import{f as g,e as M,a as c,s as D,c as vt,t as Mt}from"../chunks/DBs_ODQp.js";import{i as Rt}from"../chunks/BbaRvQ4Z.js";import{c as la,o as pa,a as rs}from"../chunks/CHX4V4AM.js";import{a7 as Ia,i as Qa,aZ as ns,a_ as Ya,a$ as Sa,K as Xt,e as Xa,b0 as Za,T as fa,b1 as os,b2 as cs,b3 as vs,q as La,b4 as ds,b5 as us,ab as ps,d as r,r as Pa,g as fs,C as Et,F as T,G as Ht,H as i,I as l,J as s,b6 as Xe,b7 as Jt,s as o,a4 as B,f as e,m as dt,E as Ne,A as H,b8 as sa,b9 as jt,ba as da,ao as ra,bb as gs}from"../chunks/DwmZeGF1.js";import{c as Tt,a as le,e as kt,i as xt,u as es,s as ea,b as yt,d as ga,f as Zt,g as bs,t as qt,h as hs,T as ms,j as _s,k as ys}from"../chunks/DQJFtNtV.js";import{i as y,s as Wt,a as st,b as _t,d as ca,e as ks}from"../chunks/0ovU14Ao.js";import{p as St,b as ja}from"../chunks/CFUzmRYW.js";import{b as va,r as Ss}from"../chunks/Bcy73Mka.js";function ya(a,n,t=!1){if(a.multiple){if(n==null)return;if(!Qa(n))return ns();for(var v of a.options)v.selected=n.includes(ua(v));return}for(v of a.options){var u=ua(v);if(Ya(u,n)){v.selected=!0;return}}(!t||n!==void 0)&&(a.selectedIndex=-1)}function Ba(a){var n=new MutationObserver(()=>{ya(a,a.__value)});n.observe(a,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Ia(()=>{n.disconnect()})}function Aa(a,n,t=n){var v=new WeakSet,u=!0;Sa(a,"change",m=>{var S=m?"[selected]":":checked",C;if(a.multiple)C=[].map.call(a.querySelectorAll(S),ua);else{var L=a.querySelector(S)??a.querySelector("option:not([disabled])");C=L&&ua(L)}t(C),Xt!==null&&v.add(Xt)}),Xa(()=>{var m=n();if(a===document.activeElement){var S=Za??Xt;if(v.has(S))return}if(ya(a,m,u),u&&m===void 0){var C=a.querySelector(":checked");C!==null&&(m=ua(C),t(m))}a.__value=m,u=!1}),Ba(a)}function ua(a){return"__value"in a?a.__value:a.value}const xs=Symbol("is custom element"),$s=Symbol("is html");function $e(a){if(fa){var n=!1,t=()=>{if(!n){if(n=!0,a.hasAttribute("value")){var v=a.value;Ye(a,"value",null),a.value=v}if(a.hasAttribute("checked")){var u=a.checked;Ye(a,"checked",null),a.checked=u}}};a.__on_r=t,La(t),ds()}}function ka(a,n){var t=Ra(a);t.value===(t.value=n??void 0)||a.value===n&&(n!==0||a.nodeName!=="PROGRESS")||(a.value=n??"")}function ts(a,n){var t=Ra(a);t.checked!==(t.checked=n??void 0)&&(a.checked=n)}function Ye(a,n,t,v){var u=Ra(a);fa&&(u[n]=a.getAttribute(n),n==="src"||n==="srcset"||n==="href"&&a.nodeName==="LINK")||u[n]!==(u[n]=t)&&(n==="loading"&&(a[os]=t),t==null?a.removeAttribute(n):typeof t!="string"&&Cs(a).includes(n)?a[n]=t:a.setAttribute(n,t))}function Ra(a){return a.__attributes??={[xs]:a.nodeName.includes("-"),[$s]:a.namespaceURI===cs}}var Ha=new Map;function Cs(a){var n=a.getAttribute("is")||a.nodeName,t=Ha.get(n);if(t)return t;Ha.set(n,t=[]);for(var v,u=a,m=Element.prototype;m!==u;){v=us(u);for(var S in v)v[S].set&&t.push(S);u=vs(u)}return t}function qe(a,n,t=n){var v=new WeakSet;Sa(a,"input",async u=>{var m=u?a.defaultValue:a.value;if(m=Ca(a)?wa(m):m,t(m),Xt!==null&&v.add(Xt),await ps(),m!==(m=n())){var S=a.selectionStart,C=a.selectionEnd,L=a.value.length;if(a.value=m??"",C!==null){var x=a.value.length;S===C&&C===L&&x>L?(a.selectionStart=x,a.selectionEnd=x):(a.selectionStart=S,a.selectionEnd=Math.min(C,x))}}}),(fa&&a.defaultValue!==a.value||r(n)==null&&a.value)&&(t(Ca(a)?wa(a.value):a.value),Xt!==null&&v.add(Xt)),Pa(()=>{var u=n();if(a===document.activeElement){var m=Za??Xt;if(v.has(m))return}Ca(a)&&u===wa(a.value)||a.type==="date"&&!u&&!a.value||u!==a.value&&(a.value=u??"")})}const $a=new Set;function Ua(a,n,t,v,u=v){var m=t.getAttribute("type")==="checkbox",S=a;let C=!1;if(n!==null)for(var L of n)S=S[L]??=[];S.push(t),Sa(t,"change",()=>{var x=t.__value;m&&(x=Na(S,x,t.checked)),u(x)},()=>u(m?[]:null)),Pa(()=>{var x=v();if(fa&&t.defaultChecked!==t.checked){C=!0;return}m?(x=x||[],t.checked=x.includes(t.__value)):t.checked=Ya(t.__value,x)}),Ia(()=>{var x=S.indexOf(t);x!==-1&&S.splice(x,1)}),$a.has(S)||($a.add(S),La(()=>{S.sort((x,ee)=>x.compareDocumentPosition(ee)===4?-1:1),$a.delete(S)})),La(()=>{if(C){var x;if(m)x=Na(S,x,t.checked);else{var ee=S.find(W=>W.checked);x=ee?.__value}u(x)}})}function Fa(a,n,t=n){Sa(a,"change",v=>{var u=v?a.defaultChecked:a.checked;t(u)}),(fa&&a.defaultChecked!==a.checked||r(n)==null)&&t(a.checked),Pa(()=>{var v=n();a.checked=!!v})}function Na(a,n,t){for(var v=new Set,u=0;u<a.length;u+=1)a[u].checked&&v.add(a[u].__value);return t||v.delete(n),Array.from(v)}function Ca(a){var n=a.type;return n==="number"||n==="range"}function wa(a){return a===""?null:+a}function ws(a,n,t){var v=fs(a,n);v&&v.set&&(a[n]=t,Ia(()=>{a[n]=null}))}function Ea(a){return function(...n){var t=n[0];return t.stopPropagation(),a?.apply(this,n)}}function na(a,n){var t=a.$$events?.[n.type],v=Qa(t)?t.slice():t==null?[]:[t];for(var u of v)u.call(this,n)}const Ds="";function as(...a){return va+Ds+Ss(a[0],a[1])}const Ma={paladin:{name:"Paladin",hitDice:"d10",spellcaster:!0,spellcastingAbility:"charisma",spellSlotsByLevel:{1:0,2:2,3:3,4:3,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Divine Sense",type:"uses",maxUses:(a,n=1)=>1+Math.max(1,n),resetOn:"long",description:"Detect celestials, fiends, and undead within 60 feet",minLevel:1},{name:"Lay on Hands",type:"pool",maxPool:a=>a*5,resetOn:"long",description:"Heal wounds or cure disease",minLevel:1},{name:"Divine Smite",type:"spellSlot",description:"Expend spell slot to deal extra radiant damage",minLevel:2,rollable:!0},{name:"Channel Divinity",type:"pool",maxPool:a=>a>=18?3:a>=6?2:1,resetOn:"short",description:"Sacred Weapon or Turn Undead",minLevel:3}]},fighter:{name:"Fighter",hitDice:"d10",spellcaster:!1,features:[{name:"Second Wind",type:"uses",maxUses:1,resetOn:"short",description:"Regain 1d10 + fighter level HP as bonus action",minLevel:1,rollable:!0,rollFormula:a=>`1d10+${a}`},{name:"Action Surge",type:"uses",maxUses:a=>a>=17?2:1,resetOn:"short",description:"Take one additional action on your turn",minLevel:2},{name:"Indomitable",type:"uses",maxUses:a=>a>=17?3:a>=13?2:1,resetOn:"long",description:"Reroll a failed saving throw",minLevel:9}],subclasses:{champion:{name:"Champion",features:[{name:"Improved Critical",type:"info",description:"Critical hit on 19-20",minLevel:3},{name:"Remarkable Athlete",type:"info",description:"Add half proficiency to STR/DEX/CON checks, increase long jump distance",minLevel:7},{name:"Additional Fighting Style",type:"info",description:"Choose a second fighting style",minLevel:10},{name:"Superior Critical",type:"info",description:"Critical hit on 18-20",minLevel:15},{name:"Survivor",type:"info",description:"Regain 5 + CON mod HP at start of turn if below half HP",minLevel:18}]},battlemaster:{name:"Battle Master",features:[{name:"Combat Superiority",type:"uses",maxUses:a=>a>=15?6:a>=7?5:4,resetOn:"short",description:a=>`Use superiority dice (${a>=18?"d12":a>=10?"d10":"d8"}) for maneuvers`,minLevel:3},{name:"Know Your Enemy",type:"info",description:"Learn capabilities of creatures you observe",minLevel:7},{name:"Improved Combat Superiority",type:"info",description:"Superiority dice become d10",minLevel:10},{name:"Relentless",type:"info",description:"Regain 1 superiority die if you have none at start of turn",minLevel:15}]}}},rogue:{name:"Rogue",hitDice:"d8",spellcaster:!1,features:[{name:"Sneak Attack",type:"info",description:a=>`Deal ${Math.ceil(a/2)}d6 extra damage once per turn with advantage or ally nearby`,minLevel:1,rollable:!0,rollFormula:a=>`${Math.ceil(a/2)}d6`},{name:"Cunning Action",type:"info",description:"Dash, Disengage, or Hide as a bonus action",minLevel:2},{name:"Uncanny Dodge",type:"info",description:"Use reaction to halve damage from an attack",minLevel:5},{name:"Evasion",type:"info",description:"Take no damage on successful Dex save (half on fail)",minLevel:7}]},wizard:{name:"Wizard",hitDice:"d6",spellcaster:!0,spellcastingAbility:"intelligence",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Arcane Recovery",type:"uses",maxUses:1,resetOn:"long",description:a=>`Recover spell slots totaling up to ${Math.ceil(a/2)} levels during short rest`,minLevel:1},{name:"Spell Mastery",type:"info",description:"Cast one 1st-level and one 2nd-level spell at will",minLevel:18}]},cleric:{name:"Cleric",hitDice:"d8",spellcaster:!0,spellcastingAbility:"wisdom",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Channel Divinity",type:"pool",maxPool:a=>a>=18?3:a>=6?2:1,resetOn:"short",description:"Turn Undead or domain-specific ability",minLevel:2},{name:"Destroy Undead",type:"info",description:a=>`Channel Divinity destroys undead of CR ${a>=17?4:a>=14?3:a>=11?2:a>=8?1:.5} or lower`,minLevel:5},{name:"Divine Intervention",type:"uses",maxUses:1,resetOn:"long",description:a=>`${a}% chance to succeed, implore deity for aid`,minLevel:10}],subclasses:{war:{name:"War Domain",features:[{name:"War Priest",type:"uses",maxUses:(a,n=1)=>Math.max(1,n),resetOn:"long",description:"Make one weapon attack as a bonus action",minLevel:1},{name:"Guided Strike",type:"channelDivinity",description:"Use your Channel Divinity to gain +10 to an attack roll. Make this choice after you see the roll, but before the DM says whether the attack hits or misses.",minLevel:2,resetOn:"short"},{name:"War God's Blessing",type:"channelDivinity",description:"Use reaction to grant +10 to an ally's attack roll within 30 feet. Consumes one use of Channel Divinity.",minLevel:6,resetOn:"short"},{name:"Divine Strike",type:"info",description:a=>`Deal extra ${a>=14?"2d8":"1d8"} weapon damage once per turn`,minLevel:8,rollable:!0,rollFormula:a=>a>=14?"2d8":"1d8"},{name:"Avatar of Battle",type:"info",description:"Gain resistance to nonmagical weapon damage",minLevel:17}]},life:{name:"Life Domain",features:[{name:"Disciple of Life",type:"info",description:"Healing spells restore additional 2 + spell level HP",minLevel:1},{name:"Preserve Life",type:"pool",maxPool:a=>a*5,resetOn:"short",description:"Restore HP to creatures within 30 feet",minLevel:2},{name:"Blessed Healer",type:"info",description:"Regain 2 + spell level HP when you cast healing spell",minLevel:6},{name:"Divine Strike",type:"info",description:a=>`Deal extra ${a>=14?"2d8":"1d8"} radiant damage once per turn`,minLevel:8,rollable:!0,rollFormula:a=>a>=14?"2d8":"1d8"},{name:"Supreme Healing",type:"info",description:"Maximize healing dice instead of rolling",minLevel:17}]}}},barbarian:{name:"Barbarian",hitDice:"d12",spellcaster:!1,features:[{name:"Rage",type:"uses",maxUses:a=>a>=20?1/0:a>=17?6:a>=12?5:a>=6?4:a>=3?3:2,resetOn:"long",description:a=>`+${a>=16?4:a>=9?3:2} damage, resistance to physical damage`,minLevel:1},{name:"Reckless Attack",type:"info",description:"Gain advantage on melee attacks, enemies get advantage on you",minLevel:2},{name:"Danger Sense",type:"info",description:"Advantage on Dex saves against effects you can see",minLevel:2}],subclasses:{berserker:{name:"Path of the Berserker",features:[{name:"Frenzy",type:"info",description:"While raging, make melee attack as bonus action (gain 1 exhaustion after rage)",minLevel:3},{name:"Mindless Rage",type:"info",description:"Cannot be charmed or frightened while raging",minLevel:6},{name:"Intimidating Presence",type:"info",description:"Use action to frighten creature within 30 feet",minLevel:10},{name:"Retaliation",type:"info",description:"When damaged by creature within 5 feet, make melee attack as reaction",minLevel:14}]}}}};function Pt(a){const n=a.toLowerCase();return Ma[n]||null}function oa(a,n,t){const v=Pt(a);if(!v)return[];const u=v.features.filter(m=>!m.minLevel||m.minLevel<=n);if(t&&v.subclasses&&v.subclasses[t]){const m=v.subclasses[t].features.filter(S=>!S.minLevel||S.minLevel<=n);return[...u,...m]}return u}function Ga(a){const n=Pt(a);return!n||!n.subclasses?[]:Object.keys(n.subclasses).map(t=>({id:t,name:n.subclasses[t].name}))}function Oa(a,n){const t=Pt(a);return!t||!t.spellcaster||!t.spellSlotsByLevel?0:t.spellSlotsByLevel[n]||0}function qa(a,n,t){const v=Pt(a);return!v||!v.spellcaster?0:Math.max(1,t+n)}function Ls(a,n,t){const v=Pt(a);return!v||!v.spellcaster?null:8+n+t}function js(){return Object.keys(Ma).map(a=>({id:a,name:Ma[a].name}))}var Bs=g('<div class="section-header svelte-ls99y2" role="button" tabindex="0"><h2 class="svelte-ls99y2"> </h2> <span class="collapse-btn svelte-ls99y2"> </span></div>');function ia(a,n){Et(n,!1);let t=St(n,"title",8),v=St(n,"collapsed",8),u=St(n,"ariaLabel",8,""),m=St(n,"onToggle",8);Rt();var S=Bs(),C=i(S),L=i(C,!0);l(C);var x=s(C,2),ee=i(x,!0);l(x),l(S),T(()=>{Ye(S,"aria-expanded",!v()),Ye(S,"aria-label",u()),D(L,t()),D(ee,v()?"‚ñº":"‚ñ≤")}),M("click",S,function(...W){m()?.apply(this,W)}),M("keydown",S,W=>{(W.key==="Enter"||W.key===" ")&&m()()}),c(a,S),Ht()}var As=g("<option> </option>"),Fs=g("<option> </option>"),Ms=g('<div class="form-group svelte-172i2fj"><label for="characterSubclass" class="svelte-172i2fj">Subclass</label> <select id="characterSubclass" class="svelte-172i2fj"><option>Select Subclass</option><!></select></div>'),Ts=g('<div class="info-grid svelte-172i2fj"><div class="form-group svelte-172i2fj"><label for="characterName" class="svelte-172i2fj">Character Name</label> <input type="text" id="characterName" placeholder="Enter name" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterClass" class="svelte-172i2fj">Class</label> <select id="characterClass" class="svelte-172i2fj"><option>Select Class</option><!></select></div> <!> <div class="form-group svelte-172i2fj"><label for="characterLevel" class="svelte-172i2fj">Level</label> <input type="number" id="characterLevel" min="1" max="20" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterRace" class="svelte-172i2fj">Race</label> <input type="text" id="characterRace" placeholder="e.g., Human" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterBackground" class="svelte-172i2fj">Background</label> <input type="text" id="characterBackground" placeholder="e.g., Soldier" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterAlignment" class="svelte-172i2fj">Alignment</label> <input type="text" id="characterAlignment" placeholder="e.g., Lawful Good" class="svelte-172i2fj"/></div></div>'),Is=g('<section class="character-info svelte-172i2fj"><!> <!></section>');function Ps(a,n){Et(n,!1);const t=()=>st(le,"$character",u),v=()=>st(Tt,"$collapsedStates",u),[u,m]=Wt(),S=B(),C=js();function L(_e){const pe=_e.target;le.update(G=>(G.class=pe.value,G.subclass="",G))}function x(_e){const pe=_e.target;le.update(G=>(G.subclass=pe.value,G))}function ee(_e){const pe=_e.target;le.update(G=>(G.level=parseInt(pe.value)||1,G)),es()}Xe(()=>(t(),Ga),()=>{o(S,t().class?Ga(t().class):[])}),Jt(),Rt();var W=Is(),ne=i(W);{let _e=dt(()=>(v(),r(()=>v().characterInfo?"Expand":"Collapse")));ia(ne,{title:"Character Info",get collapsed(){return v(),r(()=>v().characterInfo)},get ariaLabel(){return e(_e)},onToggle:()=>Tt.update(pe=>({...pe,characterInfo:!pe.characterInfo}))})}var V=s(ne,2);{var Q=_e=>{var pe=Ts(),G=i(pe),Ae=s(i(G),2);$e(Ae),l(G);var Ke=s(G,2),se=s(i(Ke),2),We=i(se);We.value=We.__value="";var Pe=s(We);kt(Pe,1,()=>C,xt,(Re,we)=>{var h=As(),P=i(h,!0);l(h);var q={};T(()=>{D(P,(e(we),r(()=>e(we).name))),q!==(q=(e(we),r(()=>e(we).id)))&&(h.value=(h.__value=(e(we),r(()=>e(we).id)))??"")}),c(Re,h)}),l(se);var te;Ba(se),l(Ke);var ge=s(Ke,2);{var Fe=Re=>{var we=Ms(),h=s(i(we),2),P=i(h);P.value=P.__value="";var q=s(P);kt(q,1,()=>e(S),xt,(z,fe)=>{var De=Fs(),nt=i(De,!0);l(De);var be={};T(()=>{D(nt,(e(fe),r(()=>e(fe).name))),be!==(be=(e(fe),r(()=>e(fe).id)))&&(De.value=(De.__value=(e(fe),r(()=>e(fe).id)))??"")}),c(z,De)}),l(h);var Y;Ba(h),l(we),T(()=>{Y!==(Y=(t(),r(()=>t().subclass)))&&(h.value=(h.__value=(t(),r(()=>t().subclass)))??"",ya(h,(t(),r(()=>t().subclass))))}),M("change",h,x),c(Re,we)};y(ge,Re=>{e(S),r(()=>e(S).length>0)&&Re(Fe)})}var Se=s(ge,2),Le=s(i(Se),2);$e(Le),l(Se);var w=s(Se,2),oe=s(i(w),2);$e(oe),l(w);var f=s(w,2),$=s(i(f),2);$e($),l(f);var O=s(f,2),Ce=s(i(O),2);$e(Ce),l(O),l(pe),T(()=>{te!==(te=(t(),r(()=>t().class)))&&(se.value=(se.__value=(t(),r(()=>t().class)))??"",ya(se,(t(),r(()=>t().class)))),ka(Le,(t(),r(()=>t().level)))}),qe(Ae,()=>t().name,Re=>_t(le,r(t).name=Re,r(t))),M("change",se,L),M("change",Le,ee),qe(oe,()=>t().race,Re=>_t(le,r(t).race=Re,r(t))),qe($,()=>t().background,Re=>_t(le,r(t).background=Re,r(t))),qe(Ce,()=>t().alignment,Re=>_t(le,r(t).alignment=Re,r(t))),c(_e,pe)};y(V,_e=>{v(),r(()=>!v().characterInfo)&&_e(Q)})}l(W),c(a,W),Ht(),m()}var Rs=g('<div class="ability-card svelte-bbv1xt"><h3 class="svelte-bbv1xt"> </h3> <input type="number" class="ability-score svelte-bbv1xt" min="1" max="30"/> <div class="ability-modifier svelte-bbv1xt"> </div> <div class="roll-buttons svelte-bbv1xt"><button class="roll-btn svelte-bbv1xt">Check</button> <button class="roll-btn svelte-bbv1xt">Save</button></div> <div class="save-proficiency svelte-bbv1xt"><input type="checkbox" class="svelte-bbv1xt"/> <label class="svelte-bbv1xt">Save Prof.</label></div></div>'),Es=g('<div class="proficiency-bonus svelte-bbv1xt"><label for="profBonus">Proficiency Bonus</label> <input type="number" id="profBonus" class="prof-input svelte-bbv1xt"/></div> <div class="abilities-grid svelte-bbv1xt"></div>',1),Hs=g("<section><!> <!></section>");function Us(a,n){Et(n,!1);const t=()=>st(ga,"$abilityModifiers",C),v=()=>st(le,"$character",C),u=()=>st(ea,"$searchFilter",C),m=()=>st(Tt,"$collapsedStates",C),S=()=>st(Zt,"$isEditMode",C),[C,L]=Wt(),x=B(),ee=B(),W=la(),ne=[{key:"strength",label:"Strength"},{key:"dexterity",label:"Dexterity"},{key:"constitution",label:"Constitution"},{key:"intelligence",label:"Intelligence"},{key:"wisdom",label:"Wisdom"},{key:"charisma",label:"Charisma"}];function V(){es()}function Q(We){const Pe=t()[We],te=`1d20${Pe>=0?"+":""}${Pe}`,ge=[];ge.push({value:"1d20",source:"base die"}),Pe!==0&&ge.push({value:Pe,source:We}),W("roll",{notation:te,rollType:"check",bonusBreakdown:ge})}function _e(We){const Pe=t()[We],te=v().saveProficiencies[We]?v().proficiencyBonus:0,ge=Pe+te,Fe=`1d20${ge>=0?"+":""}${ge}`,Se=[];Se.push({value:"1d20",source:"base die"}),Pe!==0&&Se.push({value:Pe,source:We}),te!==0&&Se.push({value:te,source:"proficiency"}),W("roll",{notation:Fe,rollType:"save",bonusBreakdown:Se})}Xe(()=>u(),()=>{o(x,ne.filter(({label:We})=>u()?We.toLowerCase().includes(u().toLowerCase()):!0))}),Xe(()=>(e(x),u()),()=>{o(ee,e(x).length>0||!u()||u().toLowerCase().includes("proficiency"))}),Jt(),Rt();var pe=Hs();let G;var Ae=i(pe);ia(Ae,{title:"Ability Scores",get collapsed(){return m(),r(()=>m().abilityScores)},ariaLabel:"Toggle Ability Scores Section",onToggle:()=>Tt.update(We=>({...We,abilityScores:!We.abilityScores}))});var Ke=s(Ae,2);{var se=We=>{var Pe=Es(),te=Ne(Pe),ge=s(i(te),2);$e(ge),l(te);var Fe=s(te,2);kt(Fe,5,()=>e(x),xt,(Se,Le)=>{let w=()=>e(Le).key,oe=()=>e(Le).label;var f=Rs(),$=i(f),O=i($,!0);l($);var Ce=s($,2);$e(Ce);var Re=s(Ce,2),we=i(Re);l(Re);var h=s(Re,2),P=i(h),q=s(P,2);l(h);var Y=s(h,2),z=i(Y);$e(z);var fe=s(z,2);l(Y),l(f),T(De=>{D(O,De),D(we,`${t(),w(),r(()=>t()[w()]>=0?"+":"")??""}${t(),w(),r(()=>t()[w()])??""}`),z.disabled=!S(),Ye(z,"id",`${w()}-save`),Ye(fe,"for",`${w()}-save`)},[()=>(oe(),r(()=>oe().substring(0,3).toUpperCase()))]),qe(Ce,()=>v().abilities[w()],De=>_t(le,r(v).abilities[w()]=De,r(v))),M("change",Ce,V),M("click",P,()=>Q(w())),M("click",q,()=>_e(w())),Fa(z,()=>v().saveProficiencies[w()],De=>_t(le,r(v).saveProficiencies[w()]=De,r(v))),c(Se,f)}),l(Fe),qe(ge,()=>v().proficiencyBonus,Se=>_t(le,r(v).proficiencyBonus=Se,r(v))),c(We,Pe)};y(Ke,We=>{m(),r(()=>!m().abilityScores)&&We(se)})}l(pe),T(()=>G=yt(pe,1,"ability-scores svelte-bbv1xt",null,G,{hidden:!e(ee)})),c(a,pe),Ht(),L()}function ss(a){return Math.floor((a-10)/2)}function Ta(a,n){if(!a.class)return null;const t=Pt(a.class);if(!t||!t.spellcaster||!t.spellcastingAbility)return null;const v=n[t.spellcastingAbility];return 8+a.proficiencyBonus+v}function Wa(a,n){if(!a.class)return 0;const t=Pt(a.class);return!t||!t.spellcaster||!t.spellcastingAbility?0:n[t.spellcastingAbility]}function Ns(a,n){const t=[],v=ss(n.dexterity);t.push("Base: 10"),v!==0&&t.push(`Dexterity: ${v>=0?"+":""}${v}`);const u=10+v,m=a.armorClass-u;return m!==0&&t.push(`Armor/Other: ${m>=0?"+":""}${m}`),t.join(`
`)}function Gs(a,n){const t=[],v=ss(n.dexterity);t.push(`Dexterity: ${v>=0?"+":""}${v}`);const u=a.initiative-v;return u!==0&&t.push(`Other Bonuses: ${u>=0?"+":""}${u}`),t.join(`
`)}function Os(a,n){if(!a.class)return"";const t=Pt(a.class);if(!t||!t.spellcaster||!t.spellcastingAbility)return"";const v=[],u=n[t.spellcastingAbility],m=t.spellcastingAbility.charAt(0).toUpperCase()+t.spellcastingAbility.slice(1);return v.push("Base: 8"),v.push(`Proficiency: +${a.proficiencyBonus}`),v.push(`${m}: ${u>=0?"+":""}${u}`),v.join(`
`)}var qs=g('<input type="number" id="armorClass" class="stat-input svelte-1r5hyyb"/>'),Ws=g('<input type="text" id="armorClass" readonly=""/>'),zs=g('<div> </div> <div style="margin-top: 5px;"> </div>',1),Ks=g("<div> </div>"),Vs=g('<div class="tooltip-popup svelte-1r5hyyb"><!></div>'),Js=g('<div class="tooltip-popup svelte-1r5hyyb"> </div>'),Qs=g('<div class="tooltip-popup svelte-1r5hyyb"> </div>'),Ys=g('<div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="spellSaveDC" class="svelte-1r5hyyb">Spell Save DC</label> <button class="info-icon svelte-1r5hyyb" aria-label="Show Spell Save DC breakdown" type="button">‚ÑπÔ∏è</button></div> <input type="number" id="spellSaveDC" class="stat-input svelte-1r5hyyb" readonly=""/> <!></div>'),Xs=g('<span class="hit-dice-type"> </span>'),Zs=g('<div class="stats-grid svelte-1r5hyyb"><div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="armorClass" class="svelte-1r5hyyb">Armor Class</label> <button class="info-icon svelte-1r5hyyb" aria-label="Show AC breakdown" type="button">‚ÑπÔ∏è</button></div> <!> <!></div> <div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="initiative" class="svelte-1r5hyyb">Initiative</label> <button class="info-icon svelte-1r5hyyb" aria-label="Show Initiative breakdown" type="button">‚ÑπÔ∏è</button></div> <input type="number" id="initiative" class="stat-input svelte-1r5hyyb"/> <!></div> <div class="stat-box svelte-1r5hyyb"><label for="speed" class="svelte-1r5hyyb">Speed</label> <input type="text" id="speed" class="stat-input svelte-1r5hyyb"/></div> <!></div> <div class="hp-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Points</h3> <div><div class="hp-inputs svelte-1r5hyyb"><input type="number" class="hp-current svelte-1r5hyyb" min="0"/> <span class="hp-separator svelte-1r5hyyb">/</span> <input type="number" class="hp-max svelte-1r5hyyb" min="0"/></div> <div class="hp-controls svelte-1r5hyyb"><button class="hp-btn svelte-1r5hyyb">‚àí</button> <button class="hp-btn svelte-1r5hyyb">+</button> <button class="hp-btn svelte-1r5hyyb">‚àí5</button> <button class="hp-btn svelte-1r5hyyb">+5</button></div></div> <div class="temp-hp svelte-1r5hyyb"><label for="tempHP" class="svelte-1r5hyyb">Temp HP</label> <input type="number" id="tempHP" min="0" class="svelte-1r5hyyb"/></div></div> <div class="hit-dice-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Dice</h3> <div class="hit-dice-display svelte-1r5hyyb"><input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <span>/</span> <input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <!></div> <div class="hit-dice-controls svelte-1r5hyyb"><label for="hitDiceCount" class="svelte-1r5hyyb">Roll</label> <div class="hit-dice-count-controls svelte-1r5hyyb"><button class="hit-dice-btn svelte-1r5hyyb">‚àí</button> <input type="number" id="hitDiceCount" class="hit-dice-count-input svelte-1r5hyyb" min="1"/> <button class="hit-dice-btn svelte-1r5hyyb">+</button></div> <button class="btn btn-primary roll-hit-dice use-enabled svelte-1r5hyyb">üé≤ Roll</button></div></div>',1),el=g("<section><!> <!></section>");function tl(a,n){Et(n,!1);const t=()=>st(le,"$character",C),v=()=>st(ga,"$abilityModifiers",C),u=()=>st(ea,"$searchFilter",C),m=()=>st(Tt,"$collapsedStates",C),S=()=>st(Zt,"$isEditMode",C),[C,L]=Wt(),x=B(),ee=B(),W=B(),ne=B(),V=B(),Q=B(),_e=B(),pe=la();let G=B(1),Ae=B(!1),Ke=B(!1),se=B(!1);function We(f){f==="ac"?(o(Ae,!e(Ae)),o(Ke,!1),o(se,!1)):f==="initiative"?(o(Ke,!e(Ke)),o(Ae,!1),o(se,!1)):(o(se,!e(se)),o(Ae,!1),o(Ke,!1))}function Pe(f){le.update($=>($.currentHP=Math.max(0,Math.min($.maxHP,$.currentHP+f)),$))}function te(f){const $=e(G)+f,O=t().hitDice.current;o(G,Math.max(1,Math.min(O,$)))}function ge(f=1){if(t().hitDice.current<=0){alert("No hit dice remaining!");return}if(!t().class){alert("Please select a class first!");return}const $=Pt(t().class);if(!$){alert("Invalid class configuration!");return}const O=Math.min(f,t().hitDice.current),Ce=$.hitDice,Re=v().constitution,we=Re*O,h=we>=0?`+${we}`:`${we}`,P=`${O}${Ce}${h}`,q=[];if(q.push({value:`${O}${Ce}`,source:"hit dice"}),Re!==0)for(let Y=0;Y<O;Y++)q.push({value:Re,source:"constitution"});pe("rollHitDice",{notation:P,hitDie:Ce,count:O,bonusBreakdown:q})}Xe(()=>(t(),v()),()=>{o(x,Ta(t(),v()))}),Xe(()=>(t(),v()),()=>{o(ee,Ns(t(),v()))}),Xe(()=>(t(),v()),()=>{o(W,Gs(t(),v()))}),Xe(()=>(t(),v()),()=>{o(ne,Os(t(),v()))}),Xe(()=>(t(),e(G)),()=>{const f=t().hitDice.current;f>0&&e(G)>f&&o(G,f)}),Xe(()=>t(),()=>{o(V,t().activeStates&&t().activeStates.length>0?t().activeStates.reduce((f,$)=>f+($.acBonus||0),0):0)}),Xe(()=>t(),()=>{o(Q,t().activeStates&&t().activeStates.length>0?t().activeStates.some(f=>f.name==="Aid"&&f.target==="self"):!1)}),Xe(()=>u(),()=>{o(_e,!u()||"armor class".includes(u().toLowerCase())||"initiative".includes(u().toLowerCase())||"speed".includes(u().toLowerCase())||"hit points".includes(u().toLowerCase())||"hp".includes(u().toLowerCase())||"hit dice".includes(u().toLowerCase())||"spell save".includes(u().toLowerCase())||"combat".includes(u().toLowerCase()))}),Jt(),Rt();var Fe=el();let Se;var Le=i(Fe);{let f=dt(()=>(m(),r(()=>m().combatStats?"Expand":"Collapse")));ia(Le,{title:"Combat Stats",get collapsed(){return m(),r(()=>m().combatStats)},get ariaLabel(){return e(f)},onToggle:()=>Tt.update($=>({...$,combatStats:!$.combatStats}))})}var w=s(Le,2);{var oe=f=>{var $=Zs(),O=Ne($),Ce=i(O),Re=i(Ce),we=s(i(Re),2);l(Re);var h=s(Re,2);{var P=b=>{var k=qs();$e(k),qe(k,()=>t().armorClass,R=>_t(le,r(t).armorClass=R,r(t))),c(b,k)},q=b=>{var k=Ws();$e(k),T(()=>{ka(k,(e(V),t(),r(()=>e(V)!==0?`${t().armorClass} ‚Üí ${t().armorClass+e(V)}`:`${t().armorClass}`))),yt(k,1,bs(e(V)!==0?"stat-input ac-enhanced":"stat-input"),"svelte-1r5hyyb")}),c(b,k)};y(h,b=>{S()?b(P):b(q,!1)})}var Y=s(h,2);{var z=b=>{var k=Vs(),R=i(k);{var he=ze=>{var E=zs(),tt=Ne(E),ut=i(tt,!0);l(tt);var ft=s(tt,2),p=i(ft);l(ft),T(()=>{D(ut,e(ee)),D(p,`Active Effects: +${e(V)??""}`)}),c(ze,E)},me=ze=>{var E=Ks(),tt=i(E,!0);l(E),T(()=>D(tt,e(ee))),c(ze,E)};y(R,ze=>{e(V)!==0?ze(he):ze(me,!1)})}l(k),c(b,k)};y(Y,b=>{e(Ae)&&b(z)})}l(Ce);var fe=s(Ce,2),De=i(fe),nt=s(i(De),2);l(De);var be=s(De,2);$e(be);var Ve=s(be,2);{var I=b=>{var k=Js(),R=i(k,!0);l(k),T(()=>D(R,e(W))),c(b,k)};y(Ve,b=>{e(Ke)&&b(I)})}l(fe);var j=s(fe,2),ie=s(i(j),2);$e(ie),l(j);var ce=s(j,2);{var K=b=>{var k=Ys(),R=i(k),he=s(i(R),2);l(R);var me=s(R,2);$e(me);var ze=s(me,2);{var E=tt=>{var ut=Qs(),ft=i(ut,!0);l(ut),T(()=>D(ft,e(ne))),c(tt,ut)};y(ze,tt=>{e(se)&&tt(E)})}l(k),T(()=>ka(me,e(x))),M("click",he,()=>We("spellSaveDC")),c(b,k)};y(ce,b=>{e(x)!==null&&b(K)})}l(O);var d=s(O,2),Ee=s(i(d),2);let ve;var de=i(Ee),A=i(de);$e(A);var Me=s(A,4);$e(Me),l(de);var Te=s(de,2),Ze=i(Te),it=s(Ze,2),je=s(it,2),ye=s(je,2);l(Te),l(Ee);var Be=s(Ee,2),He=s(i(Be),2);$e(He),l(Be),l(d);var Ue=s(d,2),Ge=s(i(Ue),2),X=i(Ge);$e(X);var ue=s(X,4);$e(ue);var Oe=s(ue,2);{var et=b=>{const k=dt(()=>(H(Pt),t(),r(()=>Pt(t().class))));var R=vt(),he=Ne(R);{var me=ze=>{const E=dt(()=>(v(),r(()=>v().constitution)));var tt=Xs(),ut=i(tt);l(tt),T(()=>D(ut,`(${H(e(k)),r(()=>e(k).hitDice)??""}${(e(E)>=0?`+${e(E)}`:e(E))??""})`)),c(ze,tt)};y(he,ze=>{e(k)&&ze(me)})}c(b,R)};y(Oe,b=>{t(),r(()=>t().class)&&b(et)})}l(Ge);var ke=s(Ge,2),_=s(i(ke),2),N=i(_),Z=s(N,2);$e(Z);var J=s(Z,2);l(_);var re=s(_,2);l(ke),l(Ue),T(()=>{ve=yt(Ee,1,"hp-display svelte-1r5hyyb",null,ve,{"aid-active":e(Q)}),Ye(A,"max",(t(),r(()=>t().maxHP))),Ye(X,"max",(t(),r(()=>t().hitDice.max))),N.disabled=e(G)<=1,Ye(Z,"max",(t(),r(()=>t().hitDice.current))),J.disabled=(e(G),t(),r(()=>e(G)>=t().hitDice.current)),re.disabled=(t(),r(()=>t().hitDice.current<=0||!t().class))}),M("click",we,()=>We("ac")),M("click",nt,()=>We("initiative")),qe(be,()=>t().initiative,b=>_t(le,r(t).initiative=b,r(t))),qe(ie,()=>t().speed,b=>_t(le,r(t).speed=b,r(t))),qe(A,()=>t().currentHP,b=>_t(le,r(t).currentHP=b,r(t))),qe(Me,()=>t().maxHP,b=>_t(le,r(t).maxHP=b,r(t))),M("click",Ze,()=>Pe(-1)),M("click",it,()=>Pe(1)),M("click",je,()=>Pe(-5)),M("click",ye,()=>Pe(5)),qe(He,()=>t().tempHP,b=>_t(le,r(t).tempHP=b,r(t))),qe(X,()=>t().hitDice.current,b=>_t(le,r(t).hitDice.current=b,r(t))),qe(ue,()=>t().hitDice.max,b=>_t(le,r(t).hitDice.max=b,r(t))),M("click",N,()=>te(-1)),qe(Z,()=>e(G),b=>o(G,b)),M("input",Z,b=>{const k=b.target,R=parseInt(k.value);R>t().hitDice.current&&o(G,t().hitDice.current),R<1&&o(G,1)}),M("click",J,()=>te(1)),M("click",re,()=>ge(e(G))),c(f,$)};y(w,f=>{m(),r(()=>!m().combatStats)&&f(oe)})}l(Fe),T(()=>Se=yt(Fe,1,"combat-stats svelte-1r5hyyb",null,Se,{hidden:!e(_e)})),c(a,Fe),Ht(),L()}const ba={acrobatics:"dexterity",animalHandling:"wisdom",arcana:"intelligence",athletics:"strength",deception:"charisma",history:"intelligence",insight:"wisdom",intimidation:"charisma",investigation:"intelligence",medicine:"wisdom",nature:"intelligence",perception:"wisdom",performance:"charisma",persuasion:"charisma",religion:"intelligence",sleightOfHand:"dexterity",stealth:"dexterity",survival:"wisdom"};var al=g('<div class="skill-row svelte-1f1pl16"><input type="checkbox" class="svelte-1f1pl16"/> <label class="svelte-1f1pl16"> <span class="ability-tag svelte-1f1pl16"> </span></label> <span class="skill-modifier svelte-1f1pl16"> </span> <button class="roll-btn svelte-1f1pl16">Roll</button></div>'),sl=g('<div class="skills-grid svelte-1f1pl16"></div>'),ll=g("<section><!> <!></section>");function il(a,n){Et(n,!1);const t=()=>st(le,"$character",C),v=()=>st(ga,"$abilityModifiers",C),u=()=>st(ea,"$searchFilter",C),m=()=>st(Tt,"$collapsedStates",C),S=()=>st(Zt,"$isEditMode",C),[C,L]=Wt(),x=B(),ee=B(),W=B(),ne=B(),V=B(),Q=B(),_e=la(),pe=[{key:"acrobatics",label:"Acrobatics"},{key:"animalHandling",label:"Animal Handling"},{key:"arcana",label:"Arcana"},{key:"athletics",label:"Athletics"},{key:"deception",label:"Deception"},{key:"history",label:"History"},{key:"insight",label:"Insight"},{key:"intimidation",label:"Intimidation"},{key:"investigation",label:"Investigation"},{key:"medicine",label:"Medicine"},{key:"nature",label:"Nature"},{key:"perception",label:"Perception"},{key:"performance",label:"Performance"},{key:"persuasion",label:"Persuasion"},{key:"religion",label:"Religion"},{key:"sleightOfHand",label:"Sleight of Hand"},{key:"stealth",label:"Stealth"},{key:"survival",label:"Survival"}];function G(te){const ge=ba[te],Fe=v()[ge],Se=t().skillProficiencies[te]?t().proficiencyBonus:0,Le=e(x)[te],w=`1d20${Le>=0?"+":""}${Le}`,oe=[];oe.push({value:"1d20",source:"base die"}),Fe!==0&&oe.push({value:Fe,source:ge}),Se!==0&&oe.push({value:Se,source:"proficiency"}),_e("roll",{notation:w,rollType:"check",bonusBreakdown:oe})}Xe(()=>{},()=>{o(x,{})}),Xe(()=>t(),()=>{o(ee,t().skillProficiencies)}),Xe(()=>t(),()=>{o(W,t().proficiencyBonus)}),Xe(()=>v(),()=>{o(ne,v())}),Xe(()=>(e(ne),e(ee),e(W)),()=>{for(const{key:te}of pe){const ge=ba[te],Fe=e(ne)[ge],Se=e(ee)[te]?e(W):0;sa(x,e(x)[te]=Fe+Se)}}),Xe(()=>u(),()=>{o(V,pe.filter(({label:te})=>u()?te.toLowerCase().includes(u().toLowerCase()):!0))}),Xe(()=>e(V),()=>{o(Q,e(V).length>0)}),Jt(),Rt();var Ae=ll();let Ke;var se=i(Ae);{let te=dt(()=>(m(),r(()=>m().skills?"Expand":"Collapse")));ia(se,{title:"Skills",get collapsed(){return m(),r(()=>m().skills)},get ariaLabel(){return e(te)},onToggle:()=>Tt.update(ge=>({...ge,skills:!ge.skills}))})}var We=s(se,2);{var Pe=te=>{var ge=sl();kt(ge,5,()=>e(V),xt,(Fe,Se)=>{let Le=()=>e(Se).key,w=()=>e(Se).label;var oe=al(),f=i(oe);$e(f);var $=s(f,2),O=i($),Ce=s(O),Re=i(Ce);l(Ce),l($);var we=s($,2),h=i(we);l(we);var P=s(we,2);l(oe),T(q=>{ts(f,(e(ee),Le(),r(()=>e(ee)[Le()]))),f.disabled=!S(),Ye(f,"id",Le()),Ye($,"for",Le()),D(O,`${w()??""} `),D(Re,`(${q??""})`),D(h,`${e(x),Le(),r(()=>e(x)[Le()]>=0?"+":"")??""}${e(x),Le(),r(()=>e(x)[Le()])??""}`)},[()=>(H(ba),Le(),r(()=>ba[Le()].substring(0,3).toUpperCase()))]),M("change",f,q=>{console.log("Skill proficiency changed:",Le(),q.target.checked),le.update(Y=>({...Y,skillProficiencies:{...Y.skillProficiencies,[Le()]:q.target.checked}}))}),M("click",P,()=>G(Le())),c(Fe,oe)}),l(ge),c(te,ge)};y(We,te=>{m(),r(()=>!m().skills)&&te(Pe)})}l(Ae),T(()=>Ke=yt(Ae,1,"skills svelte-1f1pl16",null,Ke,{hidden:!e(Q)})),c(a,Ae),Ht(),L()}let ha=null,ma=null;async function ls(){if(ha)return ha;try{return ha=await(await fetch(as("/data/spells.json"))).json(),ha||[]}catch(a){return console.error("Failed to load spells:",a),[]}}async function rl(){if(ma)return ma;try{return ma=await(await fetch(as("/data/feats.json"))).json(),ma||[]}catch(a){return console.error("Failed to load feats:",a),[]}}function za(a,n){if(!n.trim())return a;const t=n.toLowerCase();return a.filter(v=>v.name.toLowerCase().includes(t)||v.school.toLowerCase().includes(t)||v.classes.some(u=>u.toLowerCase().includes(t))||v.description.toLowerCase().includes(t))}function nl(a,n){return n===null?a:a.filter(t=>t.level===n)}function ol(a,n){if(!n.trim())return a;const t=n.toLowerCase();return a.filter(v=>v.name.toLowerCase().includes(t)||v.description.toLowerCase().includes(t))}function _a(a){const n=a.description,t=/\b(Strength|Dexterity|Constitution|Intelligence|Wisdom|Charisma)\s+saving\s+throw/i,v=n.match(t);if(!v)return null;const u=v[1].toLowerCase(),S=/half\s+(?:as\s+much\s+)?damage\s+on\s+a\s+successful(?:\s+save)?/i.test(n),L=/saving\s+throw\s+or\s+take.*?damage/i.test(n)&&!S;return{ability:u,halfDamageOnSave:S,noDamageOnSave:L}}function cl(a){const n=a.description;return/(plus|add)\s+your\s+spellcasting\s+(ability\s+)?modifier/i.test(n)}function Da(a){const n=a.description.toLowerCase();return n.includes("ranged spell attack")||n.includes("melee spell attack")}function Ka(a){const n=a.description.toLowerCase();if(["Divine Favor","Bless","Aid","Command"].includes(a.name))return!0;const u=["takes","take","deals","deal","damage equal to","force damage","fire damage","cold damage","lightning damage","thunder damage","acid damage","poison damage","necrotic damage","radiant damage","psychic damage","regain","regains","hit point"].some(C=>n.includes(C));return["bonus to attack","bonus to damage","bonus to ac","gains a +","gain a +","+1 bonus","+2 bonus","+3 bonus","advantage on","becomes a magic weapon"].some(C=>n.includes(C))&&!u}function vl(a){const n=a.description;let t=0,v=0,u=0,m="";const S=n.match(/\+(\d+)\s+bonus\s+to\s+attack\s+rolls\s+and\s+damage\s+rolls/i);if(S){const L=parseInt(S[1]);t=L,v=L,m=`+${L} to attack and damage rolls`}if(a.name==="Bless"&&(m="Add 1d4 to attack rolls and saves",t="1d4"),a.name==="Aid")return m="+5 HP (max and current) for 8 hours",{attackBonus:0,damageBonus:0,acBonus:0,hpBonus:5,description:m,name:a.name};a.name==="Divine Favor"&&(m="Your weapon attacks deal an extra 1d4 radiant damage on a hit.",v="1d4");const C=n.match(/\+(\d+)\s+bonus\s+to\s+AC/i);return C&&(u=parseInt(C[1]),m=`+${u} to AC`),a.name==="Haste"&&(m="+2 AC, doubled speed, extra action",u=2),m||t!==0||v!==0||u!==0?{attackBonus:t,damageBonus:v,acBonus:u,description:m||a.description.substring(0,100),name:a.name}:null}var dl=g('<button class="btn btn-secondary">Add Attack</button>'),ul=g('<input type="text" placeholder="Attack name" class="attack-name svelte-14o91c5"/>'),pl=g('<h4 class="attack-name-display svelte-14o91c5"> </h4>'),fl=g('<button class="btn-remove svelte-14o91c5">√ó</button>'),gl=g('<div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Bonus</label> <input type="number" class="attack-bonus svelte-14o91c5"/></div>'),bl=g('<div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Damage</label> <input type="text" placeholder="e.g., 2d6+3" class="attack-damage svelte-14o91c5"/></div>'),hl=g('<div class="spell-info-loading svelte-14o91c5">Loading spell info...</div>'),ml=g('<li class="svelte-14o91c5"><strong>At Higher Levels:</strong> </li>'),_l=g('<ul class="svelte-14o91c5"><li class="svelte-14o91c5"><strong>Level:</strong> </li> <li class="svelte-14o91c5"><strong>Casting Time:</strong> </li> <li class="svelte-14o91c5"><strong>Range:</strong> </li> <li class="svelte-14o91c5"><strong>Components:</strong> <!></li> <li class="svelte-14o91c5"><strong>Duration:</strong> <!> </li> <li class="svelte-14o91c5"><strong>Description:</strong> </li> <!></ul>'),yl=g('<span class="scaled-damage svelte-14o91c5" style="margin-left: 8px;"> </span>'),kl=g('<span class="scaled-damage svelte-14o91c5">(Half damage)</span>'),Sl=g('<span class="scaled-damage svelte-14o91c5">(No damage)</span>'),xl=g('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> <!> <!></label></div>'),$l=g("<option> </option>"),Cl=g('<span class="scaled-damage svelte-14o91c5"><!> </span>'),wl=g('<span class="scaled-damage svelte-14o91c5"> </span>'),Dl=g('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> Target is Fiend or Undead <!></label></div>'),Ll=g('<div class="spell-level-selector svelte-14o91c5"><label class="svelte-14o91c5">Cast at Level:</label> <select class="spell-level-select use-enabled svelte-14o91c5"></select> <!></div> <!>',1),jl=g('<div class="spell-level-selector svelte-14o91c5"><span style="color: #dc3545; font-weight: bold;">No spell slots available!</span></div>'),Bl=g('<div class="spell-info svelte-14o91c5"><div class="spell-info-header svelte-14o91c5" role="button" tabindex="0"><h4 class="svelte-14o91c5">Spell Info</h4> <button class="collapse-btn-small svelte-14o91c5"> </button></div> <!></div> <!> <!>',1),Al=g('<div class="spell-info-missing svelte-14o91c5">Spell info not found.</div>'),Fl=g('<div class="attack-notes svelte-14o91c5"><label class="svelte-14o91c5">Notes</label> <textarea placeholder="e.g., DC 15 Dex save, Range 120 ft, Concentration" class="notes-input svelte-14o91c5" rows="2"></textarea></div>'),Ml=g('<button class="btn btn-primary">Roll Attack</button>'),Tl=g('<div class="buff-target-selection svelte-14o91c5"><div class="target-options svelte-14o91c5"><label class="target-option svelte-14o91c5"><input type="radio" class="svelte-14o91c5"/> Self</label> <label class="target-option svelte-14o91c5"><input type="radio" class="svelte-14o91c5"/> Other</label></div> <button class="btn btn-info"> </button></div>'),Il=g('<button class="btn btn-info">Cast Spell</button>'),Pl=g("<button><!></button>"),Rl=g('<button class="btn btn-info">Cast Spell</button>'),El=g('<button class="btn btn-secondary">Roll Damage</button>'),Hl=g('<button class="btn btn-primary">Roll Attack</button> <!>',1),Ul=g('<div class="attack-card svelte-14o91c5"><div class="attack-header svelte-14o91c5"><!> <!></div> <div class="attack-details svelte-14o91c5"><!> <!> <div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Type</label> <input type="text" placeholder="e.g., slashing" class="attack-type svelte-14o91c5"/></div></div> <!> <!> <div class="attack-actions svelte-14o91c5"><!></div></div>'),Nl=g('<p class="no-attacks svelte-14o91c5">No attacks added yet. Click "Add Attack" to create one.</p>'),Gl=g('<p class="no-attacks svelte-14o91c5">No attacks match your search.</p>'),Ol=g('<button class="btn-remove svelte-14o91c5">√ó</button>'),ql=g('<div class="state-card svelte-14o91c5"><div class="state-header svelte-14o91c5"><input type="text" placeholder="Effect name (e.g., Magic Weapon)" class="state-name svelte-14o91c5"/> <!></div> <div class="state-details svelte-14o91c5"><div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Attack Bonus</label> <input type="number" class="state-bonus svelte-14o91c5"/></div> <div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Damage Bonus</label> <input type="text" class="state-bonus svelte-14o91c5"/></div> <div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Target</label> <select class="state-bonus svelte-14o91c5"><option>Self</option><option>Other</option></select></div></div> <div class="state-description svelte-14o91c5"><label class="svelte-14o91c5">Description</label> <input type="text" placeholder="e.g., +1 to attack and damage rolls (Magic Weapon)" class="state-desc-input svelte-14o91c5"/></div></div>'),Wl=g('<div class="states-list svelte-14o91c5"></div>'),zl=g('<p class="no-states svelte-14o91c5">No active effects. Add spell effects that modify your attacks.</p>'),Kl=g('<!> <div class="attacks-list svelte-14o91c5"><!> <!></div> <div class="active-states-section svelte-14o91c5"><h3 class="svelte-14o91c5">Active Spell Effects</h3> <p class="section-description svelte-14o91c5">Effects that modify attack and damage rolls (e.g., Magic Weapon, Bless)</p> <button class="btn btn-secondary">Add Effect</button> <!></div>',1),Vl=g("<section><!> <!></section>");function Jl(a,n){Et(n,!1);const t=()=>st(le,"$character",C),v=()=>st(ga,"$abilityModifiers",C),u=()=>st(ea,"$searchFilter",C),m=()=>st(Tt,"$collapsedStates",C),S=()=>st(Zt,"$isEditMode",C),[C,L]=Wt(),x=B(),ee=B(),W=[],ne=la();let V=B({}),Q=B({});function _e(h){sa(V,e(V)[h]=!e(V)[h]),o(V,{...e(V)})}function pe(h){return h.description.toLowerCase().includes("regain")&&(h.description.toLowerCase().includes("hit point")||h.description.toLowerCase().includes("hp"))}function G(h){return["Shield of Faith","Bless","Aid","Magic Weapon"].includes(h)}function Ae(){le.update(h=>(h.attacks=[...h.attacks,{id:crypto.randomUUID(),name:"",bonus:0,damage:"",damageType:"",notes:""}],h))}function Ke(h){le.update(P=>(P.attacks=P.attacks.filter(q=>q.id!==h),P))}function se(h){let P=h.damage,q=!1,Y=!1;if(h.spellRef){const be=ge(h.spellRef);if(be&&(Y=Da(be),be.level>0)){const Ve=h.castAtLevel||be.level;if(!Fe(Ve)){qt.add(`No level ${Ve} spell slots available!`,"error");return}const j=_a(be);j&&h.targetSucceededSave&&j.noDamageOnSave?P="0":(q=j?.halfDamageOnSave&&h.targetSucceededSave||!1,P=Se(h,be))}}else if(t().activeStates&&t().activeStates.length>0){let be=0,Ve=[];for(const I of t().activeStates)I.target!=="other"&&(typeof I.damageBonus=="string"?Ve.push(I.damageBonus):typeof I.damageBonus=="number"&&(be+=I.damageBonus));if((be!==0||Ve.length>0)&&P){const I=P.match(/(\d+d\d+)([+-]\d+)?/);if(I){const[,j,ie]=I,K=(ie?parseInt(ie):0)+be;let d=`${j}`;K!==0&&(d+=`${K>=0?"+":""}${K}`),Ve.length>0&&(d+=" + "+Ve.join(" + ")),P=d}}}const z=[];let fe=0;if(Y){const be=Wa(t(),v()),Ve=t().proficiencyBonus||0;z.push({value:Ve,source:"proficiency"}),z.push({value:be,source:"spellcasting"}),fe=Ve+be}else h.bonus!==0&&z.push({value:h.bonus,source:"base"}),fe=h.bonus;let De=[];if(t().activeStates)for(const be of t().activeStates)be.target!=="other"&&(typeof be.attackBonus=="number"&&be.attackBonus!==0?(z.push({value:be.attackBonus,source:be.name.toLowerCase()}),fe+=be.attackBonus):typeof be.attackBonus=="string"&&be.attackBonus&&(De.push(be.attackBonus),z.push({value:be.attackBonus,source:be.name.toLowerCase()})));let nt=`1d20${fe>=0?"+":""}${fe}`;De.length>0&&(nt+="+"+De.join("+")),ne("roll",{notation:nt,damageNotation:P,attackName:h.name,applyHalfDamage:q,bonusBreakdown:z,rollType:"attack"})}function We(h){if(!h.damage){qt.add(`${h.name}: No damage specified`,"error");return}let P=h.damage,q=!1;const Y=[];if(h.spellRef){const z=ge(h.spellRef);if(z&&z.level>0){const fe=h.castAtLevel||z.level;if(!Fe(fe)){qt.add(`No level ${fe} spell slots available!`,"error");return}const nt=_a(z);nt&&h.targetSucceededSave&&nt.noDamageOnSave?P="0":(q=nt?.halfDamageOnSave&&h.targetSucceededSave||!1,P=Se(h,z))}}else{const z=P.match(/(\d+d\d+)([+-]\d+)?/);if(z){const[,fe,De]=z,nt=De?parseInt(De):0;if(nt!==0&&Y.push({value:nt,source:"base"}),t().activeStates&&t().activeStates.length>0){let be=0,Ve=[];for(const I of t().activeStates)I.target!=="other"&&(typeof I.damageBonus=="string"?Ve.push(I.damageBonus):typeof I.damageBonus=="number"&&I.damageBonus!==0&&(Y.push({value:I.damageBonus,source:I.name.toLowerCase()}),be+=I.damageBonus));if(be!==0||Ve.length>0){const I=nt+be;let j=`${fe}`;I!==0&&(j+=`${I>=0?"+":""}${I}`),Ve.length>0&&(j+=" + "+Ve.join(" + ")),P=j}}}}ne("roll",{notation:P,attackName:h.name,applyHalfDamage:q,bonusBreakdown:Y})}let Pe=B([]),te=B(!1);pa(async()=>{o(Pe,await ls()),o(te,!0)});function ge(h){return e(Pe).find(P=>P.name===h)}function Fe(h){t().classFeatures.spellSlotsByLevel||_t(le,r(t).classFeatures.spellSlotsByLevel={},r(t)),t().classFeatures.spellSlotsByLevel[h]||_t(le,r(t).classFeatures.spellSlotsByLevel[h]=Array(2).fill(!1),r(t));const q=t().classFeatures.spellSlotsByLevel[h].findIndex(Y=>!Y);return q===-1?!1:(le.update(Y=>(Y.classFeatures.spellSlotsByLevel||(Y.classFeatures.spellSlotsByLevel={}),Y.classFeatures.spellSlotsByLevel[h]||(Y.classFeatures.spellSlotsByLevel[h]=Array(2).fill(!1)),Y.classFeatures.spellSlotsByLevel[h][q]=!0,Y)),!0)}function Se(h,P){let q=h.damage,Y=0,z=0;if(cl(P)&&(z+=Wa(t(),v())),t().activeStates)for(const ce of t().activeStates)ce.target!=="other"&&typeof ce.damageBonus=="number"&&(z+=ce.damageBonus);if(P.higherLevelSlot&&h.castAtLevel){const ce=P.level,d=(h.castAtLevel||ce)-ce;if(d>0){const Ee=P.higherLevelSlot.match(/(\d+)d(\d+)\s+for\s+each.*?level\s+above/i);if(Ee){const[,ve]=Ee;Y+=d*parseInt(ve)}}}if(h.targetIsFiendOrUndead&&P.description.includes("Fiend or an Undead")){const ce=P.description.match(/increases by (\d+)d(\d+) if.*?Fiend or.*?Undead/i);if(ce){const[,K]=ce;Y+=parseInt(K)}}const fe=q.match(/(\d+)d(\d+)([+-]\d+)?/);if(!fe)return z!==0?z>=0?`${z}`:`${z}`:q||"0";const[,De,nt,be]=fe,Ve=parseInt(De)+Y,j=(be?parseInt(be):0)+z;let ie=`${Ve}d${nt}`;return j!==0&&(ie+=j>=0?`+${j}`:`${j}`),ie}function Le(h){const P=[];for(let Y=h.level;Y<=9;Y++){const z=t().classFeatures.spellSlotsByLevel?.[Y];z&&z.length>0&&P.push(Y)}return P}function w(){le.update(h=>(h.activeStates||(h.activeStates=[]),h.activeStates=[...h.activeStates,{name:"",attackBonus:0,damageBonus:0,description:"",target:"self"}],h))}function oe(h){le.update(P=>{if(P.activeStates){const q=P.activeStates[h];q?.hpBonus&&q.target!=="other"&&(P.maxHP-=q.hpBonus,P.currentHP=Math.max(1,Math.min(P.currentHP-q.hpBonus,P.maxHP))),P.activeStates=P.activeStates.filter((Y,z)=>z!==h)}return P})}function f(h,P="self"){const q=ge(h.spellRef);if(!q){qt.add("Spell not found","error");return}const Y=h.castAtLevel||q.level;if(Y>0&&!Fe(Y)){qt.add(`No level ${Y} spell slots available!`,"error");return}const z=vl(q);if(!z){qt.add(`${q.name} cast! Check spell description for effects.`,"info");return}let fe=z.hpBonus||0,De=z.description;q.name==="Aid"&&Y>q.level&&(fe=5+(Y-q.level)*5,De=`+${fe} HP (max and current) for 8 hours`);const be=["Shield of Faith","Bless","Aid","Magic Weapon"].includes(q.name);le.update(I=>{I.activeStates||(I.activeStates=[]);const j=I.activeStates.find(ie=>ie.name===q.name);return j&&j.hpBonus&&j.target!=="other"&&(I.maxHP-=j.hpBonus,I.currentHP=Math.max(1,Math.min(I.currentHP-j.hpBonus,I.maxHP))),I.activeStates=I.activeStates.filter(ie=>ie.name!==q.name),fe>0&&P==="self"&&(I.maxHP+=fe,I.currentHP+=fe),I.activeStates=[...I.activeStates,{name:q.name,attackBonus:z.attackBonus,damageBonus:z.damageBonus,acBonus:z.acBonus,description:De,target:P,hpBonus:fe}],I});const Ve=P==="self"?" on self":" on other";qt.add(`${q.name} cast${be?Ve:""}! Effect added to Active Spell Effects.`,"success")}Xe(()=>(t(),e(V),e(Q)),()=>{if(t()&&t().attacks)for(const h of t().attacks)h.spellRef&&e(V)[h.id]===void 0&&sa(V,e(V)[h.id]=!0),h.spellRef&&e(Q)[h.id]===void 0&&sa(Q,e(Q)[h.id]="self")}),Xe(()=>(t(),u()),()=>{o(x,t().attacks.filter(h=>{if(!u())return!0;const P=u().toLowerCase();return h.name.toLowerCase().includes(P)||h.damageType.toLowerCase().includes(P)}).sort((h,P)=>!h.spellRef&&P.spellRef?-1:h.spellRef&&!P.spellRef?1:0))}),Xe(()=>(u(),e(x)),()=>{o(ee,!u()||e(x).length>0||"attack".includes(u().toLowerCase())||"spell".includes(u().toLowerCase()))}),Jt(),Rt();var $=Vl();let O;var Ce=i($);{let h=dt(()=>(m(),r(()=>m().attacks?"Expand":"Collapse")));ia(Ce,{title:"Attacks & Spells",get collapsed(){return m(),r(()=>m().attacks)},get ariaLabel(){return e(h)},onToggle:()=>Tt.update(P=>({...P,attacks:!P.attacks}))})}var Re=s(Ce,2);{var we=h=>{var P=Kl(),q=Ne(P);{var Y=K=>{var d=dl();M("click",d,Ae),c(K,d)};y(q,K=>{S()&&K(Y)})}var z=s(q,2),fe=i(z);kt(fe,1,()=>e(x),K=>K.id,(K,d,Ee)=>{var ve=Ul(),de=i(ve),A=i(de);{var Me=b=>{var k=ul();$e(k),qe(k,()=>e(d).name,R=>(e(d).name=R,jt(()=>(e(x),t(),u())))),c(b,k)},Te=b=>{var k=pl(),R=i(k,!0);l(k),T(()=>D(R,(e(d),r(()=>e(d).name||"(Unnamed Attack)")))),c(b,k)};y(A,b=>{S()?b(Me):b(Te,!1)})}var Ze=s(A,2);{var it=b=>{var k=fl();M("click",k,()=>Ke(e(d).id)),c(b,k)};y(Ze,b=>{S()&&b(it)})}l(de);var je=s(de,2),ye=i(je);{var Be=b=>{var k=gl(),R=i(k),he=s(R,2);$e(he),l(k),T(()=>{Ye(R,"for",`attack-bonus-${e(d),r(()=>e(d).id)??""}`),Ye(he,"id",`attack-bonus-${e(d),r(()=>e(d).id)??""}`)}),qe(he,()=>e(d).bonus,me=>(e(d).bonus=me,jt(()=>(e(x),t(),u())))),c(b,k)};y(ye,b=>{e(d),r(()=>e(d).bonus!==0&&e(d).bonus!==void 0)&&b(Be)})}var He=s(ye,2);{var Ue=b=>{var k=bl(),R=i(k),he=s(R,2);$e(he),l(k),T(()=>{Ye(R,"for",`attack-damage-${e(d),r(()=>e(d).id)??""}`),Ye(he,"id",`attack-damage-${e(d),r(()=>e(d).id)??""}`)}),qe(he,()=>e(d).damage,me=>(e(d).damage=me,jt(()=>(e(x),t(),u())))),c(b,k)};y(He,b=>{e(d),r(()=>e(d).damage&&e(d).damage.trim()!=="")&&b(Ue)})}var Ge=s(He,2),X=i(Ge),ue=s(X,2);$e(ue),l(Ge),l(je);var Oe=s(je,2);{var et=b=>{var k=vt(),R=Ne(k);{var he=ze=>{var E=hl();c(ze,E)},me=ze=>{const E=dt(()=>(e(d),r(()=>ge(e(d).spellRef))));var tt=vt(),ut=Ne(tt);{var ft=U=>{const F=dt(()=>(H(_a),H(e(E)),r(()=>_a(e(E)))));var xe=Bl(),ae=Ne(xe),at=i(ae),Ie=s(i(at),2),bt=i(Ie,!0);l(Ie),l(at);var Je=s(at,2);{var ot=Qe=>{var lt=_l(),pt=i(lt),Ct=s(i(pt));l(pt);var Ut=s(pt,2),Nt=s(i(Ut));l(Ut);var At=s(Ut,2),wt=s(i(At));l(At);var Dt=s(At,2),Gt=s(i(Dt)),gt=s(Gt);{var Ot=$t=>{var Lt=Mt();T(()=>D(Lt,`(${H(e(E)),r(()=>e(E).material)??""})`)),c($t,Lt)};y(gt,$t=>{H(e(E)),r(()=>e(E).material)&&$t(Ot)})}l(Dt);var Vt=s(Dt,2),Qt=s(i(Vt),2);{var ta=$t=>{var Lt=Mt("Concentration,");c($t,Lt)};y(Qt,$t=>{H(e(E)),r(()=>e(E).concentration)&&$t(ta)})}var Bt=s(Qt,1,!0);l(Vt);var It=s(Vt,2),Ft=s(i(It));l(It);var zt=s(It,2);{var Yt=$t=>{var Lt=ml(),Kt=s(i(Lt));l(Lt),T(()=>D(Kt,` ${H(e(E)),r(()=>e(E).higherLevelSlot)??""}`)),c($t,Lt)};y(zt,$t=>{H(e(E)),r(()=>e(E).higherLevelSlot)&&$t(Yt)})}l(lt),T($t=>{D(Ct,` ${H(e(E)),r(()=>e(E).level)??""}`),D(Nt,` ${H(e(E)),r(()=>e(E).castingTime||e(E).actionType)??""}`),D(wt,` ${H(e(E)),r(()=>e(E).range)??""}`),D(Gt,` ${$t??""}`),D(Bt,(H(e(E)),r(()=>e(E).duration))),D(Ft,` ${H(e(E)),r(()=>e(E).description)??""}`)},[()=>(H(e(E)),r(()=>e(E).components.join(", ")))]),c(Qe,lt)};y(Je,Qe=>{e(V),e(d),r(()=>!e(V)[e(d).id])&&Qe(ot)})}l(ae);var rt=s(ae,2);{var ct=Qe=>{var lt=xl(),pt=i(lt),Ct=i(pt);$e(Ct);var Ut=s(Ct),Nt=s(Ut);{var At=gt=>{var Ot=yl(),Vt=i(Ot);l(Ot),T(Qt=>D(Vt,`(Spell Save DC: ${Qt??""})`),[()=>(H(Ta),t(),v(),r(()=>Ta(t(),v())))]),c(gt,Ot)};y(Nt,gt=>{t(),r(()=>t().class)&&gt(At)})}var wt=s(Nt,2);{var Dt=gt=>{var Ot=kl();c(gt,Ot)},Gt=gt=>{var Ot=vt(),Vt=Ne(Ot);{var Qt=ta=>{var Bt=Sl();c(ta,Bt)};y(Vt,ta=>{e(d),H(e(F)),r(()=>e(d).targetSucceededSave&&e(F).noDamageOnSave)&&ta(Qt)},!0)}c(gt,Ot)};y(wt,gt=>{e(d),H(e(F)),r(()=>e(d).targetSucceededSave&&e(F).halfDamageOnSave)?gt(Dt):gt(Gt,!1)})}l(pt),l(lt),T(gt=>D(Ut,` Target succeeded on ${gt??""} save `),[()=>(H(e(F)),r(()=>e(F).ability.charAt(0).toUpperCase()+e(F).ability.slice(1)))]),Fa(Ct,()=>e(d).targetSucceededSave,gt=>(e(d).targetSucceededSave=gt,jt(()=>(e(x),t(),u())))),c(Qe,lt)};y(rt,Qe=>{e(F)&&Qe(ct)})}var ht=s(rt,2);{var mt=Qe=>{const lt=dt(()=>(H(e(E)),r(()=>Le(e(E)))));var pt=vt(),Ct=Ne(pt);{var Ut=At=>{var wt=Ll(),Dt=Ne(wt),Gt=i(Dt),gt=s(Gt,2);T(()=>{e(d),jt(()=>{e(lt)})}),kt(gt,5,()=>e(lt),xt,(Bt,It)=>{var Ft=$l(),zt=i(Ft);l(Ft);var Yt={};T(()=>{D(zt,`Level ${e(It)??""}`),Yt!==(Yt=e(It))&&(Ft.value=(Ft.__value=e(It))??"")}),c(Bt,Ft)}),l(gt);var Ot=s(gt,2);{var Vt=Bt=>{const It=dt(()=>(e(d),H(e(E)),r(()=>Se(e(d),e(E)))));var Ft=Cl(),zt=i(Ft);{var Yt=Kt=>{var aa=Mt("Healing");c(Kt,aa)},$t=Kt=>{var aa=Mt("Damage");c(Kt,aa)};y(zt,Kt=>{H(e(E)),r(()=>pe(e(E)))?Kt(Yt):Kt($t,!1)})}var Lt=s(zt);l(Ft),T(()=>D(Lt,` ${e(It)??""}`)),c(Bt,Ft)};y(Ot,Bt=>{e(d),H(e(E)),r(()=>e(d).castAtLevel&&e(d).castAtLevel>e(E).level)&&Bt(Vt)})}l(Dt);var Qt=s(Dt,2);{var ta=Bt=>{var It=Dl(),Ft=i(It),zt=i(Ft);$e(zt);var Yt=s(zt,2);{var $t=Lt=>{const Kt=dt(()=>(e(d),H(e(E)),r(()=>Se(e(d),e(E)))));var aa=wl(),is=i(aa);l(aa),T(()=>D(is,`(+1d8, total: ${e(Kt)??""})`)),c(Lt,aa)};y(Yt,Lt=>{e(d),r(()=>e(d).targetIsFiendOrUndead)&&Lt($t)})}l(Ft),l(It),Fa(zt,()=>e(d).targetIsFiendOrUndead,Lt=>(e(d).targetIsFiendOrUndead=Lt,jt(()=>(e(x),t(),u())))),c(Bt,It)};y(Qt,Bt=>{H(e(E)),r(()=>e(E).description.includes("Fiend or an Undead"))&&Bt(ta)})}T(()=>{Ye(Gt,"for",`castLevel-${e(d),r(()=>e(d).id)??""}`),Ye(gt,"id",`castLevel-${e(d),r(()=>e(d).id)??""}`)}),Aa(gt,()=>e(d).castAtLevel,Bt=>(e(d).castAtLevel=Bt,jt(()=>(e(x),t(),u())))),c(At,wt)},Nt=At=>{var wt=jl();c(At,wt)};y(Ct,At=>{H(e(lt)),r(()=>e(lt).length>0)?At(Ut):At(Nt,!1)})}c(Qe,pt)};y(ht,Qe=>{H(e(E)),r(()=>e(E).higherLevelSlot&&e(E).level>0)&&Qe(mt)})}T(()=>{Ye(Ie,"aria-label",(e(V),e(d),r(()=>e(V)[e(d).id]?"Expand":"Collapse"))),D(bt,(e(V),e(d),r(()=>e(V)[e(d).id]?"‚ñº":"‚ñ≤")))}),M("click",at,()=>_e(e(d).id)),M("keydown",at,Qe=>Qe.key==="Enter"&&_e(e(d).id)),c(U,xe)},p=U=>{var F=Al();c(U,F)};y(ut,U=>{e(E)?U(ft):U(p,!1)})}c(ze,tt)};y(R,ze=>{e(Pe),r(()=>e(Pe).length===0)?ze(he):ze(me,!1)})}c(b,k)};y(Oe,b=>{e(d),r(()=>e(d).spellRef)&&b(et)})}var ke=s(Oe,2);{var _=b=>{var k=Fl(),R=i(k),he=s(R,2);da(he),l(k),T(()=>{Ye(R,"for",`attack-notes-${e(d),r(()=>e(d).id)??""}`),Ye(he,"id",`attack-notes-${e(d),r(()=>e(d).id)??""}`)}),qe(he,()=>e(d).notes,me=>(e(d).notes=me,jt(()=>(e(x),t(),u())))),c(b,k)};y(ke,b=>{e(d),r(()=>!e(d).spellRef)&&b(_)})}var N=s(ke,2),Z=i(N);{var J=b=>{const k=dt(()=>(e(d),r(()=>ge(e(d).spellRef))));var R=vt(),he=Ne(R);{var me=ze=>{var E=vt(),tt=Ne(E);{var ut=p=>{var U=Ml();M("click",U,()=>se(e(d))),c(p,U)},ft=p=>{var U=vt(),F=Ne(U);{var xe=at=>{var Ie=vt(),bt=Ne(Ie);{var Je=rt=>{var ct=Tl(),ht=i(ct),mt=i(ht),Qe=i(mt);$e(Qe),Qe.value=Qe.__value="self",ra(),l(mt);var lt=s(mt,2),pt=i(lt);$e(pt),pt.value=pt.__value="other",ra(),l(lt),l(ht);var Ct=s(ht,2),Ut=i(Ct);l(Ct),l(ct),T(()=>{Ye(Qe,"name",`target-${e(d),r(()=>e(d).id)??""}`),Ye(pt,"name",`target-${e(d),r(()=>e(d).id)??""}`),D(Ut,`Cast ${H(e(k)),r(()=>e(k).name)??""}`)}),Ua(W,[Ee],Qe,()=>e(Q)[e(d).id],Nt=>sa(Q,e(Q)[e(d).id]=Nt)),Ua(W,[Ee],pt,()=>e(Q)[e(d).id],Nt=>sa(Q,e(Q)[e(d).id]=Nt)),M("click",Ct,()=>f(e(d),e(Q)[e(d).id])),c(rt,ct)},ot=rt=>{var ct=Il();M("click",ct,()=>f(e(d),"self")),c(rt,ct)};y(bt,rt=>{H(e(k)),r(()=>G(e(k).name))?rt(Je):rt(ot,!1)})}c(at,Ie)},ae=at=>{var Ie=vt(),bt=Ne(Ie);{var Je=rt=>{var ct=Pl(),ht=i(ct);{var mt=lt=>{var pt=Mt("Roll Healing");c(lt,pt)},Qe=lt=>{var pt=Mt("Roll Damage");c(lt,pt)};y(ht,lt=>{H(e(k)),r(()=>pe(e(k)))?lt(mt):lt(Qe,!1)})}l(ct),T(lt=>yt(ct,1,`btn ${lt??""}`),[()=>(H(e(k)),r(()=>pe(e(k))?"btn-success":"btn-secondary"))]),M("click",ct,()=>We(e(d))),c(rt,ct)},ot=rt=>{var ct=Rl();M("click",ct,()=>f(e(d),"self")),c(rt,ct)};y(bt,rt=>{e(d),r(()=>e(d).damage&&e(d).damage.trim()!=="")?rt(Je):rt(ot,!1)})}c(at,Ie)};y(F,at=>{H(Ka),H(e(k)),r(()=>Ka(e(k)))?at(xe):at(ae,!1)},!0)}c(p,U)};y(tt,p=>{H(Da),H(e(k)),r(()=>Da(e(k)))?p(ut):p(ft,!1)})}c(ze,E)};y(he,ze=>{e(k)&&ze(me)})}c(b,R)},re=b=>{var k=vt(),R=Ne(k);{var he=me=>{var ze=Hl(),E=Ne(ze),tt=s(E,2);{var ut=ft=>{var p=El();M("click",p,()=>We(e(d))),c(ft,p)};y(tt,ft=>{e(d),r(()=>e(d).damage&&e(d).damage.trim()!=="")&&ft(ut)})}M("click",E,()=>se(e(d))),c(me,ze)};y(R,me=>{e(d),r(()=>!e(d).spellRef)&&me(he)},!0)}c(b,k)};y(Z,b=>{e(d),e(te),r(()=>e(d).spellRef&&e(te))?b(J):b(re,!1)})}l(N),l(ve),T(()=>{Ye(X,"for",`attack-type-${e(d),r(()=>e(d).id)??""}`),Ye(ue,"id",`attack-type-${e(d),r(()=>e(d).id)??""}`)}),qe(ue,()=>e(d).damageType,b=>(e(d).damageType=b,jt(()=>(e(x),t(),u())))),c(K,ve)});var De=s(fe,2);{var nt=K=>{var d=Nl();c(K,d)},be=K=>{var d=vt(),Ee=Ne(d);{var ve=de=>{var A=Gl();c(de,A)};y(Ee,de=>{e(x),r(()=>e(x).length===0)&&de(ve)},!0)}c(K,d)};y(De,K=>{t(),r(()=>t().attacks.length===0)?K(nt):K(be,!1)})}l(z);var Ve=s(z,2),I=s(i(Ve),4),j=s(I,2);{var ie=K=>{var d=Wl();kt(d,5,()=>(t(),r(()=>t().activeStates)),xt,(Ee,ve,de)=>{var A=ql(),Me=i(A),Te=i(Me);$e(Te);var Ze=s(Te,2);{var it=re=>{var b=Ol();M("click",b,()=>oe(de)),c(re,b)};y(Ze,re=>{S()&&re(it)})}l(Me);var je=s(Me,2),ye=i(je),Be=i(ye);Ye(Be,"for",`state-attack-bonus-${de}`);var He=s(Be,2);$e(He),Ye(He,"id",`state-attack-bonus-${de}`),l(ye);var Ue=s(ye,2),Ge=i(Ue);Ye(Ge,"for",`state-damage-bonus-${de}`);var X=s(Ge,2);$e(X),Ye(X,"id",`state-damage-bonus-${de}`),l(Ue);var ue=s(Ue,2),Oe=i(ue);Ye(Oe,"for",`state-target-${de}`);var et=s(Oe,2);T(()=>{e(ve),jt(()=>{})}),Ye(et,"id",`state-target-${de}`);var ke=i(et);ke.value=ke.__value="self";var _=s(ke);_.value=_.__value="other",l(et),l(ue),l(je);var N=s(je,2),Z=i(N);Ye(Z,"for",`state-desc-${de}`);var J=s(Z,2);$e(J),Ye(J,"id",`state-desc-${de}`),l(N),l(A),qe(Te,()=>e(ve).name,re=>(e(ve).name=re,jt(()=>t()),ca(C,"$character"))),qe(He,()=>e(ve).attackBonus,re=>(e(ve).attackBonus=re,jt(()=>t()),ca(C,"$character"))),qe(X,()=>e(ve).damageBonus,re=>(e(ve).damageBonus=re,jt(()=>t()),ca(C,"$character"))),Aa(et,()=>e(ve).target,re=>(e(ve).target=re,jt(()=>t()),ca(C,"$character"))),qe(J,()=>e(ve).description,re=>(e(ve).description=re,jt(()=>t()),ca(C,"$character"))),c(Ee,A)}),l(d),c(K,d)},ce=K=>{var d=zl();c(K,d)};y(j,K=>{t(),r(()=>t().activeStates&&t().activeStates.length>0)?K(ie):K(ce,!1)})}l(Ve),M("click",I,w),c(h,P)};y(Re,h=>{m(),r(()=>!m().attacks)&&h(we)})}l($),T(()=>O=yt($,1,"attacks svelte-14o91c5",null,O,{hidden:!e(ee)})),c(a,$),Ht(),L()}var Ql=g('<span class="slot-checkbox-x svelte-serp1j">&#8212;</span>'),Yl=g('<label><input type="checkbox" class="slot-checkbox-input svelte-serp1j"/> <span><!></span></label>');function Va(a,n){Et(n,!1);const t=()=>st(Zt,"$isEditMode",v),[v,u]=Wt();let m=St(n,"checked",8,!1),S=St(n,"disabled",8,!1),C=St(n,"className",8,""),L=St(n,"index",8,void 0),x=St(n,"ariaLabel",8,void 0);const ee=la();function W(G){ee("change",{checked:G.currentTarget.checked,index:L()})}Rt();var ne=Yl(),V=i(ne);$e(V);var Q=s(V,2),_e=i(Q);{var pe=G=>{var Ae=Ql();c(G,Ae)};y(_e,G=>{m()&&G(pe)})}l(Q),l(ne),T(()=>{yt(ne,1,"slot-checkbox-label "+C()+(t()?"":" not-editable"),"svelte-serp1j"),ts(V,m()),V.disabled=S()||!t(),Ye(V,"aria-label",x()),Ye(V,"tabindex",t()?0:-1),yt(Q,1,`slot-checkbox-custom ${m()?"used":""} ${t()?"":"readonly"}`,"svelte-serp1j")}),M("change",V,W),c(a,ne),Ht(),u()}var Xl=g('<p class="no-features svelte-1kpvv0n">Select a class to see available features</p>'),Zl=g('<p class="no-features svelte-1kpvv0n">No class features available at this level</p>'),ei=g('<div class="spell-slots svelte-1kpvv0n"><label class="svelte-1kpvv0n"> </label> <div class="slots-tracker svelte-1kpvv0n"></div></div>'),ti=g('<div class="all-spell-slots"></div>'),ai=g('<div class="feature-box spellcasting svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"> </h3> <div class="spell-stats svelte-1kpvv0n"><div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Spell Save DC</label> <div class="spell-value svelte-1kpvv0n"> </div></div> <div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <div class="spell-value svelte-1kpvv0n"> </div></div></div> <!> <div class="prepared-spells svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <textarea placeholder="List your prepared spells..." class="svelte-1kpvv0n"></textarea></div></div>'),si=g('<p class="unlimited svelte-1kpvv0n">Unlimited Uses</p>'),li=g('<div class="slots-tracker svelte-1kpvv0n"></div> <div class="uses-actions-row"><button class="btn btn-primary use-enabled"> </button></div> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div>',1),ii=g('<div class="uses-tracker svelte-1kpvv0n"><!></div>'),ri=g('<div class="pool-tracker svelte-1kpvv0n"><input type="number" min="0" class="pool-input svelte-1kpvv0n"/> <span> </span> <button class="btn-small svelte-1kpvv0n"> </button></div>'),ni=g('<p class="no-uses svelte-1kpvv0n">No Channel Divinity uses remaining</p>'),oi=g('<div class="channel-divinity-option svelte-1kpvv0n"><button class="btn btn-primary use-enabled svelte-1kpvv0n">Use Channel Divinity</button> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div> <!></div>'),ci=g('<div class="feature-box svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"><!> </h3> <p class="feature-description svelte-1kpvv0n"> </p> <!></div>'),vi=g('<div class="features-grid svelte-1kpvv0n"><!> <!></div>'),di=g("<section><!> <!></section>");function ui(a,n){Et(n,!1);const t=()=>st(le,"$character",S),v=()=>st(ga,"$abilityModifiers",S),u=()=>st(ea,"$searchFilter",S),m=()=>st(Tt,"$collapsedStates",S),[S,C]=Wt(),L=B(),x=B(),ee=B(),W=B(),ne=B(),V=B(),Q=B();let _e=B(0),pe=B(0);function G(f,$){le.update(O=>(O.classFeatures.features[f]=$,O))}function Ae(){le.update(f=>(f.classFeatures.spellSlotsByLevel||(f.classFeatures.spellSlotsByLevel={}),e(W).forEach(({level:$,slots:O})=>{f.classFeatures.spellSlotsByLevel[$]||(f.classFeatures.spellSlotsByLevel[$]=Array(O).fill(!1))}),f))}function Ke(f){if(typeof f.maxUses=="function"){if((f.name==="Divine Sense"||f.name==="War Priest")&&e(L)?.spellcastingAbility){const $=v()[e(L).spellcastingAbility];return f.maxUses(t().level,$)}return f.maxUses(t().level)}return f.maxUses||0}function se(f,$){le.update(O=>((!O.classFeatures.features[f]||!Array.isArray(O.classFeatures.features[f])||O.classFeatures.features[f].length!==$)&&(O.classFeatures.features[f]=Array($).fill(!1)),O))}rs(()=>{e(V)&&t()&&t().classFeatures&&t().classFeatures.features&&e(V).forEach(f=>{if(f.type==="uses"){const $=f.name.replace(/\s+/g,""),O=Ke(f),Ce=t().classFeatures.features[$];(!Array.isArray(Ce)||Ce.length!==O)&&se($,O)}})});function We(f){return typeof f.maxPool=="function"?f.maxPool(t().level):f.maxPool||0}function Pe(f){return typeof f.description=="function"?f.description(t().level):f.description}function te(){const f="ChannelDivinity";le.update($=>{const O=$.classFeatures.features[f];return typeof O=="number"&&O>0&&($.classFeatures.features[f]=O-1),$})}function ge(){Tt.update(f=>({...f,classFeatures:!f.classFeatures}))}Xe(()=>(t(),Pt),()=>{o(L,t().class?Pt(t().class):null)}),Xe(()=>(t(),oa),()=>{o(x,t().class?oa(t().class,t().level,t().subclass):[])}),Xe(()=>(t(),Oa),()=>{o(ee,t().class?Oa(t().class,t().level):0)}),Xe(()=>(e(L),t()),()=>{o(W,(()=>{if(!e(L)?.spellcaster)return[];const f=t().level,$=[];return f>=1&&$.push({level:1,slots:Math.min(4,2+Math.floor(f/3))}),f>=3&&$.push({level:2,slots:Math.min(3,2+Math.floor((f-3)/4))}),f>=5&&$.push({level:3,slots:Math.min(3,2+Math.floor((f-5)/5))}),f>=7&&$.push({level:4,slots:Math.min(3,1+Math.floor((f-7)/6))}),f>=9&&$.push({level:5,slots:Math.min(2,1+Math.floor((f-9)/8))}),f>=11&&$.push({level:6,slots:1}),f>=13&&$.push({level:7,slots:1}),f>=15&&$.push({level:8,slots:1}),f>=17&&$.push({level:9,slots:1}),$})())}),Xe(()=>(e(L),v(),t(),qa),()=>{if(e(L)?.spellcaster&&e(L).spellcastingAbility){const f=v()[e(L).spellcastingAbility];o(_e,Ls(t().class,f,t().proficiencyBonus)||0),o(pe,qa(t().class,t().level,f))}}),Xe(()=>(t(),e(L),e(W)),()=>{t().class&&e(L)?.spellcaster&&e(W).length>0&&Ae()}),Xe(()=>t(),()=>{o(ne,(()=>{const $=t().classFeatures.features["ChannelDivinity"];return typeof $=="number"?$:0})())}),Xe(()=>(e(x),u()),()=>{o(V,e(x).filter(f=>{if(!u())return!0;const $=u().toLowerCase();return f.name.toLowerCase().includes($)||Pe(f).toLowerCase().includes($)}))}),Xe(()=>(u(),t(),e(V)),()=>{o(Q,!u()||t().class||"class features".includes(u().toLowerCase())||"spellcasting".includes(u().toLowerCase())||e(V).length>0)}),Jt(),Rt();var Fe=di();let Se;var Le=i(Fe);{let f=dt(()=>(m(),r(()=>m().classFeatures?"Expand":"Collapse")));ia(Le,{title:"Class Features",get collapsed(){return m(),r(()=>m().classFeatures)},get ariaLabel(){return e(f)},onToggle:ge})}var w=s(Le,2);{var oe=f=>{var $=vt(),O=Ne($);{var Ce=we=>{var h=Xl();c(we,h)},Re=we=>{var h=vt(),P=Ne(h);{var q=z=>{var fe=Zl();c(z,fe)},Y=z=>{var fe=vi(),De=i(fe);{var nt=Ve=>{var I=ai(),j=i(I),ie=i(j);l(j);var ce=s(j,2),K=i(ce),d=s(i(K),2),Ee=i(d,!0);l(d),l(K);var ve=s(K,2),de=s(i(ve),2),A=i(de,!0);l(de),l(ve),l(ce);var Me=s(ce,2);{var Te=je=>{var ye=ti();kt(ye,5,()=>e(W),xt,(Be,He)=>{let Ue=()=>e(He).level,Ge=()=>e(He).slots;const X=dt(()=>(t(),Ue(),Ge(),r(()=>t().classFeatures.spellSlotsByLevel?.[Ue()]||Array(Ge()).fill(!1))));var ue=ei(),Oe=i(ue),et=i(Oe);l(Oe);var ke=s(Oe,2);kt(ke,5,()=>e(X),xt,(_,N,Z)=>{{let J=dt(()=>(H(e(X)),r(()=>e(X)[Z]||!1)));Va(_,{get checked(){return e(J)},$$events:{change:re=>{le.update(b=>(b.classFeatures.spellSlotsByLevel||(b.classFeatures.spellSlotsByLevel={}),b.classFeatures.spellSlotsByLevel[Ue()]||(b.classFeatures.spellSlotsByLevel[Ue()]=Array(Ge()).fill(!1)),b.classFeatures.spellSlotsByLevel[Ue()][Z]=re.detail.checked,b))}}})}}),l(ke),l(ue),T(()=>D(et,`${Ue()===1?"1st":Ue()===2?"2nd":Ue()===3?"3rd":`${Ue()}th`} Level Spell Slots`)),c(Be,ue)}),l(ye),c(je,ye)};y(Me,je=>{e(W),r(()=>e(W).length>0)&&je(Te)})}var Ze=s(Me,2),it=s(i(Ze),2);da(it),l(Ze),l(I),T(je=>{D(ie,`Spellcasting (${je??""})`),D(Ee,e(_e)),D(A,e(pe))},[()=>(e(L),r(()=>e(L).spellcastingAbility?.toUpperCase()))]),qe(it,()=>t().classFeatures.preparedSpells,je=>_t(le,r(t).classFeatures.preparedSpells=je,r(t))),c(Ve,I)};y(De,Ve=>{e(L),r(()=>e(L)?.spellcaster)&&Ve(nt)})}var be=s(De,2);kt(be,1,()=>e(V),xt,(Ve,I)=>{const j=dt(()=>(e(I),r(()=>e(I).name.replace(/\s+/g,"")))),ie=dt(()=>(t(),H(e(j)),r(()=>t().classFeatures.features[e(j)]))),ce=dt(()=>typeof e(ie)=="number");var K=ci(),d=i(K),Ee=i(d);{var ve=je=>{var ye=Mt("Channel Divinity:");c(je,ye)};y(Ee,je=>{e(I),r(()=>e(I).type==="channelDivinity")&&je(ve)})}var de=s(Ee);l(d);var A=s(d,2),Me=i(A,!0);l(A);var Te=s(A,2);{var Ze=je=>{const ye=dt(()=>(e(I),r(()=>Ke(e(I))))),Be=dt(()=>(H(e(ie)),H(e(ye)),r(()=>Array.isArray(e(ie))?e(ie):Array(e(ye)).fill(!1))));var He=ii(),Ue=i(He);{var Ge=ue=>{var Oe=si();c(ue,Oe)},X=ue=>{var Oe=li(),et=Ne(Oe);kt(et,5,()=>e(Be),xt,(b,k,R)=>{Va(b,{get checked(){return e(k)},index:R,$$events:{change:he=>{le.update(me=>(me.classFeatures.features[e(j)]||(me.classFeatures.features[e(j)]=Array(e(ye)).fill(!1)),me.classFeatures.features[e(j)][R]=he.detail.checked,me))}}})}),l(et);var ke=s(et,2),_=i(ke),N=i(_);l(_),l(ke);var Z=s(ke,2),J=i(Z),re=i(J);l(J),l(Z),T(b=>{_.disabled=b,D(N,`Use ${e(I),r(()=>e(I).name)??""}`),D(re,`Resets on ${e(I),r(()=>e(I).resetOn==="short"?"Short Rest":"Long Rest")??""}`)},[()=>(H(e(Be)),r(()=>e(Be).filter(b=>!b).length<=0))]),M("click",_,()=>{le.update(b=>{b.classFeatures.features[e(j)]||(b.classFeatures.features[e(j)]=Array(e(ye)).fill(!1));const k=b.classFeatures.features[e(j)],R=k.findIndex(he=>!he);return R!==-1&&(k[R]=!0),b})}),c(ue,Oe)};y(Ue,ue=>{e(ye)===1/0?ue(Ge):ue(X,!1)})}l(He),c(je,He)},it=je=>{var ye=vt(),Be=Ne(ye);{var He=Ge=>{const X=dt(()=>(e(I),r(()=>We(e(I)))));var ue=ri(),Oe=i(ue);$e(Oe);var et=s(Oe,2),ke=i(et);l(et);var _=s(et,2),N=i(_,!0);l(_),l(ue),T(()=>{ka(Oe,e(ce)&&e(ie)!==void 0?e(ie):e(X)),Ye(Oe,"max",e(X)),D(ke,`/ ${e(X)??""}`),D(N,(e(I),r(()=>e(I).resetOn==="short"?"Short Rest":"Long Rest")))}),M("input",Oe,Z=>{le.update(J=>(J.classFeatures.features[e(j)]=parseInt(Z.currentTarget.value)||0,J))}),M("click",_,()=>G(e(j),e(X))),c(Ge,ue)},Ue=Ge=>{var X=vt(),ue=Ne(X);{var Oe=et=>{var ke=oi(),_=i(ke),N=s(_,2),Z=i(N),J=i(Z);l(Z),l(N);var re=s(N,2);{var b=k=>{var R=ni();c(k,R)};y(re,k=>{e(ne)<=0&&k(b)})}l(ke),T(()=>{_.disabled=e(ne)<=0,D(J,`Resets on ${e(I),r(()=>e(I).resetOn==="short"?"Short Rest":"Long Rest")??""}`)}),M("click",_,te),c(et,ke)};y(ue,et=>{e(I),r(()=>e(I).type==="channelDivinity")&&et(Oe)},!0)}c(Ge,X)};y(Be,Ge=>{e(I),r(()=>e(I).type==="pool")?Ge(He):Ge(Ue,!1)},!0)}c(je,ye)};y(Te,je=>{e(I),r(()=>e(I).type==="uses")?je(Ze):je(it,!1)})}l(K),T(je=>{D(de,` ${e(I),r(()=>e(I).name)??""}`),D(Me,je)},[()=>(e(I),r(()=>Pe(e(I))))]),c(Ve,K)}),l(fe),c(z,fe)};y(P,z=>{e(x),r(()=>e(x).length===0)?z(q):z(Y,!1)},!0)}c(we,h)};y(O,we=>{t(),r(()=>!t().class)?we(Ce):we(Re,!1)})}c(f,$)};y(w,f=>{m(),r(()=>!m().classFeatures)&&f(oe)})}l(Fe),T(()=>Se=yt(Fe,1,"class-features svelte-1kpvv0n",null,Se,{hidden:!e(Q)})),c(a,Fe),Ht(),C()}var pi=g('<textarea placeholder="Enter features, traits, and special abilities..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Equipment</h3> <textarea placeholder="List your equipment and inventory..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Notes</h3> <textarea placeholder="Additional notes..." class="svelte-wttn0l"></textarea>',1),fi=g("<section><!> <!></section>");function gi(a,n){Et(n,!1);const t=()=>st(ea,"$searchFilter",m),v=()=>st(le,"$character",m),u=()=>st(Tt,"$collapsedStates",m),[m,S]=Wt(),C=B();function L(){Tt.update(Q=>({...Q,notes:!Q.notes}))}Xe(()=>(t(),v()),()=>{o(C,!t()||"features".includes(t().toLowerCase())||"traits".includes(t().toLowerCase())||"equipment".includes(t().toLowerCase())||"notes".includes(t().toLowerCase())||v().features.toLowerCase().includes(t().toLowerCase())||v().equipment.toLowerCase().includes(t().toLowerCase())||v().notes.toLowerCase().includes(t().toLowerCase()))}),Jt(),Rt();var x=fi();let ee;var W=i(x);{let Q=dt(()=>(u(),r(()=>u().notes?"Expand":"Collapse")));ia(W,{title:"Features & Traits",get collapsed(){return u(),r(()=>u().notes)},get ariaLabel(){return e(Q)},onToggle:L})}var ne=s(W,2);{var V=Q=>{var _e=pi(),pe=Ne(_e);da(pe);var G=s(pe,4);da(G);var Ae=s(G,4);da(Ae),qe(pe,()=>v().features,Ke=>_t(le,r(v).features=Ke,r(v))),qe(G,()=>v().equipment,Ke=>_t(le,r(v).equipment=Ke,r(v))),qe(Ae,()=>v().notes,Ke=>_t(le,r(v).notes=Ke,r(v))),c(Q,_e)};y(ne,Q=>{u(),r(()=>!u().notes)&&Q(V)})}l(x),T(()=>ee=yt(x,1,"notes svelte-wttn0l",null,ee,{hidden:!e(C)})),c(a,x),Ht(),S()}var bi=g('<div class="color-picker-section svelte-1r90jgp"><h3 class="svelte-1r90jgp">Dice Colors</h3> <div class="color-inputs svelte-1r90jgp"><div class="color-input-group svelte-1r90jgp"><label for="dice-color" class="svelte-1r90jgp">Dice Color</label> <input type="color" id="dice-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="label-color" class="svelte-1r90jgp">Label Color</label> <input type="color" id="label-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="desk-color" class="svelte-1r90jgp">Background Color</label> <input type="color" id="desk-color" class="svelte-1r90jgp"/></div></div></div>'),hi=g('<div class="loading svelte-1r90jgp"><p class="svelte-1r90jgp">Loading 3D dice...</p></div>'),mi=g('<div class="custom-dice-selector svelte-1r90jgp"><h3 class="svelte-1r90jgp">Choose Dice to Roll</h3> <div class="dice-inputs svelte-1r90jgp"><div class="dice-input-group svelte-1r90jgp"><label for="d4" class="svelte-1r90jgp">d4</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d4" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d6" class="svelte-1r90jgp">d6</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d6" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d8" class="svelte-1r90jgp">d8</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d8" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d10" class="svelte-1r90jgp">d10</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d10" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d12" class="svelte-1r90jgp">d12</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d12" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d20" class="svelte-1r90jgp">d20</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d20" min="0" max="10"/></div></div> <div class="dice-controls svelte-1r90jgp"><button class="btn btn-primary use-enabled svelte-1r90jgp"> </button> <button class="btn btn-secondary use-enabled svelte-1r90jgp">Reset</button></div></div>'),_i=g('<span class="crit-badge svelte-1r90jgp">CRITICAL HIT!</span>'),yi=g('<span class="crit-badge crit-fail svelte-1r90jgp">CRITICAL MISS!</span>'),ki=g('<div class="bonus-item svelte-1r90jgp"><span class="bonus-value svelte-1r90jgp"> </span> <span class="bonus-source svelte-1r90jgp"> </span></div>'),Si=g('<div class="bonus-breakdown svelte-1r90jgp"></div>'),xi=g('<p class="modifier-text svelte-1r90jgp"> </p>'),$i=g('<div class="svelte-1r90jgp"><em class="svelte-1r90jgp">No damage is dealt on a critical miss.</em></div>'),Ci=g('<button class="btn btn-follow-up svelte-1r90jgp"> </button>'),wi=g('<button class="btn btn-guided-strike svelte-1r90jgp">‚ö° Use Guided Strike (+10)</button>'),Di=g('<div class="follow-up-actions svelte-1r90jgp"><!> <!></div>'),Li=g('<div class="result-header svelte-1r90jgp"><h3 class="svelte-1r90jgp"> </h3> <!> <!></div> <div class="result-total svelte-1r90jgp"> </div> <div class="result-details svelte-1r90jgp"><!></div> <!> <!>',1),ji=g('<div role="button" tabindex="-1"><div class="modal-content svelte-1r90jgp" role="dialog" tabindex="0"><div class="modal-header svelte-1r90jgp"><h2 class="svelte-1r90jgp">Dice Roller</h2> <div class="header-buttons svelte-1r90jgp"><button class="color-btn svelte-1r90jgp" title="Customize dice colors">üé®</button> <button class="close-btn svelte-1r90jgp">√ó</button></div></div> <!> <!> <div class="dice-main-area svelte-1r90jgp"><div class="dice-container svelte-1r90jgp"></div> <!></div> <div><!></div></div></div>');function Bi(a,n){Et(n,!1);const t=()=>st(le,"$character",v),[v,u]=Wt(),m=B(),S=B(),C=B(),L=la();let x=St(n,"notation",12,""),ee=St(n,"visible",8,!1),W=St(n,"damageNotation",12,""),ne=St(n,"attackName",12,""),V=St(n,"applyHalfDamage",8,!1),Q=St(n,"bonusBreakdown",28,()=>[]),_e=St(n,"rollType",12,"other"),pe=null,G=B(void 0),Ae=B(!1),Ke=B(""),se=B(null);function We(){return e(se)?.resultTotal??null}function Pe(_,N,Z){const J=[];if(!_||!_.result)return J;const re=N.match(/([+-]?\d*d\d+|[+-]?\d+)/g)||[];let b=0;const k=new Set;for(const R of re){const he=R.trim();if(!he)continue;const me=he.match(/([+-]?)(\d*)d(\d+)/);if(me){const ze=parseInt(me[2]||"1"),E=`${ze}d${me[3]}`,tt=Z.findIndex((p,U)=>!k.has(U)&&typeof p.value=="string"&&p.value===E),ut=[];for(let p=0;p<ze&&b<_.result.length;p++)ut.push(_.result[b++]);const ft=tt>=0?Z[tt].source:"base die";tt>=0&&k.add(tt);for(const p of ut)J.push({display:`${p}`,source:ft})}}for(let R=0;R<Z.length;R++)if(!k.has(R)&&typeof Z[R].value=="number"){const he=Z[R].value;J.push({display:he>=0?`+${he}`:`${he}`,source:Z[R].source})}return J}let te=B(0),ge=B(0),Fe=B(0),Se=B(0),Le=B(0),w=B(0),oe=B(0),f=B([]),$=B(!1),O=B(!1),Ce=B(!1),Re=B("#051e0a"),we=B("#ffffff"),h=B("#3a2004"),P=B(!1);function q(_){return _.length===9&&_.startsWith("#")?_.substring(0,7):_}function Y(_,N="ff"){return _.length===7&&_.startsWith("#")?_+N:_}function z(){if(window.DICE&&e(G))try{pe&&e(G)&&sa(G,e(G).innerHTML="");const _=e(G).clientWidth||500,N=e(G).clientHeight||300;pe=new window.DICE.dice_box(e(G),{w:_,h:N}),o(Ae,!0)}catch(_){console.error("Error initializing dice box:",_)}}pa(()=>{const _=J=>new Promise((re,b)=>{if(document.querySelector(`script[src="${J}"]`)){re(null);return}const R=document.createElement("script");R.src=J,R.onload=()=>{re(null)},R.onerror=()=>{console.error(`Failed to load: ${J}`),b(new Error(`Failed to load ${J}`))},document.head.appendChild(R)});setTimeout(()=>{_(`${va}/libs/three.min.js`).then(()=>_(`${va}/libs/cannon.min.js`)).then(()=>_(`${va}/libs/teal.js`)).then(()=>_(`${va}/dice.js`)).then(()=>{if(window.DICE){const J=window.DICE.getColors();o(Re,q(J.dice_color)),o(we,q(J.label_color)),o(h,q(J.desk_color))}z()}).catch(J=>{console.error("Failed to load dice libraries:",J)})},100);const N=()=>{e(Ae)&&z()},Z=J=>{ee()&&J.key==="Escape"&&ce()};return window.addEventListener("resize",N),window.addEventListener("keydown",Z),()=>{window.removeEventListener("resize",N),window.removeEventListener("keydown",Z)}});function fe(_,N="other"){if(!pe||!e(Ae))return;o(se,null),o(f,[]),o($,!1),o(O,!1),N==="damage"&&Q([]),_e(N),o(Ce,!1),pe.diceToRoll=_;const Z=re=>null,J=re=>{let b=re.resultTotal,k=re.resultString;if(V()&&(b=Math.floor(b/2),k=k+" (halved)"),o(se,{...re,resultTotal:b,resultString:k}),console.log("Final roll result:",e(se)),console.log({type:N}),N==="attack"&&re.result&&re.result.length>0){const R=re.result[0];o($,R===20),o(O,R===1)}if(o(f,[]),console.log("Setting up follow-up actions. Type:",N,"damageNotation:",W(),"isCriticalSuccess:",e($),"isCriticalFail:",e(O)),N==="attack"&&W())if(e($)){const R=be(W());e(f).push({label:`Roll Critical Damage (${R})`,notation:R})}else e(O)||e(f).push({label:`Roll Damage (${W()})`,notation:W()})};pe.start_throw(Z,J)}function De(){const _=[];e(te)>0&&_.push(`${e(te)}d4`),e(ge)>0&&_.push(`${e(ge)}d6`),e(Fe)>0&&_.push(`${e(Fe)}d8`),e(Se)>0&&_.push(`${e(Se)}d10`),e(Le)>0&&_.push(`${e(Le)}d12`),e(w)>0&&_.push(`${e(w)}d20`);let N=_.join("+")||"1d20";return e(oe)!==0&&(N+=e(oe)>=0?`+${e(oe)}`:`${e(oe)}`),N}function nt(){const _=De();fe(_)}function be(_){return _.replace(/(\d+)d(\d+)/g,(N,Z,J)=>`${parseInt(Z)*2}d${J}`)}function Ve(){o(te,0),o(ge,0),o(Fe,0),o(Se,0),o(Le,0),o(w,0),o(oe,0),o(se,null),o(f,[]),o($,!1),o(O,!1),_e("other"),o(Ce,!1)}function I(){window.DICE&&(window.DICE.setColors({dice_color:Y(e(Re),"ff"),label_color:Y(e(we),"ff"),desk_color:e(h)}),pe&&(pe.updateDeskColor(e(h)),pe.updateDiceColors()))}function j(){o(P,!e(P))}function ie(){!e(se)||e(S)<=0||e(Ce)||(o(se,{...e(se),resultTotal:e(se).resultTotal+10,resultString:e(se).resultString+" + 10 (Guided Strike)"}),le.update(_=>{const N="ChannelDivinity",Z=_.classFeatures.features[N];return typeof Z=="number"&&Z>0&&(_.classFeatures.features[N]=Z-1),_}),o(Ce,!0))}function ce(){L("close"),x(""),W(""),ne(""),o(Ke,""),o(se,null),o(Ce,!1),o($,!1),o(O,!1),Ve()}Xe(()=>(t(),oa),()=>{o(m,t().class?oa(t().class,t().level,t().subclass).some(N=>N.name==="Guided Strike"):!1)}),Xe(()=>t(),()=>{o(S,(()=>{const N=t().classFeatures.features["ChannelDivinity"];return typeof N=="number"?N:0})())}),Xe(()=>(e(te),e(ge),e(Fe),e(Se),e(Le),e(w),e(oe)),()=>{o(C,(()=>{const _=[];e(te)>0&&_.push(`${e(te)}d4`),e(ge)>0&&_.push(`${e(ge)}d6`),e(Fe)>0&&_.push(`${e(Fe)}d8`),e(Se)>0&&_.push(`${e(Se)}d10`),e(Le)>0&&_.push(`${e(Le)}d12`),e(w)>0&&_.push(`${e(w)}d20`);let N=_.join("+")||"1d20";return e(oe)!==0&&(N+=e(oe)>=0?`+${e(oe)}`:`${e(oe)}`),N})())}),Xe(()=>(H(x()),e(Ae),H(ee()),e(Ke),H(W()),H(ne()),H(_e())),()=>{x()&&e(Ae)&&ee()&&x()!==e(Ke)&&(o(Ke,x()),o(se,null),o(f,[]),o($,!1),o(O,!1),o(Ce,!1),console.log("Auto-roll triggered. notation:",x(),"damageNotation:",W(),"attackName:",ne(),"rollType:",_e()),setTimeout(()=>fe(x(),_e()),200))}),Jt();var K={getLastRollTotal:We};Rt();var d=ji();let Ee;var ve=i(d),de=i(ve),A=s(i(de),2),Me=i(A),Te=s(Me,2);l(A),l(de);var Ze=s(de,2);{var it=_=>{var N=bi(),Z=s(i(N),2),J=i(Z),re=s(i(J),2);$e(re),l(J);var b=s(J,2),k=s(i(b),2);$e(k),l(b);var R=s(b,2),he=s(i(R),2);$e(he),l(R),l(Z),l(N),qe(re,()=>e(Re),me=>o(Re,me)),M("change",re,I),qe(k,()=>e(we),me=>o(we,me)),M("change",k,I),qe(he,()=>e(h),me=>o(h,me)),M("change",he,I),c(_,N)};y(Ze,_=>{e(P)&&_(it)})}var je=s(Ze,2);{var ye=_=>{var N=hi();c(_,N)};y(je,_=>{e(Ae)||_(ye)})}var Be=s(je,2),He=i(Be);ja(He,_=>o(G,_),()=>e(G));var Ue=s(He,2);{var Ge=_=>{var N=mi(),Z=s(i(N),2),J=i(Z),re=s(i(J),2);$e(re),l(J);var b=s(J,2),k=s(i(b),2);$e(k),l(b);var R=s(b,2),he=s(i(R),2);$e(he),l(R);var me=s(R,2),ze=s(i(me),2);$e(ze),l(me);var E=s(me,2),tt=s(i(E),2);$e(tt),l(E);var ut=s(E,2),ft=s(i(ut),2);$e(ft),l(ut),l(Z);var p=s(Z,2),U=i(p),F=i(U);l(U);var xe=s(U,2);l(p),l(N),T(()=>{U.disabled=!e(Ae),D(F,`Roll ${e(C)??""}`)}),qe(re,()=>e(te),ae=>o(te,ae)),qe(k,()=>e(ge),ae=>o(ge,ae)),qe(he,()=>e(Fe),ae=>o(Fe,ae)),qe(ze,()=>e(Se),ae=>o(Se,ae)),qe(tt,()=>e(Le),ae=>o(Le,ae)),qe(ft,()=>e(w),ae=>o(w,ae)),M("click",U,nt),M("click",xe,Ve),c(_,N)};y(Ue,_=>{x()||_(Ge)})}l(Be);var X=s(Be,2);let ue;var Oe=i(X);{var et=_=>{var N=Li(),Z=Ne(N),J=i(Z),re=i(J,!0);l(J);var b=s(J,2);{var k=xe=>{var ae=_i();c(xe,ae)};y(b,xe=>{e($)&&xe(k)})}var R=s(b,2);{var he=xe=>{var ae=yi();c(xe,ae)};y(R,xe=>{e(O)&&xe(he)})}l(Z);var me=s(Z,2),ze=i(me,!0);l(me);var E=s(me,2),tt=i(E);{var ut=xe=>{var ae=vt(),at=Ne(ae);{var Ie=Je=>{var ot=Si();kt(ot,5,()=>(e(se),H(x()),H(Q()),r(()=>Pe(e(se),x(),Q()))),xt,(rt,ct)=>{var ht=ki(),mt=i(ht),Qe=i(mt,!0);l(mt);var lt=s(mt,2),pt=i(lt);l(lt),l(ht),T(()=>{D(Qe,(e(ct),r(()=>e(ct).display))),D(pt,`(${e(ct),r(()=>e(ct).source)??""})`)}),c(rt,ht)}),l(ot),c(Je,ot)},bt=Je=>{var ot=vt(),rt=Ne(ot);{var ct=ht=>{var mt=xi(),Qe=i(mt);l(mt),T(()=>D(Qe,`Modifier: ${e(se),r(()=>e(se).constant>=0?"+":"")??""}${e(se),r(()=>e(se).constant)??""}`)),c(ht,mt)};y(rt,ht=>{e(se),r(()=>e(se).constant)&&ht(ct)},!0)}c(Je,ot)};y(at,Je=>{H(Q()),r(()=>Q().length>0)?Je(Ie):Je(bt,!1)})}c(xe,ae)};y(tt,xe=>{e(se),H(Q()),r(()=>e(se).constant||Q().length>0)&&xe(ut)})}l(E);var ft=s(E,2);{var p=xe=>{var ae=$i();c(xe,ae)};y(ft,xe=>{e(O)&&xe(p)})}var U=s(ft,2);{var F=xe=>{var ae=Di(),at=i(ae);kt(at,1,()=>e(f),xt,(Je,ot)=>{var rt=Ci(),ct=i(rt,!0);l(rt),T(()=>D(ct,(e(ot),r(()=>e(ot).label)))),M("click",rt,()=>fe(e(ot).notation,"damage")),c(Je,rt)});var Ie=s(at,2);{var bt=Je=>{var ot=wi();T(()=>{ot.disabled=e(S)<=0,Ye(ot,"title",e(S)<=0?"No Channel Divinity uses remaining":"Use Channel Divinity to add +10 to this attack roll")}),M("click",ot,ie),c(Je,ot)};y(Ie,Je=>{e(m)&&_e()==="attack"&&!e(Ce)&&e(S)>0&&!e(O)&&Je(bt)})}l(ae),c(xe,ae)};y(U,xe=>{e(f),e(m),H(_e()),e(Ce),e(S),r(()=>e(f).length>0||e(m)&&_e()==="attack"&&!e(Ce)&&e(S)>0)&&xe(F)})}T(()=>{D(re,ne()?`${ne()} - Result`:"Result"),D(ze,(e(se),r(()=>e(se).resultTotal)))}),c(_,N)};y(Oe,_=>{e(se)&&_(et)})}l(X),l(ve),l(d),T(()=>{Ee=yt(d,1,"modal-overlay svelte-1r90jgp",null,Ee,{hidden:!ee()}),ue=yt(X,1,"roll-result svelte-1r90jgp",null,ue,{"has-result":e(se)})}),M("click",Me,j),M("click",Te,ce),M("click",ve,Ea(function(_){na.call(this,n,_)})),M("keydown",ve,function(_){na.call(this,n,_)}),M("click",d,ce),M("keydown",d,_=>_.key==="Escape"&&ce()),c(a,d),ws(n,"getLastRollTotal",We);var ke=Ht(K);return u(),ke}const xa="https://api.github.com/gists";async function Ai(a,n,t){if(!n)throw new Error("GitHub token is required");const v=JSON.stringify(a,null,2),u=`${a.name||"character"}_dnd.json`,m={description:t||`D&D Character: ${a.name}`,public:!1,files:{[u]:{content:v}}},S=await fetch(xa,{method:"POST",headers:{Authorization:`token ${n}`,"Content-Type":"application/json"},body:JSON.stringify(m)});if(!S.ok)throw new Error(`Failed to create gist: ${S.statusText}`);return(await S.json()).id}async function Fi(a,n,t){if(!n||!t)throw new Error("GitHub token and Gist ID are required");const v=JSON.stringify(a,null,2),m={files:{[`${a.name||"character"}_dnd.json`]:{content:v}}},S=await fetch(`${xa}/${t}`,{method:"PATCH",headers:{Authorization:`token ${n}`,"Content-Type":"application/json"},body:JSON.stringify(m)});if(!S.ok)throw new Error(`Failed to update gist: ${S.statusText}`)}async function Mi(a,n){if(!a)throw new Error("Gist ID is required");const t={"Content-Type":"application/json"};n&&(t.Authorization=`token ${n}`);const v=await fetch(`${xa}/${a}`,{method:"GET",headers:t});if(!v.ok)throw new Error(`Failed to load gist: ${v.statusText}`);const u=await v.json(),m=Object.values(u.files);if(m.length===0)throw new Error("No files found in gist");const C=m[0].content;try{const L=JSON.parse(C);return L.attacks&&Array.isArray(L.attacks)&&(L.attacks=L.attacks.map(x=>({...x,id:x.id||crypto.randomUUID()}))),L.classFeatures?(L.classFeatures.features||(L.classFeatures.features={}),L.classFeatures.spellSlots||(L.classFeatures.spellSlots=[]),L.classFeatures.preparedSpells===void 0&&(L.classFeatures.preparedSpells="")):L.classFeatures={features:{},spellSlots:[],preparedSpells:""},L}catch{throw new Error("Invalid character data in gist")}}function Ja(a){typeof window<"u"&&localStorage.setItem("dnd_gist_config",JSON.stringify(a))}function Ti(){if(typeof window<"u"){const a=localStorage.getItem("dnd_gist_config");if(a)return JSON.parse(a)}return{}}async function Ii(a,n=30){if(!a)throw new Error("GitHub token is required to list gists");const t=await fetch(`${xa}?per_page=${n}`,{method:"GET",headers:{Authorization:`token ${a}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error(`Failed to list gists: ${t.statusText}`);return await t.json()}var Pi=g('<div class="error-message svelte-1jb5ckg"> </div>'),Ri=g('<div class="toggle-container svelte-1jb5ckg"><button type="button" class="toggle-btn svelte-1jb5ckg"> </button></div>'),Ei=g('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID (leave empty to create new)</label> <input type="text" id="gistId" placeholder="Optional: existing Gist ID to update" class="svelte-1jb5ckg"/></div>'),Hi=g('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),Ui=g('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),Ni=g('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Update (or leave unselected to create new)</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),Gi=g('<div class="info-message svelte-1jb5ckg">No gists found. A new one will be created.</div>'),Oi=g('<!> <div class="form-group svelte-1jb5ckg"><label for="description" class="svelte-1jb5ckg"> </label> <input type="text" id="description" placeholder="D&amp;D Character Sheet" class="svelte-1jb5ckg"/></div>',1),qi=g('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID *</label> <input type="text" id="gistId" placeholder="Enter Gist ID (for public or your private gists)" required class="svelte-1jb5ckg"/></div>'),Wi=g('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),zi=g('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),Ki=g('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Load</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),Vi=g('<div class="info-message svelte-1jb5ckg">No gists found. Enter a Gist ID manually or create a new one in Save mode.</div>'),Ji=g('<div class="modal-overlay svelte-1jb5ckg" role="button" tabindex="-1"><div class="modal-content svelte-1jb5ckg" role="dialog" tabindex="0"><div class="modal-header svelte-1jb5ckg"><h2 class="svelte-1jb5ckg"> </h2> <button class="close-btn svelte-1jb5ckg">√ó</button></div> <div class="modal-body svelte-1jb5ckg"><!> <div class="form-group svelte-1jb5ckg"><label for="token" class="svelte-1jb5ckg"> <a href="https://github.com/settings/tokens" target="_blank" rel="noopener" class="svelte-1jb5ckg">Get token</a></label> <input type="password" id="token" placeholder="ghp_xxxxxxxxxxxxx" class="svelte-1jb5ckg"/></div> <!> <!> <div class="modal-actions svelte-1jb5ckg"><button class="btn btn-primary svelte-1jb5ckg"><!></button> <button class="btn btn-secondary svelte-1jb5ckg">Cancel</button></div></div></div></div>');function Qi(a,n){Et(n,!1);const t=()=>st(le,"$character",v),[v,u]=Wt(),m=la();let S=St(n,"mode",8,"save"),C=B(""),L=B(""),x=B(""),ee=B(!1),W=B(""),ne=B(!1),V=B(!1),Q=B([]),_e=B(null);const pe=Ti();pe.token&&o(C,pe.token),pe.gistId&&o(L,pe.gistId),pa(async()=>{e(C)&&!e(ne)&&await G()});async function G(){if(e(C)){o(V,!0),o(W,"");try{o(Q,await Ii(e(C))),e(L)&&o(_e,e(Q).find(j=>j.id===e(L))||null)}catch(j){o(W,j.message||"Failed to load gists"),o(Q,[])}finally{o(V,!1)}}}function Ae(j){o(_e,j),o(L,j.id)}function Ke(){o(ne,!e(ne)),o(W,""),!e(ne)&&e(C)&&G()}async function se(){if(!e(C)){o(W,"GitHub token is required");return}const j=e(_e)?.id||e(L);o(ee,!0),o(W,"");try{if(j)await Fi(t(),e(C),j),o(L,j),qt.add("Character updated in Gist successfully!","success");else{const ie=await Ai(t(),e(C),e(x));o(L,ie),qt.add(`Character saved to Gist! ID: ${ie}`,"success")}Ja({token:e(C),gistId:e(L)}),m("close")}catch(ie){o(W,ie.message||"Failed to save to Gist")}finally{o(ee,!1)}}async function We(){const j=e(_e)?.id||e(L);if(!j){o(W,"Please select a gist or enter a Gist ID");return}o(ee,!0),o(W,"");try{const ie=await Mi(j,e(C)||void 0);le.set(ie),o(L,j),Ja({token:e(C),gistId:e(L)}),qt.add("Character loaded from Gist successfully!","success"),m("close")}catch(ie){o(W,ie.message||"Failed to load from Gist")}finally{o(ee,!1)}}function Pe(){m("close")}Rt();var te=Ji(),ge=i(te),Fe=i(ge),Se=i(Fe),Le=i(Se,!0);l(Se);var w=s(Se,2);l(Fe);var oe=s(Fe,2),f=i(oe);{var $=j=>{var ie=Pi(),ce=i(ie,!0);l(ie),T(()=>D(ce,e(W))),c(j,ie)};y(f,j=>{e(W)&&j($)})}var O=s(f,2),Ce=i(O),Re=i(Ce);ra(),l(Ce);var we=s(Ce,2);$e(we),l(O);var h=s(O,2);{var P=j=>{var ie=Ri(),ce=i(ie),K=i(ce,!0);l(ce),l(ie),T(()=>{ce.disabled=e(ee),D(K,e(ne)?"üìã Show My Gists":"‚úèÔ∏è Enter Gist ID Manually")}),M("click",ce,Ke),c(j,ie)};y(h,j=>{(S()==="load"||S()==="save"&&e(C))&&j(P)})}var q=s(h,2);{var Y=j=>{var ie=Oi(),ce=Ne(ie);{var K=Me=>{var Te=Ei(),Ze=s(i(Te),2);$e(Ze),l(Te),T(()=>Ze.disabled=e(ee)),qe(Ze,()=>e(L),it=>o(L,it)),c(Me,Te)},d=Me=>{var Te=vt(),Ze=Ne(Te);{var it=ye=>{var Be=Hi();c(ye,Be)},je=ye=>{var Be=vt(),He=Ne(Be);{var Ue=X=>{var ue=Ni(),Oe=s(i(ue),2);kt(Oe,5,()=>e(Q),xt,(et,ke)=>{var _=Ui();let N;var Z=i(_),J=i(Z),re=i(J,!0);l(J);var b=s(J,2),k=i(b,!0);l(b),l(Z);var R=s(Z,2),he=i(R),me=i(he);l(he);var ze=s(he,2),E=i(ze);l(ze),l(R),l(_),T(tt=>{N=yt(_,1,"gist-item svelte-1jb5ckg",null,N,{selected:e(_e)?.id===e(ke).id}),_.disabled=e(ee),D(re,(e(ke),r(()=>e(ke).description||"Untitled"))),D(k,(e(ke),r(()=>e(ke).public?"üåê Public":"üîí Private"))),D(me,`ID: ${e(ke),r(()=>e(ke).id)??""}`),D(E,`Updated: ${tt??""}`)},[()=>(e(ke),r(()=>new Date(e(ke).updated_at).toLocaleDateString()))]),M("click",_,()=>Ae(e(ke))),c(et,_)}),l(Oe),l(ue),c(X,ue)},Ge=X=>{var ue=vt(),Oe=Ne(ue);{var et=ke=>{var _=Gi();c(ke,_)};y(Oe,ke=>{e(C)&&ke(et)},!0)}c(X,ue)};y(He,X=>{e(Q),r(()=>e(Q).length>0)?X(Ue):X(Ge,!1)},!0)}c(ye,Be)};y(Ze,ye=>{e(V)?ye(it):ye(je,!1)},!0)}c(Me,Te)};y(ce,Me=>{e(ne)||!e(C)?Me(K):Me(d,!1)})}var Ee=s(ce,2),ve=i(Ee),de=i(ve);l(ve);var A=s(ve,2);$e(A),l(Ee),T(()=>{D(de,`Description ${e(L)?"(optional)":""}`),A.disabled=e(ee)}),qe(A,()=>e(x),Me=>o(x,Me)),c(j,ie)},z=j=>{var ie=vt(),ce=Ne(ie);{var K=Ee=>{var ve=qi(),de=s(i(ve),2);$e(de),l(ve),T(()=>de.disabled=e(ee)),qe(de,()=>e(L),A=>o(L,A)),c(Ee,ve)},d=Ee=>{var ve=vt(),de=Ne(ve);{var A=Te=>{var Ze=Wi();c(Te,Ze)},Me=Te=>{var Ze=vt(),it=Ne(Ze);{var je=Be=>{var He=Ki(),Ue=s(i(He),2);kt(Ue,5,()=>e(Q),xt,(Ge,X)=>{var ue=zi();let Oe;var et=i(ue),ke=i(et),_=i(ke,!0);l(ke);var N=s(ke,2),Z=i(N,!0);l(N),l(et);var J=s(et,2),re=i(J),b=i(re);l(re);var k=s(re,2),R=i(k);l(k),l(J),l(ue),T(he=>{Oe=yt(ue,1,"gist-item svelte-1jb5ckg",null,Oe,{selected:e(_e)?.id===e(X).id}),ue.disabled=e(ee),D(_,(e(X),r(()=>e(X).description||"Untitled"))),D(Z,(e(X),r(()=>e(X).public?"üåê Public":"üîí Private"))),D(b,`ID: ${e(X),r(()=>e(X).id)??""}`),D(R,`Updated: ${he??""}`)},[()=>(e(X),r(()=>new Date(e(X).updated_at).toLocaleDateString()))]),M("click",ue,()=>Ae(e(X))),c(Ge,ue)}),l(Ue),l(He),c(Be,He)},ye=Be=>{var He=vt(),Ue=Ne(He);{var Ge=X=>{var ue=Vi();c(X,ue)};y(Ue,X=>{e(C)&&X(Ge)},!0)}c(Be,He)};y(it,Be=>{e(Q),r(()=>e(Q).length>0)?Be(je):Be(ye,!1)},!0)}c(Te,Ze)};y(de,Te=>{e(V)?Te(A):Te(Me,!1)},!0)}c(Ee,ve)};y(ce,Ee=>{e(ne)||!e(C)?Ee(K):Ee(d,!1)},!0)}c(j,ie)};y(q,j=>{S()==="save"?j(Y):j(z,!1)})}var fe=s(q,2),De=i(fe),nt=i(De);{var be=j=>{var ie=Mt();T(()=>D(ie,S()==="save"?"Saving...":"Loading...")),c(j,ie)},Ve=j=>{var ie=Mt();T(()=>D(ie,S()==="save"?"Save":"Load")),c(j,ie)};y(nt,j=>{e(ee)?j(be):j(Ve,!1)})}l(De);var I=s(De,2);l(fe),l(oe),l(ge),l(te),T(()=>{D(Le,S()==="save"?"Save to GitHub Gist":"Load from GitHub Gist"),D(Re,`GitHub Token ${S()==="load"?"(optional for public gists)":"(required)"} `),we.disabled=e(ee),De.disabled=e(ee),I.disabled=e(ee)}),M("click",w,Pe),qe(we,()=>e(C),j=>o(C,j)),M("blur",we,()=>{e(C)&&!e(ne)&&G()}),M("click",De,function(...j){(S()==="save"?se:We)?.apply(this,j)}),M("click",I,Pe),M("click",ge,Ea(function(j){na.call(this,n,j)})),M("keydown",ge,function(j){na.call(this,n,j)}),M("click",te,Pe),M("keydown",te,j=>j.key==="Escape"&&Pe()),c(a,te),Ht(),u()}var Yi=g('<div class="loading svelte-1ngjemu">Loading D&D data...</div>'),Xi=g("<option> </option>"),Zi=g('<select class="level-filter svelte-1ngjemu"><option>All Levels</option><option>Cantrip</option><!></select>'),er=g('<div class="no-results svelte-1ngjemu"> </div>'),tr=g('<div class="item-meta svelte-1ngjemu"> </div>'),ar=g('<div class="item-meta svelte-1ngjemu"> </div>'),sr=g('<button><div class="item-name svelte-1ngjemu"> </div> <!></button>'),lr=g('<p class="higher-levels"><strong>At Higher Levels:</strong> </p>'),ir=g('<p class="cantrip-upgrade"><strong>Cantrip Upgrade:</strong> </p>'),rr=g('<h3 class="svelte-1ngjemu"> </h3> <p class="spell-meta svelte-1ngjemu"><!> <!></p> <p class="spell-classes"><strong>Classes:</strong> </p> <div class="spell-stats svelte-1ngjemu"><div><strong>Casting Time:</strong> </div> <div><strong>Range:</strong> </div> <div><strong>Components:</strong> <!></div> <div><strong>Duration:</strong> <!> </div></div> <p class="description svelte-1ngjemu"> </p> <!> <!>',1),nr=g('<p class="prerequisite svelte-1ngjemu"><strong>Prerequisite:</strong> </p>'),or=g('<h3 class="svelte-1ngjemu"> </h3> <!> <p class="description svelte-1ngjemu"> </p> <a target="_blank" rel="noopener" class="source-link svelte-1ngjemu">View Full Details ‚Üí</a>',1),cr=g('<div class="item-details svelte-1ngjemu"><!></div>'),vr=g('<div class="controls svelte-1ngjemu"><div class="tabs svelte-1ngjemu"><button> </button> <button> </button></div> <div class="search-controls svelte-1ngjemu"><input type="text" placeholder="Search by name or description..." class="search-input svelte-1ngjemu"/> <!></div></div> <div class="content-container svelte-1ngjemu"><div class="items-list svelte-1ngjemu"><!></div> <!></div>',1),dr=g('<div class="modal-backdrop svelte-1ngjemu" role="presentation"><div class="modal svelte-1ngjemu" role="dialog" aria-modal="true" tabindex="-1"><div class="modal-header svelte-1ngjemu"><h2 class="svelte-1ngjemu">Browse D&D Spells & Feats</h2> <button class="close-btn svelte-1ngjemu" aria-label="Close">&times;</button></div> <div class="modal-body svelte-1ngjemu"><!></div> <div class="modal-footer svelte-1ngjemu"><button class="btn-secondary svelte-1ngjemu">Cancel</button> <button class="btn-primary svelte-1ngjemu">Add to Character Sheet</button></div></div></div>');function ur(a,n){Et(n,!1);const t=B(),v=B(),u=B();let m=St(n,"onClose",8),S=B("spell"),C=B(!0),L=B(""),x=B(null),ee=B([]),W=B([]),ne=B(null);pa(async()=>{o(C,!0);try{o(ee,await ls()),o(W,await rl())}catch(w){console.error("Failed to load data:",w)}finally{o(C,!1)}});function V(w){o(ne,w)}function Q(w){const oe=w.match(/(\d+d\d+(?:\s*\+\s*\d+)?)/i);return oe?oe[1]:""}function _e(w){const oe=w.split(/\.( |$)/)[0].trim(),f=Array.from(w.matchAll(/\*\*(.*?)\*\*/g)).map(O=>O[1].replace(/\.$/,""));let $=oe;return f.length&&($+=" | Effects: "+f.join(", ")),$}function pe(){if(e(ne)){if(e(S)==="spell"){const w=e(ne);le.update(oe=>{const $=[];w.range&&$.push(`Range: ${w.range}`),w.castingTime&&$.push(`Cast: ${w.castingTime}`),w.duration&&$.push(`Duration: ${w.duration}`),w.actionType==="Save"&&$.push("Saving throw spell"),w.components&&w.components.length>0&&$.push(`Components: ${w.components.join(", ")}`),w.material&&$.push(`Material: ${w.material}`);const O=$.join(" | "),Ce=_e(w.description),Re={id:crypto.randomUUID(),name:`${w.name}${w.concentration?" (C)":""}${w.ritual?" (R)":""}`,bonus:w.actionType==="Attack"?5:0,damage:Q(w.description),damageType:`${w.school} (Lvl ${w.level})`,spellRef:w.name,infoNotes:O,generalNotes:Ce,castAtLevel:w.level};return oe.attacks=[...oe.attacks,Re],oe})}else if(e(S)==="feat"){const w=e(ne);le.update(oe=>{const f=`${w.name}${w.prerequisite?` (Req: ${w.prerequisite})`:""}
${w.description}
`;return oe.features=oe.features?`${oe.features}
${f}`:f,oe})}o(ne,null),m()()}}Xe(()=>(e(x),e(ee),e(L)),()=>{o(t,e(x)!==null?nl(za(e(ee),e(L)),e(x)):za(e(ee),e(L)))}),Xe(()=>(e(W),e(L)),()=>{o(v,ol(e(W),e(L)))}),Xe(()=>(e(S),e(t),e(v)),()=>{o(u,e(S)==="spell"?e(t):e(v))}),Jt(),Rt();var G=dr(),Ae=i(G),Ke=i(Ae),se=s(i(Ke),2);l(Ke);var We=s(Ke,2),Pe=i(We);{var te=w=>{var oe=Yi();c(w,oe)},ge=w=>{var oe=vr(),f=Ne(oe),$=i(f),O=i($);let Ce;var Re=i(O);l(O);var we=s(O,2);let h;var P=i(we);l(we),l($);var q=s($,2),Y=i(q);$e(Y);var z=s(Y,2);{var fe=ce=>{var K=Zi();T(()=>{e(x),jt(()=>{})});var d=i(K);d.value=(d.__value=null)??"";var Ee=s(d);Ee.value=Ee.__value=0;var ve=s(Ee);kt(ve,0,()=>[1,2,3,4,5,6,7,8,9],xt,(de,A)=>{var Me=Xi(),Te=i(Me);l(Me);var Ze={};T(()=>{D(Te,`Level ${A??""}`),Ze!==(Ze=A)&&(Me.value=(Me.__value=A)??"")}),c(de,Me)}),l(K),Aa(K,()=>e(x),de=>o(x,de)),c(ce,K)};y(z,ce=>{e(S)==="spell"&&ce(fe)})}l(q),l(f);var De=s(f,2),nt=i(De),be=i(nt);{var Ve=ce=>{var K=er(),d=i(K);l(K),T(()=>D(d,`No ${e(S)??""}s found`)),c(ce,K)},I=ce=>{var K=vt(),d=Ne(K);kt(d,1,()=>e(u),xt,(Ee,ve)=>{var de=sr();let A;var Me=i(de),Te=i(Me,!0);l(Me);var Ze=s(Me,2);{var it=ye=>{const Be=dt(()=>e(ve));var He=tr(),Ue=i(He);l(He),T(()=>D(Ue,`Level ${H(e(Be)),r(()=>e(Be).level)??""} ‚Ä¢ ${H(e(Be)),r(()=>e(Be).school)??""}`)),c(ye,He)},je=ye=>{const Be=dt(()=>e(ve));var He=vt(),Ue=Ne(He);{var Ge=X=>{var ue=ar(),Oe=i(ue,!0);l(ue),T(()=>D(Oe,(H(e(Be)),r(()=>e(Be).prerequisite)))),c(X,ue)};y(Ue,X=>{H(e(Be)),r(()=>e(Be).prerequisite)&&X(Ge)})}c(ye,He)};y(Ze,ye=>{e(S)==="spell"?ye(it):ye(je,!1)})}l(de),T(()=>{A=yt(de,1,"item-card svelte-1ngjemu",null,A,{selected:e(ne)?.name===e(ve).name}),D(Te,(e(ve),r(()=>e(ve).name)))}),M("click",de,()=>V(e(ve))),c(Ee,de)}),c(ce,K)};y(be,ce=>{e(u),r(()=>e(u).length===0)?ce(Ve):ce(I,!1)})}l(nt);var j=s(nt,2);{var ie=ce=>{var K=cr(),d=i(K);{var Ee=de=>{const A=dt(()=>e(ne));var Me=rr(),Te=Ne(Me),Ze=i(Te,!0);l(Te);var it=s(Te,2),je=i(it);{var ye=p=>{var U=Mt();T(()=>D(U,`${H(e(A)),r(()=>e(A).school)??""} cantrip`)),c(p,U)},Be=p=>{var U=Mt();T(()=>D(U,`Level ${H(e(A)),r(()=>e(A).level)??""} ${H(e(A)),r(()=>e(A).school)??""}`)),c(p,U)};y(je,p=>{H(e(A)),r(()=>e(A).level===0)?p(ye):p(Be,!1)})}var He=s(je,2);{var Ue=p=>{var U=Mt("(ritual)");c(p,U)};y(He,p=>{H(e(A)),r(()=>e(A).ritual)&&p(Ue)})}l(it);var Ge=s(it,2),X=s(i(Ge));l(Ge);var ue=s(Ge,2),Oe=i(ue),et=s(i(Oe));l(Oe);var ke=s(Oe,2),_=s(i(ke));l(ke);var N=s(ke,2),Z=s(i(N)),J=s(Z);{var re=p=>{var U=Mt();T(()=>D(U,`(${H(e(A)),r(()=>e(A).material)??""})`)),c(p,U)};y(J,p=>{H(e(A)),r(()=>e(A).material)&&p(re)})}l(N);var b=s(N,2),k=s(i(b),2);{var R=p=>{var U=Mt("Concentration,");c(p,U)};y(k,p=>{H(e(A)),r(()=>e(A).concentration)&&p(R)})}var he=s(k,1,!0);l(b),l(ue);var me=s(ue,2),ze=i(me,!0);l(me);var E=s(me,2);{var tt=p=>{var U=lr(),F=s(i(U));l(U),T(()=>D(F,` ${H(e(A)),r(()=>e(A).higherLevelSlot)??""}`)),c(p,U)};y(E,p=>{H(e(A)),r(()=>e(A).higherLevelSlot)&&p(tt)})}var ut=s(E,2);{var ft=p=>{var U=ir(),F=s(i(U));l(U),T(()=>D(F,` ${H(e(A)),r(()=>e(A).cantripUpgrade)??""}`)),c(p,U)};y(ut,p=>{H(e(A)),r(()=>e(A).cantripUpgrade)&&p(ft)})}T((p,U)=>{D(Ze,(H(e(A)),r(()=>e(A).name))),D(X,` ${p??""}`),D(et,` ${H(e(A)),r(()=>e(A).castingTime||e(A).actionType)??""}`),D(_,` ${H(e(A)),r(()=>e(A).range)??""}`),D(Z,` ${U??""}`),D(he,(H(e(A)),r(()=>e(A).duration))),D(ze,(H(e(A)),r(()=>e(A).description)))},[()=>(H(e(A)),r(()=>e(A).classes.join(", "))),()=>(H(e(A)),r(()=>e(A).components.join(", ").toUpperCase()))]),c(de,Me)},ve=de=>{const A=dt(()=>e(ne));var Me=or(),Te=Ne(Me),Ze=i(Te,!0);l(Te);var it=s(Te,2);{var je=Ue=>{var Ge=nr(),X=s(i(Ge));l(Ge),T(()=>D(X,` ${H(e(A)),r(()=>e(A).prerequisite)??""}`)),c(Ue,Ge)};y(it,Ue=>{H(e(A)),r(()=>e(A).prerequisite)&&Ue(je)})}var ye=s(it,2),Be=i(ye,!0);l(ye);var He=s(ye,2);T(()=>{D(Ze,(H(e(A)),r(()=>e(A).name))),D(Be,(H(e(A)),r(()=>e(A).description))),Ye(He,"href",(H(e(A)),r(()=>e(A).source)))}),c(de,Me)};y(d,de=>{e(S)==="spell"?de(Ee):de(ve,!1)})}l(K),c(ce,K)};y(j,ce=>{e(ne)&&ce(ie)})}l(De),T(()=>{Ce=yt(O,1,"tab svelte-1ngjemu",null,Ce,{active:e(S)==="spell"}),D(Re,`üìú Spells (${e(ee),r(()=>e(ee).length)??""})`),h=yt(we,1,"tab svelte-1ngjemu",null,h,{active:e(S)==="feat"}),D(P,`‚≠ê Feats (${e(W),r(()=>e(W).length)??""})`)}),M("click",O,()=>{o(S,"spell"),o(ne,null),o(L,"")}),M("click",we,()=>{o(S,"feat"),o(ne,null),o(L,"")}),qe(Y,()=>e(L),ce=>o(L,ce)),c(w,oe)};y(Pe,w=>{e(C)?w(te):w(ge,!1)})}l(We);var Fe=s(We,2),Se=i(Fe),Le=s(Se,2);l(Fe),l(Ae),l(G),T(()=>Le.disabled=!e(ne)),M("click",se,function(...w){m()?.apply(this,w)}),M("click",Se,function(...w){m()?.apply(this,w)}),M("click",Le,pe),M("click",Ae,Ea(function(w){na.call(this,n,w)})),M("keydown",Ae,function(w){na.call(this,n,w)}),M("click",G,function(...w){m()?.apply(this,w)}),M("keydown",G,w=>w.key==="Escape"&&m()()),c(a,G),Ht()}var pr=g('<link rel="icon" type="image/png" href="favicon4.png"/> <meta name="viewport" content="width=device-width, initial-scale=1"/>',1),fr=g('<span class="character-name svelte-1uha8ag"> </span>'),gr=g("<span> </span>"),br=g('<div class="spell-slots-header svelte-1uha8ag"></div>'),hr=g("<span> </span><br/>",1),mr=g("<span> </span>"),_r=g('<span class="effect-tooltip"><strong> </strong><br/> <br/> <!> <!></span>'),yr=g('<button class="effect-remove-btn svelte-1uha8ag">√ó</button>'),kr=g('<span class="effect-badge svelte-1uha8ag" tabindex="0"> <!> <!></span>'),Sr=g(`<div class="active-effects-header svelte-1uha8ag"></div> <style>.effect-badge {
              position: relative;
            }
            .effect-tooltip {
              position: absolute;
              top: 120%;
              left: 50%;
              transform: translateX(-50%);
              background: #fff;
              color: #222;
              border: 1px solid #a5b4fc;
              border-radius: 6px;
              padding: 8px 12px;
              font-size: 0.95em;
              box-shadow: 0 2px 8px rgba(0, 0, 0, 0.12);
              z-index: 10;
              min-width: 180px;
              max-width: 260px;
              white-space: normal;
              pointer-events: none;
              opacity: 1;
              transition: opacity 0.15s;
            }</style>`,1),xr=g('<div class="rest-menu svelte-1uha8ag"><button class="rest-option svelte-1uha8ag">‚òï Short Rest</button> <button class="rest-option svelte-1uha8ag">üõèÔ∏è Long Rest</button></div>'),$r=g('<div class="container svelte-1uha8ag"><header class="svelte-1uha8ag"><div class="header-top svelte-1uha8ag"><div class="header-title svelte-1uha8ag"><div class="title-row svelte-1uha8ag"><h1 class="svelte-1uha8ag">D&D Character Sheet</h1> <!></div> <!> <!></div> <div class="header-right svelte-1uha8ag"><div class="header-controls svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">üé≤</span><span class="btn-text svelte-1uha8ag">Roll Dice</span></button> <div class="rest-button-container svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">üò¥</span><span class="btn-text svelte-1uha8ag">Rest</span></button> <!></div> <div class="mode-toggle"><button><span class="btn-icon svelte-1uha8ag"> </span><span class="btn-text svelte-1uha8ag"> </span></button></div></div> <div class="header-search svelte-1uha8ag"><input type="text" placeholder="üîç Search..." class="search-input use-enabled svelte-1uha8ag"/></div></div></div> <div class="header-actions svelte-1uha8ag"><button class="btn btn-mode svelte-1uha8ag">üìö Browse Spells & Feats</button> <button class="btn btn-secondary">Save to Gist</button> <button class="btn btn-secondary">Load from Gist</button> <button class="btn btn-secondary">Export JSON</button> <button class="btn btn-secondary">Import JSON</button> <input type="file" accept=".json" style="display: none;"/></div></header> <main class="svelte-1uha8ag"><!> <!> <!> <!> <!> <!> <!></main></div> <!> <!> <!> <!>',1);function Mr(a,n){Et(n,!1);const t=()=>st(le,"$character",m),v=()=>st(Zt,"$isEditMode",m),u=()=>st(ea,"$searchFilter",m),[m,S]=Wt();function C(){const p=[],U=t().classFeatures.spellSlotsByLevel||{};for(let F=1;F<=9;F++){const xe=U[F];if(xe&&xe.length>0){const ae=xe.length,at=xe.filter(Ie=>Ie).length;p.push({level:F,available:ae-at,total:ae})}}return p}let L=B(!1),x=B(!1),ee=B(!1),W=B("save"),ne=B(void 0),V=B(""),Q=B(""),_e=B(""),pe=B(!1),G=B([]),Ae=B("other"),Ke=B(),se=!1,We=1,Pe=B(!1),te=B(null);function ge(p){o(te,p)}function Fe(){o(te,null)}function Se(p){o(te,e(te)===p?null:p)}function Le(){const p=[];le.update(F=>{const xe=F.hitDice.current;F.hitDice.current=Math.min(F.hitDice.max,F.hitDice.current+Math.max(1,Math.floor(F.hitDice.max/2)));const ae=F.hitDice.current-xe;if(ae>0&&p.push(`${ae} hit ${ae===1?"die":"dice"}`),F.class){const at=oa(F.class,F.level,F.subclass);F.classFeatures.features||(F.classFeatures.features={}),at.forEach(Ie=>{if(Ie.resetOn==="short"){const bt=Ie.name.replace(/\s+/g,"");if(Ie.type==="uses"){const Je=typeof Ie.maxUses=="function"?Ie.maxUses(F.level):Ie.maxUses;F.classFeatures.features[bt]=Array(Je).fill(!1),p.push(Ie.name)}else if(Ie.type==="pool"){const Je=typeof Ie.maxPool=="function"?Ie.maxPool(F.level):Ie.maxPool;Je!==void 0&&(F.classFeatures.features[bt]=Je,p.push(Ie.name))}}})}return F}),o(Pe,!1);const U=p.length>0?`Short rest taken! Restored: ${p.join(", ")}`:"Short rest taken!";qt.add(U,"success")}function w(){const p=[];le.update(F=>{const xe=F.maxHP-F.currentHP;xe>0&&p.push(`${xe} HP`),F.currentHP=F.maxHP,F.tempHP=0;const ae=F.hitDice.max-F.hitDice.current;ae>0&&p.push(`${ae} hit ${ae===1?"die":"dice"}`),F.hitDice.current=F.hitDice.max;let at=0;if(F.classFeatures.spellSlotsByLevel&&Object.keys(F.classFeatures.spellSlotsByLevel).forEach(Ie=>{const bt=F.classFeatures.spellSlotsByLevel[parseInt(Ie)];if(bt){const Je=bt.filter(ot=>ot).length;at+=Je,F.classFeatures.spellSlotsByLevel[parseInt(Ie)]=Array(bt.length).fill(!1)}}),at>0&&p.push(`${at} spell ${at===1?"slot":"slots"}`),F.class){const Ie=oa(F.class,F.level,F.subclass);F.classFeatures.features||(F.classFeatures.features={});let bt=!1;Ie.forEach(Je=>{const ot=Je.name.replace(/\s+/g,"");if(!(Je.type==="info"||Je.type==="channelDivinity")){if(Je.type==="uses"){const rt=typeof Je.maxUses=="function"?Je.maxUses(F.level):Je.maxUses;F.classFeatures.features[ot]=Array(rt).fill(!1),bt=!0}else if(Je.type==="pool"){const rt=typeof Je.maxPool=="function"?Je.maxPool(F.level):Je.maxPool;rt!==void 0&&(F.classFeatures.features[ot]=rt,bt=!0)}}}),bt&&p.push("all class features")}return F}),o(Pe,!1);const U=p.length>0?`Long rest taken! Restored: ${p.join(", ")}`:"Long rest taken! Fully rested.";qt.add(U,"success")}function oe(p){o(V,""),o(Q,""),o(_e,""),o(pe,!1),o(G,[]),o(Ae,"other"),se=!1,typeof p=="string"?o(V,p):(o(V,p.notation),o(Q,p.damageNotation||""),o(_e,p.attackName||""),o(pe,!!p.applyHalfDamage),o(G,p.bonusBreakdown||[]),o(Ae,p.rollType||"other")),o(L,!0)}function f(p){const{notation:U,count:F,bonusBreakdown:xe}=p.detail;o(V,""),se=!0,We=F||1,setTimeout(()=>{o(V,U),o(Q,""),o(_e,"Hit Die"),o(G,xe||[]),o(Ae,"other")},0),o(L,!0)}function $(){if(o(L,!1),se&&e(Ke)){const p=e(Ke).getLastRollTotal();if(p!==null){const U=Math.max(1,p);le.update(F=>(F.hitDice.current=Math.max(0,F.hitDice.current-We),F.currentHP=Math.min(F.maxHP,F.currentHP+U),F))}se=!1}}function O(){Zt.update(p=>!p)}function Ce(p){p.target.closest(".rest-button-container")||o(Pe,!1)}pa(()=>{const p=Zt.subscribe(U=>{U?document.body.classList.remove("use-mode"):document.body.classList.add("use-mode")});return document.addEventListener("click",Ce),()=>{p(),document.removeEventListener("click",Ce)}});function Re(){_s(t())}function we(){e(ne)?.click()}async function h(p){const F=p.target.files?.[0];if(F)try{const xe=await ys(F);le.set(xe),alert("Character imported successfully!")}catch{alert("Failed to import character file")}}Rt();var P=$r();hs("1uha8ag",p=>{var U=pr();ra(2),Xa(()=>{gs.title="D&D Character Sheet"}),c(p,U)});var q=Ne(P),Y=i(q),z=i(Y),fe=i(z),De=i(fe),nt=s(i(De),2);{var be=p=>{var U=fr(),F=i(U);l(U),T(()=>D(F,`${t().name??""} (${t().level??""})`)),c(p,U)};y(nt,p=>{t().name&&p(be)})}l(De);var Ve=s(De,2);{var I=p=>{var U=br();kt(U,5,C,xt,(F,xe)=>{var ae=gr();let at;var Ie=i(ae);l(ae),T(()=>{at=yt(ae,1,"slot-badge svelte-1uha8ag",null,at,{depleted:e(xe).available===0}),D(Ie,`Lv${e(xe).level??""}: ${e(xe).available??""}/${e(xe).total??""}`)}),c(F,ae)}),l(U),c(p,U)};y(Ve,p=>{C().length>0&&p(I)})}var j=s(Ve,2);{var ie=p=>{var U=Sr(),F=Ne(U);kt(F,5,()=>t().activeStates,xt,(xe,ae,at)=>{var Ie=kr(),bt=i(Ie),Je=s(bt);{var ot=ht=>{var mt=_r(),Qe=i(mt),lt=i(Qe,!0);l(Qe);var pt=s(Qe,2),Ct=s(pt,3);{var Ut=wt=>{var Dt=hr(),Gt=Ne(Dt),gt=i(Gt);l(Gt),ra(),T(()=>D(gt,`Attack Bonus: ${typeof e(ae).attackBonus=="number"&&e(ae).attackBonus>0?"+":""}${e(ae).attackBonus??""}`)),c(wt,Dt)};y(Ct,wt=>{e(ae).attackBonus&&wt(Ut)})}var Nt=s(Ct,2);{var At=wt=>{var Dt=mr(),Gt=i(Dt);l(Dt),T(()=>D(Gt,`Damage Bonus: ${typeof e(ae).damageBonus=="number"&&e(ae).damageBonus>0?"+":""}${e(ae).damageBonus??""}`)),c(wt,Dt)};y(Nt,wt=>{e(ae).damageBonus&&wt(At)})}l(mt),T(()=>{D(lt,e(ae).name),D(pt,` ${e(ae).description??""}`)}),c(ht,mt)};y(Je,ht=>{e(te)===at&&ht(ot)})}var rt=s(Je,2);{var ct=ht=>{var mt=yr();T(()=>Ye(mt,"title",`End ${e(ae).name??""}`)),M("click",mt,()=>{le.update(Qe=>{if(Qe.activeStates){const lt=Qe.activeStates[at];lt?.hpBonus&&lt.target!=="other"&&(Qe.maxHP-=lt.hpBonus,Qe.currentHP=Math.max(1,Math.min(Qe.currentHP-lt.hpBonus,Qe.maxHP))),Qe.activeStates=Qe.activeStates.filter((pt,Ct)=>Ct!==at)}return Qe})}),c(ht,mt)};y(rt,ht=>{v()||ht(ct)})}l(Ie),T(()=>{Ye(Ie,"aria-label",e(ae).name),D(bt,`‚ú® ${e(ae).name??""} `)}),M("mouseenter",Ie,()=>ge(at)),M("mouseleave",Ie,Fe),M("focus",Ie,()=>ge(at)),M("blur",Ie,Fe),M("click",Ie,()=>Se(at)),c(xe,Ie)}),l(F),ra(2),c(p,U)};y(j,p=>{t().activeStates&&t().activeStates.length>0&&p(ie)})}l(fe);var ce=s(fe,2),K=i(ce),d=i(K),Ee=s(d,2),ve=i(Ee),de=s(ve,2);{var A=p=>{var U=xr(),F=i(U),xe=s(F,2);l(U),M("click",F,Le),M("click",xe,w),c(p,U)};y(de,p=>{e(Pe)&&p(A)})}l(Ee);var Me=s(Ee,2),Te=i(Me);let Ze;var it=i(Te),je=i(it,!0);l(it);var ye=s(it),Be=i(ye,!0);l(ye),l(Te),l(Me),l(K);var He=s(K,2),Ue=i(He);$e(Ue),l(He),l(ce),l(z);var Ge=s(z,2),X=i(Ge),ue=s(X,2),Oe=s(ue,2),et=s(Oe,2),ke=s(et,2),_=s(ke,2);ja(_,p=>o(ne,p),()=>e(ne)),l(Ge),l(Y);var N=s(Y,2),Z=i(N);Ps(Z,{});var J=s(Z,2);Us(J,{$$events:{roll:p=>oe(p.detail)}});var re=s(J,2);il(re,{$$events:{roll:p=>oe(p.detail)}});var b=s(re,2);tl(b,{$$events:{rollHitDice:f}});var k=s(b,2);Jl(k,{$$events:{roll:p=>oe(p.detail)}});var R=s(k,2);ui(R,{});var he=s(R,2);gi(he,{}),l(N),l(q);var me=s(q,2);ja(Bi(me,{get notation(){return e(V)},get damageNotation(){return e(Q)},get attackName(){return e(_e)},get applyHalfDamage(){return e(pe)},get bonusBreakdown(){return e(G)},get rollType(){return e(Ae)},get visible(){return e(L)},$$events:{close:$},$$legacy:!0}),p=>o(Ke,p),()=>e(Ke));var ze=s(me,2);{var E=p=>{Qi(p,{get mode(){return e(W)},$$events:{close:()=>o(x,!1)}})};y(ze,p=>{e(x)&&p(E)})}var tt=s(ze,2);{var ut=p=>{ur(p,{onClose:()=>o(ee,!1)})};y(tt,p=>{e(ee)&&p(ut)})}var ft=s(tt,2);ms(ft,{}),T(()=>{Ze=yt(Te,1,"btn btn-mode svelte-1uha8ag",null,Ze,{"use-mode":!v()}),D(je,v()?"üìù":"üé≤"),D(Be,v()?"Edit Mode":"Use Mode")}),M("click",d,()=>{o(G,[]),o(L,!0)}),M("click",ve,()=>o(Pe,!e(Pe))),M("click",Te,O),qe(Ue,u,p=>ks(ea,p)),M("click",X,()=>o(ee,!0)),M("click",ue,()=>{o(W,"save"),o(x,!0)}),M("click",Oe,()=>{o(W,"load"),o(x,!0)}),M("click",et,Re),M("click",ke,we),M("change",_,h),c(a,P),Ht(),S()}export{Mr as component};
