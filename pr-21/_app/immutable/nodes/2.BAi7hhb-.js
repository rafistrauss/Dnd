import{f,e as B,a as v,s as C,c as ut,t as Ft}from"../chunks/BLbP1Y8l.js";import{i as It}from"../chunks/-BDOS6cA.js";import{c as ia,o as ca,a as os,b as cs}from"../chunks/DJBW4-nh.js";import{a7 as Ra,i as Ya,aZ as vs,a_ as Xa,a$ as Da,K as Xt,e as Za,b0 as es,T as ba,b1 as ds,b2 as us,b3 as ps,q as Ma,b4 as fs,b5 as bs,ab as ms,d as n,r as Ia,g as hs,C as Et,F as M,G as Ht,H as i,I as l,J as s,b6 as Ye,b7 as Jt,s as o,a4 as j,f as e,m as pt,E as He,b8 as Ct,ao as la,A as H,b9 as sa,ba as ua,bb as gs}from"../chunks/CX8RFN-M.js";import{c as Tt,a as ee,e as yt,i as kt,u as ts,s as ea,b as xt,d as ma,f as Zt,g as _s,t as qt,h as ys,T as xs,j as ks,k as Ss}from"../chunks/DcmVR45b.js";import{i as _,s as Wt,a as st,b as _t,d as va,e as $s}from"../chunks/Bgm6_RFG.js";import{p as St,b as xa}from"../chunks/Zs0U3hKk.js";import{b as da,r as Cs}from"../chunks/CARIjUZE.js";function ka(a,r,t=!1){if(a.multiple){if(r==null)return;if(!Ya(r))return vs();for(var c of a.options)c.selected=r.includes(pa(c));return}for(c of a.options){var u=pa(c);if(Xa(u,r)){c.selected=!0;return}}(!t||r!==void 0)&&(a.selectedIndex=-1)}function Fa(a){var r=new MutationObserver(()=>{ka(a,a.__value)});r.observe(a,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Ra(()=>{r.disconnect()})}function Sa(a,r,t=r){var c=new WeakSet,u=!0;Da(a,"change",m=>{var y=m?"[selected]":":checked",$;if(a.multiple)$=[].map.call(a.querySelectorAll(y),pa);else{var w=a.querySelector(y)??a.querySelector("option:not([disabled])");$=w&&pa(w)}t($),Xt!==null&&c.add(Xt)}),Za(()=>{var m=r();if(a===document.activeElement){var y=es??Xt;if(c.has(y))return}if(ka(a,m,u),u&&m===void 0){var $=a.querySelector(":checked");$!==null&&(m=pa($),t(m))}a.__value=m,u=!1}),Fa(a)}function pa(a){return"__value"in a?a.__value:a.value}const Ds=Symbol("is custom element"),ws=Symbol("is html");function Le(a){if(ba){var r=!1,t=()=>{if(!r){if(r=!0,a.hasAttribute("value")){var c=a.value;tt(a,"value",null),a.value=c}if(a.hasAttribute("checked")){var u=a.checked;tt(a,"checked",null),a.checked=u}}};a.__on_r=t,Ma(t),fs()}}function fa(a,r){var t=Ea(a);t.value===(t.value=r??void 0)||a.value===r&&(r!==0||a.nodeName!=="PROGRESS")||(a.value=r??"")}function as(a,r){var t=Ea(a);t.checked!==(t.checked=r??void 0)&&(a.checked=r)}function tt(a,r,t,c){var u=Ea(a);ba&&(u[r]=a.getAttribute(r),r==="src"||r==="srcset"||r==="href"&&a.nodeName==="LINK")||u[r]!==(u[r]=t)&&(r==="loading"&&(a[ds]=t),t==null?a.removeAttribute(r):typeof t!="string"&&Ls(a).includes(r)?a[r]=t:a.setAttribute(r,t))}function Ea(a){return a.__attributes??={[Ds]:a.nodeName.includes("-"),[ws]:a.namespaceURI===us}}var Na=new Map;function Ls(a){var r=a.getAttribute("is")||a.nodeName,t=Na.get(r);if(t)return t;Na.set(r,t=[]);for(var c,u=a,m=Element.prototype;m!==u;){c=bs(u);for(var y in c)c[y].set&&t.push(y);u=ps(u)}return t}function Je(a,r,t=r){var c=new WeakSet;Da(a,"input",async u=>{var m=u?a.defaultValue:a.value;if(m=ja(a)?Aa(m):m,t(m),Xt!==null&&c.add(Xt),await ms(),m!==(m=r())){var y=a.selectionStart,$=a.selectionEnd,w=a.value.length;if(a.value=m??"",$!==null){var x=a.value.length;y===$&&$===w&&x>w?(a.selectionStart=x,a.selectionEnd=x):(a.selectionStart=y,a.selectionEnd=Math.min($,x))}}}),(ba&&a.defaultValue!==a.value||n(r)==null&&a.value)&&(t(ja(a)?Aa(a.value):a.value),Xt!==null&&c.add(Xt)),Ia(()=>{var u=r();if(a===document.activeElement){var m=es??Xt;if(c.has(m))return}ja(a)&&u===Aa(a.value)||a.type==="date"&&!u&&!a.value||u!==a.value&&(a.value=u??"")})}const La=new Set;function Ua(a,r,t,c,u=c){var m=t.getAttribute("type")==="checkbox",y=a;let $=!1;if(r!==null)for(var w of r)y=y[w]??=[];y.push(t),Da(t,"change",()=>{var x=t.__value;m&&(x=Ga(y,x,t.checked)),u(x)},()=>u(m?[]:null)),Ia(()=>{var x=c();if(ba&&t.defaultChecked!==t.checked){$=!0;return}m?(x=x||[],t.checked=x.includes(t.__value)):t.checked=Xa(t.__value,x)}),Ra(()=>{var x=y.indexOf(t);x!==-1&&y.splice(x,1)}),La.has(y)||(La.add(y),Ma(()=>{y.sort((x,ae)=>x.compareDocumentPosition(ae)===4?-1:1),La.delete(y)})),Ma(()=>{if($){var x;if(m)x=Ga(y,x,t.checked);else{var ae=y.find(J=>J.checked);x=ae?.__value}u(x)}})}function $a(a,r,t=r){Da(a,"change",c=>{var u=c?a.defaultChecked:a.checked;t(u)}),(ba&&a.defaultChecked!==a.checked||n(r)==null)&&t(a.checked),Ia(()=>{var c=r();a.checked=!!c})}function Ga(a,r,t){for(var c=new Set,u=0;u<a.length;u+=1)a[u].checked&&c.add(a[u].__value);return t||c.delete(r),Array.from(c)}function ja(a){var r=a.type;return r==="number"||r==="range"}function Aa(a){return a===""?null:+a}function js(a,r,t){var c=hs(a,r);c&&c.set&&(a[r]=t,Ra(()=>{a[r]=null}))}function Ha(a){return function(...r){var t=r[0];return t.stopPropagation(),a?.apply(this,r)}}function ra(a,r){var t=a.$$events?.[r.type],c=Ya(t)?t.slice():t==null?[]:[t];for(var u of c)u.call(this,r)}const As="";function ss(...a){return da+As+Cs(a[0],a[1])}const Ta={paladin:{name:"Paladin",hitDice:"d10",spellcaster:!0,spellcastingAbility:"charisma",spellSlotsByLevel:{1:0,2:2,3:3,4:3,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Divine Sense",type:"uses",maxUses:(a,r=1)=>1+Math.max(1,r),resetOn:"long",description:"Detect celestials, fiends, and undead within 60 feet",minLevel:1},{name:"Lay on Hands",type:"pool",maxPool:a=>a*5,resetOn:"long",description:"Heal wounds or cure disease",minLevel:1},{name:"Divine Smite",type:"spellSlot",description:"Expend spell slot to deal extra radiant damage",minLevel:2,rollable:!0},{name:"Channel Divinity",type:"pool",maxPool:a=>a>=18?3:a>=6?2:1,resetOn:"short",description:"Sacred Weapon or Turn Undead",minLevel:3}]},fighter:{name:"Fighter",hitDice:"d10",spellcaster:!1,features:[{name:"Second Wind",type:"uses",maxUses:1,resetOn:"short",description:"Regain 1d10 + fighter level HP as bonus action",minLevel:1,rollable:!0,rollFormula:a=>`1d10+${a}`},{name:"Action Surge",type:"uses",maxUses:a=>a>=17?2:1,resetOn:"short",description:"Take one additional action on your turn",minLevel:2},{name:"Indomitable",type:"uses",maxUses:a=>a>=17?3:a>=13?2:1,resetOn:"long",description:"Reroll a failed saving throw",minLevel:9}],subclasses:{champion:{name:"Champion",features:[{name:"Improved Critical",type:"info",description:"Critical hit on 19-20",minLevel:3},{name:"Remarkable Athlete",type:"info",description:"Add half proficiency to STR/DEX/CON checks, increase long jump distance",minLevel:7},{name:"Additional Fighting Style",type:"info",description:"Choose a second fighting style",minLevel:10},{name:"Superior Critical",type:"info",description:"Critical hit on 18-20",minLevel:15},{name:"Survivor",type:"info",description:"Regain 5 + CON mod HP at start of turn if below half HP",minLevel:18}]},battlemaster:{name:"Battle Master",features:[{name:"Combat Superiority",type:"uses",maxUses:a=>a>=15?6:a>=7?5:4,resetOn:"short",description:a=>`Use superiority dice (${a>=18?"d12":a>=10?"d10":"d8"}) for maneuvers`,minLevel:3},{name:"Know Your Enemy",type:"info",description:"Learn capabilities of creatures you observe",minLevel:7},{name:"Improved Combat Superiority",type:"info",description:"Superiority dice become d10",minLevel:10},{name:"Relentless",type:"info",description:"Regain 1 superiority die if you have none at start of turn",minLevel:15}]}}},rogue:{name:"Rogue",hitDice:"d8",spellcaster:!1,features:[{name:"Sneak Attack",type:"info",description:a=>`Deal ${Math.ceil(a/2)}d6 extra damage once per turn with advantage or ally nearby`,minLevel:1,rollable:!0,rollFormula:a=>`${Math.ceil(a/2)}d6`},{name:"Cunning Action",type:"info",description:"Dash, Disengage, or Hide as a bonus action",minLevel:2},{name:"Uncanny Dodge",type:"info",description:"Use reaction to halve damage from an attack",minLevel:5},{name:"Evasion",type:"info",description:"Take no damage on successful Dex save (half on fail)",minLevel:7}]},wizard:{name:"Wizard",hitDice:"d6",spellcaster:!0,spellcastingAbility:"intelligence",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Arcane Recovery",type:"uses",maxUses:1,resetOn:"long",description:a=>`Recover spell slots totaling up to ${Math.ceil(a/2)} levels during short rest`,minLevel:1},{name:"Spell Mastery",type:"info",description:"Cast one 1st-level and one 2nd-level spell at will",minLevel:18}]},cleric:{name:"Cleric",hitDice:"d8",spellcaster:!0,spellcastingAbility:"wisdom",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Channel Divinity",type:"pool",maxPool:a=>a>=18?3:a>=6?2:1,resetOn:"short",description:"Turn Undead or domain-specific ability",minLevel:2},{name:"Destroy Undead",type:"info",description:a=>`Channel Divinity destroys undead of CR ${a>=17?4:a>=14?3:a>=11?2:a>=8?1:.5} or lower`,minLevel:5},{name:"Divine Intervention",type:"uses",maxUses:1,resetOn:"long",description:a=>`${a}% chance to succeed, implore deity for aid`,minLevel:10}],subclasses:{war:{name:"War Domain",features:[{name:"War Priest",type:"uses",maxUses:(a,r=1)=>Math.max(1,r),resetOn:"long",description:"Make one weapon attack as a bonus action",minLevel:1},{name:"Guided Strike",type:"channelDivinity",description:"Use your Channel Divinity to gain +10 to an attack roll. Make this choice after you see the roll, but before the DM says whether the attack hits or misses.",minLevel:2,resetOn:"short"},{name:"War God's Blessing",type:"channelDivinity",description:"Use reaction to grant +10 to an ally's attack roll within 30 feet. Consumes one use of Channel Divinity.",minLevel:6,resetOn:"short"},{name:"Divine Strike",type:"info",description:a=>`Deal extra ${a>=14?"2d8":"1d8"} weapon damage once per turn`,minLevel:8,rollable:!0,rollFormula:a=>a>=14?"2d8":"1d8"},{name:"Avatar of Battle",type:"info",description:"Gain resistance to nonmagical weapon damage",minLevel:17}]},life:{name:"Life Domain",features:[{name:"Disciple of Life",type:"info",description:"Healing spells restore additional 2 + spell level HP",minLevel:1},{name:"Preserve Life",type:"pool",maxPool:a=>a*5,resetOn:"short",description:"Restore HP to creatures within 30 feet",minLevel:2},{name:"Blessed Healer",type:"info",description:"Regain 2 + spell level HP when you cast healing spell",minLevel:6},{name:"Divine Strike",type:"info",description:a=>`Deal extra ${a>=14?"2d8":"1d8"} radiant damage once per turn`,minLevel:8,rollable:!0,rollFormula:a=>a>=14?"2d8":"1d8"},{name:"Supreme Healing",type:"info",description:"Maximize healing dice instead of rolling",minLevel:17}]}}},barbarian:{name:"Barbarian",hitDice:"d12",spellcaster:!1,features:[{name:"Rage",type:"uses",maxUses:a=>a>=20?1/0:a>=17?6:a>=12?5:a>=6?4:a>=3?3:2,resetOn:"long",description:a=>`+${a>=16?4:a>=9?3:2} damage, resistance to physical damage`,minLevel:1},{name:"Reckless Attack",type:"info",description:"Gain advantage on melee attacks, enemies get advantage on you",minLevel:2},{name:"Danger Sense",type:"info",description:"Advantage on Dex saves against effects you can see",minLevel:2}],subclasses:{berserker:{name:"Path of the Berserker",features:[{name:"Frenzy",type:"info",description:"While raging, make melee attack as bonus action (gain 1 exhaustion after rage)",minLevel:3},{name:"Mindless Rage",type:"info",description:"Cannot be charmed or frightened while raging",minLevel:6},{name:"Intimidating Presence",type:"info",description:"Use action to frighten creature within 30 feet",minLevel:10},{name:"Retaliation",type:"info",description:"When damaged by creature within 5 feet, make melee attack as reaction",minLevel:14}]}}}};function Rt(a){const r=a.toLowerCase();return Ta[r]||null}function oa(a,r,t){const c=Rt(a);if(!c)return[];const u=c.features.filter(m=>!m.minLevel||m.minLevel<=r);if(t&&c.subclasses&&c.subclasses[t]){const m=c.subclasses[t].features.filter(y=>!y.minLevel||y.minLevel<=r);return[...u,...m]}return u}function Oa(a){const r=Rt(a);return!r||!r.subclasses?[]:Object.keys(r.subclasses).map(t=>({id:t,name:r.subclasses[t].name}))}function qa(a,r){const t=Rt(a);return!t||!t.spellcaster||!t.spellSlotsByLevel?0:t.spellSlotsByLevel[r]||0}function Wa(a,r,t){const c=Rt(a);return!c||!c.spellcaster?0:Math.max(1,t+r)}function Bs(a,r,t){const c=Rt(a);return!c||!c.spellcaster?null:8+r+t}function Ms(){return Object.keys(Ta).map(a=>({id:a,name:Ta[a].name}))}var Fs=f('<div class="section-header svelte-ls99y2" role="button" tabindex="0"><h2 class="svelte-ls99y2"> </h2> <span class="collapse-btn svelte-ls99y2"> </span></div>');function na(a,r){Et(r,!1);let t=St(r,"title",8),c=St(r,"collapsed",8),u=St(r,"ariaLabel",8,""),m=St(r,"onToggle",8);It();var y=Fs(),$=i(y),w=i($,!0);l($);var x=s($,2),ae=i(x,!0);l(x),l(y),M(()=>{tt(y,"aria-expanded",!c()),tt(y,"aria-label",u()),C(w,t()),C(ae,c()?"‚ñº":"‚ñ≤")}),B("click",y,function(...J){m()?.apply(this,J)}),B("keydown",y,J=>{(J.key==="Enter"||J.key===" ")&&m()()}),v(a,y),Ht()}var Ts=f("<option> </option>"),Ps=f("<option> </option>"),Rs=f('<div class="form-group svelte-172i2fj"><label for="characterSubclass" class="svelte-172i2fj">Subclass</label> <select id="characterSubclass" class="svelte-172i2fj"><option>Select Subclass</option><!></select></div>'),Is=f('<div class="info-grid svelte-172i2fj"><div class="form-group svelte-172i2fj"><label for="characterName" class="svelte-172i2fj">Character Name</label> <input type="text" id="characterName" placeholder="Enter name" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterClass" class="svelte-172i2fj">Class</label> <select id="characterClass" class="svelte-172i2fj"><option>Select Class</option><!></select></div> <!> <div class="form-group svelte-172i2fj"><label for="characterLevel" class="svelte-172i2fj">Level</label> <input type="number" id="characterLevel" min="1" max="20" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterRace" class="svelte-172i2fj">Race</label> <input type="text" id="characterRace" placeholder="e.g., Human" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterBackground" class="svelte-172i2fj">Background</label> <input type="text" id="characterBackground" placeholder="e.g., Soldier" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterAlignment" class="svelte-172i2fj">Alignment</label> <input type="text" id="characterAlignment" placeholder="e.g., Lawful Good" class="svelte-172i2fj"/></div></div>'),Es=f('<section class="character-info svelte-172i2fj"><!> <!></section>');function Hs(a,r){Et(r,!1);const t=()=>st(ee,"$character",u),c=()=>st(Tt,"$collapsedStates",u),[u,m]=Wt(),y=j(),$=Ms();function w(Se){const _e=Se.target;ee.update(O=>(O.class=_e.value,O.subclass="",O))}function x(Se){const _e=Se.target;ee.update(O=>(O.subclass=_e.value,O))}function ae(Se){const _e=Se.target;ee.update(O=>(O.level=parseInt(_e.value)||1,O)),ts()}Ye(()=>(t(),Oa),()=>{o(y,t().class?Oa(t().class):[])}),Jt(),It();var J=Es(),ue=i(J);{let Se=pt(()=>(c(),n(()=>c().characterInfo?"Expand":"Collapse")));na(ue,{title:"Character Info",get collapsed(){return c(),n(()=>c().characterInfo)},get ariaLabel(){return e(Se)},onToggle:()=>Tt.update(_e=>({..._e,characterInfo:!_e.characterInfo}))})}var Y=s(ue,2);{var te=Se=>{var _e=Is(),O=i(_e),je=s(i(O),2);Le(je),l(O);var We=s(O,2),se=s(i(We),2),Ge=i(se);Ge.value=Ge.__value="";var Oe=s(Ge);yt(Oe,1,()=>$,kt,(oe,ye)=>{var b=Ts(),F=i(b,!0);l(b);var q={};M(()=>{C(F,(e(ye),n(()=>e(ye).name))),q!==(q=(e(ye),n(()=>e(ye).id)))&&(b.value=(b.__value=(e(ye),n(()=>e(ye).id)))??"")}),v(oe,b)}),l(se);var ne;Fa(se),l(We);var xe=s(We,2);{var Fe=oe=>{var ye=Rs(),b=s(i(ye),2),F=i(b);F.value=F.__value="";var q=s(F);yt(q,1,()=>e(y),kt,(z,le)=>{var we=Ps(),vt=i(we,!0);l(we);var ke={};M(()=>{C(vt,(e(le),n(()=>e(le).name))),ke!==(ke=(e(le),n(()=>e(le).id)))&&(we.value=(we.__value=(e(le),n(()=>e(le).id)))??"")}),v(z,we)}),l(b);var Z;Fa(b),l(ye),M(()=>{Z!==(Z=(t(),n(()=>t().subclass)))&&(b.value=(b.__value=(t(),n(()=>t().subclass)))??"",ka(b,(t(),n(()=>t().subclass))))}),B("change",b,x),v(oe,ye)};_(xe,oe=>{e(y),n(()=>e(y).length>0)&&oe(Fe)})}var De=s(xe,2),Te=s(i(De),2);Le(Te),l(De);var k=s(De,2),de=s(i(k),2);Le(de),l(k);var h=s(k,2),R=s(i(h),2);Le(R),l(h);var re=s(h,2),U=s(i(re),2);Le(U),l(re),l(_e),M(()=>{ne!==(ne=(t(),n(()=>t().class)))&&(se.value=(se.__value=(t(),n(()=>t().class)))??"",ka(se,(t(),n(()=>t().class)))),fa(Te,(t(),n(()=>t().level)))}),Je(je,()=>t().name,oe=>_t(ee,n(t).name=oe,n(t))),B("change",se,w),B("change",Te,ae),Je(de,()=>t().race,oe=>_t(ee,n(t).race=oe,n(t))),Je(R,()=>t().background,oe=>_t(ee,n(t).background=oe,n(t))),Je(U,()=>t().alignment,oe=>_t(ee,n(t).alignment=oe,n(t))),v(Se,_e)};_(Y,Se=>{c(),n(()=>!c().characterInfo)&&Se(te)})}l(J),v(a,J),Ht(),m()}var Ns=f('<div class="ability-card svelte-bbv1xt"><h3 class="svelte-bbv1xt"> </h3> <input type="number" class="ability-score svelte-bbv1xt" min="1" max="30"/> <div class="ability-modifier svelte-bbv1xt"> </div> <div class="roll-buttons svelte-bbv1xt"><button class="roll-btn svelte-bbv1xt">Check</button> <button class="roll-btn svelte-bbv1xt">Save</button></div> <div class="save-proficiency svelte-bbv1xt"><input type="checkbox" class="svelte-bbv1xt"/> <label class="svelte-bbv1xt">Save Prof.</label></div></div>'),Us=f('<div class="proficiency-bonus svelte-bbv1xt"><label for="profBonus">Proficiency Bonus</label> <input type="number" id="profBonus" class="prof-input svelte-bbv1xt"/></div> <div class="abilities-grid svelte-bbv1xt"></div>',1),Gs=f("<section><!> <!></section>");function Os(a,r){Et(r,!1);const t=()=>st(ma,"$abilityModifiers",$),c=()=>st(ee,"$character",$),u=()=>st(ea,"$searchFilter",$),m=()=>st(Tt,"$collapsedStates",$),y=()=>st(Zt,"$isEditMode",$),[$,w]=Wt(),x=j(),ae=j(),J=ia(),ue=[{key:"strength",label:"Strength"},{key:"dexterity",label:"Dexterity"},{key:"constitution",label:"Constitution"},{key:"intelligence",label:"Intelligence"},{key:"wisdom",label:"Wisdom"},{key:"charisma",label:"Charisma"}];function Y(){ts()}function te(Ge){const Oe=t()[Ge],ne=`1d20${Oe>=0?"+":""}${Oe}`,xe=[];xe.push({value:"1d20",source:"base die"}),Oe!==0&&xe.push({value:Oe,source:Ge}),J("roll",{notation:ne,rollType:"check",bonusBreakdown:xe})}function Se(Ge){const Oe=t()[Ge],ne=c().saveProficiencies[Ge]?c().proficiencyBonus:0,xe=Oe+ne,Fe=`1d20${xe>=0?"+":""}${xe}`,De=[];De.push({value:"1d20",source:"base die"}),Oe!==0&&De.push({value:Oe,source:Ge}),ne!==0&&De.push({value:ne,source:"proficiency"}),J("roll",{notation:Fe,rollType:"save",bonusBreakdown:De})}Ye(()=>u(),()=>{o(x,ue.filter(({label:Ge})=>u()?Ge.toLowerCase().includes(u().toLowerCase()):!0))}),Ye(()=>(e(x),u()),()=>{o(ae,e(x).length>0||!u()||u().toLowerCase().includes("proficiency"))}),Jt(),It();var _e=Gs();let O;var je=i(_e);na(je,{title:"Ability Scores",get collapsed(){return m(),n(()=>m().abilityScores)},ariaLabel:"Toggle Ability Scores Section",onToggle:()=>Tt.update(Ge=>({...Ge,abilityScores:!Ge.abilityScores}))});var We=s(je,2);{var se=Ge=>{var Oe=Us(),ne=He(Oe),xe=s(i(ne),2);Le(xe),l(ne);var Fe=s(ne,2);yt(Fe,5,()=>e(x),kt,(De,Te)=>{let k=()=>e(Te).key,de=()=>e(Te).label;var h=Ns(),R=i(h),re=i(R,!0);l(R);var U=s(R,2);Le(U);var oe=s(U,2),ye=i(oe);l(oe);var b=s(oe,2),F=i(b),q=s(F,2);l(b);var Z=s(b,2),z=i(Z);Le(z);var le=s(z,2);l(Z),l(h),M(we=>{C(re,we),C(ye,`${t(),k(),n(()=>t()[k()]>=0?"+":"")??""}${t(),k(),n(()=>t()[k()])??""}`),z.disabled=!y(),tt(z,"id",`${k()}-save`),tt(le,"for",`${k()}-save`)},[()=>(de(),n(()=>de().substring(0,3).toUpperCase()))]),Je(U,()=>c().abilities[k()],we=>_t(ee,n(c).abilities[k()]=we,n(c))),B("change",U,Y),B("click",F,()=>te(k())),B("click",q,()=>Se(k())),$a(z,()=>c().saveProficiencies[k()],we=>_t(ee,n(c).saveProficiencies[k()]=we,n(c))),v(De,h)}),l(Fe),Je(xe,()=>c().proficiencyBonus,De=>_t(ee,n(c).proficiencyBonus=De,n(c))),v(Ge,Oe)};_(We,Ge=>{m(),n(()=>!m().abilityScores)&&Ge(se)})}l(_e),M(()=>O=xt(_e,1,"ability-scores svelte-bbv1xt",null,O,{hidden:!e(ae)})),v(a,_e),Ht(),w()}const ls=[{name:"Unarmored",type:"none",baseAC:10},{name:"Padded",type:"light",baseAC:11},{name:"Leather",type:"light",baseAC:11},{name:"Studded Leather",type:"light",baseAC:12},{name:"Hide",type:"medium",baseAC:12,maxDexBonus:2},{name:"Chain Shirt",type:"medium",baseAC:13,maxDexBonus:2},{name:"Scale Mail",type:"medium",baseAC:14,maxDexBonus:2},{name:"Breastplate",type:"medium",baseAC:14,maxDexBonus:2},{name:"Half Plate",type:"medium",baseAC:15,maxDexBonus:2},{name:"Ring Mail",type:"heavy",baseAC:14,maxDexBonus:0},{name:"Chain Mail",type:"heavy",baseAC:16,maxDexBonus:0},{name:"Splint",type:"heavy",baseAC:17,maxDexBonus:0},{name:"Plate",type:"heavy",baseAC:18,maxDexBonus:0}];function is(a){return ls.find(r=>r.name===a)}function qs(a,r,t){if(!a)return 10+r+(t?2:0);const c=is(a);if(!c)return 10+r+(t?2:0);let u=c.baseAC;return c.maxDexBonus===void 0?u+=r:c.maxDexBonus>0&&(u+=Math.min(r,c.maxDexBonus)),t&&(u+=2),u}function Ca(a){return Math.floor((a-10)/2)}function Pa(a,r){if(!a.class)return null;const t=Rt(a.class);if(!t||!t.spellcaster||!t.spellcastingAbility)return null;const c=r[t.spellcastingAbility];return 8+a.proficiencyBonus+c}function za(a,r){if(!a.class)return 0;const t=Rt(a.class);return!t||!t.spellcaster||!t.spellcastingAbility?0:r[t.spellcastingAbility]}function Ws(a,r){const t=[],c=Ca(r.dexterity),u=a.armorName?is(a.armorName):void 0;if(u){if(u.type==="none")t.push("Unarmored"),t.push("Base: 10"),t.push(`Dexterity: ${c>=0?"+":""}${c}`);else if(u.type==="light")t.push(`${u.name}: ${u.baseAC}`),t.push(`Dexterity: ${c>=0?"+":""}${c}`);else if(u.type==="medium"){const m=Math.min(2,c);t.push(`${u.name}: ${u.baseAC}`),t.push(`Dexterity: ${m>=0?"+":""}${m} (max +2)`)}else u.type==="heavy"&&(t.push(`${u.name}: ${u.baseAC}`),t.push("Dexterity: +0 (heavy armor)"));a.shieldEquipped&&t.push("Shield: +2")}else{t.push("Base: 10"),c!==0&&t.push(`Dexterity: ${c>=0?"+":""}${c}`);const m=10+c,y=a.armorClass-m;y!==0&&t.push(`Other: ${y>=0?"+":""}${y}`)}return t.join(`
`)}function zs(a,r){const t=[],c=Ca(r.dexterity);t.push(`Dexterity: ${c>=0?"+":""}${c}`);const u=a.initiative-c;return u!==0&&t.push(`Other Bonuses: ${u>=0?"+":""}${u}`),t.join(`
`)}function Ks(a,r){if(!a.class)return"";const t=Rt(a.class);if(!t||!t.spellcaster||!t.spellcastingAbility)return"";const c=[],u=r[t.spellcastingAbility],m=t.spellcastingAbility.charAt(0).toUpperCase()+t.spellcastingAbility.slice(1);return c.push("Base: 8"),c.push(`Proficiency: +${a.proficiencyBonus}`),c.push(`${m}: ${u>=0?"+":""}${u}`),c.join(`
`)}var Vs=f("<option> </option>"),Js=f('<div class="armor-config svelte-1r5hyyb"><h4 class="svelte-1r5hyyb">Armor Configuration</h4> <div class="armor-controls svelte-1r5hyyb"><div class="armor-field svelte-1r5hyyb"><label for="armorName" class="svelte-1r5hyyb">Armor</label> <select id="armorName" class="armor-select svelte-1r5hyyb"><option>None (Unarmored)</option><!></select></div> <div class="armor-field svelte-1r5hyyb"><label class="shield-label svelte-1r5hyyb"><input type="checkbox" class="shield-checkbox svelte-1r5hyyb"/> Shield Equipped (+2 AC)</label></div></div></div>'),Qs=f('<div> </div> <div style="margin-top: 5px;"> </div>',1),Ys=f("<div> </div>"),Xs=f('<div class="tooltip-popup svelte-1r5hyyb"><!></div>'),Zs=f('<div class="tooltip-popup svelte-1r5hyyb"> </div>'),el=f('<div class="tooltip-popup svelte-1r5hyyb"> </div>'),tl=f('<div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="spellSaveDC" class="svelte-1r5hyyb">Spell Save DC</label> <button class="info-icon svelte-1r5hyyb" aria-label="Show Spell Save DC breakdown" type="button">‚ÑπÔ∏è</button></div> <input type="number" id="spellSaveDC" class="stat-input svelte-1r5hyyb" readonly=""/> <!></div>'),al=f('<span class="hit-dice-type"> </span>'),sl=f('<!> <div class="stats-grid svelte-1r5hyyb"><div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="armorClass" class="svelte-1r5hyyb">Armor Class</label> <button class="info-icon svelte-1r5hyyb" aria-label="Show AC breakdown" type="button">‚ÑπÔ∏è</button></div> <input type="text" id="armorClass" readonly=""/> <!></div> <div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="initiative" class="svelte-1r5hyyb">Initiative</label> <button class="info-icon svelte-1r5hyyb" aria-label="Show Initiative breakdown" type="button">‚ÑπÔ∏è</button></div> <input type="text" id="initiative" class="stat-input svelte-1r5hyyb" readonly=""/> <!></div> <div class="stat-box svelte-1r5hyyb"><label for="speed" class="svelte-1r5hyyb">Speed</label> <input type="text" id="speed" class="stat-input svelte-1r5hyyb"/></div> <!></div> <div class="hp-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Points</h3> <div><div class="hp-inputs svelte-1r5hyyb"><input type="number" class="hp-current svelte-1r5hyyb" min="0"/> <span class="hp-separator svelte-1r5hyyb">/</span> <input type="number" class="hp-max svelte-1r5hyyb" min="0"/></div> <div class="hp-controls svelte-1r5hyyb"><button class="hp-btn svelte-1r5hyyb">‚àí</button> <button class="hp-btn svelte-1r5hyyb">+</button> <button class="hp-btn svelte-1r5hyyb">‚àí5</button> <button class="hp-btn svelte-1r5hyyb">+5</button></div></div> <div class="temp-hp svelte-1r5hyyb"><label for="tempHP" class="svelte-1r5hyyb">Temp HP</label> <input type="number" id="tempHP" min="0" class="svelte-1r5hyyb"/></div></div> <div class="hit-dice-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Dice</h3> <div class="hit-dice-display svelte-1r5hyyb"><input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <span>/</span> <input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <!></div> <div class="hit-dice-controls svelte-1r5hyyb"><label for="hitDiceCount" class="svelte-1r5hyyb">Roll</label> <div class="hit-dice-count-controls svelte-1r5hyyb"><button class="hit-dice-btn svelte-1r5hyyb">‚àí</button> <input type="number" id="hitDiceCount" class="hit-dice-count-input svelte-1r5hyyb" min="1"/> <button class="hit-dice-btn svelte-1r5hyyb">+</button></div> <button class="btn btn-primary roll-hit-dice use-enabled svelte-1r5hyyb">üé≤ Roll</button></div></div>',1),ll=f("<section><!> <!></section>");function il(a,r){Et(r,!1);const t=()=>st(ee,"$character",$),c=()=>st(ma,"$abilityModifiers",$),u=()=>st(ea,"$searchFilter",$),m=()=>st(Tt,"$collapsedStates",$),y=()=>st(Zt,"$isEditMode",$),[$,w]=Wt(),x=j(),ae=j(),J=j(),ue=j(),Y=j(),te=j(),Se=j(),_e=ia();let O=j(1),je=j(!1),We=j(!1),se=j(!1),Ge=j();function Oe(U){U==="ac"?(o(je,!e(je)),o(We,!1),o(se,!1)):U==="initiative"?(o(We,!e(We)),o(je,!1),o(se,!1)):(o(se,!e(se)),o(je,!1),o(We,!1))}function ne(){o(je,!1),o(We,!1),o(se,!1)}function xe(U){e(Ge)&&!e(Ge).contains(U.target)&&ne()}ca(()=>{document.addEventListener("click",xe)}),os(()=>{document.removeEventListener("click",xe)});function Fe(U){ee.update(oe=>(oe.currentHP=Math.max(0,Math.min(oe.maxHP,oe.currentHP+U)),oe))}function De(U){const oe=e(O)+U,ye=t().hitDice.current;o(O,Math.max(1,Math.min(ye,oe)))}function Te(U=1){if(t().hitDice.current<=0){alert("No hit dice remaining!");return}if(!t().class){alert("Please select a class first!");return}const oe=Rt(t().class);if(!oe){alert("Invalid class configuration!");return}const ye=Math.min(U,t().hitDice.current),b=oe.hitDice,F=c().constitution,q=F*ye,Z=q>=0?`+${q}`:`${q}`,z=`${ye}${b}${Z}`,le=[];if(le.push({value:`${ye}${b}`,source:"hit dice"}),F!==0)for(let we=0;we<ye;we++)le.push({value:F,source:"constitution"});_e("rollHitDice",{notation:z,hitDie:b,count:ye,bonusBreakdown:le})}Ye(()=>(t(),c(),ee),()=>{if(t().armorName!==void 0||t().shieldEquipped!==void 0){const U=Ca(c().dexterity),oe=qs(t().armorName,U,t().shieldEquipped||!1);t().armorClass!==oe&&ee.update(ye=>({...ye,armorClass:oe}))}}),Ye(()=>(c(),t(),ee),()=>{const U=Ca(c().dexterity);t().initiative!==U&&ee.update(oe=>({...oe,initiative:U}))}),Ye(()=>(t(),c()),()=>{o(x,Pa(t(),c()))}),Ye(()=>(t(),c()),()=>{o(ae,Ws(t(),c()))}),Ye(()=>(t(),c()),()=>{o(J,zs(t(),c()))}),Ye(()=>(t(),c()),()=>{o(ue,Ks(t(),c()))}),Ye(()=>(t(),e(O)),()=>{const U=t().hitDice.current;U>0&&e(O)>U&&o(O,U)}),Ye(()=>t(),()=>{o(Y,t().activeStates&&t().activeStates.length>0?t().activeStates.reduce((U,oe)=>U+(oe.acBonus||0),0):0)}),Ye(()=>t(),()=>{o(te,t().activeStates&&t().activeStates.length>0?t().activeStates.some(U=>U.name==="Aid"&&U.target==="self"):!1)}),Ye(()=>u(),()=>{o(Se,!u()||"armor class".includes(u().toLowerCase())||"initiative".includes(u().toLowerCase())||"speed".includes(u().toLowerCase())||"hit points".includes(u().toLowerCase())||"hp".includes(u().toLowerCase())||"hit dice".includes(u().toLowerCase())||"spell save".includes(u().toLowerCase())||"combat".includes(u().toLowerCase()))}),Jt(),It();var k=ll();let de;var h=i(k);{let U=pt(()=>(m(),n(()=>m().combatStats?"Expand":"Collapse")));na(h,{title:"Combat Stats",get collapsed(){return m(),n(()=>m().combatStats)},get ariaLabel(){return e(U)},onToggle:()=>Tt.update(oe=>({...oe,combatStats:!oe.combatStats}))})}var R=s(h,2);{var re=U=>{var oe=sl(),ye=He(oe);{var b=E=>{var Q=Js(),Ie=s(i(Q),2),N=i(Ie),at=s(i(N),2);M(()=>{t(),Ct(()=>{})});var lt=i(at);lt.value=(lt.__value=void 0)??"";var it=s(lt);yt(it,1,()=>ls,kt,(me,W)=>{var Ze=ut(),Me=He(Ze);{var ft=Ue=>{var nt=Vs(),rt=i(nt);l(nt);var dt={};M(()=>{C(rt,`${e(W),n(()=>e(W).name)??""} (AC ${e(W),n(()=>e(W).baseAC)??""})`),dt!==(dt=(e(W),n(()=>e(W).name)))&&(nt.value=(nt.__value=(e(W),n(()=>e(W).name)))??"")}),v(Ue,nt)};_(Me,Ue=>{e(W),n(()=>e(W).name!=="Unarmored")&&Ue(ft)})}v(me,Ze)}),l(at),l(N);var p=s(N,2),P=i(p),S=i(P);Le(S),la(),l(P),l(p),l(Ie),l(Q),Sa(at,()=>t().armorName,me=>_t(ee,n(t).armorName=me,n(t))),$a(S,()=>t().shieldEquipped,me=>_t(ee,n(t).shieldEquipped=me,n(t))),v(E,Q)};_(ye,E=>{y()&&E(b)})}var F=s(ye,2),q=i(F),Z=i(q),z=s(i(Z),2);l(Z);var le=s(Z,2);Le(le);var we=s(le,2);{var vt=E=>{var Q=Xs(),Ie=i(Q);{var N=lt=>{var it=Qs(),p=He(it),P=i(p,!0);l(p);var S=s(p,2),me=i(S);l(S),M(()=>{C(P,e(ae)),C(me,`Active Effects: +${e(Y)??""}`)}),v(lt,it)},at=lt=>{var it=Ys(),p=i(it,!0);l(it),M(()=>C(p,e(ae))),v(lt,it)};_(Ie,lt=>{e(Y)!==0?lt(N):lt(at,!1)})}l(Q),v(E,Q)};_(we,E=>{e(je)&&E(vt)})}l(q);var ke=s(q,2),ze=i(ke),T=s(i(ze),2);l(ze);var L=s(ze,2);Le(L);var pe=s(L,2);{var fe=E=>{var Q=Zs(),Ie=i(Q,!0);l(Q),M(()=>C(Ie,e(J))),v(E,Q)};_(pe,E=>{e(We)&&E(fe)})}l(ke);var V=s(ke,2),d=s(i(V),2);Le(d),l(V);var Ve=s(V,2);{var he=E=>{var Q=tl(),Ie=i(Q),N=s(i(Ie),2);l(Ie);var at=s(Ie,2);Le(at);var lt=s(at,2);{var it=p=>{var P=el(),S=i(P,!0);l(P),M(()=>C(S,e(ue))),v(p,P)};_(lt,p=>{e(se)&&p(it)})}l(Q),M(()=>fa(at,e(x))),B("click",N,()=>Oe("spellSaveDC")),v(E,Q)};_(Ve,E=>{e(x)!==null&&E(he)})}l(F);var be=s(F,2),A=s(i(be),2);let Pe;var Re=i(A),Xe=i(Re);Le(Xe);var ct=s(Xe,4);Le(ct),l(Re);var Ae=s(Re,2),$e=i(Ae),Be=s($e,2),Ne=s(Be,2),qe=s(Ne,2);l(Ae),l(A);var Ke=s(A,2),ie=s(i(Ke),2);Le(ie),l(Ke),l(be);var ge=s(be,2),Ee=s(i(ge),2),Qe=i(Ee);Le(Qe);var Ce=s(Qe,4);Le(Ce);var g=s(Ce,2);{var G=E=>{const Q=pt(()=>(H(Rt),t(),n(()=>Rt(t().class))));var Ie=ut(),N=He(Ie);{var at=lt=>{const it=pt(()=>(c(),n(()=>c().constitution)));var p=al(),P=i(p);l(p),M(()=>C(P,`(${H(e(Q)),n(()=>e(Q).hitDice)??""}${(e(it)>=0?`+${e(it)}`:e(it))??""})`)),v(lt,p)};_(N,lt=>{e(Q)&&lt(at)})}v(E,Ie)};_(g,E=>{t(),n(()=>t().class)&&E(G)})}l(Ee);var ce=s(Ee,2),X=s(i(ce),2),ve=i(X),D=s(ve,2);Le(D);var I=s(D,2);l(X);var K=s(X,2);l(ce),l(ge),M(()=>{fa(le,(e(Y),t(),n(()=>e(Y)!==0?`${t().armorClass} ‚Üí ${t().armorClass+e(Y)}`:`${t().armorClass}`))),xt(le,1,_s(e(Y)!==0?"stat-input ac-enhanced":"stat-input"),"svelte-1r5hyyb"),fa(L,(t(),n(()=>t().initiative))),Pe=xt(A,1,"hp-display svelte-1r5hyyb",null,Pe,{"aid-active":e(te)}),tt(Xe,"max",(t(),n(()=>t().maxHP))),tt(Qe,"max",(t(),n(()=>t().hitDice.max))),ve.disabled=e(O)<=1,tt(D,"max",(t(),n(()=>t().hitDice.current))),I.disabled=(e(O),t(),n(()=>e(O)>=t().hitDice.current)),K.disabled=(t(),n(()=>t().hitDice.current<=0||!t().class))}),B("click",z,()=>Oe("ac")),B("click",T,()=>Oe("initiative")),Je(d,()=>t().speed,E=>_t(ee,n(t).speed=E,n(t))),Je(Xe,()=>t().currentHP,E=>_t(ee,n(t).currentHP=E,n(t))),Je(ct,()=>t().maxHP,E=>_t(ee,n(t).maxHP=E,n(t))),B("click",$e,()=>Fe(-1)),B("click",Be,()=>Fe(1)),B("click",Ne,()=>Fe(-5)),B("click",qe,()=>Fe(5)),Je(ie,()=>t().tempHP,E=>_t(ee,n(t).tempHP=E,n(t))),Je(Qe,()=>t().hitDice.current,E=>_t(ee,n(t).hitDice.current=E,n(t))),Je(Ce,()=>t().hitDice.max,E=>_t(ee,n(t).hitDice.max=E,n(t))),B("click",ve,()=>De(-1)),Je(D,()=>e(O),E=>o(O,E)),B("input",D,E=>{const Q=E.target,Ie=parseInt(Q.value);Ie>t().hitDice.current&&o(O,t().hitDice.current),Ie<1&&o(O,1)}),B("click",I,()=>De(1)),B("click",K,()=>Te(e(O))),v(U,oe)};_(R,U=>{m(),n(()=>!m().combatStats)&&U(re)})}l(k),xa(k,U=>o(Ge,U),()=>e(Ge)),M(()=>de=xt(k,1,"combat-stats svelte-1r5hyyb",null,de,{hidden:!e(Se)})),v(a,k),Ht(),w()}const ha={acrobatics:"dexterity",animalHandling:"wisdom",arcana:"intelligence",athletics:"strength",deception:"charisma",history:"intelligence",insight:"wisdom",intimidation:"charisma",investigation:"intelligence",medicine:"wisdom",nature:"intelligence",perception:"wisdom",performance:"charisma",persuasion:"charisma",religion:"intelligence",sleightOfHand:"dexterity",stealth:"dexterity",survival:"wisdom"};var nl=f('<div class="skill-row svelte-1f1pl16"><input type="checkbox" class="svelte-1f1pl16"/> <label class="svelte-1f1pl16"> <span class="ability-tag svelte-1f1pl16"> </span></label> <span class="skill-modifier svelte-1f1pl16"> </span> <button class="roll-btn svelte-1f1pl16">Roll</button></div>'),rl=f('<div class="skills-grid svelte-1f1pl16"></div>'),ol=f("<section><!> <!></section>");function cl(a,r){Et(r,!1);const t=()=>st(ee,"$character",$),c=()=>st(ma,"$abilityModifiers",$),u=()=>st(ea,"$searchFilter",$),m=()=>st(Tt,"$collapsedStates",$),y=()=>st(Zt,"$isEditMode",$),[$,w]=Wt(),x=j(),ae=j(),J=j(),ue=j(),Y=j(),te=j(),Se=ia(),_e=[{key:"acrobatics",label:"Acrobatics"},{key:"animalHandling",label:"Animal Handling"},{key:"arcana",label:"Arcana"},{key:"athletics",label:"Athletics"},{key:"deception",label:"Deception"},{key:"history",label:"History"},{key:"insight",label:"Insight"},{key:"intimidation",label:"Intimidation"},{key:"investigation",label:"Investigation"},{key:"medicine",label:"Medicine"},{key:"nature",label:"Nature"},{key:"perception",label:"Perception"},{key:"performance",label:"Performance"},{key:"persuasion",label:"Persuasion"},{key:"religion",label:"Religion"},{key:"sleightOfHand",label:"Sleight of Hand"},{key:"stealth",label:"Stealth"},{key:"survival",label:"Survival"}];function O(ne){const xe=ha[ne],Fe=c()[xe],De=t().skillProficiencies[ne]?t().proficiencyBonus:0,Te=e(x)[ne],k=`1d20${Te>=0?"+":""}${Te}`,de=[];de.push({value:"1d20",source:"base die"}),Fe!==0&&de.push({value:Fe,source:xe}),De!==0&&de.push({value:De,source:"proficiency"}),Se("roll",{notation:k,rollType:"check",bonusBreakdown:de})}Ye(()=>{},()=>{o(x,{})}),Ye(()=>t(),()=>{o(ae,t().skillProficiencies)}),Ye(()=>t(),()=>{o(J,t().proficiencyBonus)}),Ye(()=>c(),()=>{o(ue,c())}),Ye(()=>(e(ue),e(ae),e(J)),()=>{for(const{key:ne}of _e){const xe=ha[ne],Fe=e(ue)[xe],De=e(ae)[ne]?e(J):0;sa(x,e(x)[ne]=Fe+De)}}),Ye(()=>u(),()=>{o(Y,_e.filter(({label:ne})=>u()?ne.toLowerCase().includes(u().toLowerCase()):!0))}),Ye(()=>e(Y),()=>{o(te,e(Y).length>0)}),Jt(),It();var je=ol();let We;var se=i(je);{let ne=pt(()=>(m(),n(()=>m().skills?"Expand":"Collapse")));na(se,{title:"Skills",get collapsed(){return m(),n(()=>m().skills)},get ariaLabel(){return e(ne)},onToggle:()=>Tt.update(xe=>({...xe,skills:!xe.skills}))})}var Ge=s(se,2);{var Oe=ne=>{var xe=rl();yt(xe,5,()=>e(Y),kt,(Fe,De)=>{let Te=()=>e(De).key,k=()=>e(De).label;var de=nl(),h=i(de);Le(h);var R=s(h,2),re=i(R),U=s(re),oe=i(U);l(U),l(R);var ye=s(R,2),b=i(ye);l(ye);var F=s(ye,2);l(de),M(q=>{as(h,(e(ae),Te(),n(()=>e(ae)[Te()]))),h.disabled=!y(),tt(h,"id",Te()),tt(R,"for",Te()),C(re,`${k()??""} `),C(oe,`(${q??""})`),C(b,`${e(x),Te(),n(()=>e(x)[Te()]>=0?"+":"")??""}${e(x),Te(),n(()=>e(x)[Te()])??""}`)},[()=>(H(ha),Te(),n(()=>ha[Te()].substring(0,3).toUpperCase()))]),B("change",h,q=>{console.log("Skill proficiency changed:",Te(),q.target.checked),ee.update(Z=>({...Z,skillProficiencies:{...Z.skillProficiencies,[Te()]:q.target.checked}}))}),B("click",F,()=>O(Te())),v(Fe,de)}),l(xe),v(ne,xe)};_(Ge,ne=>{m(),n(()=>!m().skills)&&ne(Oe)})}l(je),M(()=>We=xt(je,1,"skills svelte-1f1pl16",null,We,{hidden:!e(te)})),v(a,je),Ht(),w()}let ga=null,_a=null;async function ns(){if(ga)return ga;try{return ga=await(await fetch(ss("/data/spells.json"))).json(),ga||[]}catch(a){return console.error("Failed to load spells:",a),[]}}async function vl(){if(_a)return _a;try{return _a=await(await fetch(ss("/data/feats.json"))).json(),_a||[]}catch(a){return console.error("Failed to load feats:",a),[]}}function Ka(a,r){if(!r.trim())return a;const t=r.toLowerCase();return a.filter(c=>c.name.toLowerCase().includes(t)||c.school.toLowerCase().includes(t)||c.classes.some(u=>u.toLowerCase().includes(t))||c.description.toLowerCase().includes(t))}function dl(a,r){return r===null?a:a.filter(t=>t.level===r)}function ul(a,r){if(!r.trim())return a;const t=r.toLowerCase();return a.filter(c=>c.name.toLowerCase().includes(t)||c.description.toLowerCase().includes(t))}function ya(a){const r=a.description,t=/\b(Strength|Dexterity|Constitution|Intelligence|Wisdom|Charisma)\s+saving\s+throw/i,c=r.match(t);if(!c)return null;const u=c[1].toLowerCase(),y=/half\s+(?:as\s+much\s+)?damage\s+on\s+a\s+successful(?:\s+save)?/i.test(r),w=/saving\s+throw\s+or\s+take.*?damage/i.test(r)&&!y;return{ability:u,halfDamageOnSave:y,noDamageOnSave:w}}function pl(a){const r=a.description;return/(plus|add)\s+your\s+spellcasting\s+(ability\s+)?modifier/i.test(r)}function Ba(a){const r=a.description.toLowerCase();return r.includes("ranged spell attack")||r.includes("melee spell attack")}function Va(a){const r=a.description.toLowerCase();if(["Divine Favor","Bless","Aid","Command"].includes(a.name))return!0;const u=["takes","take","deals","deal","damage equal to","force damage","fire damage","cold damage","lightning damage","thunder damage","acid damage","poison damage","necrotic damage","radiant damage","psychic damage","regain","regains","hit point"].some($=>r.includes($));return["bonus to attack","bonus to damage","bonus to ac","gains a +","gain a +","+1 bonus","+2 bonus","+3 bonus","advantage on","becomes a magic weapon"].some($=>r.includes($))&&!u}function fl(a){const r=a.description;let t=0,c=0,u=0,m="";const y=r.match(/\+(\d+)\s+bonus\s+to\s+attack\s+rolls\s+and\s+damage\s+rolls/i);if(y){const w=parseInt(y[1]);t=w,c=w,m=`+${w} to attack and damage rolls`}if(a.name==="Bless"&&(m="Add 1d4 to attack rolls and saves",t="1d4"),a.name==="Aid")return m="+5 HP (max and current) for 8 hours",{attackBonus:0,damageBonus:0,acBonus:0,hpBonus:5,description:m,name:a.name};a.name==="Divine Favor"&&(m="Your weapon attacks deal an extra 1d4 radiant damage on a hit.",c="1d4");const $=r.match(/\+(\d+)\s+bonus\s+to\s+AC/i);return $&&(u=parseInt($[1]),m=`+${u} to AC`),a.name==="Haste"&&(m="+2 AC, doubled speed, extra action",u=2),m||t!==0||c!==0||u!==0?{attackBonus:t,damageBonus:c,acBonus:u,description:m||a.description.substring(0,100),name:a.name}:null}var bl=f('<button class="btn btn-secondary">Add Attack</button>'),ml=f('<input type="text" placeholder="Attack name" class="attack-name svelte-14o91c5"/>'),hl=f('<h4 class="attack-name-display svelte-14o91c5"> </h4>'),gl=f('<button class="btn-remove svelte-14o91c5">√ó</button>'),_l=f('<div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Bonus</label> <input type="number" class="attack-bonus svelte-14o91c5"/></div>'),yl=f('<div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Damage</label> <input type="text" placeholder="e.g., 2d6+3" class="attack-damage svelte-14o91c5"/></div>'),xl=f('<div class="spell-info-loading svelte-14o91c5">Loading spell info...</div>'),kl=f('<li class="svelte-14o91c5"><strong>At Higher Levels:</strong> </li>'),Sl=f('<ul class="svelte-14o91c5"><li class="svelte-14o91c5"><strong>Level:</strong> </li> <li class="svelte-14o91c5"><strong>Casting Time:</strong> </li> <li class="svelte-14o91c5"><strong>Range:</strong> </li> <li class="svelte-14o91c5"><strong>Components:</strong> <!></li> <li class="svelte-14o91c5"><strong>Duration:</strong> <!> </li> <li class="svelte-14o91c5"><strong>Description:</strong> </li> <!></ul>'),$l=f('<span class="scaled-damage svelte-14o91c5" style="margin-left: 8px;"> </span>'),Cl=f('<span class="scaled-damage svelte-14o91c5">(Half damage)</span>'),Dl=f('<span class="scaled-damage svelte-14o91c5">(No damage)</span>'),wl=f('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> <!> <!></label></div>'),Ll=f("<option> </option>"),jl=f('<span class="scaled-damage svelte-14o91c5"><!> </span>'),Al=f('<span class="scaled-damage svelte-14o91c5"> </span>'),Bl=f('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> Target is Fiend or Undead <!></label></div>'),Ml=f('<div class="spell-level-selector svelte-14o91c5"><label class="svelte-14o91c5">Cast at Level:</label> <select class="spell-level-select use-enabled svelte-14o91c5"></select> <!></div> <!>',1),Fl=f('<div class="spell-level-selector svelte-14o91c5"><span style="color: #dc3545; font-weight: bold;">No spell slots available!</span></div>'),Tl=f('<div class="spell-info svelte-14o91c5"><div class="spell-info-header svelte-14o91c5" role="button" tabindex="0"><h4 class="svelte-14o91c5">Spell Info</h4> <button class="collapse-btn-small svelte-14o91c5"> </button></div> <!></div> <!> <!>',1),Pl=f('<div class="spell-info-missing svelte-14o91c5">Spell info not found.</div>'),Rl=f('<div class="attack-notes svelte-14o91c5"><label class="svelte-14o91c5">Notes</label> <textarea placeholder="e.g., DC 15 Dex save, Range 120 ft, Concentration" class="notes-input svelte-14o91c5" rows="2"></textarea></div>'),Il=f('<button class="btn btn-primary">Roll Attack</button>'),El=f('<div class="buff-target-selection svelte-14o91c5"><div class="target-options svelte-14o91c5"><label class="target-option svelte-14o91c5"><input type="radio" class="svelte-14o91c5"/> Self</label> <label class="target-option svelte-14o91c5"><input type="radio" class="svelte-14o91c5"/> Other</label></div> <button class="btn btn-info"> </button></div>'),Hl=f('<button class="btn btn-info">Cast Spell</button>'),Nl=f("<button><!></button>"),Ul=f('<button class="btn btn-info">Cast Spell</button>'),Gl=f('<button class="btn btn-secondary">Roll Damage</button>'),Ol=f('<button class="btn btn-primary">Roll Attack</button> <!>',1),ql=f('<div class="attack-card svelte-14o91c5"><div class="attack-header svelte-14o91c5"><!> <!></div> <div class="attack-details svelte-14o91c5"><!> <!> <div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Type</label> <input type="text" placeholder="e.g., slashing" class="attack-type svelte-14o91c5"/></div></div> <!> <!> <div class="attack-actions svelte-14o91c5"><!></div></div>'),Wl=f('<p class="no-attacks svelte-14o91c5">No attacks added yet. Click "Add Attack" to create one.</p>'),zl=f('<p class="no-attacks svelte-14o91c5">No attacks match your search.</p>'),Kl=f('<button class="btn-remove svelte-14o91c5">√ó</button>'),Vl=f('<div class="state-card svelte-14o91c5"><div class="state-header svelte-14o91c5"><input type="text" placeholder="Effect name (e.g., Magic Weapon)" class="state-name svelte-14o91c5"/> <!></div> <div class="state-details svelte-14o91c5"><div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Attack Bonus</label> <input type="number" class="state-bonus svelte-14o91c5"/></div> <div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Damage Bonus</label> <input type="text" class="state-bonus svelte-14o91c5"/></div> <div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Target</label> <select class="state-bonus svelte-14o91c5"><option>Self</option><option>Other</option></select></div></div> <div class="state-description svelte-14o91c5"><label class="svelte-14o91c5">Description</label> <input type="text" placeholder="e.g., +1 to attack and damage rolls (Magic Weapon)" class="state-desc-input svelte-14o91c5"/></div></div>'),Jl=f('<div class="states-list svelte-14o91c5"></div>'),Ql=f('<p class="no-states svelte-14o91c5">No active effects. Add spell effects that modify your attacks.</p>'),Yl=f('<!> <div class="attacks-list svelte-14o91c5"><!> <!></div> <div class="active-states-section svelte-14o91c5"><h3 class="svelte-14o91c5">Active Spell Effects</h3> <p class="section-description svelte-14o91c5">Effects that modify attack and damage rolls (e.g., Magic Weapon, Bless)</p> <button class="btn btn-secondary">Add Effect</button> <!></div>',1),Xl=f("<section><!> <!></section>");function Zl(a,r){Et(r,!1);const t=()=>st(ee,"$character",$),c=()=>st(ma,"$abilityModifiers",$),u=()=>st(ea,"$searchFilter",$),m=()=>st(Tt,"$collapsedStates",$),y=()=>st(Zt,"$isEditMode",$),[$,w]=Wt(),x=j(),ae=j(),J=[],ue=ia();let Y=j({}),te=j({});function Se(b){sa(Y,e(Y)[b]=!e(Y)[b]),o(Y,{...e(Y)})}function _e(b){return b.description.toLowerCase().includes("regain")&&(b.description.toLowerCase().includes("hit point")||b.description.toLowerCase().includes("hp"))}function O(b){return["Shield of Faith","Bless","Aid","Magic Weapon"].includes(b)}function je(){ee.update(b=>(b.attacks=[...b.attacks,{id:crypto.randomUUID(),name:"",bonus:0,damage:"",damageType:"",notes:""}],b))}function We(b){ee.update(F=>(F.attacks=F.attacks.filter(q=>q.id!==b),F))}function se(b){let F=b.damage,q=!1,Z=!1;if(b.spellRef){const ke=xe(b.spellRef);if(ke&&(Z=Ba(ke),ke.level>0)){const ze=b.castAtLevel||ke.level;if(!Fe(ze)){qt.add(`No level ${ze} spell slots available!`,"error");return}const L=ya(ke);L&&b.targetSucceededSave&&L.noDamageOnSave?F="0":(q=L?.halfDamageOnSave&&b.targetSucceededSave||!1,F=De(b,ke))}}else if(t().activeStates&&t().activeStates.length>0){let ke=0,ze=[];for(const T of t().activeStates)T.target!=="other"&&(typeof T.damageBonus=="string"?ze.push(T.damageBonus):typeof T.damageBonus=="number"&&(ke+=T.damageBonus));if((ke!==0||ze.length>0)&&F){const T=F.match(/(\d+d\d+)([+-]\d+)?/);if(T){const[,L,pe]=T,V=(pe?parseInt(pe):0)+ke;let d=`${L}`;V!==0&&(d+=`${V>=0?"+":""}${V}`),ze.length>0&&(d+=" + "+ze.join(" + ")),F=d}}}const z=[];let le=0;if(Z){const ke=za(t(),c()),ze=t().proficiencyBonus||0;z.push({value:ze,source:"proficiency"}),z.push({value:ke,source:"spellcasting"}),le=ze+ke}else b.bonus!==0&&z.push({value:b.bonus,source:"base"}),le=b.bonus;let we=[];if(t().activeStates)for(const ke of t().activeStates)ke.target!=="other"&&(typeof ke.attackBonus=="number"&&ke.attackBonus!==0?(z.push({value:ke.attackBonus,source:ke.name.toLowerCase()}),le+=ke.attackBonus):typeof ke.attackBonus=="string"&&ke.attackBonus&&(we.push(ke.attackBonus),z.push({value:ke.attackBonus,source:ke.name.toLowerCase()})));let vt=`1d20${le>=0?"+":""}${le}`;we.length>0&&(vt+="+"+we.join("+")),ue("roll",{notation:vt,damageNotation:F,attackName:b.name,applyHalfDamage:q,bonusBreakdown:z,rollType:"attack"})}function Ge(b){if(!b.damage){qt.add(`${b.name}: No damage specified`,"error");return}let F=b.damage,q=!1;const Z=[];if(b.spellRef){const z=xe(b.spellRef);if(z&&z.level>0){const le=b.castAtLevel||z.level;if(!Fe(le)){qt.add(`No level ${le} spell slots available!`,"error");return}const vt=ya(z);vt&&b.targetSucceededSave&&vt.noDamageOnSave?F="0":(q=vt?.halfDamageOnSave&&b.targetSucceededSave||!1,F=De(b,z))}}else{const z=F.match(/(\d+d\d+)([+-]\d+)?/);if(z){const[,le,we]=z,vt=we?parseInt(we):0;if(vt!==0&&Z.push({value:vt,source:"base"}),t().activeStates&&t().activeStates.length>0){let ke=0,ze=[];for(const T of t().activeStates)T.target!=="other"&&(typeof T.damageBonus=="string"?ze.push(T.damageBonus):typeof T.damageBonus=="number"&&T.damageBonus!==0&&(Z.push({value:T.damageBonus,source:T.name.toLowerCase()}),ke+=T.damageBonus));if(ke!==0||ze.length>0){const T=vt+ke;let L=`${le}`;T!==0&&(L+=`${T>=0?"+":""}${T}`),ze.length>0&&(L+=" + "+ze.join(" + ")),F=L}}}}ue("roll",{notation:F,attackName:b.name,applyHalfDamage:q,bonusBreakdown:Z})}let Oe=j([]),ne=j(!1);ca(async()=>{o(Oe,await ns()),o(ne,!0)});function xe(b){return e(Oe).find(F=>F.name===b)}function Fe(b){t().classFeatures.spellSlotsByLevel||_t(ee,n(t).classFeatures.spellSlotsByLevel={},n(t)),t().classFeatures.spellSlotsByLevel[b]||_t(ee,n(t).classFeatures.spellSlotsByLevel[b]=Array(2).fill(!1),n(t));const q=t().classFeatures.spellSlotsByLevel[b].findIndex(Z=>!Z);return q===-1?!1:(ee.update(Z=>(Z.classFeatures.spellSlotsByLevel||(Z.classFeatures.spellSlotsByLevel={}),Z.classFeatures.spellSlotsByLevel[b]||(Z.classFeatures.spellSlotsByLevel[b]=Array(2).fill(!1)),Z.classFeatures.spellSlotsByLevel[b][q]=!0,Z)),!0)}function De(b,F){let q=b.damage,Z=0,z=0;if(pl(F)&&(z+=za(t(),c())),t().activeStates)for(const fe of t().activeStates)fe.target!=="other"&&typeof fe.damageBonus=="number"&&(z+=fe.damageBonus);if(F.higherLevelSlot&&b.castAtLevel){const fe=F.level,d=(b.castAtLevel||fe)-fe;if(d>0){const Ve=F.higherLevelSlot.match(/(\d+)d(\d+)\s+for\s+each.*?level\s+above/i);if(Ve){const[,he]=Ve;Z+=d*parseInt(he)}}}if(b.targetIsFiendOrUndead&&F.description.includes("Fiend or an Undead")){const fe=F.description.match(/increases by (\d+)d(\d+) if.*?Fiend or.*?Undead/i);if(fe){const[,V]=fe;Z+=parseInt(V)}}const le=q.match(/(\d+)d(\d+)([+-]\d+)?/);if(!le)return z!==0?z>=0?`${z}`:`${z}`:q||"0";const[,we,vt,ke]=le,ze=parseInt(we)+Z,L=(ke?parseInt(ke):0)+z;let pe=`${ze}d${vt}`;return L!==0&&(pe+=L>=0?`+${L}`:`${L}`),pe}function Te(b){const F=[];for(let Z=b.level;Z<=9;Z++){const z=t().classFeatures.spellSlotsByLevel?.[Z];z&&z.length>0&&F.push(Z)}return F}function k(){ee.update(b=>(b.activeStates||(b.activeStates=[]),b.activeStates=[...b.activeStates,{name:"",attackBonus:0,damageBonus:0,description:"",target:"self"}],b))}function de(b){ee.update(F=>{if(F.activeStates){const q=F.activeStates[b];q?.hpBonus&&q.target!=="other"&&(F.maxHP-=q.hpBonus,F.currentHP=Math.max(1,Math.min(F.currentHP-q.hpBonus,F.maxHP))),F.activeStates=F.activeStates.filter((Z,z)=>z!==b)}return F})}function h(b,F="self"){const q=xe(b.spellRef);if(!q){qt.add("Spell not found","error");return}const Z=b.castAtLevel||q.level;if(Z>0&&!Fe(Z)){qt.add(`No level ${Z} spell slots available!`,"error");return}const z=fl(q);if(!z){qt.add(`${q.name} cast! Check spell description for effects.`,"info");return}let le=z.hpBonus||0,we=z.description;q.name==="Aid"&&Z>q.level&&(le=5+(Z-q.level)*5,we=`+${le} HP (max and current) for 8 hours`);const ke=["Shield of Faith","Bless","Aid","Magic Weapon"].includes(q.name);ee.update(T=>{T.activeStates||(T.activeStates=[]);const L=T.activeStates.find(pe=>pe.name===q.name);return L&&L.hpBonus&&L.target!=="other"&&(T.maxHP-=L.hpBonus,T.currentHP=Math.max(1,Math.min(T.currentHP-L.hpBonus,T.maxHP))),T.activeStates=T.activeStates.filter(pe=>pe.name!==q.name),le>0&&F==="self"&&(T.maxHP+=le,T.currentHP+=le),T.activeStates=[...T.activeStates,{name:q.name,attackBonus:z.attackBonus,damageBonus:z.damageBonus,acBonus:z.acBonus,description:we,target:F,hpBonus:le}],T});const ze=F==="self"?" on self":" on other";qt.add(`${q.name} cast${ke?ze:""}! Effect added to Active Spell Effects.`,"success")}Ye(()=>(t(),e(Y),e(te)),()=>{if(t()&&t().attacks)for(const b of t().attacks)b.spellRef&&e(Y)[b.id]===void 0&&sa(Y,e(Y)[b.id]=!0),b.spellRef&&e(te)[b.id]===void 0&&sa(te,e(te)[b.id]="self")}),Ye(()=>(t(),u()),()=>{o(x,t().attacks.filter(b=>{if(!u())return!0;const F=u().toLowerCase();return b.name.toLowerCase().includes(F)||b.damageType.toLowerCase().includes(F)}).sort((b,F)=>!b.spellRef&&F.spellRef?-1:b.spellRef&&!F.spellRef?1:0))}),Ye(()=>(u(),e(x)),()=>{o(ae,!u()||e(x).length>0||"attack".includes(u().toLowerCase())||"spell".includes(u().toLowerCase()))}),Jt(),It();var R=Xl();let re;var U=i(R);{let b=pt(()=>(m(),n(()=>m().attacks?"Expand":"Collapse")));na(U,{title:"Attacks & Spells",get collapsed(){return m(),n(()=>m().attacks)},get ariaLabel(){return e(b)},onToggle:()=>Tt.update(F=>({...F,attacks:!F.attacks}))})}var oe=s(U,2);{var ye=b=>{var F=Yl(),q=He(F);{var Z=V=>{var d=bl();B("click",d,je),v(V,d)};_(q,V=>{y()&&V(Z)})}var z=s(q,2),le=i(z);yt(le,1,()=>e(x),V=>V.id,(V,d,Ve)=>{var he=ql(),be=i(he),A=i(be);{var Pe=D=>{var I=ml();Le(I),Je(I,()=>e(d).name,K=>(e(d).name=K,Ct(()=>(e(x),t(),u())))),v(D,I)},Re=D=>{var I=hl(),K=i(I,!0);l(I),M(()=>C(K,(e(d),n(()=>e(d).name||"(Unnamed Attack)")))),v(D,I)};_(A,D=>{y()?D(Pe):D(Re,!1)})}var Xe=s(A,2);{var ct=D=>{var I=gl();B("click",I,()=>We(e(d).id)),v(D,I)};_(Xe,D=>{y()&&D(ct)})}l(be);var Ae=s(be,2),$e=i(Ae);{var Be=D=>{var I=_l(),K=i(I),E=s(K,2);Le(E),l(I),M(()=>{tt(K,"for",`attack-bonus-${e(d),n(()=>e(d).id)??""}`),tt(E,"id",`attack-bonus-${e(d),n(()=>e(d).id)??""}`)}),Je(E,()=>e(d).bonus,Q=>(e(d).bonus=Q,Ct(()=>(e(x),t(),u())))),v(D,I)};_($e,D=>{e(d),n(()=>e(d).bonus!==0&&e(d).bonus!==void 0)&&D(Be)})}var Ne=s($e,2);{var qe=D=>{var I=yl(),K=i(I),E=s(K,2);Le(E),l(I),M(()=>{tt(K,"for",`attack-damage-${e(d),n(()=>e(d).id)??""}`),tt(E,"id",`attack-damage-${e(d),n(()=>e(d).id)??""}`)}),Je(E,()=>e(d).damage,Q=>(e(d).damage=Q,Ct(()=>(e(x),t(),u())))),v(D,I)};_(Ne,D=>{e(d),n(()=>e(d).damage&&e(d).damage.trim()!=="")&&D(qe)})}var Ke=s(Ne,2),ie=i(Ke),ge=s(ie,2);Le(ge),l(Ke),l(Ae);var Ee=s(Ae,2);{var Qe=D=>{var I=ut(),K=He(I);{var E=Ie=>{var N=xl();v(Ie,N)},Q=Ie=>{const N=pt(()=>(e(d),n(()=>xe(e(d).spellRef))));var at=ut(),lt=He(at);{var it=P=>{const S=pt(()=>(H(ya),H(e(N)),n(()=>ya(e(N)))));var me=Tl(),W=He(me),Ze=i(W),Me=s(i(Ze),2),ft=i(Me,!0);l(Me),l(Ze);var Ue=s(Ze,2);{var nt=et=>{var ot=Sl(),bt=i(ot),Dt=s(i(bt));l(bt);var Nt=s(bt,2),Ut=s(i(Nt));l(Nt);var Bt=s(Nt,2),wt=s(i(Bt));l(Bt);var Lt=s(Bt,2),Gt=s(i(Lt)),mt=s(Gt);{var Ot=$t=>{var jt=Ft();M(()=>C(jt,`(${H(e(N)),n(()=>e(N).material)??""})`)),v($t,jt)};_(mt,$t=>{H(e(N)),n(()=>e(N).material)&&$t(Ot)})}l(Lt);var Vt=s(Lt,2),Qt=s(i(Vt),2);{var ta=$t=>{var jt=Ft("Concentration,");v($t,jt)};_(Qt,$t=>{H(e(N)),n(()=>e(N).concentration)&&$t(ta)})}var At=s(Qt,1,!0);l(Vt);var Pt=s(Vt,2),Mt=s(i(Pt));l(Pt);var zt=s(Pt,2);{var Yt=$t=>{var jt=kl(),Kt=s(i(jt));l(jt),M(()=>C(Kt,` ${H(e(N)),n(()=>e(N).higherLevelSlot)??""}`)),v($t,jt)};_(zt,$t=>{H(e(N)),n(()=>e(N).higherLevelSlot)&&$t(Yt)})}l(ot),M($t=>{C(Dt,` ${H(e(N)),n(()=>e(N).level)??""}`),C(Ut,` ${H(e(N)),n(()=>e(N).castingTime||e(N).actionType)??""}`),C(wt,` ${H(e(N)),n(()=>e(N).range)??""}`),C(Gt,` ${$t??""}`),C(At,(H(e(N)),n(()=>e(N).duration))),C(Mt,` ${H(e(N)),n(()=>e(N).description)??""}`)},[()=>(H(e(N)),n(()=>e(N).components.join(", ")))]),v(et,ot)};_(Ue,et=>{e(Y),e(d),n(()=>!e(Y)[e(d).id])&&et(nt)})}l(W);var rt=s(W,2);{var dt=et=>{var ot=wl(),bt=i(ot),Dt=i(bt);Le(Dt);var Nt=s(Dt),Ut=s(Nt);{var Bt=mt=>{var Ot=$l(),Vt=i(Ot);l(Ot),M(Qt=>C(Vt,`(Spell Save DC: ${Qt??""})`),[()=>(H(Pa),t(),c(),n(()=>Pa(t(),c())))]),v(mt,Ot)};_(Ut,mt=>{t(),n(()=>t().class)&&mt(Bt)})}var wt=s(Ut,2);{var Lt=mt=>{var Ot=Cl();v(mt,Ot)},Gt=mt=>{var Ot=ut(),Vt=He(Ot);{var Qt=ta=>{var At=Dl();v(ta,At)};_(Vt,ta=>{e(d),H(e(S)),n(()=>e(d).targetSucceededSave&&e(S).noDamageOnSave)&&ta(Qt)},!0)}v(mt,Ot)};_(wt,mt=>{e(d),H(e(S)),n(()=>e(d).targetSucceededSave&&e(S).halfDamageOnSave)?mt(Lt):mt(Gt,!1)})}l(bt),l(ot),M(mt=>C(Nt,` Target succeeded on ${mt??""} save `),[()=>(H(e(S)),n(()=>e(S).ability.charAt(0).toUpperCase()+e(S).ability.slice(1)))]),$a(Dt,()=>e(d).targetSucceededSave,mt=>(e(d).targetSucceededSave=mt,Ct(()=>(e(x),t(),u())))),v(et,ot)};_(rt,et=>{e(S)&&et(dt)})}var ht=s(rt,2);{var gt=et=>{const ot=pt(()=>(H(e(N)),n(()=>Te(e(N)))));var bt=ut(),Dt=He(bt);{var Nt=Bt=>{var wt=Ml(),Lt=He(wt),Gt=i(Lt),mt=s(Gt,2);M(()=>{e(d),Ct(()=>{e(ot)})}),yt(mt,5,()=>e(ot),kt,(At,Pt)=>{var Mt=Ll(),zt=i(Mt);l(Mt);var Yt={};M(()=>{C(zt,`Level ${e(Pt)??""}`),Yt!==(Yt=e(Pt))&&(Mt.value=(Mt.__value=e(Pt))??"")}),v(At,Mt)}),l(mt);var Ot=s(mt,2);{var Vt=At=>{const Pt=pt(()=>(e(d),H(e(N)),n(()=>De(e(d),e(N)))));var Mt=jl(),zt=i(Mt);{var Yt=Kt=>{var aa=Ft("Healing");v(Kt,aa)},$t=Kt=>{var aa=Ft("Damage");v(Kt,aa)};_(zt,Kt=>{H(e(N)),n(()=>_e(e(N)))?Kt(Yt):Kt($t,!1)})}var jt=s(zt);l(Mt),M(()=>C(jt,` ${e(Pt)??""}`)),v(At,Mt)};_(Ot,At=>{e(d),H(e(N)),n(()=>e(d).castAtLevel&&e(d).castAtLevel>e(N).level)&&At(Vt)})}l(Lt);var Qt=s(Lt,2);{var ta=At=>{var Pt=Bl(),Mt=i(Pt),zt=i(Mt);Le(zt);var Yt=s(zt,2);{var $t=jt=>{const Kt=pt(()=>(e(d),H(e(N)),n(()=>De(e(d),e(N)))));var aa=Al(),rs=i(aa);l(aa),M(()=>C(rs,`(+1d8, total: ${e(Kt)??""})`)),v(jt,aa)};_(Yt,jt=>{e(d),n(()=>e(d).targetIsFiendOrUndead)&&jt($t)})}l(Mt),l(Pt),$a(zt,()=>e(d).targetIsFiendOrUndead,jt=>(e(d).targetIsFiendOrUndead=jt,Ct(()=>(e(x),t(),u())))),v(At,Pt)};_(Qt,At=>{H(e(N)),n(()=>e(N).description.includes("Fiend or an Undead"))&&At(ta)})}M(()=>{tt(Gt,"for",`castLevel-${e(d),n(()=>e(d).id)??""}`),tt(mt,"id",`castLevel-${e(d),n(()=>e(d).id)??""}`)}),Sa(mt,()=>e(d).castAtLevel,At=>(e(d).castAtLevel=At,Ct(()=>(e(x),t(),u())))),v(Bt,wt)},Ut=Bt=>{var wt=Fl();v(Bt,wt)};_(Dt,Bt=>{H(e(ot)),n(()=>e(ot).length>0)?Bt(Nt):Bt(Ut,!1)})}v(et,bt)};_(ht,et=>{H(e(N)),n(()=>e(N).higherLevelSlot&&e(N).level>0)&&et(gt)})}M(()=>{tt(Me,"aria-label",(e(Y),e(d),n(()=>e(Y)[e(d).id]?"Expand":"Collapse"))),C(ft,(e(Y),e(d),n(()=>e(Y)[e(d).id]?"‚ñº":"‚ñ≤")))}),B("click",Ze,()=>Se(e(d).id)),B("keydown",Ze,et=>et.key==="Enter"&&Se(e(d).id)),v(P,me)},p=P=>{var S=Pl();v(P,S)};_(lt,P=>{e(N)?P(it):P(p,!1)})}v(Ie,at)};_(K,Ie=>{e(Oe),n(()=>e(Oe).length===0)?Ie(E):Ie(Q,!1)})}v(D,I)};_(Ee,D=>{e(d),n(()=>e(d).spellRef)&&D(Qe)})}var Ce=s(Ee,2);{var g=D=>{var I=Rl(),K=i(I),E=s(K,2);ua(E),l(I),M(()=>{tt(K,"for",`attack-notes-${e(d),n(()=>e(d).id)??""}`),tt(E,"id",`attack-notes-${e(d),n(()=>e(d).id)??""}`)}),Je(E,()=>e(d).notes,Q=>(e(d).notes=Q,Ct(()=>(e(x),t(),u())))),v(D,I)};_(Ce,D=>{e(d),n(()=>!e(d).spellRef)&&D(g)})}var G=s(Ce,2),ce=i(G);{var X=D=>{const I=pt(()=>(e(d),n(()=>xe(e(d).spellRef))));var K=ut(),E=He(K);{var Q=Ie=>{var N=ut(),at=He(N);{var lt=p=>{var P=Il();B("click",P,()=>se(e(d))),v(p,P)},it=p=>{var P=ut(),S=He(P);{var me=Ze=>{var Me=ut(),ft=He(Me);{var Ue=rt=>{var dt=El(),ht=i(dt),gt=i(ht),et=i(gt);Le(et),et.value=et.__value="self",la(),l(gt);var ot=s(gt,2),bt=i(ot);Le(bt),bt.value=bt.__value="other",la(),l(ot),l(ht);var Dt=s(ht,2),Nt=i(Dt);l(Dt),l(dt),M(()=>{tt(et,"name",`target-${e(d),n(()=>e(d).id)??""}`),tt(bt,"name",`target-${e(d),n(()=>e(d).id)??""}`),C(Nt,`Cast ${H(e(I)),n(()=>e(I).name)??""}`)}),Ua(J,[Ve],et,()=>e(te)[e(d).id],Ut=>sa(te,e(te)[e(d).id]=Ut)),Ua(J,[Ve],bt,()=>e(te)[e(d).id],Ut=>sa(te,e(te)[e(d).id]=Ut)),B("click",Dt,()=>h(e(d),e(te)[e(d).id])),v(rt,dt)},nt=rt=>{var dt=Hl();B("click",dt,()=>h(e(d),"self")),v(rt,dt)};_(ft,rt=>{H(e(I)),n(()=>O(e(I).name))?rt(Ue):rt(nt,!1)})}v(Ze,Me)},W=Ze=>{var Me=ut(),ft=He(Me);{var Ue=rt=>{var dt=Nl(),ht=i(dt);{var gt=ot=>{var bt=Ft("Roll Healing");v(ot,bt)},et=ot=>{var bt=Ft("Roll Damage");v(ot,bt)};_(ht,ot=>{H(e(I)),n(()=>_e(e(I)))?ot(gt):ot(et,!1)})}l(dt),M(ot=>xt(dt,1,`btn ${ot??""}`),[()=>(H(e(I)),n(()=>_e(e(I))?"btn-success":"btn-secondary"))]),B("click",dt,()=>Ge(e(d))),v(rt,dt)},nt=rt=>{var dt=Ul();B("click",dt,()=>h(e(d),"self")),v(rt,dt)};_(ft,rt=>{e(d),n(()=>e(d).damage&&e(d).damage.trim()!=="")?rt(Ue):rt(nt,!1)})}v(Ze,Me)};_(S,Ze=>{H(Va),H(e(I)),n(()=>Va(e(I)))?Ze(me):Ze(W,!1)},!0)}v(p,P)};_(at,p=>{H(Ba),H(e(I)),n(()=>Ba(e(I)))?p(lt):p(it,!1)})}v(Ie,N)};_(E,Ie=>{e(I)&&Ie(Q)})}v(D,K)},ve=D=>{var I=ut(),K=He(I);{var E=Q=>{var Ie=Ol(),N=He(Ie),at=s(N,2);{var lt=it=>{var p=Gl();B("click",p,()=>Ge(e(d))),v(it,p)};_(at,it=>{e(d),n(()=>e(d).damage&&e(d).damage.trim()!=="")&&it(lt)})}B("click",N,()=>se(e(d))),v(Q,Ie)};_(K,Q=>{e(d),n(()=>!e(d).spellRef)&&Q(E)},!0)}v(D,I)};_(ce,D=>{e(d),e(ne),n(()=>e(d).spellRef&&e(ne))?D(X):D(ve,!1)})}l(G),l(he),M(()=>{tt(ie,"for",`attack-type-${e(d),n(()=>e(d).id)??""}`),tt(ge,"id",`attack-type-${e(d),n(()=>e(d).id)??""}`)}),Je(ge,()=>e(d).damageType,D=>(e(d).damageType=D,Ct(()=>(e(x),t(),u())))),v(V,he)});var we=s(le,2);{var vt=V=>{var d=Wl();v(V,d)},ke=V=>{var d=ut(),Ve=He(d);{var he=be=>{var A=zl();v(be,A)};_(Ve,be=>{e(x),n(()=>e(x).length===0)&&be(he)},!0)}v(V,d)};_(we,V=>{t(),n(()=>t().attacks.length===0)?V(vt):V(ke,!1)})}l(z);var ze=s(z,2),T=s(i(ze),4),L=s(T,2);{var pe=V=>{var d=Jl();yt(d,5,()=>(t(),n(()=>t().activeStates)),kt,(Ve,he,be)=>{var A=Vl(),Pe=i(A),Re=i(Pe);Le(Re);var Xe=s(Re,2);{var ct=ve=>{var D=Kl();B("click",D,()=>de(be)),v(ve,D)};_(Xe,ve=>{y()&&ve(ct)})}l(Pe);var Ae=s(Pe,2),$e=i(Ae),Be=i($e);tt(Be,"for",`state-attack-bonus-${be}`);var Ne=s(Be,2);Le(Ne),tt(Ne,"id",`state-attack-bonus-${be}`),l($e);var qe=s($e,2),Ke=i(qe);tt(Ke,"for",`state-damage-bonus-${be}`);var ie=s(Ke,2);Le(ie),tt(ie,"id",`state-damage-bonus-${be}`),l(qe);var ge=s(qe,2),Ee=i(ge);tt(Ee,"for",`state-target-${be}`);var Qe=s(Ee,2);M(()=>{e(he),Ct(()=>{})}),tt(Qe,"id",`state-target-${be}`);var Ce=i(Qe);Ce.value=Ce.__value="self";var g=s(Ce);g.value=g.__value="other",l(Qe),l(ge),l(Ae);var G=s(Ae,2),ce=i(G);tt(ce,"for",`state-desc-${be}`);var X=s(ce,2);Le(X),tt(X,"id",`state-desc-${be}`),l(G),l(A),Je(Re,()=>e(he).name,ve=>(e(he).name=ve,Ct(()=>t()),va($,"$character"))),Je(Ne,()=>e(he).attackBonus,ve=>(e(he).attackBonus=ve,Ct(()=>t()),va($,"$character"))),Je(ie,()=>e(he).damageBonus,ve=>(e(he).damageBonus=ve,Ct(()=>t()),va($,"$character"))),Sa(Qe,()=>e(he).target,ve=>(e(he).target=ve,Ct(()=>t()),va($,"$character"))),Je(X,()=>e(he).description,ve=>(e(he).description=ve,Ct(()=>t()),va($,"$character"))),v(Ve,A)}),l(d),v(V,d)},fe=V=>{var d=Ql();v(V,d)};_(L,V=>{t(),n(()=>t().activeStates&&t().activeStates.length>0)?V(pe):V(fe,!1)})}l(ze),B("click",T,k),v(b,F)};_(oe,b=>{m(),n(()=>!m().attacks)&&b(ye)})}l(R),M(()=>re=xt(R,1,"attacks svelte-14o91c5",null,re,{hidden:!e(ae)})),v(a,R),Ht(),w()}var ei=f('<span class="slot-checkbox-x svelte-serp1j">&#8212;</span>'),ti=f('<label><input type="checkbox" class="slot-checkbox-input svelte-serp1j"/> <span><!></span></label>');function Ja(a,r){Et(r,!1);const t=()=>st(Zt,"$isEditMode",c),[c,u]=Wt();let m=St(r,"checked",8,!1),y=St(r,"disabled",8,!1),$=St(r,"className",8,""),w=St(r,"index",8,void 0),x=St(r,"ariaLabel",8,void 0);const ae=ia();function J(O){ae("change",{checked:O.currentTarget.checked,index:w()})}It();var ue=ti(),Y=i(ue);Le(Y);var te=s(Y,2),Se=i(te);{var _e=O=>{var je=ei();v(O,je)};_(Se,O=>{m()&&O(_e)})}l(te),l(ue),M(()=>{xt(ue,1,"slot-checkbox-label "+$()+(t()?"":" not-editable"),"svelte-serp1j"),as(Y,m()),Y.disabled=y()||!t(),tt(Y,"aria-label",x()),tt(Y,"tabindex",t()?0:-1),xt(te,1,`slot-checkbox-custom ${m()?"used":""} ${t()?"":"readonly"}`,"svelte-serp1j")}),B("change",Y,J),v(a,ue),Ht(),u()}var ai=f('<p class="no-features svelte-1kpvv0n">Select a class to see available features</p>'),si=f('<p class="no-features svelte-1kpvv0n">No class features available at this level</p>'),li=f('<div class="spell-slots svelte-1kpvv0n"><label class="svelte-1kpvv0n"> </label> <div class="slots-tracker svelte-1kpvv0n"></div></div>'),ii=f('<div class="all-spell-slots"></div>'),ni=f('<div class="feature-box spellcasting svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"> </h3> <div class="spell-stats svelte-1kpvv0n"><div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Spell Save DC</label> <div class="spell-value svelte-1kpvv0n"> </div></div> <div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <div class="spell-value svelte-1kpvv0n"> </div></div></div> <!> <div class="prepared-spells svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <textarea placeholder="List your prepared spells..." class="svelte-1kpvv0n"></textarea></div></div>'),ri=f('<p class="unlimited svelte-1kpvv0n">Unlimited Uses</p>'),oi=f('<div class="slots-tracker svelte-1kpvv0n"></div> <div class="uses-actions-row"><button class="btn btn-primary use-enabled"> </button></div> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div>',1),ci=f('<div class="uses-tracker svelte-1kpvv0n"><!></div>'),vi=f('<div class="pool-tracker svelte-1kpvv0n"><input type="number" min="0" class="pool-input svelte-1kpvv0n"/> <span> </span> <button class="btn-small svelte-1kpvv0n"> </button></div>'),di=f('<p class="no-uses svelte-1kpvv0n">No Channel Divinity uses remaining</p>'),ui=f('<div class="channel-divinity-option svelte-1kpvv0n"><button class="btn btn-primary use-enabled svelte-1kpvv0n">Use Channel Divinity</button> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div> <!></div>'),pi=f('<div class="feature-box svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"><!> </h3> <p class="feature-description svelte-1kpvv0n"> </p> <!></div>'),fi=f('<div class="features-grid svelte-1kpvv0n"><!> <!></div>'),bi=f("<section><!> <!></section>");function mi(a,r){Et(r,!1);const t=()=>st(ee,"$character",y),c=()=>st(ma,"$abilityModifiers",y),u=()=>st(ea,"$searchFilter",y),m=()=>st(Tt,"$collapsedStates",y),[y,$]=Wt(),w=j(),x=j(),ae=j(),J=j(),ue=j(),Y=j(),te=j();let Se=j(0),_e=j(0);function O(h,R){ee.update(re=>(re.classFeatures.features[h]=R,re))}function je(){ee.update(h=>(h.classFeatures.spellSlotsByLevel||(h.classFeatures.spellSlotsByLevel={}),e(J).forEach(({level:R,slots:re})=>{h.classFeatures.spellSlotsByLevel[R]||(h.classFeatures.spellSlotsByLevel[R]=Array(re).fill(!1))}),h))}function We(h){if(typeof h.maxUses=="function"){if((h.name==="Divine Sense"||h.name==="War Priest")&&e(w)?.spellcastingAbility){const R=c()[e(w).spellcastingAbility];return h.maxUses(t().level,R)}return h.maxUses(t().level)}return h.maxUses||0}function se(h,R){ee.update(re=>((!re.classFeatures.features[h]||!Array.isArray(re.classFeatures.features[h])||re.classFeatures.features[h].length!==R)&&(re.classFeatures.features[h]=Array(R).fill(!1)),re))}cs(()=>{e(Y)&&t()&&t().classFeatures&&t().classFeatures.features&&e(Y).forEach(h=>{if(h.type==="uses"){const R=h.name.replace(/\s+/g,""),re=We(h),U=t().classFeatures.features[R];(!Array.isArray(U)||U.length!==re)&&se(R,re)}})});function Ge(h){return typeof h.maxPool=="function"?h.maxPool(t().level):h.maxPool||0}function Oe(h){return typeof h.description=="function"?h.description(t().level):h.description}function ne(){const h="ChannelDivinity";ee.update(R=>{const re=R.classFeatures.features[h];return typeof re=="number"&&re>0&&(R.classFeatures.features[h]=re-1),R})}function xe(){Tt.update(h=>({...h,classFeatures:!h.classFeatures}))}Ye(()=>(t(),Rt),()=>{o(w,t().class?Rt(t().class):null)}),Ye(()=>(t(),oa),()=>{o(x,t().class?oa(t().class,t().level,t().subclass):[])}),Ye(()=>(t(),qa),()=>{o(ae,t().class?qa(t().class,t().level):0)}),Ye(()=>(e(w),t()),()=>{o(J,(()=>{if(!e(w)?.spellcaster)return[];const h=t().level,R=[];return h>=1&&R.push({level:1,slots:Math.min(4,2+Math.floor(h/3))}),h>=3&&R.push({level:2,slots:Math.min(3,2+Math.floor((h-3)/4))}),h>=5&&R.push({level:3,slots:Math.min(3,2+Math.floor((h-5)/5))}),h>=7&&R.push({level:4,slots:Math.min(3,1+Math.floor((h-7)/6))}),h>=9&&R.push({level:5,slots:Math.min(2,1+Math.floor((h-9)/8))}),h>=11&&R.push({level:6,slots:1}),h>=13&&R.push({level:7,slots:1}),h>=15&&R.push({level:8,slots:1}),h>=17&&R.push({level:9,slots:1}),R})())}),Ye(()=>(e(w),c(),t(),Wa),()=>{if(e(w)?.spellcaster&&e(w).spellcastingAbility){const h=c()[e(w).spellcastingAbility];o(Se,Bs(t().class,h,t().proficiencyBonus)||0),o(_e,Wa(t().class,t().level,h))}}),Ye(()=>(t(),e(w),e(J)),()=>{t().class&&e(w)?.spellcaster&&e(J).length>0&&je()}),Ye(()=>t(),()=>{o(ue,(()=>{const R=t().classFeatures.features["ChannelDivinity"];return typeof R=="number"?R:0})())}),Ye(()=>(e(x),u()),()=>{o(Y,e(x).filter(h=>{if(!u())return!0;const R=u().toLowerCase();return h.name.toLowerCase().includes(R)||Oe(h).toLowerCase().includes(R)}))}),Ye(()=>(u(),t(),e(Y)),()=>{o(te,!u()||t().class||"class features".includes(u().toLowerCase())||"spellcasting".includes(u().toLowerCase())||e(Y).length>0)}),Jt(),It();var Fe=bi();let De;var Te=i(Fe);{let h=pt(()=>(m(),n(()=>m().classFeatures?"Expand":"Collapse")));na(Te,{title:"Class Features",get collapsed(){return m(),n(()=>m().classFeatures)},get ariaLabel(){return e(h)},onToggle:xe})}var k=s(Te,2);{var de=h=>{var R=ut(),re=He(R);{var U=ye=>{var b=ai();v(ye,b)},oe=ye=>{var b=ut(),F=He(b);{var q=z=>{var le=si();v(z,le)},Z=z=>{var le=fi(),we=i(le);{var vt=ze=>{var T=ni(),L=i(T),pe=i(L);l(L);var fe=s(L,2),V=i(fe),d=s(i(V),2),Ve=i(d,!0);l(d),l(V);var he=s(V,2),be=s(i(he),2),A=i(be,!0);l(be),l(he),l(fe);var Pe=s(fe,2);{var Re=Ae=>{var $e=ii();yt($e,5,()=>e(J),kt,(Be,Ne)=>{let qe=()=>e(Ne).level,Ke=()=>e(Ne).slots;const ie=pt(()=>(t(),qe(),Ke(),n(()=>t().classFeatures.spellSlotsByLevel?.[qe()]||Array(Ke()).fill(!1))));var ge=li(),Ee=i(ge),Qe=i(Ee);l(Ee);var Ce=s(Ee,2);yt(Ce,5,()=>e(ie),kt,(g,G,ce)=>{{let X=pt(()=>(H(e(ie)),n(()=>e(ie)[ce]||!1)));Ja(g,{get checked(){return e(X)},$$events:{change:ve=>{ee.update(D=>(D.classFeatures.spellSlotsByLevel||(D.classFeatures.spellSlotsByLevel={}),D.classFeatures.spellSlotsByLevel[qe()]||(D.classFeatures.spellSlotsByLevel[qe()]=Array(Ke()).fill(!1)),D.classFeatures.spellSlotsByLevel[qe()][ce]=ve.detail.checked,D))}}})}}),l(Ce),l(ge),M(()=>C(Qe,`${qe()===1?"1st":qe()===2?"2nd":qe()===3?"3rd":`${qe()}th`} Level Spell Slots`)),v(Be,ge)}),l($e),v(Ae,$e)};_(Pe,Ae=>{e(J),n(()=>e(J).length>0)&&Ae(Re)})}var Xe=s(Pe,2),ct=s(i(Xe),2);ua(ct),l(Xe),l(T),M(Ae=>{C(pe,`Spellcasting (${Ae??""})`),C(Ve,e(Se)),C(A,e(_e))},[()=>(e(w),n(()=>e(w).spellcastingAbility?.toUpperCase()))]),Je(ct,()=>t().classFeatures.preparedSpells,Ae=>_t(ee,n(t).classFeatures.preparedSpells=Ae,n(t))),v(ze,T)};_(we,ze=>{e(w),n(()=>e(w)?.spellcaster)&&ze(vt)})}var ke=s(we,2);yt(ke,1,()=>e(Y),kt,(ze,T)=>{const L=pt(()=>(e(T),n(()=>e(T).name.replace(/\s+/g,"")))),pe=pt(()=>(t(),H(e(L)),n(()=>t().classFeatures.features[e(L)]))),fe=pt(()=>typeof e(pe)=="number");var V=pi(),d=i(V),Ve=i(d);{var he=Ae=>{var $e=Ft("Channel Divinity:");v(Ae,$e)};_(Ve,Ae=>{e(T),n(()=>e(T).type==="channelDivinity")&&Ae(he)})}var be=s(Ve);l(d);var A=s(d,2),Pe=i(A,!0);l(A);var Re=s(A,2);{var Xe=Ae=>{const $e=pt(()=>(e(T),n(()=>We(e(T))))),Be=pt(()=>(H(e(pe)),H(e($e)),n(()=>Array.isArray(e(pe))?e(pe):Array(e($e)).fill(!1))));var Ne=ci(),qe=i(Ne);{var Ke=ge=>{var Ee=ri();v(ge,Ee)},ie=ge=>{var Ee=oi(),Qe=He(Ee);yt(Qe,5,()=>e(Be),kt,(D,I,K)=>{Ja(D,{get checked(){return e(I)},index:K,$$events:{change:E=>{ee.update(Q=>(Q.classFeatures.features[e(L)]||(Q.classFeatures.features[e(L)]=Array(e($e)).fill(!1)),Q.classFeatures.features[e(L)][K]=E.detail.checked,Q))}}})}),l(Qe);var Ce=s(Qe,2),g=i(Ce),G=i(g);l(g),l(Ce);var ce=s(Ce,2),X=i(ce),ve=i(X);l(X),l(ce),M(D=>{g.disabled=D,C(G,`Use ${e(T),n(()=>e(T).name)??""}`),C(ve,`Resets on ${e(T),n(()=>e(T).resetOn==="short"?"Short Rest":"Long Rest")??""}`)},[()=>(H(e(Be)),n(()=>e(Be).filter(D=>!D).length<=0))]),B("click",g,()=>{ee.update(D=>{D.classFeatures.features[e(L)]||(D.classFeatures.features[e(L)]=Array(e($e)).fill(!1));const I=D.classFeatures.features[e(L)],K=I.findIndex(E=>!E);return K!==-1&&(I[K]=!0),D})}),v(ge,Ee)};_(qe,ge=>{e($e)===1/0?ge(Ke):ge(ie,!1)})}l(Ne),v(Ae,Ne)},ct=Ae=>{var $e=ut(),Be=He($e);{var Ne=Ke=>{const ie=pt(()=>(e(T),n(()=>Ge(e(T)))));var ge=vi(),Ee=i(ge);Le(Ee);var Qe=s(Ee,2),Ce=i(Qe);l(Qe);var g=s(Qe,2),G=i(g,!0);l(g),l(ge),M(()=>{fa(Ee,e(fe)&&e(pe)!==void 0?e(pe):e(ie)),tt(Ee,"max",e(ie)),C(Ce,`/ ${e(ie)??""}`),C(G,(e(T),n(()=>e(T).resetOn==="short"?"Short Rest":"Long Rest")))}),B("input",Ee,ce=>{ee.update(X=>(X.classFeatures.features[e(L)]=parseInt(ce.currentTarget.value)||0,X))}),B("click",g,()=>O(e(L),e(ie))),v(Ke,ge)},qe=Ke=>{var ie=ut(),ge=He(ie);{var Ee=Qe=>{var Ce=ui(),g=i(Ce),G=s(g,2),ce=i(G),X=i(ce);l(ce),l(G);var ve=s(G,2);{var D=I=>{var K=di();v(I,K)};_(ve,I=>{e(ue)<=0&&I(D)})}l(Ce),M(()=>{g.disabled=e(ue)<=0,C(X,`Resets on ${e(T),n(()=>e(T).resetOn==="short"?"Short Rest":"Long Rest")??""}`)}),B("click",g,ne),v(Qe,Ce)};_(ge,Qe=>{e(T),n(()=>e(T).type==="channelDivinity")&&Qe(Ee)},!0)}v(Ke,ie)};_(Be,Ke=>{e(T),n(()=>e(T).type==="pool")?Ke(Ne):Ke(qe,!1)},!0)}v(Ae,$e)};_(Re,Ae=>{e(T),n(()=>e(T).type==="uses")?Ae(Xe):Ae(ct,!1)})}l(V),M(Ae=>{C(be,` ${e(T),n(()=>e(T).name)??""}`),C(Pe,Ae)},[()=>(e(T),n(()=>Oe(e(T))))]),v(ze,V)}),l(le),v(z,le)};_(F,z=>{e(x),n(()=>e(x).length===0)?z(q):z(Z,!1)},!0)}v(ye,b)};_(re,ye=>{t(),n(()=>!t().class)?ye(U):ye(oe,!1)})}v(h,R)};_(k,h=>{m(),n(()=>!m().classFeatures)&&h(de)})}l(Fe),M(()=>De=xt(Fe,1,"class-features svelte-1kpvv0n",null,De,{hidden:!e(te)})),v(a,Fe),Ht(),$()}var hi=f('<textarea placeholder="Enter features, traits, and special abilities..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Equipment</h3> <textarea placeholder="List your equipment and inventory..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Notes</h3> <textarea placeholder="Additional notes..." class="svelte-wttn0l"></textarea>',1),gi=f("<section><!> <!></section>");function _i(a,r){Et(r,!1);const t=()=>st(ea,"$searchFilter",m),c=()=>st(ee,"$character",m),u=()=>st(Tt,"$collapsedStates",m),[m,y]=Wt(),$=j();function w(){Tt.update(te=>({...te,notes:!te.notes}))}Ye(()=>(t(),c()),()=>{o($,!t()||"features".includes(t().toLowerCase())||"traits".includes(t().toLowerCase())||"equipment".includes(t().toLowerCase())||"notes".includes(t().toLowerCase())||c().features.toLowerCase().includes(t().toLowerCase())||c().equipment.toLowerCase().includes(t().toLowerCase())||c().notes.toLowerCase().includes(t().toLowerCase()))}),Jt(),It();var x=gi();let ae;var J=i(x);{let te=pt(()=>(u(),n(()=>u().notes?"Expand":"Collapse")));na(J,{title:"Features & Traits",get collapsed(){return u(),n(()=>u().notes)},get ariaLabel(){return e(te)},onToggle:w})}var ue=s(J,2);{var Y=te=>{var Se=hi(),_e=He(Se);ua(_e);var O=s(_e,4);ua(O);var je=s(O,4);ua(je),Je(_e,()=>c().features,We=>_t(ee,n(c).features=We,n(c))),Je(O,()=>c().equipment,We=>_t(ee,n(c).equipment=We,n(c))),Je(je,()=>c().notes,We=>_t(ee,n(c).notes=We,n(c))),v(te,Se)};_(ue,te=>{u(),n(()=>!u().notes)&&te(Y)})}l(x),M(()=>ae=xt(x,1,"notes svelte-wttn0l",null,ae,{hidden:!e($)})),v(a,x),Ht(),y()}var yi=f('<div class="color-picker-section svelte-1r90jgp"><h3 class="svelte-1r90jgp">Dice Colors</h3> <div class="color-inputs svelte-1r90jgp"><div class="color-input-group svelte-1r90jgp"><label for="dice-color" class="svelte-1r90jgp">Dice Color</label> <input type="color" id="dice-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="label-color" class="svelte-1r90jgp">Label Color</label> <input type="color" id="label-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="desk-color" class="svelte-1r90jgp">Background Color</label> <input type="color" id="desk-color" class="svelte-1r90jgp"/></div></div></div>'),xi=f('<div class="loading svelte-1r90jgp"><p class="svelte-1r90jgp">Loading 3D dice...</p></div>'),ki=f('<div class="custom-dice-selector svelte-1r90jgp"><h3 class="svelte-1r90jgp">Choose Dice to Roll</h3> <div class="dice-inputs svelte-1r90jgp"><div class="dice-input-group svelte-1r90jgp"><label for="d4" class="svelte-1r90jgp">d4</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d4" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d6" class="svelte-1r90jgp">d6</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d6" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d8" class="svelte-1r90jgp">d8</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d8" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d10" class="svelte-1r90jgp">d10</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d10" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d12" class="svelte-1r90jgp">d12</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d12" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d20" class="svelte-1r90jgp">d20</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d20" min="0" max="10"/></div></div> <div class="dice-controls svelte-1r90jgp"><button class="btn btn-primary use-enabled svelte-1r90jgp"> </button> <button class="btn btn-secondary use-enabled svelte-1r90jgp">Reset</button></div></div>'),Si=f('<span class="crit-badge svelte-1r90jgp">CRITICAL HIT!</span>'),$i=f('<span class="crit-badge crit-fail svelte-1r90jgp">CRITICAL MISS!</span>'),Ci=f('<div class="bonus-item svelte-1r90jgp"><span class="bonus-value svelte-1r90jgp"> </span> <span class="bonus-source svelte-1r90jgp"> </span></div>'),Di=f('<div class="bonus-breakdown svelte-1r90jgp"></div>'),wi=f('<p class="modifier-text svelte-1r90jgp"> </p>'),Li=f('<div class="svelte-1r90jgp"><em class="svelte-1r90jgp">No damage is dealt on a critical miss.</em></div>'),ji=f('<button class="btn btn-follow-up svelte-1r90jgp"> </button>'),Ai=f('<button class="btn btn-guided-strike svelte-1r90jgp">‚ö° Use Guided Strike (+10)</button>'),Bi=f('<div class="follow-up-actions svelte-1r90jgp"><!> <!></div>'),Mi=f('<div class="result-header svelte-1r90jgp"><h3 class="svelte-1r90jgp"> </h3> <!> <!></div> <div class="result-total svelte-1r90jgp"> </div> <div class="result-details svelte-1r90jgp"><!></div> <!> <!>',1),Fi=f('<div role="button" tabindex="-1"><div class="modal-content svelte-1r90jgp" role="dialog" tabindex="0"><div class="modal-header svelte-1r90jgp"><h2 class="svelte-1r90jgp">Dice Roller</h2> <div class="header-buttons svelte-1r90jgp"><button class="color-btn svelte-1r90jgp" title="Customize dice colors">üé®</button> <button class="close-btn svelte-1r90jgp">√ó</button></div></div> <!> <!> <div class="dice-main-area svelte-1r90jgp"><div class="dice-container svelte-1r90jgp"></div> <!></div> <div><!></div></div></div>');function Ti(a,r){Et(r,!1);const t=()=>st(ee,"$character",c),[c,u]=Wt(),m=j(),y=j(),$=j(),w=ia();let x=St(r,"notation",12,""),ae=St(r,"visible",8,!1),J=St(r,"damageNotation",12,""),ue=St(r,"attackName",12,""),Y=St(r,"applyHalfDamage",8,!1),te=St(r,"bonusBreakdown",28,()=>[]),Se=St(r,"rollType",12,"other"),_e=null,O=j(void 0),je=j(!1),We=j(""),se=j(null);function Ge(){return e(se)?.resultTotal??null}function Oe(g,G,ce){const X=[];if(!g||!g.result)return X;const ve=G.match(/([+-]?\d*d\d+|[+-]?\d+)/g)||[];let D=0;const I=new Set;for(const K of ve){const E=K.trim();if(!E)continue;const Q=E.match(/([+-]?)(\d*)d(\d+)/);if(Q){const Ie=parseInt(Q[2]||"1"),N=`${Ie}d${Q[3]}`,at=ce.findIndex((p,P)=>!I.has(P)&&typeof p.value=="string"&&p.value===N),lt=[];for(let p=0;p<Ie&&D<g.result.length;p++)lt.push(g.result[D++]);const it=at>=0?ce[at].source:"base die";at>=0&&I.add(at);for(const p of lt)X.push({display:`${p}`,source:it})}}for(let K=0;K<ce.length;K++)if(!I.has(K)&&typeof ce[K].value=="number"){const E=ce[K].value;X.push({display:E>=0?`+${E}`:`${E}`,source:ce[K].source})}return X}let ne=j(0),xe=j(0),Fe=j(0),De=j(0),Te=j(0),k=j(0),de=j(0),h=j([]),R=j(!1),re=j(!1),U=j(!1),oe=j("#051e0a"),ye=j("#ffffff"),b=j("#3a2004"),F=j(!1);function q(g){return g.length===9&&g.startsWith("#")?g.substring(0,7):g}function Z(g,G="ff"){return g.length===7&&g.startsWith("#")?g+G:g}function z(){if(window.DICE&&e(O))try{_e&&e(O)&&sa(O,e(O).innerHTML="");const g=e(O).clientWidth||500,G=e(O).clientHeight||300;_e=new window.DICE.dice_box(e(O),{w:g,h:G}),o(je,!0)}catch(g){console.error("Error initializing dice box:",g)}}ca(()=>{const g=X=>new Promise((ve,D)=>{if(document.querySelector(`script[src="${X}"]`)){ve(null);return}const K=document.createElement("script");K.src=X,K.onload=()=>{ve(null)},K.onerror=()=>{console.error(`Failed to load: ${X}`),D(new Error(`Failed to load ${X}`))},document.head.appendChild(K)});setTimeout(()=>{g(`${da}/libs/three.min.js`).then(()=>g(`${da}/libs/cannon.min.js`)).then(()=>g(`${da}/libs/teal.js`)).then(()=>g(`${da}/dice.js`)).then(()=>{if(window.DICE){const X=window.DICE.getColors();o(oe,q(X.dice_color)),o(ye,q(X.label_color)),o(b,q(X.desk_color))}z()}).catch(X=>{console.error("Failed to load dice libraries:",X)})},100);const G=()=>{e(je)&&z()},ce=X=>{ae()&&X.key==="Escape"&&fe()};return window.addEventListener("resize",G),window.addEventListener("keydown",ce),()=>{window.removeEventListener("resize",G),window.removeEventListener("keydown",ce)}});function le(g,G="other"){if(!_e||!e(je))return;o(se,null),o(h,[]),o(R,!1),o(re,!1),G==="damage"&&te([]),Se(G),o(U,!1),_e.diceToRoll=g;const ce=ve=>null,X=ve=>{let D=ve.resultTotal,I=ve.resultString;if(Y()&&(D=Math.floor(D/2),I=I+" (halved)"),o(se,{...ve,resultTotal:D,resultString:I}),console.log("Final roll result:",e(se)),console.log({type:G}),G==="attack"&&ve.result&&ve.result.length>0){const K=ve.result[0];o(R,K===20),o(re,K===1)}if(o(h,[]),console.log("Setting up follow-up actions. Type:",G,"damageNotation:",J(),"isCriticalSuccess:",e(R),"isCriticalFail:",e(re)),G==="attack"&&J())if(e(R)){const K=ke(J());e(h).push({label:`Roll Critical Damage (${K})`,notation:K})}else e(re)||e(h).push({label:`Roll Damage (${J()})`,notation:J()})};_e.start_throw(ce,X)}function we(){const g=[];e(ne)>0&&g.push(`${e(ne)}d4`),e(xe)>0&&g.push(`${e(xe)}d6`),e(Fe)>0&&g.push(`${e(Fe)}d8`),e(De)>0&&g.push(`${e(De)}d10`),e(Te)>0&&g.push(`${e(Te)}d12`),e(k)>0&&g.push(`${e(k)}d20`);let G=g.join("+")||"1d20";return e(de)!==0&&(G+=e(de)>=0?`+${e(de)}`:`${e(de)}`),G}function vt(){const g=we();le(g)}function ke(g){return g.replace(/(\d+)d(\d+)/g,(G,ce,X)=>`${parseInt(ce)*2}d${X}`)}function ze(){o(ne,0),o(xe,0),o(Fe,0),o(De,0),o(Te,0),o(k,0),o(de,0),o(se,null),o(h,[]),o(R,!1),o(re,!1),Se("other"),o(U,!1)}function T(){window.DICE&&(window.DICE.setColors({dice_color:Z(e(oe),"ff"),label_color:Z(e(ye),"ff"),desk_color:e(b)}),_e&&(_e.updateDeskColor(e(b)),_e.updateDiceColors()))}function L(){o(F,!e(F))}function pe(){!e(se)||e(y)<=0||e(U)||(o(se,{...e(se),resultTotal:e(se).resultTotal+10,resultString:e(se).resultString+" + 10 (Guided Strike)"}),ee.update(g=>{const G="ChannelDivinity",ce=g.classFeatures.features[G];return typeof ce=="number"&&ce>0&&(g.classFeatures.features[G]=ce-1),g}),o(U,!0))}function fe(){w("close"),x(""),J(""),ue(""),o(We,""),o(se,null),o(U,!1),o(R,!1),o(re,!1),ze()}Ye(()=>(t(),oa),()=>{o(m,t().class?oa(t().class,t().level,t().subclass).some(G=>G.name==="Guided Strike"):!1)}),Ye(()=>t(),()=>{o(y,(()=>{const G=t().classFeatures.features["ChannelDivinity"];return typeof G=="number"?G:0})())}),Ye(()=>(e(ne),e(xe),e(Fe),e(De),e(Te),e(k),e(de)),()=>{o($,(()=>{const g=[];e(ne)>0&&g.push(`${e(ne)}d4`),e(xe)>0&&g.push(`${e(xe)}d6`),e(Fe)>0&&g.push(`${e(Fe)}d8`),e(De)>0&&g.push(`${e(De)}d10`),e(Te)>0&&g.push(`${e(Te)}d12`),e(k)>0&&g.push(`${e(k)}d20`);let G=g.join("+")||"1d20";return e(de)!==0&&(G+=e(de)>=0?`+${e(de)}`:`${e(de)}`),G})())}),Ye(()=>(H(x()),e(je),H(ae()),e(We),H(J()),H(ue()),H(Se())),()=>{x()&&e(je)&&ae()&&x()!==e(We)&&(o(We,x()),o(se,null),o(h,[]),o(R,!1),o(re,!1),o(U,!1),console.log("Auto-roll triggered. notation:",x(),"damageNotation:",J(),"attackName:",ue(),"rollType:",Se()),setTimeout(()=>le(x(),Se()),200))}),Jt();var V={getLastRollTotal:Ge};It();var d=Fi();let Ve;var he=i(d),be=i(he),A=s(i(be),2),Pe=i(A),Re=s(Pe,2);l(A),l(be);var Xe=s(be,2);{var ct=g=>{var G=yi(),ce=s(i(G),2),X=i(ce),ve=s(i(X),2);Le(ve),l(X);var D=s(X,2),I=s(i(D),2);Le(I),l(D);var K=s(D,2),E=s(i(K),2);Le(E),l(K),l(ce),l(G),Je(ve,()=>e(oe),Q=>o(oe,Q)),B("change",ve,T),Je(I,()=>e(ye),Q=>o(ye,Q)),B("change",I,T),Je(E,()=>e(b),Q=>o(b,Q)),B("change",E,T),v(g,G)};_(Xe,g=>{e(F)&&g(ct)})}var Ae=s(Xe,2);{var $e=g=>{var G=xi();v(g,G)};_(Ae,g=>{e(je)||g($e)})}var Be=s(Ae,2),Ne=i(Be);xa(Ne,g=>o(O,g),()=>e(O));var qe=s(Ne,2);{var Ke=g=>{var G=ki(),ce=s(i(G),2),X=i(ce),ve=s(i(X),2);Le(ve),l(X);var D=s(X,2),I=s(i(D),2);Le(I),l(D);var K=s(D,2),E=s(i(K),2);Le(E),l(K);var Q=s(K,2),Ie=s(i(Q),2);Le(Ie),l(Q);var N=s(Q,2),at=s(i(N),2);Le(at),l(N);var lt=s(N,2),it=s(i(lt),2);Le(it),l(lt),l(ce);var p=s(ce,2),P=i(p),S=i(P);l(P);var me=s(P,2);l(p),l(G),M(()=>{P.disabled=!e(je),C(S,`Roll ${e($)??""}`)}),Je(ve,()=>e(ne),W=>o(ne,W)),Je(I,()=>e(xe),W=>o(xe,W)),Je(E,()=>e(Fe),W=>o(Fe,W)),Je(Ie,()=>e(De),W=>o(De,W)),Je(at,()=>e(Te),W=>o(Te,W)),Je(it,()=>e(k),W=>o(k,W)),B("click",P,vt),B("click",me,ze),v(g,G)};_(qe,g=>{x()||g(Ke)})}l(Be);var ie=s(Be,2);let ge;var Ee=i(ie);{var Qe=g=>{var G=Mi(),ce=He(G),X=i(ce),ve=i(X,!0);l(X);var D=s(X,2);{var I=me=>{var W=Si();v(me,W)};_(D,me=>{e(R)&&me(I)})}var K=s(D,2);{var E=me=>{var W=$i();v(me,W)};_(K,me=>{e(re)&&me(E)})}l(ce);var Q=s(ce,2),Ie=i(Q,!0);l(Q);var N=s(Q,2),at=i(N);{var lt=me=>{var W=ut(),Ze=He(W);{var Me=Ue=>{var nt=Di();yt(nt,5,()=>(e(se),H(x()),H(te()),n(()=>Oe(e(se),x(),te()))),kt,(rt,dt)=>{var ht=Ci(),gt=i(ht),et=i(gt,!0);l(gt);var ot=s(gt,2),bt=i(ot);l(ot),l(ht),M(()=>{C(et,(e(dt),n(()=>e(dt).display))),C(bt,`(${e(dt),n(()=>e(dt).source)??""})`)}),v(rt,ht)}),l(nt),v(Ue,nt)},ft=Ue=>{var nt=ut(),rt=He(nt);{var dt=ht=>{var gt=wi(),et=i(gt);l(gt),M(()=>C(et,`Modifier: ${e(se),n(()=>e(se).constant>=0?"+":"")??""}${e(se),n(()=>e(se).constant)??""}`)),v(ht,gt)};_(rt,ht=>{e(se),n(()=>e(se).constant)&&ht(dt)},!0)}v(Ue,nt)};_(Ze,Ue=>{H(te()),n(()=>te().length>0)?Ue(Me):Ue(ft,!1)})}v(me,W)};_(at,me=>{e(se),H(te()),n(()=>e(se).constant||te().length>0)&&me(lt)})}l(N);var it=s(N,2);{var p=me=>{var W=Li();v(me,W)};_(it,me=>{e(re)&&me(p)})}var P=s(it,2);{var S=me=>{var W=Bi(),Ze=i(W);yt(Ze,1,()=>e(h),kt,(Ue,nt)=>{var rt=ji(),dt=i(rt,!0);l(rt),M(()=>C(dt,(e(nt),n(()=>e(nt).label)))),B("click",rt,()=>le(e(nt).notation,"damage")),v(Ue,rt)});var Me=s(Ze,2);{var ft=Ue=>{var nt=Ai();M(()=>{nt.disabled=e(y)<=0,tt(nt,"title",e(y)<=0?"No Channel Divinity uses remaining":"Use Channel Divinity to add +10 to this attack roll")}),B("click",nt,pe),v(Ue,nt)};_(Me,Ue=>{e(m)&&Se()==="attack"&&!e(U)&&e(y)>0&&!e(re)&&Ue(ft)})}l(W),v(me,W)};_(P,me=>{e(h),e(m),H(Se()),e(U),e(y),n(()=>e(h).length>0||e(m)&&Se()==="attack"&&!e(U)&&e(y)>0)&&me(S)})}M(()=>{C(ve,ue()?`${ue()} - Result`:"Result"),C(Ie,(e(se),n(()=>e(se).resultTotal)))}),v(g,G)};_(Ee,g=>{e(se)&&g(Qe)})}l(ie),l(he),l(d),M(()=>{Ve=xt(d,1,"modal-overlay svelte-1r90jgp",null,Ve,{hidden:!ae()}),ge=xt(ie,1,"roll-result svelte-1r90jgp",null,ge,{"has-result":e(se)})}),B("click",Pe,L),B("click",Re,fe),B("click",he,Ha(function(g){ra.call(this,r,g)})),B("keydown",he,function(g){ra.call(this,r,g)}),B("click",d,fe),B("keydown",d,g=>g.key==="Escape"&&fe()),v(a,d),js(r,"getLastRollTotal",Ge);var Ce=Ht(V);return u(),Ce}const wa="https://api.github.com/gists";async function Pi(a,r,t){if(!r)throw new Error("GitHub token is required");const c=JSON.stringify(a,null,2),u=`${a.name||"character"}_dnd.json`,m={description:t||`D&D Character: ${a.name}`,public:!1,files:{[u]:{content:c}}},y=await fetch(wa,{method:"POST",headers:{Authorization:`token ${r}`,"Content-Type":"application/json"},body:JSON.stringify(m)});if(!y.ok)throw new Error(`Failed to create gist: ${y.statusText}`);return(await y.json()).id}async function Ri(a,r,t){if(!r||!t)throw new Error("GitHub token and Gist ID are required");const c=JSON.stringify(a,null,2),m={files:{[`${a.name||"character"}_dnd.json`]:{content:c}}},y=await fetch(`${wa}/${t}`,{method:"PATCH",headers:{Authorization:`token ${r}`,"Content-Type":"application/json"},body:JSON.stringify(m)});if(!y.ok)throw new Error(`Failed to update gist: ${y.statusText}`)}async function Ii(a,r){if(!a)throw new Error("Gist ID is required");const t={"Content-Type":"application/json"};r&&(t.Authorization=`token ${r}`);const c=await fetch(`${wa}/${a}`,{method:"GET",headers:t});if(!c.ok)throw new Error(`Failed to load gist: ${c.statusText}`);const u=await c.json(),m=Object.values(u.files);if(m.length===0)throw new Error("No files found in gist");const $=m[0].content;try{const w=JSON.parse($);return w.attacks&&Array.isArray(w.attacks)&&(w.attacks=w.attacks.map(x=>({...x,id:x.id||crypto.randomUUID()}))),w.classFeatures?(w.classFeatures.features||(w.classFeatures.features={}),w.classFeatures.spellSlots||(w.classFeatures.spellSlots=[]),w.classFeatures.preparedSpells===void 0&&(w.classFeatures.preparedSpells="")):w.classFeatures={features:{},spellSlots:[],preparedSpells:""},w}catch{throw new Error("Invalid character data in gist")}}function Qa(a){typeof window<"u"&&localStorage.setItem("dnd_gist_config",JSON.stringify(a))}function Ei(){if(typeof window<"u"){const a=localStorage.getItem("dnd_gist_config");if(a)return JSON.parse(a)}return{}}async function Hi(a,r=30){if(!a)throw new Error("GitHub token is required to list gists");const t=await fetch(`${wa}?per_page=${r}`,{method:"GET",headers:{Authorization:`token ${a}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error(`Failed to list gists: ${t.statusText}`);return await t.json()}var Ni=f('<div class="error-message svelte-1jb5ckg"> </div>'),Ui=f('<div class="toggle-container svelte-1jb5ckg"><button type="button" class="toggle-btn svelte-1jb5ckg"> </button></div>'),Gi=f('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID (leave empty to create new)</label> <input type="text" id="gistId" placeholder="Optional: existing Gist ID to update" class="svelte-1jb5ckg"/></div>'),Oi=f('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),qi=f('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),Wi=f('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Update (or leave unselected to create new)</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),zi=f('<div class="info-message svelte-1jb5ckg">No gists found. A new one will be created.</div>'),Ki=f('<!> <div class="form-group svelte-1jb5ckg"><label for="description" class="svelte-1jb5ckg"> </label> <input type="text" id="description" placeholder="D&amp;D Character Sheet" class="svelte-1jb5ckg"/></div>',1),Vi=f('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID *</label> <input type="text" id="gistId" placeholder="Enter Gist ID (for public or your private gists)" required class="svelte-1jb5ckg"/></div>'),Ji=f('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),Qi=f('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),Yi=f('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Load</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),Xi=f('<div class="info-message svelte-1jb5ckg">No gists found. Enter a Gist ID manually or create a new one in Save mode.</div>'),Zi=f('<div class="modal-overlay svelte-1jb5ckg" role="button" tabindex="-1"><div class="modal-content svelte-1jb5ckg" role="dialog" tabindex="0"><div class="modal-header svelte-1jb5ckg"><h2 class="svelte-1jb5ckg"> </h2> <button class="close-btn svelte-1jb5ckg">√ó</button></div> <div class="modal-body svelte-1jb5ckg"><!> <div class="form-group svelte-1jb5ckg"><label for="token" class="svelte-1jb5ckg"> <a href="https://github.com/settings/tokens" target="_blank" rel="noopener" class="svelte-1jb5ckg">Get token</a></label> <input type="password" id="token" placeholder="ghp_xxxxxxxxxxxxx" class="svelte-1jb5ckg"/></div> <!> <!> <div class="modal-actions svelte-1jb5ckg"><button class="btn btn-primary svelte-1jb5ckg"><!></button> <button class="btn btn-secondary svelte-1jb5ckg">Cancel</button></div></div></div></div>');function en(a,r){Et(r,!1);const t=()=>st(ee,"$character",c),[c,u]=Wt(),m=ia();let y=St(r,"mode",8,"save"),$=j(""),w=j(""),x=j(""),ae=j(!1),J=j(""),ue=j(!1),Y=j(!1),te=j([]),Se=j(null);const _e=Ei();_e.token&&o($,_e.token),_e.gistId&&o(w,_e.gistId),ca(async()=>{e($)&&!e(ue)&&await O()});async function O(){if(e($)){o(Y,!0),o(J,"");try{o(te,await Hi(e($))),e(w)&&o(Se,e(te).find(L=>L.id===e(w))||null)}catch(L){o(J,L.message||"Failed to load gists"),o(te,[])}finally{o(Y,!1)}}}function je(L){o(Se,L),o(w,L.id)}function We(){o(ue,!e(ue)),o(J,""),!e(ue)&&e($)&&O()}async function se(){if(!e($)){o(J,"GitHub token is required");return}const L=e(Se)?.id||e(w);o(ae,!0),o(J,"");try{if(L)await Ri(t(),e($),L),o(w,L),qt.add("Character updated in Gist successfully!","success");else{const pe=await Pi(t(),e($),e(x));o(w,pe),qt.add(`Character saved to Gist! ID: ${pe}`,"success")}Qa({token:e($),gistId:e(w)}),m("close")}catch(pe){o(J,pe.message||"Failed to save to Gist")}finally{o(ae,!1)}}async function Ge(){const L=e(Se)?.id||e(w);if(!L){o(J,"Please select a gist or enter a Gist ID");return}o(ae,!0),o(J,"");try{const pe=await Ii(L,e($)||void 0);ee.set(pe),o(w,L),Qa({token:e($),gistId:e(w)}),qt.add("Character loaded from Gist successfully!","success"),m("close")}catch(pe){o(J,pe.message||"Failed to load from Gist")}finally{o(ae,!1)}}function Oe(){m("close")}It();var ne=Zi(),xe=i(ne),Fe=i(xe),De=i(Fe),Te=i(De,!0);l(De);var k=s(De,2);l(Fe);var de=s(Fe,2),h=i(de);{var R=L=>{var pe=Ni(),fe=i(pe,!0);l(pe),M(()=>C(fe,e(J))),v(L,pe)};_(h,L=>{e(J)&&L(R)})}var re=s(h,2),U=i(re),oe=i(U);la(),l(U);var ye=s(U,2);Le(ye),l(re);var b=s(re,2);{var F=L=>{var pe=Ui(),fe=i(pe),V=i(fe,!0);l(fe),l(pe),M(()=>{fe.disabled=e(ae),C(V,e(ue)?"üìã Show My Gists":"‚úèÔ∏è Enter Gist ID Manually")}),B("click",fe,We),v(L,pe)};_(b,L=>{(y()==="load"||y()==="save"&&e($))&&L(F)})}var q=s(b,2);{var Z=L=>{var pe=Ki(),fe=He(pe);{var V=Pe=>{var Re=Gi(),Xe=s(i(Re),2);Le(Xe),l(Re),M(()=>Xe.disabled=e(ae)),Je(Xe,()=>e(w),ct=>o(w,ct)),v(Pe,Re)},d=Pe=>{var Re=ut(),Xe=He(Re);{var ct=$e=>{var Be=Oi();v($e,Be)},Ae=$e=>{var Be=ut(),Ne=He(Be);{var qe=ie=>{var ge=Wi(),Ee=s(i(ge),2);yt(Ee,5,()=>e(te),kt,(Qe,Ce)=>{var g=qi();let G;var ce=i(g),X=i(ce),ve=i(X,!0);l(X);var D=s(X,2),I=i(D,!0);l(D),l(ce);var K=s(ce,2),E=i(K),Q=i(E);l(E);var Ie=s(E,2),N=i(Ie);l(Ie),l(K),l(g),M(at=>{G=xt(g,1,"gist-item svelte-1jb5ckg",null,G,{selected:e(Se)?.id===e(Ce).id}),g.disabled=e(ae),C(ve,(e(Ce),n(()=>e(Ce).description||"Untitled"))),C(I,(e(Ce),n(()=>e(Ce).public?"üåê Public":"üîí Private"))),C(Q,`ID: ${e(Ce),n(()=>e(Ce).id)??""}`),C(N,`Updated: ${at??""}`)},[()=>(e(Ce),n(()=>new Date(e(Ce).updated_at).toLocaleDateString()))]),B("click",g,()=>je(e(Ce))),v(Qe,g)}),l(Ee),l(ge),v(ie,ge)},Ke=ie=>{var ge=ut(),Ee=He(ge);{var Qe=Ce=>{var g=zi();v(Ce,g)};_(Ee,Ce=>{e($)&&Ce(Qe)},!0)}v(ie,ge)};_(Ne,ie=>{e(te),n(()=>e(te).length>0)?ie(qe):ie(Ke,!1)},!0)}v($e,Be)};_(Xe,$e=>{e(Y)?$e(ct):$e(Ae,!1)},!0)}v(Pe,Re)};_(fe,Pe=>{e(ue)||!e($)?Pe(V):Pe(d,!1)})}var Ve=s(fe,2),he=i(Ve),be=i(he);l(he);var A=s(he,2);Le(A),l(Ve),M(()=>{C(be,`Description ${e(w)?"(optional)":""}`),A.disabled=e(ae)}),Je(A,()=>e(x),Pe=>o(x,Pe)),v(L,pe)},z=L=>{var pe=ut(),fe=He(pe);{var V=Ve=>{var he=Vi(),be=s(i(he),2);Le(be),l(he),M(()=>be.disabled=e(ae)),Je(be,()=>e(w),A=>o(w,A)),v(Ve,he)},d=Ve=>{var he=ut(),be=He(he);{var A=Re=>{var Xe=Ji();v(Re,Xe)},Pe=Re=>{var Xe=ut(),ct=He(Xe);{var Ae=Be=>{var Ne=Yi(),qe=s(i(Ne),2);yt(qe,5,()=>e(te),kt,(Ke,ie)=>{var ge=Qi();let Ee;var Qe=i(ge),Ce=i(Qe),g=i(Ce,!0);l(Ce);var G=s(Ce,2),ce=i(G,!0);l(G),l(Qe);var X=s(Qe,2),ve=i(X),D=i(ve);l(ve);var I=s(ve,2),K=i(I);l(I),l(X),l(ge),M(E=>{Ee=xt(ge,1,"gist-item svelte-1jb5ckg",null,Ee,{selected:e(Se)?.id===e(ie).id}),ge.disabled=e(ae),C(g,(e(ie),n(()=>e(ie).description||"Untitled"))),C(ce,(e(ie),n(()=>e(ie).public?"üåê Public":"üîí Private"))),C(D,`ID: ${e(ie),n(()=>e(ie).id)??""}`),C(K,`Updated: ${E??""}`)},[()=>(e(ie),n(()=>new Date(e(ie).updated_at).toLocaleDateString()))]),B("click",ge,()=>je(e(ie))),v(Ke,ge)}),l(qe),l(Ne),v(Be,Ne)},$e=Be=>{var Ne=ut(),qe=He(Ne);{var Ke=ie=>{var ge=Xi();v(ie,ge)};_(qe,ie=>{e($)&&ie(Ke)},!0)}v(Be,Ne)};_(ct,Be=>{e(te),n(()=>e(te).length>0)?Be(Ae):Be($e,!1)},!0)}v(Re,Xe)};_(be,Re=>{e(Y)?Re(A):Re(Pe,!1)},!0)}v(Ve,he)};_(fe,Ve=>{e(ue)||!e($)?Ve(V):Ve(d,!1)},!0)}v(L,pe)};_(q,L=>{y()==="save"?L(Z):L(z,!1)})}var le=s(q,2),we=i(le),vt=i(we);{var ke=L=>{var pe=Ft();M(()=>C(pe,y()==="save"?"Saving...":"Loading...")),v(L,pe)},ze=L=>{var pe=Ft();M(()=>C(pe,y()==="save"?"Save":"Load")),v(L,pe)};_(vt,L=>{e(ae)?L(ke):L(ze,!1)})}l(we);var T=s(we,2);l(le),l(de),l(xe),l(ne),M(()=>{C(Te,y()==="save"?"Save to GitHub Gist":"Load from GitHub Gist"),C(oe,`GitHub Token ${y()==="load"?"(optional for public gists)":"(required)"} `),ye.disabled=e(ae),we.disabled=e(ae),T.disabled=e(ae)}),B("click",k,Oe),Je(ye,()=>e($),L=>o($,L)),B("blur",ye,()=>{e($)&&!e(ue)&&O()}),B("click",we,function(...L){(y()==="save"?se:Ge)?.apply(this,L)}),B("click",T,Oe),B("click",xe,Ha(function(L){ra.call(this,r,L)})),B("keydown",xe,function(L){ra.call(this,r,L)}),B("click",ne,Oe),B("keydown",ne,L=>L.key==="Escape"&&Oe()),v(a,ne),Ht(),u()}var tn=f('<div class="loading svelte-1ngjemu">Loading D&D data...</div>'),an=f("<option> </option>"),sn=f('<select class="level-filter svelte-1ngjemu"><option>All Levels</option><option>Cantrip</option><!></select>'),ln=f('<div class="no-results svelte-1ngjemu"> </div>'),nn=f('<div class="item-meta svelte-1ngjemu"> </div>'),rn=f('<div class="item-meta svelte-1ngjemu"> </div>'),on=f('<button><div class="item-name svelte-1ngjemu"> </div> <!></button>'),cn=f('<p class="higher-levels"><strong>At Higher Levels:</strong> </p>'),vn=f('<p class="cantrip-upgrade"><strong>Cantrip Upgrade:</strong> </p>'),dn=f('<h3 class="svelte-1ngjemu"> </h3> <p class="spell-meta svelte-1ngjemu"><!> <!></p> <p class="spell-classes"><strong>Classes:</strong> </p> <div class="spell-stats svelte-1ngjemu"><div><strong>Casting Time:</strong> </div> <div><strong>Range:</strong> </div> <div><strong>Components:</strong> <!></div> <div><strong>Duration:</strong> <!> </div></div> <p class="description svelte-1ngjemu"> </p> <!> <!>',1),un=f('<p class="prerequisite svelte-1ngjemu"><strong>Prerequisite:</strong> </p>'),pn=f('<h3 class="svelte-1ngjemu"> </h3> <!> <p class="description svelte-1ngjemu"> </p> <a target="_blank" rel="noopener" class="source-link svelte-1ngjemu">View Full Details ‚Üí</a>',1),fn=f('<div class="item-details svelte-1ngjemu"><!></div>'),bn=f('<div class="controls svelte-1ngjemu"><div class="tabs svelte-1ngjemu"><button> </button> <button> </button></div> <div class="search-controls svelte-1ngjemu"><input type="text" placeholder="Search by name or description..." class="search-input svelte-1ngjemu"/> <!></div></div> <div class="content-container svelte-1ngjemu"><div class="items-list svelte-1ngjemu"><!></div> <!></div>',1),mn=f('<div class="modal-backdrop svelte-1ngjemu" role="presentation"><div class="modal svelte-1ngjemu" role="dialog" aria-modal="true" tabindex="-1"><div class="modal-header svelte-1ngjemu"><h2 class="svelte-1ngjemu">Browse D&D Spells & Feats</h2> <button class="close-btn svelte-1ngjemu" aria-label="Close">&times;</button></div> <div class="modal-body svelte-1ngjemu"><!></div> <div class="modal-footer svelte-1ngjemu"><button class="btn-secondary svelte-1ngjemu">Cancel</button> <button class="btn-primary svelte-1ngjemu">Add to Character Sheet</button></div></div></div>');function hn(a,r){Et(r,!1);const t=j(),c=j(),u=j();let m=St(r,"onClose",8),y=j("spell"),$=j(!0),w=j(""),x=j(null),ae=j([]),J=j([]),ue=j(null);ca(async()=>{o($,!0);try{o(ae,await ns()),o(J,await vl())}catch(k){console.error("Failed to load data:",k)}finally{o($,!1)}});function Y(k){o(ue,k)}function te(k){const de=k.match(/(\d+d\d+(?:\s*\+\s*\d+)?)/i);return de?de[1]:""}function Se(k){const de=k.split(/\.( |$)/)[0].trim(),h=Array.from(k.matchAll(/\*\*(.*?)\*\*/g)).map(re=>re[1].replace(/\.$/,""));let R=de;return h.length&&(R+=" | Effects: "+h.join(", ")),R}function _e(){if(e(ue)){if(e(y)==="spell"){const k=e(ue);ee.update(de=>{const R=[];k.range&&R.push(`Range: ${k.range}`),k.castingTime&&R.push(`Cast: ${k.castingTime}`),k.duration&&R.push(`Duration: ${k.duration}`),k.actionType==="Save"&&R.push("Saving throw spell"),k.components&&k.components.length>0&&R.push(`Components: ${k.components.join(", ")}`),k.material&&R.push(`Material: ${k.material}`);const re=R.join(" | "),U=Se(k.description),oe={id:crypto.randomUUID(),name:`${k.name}${k.concentration?" (C)":""}${k.ritual?" (R)":""}`,bonus:k.actionType==="Attack"?5:0,damage:te(k.description),damageType:`${k.school} (Lvl ${k.level})`,spellRef:k.name,infoNotes:re,generalNotes:U,castAtLevel:k.level};return de.attacks=[...de.attacks,oe],de})}else if(e(y)==="feat"){const k=e(ue);ee.update(de=>{const h=`${k.name}${k.prerequisite?` (Req: ${k.prerequisite})`:""}
${k.description}
`;return de.features=de.features?`${de.features}
${h}`:h,de})}o(ue,null),m()()}}Ye(()=>(e(x),e(ae),e(w)),()=>{o(t,e(x)!==null?dl(Ka(e(ae),e(w)),e(x)):Ka(e(ae),e(w)))}),Ye(()=>(e(J),e(w)),()=>{o(c,ul(e(J),e(w)))}),Ye(()=>(e(y),e(t),e(c)),()=>{o(u,e(y)==="spell"?e(t):e(c))}),Jt(),It();var O=mn(),je=i(O),We=i(je),se=s(i(We),2);l(We);var Ge=s(We,2),Oe=i(Ge);{var ne=k=>{var de=tn();v(k,de)},xe=k=>{var de=bn(),h=He(de),R=i(h),re=i(R);let U;var oe=i(re);l(re);var ye=s(re,2);let b;var F=i(ye);l(ye),l(R);var q=s(R,2),Z=i(q);Le(Z);var z=s(Z,2);{var le=fe=>{var V=sn();M(()=>{e(x),Ct(()=>{})});var d=i(V);d.value=(d.__value=null)??"";var Ve=s(d);Ve.value=Ve.__value=0;var he=s(Ve);yt(he,0,()=>[1,2,3,4,5,6,7,8,9],kt,(be,A)=>{var Pe=an(),Re=i(Pe);l(Pe);var Xe={};M(()=>{C(Re,`Level ${A??""}`),Xe!==(Xe=A)&&(Pe.value=(Pe.__value=A)??"")}),v(be,Pe)}),l(V),Sa(V,()=>e(x),be=>o(x,be)),v(fe,V)};_(z,fe=>{e(y)==="spell"&&fe(le)})}l(q),l(h);var we=s(h,2),vt=i(we),ke=i(vt);{var ze=fe=>{var V=ln(),d=i(V);l(V),M(()=>C(d,`No ${e(y)??""}s found`)),v(fe,V)},T=fe=>{var V=ut(),d=He(V);yt(d,1,()=>e(u),kt,(Ve,he)=>{var be=on();let A;var Pe=i(be),Re=i(Pe,!0);l(Pe);var Xe=s(Pe,2);{var ct=$e=>{const Be=pt(()=>e(he));var Ne=nn(),qe=i(Ne);l(Ne),M(()=>C(qe,`Level ${H(e(Be)),n(()=>e(Be).level)??""} ‚Ä¢ ${H(e(Be)),n(()=>e(Be).school)??""}`)),v($e,Ne)},Ae=$e=>{const Be=pt(()=>e(he));var Ne=ut(),qe=He(Ne);{var Ke=ie=>{var ge=rn(),Ee=i(ge,!0);l(ge),M(()=>C(Ee,(H(e(Be)),n(()=>e(Be).prerequisite)))),v(ie,ge)};_(qe,ie=>{H(e(Be)),n(()=>e(Be).prerequisite)&&ie(Ke)})}v($e,Ne)};_(Xe,$e=>{e(y)==="spell"?$e(ct):$e(Ae,!1)})}l(be),M(()=>{A=xt(be,1,"item-card svelte-1ngjemu",null,A,{selected:e(ue)?.name===e(he).name}),C(Re,(e(he),n(()=>e(he).name)))}),B("click",be,()=>Y(e(he))),v(Ve,be)}),v(fe,V)};_(ke,fe=>{e(u),n(()=>e(u).length===0)?fe(ze):fe(T,!1)})}l(vt);var L=s(vt,2);{var pe=fe=>{var V=fn(),d=i(V);{var Ve=be=>{const A=pt(()=>e(ue));var Pe=dn(),Re=He(Pe),Xe=i(Re,!0);l(Re);var ct=s(Re,2),Ae=i(ct);{var $e=p=>{var P=Ft();M(()=>C(P,`${H(e(A)),n(()=>e(A).school)??""} cantrip`)),v(p,P)},Be=p=>{var P=Ft();M(()=>C(P,`Level ${H(e(A)),n(()=>e(A).level)??""} ${H(e(A)),n(()=>e(A).school)??""}`)),v(p,P)};_(Ae,p=>{H(e(A)),n(()=>e(A).level===0)?p($e):p(Be,!1)})}var Ne=s(Ae,2);{var qe=p=>{var P=Ft("(ritual)");v(p,P)};_(Ne,p=>{H(e(A)),n(()=>e(A).ritual)&&p(qe)})}l(ct);var Ke=s(ct,2),ie=s(i(Ke));l(Ke);var ge=s(Ke,2),Ee=i(ge),Qe=s(i(Ee));l(Ee);var Ce=s(Ee,2),g=s(i(Ce));l(Ce);var G=s(Ce,2),ce=s(i(G)),X=s(ce);{var ve=p=>{var P=Ft();M(()=>C(P,`(${H(e(A)),n(()=>e(A).material)??""})`)),v(p,P)};_(X,p=>{H(e(A)),n(()=>e(A).material)&&p(ve)})}l(G);var D=s(G,2),I=s(i(D),2);{var K=p=>{var P=Ft("Concentration,");v(p,P)};_(I,p=>{H(e(A)),n(()=>e(A).concentration)&&p(K)})}var E=s(I,1,!0);l(D),l(ge);var Q=s(ge,2),Ie=i(Q,!0);l(Q);var N=s(Q,2);{var at=p=>{var P=cn(),S=s(i(P));l(P),M(()=>C(S,` ${H(e(A)),n(()=>e(A).higherLevelSlot)??""}`)),v(p,P)};_(N,p=>{H(e(A)),n(()=>e(A).higherLevelSlot)&&p(at)})}var lt=s(N,2);{var it=p=>{var P=vn(),S=s(i(P));l(P),M(()=>C(S,` ${H(e(A)),n(()=>e(A).cantripUpgrade)??""}`)),v(p,P)};_(lt,p=>{H(e(A)),n(()=>e(A).cantripUpgrade)&&p(it)})}M((p,P)=>{C(Xe,(H(e(A)),n(()=>e(A).name))),C(ie,` ${p??""}`),C(Qe,` ${H(e(A)),n(()=>e(A).castingTime||e(A).actionType)??""}`),C(g,` ${H(e(A)),n(()=>e(A).range)??""}`),C(ce,` ${P??""}`),C(E,(H(e(A)),n(()=>e(A).duration))),C(Ie,(H(e(A)),n(()=>e(A).description)))},[()=>(H(e(A)),n(()=>e(A).classes.join(", "))),()=>(H(e(A)),n(()=>e(A).components.join(", ").toUpperCase()))]),v(be,Pe)},he=be=>{const A=pt(()=>e(ue));var Pe=pn(),Re=He(Pe),Xe=i(Re,!0);l(Re);var ct=s(Re,2);{var Ae=qe=>{var Ke=un(),ie=s(i(Ke));l(Ke),M(()=>C(ie,` ${H(e(A)),n(()=>e(A).prerequisite)??""}`)),v(qe,Ke)};_(ct,qe=>{H(e(A)),n(()=>e(A).prerequisite)&&qe(Ae)})}var $e=s(ct,2),Be=i($e,!0);l($e);var Ne=s($e,2);M(()=>{C(Xe,(H(e(A)),n(()=>e(A).name))),C(Be,(H(e(A)),n(()=>e(A).description))),tt(Ne,"href",(H(e(A)),n(()=>e(A).source)))}),v(be,Pe)};_(d,be=>{e(y)==="spell"?be(Ve):be(he,!1)})}l(V),v(fe,V)};_(L,fe=>{e(ue)&&fe(pe)})}l(we),M(()=>{U=xt(re,1,"tab svelte-1ngjemu",null,U,{active:e(y)==="spell"}),C(oe,`üìú Spells (${e(ae),n(()=>e(ae).length)??""})`),b=xt(ye,1,"tab svelte-1ngjemu",null,b,{active:e(y)==="feat"}),C(F,`‚≠ê Feats (${e(J),n(()=>e(J).length)??""})`)}),B("click",re,()=>{o(y,"spell"),o(ue,null),o(w,"")}),B("click",ye,()=>{o(y,"feat"),o(ue,null),o(w,"")}),Je(Z,()=>e(w),fe=>o(w,fe)),v(k,de)};_(Oe,k=>{e($)?k(ne):k(xe,!1)})}l(Ge);var Fe=s(Ge,2),De=i(Fe),Te=s(De,2);l(Fe),l(je),l(O),M(()=>Te.disabled=!e(ue)),B("click",se,function(...k){m()?.apply(this,k)}),B("click",De,function(...k){m()?.apply(this,k)}),B("click",Te,_e),B("click",je,Ha(function(k){ra.call(this,r,k)})),B("keydown",je,function(k){ra.call(this,r,k)}),B("click",O,function(...k){m()?.apply(this,k)}),B("keydown",O,k=>k.key==="Escape"&&m()()),v(a,O),Ht()}var gn=f('<link rel="icon" type="image/png" href="favicon4.png"/> <meta name="viewport" content="width=device-width, initial-scale=1"/>',1),_n=f('<span class="character-name svelte-1uha8ag"> </span>'),yn=f("<span> </span>"),xn=f('<div class="spell-slots-header svelte-1uha8ag"></div>'),kn=f("<span> </span><br/>",1),Sn=f("<span> </span>"),$n=f('<span class="effect-tooltip"><strong> </strong><br/> <br/> <!> <!></span>'),Cn=f('<button class="effect-remove-btn svelte-1uha8ag">√ó</button>'),Dn=f('<span class="effect-badge svelte-1uha8ag" tabindex="0"> <!> <!></span>'),wn=f(`<div class="active-effects-header svelte-1uha8ag"></div> <style>.effect-badge {
              position: relative;
            }
            .effect-tooltip {
              position: absolute;
              top: 120%;
              left: 50%;
              transform: translateX(-50%);
              background: #fff;
              color: #222;
              border: 1px solid #a5b4fc;
              border-radius: 6px;
              padding: 8px 12px;
              font-size: 0.95em;
              box-shadow: 0 2px 8px rgba(0, 0, 0, 0.12);
              z-index: 10;
              min-width: 180px;
              max-width: 260px;
              white-space: normal;
              pointer-events: none;
              opacity: 1;
              transition: opacity 0.15s;
            }</style>`,1),Ln=f('<div class="rest-menu svelte-1uha8ag"><button class="rest-option svelte-1uha8ag">‚òï Short Rest</button> <button class="rest-option svelte-1uha8ag">üõèÔ∏è Long Rest</button></div>'),jn=f('<div class="container svelte-1uha8ag"><header class="svelte-1uha8ag"><div class="header-top svelte-1uha8ag"><div class="header-title svelte-1uha8ag"><div class="title-row svelte-1uha8ag"><h1 class="svelte-1uha8ag">D&D Character Sheet</h1> <!></div> <!> <!></div> <div class="header-right svelte-1uha8ag"><div class="header-controls svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">üé≤</span><span class="btn-text svelte-1uha8ag">Roll Dice</span></button> <div class="rest-button-container svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">üò¥</span><span class="btn-text svelte-1uha8ag">Rest</span></button> <!></div> <div class="mode-toggle"><button><span class="btn-icon svelte-1uha8ag"> </span><span class="btn-text svelte-1uha8ag"> </span></button></div></div> <div class="header-search svelte-1uha8ag"><input type="text" placeholder="üîç Search..." class="search-input use-enabled svelte-1uha8ag"/></div></div></div> <div class="header-actions svelte-1uha8ag"><button class="btn btn-mode svelte-1uha8ag">üìö Browse Spells & Feats</button> <button class="btn btn-secondary">Save to Gist</button> <button class="btn btn-secondary">Load from Gist</button> <button class="btn btn-secondary">Export JSON</button> <button class="btn btn-secondary">Import JSON</button> <input type="file" accept=".json" style="display: none;"/></div></header> <main class="svelte-1uha8ag"><!> <!> <!> <!> <!> <!> <!></main></div> <!> <!> <!> <!>',1);function En(a,r){Et(r,!1);const t=()=>st(ee,"$character",m),c=()=>st(Zt,"$isEditMode",m),u=()=>st(ea,"$searchFilter",m),[m,y]=Wt();function $(){const p=[],P=t().classFeatures.spellSlotsByLevel||{};for(let S=1;S<=9;S++){const me=P[S];if(me&&me.length>0){const W=me.length,Ze=me.filter(Me=>Me).length;p.push({level:S,available:W-Ze,total:W})}}return p}let w=j(!1),x=j(!1),ae=j(!1),J=j("save"),ue=j(void 0),Y=j(""),te=j(""),Se=j(""),_e=j(!1),O=j([]),je=j("other"),We=j(),se=!1,Ge=1,Oe=j(!1),ne=j(null);function xe(p){o(ne,p)}function Fe(){o(ne,null)}function De(p){o(ne,e(ne)===p?null:p)}function Te(){const p=[];ee.update(S=>{const me=S.hitDice.current;S.hitDice.current=Math.min(S.hitDice.max,S.hitDice.current+Math.max(1,Math.floor(S.hitDice.max/2)));const W=S.hitDice.current-me;if(W>0&&p.push(`${W} hit ${W===1?"die":"dice"}`),S.class){const Ze=oa(S.class,S.level,S.subclass);S.classFeatures.features||(S.classFeatures.features={}),Ze.forEach(Me=>{if(Me.resetOn==="short"){const ft=Me.name.replace(/\s+/g,"");if(Me.type==="uses"){const Ue=typeof Me.maxUses=="function"?Me.maxUses(S.level):Me.maxUses;S.classFeatures.features[ft]=Array(Ue).fill(!1),p.push(Me.name)}else if(Me.type==="pool"){const Ue=typeof Me.maxPool=="function"?Me.maxPool(S.level):Me.maxPool;Ue!==void 0&&(S.classFeatures.features[ft]=Ue,p.push(Me.name))}}})}return S}),o(Oe,!1);const P=p.length>0?`Short rest taken! Restored: ${p.join(", ")}`:"Short rest taken!";qt.add(P,"success")}function k(){const p=[];ee.update(S=>{const me=S.maxHP-S.currentHP;me>0&&p.push(`${me} HP`),S.currentHP=S.maxHP,S.tempHP=0;const W=S.hitDice.max-S.hitDice.current;W>0&&p.push(`${W} hit ${W===1?"die":"dice"}`),S.hitDice.current=S.hitDice.max;let Ze=0;if(S.classFeatures.spellSlotsByLevel&&Object.keys(S.classFeatures.spellSlotsByLevel).forEach(Me=>{const ft=S.classFeatures.spellSlotsByLevel[parseInt(Me)];if(ft){const Ue=ft.filter(nt=>nt).length;Ze+=Ue,S.classFeatures.spellSlotsByLevel[parseInt(Me)]=Array(ft.length).fill(!1)}}),Ze>0&&p.push(`${Ze} spell ${Ze===1?"slot":"slots"}`),S.class){const Me=oa(S.class,S.level,S.subclass);S.classFeatures.features||(S.classFeatures.features={});let ft=!1;Me.forEach(Ue=>{const nt=Ue.name.replace(/\s+/g,"");if(!(Ue.type==="info"||Ue.type==="channelDivinity")){if(Ue.type==="uses"){const rt=typeof Ue.maxUses=="function"?Ue.maxUses(S.level):Ue.maxUses;S.classFeatures.features[nt]=Array(rt).fill(!1),ft=!0}else if(Ue.type==="pool"){const rt=typeof Ue.maxPool=="function"?Ue.maxPool(S.level):Ue.maxPool;rt!==void 0&&(S.classFeatures.features[nt]=rt,ft=!0)}}}),ft&&p.push("all class features")}return S}),o(Oe,!1);const P=p.length>0?`Long rest taken! Restored: ${p.join(", ")}`:"Long rest taken! Fully rested.";qt.add(P,"success")}function de(p){o(Y,""),o(te,""),o(Se,""),o(_e,!1),o(O,[]),o(je,"other"),se=!1,typeof p=="string"?o(Y,p):(o(Y,p.notation),o(te,p.damageNotation||""),o(Se,p.attackName||""),o(_e,!!p.applyHalfDamage),o(O,p.bonusBreakdown||[]),o(je,p.rollType||"other")),o(w,!0)}function h(p){const{notation:P,count:S,bonusBreakdown:me}=p.detail;o(Y,""),se=!0,Ge=S||1,setTimeout(()=>{o(Y,P),o(te,""),o(Se,"Hit Die"),o(O,me||[]),o(je,"other")},0),o(w,!0)}function R(){if(o(w,!1),se&&e(We)){const p=e(We).getLastRollTotal();if(p!==null){const P=Math.max(1,p);ee.update(S=>(S.hitDice.current=Math.max(0,S.hitDice.current-Ge),S.currentHP=Math.min(S.maxHP,S.currentHP+P),S))}se=!1}}function re(){Zt.update(p=>!p)}function U(p){p.target.closest(".rest-button-container")||o(Oe,!1)}ca(()=>{const p=Zt.subscribe(P=>{P?document.body.classList.remove("use-mode"):document.body.classList.add("use-mode")});return document.addEventListener("click",U),()=>{p(),document.removeEventListener("click",U)}});function oe(){ks(t())}function ye(){e(ue)?.click()}async function b(p){const S=p.target.files?.[0];if(S)try{const me=await Ss(S);ee.set(me),alert("Character imported successfully!")}catch{alert("Failed to import character file")}}It();var F=jn();ys("1uha8ag",p=>{var P=gn();la(2),Za(()=>{gs.title="D&D Character Sheet"}),v(p,P)});var q=He(F),Z=i(q),z=i(Z),le=i(z),we=i(le),vt=s(i(we),2);{var ke=p=>{var P=_n(),S=i(P);l(P),M(()=>C(S,`${t().name??""} (${t().level??""})`)),v(p,P)};_(vt,p=>{t().name&&p(ke)})}l(we);var ze=s(we,2);{var T=p=>{var P=xn();yt(P,5,$,kt,(S,me)=>{var W=yn();let Ze;var Me=i(W);l(W),M(()=>{Ze=xt(W,1,"slot-badge svelte-1uha8ag",null,Ze,{depleted:e(me).available===0}),C(Me,`Lv${e(me).level??""}: ${e(me).available??""}/${e(me).total??""}`)}),v(S,W)}),l(P),v(p,P)};_(ze,p=>{$().length>0&&p(T)})}var L=s(ze,2);{var pe=p=>{var P=wn(),S=He(P);yt(S,5,()=>t().activeStates,kt,(me,W,Ze)=>{var Me=Dn(),ft=i(Me),Ue=s(ft);{var nt=ht=>{var gt=$n(),et=i(gt),ot=i(et,!0);l(et);var bt=s(et,2),Dt=s(bt,3);{var Nt=wt=>{var Lt=kn(),Gt=He(Lt),mt=i(Gt);l(Gt),la(),M(()=>C(mt,`Attack Bonus: ${typeof e(W).attackBonus=="number"&&e(W).attackBonus>0?"+":""}${e(W).attackBonus??""}`)),v(wt,Lt)};_(Dt,wt=>{e(W).attackBonus&&wt(Nt)})}var Ut=s(Dt,2);{var Bt=wt=>{var Lt=Sn(),Gt=i(Lt);l(Lt),M(()=>C(Gt,`Damage Bonus: ${typeof e(W).damageBonus=="number"&&e(W).damageBonus>0?"+":""}${e(W).damageBonus??""}`)),v(wt,Lt)};_(Ut,wt=>{e(W).damageBonus&&wt(Bt)})}l(gt),M(()=>{C(ot,e(W).name),C(bt,` ${e(W).description??""}`)}),v(ht,gt)};_(Ue,ht=>{e(ne)===Ze&&ht(nt)})}var rt=s(Ue,2);{var dt=ht=>{var gt=Cn();M(()=>tt(gt,"title",`End ${e(W).name??""}`)),B("click",gt,()=>{ee.update(et=>{if(et.activeStates){const ot=et.activeStates[Ze];ot?.hpBonus&&ot.target!=="other"&&(et.maxHP-=ot.hpBonus,et.currentHP=Math.max(1,Math.min(et.currentHP-ot.hpBonus,et.maxHP))),et.activeStates=et.activeStates.filter((bt,Dt)=>Dt!==Ze)}return et})}),v(ht,gt)};_(rt,ht=>{c()||ht(dt)})}l(Me),M(()=>{tt(Me,"aria-label",e(W).name),C(ft,`‚ú® ${e(W).name??""} `)}),B("mouseenter",Me,()=>xe(Ze)),B("mouseleave",Me,Fe),B("focus",Me,()=>xe(Ze)),B("blur",Me,Fe),B("click",Me,()=>De(Ze)),v(me,Me)}),l(S),la(2),v(p,P)};_(L,p=>{t().activeStates&&t().activeStates.length>0&&p(pe)})}l(le);var fe=s(le,2),V=i(fe),d=i(V),Ve=s(d,2),he=i(Ve),be=s(he,2);{var A=p=>{var P=Ln(),S=i(P),me=s(S,2);l(P),B("click",S,Te),B("click",me,k),v(p,P)};_(be,p=>{e(Oe)&&p(A)})}l(Ve);var Pe=s(Ve,2),Re=i(Pe);let Xe;var ct=i(Re),Ae=i(ct,!0);l(ct);var $e=s(ct),Be=i($e,!0);l($e),l(Re),l(Pe),l(V);var Ne=s(V,2),qe=i(Ne);Le(qe),l(Ne),l(fe),l(z);var Ke=s(z,2),ie=i(Ke),ge=s(ie,2),Ee=s(ge,2),Qe=s(Ee,2),Ce=s(Qe,2),g=s(Ce,2);xa(g,p=>o(ue,p),()=>e(ue)),l(Ke),l(Z);var G=s(Z,2),ce=i(G);Hs(ce,{});var X=s(ce,2);Os(X,{$$events:{roll:p=>de(p.detail)}});var ve=s(X,2);cl(ve,{$$events:{roll:p=>de(p.detail)}});var D=s(ve,2);il(D,{$$events:{rollHitDice:h}});var I=s(D,2);Zl(I,{$$events:{roll:p=>de(p.detail)}});var K=s(I,2);mi(K,{});var E=s(K,2);_i(E,{}),l(G),l(q);var Q=s(q,2);xa(Ti(Q,{get notation(){return e(Y)},get damageNotation(){return e(te)},get attackName(){return e(Se)},get applyHalfDamage(){return e(_e)},get bonusBreakdown(){return e(O)},get rollType(){return e(je)},get visible(){return e(w)},$$events:{close:R},$$legacy:!0}),p=>o(We,p),()=>e(We));var Ie=s(Q,2);{var N=p=>{en(p,{get mode(){return e(J)},$$events:{close:()=>o(x,!1)}})};_(Ie,p=>{e(x)&&p(N)})}var at=s(Ie,2);{var lt=p=>{hn(p,{onClose:()=>o(ae,!1)})};_(at,p=>{e(ae)&&p(lt)})}var it=s(at,2);xs(it,{}),M(()=>{Xe=xt(Re,1,"btn btn-mode svelte-1uha8ag",null,Xe,{"use-mode":!c()}),C(Ae,c()?"üìù":"üé≤"),C(Be,c()?"Edit Mode":"Use Mode")}),B("click",d,()=>{o(O,[]),o(w,!0)}),B("click",he,()=>o(Oe,!e(Oe))),B("click",Re,re),Je(qe,u,p=>$s(ea,p)),B("click",ie,()=>o(ae,!0)),B("click",ge,()=>{o(J,"save"),o(x,!0)}),B("click",Ee,()=>{o(J,"load"),o(x,!0)}),B("click",Qe,oe),B("click",Ce,ye),B("change",g,b),v(a,F),Ht(),y()}export{En as component};
