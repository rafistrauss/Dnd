import{f,e as M,a as c,s as L,c as ct,t as Mt}from"../chunks/DBs_ODQp.js";import{i as It}from"../chunks/BbaRvQ4Z.js";import{c as la,o as pa,a as rs}from"../chunks/CHX4V4AM.js";import{a7 as Ra,i as Qa,aZ as ns,a_ as Ya,a$ as Sa,K as Xt,e as Xa,b0 as Za,T as fa,b1 as os,b2 as cs,b3 as vs,q as Da,b4 as ds,b5 as us,ab as ps,d as r,r as Ta,g as fs,C as Et,F as P,G as Ht,H as i,I as l,J as s,b6 as Xe,b7 as Jt,s as o,a4 as A,f as e,m as vt,E as Oe,A as I,b8 as sa,b9 as jt,ba as da,ao as ra,bb as gs}from"../chunks/DwmZeGF1.js";import{c as Pt,a as ne,e as yt,i as St,u as es,s as ea,b as mt,d as ga,f as Zt,g as bs,t as qt,h as hs,T as ms,j as _s,k as ys}from"../chunks/DQJFtNtV.js";import{i as _,s as Wt,a as tt,b as ht,d as ca,e as ks}from"../chunks/0ovU14Ao.js";import{p as kt,b as ja}from"../chunks/CFUzmRYW.js";import{b as va,r as Ss}from"../chunks/CiY6FpNv.js";function ya(a,n,t=!1){if(a.multiple){if(n==null)return;if(!Qa(n))return ns();for(var v of a.options)v.selected=n.includes(ua(v));return}for(v of a.options){var u=ua(v);if(Ya(u,n)){v.selected=!0;return}}(!t||n!==void 0)&&(a.selectedIndex=-1)}function Ba(a){var n=new MutationObserver(()=>{ya(a,a.__value)});n.observe(a,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Ra(()=>{n.disconnect()})}function Aa(a,n,t=n){var v=new WeakSet,u=!0;Sa(a,"change",b=>{var y=b?"[selected]":":checked",x;if(a.multiple)x=[].map.call(a.querySelectorAll(y),ua);else{var $=a.querySelector(y)??a.querySelector("option:not([disabled])");x=$&&ua($)}t(x),Xt!==null&&v.add(Xt)}),Xa(()=>{var b=n();if(a===document.activeElement){var y=Za??Xt;if(v.has(y))return}if(ya(a,b,u),u&&b===void 0){var x=a.querySelector(":checked");x!==null&&(b=ua(x),t(b))}a.__value=b,u=!1}),Ba(a)}function ua(a){return"__value"in a?a.__value:a.value}const xs=Symbol("is custom element"),$s=Symbol("is html");function we(a){if(fa){var n=!1,t=()=>{if(!n){if(n=!0,a.hasAttribute("value")){var v=a.value;Ge(a,"value",null),a.value=v}if(a.hasAttribute("checked")){var u=a.checked;Ge(a,"checked",null),a.checked=u}}};a.__on_r=t,Da(t),ds()}}function ka(a,n){var t=Ia(a);t.value===(t.value=n??void 0)||a.value===n&&(n!==0||a.nodeName!=="PROGRESS")||(a.value=n??"")}function ts(a,n){var t=Ia(a);t.checked!==(t.checked=n??void 0)&&(a.checked=n)}function Ge(a,n,t,v){var u=Ia(a);fa&&(u[n]=a.getAttribute(n),n==="src"||n==="srcset"||n==="href"&&a.nodeName==="LINK")||u[n]!==(u[n]=t)&&(n==="loading"&&(a[os]=t),t==null?a.removeAttribute(n):typeof t!="string"&&Cs(a).includes(n)?a[n]=t:a.setAttribute(n,t))}function Ia(a){return a.__attributes??={[xs]:a.nodeName.includes("-"),[$s]:a.namespaceURI===cs}}var Ha=new Map;function Cs(a){var n=a.getAttribute("is")||a.nodeName,t=Ha.get(n);if(t)return t;Ha.set(n,t=[]);for(var v,u=a,b=Element.prototype;b!==u;){v=us(u);for(var y in v)v[y].set&&t.push(y);u=vs(u)}return t}function qe(a,n,t=n){var v=new WeakSet;Sa(a,"input",async u=>{var b=u?a.defaultValue:a.value;if(b=Ca(a)?wa(b):b,t(b),Xt!==null&&v.add(Xt),await ps(),b!==(b=n())){var y=a.selectionStart,x=a.selectionEnd,$=a.value.length;if(a.value=b??"",x!==null){var S=a.value.length;y===x&&x===$&&S>$?(a.selectionStart=S,a.selectionEnd=S):(a.selectionStart=y,a.selectionEnd=Math.min(x,S))}}}),(fa&&a.defaultValue!==a.value||r(n)==null&&a.value)&&(t(Ca(a)?wa(a.value):a.value),Xt!==null&&v.add(Xt)),Ta(()=>{var u=n();if(a===document.activeElement){var b=Za??Xt;if(v.has(b))return}Ca(a)&&u===wa(a.value)||a.type==="date"&&!u&&!a.value||u!==a.value&&(a.value=u??"")})}const $a=new Set;function Ua(a,n,t,v,u=v){var b=t.getAttribute("type")==="checkbox",y=a;let x=!1;if(n!==null)for(var $ of n)y=y[$]??=[];y.push(t),Sa(t,"change",()=>{var S=t.__value;b&&(S=Na(y,S,t.checked)),u(S)},()=>u(b?[]:null)),Ta(()=>{var S=v();if(fa&&t.defaultChecked!==t.checked){x=!0;return}b?(S=S||[],t.checked=S.includes(t.__value)):t.checked=Ya(t.__value,S)}),Ra(()=>{var S=y.indexOf(t);S!==-1&&y.splice(S,1)}),$a.has(y)||($a.add(y),Da(()=>{y.sort((S,X)=>S.compareDocumentPosition(X)===4?-1:1),$a.delete(y)})),Da(()=>{if(x){var S;if(b)S=Na(y,S,t.checked);else{var X=y.find(q=>q.checked);S=X?.__value}u(S)}})}function Fa(a,n,t=n){Sa(a,"change",v=>{var u=v?a.defaultChecked:a.checked;t(u)}),(fa&&a.defaultChecked!==a.checked||r(n)==null)&&t(a.checked),Ta(()=>{var v=n();a.checked=!!v})}function Na(a,n,t){for(var v=new Set,u=0;u<a.length;u+=1)a[u].checked&&v.add(a[u].__value);return t||v.delete(n),Array.from(v)}function Ca(a){var n=a.type;return n==="number"||n==="range"}function wa(a){return a===""?null:+a}function ws(a,n,t){var v=fs(a,n);v&&v.set&&(a[n]=t,Ra(()=>{a[n]=null}))}function Ea(a){return function(...n){var t=n[0];return t.stopPropagation(),a?.apply(this,n)}}function na(a,n){var t=a.$$events?.[n.type],v=Qa(t)?t.slice():t==null?[]:[t];for(var u of v)u.call(this,n)}const Ls="";function as(...a){return va+Ls+Ss(a[0],a[1])}const Ma={paladin:{name:"Paladin",hitDice:"d10",spellcaster:!0,spellcastingAbility:"charisma",spellSlotsByLevel:{1:0,2:2,3:3,4:3,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Divine Sense",type:"uses",maxUses:(a,n=1)=>1+Math.max(1,n),resetOn:"long",description:"Detect celestials, fiends, and undead within 60 feet",minLevel:1},{name:"Lay on Hands",type:"pool",maxPool:a=>a*5,resetOn:"long",description:"Heal wounds or cure disease",minLevel:1},{name:"Divine Smite",type:"spellSlot",description:"Expend spell slot to deal extra radiant damage",minLevel:2,rollable:!0},{name:"Channel Divinity",type:"pool",maxPool:a=>a>=18?3:a>=6?2:1,resetOn:"short",description:"Sacred Weapon or Turn Undead",minLevel:3}]},fighter:{name:"Fighter",hitDice:"d10",spellcaster:!1,features:[{name:"Second Wind",type:"uses",maxUses:1,resetOn:"short",description:"Regain 1d10 + fighter level HP as bonus action",minLevel:1,rollable:!0,rollFormula:a=>`1d10+${a}`},{name:"Action Surge",type:"uses",maxUses:a=>a>=17?2:1,resetOn:"short",description:"Take one additional action on your turn",minLevel:2},{name:"Indomitable",type:"uses",maxUses:a=>a>=17?3:a>=13?2:1,resetOn:"long",description:"Reroll a failed saving throw",minLevel:9}],subclasses:{champion:{name:"Champion",features:[{name:"Improved Critical",type:"info",description:"Critical hit on 19-20",minLevel:3},{name:"Remarkable Athlete",type:"info",description:"Add half proficiency to STR/DEX/CON checks, increase long jump distance",minLevel:7},{name:"Additional Fighting Style",type:"info",description:"Choose a second fighting style",minLevel:10},{name:"Superior Critical",type:"info",description:"Critical hit on 18-20",minLevel:15},{name:"Survivor",type:"info",description:"Regain 5 + CON mod HP at start of turn if below half HP",minLevel:18}]},battlemaster:{name:"Battle Master",features:[{name:"Combat Superiority",type:"uses",maxUses:a=>a>=15?6:a>=7?5:4,resetOn:"short",description:a=>`Use superiority dice (${a>=18?"d12":a>=10?"d10":"d8"}) for maneuvers`,minLevel:3},{name:"Know Your Enemy",type:"info",description:"Learn capabilities of creatures you observe",minLevel:7},{name:"Improved Combat Superiority",type:"info",description:"Superiority dice become d10",minLevel:10},{name:"Relentless",type:"info",description:"Regain 1 superiority die if you have none at start of turn",minLevel:15}]}}},rogue:{name:"Rogue",hitDice:"d8",spellcaster:!1,features:[{name:"Sneak Attack",type:"info",description:a=>`Deal ${Math.ceil(a/2)}d6 extra damage once per turn with advantage or ally nearby`,minLevel:1,rollable:!0,rollFormula:a=>`${Math.ceil(a/2)}d6`},{name:"Cunning Action",type:"info",description:"Dash, Disengage, or Hide as a bonus action",minLevel:2},{name:"Uncanny Dodge",type:"info",description:"Use reaction to halve damage from an attack",minLevel:5},{name:"Evasion",type:"info",description:"Take no damage on successful Dex save (half on fail)",minLevel:7}]},wizard:{name:"Wizard",hitDice:"d6",spellcaster:!0,spellcastingAbility:"intelligence",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Arcane Recovery",type:"uses",maxUses:1,resetOn:"long",description:a=>`Recover spell slots totaling up to ${Math.ceil(a/2)} levels during short rest`,minLevel:1},{name:"Spell Mastery",type:"info",description:"Cast one 1st-level and one 2nd-level spell at will",minLevel:18}]},cleric:{name:"Cleric",hitDice:"d8",spellcaster:!0,spellcastingAbility:"wisdom",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Channel Divinity",type:"pool",maxPool:a=>a>=18?3:a>=6?2:1,resetOn:"short",description:"Turn Undead or domain-specific ability",minLevel:2},{name:"Destroy Undead",type:"info",description:a=>`Channel Divinity destroys undead of CR ${a>=17?4:a>=14?3:a>=11?2:a>=8?1:.5} or lower`,minLevel:5},{name:"Divine Intervention",type:"uses",maxUses:1,resetOn:"long",description:a=>`${a}% chance to succeed, implore deity for aid`,minLevel:10}],subclasses:{war:{name:"War Domain",features:[{name:"War Priest",type:"uses",maxUses:(a,n=1)=>Math.max(1,n),resetOn:"long",description:"Make one weapon attack as a bonus action",minLevel:1},{name:"Guided Strike",type:"channelDivinity",description:"Use your Channel Divinity to gain +10 to an attack roll. Make this choice after you see the roll, but before the DM says whether the attack hits or misses.",minLevel:2,resetOn:"short"},{name:"War God's Blessing",type:"channelDivinity",description:"Use reaction to grant +10 to an ally's attack roll within 30 feet. Consumes one use of Channel Divinity.",minLevel:6,resetOn:"short"},{name:"Divine Strike",type:"info",description:a=>`Deal extra ${a>=14?"2d8":"1d8"} weapon damage once per turn`,minLevel:8,rollable:!0,rollFormula:a=>a>=14?"2d8":"1d8"},{name:"Avatar of Battle",type:"info",description:"Gain resistance to nonmagical weapon damage",minLevel:17}]},life:{name:"Life Domain",features:[{name:"Disciple of Life",type:"info",description:"Healing spells restore additional 2 + spell level HP",minLevel:1},{name:"Preserve Life",type:"pool",maxPool:a=>a*5,resetOn:"short",description:"Restore HP to creatures within 30 feet",minLevel:2},{name:"Blessed Healer",type:"info",description:"Regain 2 + spell level HP when you cast healing spell",minLevel:6},{name:"Divine Strike",type:"info",description:a=>`Deal extra ${a>=14?"2d8":"1d8"} radiant damage once per turn`,minLevel:8,rollable:!0,rollFormula:a=>a>=14?"2d8":"1d8"},{name:"Supreme Healing",type:"info",description:"Maximize healing dice instead of rolling",minLevel:17}]}}},barbarian:{name:"Barbarian",hitDice:"d12",spellcaster:!1,features:[{name:"Rage",type:"uses",maxUses:a=>a>=20?1/0:a>=17?6:a>=12?5:a>=6?4:a>=3?3:2,resetOn:"long",description:a=>`+${a>=16?4:a>=9?3:2} damage, resistance to physical damage`,minLevel:1},{name:"Reckless Attack",type:"info",description:"Gain advantage on melee attacks, enemies get advantage on you",minLevel:2},{name:"Danger Sense",type:"info",description:"Advantage on Dex saves against effects you can see",minLevel:2}],subclasses:{berserker:{name:"Path of the Berserker",features:[{name:"Frenzy",type:"info",description:"While raging, make melee attack as bonus action (gain 1 exhaustion after rage)",minLevel:3},{name:"Mindless Rage",type:"info",description:"Cannot be charmed or frightened while raging",minLevel:6},{name:"Intimidating Presence",type:"info",description:"Use action to frighten creature within 30 feet",minLevel:10},{name:"Retaliation",type:"info",description:"When damaged by creature within 5 feet, make melee attack as reaction",minLevel:14}]}}}};function Tt(a){const n=a.toLowerCase();return Ma[n]||null}function oa(a,n,t){const v=Tt(a);if(!v)return[];const u=v.features.filter(b=>!b.minLevel||b.minLevel<=n);if(t&&v.subclasses&&v.subclasses[t]){const b=v.subclasses[t].features.filter(y=>!y.minLevel||y.minLevel<=n);return[...u,...b]}return u}function Ga(a){const n=Tt(a);return!n||!n.subclasses?[]:Object.keys(n.subclasses).map(t=>({id:t,name:n.subclasses[t].name}))}function Oa(a,n){const t=Tt(a);return!t||!t.spellcaster||!t.spellSlotsByLevel?0:t.spellSlotsByLevel[n]||0}function qa(a,n,t){const v=Tt(a);return!v||!v.spellcaster?0:Math.max(1,t+n)}function Ds(a,n,t){const v=Tt(a);return!v||!v.spellcaster?null:8+n+t}function js(){return Object.keys(Ma).map(a=>({id:a,name:Ma[a].name}))}var Bs=f('<div class="section-header svelte-ls99y2" role="button" tabindex="0"><h2 class="svelte-ls99y2"> </h2> <span class="collapse-btn svelte-ls99y2"> </span></div>');function ia(a,n){Et(n,!1);let t=kt(n,"title",8),v=kt(n,"collapsed",8),u=kt(n,"ariaLabel",8,""),b=kt(n,"onToggle",8);It();var y=Bs(),x=i(y),$=i(x,!0);l(x);var S=s(x,2),X=i(S,!0);l(S),l(y),P(()=>{Ge(y,"aria-expanded",!v()),Ge(y,"aria-label",u()),L($,t()),L(X,v()?"â–¼":"â–²")}),M("click",y,function(...q){b()?.apply(this,q)}),M("keydown",y,q=>{(q.key==="Enter"||q.key===" ")&&b()()}),c(a,y),Ht()}var As=f("<option> </option>"),Fs=f("<option> </option>"),Ms=f('<div class="form-group svelte-172i2fj"><label for="characterSubclass" class="svelte-172i2fj">Subclass</label> <select id="characterSubclass" class="svelte-172i2fj"><option>Select Subclass</option><!></select></div>'),Ps=f('<div class="info-grid svelte-172i2fj"><div class="form-group svelte-172i2fj"><label for="characterName" class="svelte-172i2fj">Character Name</label> <input type="text" id="characterName" placeholder="Enter name" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterClass" class="svelte-172i2fj">Class</label> <select id="characterClass" class="svelte-172i2fj"><option>Select Class</option><!></select></div> <!> <div class="form-group svelte-172i2fj"><label for="characterLevel" class="svelte-172i2fj">Level</label> <input type="number" id="characterLevel" min="1" max="20" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterRace" class="svelte-172i2fj">Race</label> <input type="text" id="characterRace" placeholder="e.g., Human" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterBackground" class="svelte-172i2fj">Background</label> <input type="text" id="characterBackground" placeholder="e.g., Soldier" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterAlignment" class="svelte-172i2fj">Alignment</label> <input type="text" id="characterAlignment" placeholder="e.g., Lawful Good" class="svelte-172i2fj"/></div></div>'),Rs=f('<section class="character-info svelte-172i2fj"><!> <!></section>');function Ts(a,n){Et(n,!1);const t=()=>tt(ne,"$character",u),v=()=>tt(Pt,"$collapsedStates",u),[u,b]=Wt(),y=A(),x=js();function $(ke){const fe=ke.target;ne.update(N=>(N.class=fe.value,N.subclass="",N))}function S(ke){const fe=ke.target;ne.update(N=>(N.subclass=fe.value,N))}function X(ke){const fe=ke.target;ne.update(N=>(N.level=parseInt(fe.value)||1,N)),es()}Xe(()=>(t(),Ga),()=>{o(y,t().class?Ga(t().class):[])}),Jt(),It();var q=Rs(),de=i(q);{let ke=vt(()=>(v(),r(()=>v().characterInfo?"Expand":"Collapse")));ia(de,{title:"Character Info",get collapsed(){return v(),r(()=>v().characterInfo)},get ariaLabel(){return e(ke)},onToggle:()=>Pt.update(fe=>({...fe,characterInfo:!fe.characterInfo}))})}var J=s(de,2);{var Z=ke=>{var fe=Ps(),N=i(fe),Fe=s(i(N),2);we(Fe),l(N);var Ye=s(N,2),ge=s(i(Ye),2),He=i(ge);He.value=He.__value="";var We=s(He);yt(We,1,()=>x,St,(Te,$e)=>{var g=As(),R=i(g,!0);l(g);var Q={};P(()=>{L(R,(e($e),r(()=>e($e).name))),Q!==(Q=(e($e),r(()=>e($e).id)))&&(g.value=(g.__value=(e($e),r(()=>e($e).id)))??"")}),c(Te,g)}),l(ge);var le;Ba(ge),l(Ye);var ye=s(Ye,2);{var Ue=Te=>{var $e=Ms(),g=s(i($e),2),R=i(g);R.value=R.__value="";var Q=s(R);yt(Q,1,()=>e(y),St,(G,me)=>{var Le=Fs(),at=i(Le,!0);l(Le);var Se={};P(()=>{L(at,(e(me),r(()=>e(me).name))),Se!==(Se=(e(me),r(()=>e(me).id)))&&(Le.value=(Le.__value=(e(me),r(()=>e(me).id)))??"")}),c(G,Le)}),l(g);var ae;Ba(g),l($e),P(()=>{ae!==(ae=(t(),r(()=>t().subclass)))&&(g.value=(g.__value=(t(),r(()=>t().subclass)))??"",ya(g,(t(),r(()=>t().subclass))))}),M("change",g,S),c(Te,$e)};_(ye,Te=>{e(y),r(()=>e(y).length>0)&&Te(Ue)})}var W=s(ye,2),ee=s(i(W),2);we(ee),l(W);var k=s(W,2),Y=s(i(k),2);we(Y),l(k);var h=s(k,2),F=s(i(h),2);we(F),l(h);var te=s(h,2),Ae=s(i(te),2);we(Ae),l(te),l(fe),P(()=>{le!==(le=(t(),r(()=>t().class)))&&(ge.value=(ge.__value=(t(),r(()=>t().class)))??"",ya(ge,(t(),r(()=>t().class)))),ka(ee,(t(),r(()=>t().level)))}),qe(Fe,()=>t().name,Te=>ht(ne,r(t).name=Te,r(t))),M("change",ge,$),M("change",ee,X),qe(Y,()=>t().race,Te=>ht(ne,r(t).race=Te,r(t))),qe(F,()=>t().background,Te=>ht(ne,r(t).background=Te,r(t))),qe(Ae,()=>t().alignment,Te=>ht(ne,r(t).alignment=Te,r(t))),c(ke,fe)};_(J,ke=>{v(),r(()=>!v().characterInfo)&&ke(Z)})}l(q),c(a,q),Ht(),b()}var Is=f('<div class="ability-card svelte-bbv1xt"><h3 class="svelte-bbv1xt"> </h3> <input type="number" class="ability-score svelte-bbv1xt" min="1" max="30"/> <div class="ability-modifier svelte-bbv1xt"> </div> <div class="roll-buttons svelte-bbv1xt"><button class="roll-btn svelte-bbv1xt">Check</button> <button class="roll-btn svelte-bbv1xt">Save</button></div> <div class="save-proficiency svelte-bbv1xt"><input type="checkbox" class="svelte-bbv1xt"/> <label class="svelte-bbv1xt">Save Prof.</label></div></div>'),Es=f('<div class="proficiency-bonus svelte-bbv1xt"><label for="profBonus">Proficiency Bonus</label> <input type="number" id="profBonus" class="prof-input svelte-bbv1xt"/></div> <div class="abilities-grid svelte-bbv1xt"></div>',1),Hs=f("<section><!> <!></section>");function Us(a,n){Et(n,!1);const t=()=>tt(ga,"$abilityModifiers",x),v=()=>tt(ne,"$character",x),u=()=>tt(ea,"$searchFilter",x),b=()=>tt(Pt,"$collapsedStates",x),y=()=>tt(Zt,"$isEditMode",x),[x,$]=Wt(),S=A(),X=A(),q=la(),de=[{key:"strength",label:"Strength"},{key:"dexterity",label:"Dexterity"},{key:"constitution",label:"Constitution"},{key:"intelligence",label:"Intelligence"},{key:"wisdom",label:"Wisdom"},{key:"charisma",label:"Charisma"}];function J(){es()}function Z(He){const We=t()[He],le=`1d20${We>=0?"+":""}${We}`,ye=[];ye.push({value:"1d20",source:"base die"}),We!==0&&ye.push({value:We,source:He}),q("roll",{notation:le,rollType:"check",bonusBreakdown:ye})}function ke(He){const We=t()[He],le=v().saveProficiencies[He]?v().proficiencyBonus:0,ye=We+le,Ue=`1d20${ye>=0?"+":""}${ye}`,W=[];W.push({value:"1d20",source:"base die"}),We!==0&&W.push({value:We,source:He}),le!==0&&W.push({value:le,source:"proficiency"}),q("roll",{notation:Ue,rollType:"save",bonusBreakdown:W})}Xe(()=>u(),()=>{o(S,de.filter(({label:He})=>u()?He.toLowerCase().includes(u().toLowerCase()):!0))}),Xe(()=>(e(S),u()),()=>{o(X,e(S).length>0||!u()||u().toLowerCase().includes("proficiency"))}),Jt(),It();var fe=Hs();let N;var Fe=i(fe);ia(Fe,{title:"Ability Scores",get collapsed(){return b(),r(()=>b().abilityScores)},ariaLabel:"Toggle Ability Scores Section",onToggle:()=>Pt.update(He=>({...He,abilityScores:!He.abilityScores}))});var Ye=s(Fe,2);{var ge=He=>{var We=Es(),le=Oe(We),ye=s(i(le),2);we(ye),l(le);var Ue=s(le,2);yt(Ue,5,()=>e(S),St,(W,ee)=>{let k=()=>e(ee).key,Y=()=>e(ee).label;var h=Is(),F=i(h),te=i(F,!0);l(F);var Ae=s(F,2);we(Ae);var Te=s(Ae,2),$e=i(Te);l(Te);var g=s(Te,2),R=i(g),Q=s(R,2);l(g);var ae=s(g,2),G=i(ae);we(G);var me=s(G,2);l(ae),l(h),P(Le=>{L(te,Le),L($e,`${t(),k(),r(()=>t()[k()]>=0?"+":"")??""}${t(),k(),r(()=>t()[k()])??""}`),G.disabled=!y(),Ge(G,"id",`${k()}-save`),Ge(me,"for",`${k()}-save`)},[()=>(Y(),r(()=>Y().substring(0,3).toUpperCase()))]),qe(Ae,()=>v().abilities[k()],Le=>ht(ne,r(v).abilities[k()]=Le,r(v))),M("change",Ae,J),M("click",R,()=>Z(k())),M("click",Q,()=>ke(k())),Fa(G,()=>v().saveProficiencies[k()],Le=>ht(ne,r(v).saveProficiencies[k()]=Le,r(v))),c(W,h)}),l(Ue),qe(ye,()=>v().proficiencyBonus,W=>ht(ne,r(v).proficiencyBonus=W,r(v))),c(He,We)};_(Ye,He=>{b(),r(()=>!b().abilityScores)&&He(ge)})}l(fe),P(()=>N=mt(fe,1,"ability-scores svelte-bbv1xt",null,N,{hidden:!e(X)})),c(a,fe),Ht(),$()}function ss(a){return Math.floor((a-10)/2)}function Pa(a,n){if(!a.class)return null;const t=Tt(a.class);if(!t||!t.spellcaster||!t.spellcastingAbility)return null;const v=n[t.spellcastingAbility];return 8+a.proficiencyBonus+v}function Wa(a,n){if(!a.class)return 0;const t=Tt(a.class);return!t||!t.spellcaster||!t.spellcastingAbility?0:n[t.spellcastingAbility]}function Ns(a,n){const t=[],v=ss(n.dexterity);t.push("Base: 10"),v!==0&&t.push(`Dexterity: ${v>=0?"+":""}${v}`);const u=10+v,b=a.armorClass-u;return b!==0&&t.push(`Armor/Other: ${b>=0?"+":""}${b}`),t.join(`
`)}function Gs(a,n){const t=[],v=ss(n.dexterity);t.push(`Dexterity: ${v>=0?"+":""}${v}`);const u=a.initiative-v;return u!==0&&t.push(`Other Bonuses: ${u>=0?"+":""}${u}`),t.join(`
`)}function Os(a,n){if(!a.class)return"";const t=Tt(a.class);if(!t||!t.spellcaster||!t.spellcastingAbility)return"";const v=[],u=n[t.spellcastingAbility],b=t.spellcastingAbility.charAt(0).toUpperCase()+t.spellcastingAbility.slice(1);return v.push("Base: 8"),v.push(`Proficiency: +${a.proficiencyBonus}`),v.push(`${b}: ${u>=0?"+":""}${u}`),v.join(`
`)}var qs=f('<input type="number" id="armorClass" class="stat-input svelte-1r5hyyb"/>'),Ws=f('<input type="text" id="armorClass" readonly=""/>'),zs=f('<div class="stat-box svelte-1r5hyyb"><label for="spellSaveDC" class="svelte-1r5hyyb">Spell Save DC</label> <input type="number" id="spellSaveDC" class="stat-input svelte-1r5hyyb" readonly=""/></div>'),Ks=f('<span class="hit-dice-type"> </span>'),Vs=f('<div class="stats-grid svelte-1r5hyyb"><div class="stat-box svelte-1r5hyyb"><label for="armorClass" class="svelte-1r5hyyb">Armor Class</label> <!></div> <div class="stat-box svelte-1r5hyyb"><label for="initiative" class="svelte-1r5hyyb">Initiative</label> <input type="number" id="initiative" class="stat-input svelte-1r5hyyb"/></div> <div class="stat-box svelte-1r5hyyb"><label for="speed" class="svelte-1r5hyyb">Speed</label> <input type="text" id="speed" class="stat-input svelte-1r5hyyb"/></div> <!></div> <div class="hp-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Points</h3> <div><div class="hp-inputs svelte-1r5hyyb"><input type="number" class="hp-current svelte-1r5hyyb" min="0"/> <span class="hp-separator svelte-1r5hyyb">/</span> <input type="number" class="hp-max svelte-1r5hyyb" min="0"/></div> <div class="hp-controls svelte-1r5hyyb"><button class="hp-btn svelte-1r5hyyb">âˆ’</button> <button class="hp-btn svelte-1r5hyyb">+</button> <button class="hp-btn svelte-1r5hyyb">âˆ’5</button> <button class="hp-btn svelte-1r5hyyb">+5</button></div></div> <div class="temp-hp svelte-1r5hyyb"><label for="tempHP" class="svelte-1r5hyyb">Temp HP</label> <input type="number" id="tempHP" min="0" class="svelte-1r5hyyb"/></div></div> <div class="hit-dice-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Dice</h3> <div class="hit-dice-display svelte-1r5hyyb"><input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <span>/</span> <input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <!></div> <div class="hit-dice-controls svelte-1r5hyyb"><label for="hitDiceCount" class="svelte-1r5hyyb">Roll</label> <div class="hit-dice-count-controls svelte-1r5hyyb"><button class="hit-dice-btn svelte-1r5hyyb">âˆ’</button> <input type="number" id="hitDiceCount" class="hit-dice-count-input svelte-1r5hyyb" min="1"/> <button class="hit-dice-btn svelte-1r5hyyb">+</button></div> <button class="btn btn-primary roll-hit-dice use-enabled svelte-1r5hyyb">ðŸŽ² Roll</button></div></div>',1),Js=f("<section><!> <!></section>");function Qs(a,n){Et(n,!1);const t=()=>tt(ne,"$character",x),v=()=>tt(ga,"$abilityModifiers",x),u=()=>tt(ea,"$searchFilter",x),b=()=>tt(Pt,"$collapsedStates",x),y=()=>tt(Zt,"$isEditMode",x),[x,$]=Wt(),S=A(),X=A(),q=A(),de=A(),J=A(),Z=A(),ke=A(),fe=la();let N=A(1);function Fe(W){ne.update(ee=>(ee.currentHP=Math.max(0,Math.min(ee.maxHP,ee.currentHP+W)),ee))}function Ye(W){const ee=e(N)+W,k=t().hitDice.current;o(N,Math.max(1,Math.min(k,ee)))}function ge(W=1){if(t().hitDice.current<=0){alert("No hit dice remaining!");return}if(!t().class){alert("Please select a class first!");return}const ee=Tt(t().class);if(!ee){alert("Invalid class configuration!");return}const k=Math.min(W,t().hitDice.current),Y=ee.hitDice,h=v().constitution,F=h*k,te=F>=0?`+${F}`:`${F}`,Ae=`${k}${Y}${te}`,Te=[];if(Te.push({value:`${k}${Y}`,source:"hit dice"}),h!==0)for(let $e=0;$e<k;$e++)Te.push({value:h,source:"constitution"});fe("rollHitDice",{notation:Ae,hitDie:Y,count:k,bonusBreakdown:Te})}Xe(()=>(t(),v()),()=>{o(S,Pa(t(),v()))}),Xe(()=>(t(),v()),()=>{o(X,Ns(t(),v()))}),Xe(()=>(t(),v()),()=>{o(q,Gs(t(),v()))}),Xe(()=>(t(),v()),()=>{o(de,Os(t(),v()))}),Xe(()=>(t(),e(N)),()=>{const W=t().hitDice.current;W>0&&e(N)>W&&o(N,W)}),Xe(()=>t(),()=>{o(J,t().activeStates&&t().activeStates.length>0?t().activeStates.reduce((W,ee)=>W+(ee.acBonus||0),0):0)}),Xe(()=>t(),()=>{o(Z,t().activeStates&&t().activeStates.length>0?t().activeStates.some(W=>W.name==="Aid"&&W.target==="self"):!1)}),Xe(()=>u(),()=>{o(ke,!u()||"armor class".includes(u().toLowerCase())||"initiative".includes(u().toLowerCase())||"speed".includes(u().toLowerCase())||"hit points".includes(u().toLowerCase())||"hp".includes(u().toLowerCase())||"hit dice".includes(u().toLowerCase())||"spell save".includes(u().toLowerCase())||"combat".includes(u().toLowerCase()))}),Jt(),It();var He=Js();let We;var le=i(He);{let W=vt(()=>(b(),r(()=>b().combatStats?"Expand":"Collapse")));ia(le,{title:"Combat Stats",get collapsed(){return b(),r(()=>b().combatStats)},get ariaLabel(){return e(W)},onToggle:()=>Pt.update(ee=>({...ee,combatStats:!ee.combatStats}))})}var ye=s(le,2);{var Ue=W=>{var ee=Vs(),k=Oe(ee),Y=i(k),h=s(i(Y),2);{var F=H=>{var ie=qs();we(ie),P(()=>Ge(ie,"title",e(X))),qe(ie,()=>t().armorClass,O=>ht(ne,r(t).armorClass=O,r(t))),c(H,ie)},te=H=>{var ie=Ws();we(ie),P(()=>{ka(ie,(e(J),t(),r(()=>e(J)!==0?`${t().armorClass} â†’ ${t().armorClass+e(J)}`:`${t().armorClass}`))),mt(ie,1,bs(e(J)!==0?"stat-input ac-enhanced":"stat-input"),"svelte-1r5hyyb"),Ge(ie,"title",e(J)!==0?`${e(X)}
Active Effects: +${e(J)}`:e(X))}),c(H,ie)};_(h,H=>{y()?H(F):H(te,!1)})}l(Y);var Ae=s(Y,2),Te=s(i(Ae),2);we(Te),l(Ae);var $e=s(Ae,2),g=s(i($e),2);we(g),l($e);var R=s($e,2);{var Q=H=>{var ie=zs(),O=s(i(ie),2);we(O),l(ie),P(()=>{ka(O,e(S)),Ge(O,"title",e(de))}),c(H,ie)};_(R,H=>{e(S)!==null&&H(Q)})}l(k);var ae=s(k,2),G=s(i(ae),2);let me;var Le=i(G),at=i(Le);we(at);var Se=s(at,4);we(Se),l(Le);var Ke=s(Le,2),B=i(Ke),C=s(B,2),oe=s(C,2),ue=s(oe,2);l(Ke),l(G);var z=s(G,2),d=s(i(z),2);we(d),l(z),l(ae);var ze=s(ae,2),ce=s(i(ze),2),ve=i(ce);we(ve);var D=s(ve,4);we(D);var Me=s(D,2);{var Ie=H=>{const ie=vt(()=>(I(Tt),t(),r(()=>Tt(t().class))));var O=ct(),be=Oe(O);{var Ne=Je=>{const xe=vt(()=>(v(),r(()=>v().constitution)));var m=Ks(),U=i(m);l(m),P(()=>L(U,`(${I(e(ie)),r(()=>e(ie).hitDice)??""}${(e(xe)>=0?`+${e(xe)}`:e(xe))??""})`)),c(Je,m)};_(be,Je=>{e(ie)&&Je(Ne)})}c(H,O)};_(Me,H=>{t(),r(()=>t().class)&&H(Ie)})}l(ce);var Ze=s(ce,2),lt=s(i(Ze),2),De=i(lt),_e=s(De,2);we(_e);var je=s(_e,2);l(lt);var Ee=s(lt,2);l(Ze),l(ze),P(()=>{Ge(Te,"title",e(q)),me=mt(G,1,"hp-display svelte-1r5hyyb",null,me,{"aid-active":e(Z)}),Ge(at,"max",(t(),r(()=>t().maxHP))),Ge(ve,"max",(t(),r(()=>t().hitDice.max))),De.disabled=e(N)<=1,Ge(_e,"max",(t(),r(()=>t().hitDice.current))),je.disabled=(e(N),t(),r(()=>e(N)>=t().hitDice.current)),Ee.disabled=(t(),r(()=>t().hitDice.current<=0||!t().class))}),qe(Te,()=>t().initiative,H=>ht(ne,r(t).initiative=H,r(t))),qe(g,()=>t().speed,H=>ht(ne,r(t).speed=H,r(t))),qe(at,()=>t().currentHP,H=>ht(ne,r(t).currentHP=H,r(t))),qe(Se,()=>t().maxHP,H=>ht(ne,r(t).maxHP=H,r(t))),M("click",B,()=>Fe(-1)),M("click",C,()=>Fe(1)),M("click",oe,()=>Fe(-5)),M("click",ue,()=>Fe(5)),qe(d,()=>t().tempHP,H=>ht(ne,r(t).tempHP=H,r(t))),qe(ve,()=>t().hitDice.current,H=>ht(ne,r(t).hitDice.current=H,r(t))),qe(D,()=>t().hitDice.max,H=>ht(ne,r(t).hitDice.max=H,r(t))),M("click",De,()=>Ye(-1)),qe(_e,()=>e(N),H=>o(N,H)),M("input",_e,H=>{const ie=H.target,O=parseInt(ie.value);O>t().hitDice.current&&o(N,t().hitDice.current),O<1&&o(N,1)}),M("click",je,()=>Ye(1)),M("click",Ee,()=>ge(e(N))),c(W,ee)};_(ye,W=>{b(),r(()=>!b().combatStats)&&W(Ue)})}l(He),P(()=>We=mt(He,1,"combat-stats svelte-1r5hyyb",null,We,{hidden:!e(ke)})),c(a,He),Ht(),$()}const ba={acrobatics:"dexterity",animalHandling:"wisdom",arcana:"intelligence",athletics:"strength",deception:"charisma",history:"intelligence",insight:"wisdom",intimidation:"charisma",investigation:"intelligence",medicine:"wisdom",nature:"intelligence",perception:"wisdom",performance:"charisma",persuasion:"charisma",religion:"intelligence",sleightOfHand:"dexterity",stealth:"dexterity",survival:"wisdom"};var Ys=f('<div class="skill-row svelte-1f1pl16"><input type="checkbox" class="svelte-1f1pl16"/> <label class="svelte-1f1pl16"> <span class="ability-tag svelte-1f1pl16"> </span></label> <span class="skill-modifier svelte-1f1pl16"> </span> <button class="roll-btn svelte-1f1pl16">Roll</button></div>'),Xs=f('<div class="skills-grid svelte-1f1pl16"></div>'),Zs=f("<section><!> <!></section>");function el(a,n){Et(n,!1);const t=()=>tt(ne,"$character",x),v=()=>tt(ga,"$abilityModifiers",x),u=()=>tt(ea,"$searchFilter",x),b=()=>tt(Pt,"$collapsedStates",x),y=()=>tt(Zt,"$isEditMode",x),[x,$]=Wt(),S=A(),X=A(),q=A(),de=A(),J=A(),Z=A(),ke=la(),fe=[{key:"acrobatics",label:"Acrobatics"},{key:"animalHandling",label:"Animal Handling"},{key:"arcana",label:"Arcana"},{key:"athletics",label:"Athletics"},{key:"deception",label:"Deception"},{key:"history",label:"History"},{key:"insight",label:"Insight"},{key:"intimidation",label:"Intimidation"},{key:"investigation",label:"Investigation"},{key:"medicine",label:"Medicine"},{key:"nature",label:"Nature"},{key:"perception",label:"Perception"},{key:"performance",label:"Performance"},{key:"persuasion",label:"Persuasion"},{key:"religion",label:"Religion"},{key:"sleightOfHand",label:"Sleight of Hand"},{key:"stealth",label:"Stealth"},{key:"survival",label:"Survival"}];function N(le){const ye=ba[le],Ue=v()[ye],W=t().skillProficiencies[le]?t().proficiencyBonus:0,ee=e(S)[le],k=`1d20${ee>=0?"+":""}${ee}`,Y=[];Y.push({value:"1d20",source:"base die"}),Ue!==0&&Y.push({value:Ue,source:ye}),W!==0&&Y.push({value:W,source:"proficiency"}),ke("roll",{notation:k,rollType:"check",bonusBreakdown:Y})}Xe(()=>{},()=>{o(S,{})}),Xe(()=>t(),()=>{o(X,t().skillProficiencies)}),Xe(()=>t(),()=>{o(q,t().proficiencyBonus)}),Xe(()=>v(),()=>{o(de,v())}),Xe(()=>(e(de),e(X),e(q)),()=>{for(const{key:le}of fe){const ye=ba[le],Ue=e(de)[ye],W=e(X)[le]?e(q):0;sa(S,e(S)[le]=Ue+W)}}),Xe(()=>u(),()=>{o(J,fe.filter(({label:le})=>u()?le.toLowerCase().includes(u().toLowerCase()):!0))}),Xe(()=>e(J),()=>{o(Z,e(J).length>0)}),Jt(),It();var Fe=Zs();let Ye;var ge=i(Fe);{let le=vt(()=>(b(),r(()=>b().skills?"Expand":"Collapse")));ia(ge,{title:"Skills",get collapsed(){return b(),r(()=>b().skills)},get ariaLabel(){return e(le)},onToggle:()=>Pt.update(ye=>({...ye,skills:!ye.skills}))})}var He=s(ge,2);{var We=le=>{var ye=Xs();yt(ye,5,()=>e(J),St,(Ue,W)=>{let ee=()=>e(W).key,k=()=>e(W).label;var Y=Ys(),h=i(Y);we(h);var F=s(h,2),te=i(F),Ae=s(te),Te=i(Ae);l(Ae),l(F);var $e=s(F,2),g=i($e);l($e);var R=s($e,2);l(Y),P(Q=>{ts(h,(e(X),ee(),r(()=>e(X)[ee()]))),h.disabled=!y(),Ge(h,"id",ee()),Ge(F,"for",ee()),L(te,`${k()??""} `),L(Te,`(${Q??""})`),L(g,`${e(S),ee(),r(()=>e(S)[ee()]>=0?"+":"")??""}${e(S),ee(),r(()=>e(S)[ee()])??""}`)},[()=>(I(ba),ee(),r(()=>ba[ee()].substring(0,3).toUpperCase()))]),M("change",h,Q=>{console.log("Skill proficiency changed:",ee(),Q.target.checked),ne.update(ae=>({...ae,skillProficiencies:{...ae.skillProficiencies,[ee()]:Q.target.checked}}))}),M("click",R,()=>N(ee())),c(Ue,Y)}),l(ye),c(le,ye)};_(He,le=>{b(),r(()=>!b().skills)&&le(We)})}l(Fe),P(()=>Ye=mt(Fe,1,"skills svelte-1f1pl16",null,Ye,{hidden:!e(Z)})),c(a,Fe),Ht(),$()}let ha=null,ma=null;async function ls(){if(ha)return ha;try{return ha=await(await fetch(as("/data/spells.json"))).json(),ha||[]}catch(a){return console.error("Failed to load spells:",a),[]}}async function tl(){if(ma)return ma;try{return ma=await(await fetch(as("/data/feats.json"))).json(),ma||[]}catch(a){return console.error("Failed to load feats:",a),[]}}function za(a,n){if(!n.trim())return a;const t=n.toLowerCase();return a.filter(v=>v.name.toLowerCase().includes(t)||v.school.toLowerCase().includes(t)||v.classes.some(u=>u.toLowerCase().includes(t))||v.description.toLowerCase().includes(t))}function al(a,n){return n===null?a:a.filter(t=>t.level===n)}function sl(a,n){if(!n.trim())return a;const t=n.toLowerCase();return a.filter(v=>v.name.toLowerCase().includes(t)||v.description.toLowerCase().includes(t))}function _a(a){const n=a.description,t=/\b(Strength|Dexterity|Constitution|Intelligence|Wisdom|Charisma)\s+saving\s+throw/i,v=n.match(t);if(!v)return null;const u=v[1].toLowerCase(),y=/half\s+(?:as\s+much\s+)?damage\s+on\s+a\s+successful(?:\s+save)?/i.test(n),$=/saving\s+throw\s+or\s+take.*?damage/i.test(n)&&!y;return{ability:u,halfDamageOnSave:y,noDamageOnSave:$}}function ll(a){const n=a.description;return/(plus|add)\s+your\s+spellcasting\s+(ability\s+)?modifier/i.test(n)}function La(a){const n=a.description.toLowerCase();return n.includes("ranged spell attack")||n.includes("melee spell attack")}function Ka(a){const n=a.description.toLowerCase();if(["Divine Favor","Bless","Aid","Command"].includes(a.name))return!0;const u=["takes","take","deals","deal","damage equal to","force damage","fire damage","cold damage","lightning damage","thunder damage","acid damage","poison damage","necrotic damage","radiant damage","psychic damage","regain","regains","hit point"].some(x=>n.includes(x));return["bonus to attack","bonus to damage","bonus to ac","gains a +","gain a +","+1 bonus","+2 bonus","+3 bonus","advantage on","becomes a magic weapon"].some(x=>n.includes(x))&&!u}function il(a){const n=a.description;let t=0,v=0,u=0,b="";const y=n.match(/\+(\d+)\s+bonus\s+to\s+attack\s+rolls\s+and\s+damage\s+rolls/i);if(y){const $=parseInt(y[1]);t=$,v=$,b=`+${$} to attack and damage rolls`}if(a.name==="Bless"&&(b="Add 1d4 to attack rolls and saves",t="1d4"),a.name==="Aid")return b="+5 HP (max and current) for 8 hours",{attackBonus:0,damageBonus:0,acBonus:0,hpBonus:5,description:b,name:a.name};a.name==="Divine Favor"&&(b="Your weapon attacks deal an extra 1d4 radiant damage on a hit.",v="1d4");const x=n.match(/\+(\d+)\s+bonus\s+to\s+AC/i);return x&&(u=parseInt(x[1]),b=`+${u} to AC`),a.name==="Haste"&&(b="+2 AC, doubled speed, extra action",u=2),b||t!==0||v!==0||u!==0?{attackBonus:t,damageBonus:v,acBonus:u,description:b||a.description.substring(0,100),name:a.name}:null}var rl=f('<button class="btn btn-secondary">Add Attack</button>'),nl=f('<input type="text" placeholder="Attack name" class="attack-name svelte-14o91c5"/>'),ol=f('<h4 class="attack-name-display svelte-14o91c5"> </h4>'),cl=f('<button class="btn-remove svelte-14o91c5">Ã—</button>'),vl=f('<div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Bonus</label> <input type="number" class="attack-bonus svelte-14o91c5"/></div>'),dl=f('<div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Damage</label> <input type="text" placeholder="e.g., 2d6+3" class="attack-damage svelte-14o91c5"/></div>'),ul=f('<div class="spell-info-loading svelte-14o91c5">Loading spell info...</div>'),pl=f('<li class="svelte-14o91c5"><strong>At Higher Levels:</strong> </li>'),fl=f('<ul class="svelte-14o91c5"><li class="svelte-14o91c5"><strong>Level:</strong> </li> <li class="svelte-14o91c5"><strong>Casting Time:</strong> </li> <li class="svelte-14o91c5"><strong>Range:</strong> </li> <li class="svelte-14o91c5"><strong>Components:</strong> <!></li> <li class="svelte-14o91c5"><strong>Duration:</strong> <!> </li> <li class="svelte-14o91c5"><strong>Description:</strong> </li> <!></ul>'),gl=f('<span class="scaled-damage svelte-14o91c5" style="margin-left: 8px;"> </span>'),bl=f('<span class="scaled-damage svelte-14o91c5">(Half damage)</span>'),hl=f('<span class="scaled-damage svelte-14o91c5">(No damage)</span>'),ml=f('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> <!> <!></label></div>'),_l=f("<option> </option>"),yl=f('<span class="scaled-damage svelte-14o91c5"><!> </span>'),kl=f('<span class="scaled-damage svelte-14o91c5"> </span>'),Sl=f('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> Target is Fiend or Undead <!></label></div>'),xl=f('<div class="spell-level-selector svelte-14o91c5"><label class="svelte-14o91c5">Cast at Level:</label> <select class="spell-level-select use-enabled svelte-14o91c5"></select> <!></div> <!>',1),$l=f('<div class="spell-level-selector svelte-14o91c5"><span style="color: #dc3545; font-weight: bold;">No spell slots available!</span></div>'),Cl=f('<div class="spell-info svelte-14o91c5"><div class="spell-info-header svelte-14o91c5" role="button" tabindex="0"><h4 class="svelte-14o91c5">Spell Info</h4> <button class="collapse-btn-small svelte-14o91c5"> </button></div> <!></div> <!> <!>',1),wl=f('<div class="spell-info-missing svelte-14o91c5">Spell info not found.</div>'),Ll=f('<div class="attack-notes svelte-14o91c5"><label class="svelte-14o91c5">Notes</label> <textarea placeholder="e.g., DC 15 Dex save, Range 120 ft, Concentration" class="notes-input svelte-14o91c5" rows="2"></textarea></div>'),Dl=f('<button class="btn btn-primary">Roll Attack</button>'),jl=f('<div class="buff-target-selection svelte-14o91c5"><div class="target-options svelte-14o91c5"><label class="target-option svelte-14o91c5"><input type="radio" class="svelte-14o91c5"/> Self</label> <label class="target-option svelte-14o91c5"><input type="radio" class="svelte-14o91c5"/> Other</label></div> <button class="btn btn-info"> </button></div>'),Bl=f('<button class="btn btn-info">Cast Spell</button>'),Al=f("<button><!></button>"),Fl=f('<button class="btn btn-info">Cast Spell</button>'),Ml=f('<button class="btn btn-secondary">Roll Damage</button>'),Pl=f('<button class="btn btn-primary">Roll Attack</button> <!>',1),Rl=f('<div class="attack-card svelte-14o91c5"><div class="attack-header svelte-14o91c5"><!> <!></div> <div class="attack-details svelte-14o91c5"><!> <!> <div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Type</label> <input type="text" placeholder="e.g., slashing" class="attack-type svelte-14o91c5"/></div></div> <!> <!> <div class="attack-actions svelte-14o91c5"><!></div></div>'),Tl=f('<p class="no-attacks svelte-14o91c5">No attacks added yet. Click "Add Attack" to create one.</p>'),Il=f('<p class="no-attacks svelte-14o91c5">No attacks match your search.</p>'),El=f('<button class="btn-remove svelte-14o91c5">Ã—</button>'),Hl=f('<div class="state-card svelte-14o91c5"><div class="state-header svelte-14o91c5"><input type="text" placeholder="Effect name (e.g., Magic Weapon)" class="state-name svelte-14o91c5"/> <!></div> <div class="state-details svelte-14o91c5"><div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Attack Bonus</label> <input type="number" class="state-bonus svelte-14o91c5"/></div> <div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Damage Bonus</label> <input type="text" class="state-bonus svelte-14o91c5"/></div> <div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Target</label> <select class="state-bonus svelte-14o91c5"><option>Self</option><option>Other</option></select></div></div> <div class="state-description svelte-14o91c5"><label class="svelte-14o91c5">Description</label> <input type="text" placeholder="e.g., +1 to attack and damage rolls (Magic Weapon)" class="state-desc-input svelte-14o91c5"/></div></div>'),Ul=f('<div class="states-list svelte-14o91c5"></div>'),Nl=f('<p class="no-states svelte-14o91c5">No active effects. Add spell effects that modify your attacks.</p>'),Gl=f('<!> <div class="attacks-list svelte-14o91c5"><!> <!></div> <div class="active-states-section svelte-14o91c5"><h3 class="svelte-14o91c5">Active Spell Effects</h3> <p class="section-description svelte-14o91c5">Effects that modify attack and damage rolls (e.g., Magic Weapon, Bless)</p> <button class="btn btn-secondary">Add Effect</button> <!></div>',1),Ol=f("<section><!> <!></section>");function ql(a,n){Et(n,!1);const t=()=>tt(ne,"$character",x),v=()=>tt(ga,"$abilityModifiers",x),u=()=>tt(ea,"$searchFilter",x),b=()=>tt(Pt,"$collapsedStates",x),y=()=>tt(Zt,"$isEditMode",x),[x,$]=Wt(),S=A(),X=A(),q=[],de=la();let J=A({}),Z=A({});function ke(g){sa(J,e(J)[g]=!e(J)[g]),o(J,{...e(J)})}function fe(g){return g.description.toLowerCase().includes("regain")&&(g.description.toLowerCase().includes("hit point")||g.description.toLowerCase().includes("hp"))}function N(g){return["Shield of Faith","Bless","Aid","Magic Weapon"].includes(g)}function Fe(){ne.update(g=>(g.attacks=[...g.attacks,{id:crypto.randomUUID(),name:"",bonus:0,damage:"",damageType:"",notes:""}],g))}function Ye(g){ne.update(R=>(R.attacks=R.attacks.filter(Q=>Q.id!==g),R))}function ge(g){let R=g.damage,Q=!1,ae=!1;if(g.spellRef){const Se=ye(g.spellRef);if(Se&&(ae=La(Se),Se.level>0)){const Ke=g.castAtLevel||Se.level;if(!Ue(Ke)){qt.add(`No level ${Ke} spell slots available!`,"error");return}const C=_a(Se);C&&g.targetSucceededSave&&C.noDamageOnSave?R="0":(Q=C?.halfDamageOnSave&&g.targetSucceededSave||!1,R=W(g,Se))}}else if(t().activeStates&&t().activeStates.length>0){let Se=0,Ke=[];for(const B of t().activeStates)B.target!=="other"&&(typeof B.damageBonus=="string"?Ke.push(B.damageBonus):typeof B.damageBonus=="number"&&(Se+=B.damageBonus));if((Se!==0||Ke.length>0)&&R){const B=R.match(/(\d+d\d+)([+-]\d+)?/);if(B){const[,C,oe]=B,z=(oe?parseInt(oe):0)+Se;let d=`${C}`;z!==0&&(d+=`${z>=0?"+":""}${z}`),Ke.length>0&&(d+=" + "+Ke.join(" + ")),R=d}}}const G=[];let me=0;if(ae){const Se=Wa(t(),v()),Ke=t().proficiencyBonus||0;G.push({value:Ke,source:"proficiency"}),G.push({value:Se,source:"spellcasting"}),me=Ke+Se}else g.bonus!==0&&G.push({value:g.bonus,source:"base"}),me=g.bonus;let Le=[];if(t().activeStates)for(const Se of t().activeStates)Se.target!=="other"&&(typeof Se.attackBonus=="number"&&Se.attackBonus!==0?(G.push({value:Se.attackBonus,source:Se.name.toLowerCase()}),me+=Se.attackBonus):typeof Se.attackBonus=="string"&&Se.attackBonus&&(Le.push(Se.attackBonus),G.push({value:Se.attackBonus,source:Se.name.toLowerCase()})));let at=`1d20${me>=0?"+":""}${me}`;Le.length>0&&(at+="+"+Le.join("+")),de("roll",{notation:at,damageNotation:R,attackName:g.name,applyHalfDamage:Q,bonusBreakdown:G,rollType:"attack"})}function He(g){if(!g.damage){qt.add(`${g.name}: No damage specified`,"error");return}let R=g.damage,Q=!1;const ae=[];if(g.spellRef){const G=ye(g.spellRef);if(G&&G.level>0){const me=g.castAtLevel||G.level;if(!Ue(me)){qt.add(`No level ${me} spell slots available!`,"error");return}const at=_a(G);at&&g.targetSucceededSave&&at.noDamageOnSave?R="0":(Q=at?.halfDamageOnSave&&g.targetSucceededSave||!1,R=W(g,G))}}else{const G=R.match(/(\d+d\d+)([+-]\d+)?/);if(G){const[,me,Le]=G,at=Le?parseInt(Le):0;if(at!==0&&ae.push({value:at,source:"base"}),t().activeStates&&t().activeStates.length>0){let Se=0,Ke=[];for(const B of t().activeStates)B.target!=="other"&&(typeof B.damageBonus=="string"?Ke.push(B.damageBonus):typeof B.damageBonus=="number"&&B.damageBonus!==0&&(ae.push({value:B.damageBonus,source:B.name.toLowerCase()}),Se+=B.damageBonus));if(Se!==0||Ke.length>0){const B=at+Se;let C=`${me}`;B!==0&&(C+=`${B>=0?"+":""}${B}`),Ke.length>0&&(C+=" + "+Ke.join(" + ")),R=C}}}}de("roll",{notation:R,attackName:g.name,applyHalfDamage:Q,bonusBreakdown:ae})}let We=A([]),le=A(!1);pa(async()=>{o(We,await ls()),o(le,!0)});function ye(g){return e(We).find(R=>R.name===g)}function Ue(g){t().classFeatures.spellSlotsByLevel||ht(ne,r(t).classFeatures.spellSlotsByLevel={},r(t)),t().classFeatures.spellSlotsByLevel[g]||ht(ne,r(t).classFeatures.spellSlotsByLevel[g]=Array(2).fill(!1),r(t));const Q=t().classFeatures.spellSlotsByLevel[g].findIndex(ae=>!ae);return Q===-1?!1:(ne.update(ae=>(ae.classFeatures.spellSlotsByLevel||(ae.classFeatures.spellSlotsByLevel={}),ae.classFeatures.spellSlotsByLevel[g]||(ae.classFeatures.spellSlotsByLevel[g]=Array(2).fill(!1)),ae.classFeatures.spellSlotsByLevel[g][Q]=!0,ae)),!0)}function W(g,R){let Q=g.damage,ae=0,G=0;if(ll(R)&&(G+=Wa(t(),v())),t().activeStates)for(const ue of t().activeStates)ue.target!=="other"&&typeof ue.damageBonus=="number"&&(G+=ue.damageBonus);if(R.higherLevelSlot&&g.castAtLevel){const ue=R.level,d=(g.castAtLevel||ue)-ue;if(d>0){const ze=R.higherLevelSlot.match(/(\d+)d(\d+)\s+for\s+each.*?level\s+above/i);if(ze){const[,ce]=ze;ae+=d*parseInt(ce)}}}if(g.targetIsFiendOrUndead&&R.description.includes("Fiend or an Undead")){const ue=R.description.match(/increases by (\d+)d(\d+) if.*?Fiend or.*?Undead/i);if(ue){const[,z]=ue;ae+=parseInt(z)}}const me=Q.match(/(\d+)d(\d+)([+-]\d+)?/);if(!me)return G!==0?G>=0?`${G}`:`${G}`:Q||"0";const[,Le,at,Se]=me,Ke=parseInt(Le)+ae,C=(Se?parseInt(Se):0)+G;let oe=`${Ke}d${at}`;return C!==0&&(oe+=C>=0?`+${C}`:`${C}`),oe}function ee(g){const R=[];for(let ae=g.level;ae<=9;ae++){const G=t().classFeatures.spellSlotsByLevel?.[ae];G&&G.length>0&&R.push(ae)}return R}function k(){ne.update(g=>(g.activeStates||(g.activeStates=[]),g.activeStates=[...g.activeStates,{name:"",attackBonus:0,damageBonus:0,description:"",target:"self"}],g))}function Y(g){ne.update(R=>{if(R.activeStates){const Q=R.activeStates[g];Q?.hpBonus&&Q.target!=="other"&&(R.maxHP-=Q.hpBonus,R.currentHP=Math.max(1,Math.min(R.currentHP-Q.hpBonus,R.maxHP))),R.activeStates=R.activeStates.filter((ae,G)=>G!==g)}return R})}function h(g,R="self"){const Q=ye(g.spellRef);if(!Q){qt.add("Spell not found","error");return}const ae=g.castAtLevel||Q.level;if(ae>0&&!Ue(ae)){qt.add(`No level ${ae} spell slots available!`,"error");return}const G=il(Q);if(!G){qt.add(`${Q.name} cast! Check spell description for effects.`,"info");return}let me=G.hpBonus||0,Le=G.description;Q.name==="Aid"&&ae>Q.level&&(me=5+(ae-Q.level)*5,Le=`+${me} HP (max and current) for 8 hours`);const Se=["Shield of Faith","Bless","Aid","Magic Weapon"].includes(Q.name);ne.update(B=>{B.activeStates||(B.activeStates=[]);const C=B.activeStates.find(oe=>oe.name===Q.name);return C&&C.hpBonus&&C.target!=="other"&&(B.maxHP-=C.hpBonus,B.currentHP=Math.max(1,Math.min(B.currentHP-C.hpBonus,B.maxHP))),B.activeStates=B.activeStates.filter(oe=>oe.name!==Q.name),me>0&&R==="self"&&(B.maxHP+=me,B.currentHP+=me),B.activeStates=[...B.activeStates,{name:Q.name,attackBonus:G.attackBonus,damageBonus:G.damageBonus,acBonus:G.acBonus,description:Le,target:R,hpBonus:me}],B});const Ke=R==="self"?" on self":" on other";qt.add(`${Q.name} cast${Se?Ke:""}! Effect added to Active Spell Effects.`,"success")}Xe(()=>(t(),e(J),e(Z)),()=>{if(t()&&t().attacks)for(const g of t().attacks)g.spellRef&&e(J)[g.id]===void 0&&sa(J,e(J)[g.id]=!0),g.spellRef&&e(Z)[g.id]===void 0&&sa(Z,e(Z)[g.id]="self")}),Xe(()=>(t(),u()),()=>{o(S,t().attacks.filter(g=>{if(!u())return!0;const R=u().toLowerCase();return g.name.toLowerCase().includes(R)||g.damageType.toLowerCase().includes(R)}).sort((g,R)=>!g.spellRef&&R.spellRef?-1:g.spellRef&&!R.spellRef?1:0))}),Xe(()=>(u(),e(S)),()=>{o(X,!u()||e(S).length>0||"attack".includes(u().toLowerCase())||"spell".includes(u().toLowerCase()))}),Jt(),It();var F=Ol();let te;var Ae=i(F);{let g=vt(()=>(b(),r(()=>b().attacks?"Expand":"Collapse")));ia(Ae,{title:"Attacks & Spells",get collapsed(){return b(),r(()=>b().attacks)},get ariaLabel(){return e(g)},onToggle:()=>Pt.update(R=>({...R,attacks:!R.attacks}))})}var Te=s(Ae,2);{var $e=g=>{var R=Gl(),Q=Oe(R);{var ae=z=>{var d=rl();M("click",d,Fe),c(z,d)};_(Q,z=>{y()&&z(ae)})}var G=s(Q,2),me=i(G);yt(me,1,()=>e(S),z=>z.id,(z,d,ze)=>{var ce=Rl(),ve=i(ce),D=i(ve);{var Me=j=>{var T=nl();we(T),qe(T,()=>e(d).name,K=>(e(d).name=K,jt(()=>(e(S),t(),u())))),c(j,T)},Ie=j=>{var T=ol(),K=i(T,!0);l(T),P(()=>L(K,(e(d),r(()=>e(d).name||"(Unnamed Attack)")))),c(j,T)};_(D,j=>{y()?j(Me):j(Ie,!1)})}var Ze=s(D,2);{var lt=j=>{var T=cl();M("click",T,()=>Ye(e(d).id)),c(j,T)};_(Ze,j=>{y()&&j(lt)})}l(ve);var De=s(ve,2),_e=i(De);{var je=j=>{var T=vl(),K=i(T),Be=s(K,2);we(Be),l(T),P(()=>{Ge(K,"for",`attack-bonus-${e(d),r(()=>e(d).id)??""}`),Ge(Be,"id",`attack-bonus-${e(d),r(()=>e(d).id)??""}`)}),qe(Be,()=>e(d).bonus,Pe=>(e(d).bonus=Pe,jt(()=>(e(S),t(),u())))),c(j,T)};_(_e,j=>{e(d),r(()=>e(d).bonus!==0&&e(d).bonus!==void 0)&&j(je)})}var Ee=s(_e,2);{var H=j=>{var T=dl(),K=i(T),Be=s(K,2);we(Be),l(T),P(()=>{Ge(K,"for",`attack-damage-${e(d),r(()=>e(d).id)??""}`),Ge(Be,"id",`attack-damage-${e(d),r(()=>e(d).id)??""}`)}),qe(Be,()=>e(d).damage,Pe=>(e(d).damage=Pe,jt(()=>(e(S),t(),u())))),c(j,T)};_(Ee,j=>{e(d),r(()=>e(d).damage&&e(d).damage.trim()!=="")&&j(H)})}var ie=s(Ee,2),O=i(ie),be=s(O,2);we(be),l(ie),l(De);var Ne=s(De,2);{var Je=j=>{var T=ct(),K=Oe(T);{var Be=rt=>{var V=ul();c(rt,V)},Pe=rt=>{const V=vt(()=>(e(d),r(()=>ye(e(d).spellRef))));var pt=ct(),xt=Oe(pt);{var _t=E=>{const w=vt(()=>(I(_a),I(e(V)),r(()=>_a(e(V)))));var Ce=Cl(),re=Oe(Ce),et=i(re),Re=s(i(et),2),ft=i(Re,!0);l(Re),l(et);var Ve=s(et,2);{var nt=Qe=>{var st=fl(),dt=i(st),Ct=s(i(dt));l(dt);var Ut=s(dt,2),Nt=s(i(Ut));l(Ut);var At=s(Ut,2),wt=s(i(At));l(At);var Lt=s(At,2),Gt=s(i(Lt)),ut=s(Gt);{var Ot=$t=>{var Dt=Mt();P(()=>L(Dt,`(${I(e(V)),r(()=>e(V).material)??""})`)),c($t,Dt)};_(ut,$t=>{I(e(V)),r(()=>e(V).material)&&$t(Ot)})}l(Lt);var Vt=s(Lt,2),Qt=s(i(Vt),2);{var ta=$t=>{var Dt=Mt("Concentration,");c($t,Dt)};_(Qt,$t=>{I(e(V)),r(()=>e(V).concentration)&&$t(ta)})}var Bt=s(Qt,1,!0);l(Vt);var Rt=s(Vt,2),Ft=s(i(Rt));l(Rt);var zt=s(Rt,2);{var Yt=$t=>{var Dt=pl(),Kt=s(i(Dt));l(Dt),P(()=>L(Kt,` ${I(e(V)),r(()=>e(V).higherLevelSlot)??""}`)),c($t,Dt)};_(zt,$t=>{I(e(V)),r(()=>e(V).higherLevelSlot)&&$t(Yt)})}l(st),P($t=>{L(Ct,` ${I(e(V)),r(()=>e(V).level)??""}`),L(Nt,` ${I(e(V)),r(()=>e(V).castingTime||e(V).actionType)??""}`),L(wt,` ${I(e(V)),r(()=>e(V).range)??""}`),L(Gt,` ${$t??""}`),L(Bt,(I(e(V)),r(()=>e(V).duration))),L(Ft,` ${I(e(V)),r(()=>e(V).description)??""}`)},[()=>(I(e(V)),r(()=>e(V).components.join(", ")))]),c(Qe,st)};_(Ve,Qe=>{e(J),e(d),r(()=>!e(J)[e(d).id])&&Qe(nt)})}l(re);var it=s(re,2);{var ot=Qe=>{var st=ml(),dt=i(st),Ct=i(dt);we(Ct);var Ut=s(Ct),Nt=s(Ut);{var At=ut=>{var Ot=gl(),Vt=i(Ot);l(Ot),P(Qt=>L(Vt,`(Spell Save DC: ${Qt??""})`),[()=>(I(Pa),t(),v(),r(()=>Pa(t(),v())))]),c(ut,Ot)};_(Nt,ut=>{t(),r(()=>t().class)&&ut(At)})}var wt=s(Nt,2);{var Lt=ut=>{var Ot=bl();c(ut,Ot)},Gt=ut=>{var Ot=ct(),Vt=Oe(Ot);{var Qt=ta=>{var Bt=hl();c(ta,Bt)};_(Vt,ta=>{e(d),I(e(w)),r(()=>e(d).targetSucceededSave&&e(w).noDamageOnSave)&&ta(Qt)},!0)}c(ut,Ot)};_(wt,ut=>{e(d),I(e(w)),r(()=>e(d).targetSucceededSave&&e(w).halfDamageOnSave)?ut(Lt):ut(Gt,!1)})}l(dt),l(st),P(ut=>L(Ut,` Target succeeded on ${ut??""} save `),[()=>(I(e(w)),r(()=>e(w).ability.charAt(0).toUpperCase()+e(w).ability.slice(1)))]),Fa(Ct,()=>e(d).targetSucceededSave,ut=>(e(d).targetSucceededSave=ut,jt(()=>(e(S),t(),u())))),c(Qe,st)};_(it,Qe=>{e(w)&&Qe(ot)})}var gt=s(it,2);{var bt=Qe=>{const st=vt(()=>(I(e(V)),r(()=>ee(e(V)))));var dt=ct(),Ct=Oe(dt);{var Ut=At=>{var wt=xl(),Lt=Oe(wt),Gt=i(Lt),ut=s(Gt,2);P(()=>{e(d),jt(()=>{e(st)})}),yt(ut,5,()=>e(st),St,(Bt,Rt)=>{var Ft=_l(),zt=i(Ft);l(Ft);var Yt={};P(()=>{L(zt,`Level ${e(Rt)??""}`),Yt!==(Yt=e(Rt))&&(Ft.value=(Ft.__value=e(Rt))??"")}),c(Bt,Ft)}),l(ut);var Ot=s(ut,2);{var Vt=Bt=>{const Rt=vt(()=>(e(d),I(e(V)),r(()=>W(e(d),e(V)))));var Ft=yl(),zt=i(Ft);{var Yt=Kt=>{var aa=Mt("Healing");c(Kt,aa)},$t=Kt=>{var aa=Mt("Damage");c(Kt,aa)};_(zt,Kt=>{I(e(V)),r(()=>fe(e(V)))?Kt(Yt):Kt($t,!1)})}var Dt=s(zt);l(Ft),P(()=>L(Dt,` ${e(Rt)??""}`)),c(Bt,Ft)};_(Ot,Bt=>{e(d),I(e(V)),r(()=>e(d).castAtLevel&&e(d).castAtLevel>e(V).level)&&Bt(Vt)})}l(Lt);var Qt=s(Lt,2);{var ta=Bt=>{var Rt=Sl(),Ft=i(Rt),zt=i(Ft);we(zt);var Yt=s(zt,2);{var $t=Dt=>{const Kt=vt(()=>(e(d),I(e(V)),r(()=>W(e(d),e(V)))));var aa=kl(),is=i(aa);l(aa),P(()=>L(is,`(+1d8, total: ${e(Kt)??""})`)),c(Dt,aa)};_(Yt,Dt=>{e(d),r(()=>e(d).targetIsFiendOrUndead)&&Dt($t)})}l(Ft),l(Rt),Fa(zt,()=>e(d).targetIsFiendOrUndead,Dt=>(e(d).targetIsFiendOrUndead=Dt,jt(()=>(e(S),t(),u())))),c(Bt,Rt)};_(Qt,Bt=>{I(e(V)),r(()=>e(V).description.includes("Fiend or an Undead"))&&Bt(ta)})}P(()=>{Ge(Gt,"for",`castLevel-${e(d),r(()=>e(d).id)??""}`),Ge(ut,"id",`castLevel-${e(d),r(()=>e(d).id)??""}`)}),Aa(ut,()=>e(d).castAtLevel,Bt=>(e(d).castAtLevel=Bt,jt(()=>(e(S),t(),u())))),c(At,wt)},Nt=At=>{var wt=$l();c(At,wt)};_(Ct,At=>{I(e(st)),r(()=>e(st).length>0)?At(Ut):At(Nt,!1)})}c(Qe,dt)};_(gt,Qe=>{I(e(V)),r(()=>e(V).higherLevelSlot&&e(V).level>0)&&Qe(bt)})}P(()=>{Ge(Re,"aria-label",(e(J),e(d),r(()=>e(J)[e(d).id]?"Expand":"Collapse"))),L(ft,(e(J),e(d),r(()=>e(J)[e(d).id]?"â–¼":"â–²")))}),M("click",et,()=>ke(e(d).id)),M("keydown",et,Qe=>Qe.key==="Enter"&&ke(e(d).id)),c(E,Ce)},p=E=>{var w=wl();c(E,w)};_(xt,E=>{e(V)?E(_t):E(p,!1)})}c(rt,pt)};_(K,rt=>{e(We),r(()=>e(We).length===0)?rt(Be):rt(Pe,!1)})}c(j,T)};_(Ne,j=>{e(d),r(()=>e(d).spellRef)&&j(Je)})}var xe=s(Ne,2);{var m=j=>{var T=Ll(),K=i(T),Be=s(K,2);da(Be),l(T),P(()=>{Ge(K,"for",`attack-notes-${e(d),r(()=>e(d).id)??""}`),Ge(Be,"id",`attack-notes-${e(d),r(()=>e(d).id)??""}`)}),qe(Be,()=>e(d).notes,Pe=>(e(d).notes=Pe,jt(()=>(e(S),t(),u())))),c(j,T)};_(xe,j=>{e(d),r(()=>!e(d).spellRef)&&j(m)})}var U=s(xe,2),pe=i(U);{var se=j=>{const T=vt(()=>(e(d),r(()=>ye(e(d).spellRef))));var K=ct(),Be=Oe(K);{var Pe=rt=>{var V=ct(),pt=Oe(V);{var xt=p=>{var E=Dl();M("click",E,()=>ge(e(d))),c(p,E)},_t=p=>{var E=ct(),w=Oe(E);{var Ce=et=>{var Re=ct(),ft=Oe(Re);{var Ve=it=>{var ot=jl(),gt=i(ot),bt=i(gt),Qe=i(bt);we(Qe),Qe.value=Qe.__value="self",ra(),l(bt);var st=s(bt,2),dt=i(st);we(dt),dt.value=dt.__value="other",ra(),l(st),l(gt);var Ct=s(gt,2),Ut=i(Ct);l(Ct),l(ot),P(()=>{Ge(Qe,"name",`target-${e(d),r(()=>e(d).id)??""}`),Ge(dt,"name",`target-${e(d),r(()=>e(d).id)??""}`),L(Ut,`Cast ${I(e(T)),r(()=>e(T).name)??""}`)}),Ua(q,[ze],Qe,()=>e(Z)[e(d).id],Nt=>sa(Z,e(Z)[e(d).id]=Nt)),Ua(q,[ze],dt,()=>e(Z)[e(d).id],Nt=>sa(Z,e(Z)[e(d).id]=Nt)),M("click",Ct,()=>h(e(d),e(Z)[e(d).id])),c(it,ot)},nt=it=>{var ot=Bl();M("click",ot,()=>h(e(d),"self")),c(it,ot)};_(ft,it=>{I(e(T)),r(()=>N(e(T).name))?it(Ve):it(nt,!1)})}c(et,Re)},re=et=>{var Re=ct(),ft=Oe(Re);{var Ve=it=>{var ot=Al(),gt=i(ot);{var bt=st=>{var dt=Mt("Roll Healing");c(st,dt)},Qe=st=>{var dt=Mt("Roll Damage");c(st,dt)};_(gt,st=>{I(e(T)),r(()=>fe(e(T)))?st(bt):st(Qe,!1)})}l(ot),P(st=>mt(ot,1,`btn ${st??""}`),[()=>(I(e(T)),r(()=>fe(e(T))?"btn-success":"btn-secondary"))]),M("click",ot,()=>He(e(d))),c(it,ot)},nt=it=>{var ot=Fl();M("click",ot,()=>h(e(d),"self")),c(it,ot)};_(ft,it=>{e(d),r(()=>e(d).damage&&e(d).damage.trim()!=="")?it(Ve):it(nt,!1)})}c(et,Re)};_(w,et=>{I(Ka),I(e(T)),r(()=>Ka(e(T)))?et(Ce):et(re,!1)},!0)}c(p,E)};_(pt,p=>{I(La),I(e(T)),r(()=>La(e(T)))?p(xt):p(_t,!1)})}c(rt,V)};_(Be,rt=>{e(T)&&rt(Pe)})}c(j,K)},he=j=>{var T=ct(),K=Oe(T);{var Be=Pe=>{var rt=Pl(),V=Oe(rt),pt=s(V,2);{var xt=_t=>{var p=Ml();M("click",p,()=>He(e(d))),c(_t,p)};_(pt,_t=>{e(d),r(()=>e(d).damage&&e(d).damage.trim()!=="")&&_t(xt)})}M("click",V,()=>ge(e(d))),c(Pe,rt)};_(K,Pe=>{e(d),r(()=>!e(d).spellRef)&&Pe(Be)},!0)}c(j,T)};_(pe,j=>{e(d),e(le),r(()=>e(d).spellRef&&e(le))?j(se):j(he,!1)})}l(U),l(ce),P(()=>{Ge(O,"for",`attack-type-${e(d),r(()=>e(d).id)??""}`),Ge(be,"id",`attack-type-${e(d),r(()=>e(d).id)??""}`)}),qe(be,()=>e(d).damageType,j=>(e(d).damageType=j,jt(()=>(e(S),t(),u())))),c(z,ce)});var Le=s(me,2);{var at=z=>{var d=Tl();c(z,d)},Se=z=>{var d=ct(),ze=Oe(d);{var ce=ve=>{var D=Il();c(ve,D)};_(ze,ve=>{e(S),r(()=>e(S).length===0)&&ve(ce)},!0)}c(z,d)};_(Le,z=>{t(),r(()=>t().attacks.length===0)?z(at):z(Se,!1)})}l(G);var Ke=s(G,2),B=s(i(Ke),4),C=s(B,2);{var oe=z=>{var d=Ul();yt(d,5,()=>(t(),r(()=>t().activeStates)),St,(ze,ce,ve)=>{var D=Hl(),Me=i(D),Ie=i(Me);we(Ie);var Ze=s(Ie,2);{var lt=he=>{var j=El();M("click",j,()=>Y(ve)),c(he,j)};_(Ze,he=>{y()&&he(lt)})}l(Me);var De=s(Me,2),_e=i(De),je=i(_e);Ge(je,"for",`state-attack-bonus-${ve}`);var Ee=s(je,2);we(Ee),Ge(Ee,"id",`state-attack-bonus-${ve}`),l(_e);var H=s(_e,2),ie=i(H);Ge(ie,"for",`state-damage-bonus-${ve}`);var O=s(ie,2);we(O),Ge(O,"id",`state-damage-bonus-${ve}`),l(H);var be=s(H,2),Ne=i(be);Ge(Ne,"for",`state-target-${ve}`);var Je=s(Ne,2);P(()=>{e(ce),jt(()=>{})}),Ge(Je,"id",`state-target-${ve}`);var xe=i(Je);xe.value=xe.__value="self";var m=s(xe);m.value=m.__value="other",l(Je),l(be),l(De);var U=s(De,2),pe=i(U);Ge(pe,"for",`state-desc-${ve}`);var se=s(pe,2);we(se),Ge(se,"id",`state-desc-${ve}`),l(U),l(D),qe(Ie,()=>e(ce).name,he=>(e(ce).name=he,jt(()=>t()),ca(x,"$character"))),qe(Ee,()=>e(ce).attackBonus,he=>(e(ce).attackBonus=he,jt(()=>t()),ca(x,"$character"))),qe(O,()=>e(ce).damageBonus,he=>(e(ce).damageBonus=he,jt(()=>t()),ca(x,"$character"))),Aa(Je,()=>e(ce).target,he=>(e(ce).target=he,jt(()=>t()),ca(x,"$character"))),qe(se,()=>e(ce).description,he=>(e(ce).description=he,jt(()=>t()),ca(x,"$character"))),c(ze,D)}),l(d),c(z,d)},ue=z=>{var d=Nl();c(z,d)};_(C,z=>{t(),r(()=>t().activeStates&&t().activeStates.length>0)?z(oe):z(ue,!1)})}l(Ke),M("click",B,k),c(g,R)};_(Te,g=>{b(),r(()=>!b().attacks)&&g($e)})}l(F),P(()=>te=mt(F,1,"attacks svelte-14o91c5",null,te,{hidden:!e(X)})),c(a,F),Ht(),$()}var Wl=f('<span class="slot-checkbox-x svelte-serp1j">&#8212;</span>'),zl=f('<label><input type="checkbox" class="slot-checkbox-input svelte-serp1j"/> <span><!></span></label>');function Va(a,n){Et(n,!1);const t=()=>tt(Zt,"$isEditMode",v),[v,u]=Wt();let b=kt(n,"checked",8,!1),y=kt(n,"disabled",8,!1),x=kt(n,"className",8,""),$=kt(n,"index",8,void 0),S=kt(n,"ariaLabel",8,void 0);const X=la();function q(N){X("change",{checked:N.currentTarget.checked,index:$()})}It();var de=zl(),J=i(de);we(J);var Z=s(J,2),ke=i(Z);{var fe=N=>{var Fe=Wl();c(N,Fe)};_(ke,N=>{b()&&N(fe)})}l(Z),l(de),P(()=>{mt(de,1,"slot-checkbox-label "+x()+(t()?"":" not-editable"),"svelte-serp1j"),ts(J,b()),J.disabled=y()||!t(),Ge(J,"aria-label",S()),Ge(J,"tabindex",t()?0:-1),mt(Z,1,`slot-checkbox-custom ${b()?"used":""} ${t()?"":"readonly"}`,"svelte-serp1j")}),M("change",J,q),c(a,de),Ht(),u()}var Kl=f('<p class="no-features svelte-1kpvv0n">Select a class to see available features</p>'),Vl=f('<p class="no-features svelte-1kpvv0n">No class features available at this level</p>'),Jl=f('<div class="spell-slots svelte-1kpvv0n"><label class="svelte-1kpvv0n"> </label> <div class="slots-tracker svelte-1kpvv0n"></div></div>'),Ql=f('<div class="all-spell-slots"></div>'),Yl=f('<div class="feature-box spellcasting svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"> </h3> <div class="spell-stats svelte-1kpvv0n"><div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Spell Save DC</label> <div class="spell-value svelte-1kpvv0n"> </div></div> <div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <div class="spell-value svelte-1kpvv0n"> </div></div></div> <!> <div class="prepared-spells svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <textarea placeholder="List your prepared spells..." class="svelte-1kpvv0n"></textarea></div></div>'),Xl=f('<p class="unlimited svelte-1kpvv0n">Unlimited Uses</p>'),Zl=f('<div class="slots-tracker svelte-1kpvv0n"></div> <div class="uses-actions-row"><button class="btn btn-primary use-enabled"> </button></div> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div>',1),ei=f('<div class="uses-tracker svelte-1kpvv0n"><!></div>'),ti=f('<div class="pool-tracker svelte-1kpvv0n"><input type="number" min="0" class="pool-input svelte-1kpvv0n"/> <span> </span> <button class="btn-small svelte-1kpvv0n"> </button></div>'),ai=f('<p class="no-uses svelte-1kpvv0n">No Channel Divinity uses remaining</p>'),si=f('<div class="channel-divinity-option svelte-1kpvv0n"><button class="btn btn-primary use-enabled svelte-1kpvv0n">Use Channel Divinity</button> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div> <!></div>'),li=f('<div class="feature-box svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"><!> </h3> <p class="feature-description svelte-1kpvv0n"> </p> <!></div>'),ii=f('<div class="features-grid svelte-1kpvv0n"><!> <!></div>'),ri=f("<section><!> <!></section>");function ni(a,n){Et(n,!1);const t=()=>tt(ne,"$character",y),v=()=>tt(ga,"$abilityModifiers",y),u=()=>tt(ea,"$searchFilter",y),b=()=>tt(Pt,"$collapsedStates",y),[y,x]=Wt(),$=A(),S=A(),X=A(),q=A(),de=A(),J=A(),Z=A();let ke=A(0),fe=A(0);function N(h,F){ne.update(te=>(te.classFeatures.features[h]=F,te))}function Fe(){ne.update(h=>(h.classFeatures.spellSlotsByLevel||(h.classFeatures.spellSlotsByLevel={}),e(q).forEach(({level:F,slots:te})=>{h.classFeatures.spellSlotsByLevel[F]||(h.classFeatures.spellSlotsByLevel[F]=Array(te).fill(!1))}),h))}function Ye(h){if(typeof h.maxUses=="function"){if((h.name==="Divine Sense"||h.name==="War Priest")&&e($)?.spellcastingAbility){const F=v()[e($).spellcastingAbility];return h.maxUses(t().level,F)}return h.maxUses(t().level)}return h.maxUses||0}function ge(h,F){ne.update(te=>((!te.classFeatures.features[h]||!Array.isArray(te.classFeatures.features[h])||te.classFeatures.features[h].length!==F)&&(te.classFeatures.features[h]=Array(F).fill(!1)),te))}rs(()=>{e(J)&&t()&&t().classFeatures&&t().classFeatures.features&&e(J).forEach(h=>{if(h.type==="uses"){const F=h.name.replace(/\s+/g,""),te=Ye(h),Ae=t().classFeatures.features[F];(!Array.isArray(Ae)||Ae.length!==te)&&ge(F,te)}})});function He(h){return typeof h.maxPool=="function"?h.maxPool(t().level):h.maxPool||0}function We(h){return typeof h.description=="function"?h.description(t().level):h.description}function le(){const h="ChannelDivinity";ne.update(F=>{const te=F.classFeatures.features[h];return typeof te=="number"&&te>0&&(F.classFeatures.features[h]=te-1),F})}function ye(){Pt.update(h=>({...h,classFeatures:!h.classFeatures}))}Xe(()=>(t(),Tt),()=>{o($,t().class?Tt(t().class):null)}),Xe(()=>(t(),oa),()=>{o(S,t().class?oa(t().class,t().level,t().subclass):[])}),Xe(()=>(t(),Oa),()=>{o(X,t().class?Oa(t().class,t().level):0)}),Xe(()=>(e($),t()),()=>{o(q,(()=>{if(!e($)?.spellcaster)return[];const h=t().level,F=[];return h>=1&&F.push({level:1,slots:Math.min(4,2+Math.floor(h/3))}),h>=3&&F.push({level:2,slots:Math.min(3,2+Math.floor((h-3)/4))}),h>=5&&F.push({level:3,slots:Math.min(3,2+Math.floor((h-5)/5))}),h>=7&&F.push({level:4,slots:Math.min(3,1+Math.floor((h-7)/6))}),h>=9&&F.push({level:5,slots:Math.min(2,1+Math.floor((h-9)/8))}),h>=11&&F.push({level:6,slots:1}),h>=13&&F.push({level:7,slots:1}),h>=15&&F.push({level:8,slots:1}),h>=17&&F.push({level:9,slots:1}),F})())}),Xe(()=>(e($),v(),t(),qa),()=>{if(e($)?.spellcaster&&e($).spellcastingAbility){const h=v()[e($).spellcastingAbility];o(ke,Ds(t().class,h,t().proficiencyBonus)||0),o(fe,qa(t().class,t().level,h))}}),Xe(()=>(t(),e($),e(q)),()=>{t().class&&e($)?.spellcaster&&e(q).length>0&&Fe()}),Xe(()=>t(),()=>{o(de,(()=>{const F=t().classFeatures.features["ChannelDivinity"];return typeof F=="number"?F:0})())}),Xe(()=>(e(S),u()),()=>{o(J,e(S).filter(h=>{if(!u())return!0;const F=u().toLowerCase();return h.name.toLowerCase().includes(F)||We(h).toLowerCase().includes(F)}))}),Xe(()=>(u(),t(),e(J)),()=>{o(Z,!u()||t().class||"class features".includes(u().toLowerCase())||"spellcasting".includes(u().toLowerCase())||e(J).length>0)}),Jt(),It();var Ue=ri();let W;var ee=i(Ue);{let h=vt(()=>(b(),r(()=>b().classFeatures?"Expand":"Collapse")));ia(ee,{title:"Class Features",get collapsed(){return b(),r(()=>b().classFeatures)},get ariaLabel(){return e(h)},onToggle:ye})}var k=s(ee,2);{var Y=h=>{var F=ct(),te=Oe(F);{var Ae=$e=>{var g=Kl();c($e,g)},Te=$e=>{var g=ct(),R=Oe(g);{var Q=G=>{var me=Vl();c(G,me)},ae=G=>{var me=ii(),Le=i(me);{var at=Ke=>{var B=Yl(),C=i(B),oe=i(C);l(C);var ue=s(C,2),z=i(ue),d=s(i(z),2),ze=i(d,!0);l(d),l(z);var ce=s(z,2),ve=s(i(ce),2),D=i(ve,!0);l(ve),l(ce),l(ue);var Me=s(ue,2);{var Ie=De=>{var _e=Ql();yt(_e,5,()=>e(q),St,(je,Ee)=>{let H=()=>e(Ee).level,ie=()=>e(Ee).slots;const O=vt(()=>(t(),H(),ie(),r(()=>t().classFeatures.spellSlotsByLevel?.[H()]||Array(ie()).fill(!1))));var be=Jl(),Ne=i(be),Je=i(Ne);l(Ne);var xe=s(Ne,2);yt(xe,5,()=>e(O),St,(m,U,pe)=>{{let se=vt(()=>(I(e(O)),r(()=>e(O)[pe]||!1)));Va(m,{get checked(){return e(se)},$$events:{change:he=>{ne.update(j=>(j.classFeatures.spellSlotsByLevel||(j.classFeatures.spellSlotsByLevel={}),j.classFeatures.spellSlotsByLevel[H()]||(j.classFeatures.spellSlotsByLevel[H()]=Array(ie()).fill(!1)),j.classFeatures.spellSlotsByLevel[H()][pe]=he.detail.checked,j))}}})}}),l(xe),l(be),P(()=>L(Je,`${H()===1?"1st":H()===2?"2nd":H()===3?"3rd":`${H()}th`} Level Spell Slots`)),c(je,be)}),l(_e),c(De,_e)};_(Me,De=>{e(q),r(()=>e(q).length>0)&&De(Ie)})}var Ze=s(Me,2),lt=s(i(Ze),2);da(lt),l(Ze),l(B),P(De=>{L(oe,`Spellcasting (${De??""})`),L(ze,e(ke)),L(D,e(fe))},[()=>(e($),r(()=>e($).spellcastingAbility?.toUpperCase()))]),qe(lt,()=>t().classFeatures.preparedSpells,De=>ht(ne,r(t).classFeatures.preparedSpells=De,r(t))),c(Ke,B)};_(Le,Ke=>{e($),r(()=>e($)?.spellcaster)&&Ke(at)})}var Se=s(Le,2);yt(Se,1,()=>e(J),St,(Ke,B)=>{const C=vt(()=>(e(B),r(()=>e(B).name.replace(/\s+/g,"")))),oe=vt(()=>(t(),I(e(C)),r(()=>t().classFeatures.features[e(C)]))),ue=vt(()=>typeof e(oe)=="number");var z=li(),d=i(z),ze=i(d);{var ce=De=>{var _e=Mt("Channel Divinity:");c(De,_e)};_(ze,De=>{e(B),r(()=>e(B).type==="channelDivinity")&&De(ce)})}var ve=s(ze);l(d);var D=s(d,2),Me=i(D,!0);l(D);var Ie=s(D,2);{var Ze=De=>{const _e=vt(()=>(e(B),r(()=>Ye(e(B))))),je=vt(()=>(I(e(oe)),I(e(_e)),r(()=>Array.isArray(e(oe))?e(oe):Array(e(_e)).fill(!1))));var Ee=ei(),H=i(Ee);{var ie=be=>{var Ne=Xl();c(be,Ne)},O=be=>{var Ne=Zl(),Je=Oe(Ne);yt(Je,5,()=>e(je),St,(j,T,K)=>{Va(j,{get checked(){return e(T)},index:K,$$events:{change:Be=>{ne.update(Pe=>(Pe.classFeatures.features[e(C)]||(Pe.classFeatures.features[e(C)]=Array(e(_e)).fill(!1)),Pe.classFeatures.features[e(C)][K]=Be.detail.checked,Pe))}}})}),l(Je);var xe=s(Je,2),m=i(xe),U=i(m);l(m),l(xe);var pe=s(xe,2),se=i(pe),he=i(se);l(se),l(pe),P(j=>{m.disabled=j,L(U,`Use ${e(B),r(()=>e(B).name)??""}`),L(he,`Resets on ${e(B),r(()=>e(B).resetOn==="short"?"Short Rest":"Long Rest")??""}`)},[()=>(I(e(je)),r(()=>e(je).filter(j=>!j).length<=0))]),M("click",m,()=>{ne.update(j=>{j.classFeatures.features[e(C)]||(j.classFeatures.features[e(C)]=Array(e(_e)).fill(!1));const T=j.classFeatures.features[e(C)],K=T.findIndex(Be=>!Be);return K!==-1&&(T[K]=!0),j})}),c(be,Ne)};_(H,be=>{e(_e)===1/0?be(ie):be(O,!1)})}l(Ee),c(De,Ee)},lt=De=>{var _e=ct(),je=Oe(_e);{var Ee=ie=>{const O=vt(()=>(e(B),r(()=>He(e(B)))));var be=ti(),Ne=i(be);we(Ne);var Je=s(Ne,2),xe=i(Je);l(Je);var m=s(Je,2),U=i(m,!0);l(m),l(be),P(()=>{ka(Ne,e(ue)&&e(oe)!==void 0?e(oe):e(O)),Ge(Ne,"max",e(O)),L(xe,`/ ${e(O)??""}`),L(U,(e(B),r(()=>e(B).resetOn==="short"?"Short Rest":"Long Rest")))}),M("input",Ne,pe=>{ne.update(se=>(se.classFeatures.features[e(C)]=parseInt(pe.currentTarget.value)||0,se))}),M("click",m,()=>N(e(C),e(O))),c(ie,be)},H=ie=>{var O=ct(),be=Oe(O);{var Ne=Je=>{var xe=si(),m=i(xe),U=s(m,2),pe=i(U),se=i(pe);l(pe),l(U);var he=s(U,2);{var j=T=>{var K=ai();c(T,K)};_(he,T=>{e(de)<=0&&T(j)})}l(xe),P(()=>{m.disabled=e(de)<=0,L(se,`Resets on ${e(B),r(()=>e(B).resetOn==="short"?"Short Rest":"Long Rest")??""}`)}),M("click",m,le),c(Je,xe)};_(be,Je=>{e(B),r(()=>e(B).type==="channelDivinity")&&Je(Ne)},!0)}c(ie,O)};_(je,ie=>{e(B),r(()=>e(B).type==="pool")?ie(Ee):ie(H,!1)},!0)}c(De,_e)};_(Ie,De=>{e(B),r(()=>e(B).type==="uses")?De(Ze):De(lt,!1)})}l(z),P(De=>{L(ve,` ${e(B),r(()=>e(B).name)??""}`),L(Me,De)},[()=>(e(B),r(()=>We(e(B))))]),c(Ke,z)}),l(me),c(G,me)};_(R,G=>{e(S),r(()=>e(S).length===0)?G(Q):G(ae,!1)},!0)}c($e,g)};_(te,$e=>{t(),r(()=>!t().class)?$e(Ae):$e(Te,!1)})}c(h,F)};_(k,h=>{b(),r(()=>!b().classFeatures)&&h(Y)})}l(Ue),P(()=>W=mt(Ue,1,"class-features svelte-1kpvv0n",null,W,{hidden:!e(Z)})),c(a,Ue),Ht(),x()}var oi=f('<textarea placeholder="Enter features, traits, and special abilities..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Equipment</h3> <textarea placeholder="List your equipment and inventory..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Notes</h3> <textarea placeholder="Additional notes..." class="svelte-wttn0l"></textarea>',1),ci=f("<section><!> <!></section>");function vi(a,n){Et(n,!1);const t=()=>tt(ea,"$searchFilter",b),v=()=>tt(ne,"$character",b),u=()=>tt(Pt,"$collapsedStates",b),[b,y]=Wt(),x=A();function $(){Pt.update(Z=>({...Z,notes:!Z.notes}))}Xe(()=>(t(),v()),()=>{o(x,!t()||"features".includes(t().toLowerCase())||"traits".includes(t().toLowerCase())||"equipment".includes(t().toLowerCase())||"notes".includes(t().toLowerCase())||v().features.toLowerCase().includes(t().toLowerCase())||v().equipment.toLowerCase().includes(t().toLowerCase())||v().notes.toLowerCase().includes(t().toLowerCase()))}),Jt(),It();var S=ci();let X;var q=i(S);{let Z=vt(()=>(u(),r(()=>u().notes?"Expand":"Collapse")));ia(q,{title:"Features & Traits",get collapsed(){return u(),r(()=>u().notes)},get ariaLabel(){return e(Z)},onToggle:$})}var de=s(q,2);{var J=Z=>{var ke=oi(),fe=Oe(ke);da(fe);var N=s(fe,4);da(N);var Fe=s(N,4);da(Fe),qe(fe,()=>v().features,Ye=>ht(ne,r(v).features=Ye,r(v))),qe(N,()=>v().equipment,Ye=>ht(ne,r(v).equipment=Ye,r(v))),qe(Fe,()=>v().notes,Ye=>ht(ne,r(v).notes=Ye,r(v))),c(Z,ke)};_(de,Z=>{u(),r(()=>!u().notes)&&Z(J)})}l(S),P(()=>X=mt(S,1,"notes svelte-wttn0l",null,X,{hidden:!e(x)})),c(a,S),Ht(),y()}var di=f('<div class="color-picker-section svelte-1r90jgp"><h3 class="svelte-1r90jgp">Dice Colors</h3> <div class="color-inputs svelte-1r90jgp"><div class="color-input-group svelte-1r90jgp"><label for="dice-color" class="svelte-1r90jgp">Dice Color</label> <input type="color" id="dice-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="label-color" class="svelte-1r90jgp">Label Color</label> <input type="color" id="label-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="desk-color" class="svelte-1r90jgp">Background Color</label> <input type="color" id="desk-color" class="svelte-1r90jgp"/></div></div></div>'),ui=f('<div class="loading svelte-1r90jgp"><p class="svelte-1r90jgp">Loading 3D dice...</p></div>'),pi=f('<div class="custom-dice-selector svelte-1r90jgp"><h3 class="svelte-1r90jgp">Choose Dice to Roll</h3> <div class="dice-inputs svelte-1r90jgp"><div class="dice-input-group svelte-1r90jgp"><label for="d4" class="svelte-1r90jgp">d4</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d4" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d6" class="svelte-1r90jgp">d6</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d6" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d8" class="svelte-1r90jgp">d8</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d8" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d10" class="svelte-1r90jgp">d10</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d10" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d12" class="svelte-1r90jgp">d12</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d12" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d20" class="svelte-1r90jgp">d20</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d20" min="0" max="10"/></div></div> <div class="dice-controls svelte-1r90jgp"><button class="btn btn-primary use-enabled svelte-1r90jgp"> </button> <button class="btn btn-secondary use-enabled svelte-1r90jgp">Reset</button></div></div>'),fi=f('<span class="crit-badge svelte-1r90jgp">CRITICAL HIT!</span>'),gi=f('<span class="crit-badge crit-fail svelte-1r90jgp">CRITICAL MISS!</span>'),bi=f('<div class="bonus-item svelte-1r90jgp"><span class="bonus-value svelte-1r90jgp"> </span> <span class="bonus-source svelte-1r90jgp"> </span></div>'),hi=f('<div class="bonus-breakdown svelte-1r90jgp"></div>'),mi=f('<p class="modifier-text svelte-1r90jgp"> </p>'),_i=f('<div class="svelte-1r90jgp"><em class="svelte-1r90jgp">No damage is dealt on a critical miss.</em></div>'),yi=f('<button class="btn btn-follow-up svelte-1r90jgp"> </button>'),ki=f('<button class="btn btn-guided-strike svelte-1r90jgp">âš¡ Use Guided Strike (+10)</button>'),Si=f('<div class="follow-up-actions svelte-1r90jgp"><!> <!></div>'),xi=f('<div class="result-header svelte-1r90jgp"><h3 class="svelte-1r90jgp"> </h3> <!> <!></div> <div class="result-total svelte-1r90jgp"> </div> <div class="result-details svelte-1r90jgp"><!></div> <!> <!>',1),$i=f('<div role="button" tabindex="-1"><div class="modal-content svelte-1r90jgp" role="dialog" tabindex="0"><div class="modal-header svelte-1r90jgp"><h2 class="svelte-1r90jgp">Dice Roller</h2> <div class="header-buttons svelte-1r90jgp"><button class="color-btn svelte-1r90jgp" title="Customize dice colors">ðŸŽ¨</button> <button class="close-btn svelte-1r90jgp">Ã—</button></div></div> <!> <!> <div class="dice-main-area svelte-1r90jgp"><div class="dice-container svelte-1r90jgp"></div> <!></div> <div><!></div></div></div>');function Ci(a,n){Et(n,!1);const t=()=>tt(ne,"$character",v),[v,u]=Wt(),b=A(),y=A(),x=A(),$=la();let S=kt(n,"notation",12,""),X=kt(n,"visible",8,!1),q=kt(n,"damageNotation",12,""),de=kt(n,"attackName",12,""),J=kt(n,"applyHalfDamage",8,!1),Z=kt(n,"bonusBreakdown",28,()=>[]),ke=kt(n,"rollType",12,"other"),fe=null,N=A(void 0),Fe=A(!1),Ye=A(""),ge=A(null);function He(){return e(ge)?.resultTotal??null}function We(m,U,pe){const se=[];if(!m||!m.result)return se;const he=U.match(/([+-]?\d*d\d+|[+-]?\d+)/g)||[];let j=0;const T=new Set;for(const K of he){const Be=K.trim();if(!Be)continue;const Pe=Be.match(/([+-]?)(\d*)d(\d+)/);if(Pe){const rt=parseInt(Pe[2]||"1"),V=`${rt}d${Pe[3]}`,pt=pe.findIndex((p,E)=>!T.has(E)&&typeof p.value=="string"&&p.value===V),xt=[];for(let p=0;p<rt&&j<m.result.length;p++)xt.push(m.result[j++]);const _t=pt>=0?pe[pt].source:"base die";pt>=0&&T.add(pt);for(const p of xt)se.push({display:`${p}`,source:_t})}}for(let K=0;K<pe.length;K++)if(!T.has(K)&&typeof pe[K].value=="number"){const Be=pe[K].value;se.push({display:Be>=0?`+${Be}`:`${Be}`,source:pe[K].source})}return se}let le=A(0),ye=A(0),Ue=A(0),W=A(0),ee=A(0),k=A(0),Y=A(0),h=A([]),F=A(!1),te=A(!1),Ae=A(!1),Te=A("#051e0a"),$e=A("#ffffff"),g=A("#3a2004"),R=A(!1);function Q(m){return m.length===9&&m.startsWith("#")?m.substring(0,7):m}function ae(m,U="ff"){return m.length===7&&m.startsWith("#")?m+U:m}function G(){if(window.DICE&&e(N))try{fe&&e(N)&&sa(N,e(N).innerHTML="");const m=e(N).clientWidth||500,U=e(N).clientHeight||300;fe=new window.DICE.dice_box(e(N),{w:m,h:U}),o(Fe,!0)}catch(m){console.error("Error initializing dice box:",m)}}pa(()=>{const m=se=>new Promise((he,j)=>{if(document.querySelector(`script[src="${se}"]`)){he(null);return}const K=document.createElement("script");K.src=se,K.onload=()=>{he(null)},K.onerror=()=>{console.error(`Failed to load: ${se}`),j(new Error(`Failed to load ${se}`))},document.head.appendChild(K)});setTimeout(()=>{m(`${va}/libs/three.min.js`).then(()=>m(`${va}/libs/cannon.min.js`)).then(()=>m(`${va}/libs/teal.js`)).then(()=>m(`${va}/dice.js`)).then(()=>{if(window.DICE){const se=window.DICE.getColors();o(Te,Q(se.dice_color)),o($e,Q(se.label_color)),o(g,Q(se.desk_color))}G()}).catch(se=>{console.error("Failed to load dice libraries:",se)})},100);const U=()=>{e(Fe)&&G()},pe=se=>{X()&&se.key==="Escape"&&ue()};return window.addEventListener("resize",U),window.addEventListener("keydown",pe),()=>{window.removeEventListener("resize",U),window.removeEventListener("keydown",pe)}});function me(m,U="other"){if(!fe||!e(Fe))return;o(ge,null),o(h,[]),o(F,!1),o(te,!1),U==="damage"&&Z([]),ke(U),o(Ae,!1),fe.diceToRoll=m;const pe=he=>null,se=he=>{let j=he.resultTotal,T=he.resultString;if(J()&&(j=Math.floor(j/2),T=T+" (halved)"),o(ge,{...he,resultTotal:j,resultString:T}),console.log("Final roll result:",e(ge)),console.log({type:U}),U==="attack"&&he.result&&he.result.length>0){const K=he.result[0];o(F,K===20),o(te,K===1)}if(o(h,[]),console.log("Setting up follow-up actions. Type:",U,"damageNotation:",q(),"isCriticalSuccess:",e(F),"isCriticalFail:",e(te)),U==="attack"&&q())if(e(F)){const K=Se(q());e(h).push({label:`Roll Critical Damage (${K})`,notation:K})}else e(te)||e(h).push({label:`Roll Damage (${q()})`,notation:q()})};fe.start_throw(pe,se)}function Le(){const m=[];e(le)>0&&m.push(`${e(le)}d4`),e(ye)>0&&m.push(`${e(ye)}d6`),e(Ue)>0&&m.push(`${e(Ue)}d8`),e(W)>0&&m.push(`${e(W)}d10`),e(ee)>0&&m.push(`${e(ee)}d12`),e(k)>0&&m.push(`${e(k)}d20`);let U=m.join("+")||"1d20";return e(Y)!==0&&(U+=e(Y)>=0?`+${e(Y)}`:`${e(Y)}`),U}function at(){const m=Le();me(m)}function Se(m){return m.replace(/(\d+)d(\d+)/g,(U,pe,se)=>`${parseInt(pe)*2}d${se}`)}function Ke(){o(le,0),o(ye,0),o(Ue,0),o(W,0),o(ee,0),o(k,0),o(Y,0),o(ge,null),o(h,[]),o(F,!1),o(te,!1),ke("other"),o(Ae,!1)}function B(){window.DICE&&(window.DICE.setColors({dice_color:ae(e(Te),"ff"),label_color:ae(e($e),"ff"),desk_color:e(g)}),fe&&(fe.updateDeskColor(e(g)),fe.updateDiceColors()))}function C(){o(R,!e(R))}function oe(){!e(ge)||e(y)<=0||e(Ae)||(o(ge,{...e(ge),resultTotal:e(ge).resultTotal+10,resultString:e(ge).resultString+" + 10 (Guided Strike)"}),ne.update(m=>{const U="ChannelDivinity",pe=m.classFeatures.features[U];return typeof pe=="number"&&pe>0&&(m.classFeatures.features[U]=pe-1),m}),o(Ae,!0))}function ue(){$("close"),S(""),q(""),de(""),o(Ye,""),o(ge,null),o(Ae,!1),o(F,!1),o(te,!1),Ke()}Xe(()=>(t(),oa),()=>{o(b,t().class?oa(t().class,t().level,t().subclass).some(U=>U.name==="Guided Strike"):!1)}),Xe(()=>t(),()=>{o(y,(()=>{const U=t().classFeatures.features["ChannelDivinity"];return typeof U=="number"?U:0})())}),Xe(()=>(e(le),e(ye),e(Ue),e(W),e(ee),e(k),e(Y)),()=>{o(x,(()=>{const m=[];e(le)>0&&m.push(`${e(le)}d4`),e(ye)>0&&m.push(`${e(ye)}d6`),e(Ue)>0&&m.push(`${e(Ue)}d8`),e(W)>0&&m.push(`${e(W)}d10`),e(ee)>0&&m.push(`${e(ee)}d12`),e(k)>0&&m.push(`${e(k)}d20`);let U=m.join("+")||"1d20";return e(Y)!==0&&(U+=e(Y)>=0?`+${e(Y)}`:`${e(Y)}`),U})())}),Xe(()=>(I(S()),e(Fe),I(X()),e(Ye),I(q()),I(de()),I(ke())),()=>{S()&&e(Fe)&&X()&&S()!==e(Ye)&&(o(Ye,S()),o(ge,null),o(h,[]),o(F,!1),o(te,!1),o(Ae,!1),console.log("Auto-roll triggered. notation:",S(),"damageNotation:",q(),"attackName:",de(),"rollType:",ke()),setTimeout(()=>me(S(),ke()),200))}),Jt();var z={getLastRollTotal:He};It();var d=$i();let ze;var ce=i(d),ve=i(ce),D=s(i(ve),2),Me=i(D),Ie=s(Me,2);l(D),l(ve);var Ze=s(ve,2);{var lt=m=>{var U=di(),pe=s(i(U),2),se=i(pe),he=s(i(se),2);we(he),l(se);var j=s(se,2),T=s(i(j),2);we(T),l(j);var K=s(j,2),Be=s(i(K),2);we(Be),l(K),l(pe),l(U),qe(he,()=>e(Te),Pe=>o(Te,Pe)),M("change",he,B),qe(T,()=>e($e),Pe=>o($e,Pe)),M("change",T,B),qe(Be,()=>e(g),Pe=>o(g,Pe)),M("change",Be,B),c(m,U)};_(Ze,m=>{e(R)&&m(lt)})}var De=s(Ze,2);{var _e=m=>{var U=ui();c(m,U)};_(De,m=>{e(Fe)||m(_e)})}var je=s(De,2),Ee=i(je);ja(Ee,m=>o(N,m),()=>e(N));var H=s(Ee,2);{var ie=m=>{var U=pi(),pe=s(i(U),2),se=i(pe),he=s(i(se),2);we(he),l(se);var j=s(se,2),T=s(i(j),2);we(T),l(j);var K=s(j,2),Be=s(i(K),2);we(Be),l(K);var Pe=s(K,2),rt=s(i(Pe),2);we(rt),l(Pe);var V=s(Pe,2),pt=s(i(V),2);we(pt),l(V);var xt=s(V,2),_t=s(i(xt),2);we(_t),l(xt),l(pe);var p=s(pe,2),E=i(p),w=i(E);l(E);var Ce=s(E,2);l(p),l(U),P(()=>{E.disabled=!e(Fe),L(w,`Roll ${e(x)??""}`)}),qe(he,()=>e(le),re=>o(le,re)),qe(T,()=>e(ye),re=>o(ye,re)),qe(Be,()=>e(Ue),re=>o(Ue,re)),qe(rt,()=>e(W),re=>o(W,re)),qe(pt,()=>e(ee),re=>o(ee,re)),qe(_t,()=>e(k),re=>o(k,re)),M("click",E,at),M("click",Ce,Ke),c(m,U)};_(H,m=>{S()||m(ie)})}l(je);var O=s(je,2);let be;var Ne=i(O);{var Je=m=>{var U=xi(),pe=Oe(U),se=i(pe),he=i(se,!0);l(se);var j=s(se,2);{var T=Ce=>{var re=fi();c(Ce,re)};_(j,Ce=>{e(F)&&Ce(T)})}var K=s(j,2);{var Be=Ce=>{var re=gi();c(Ce,re)};_(K,Ce=>{e(te)&&Ce(Be)})}l(pe);var Pe=s(pe,2),rt=i(Pe,!0);l(Pe);var V=s(Pe,2),pt=i(V);{var xt=Ce=>{var re=ct(),et=Oe(re);{var Re=Ve=>{var nt=hi();yt(nt,5,()=>(e(ge),I(S()),I(Z()),r(()=>We(e(ge),S(),Z()))),St,(it,ot)=>{var gt=bi(),bt=i(gt),Qe=i(bt,!0);l(bt);var st=s(bt,2),dt=i(st);l(st),l(gt),P(()=>{L(Qe,(e(ot),r(()=>e(ot).display))),L(dt,`(${e(ot),r(()=>e(ot).source)??""})`)}),c(it,gt)}),l(nt),c(Ve,nt)},ft=Ve=>{var nt=ct(),it=Oe(nt);{var ot=gt=>{var bt=mi(),Qe=i(bt);l(bt),P(()=>L(Qe,`Modifier: ${e(ge),r(()=>e(ge).constant>=0?"+":"")??""}${e(ge),r(()=>e(ge).constant)??""}`)),c(gt,bt)};_(it,gt=>{e(ge),r(()=>e(ge).constant)&&gt(ot)},!0)}c(Ve,nt)};_(et,Ve=>{I(Z()),r(()=>Z().length>0)?Ve(Re):Ve(ft,!1)})}c(Ce,re)};_(pt,Ce=>{e(ge),I(Z()),r(()=>e(ge).constant||Z().length>0)&&Ce(xt)})}l(V);var _t=s(V,2);{var p=Ce=>{var re=_i();c(Ce,re)};_(_t,Ce=>{e(te)&&Ce(p)})}var E=s(_t,2);{var w=Ce=>{var re=Si(),et=i(re);yt(et,1,()=>e(h),St,(Ve,nt)=>{var it=yi(),ot=i(it,!0);l(it),P(()=>L(ot,(e(nt),r(()=>e(nt).label)))),M("click",it,()=>me(e(nt).notation,"damage")),c(Ve,it)});var Re=s(et,2);{var ft=Ve=>{var nt=ki();P(()=>{nt.disabled=e(y)<=0,Ge(nt,"title",e(y)<=0?"No Channel Divinity uses remaining":"Use Channel Divinity to add +10 to this attack roll")}),M("click",nt,oe),c(Ve,nt)};_(Re,Ve=>{e(b)&&ke()==="attack"&&!e(Ae)&&e(y)>0&&!e(te)&&Ve(ft)})}l(re),c(Ce,re)};_(E,Ce=>{e(h),e(b),I(ke()),e(Ae),e(y),r(()=>e(h).length>0||e(b)&&ke()==="attack"&&!e(Ae)&&e(y)>0)&&Ce(w)})}P(()=>{L(he,de()?`${de()} - Result`:"Result"),L(rt,(e(ge),r(()=>e(ge).resultTotal)))}),c(m,U)};_(Ne,m=>{e(ge)&&m(Je)})}l(O),l(ce),l(d),P(()=>{ze=mt(d,1,"modal-overlay svelte-1r90jgp",null,ze,{hidden:!X()}),be=mt(O,1,"roll-result svelte-1r90jgp",null,be,{"has-result":e(ge)})}),M("click",Me,C),M("click",Ie,ue),M("click",ce,Ea(function(m){na.call(this,n,m)})),M("keydown",ce,function(m){na.call(this,n,m)}),M("click",d,ue),M("keydown",d,m=>m.key==="Escape"&&ue()),c(a,d),ws(n,"getLastRollTotal",He);var xe=Ht(z);return u(),xe}const xa="https://api.github.com/gists";async function wi(a,n,t){if(!n)throw new Error("GitHub token is required");const v=JSON.stringify(a,null,2),u=`${a.name||"character"}_dnd.json`,b={description:t||`D&D Character: ${a.name}`,public:!1,files:{[u]:{content:v}}},y=await fetch(xa,{method:"POST",headers:{Authorization:`token ${n}`,"Content-Type":"application/json"},body:JSON.stringify(b)});if(!y.ok)throw new Error(`Failed to create gist: ${y.statusText}`);return(await y.json()).id}async function Li(a,n,t){if(!n||!t)throw new Error("GitHub token and Gist ID are required");const v=JSON.stringify(a,null,2),b={files:{[`${a.name||"character"}_dnd.json`]:{content:v}}},y=await fetch(`${xa}/${t}`,{method:"PATCH",headers:{Authorization:`token ${n}`,"Content-Type":"application/json"},body:JSON.stringify(b)});if(!y.ok)throw new Error(`Failed to update gist: ${y.statusText}`)}async function Di(a,n){if(!a)throw new Error("Gist ID is required");const t={"Content-Type":"application/json"};n&&(t.Authorization=`token ${n}`);const v=await fetch(`${xa}/${a}`,{method:"GET",headers:t});if(!v.ok)throw new Error(`Failed to load gist: ${v.statusText}`);const u=await v.json(),b=Object.values(u.files);if(b.length===0)throw new Error("No files found in gist");const x=b[0].content;try{const $=JSON.parse(x);return $.attacks&&Array.isArray($.attacks)&&($.attacks=$.attacks.map(S=>({...S,id:S.id||crypto.randomUUID()}))),$.classFeatures?($.classFeatures.features||($.classFeatures.features={}),$.classFeatures.spellSlots||($.classFeatures.spellSlots=[]),$.classFeatures.preparedSpells===void 0&&($.classFeatures.preparedSpells="")):$.classFeatures={features:{},spellSlots:[],preparedSpells:""},$}catch{throw new Error("Invalid character data in gist")}}function Ja(a){typeof window<"u"&&localStorage.setItem("dnd_gist_config",JSON.stringify(a))}function ji(){if(typeof window<"u"){const a=localStorage.getItem("dnd_gist_config");if(a)return JSON.parse(a)}return{}}async function Bi(a,n=30){if(!a)throw new Error("GitHub token is required to list gists");const t=await fetch(`${xa}?per_page=${n}`,{method:"GET",headers:{Authorization:`token ${a}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error(`Failed to list gists: ${t.statusText}`);return await t.json()}var Ai=f('<div class="error-message svelte-1jb5ckg"> </div>'),Fi=f('<div class="toggle-container svelte-1jb5ckg"><button type="button" class="toggle-btn svelte-1jb5ckg"> </button></div>'),Mi=f('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID (leave empty to create new)</label> <input type="text" id="gistId" placeholder="Optional: existing Gist ID to update" class="svelte-1jb5ckg"/></div>'),Pi=f('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),Ri=f('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),Ti=f('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Update (or leave unselected to create new)</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),Ii=f('<div class="info-message svelte-1jb5ckg">No gists found. A new one will be created.</div>'),Ei=f('<!> <div class="form-group svelte-1jb5ckg"><label for="description" class="svelte-1jb5ckg"> </label> <input type="text" id="description" placeholder="D&amp;D Character Sheet" class="svelte-1jb5ckg"/></div>',1),Hi=f('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID *</label> <input type="text" id="gistId" placeholder="Enter Gist ID (for public or your private gists)" required class="svelte-1jb5ckg"/></div>'),Ui=f('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),Ni=f('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),Gi=f('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Load</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),Oi=f('<div class="info-message svelte-1jb5ckg">No gists found. Enter a Gist ID manually or create a new one in Save mode.</div>'),qi=f('<div class="modal-overlay svelte-1jb5ckg" role="button" tabindex="-1"><div class="modal-content svelte-1jb5ckg" role="dialog" tabindex="0"><div class="modal-header svelte-1jb5ckg"><h2 class="svelte-1jb5ckg"> </h2> <button class="close-btn svelte-1jb5ckg">Ã—</button></div> <div class="modal-body svelte-1jb5ckg"><!> <div class="form-group svelte-1jb5ckg"><label for="token" class="svelte-1jb5ckg"> <a href="https://github.com/settings/tokens" target="_blank" rel="noopener" class="svelte-1jb5ckg">Get token</a></label> <input type="password" id="token" placeholder="ghp_xxxxxxxxxxxxx" class="svelte-1jb5ckg"/></div> <!> <!> <div class="modal-actions svelte-1jb5ckg"><button class="btn btn-primary svelte-1jb5ckg"><!></button> <button class="btn btn-secondary svelte-1jb5ckg">Cancel</button></div></div></div></div>');function Wi(a,n){Et(n,!1);const t=()=>tt(ne,"$character",v),[v,u]=Wt(),b=la();let y=kt(n,"mode",8,"save"),x=A(""),$=A(""),S=A(""),X=A(!1),q=A(""),de=A(!1),J=A(!1),Z=A([]),ke=A(null);const fe=ji();fe.token&&o(x,fe.token),fe.gistId&&o($,fe.gistId),pa(async()=>{e(x)&&!e(de)&&await N()});async function N(){if(e(x)){o(J,!0),o(q,"");try{o(Z,await Bi(e(x))),e($)&&o(ke,e(Z).find(C=>C.id===e($))||null)}catch(C){o(q,C.message||"Failed to load gists"),o(Z,[])}finally{o(J,!1)}}}function Fe(C){o(ke,C),o($,C.id)}function Ye(){o(de,!e(de)),o(q,""),!e(de)&&e(x)&&N()}async function ge(){if(!e(x)){o(q,"GitHub token is required");return}const C=e(ke)?.id||e($);o(X,!0),o(q,"");try{if(C)await Li(t(),e(x),C),o($,C),qt.add("Character updated in Gist successfully!","success");else{const oe=await wi(t(),e(x),e(S));o($,oe),qt.add(`Character saved to Gist! ID: ${oe}`,"success")}Ja({token:e(x),gistId:e($)}),b("close")}catch(oe){o(q,oe.message||"Failed to save to Gist")}finally{o(X,!1)}}async function He(){const C=e(ke)?.id||e($);if(!C){o(q,"Please select a gist or enter a Gist ID");return}o(X,!0),o(q,"");try{const oe=await Di(C,e(x)||void 0);ne.set(oe),o($,C),Ja({token:e(x),gistId:e($)}),qt.add("Character loaded from Gist successfully!","success"),b("close")}catch(oe){o(q,oe.message||"Failed to load from Gist")}finally{o(X,!1)}}function We(){b("close")}It();var le=qi(),ye=i(le),Ue=i(ye),W=i(Ue),ee=i(W,!0);l(W);var k=s(W,2);l(Ue);var Y=s(Ue,2),h=i(Y);{var F=C=>{var oe=Ai(),ue=i(oe,!0);l(oe),P(()=>L(ue,e(q))),c(C,oe)};_(h,C=>{e(q)&&C(F)})}var te=s(h,2),Ae=i(te),Te=i(Ae);ra(),l(Ae);var $e=s(Ae,2);we($e),l(te);var g=s(te,2);{var R=C=>{var oe=Fi(),ue=i(oe),z=i(ue,!0);l(ue),l(oe),P(()=>{ue.disabled=e(X),L(z,e(de)?"ðŸ“‹ Show My Gists":"âœï¸ Enter Gist ID Manually")}),M("click",ue,Ye),c(C,oe)};_(g,C=>{(y()==="load"||y()==="save"&&e(x))&&C(R)})}var Q=s(g,2);{var ae=C=>{var oe=Ei(),ue=Oe(oe);{var z=Me=>{var Ie=Mi(),Ze=s(i(Ie),2);we(Ze),l(Ie),P(()=>Ze.disabled=e(X)),qe(Ze,()=>e($),lt=>o($,lt)),c(Me,Ie)},d=Me=>{var Ie=ct(),Ze=Oe(Ie);{var lt=_e=>{var je=Pi();c(_e,je)},De=_e=>{var je=ct(),Ee=Oe(je);{var H=O=>{var be=Ti(),Ne=s(i(be),2);yt(Ne,5,()=>e(Z),St,(Je,xe)=>{var m=Ri();let U;var pe=i(m),se=i(pe),he=i(se,!0);l(se);var j=s(se,2),T=i(j,!0);l(j),l(pe);var K=s(pe,2),Be=i(K),Pe=i(Be);l(Be);var rt=s(Be,2),V=i(rt);l(rt),l(K),l(m),P(pt=>{U=mt(m,1,"gist-item svelte-1jb5ckg",null,U,{selected:e(ke)?.id===e(xe).id}),m.disabled=e(X),L(he,(e(xe),r(()=>e(xe).description||"Untitled"))),L(T,(e(xe),r(()=>e(xe).public?"ðŸŒ Public":"ðŸ”’ Private"))),L(Pe,`ID: ${e(xe),r(()=>e(xe).id)??""}`),L(V,`Updated: ${pt??""}`)},[()=>(e(xe),r(()=>new Date(e(xe).updated_at).toLocaleDateString()))]),M("click",m,()=>Fe(e(xe))),c(Je,m)}),l(Ne),l(be),c(O,be)},ie=O=>{var be=ct(),Ne=Oe(be);{var Je=xe=>{var m=Ii();c(xe,m)};_(Ne,xe=>{e(x)&&xe(Je)},!0)}c(O,be)};_(Ee,O=>{e(Z),r(()=>e(Z).length>0)?O(H):O(ie,!1)},!0)}c(_e,je)};_(Ze,_e=>{e(J)?_e(lt):_e(De,!1)},!0)}c(Me,Ie)};_(ue,Me=>{e(de)||!e(x)?Me(z):Me(d,!1)})}var ze=s(ue,2),ce=i(ze),ve=i(ce);l(ce);var D=s(ce,2);we(D),l(ze),P(()=>{L(ve,`Description ${e($)?"(optional)":""}`),D.disabled=e(X)}),qe(D,()=>e(S),Me=>o(S,Me)),c(C,oe)},G=C=>{var oe=ct(),ue=Oe(oe);{var z=ze=>{var ce=Hi(),ve=s(i(ce),2);we(ve),l(ce),P(()=>ve.disabled=e(X)),qe(ve,()=>e($),D=>o($,D)),c(ze,ce)},d=ze=>{var ce=ct(),ve=Oe(ce);{var D=Ie=>{var Ze=Ui();c(Ie,Ze)},Me=Ie=>{var Ze=ct(),lt=Oe(Ze);{var De=je=>{var Ee=Gi(),H=s(i(Ee),2);yt(H,5,()=>e(Z),St,(ie,O)=>{var be=Ni();let Ne;var Je=i(be),xe=i(Je),m=i(xe,!0);l(xe);var U=s(xe,2),pe=i(U,!0);l(U),l(Je);var se=s(Je,2),he=i(se),j=i(he);l(he);var T=s(he,2),K=i(T);l(T),l(se),l(be),P(Be=>{Ne=mt(be,1,"gist-item svelte-1jb5ckg",null,Ne,{selected:e(ke)?.id===e(O).id}),be.disabled=e(X),L(m,(e(O),r(()=>e(O).description||"Untitled"))),L(pe,(e(O),r(()=>e(O).public?"ðŸŒ Public":"ðŸ”’ Private"))),L(j,`ID: ${e(O),r(()=>e(O).id)??""}`),L(K,`Updated: ${Be??""}`)},[()=>(e(O),r(()=>new Date(e(O).updated_at).toLocaleDateString()))]),M("click",be,()=>Fe(e(O))),c(ie,be)}),l(H),l(Ee),c(je,Ee)},_e=je=>{var Ee=ct(),H=Oe(Ee);{var ie=O=>{var be=Oi();c(O,be)};_(H,O=>{e(x)&&O(ie)},!0)}c(je,Ee)};_(lt,je=>{e(Z),r(()=>e(Z).length>0)?je(De):je(_e,!1)},!0)}c(Ie,Ze)};_(ve,Ie=>{e(J)?Ie(D):Ie(Me,!1)},!0)}c(ze,ce)};_(ue,ze=>{e(de)||!e(x)?ze(z):ze(d,!1)},!0)}c(C,oe)};_(Q,C=>{y()==="save"?C(ae):C(G,!1)})}var me=s(Q,2),Le=i(me),at=i(Le);{var Se=C=>{var oe=Mt();P(()=>L(oe,y()==="save"?"Saving...":"Loading...")),c(C,oe)},Ke=C=>{var oe=Mt();P(()=>L(oe,y()==="save"?"Save":"Load")),c(C,oe)};_(at,C=>{e(X)?C(Se):C(Ke,!1)})}l(Le);var B=s(Le,2);l(me),l(Y),l(ye),l(le),P(()=>{L(ee,y()==="save"?"Save to GitHub Gist":"Load from GitHub Gist"),L(Te,`GitHub Token ${y()==="load"?"(optional for public gists)":"(required)"} `),$e.disabled=e(X),Le.disabled=e(X),B.disabled=e(X)}),M("click",k,We),qe($e,()=>e(x),C=>o(x,C)),M("blur",$e,()=>{e(x)&&!e(de)&&N()}),M("click",Le,function(...C){(y()==="save"?ge:He)?.apply(this,C)}),M("click",B,We),M("click",ye,Ea(function(C){na.call(this,n,C)})),M("keydown",ye,function(C){na.call(this,n,C)}),M("click",le,We),M("keydown",le,C=>C.key==="Escape"&&We()),c(a,le),Ht(),u()}var zi=f('<div class="loading svelte-1ngjemu">Loading D&D data...</div>'),Ki=f("<option> </option>"),Vi=f('<select class="level-filter svelte-1ngjemu"><option>All Levels</option><option>Cantrip</option><!></select>'),Ji=f('<div class="no-results svelte-1ngjemu"> </div>'),Qi=f('<div class="item-meta svelte-1ngjemu"> </div>'),Yi=f('<div class="item-meta svelte-1ngjemu"> </div>'),Xi=f('<button><div class="item-name svelte-1ngjemu"> </div> <!></button>'),Zi=f('<p class="higher-levels"><strong>At Higher Levels:</strong> </p>'),er=f('<p class="cantrip-upgrade"><strong>Cantrip Upgrade:</strong> </p>'),tr=f('<h3 class="svelte-1ngjemu"> </h3> <p class="spell-meta svelte-1ngjemu"><!> <!></p> <p class="spell-classes"><strong>Classes:</strong> </p> <div class="spell-stats svelte-1ngjemu"><div><strong>Casting Time:</strong> </div> <div><strong>Range:</strong> </div> <div><strong>Components:</strong> <!></div> <div><strong>Duration:</strong> <!> </div></div> <p class="description svelte-1ngjemu"> </p> <!> <!>',1),ar=f('<p class="prerequisite svelte-1ngjemu"><strong>Prerequisite:</strong> </p>'),sr=f('<h3 class="svelte-1ngjemu"> </h3> <!> <p class="description svelte-1ngjemu"> </p> <a target="_blank" rel="noopener" class="source-link svelte-1ngjemu">View Full Details â†’</a>',1),lr=f('<div class="item-details svelte-1ngjemu"><!></div>'),ir=f('<div class="controls svelte-1ngjemu"><div class="tabs svelte-1ngjemu"><button> </button> <button> </button></div> <div class="search-controls svelte-1ngjemu"><input type="text" placeholder="Search by name or description..." class="search-input svelte-1ngjemu"/> <!></div></div> <div class="content-container svelte-1ngjemu"><div class="items-list svelte-1ngjemu"><!></div> <!></div>',1),rr=f('<div class="modal-backdrop svelte-1ngjemu" role="presentation"><div class="modal svelte-1ngjemu" role="dialog" aria-modal="true" tabindex="-1"><div class="modal-header svelte-1ngjemu"><h2 class="svelte-1ngjemu">Browse D&D Spells & Feats</h2> <button class="close-btn svelte-1ngjemu" aria-label="Close">&times;</button></div> <div class="modal-body svelte-1ngjemu"><!></div> <div class="modal-footer svelte-1ngjemu"><button class="btn-secondary svelte-1ngjemu">Cancel</button> <button class="btn-primary svelte-1ngjemu">Add to Character Sheet</button></div></div></div>');function nr(a,n){Et(n,!1);const t=A(),v=A(),u=A();let b=kt(n,"onClose",8),y=A("spell"),x=A(!0),$=A(""),S=A(null),X=A([]),q=A([]),de=A(null);pa(async()=>{o(x,!0);try{o(X,await ls()),o(q,await tl())}catch(k){console.error("Failed to load data:",k)}finally{o(x,!1)}});function J(k){o(de,k)}function Z(k){const Y=k.match(/(\d+d\d+(?:\s*\+\s*\d+)?)/i);return Y?Y[1]:""}function ke(k){const Y=k.split(/\.( |$)/)[0].trim(),h=Array.from(k.matchAll(/\*\*(.*?)\*\*/g)).map(te=>te[1].replace(/\.$/,""));let F=Y;return h.length&&(F+=" | Effects: "+h.join(", ")),F}function fe(){if(e(de)){if(e(y)==="spell"){const k=e(de);ne.update(Y=>{const F=[];k.range&&F.push(`Range: ${k.range}`),k.castingTime&&F.push(`Cast: ${k.castingTime}`),k.duration&&F.push(`Duration: ${k.duration}`),k.actionType==="Save"&&F.push("Saving throw spell"),k.components&&k.components.length>0&&F.push(`Components: ${k.components.join(", ")}`),k.material&&F.push(`Material: ${k.material}`);const te=F.join(" | "),Ae=ke(k.description),Te={id:crypto.randomUUID(),name:`${k.name}${k.concentration?" (C)":""}${k.ritual?" (R)":""}`,bonus:k.actionType==="Attack"?5:0,damage:Z(k.description),damageType:`${k.school} (Lvl ${k.level})`,spellRef:k.name,infoNotes:te,generalNotes:Ae,castAtLevel:k.level};return Y.attacks=[...Y.attacks,Te],Y})}else if(e(y)==="feat"){const k=e(de);ne.update(Y=>{const h=`${k.name}${k.prerequisite?` (Req: ${k.prerequisite})`:""}
${k.description}
`;return Y.features=Y.features?`${Y.features}
${h}`:h,Y})}o(de,null),b()()}}Xe(()=>(e(S),e(X),e($)),()=>{o(t,e(S)!==null?al(za(e(X),e($)),e(S)):za(e(X),e($)))}),Xe(()=>(e(q),e($)),()=>{o(v,sl(e(q),e($)))}),Xe(()=>(e(y),e(t),e(v)),()=>{o(u,e(y)==="spell"?e(t):e(v))}),Jt(),It();var N=rr(),Fe=i(N),Ye=i(Fe),ge=s(i(Ye),2);l(Ye);var He=s(Ye,2),We=i(He);{var le=k=>{var Y=zi();c(k,Y)},ye=k=>{var Y=ir(),h=Oe(Y),F=i(h),te=i(F);let Ae;var Te=i(te);l(te);var $e=s(te,2);let g;var R=i($e);l($e),l(F);var Q=s(F,2),ae=i(Q);we(ae);var G=s(ae,2);{var me=ue=>{var z=Vi();P(()=>{e(S),jt(()=>{})});var d=i(z);d.value=(d.__value=null)??"";var ze=s(d);ze.value=ze.__value=0;var ce=s(ze);yt(ce,0,()=>[1,2,3,4,5,6,7,8,9],St,(ve,D)=>{var Me=Ki(),Ie=i(Me);l(Me);var Ze={};P(()=>{L(Ie,`Level ${D??""}`),Ze!==(Ze=D)&&(Me.value=(Me.__value=D)??"")}),c(ve,Me)}),l(z),Aa(z,()=>e(S),ve=>o(S,ve)),c(ue,z)};_(G,ue=>{e(y)==="spell"&&ue(me)})}l(Q),l(h);var Le=s(h,2),at=i(Le),Se=i(at);{var Ke=ue=>{var z=Ji(),d=i(z);l(z),P(()=>L(d,`No ${e(y)??""}s found`)),c(ue,z)},B=ue=>{var z=ct(),d=Oe(z);yt(d,1,()=>e(u),St,(ze,ce)=>{var ve=Xi();let D;var Me=i(ve),Ie=i(Me,!0);l(Me);var Ze=s(Me,2);{var lt=_e=>{const je=vt(()=>e(ce));var Ee=Qi(),H=i(Ee);l(Ee),P(()=>L(H,`Level ${I(e(je)),r(()=>e(je).level)??""} â€¢ ${I(e(je)),r(()=>e(je).school)??""}`)),c(_e,Ee)},De=_e=>{const je=vt(()=>e(ce));var Ee=ct(),H=Oe(Ee);{var ie=O=>{var be=Yi(),Ne=i(be,!0);l(be),P(()=>L(Ne,(I(e(je)),r(()=>e(je).prerequisite)))),c(O,be)};_(H,O=>{I(e(je)),r(()=>e(je).prerequisite)&&O(ie)})}c(_e,Ee)};_(Ze,_e=>{e(y)==="spell"?_e(lt):_e(De,!1)})}l(ve),P(()=>{D=mt(ve,1,"item-card svelte-1ngjemu",null,D,{selected:e(de)?.name===e(ce).name}),L(Ie,(e(ce),r(()=>e(ce).name)))}),M("click",ve,()=>J(e(ce))),c(ze,ve)}),c(ue,z)};_(Se,ue=>{e(u),r(()=>e(u).length===0)?ue(Ke):ue(B,!1)})}l(at);var C=s(at,2);{var oe=ue=>{var z=lr(),d=i(z);{var ze=ve=>{const D=vt(()=>e(de));var Me=tr(),Ie=Oe(Me),Ze=i(Ie,!0);l(Ie);var lt=s(Ie,2),De=i(lt);{var _e=p=>{var E=Mt();P(()=>L(E,`${I(e(D)),r(()=>e(D).school)??""} cantrip`)),c(p,E)},je=p=>{var E=Mt();P(()=>L(E,`Level ${I(e(D)),r(()=>e(D).level)??""} ${I(e(D)),r(()=>e(D).school)??""}`)),c(p,E)};_(De,p=>{I(e(D)),r(()=>e(D).level===0)?p(_e):p(je,!1)})}var Ee=s(De,2);{var H=p=>{var E=Mt("(ritual)");c(p,E)};_(Ee,p=>{I(e(D)),r(()=>e(D).ritual)&&p(H)})}l(lt);var ie=s(lt,2),O=s(i(ie));l(ie);var be=s(ie,2),Ne=i(be),Je=s(i(Ne));l(Ne);var xe=s(Ne,2),m=s(i(xe));l(xe);var U=s(xe,2),pe=s(i(U)),se=s(pe);{var he=p=>{var E=Mt();P(()=>L(E,`(${I(e(D)),r(()=>e(D).material)??""})`)),c(p,E)};_(se,p=>{I(e(D)),r(()=>e(D).material)&&p(he)})}l(U);var j=s(U,2),T=s(i(j),2);{var K=p=>{var E=Mt("Concentration,");c(p,E)};_(T,p=>{I(e(D)),r(()=>e(D).concentration)&&p(K)})}var Be=s(T,1,!0);l(j),l(be);var Pe=s(be,2),rt=i(Pe,!0);l(Pe);var V=s(Pe,2);{var pt=p=>{var E=Zi(),w=s(i(E));l(E),P(()=>L(w,` ${I(e(D)),r(()=>e(D).higherLevelSlot)??""}`)),c(p,E)};_(V,p=>{I(e(D)),r(()=>e(D).higherLevelSlot)&&p(pt)})}var xt=s(V,2);{var _t=p=>{var E=er(),w=s(i(E));l(E),P(()=>L(w,` ${I(e(D)),r(()=>e(D).cantripUpgrade)??""}`)),c(p,E)};_(xt,p=>{I(e(D)),r(()=>e(D).cantripUpgrade)&&p(_t)})}P((p,E)=>{L(Ze,(I(e(D)),r(()=>e(D).name))),L(O,` ${p??""}`),L(Je,` ${I(e(D)),r(()=>e(D).castingTime||e(D).actionType)??""}`),L(m,` ${I(e(D)),r(()=>e(D).range)??""}`),L(pe,` ${E??""}`),L(Be,(I(e(D)),r(()=>e(D).duration))),L(rt,(I(e(D)),r(()=>e(D).description)))},[()=>(I(e(D)),r(()=>e(D).classes.join(", "))),()=>(I(e(D)),r(()=>e(D).components.join(", ").toUpperCase()))]),c(ve,Me)},ce=ve=>{const D=vt(()=>e(de));var Me=sr(),Ie=Oe(Me),Ze=i(Ie,!0);l(Ie);var lt=s(Ie,2);{var De=H=>{var ie=ar(),O=s(i(ie));l(ie),P(()=>L(O,` ${I(e(D)),r(()=>e(D).prerequisite)??""}`)),c(H,ie)};_(lt,H=>{I(e(D)),r(()=>e(D).prerequisite)&&H(De)})}var _e=s(lt,2),je=i(_e,!0);l(_e);var Ee=s(_e,2);P(()=>{L(Ze,(I(e(D)),r(()=>e(D).name))),L(je,(I(e(D)),r(()=>e(D).description))),Ge(Ee,"href",(I(e(D)),r(()=>e(D).source)))}),c(ve,Me)};_(d,ve=>{e(y)==="spell"?ve(ze):ve(ce,!1)})}l(z),c(ue,z)};_(C,ue=>{e(de)&&ue(oe)})}l(Le),P(()=>{Ae=mt(te,1,"tab svelte-1ngjemu",null,Ae,{active:e(y)==="spell"}),L(Te,`ðŸ“œ Spells (${e(X),r(()=>e(X).length)??""})`),g=mt($e,1,"tab svelte-1ngjemu",null,g,{active:e(y)==="feat"}),L(R,`â­ Feats (${e(q),r(()=>e(q).length)??""})`)}),M("click",te,()=>{o(y,"spell"),o(de,null),o($,"")}),M("click",$e,()=>{o(y,"feat"),o(de,null),o($,"")}),qe(ae,()=>e($),ue=>o($,ue)),c(k,Y)};_(We,k=>{e(x)?k(le):k(ye,!1)})}l(He);var Ue=s(He,2),W=i(Ue),ee=s(W,2);l(Ue),l(Fe),l(N),P(()=>ee.disabled=!e(de)),M("click",ge,function(...k){b()?.apply(this,k)}),M("click",W,function(...k){b()?.apply(this,k)}),M("click",ee,fe),M("click",Fe,Ea(function(k){na.call(this,n,k)})),M("keydown",Fe,function(k){na.call(this,n,k)}),M("click",N,function(...k){b()?.apply(this,k)}),M("keydown",N,k=>k.key==="Escape"&&b()()),c(a,N),Ht()}var or=f('<link rel="icon" type="image/png" href="favicon4.png"/> <meta name="viewport" content="width=device-width, initial-scale=1"/>',1),cr=f('<span class="character-name svelte-1uha8ag"> </span>'),vr=f("<span> </span>"),dr=f('<div class="spell-slots-header svelte-1uha8ag"></div>'),ur=f("<span> </span><br/>",1),pr=f("<span> </span>"),fr=f('<span class="effect-tooltip"><strong> </strong><br/> <br/> <!> <!></span>'),gr=f('<button class="effect-remove-btn svelte-1uha8ag">Ã—</button>'),br=f('<span class="effect-badge svelte-1uha8ag" tabindex="0"> <!> <!></span>'),hr=f(`<div class="active-effects-header svelte-1uha8ag"></div> <style>.effect-badge {
              position: relative;
            }
            .effect-tooltip {
              position: absolute;
              top: 120%;
              left: 50%;
              transform: translateX(-50%);
              background: #fff;
              color: #222;
              border: 1px solid #a5b4fc;
              border-radius: 6px;
              padding: 8px 12px;
              font-size: 0.95em;
              box-shadow: 0 2px 8px rgba(0, 0, 0, 0.12);
              z-index: 10;
              min-width: 180px;
              max-width: 260px;
              white-space: normal;
              pointer-events: none;
              opacity: 1;
              transition: opacity 0.15s;
            }</style>`,1),mr=f('<div class="rest-menu svelte-1uha8ag"><button class="rest-option svelte-1uha8ag">â˜• Short Rest</button> <button class="rest-option svelte-1uha8ag">ðŸ›ï¸ Long Rest</button></div>'),_r=f('<div class="container svelte-1uha8ag"><header class="svelte-1uha8ag"><div class="header-top svelte-1uha8ag"><div class="header-title svelte-1uha8ag"><div class="title-row svelte-1uha8ag"><h1 class="svelte-1uha8ag">D&D Character Sheet</h1> <!></div> <!> <!></div> <div class="header-right svelte-1uha8ag"><div class="header-controls svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">ðŸŽ²</span><span class="btn-text svelte-1uha8ag">Roll Dice</span></button> <div class="rest-button-container svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">ðŸ˜´</span><span class="btn-text svelte-1uha8ag">Rest</span></button> <!></div> <div class="mode-toggle"><button><span class="btn-icon svelte-1uha8ag"> </span><span class="btn-text svelte-1uha8ag"> </span></button></div></div> <div class="header-search svelte-1uha8ag"><input type="text" placeholder="ðŸ” Search..." class="search-input use-enabled svelte-1uha8ag"/></div></div></div> <div class="header-actions svelte-1uha8ag"><button class="btn btn-mode svelte-1uha8ag">ðŸ“š Browse Spells & Feats</button> <button class="btn btn-secondary">Save to Gist</button> <button class="btn btn-secondary">Load from Gist</button> <button class="btn btn-secondary">Export JSON</button> <button class="btn btn-secondary">Import JSON</button> <input type="file" accept=".json" style="display: none;"/></div></header> <main class="svelte-1uha8ag"><!> <!> <!> <!> <!> <!> <!></main></div> <!> <!> <!> <!>',1);function Dr(a,n){Et(n,!1);const t=()=>tt(ne,"$character",b),v=()=>tt(Zt,"$isEditMode",b),u=()=>tt(ea,"$searchFilter",b),[b,y]=Wt();function x(){const p=[],E=t().classFeatures.spellSlotsByLevel||{};for(let w=1;w<=9;w++){const Ce=E[w];if(Ce&&Ce.length>0){const re=Ce.length,et=Ce.filter(Re=>Re).length;p.push({level:w,available:re-et,total:re})}}return p}let $=A(!1),S=A(!1),X=A(!1),q=A("save"),de=A(void 0),J=A(""),Z=A(""),ke=A(""),fe=A(!1),N=A([]),Fe=A("other"),Ye=A(),ge=!1,He=1,We=A(!1),le=A(null);function ye(p){o(le,p)}function Ue(){o(le,null)}function W(p){o(le,e(le)===p?null:p)}function ee(){const p=[];ne.update(w=>{const Ce=w.hitDice.current;w.hitDice.current=Math.min(w.hitDice.max,w.hitDice.current+Math.max(1,Math.floor(w.hitDice.max/2)));const re=w.hitDice.current-Ce;if(re>0&&p.push(`${re} hit ${re===1?"die":"dice"}`),w.class){const et=oa(w.class,w.level,w.subclass);w.classFeatures.features||(w.classFeatures.features={}),et.forEach(Re=>{if(Re.resetOn==="short"){const ft=Re.name.replace(/\s+/g,"");if(Re.type==="uses"){const Ve=typeof Re.maxUses=="function"?Re.maxUses(w.level):Re.maxUses;w.classFeatures.features[ft]=Array(Ve).fill(!1),p.push(Re.name)}else if(Re.type==="pool"){const Ve=typeof Re.maxPool=="function"?Re.maxPool(w.level):Re.maxPool;Ve!==void 0&&(w.classFeatures.features[ft]=Ve,p.push(Re.name))}}})}return w}),o(We,!1);const E=p.length>0?`Short rest taken! Restored: ${p.join(", ")}`:"Short rest taken!";qt.add(E,"success")}function k(){const p=[];ne.update(w=>{const Ce=w.maxHP-w.currentHP;Ce>0&&p.push(`${Ce} HP`),w.currentHP=w.maxHP,w.tempHP=0;const re=w.hitDice.max-w.hitDice.current;re>0&&p.push(`${re} hit ${re===1?"die":"dice"}`),w.hitDice.current=w.hitDice.max;let et=0;if(w.classFeatures.spellSlotsByLevel&&Object.keys(w.classFeatures.spellSlotsByLevel).forEach(Re=>{const ft=w.classFeatures.spellSlotsByLevel[parseInt(Re)];if(ft){const Ve=ft.filter(nt=>nt).length;et+=Ve,w.classFeatures.spellSlotsByLevel[parseInt(Re)]=Array(ft.length).fill(!1)}}),et>0&&p.push(`${et} spell ${et===1?"slot":"slots"}`),w.class){const Re=oa(w.class,w.level,w.subclass);w.classFeatures.features||(w.classFeatures.features={});let ft=!1;Re.forEach(Ve=>{const nt=Ve.name.replace(/\s+/g,"");if(!(Ve.type==="info"||Ve.type==="channelDivinity")){if(Ve.type==="uses"){const it=typeof Ve.maxUses=="function"?Ve.maxUses(w.level):Ve.maxUses;w.classFeatures.features[nt]=Array(it).fill(!1),ft=!0}else if(Ve.type==="pool"){const it=typeof Ve.maxPool=="function"?Ve.maxPool(w.level):Ve.maxPool;it!==void 0&&(w.classFeatures.features[nt]=it,ft=!0)}}}),ft&&p.push("all class features")}return w}),o(We,!1);const E=p.length>0?`Long rest taken! Restored: ${p.join(", ")}`:"Long rest taken! Fully rested.";qt.add(E,"success")}function Y(p){o(J,""),o(Z,""),o(ke,""),o(fe,!1),o(N,[]),o(Fe,"other"),ge=!1,typeof p=="string"?o(J,p):(o(J,p.notation),o(Z,p.damageNotation||""),o(ke,p.attackName||""),o(fe,!!p.applyHalfDamage),o(N,p.bonusBreakdown||[]),o(Fe,p.rollType||"other")),o($,!0)}function h(p){const{notation:E,count:w,bonusBreakdown:Ce}=p.detail;o(J,""),ge=!0,He=w||1,setTimeout(()=>{o(J,E),o(Z,""),o(ke,"Hit Die"),o(N,Ce||[]),o(Fe,"other")},0),o($,!0)}function F(){if(o($,!1),ge&&e(Ye)){const p=e(Ye).getLastRollTotal();if(p!==null){const E=Math.max(1,p);ne.update(w=>(w.hitDice.current=Math.max(0,w.hitDice.current-He),w.currentHP=Math.min(w.maxHP,w.currentHP+E),w))}ge=!1}}function te(){Zt.update(p=>!p)}function Ae(p){p.target.closest(".rest-button-container")||o(We,!1)}pa(()=>{const p=Zt.subscribe(E=>{E?document.body.classList.remove("use-mode"):document.body.classList.add("use-mode")});return document.addEventListener("click",Ae),()=>{p(),document.removeEventListener("click",Ae)}});function Te(){_s(t())}function $e(){e(de)?.click()}async function g(p){const w=p.target.files?.[0];if(w)try{const Ce=await ys(w);ne.set(Ce),alert("Character imported successfully!")}catch{alert("Failed to import character file")}}It();var R=_r();hs("1uha8ag",p=>{var E=or();ra(2),Xa(()=>{gs.title="D&D Character Sheet"}),c(p,E)});var Q=Oe(R),ae=i(Q),G=i(ae),me=i(G),Le=i(me),at=s(i(Le),2);{var Se=p=>{var E=cr(),w=i(E);l(E),P(()=>L(w,`${t().name??""} (${t().level??""})`)),c(p,E)};_(at,p=>{t().name&&p(Se)})}l(Le);var Ke=s(Le,2);{var B=p=>{var E=dr();yt(E,5,x,St,(w,Ce)=>{var re=vr();let et;var Re=i(re);l(re),P(()=>{et=mt(re,1,"slot-badge svelte-1uha8ag",null,et,{depleted:e(Ce).available===0}),L(Re,`Lv${e(Ce).level??""}: ${e(Ce).available??""}/${e(Ce).total??""}`)}),c(w,re)}),l(E),c(p,E)};_(Ke,p=>{x().length>0&&p(B)})}var C=s(Ke,2);{var oe=p=>{var E=hr(),w=Oe(E);yt(w,5,()=>t().activeStates,St,(Ce,re,et)=>{var Re=br(),ft=i(Re),Ve=s(ft);{var nt=gt=>{var bt=fr(),Qe=i(bt),st=i(Qe,!0);l(Qe);var dt=s(Qe,2),Ct=s(dt,3);{var Ut=wt=>{var Lt=ur(),Gt=Oe(Lt),ut=i(Gt);l(Gt),ra(),P(()=>L(ut,`Attack Bonus: ${typeof e(re).attackBonus=="number"&&e(re).attackBonus>0?"+":""}${e(re).attackBonus??""}`)),c(wt,Lt)};_(Ct,wt=>{e(re).attackBonus&&wt(Ut)})}var Nt=s(Ct,2);{var At=wt=>{var Lt=pr(),Gt=i(Lt);l(Lt),P(()=>L(Gt,`Damage Bonus: ${typeof e(re).damageBonus=="number"&&e(re).damageBonus>0?"+":""}${e(re).damageBonus??""}`)),c(wt,Lt)};_(Nt,wt=>{e(re).damageBonus&&wt(At)})}l(bt),P(()=>{L(st,e(re).name),L(dt,` ${e(re).description??""}`)}),c(gt,bt)};_(Ve,gt=>{e(le)===et&&gt(nt)})}var it=s(Ve,2);{var ot=gt=>{var bt=gr();P(()=>Ge(bt,"title",`End ${e(re).name??""}`)),M("click",bt,()=>{ne.update(Qe=>{if(Qe.activeStates){const st=Qe.activeStates[et];st?.hpBonus&&st.target!=="other"&&(Qe.maxHP-=st.hpBonus,Qe.currentHP=Math.max(1,Math.min(Qe.currentHP-st.hpBonus,Qe.maxHP))),Qe.activeStates=Qe.activeStates.filter((dt,Ct)=>Ct!==et)}return Qe})}),c(gt,bt)};_(it,gt=>{v()||gt(ot)})}l(Re),P(()=>{Ge(Re,"aria-label",e(re).name),L(ft,`âœ¨ ${e(re).name??""} `)}),M("mouseenter",Re,()=>ye(et)),M("mouseleave",Re,Ue),M("focus",Re,()=>ye(et)),M("blur",Re,Ue),M("click",Re,()=>W(et)),c(Ce,Re)}),l(w),ra(2),c(p,E)};_(C,p=>{t().activeStates&&t().activeStates.length>0&&p(oe)})}l(me);var ue=s(me,2),z=i(ue),d=i(z),ze=s(d,2),ce=i(ze),ve=s(ce,2);{var D=p=>{var E=mr(),w=i(E),Ce=s(w,2);l(E),M("click",w,ee),M("click",Ce,k),c(p,E)};_(ve,p=>{e(We)&&p(D)})}l(ze);var Me=s(ze,2),Ie=i(Me);let Ze;var lt=i(Ie),De=i(lt,!0);l(lt);var _e=s(lt),je=i(_e,!0);l(_e),l(Ie),l(Me),l(z);var Ee=s(z,2),H=i(Ee);we(H),l(Ee),l(ue),l(G);var ie=s(G,2),O=i(ie),be=s(O,2),Ne=s(be,2),Je=s(Ne,2),xe=s(Je,2),m=s(xe,2);ja(m,p=>o(de,p),()=>e(de)),l(ie),l(ae);var U=s(ae,2),pe=i(U);Ts(pe,{});var se=s(pe,2);Us(se,{$$events:{roll:p=>Y(p.detail)}});var he=s(se,2);el(he,{$$events:{roll:p=>Y(p.detail)}});var j=s(he,2);Qs(j,{$$events:{rollHitDice:h}});var T=s(j,2);ql(T,{$$events:{roll:p=>Y(p.detail)}});var K=s(T,2);ni(K,{});var Be=s(K,2);vi(Be,{}),l(U),l(Q);var Pe=s(Q,2);ja(Ci(Pe,{get notation(){return e(J)},get damageNotation(){return e(Z)},get attackName(){return e(ke)},get applyHalfDamage(){return e(fe)},get bonusBreakdown(){return e(N)},get rollType(){return e(Fe)},get visible(){return e($)},$$events:{close:F},$$legacy:!0}),p=>o(Ye,p),()=>e(Ye));var rt=s(Pe,2);{var V=p=>{Wi(p,{get mode(){return e(q)},$$events:{close:()=>o(S,!1)}})};_(rt,p=>{e(S)&&p(V)})}var pt=s(rt,2);{var xt=p=>{nr(p,{onClose:()=>o(X,!1)})};_(pt,p=>{e(X)&&p(xt)})}var _t=s(pt,2);ms(_t,{}),P(()=>{Ze=mt(Ie,1,"btn btn-mode svelte-1uha8ag",null,Ze,{"use-mode":!v()}),L(De,v()?"ðŸ“":"ðŸŽ²"),L(je,v()?"Edit Mode":"Use Mode")}),M("click",d,()=>{o(N,[]),o($,!0)}),M("click",ce,()=>o(We,!e(We))),M("click",Ie,te),qe(H,u,p=>ks(ea,p)),M("click",O,()=>o(X,!0)),M("click",be,()=>{o(q,"save"),o(S,!0)}),M("click",Ne,()=>{o(q,"load"),o(S,!0)}),M("click",Je,Te),M("click",xe,$e),M("change",m,g),c(a,R),Ht(),y()}export{Dr as component};
