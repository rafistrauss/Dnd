import{d as Ga,g as ps,f as m,e as A,a as v,s as D,c as rt,t as Ft}from"../chunks/BESELRjb.js";import{i as Rt}from"../chunks/JMgyEzd3.js";import{c as na,o as va,a as fs,b as ms}from"../chunks/CtPH092J.js";import{F as T,T as ea,Y as Ta,j as hs,aZ as bs,U as qa,ag as gs,aD as _s,aK as ys,aE as xs,a1 as Ss,av as ga,a7 as Ha,i as as,a_ as ks,a$ as ss,b0 as Da,K as Xt,e as ls,b1 as is,b2 as $s,b3 as Cs,b4 as ws,q as Ra,b5 as Ds,b6 as Ls,ab as js,d as n,r as Na,g as As,C as Pt,G as It,H as i,I as l,J as s,b7 as Qe,b8 as Jt,s as c,a4 as L,f as e,m as dt,E as Oe,b9 as Ct,ao as ia,A as E,ba as la,bb as pa,bc as Bs}from"../chunks/DyJ43TGI.js";import{c as Tt,a as ae,e as xt,i as kt,u as ns,s as ta,b as St,d as ha,f as Zt,g as Ms,t as qt,h as Fs,T as Ts,j as Rs,k as Ps}from"../chunks/BjQbzKAD.js";import{i as y,s as Wt,a as tt,b as _t,d as da,e as Is}from"../chunks/CCL4udNy.js";import{p as yt,b as ka}from"../chunks/iXw84bXb.js";import{b as ua,r as Es}from"../chunks/jms83ebS.js";function Hs(a,r,t=!1,o=!1,d=!1){var p=a,b="";T(()=>{var $=hs;if(b===(b=r()??"")){ea&&Ta();return}if($.nodes_start!==null&&(bs($.nodes_start,$.nodes_end),$.nodes_start=$.nodes_end=null),b!==""){if(ea){qa.data;for(var S=Ta(),x=S;S!==null&&(S.nodeType!==gs||S.data!=="");)x=S,S=_s(S);if(S===null)throw ys(),xs;Ga(qa,x),p=Ss(S);return}var W=b+"";t?W=`<svg>${W}</svg>`:o&&(W=`<math>${W}</math>`);var H=ps(W);if((t||o)&&(H=ga(H)),Ga(ga(H),H.lastChild),t||o)for(;ga(H);)p.before(ga(H));else p.before(H)}})}function Ns(a,r,t,o,d){ea&&Ta();var p=r.$$slots?.[t],b=!1;p===!0&&(p=r[t],b=!0),p===void 0?d!==null&&d(a):p(a,b?()=>o:o)}function $a(a,r,t=!1){if(a.multiple){if(r==null)return;if(!as(r))return ks();for(var o of a.options)o.selected=r.includes(fa(o));return}for(o of a.options){var d=fa(o);if(ss(d,r)){o.selected=!0;return}}(!t||r!==void 0)&&(a.selectedIndex=-1)}function Pa(a){var r=new MutationObserver(()=>{$a(a,a.__value)});r.observe(a,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Ha(()=>{r.disconnect()})}function Ca(a,r,t=r){var o=new WeakSet,d=!0;Da(a,"change",p=>{var b=p?"[selected]":":checked",$;if(a.multiple)$=[].map.call(a.querySelectorAll(b),fa);else{var S=a.querySelector(b)??a.querySelector("option:not([disabled])");$=S&&fa(S)}t($),Xt!==null&&o.add(Xt)}),ls(()=>{var p=r();if(a===document.activeElement){var b=is??Xt;if(o.has(b))return}if($a(a,p,d),d&&p===void 0){var $=a.querySelector(":checked");$!==null&&(p=fa($),t(p))}a.__value=p,d=!1}),Pa(a)}function fa(a){return"__value"in a?a.__value:a.value}const Us=Symbol("is custom element"),Os=Symbol("is html");function je(a){if(ea){var r=!1,t=()=>{if(!r){if(r=!0,a.hasAttribute("value")){var o=a.value;Ve(a,"value",null),a.value=o}if(a.hasAttribute("checked")){var d=a.checked;Ve(a,"checked",null),a.checked=d}}};a.__on_r=t,Ra(t),Ds()}}function ma(a,r){var t=Ua(a);t.value===(t.value=r??void 0)||a.value===r&&(r!==0||a.nodeName!=="PROGRESS")||(a.value=r??"")}function rs(a,r){var t=Ua(a);t.checked!==(t.checked=r??void 0)&&(a.checked=r)}function Ve(a,r,t,o){var d=Ua(a);ea&&(d[r]=a.getAttribute(r),r==="src"||r==="srcset"||r==="href"&&a.nodeName==="LINK")||d[r]!==(d[r]=t)&&(r==="loading"&&(a[$s]=t),t==null?a.removeAttribute(r):typeof t!="string"&&Gs(a).includes(r)?a[r]=t:a.setAttribute(r,t))}function Ua(a){return a.__attributes??={[Us]:a.nodeName.includes("-"),[Os]:a.namespaceURI===Cs}}var Wa=new Map;function Gs(a){var r=a.getAttribute("is")||a.nodeName,t=Wa.get(r);if(t)return t;Wa.set(r,t=[]);for(var o,d=a,p=Element.prototype;p!==d;){o=Ls(d);for(var b in o)o[b].set&&t.push(b);d=ws(d)}return t}function Je(a,r,t=r){var o=new WeakSet;Da(a,"input",async d=>{var p=d?a.defaultValue:a.value;if(p=Aa(a)?Ba(p):p,t(p),Xt!==null&&o.add(Xt),await js(),p!==(p=r())){var b=a.selectionStart,$=a.selectionEnd,S=a.value.length;if(a.value=p??"",$!==null){var x=a.value.length;b===$&&$===S&&x>S?(a.selectionStart=x,a.selectionEnd=x):(a.selectionStart=b,a.selectionEnd=Math.min($,x))}}}),(ea&&a.defaultValue!==a.value||n(r)==null&&a.value)&&(t(Aa(a)?Ba(a.value):a.value),Xt!==null&&o.add(Xt)),Na(()=>{var d=r();if(a===document.activeElement){var p=is??Xt;if(o.has(p))return}Aa(a)&&d===Ba(a.value)||a.type==="date"&&!d&&!a.value||d!==a.value&&(a.value=d??"")})}const ja=new Set;function za(a,r,t,o,d=o){var p=t.getAttribute("type")==="checkbox",b=a;let $=!1;if(r!==null)for(var S of r)b=b[S]??=[];b.push(t),Da(t,"change",()=>{var x=t.__value;p&&(x=Ka(b,x,t.checked)),d(x)},()=>d(p?[]:null)),Na(()=>{var x=o();if(ea&&t.defaultChecked!==t.checked){$=!0;return}p?(x=x||[],t.checked=x.includes(t.__value)):t.checked=ss(t.__value,x)}),Ha(()=>{var x=b.indexOf(t);x!==-1&&b.splice(x,1)}),ja.has(b)||(ja.add(b),Ra(()=>{b.sort((x,W)=>x.compareDocumentPosition(W)===4?-1:1),ja.delete(b)})),Ra(()=>{if($){var x;if(p)x=Ka(b,x,t.checked);else{var W=b.find(H=>H.checked);x=W?.__value}d(x)}})}function wa(a,r,t=r){Da(a,"change",o=>{var d=o?a.defaultChecked:a.checked;t(d)}),(ea&&a.defaultChecked!==a.checked||n(r)==null)&&t(a.checked),Na(()=>{var o=r();a.checked=!!o})}function Ka(a,r,t){for(var o=new Set,d=0;d<a.length;d+=1)a[d].checked&&o.add(a[d].__value);return t||o.delete(r),Array.from(o)}function Aa(a){var r=a.type;return r==="number"||r==="range"}function Ba(a){return a===""?null:+a}function qs(a,r,t){var o=As(a,r);o&&o.set&&(a[r]=t,Ha(()=>{a[r]=null}))}function Oa(a){return function(...r){var t=r[0];return t.stopPropagation(),a?.apply(this,r)}}function oa(a,r){var t=a.$$events?.[r.type],o=as(t)?t.slice():t==null?[]:[t];for(var d of o)d.call(this,r)}const Ws="";function os(...a){return ua+Ws+Es(a[0],a[1])}const Ia={paladin:{name:"Paladin",hitDice:"d10",spellcaster:!0,spellcastingAbility:"charisma",spellSlotsByLevel:{1:0,2:2,3:3,4:3,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Divine Sense",type:"uses",maxUses:(a,r=1)=>1+Math.max(1,r),resetOn:"long",description:"Detect celestials, fiends, and undead within 60 feet",minLevel:1},{name:"Lay on Hands",type:"pool",maxPool:a=>a*5,resetOn:"long",description:"Heal wounds or cure disease",minLevel:1},{name:"Divine Smite",type:"spellSlot",description:"Expend spell slot to deal extra radiant damage",minLevel:2,rollable:!0},{name:"Channel Divinity",type:"pool",maxPool:a=>a>=18?3:a>=6?2:1,resetOn:"short",description:"Sacred Weapon or Turn Undead",minLevel:3}]},fighter:{name:"Fighter",hitDice:"d10",spellcaster:!1,features:[{name:"Second Wind",type:"uses",maxUses:1,resetOn:"short",description:"Regain 1d10 + fighter level HP as bonus action",minLevel:1,rollable:!0,rollFormula:a=>`1d10+${a}`},{name:"Action Surge",type:"uses",maxUses:a=>a>=17?2:1,resetOn:"short",description:"Take one additional action on your turn",minLevel:2},{name:"Indomitable",type:"uses",maxUses:a=>a>=17?3:a>=13?2:1,resetOn:"long",description:"Reroll a failed saving throw",minLevel:9}],subclasses:{champion:{name:"Champion",features:[{name:"Improved Critical",type:"info",description:"Critical hit on 19-20",minLevel:3},{name:"Remarkable Athlete",type:"info",description:"Add half proficiency to STR/DEX/CON checks, increase long jump distance",minLevel:7},{name:"Additional Fighting Style",type:"info",description:"Choose a second fighting style",minLevel:10},{name:"Superior Critical",type:"info",description:"Critical hit on 18-20",minLevel:15},{name:"Survivor",type:"info",description:"Regain 5 + CON mod HP at start of turn if below half HP",minLevel:18}]},battlemaster:{name:"Battle Master",features:[{name:"Combat Superiority",type:"uses",maxUses:a=>a>=15?6:a>=7?5:4,resetOn:"short",description:a=>`Use superiority dice (${a>=18?"d12":a>=10?"d10":"d8"}) for maneuvers`,minLevel:3},{name:"Know Your Enemy",type:"info",description:"Learn capabilities of creatures you observe",minLevel:7},{name:"Improved Combat Superiority",type:"info",description:"Superiority dice become d10",minLevel:10},{name:"Relentless",type:"info",description:"Regain 1 superiority die if you have none at start of turn",minLevel:15}]}}},rogue:{name:"Rogue",hitDice:"d8",spellcaster:!1,features:[{name:"Sneak Attack",type:"info",description:a=>`Deal ${Math.ceil(a/2)}d6 extra damage once per turn with advantage or ally nearby`,minLevel:1,rollable:!0,rollFormula:a=>`${Math.ceil(a/2)}d6`},{name:"Cunning Action",type:"info",description:"Dash, Disengage, or Hide as a bonus action",minLevel:2},{name:"Uncanny Dodge",type:"info",description:"Use reaction to halve damage from an attack",minLevel:5},{name:"Evasion",type:"info",description:"Take no damage on successful Dex save (half on fail)",minLevel:7}]},wizard:{name:"Wizard",hitDice:"d6",spellcaster:!0,spellcastingAbility:"intelligence",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Arcane Recovery",type:"uses",maxUses:1,resetOn:"long",description:a=>`Recover spell slots totaling up to ${Math.ceil(a/2)} levels during short rest`,minLevel:1},{name:"Spell Mastery",type:"info",description:"Cast one 1st-level and one 2nd-level spell at will",minLevel:18}]},cleric:{name:"Cleric",hitDice:"d8",spellcaster:!0,spellcastingAbility:"wisdom",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Channel Divinity",type:"pool",maxPool:a=>a>=18?3:a>=6?2:1,resetOn:"short",description:"Turn Undead or domain-specific ability",minLevel:2},{name:"Destroy Undead",type:"info",description:a=>`Channel Divinity destroys undead of CR ${a>=17?4:a>=14?3:a>=11?2:a>=8?1:.5} or lower`,minLevel:5},{name:"Divine Intervention",type:"uses",maxUses:1,resetOn:"long",description:a=>`${a}% chance to succeed, implore deity for aid`,minLevel:10}],subclasses:{war:{name:"War Domain",features:[{name:"War Priest",type:"uses",maxUses:(a,r=1)=>Math.max(1,r),resetOn:"long",description:"Make one weapon attack as a bonus action",minLevel:1},{name:"Guided Strike",type:"channelDivinity",description:"Use your Channel Divinity to gain +10 to an attack roll. Make this choice after you see the roll, but before the DM says whether the attack hits or misses.",minLevel:2,resetOn:"short"},{name:"War God's Blessing",type:"channelDivinity",description:"Use reaction to grant +10 to an ally's attack roll within 30 feet. Consumes one use of Channel Divinity.",minLevel:6,resetOn:"short"},{name:"Divine Strike",type:"info",description:a=>`Deal extra ${a>=14?"2d8":"1d8"} weapon damage once per turn`,minLevel:8,rollable:!0,rollFormula:a=>a>=14?"2d8":"1d8"},{name:"Avatar of Battle",type:"info",description:"Gain resistance to nonmagical weapon damage",minLevel:17}]},life:{name:"Life Domain",features:[{name:"Disciple of Life",type:"info",description:"Healing spells restore additional 2 + spell level HP",minLevel:1},{name:"Preserve Life",type:"pool",maxPool:a=>a*5,resetOn:"short",description:"Restore HP to creatures within 30 feet",minLevel:2},{name:"Blessed Healer",type:"info",description:"Regain 2 + spell level HP when you cast healing spell",minLevel:6},{name:"Divine Strike",type:"info",description:a=>`Deal extra ${a>=14?"2d8":"1d8"} radiant damage once per turn`,minLevel:8,rollable:!0,rollFormula:a=>a>=14?"2d8":"1d8"},{name:"Supreme Healing",type:"info",description:"Maximize healing dice instead of rolling",minLevel:17}]}}},barbarian:{name:"Barbarian",hitDice:"d12",spellcaster:!1,features:[{name:"Rage",type:"uses",maxUses:a=>a>=20?1/0:a>=17?6:a>=12?5:a>=6?4:a>=3?3:2,resetOn:"long",description:a=>`+${a>=16?4:a>=9?3:2} damage, resistance to physical damage`,minLevel:1},{name:"Reckless Attack",type:"info",description:"Gain advantage on melee attacks, enemies get advantage on you",minLevel:2},{name:"Danger Sense",type:"info",description:"Advantage on Dex saves against effects you can see",minLevel:2}],subclasses:{berserker:{name:"Path of the Berserker",features:[{name:"Frenzy",type:"info",description:"While raging, make melee attack as bonus action (gain 1 exhaustion after rage)",minLevel:3},{name:"Mindless Rage",type:"info",description:"Cannot be charmed or frightened while raging",minLevel:6},{name:"Intimidating Presence",type:"info",description:"Use action to frighten creature within 30 feet",minLevel:10},{name:"Retaliation",type:"info",description:"When damaged by creature within 5 feet, make melee attack as reaction",minLevel:14}]}}}};function Ht(a){const r=a.toLowerCase();return Ia[r]||null}function ca(a,r,t){const o=Ht(a);if(!o)return[];const d=o.features.filter(p=>!p.minLevel||p.minLevel<=r);if(t&&o.subclasses&&o.subclasses[t]){const p=o.subclasses[t].features.filter(b=>!b.minLevel||b.minLevel<=r);return[...d,...p]}return d}function Va(a){const r=Ht(a);return!r||!r.subclasses?[]:Object.keys(r.subclasses).map(t=>({id:t,name:r.subclasses[t].name}))}function Ja(a,r){const t=Ht(a);return!t||!t.spellcaster||!t.spellSlotsByLevel?0:t.spellSlotsByLevel[r]||0}function Ya(a,r,t){const o=Ht(a);return!o||!o.spellcaster?0:Math.max(1,t+r)}function zs(a,r,t){const o=Ht(a);return!o||!o.spellcaster?null:8+r+t}function Ks(){return Object.keys(Ia).map(a=>({id:a,name:Ia[a].name}))}var Vs=m('<div class="section-header svelte-ls99y2" role="button" tabindex="0"><h2 class="svelte-ls99y2"> </h2> <span class="collapse-btn svelte-ls99y2"> </span></div>');function ra(a,r){Pt(r,!1);let t=yt(r,"title",8),o=yt(r,"collapsed",8),d=yt(r,"ariaLabel",8,""),p=yt(r,"onToggle",8);Rt();var b=Vs(),$=i(b),S=i($,!0);l($);var x=s($,2),W=i(x,!0);l(x),l(b),T(()=>{Ve(b,"aria-expanded",!o()),Ve(b,"aria-label",d()),D(S,t()),D(W,o()?"‚ñº":"‚ñ≤")}),A("click",b,function(...H){p()?.apply(this,H)}),A("keydown",b,H=>{(H.key==="Enter"||H.key===" ")&&p()()}),v(a,b),It()}var Js=m("<option> </option>"),Ys=m("<option> </option>"),Qs=m('<div class="form-group svelte-172i2fj"><label for="characterSubclass" class="svelte-172i2fj">Subclass</label> <select id="characterSubclass" class="svelte-172i2fj"><option>Select Subclass</option><!></select></div>'),Xs=m('<div class="info-grid svelte-172i2fj"><div class="form-group svelte-172i2fj"><label for="characterName" class="svelte-172i2fj">Character Name</label> <input type="text" id="characterName" placeholder="Enter name" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterClass" class="svelte-172i2fj">Class</label> <select id="characterClass" class="svelte-172i2fj"><option>Select Class</option><!></select></div> <!> <div class="form-group svelte-172i2fj"><label for="characterLevel" class="svelte-172i2fj">Level</label> <input type="number" id="characterLevel" min="1" max="20" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterRace" class="svelte-172i2fj">Race</label> <input type="text" id="characterRace" placeholder="e.g., Human" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterBackground" class="svelte-172i2fj">Background</label> <input type="text" id="characterBackground" placeholder="e.g., Soldier" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterAlignment" class="svelte-172i2fj">Alignment</label> <input type="text" id="characterAlignment" placeholder="e.g., Lawful Good" class="svelte-172i2fj"/></div></div>'),Zs=m('<section class="character-info svelte-172i2fj"><!> <!></section>');function el(a,r){Pt(r,!1);const t=()=>tt(ae,"$character",d),o=()=>tt(Tt,"$collapsedStates",d),[d,p]=Wt(),b=L(),$=Ks();function S(ye){const me=ye.target;ae.update(U=>(U.class=me.value,U.subclass="",U))}function x(ye){const me=ye.target;ae.update(U=>(U.subclass=me.value,U))}function W(ye){const me=ye.target;ae.update(U=>(U.level=parseInt(me.value)||1,U)),ns()}Qe(()=>(t(),Va),()=>{c(b,t().class?Va(t().class):[])}),Jt(),Rt();var H=Zs(),se=i(H);{let ye=dt(()=>(o(),n(()=>o().characterInfo?"Expand":"Collapse")));ra(se,{title:"Character Info",get collapsed(){return o(),n(()=>o().characterInfo)},get ariaLabel(){return e(ye)},onToggle:()=>Tt.update(me=>({...me,characterInfo:!me.characterInfo}))})}var Q=s(se,2);{var Z=ye=>{var me=Xs(),U=i(me),le=s(i(U),2);je(le),l(U);var $e=s(U,2),he=s(i($e),2),Pe=i(he);Pe.value=Pe.__value="";var Ie=s(Pe);xt(Ie,1,()=>$,kt,(qe,we)=>{var h=Js(),P=i(h,!0);l(h);var X={};T(()=>{D(P,(e(we),n(()=>e(we).name))),X!==(X=(e(we),n(()=>e(we).id)))&&(h.value=(h.__value=(e(we),n(()=>e(we).id)))??"")}),v(qe,h)}),l(he);var ie;Pa(he),l($e);var Se=s($e,2);{var We=qe=>{var we=Qs(),h=s(i(we),2),P=i(h);P.value=P.__value="";var X=s(P);xt(X,1,()=>e(b),kt,(z,ke)=>{var Me=Ys(),st=i(Me,!0);l(Me);var xe={};T(()=>{D(st,(e(ke),n(()=>e(ke).name))),xe!==(xe=(e(ke),n(()=>e(ke).id)))&&(Me.value=(Me.__value=(e(ke),n(()=>e(ke).id)))??"")}),v(z,Me)}),l(h);var oe;Pa(h),l(we),T(()=>{oe!==(oe=(t(),n(()=>t().subclass)))&&(h.value=(h.__value=(t(),n(()=>t().subclass)))??"",$a(h,(t(),n(()=>t().subclass))))}),A("change",h,x),v(qe,we)};y(Se,qe=>{e(b),n(()=>e(b).length>0)&&qe(We)})}var O=s(Se,2),V=s(i(O),2);je(V),l(O);var k=s(O,2),re=s(i(k),2);je(re),l(k);var _=s(k,2),B=s(i(_),2);je(B),l(_);var te=s(_,2),Ge=s(i(te),2);je(Ge),l(te),l(me),T(()=>{ie!==(ie=(t(),n(()=>t().class)))&&(he.value=(he.__value=(t(),n(()=>t().class)))??"",$a(he,(t(),n(()=>t().class)))),ma(V,(t(),n(()=>t().level)))}),Je(le,()=>t().name,qe=>_t(ae,n(t).name=qe,n(t))),A("change",he,S),A("change",V,W),Je(re,()=>t().race,qe=>_t(ae,n(t).race=qe,n(t))),Je(B,()=>t().background,qe=>_t(ae,n(t).background=qe,n(t))),Je(Ge,()=>t().alignment,qe=>_t(ae,n(t).alignment=qe,n(t))),v(ye,me)};y(Q,ye=>{o(),n(()=>!o().characterInfo)&&ye(Z)})}l(H),v(a,H),It(),p()}var tl=m('<div class="ability-card svelte-bbv1xt"><h3 class="svelte-bbv1xt"> </h3> <input type="number" class="ability-score svelte-bbv1xt" min="1" max="30"/> <div class="ability-modifier svelte-bbv1xt"> </div> <div class="roll-buttons svelte-bbv1xt"><button class="roll-btn svelte-bbv1xt">Check</button> <button class="roll-btn svelte-bbv1xt">Save</button></div> <div class="save-proficiency svelte-bbv1xt"><input type="checkbox" class="svelte-bbv1xt"/> <label class="svelte-bbv1xt">Save Prof.</label></div></div>'),al=m('<div class="proficiency-bonus svelte-bbv1xt"><label for="profBonus">Proficiency Bonus</label> <input type="number" id="profBonus" class="prof-input svelte-bbv1xt"/></div> <div class="abilities-grid svelte-bbv1xt"></div>',1),sl=m("<section><!> <!></section>");function ll(a,r){Pt(r,!1);const t=()=>tt(ha,"$abilityModifiers",$),o=()=>tt(ae,"$character",$),d=()=>tt(ta,"$searchFilter",$),p=()=>tt(Tt,"$collapsedStates",$),b=()=>tt(Zt,"$isEditMode",$),[$,S]=Wt(),x=L(),W=L(),H=na(),se=[{key:"strength",label:"Strength"},{key:"dexterity",label:"Dexterity"},{key:"constitution",label:"Constitution"},{key:"intelligence",label:"Intelligence"},{key:"wisdom",label:"Wisdom"},{key:"charisma",label:"Charisma"}];function Q(){ns()}function Z(Pe){const Ie=t()[Pe],ie=`1d20${Ie>=0?"+":""}${Ie}`,Se=[];Se.push({value:"1d20",source:"base die"}),Ie!==0&&Se.push({value:Ie,source:Pe}),H("roll",{notation:ie,rollType:"check",bonusBreakdown:Se})}function ye(Pe){const Ie=t()[Pe],ie=o().saveProficiencies[Pe]?o().proficiencyBonus:0,Se=Ie+ie,We=`1d20${Se>=0?"+":""}${Se}`,O=[];O.push({value:"1d20",source:"base die"}),Ie!==0&&O.push({value:Ie,source:Pe}),ie!==0&&O.push({value:ie,source:"proficiency"}),H("roll",{notation:We,rollType:"save",bonusBreakdown:O})}Qe(()=>d(),()=>{c(x,se.filter(({label:Pe})=>d()?Pe.toLowerCase().includes(d().toLowerCase()):!0))}),Qe(()=>(e(x),d()),()=>{c(W,e(x).length>0||!d()||d().toLowerCase().includes("proficiency"))}),Jt(),Rt();var me=sl();let U;var le=i(me);ra(le,{title:"Ability Scores",get collapsed(){return p(),n(()=>p().abilityScores)},ariaLabel:"Toggle Ability Scores Section",onToggle:()=>Tt.update(Pe=>({...Pe,abilityScores:!Pe.abilityScores}))});var $e=s(le,2);{var he=Pe=>{var Ie=al(),ie=Oe(Ie),Se=s(i(ie),2);je(Se),l(ie);var We=s(ie,2);xt(We,5,()=>e(x),kt,(O,V)=>{let k=()=>e(V).key,re=()=>e(V).label;var _=tl(),B=i(_),te=i(B,!0);l(B);var Ge=s(B,2);je(Ge);var qe=s(Ge,2),we=i(qe);l(qe);var h=s(qe,2),P=i(h),X=s(P,2);l(h);var oe=s(h,2),z=i(oe);je(z);var ke=s(z,2);l(oe),l(_),T(Me=>{D(te,Me),D(we,`${t(),k(),n(()=>t()[k()]>=0?"+":"")??""}${t(),k(),n(()=>t()[k()])??""}`),z.disabled=!b(),Ve(z,"id",`${k()}-save`),Ve(ke,"for",`${k()}-save`)},[()=>(re(),n(()=>re().substring(0,3).toUpperCase()))]),Je(Ge,()=>o().abilities[k()],Me=>_t(ae,n(o).abilities[k()]=Me,n(o))),A("change",Ge,Q),A("click",P,()=>Z(k())),A("click",X,()=>ye(k())),wa(z,()=>o().saveProficiencies[k()],Me=>_t(ae,n(o).saveProficiencies[k()]=Me,n(o))),v(O,_)}),l(We),Je(Se,()=>o().proficiencyBonus,O=>_t(ae,n(o).proficiencyBonus=O,n(o))),v(Pe,Ie)};y($e,Pe=>{p(),n(()=>!p().abilityScores)&&Pe(he)})}l(me),T(()=>U=St(me,1,"ability-scores svelte-bbv1xt",null,U,{hidden:!e(W)})),v(a,me),It(),S()}const cs=[{name:"Unarmored",type:"none",baseAC:10},{name:"Padded",type:"light",baseAC:11},{name:"Leather",type:"light",baseAC:11},{name:"Studded Leather",type:"light",baseAC:12},{name:"Hide",type:"medium",baseAC:12,maxDexBonus:2},{name:"Chain Shirt",type:"medium",baseAC:13,maxDexBonus:2},{name:"Scale Mail",type:"medium",baseAC:14,maxDexBonus:2},{name:"Breastplate",type:"medium",baseAC:14,maxDexBonus:2},{name:"Half Plate",type:"medium",baseAC:15,maxDexBonus:2},{name:"Ring Mail",type:"heavy",baseAC:14,maxDexBonus:0},{name:"Chain Mail",type:"heavy",baseAC:16,maxDexBonus:0},{name:"Splint",type:"heavy",baseAC:17,maxDexBonus:0},{name:"Plate",type:"heavy",baseAC:18,maxDexBonus:0}];function vs(a){return cs.find(r=>r.name===a)}function il(a,r,t){if(!a)return 10+r+(t?2:0);const o=vs(a);if(!o)return 10+r+(t?2:0);let d=o.baseAC;return o.maxDexBonus===void 0?d+=r:o.maxDexBonus>0&&(d+=Math.min(r,o.maxDexBonus)),t&&(d+=2),d}function ba(a){return Math.floor((a-10)/2)}function Ea(a,r){if(!a.class)return null;const t=Ht(a.class);if(!t||!t.spellcaster||!t.spellcastingAbility)return null;const o=ba(r[t.spellcastingAbility]);return 8+a.proficiencyBonus+o}function Qa(a,r){if(!a.class)return 0;const t=Ht(a.class);return!t||!t.spellcaster||!t.spellcastingAbility?0:ba(r[t.spellcastingAbility])}function nl(a,r){const t=[],o=ba(r.dexterity),d=a.armorName?vs(a.armorName):void 0;if(d){if(d.type==="none")t.push("Unarmored"),t.push("Base: 10"),t.push(`Dexterity: ${o>=0?"+":""}${o}`);else if(d.type==="light")t.push(`${d.name}: ${d.baseAC}`),t.push(`Dexterity: ${o>=0?"+":""}${o}`);else if(d.type==="medium"){const p=Math.min(2,o);t.push(`${d.name}: ${d.baseAC}`),t.push(`Dexterity: ${p>=0?"+":""}${p} (max +2)`)}else d.type==="heavy"&&(t.push(`${d.name}: ${d.baseAC}`),t.push("Dexterity: +0 (heavy armor)"));a.shieldEquipped&&t.push("Shield: +2")}else{t.push("Base: 10"),o!==0&&t.push(`Dexterity: ${o>=0?"+":""}${o}`);const p=10+o,b=a.armorClass-p;b!==0&&t.push(`Other: ${b>=0?"+":""}${b}`)}return a.activeStates&&a.activeStates.length>0&&a.activeStates.forEach(p=>{typeof p.acBonus=="number"&&p.acBonus!==0&&(!p.target||p.target==="self")&&t.push(`${p.name}: ${p.acBonus>=0?"+":""}${p.acBonus}`)}),t.join(`
`)}function rl(a,r){const t=[],o=ba(r.dexterity);t.push(`Dexterity: ${o>=0?"+":""}${o}`);const d=a.initiative-o;return d!==0&&t.push(`Other Bonuses: ${d>=0?"+":""}${d}`),t.join(`
`)}function ol(a,r){if(!a.class)return"";const t=Ht(a.class);if(!t||!t.spellcaster||!t.spellcastingAbility)return"";const o=[],d=ba(r[t.spellcastingAbility]),p=t.spellcastingAbility.charAt(0).toUpperCase()+t.spellcastingAbility.slice(1);return o.push("Base: 8"),o.push(`Proficiency: +${a.proficiencyBonus}`),o.push(`${p}: ${d>=0?"+":""}${d}`),o.join(`
`)}var cl=m('<button class="info-icon svelte-1o8ci7b" type="button">‚ÑπÔ∏è</button>'),vl=m('<button class="info-icon svelte-1o8ci7b" type="button">‚ÑπÔ∏è</button>'),dl=m('<div class="tooltip-popup svelte-1o8ci7b"><!></div>'),ul=m('<div class="tooltip-wrapper svelte-1o8ci7b"><!> <!></div>');function Ma(a,r){Pt(r,!1);let t=yt(r,"tooltipContent",8),o=yt(r,"ariaLabel",8,"Show information"),d=L(!1),p=L(),b=L(!1);function $(){c(b,window.matchMedia("(pointer: coarse)").matches||"ontouchstart"in window)}function S(){c(d,!0)}function x(){c(d,!1)}function W(le){le.stopPropagation(),c(d,!e(d))}function H(le){e(p)&&!e(p).contains(le.target)&&c(d,!1)}va(()=>{$(),document.addEventListener("click",H)}),fs(()=>{document.removeEventListener("click",H)}),Rt();var se=ul(),Q=i(se);{var Z=le=>{var $e=cl();T(()=>Ve($e,"aria-label",o())),A("click",$e,W),v(le,$e)},ye=le=>{var $e=vl();T(()=>Ve($e,"aria-label",o())),A("mouseenter",$e,S),A("mouseleave",$e,x),v(le,$e)};y(Q,le=>{e(b)?le(Z):le(ye,!1)})}var me=s(Q,2);{var U=le=>{var $e=dl(),he=i($e);Ns(he,r,"content",{},Pe=>{var Ie=rt(),ie=Oe(Ie);Hs(ie,t),v(Pe,Ie)}),l($e),v(le,$e)};y(me,le=>{e(d)&&le(U)})}l(se),ka(se,le=>c(p,le),()=>e(p)),v(a,se),It()}var pl=m("<option> </option>"),fl=m('<div class="armor-config svelte-1r5hyyb"><h4 class="svelte-1r5hyyb">Armor Configuration</h4> <div class="armor-controls svelte-1r5hyyb"><div class="armor-field svelte-1r5hyyb"><label for="armorName" class="svelte-1r5hyyb">Armor</label> <select id="armorName" class="armor-select svelte-1r5hyyb"><option>None (Unarmored)</option><!></select></div> <div class="armor-field svelte-1r5hyyb"><label class="shield-label svelte-1r5hyyb"><input type="checkbox" class="shield-checkbox svelte-1r5hyyb"/> Shield Equipped (+2 AC)</label></div></div></div>'),ml=m('<div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="spellSaveDC" class="svelte-1r5hyyb">Spell Save DC</label> <!></div> <input type="number" id="spellSaveDC" class="stat-input svelte-1r5hyyb" readonly=""/></div>'),hl=m('<span class="hit-dice-type"> </span>'),bl=m('<!> <div class="stats-grid svelte-1r5hyyb"><div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="armorClass" class="svelte-1r5hyyb">Armor Class</label> <!></div> <input type="text" id="armorClass" readonly=""/></div> <div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="initiative" class="svelte-1r5hyyb">Initiative</label> <!></div> <input type="text" id="initiative" class="stat-input svelte-1r5hyyb" readonly=""/></div> <div class="stat-box svelte-1r5hyyb"><label for="speed" class="svelte-1r5hyyb">Speed</label> <input type="text" id="speed" class="stat-input svelte-1r5hyyb"/></div> <!></div> <div class="hp-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Points</h3> <div><div class="hp-inputs svelte-1r5hyyb"><input type="number" class="hp-current svelte-1r5hyyb" min="0"/> <span class="hp-separator svelte-1r5hyyb">/</span> <input type="number" class="hp-max svelte-1r5hyyb" min="0"/></div> <div class="hp-controls svelte-1r5hyyb"><button class="hp-btn svelte-1r5hyyb">‚àí</button> <button class="hp-btn svelte-1r5hyyb">+</button> <button class="hp-btn svelte-1r5hyyb">‚àí5</button> <button class="hp-btn svelte-1r5hyyb">+5</button></div></div> <div class="temp-hp svelte-1r5hyyb"><label for="tempHP" class="svelte-1r5hyyb">Temp HP</label> <input type="number" id="tempHP" min="0" class="svelte-1r5hyyb"/></div></div> <div class="hit-dice-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Dice</h3> <div class="hit-dice-display svelte-1r5hyyb"><input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <span>/</span> <input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <!></div> <div class="hit-dice-controls svelte-1r5hyyb"><label for="hitDiceCount" class="svelte-1r5hyyb">Roll</label> <div class="hit-dice-count-controls svelte-1r5hyyb"><button class="hit-dice-btn svelte-1r5hyyb">‚àí</button> <input type="number" id="hitDiceCount" class="hit-dice-count-input svelte-1r5hyyb" min="1"/> <button class="hit-dice-btn svelte-1r5hyyb">+</button></div> <button class="btn btn-primary roll-hit-dice use-enabled svelte-1r5hyyb">üé≤ Roll</button></div></div>',1),gl=m("<section><!> <!></section>");function _l(a,r){Pt(r,!1);const t=()=>tt(ae,"$character",$),o=()=>tt(ha,"$abilityModifiers",$),d=()=>tt(ta,"$searchFilter",$),p=()=>tt(Tt,"$collapsedStates",$),b=()=>tt(Zt,"$isEditMode",$),[$,S]=Wt(),x=L(),W=L(),H=L(),se=L(),Q=L(),Z=L(),ye=L(),me=na();let U=L(1);function le(O){ae.update(V=>(V.currentHP=Math.max(0,Math.min(V.maxHP,V.currentHP+O)),V))}function $e(O){const V=e(U)+O,k=t().hitDice.current;c(U,Math.max(1,Math.min(k,V)))}function he(O=1){if(t().hitDice.current<=0){alert("No hit dice remaining!");return}if(!t().class){alert("Please select a class first!");return}const V=Ht(t().class);if(!V){alert("Invalid class configuration!");return}const k=Math.min(O,t().hitDice.current),re=V.hitDice,_=o().constitution,B=_*k,te=B>=0?`+${B}`:`${B}`,Ge=`${k}${re}${te}`,qe=[];if(qe.push({value:`${k}${re}`,source:"hit dice"}),_!==0)for(let we=0;we<k;we++)qe.push({value:_,source:"constitution"});me("rollHitDice",{notation:Ge,hitDie:re,count:k,bonusBreakdown:qe})}Qe(()=>(t(),o(),ae),()=>{if(t().armorName!==void 0||t().shieldEquipped!==void 0){const O=o().dexterity,V=il(t().armorName,O,t().shieldEquipped||!1);t().armorClass!==V&&ae.update(k=>({...k,armorClass:V}))}}),Qe(()=>(o(),t(),ae),()=>{const O=o().dexterity;t().initiative!==O&&ae.update(V=>({...V,initiative:O}))}),Qe(()=>t(),()=>{c(x,Ea(t(),t().abilities))}),Qe(()=>t(),()=>{c(W,nl(t(),t().abilities))}),Qe(()=>t(),()=>{c(H,rl(t(),t().abilities))}),Qe(()=>t(),()=>{c(se,ol(t(),t().abilities))}),Qe(()=>(t(),e(U)),()=>{const O=t().hitDice.current;O>0&&e(U)>O&&c(U,O)}),Qe(()=>t(),()=>{c(Q,t().activeStates&&t().activeStates.length>0?t().activeStates.reduce((O,V)=>O+(V.acBonus||0),0):0)}),Qe(()=>t(),()=>{c(Z,t().activeStates&&t().activeStates.length>0?t().activeStates.some(O=>O.name==="Aid"&&O.target==="self"):!1)}),Qe(()=>d(),()=>{c(ye,!d()||"armor class".includes(d().toLowerCase())||"initiative".includes(d().toLowerCase())||"speed".includes(d().toLowerCase())||"hit points".includes(d().toLowerCase())||"hp".includes(d().toLowerCase())||"hit dice".includes(d().toLowerCase())||"spell save".includes(d().toLowerCase())||"combat".includes(d().toLowerCase()))}),Jt(),Rt();var Pe=gl();let Ie;var ie=i(Pe);{let O=dt(()=>(p(),n(()=>p().combatStats?"Expand":"Collapse")));ra(ie,{title:"Combat Stats",get collapsed(){return p(),n(()=>p().combatStats)},get ariaLabel(){return e(O)},onToggle:()=>Tt.update(V=>({...V,combatStats:!V.combatStats}))})}var Se=s(ie,2);{var We=O=>{var V=bl(),k=Oe(V);{var re=q=>{var De=fl(),ve=s(i(De),2),g=i(ve),I=s(i(g),2);T(()=>{t(),Ct(()=>{})});var ee=i(I);ee.value=(ee.__value=void 0)??"";var Y=s(ee);xt(Y,1,()=>cs,kt,(G,fe)=>{var Ae=rt(),nt=Oe(Ae);{var K=vt=>{var ft=pl(),gt=i(ft);l(ft);var f={};T(()=>{D(gt,`${e(fe),n(()=>e(fe).name)??""} (AC ${e(fe),n(()=>e(fe).baseAC)??""})`),f!==(f=(e(fe),n(()=>e(fe).name)))&&(ft.value=(ft.__value=(e(fe),n(()=>e(fe).name)))??"")}),v(vt,ft)};y(nt,vt=>{e(fe),n(()=>e(fe).name!=="Unarmored")&&vt(K)})}v(G,Ae)}),l(I),l(g);var ne=s(g,2),w=i(ne),R=i(w);je(R),ia(),l(w),l(ne),l(ve),l(De),Ca(I,()=>t().armorName,G=>_t(ae,n(t).armorName=G,n(t))),wa(R,()=>t().shieldEquipped,G=>_t(ae,n(t).shieldEquipped=G,n(t))),v(q,De)};y(k,q=>{b()&&q(re)})}var _=s(k,2),B=i(_),te=i(B),Ge=s(i(te),2);Ma(Ge,{get tooltipContent(){return e(W)},ariaLabel:"Show AC breakdown"}),l(te);var qe=s(te,2);je(qe),l(B);var we=s(B,2),h=i(we),P=s(i(h),2);Ma(P,{get tooltipContent(){return e(H)},ariaLabel:"Show Initiative breakdown"}),l(h);var X=s(h,2);je(X),l(we);var oe=s(we,2),z=s(i(oe),2);je(z),l(oe);var ke=s(oe,2);{var Me=q=>{var De=ml(),ve=i(De),g=s(i(ve),2);Ma(g,{get tooltipContent(){return e(se)},ariaLabel:"Show Spell Save DC breakdown"}),l(ve);var I=s(ve,2);je(I),l(De),T(()=>ma(I,e(x))),v(q,De)};y(ke,q=>{e(x)!==null&&q(Me)})}l(_);var st=s(_,2),xe=s(i(st),2);let Ke;var M=i(xe),C=i(M);je(C);var ue=s(C,4);je(ue),l(M);var pe=s(M,2),J=i(pe),u=s(J,2),ze=s(u,2),be=s(ze,2);l(pe),l(xe);var ge=s(xe,2),F=s(i(ge),2);je(F),l(ge),l(st);var Fe=s(st,2),Te=s(i(Fe),2),Xe=i(Te);je(Xe);var lt=s(Xe,4);je(lt);var Re=s(lt,2);{var Ce=q=>{const De=dt(()=>(E(Ht),t(),n(()=>Ht(t().class))));var ve=rt(),g=Oe(ve);{var I=ee=>{const Y=dt(()=>(o(),n(()=>o().constitution)));var ne=hl(),w=i(ne);l(ne),T(()=>D(w,`(${E(e(De)),n(()=>e(De).hitDice)??""}${(e(Y)>=0?`+${e(Y)}`:e(Y))??""})`)),v(ee,ne)};y(g,ee=>{e(De)&&ee(I)})}v(q,ve)};y(Re,q=>{t(),n(()=>t().class)&&q(Ce)})}l(Te);var Be=s(Te,2),Ee=s(i(Be),2),He=i(Ee),Ne=s(He,2);je(Ne);var ce=s(Ne,2);l(Ee);var _e=s(Ee,2);l(Be),l(Fe),T(()=>{ma(qe,(e(Q),t(),n(()=>e(Q)!==0?`${t().armorClass} ‚Üí ${t().armorClass+e(Q)}`:`${t().armorClass}`))),St(qe,1,Ms(e(Q)!==0?"stat-input ac-enhanced":"stat-input"),"svelte-1r5hyyb"),ma(X,(t(),n(()=>t().initiative))),Ke=St(xe,1,"hp-display svelte-1r5hyyb",null,Ke,{"aid-active":e(Z)}),Ve(C,"max",(t(),n(()=>t().maxHP))),Ve(Xe,"max",(t(),n(()=>t().hitDice.max))),He.disabled=e(U)<=1,Ve(Ne,"max",(t(),n(()=>t().hitDice.current))),ce.disabled=(e(U),t(),n(()=>e(U)>=t().hitDice.current)),_e.disabled=(t(),n(()=>t().hitDice.current<=0||!t().class))}),Je(z,()=>t().speed,q=>_t(ae,n(t).speed=q,n(t))),Je(C,()=>t().currentHP,q=>_t(ae,n(t).currentHP=q,n(t))),Je(ue,()=>t().maxHP,q=>_t(ae,n(t).maxHP=q,n(t))),A("click",J,()=>le(-1)),A("click",u,()=>le(1)),A("click",ze,()=>le(-5)),A("click",be,()=>le(5)),Je(F,()=>t().tempHP,q=>_t(ae,n(t).tempHP=q,n(t))),Je(Xe,()=>t().hitDice.current,q=>_t(ae,n(t).hitDice.current=q,n(t))),Je(lt,()=>t().hitDice.max,q=>_t(ae,n(t).hitDice.max=q,n(t))),A("click",He,()=>$e(-1)),Je(Ne,()=>e(U),q=>c(U,q)),A("input",Ne,q=>{const De=q.target,ve=parseInt(De.value);ve>t().hitDice.current&&c(U,t().hitDice.current),ve<1&&c(U,1)}),A("click",ce,()=>$e(1)),A("click",_e,()=>he(e(U))),v(O,V)};y(Se,O=>{p(),n(()=>!p().combatStats)&&O(We)})}l(Pe),T(()=>Ie=St(Pe,1,"combat-stats svelte-1r5hyyb",null,Ie,{hidden:!e(ye)})),v(a,Pe),It(),S()}const _a={acrobatics:"dexterity",animalHandling:"wisdom",arcana:"intelligence",athletics:"strength",deception:"charisma",history:"intelligence",insight:"wisdom",intimidation:"charisma",investigation:"intelligence",medicine:"wisdom",nature:"intelligence",perception:"wisdom",performance:"charisma",persuasion:"charisma",religion:"intelligence",sleightOfHand:"dexterity",stealth:"dexterity",survival:"wisdom"};var yl=m('<div class="skill-row svelte-1f1pl16"><input type="checkbox" class="svelte-1f1pl16"/> <label class="svelte-1f1pl16"> <span class="ability-tag svelte-1f1pl16"> </span></label> <span class="skill-modifier svelte-1f1pl16"> </span> <button class="roll-btn svelte-1f1pl16">Roll</button></div>'),xl=m('<div class="skills-grid svelte-1f1pl16"></div>'),Sl=m("<section><!> <!></section>");function kl(a,r){Pt(r,!1);const t=()=>tt(ae,"$character",$),o=()=>tt(ha,"$abilityModifiers",$),d=()=>tt(ta,"$searchFilter",$),p=()=>tt(Tt,"$collapsedStates",$),b=()=>tt(Zt,"$isEditMode",$),[$,S]=Wt(),x=L(),W=L(),H=L(),se=L(),Q=L(),Z=L(),ye=na(),me=[{key:"acrobatics",label:"Acrobatics"},{key:"animalHandling",label:"Animal Handling"},{key:"arcana",label:"Arcana"},{key:"athletics",label:"Athletics"},{key:"deception",label:"Deception"},{key:"history",label:"History"},{key:"insight",label:"Insight"},{key:"intimidation",label:"Intimidation"},{key:"investigation",label:"Investigation"},{key:"medicine",label:"Medicine"},{key:"nature",label:"Nature"},{key:"perception",label:"Perception"},{key:"performance",label:"Performance"},{key:"persuasion",label:"Persuasion"},{key:"religion",label:"Religion"},{key:"sleightOfHand",label:"Sleight of Hand"},{key:"stealth",label:"Stealth"},{key:"survival",label:"Survival"}];function U(ie){const Se=_a[ie],We=o()[Se],O=t().skillProficiencies[ie]?t().proficiencyBonus:0,V=e(x)[ie],k=`1d20${V>=0?"+":""}${V}`,re=[];re.push({value:"1d20",source:"base die"}),We!==0&&re.push({value:We,source:Se}),O!==0&&re.push({value:O,source:"proficiency"}),ye("roll",{notation:k,rollType:"check",bonusBreakdown:re})}Qe(()=>{},()=>{c(x,{})}),Qe(()=>t(),()=>{c(W,t().skillProficiencies)}),Qe(()=>t(),()=>{c(H,t().proficiencyBonus)}),Qe(()=>o(),()=>{c(se,o())}),Qe(()=>(e(se),e(W),e(H)),()=>{for(const{key:ie}of me){const Se=_a[ie],We=e(se)[Se],O=e(W)[ie]?e(H):0;la(x,e(x)[ie]=We+O)}}),Qe(()=>d(),()=>{c(Q,me.filter(({label:ie})=>d()?ie.toLowerCase().includes(d().toLowerCase()):!0))}),Qe(()=>e(Q),()=>{c(Z,e(Q).length>0)}),Jt(),Rt();var le=Sl();let $e;var he=i(le);{let ie=dt(()=>(p(),n(()=>p().skills?"Expand":"Collapse")));ra(he,{title:"Skills",get collapsed(){return p(),n(()=>p().skills)},get ariaLabel(){return e(ie)},onToggle:()=>Tt.update(Se=>({...Se,skills:!Se.skills}))})}var Pe=s(he,2);{var Ie=ie=>{var Se=xl();xt(Se,5,()=>e(Q),kt,(We,O)=>{let V=()=>e(O).key,k=()=>e(O).label;var re=yl(),_=i(re);je(_);var B=s(_,2),te=i(B),Ge=s(te),qe=i(Ge);l(Ge),l(B);var we=s(B,2),h=i(we);l(we);var P=s(we,2);l(re),T(X=>{rs(_,(e(W),V(),n(()=>e(W)[V()]))),_.disabled=!b(),Ve(_,"id",V()),Ve(B,"for",V()),D(te,`${k()??""} `),D(qe,`(${X??""})`),D(h,`${e(x),V(),n(()=>e(x)[V()]>=0?"+":"")??""}${e(x),V(),n(()=>e(x)[V()])??""}`)},[()=>(E(_a),V(),n(()=>_a[V()].substring(0,3).toUpperCase()))]),A("change",_,X=>{console.log("Skill proficiency changed:",V(),X.target.checked),ae.update(oe=>({...oe,skillProficiencies:{...oe.skillProficiencies,[V()]:X.target.checked}}))}),A("click",P,()=>U(V())),v(We,re)}),l(Se),v(ie,Se)};y(Pe,ie=>{p(),n(()=>!p().skills)&&ie(Ie)})}l(le),T(()=>$e=St(le,1,"skills svelte-1f1pl16",null,$e,{hidden:!e(Z)})),v(a,le),It(),S()}let ya=null,xa=null;async function ds(){if(ya)return ya;try{return ya=await(await fetch(os("/data/spells.json"))).json(),ya||[]}catch(a){return console.error("Failed to load spells:",a),[]}}async function $l(){if(xa)return xa;try{return xa=await(await fetch(os("/data/feats.json"))).json(),xa||[]}catch(a){return console.error("Failed to load feats:",a),[]}}function Xa(a,r){if(!r.trim())return a;const t=r.toLowerCase();return a.filter(o=>o.name.toLowerCase().includes(t)||o.school.toLowerCase().includes(t)||o.classes.some(d=>d.toLowerCase().includes(t))||o.description.toLowerCase().includes(t))}function Cl(a,r){return r===null?a:a.filter(t=>t.level===r)}function wl(a,r){if(!r.trim())return a;const t=r.toLowerCase();return a.filter(o=>o.name.toLowerCase().includes(t)||o.description.toLowerCase().includes(t))}function Sa(a){const r=a.description,t=/\b(Strength|Dexterity|Constitution|Intelligence|Wisdom|Charisma)\s+saving\s+throw/i,o=r.match(t);if(!o)return null;const d=o[1].toLowerCase(),b=/half\s+(?:as\s+much\s+)?damage\s+on\s+a\s+successful(?:\s+save)?/i.test(r),S=/saving\s+throw\s+or\s+take.*?damage/i.test(r)&&!b;return{ability:d,halfDamageOnSave:b,noDamageOnSave:S}}function Dl(a){const r=a.description;return/(plus|add)\s+your\s+spellcasting\s+(ability\s+)?modifier/i.test(r)}function Fa(a){const r=a.description.toLowerCase();return r.includes("ranged spell attack")||r.includes("melee spell attack")}function Za(a){const r=a.description.toLowerCase();if(["Divine Favor","Bless","Aid","Command"].includes(a.name))return!0;const d=["takes","take","deals","deal","damage equal to","force damage","fire damage","cold damage","lightning damage","thunder damage","acid damage","poison damage","necrotic damage","radiant damage","psychic damage","regain","regains","hit point"].some($=>r.includes($));return["bonus to attack","bonus to damage","bonus to ac","gains a +","gain a +","+1 bonus","+2 bonus","+3 bonus","advantage on","becomes a magic weapon"].some($=>r.includes($))&&!d}function Ll(a){const r=a.description;let t=0,o=0,d=0,p="";const b=r.match(/\+(\d+)\s+bonus\s+to\s+attack\s+rolls\s+and\s+damage\s+rolls/i);if(b){const S=parseInt(b[1]);t=S,o=S,p=`+${S} to attack and damage rolls`}if(a.name==="Bless"&&(p="Add 1d4 to attack rolls and saves",t="1d4"),a.name==="Aid")return p="+5 HP (max and current) for 8 hours",{attackBonus:0,damageBonus:0,acBonus:0,hpBonus:5,description:p,name:a.name};a.name==="Divine Favor"&&(p="Your weapon attacks deal an extra 1d4 radiant damage on a hit.",o="1d4");const $=r.match(/\+(\d+)\s+bonus\s+to\s+AC/i);return $&&(d=parseInt($[1]),p=`+${d} to AC`),a.name==="Haste"&&(p="+2 AC, doubled speed, extra action",d=2),p||t!==0||o!==0||d!==0?{attackBonus:t,damageBonus:o,acBonus:d,description:p||a.description.substring(0,100),name:a.name}:null}var jl=m('<button class="btn btn-secondary">Add Attack</button>'),Al=m('<input type="text" placeholder="Attack name" class="attack-name svelte-14o91c5"/>'),Bl=m('<h4 class="attack-name-display svelte-14o91c5"> </h4>'),Ml=m('<button class="btn-remove svelte-14o91c5">√ó</button>'),Fl=m('<div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Bonus</label> <input type="number" class="attack-bonus svelte-14o91c5"/></div>'),Tl=m('<div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Damage</label> <input type="text" placeholder="e.g., 2d6+3" class="attack-damage svelte-14o91c5"/></div>'),Rl=m('<div class="spell-info-loading svelte-14o91c5">Loading spell info...</div>'),Pl=m('<li class="svelte-14o91c5"><strong>At Higher Levels:</strong> </li>'),Il=m('<ul class="svelte-14o91c5"><li class="svelte-14o91c5"><strong>Level:</strong> </li> <li class="svelte-14o91c5"><strong>Casting Time:</strong> </li> <li class="svelte-14o91c5"><strong>Range:</strong> </li> <li class="svelte-14o91c5"><strong>Components:</strong> <!></li> <li class="svelte-14o91c5"><strong>Duration:</strong> <!> </li> <li class="svelte-14o91c5"><strong>Description:</strong> </li> <!></ul>'),El=m('<span class="scaled-damage svelte-14o91c5" style="margin-left: 8px;"> </span>'),Hl=m('<span class="scaled-damage svelte-14o91c5">(Half damage)</span>'),Nl=m('<span class="scaled-damage svelte-14o91c5">(No damage)</span>'),Ul=m('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> <!> <!></label></div>'),Ol=m("<option> </option>"),Gl=m('<span class="scaled-damage svelte-14o91c5"><!> </span>'),ql=m('<span class="scaled-damage svelte-14o91c5"> </span>'),Wl=m('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> Target is Fiend or Undead <!></label></div>'),zl=m('<div class="spell-level-selector svelte-14o91c5"><label class="svelte-14o91c5">Cast at Level:</label> <select class="spell-level-select use-enabled svelte-14o91c5"></select> <!></div> <!>',1),Kl=m('<div class="spell-level-selector svelte-14o91c5"><span style="color: #dc3545; font-weight: bold;">No spell slots available!</span></div>'),Vl=m('<div class="spell-info svelte-14o91c5"><div class="spell-info-header svelte-14o91c5" role="button" tabindex="0"><h4 class="svelte-14o91c5">Spell Info</h4> <button class="collapse-btn-small svelte-14o91c5"> </button></div> <!></div> <!> <!>',1),Jl=m('<div class="spell-info-missing svelte-14o91c5">Spell info not found.</div>'),Yl=m('<div class="attack-notes svelte-14o91c5"><label class="svelte-14o91c5">Notes</label> <textarea placeholder="e.g., DC 15 Dex save, Range 120 ft, Concentration" class="notes-input svelte-14o91c5" rows="2"></textarea></div>'),Ql=m('<button class="btn btn-primary">Roll Attack</button>'),Xl=m('<div class="buff-target-selection svelte-14o91c5"><div class="target-options svelte-14o91c5"><label class="target-option svelte-14o91c5"><input type="radio" class="svelte-14o91c5"/> Self</label> <label class="target-option svelte-14o91c5"><input type="radio" class="svelte-14o91c5"/> Other</label></div> <button class="btn btn-info"> </button></div>'),Zl=m('<button class="btn btn-info">Cast Spell</button>'),ei=m("<button><!></button>"),ti=m('<button class="btn btn-info">Cast Spell</button>'),ai=m('<button class="btn btn-secondary">Roll Damage</button>'),si=m('<button class="btn btn-primary">Roll Attack</button> <!>',1),li=m('<div class="attack-card svelte-14o91c5"><div class="attack-header svelte-14o91c5"><!> <!></div> <div class="attack-details svelte-14o91c5"><!> <!> <div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Type</label> <input type="text" placeholder="e.g., slashing" class="attack-type svelte-14o91c5"/></div></div> <!> <!> <div class="attack-actions svelte-14o91c5"><!></div></div>'),ii=m('<p class="no-attacks svelte-14o91c5">No attacks added yet. Click "Add Attack" to create one.</p>'),ni=m('<p class="no-attacks svelte-14o91c5">No attacks match your search.</p>'),ri=m('<button class="btn-remove svelte-14o91c5">√ó</button>'),oi=m('<div class="state-card svelte-14o91c5"><div class="state-header svelte-14o91c5"><input type="text" placeholder="Effect name (e.g., Magic Weapon)" class="state-name svelte-14o91c5"/> <!></div> <div class="state-details svelte-14o91c5"><div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Attack Bonus</label> <input type="number" class="state-bonus svelte-14o91c5"/></div> <div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Damage Bonus</label> <input type="text" class="state-bonus svelte-14o91c5"/></div> <div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Target</label> <select class="state-bonus svelte-14o91c5"><option>Self</option><option>Other</option></select></div></div> <div class="state-description svelte-14o91c5"><label class="svelte-14o91c5">Description</label> <input type="text" placeholder="e.g., +1 to attack and damage rolls (Magic Weapon)" class="state-desc-input svelte-14o91c5"/></div></div>'),ci=m('<div class="states-list svelte-14o91c5"></div>'),vi=m('<p class="no-states svelte-14o91c5">No active effects. Add spell effects that modify your attacks.</p>'),di=m('<!> <div class="attacks-list svelte-14o91c5"><!> <!></div> <div class="active-states-section svelte-14o91c5"><h3 class="svelte-14o91c5">Active Spell Effects</h3> <p class="section-description svelte-14o91c5">Effects that modify attack and damage rolls (e.g., Magic Weapon, Bless)</p> <button class="btn btn-secondary">Add Effect</button> <!></div>',1),ui=m("<section><!> <!></section>");function pi(a,r){Pt(r,!1);const t=()=>tt(ae,"$character",$),o=()=>tt(ha,"$abilityModifiers",$),d=()=>tt(ta,"$searchFilter",$),p=()=>tt(Tt,"$collapsedStates",$),b=()=>tt(Zt,"$isEditMode",$),[$,S]=Wt(),x=L(),W=L(),H=[],se=na();let Q=L({}),Z=L({});function ye(h){la(Q,e(Q)[h]=!e(Q)[h]),c(Q,{...e(Q)})}function me(h){return h.description.toLowerCase().includes("regain")&&(h.description.toLowerCase().includes("hit point")||h.description.toLowerCase().includes("hp"))}function U(h){return["Shield of Faith","Bless","Aid","Magic Weapon"].includes(h)}function le(){ae.update(h=>(h.attacks=[...h.attacks,{id:crypto.randomUUID(),name:"",bonus:0,damage:"",damageType:"",notes:""}],h))}function $e(h){ae.update(P=>(P.attacks=P.attacks.filter(X=>X.id!==h),P))}function he(h){let P=h.damage,X=!1,oe=!1;if(h.spellRef){const xe=Se(h.spellRef);if(xe&&(oe=Fa(xe),xe.level>0)){const Ke=h.castAtLevel||xe.level;if(!We(Ke)){qt.add(`No level ${Ke} spell slots available!`,"error");return}const C=Sa(xe);C&&h.targetSucceededSave&&C.noDamageOnSave?P="0":(X=C?.halfDamageOnSave&&h.targetSucceededSave||!1,P=O(h,xe))}}else if(t().activeStates&&t().activeStates.length>0){let xe=0,Ke=[];for(const M of t().activeStates)M.target!=="other"&&(typeof M.damageBonus=="string"?Ke.push(M.damageBonus):typeof M.damageBonus=="number"&&(xe+=M.damageBonus));if((xe!==0||Ke.length>0)&&P){const M=P.match(/(\d+d\d+)([+-]\d+)?/);if(M){const[,C,ue]=M,J=(ue?parseInt(ue):0)+xe;let u=`${C}`;J!==0&&(u+=`${J>=0?"+":""}${J}`),Ke.length>0&&(u+=" + "+Ke.join(" + ")),P=u}}}const z=[];let ke=0;if(oe){const xe=Qa(t(),o()),Ke=t().proficiencyBonus||0;z.push({value:Ke,source:"proficiency"}),z.push({value:xe,source:"spellcasting"}),ke=Ke+xe}else h.bonus!==0&&z.push({value:h.bonus,source:"base"}),ke=h.bonus;let Me=[];if(t().activeStates)for(const xe of t().activeStates)xe.target!=="other"&&(typeof xe.attackBonus=="number"&&xe.attackBonus!==0?(z.push({value:xe.attackBonus,source:xe.name.toLowerCase()}),ke+=xe.attackBonus):typeof xe.attackBonus=="string"&&xe.attackBonus&&(Me.push(xe.attackBonus),z.push({value:xe.attackBonus,source:xe.name.toLowerCase()})));let st=`1d20${ke>=0?"+":""}${ke}`;Me.length>0&&(st+="+"+Me.join("+")),se("roll",{notation:st,damageNotation:P,attackName:h.name,applyHalfDamage:X,bonusBreakdown:z,rollType:"attack"})}function Pe(h){if(!h.damage){qt.add(`${h.name}: No damage specified`,"error");return}let P=h.damage,X=!1;const oe=[];if(h.spellRef){const z=Se(h.spellRef);if(z&&z.level>0){const ke=h.castAtLevel||z.level;if(!We(ke)){qt.add(`No level ${ke} spell slots available!`,"error");return}const st=Sa(z);st&&h.targetSucceededSave&&st.noDamageOnSave?P="0":(X=st?.halfDamageOnSave&&h.targetSucceededSave||!1,P=O(h,z))}}else{const z=P.match(/(\d+d\d+)([+-]\d+)?/);if(z){const[,ke,Me]=z,st=Me?parseInt(Me):0;if(st!==0&&oe.push({value:st,source:"base"}),t().activeStates&&t().activeStates.length>0){let xe=0,Ke=[];for(const M of t().activeStates)M.target!=="other"&&(typeof M.damageBonus=="string"?Ke.push(M.damageBonus):typeof M.damageBonus=="number"&&M.damageBonus!==0&&(oe.push({value:M.damageBonus,source:M.name.toLowerCase()}),xe+=M.damageBonus));if(xe!==0||Ke.length>0){const M=st+xe;let C=`${ke}`;M!==0&&(C+=`${M>=0?"+":""}${M}`),Ke.length>0&&(C+=" + "+Ke.join(" + ")),P=C}}}}se("roll",{notation:P,attackName:h.name,applyHalfDamage:X,bonusBreakdown:oe})}let Ie=L([]),ie=L(!1);va(async()=>{c(Ie,await ds()),c(ie,!0)});function Se(h){return e(Ie).find(P=>P.name===h)}function We(h){t().classFeatures.spellSlotsByLevel||_t(ae,n(t).classFeatures.spellSlotsByLevel={},n(t)),t().classFeatures.spellSlotsByLevel[h]||_t(ae,n(t).classFeatures.spellSlotsByLevel[h]=Array(2).fill(!1),n(t));const X=t().classFeatures.spellSlotsByLevel[h].findIndex(oe=>!oe);return X===-1?!1:(ae.update(oe=>(oe.classFeatures.spellSlotsByLevel||(oe.classFeatures.spellSlotsByLevel={}),oe.classFeatures.spellSlotsByLevel[h]||(oe.classFeatures.spellSlotsByLevel[h]=Array(2).fill(!1)),oe.classFeatures.spellSlotsByLevel[h][X]=!0,oe)),!0)}function O(h,P){let X=h.damage,oe=0,z=0;if(Dl(P)&&(z+=Qa(t(),o())),t().activeStates)for(const pe of t().activeStates)pe.target!=="other"&&typeof pe.damageBonus=="number"&&(z+=pe.damageBonus);if(P.higherLevelSlot&&h.castAtLevel){const pe=P.level,u=(h.castAtLevel||pe)-pe;if(u>0){const ze=P.higherLevelSlot.match(/(\d+)d(\d+)\s+for\s+each.*?level\s+above/i);if(ze){const[,be]=ze;oe+=u*parseInt(be)}}}if(h.targetIsFiendOrUndead&&P.description.includes("Fiend or an Undead")){const pe=P.description.match(/increases by (\d+)d(\d+) if.*?Fiend or.*?Undead/i);if(pe){const[,J]=pe;oe+=parseInt(J)}}const ke=X.match(/(\d+)d(\d+)([+-]\d+)?/);if(!ke)return z!==0?z>=0?`${z}`:`${z}`:X||"0";const[,Me,st,xe]=ke,Ke=parseInt(Me)+oe,C=(xe?parseInt(xe):0)+z;let ue=`${Ke}d${st}`;return C!==0&&(ue+=C>=0?`+${C}`:`${C}`),ue}function V(h){const P=[];for(let oe=h.level;oe<=9;oe++){const z=t().classFeatures.spellSlotsByLevel?.[oe];z&&z.length>0&&P.push(oe)}return P}function k(){ae.update(h=>(h.activeStates||(h.activeStates=[]),h.activeStates=[...h.activeStates,{name:"",attackBonus:0,damageBonus:0,description:"",target:"self"}],h))}function re(h){ae.update(P=>{if(P.activeStates){const X=P.activeStates[h];X?.hpBonus&&X.target!=="other"&&(P.maxHP-=X.hpBonus,P.currentHP=Math.max(1,Math.min(P.currentHP-X.hpBonus,P.maxHP))),P.activeStates=P.activeStates.filter((oe,z)=>z!==h)}return P})}function _(h,P="self"){const X=Se(h.spellRef);if(!X){qt.add("Spell not found","error");return}const oe=h.castAtLevel||X.level;if(oe>0&&!We(oe)){qt.add(`No level ${oe} spell slots available!`,"error");return}const z=Ll(X);if(!z){qt.add(`${X.name} cast! Check spell description for effects.`,"info");return}let ke=z.hpBonus||0,Me=z.description;X.name==="Aid"&&oe>X.level&&(ke=5+(oe-X.level)*5,Me=`+${ke} HP (max and current) for 8 hours`);const xe=["Shield of Faith","Bless","Aid","Magic Weapon"].includes(X.name);ae.update(M=>{M.activeStates||(M.activeStates=[]);const C=M.activeStates.find(ue=>ue.name===X.name);return C&&C.hpBonus&&C.target!=="other"&&(M.maxHP-=C.hpBonus,M.currentHP=Math.max(1,Math.min(M.currentHP-C.hpBonus,M.maxHP))),M.activeStates=M.activeStates.filter(ue=>ue.name!==X.name),ke>0&&P==="self"&&(M.maxHP+=ke,M.currentHP+=ke),M.activeStates=[...M.activeStates,{name:X.name,attackBonus:z.attackBonus,damageBonus:z.damageBonus,acBonus:z.acBonus,description:Me,target:P,hpBonus:ke}],M});const Ke=P==="self"?" on self":" on other";qt.add(`${X.name} cast${xe?Ke:""}! Effect added to Active Spell Effects.`,"success")}Qe(()=>(t(),e(Q),e(Z)),()=>{if(t()&&t().attacks)for(const h of t().attacks)h.spellRef&&e(Q)[h.id]===void 0&&la(Q,e(Q)[h.id]=!0),h.spellRef&&e(Z)[h.id]===void 0&&la(Z,e(Z)[h.id]="self")}),Qe(()=>(t(),d()),()=>{c(x,t().attacks.filter(h=>{if(!d())return!0;const P=d().toLowerCase();return h.name.toLowerCase().includes(P)||h.damageType.toLowerCase().includes(P)}).sort((h,P)=>!h.spellRef&&P.spellRef?-1:h.spellRef&&!P.spellRef?1:0))}),Qe(()=>(d(),e(x)),()=>{c(W,!d()||e(x).length>0||"attack".includes(d().toLowerCase())||"spell".includes(d().toLowerCase()))}),Jt(),Rt();var B=ui();let te;var Ge=i(B);{let h=dt(()=>(p(),n(()=>p().attacks?"Expand":"Collapse")));ra(Ge,{title:"Attacks & Spells",get collapsed(){return p(),n(()=>p().attacks)},get ariaLabel(){return e(h)},onToggle:()=>Tt.update(P=>({...P,attacks:!P.attacks}))})}var qe=s(Ge,2);{var we=h=>{var P=di(),X=Oe(P);{var oe=J=>{var u=jl();A("click",u,le),v(J,u)};y(X,J=>{b()&&J(oe)})}var z=s(X,2),ke=i(z);xt(ke,1,()=>e(x),J=>J.id,(J,u,ze)=>{var be=li(),ge=i(be),F=i(ge);{var Fe=w=>{var R=Al();je(R),Je(R,()=>e(u).name,G=>(e(u).name=G,Ct(()=>(e(x),t(),d())))),v(w,R)},Te=w=>{var R=Bl(),G=i(R,!0);l(R),T(()=>D(G,(e(u),n(()=>e(u).name||"(Unnamed Attack)")))),v(w,R)};y(F,w=>{b()?w(Fe):w(Te,!1)})}var Xe=s(F,2);{var lt=w=>{var R=Ml();A("click",R,()=>$e(e(u).id)),v(w,R)};y(Xe,w=>{b()&&w(lt)})}l(ge);var Re=s(ge,2),Ce=i(Re);{var Be=w=>{var R=Fl(),G=i(R),fe=s(G,2);je(fe),l(R),T(()=>{Ve(G,"for",`attack-bonus-${e(u),n(()=>e(u).id)??""}`),Ve(fe,"id",`attack-bonus-${e(u),n(()=>e(u).id)??""}`)}),Je(fe,()=>e(u).bonus,Ae=>(e(u).bonus=Ae,Ct(()=>(e(x),t(),d())))),v(w,R)};y(Ce,w=>{e(u),n(()=>e(u).bonus!==0&&e(u).bonus!==void 0)&&w(Be)})}var Ee=s(Ce,2);{var He=w=>{var R=Tl(),G=i(R),fe=s(G,2);je(fe),l(R),T(()=>{Ve(G,"for",`attack-damage-${e(u),n(()=>e(u).id)??""}`),Ve(fe,"id",`attack-damage-${e(u),n(()=>e(u).id)??""}`)}),Je(fe,()=>e(u).damage,Ae=>(e(u).damage=Ae,Ct(()=>(e(x),t(),d())))),v(w,R)};y(Ee,w=>{e(u),n(()=>e(u).damage&&e(u).damage.trim()!=="")&&w(He)})}var Ne=s(Ee,2),ce=i(Ne),_e=s(ce,2);je(_e),l(Ne),l(Re);var q=s(Re,2);{var De=w=>{var R=rt(),G=Oe(R);{var fe=nt=>{var K=Rl();v(nt,K)},Ae=nt=>{const K=dt(()=>(e(u),n(()=>Se(e(u).spellRef))));var vt=rt(),ft=Oe(vt);{var gt=N=>{const j=dt(()=>(E(Sa),E(e(K)),n(()=>Sa(e(K)))));var Le=Vl(),de=Oe(Le),et=i(de),Ue=s(i(et),2),mt=i(Ue,!0);l(Ue),l(et);var Ye=s(et,2);{var ot=Ze=>{var at=Il(),ut=i(at),wt=s(i(ut));l(ut);var Nt=s(ut,2),Ut=s(i(Nt));l(Nt);var Bt=s(Nt,2),Dt=s(i(Bt));l(Bt);var Lt=s(Bt,2),Ot=s(i(Lt)),pt=s(Ot);{var Gt=$t=>{var jt=Ft();T(()=>D(jt,`(${E(e(K)),n(()=>e(K).material)??""})`)),v($t,jt)};y(pt,$t=>{E(e(K)),n(()=>e(K).material)&&$t(Gt)})}l(Lt);var Vt=s(Lt,2),Yt=s(i(Vt),2);{var aa=$t=>{var jt=Ft("Concentration,");v($t,jt)};y(Yt,$t=>{E(e(K)),n(()=>e(K).concentration)&&$t(aa)})}var At=s(Yt,1,!0);l(Vt);var Et=s(Vt,2),Mt=s(i(Et));l(Et);var zt=s(Et,2);{var Qt=$t=>{var jt=Pl(),Kt=s(i(jt));l(jt),T(()=>D(Kt,` ${E(e(K)),n(()=>e(K).higherLevelSlot)??""}`)),v($t,jt)};y(zt,$t=>{E(e(K)),n(()=>e(K).higherLevelSlot)&&$t(Qt)})}l(at),T($t=>{D(wt,` ${E(e(K)),n(()=>e(K).level)??""}`),D(Ut,` ${E(e(K)),n(()=>e(K).castingTime||e(K).actionType)??""}`),D(Dt,` ${E(e(K)),n(()=>e(K).range)??""}`),D(Ot,` ${$t??""}`),D(At,(E(e(K)),n(()=>e(K).duration))),D(Mt,` ${E(e(K)),n(()=>e(K).description)??""}`)},[()=>(E(e(K)),n(()=>e(K).components.join(", ")))]),v(Ze,at)};y(Ye,Ze=>{e(Q),e(u),n(()=>!e(Q)[e(u).id])&&Ze(ot)})}l(de);var it=s(de,2);{var ct=Ze=>{var at=Ul(),ut=i(at),wt=i(ut);je(wt);var Nt=s(wt),Ut=s(Nt);{var Bt=pt=>{var Gt=El(),Vt=i(Gt);l(Gt),T(Yt=>D(Vt,`(Spell Save DC: ${Yt??""})`),[()=>(E(Ea),t(),o(),n(()=>Ea(t(),o())))]),v(pt,Gt)};y(Ut,pt=>{t(),n(()=>t().class)&&pt(Bt)})}var Dt=s(Ut,2);{var Lt=pt=>{var Gt=Hl();v(pt,Gt)},Ot=pt=>{var Gt=rt(),Vt=Oe(Gt);{var Yt=aa=>{var At=Nl();v(aa,At)};y(Vt,aa=>{e(u),E(e(j)),n(()=>e(u).targetSucceededSave&&e(j).noDamageOnSave)&&aa(Yt)},!0)}v(pt,Gt)};y(Dt,pt=>{e(u),E(e(j)),n(()=>e(u).targetSucceededSave&&e(j).halfDamageOnSave)?pt(Lt):pt(Ot,!1)})}l(ut),l(at),T(pt=>D(Nt,` Target succeeded on ${pt??""} save `),[()=>(E(e(j)),n(()=>e(j).ability.charAt(0).toUpperCase()+e(j).ability.slice(1)))]),wa(wt,()=>e(u).targetSucceededSave,pt=>(e(u).targetSucceededSave=pt,Ct(()=>(e(x),t(),d())))),v(Ze,at)};y(it,Ze=>{e(j)&&Ze(ct)})}var ht=s(it,2);{var bt=Ze=>{const at=dt(()=>(E(e(K)),n(()=>V(e(K)))));var ut=rt(),wt=Oe(ut);{var Nt=Bt=>{var Dt=zl(),Lt=Oe(Dt),Ot=i(Lt),pt=s(Ot,2);T(()=>{e(u),Ct(()=>{e(at)})}),xt(pt,5,()=>e(at),kt,(At,Et)=>{var Mt=Ol(),zt=i(Mt);l(Mt);var Qt={};T(()=>{D(zt,`Level ${e(Et)??""}`),Qt!==(Qt=e(Et))&&(Mt.value=(Mt.__value=e(Et))??"")}),v(At,Mt)}),l(pt);var Gt=s(pt,2);{var Vt=At=>{const Et=dt(()=>(e(u),E(e(K)),n(()=>O(e(u),e(K)))));var Mt=Gl(),zt=i(Mt);{var Qt=Kt=>{var sa=Ft("Healing");v(Kt,sa)},$t=Kt=>{var sa=Ft("Damage");v(Kt,sa)};y(zt,Kt=>{E(e(K)),n(()=>me(e(K)))?Kt(Qt):Kt($t,!1)})}var jt=s(zt);l(Mt),T(()=>D(jt,` ${e(Et)??""}`)),v(At,Mt)};y(Gt,At=>{e(u),E(e(K)),n(()=>e(u).castAtLevel&&e(u).castAtLevel>e(K).level)&&At(Vt)})}l(Lt);var Yt=s(Lt,2);{var aa=At=>{var Et=Wl(),Mt=i(Et),zt=i(Mt);je(zt);var Qt=s(zt,2);{var $t=jt=>{const Kt=dt(()=>(e(u),E(e(K)),n(()=>O(e(u),e(K)))));var sa=ql(),us=i(sa);l(sa),T(()=>D(us,`(+1d8, total: ${e(Kt)??""})`)),v(jt,sa)};y(Qt,jt=>{e(u),n(()=>e(u).targetIsFiendOrUndead)&&jt($t)})}l(Mt),l(Et),wa(zt,()=>e(u).targetIsFiendOrUndead,jt=>(e(u).targetIsFiendOrUndead=jt,Ct(()=>(e(x),t(),d())))),v(At,Et)};y(Yt,At=>{E(e(K)),n(()=>e(K).description.includes("Fiend or an Undead"))&&At(aa)})}T(()=>{Ve(Ot,"for",`castLevel-${e(u),n(()=>e(u).id)??""}`),Ve(pt,"id",`castLevel-${e(u),n(()=>e(u).id)??""}`)}),Ca(pt,()=>e(u).castAtLevel,At=>(e(u).castAtLevel=At,Ct(()=>(e(x),t(),d())))),v(Bt,Dt)},Ut=Bt=>{var Dt=Kl();v(Bt,Dt)};y(wt,Bt=>{E(e(at)),n(()=>e(at).length>0)?Bt(Nt):Bt(Ut,!1)})}v(Ze,ut)};y(ht,Ze=>{E(e(K)),n(()=>e(K).higherLevelSlot&&e(K).level>0)&&Ze(bt)})}T(()=>{Ve(Ue,"aria-label",(e(Q),e(u),n(()=>e(Q)[e(u).id]?"Expand":"Collapse"))),D(mt,(e(Q),e(u),n(()=>e(Q)[e(u).id]?"‚ñº":"‚ñ≤")))}),A("click",et,()=>ye(e(u).id)),A("keydown",et,Ze=>Ze.key==="Enter"&&ye(e(u).id)),v(N,Le)},f=N=>{var j=Jl();v(N,j)};y(ft,N=>{e(K)?N(gt):N(f,!1)})}v(nt,vt)};y(G,nt=>{e(Ie),n(()=>e(Ie).length===0)?nt(fe):nt(Ae,!1)})}v(w,R)};y(q,w=>{e(u),n(()=>e(u).spellRef)&&w(De)})}var ve=s(q,2);{var g=w=>{var R=Yl(),G=i(R),fe=s(G,2);pa(fe),l(R),T(()=>{Ve(G,"for",`attack-notes-${e(u),n(()=>e(u).id)??""}`),Ve(fe,"id",`attack-notes-${e(u),n(()=>e(u).id)??""}`)}),Je(fe,()=>e(u).notes,Ae=>(e(u).notes=Ae,Ct(()=>(e(x),t(),d())))),v(w,R)};y(ve,w=>{e(u),n(()=>!e(u).spellRef)&&w(g)})}var I=s(ve,2),ee=i(I);{var Y=w=>{const R=dt(()=>(e(u),n(()=>Se(e(u).spellRef))));var G=rt(),fe=Oe(G);{var Ae=nt=>{var K=rt(),vt=Oe(K);{var ft=f=>{var N=Ql();A("click",N,()=>he(e(u))),v(f,N)},gt=f=>{var N=rt(),j=Oe(N);{var Le=et=>{var Ue=rt(),mt=Oe(Ue);{var Ye=it=>{var ct=Xl(),ht=i(ct),bt=i(ht),Ze=i(bt);je(Ze),Ze.value=Ze.__value="self",ia(),l(bt);var at=s(bt,2),ut=i(at);je(ut),ut.value=ut.__value="other",ia(),l(at),l(ht);var wt=s(ht,2),Nt=i(wt);l(wt),l(ct),T(()=>{Ve(Ze,"name",`target-${e(u),n(()=>e(u).id)??""}`),Ve(ut,"name",`target-${e(u),n(()=>e(u).id)??""}`),D(Nt,`Cast ${E(e(R)),n(()=>e(R).name)??""}`)}),za(H,[ze],Ze,()=>e(Z)[e(u).id],Ut=>la(Z,e(Z)[e(u).id]=Ut)),za(H,[ze],ut,()=>e(Z)[e(u).id],Ut=>la(Z,e(Z)[e(u).id]=Ut)),A("click",wt,()=>_(e(u),e(Z)[e(u).id])),v(it,ct)},ot=it=>{var ct=Zl();A("click",ct,()=>_(e(u),"self")),v(it,ct)};y(mt,it=>{E(e(R)),n(()=>U(e(R).name))?it(Ye):it(ot,!1)})}v(et,Ue)},de=et=>{var Ue=rt(),mt=Oe(Ue);{var Ye=it=>{var ct=ei(),ht=i(ct);{var bt=at=>{var ut=Ft("Roll Healing");v(at,ut)},Ze=at=>{var ut=Ft("Roll Damage");v(at,ut)};y(ht,at=>{E(e(R)),n(()=>me(e(R)))?at(bt):at(Ze,!1)})}l(ct),T(at=>St(ct,1,`btn ${at??""}`),[()=>(E(e(R)),n(()=>me(e(R))?"btn-success":"btn-secondary"))]),A("click",ct,()=>Pe(e(u))),v(it,ct)},ot=it=>{var ct=ti();A("click",ct,()=>_(e(u),"self")),v(it,ct)};y(mt,it=>{e(u),n(()=>e(u).damage&&e(u).damage.trim()!=="")?it(Ye):it(ot,!1)})}v(et,Ue)};y(j,et=>{E(Za),E(e(R)),n(()=>Za(e(R)))?et(Le):et(de,!1)},!0)}v(f,N)};y(vt,f=>{E(Fa),E(e(R)),n(()=>Fa(e(R)))?f(ft):f(gt,!1)})}v(nt,K)};y(fe,nt=>{e(R)&&nt(Ae)})}v(w,G)},ne=w=>{var R=rt(),G=Oe(R);{var fe=Ae=>{var nt=si(),K=Oe(nt),vt=s(K,2);{var ft=gt=>{var f=ai();A("click",f,()=>Pe(e(u))),v(gt,f)};y(vt,gt=>{e(u),n(()=>e(u).damage&&e(u).damage.trim()!=="")&&gt(ft)})}A("click",K,()=>he(e(u))),v(Ae,nt)};y(G,Ae=>{e(u),n(()=>!e(u).spellRef)&&Ae(fe)},!0)}v(w,R)};y(ee,w=>{e(u),e(ie),n(()=>e(u).spellRef&&e(ie))?w(Y):w(ne,!1)})}l(I),l(be),T(()=>{Ve(ce,"for",`attack-type-${e(u),n(()=>e(u).id)??""}`),Ve(_e,"id",`attack-type-${e(u),n(()=>e(u).id)??""}`)}),Je(_e,()=>e(u).damageType,w=>(e(u).damageType=w,Ct(()=>(e(x),t(),d())))),v(J,be)});var Me=s(ke,2);{var st=J=>{var u=ii();v(J,u)},xe=J=>{var u=rt(),ze=Oe(u);{var be=ge=>{var F=ni();v(ge,F)};y(ze,ge=>{e(x),n(()=>e(x).length===0)&&ge(be)},!0)}v(J,u)};y(Me,J=>{t(),n(()=>t().attacks.length===0)?J(st):J(xe,!1)})}l(z);var Ke=s(z,2),M=s(i(Ke),4),C=s(M,2);{var ue=J=>{var u=ci();xt(u,5,()=>(t(),n(()=>t().activeStates)),kt,(ze,be,ge)=>{var F=oi(),Fe=i(F),Te=i(Fe);je(Te);var Xe=s(Te,2);{var lt=ne=>{var w=ri();A("click",w,()=>re(ge)),v(ne,w)};y(Xe,ne=>{b()&&ne(lt)})}l(Fe);var Re=s(Fe,2),Ce=i(Re),Be=i(Ce);Ve(Be,"for",`state-attack-bonus-${ge}`);var Ee=s(Be,2);je(Ee),Ve(Ee,"id",`state-attack-bonus-${ge}`),l(Ce);var He=s(Ce,2),Ne=i(He);Ve(Ne,"for",`state-damage-bonus-${ge}`);var ce=s(Ne,2);je(ce),Ve(ce,"id",`state-damage-bonus-${ge}`),l(He);var _e=s(He,2),q=i(_e);Ve(q,"for",`state-target-${ge}`);var De=s(q,2);T(()=>{e(be),Ct(()=>{})}),Ve(De,"id",`state-target-${ge}`);var ve=i(De);ve.value=ve.__value="self";var g=s(ve);g.value=g.__value="other",l(De),l(_e),l(Re);var I=s(Re,2),ee=i(I);Ve(ee,"for",`state-desc-${ge}`);var Y=s(ee,2);je(Y),Ve(Y,"id",`state-desc-${ge}`),l(I),l(F),Je(Te,()=>e(be).name,ne=>(e(be).name=ne,Ct(()=>t()),da($,"$character"))),Je(Ee,()=>e(be).attackBonus,ne=>(e(be).attackBonus=ne,Ct(()=>t()),da($,"$character"))),Je(ce,()=>e(be).damageBonus,ne=>(e(be).damageBonus=ne,Ct(()=>t()),da($,"$character"))),Ca(De,()=>e(be).target,ne=>(e(be).target=ne,Ct(()=>t()),da($,"$character"))),Je(Y,()=>e(be).description,ne=>(e(be).description=ne,Ct(()=>t()),da($,"$character"))),v(ze,F)}),l(u),v(J,u)},pe=J=>{var u=vi();v(J,u)};y(C,J=>{t(),n(()=>t().activeStates&&t().activeStates.length>0)?J(ue):J(pe,!1)})}l(Ke),A("click",M,k),v(h,P)};y(qe,h=>{p(),n(()=>!p().attacks)&&h(we)})}l(B),T(()=>te=St(B,1,"attacks svelte-14o91c5",null,te,{hidden:!e(W)})),v(a,B),It(),S()}var fi=m('<span class="slot-checkbox-x svelte-serp1j">&#8212;</span>'),mi=m('<label><input type="checkbox" class="slot-checkbox-input svelte-serp1j"/> <span><!></span></label>');function es(a,r){Pt(r,!1);const t=()=>tt(Zt,"$isEditMode",o),[o,d]=Wt();let p=yt(r,"checked",8,!1),b=yt(r,"disabled",8,!1),$=yt(r,"className",8,""),S=yt(r,"index",8,void 0),x=yt(r,"ariaLabel",8,void 0);const W=na();function H(U){W("change",{checked:U.currentTarget.checked,index:S()})}Rt();var se=mi(),Q=i(se);je(Q);var Z=s(Q,2),ye=i(Z);{var me=U=>{var le=fi();v(U,le)};y(ye,U=>{p()&&U(me)})}l(Z),l(se),T(()=>{St(se,1,"slot-checkbox-label "+$()+(t()?"":" not-editable"),"svelte-serp1j"),rs(Q,p()),Q.disabled=b()||!t(),Ve(Q,"aria-label",x()),Ve(Q,"tabindex",t()?0:-1),St(Z,1,`slot-checkbox-custom ${p()?"used":""} ${t()?"":"readonly"}`,"svelte-serp1j")}),A("change",Q,H),v(a,se),It(),d()}var hi=m('<p class="no-features svelte-1kpvv0n">Select a class to see available features</p>'),bi=m('<p class="no-features svelte-1kpvv0n">No class features available at this level</p>'),gi=m('<div class="spell-slots svelte-1kpvv0n"><label class="svelte-1kpvv0n"> </label> <div class="slots-tracker svelte-1kpvv0n"></div></div>'),_i=m('<div class="all-spell-slots"></div>'),yi=m('<div class="feature-box spellcasting svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"> </h3> <div class="spell-stats svelte-1kpvv0n"><div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Spell Save DC</label> <div class="spell-value svelte-1kpvv0n"> </div></div> <div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <div class="spell-value svelte-1kpvv0n"> </div></div></div> <!> <div class="prepared-spells svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <textarea placeholder="List your prepared spells..." class="svelte-1kpvv0n"></textarea></div></div>'),xi=m('<p class="unlimited svelte-1kpvv0n">Unlimited Uses</p>'),Si=m('<div class="slots-tracker svelte-1kpvv0n"></div> <div class="uses-actions-row"><button class="btn btn-primary use-enabled"> </button></div> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div>',1),ki=m('<div class="uses-tracker svelte-1kpvv0n"><!></div>'),$i=m('<div class="pool-tracker svelte-1kpvv0n"><input type="number" min="0" class="pool-input svelte-1kpvv0n"/> <span> </span> <button class="btn-small svelte-1kpvv0n"> </button></div>'),Ci=m('<p class="no-uses svelte-1kpvv0n">No Channel Divinity uses remaining</p>'),wi=m('<div class="channel-divinity-option svelte-1kpvv0n"><button class="btn btn-primary use-enabled svelte-1kpvv0n">Use Channel Divinity</button> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div> <!></div>'),Di=m('<div class="feature-box svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"><!> </h3> <p class="feature-description svelte-1kpvv0n"> </p> <!></div>'),Li=m('<div class="features-grid svelte-1kpvv0n"><!> <!></div>'),ji=m("<section><!> <!></section>");function Ai(a,r){Pt(r,!1);const t=()=>tt(ae,"$character",b),o=()=>tt(ha,"$abilityModifiers",b),d=()=>tt(ta,"$searchFilter",b),p=()=>tt(Tt,"$collapsedStates",b),[b,$]=Wt(),S=L(),x=L(),W=L(),H=L(),se=L(),Q=L(),Z=L();let ye=L(0),me=L(0);function U(_,B){ae.update(te=>(te.classFeatures.features[_]=B,te))}function le(){ae.update(_=>(_.classFeatures.spellSlotsByLevel||(_.classFeatures.spellSlotsByLevel={}),e(H).forEach(({level:B,slots:te})=>{_.classFeatures.spellSlotsByLevel[B]||(_.classFeatures.spellSlotsByLevel[B]=Array(te).fill(!1))}),_))}function $e(_){if(typeof _.maxUses=="function"){if((_.name==="Divine Sense"||_.name==="War Priest")&&e(S)?.spellcastingAbility){const B=o()[e(S).spellcastingAbility];return _.maxUses(t().level,B)}return _.maxUses(t().level)}return _.maxUses||0}function he(_,B){ae.update(te=>((!te.classFeatures.features[_]||!Array.isArray(te.classFeatures.features[_])||te.classFeatures.features[_].length!==B)&&(te.classFeatures.features[_]=Array(B).fill(!1)),te))}ms(()=>{e(Q)&&t()&&t().classFeatures&&t().classFeatures.features&&e(Q).forEach(_=>{if(_.type==="uses"){const B=_.name.replace(/\s+/g,""),te=$e(_),Ge=t().classFeatures.features[B];(!Array.isArray(Ge)||Ge.length!==te)&&he(B,te)}})});function Pe(_){return typeof _.maxPool=="function"?_.maxPool(t().level):_.maxPool||0}function Ie(_){return typeof _.description=="function"?_.description(t().level):_.description}function ie(){const _="ChannelDivinity";ae.update(B=>{const te=B.classFeatures.features[_];return typeof te=="number"&&te>0&&(B.classFeatures.features[_]=te-1),B})}function Se(){Tt.update(_=>({..._,classFeatures:!_.classFeatures}))}Qe(()=>(t(),Ht),()=>{c(S,t().class?Ht(t().class):null)}),Qe(()=>(t(),ca),()=>{c(x,t().class?ca(t().class,t().level,t().subclass):[])}),Qe(()=>(t(),Ja),()=>{c(W,t().class?Ja(t().class,t().level):0)}),Qe(()=>(e(S),t()),()=>{c(H,(()=>{if(!e(S)?.spellcaster)return[];const _=t().level,B=[];return _>=1&&B.push({level:1,slots:Math.min(4,2+Math.floor(_/3))}),_>=3&&B.push({level:2,slots:Math.min(3,2+Math.floor((_-3)/4))}),_>=5&&B.push({level:3,slots:Math.min(3,2+Math.floor((_-5)/5))}),_>=7&&B.push({level:4,slots:Math.min(3,1+Math.floor((_-7)/6))}),_>=9&&B.push({level:5,slots:Math.min(2,1+Math.floor((_-9)/8))}),_>=11&&B.push({level:6,slots:1}),_>=13&&B.push({level:7,slots:1}),_>=15&&B.push({level:8,slots:1}),_>=17&&B.push({level:9,slots:1}),B})())}),Qe(()=>(e(S),o(),t(),Ya),()=>{if(e(S)?.spellcaster&&e(S).spellcastingAbility){const _=o()[e(S).spellcastingAbility];c(ye,zs(t().class,_,t().proficiencyBonus)||0),c(me,Ya(t().class,t().level,_))}}),Qe(()=>(t(),e(S),e(H)),()=>{t().class&&e(S)?.spellcaster&&e(H).length>0&&le()}),Qe(()=>t(),()=>{c(se,(()=>{const B=t().classFeatures.features["ChannelDivinity"];return typeof B=="number"?B:0})())}),Qe(()=>(e(x),d()),()=>{c(Q,e(x).filter(_=>{if(!d())return!0;const B=d().toLowerCase();return _.name.toLowerCase().includes(B)||Ie(_).toLowerCase().includes(B)}))}),Qe(()=>(d(),t(),e(Q)),()=>{c(Z,!d()||t().class||"class features".includes(d().toLowerCase())||"spellcasting".includes(d().toLowerCase())||e(Q).length>0)}),Jt(),Rt();var We=ji();let O;var V=i(We);{let _=dt(()=>(p(),n(()=>p().classFeatures?"Expand":"Collapse")));ra(V,{title:"Class Features",get collapsed(){return p(),n(()=>p().classFeatures)},get ariaLabel(){return e(_)},onToggle:Se})}var k=s(V,2);{var re=_=>{var B=rt(),te=Oe(B);{var Ge=we=>{var h=hi();v(we,h)},qe=we=>{var h=rt(),P=Oe(h);{var X=z=>{var ke=bi();v(z,ke)},oe=z=>{var ke=Li(),Me=i(ke);{var st=Ke=>{var M=yi(),C=i(M),ue=i(C);l(C);var pe=s(C,2),J=i(pe),u=s(i(J),2),ze=i(u,!0);l(u),l(J);var be=s(J,2),ge=s(i(be),2),F=i(ge,!0);l(ge),l(be),l(pe);var Fe=s(pe,2);{var Te=Re=>{var Ce=_i();xt(Ce,5,()=>e(H),kt,(Be,Ee)=>{let He=()=>e(Ee).level,Ne=()=>e(Ee).slots;const ce=dt(()=>(t(),He(),Ne(),n(()=>t().classFeatures.spellSlotsByLevel?.[He()]||Array(Ne()).fill(!1))));var _e=gi(),q=i(_e),De=i(q);l(q);var ve=s(q,2);xt(ve,5,()=>e(ce),kt,(g,I,ee)=>{{let Y=dt(()=>(E(e(ce)),n(()=>e(ce)[ee]||!1)));es(g,{get checked(){return e(Y)},$$events:{change:ne=>{ae.update(w=>(w.classFeatures.spellSlotsByLevel||(w.classFeatures.spellSlotsByLevel={}),w.classFeatures.spellSlotsByLevel[He()]||(w.classFeatures.spellSlotsByLevel[He()]=Array(Ne()).fill(!1)),w.classFeatures.spellSlotsByLevel[He()][ee]=ne.detail.checked,w))}}})}}),l(ve),l(_e),T(()=>D(De,`${He()===1?"1st":He()===2?"2nd":He()===3?"3rd":`${He()}th`} Level Spell Slots`)),v(Be,_e)}),l(Ce),v(Re,Ce)};y(Fe,Re=>{e(H),n(()=>e(H).length>0)&&Re(Te)})}var Xe=s(Fe,2),lt=s(i(Xe),2);pa(lt),l(Xe),l(M),T(Re=>{D(ue,`Spellcasting (${Re??""})`),D(ze,e(ye)),D(F,e(me))},[()=>(e(S),n(()=>e(S).spellcastingAbility?.toUpperCase()))]),Je(lt,()=>t().classFeatures.preparedSpells,Re=>_t(ae,n(t).classFeatures.preparedSpells=Re,n(t))),v(Ke,M)};y(Me,Ke=>{e(S),n(()=>e(S)?.spellcaster)&&Ke(st)})}var xe=s(Me,2);xt(xe,1,()=>e(Q),kt,(Ke,M)=>{const C=dt(()=>(e(M),n(()=>e(M).name.replace(/\s+/g,"")))),ue=dt(()=>(t(),E(e(C)),n(()=>t().classFeatures.features[e(C)]))),pe=dt(()=>typeof e(ue)=="number");var J=Di(),u=i(J),ze=i(u);{var be=Re=>{var Ce=Ft("Channel Divinity:");v(Re,Ce)};y(ze,Re=>{e(M),n(()=>e(M).type==="channelDivinity")&&Re(be)})}var ge=s(ze);l(u);var F=s(u,2),Fe=i(F,!0);l(F);var Te=s(F,2);{var Xe=Re=>{const Ce=dt(()=>(e(M),n(()=>$e(e(M))))),Be=dt(()=>(E(e(ue)),E(e(Ce)),n(()=>Array.isArray(e(ue))?e(ue):Array(e(Ce)).fill(!1))));var Ee=ki(),He=i(Ee);{var Ne=_e=>{var q=xi();v(_e,q)},ce=_e=>{var q=Si(),De=Oe(q);xt(De,5,()=>e(Be),kt,(w,R,G)=>{es(w,{get checked(){return e(R)},index:G,$$events:{change:fe=>{ae.update(Ae=>(Ae.classFeatures.features[e(C)]||(Ae.classFeatures.features[e(C)]=Array(e(Ce)).fill(!1)),Ae.classFeatures.features[e(C)][G]=fe.detail.checked,Ae))}}})}),l(De);var ve=s(De,2),g=i(ve),I=i(g);l(g),l(ve);var ee=s(ve,2),Y=i(ee),ne=i(Y);l(Y),l(ee),T(w=>{g.disabled=w,D(I,`Use ${e(M),n(()=>e(M).name)??""}`),D(ne,`Resets on ${e(M),n(()=>e(M).resetOn==="short"?"Short Rest":"Long Rest")??""}`)},[()=>(E(e(Be)),n(()=>e(Be).filter(w=>!w).length<=0))]),A("click",g,()=>{ae.update(w=>{w.classFeatures.features[e(C)]||(w.classFeatures.features[e(C)]=Array(e(Ce)).fill(!1));const R=w.classFeatures.features[e(C)],G=R.findIndex(fe=>!fe);return G!==-1&&(R[G]=!0),w})}),v(_e,q)};y(He,_e=>{e(Ce)===1/0?_e(Ne):_e(ce,!1)})}l(Ee),v(Re,Ee)},lt=Re=>{var Ce=rt(),Be=Oe(Ce);{var Ee=Ne=>{const ce=dt(()=>(e(M),n(()=>Pe(e(M)))));var _e=$i(),q=i(_e);je(q);var De=s(q,2),ve=i(De);l(De);var g=s(De,2),I=i(g,!0);l(g),l(_e),T(()=>{ma(q,e(pe)&&e(ue)!==void 0?e(ue):e(ce)),Ve(q,"max",e(ce)),D(ve,`/ ${e(ce)??""}`),D(I,(e(M),n(()=>e(M).resetOn==="short"?"Short Rest":"Long Rest")))}),A("input",q,ee=>{ae.update(Y=>(Y.classFeatures.features[e(C)]=parseInt(ee.currentTarget.value)||0,Y))}),A("click",g,()=>U(e(C),e(ce))),v(Ne,_e)},He=Ne=>{var ce=rt(),_e=Oe(ce);{var q=De=>{var ve=wi(),g=i(ve),I=s(g,2),ee=i(I),Y=i(ee);l(ee),l(I);var ne=s(I,2);{var w=R=>{var G=Ci();v(R,G)};y(ne,R=>{e(se)<=0&&R(w)})}l(ve),T(()=>{g.disabled=e(se)<=0,D(Y,`Resets on ${e(M),n(()=>e(M).resetOn==="short"?"Short Rest":"Long Rest")??""}`)}),A("click",g,ie),v(De,ve)};y(_e,De=>{e(M),n(()=>e(M).type==="channelDivinity")&&De(q)},!0)}v(Ne,ce)};y(Be,Ne=>{e(M),n(()=>e(M).type==="pool")?Ne(Ee):Ne(He,!1)},!0)}v(Re,Ce)};y(Te,Re=>{e(M),n(()=>e(M).type==="uses")?Re(Xe):Re(lt,!1)})}l(J),T(Re=>{D(ge,` ${e(M),n(()=>e(M).name)??""}`),D(Fe,Re)},[()=>(e(M),n(()=>Ie(e(M))))]),v(Ke,J)}),l(ke),v(z,ke)};y(P,z=>{e(x),n(()=>e(x).length===0)?z(X):z(oe,!1)},!0)}v(we,h)};y(te,we=>{t(),n(()=>!t().class)?we(Ge):we(qe,!1)})}v(_,B)};y(k,_=>{p(),n(()=>!p().classFeatures)&&_(re)})}l(We),T(()=>O=St(We,1,"class-features svelte-1kpvv0n",null,O,{hidden:!e(Z)})),v(a,We),It(),$()}var Bi=m('<textarea placeholder="Enter features, traits, and special abilities..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Equipment</h3> <textarea placeholder="List your equipment and inventory..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Notes</h3> <textarea placeholder="Additional notes..." class="svelte-wttn0l"></textarea>',1),Mi=m("<section><!> <!></section>");function Fi(a,r){Pt(r,!1);const t=()=>tt(ta,"$searchFilter",p),o=()=>tt(ae,"$character",p),d=()=>tt(Tt,"$collapsedStates",p),[p,b]=Wt(),$=L();function S(){Tt.update(Z=>({...Z,notes:!Z.notes}))}Qe(()=>(t(),o()),()=>{c($,!t()||"features".includes(t().toLowerCase())||"traits".includes(t().toLowerCase())||"equipment".includes(t().toLowerCase())||"notes".includes(t().toLowerCase())||o().features.toLowerCase().includes(t().toLowerCase())||o().equipment.toLowerCase().includes(t().toLowerCase())||o().notes.toLowerCase().includes(t().toLowerCase()))}),Jt(),Rt();var x=Mi();let W;var H=i(x);{let Z=dt(()=>(d(),n(()=>d().notes?"Expand":"Collapse")));ra(H,{title:"Features & Traits",get collapsed(){return d(),n(()=>d().notes)},get ariaLabel(){return e(Z)},onToggle:S})}var se=s(H,2);{var Q=Z=>{var ye=Bi(),me=Oe(ye);pa(me);var U=s(me,4);pa(U);var le=s(U,4);pa(le),Je(me,()=>o().features,$e=>_t(ae,n(o).features=$e,n(o))),Je(U,()=>o().equipment,$e=>_t(ae,n(o).equipment=$e,n(o))),Je(le,()=>o().notes,$e=>_t(ae,n(o).notes=$e,n(o))),v(Z,ye)};y(se,Z=>{d(),n(()=>!d().notes)&&Z(Q)})}l(x),T(()=>W=St(x,1,"notes svelte-wttn0l",null,W,{hidden:!e($)})),v(a,x),It(),b()}var Ti=m('<div class="color-picker-section svelte-1r90jgp"><h3 class="svelte-1r90jgp">Dice Colors</h3> <div class="color-inputs svelte-1r90jgp"><div class="color-input-group svelte-1r90jgp"><label for="dice-color" class="svelte-1r90jgp">Dice Color</label> <input type="color" id="dice-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="label-color" class="svelte-1r90jgp">Label Color</label> <input type="color" id="label-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="desk-color" class="svelte-1r90jgp">Background Color</label> <input type="color" id="desk-color" class="svelte-1r90jgp"/></div></div></div>'),Ri=m('<div class="loading svelte-1r90jgp"><p class="svelte-1r90jgp">Loading 3D dice...</p></div>'),Pi=m('<div class="custom-dice-selector svelte-1r90jgp"><h3 class="svelte-1r90jgp">Choose Dice to Roll</h3> <div class="dice-inputs svelte-1r90jgp"><div class="dice-input-group svelte-1r90jgp"><label for="d4" class="svelte-1r90jgp">d4</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d4" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d6" class="svelte-1r90jgp">d6</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d6" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d8" class="svelte-1r90jgp">d8</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d8" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d10" class="svelte-1r90jgp">d10</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d10" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d12" class="svelte-1r90jgp">d12</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d12" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d20" class="svelte-1r90jgp">d20</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d20" min="0" max="10"/></div></div> <div class="dice-controls svelte-1r90jgp"><button class="btn btn-primary use-enabled svelte-1r90jgp"> </button> <button class="btn btn-secondary use-enabled svelte-1r90jgp">Reset</button></div></div>'),Ii=m('<span class="crit-badge svelte-1r90jgp">CRITICAL HIT!</span>'),Ei=m('<span class="crit-badge crit-fail svelte-1r90jgp">CRITICAL MISS!</span>'),Hi=m('<div class="bonus-item svelte-1r90jgp"><span class="bonus-value svelte-1r90jgp"> </span> <span class="bonus-source svelte-1r90jgp"> </span></div>'),Ni=m('<div class="bonus-breakdown svelte-1r90jgp"></div>'),Ui=m('<p class="modifier-text svelte-1r90jgp"> </p>'),Oi=m('<div class="svelte-1r90jgp"><em class="svelte-1r90jgp">No damage is dealt on a critical miss.</em></div>'),Gi=m('<button class="btn btn-follow-up svelte-1r90jgp"> </button>'),qi=m('<button class="btn btn-guided-strike svelte-1r90jgp">‚ö° Use Guided Strike (+10)</button>'),Wi=m('<div class="follow-up-actions svelte-1r90jgp"><!> <!></div>'),zi=m('<div class="result-header svelte-1r90jgp"><h3 class="svelte-1r90jgp"> </h3> <!> <!></div> <div class="result-total svelte-1r90jgp"> </div> <div class="result-details svelte-1r90jgp"><!></div> <!> <!>',1),Ki=m('<div role="button" tabindex="-1"><div class="modal-content svelte-1r90jgp" role="dialog" tabindex="0"><div class="modal-header svelte-1r90jgp"><h2 class="svelte-1r90jgp">Dice Roller</h2> <div class="header-buttons svelte-1r90jgp"><button class="color-btn svelte-1r90jgp" title="Customize dice colors">üé®</button> <button class="close-btn svelte-1r90jgp">√ó</button></div></div> <!> <!> <div class="dice-main-area svelte-1r90jgp"><div class="dice-container svelte-1r90jgp"></div> <!></div> <div><!></div></div></div>');function Vi(a,r){Pt(r,!1);const t=()=>tt(ae,"$character",o),[o,d]=Wt(),p=L(),b=L(),$=L(),S=na();let x=yt(r,"notation",12,""),W=yt(r,"visible",8,!1),H=yt(r,"damageNotation",12,""),se=yt(r,"attackName",12,""),Q=yt(r,"applyHalfDamage",8,!1),Z=yt(r,"bonusBreakdown",28,()=>[]),ye=yt(r,"rollType",12,"other"),me=null,U=L(void 0),le=L(!1),$e=L(""),he=L(null);function Pe(){return e(he)?.resultTotal??null}function Ie(g,I,ee){const Y=[];if(!g||!g.result)return Y;const ne=I.match(/([+-]?\d*d\d+|[+-]?\d+)/g)||[];let w=0;const R=new Set;for(const G of ne){const fe=G.trim();if(!fe)continue;const Ae=fe.match(/([+-]?)(\d*)d(\d+)/);if(Ae){const nt=parseInt(Ae[2]||"1"),K=`${nt}d${Ae[3]}`,vt=ee.findIndex((f,N)=>!R.has(N)&&typeof f.value=="string"&&f.value===K),ft=[];for(let f=0;f<nt&&w<g.result.length;f++)ft.push(g.result[w++]);const gt=vt>=0?ee[vt].source:"base die";vt>=0&&R.add(vt);for(const f of ft)Y.push({display:`${f}`,source:gt})}}for(let G=0;G<ee.length;G++)if(!R.has(G)&&typeof ee[G].value=="number"){const fe=ee[G].value;Y.push({display:fe>=0?`+${fe}`:`${fe}`,source:ee[G].source})}return Y}let ie=L(0),Se=L(0),We=L(0),O=L(0),V=L(0),k=L(0),re=L(0),_=L([]),B=L(!1),te=L(!1),Ge=L(!1),qe=L("#051e0a"),we=L("#ffffff"),h=L("#3a2004"),P=L(!1);function X(g){return g.length===9&&g.startsWith("#")?g.substring(0,7):g}function oe(g,I="ff"){return g.length===7&&g.startsWith("#")?g+I:g}function z(){if(window.DICE&&e(U))try{me&&e(U)&&la(U,e(U).innerHTML="");const g=e(U).clientWidth||500,I=e(U).clientHeight||300;me=new window.DICE.dice_box(e(U),{w:g,h:I}),c(le,!0)}catch(g){console.error("Error initializing dice box:",g)}}va(()=>{const g=Y=>new Promise((ne,w)=>{if(document.querySelector(`script[src="${Y}"]`)){ne(null);return}const G=document.createElement("script");G.src=Y,G.onload=()=>{ne(null)},G.onerror=()=>{console.error(`Failed to load: ${Y}`),w(new Error(`Failed to load ${Y}`))},document.head.appendChild(G)});setTimeout(()=>{g(`${ua}/libs/three.min.js`).then(()=>g(`${ua}/libs/cannon.min.js`)).then(()=>g(`${ua}/libs/teal.js`)).then(()=>g(`${ua}/dice.js`)).then(()=>{if(window.DICE){const Y=window.DICE.getColors();c(qe,X(Y.dice_color)),c(we,X(Y.label_color)),c(h,X(Y.desk_color))}z()}).catch(Y=>{console.error("Failed to load dice libraries:",Y)})},100);const I=()=>{e(le)&&z()},ee=Y=>{W()&&Y.key==="Escape"&&pe()};return window.addEventListener("resize",I),window.addEventListener("keydown",ee),()=>{window.removeEventListener("resize",I),window.removeEventListener("keydown",ee)}});function ke(g,I="other"){if(!me||!e(le))return;c(he,null),c(_,[]),c(B,!1),c(te,!1),I==="damage"&&Z([]),ye(I),c(Ge,!1),me.diceToRoll=g;const ee=ne=>null,Y=ne=>{let w=ne.resultTotal,R=ne.resultString;if(Q()&&(w=Math.floor(w/2),R=R+" (halved)"),c(he,{...ne,resultTotal:w,resultString:R}),console.log("Final roll result:",e(he)),console.log({type:I}),I==="attack"&&ne.result&&ne.result.length>0){const G=ne.result[0];c(B,G===20),c(te,G===1)}if(c(_,[]),console.log("Setting up follow-up actions. Type:",I,"damageNotation:",H(),"isCriticalSuccess:",e(B),"isCriticalFail:",e(te)),I==="attack"&&H())if(e(B)){const G=xe(H());e(_).push({label:`Roll Critical Damage (${G})`,notation:G})}else e(te)||e(_).push({label:`Roll Damage (${H()})`,notation:H()})};me.start_throw(ee,Y)}function Me(){const g=[];e(ie)>0&&g.push(`${e(ie)}d4`),e(Se)>0&&g.push(`${e(Se)}d6`),e(We)>0&&g.push(`${e(We)}d8`),e(O)>0&&g.push(`${e(O)}d10`),e(V)>0&&g.push(`${e(V)}d12`),e(k)>0&&g.push(`${e(k)}d20`);let I=g.join("+")||"1d20";return e(re)!==0&&(I+=e(re)>=0?`+${e(re)}`:`${e(re)}`),I}function st(){const g=Me();ke(g)}function xe(g){return g.replace(/(\d+)d(\d+)/g,(I,ee,Y)=>`${parseInt(ee)*2}d${Y}`)}function Ke(){c(ie,0),c(Se,0),c(We,0),c(O,0),c(V,0),c(k,0),c(re,0),c(he,null),c(_,[]),c(B,!1),c(te,!1),ye("other"),c(Ge,!1)}function M(){window.DICE&&(window.DICE.setColors({dice_color:oe(e(qe),"ff"),label_color:oe(e(we),"ff"),desk_color:e(h)}),me&&(me.updateDeskColor(e(h)),me.updateDiceColors()))}function C(){c(P,!e(P))}function ue(){!e(he)||e(b)<=0||e(Ge)||(c(he,{...e(he),resultTotal:e(he).resultTotal+10,resultString:e(he).resultString+" + 10 (Guided Strike)"}),ae.update(g=>{const I="ChannelDivinity",ee=g.classFeatures.features[I];return typeof ee=="number"&&ee>0&&(g.classFeatures.features[I]=ee-1),g}),c(Ge,!0))}function pe(){S("close"),x(""),H(""),se(""),c($e,""),c(he,null),c(Ge,!1),c(B,!1),c(te,!1),Ke()}Qe(()=>(t(),ca),()=>{c(p,t().class?ca(t().class,t().level,t().subclass).some(I=>I.name==="Guided Strike"):!1)}),Qe(()=>t(),()=>{c(b,(()=>{const I=t().classFeatures.features["ChannelDivinity"];return typeof I=="number"?I:0})())}),Qe(()=>(e(ie),e(Se),e(We),e(O),e(V),e(k),e(re)),()=>{c($,(()=>{const g=[];e(ie)>0&&g.push(`${e(ie)}d4`),e(Se)>0&&g.push(`${e(Se)}d6`),e(We)>0&&g.push(`${e(We)}d8`),e(O)>0&&g.push(`${e(O)}d10`),e(V)>0&&g.push(`${e(V)}d12`),e(k)>0&&g.push(`${e(k)}d20`);let I=g.join("+")||"1d20";return e(re)!==0&&(I+=e(re)>=0?`+${e(re)}`:`${e(re)}`),I})())}),Qe(()=>(E(x()),e(le),E(W()),e($e),E(H()),E(se()),E(ye())),()=>{x()&&e(le)&&W()&&x()!==e($e)&&(c($e,x()),c(he,null),c(_,[]),c(B,!1),c(te,!1),c(Ge,!1),console.log("Auto-roll triggered. notation:",x(),"damageNotation:",H(),"attackName:",se(),"rollType:",ye()),setTimeout(()=>ke(x(),ye()),200))}),Jt();var J={getLastRollTotal:Pe};Rt();var u=Ki();let ze;var be=i(u),ge=i(be),F=s(i(ge),2),Fe=i(F),Te=s(Fe,2);l(F),l(ge);var Xe=s(ge,2);{var lt=g=>{var I=Ti(),ee=s(i(I),2),Y=i(ee),ne=s(i(Y),2);je(ne),l(Y);var w=s(Y,2),R=s(i(w),2);je(R),l(w);var G=s(w,2),fe=s(i(G),2);je(fe),l(G),l(ee),l(I),Je(ne,()=>e(qe),Ae=>c(qe,Ae)),A("change",ne,M),Je(R,()=>e(we),Ae=>c(we,Ae)),A("change",R,M),Je(fe,()=>e(h),Ae=>c(h,Ae)),A("change",fe,M),v(g,I)};y(Xe,g=>{e(P)&&g(lt)})}var Re=s(Xe,2);{var Ce=g=>{var I=Ri();v(g,I)};y(Re,g=>{e(le)||g(Ce)})}var Be=s(Re,2),Ee=i(Be);ka(Ee,g=>c(U,g),()=>e(U));var He=s(Ee,2);{var Ne=g=>{var I=Pi(),ee=s(i(I),2),Y=i(ee),ne=s(i(Y),2);je(ne),l(Y);var w=s(Y,2),R=s(i(w),2);je(R),l(w);var G=s(w,2),fe=s(i(G),2);je(fe),l(G);var Ae=s(G,2),nt=s(i(Ae),2);je(nt),l(Ae);var K=s(Ae,2),vt=s(i(K),2);je(vt),l(K);var ft=s(K,2),gt=s(i(ft),2);je(gt),l(ft),l(ee);var f=s(ee,2),N=i(f),j=i(N);l(N);var Le=s(N,2);l(f),l(I),T(()=>{N.disabled=!e(le),D(j,`Roll ${e($)??""}`)}),Je(ne,()=>e(ie),de=>c(ie,de)),Je(R,()=>e(Se),de=>c(Se,de)),Je(fe,()=>e(We),de=>c(We,de)),Je(nt,()=>e(O),de=>c(O,de)),Je(vt,()=>e(V),de=>c(V,de)),Je(gt,()=>e(k),de=>c(k,de)),A("click",N,st),A("click",Le,Ke),v(g,I)};y(He,g=>{x()||g(Ne)})}l(Be);var ce=s(Be,2);let _e;var q=i(ce);{var De=g=>{var I=zi(),ee=Oe(I),Y=i(ee),ne=i(Y,!0);l(Y);var w=s(Y,2);{var R=Le=>{var de=Ii();v(Le,de)};y(w,Le=>{e(B)&&Le(R)})}var G=s(w,2);{var fe=Le=>{var de=Ei();v(Le,de)};y(G,Le=>{e(te)&&Le(fe)})}l(ee);var Ae=s(ee,2),nt=i(Ae,!0);l(Ae);var K=s(Ae,2),vt=i(K);{var ft=Le=>{var de=rt(),et=Oe(de);{var Ue=Ye=>{var ot=Ni();xt(ot,5,()=>(e(he),E(x()),E(Z()),n(()=>Ie(e(he),x(),Z()))),kt,(it,ct)=>{var ht=Hi(),bt=i(ht),Ze=i(bt,!0);l(bt);var at=s(bt,2),ut=i(at);l(at),l(ht),T(()=>{D(Ze,(e(ct),n(()=>e(ct).display))),D(ut,`(${e(ct),n(()=>e(ct).source)??""})`)}),v(it,ht)}),l(ot),v(Ye,ot)},mt=Ye=>{var ot=rt(),it=Oe(ot);{var ct=ht=>{var bt=Ui(),Ze=i(bt);l(bt),T(()=>D(Ze,`Modifier: ${e(he),n(()=>e(he).constant>=0?"+":"")??""}${e(he),n(()=>e(he).constant)??""}`)),v(ht,bt)};y(it,ht=>{e(he),n(()=>e(he).constant)&&ht(ct)},!0)}v(Ye,ot)};y(et,Ye=>{E(Z()),n(()=>Z().length>0)?Ye(Ue):Ye(mt,!1)})}v(Le,de)};y(vt,Le=>{e(he),E(Z()),n(()=>e(he).constant||Z().length>0)&&Le(ft)})}l(K);var gt=s(K,2);{var f=Le=>{var de=Oi();v(Le,de)};y(gt,Le=>{e(te)&&Le(f)})}var N=s(gt,2);{var j=Le=>{var de=Wi(),et=i(de);xt(et,1,()=>e(_),kt,(Ye,ot)=>{var it=Gi(),ct=i(it,!0);l(it),T(()=>D(ct,(e(ot),n(()=>e(ot).label)))),A("click",it,()=>ke(e(ot).notation,"damage")),v(Ye,it)});var Ue=s(et,2);{var mt=Ye=>{var ot=qi();T(()=>{ot.disabled=e(b)<=0,Ve(ot,"title",e(b)<=0?"No Channel Divinity uses remaining":"Use Channel Divinity to add +10 to this attack roll")}),A("click",ot,ue),v(Ye,ot)};y(Ue,Ye=>{e(p)&&ye()==="attack"&&!e(Ge)&&e(b)>0&&!e(te)&&Ye(mt)})}l(de),v(Le,de)};y(N,Le=>{e(_),e(p),E(ye()),e(Ge),e(b),n(()=>e(_).length>0||e(p)&&ye()==="attack"&&!e(Ge)&&e(b)>0)&&Le(j)})}T(()=>{D(ne,se()?`${se()} - Result`:"Result"),D(nt,(e(he),n(()=>e(he).resultTotal)))}),v(g,I)};y(q,g=>{e(he)&&g(De)})}l(ce),l(be),l(u),T(()=>{ze=St(u,1,"modal-overlay svelte-1r90jgp",null,ze,{hidden:!W()}),_e=St(ce,1,"roll-result svelte-1r90jgp",null,_e,{"has-result":e(he)})}),A("click",Fe,C),A("click",Te,pe),A("click",be,Oa(function(g){oa.call(this,r,g)})),A("keydown",be,function(g){oa.call(this,r,g)}),A("click",u,pe),A("keydown",u,g=>g.key==="Escape"&&pe()),v(a,u),qs(r,"getLastRollTotal",Pe);var ve=It(J);return d(),ve}const La="https://api.github.com/gists";async function Ji(a,r,t){if(!r)throw new Error("GitHub token is required");const o=JSON.stringify(a,null,2),d=`${a.name||"character"}_dnd.json`,p={description:t||`D&D Character: ${a.name}`,public:!1,files:{[d]:{content:o}}},b=await fetch(La,{method:"POST",headers:{Authorization:`token ${r}`,"Content-Type":"application/json"},body:JSON.stringify(p)});if(!b.ok)throw new Error(`Failed to create gist: ${b.statusText}`);return(await b.json()).id}async function Yi(a,r,t){if(!r||!t)throw new Error("GitHub token and Gist ID are required");const o=JSON.stringify(a,null,2),p={files:{[`${a.name||"character"}_dnd.json`]:{content:o}}},b=await fetch(`${La}/${t}`,{method:"PATCH",headers:{Authorization:`token ${r}`,"Content-Type":"application/json"},body:JSON.stringify(p)});if(!b.ok)throw new Error(`Failed to update gist: ${b.statusText}`)}async function Qi(a,r){if(!a)throw new Error("Gist ID is required");const t={"Content-Type":"application/json"};r&&(t.Authorization=`token ${r}`);const o=await fetch(`${La}/${a}`,{method:"GET",headers:t});if(!o.ok)throw new Error(`Failed to load gist: ${o.statusText}`);const d=await o.json(),p=Object.values(d.files);if(p.length===0)throw new Error("No files found in gist");const $=p[0].content;try{const S=JSON.parse($);return S.attacks&&Array.isArray(S.attacks)&&(S.attacks=S.attacks.map(x=>({...x,id:x.id||crypto.randomUUID()}))),S.classFeatures?(S.classFeatures.features||(S.classFeatures.features={}),S.classFeatures.spellSlots||(S.classFeatures.spellSlots=[]),S.classFeatures.preparedSpells===void 0&&(S.classFeatures.preparedSpells="")):S.classFeatures={features:{},spellSlots:[],preparedSpells:""},S}catch{throw new Error("Invalid character data in gist")}}function ts(a){typeof window<"u"&&localStorage.setItem("dnd_gist_config",JSON.stringify(a))}function Xi(){if(typeof window<"u"){const a=localStorage.getItem("dnd_gist_config");if(a)return JSON.parse(a)}return{}}async function Zi(a,r=30){if(!a)throw new Error("GitHub token is required to list gists");const t=await fetch(`${La}?per_page=${r}`,{method:"GET",headers:{Authorization:`token ${a}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error(`Failed to list gists: ${t.statusText}`);return await t.json()}var en=m('<div class="error-message svelte-1jb5ckg"> </div>'),tn=m('<div class="toggle-container svelte-1jb5ckg"><button type="button" class="toggle-btn svelte-1jb5ckg"> </button></div>'),an=m('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID (leave empty to create new)</label> <input type="text" id="gistId" placeholder="Optional: existing Gist ID to update" class="svelte-1jb5ckg"/></div>'),sn=m('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),ln=m('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),nn=m('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Update (or leave unselected to create new)</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),rn=m('<div class="info-message svelte-1jb5ckg">No gists found. A new one will be created.</div>'),on=m('<!> <div class="form-group svelte-1jb5ckg"><label for="description" class="svelte-1jb5ckg"> </label> <input type="text" id="description" placeholder="D&amp;D Character Sheet" class="svelte-1jb5ckg"/></div>',1),cn=m('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID *</label> <input type="text" id="gistId" placeholder="Enter Gist ID (for public or your private gists)" required class="svelte-1jb5ckg"/></div>'),vn=m('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),dn=m('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),un=m('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Load</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),pn=m('<div class="info-message svelte-1jb5ckg">No gists found. Enter a Gist ID manually or create a new one in Save mode.</div>'),fn=m('<div class="modal-overlay svelte-1jb5ckg" role="button" tabindex="-1"><div class="modal-content svelte-1jb5ckg" role="dialog" tabindex="0"><div class="modal-header svelte-1jb5ckg"><h2 class="svelte-1jb5ckg"> </h2> <button class="close-btn svelte-1jb5ckg">√ó</button></div> <div class="modal-body svelte-1jb5ckg"><!> <div class="form-group svelte-1jb5ckg"><label for="token" class="svelte-1jb5ckg"> <a href="https://github.com/settings/tokens" target="_blank" rel="noopener" class="svelte-1jb5ckg">Get token</a></label> <input type="password" id="token" placeholder="ghp_xxxxxxxxxxxxx" class="svelte-1jb5ckg"/></div> <!> <!> <div class="modal-actions svelte-1jb5ckg"><button class="btn btn-primary svelte-1jb5ckg"><!></button> <button class="btn btn-secondary svelte-1jb5ckg">Cancel</button></div></div></div></div>');function mn(a,r){Pt(r,!1);const t=()=>tt(ae,"$character",o),[o,d]=Wt(),p=na();let b=yt(r,"mode",8,"save"),$=L(""),S=L(""),x=L(""),W=L(!1),H=L(""),se=L(!1),Q=L(!1),Z=L([]),ye=L(null);const me=Xi();me.token&&c($,me.token),me.gistId&&c(S,me.gistId),va(async()=>{e($)&&!e(se)&&await U()});async function U(){if(e($)){c(Q,!0),c(H,"");try{c(Z,await Zi(e($))),e(S)&&c(ye,e(Z).find(C=>C.id===e(S))||null)}catch(C){c(H,C.message||"Failed to load gists"),c(Z,[])}finally{c(Q,!1)}}}function le(C){c(ye,C),c(S,C.id)}function $e(){c(se,!e(se)),c(H,""),!e(se)&&e($)&&U()}async function he(){if(!e($)){c(H,"GitHub token is required");return}const C=e(ye)?.id||e(S);c(W,!0),c(H,"");try{if(C)await Yi(t(),e($),C),c(S,C),qt.add("Character updated in Gist successfully!","success");else{const ue=await Ji(t(),e($),e(x));c(S,ue),qt.add(`Character saved to Gist! ID: ${ue}`,"success")}ts({token:e($),gistId:e(S)}),p("close")}catch(ue){c(H,ue.message||"Failed to save to Gist")}finally{c(W,!1)}}async function Pe(){const C=e(ye)?.id||e(S);if(!C){c(H,"Please select a gist or enter a Gist ID");return}c(W,!0),c(H,"");try{const ue=await Qi(C,e($)||void 0);ae.set(ue),c(S,C),ts({token:e($),gistId:e(S)}),qt.add("Character loaded from Gist successfully!","success"),p("close")}catch(ue){c(H,ue.message||"Failed to load from Gist")}finally{c(W,!1)}}function Ie(){p("close")}Rt();var ie=fn(),Se=i(ie),We=i(Se),O=i(We),V=i(O,!0);l(O);var k=s(O,2);l(We);var re=s(We,2),_=i(re);{var B=C=>{var ue=en(),pe=i(ue,!0);l(ue),T(()=>D(pe,e(H))),v(C,ue)};y(_,C=>{e(H)&&C(B)})}var te=s(_,2),Ge=i(te),qe=i(Ge);ia(),l(Ge);var we=s(Ge,2);je(we),l(te);var h=s(te,2);{var P=C=>{var ue=tn(),pe=i(ue),J=i(pe,!0);l(pe),l(ue),T(()=>{pe.disabled=e(W),D(J,e(se)?"üìã Show My Gists":"‚úèÔ∏è Enter Gist ID Manually")}),A("click",pe,$e),v(C,ue)};y(h,C=>{(b()==="load"||b()==="save"&&e($))&&C(P)})}var X=s(h,2);{var oe=C=>{var ue=on(),pe=Oe(ue);{var J=Fe=>{var Te=an(),Xe=s(i(Te),2);je(Xe),l(Te),T(()=>Xe.disabled=e(W)),Je(Xe,()=>e(S),lt=>c(S,lt)),v(Fe,Te)},u=Fe=>{var Te=rt(),Xe=Oe(Te);{var lt=Ce=>{var Be=sn();v(Ce,Be)},Re=Ce=>{var Be=rt(),Ee=Oe(Be);{var He=ce=>{var _e=nn(),q=s(i(_e),2);xt(q,5,()=>e(Z),kt,(De,ve)=>{var g=ln();let I;var ee=i(g),Y=i(ee),ne=i(Y,!0);l(Y);var w=s(Y,2),R=i(w,!0);l(w),l(ee);var G=s(ee,2),fe=i(G),Ae=i(fe);l(fe);var nt=s(fe,2),K=i(nt);l(nt),l(G),l(g),T(vt=>{I=St(g,1,"gist-item svelte-1jb5ckg",null,I,{selected:e(ye)?.id===e(ve).id}),g.disabled=e(W),D(ne,(e(ve),n(()=>e(ve).description||"Untitled"))),D(R,(e(ve),n(()=>e(ve).public?"üåê Public":"üîí Private"))),D(Ae,`ID: ${e(ve),n(()=>e(ve).id)??""}`),D(K,`Updated: ${vt??""}`)},[()=>(e(ve),n(()=>new Date(e(ve).updated_at).toLocaleDateString()))]),A("click",g,()=>le(e(ve))),v(De,g)}),l(q),l(_e),v(ce,_e)},Ne=ce=>{var _e=rt(),q=Oe(_e);{var De=ve=>{var g=rn();v(ve,g)};y(q,ve=>{e($)&&ve(De)},!0)}v(ce,_e)};y(Ee,ce=>{e(Z),n(()=>e(Z).length>0)?ce(He):ce(Ne,!1)},!0)}v(Ce,Be)};y(Xe,Ce=>{e(Q)?Ce(lt):Ce(Re,!1)},!0)}v(Fe,Te)};y(pe,Fe=>{e(se)||!e($)?Fe(J):Fe(u,!1)})}var ze=s(pe,2),be=i(ze),ge=i(be);l(be);var F=s(be,2);je(F),l(ze),T(()=>{D(ge,`Description ${e(S)?"(optional)":""}`),F.disabled=e(W)}),Je(F,()=>e(x),Fe=>c(x,Fe)),v(C,ue)},z=C=>{var ue=rt(),pe=Oe(ue);{var J=ze=>{var be=cn(),ge=s(i(be),2);je(ge),l(be),T(()=>ge.disabled=e(W)),Je(ge,()=>e(S),F=>c(S,F)),v(ze,be)},u=ze=>{var be=rt(),ge=Oe(be);{var F=Te=>{var Xe=vn();v(Te,Xe)},Fe=Te=>{var Xe=rt(),lt=Oe(Xe);{var Re=Be=>{var Ee=un(),He=s(i(Ee),2);xt(He,5,()=>e(Z),kt,(Ne,ce)=>{var _e=dn();let q;var De=i(_e),ve=i(De),g=i(ve,!0);l(ve);var I=s(ve,2),ee=i(I,!0);l(I),l(De);var Y=s(De,2),ne=i(Y),w=i(ne);l(ne);var R=s(ne,2),G=i(R);l(R),l(Y),l(_e),T(fe=>{q=St(_e,1,"gist-item svelte-1jb5ckg",null,q,{selected:e(ye)?.id===e(ce).id}),_e.disabled=e(W),D(g,(e(ce),n(()=>e(ce).description||"Untitled"))),D(ee,(e(ce),n(()=>e(ce).public?"üåê Public":"üîí Private"))),D(w,`ID: ${e(ce),n(()=>e(ce).id)??""}`),D(G,`Updated: ${fe??""}`)},[()=>(e(ce),n(()=>new Date(e(ce).updated_at).toLocaleDateString()))]),A("click",_e,()=>le(e(ce))),v(Ne,_e)}),l(He),l(Ee),v(Be,Ee)},Ce=Be=>{var Ee=rt(),He=Oe(Ee);{var Ne=ce=>{var _e=pn();v(ce,_e)};y(He,ce=>{e($)&&ce(Ne)},!0)}v(Be,Ee)};y(lt,Be=>{e(Z),n(()=>e(Z).length>0)?Be(Re):Be(Ce,!1)},!0)}v(Te,Xe)};y(ge,Te=>{e(Q)?Te(F):Te(Fe,!1)},!0)}v(ze,be)};y(pe,ze=>{e(se)||!e($)?ze(J):ze(u,!1)},!0)}v(C,ue)};y(X,C=>{b()==="save"?C(oe):C(z,!1)})}var ke=s(X,2),Me=i(ke),st=i(Me);{var xe=C=>{var ue=Ft();T(()=>D(ue,b()==="save"?"Saving...":"Loading...")),v(C,ue)},Ke=C=>{var ue=Ft();T(()=>D(ue,b()==="save"?"Save":"Load")),v(C,ue)};y(st,C=>{e(W)?C(xe):C(Ke,!1)})}l(Me);var M=s(Me,2);l(ke),l(re),l(Se),l(ie),T(()=>{D(V,b()==="save"?"Save to GitHub Gist":"Load from GitHub Gist"),D(qe,`GitHub Token ${b()==="load"?"(optional for public gists)":"(required)"} `),we.disabled=e(W),Me.disabled=e(W),M.disabled=e(W)}),A("click",k,Ie),Je(we,()=>e($),C=>c($,C)),A("blur",we,()=>{e($)&&!e(se)&&U()}),A("click",Me,function(...C){(b()==="save"?he:Pe)?.apply(this,C)}),A("click",M,Ie),A("click",Se,Oa(function(C){oa.call(this,r,C)})),A("keydown",Se,function(C){oa.call(this,r,C)}),A("click",ie,Ie),A("keydown",ie,C=>C.key==="Escape"&&Ie()),v(a,ie),It(),d()}var hn=m('<div class="loading svelte-1ngjemu">Loading D&D data...</div>'),bn=m("<option> </option>"),gn=m('<select class="level-filter svelte-1ngjemu"><option>All Levels</option><option>Cantrip</option><!></select>'),_n=m('<div class="no-results svelte-1ngjemu"> </div>'),yn=m('<div class="item-meta svelte-1ngjemu"> </div>'),xn=m('<div class="item-meta svelte-1ngjemu"> </div>'),Sn=m('<button><div class="item-name svelte-1ngjemu"> </div> <!></button>'),kn=m('<p class="higher-levels"><strong>At Higher Levels:</strong> </p>'),$n=m('<p class="cantrip-upgrade"><strong>Cantrip Upgrade:</strong> </p>'),Cn=m('<h3 class="svelte-1ngjemu"> </h3> <p class="spell-meta svelte-1ngjemu"><!> <!></p> <p class="spell-classes"><strong>Classes:</strong> </p> <div class="spell-stats svelte-1ngjemu"><div><strong>Casting Time:</strong> </div> <div><strong>Range:</strong> </div> <div><strong>Components:</strong> <!></div> <div><strong>Duration:</strong> <!> </div></div> <p class="description svelte-1ngjemu"> </p> <!> <!>',1),wn=m('<p class="prerequisite svelte-1ngjemu"><strong>Prerequisite:</strong> </p>'),Dn=m('<h3 class="svelte-1ngjemu"> </h3> <!> <p class="description svelte-1ngjemu"> </p> <a target="_blank" rel="noopener" class="source-link svelte-1ngjemu">View Full Details ‚Üí</a>',1),Ln=m('<div class="item-details svelte-1ngjemu"><!></div>'),jn=m('<div class="controls svelte-1ngjemu"><div class="tabs svelte-1ngjemu"><button> </button> <button> </button></div> <div class="search-controls svelte-1ngjemu"><input type="text" placeholder="Search by name or description..." class="search-input svelte-1ngjemu"/> <!></div></div> <div class="content-container svelte-1ngjemu"><div class="items-list svelte-1ngjemu"><!></div> <!></div>',1),An=m('<div class="modal-backdrop svelte-1ngjemu" role="presentation"><div class="modal svelte-1ngjemu" role="dialog" aria-modal="true" tabindex="-1"><div class="modal-header svelte-1ngjemu"><h2 class="svelte-1ngjemu">Browse D&D Spells & Feats</h2> <button class="close-btn svelte-1ngjemu" aria-label="Close">&times;</button></div> <div class="modal-body svelte-1ngjemu"><!></div> <div class="modal-footer svelte-1ngjemu"><button class="btn-secondary svelte-1ngjemu">Cancel</button> <button class="btn-primary svelte-1ngjemu">Add to Character Sheet</button></div></div></div>');function Bn(a,r){Pt(r,!1);const t=L(),o=L(),d=L();let p=yt(r,"onClose",8),b=L("spell"),$=L(!0),S=L(""),x=L(null),W=L([]),H=L([]),se=L(null);va(async()=>{c($,!0);try{c(W,await ds()),c(H,await $l())}catch(k){console.error("Failed to load data:",k)}finally{c($,!1)}});function Q(k){c(se,k)}function Z(k){const re=k.match(/(\d+d\d+(?:\s*\+\s*\d+)?)/i);return re?re[1]:""}function ye(k){const re=k.split(/\.( |$)/)[0].trim(),_=Array.from(k.matchAll(/\*\*(.*?)\*\*/g)).map(te=>te[1].replace(/\.$/,""));let B=re;return _.length&&(B+=" | Effects: "+_.join(", ")),B}function me(){if(e(se)){if(e(b)==="spell"){const k=e(se);ae.update(re=>{const B=[];k.range&&B.push(`Range: ${k.range}`),k.castingTime&&B.push(`Cast: ${k.castingTime}`),k.duration&&B.push(`Duration: ${k.duration}`),k.actionType==="Save"&&B.push("Saving throw spell"),k.components&&k.components.length>0&&B.push(`Components: ${k.components.join(", ")}`),k.material&&B.push(`Material: ${k.material}`);const te=B.join(" | "),Ge=ye(k.description),qe={id:crypto.randomUUID(),name:`${k.name}${k.concentration?" (C)":""}${k.ritual?" (R)":""}`,bonus:k.actionType==="Attack"?5:0,damage:Z(k.description),damageType:`${k.school} (Lvl ${k.level})`,spellRef:k.name,infoNotes:te,generalNotes:Ge,castAtLevel:k.level};return re.attacks=[...re.attacks,qe],re})}else if(e(b)==="feat"){const k=e(se);ae.update(re=>{const _=`${k.name}${k.prerequisite?` (Req: ${k.prerequisite})`:""}
${k.description}
`;return re.features=re.features?`${re.features}
${_}`:_,re})}c(se,null),p()()}}Qe(()=>(e(x),e(W),e(S)),()=>{c(t,e(x)!==null?Cl(Xa(e(W),e(S)),e(x)):Xa(e(W),e(S)))}),Qe(()=>(e(H),e(S)),()=>{c(o,wl(e(H),e(S)))}),Qe(()=>(e(b),e(t),e(o)),()=>{c(d,e(b)==="spell"?e(t):e(o))}),Jt(),Rt();var U=An(),le=i(U),$e=i(le),he=s(i($e),2);l($e);var Pe=s($e,2),Ie=i(Pe);{var ie=k=>{var re=hn();v(k,re)},Se=k=>{var re=jn(),_=Oe(re),B=i(_),te=i(B);let Ge;var qe=i(te);l(te);var we=s(te,2);let h;var P=i(we);l(we),l(B);var X=s(B,2),oe=i(X);je(oe);var z=s(oe,2);{var ke=pe=>{var J=gn();T(()=>{e(x),Ct(()=>{})});var u=i(J);u.value=(u.__value=null)??"";var ze=s(u);ze.value=ze.__value=0;var be=s(ze);xt(be,0,()=>[1,2,3,4,5,6,7,8,9],kt,(ge,F)=>{var Fe=bn(),Te=i(Fe);l(Fe);var Xe={};T(()=>{D(Te,`Level ${F??""}`),Xe!==(Xe=F)&&(Fe.value=(Fe.__value=F)??"")}),v(ge,Fe)}),l(J),Ca(J,()=>e(x),ge=>c(x,ge)),v(pe,J)};y(z,pe=>{e(b)==="spell"&&pe(ke)})}l(X),l(_);var Me=s(_,2),st=i(Me),xe=i(st);{var Ke=pe=>{var J=_n(),u=i(J);l(J),T(()=>D(u,`No ${e(b)??""}s found`)),v(pe,J)},M=pe=>{var J=rt(),u=Oe(J);xt(u,1,()=>e(d),kt,(ze,be)=>{var ge=Sn();let F;var Fe=i(ge),Te=i(Fe,!0);l(Fe);var Xe=s(Fe,2);{var lt=Ce=>{const Be=dt(()=>e(be));var Ee=yn(),He=i(Ee);l(Ee),T(()=>D(He,`Level ${E(e(Be)),n(()=>e(Be).level)??""} ‚Ä¢ ${E(e(Be)),n(()=>e(Be).school)??""}`)),v(Ce,Ee)},Re=Ce=>{const Be=dt(()=>e(be));var Ee=rt(),He=Oe(Ee);{var Ne=ce=>{var _e=xn(),q=i(_e,!0);l(_e),T(()=>D(q,(E(e(Be)),n(()=>e(Be).prerequisite)))),v(ce,_e)};y(He,ce=>{E(e(Be)),n(()=>e(Be).prerequisite)&&ce(Ne)})}v(Ce,Ee)};y(Xe,Ce=>{e(b)==="spell"?Ce(lt):Ce(Re,!1)})}l(ge),T(()=>{F=St(ge,1,"item-card svelte-1ngjemu",null,F,{selected:e(se)?.name===e(be).name}),D(Te,(e(be),n(()=>e(be).name)))}),A("click",ge,()=>Q(e(be))),v(ze,ge)}),v(pe,J)};y(xe,pe=>{e(d),n(()=>e(d).length===0)?pe(Ke):pe(M,!1)})}l(st);var C=s(st,2);{var ue=pe=>{var J=Ln(),u=i(J);{var ze=ge=>{const F=dt(()=>e(se));var Fe=Cn(),Te=Oe(Fe),Xe=i(Te,!0);l(Te);var lt=s(Te,2),Re=i(lt);{var Ce=f=>{var N=Ft();T(()=>D(N,`${E(e(F)),n(()=>e(F).school)??""} cantrip`)),v(f,N)},Be=f=>{var N=Ft();T(()=>D(N,`Level ${E(e(F)),n(()=>e(F).level)??""} ${E(e(F)),n(()=>e(F).school)??""}`)),v(f,N)};y(Re,f=>{E(e(F)),n(()=>e(F).level===0)?f(Ce):f(Be,!1)})}var Ee=s(Re,2);{var He=f=>{var N=Ft("(ritual)");v(f,N)};y(Ee,f=>{E(e(F)),n(()=>e(F).ritual)&&f(He)})}l(lt);var Ne=s(lt,2),ce=s(i(Ne));l(Ne);var _e=s(Ne,2),q=i(_e),De=s(i(q));l(q);var ve=s(q,2),g=s(i(ve));l(ve);var I=s(ve,2),ee=s(i(I)),Y=s(ee);{var ne=f=>{var N=Ft();T(()=>D(N,`(${E(e(F)),n(()=>e(F).material)??""})`)),v(f,N)};y(Y,f=>{E(e(F)),n(()=>e(F).material)&&f(ne)})}l(I);var w=s(I,2),R=s(i(w),2);{var G=f=>{var N=Ft("Concentration,");v(f,N)};y(R,f=>{E(e(F)),n(()=>e(F).concentration)&&f(G)})}var fe=s(R,1,!0);l(w),l(_e);var Ae=s(_e,2),nt=i(Ae,!0);l(Ae);var K=s(Ae,2);{var vt=f=>{var N=kn(),j=s(i(N));l(N),T(()=>D(j,` ${E(e(F)),n(()=>e(F).higherLevelSlot)??""}`)),v(f,N)};y(K,f=>{E(e(F)),n(()=>e(F).higherLevelSlot)&&f(vt)})}var ft=s(K,2);{var gt=f=>{var N=$n(),j=s(i(N));l(N),T(()=>D(j,` ${E(e(F)),n(()=>e(F).cantripUpgrade)??""}`)),v(f,N)};y(ft,f=>{E(e(F)),n(()=>e(F).cantripUpgrade)&&f(gt)})}T((f,N)=>{D(Xe,(E(e(F)),n(()=>e(F).name))),D(ce,` ${f??""}`),D(De,` ${E(e(F)),n(()=>e(F).castingTime||e(F).actionType)??""}`),D(g,` ${E(e(F)),n(()=>e(F).range)??""}`),D(ee,` ${N??""}`),D(fe,(E(e(F)),n(()=>e(F).duration))),D(nt,(E(e(F)),n(()=>e(F).description)))},[()=>(E(e(F)),n(()=>e(F).classes.join(", "))),()=>(E(e(F)),n(()=>e(F).components.join(", ").toUpperCase()))]),v(ge,Fe)},be=ge=>{const F=dt(()=>e(se));var Fe=Dn(),Te=Oe(Fe),Xe=i(Te,!0);l(Te);var lt=s(Te,2);{var Re=He=>{var Ne=wn(),ce=s(i(Ne));l(Ne),T(()=>D(ce,` ${E(e(F)),n(()=>e(F).prerequisite)??""}`)),v(He,Ne)};y(lt,He=>{E(e(F)),n(()=>e(F).prerequisite)&&He(Re)})}var Ce=s(lt,2),Be=i(Ce,!0);l(Ce);var Ee=s(Ce,2);T(()=>{D(Xe,(E(e(F)),n(()=>e(F).name))),D(Be,(E(e(F)),n(()=>e(F).description))),Ve(Ee,"href",(E(e(F)),n(()=>e(F).source)))}),v(ge,Fe)};y(u,ge=>{e(b)==="spell"?ge(ze):ge(be,!1)})}l(J),v(pe,J)};y(C,pe=>{e(se)&&pe(ue)})}l(Me),T(()=>{Ge=St(te,1,"tab svelte-1ngjemu",null,Ge,{active:e(b)==="spell"}),D(qe,`üìú Spells (${e(W),n(()=>e(W).length)??""})`),h=St(we,1,"tab svelte-1ngjemu",null,h,{active:e(b)==="feat"}),D(P,`‚≠ê Feats (${e(H),n(()=>e(H).length)??""})`)}),A("click",te,()=>{c(b,"spell"),c(se,null),c(S,"")}),A("click",we,()=>{c(b,"feat"),c(se,null),c(S,"")}),Je(oe,()=>e(S),pe=>c(S,pe)),v(k,re)};y(Ie,k=>{e($)?k(ie):k(Se,!1)})}l(Pe);var We=s(Pe,2),O=i(We),V=s(O,2);l(We),l(le),l(U),T(()=>V.disabled=!e(se)),A("click",he,function(...k){p()?.apply(this,k)}),A("click",O,function(...k){p()?.apply(this,k)}),A("click",V,me),A("click",le,Oa(function(k){oa.call(this,r,k)})),A("keydown",le,function(k){oa.call(this,r,k)}),A("click",U,function(...k){p()?.apply(this,k)}),A("keydown",U,k=>k.key==="Escape"&&p()()),v(a,U),It()}var Mn=m('<link rel="icon" type="image/png" href="favicon4.png"/> <meta name="viewport" content="width=device-width, initial-scale=1"/>',1),Fn=m('<span class="character-name svelte-1uha8ag"> </span>'),Tn=m("<span> </span>"),Rn=m('<div class="spell-slots-header svelte-1uha8ag"></div>'),Pn=m("<span> </span><br/>",1),In=m("<span> </span>"),En=m('<span class="effect-tooltip"><strong> </strong><br/> <br/> <!> <!></span>'),Hn=m('<button class="effect-remove-btn svelte-1uha8ag">√ó</button>'),Nn=m('<span class="effect-badge svelte-1uha8ag" tabindex="0"> <!> <!></span>'),Un=m(`<div class="active-effects-header svelte-1uha8ag"></div> <style>.effect-badge {
              position: relative;
            }
            .effect-tooltip {
              position: absolute;
              top: 120%;
              left: 50%;
              transform: translateX(-50%);
              background: #fff;
              color: #222;
              border: 1px solid #a5b4fc;
              border-radius: 6px;
              padding: 8px 12px;
              font-size: 0.95em;
              box-shadow: 0 2px 8px rgba(0, 0, 0, 0.12);
              z-index: 10;
              min-width: 180px;
              max-width: 260px;
              white-space: normal;
              pointer-events: none;
              opacity: 1;
              transition: opacity 0.15s;
            }</style>`,1),On=m('<div class="rest-menu svelte-1uha8ag"><button class="rest-option svelte-1uha8ag">‚òï Short Rest</button> <button class="rest-option svelte-1uha8ag">üõèÔ∏è Long Rest</button></div>'),Gn=m('<div class="container svelte-1uha8ag"><header class="svelte-1uha8ag"><div class="header-top svelte-1uha8ag"><div class="header-title svelte-1uha8ag"><div class="title-row svelte-1uha8ag"><h1 class="svelte-1uha8ag">D&D Character Sheet</h1> <!></div> <!> <!></div> <div class="header-right svelte-1uha8ag"><div class="header-controls svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">üé≤</span><span class="btn-text svelte-1uha8ag">Roll Dice</span></button> <div class="rest-button-container svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">üò¥</span><span class="btn-text svelte-1uha8ag">Rest</span></button> <!></div> <div class="mode-toggle"><button><span class="btn-icon svelte-1uha8ag"> </span><span class="btn-text svelte-1uha8ag"> </span></button></div></div> <div class="header-search svelte-1uha8ag"><input type="text" placeholder="üîç Search..." class="search-input use-enabled svelte-1uha8ag"/></div></div></div> <div class="header-actions svelte-1uha8ag"><button class="btn btn-mode svelte-1uha8ag">üìö Browse Spells & Feats</button> <button class="btn btn-secondary">Save to Gist</button> <button class="btn btn-secondary">Load from Gist</button> <button class="btn btn-secondary">Export JSON</button> <button class="btn btn-secondary">Import JSON</button> <input type="file" accept=".json" style="display: none;"/></div></header> <main class="svelte-1uha8ag"><!> <!> <!> <!> <!> <!> <!></main></div> <!> <!> <!> <!>',1);function Xn(a,r){Pt(r,!1);const t=()=>tt(ae,"$character",p),o=()=>tt(Zt,"$isEditMode",p),d=()=>tt(ta,"$searchFilter",p),[p,b]=Wt();function $(){const f=[],N=t().classFeatures.spellSlotsByLevel||{};for(let j=1;j<=9;j++){const Le=N[j];if(Le&&Le.length>0){const de=Le.length,et=Le.filter(Ue=>Ue).length;f.push({level:j,available:de-et,total:de})}}return f}let S=L(!1),x=L(!1),W=L(!1),H=L("save"),se=L(void 0),Q=L(""),Z=L(""),ye=L(""),me=L(!1),U=L([]),le=L("other"),$e=L(),he=!1,Pe=1,Ie=L(!1),ie=L(null);function Se(f){c(ie,f)}function We(){c(ie,null)}function O(f){c(ie,e(ie)===f?null:f)}function V(){const f=[];ae.update(j=>{const Le=j.hitDice.current;j.hitDice.current=Math.min(j.hitDice.max,j.hitDice.current+Math.max(1,Math.floor(j.hitDice.max/2)));const de=j.hitDice.current-Le;if(de>0&&f.push(`${de} hit ${de===1?"die":"dice"}`),j.class){const et=ca(j.class,j.level,j.subclass);j.classFeatures.features||(j.classFeatures.features={}),et.forEach(Ue=>{if(Ue.resetOn==="short"){const mt=Ue.name.replace(/\s+/g,"");if(Ue.type==="uses"){const Ye=typeof Ue.maxUses=="function"?Ue.maxUses(j.level):Ue.maxUses;j.classFeatures.features[mt]=Array(Ye).fill(!1),f.push(Ue.name)}else if(Ue.type==="pool"){const Ye=typeof Ue.maxPool=="function"?Ue.maxPool(j.level):Ue.maxPool;Ye!==void 0&&(j.classFeatures.features[mt]=Ye,f.push(Ue.name))}}})}return j}),c(Ie,!1);const N=f.length>0?`Short rest taken! Restored: ${f.join(", ")}`:"Short rest taken!";qt.add(N,"success")}function k(){const f=[];ae.update(j=>{const Le=j.maxHP-j.currentHP;Le>0&&f.push(`${Le} HP`),j.currentHP=j.maxHP,j.tempHP=0;const de=j.hitDice.max-j.hitDice.current;de>0&&f.push(`${de} hit ${de===1?"die":"dice"}`),j.hitDice.current=j.hitDice.max;let et=0;if(j.classFeatures.spellSlotsByLevel&&Object.keys(j.classFeatures.spellSlotsByLevel).forEach(Ue=>{const mt=j.classFeatures.spellSlotsByLevel[parseInt(Ue)];if(mt){const Ye=mt.filter(ot=>ot).length;et+=Ye,j.classFeatures.spellSlotsByLevel[parseInt(Ue)]=Array(mt.length).fill(!1)}}),et>0&&f.push(`${et} spell ${et===1?"slot":"slots"}`),j.class){const Ue=ca(j.class,j.level,j.subclass);j.classFeatures.features||(j.classFeatures.features={});let mt=!1;Ue.forEach(Ye=>{const ot=Ye.name.replace(/\s+/g,"");if(!(Ye.type==="info"||Ye.type==="channelDivinity")){if(Ye.type==="uses"){const it=typeof Ye.maxUses=="function"?Ye.maxUses(j.level):Ye.maxUses;j.classFeatures.features[ot]=Array(it).fill(!1),mt=!0}else if(Ye.type==="pool"){const it=typeof Ye.maxPool=="function"?Ye.maxPool(j.level):Ye.maxPool;it!==void 0&&(j.classFeatures.features[ot]=it,mt=!0)}}}),mt&&f.push("all class features")}return j}),c(Ie,!1);const N=f.length>0?`Long rest taken! Restored: ${f.join(", ")}`:"Long rest taken! Fully rested.";qt.add(N,"success")}function re(f){c(Q,""),c(Z,""),c(ye,""),c(me,!1),c(U,[]),c(le,"other"),he=!1,typeof f=="string"?c(Q,f):(c(Q,f.notation),c(Z,f.damageNotation||""),c(ye,f.attackName||""),c(me,!!f.applyHalfDamage),c(U,f.bonusBreakdown||[]),c(le,f.rollType||"other")),c(S,!0)}function _(f){const{notation:N,count:j,bonusBreakdown:Le}=f.detail;c(Q,""),he=!0,Pe=j||1,setTimeout(()=>{c(Q,N),c(Z,""),c(ye,"Hit Die"),c(U,Le||[]),c(le,"other")},0),c(S,!0)}function B(){if(c(S,!1),he&&e($e)){const f=e($e).getLastRollTotal();if(f!==null){const N=Math.max(1,f);ae.update(j=>(j.hitDice.current=Math.max(0,j.hitDice.current-Pe),j.currentHP=Math.min(j.maxHP,j.currentHP+N),j))}he=!1}}function te(){Zt.update(f=>!f)}function Ge(f){f.target.closest(".rest-button-container")||c(Ie,!1)}va(()=>{const f=Zt.subscribe(N=>{N?document.body.classList.remove("use-mode"):document.body.classList.add("use-mode")});return document.addEventListener("click",Ge),()=>{f(),document.removeEventListener("click",Ge)}});function qe(){Rs(t())}function we(){e(se)?.click()}async function h(f){const j=f.target.files?.[0];if(j)try{const Le=await Ps(j);ae.set(Le),alert("Character imported successfully!")}catch{alert("Failed to import character file")}}Rt();var P=Gn();Fs("1uha8ag",f=>{var N=Mn();ia(2),ls(()=>{Bs.title="D&D Character Sheet"}),v(f,N)});var X=Oe(P),oe=i(X),z=i(oe),ke=i(z),Me=i(ke),st=s(i(Me),2);{var xe=f=>{var N=Fn(),j=i(N);l(N),T(()=>D(j,`${t().name??""} (${t().level??""})`)),v(f,N)};y(st,f=>{t().name&&f(xe)})}l(Me);var Ke=s(Me,2);{var M=f=>{var N=Rn();xt(N,5,$,kt,(j,Le)=>{var de=Tn();let et;var Ue=i(de);l(de),T(()=>{et=St(de,1,"slot-badge svelte-1uha8ag",null,et,{depleted:e(Le).available===0}),D(Ue,`Lv${e(Le).level??""}: ${e(Le).available??""}/${e(Le).total??""}`)}),v(j,de)}),l(N),v(f,N)};y(Ke,f=>{$().length>0&&f(M)})}var C=s(Ke,2);{var ue=f=>{var N=Un(),j=Oe(N);xt(j,5,()=>t().activeStates,kt,(Le,de,et)=>{var Ue=Nn(),mt=i(Ue),Ye=s(mt);{var ot=ht=>{var bt=En(),Ze=i(bt),at=i(Ze,!0);l(Ze);var ut=s(Ze,2),wt=s(ut,3);{var Nt=Dt=>{var Lt=Pn(),Ot=Oe(Lt),pt=i(Ot);l(Ot),ia(),T(()=>D(pt,`Attack Bonus: ${typeof e(de).attackBonus=="number"&&e(de).attackBonus>0?"+":""}${e(de).attackBonus??""}`)),v(Dt,Lt)};y(wt,Dt=>{e(de).attackBonus&&Dt(Nt)})}var Ut=s(wt,2);{var Bt=Dt=>{var Lt=In(),Ot=i(Lt);l(Lt),T(()=>D(Ot,`Damage Bonus: ${typeof e(de).damageBonus=="number"&&e(de).damageBonus>0?"+":""}${e(de).damageBonus??""}`)),v(Dt,Lt)};y(Ut,Dt=>{e(de).damageBonus&&Dt(Bt)})}l(bt),T(()=>{D(at,e(de).name),D(ut,` ${e(de).description??""}`)}),v(ht,bt)};y(Ye,ht=>{e(ie)===et&&ht(ot)})}var it=s(Ye,2);{var ct=ht=>{var bt=Hn();T(()=>Ve(bt,"title",`End ${e(de).name??""}`)),A("click",bt,()=>{ae.update(Ze=>{if(Ze.activeStates){const at=Ze.activeStates[et];at?.hpBonus&&at.target!=="other"&&(Ze.maxHP-=at.hpBonus,Ze.currentHP=Math.max(1,Math.min(Ze.currentHP-at.hpBonus,Ze.maxHP))),Ze.activeStates=Ze.activeStates.filter((ut,wt)=>wt!==et)}return Ze})}),v(ht,bt)};y(it,ht=>{o()||ht(ct)})}l(Ue),T(()=>{Ve(Ue,"aria-label",e(de).name),D(mt,`‚ú® ${e(de).name??""} `)}),A("mouseenter",Ue,()=>Se(et)),A("mouseleave",Ue,We),A("focus",Ue,()=>Se(et)),A("blur",Ue,We),A("click",Ue,()=>O(et)),v(Le,Ue)}),l(j),ia(2),v(f,N)};y(C,f=>{t().activeStates&&t().activeStates.length>0&&f(ue)})}l(ke);var pe=s(ke,2),J=i(pe),u=i(J),ze=s(u,2),be=i(ze),ge=s(be,2);{var F=f=>{var N=On(),j=i(N),Le=s(j,2);l(N),A("click",j,V),A("click",Le,k),v(f,N)};y(ge,f=>{e(Ie)&&f(F)})}l(ze);var Fe=s(ze,2),Te=i(Fe);let Xe;var lt=i(Te),Re=i(lt,!0);l(lt);var Ce=s(lt),Be=i(Ce,!0);l(Ce),l(Te),l(Fe),l(J);var Ee=s(J,2),He=i(Ee);je(He),l(Ee),l(pe),l(z);var Ne=s(z,2),ce=i(Ne),_e=s(ce,2),q=s(_e,2),De=s(q,2),ve=s(De,2),g=s(ve,2);ka(g,f=>c(se,f),()=>e(se)),l(Ne),l(oe);var I=s(oe,2),ee=i(I);el(ee,{});var Y=s(ee,2);ll(Y,{$$events:{roll:f=>re(f.detail)}});var ne=s(Y,2);kl(ne,{$$events:{roll:f=>re(f.detail)}});var w=s(ne,2);_l(w,{$$events:{rollHitDice:_}});var R=s(w,2);pi(R,{$$events:{roll:f=>re(f.detail)}});var G=s(R,2);Ai(G,{});var fe=s(G,2);Fi(fe,{}),l(I),l(X);var Ae=s(X,2);ka(Vi(Ae,{get notation(){return e(Q)},get damageNotation(){return e(Z)},get attackName(){return e(ye)},get applyHalfDamage(){return e(me)},get bonusBreakdown(){return e(U)},get rollType(){return e(le)},get visible(){return e(S)},$$events:{close:B},$$legacy:!0}),f=>c($e,f),()=>e($e));var nt=s(Ae,2);{var K=f=>{mn(f,{get mode(){return e(H)},$$events:{close:()=>c(x,!1)}})};y(nt,f=>{e(x)&&f(K)})}var vt=s(nt,2);{var ft=f=>{Bn(f,{onClose:()=>c(W,!1)})};y(vt,f=>{e(W)&&f(ft)})}var gt=s(vt,2);Ts(gt,{}),T(()=>{Xe=St(Te,1,"btn btn-mode svelte-1uha8ag",null,Xe,{"use-mode":!o()}),D(Re,o()?"üìù":"üé≤"),D(Be,o()?"Edit Mode":"Use Mode")}),A("click",u,()=>{c(U,[]),c(S,!0)}),A("click",be,()=>c(Ie,!e(Ie))),A("click",Te,te),Je(He,d,f=>Is(ta,f)),A("click",ce,()=>c(W,!0)),A("click",_e,()=>{c(H,"save"),c(x,!0)}),A("click",q,()=>{c(H,"load"),c(x,!0)}),A("click",De,qe),A("click",ve,we),A("change",g,h),v(a,P),It(),b()}export{Xn as component};
