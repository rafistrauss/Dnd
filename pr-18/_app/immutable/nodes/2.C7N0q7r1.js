import{f,e as F,a as c,s as L,c as nt,t as Mt}from"../chunks/DBs_ODQp.js";import{i as Pt}from"../chunks/BbaRvQ4Z.js";import{c as sa,o as pa,a as rs}from"../chunks/CHX4V4AM.js";import{a7 as Ia,i as Qa,aZ as is,a_ as Ya,a$ as ka,K as Xt,e as Xa,b0 as Za,T as fa,b1 as ns,b2 as os,b3 as cs,q as Da,b4 as vs,b5 as ds,ab as us,d as i,r as Pa,g as ps,C as Tt,F as R,G as Et,H as r,I as l,J as s,b6 as Ze,b7 as Jt,s as o,a4 as M,f as e,m as ot,E as He,A as E,b8 as aa,b9 as wt,ba as da,ao as ra,bb as fs}from"../chunks/DwmZeGF1.js";import{c as Rt,a as se,e as _t,i as kt,u as es,s as Zt,b as ht,d as ga,f as ia,g as gs,t as Ot,h as ms,T as bs,j as hs,k as _s}from"../chunks/DQJFtNtV.js";import{i as y,s as Wt,a as tt,b as bt,d as ca,e as ys}from"../chunks/0ovU14Ao.js";import{p as yt,b as ja}from"../chunks/CFUzmRYW.js";import{b as va,r as ks}from"../chunks/CmizZSU1.js";function _a(a,n,t=!1){if(a.multiple){if(n==null)return;if(!Qa(n))return is();for(var d of a.options)d.selected=n.includes(ua(d));return}for(d of a.options){var p=ua(d);if(Ya(p,n)){d.selected=!0;return}}(!t||n!==void 0)&&(a.selectedIndex=-1)}function Aa(a){var n=new MutationObserver(()=>{_a(a,a.__value)});n.observe(a,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Ia(()=>{n.disconnect()})}function Ba(a,n,t=n){var d=new WeakSet,p=!0;ka(a,"change",m=>{var b=m?"[selected]":":checked",w;if(a.multiple)w=[].map.call(a.querySelectorAll(b),ua);else{var k=a.querySelector(b)??a.querySelector("option:not([disabled])");w=k&&ua(k)}t(w),Xt!==null&&d.add(Xt)}),Xa(()=>{var m=n();if(a===document.activeElement){var b=Za??Xt;if(d.has(b))return}if(_a(a,m,p),p&&m===void 0){var w=a.querySelector(":checked");w!==null&&(m=ua(w),t(m))}a.__value=m,p=!1}),Aa(a)}function ua(a){return"__value"in a?a.__value:a.value}const Ss=Symbol("is custom element"),xs=Symbol("is html");function xe(a){if(fa){var n=!1,t=()=>{if(!n){if(n=!0,a.hasAttribute("value")){var d=a.value;Ke(a,"value",null),a.value=d}if(a.hasAttribute("checked")){var p=a.checked;Ke(a,"checked",null),a.checked=p}}};a.__on_r=t,Da(t),vs()}}function ya(a,n){var t=Ta(a);t.value===(t.value=n??void 0)||a.value===n&&(n!==0||a.nodeName!=="PROGRESS")||(a.value=n??"")}function ts(a,n){var t=Ta(a);t.checked!==(t.checked=n??void 0)&&(a.checked=n)}function Ke(a,n,t,d){var p=Ta(a);fa&&(p[n]=a.getAttribute(n),n==="src"||n==="srcset"||n==="href"&&a.nodeName==="LINK")||p[n]!==(p[n]=t)&&(n==="loading"&&(a[ns]=t),t==null?a.removeAttribute(n):typeof t!="string"&&$s(a).includes(n)?a[n]=t:a.setAttribute(n,t))}function Ta(a){return a.__attributes??={[Ss]:a.nodeName.includes("-"),[xs]:a.namespaceURI===os}}var Ha=new Map;function $s(a){var n=a.getAttribute("is")||a.nodeName,t=Ha.get(n);if(t)return t;Ha.set(n,t=[]);for(var d,p=a,m=Element.prototype;m!==p;){d=ds(p);for(var b in d)d[b].set&&t.push(b);p=cs(p)}return t}function Ee(a,n,t=n){var d=new WeakSet;ka(a,"input",async p=>{var m=p?a.defaultValue:a.value;if(m=$a(a)?Ca(m):m,t(m),Xt!==null&&d.add(Xt),await us(),m!==(m=n())){var b=a.selectionStart,w=a.selectionEnd,k=a.value.length;if(a.value=m??"",w!==null){var S=a.value.length;b===w&&w===k&&S>k?(a.selectionStart=S,a.selectionEnd=S):(a.selectionStart=b,a.selectionEnd=Math.min(w,S))}}}),(fa&&a.defaultValue!==a.value||i(n)==null&&a.value)&&(t($a(a)?Ca(a.value):a.value),Xt!==null&&d.add(Xt)),Pa(()=>{var p=n();if(a===document.activeElement){var m=Za??Xt;if(d.has(m))return}$a(a)&&p===Ca(a.value)||a.type==="date"&&!p&&!a.value||p!==a.value&&(a.value=p??"")})}const xa=new Set;function Ua(a,n,t,d,p=d){var m=t.getAttribute("type")==="checkbox",b=a;let w=!1;if(n!==null)for(var k of n)b=b[k]??=[];b.push(t),ka(t,"change",()=>{var S=t.__value;m&&(S=Na(b,S,t.checked)),p(S)},()=>p(m?[]:null)),Pa(()=>{var S=d();if(fa&&t.defaultChecked!==t.checked){w=!0;return}m?(S=S||[],t.checked=S.includes(t.__value)):t.checked=Ya(t.__value,S)}),Ia(()=>{var S=b.indexOf(t);S!==-1&&b.splice(S,1)}),xa.has(b)||(xa.add(b),Da(()=>{b.sort((S,X)=>S.compareDocumentPosition(X)===4?-1:1),xa.delete(b)})),Da(()=>{if(w){var S;if(m)S=Na(b,S,t.checked);else{var X=b.find(z=>z.checked);S=X?.__value}p(S)}})}function Fa(a,n,t=n){ka(a,"change",d=>{var p=d?a.defaultChecked:a.checked;t(p)}),(fa&&a.defaultChecked!==a.checked||i(n)==null)&&t(a.checked),Pa(()=>{var d=n();a.checked=!!d})}function Na(a,n,t){for(var d=new Set,p=0;p<a.length;p+=1)a[p].checked&&d.add(a[p].__value);return t||d.delete(n),Array.from(d)}function $a(a){var n=a.type;return n==="number"||n==="range"}function Ca(a){return a===""?null:+a}function Cs(a,n,t){var d=ps(a,n);d&&d.set&&(a[n]=t,Ia(()=>{a[n]=null}))}function Ea(a){return function(...n){var t=n[0];return t.stopPropagation(),a?.apply(this,n)}}function na(a,n){var t=a.$$events?.[n.type],d=Qa(t)?t.slice():t==null?[]:[t];for(var p of d)p.call(this,n)}const Ls="";function as(...a){return va+Ls+ks(a[0],a[1])}const Ma={paladin:{name:"Paladin",hitDice:"d10",spellcaster:!0,spellcastingAbility:"charisma",spellSlotsByLevel:{1:0,2:2,3:3,4:3,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Divine Sense",type:"uses",maxUses:(a,n=1)=>1+Math.max(1,n),resetOn:"long",description:"Detect celestials, fiends, and undead within 60 feet",minLevel:1},{name:"Lay on Hands",type:"pool",maxPool:a=>a*5,resetOn:"long",description:"Heal wounds or cure disease",minLevel:1},{name:"Divine Smite",type:"spellSlot",description:"Expend spell slot to deal extra radiant damage",minLevel:2,rollable:!0},{name:"Channel Divinity",type:"pool",maxPool:a=>a>=18?3:a>=6?2:1,resetOn:"short",description:"Sacred Weapon or Turn Undead",minLevel:3}]},fighter:{name:"Fighter",hitDice:"d10",spellcaster:!1,features:[{name:"Second Wind",type:"uses",maxUses:1,resetOn:"short",description:"Regain 1d10 + fighter level HP as bonus action",minLevel:1,rollable:!0,rollFormula:a=>`1d10+${a}`},{name:"Action Surge",type:"uses",maxUses:a=>a>=17?2:1,resetOn:"short",description:"Take one additional action on your turn",minLevel:2},{name:"Indomitable",type:"uses",maxUses:a=>a>=17?3:a>=13?2:1,resetOn:"long",description:"Reroll a failed saving throw",minLevel:9}],subclasses:{champion:{name:"Champion",features:[{name:"Improved Critical",type:"info",description:"Critical hit on 19-20",minLevel:3},{name:"Remarkable Athlete",type:"info",description:"Add half proficiency to STR/DEX/CON checks, increase long jump distance",minLevel:7},{name:"Additional Fighting Style",type:"info",description:"Choose a second fighting style",minLevel:10},{name:"Superior Critical",type:"info",description:"Critical hit on 18-20",minLevel:15},{name:"Survivor",type:"info",description:"Regain 5 + CON mod HP at start of turn if below half HP",minLevel:18}]},battlemaster:{name:"Battle Master",features:[{name:"Combat Superiority",type:"uses",maxUses:a=>a>=15?6:a>=7?5:4,resetOn:"short",description:a=>`Use superiority dice (${a>=18?"d12":a>=10?"d10":"d8"}) for maneuvers`,minLevel:3},{name:"Know Your Enemy",type:"info",description:"Learn capabilities of creatures you observe",minLevel:7},{name:"Improved Combat Superiority",type:"info",description:"Superiority dice become d10",minLevel:10},{name:"Relentless",type:"info",description:"Regain 1 superiority die if you have none at start of turn",minLevel:15}]}}},rogue:{name:"Rogue",hitDice:"d8",spellcaster:!1,features:[{name:"Sneak Attack",type:"info",description:a=>`Deal ${Math.ceil(a/2)}d6 extra damage once per turn with advantage or ally nearby`,minLevel:1,rollable:!0,rollFormula:a=>`${Math.ceil(a/2)}d6`},{name:"Cunning Action",type:"info",description:"Dash, Disengage, or Hide as a bonus action",minLevel:2},{name:"Uncanny Dodge",type:"info",description:"Use reaction to halve damage from an attack",minLevel:5},{name:"Evasion",type:"info",description:"Take no damage on successful Dex save (half on fail)",minLevel:7}]},wizard:{name:"Wizard",hitDice:"d6",spellcaster:!0,spellcastingAbility:"intelligence",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Arcane Recovery",type:"uses",maxUses:1,resetOn:"long",description:a=>`Recover spell slots totaling up to ${Math.ceil(a/2)} levels during short rest`,minLevel:1},{name:"Spell Mastery",type:"info",description:"Cast one 1st-level and one 2nd-level spell at will",minLevel:18}]},cleric:{name:"Cleric",hitDice:"d8",spellcaster:!0,spellcastingAbility:"wisdom",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Channel Divinity",type:"pool",maxPool:a=>a>=18?3:a>=6?2:1,resetOn:"short",description:"Turn Undead or domain-specific ability",minLevel:2},{name:"Destroy Undead",type:"info",description:a=>`Channel Divinity destroys undead of CR ${a>=17?4:a>=14?3:a>=11?2:a>=8?1:.5} or lower`,minLevel:5},{name:"Divine Intervention",type:"uses",maxUses:1,resetOn:"long",description:a=>`${a}% chance to succeed, implore deity for aid`,minLevel:10}],subclasses:{war:{name:"War Domain",features:[{name:"War Priest",type:"uses",maxUses:(a,n=1)=>Math.max(1,n),resetOn:"long",description:"Make one weapon attack as a bonus action",minLevel:1},{name:"Guided Strike",type:"channelDivinity",description:"Use your Channel Divinity to gain +10 to an attack roll. Make this choice after you see the roll, but before the DM says whether the attack hits or misses.",minLevel:2,resetOn:"short"},{name:"War God's Blessing",type:"channelDivinity",description:"Use reaction to grant +10 to an ally's attack roll within 30 feet. Consumes one use of Channel Divinity.",minLevel:6,resetOn:"short"},{name:"Divine Strike",type:"info",description:a=>`Deal extra ${a>=14?"2d8":"1d8"} weapon damage once per turn`,minLevel:8,rollable:!0,rollFormula:a=>a>=14?"2d8":"1d8"},{name:"Avatar of Battle",type:"info",description:"Gain resistance to nonmagical weapon damage",minLevel:17}]},life:{name:"Life Domain",features:[{name:"Disciple of Life",type:"info",description:"Healing spells restore additional 2 + spell level HP",minLevel:1},{name:"Preserve Life",type:"pool",maxPool:a=>a*5,resetOn:"short",description:"Restore HP to creatures within 30 feet",minLevel:2},{name:"Blessed Healer",type:"info",description:"Regain 2 + spell level HP when you cast healing spell",minLevel:6},{name:"Divine Strike",type:"info",description:a=>`Deal extra ${a>=14?"2d8":"1d8"} radiant damage once per turn`,minLevel:8,rollable:!0,rollFormula:a=>a>=14?"2d8":"1d8"},{name:"Supreme Healing",type:"info",description:"Maximize healing dice instead of rolling",minLevel:17}]}}},barbarian:{name:"Barbarian",hitDice:"d12",spellcaster:!1,features:[{name:"Rage",type:"uses",maxUses:a=>a>=20?1/0:a>=17?6:a>=12?5:a>=6?4:a>=3?3:2,resetOn:"long",description:a=>`+${a>=16?4:a>=9?3:2} damage, resistance to physical damage`,minLevel:1},{name:"Reckless Attack",type:"info",description:"Gain advantage on melee attacks, enemies get advantage on you",minLevel:2},{name:"Danger Sense",type:"info",description:"Advantage on Dex saves against effects you can see",minLevel:2}],subclasses:{berserker:{name:"Path of the Berserker",features:[{name:"Frenzy",type:"info",description:"While raging, make melee attack as bonus action (gain 1 exhaustion after rage)",minLevel:3},{name:"Mindless Rage",type:"info",description:"Cannot be charmed or frightened while raging",minLevel:6},{name:"Intimidating Presence",type:"info",description:"Use action to frighten creature within 30 feet",minLevel:10},{name:"Retaliation",type:"info",description:"When damaged by creature within 5 feet, make melee attack as reaction",minLevel:14}]}}}};function qt(a){const n=a.toLowerCase();return Ma[n]||null}function oa(a,n,t){const d=qt(a);if(!d)return[];const p=d.features.filter(m=>!m.minLevel||m.minLevel<=n);if(t&&d.subclasses&&d.subclasses[t]){const m=d.subclasses[t].features.filter(b=>!b.minLevel||b.minLevel<=n);return[...p,...m]}return p}function Ga(a){const n=qt(a);return!n||!n.subclasses?[]:Object.keys(n.subclasses).map(t=>({id:t,name:n.subclasses[t].name}))}function Oa(a,n){const t=qt(a);return!t||!t.spellcaster||!t.spellSlotsByLevel?0:t.spellSlotsByLevel[n]||0}function qa(a,n,t){const d=qt(a);return!d||!d.spellcaster?0:Math.max(1,t+n)}function ws(a,n,t){const d=qt(a);return!d||!d.spellcaster?null:8+n+t}function Ds(){return Object.keys(Ma).map(a=>({id:a,name:Ma[a].name}))}var js=f('<div class="section-header svelte-ls99y2" role="button" tabindex="0"><h2 class="svelte-ls99y2"> </h2> <span class="collapse-btn svelte-ls99y2"> </span></div>');function la(a,n){Tt(n,!1);let t=yt(n,"title",8),d=yt(n,"collapsed",8),p=yt(n,"ariaLabel",8,""),m=yt(n,"onToggle",8);Pt();var b=js(),w=r(b),k=r(w,!0);l(w);var S=s(w,2),X=r(S,!0);l(S),l(b),R(()=>{Ke(b,"aria-expanded",!d()),Ke(b,"aria-label",p()),L(k,t()),L(X,d()?"â–¼":"â–²")}),F("click",b,function(...z){m()?.apply(this,z)}),F("keydown",b,z=>{(z.key==="Enter"||z.key===" ")&&m()()}),c(a,b),Et()}var As=f("<option> </option>"),Bs=f("<option> </option>"),Fs=f('<div class="form-group svelte-172i2fj"><label for="characterSubclass" class="svelte-172i2fj">Subclass</label> <select id="characterSubclass" class="svelte-172i2fj"><option>Select Subclass</option><!></select></div>'),Ms=f('<div class="info-grid svelte-172i2fj"><div class="form-group svelte-172i2fj"><label for="characterName" class="svelte-172i2fj">Character Name</label> <input type="text" id="characterName" placeholder="Enter name" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterClass" class="svelte-172i2fj">Class</label> <select id="characterClass" class="svelte-172i2fj"><option>Select Class</option><!></select></div> <!> <div class="form-group svelte-172i2fj"><label for="characterLevel" class="svelte-172i2fj">Level</label> <input type="number" id="characterLevel" min="1" max="20" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterRace" class="svelte-172i2fj">Race</label> <input type="text" id="characterRace" placeholder="e.g., Human" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterBackground" class="svelte-172i2fj">Background</label> <input type="text" id="characterBackground" placeholder="e.g., Soldier" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterAlignment" class="svelte-172i2fj">Alignment</label> <input type="text" id="characterAlignment" placeholder="e.g., Lawful Good" class="svelte-172i2fj"/></div></div>'),Rs=f('<section class="character-info svelte-172i2fj"><!> <!></section>');function Is(a,n){Tt(n,!1);const t=()=>tt(se,"$character",p),d=()=>tt(Rt,"$collapsedStates",p),[p,m]=Wt(),b=M(),w=Ds();function k(re){const be=re.target;se.update(Z=>(Z.class=be.value,Z.subclass="",Z))}function S(re){const be=re.target;se.update(Z=>(Z.subclass=be.value,Z))}function X(re){const be=re.target;se.update(Z=>(Z.level=parseInt(be.value)||1,Z)),es()}Ze(()=>(t(),Ga),()=>{o(b,t().class?Ga(t().class):[])}),Jt(),Pt();var z=Rs(),le=r(z);{let re=ot(()=>(d(),i(()=>d().characterInfo?"Expand":"Collapse")));la(le,{title:"Character Info",get collapsed(){return d(),i(()=>d().characterInfo)},get ariaLabel(){return e(re)},onToggle:()=>Rt.update(be=>({...be,characterInfo:!be.characterInfo}))})}var ce=s(le,2);{var U=re=>{var be=Ms(),Z=r(be),Ue=s(r(Z),2);xe(Ue),l(Z);var Ve=s(Z,2),W=s(r(Ve),2),at=r(W);at.value=at.__value="";var Se=s(at);_t(Se,1,()=>w,kt,(Je,Ie)=>{var g=As(),$=r(g,!0);l(g);var J={};R(()=>{L($,(e(Ie),i(()=>e(Ie).name))),J!==(J=(e(Ie),i(()=>e(Ie).id)))&&(g.value=(g.__value=(e(Ie),i(()=>e(Ie).id)))??"")}),c(Je,g)}),l(W);var G;Aa(W),l(Ve);var ie=s(Ve,2);{var Ce=Je=>{var Ie=Fs(),g=s(r(Ie),2),$=r(g);$.value=$.__value="";var J=s($);_t(J,1,()=>e(b),kt,(O,_e)=>{var Ge=Bs(),st=r(Ge,!0);l(Ge);var ye={};R(()=>{L(st,(e(_e),i(()=>e(_e).name))),ye!==(ye=(e(_e),i(()=>e(_e).id)))&&(Ge.value=(Ge.__value=(e(_e),i(()=>e(_e).id)))??"")}),c(O,Ge)}),l(g);var de;Aa(g),l(Ie),R(()=>{de!==(de=(t(),i(()=>t().subclass)))&&(g.value=(g.__value=(t(),i(()=>t().subclass)))??"",_a(g,(t(),i(()=>t().subclass))))}),F("change",g,S),c(Je,Ie)};y(ie,Je=>{e(b),i(()=>e(b).length>0)&&Je(Ce)})}var he=s(ie,2),Fe=s(r(he),2);xe(Fe),l(he);var A=s(he,2),ve=s(r(A),2);xe(ve),l(A);var h=s(A,2),P=s(r(h),2);xe(P),l(h);var Q=s(h,2),Ne=s(r(Q),2);xe(Ne),l(Q),l(be),R(()=>{G!==(G=(t(),i(()=>t().class)))&&(W.value=(W.__value=(t(),i(()=>t().class)))??"",_a(W,(t(),i(()=>t().class)))),ya(Fe,(t(),i(()=>t().level)))}),Ee(Ue,()=>t().name,Je=>bt(se,i(t).name=Je,i(t))),F("change",W,k),F("change",Fe,X),Ee(ve,()=>t().race,Je=>bt(se,i(t).race=Je,i(t))),Ee(P,()=>t().background,Je=>bt(se,i(t).background=Je,i(t))),Ee(Ne,()=>t().alignment,Je=>bt(se,i(t).alignment=Je,i(t))),c(re,be)};y(ce,re=>{d(),i(()=>!d().characterInfo)&&re(U)})}l(z),c(a,z),Et(),m()}var Ps=f('<div class="ability-card svelte-bbv1xt"><h3 class="svelte-bbv1xt"> </h3> <input type="number" class="ability-score svelte-bbv1xt" min="1" max="30"/> <div class="ability-modifier svelte-bbv1xt"> </div> <button class="roll-btn svelte-bbv1xt">Check</button> <div class="save-row svelte-bbv1xt"><input type="checkbox" class="svelte-bbv1xt"/> <label class="svelte-bbv1xt">Save</label> <button class="roll-btn-small svelte-bbv1xt">Roll</button></div></div>'),Ts=f('<div class="proficiency-bonus svelte-bbv1xt"><label for="profBonus">Proficiency Bonus</label> <input type="number" id="profBonus" class="prof-input svelte-bbv1xt"/></div> <div class="abilities-grid svelte-bbv1xt"></div>',1),Es=f("<section><!> <!></section>");function Hs(a,n){Tt(n,!1);const t=()=>tt(ga,"$abilityModifiers",b),d=()=>tt(se,"$character",b),p=()=>tt(Zt,"$searchFilter",b),m=()=>tt(Rt,"$collapsedStates",b),[b,w]=Wt(),k=M(),S=M(),X=sa(),z=[{key:"strength",label:"Strength"},{key:"dexterity",label:"Dexterity"},{key:"constitution",label:"Constitution"},{key:"intelligence",label:"Intelligence"},{key:"wisdom",label:"Wisdom"},{key:"charisma",label:"Charisma"}];function le(){es()}function ce(W){const at=t()[W],Se=`1d20${at>=0?"+":""}${at}`;X("roll",{notation:Se,rollType:"check"})}function U(W){const at=t()[W],Se=d().saveProficiencies[W]?d().proficiencyBonus:0,G=at+Se,ie=`1d20${G>=0?"+":""}${G}`;X("roll",{notation:ie,rollType:"save"})}Ze(()=>p(),()=>{o(k,z.filter(({label:W})=>p()?W.toLowerCase().includes(p().toLowerCase()):!0))}),Ze(()=>(e(k),p()),()=>{o(S,e(k).length>0||!p()||p().toLowerCase().includes("proficiency"))}),Jt(),Pt();var re=Es();let be;var Z=r(re);la(Z,{title:"Ability Scores",get collapsed(){return m(),i(()=>m().abilityScores)},ariaLabel:"Toggle Ability Scores Section",onToggle:()=>Rt.update(W=>({...W,abilityScores:!W.abilityScores}))});var Ue=s(Z,2);{var Ve=W=>{var at=Ts(),Se=He(at),G=s(r(Se),2);xe(G),l(Se);var ie=s(Se,2);_t(ie,5,()=>e(k),kt,(Ce,he)=>{let Fe=()=>e(he).key,A=()=>e(he).label;var ve=Ps(),h=r(ve),P=r(h,!0);l(h);var Q=s(h,2);xe(Q);var Ne=s(Q,2),Je=r(Ne);l(Ne);var Ie=s(Ne,2),g=s(Ie,2),$=r(g);xe($);var J=s($,2),de=s(J,2);l(g),l(ve),R(O=>{L(P,O),L(Je,`${t(),Fe(),i(()=>t()[Fe()]>=0?"+":"")??""}${t(),Fe(),i(()=>t()[Fe()])??""}`),Ke($,"id",`${Fe()}-save`),Ke(J,"for",`${Fe()}-save`)},[()=>(A(),i(()=>A().substring(0,3).toUpperCase()))]),Ee(Q,()=>d().abilities[Fe()],O=>bt(se,i(d).abilities[Fe()]=O,i(d))),F("change",Q,le),F("click",Ie,()=>ce(Fe())),Fa($,()=>d().saveProficiencies[Fe()],O=>bt(se,i(d).saveProficiencies[Fe()]=O,i(d))),F("click",de,()=>U(Fe())),c(Ce,ve)}),l(ie),Ee(G,()=>d().proficiencyBonus,Ce=>bt(se,i(d).proficiencyBonus=Ce,i(d))),c(W,at)};y(Ue,W=>{m(),i(()=>!m().abilityScores)&&W(Ve)})}l(re),R(()=>be=ht(re,1,"ability-scores svelte-bbv1xt",null,be,{hidden:!e(S)})),c(a,re),Et(),w()}function Ra(a,n){if(!a.class)return null;const t=qt(a.class);if(!t||!t.spellcaster||!t.spellcastingAbility)return null;const d=n[t.spellcastingAbility];return 8+a.proficiencyBonus+d}function Wa(a,n){if(!a.class)return 0;const t=qt(a.class);return!t||!t.spellcaster||!t.spellcastingAbility?0:n[t.spellcastingAbility]}var Us=f('<input type="number" id="armorClass" class="stat-input svelte-1r5hyyb"/>'),Ns=f('<input type="text" id="armorClass" readonly=""/>'),Gs=f('<div class="stat-box svelte-1r5hyyb"><label for="spellSaveDC" class="svelte-1r5hyyb">Spell Save DC</label> <input type="number" id="spellSaveDC" class="stat-input svelte-1r5hyyb" readonly="" title="8 + Proficiency Bonus + Spellcasting Ability Modifier"/></div>'),Os=f('<span class="hit-dice-type"> </span>'),qs=f('<div class="stats-grid svelte-1r5hyyb"><div class="stat-box svelte-1r5hyyb"><label for="armorClass" class="svelte-1r5hyyb">Armor Class</label> <!></div> <div class="stat-box svelte-1r5hyyb"><label for="initiative" class="svelte-1r5hyyb">Initiative</label> <input type="number" id="initiative" class="stat-input svelte-1r5hyyb"/></div> <div class="stat-box svelte-1r5hyyb"><label for="speed" class="svelte-1r5hyyb">Speed</label> <input type="text" id="speed" class="stat-input svelte-1r5hyyb"/></div> <!></div> <div class="hp-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Points</h3> <div><div class="hp-inputs svelte-1r5hyyb"><input type="number" class="hp-current svelte-1r5hyyb" min="0"/> <span class="hp-separator svelte-1r5hyyb">/</span> <input type="number" class="hp-max svelte-1r5hyyb" min="0"/></div> <div class="hp-controls svelte-1r5hyyb"><button class="hp-btn svelte-1r5hyyb">âˆ’</button> <button class="hp-btn svelte-1r5hyyb">+</button> <button class="hp-btn svelte-1r5hyyb">âˆ’5</button> <button class="hp-btn svelte-1r5hyyb">+5</button></div></div> <div class="temp-hp svelte-1r5hyyb"><label for="tempHP" class="svelte-1r5hyyb">Temp HP</label> <input type="number" id="tempHP" min="0" class="svelte-1r5hyyb"/></div></div> <div class="hit-dice-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Dice</h3> <div class="hit-dice-display svelte-1r5hyyb"><input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <span>/</span> <input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <!></div> <div class="hit-dice-controls svelte-1r5hyyb"><label for="hitDiceCount" class="svelte-1r5hyyb">Roll</label> <div class="hit-dice-count-controls svelte-1r5hyyb"><button class="hit-dice-btn svelte-1r5hyyb">âˆ’</button> <input type="number" id="hitDiceCount" class="hit-dice-count-input svelte-1r5hyyb" min="1"/> <button class="hit-dice-btn svelte-1r5hyyb">+</button></div> <button class="btn btn-primary roll-hit-dice use-enabled svelte-1r5hyyb">ðŸŽ² Roll</button></div></div>',1),Ws=f("<section><!> <!></section>");function zs(a,n){Tt(n,!1);const t=()=>tt(se,"$character",w),d=()=>tt(ga,"$abilityModifiers",w),p=()=>tt(Zt,"$searchFilter",w),m=()=>tt(Rt,"$collapsedStates",w),b=()=>tt(ia,"$isEditMode",w),[w,k]=Wt(),S=M(),X=M(),z=M(),le=M(),ce=sa();let U=M(1);function re(G){se.update(ie=>(ie.currentHP=Math.max(0,Math.min(ie.maxHP,ie.currentHP+G)),ie))}function be(G){const ie=e(U)+G,Ce=t().hitDice.current;o(U,Math.max(1,Math.min(Ce,ie)))}function Z(G=1){if(t().hitDice.current<=0){alert("No hit dice remaining!");return}if(!t().class){alert("Please select a class first!");return}const ie=qt(t().class);if(!ie){alert("Invalid class configuration!");return}const Ce=Math.min(G,t().hitDice.current),he=ie.hitDice,Fe=d().constitution,A=Fe>=0?`+${Fe}`:`${Fe}`,ve=`${Ce}${he}${A}`;ce("rollHitDice",{notation:ve,hitDie:he,count:Ce})}Ze(()=>(t(),d()),()=>{o(S,Ra(t(),d()))}),Ze(()=>(t(),e(U)),()=>{const G=t().hitDice.current;G>0&&e(U)>G&&o(U,G)}),Ze(()=>t(),()=>{o(X,t().activeStates&&t().activeStates.length>0?t().activeStates.reduce((G,ie)=>G+(ie.acBonus||0),0):0)}),Ze(()=>t(),()=>{o(z,t().activeStates&&t().activeStates.length>0?t().activeStates.some(G=>G.name==="Aid"&&G.target==="self"):!1)}),Ze(()=>p(),()=>{o(le,!p()||"armor class".includes(p().toLowerCase())||"initiative".includes(p().toLowerCase())||"speed".includes(p().toLowerCase())||"hit points".includes(p().toLowerCase())||"hp".includes(p().toLowerCase())||"hit dice".includes(p().toLowerCase())||"spell save".includes(p().toLowerCase())||"combat".includes(p().toLowerCase()))}),Jt(),Pt();var Ue=Ws();let Ve;var W=r(Ue);{let G=ot(()=>(m(),i(()=>m().combatStats?"Expand":"Collapse")));la(W,{title:"Combat Stats",get collapsed(){return m(),i(()=>m().combatStats)},get ariaLabel(){return e(G)},onToggle:()=>Rt.update(ie=>({...ie,combatStats:!ie.combatStats}))})}var at=s(W,2);{var Se=G=>{var ie=qs(),Ce=He(ie),he=r(Ce),Fe=s(r(he),2);{var A=I=>{var Y=Us();xe(Y),Ee(Y,()=>t().armorClass,ke=>bt(se,i(t).armorClass=ke,i(t))),c(I,Y)},ve=I=>{var Y=Ns();xe(Y),R(()=>{ya(Y,(e(X),t(),i(()=>e(X)!==0?`${t().armorClass} â†’ ${t().armorClass+e(X)}`:`${t().armorClass}`))),ht(Y,1,gs(e(X)!==0?"stat-input ac-enhanced":"stat-input"),"svelte-1r5hyyb"),Ke(Y,"title",e(X)!==0?"Base AC plus active effect bonuses":"Base Armor Class")}),c(I,Y)};y(Fe,I=>{b()?I(A):I(ve,!1)})}l(he);var h=s(he,2),P=s(r(h),2);xe(P),l(h);var Q=s(h,2),Ne=s(r(Q),2);xe(Ne),l(Q);var Je=s(Q,2);{var Ie=I=>{var Y=Gs(),ke=s(r(Y),2);xe(ke),l(Y),R(()=>ya(ke,e(S))),c(I,Y)};y(Je,I=>{e(S)!==null&&I(Ie)})}l(Ce);var g=s(Ce,2),$=s(r(g),2);let J;var de=r($),O=r(de);xe(O);var _e=s(O,4);xe(_e),l(de);var Ge=s(de,2),st=r(Ge),ye=s(st,2),Oe=s(ye,2),B=s(Oe,2);l(Ge),l($);var x=s($,2),ne=s(r(x),2);xe(ne),l(x),l(g);var oe=s(g,2),q=s(r(oe),2),v=r(q);xe(v);var Pe=s(v,4);xe(Pe);var pe=s(Pe,2);{var ge=I=>{const Y=ot(()=>(E(qt),t(),i(()=>qt(t().class))));var ke=nt(),Te=He(ke);{var qe=ee=>{const ue=ot(()=>(d(),i(()=>d().constitution)));var Me=Os(),Qe=r(Me);l(Me),R(()=>L(Qe,`(${E(e(Y)),i(()=>e(Y).hitDice)??""}${(e(ue)>=0?`+${e(ue)}`:e(ue))??""})`)),c(ee,Me)};y(Te,ee=>{e(Y)&&ee(qe)})}c(I,ke)};y(pe,I=>{t(),i(()=>t().class)&&I(ge)})}l(q);var j=s(q,2),Le=s(r(j),2),Be=r(Le),We=s(Be,2);xe(We);var lt=s(We,2);l(Le);var we=s(Le,2);l(j),l(oe),R(()=>{J=ht($,1,"hp-display svelte-1r5hyyb",null,J,{"aid-active":e(z)}),Ke(O,"max",(t(),i(()=>t().maxHP))),Ke(v,"max",(t(),i(()=>t().hitDice.max))),Be.disabled=e(U)<=1,Ke(We,"max",(t(),i(()=>t().hitDice.current))),lt.disabled=(e(U),t(),i(()=>e(U)>=t().hitDice.current)),we.disabled=(t(),i(()=>t().hitDice.current<=0||!t().class))}),Ee(P,()=>t().initiative,I=>bt(se,i(t).initiative=I,i(t))),Ee(Ne,()=>t().speed,I=>bt(se,i(t).speed=I,i(t))),Ee(O,()=>t().currentHP,I=>bt(se,i(t).currentHP=I,i(t))),Ee(_e,()=>t().maxHP,I=>bt(se,i(t).maxHP=I,i(t))),F("click",st,()=>re(-1)),F("click",ye,()=>re(1)),F("click",Oe,()=>re(-5)),F("click",B,()=>re(5)),Ee(ne,()=>t().tempHP,I=>bt(se,i(t).tempHP=I,i(t))),Ee(v,()=>t().hitDice.current,I=>bt(se,i(t).hitDice.current=I,i(t))),Ee(Pe,()=>t().hitDice.max,I=>bt(se,i(t).hitDice.max=I,i(t))),F("click",Be,()=>be(-1)),Ee(We,()=>e(U),I=>o(U,I)),F("input",We,I=>{const Y=I.target,ke=parseInt(Y.value);ke>t().hitDice.current&&o(U,t().hitDice.current),ke<1&&o(U,1)}),F("click",lt,()=>be(1)),F("click",we,()=>Z(e(U))),c(G,ie)};y(at,G=>{m(),i(()=>!m().combatStats)&&G(Se)})}l(Ue),R(()=>Ve=ht(Ue,1,"combat-stats svelte-1r5hyyb",null,Ve,{hidden:!e(le)})),c(a,Ue),Et(),k()}const La={acrobatics:"dexterity",animalHandling:"wisdom",arcana:"intelligence",athletics:"strength",deception:"charisma",history:"intelligence",insight:"wisdom",intimidation:"charisma",investigation:"intelligence",medicine:"wisdom",nature:"intelligence",perception:"wisdom",performance:"charisma",persuasion:"charisma",religion:"intelligence",sleightOfHand:"dexterity",stealth:"dexterity",survival:"wisdom"};var Ks=f('<div class="skill-row svelte-1f1pl16"><input type="checkbox" class="svelte-1f1pl16"/> <label class="svelte-1f1pl16"> <span class="ability-tag svelte-1f1pl16"> </span></label> <span class="skill-modifier svelte-1f1pl16"> </span> <button class="roll-btn svelte-1f1pl16">Roll</button></div>'),Vs=f('<div class="skills-grid svelte-1f1pl16"></div>'),Js=f("<section><!> <!></section>");function Qs(a,n){Tt(n,!1);const t=()=>tt(se,"$character",b),d=()=>tt(ga,"$abilityModifiers",b),p=()=>tt(Zt,"$searchFilter",b),m=()=>tt(Rt,"$collapsedStates",b),[b,w]=Wt(),k=M(),S=M(),X=M(),z=M(),le=M(),ce=M(),U=sa(),re=[{key:"acrobatics",label:"Acrobatics"},{key:"animalHandling",label:"Animal Handling"},{key:"arcana",label:"Arcana"},{key:"athletics",label:"Athletics"},{key:"deception",label:"Deception"},{key:"history",label:"History"},{key:"insight",label:"Insight"},{key:"intimidation",label:"Intimidation"},{key:"investigation",label:"Investigation"},{key:"medicine",label:"Medicine"},{key:"nature",label:"Nature"},{key:"perception",label:"Perception"},{key:"performance",label:"Performance"},{key:"persuasion",label:"Persuasion"},{key:"religion",label:"Religion"},{key:"sleightOfHand",label:"Sleight of Hand"},{key:"stealth",label:"Stealth"},{key:"survival",label:"Survival"}];function be(Se){const G=e(k)[Se],ie=`1d20${G>=0?"+":""}${G}`;U("roll",{notation:ie,rollType:"check"})}Ze(()=>{},()=>{o(k,{})}),Ze(()=>t(),()=>{o(S,t().skillProficiencies)}),Ze(()=>t(),()=>{o(X,t().proficiencyBonus)}),Ze(()=>d(),()=>{o(z,d())}),Ze(()=>(e(z),e(S),e(X)),()=>{for(const{key:Se}of re){const G=La[Se],ie=e(z)[G],Ce=e(S)[Se]?e(X):0;aa(k,e(k)[Se]=ie+Ce)}}),Ze(()=>p(),()=>{o(le,re.filter(({label:Se})=>p()?Se.toLowerCase().includes(p().toLowerCase()):!0))}),Ze(()=>e(le),()=>{o(ce,e(le).length>0)}),Jt(),Pt();var Z=Js();let Ue;var Ve=r(Z);{let Se=ot(()=>(m(),i(()=>m().skills?"Expand":"Collapse")));la(Ve,{title:"Skills",get collapsed(){return m(),i(()=>m().skills)},get ariaLabel(){return e(Se)},onToggle:()=>Rt.update(G=>({...G,skills:!G.skills}))})}var W=s(Ve,2);{var at=Se=>{var G=Vs();_t(G,5,()=>e(le),kt,(ie,Ce)=>{let he=()=>e(Ce).key,Fe=()=>e(Ce).label;var A=Ks(),ve=r(A);xe(ve);var h=s(ve,2),P=r(h),Q=s(P),Ne=r(Q);l(Q),l(h);var Je=s(h,2),Ie=r(Je);l(Je);var g=s(Je,2);l(A),R($=>{ts(ve,(e(S),he(),i(()=>e(S)[he()]))),Ke(ve,"id",he()),Ke(h,"for",he()),L(P,`${Fe()??""} `),L(Ne,`(${$??""})`),L(Ie,`${e(k),he(),i(()=>e(k)[he()]>=0?"+":"")??""}${e(k),he(),i(()=>e(k)[he()])??""}`)},[()=>(E(La),he(),i(()=>La[he()].substring(0,3).toUpperCase()))]),F("change",ve,$=>{console.log("Skill proficiency changed:",he(),$.target.checked),se.update(J=>({...J,skillProficiencies:{...J.skillProficiencies,[he()]:$.target.checked}}))}),F("click",g,()=>be(he())),c(ie,A)}),l(G),c(Se,G)};y(W,Se=>{m(),i(()=>!m().skills)&&Se(at)})}l(Z),R(()=>Ue=ht(Z,1,"skills svelte-1f1pl16",null,Ue,{hidden:!e(ce)})),c(a,Z),Et(),w()}let ma=null,ba=null;async function ss(){if(ma)return ma;try{return ma=await(await fetch(as("/data/spells.json"))).json(),ma||[]}catch(a){return console.error("Failed to load spells:",a),[]}}async function Ys(){if(ba)return ba;try{return ba=await(await fetch(as("/data/feats.json"))).json(),ba||[]}catch(a){return console.error("Failed to load feats:",a),[]}}function za(a,n){if(!n.trim())return a;const t=n.toLowerCase();return a.filter(d=>d.name.toLowerCase().includes(t)||d.school.toLowerCase().includes(t)||d.classes.some(p=>p.toLowerCase().includes(t))||d.description.toLowerCase().includes(t))}function Xs(a,n){return n===null?a:a.filter(t=>t.level===n)}function Zs(a,n){if(!n.trim())return a;const t=n.toLowerCase();return a.filter(d=>d.name.toLowerCase().includes(t)||d.description.toLowerCase().includes(t))}function ha(a){const n=a.description,t=/\b(Strength|Dexterity|Constitution|Intelligence|Wisdom|Charisma)\s+saving\s+throw/i,d=n.match(t);if(!d)return null;const p=d[1].toLowerCase(),b=/half\s+(?:as\s+much\s+)?damage\s+on\s+a\s+successful(?:\s+save)?/i.test(n),k=/saving\s+throw\s+or\s+take.*?damage/i.test(n)&&!b;return{ability:p,halfDamageOnSave:b,noDamageOnSave:k}}function el(a){const n=a.description;return/(plus|add)\s+your\s+spellcasting\s+(ability\s+)?modifier/i.test(n)}function wa(a){const n=a.description.toLowerCase();return n.includes("ranged spell attack")||n.includes("melee spell attack")}function Ka(a){const n=a.description.toLowerCase();if(["Divine Favor","Bless","Aid","Command"].includes(a.name))return!0;const p=["takes","take","deals","deal","damage equal to","force damage","fire damage","cold damage","lightning damage","thunder damage","acid damage","poison damage","necrotic damage","radiant damage","psychic damage","regain","regains","hit point"].some(w=>n.includes(w));return["bonus to attack","bonus to damage","bonus to ac","gains a +","gain a +","+1 bonus","+2 bonus","+3 bonus","advantage on","becomes a magic weapon"].some(w=>n.includes(w))&&!p}function tl(a){const n=a.description;let t=0,d=0,p=0,m="";const b=n.match(/\+(\d+)\s+bonus\s+to\s+attack\s+rolls\s+and\s+damage\s+rolls/i);if(b){const k=parseInt(b[1]);t=k,d=k,m=`+${k} to attack and damage rolls`}if(a.name==="Bless"&&(m="Add 1d4 to attack rolls and saves",t="1d4"),a.name==="Aid")return m="+5 HP (max and current) for 8 hours",{attackBonus:0,damageBonus:0,acBonus:0,hpBonus:5,description:m,name:a.name};a.name==="Divine Favor"&&(m="Your weapon attacks deal an extra 1d4 radiant damage on a hit.",d="1d4");const w=n.match(/\+(\d+)\s+bonus\s+to\s+AC/i);return w&&(p=parseInt(w[1]),m=`+${p} to AC`),a.name==="Haste"&&(m="+2 AC, doubled speed, extra action",p=2),m||t!==0||d!==0||p!==0?{attackBonus:t,damageBonus:d,acBonus:p,description:m||a.description.substring(0,100),name:a.name}:null}var al=f('<button class="btn btn-secondary">Add Attack</button>'),sl=f('<input type="text" placeholder="Attack name" class="attack-name svelte-14o91c5"/>'),ll=f('<h4 class="attack-name-display svelte-14o91c5"> </h4>'),rl=f('<button class="btn-remove svelte-14o91c5">Ã—</button>'),il=f('<div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Bonus</label> <input type="number" class="attack-bonus svelte-14o91c5"/></div>'),nl=f('<div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Damage</label> <input type="text" placeholder="e.g., 2d6+3" class="attack-damage svelte-14o91c5"/></div>'),ol=f('<div class="spell-info-loading svelte-14o91c5">Loading spell info...</div>'),cl=f('<li class="svelte-14o91c5"><strong>At Higher Levels:</strong> </li>'),vl=f('<ul class="svelte-14o91c5"><li class="svelte-14o91c5"><strong>Level:</strong> </li> <li class="svelte-14o91c5"><strong>Casting Time:</strong> </li> <li class="svelte-14o91c5"><strong>Range:</strong> </li> <li class="svelte-14o91c5"><strong>Components:</strong> <!></li> <li class="svelte-14o91c5"><strong>Duration:</strong> <!> </li> <li class="svelte-14o91c5"><strong>Description:</strong> </li> <!></ul>'),dl=f('<span class="scaled-damage svelte-14o91c5" style="margin-left: 8px;"> </span>'),ul=f('<span class="scaled-damage svelte-14o91c5">(Half damage)</span>'),pl=f('<span class="scaled-damage svelte-14o91c5">(No damage)</span>'),fl=f('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> <!> <!></label></div>'),gl=f("<option> </option>"),ml=f('<span class="scaled-damage svelte-14o91c5"><!> </span>'),bl=f('<span class="scaled-damage svelte-14o91c5"> </span>'),hl=f('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> Target is Fiend or Undead <!></label></div>'),_l=f('<div class="spell-level-selector svelte-14o91c5"><label class="svelte-14o91c5">Cast at Level:</label> <select class="spell-level-select use-enabled svelte-14o91c5"></select> <!></div> <!>',1),yl=f('<div class="spell-level-selector svelte-14o91c5"><span style="color: #dc3545; font-weight: bold;">No spell slots available!</span></div>'),kl=f('<div class="spell-info svelte-14o91c5"><div class="spell-info-header svelte-14o91c5" role="button" tabindex="0"><h4 class="svelte-14o91c5">Spell Info</h4> <button class="collapse-btn-small svelte-14o91c5"> </button></div> <!></div> <!> <!>',1),Sl=f('<div class="spell-info-missing svelte-14o91c5">Spell info not found.</div>'),xl=f('<div class="attack-notes svelte-14o91c5"><label class="svelte-14o91c5">Notes</label> <textarea placeholder="e.g., DC 15 Dex save, Range 120 ft, Concentration" class="notes-input svelte-14o91c5" rows="2"></textarea></div>'),$l=f('<button class="btn btn-primary">Roll Attack</button>'),Cl=f('<div class="buff-target-selection svelte-14o91c5"><div class="target-options svelte-14o91c5"><label class="target-option svelte-14o91c5"><input type="radio" class="svelte-14o91c5"/> Self</label> <label class="target-option svelte-14o91c5"><input type="radio" class="svelte-14o91c5"/> Other</label></div> <button class="btn btn-info"> </button></div>'),Ll=f('<button class="btn btn-info">Cast Spell</button>'),wl=f("<button><!></button>"),Dl=f('<button class="btn btn-primary">Roll Attack</button> <button class="btn btn-secondary">Roll Damage</button>',1),jl=f('<div class="attack-card svelte-14o91c5"><div class="attack-header svelte-14o91c5"><!> <!></div> <div class="attack-details svelte-14o91c5"><!> <!> <div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Type</label> <input type="text" placeholder="e.g., slashing" class="attack-type svelte-14o91c5"/></div></div> <!> <!> <div class="attack-actions svelte-14o91c5"><!></div></div>'),Al=f('<p class="no-attacks svelte-14o91c5">No attacks added yet. Click "Add Attack" to create one.</p>'),Bl=f('<p class="no-attacks svelte-14o91c5">No attacks match your search.</p>'),Fl=f('<button class="btn-remove svelte-14o91c5">Ã—</button>'),Ml=f('<div class="state-card svelte-14o91c5"><div class="state-header svelte-14o91c5"><input type="text" placeholder="Effect name (e.g., Magic Weapon)" class="state-name svelte-14o91c5"/> <!></div> <div class="state-details svelte-14o91c5"><div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Attack Bonus</label> <input type="number" class="state-bonus svelte-14o91c5"/></div> <div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Damage Bonus</label> <input type="text" class="state-bonus svelte-14o91c5"/></div> <div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Target</label> <select class="state-bonus svelte-14o91c5"><option>Self</option><option>Other</option></select></div></div> <div class="state-description svelte-14o91c5"><label class="svelte-14o91c5">Description</label> <input type="text" placeholder="e.g., +1 to attack and damage rolls (Magic Weapon)" class="state-desc-input svelte-14o91c5"/></div></div>'),Rl=f('<div class="states-list svelte-14o91c5"></div>'),Il=f('<p class="no-states svelte-14o91c5">No active effects. Add spell effects that modify your attacks.</p>'),Pl=f('<!> <div class="attacks-list svelte-14o91c5"><!> <!></div> <div class="active-states-section svelte-14o91c5"><h3 class="svelte-14o91c5">Active Spell Effects</h3> <p class="section-description svelte-14o91c5">Effects that modify attack and damage rolls (e.g., Magic Weapon, Bless)</p> <button class="btn btn-secondary">Add Effect</button> <!></div>',1),Tl=f("<section><!> <!></section>");function El(a,n){Tt(n,!1);const t=()=>tt(se,"$character",w),d=()=>tt(ga,"$abilityModifiers",w),p=()=>tt(Zt,"$searchFilter",w),m=()=>tt(Rt,"$collapsedStates",w),b=()=>tt(ia,"$isEditMode",w),[w,k]=Wt(),S=M(),X=M(),z=[],le=sa();let ce=M({}),U=M({});function re(g){aa(ce,e(ce)[g]=!e(ce)[g]),o(ce,{...e(ce)})}function be(g){return g.description.toLowerCase().includes("regain")&&(g.description.toLowerCase().includes("hit point")||g.description.toLowerCase().includes("hp"))}function Z(g){return["Shield of Faith","Bless","Aid","Magic Weapon"].includes(g)}function Ue(){se.update(g=>(g.attacks=[...g.attacks,{id:crypto.randomUUID(),name:"",bonus:0,damage:"",damageType:"",notes:""}],g))}function Ve(g){se.update($=>($.attacks=$.attacks.filter(J=>J.id!==g),$))}function W(g){let $=g.damage,J=!1,de=!1;if(g.spellRef){const ye=ie(g.spellRef);if(ye&&(de=wa(ye),ye.level>0)){const Oe=g.castAtLevel||ye.level;if(!Ce(Oe)){Ot.add(`No level ${Oe} spell slots available!`,"error");return}const x=ha(ye);x&&g.targetSucceededSave&&x.noDamageOnSave?$="0":(J=x?.halfDamageOnSave&&g.targetSucceededSave||!1,$=he(g,ye))}}else if(t().activeStates&&t().activeStates.length>0){let ye=0,Oe=[];for(const B of t().activeStates)B.target!=="other"&&(typeof B.damageBonus=="string"?Oe.push(B.damageBonus):typeof B.damageBonus=="number"&&(ye+=B.damageBonus));if((ye!==0||Oe.length>0)&&$){const B=$.match(/(\d+d\d+)([+-]\d+)?/);if(B){const[,x,ne]=B,q=(ne?parseInt(ne):0)+ye;let v=`${x}`;q!==0&&(v+=`${q>=0?"+":""}${q}`),Oe.length>0&&(v+=" + "+Oe.join(" + ")),$=v}}}const O=[];let _e=0;if(de){const ye=Wa(t(),d()),Oe=t().proficiencyBonus||0;O.push({value:Oe,source:"proficiency"}),O.push({value:ye,source:"spellcasting"}),_e=Oe+ye}else g.bonus!==0&&O.push({value:g.bonus,source:"base"}),_e=g.bonus;let Ge=[];if(t().activeStates)for(const ye of t().activeStates)ye.target!=="other"&&(typeof ye.attackBonus=="number"&&ye.attackBonus!==0?(O.push({value:ye.attackBonus,source:ye.name.toLowerCase()}),_e+=ye.attackBonus):typeof ye.attackBonus=="string"&&ye.attackBonus&&(Ge.push(ye.attackBonus),O.push({value:ye.attackBonus,source:ye.name.toLowerCase()})));let st=`1d20${_e>=0?"+":""}${_e}`;Ge.length>0&&(st+="+"+Ge.join("+")),le("roll",{notation:st,damageNotation:$,attackName:g.name,applyHalfDamage:J,bonusBreakdown:O,rollType:"attack"})}function at(g){if(!g.damage){Ot.add(`${g.name}: No damage specified`,"error");return}let $=g.damage,J=!1;const de=[];if(g.spellRef){const O=ie(g.spellRef);if(O&&O.level>0){const _e=g.castAtLevel||O.level;if(!Ce(_e)){Ot.add(`No level ${_e} spell slots available!`,"error");return}const st=ha(O);st&&g.targetSucceededSave&&st.noDamageOnSave?$="0":(J=st?.halfDamageOnSave&&g.targetSucceededSave||!1,$=he(g,O))}}else{const O=$.match(/(\d+d\d+)([+-]\d+)?/);if(O){const[,_e,Ge]=O,st=Ge?parseInt(Ge):0;if(st!==0&&de.push({value:st,source:"base"}),t().activeStates&&t().activeStates.length>0){let ye=0,Oe=[];for(const B of t().activeStates)B.target!=="other"&&(typeof B.damageBonus=="string"?Oe.push(B.damageBonus):typeof B.damageBonus=="number"&&B.damageBonus!==0&&(de.push({value:B.damageBonus,source:B.name.toLowerCase()}),ye+=B.damageBonus));if(ye!==0||Oe.length>0){const B=st+ye;let x=`${_e}`;B!==0&&(x+=`${B>=0?"+":""}${B}`),Oe.length>0&&(x+=" + "+Oe.join(" + ")),$=x}}}}le("roll",{notation:$,attackName:g.name,applyHalfDamage:J,bonusBreakdown:de})}let Se=M([]),G=M(!1);pa(async()=>{o(Se,await ss()),o(G,!0)});function ie(g){return e(Se).find($=>$.name===g)}function Ce(g){t().classFeatures.spellSlotsByLevel||bt(se,i(t).classFeatures.spellSlotsByLevel={},i(t)),t().classFeatures.spellSlotsByLevel[g]||bt(se,i(t).classFeatures.spellSlotsByLevel[g]=Array(2).fill(!1),i(t));const J=t().classFeatures.spellSlotsByLevel[g].findIndex(de=>!de);return J===-1?!1:(se.update(de=>(de.classFeatures.spellSlotsByLevel||(de.classFeatures.spellSlotsByLevel={}),de.classFeatures.spellSlotsByLevel[g]||(de.classFeatures.spellSlotsByLevel[g]=Array(2).fill(!1)),de.classFeatures.spellSlotsByLevel[g][J]=!0,de)),!0)}function he(g,$){let J=g.damage,de=0,O=0;if(el($)&&(O+=Wa(t(),d())),t().activeStates)for(const oe of t().activeStates)oe.target!=="other"&&typeof oe.damageBonus=="number"&&(O+=oe.damageBonus);if($.higherLevelSlot&&g.castAtLevel){const oe=$.level,v=(g.castAtLevel||oe)-oe;if(v>0){const Pe=$.higherLevelSlot.match(/(\d+)d(\d+)\s+for\s+each.*?level\s+above/i);if(Pe){const[,pe]=Pe;de+=v*parseInt(pe)}}}if(g.targetIsFiendOrUndead&&$.description.includes("Fiend or an Undead")){const oe=$.description.match(/increases by (\d+)d(\d+) if.*?Fiend or.*?Undead/i);if(oe){const[,q]=oe;de+=parseInt(q)}}const _e=J.match(/(\d+)d(\d+)([+-]\d+)?/);if(!_e)return O!==0?O>=0?`${O}`:`${O}`:J||"0";const[,Ge,st,ye]=_e,Oe=parseInt(Ge)+de,x=(ye?parseInt(ye):0)+O;let ne=`${Oe}d${st}`;return x!==0&&(ne+=x>=0?`+${x}`:`${x}`),ne}function Fe(g){const $=[];for(let de=g.level;de<=9;de++){const O=t().classFeatures.spellSlotsByLevel?.[de];O&&O.length>0&&$.push(de)}return $}function A(){se.update(g=>(g.activeStates||(g.activeStates=[]),g.activeStates=[...g.activeStates,{name:"",attackBonus:0,damageBonus:0,description:"",target:"self"}],g))}function ve(g){se.update($=>{if($.activeStates){const J=$.activeStates[g];J?.hpBonus&&J.target!=="other"&&($.maxHP-=J.hpBonus,$.currentHP=Math.max(1,Math.min($.currentHP-J.hpBonus,$.maxHP))),$.activeStates=$.activeStates.filter((de,O)=>O!==g)}return $})}function h(g,$="self"){const J=ie(g.spellRef);if(!J){Ot.add("Spell not found","error");return}const de=g.castAtLevel||J.level;if(de>0&&!Ce(de)){Ot.add(`No level ${de} spell slots available!`,"error");return}const O=tl(J);if(!O){Ot.add(`${J.name} cast! Check spell description for effects.`,"info");return}let _e=O.hpBonus||0,Ge=O.description;J.name==="Aid"&&de>J.level&&(_e=5+(de-J.level)*5,Ge=`+${_e} HP (max and current) for 8 hours`);const ye=["Shield of Faith","Bless","Aid","Magic Weapon"].includes(J.name);se.update(B=>{B.activeStates||(B.activeStates=[]);const x=B.activeStates.find(ne=>ne.name===J.name);return x&&x.hpBonus&&x.target!=="other"&&(B.maxHP-=x.hpBonus,B.currentHP=Math.max(1,Math.min(B.currentHP-x.hpBonus,B.maxHP))),B.activeStates=B.activeStates.filter(ne=>ne.name!==J.name),_e>0&&$==="self"&&(B.maxHP+=_e,B.currentHP+=_e),B.activeStates=[...B.activeStates,{name:J.name,attackBonus:O.attackBonus,damageBonus:O.damageBonus,acBonus:O.acBonus,description:Ge,target:$,hpBonus:_e}],B});const Oe=$==="self"?" on self":" on other";Ot.add(`${J.name} cast${ye?Oe:""}! Effect added to Active Spell Effects.`,"success")}Ze(()=>(t(),e(ce),e(U)),()=>{if(t()&&t().attacks)for(const g of t().attacks)g.spellRef&&e(ce)[g.id]===void 0&&aa(ce,e(ce)[g.id]=!0),g.spellRef&&e(U)[g.id]===void 0&&aa(U,e(U)[g.id]="self")}),Ze(()=>(t(),p()),()=>{o(S,t().attacks.filter(g=>{if(!p())return!0;const $=p().toLowerCase();return g.name.toLowerCase().includes($)||g.damageType.toLowerCase().includes($)}).sort((g,$)=>!g.spellRef&&$.spellRef?-1:g.spellRef&&!$.spellRef?1:0))}),Ze(()=>(p(),e(S)),()=>{o(X,!p()||e(S).length>0||"attack".includes(p().toLowerCase())||"spell".includes(p().toLowerCase()))}),Jt(),Pt();var P=Tl();let Q;var Ne=r(P);{let g=ot(()=>(m(),i(()=>m().attacks?"Expand":"Collapse")));la(Ne,{title:"Attacks & Spells",get collapsed(){return m(),i(()=>m().attacks)},get ariaLabel(){return e(g)},onToggle:()=>Rt.update($=>({...$,attacks:!$.attacks}))})}var Je=s(Ne,2);{var Ie=g=>{var $=Pl(),J=He($);{var de=q=>{var v=al();F("click",v,Ue),c(q,v)};y(J,q=>{b()&&q(de)})}var O=s(J,2),_e=r(O);_t(_e,1,()=>e(S),q=>q.id,(q,v,Pe)=>{var pe=jl(),ge=r(pe),j=r(ge);{var Le=D=>{var T=sl();xe(T),Ee(T,()=>e(v).name,K=>(e(v).name=K,wt(()=>(e(S),t(),p())))),c(D,T)},Be=D=>{var T=ll(),K=r(T,!0);l(T),R(()=>L(K,(e(v),i(()=>e(v).name||"(Unnamed Attack)")))),c(D,T)};y(j,D=>{b()?D(Le):D(Be,!1)})}var We=s(j,2);{var lt=D=>{var T=rl();F("click",T,()=>Ve(e(v).id)),c(D,T)};y(We,D=>{b()&&D(lt)})}l(ge);var we=s(ge,2),I=r(we);{var Y=D=>{var T=il(),K=r(T),je=s(K,2);xe(je),l(T),R(()=>{Ke(K,"for",`attack-bonus-${e(v),i(()=>e(v).id)??""}`),Ke(je,"id",`attack-bonus-${e(v),i(()=>e(v).id)??""}`)}),Ee(je,()=>e(v).bonus,Re=>(e(v).bonus=Re,wt(()=>(e(S),t(),p())))),c(D,T)};y(I,D=>{e(v),i(()=>e(v).bonus!==0&&e(v).bonus!==void 0)&&D(Y)})}var ke=s(I,2);{var Te=D=>{var T=nl(),K=r(T),je=s(K,2);xe(je),l(T),R(()=>{Ke(K,"for",`attack-damage-${e(v),i(()=>e(v).id)??""}`),Ke(je,"id",`attack-damage-${e(v),i(()=>e(v).id)??""}`)}),Ee(je,()=>e(v).damage,Re=>(e(v).damage=Re,wt(()=>(e(S),t(),p())))),c(D,T)};y(ke,D=>{e(v),i(()=>e(v).damage&&e(v).damage.trim()!=="")&&D(Te)})}var qe=s(ke,2),ee=r(qe),ue=s(ee,2);xe(ue),l(qe),l(we);var Me=s(we,2);{var Qe=D=>{var T=nt(),K=He(T);{var je=rt=>{var V=ol();c(rt,V)},Re=rt=>{const V=ot(()=>(e(v),i(()=>ie(e(v).spellRef))));var dt=nt(),Dt=He(dt);{var jt=H=>{const C=ot(()=>(E(ha),E(e(V)),i(()=>ha(e(V)))));var Ae=kl(),ae=He(Ae),Xe=r(ae),$e=s(r(Xe),2),ut=r($e,!0);l($e),l(Xe);var ze=s(Xe,2);{var it=Ye=>{var ct=vl(),mt=r(ct),xt=s(r(mt));l(mt);var Ht=s(mt,2),Ut=s(r(Ht));l(Ht);var Bt=s(Ht,2),$t=s(r(Bt));l(Bt);var Ct=s(Bt,2),Nt=s(r(Ct)),vt=s(Nt);{var Gt=St=>{var Lt=Mt();R(()=>L(Lt,`(${E(e(V)),i(()=>e(V).material)??""})`)),c(St,Lt)};y(vt,St=>{E(e(V)),i(()=>e(V).material)&&St(Gt)})}l(Ct);var Vt=s(Ct,2),Qt=s(r(Vt),2);{var ea=St=>{var Lt=Mt("Concentration,");c(St,Lt)};y(Qt,St=>{E(e(V)),i(()=>e(V).concentration)&&St(ea)})}var At=s(Qt,1,!0);l(Vt);var It=s(Vt,2),Ft=s(r(It));l(It);var zt=s(It,2);{var Yt=St=>{var Lt=cl(),Kt=s(r(Lt));l(Lt),R(()=>L(Kt,` ${E(e(V)),i(()=>e(V).higherLevelSlot)??""}`)),c(St,Lt)};y(zt,St=>{E(e(V)),i(()=>e(V).higherLevelSlot)&&St(Yt)})}l(ct),R(St=>{L(xt,` ${E(e(V)),i(()=>e(V).level)??""}`),L(Ut,` ${E(e(V)),i(()=>e(V).castingTime||e(V).actionType)??""}`),L($t,` ${E(e(V)),i(()=>e(V).range)??""}`),L(Nt,` ${St??""}`),L(At,(E(e(V)),i(()=>e(V).duration))),L(Ft,` ${E(e(V)),i(()=>e(V).description)??""}`)},[()=>(E(e(V)),i(()=>e(V).components.join(", ")))]),c(Ye,ct)};y(ze,Ye=>{e(ce),e(v),i(()=>!e(ce)[e(v).id])&&Ye(it)})}l(ae);var et=s(ae,2);{var pt=Ye=>{var ct=fl(),mt=r(ct),xt=r(mt);xe(xt);var Ht=s(xt),Ut=s(Ht);{var Bt=vt=>{var Gt=dl(),Vt=r(Gt);l(Gt),R(Qt=>L(Vt,`(Spell Save DC: ${Qt??""})`),[()=>(E(Ra),t(),d(),i(()=>Ra(t(),d())))]),c(vt,Gt)};y(Ut,vt=>{t(),i(()=>t().class)&&vt(Bt)})}var $t=s(Ut,2);{var Ct=vt=>{var Gt=ul();c(vt,Gt)},Nt=vt=>{var Gt=nt(),Vt=He(Gt);{var Qt=ea=>{var At=pl();c(ea,At)};y(Vt,ea=>{e(v),E(e(C)),i(()=>e(v).targetSucceededSave&&e(C).noDamageOnSave)&&ea(Qt)},!0)}c(vt,Gt)};y($t,vt=>{e(v),E(e(C)),i(()=>e(v).targetSucceededSave&&e(C).halfDamageOnSave)?vt(Ct):vt(Nt,!1)})}l(mt),l(ct),R(vt=>L(Ht,` Target succeeded on ${vt??""} save `),[()=>(E(e(C)),i(()=>e(C).ability.charAt(0).toUpperCase()+e(C).ability.slice(1)))]),Fa(xt,()=>e(v).targetSucceededSave,vt=>(e(v).targetSucceededSave=vt,wt(()=>(e(S),t(),p())))),c(Ye,ct)};y(et,Ye=>{e(C)&&Ye(pt)})}var ft=s(et,2);{var gt=Ye=>{const ct=ot(()=>(E(e(V)),i(()=>Fe(e(V)))));var mt=nt(),xt=He(mt);{var Ht=Bt=>{var $t=_l(),Ct=He($t),Nt=r(Ct),vt=s(Nt,2);R(()=>{e(v),wt(()=>{e(ct)})}),_t(vt,5,()=>e(ct),kt,(At,It)=>{var Ft=gl(),zt=r(Ft);l(Ft);var Yt={};R(()=>{L(zt,`Level ${e(It)??""}`),Yt!==(Yt=e(It))&&(Ft.value=(Ft.__value=e(It))??"")}),c(At,Ft)}),l(vt);var Gt=s(vt,2);{var Vt=At=>{const It=ot(()=>(e(v),E(e(V)),i(()=>he(e(v),e(V)))));var Ft=ml(),zt=r(Ft);{var Yt=Kt=>{var ta=Mt("Healing");c(Kt,ta)},St=Kt=>{var ta=Mt("Damage");c(Kt,ta)};y(zt,Kt=>{E(e(V)),i(()=>be(e(V)))?Kt(Yt):Kt(St,!1)})}var Lt=s(zt);l(Ft),R(()=>L(Lt,` ${e(It)??""}`)),c(At,Ft)};y(Gt,At=>{e(v),E(e(V)),i(()=>e(v).castAtLevel&&e(v).castAtLevel>e(V).level)&&At(Vt)})}l(Ct);var Qt=s(Ct,2);{var ea=At=>{var It=hl(),Ft=r(It),zt=r(Ft);xe(zt);var Yt=s(zt,2);{var St=Lt=>{const Kt=ot(()=>(e(v),E(e(V)),i(()=>he(e(v),e(V)))));var ta=bl(),ls=r(ta);l(ta),R(()=>L(ls,`(+1d8, total: ${e(Kt)??""})`)),c(Lt,ta)};y(Yt,Lt=>{e(v),i(()=>e(v).targetIsFiendOrUndead)&&Lt(St)})}l(Ft),l(It),Fa(zt,()=>e(v).targetIsFiendOrUndead,Lt=>(e(v).targetIsFiendOrUndead=Lt,wt(()=>(e(S),t(),p())))),c(At,It)};y(Qt,At=>{E(e(V)),i(()=>e(V).description.includes("Fiend or an Undead"))&&At(ea)})}R(()=>{Ke(Nt,"for",`castLevel-${e(v),i(()=>e(v).id)??""}`),Ke(vt,"id",`castLevel-${e(v),i(()=>e(v).id)??""}`)}),Ba(vt,()=>e(v).castAtLevel,At=>(e(v).castAtLevel=At,wt(()=>(e(S),t(),p())))),c(Bt,$t)},Ut=Bt=>{var $t=yl();c(Bt,$t)};y(xt,Bt=>{E(e(ct)),i(()=>e(ct).length>0)?Bt(Ht):Bt(Ut,!1)})}c(Ye,mt)};y(ft,Ye=>{E(e(V)),i(()=>e(V).higherLevelSlot&&e(V).level>0)&&Ye(gt)})}R(()=>{Ke($e,"aria-label",(e(ce),e(v),i(()=>e(ce)[e(v).id]?"Expand":"Collapse"))),L(ut,(e(ce),e(v),i(()=>e(ce)[e(v).id]?"â–¼":"â–²")))}),F("click",Xe,()=>re(e(v).id)),F("keydown",Xe,Ye=>Ye.key==="Enter"&&re(e(v).id)),c(H,Ae)},u=H=>{var C=Sl();c(H,C)};y(Dt,H=>{e(V)?H(jt):H(u,!1)})}c(rt,dt)};y(K,rt=>{e(Se),i(()=>e(Se).length===0)?rt(je):rt(Re,!1)})}c(D,T)};y(Me,D=>{e(v),i(()=>e(v).spellRef)&&D(Qe)})}var De=s(Me,2);{var _=D=>{var T=xl(),K=r(T),je=s(K,2);da(je),l(T),R(()=>{Ke(K,"for",`attack-notes-${e(v),i(()=>e(v).id)??""}`),Ke(je,"id",`attack-notes-${e(v),i(()=>e(v).id)??""}`)}),Ee(je,()=>e(v).notes,Re=>(e(v).notes=Re,wt(()=>(e(S),t(),p())))),c(D,T)};y(De,D=>{e(v),i(()=>!e(v).spellRef)&&D(_)})}var N=s(De,2),fe=r(N);{var te=D=>{const T=ot(()=>(e(v),i(()=>ie(e(v).spellRef))));var K=nt(),je=He(K);{var Re=rt=>{var V=nt(),dt=He(V);{var Dt=u=>{var H=$l();F("click",H,()=>W(e(v))),c(u,H)},jt=u=>{var H=nt(),C=He(H);{var Ae=Xe=>{var $e=nt(),ut=He($e);{var ze=et=>{var pt=Cl(),ft=r(pt),gt=r(ft),Ye=r(gt);xe(Ye),Ye.value=Ye.__value="self",ra(),l(gt);var ct=s(gt,2),mt=r(ct);xe(mt),mt.value=mt.__value="other",ra(),l(ct),l(ft);var xt=s(ft,2),Ht=r(xt);l(xt),l(pt),R(()=>{Ke(Ye,"name",`target-${e(v),i(()=>e(v).id)??""}`),Ke(mt,"name",`target-${e(v),i(()=>e(v).id)??""}`),L(Ht,`Cast ${E(e(T)),i(()=>e(T).name)??""}`)}),Ua(z,[Pe],Ye,()=>e(U)[e(v).id],Ut=>aa(U,e(U)[e(v).id]=Ut)),Ua(z,[Pe],mt,()=>e(U)[e(v).id],Ut=>aa(U,e(U)[e(v).id]=Ut)),F("click",xt,()=>h(e(v),e(U)[e(v).id])),c(et,pt)},it=et=>{var pt=Ll();F("click",pt,()=>h(e(v),"self")),c(et,pt)};y(ut,et=>{E(e(T)),i(()=>Z(e(T).name))?et(ze):et(it,!1)})}c(Xe,$e)},ae=Xe=>{var $e=wl(),ut=r($e);{var ze=et=>{var pt=Mt("Roll Healing");c(et,pt)},it=et=>{var pt=Mt("Roll Damage");c(et,pt)};y(ut,et=>{E(e(T)),i(()=>be(e(T)))?et(ze):et(it,!1)})}l($e),R(et=>ht($e,1,`btn ${et??""}`),[()=>(E(e(T)),i(()=>be(e(T))?"btn-success":"btn-secondary"))]),F("click",$e,()=>at(e(v))),c(Xe,$e)};y(C,Xe=>{E(Ka),E(e(T)),i(()=>Ka(e(T)))?Xe(Ae):Xe(ae,!1)},!0)}c(u,H)};y(dt,u=>{E(wa),E(e(T)),i(()=>wa(e(T)))?u(Dt):u(jt,!1)})}c(rt,V)};y(je,rt=>{e(T)&&rt(Re)})}c(D,K)},me=D=>{var T=nt(),K=He(T);{var je=Re=>{var rt=Dl(),V=He(rt),dt=s(V,2);F("click",V,()=>W(e(v))),F("click",dt,()=>at(e(v))),c(Re,rt)};y(K,Re=>{e(v),i(()=>!e(v).spellRef)&&Re(je)},!0)}c(D,T)};y(fe,D=>{e(v),e(G),i(()=>e(v).spellRef&&e(G))?D(te):D(me,!1)})}l(N),l(pe),R(()=>{Ke(ee,"for",`attack-type-${e(v),i(()=>e(v).id)??""}`),Ke(ue,"id",`attack-type-${e(v),i(()=>e(v).id)??""}`)}),Ee(ue,()=>e(v).damageType,D=>(e(v).damageType=D,wt(()=>(e(S),t(),p())))),c(q,pe)});var Ge=s(_e,2);{var st=q=>{var v=Al();c(q,v)},ye=q=>{var v=nt(),Pe=He(v);{var pe=ge=>{var j=Bl();c(ge,j)};y(Pe,ge=>{e(S),i(()=>e(S).length===0)&&ge(pe)},!0)}c(q,v)};y(Ge,q=>{t(),i(()=>t().attacks.length===0)?q(st):q(ye,!1)})}l(O);var Oe=s(O,2),B=s(r(Oe),4),x=s(B,2);{var ne=q=>{var v=Rl();_t(v,5,()=>(t(),i(()=>t().activeStates)),kt,(Pe,pe,ge)=>{var j=Ml(),Le=r(j),Be=r(Le);xe(Be);var We=s(Be,2);{var lt=me=>{var D=Fl();F("click",D,()=>ve(ge)),c(me,D)};y(We,me=>{b()&&me(lt)})}l(Le);var we=s(Le,2),I=r(we),Y=r(I);Ke(Y,"for",`state-attack-bonus-${ge}`);var ke=s(Y,2);xe(ke),Ke(ke,"id",`state-attack-bonus-${ge}`),l(I);var Te=s(I,2),qe=r(Te);Ke(qe,"for",`state-damage-bonus-${ge}`);var ee=s(qe,2);xe(ee),Ke(ee,"id",`state-damage-bonus-${ge}`),l(Te);var ue=s(Te,2),Me=r(ue);Ke(Me,"for",`state-target-${ge}`);var Qe=s(Me,2);R(()=>{e(pe),wt(()=>{})}),Ke(Qe,"id",`state-target-${ge}`);var De=r(Qe);De.value=De.__value="self";var _=s(De);_.value=_.__value="other",l(Qe),l(ue),l(we);var N=s(we,2),fe=r(N);Ke(fe,"for",`state-desc-${ge}`);var te=s(fe,2);xe(te),Ke(te,"id",`state-desc-${ge}`),l(N),l(j),Ee(Be,()=>e(pe).name,me=>(e(pe).name=me,wt(()=>t()),ca(w,"$character"))),Ee(ke,()=>e(pe).attackBonus,me=>(e(pe).attackBonus=me,wt(()=>t()),ca(w,"$character"))),Ee(ee,()=>e(pe).damageBonus,me=>(e(pe).damageBonus=me,wt(()=>t()),ca(w,"$character"))),Ba(Qe,()=>e(pe).target,me=>(e(pe).target=me,wt(()=>t()),ca(w,"$character"))),Ee(te,()=>e(pe).description,me=>(e(pe).description=me,wt(()=>t()),ca(w,"$character"))),c(Pe,j)}),l(v),c(q,v)},oe=q=>{var v=Il();c(q,v)};y(x,q=>{t(),i(()=>t().activeStates&&t().activeStates.length>0)?q(ne):q(oe,!1)})}l(Oe),F("click",B,A),c(g,$)};y(Je,g=>{m(),i(()=>!m().attacks)&&g(Ie)})}l(P),R(()=>Q=ht(P,1,"attacks svelte-14o91c5",null,Q,{hidden:!e(X)})),c(a,P),Et(),k()}var Hl=f('<span class="slot-checkbox-x svelte-serp1j">&#8212;</span>'),Ul=f('<label><input type="checkbox" class="slot-checkbox-input svelte-serp1j"/> <span><!></span></label>');function Va(a,n){Tt(n,!1);const t=()=>tt(ia,"$isEditMode",d),[d,p]=Wt();let m=yt(n,"checked",8,!1),b=yt(n,"disabled",8,!1),w=yt(n,"className",8,""),k=yt(n,"index",8,void 0),S=yt(n,"ariaLabel",8,void 0);const X=sa();function z(Z){X("change",{checked:Z.currentTarget.checked,index:k()})}Pt();var le=Ul(),ce=r(le);xe(ce);var U=s(ce,2),re=r(U);{var be=Z=>{var Ue=Hl();c(Z,Ue)};y(re,Z=>{m()&&Z(be)})}l(U),l(le),R(()=>{ht(le,1,"slot-checkbox-label "+w()+(t()?"":" not-editable"),"svelte-serp1j"),ts(ce,m()),ce.disabled=b()||!t(),Ke(ce,"aria-label",S()),Ke(ce,"tabindex",t()?0:-1),ht(U,1,`slot-checkbox-custom ${m()?"used":""} ${t()?"":"readonly"}`,"svelte-serp1j")}),F("change",ce,z),c(a,le),Et(),p()}var Nl=f('<p class="no-features svelte-1kpvv0n">Select a class to see available features</p>'),Gl=f('<p class="no-features svelte-1kpvv0n">No class features available at this level</p>'),Ol=f('<div class="spell-slots svelte-1kpvv0n"><label class="svelte-1kpvv0n"> </label> <div class="slots-tracker svelte-1kpvv0n"></div></div>'),ql=f('<div class="all-spell-slots"></div>'),Wl=f('<div class="feature-box spellcasting svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"> </h3> <div class="spell-stats svelte-1kpvv0n"><div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Spell Save DC</label> <div class="spell-value svelte-1kpvv0n"> </div></div> <div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <div class="spell-value svelte-1kpvv0n"> </div></div></div> <!> <div class="prepared-spells svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <textarea placeholder="List your prepared spells..." class="svelte-1kpvv0n"></textarea></div></div>'),zl=f('<p class="unlimited svelte-1kpvv0n">Unlimited Uses</p>'),Kl=f('<div class="slots-tracker svelte-1kpvv0n"></div> <div class="uses-actions-row"><button class="btn btn-primary use-enabled"> </button></div> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div>',1),Vl=f('<div class="uses-tracker svelte-1kpvv0n"><!></div>'),Jl=f('<div class="pool-tracker svelte-1kpvv0n"><input type="number" min="0" class="pool-input svelte-1kpvv0n"/> <span> </span> <button class="btn-small svelte-1kpvv0n"> </button></div>'),Ql=f('<p class="no-uses svelte-1kpvv0n">No Channel Divinity uses remaining</p>'),Yl=f('<div class="channel-divinity-option svelte-1kpvv0n"><button class="btn btn-primary use-enabled svelte-1kpvv0n">Use Channel Divinity</button> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div> <!></div>'),Xl=f('<div class="feature-box svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"><!> </h3> <p class="feature-description svelte-1kpvv0n"> </p> <!></div>'),Zl=f('<div class="features-grid svelte-1kpvv0n"><!> <!></div>'),er=f("<section><!> <!></section>");function tr(a,n){Tt(n,!1);const t=()=>tt(se,"$character",b),d=()=>tt(ga,"$abilityModifiers",b),p=()=>tt(Zt,"$searchFilter",b),m=()=>tt(Rt,"$collapsedStates",b),[b,w]=Wt(),k=M(),S=M(),X=M(),z=M(),le=M(),ce=M(),U=M();let re=M(0),be=M(0);function Z(h,P){se.update(Q=>(Q.classFeatures.features[h]=P,Q))}function Ue(){se.update(h=>(h.classFeatures.spellSlotsByLevel||(h.classFeatures.spellSlotsByLevel={}),e(z).forEach(({level:P,slots:Q})=>{h.classFeatures.spellSlotsByLevel[P]||(h.classFeatures.spellSlotsByLevel[P]=Array(Q).fill(!1))}),h))}function Ve(h){if(typeof h.maxUses=="function"){if((h.name==="Divine Sense"||h.name==="War Priest")&&e(k)?.spellcastingAbility){const P=d()[e(k).spellcastingAbility];return h.maxUses(t().level,P)}return h.maxUses(t().level)}return h.maxUses||0}function W(h,P){se.update(Q=>((!Q.classFeatures.features[h]||!Array.isArray(Q.classFeatures.features[h])||Q.classFeatures.features[h].length!==P)&&(Q.classFeatures.features[h]=Array(P).fill(!1)),Q))}rs(()=>{e(ce)&&t()&&t().classFeatures&&t().classFeatures.features&&e(ce).forEach(h=>{if(h.type==="uses"){const P=h.name.replace(/\s+/g,""),Q=Ve(h),Ne=t().classFeatures.features[P];(!Array.isArray(Ne)||Ne.length!==Q)&&W(P,Q)}})});function at(h){return typeof h.maxPool=="function"?h.maxPool(t().level):h.maxPool||0}function Se(h){return typeof h.description=="function"?h.description(t().level):h.description}function G(){const h="ChannelDivinity";se.update(P=>{const Q=P.classFeatures.features[h];return typeof Q=="number"&&Q>0&&(P.classFeatures.features[h]=Q-1),P})}function ie(){Rt.update(h=>({...h,classFeatures:!h.classFeatures}))}Ze(()=>(t(),qt),()=>{o(k,t().class?qt(t().class):null)}),Ze(()=>(t(),oa),()=>{o(S,t().class?oa(t().class,t().level,t().subclass):[])}),Ze(()=>(t(),Oa),()=>{o(X,t().class?Oa(t().class,t().level):0)}),Ze(()=>(e(k),t()),()=>{o(z,(()=>{if(!e(k)?.spellcaster)return[];const h=t().level,P=[];return h>=1&&P.push({level:1,slots:Math.min(4,2+Math.floor(h/3))}),h>=3&&P.push({level:2,slots:Math.min(3,2+Math.floor((h-3)/4))}),h>=5&&P.push({level:3,slots:Math.min(3,2+Math.floor((h-5)/5))}),h>=7&&P.push({level:4,slots:Math.min(3,1+Math.floor((h-7)/6))}),h>=9&&P.push({level:5,slots:Math.min(2,1+Math.floor((h-9)/8))}),h>=11&&P.push({level:6,slots:1}),h>=13&&P.push({level:7,slots:1}),h>=15&&P.push({level:8,slots:1}),h>=17&&P.push({level:9,slots:1}),P})())}),Ze(()=>(e(k),d(),t(),qa),()=>{if(e(k)?.spellcaster&&e(k).spellcastingAbility){const h=d()[e(k).spellcastingAbility];o(re,ws(t().class,h,t().proficiencyBonus)||0),o(be,qa(t().class,t().level,h))}}),Ze(()=>(t(),e(k),e(z)),()=>{t().class&&e(k)?.spellcaster&&e(z).length>0&&Ue()}),Ze(()=>t(),()=>{o(le,(()=>{const P=t().classFeatures.features["ChannelDivinity"];return typeof P=="number"?P:0})())}),Ze(()=>(e(S),p()),()=>{o(ce,e(S).filter(h=>{if(!p())return!0;const P=p().toLowerCase();return h.name.toLowerCase().includes(P)||Se(h).toLowerCase().includes(P)}))}),Ze(()=>(p(),t(),e(ce)),()=>{o(U,!p()||t().class||"class features".includes(p().toLowerCase())||"spellcasting".includes(p().toLowerCase())||e(ce).length>0)}),Jt(),Pt();var Ce=er();let he;var Fe=r(Ce);{let h=ot(()=>(m(),i(()=>m().classFeatures?"Expand":"Collapse")));la(Fe,{title:"Class Features",get collapsed(){return m(),i(()=>m().classFeatures)},get ariaLabel(){return e(h)},onToggle:ie})}var A=s(Fe,2);{var ve=h=>{var P=nt(),Q=He(P);{var Ne=Ie=>{var g=Nl();c(Ie,g)},Je=Ie=>{var g=nt(),$=He(g);{var J=O=>{var _e=Gl();c(O,_e)},de=O=>{var _e=Zl(),Ge=r(_e);{var st=Oe=>{var B=Wl(),x=r(B),ne=r(x);l(x);var oe=s(x,2),q=r(oe),v=s(r(q),2),Pe=r(v,!0);l(v),l(q);var pe=s(q,2),ge=s(r(pe),2),j=r(ge,!0);l(ge),l(pe),l(oe);var Le=s(oe,2);{var Be=we=>{var I=ql();_t(I,5,()=>e(z),kt,(Y,ke)=>{let Te=()=>e(ke).level,qe=()=>e(ke).slots;const ee=ot(()=>(t(),Te(),qe(),i(()=>t().classFeatures.spellSlotsByLevel?.[Te()]||Array(qe()).fill(!1))));var ue=Ol(),Me=r(ue),Qe=r(Me);l(Me);var De=s(Me,2);_t(De,5,()=>e(ee),kt,(_,N,fe)=>{{let te=ot(()=>(E(e(ee)),i(()=>e(ee)[fe]||!1)));Va(_,{get checked(){return e(te)},$$events:{change:me=>{se.update(D=>(D.classFeatures.spellSlotsByLevel||(D.classFeatures.spellSlotsByLevel={}),D.classFeatures.spellSlotsByLevel[Te()]||(D.classFeatures.spellSlotsByLevel[Te()]=Array(qe()).fill(!1)),D.classFeatures.spellSlotsByLevel[Te()][fe]=me.detail.checked,D))}}})}}),l(De),l(ue),R(()=>L(Qe,`${Te()===1?"1st":Te()===2?"2nd":Te()===3?"3rd":`${Te()}th`} Level Spell Slots`)),c(Y,ue)}),l(I),c(we,I)};y(Le,we=>{e(z),i(()=>e(z).length>0)&&we(Be)})}var We=s(Le,2),lt=s(r(We),2);da(lt),l(We),l(B),R(we=>{L(ne,`Spellcasting (${we??""})`),L(Pe,e(re)),L(j,e(be))},[()=>(e(k),i(()=>e(k).spellcastingAbility?.toUpperCase()))]),Ee(lt,()=>t().classFeatures.preparedSpells,we=>bt(se,i(t).classFeatures.preparedSpells=we,i(t))),c(Oe,B)};y(Ge,Oe=>{e(k),i(()=>e(k)?.spellcaster)&&Oe(st)})}var ye=s(Ge,2);_t(ye,1,()=>e(ce),kt,(Oe,B)=>{const x=ot(()=>(e(B),i(()=>e(B).name.replace(/\s+/g,"")))),ne=ot(()=>(t(),E(e(x)),i(()=>t().classFeatures.features[e(x)]))),oe=ot(()=>typeof e(ne)=="number");var q=Xl(),v=r(q),Pe=r(v);{var pe=we=>{var I=Mt("Channel Divinity:");c(we,I)};y(Pe,we=>{e(B),i(()=>e(B).type==="channelDivinity")&&we(pe)})}var ge=s(Pe);l(v);var j=s(v,2),Le=r(j,!0);l(j);var Be=s(j,2);{var We=we=>{const I=ot(()=>(e(B),i(()=>Ve(e(B))))),Y=ot(()=>(E(e(ne)),E(e(I)),i(()=>Array.isArray(e(ne))?e(ne):Array(e(I)).fill(!1))));var ke=Vl(),Te=r(ke);{var qe=ue=>{var Me=zl();c(ue,Me)},ee=ue=>{var Me=Kl(),Qe=He(Me);_t(Qe,5,()=>e(Y),kt,(D,T,K)=>{Va(D,{get checked(){return e(T)},index:K,$$events:{change:je=>{se.update(Re=>(Re.classFeatures.features[e(x)]||(Re.classFeatures.features[e(x)]=Array(e(I)).fill(!1)),Re.classFeatures.features[e(x)][K]=je.detail.checked,Re))}}})}),l(Qe);var De=s(Qe,2),_=r(De),N=r(_);l(_),l(De);var fe=s(De,2),te=r(fe),me=r(te);l(te),l(fe),R(D=>{_.disabled=D,L(N,`Use ${e(B),i(()=>e(B).name)??""}`),L(me,`Resets on ${e(B),i(()=>e(B).resetOn==="short"?"Short Rest":"Long Rest")??""}`)},[()=>(E(e(Y)),i(()=>e(Y).filter(D=>!D).length<=0))]),F("click",_,()=>{se.update(D=>{D.classFeatures.features[e(x)]||(D.classFeatures.features[e(x)]=Array(e(I)).fill(!1));const T=D.classFeatures.features[e(x)],K=T.findIndex(je=>!je);return K!==-1&&(T[K]=!0),D})}),c(ue,Me)};y(Te,ue=>{e(I)===1/0?ue(qe):ue(ee,!1)})}l(ke),c(we,ke)},lt=we=>{var I=nt(),Y=He(I);{var ke=qe=>{const ee=ot(()=>(e(B),i(()=>at(e(B)))));var ue=Jl(),Me=r(ue);xe(Me);var Qe=s(Me,2),De=r(Qe);l(Qe);var _=s(Qe,2),N=r(_,!0);l(_),l(ue),R(()=>{ya(Me,e(oe)&&e(ne)!==void 0?e(ne):e(ee)),Ke(Me,"max",e(ee)),L(De,`/ ${e(ee)??""}`),L(N,(e(B),i(()=>e(B).resetOn==="short"?"Short Rest":"Long Rest")))}),F("input",Me,fe=>{se.update(te=>(te.classFeatures.features[e(x)]=parseInt(fe.currentTarget.value)||0,te))}),F("click",_,()=>Z(e(x),e(ee))),c(qe,ue)},Te=qe=>{var ee=nt(),ue=He(ee);{var Me=Qe=>{var De=Yl(),_=r(De),N=s(_,2),fe=r(N),te=r(fe);l(fe),l(N);var me=s(N,2);{var D=T=>{var K=Ql();c(T,K)};y(me,T=>{e(le)<=0&&T(D)})}l(De),R(()=>{_.disabled=e(le)<=0,L(te,`Resets on ${e(B),i(()=>e(B).resetOn==="short"?"Short Rest":"Long Rest")??""}`)}),F("click",_,G),c(Qe,De)};y(ue,Qe=>{e(B),i(()=>e(B).type==="channelDivinity")&&Qe(Me)},!0)}c(qe,ee)};y(Y,qe=>{e(B),i(()=>e(B).type==="pool")?qe(ke):qe(Te,!1)},!0)}c(we,I)};y(Be,we=>{e(B),i(()=>e(B).type==="uses")?we(We):we(lt,!1)})}l(q),R(we=>{L(ge,` ${e(B),i(()=>e(B).name)??""}`),L(Le,we)},[()=>(e(B),i(()=>Se(e(B))))]),c(Oe,q)}),l(_e),c(O,_e)};y($,O=>{e(S),i(()=>e(S).length===0)?O(J):O(de,!1)},!0)}c(Ie,g)};y(Q,Ie=>{t(),i(()=>!t().class)?Ie(Ne):Ie(Je,!1)})}c(h,P)};y(A,h=>{m(),i(()=>!m().classFeatures)&&h(ve)})}l(Ce),R(()=>he=ht(Ce,1,"class-features svelte-1kpvv0n",null,he,{hidden:!e(U)})),c(a,Ce),Et(),w()}var ar=f('<textarea placeholder="Enter features, traits, and special abilities..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Equipment</h3> <textarea placeholder="List your equipment and inventory..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Notes</h3> <textarea placeholder="Additional notes..." class="svelte-wttn0l"></textarea>',1),sr=f("<section><!> <!></section>");function lr(a,n){Tt(n,!1);const t=()=>tt(Zt,"$searchFilter",m),d=()=>tt(se,"$character",m),p=()=>tt(Rt,"$collapsedStates",m),[m,b]=Wt(),w=M();function k(){Rt.update(U=>({...U,notes:!U.notes}))}Ze(()=>(t(),d()),()=>{o(w,!t()||"features".includes(t().toLowerCase())||"traits".includes(t().toLowerCase())||"equipment".includes(t().toLowerCase())||"notes".includes(t().toLowerCase())||d().features.toLowerCase().includes(t().toLowerCase())||d().equipment.toLowerCase().includes(t().toLowerCase())||d().notes.toLowerCase().includes(t().toLowerCase()))}),Jt(),Pt();var S=sr();let X;var z=r(S);{let U=ot(()=>(p(),i(()=>p().notes?"Expand":"Collapse")));la(z,{title:"Features & Traits",get collapsed(){return p(),i(()=>p().notes)},get ariaLabel(){return e(U)},onToggle:k})}var le=s(z,2);{var ce=U=>{var re=ar(),be=He(re);da(be);var Z=s(be,4);da(Z);var Ue=s(Z,4);da(Ue),Ee(be,()=>d().features,Ve=>bt(se,i(d).features=Ve,i(d))),Ee(Z,()=>d().equipment,Ve=>bt(se,i(d).equipment=Ve,i(d))),Ee(Ue,()=>d().notes,Ve=>bt(se,i(d).notes=Ve,i(d))),c(U,re)};y(le,U=>{p(),i(()=>!p().notes)&&U(ce)})}l(S),R(()=>X=ht(S,1,"notes svelte-wttn0l",null,X,{hidden:!e(w)})),c(a,S),Et(),b()}var rr=f('<div class="color-picker-section svelte-1r90jgp"><h3 class="svelte-1r90jgp">Dice Colors</h3> <div class="color-inputs svelte-1r90jgp"><div class="color-input-group svelte-1r90jgp"><label for="dice-color" class="svelte-1r90jgp">Dice Color</label> <input type="color" id="dice-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="label-color" class="svelte-1r90jgp">Label Color</label> <input type="color" id="label-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="desk-color" class="svelte-1r90jgp">Background Color</label> <input type="color" id="desk-color" class="svelte-1r90jgp"/></div></div></div>'),ir=f('<div class="loading svelte-1r90jgp"><p class="svelte-1r90jgp">Loading 3D dice...</p></div>'),nr=f('<div class="custom-dice-selector svelte-1r90jgp"><h3 class="svelte-1r90jgp">Choose Dice to Roll</h3> <div class="dice-inputs svelte-1r90jgp"><div class="dice-input-group svelte-1r90jgp"><label for="d4" class="svelte-1r90jgp">d4</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d4" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d6" class="svelte-1r90jgp">d6</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d6" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d8" class="svelte-1r90jgp">d8</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d8" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d10" class="svelte-1r90jgp">d10</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d10" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d12" class="svelte-1r90jgp">d12</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d12" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d20" class="svelte-1r90jgp">d20</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d20" min="0" max="10"/></div></div> <div class="dice-controls svelte-1r90jgp"><button class="btn btn-primary use-enabled svelte-1r90jgp"> </button> <button class="btn btn-secondary use-enabled svelte-1r90jgp">Reset</button></div></div>'),or=f('<span class="crit-badge svelte-1r90jgp">CRITICAL HIT!</span>'),cr=f('<span class="crit-badge crit-fail svelte-1r90jgp">CRITICAL MISS!</span>'),vr=f('<div class="bonus-item svelte-1r90jgp"><span class="bonus-value svelte-1r90jgp"> </span> <span class="bonus-source svelte-1r90jgp"> </span></div>'),dr=f('<div class="bonus-breakdown svelte-1r90jgp"></div>'),ur=f('<p class="modifier-text svelte-1r90jgp"> </p>'),pr=f('<div class="svelte-1r90jgp"><em class="svelte-1r90jgp">No damage is dealt on a critical miss.</em></div>'),fr=f('<button class="btn btn-follow-up svelte-1r90jgp"> </button>'),gr=f('<button class="btn btn-guided-strike svelte-1r90jgp">âš¡ Use Guided Strike (+10)</button>'),mr=f('<div class="follow-up-actions svelte-1r90jgp"><!> <!></div>'),br=f('<div class="result-header svelte-1r90jgp"><h3 class="svelte-1r90jgp"> </h3> <!> <!></div> <div class="result-total svelte-1r90jgp"> </div> <div class="result-details svelte-1r90jgp"><!></div> <!> <!>',1),hr=f('<div role="button" tabindex="-1"><div class="modal-content svelte-1r90jgp" role="dialog" tabindex="0"><div class="modal-header svelte-1r90jgp"><h2 class="svelte-1r90jgp">Dice Roller</h2> <div class="header-buttons svelte-1r90jgp"><button class="color-btn svelte-1r90jgp" title="Customize dice colors">ðŸŽ¨</button> <button class="close-btn svelte-1r90jgp">Ã—</button></div></div> <!> <!> <div class="dice-main-area svelte-1r90jgp"><div class="dice-container svelte-1r90jgp"></div> <!></div> <div><!></div></div></div>');function _r(a,n){Tt(n,!1);const t=()=>tt(se,"$character",d),[d,p]=Wt(),m=M(),b=M(),w=M(),k=sa();let S=yt(n,"notation",12,""),X=yt(n,"visible",8,!1),z=yt(n,"damageNotation",12,""),le=yt(n,"attackName",12,""),ce=yt(n,"applyHalfDamage",8,!1),U=yt(n,"bonusBreakdown",28,()=>[]),re=yt(n,"rollType",12,"other"),be=null,Z=M(void 0),Ue=M(!1),Ve=M(""),W=M(null);function at(){return e(W)?.resultTotal??null}function Se(_,N,fe){const te=[];if(!_||!_.result)return te;const me=N.match(/([+-]?\d*d\d+|[+-]?\d+)/g)||[];let D=0;const T=new Set;for(const K of me){const je=K.trim();if(!je)continue;const Re=je.match(/([+-]?)(\d*)d(\d+)/);if(Re){const rt=parseInt(Re[2]||"1"),V=`${rt}d${Re[3]}`,dt=fe.findIndex((u,H)=>!T.has(H)&&typeof u.value=="string"&&u.value===V),Dt=[];for(let u=0;u<rt&&D<_.result.length;u++)Dt.push(_.result[D++]);const jt=dt>=0?fe[dt].source:"base die";dt>=0&&T.add(dt);for(const u of Dt)te.push({display:`${u}`,source:jt})}}for(let K=0;K<fe.length;K++)if(!T.has(K)&&typeof fe[K].value=="number"){const je=fe[K].value;te.push({display:je>=0?`+${je}`:`${je}`,source:fe[K].source})}return te}let G=M(0),ie=M(0),Ce=M(0),he=M(0),Fe=M(0),A=M(0),ve=M(0),h=M([]),P=M(!1),Q=M(!1),Ne=M(!1),Je=M("#051e0a"),Ie=M("#ffffff"),g=M("#3a2004"),$=M(!1);function J(_){return _.length===9&&_.startsWith("#")?_.substring(0,7):_}function de(_,N="ff"){return _.length===7&&_.startsWith("#")?_+N:_}function O(){if(window.DICE&&e(Z))try{be&&e(Z)&&aa(Z,e(Z).innerHTML="");const _=e(Z).clientWidth||500,N=e(Z).clientHeight||300;be=new window.DICE.dice_box(e(Z),{w:_,h:N}),o(Ue,!0)}catch(_){console.error("Error initializing dice box:",_)}}pa(()=>{const _=te=>new Promise((me,D)=>{if(document.querySelector(`script[src="${te}"]`)){me(null);return}const K=document.createElement("script");K.src=te,K.onload=()=>{me(null)},K.onerror=()=>{console.error(`Failed to load: ${te}`),D(new Error(`Failed to load ${te}`))},document.head.appendChild(K)});setTimeout(()=>{_(`${va}/libs/three.min.js`).then(()=>_(`${va}/libs/cannon.min.js`)).then(()=>_(`${va}/libs/teal.js`)).then(()=>_(`${va}/dice.js`)).then(()=>{if(window.DICE){const te=window.DICE.getColors();o(Je,J(te.dice_color)),o(Ie,J(te.label_color)),o(g,J(te.desk_color))}O()}).catch(te=>{console.error("Failed to load dice libraries:",te)})},100);const N=()=>{e(Ue)&&O()},fe=te=>{X()&&te.key==="Escape"&&oe()};return window.addEventListener("resize",N),window.addEventListener("keydown",fe),()=>{window.removeEventListener("resize",N),window.removeEventListener("keydown",fe)}});function _e(_,N="other"){if(!be||!e(Ue))return;o(W,null),o(h,[]),o(P,!1),o(Q,!1),N==="damage"&&U([]),re(N),o(Ne,!1),be.diceToRoll=_;const fe=me=>null,te=me=>{let D=me.resultTotal,T=me.resultString;if(ce()&&(D=Math.floor(D/2),T=T+" (halved)"),o(W,{...me,resultTotal:D,resultString:T}),console.log("Final roll result:",e(W)),console.log({type:N}),N==="attack"&&me.result&&me.result.length>0){const K=me.result[0];o(P,K===20),o(Q,K===1)}if(o(h,[]),console.log("Setting up follow-up actions. Type:",N,"damageNotation:",z(),"isCriticalSuccess:",e(P),"isCriticalFail:",e(Q)),N==="attack"&&z())if(e(P)){const K=ye(z());e(h).push({label:`Roll Critical Damage (${K})`,notation:K})}else e(Q)||e(h).push({label:`Roll Damage (${z()})`,notation:z()})};be.start_throw(fe,te)}function Ge(){const _=[];e(G)>0&&_.push(`${e(G)}d4`),e(ie)>0&&_.push(`${e(ie)}d6`),e(Ce)>0&&_.push(`${e(Ce)}d8`),e(he)>0&&_.push(`${e(he)}d10`),e(Fe)>0&&_.push(`${e(Fe)}d12`),e(A)>0&&_.push(`${e(A)}d20`);let N=_.join("+")||"1d20";return e(ve)!==0&&(N+=e(ve)>=0?`+${e(ve)}`:`${e(ve)}`),N}function st(){const _=Ge();_e(_)}function ye(_){return _.replace(/(\d+)d(\d+)/g,(N,fe,te)=>`${parseInt(fe)*2}d${te}`)}function Oe(){o(G,0),o(ie,0),o(Ce,0),o(he,0),o(Fe,0),o(A,0),o(ve,0),o(W,null),o(h,[]),o(P,!1),o(Q,!1),re("other"),o(Ne,!1)}function B(){window.DICE&&(window.DICE.setColors({dice_color:de(e(Je),"ff"),label_color:de(e(Ie),"ff"),desk_color:e(g)}),be&&(be.updateDeskColor(e(g)),be.updateDiceColors()))}function x(){o($,!e($))}function ne(){!e(W)||e(b)<=0||e(Ne)||(o(W,{...e(W),resultTotal:e(W).resultTotal+10,resultString:e(W).resultString+" + 10 (Guided Strike)"}),se.update(_=>{const N="ChannelDivinity",fe=_.classFeatures.features[N];return typeof fe=="number"&&fe>0&&(_.classFeatures.features[N]=fe-1),_}),o(Ne,!0))}function oe(){k("close"),S(""),z(""),le(""),o(Ve,""),o(W,null),o(Ne,!1),o(P,!1),o(Q,!1),Oe()}Ze(()=>(t(),oa),()=>{o(m,t().class?oa(t().class,t().level,t().subclass).some(N=>N.name==="Guided Strike"):!1)}),Ze(()=>t(),()=>{o(b,(()=>{const N=t().classFeatures.features["ChannelDivinity"];return typeof N=="number"?N:0})())}),Ze(()=>(e(G),e(ie),e(Ce),e(he),e(Fe),e(A),e(ve)),()=>{o(w,(()=>{const _=[];e(G)>0&&_.push(`${e(G)}d4`),e(ie)>0&&_.push(`${e(ie)}d6`),e(Ce)>0&&_.push(`${e(Ce)}d8`),e(he)>0&&_.push(`${e(he)}d10`),e(Fe)>0&&_.push(`${e(Fe)}d12`),e(A)>0&&_.push(`${e(A)}d20`);let N=_.join("+")||"1d20";return e(ve)!==0&&(N+=e(ve)>=0?`+${e(ve)}`:`${e(ve)}`),N})())}),Ze(()=>(E(S()),e(Ue),E(X()),e(Ve),E(z()),E(le()),E(re())),()=>{S()&&e(Ue)&&X()&&S()!==e(Ve)&&(o(Ve,S()),o(W,null),o(h,[]),o(P,!1),o(Q,!1),o(Ne,!1),console.log("Auto-roll triggered. notation:",S(),"damageNotation:",z(),"attackName:",le(),"rollType:",re()),setTimeout(()=>_e(S(),re()),200))}),Jt();var q={getLastRollTotal:at};Pt();var v=hr();let Pe;var pe=r(v),ge=r(pe),j=s(r(ge),2),Le=r(j),Be=s(Le,2);l(j),l(ge);var We=s(ge,2);{var lt=_=>{var N=rr(),fe=s(r(N),2),te=r(fe),me=s(r(te),2);xe(me),l(te);var D=s(te,2),T=s(r(D),2);xe(T),l(D);var K=s(D,2),je=s(r(K),2);xe(je),l(K),l(fe),l(N),Ee(me,()=>e(Je),Re=>o(Je,Re)),F("change",me,B),Ee(T,()=>e(Ie),Re=>o(Ie,Re)),F("change",T,B),Ee(je,()=>e(g),Re=>o(g,Re)),F("change",je,B),c(_,N)};y(We,_=>{e($)&&_(lt)})}var we=s(We,2);{var I=_=>{var N=ir();c(_,N)};y(we,_=>{e(Ue)||_(I)})}var Y=s(we,2),ke=r(Y);ja(ke,_=>o(Z,_),()=>e(Z));var Te=s(ke,2);{var qe=_=>{var N=nr(),fe=s(r(N),2),te=r(fe),me=s(r(te),2);xe(me),l(te);var D=s(te,2),T=s(r(D),2);xe(T),l(D);var K=s(D,2),je=s(r(K),2);xe(je),l(K);var Re=s(K,2),rt=s(r(Re),2);xe(rt),l(Re);var V=s(Re,2),dt=s(r(V),2);xe(dt),l(V);var Dt=s(V,2),jt=s(r(Dt),2);xe(jt),l(Dt),l(fe);var u=s(fe,2),H=r(u),C=r(H);l(H);var Ae=s(H,2);l(u),l(N),R(()=>{H.disabled=!e(Ue),L(C,`Roll ${e(w)??""}`)}),Ee(me,()=>e(G),ae=>o(G,ae)),Ee(T,()=>e(ie),ae=>o(ie,ae)),Ee(je,()=>e(Ce),ae=>o(Ce,ae)),Ee(rt,()=>e(he),ae=>o(he,ae)),Ee(dt,()=>e(Fe),ae=>o(Fe,ae)),Ee(jt,()=>e(A),ae=>o(A,ae)),F("click",H,st),F("click",Ae,Oe),c(_,N)};y(Te,_=>{S()||_(qe)})}l(Y);var ee=s(Y,2);let ue;var Me=r(ee);{var Qe=_=>{var N=br(),fe=He(N),te=r(fe),me=r(te,!0);l(te);var D=s(te,2);{var T=Ae=>{var ae=or();c(Ae,ae)};y(D,Ae=>{e(P)&&Ae(T)})}var K=s(D,2);{var je=Ae=>{var ae=cr();c(Ae,ae)};y(K,Ae=>{e(Q)&&Ae(je)})}l(fe);var Re=s(fe,2),rt=r(Re,!0);l(Re);var V=s(Re,2),dt=r(V);{var Dt=Ae=>{var ae=nt(),Xe=He(ae);{var $e=ze=>{var it=dr();_t(it,5,()=>(e(W),E(S()),E(U()),i(()=>Se(e(W),S(),U()))),kt,(et,pt)=>{var ft=vr(),gt=r(ft),Ye=r(gt,!0);l(gt);var ct=s(gt,2),mt=r(ct);l(ct),l(ft),R(()=>{L(Ye,(e(pt),i(()=>e(pt).display))),L(mt,`(${e(pt),i(()=>e(pt).source)??""})`)}),c(et,ft)}),l(it),c(ze,it)},ut=ze=>{var it=nt(),et=He(it);{var pt=ft=>{var gt=ur(),Ye=r(gt);l(gt),R(()=>L(Ye,`Modifier: ${e(W),i(()=>e(W).constant>=0?"+":"")??""}${e(W),i(()=>e(W).constant)??""}`)),c(ft,gt)};y(et,ft=>{e(W),i(()=>e(W).constant)&&ft(pt)},!0)}c(ze,it)};y(Xe,ze=>{E(U()),i(()=>U().length>0)?ze($e):ze(ut,!1)})}c(Ae,ae)};y(dt,Ae=>{e(W),E(U()),i(()=>e(W).constant||U().length>0)&&Ae(Dt)})}l(V);var jt=s(V,2);{var u=Ae=>{var ae=pr();c(Ae,ae)};y(jt,Ae=>{e(Q)&&Ae(u)})}var H=s(jt,2);{var C=Ae=>{var ae=mr(),Xe=r(ae);_t(Xe,1,()=>e(h),kt,(ze,it)=>{var et=fr(),pt=r(et,!0);l(et),R(()=>L(pt,(e(it),i(()=>e(it).label)))),F("click",et,()=>_e(e(it).notation,"damage")),c(ze,et)});var $e=s(Xe,2);{var ut=ze=>{var it=gr();R(()=>{it.disabled=e(b)<=0,Ke(it,"title",e(b)<=0?"No Channel Divinity uses remaining":"Use Channel Divinity to add +10 to this attack roll")}),F("click",it,ne),c(ze,it)};y($e,ze=>{e(m)&&re()==="attack"&&!e(Ne)&&e(b)>0&&!e(Q)&&ze(ut)})}l(ae),c(Ae,ae)};y(H,Ae=>{e(h),e(m),E(re()),e(Ne),e(b),i(()=>e(h).length>0||e(m)&&re()==="attack"&&!e(Ne)&&e(b)>0)&&Ae(C)})}R(()=>{L(me,le()?`${le()} - Result`:"Result"),L(rt,(e(W),i(()=>e(W).resultTotal)))}),c(_,N)};y(Me,_=>{e(W)&&_(Qe)})}l(ee),l(pe),l(v),R(()=>{Pe=ht(v,1,"modal-overlay svelte-1r90jgp",null,Pe,{hidden:!X()}),ue=ht(ee,1,"roll-result svelte-1r90jgp",null,ue,{"has-result":e(W)})}),F("click",Le,x),F("click",Be,oe),F("click",pe,Ea(function(_){na.call(this,n,_)})),F("keydown",pe,function(_){na.call(this,n,_)}),F("click",v,oe),F("keydown",v,_=>_.key==="Escape"&&oe()),c(a,v),Cs(n,"getLastRollTotal",at);var De=Et(q);return p(),De}const Sa="https://api.github.com/gists";async function yr(a,n,t){if(!n)throw new Error("GitHub token is required");const d=JSON.stringify(a,null,2),p=`${a.name||"character"}_dnd.json`,m={description:t||`D&D Character: ${a.name}`,public:!1,files:{[p]:{content:d}}},b=await fetch(Sa,{method:"POST",headers:{Authorization:`token ${n}`,"Content-Type":"application/json"},body:JSON.stringify(m)});if(!b.ok)throw new Error(`Failed to create gist: ${b.statusText}`);return(await b.json()).id}async function kr(a,n,t){if(!n||!t)throw new Error("GitHub token and Gist ID are required");const d=JSON.stringify(a,null,2),m={files:{[`${a.name||"character"}_dnd.json`]:{content:d}}},b=await fetch(`${Sa}/${t}`,{method:"PATCH",headers:{Authorization:`token ${n}`,"Content-Type":"application/json"},body:JSON.stringify(m)});if(!b.ok)throw new Error(`Failed to update gist: ${b.statusText}`)}async function Sr(a,n){if(!a)throw new Error("Gist ID is required");const t={"Content-Type":"application/json"};n&&(t.Authorization=`token ${n}`);const d=await fetch(`${Sa}/${a}`,{method:"GET",headers:t});if(!d.ok)throw new Error(`Failed to load gist: ${d.statusText}`);const p=await d.json(),m=Object.values(p.files);if(m.length===0)throw new Error("No files found in gist");const w=m[0].content;try{const k=JSON.parse(w);return k.attacks&&Array.isArray(k.attacks)&&(k.attacks=k.attacks.map(S=>({...S,id:S.id||crypto.randomUUID()}))),k.classFeatures?(k.classFeatures.features||(k.classFeatures.features={}),k.classFeatures.spellSlots||(k.classFeatures.spellSlots=[]),k.classFeatures.preparedSpells===void 0&&(k.classFeatures.preparedSpells="")):k.classFeatures={features:{},spellSlots:[],preparedSpells:""},k}catch{throw new Error("Invalid character data in gist")}}function Ja(a){typeof window<"u"&&localStorage.setItem("dnd_gist_config",JSON.stringify(a))}function xr(){if(typeof window<"u"){const a=localStorage.getItem("dnd_gist_config");if(a)return JSON.parse(a)}return{}}async function $r(a,n=30){if(!a)throw new Error("GitHub token is required to list gists");const t=await fetch(`${Sa}?per_page=${n}`,{method:"GET",headers:{Authorization:`token ${a}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error(`Failed to list gists: ${t.statusText}`);return await t.json()}var Cr=f('<div class="error-message svelte-1jb5ckg"> </div>'),Lr=f('<div class="toggle-container svelte-1jb5ckg"><button type="button" class="toggle-btn svelte-1jb5ckg"> </button></div>'),wr=f('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID (leave empty to create new)</label> <input type="text" id="gistId" placeholder="Optional: existing Gist ID to update" class="svelte-1jb5ckg"/></div>'),Dr=f('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),jr=f('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),Ar=f('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Update (or leave unselected to create new)</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),Br=f('<div class="info-message svelte-1jb5ckg">No gists found. A new one will be created.</div>'),Fr=f('<!> <div class="form-group svelte-1jb5ckg"><label for="description" class="svelte-1jb5ckg"> </label> <input type="text" id="description" placeholder="D&amp;D Character Sheet" class="svelte-1jb5ckg"/></div>',1),Mr=f('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID *</label> <input type="text" id="gistId" placeholder="Enter Gist ID (for public or your private gists)" required class="svelte-1jb5ckg"/></div>'),Rr=f('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),Ir=f('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),Pr=f('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Load</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),Tr=f('<div class="info-message svelte-1jb5ckg">No gists found. Enter a Gist ID manually or create a new one in Save mode.</div>'),Er=f('<div class="modal-overlay svelte-1jb5ckg" role="button" tabindex="-1"><div class="modal-content svelte-1jb5ckg" role="dialog" tabindex="0"><div class="modal-header svelte-1jb5ckg"><h2 class="svelte-1jb5ckg"> </h2> <button class="close-btn svelte-1jb5ckg">Ã—</button></div> <div class="modal-body svelte-1jb5ckg"><!> <div class="form-group svelte-1jb5ckg"><label for="token" class="svelte-1jb5ckg"> <a href="https://github.com/settings/tokens" target="_blank" rel="noopener" class="svelte-1jb5ckg">Get token</a></label> <input type="password" id="token" placeholder="ghp_xxxxxxxxxxxxx" class="svelte-1jb5ckg"/></div> <!> <!> <div class="modal-actions svelte-1jb5ckg"><button class="btn btn-primary svelte-1jb5ckg"><!></button> <button class="btn btn-secondary svelte-1jb5ckg">Cancel</button></div></div></div></div>');function Hr(a,n){Tt(n,!1);const t=()=>tt(se,"$character",d),[d,p]=Wt(),m=sa();let b=yt(n,"mode",8,"save"),w=M(""),k=M(""),S=M(""),X=M(!1),z=M(""),le=M(!1),ce=M(!1),U=M([]),re=M(null);const be=xr();be.token&&o(w,be.token),be.gistId&&o(k,be.gistId),pa(async()=>{e(w)&&!e(le)&&await Z()});async function Z(){if(e(w)){o(ce,!0),o(z,"");try{o(U,await $r(e(w))),e(k)&&o(re,e(U).find(x=>x.id===e(k))||null)}catch(x){o(z,x.message||"Failed to load gists"),o(U,[])}finally{o(ce,!1)}}}function Ue(x){o(re,x),o(k,x.id)}function Ve(){o(le,!e(le)),o(z,""),!e(le)&&e(w)&&Z()}async function W(){if(!e(w)){o(z,"GitHub token is required");return}const x=e(re)?.id||e(k);o(X,!0),o(z,"");try{if(x)await kr(t(),e(w),x),o(k,x),Ot.add("Character updated in Gist successfully!","success");else{const ne=await yr(t(),e(w),e(S));o(k,ne),Ot.add(`Character saved to Gist! ID: ${ne}`,"success")}Ja({token:e(w),gistId:e(k)}),m("close")}catch(ne){o(z,ne.message||"Failed to save to Gist")}finally{o(X,!1)}}async function at(){const x=e(re)?.id||e(k);if(!x){o(z,"Please select a gist or enter a Gist ID");return}o(X,!0),o(z,"");try{const ne=await Sr(x,e(w)||void 0);se.set(ne),o(k,x),Ja({token:e(w),gistId:e(k)}),Ot.add("Character loaded from Gist successfully!","success"),m("close")}catch(ne){o(z,ne.message||"Failed to load from Gist")}finally{o(X,!1)}}function Se(){m("close")}Pt();var G=Er(),ie=r(G),Ce=r(ie),he=r(Ce),Fe=r(he,!0);l(he);var A=s(he,2);l(Ce);var ve=s(Ce,2),h=r(ve);{var P=x=>{var ne=Cr(),oe=r(ne,!0);l(ne),R(()=>L(oe,e(z))),c(x,ne)};y(h,x=>{e(z)&&x(P)})}var Q=s(h,2),Ne=r(Q),Je=r(Ne);ra(),l(Ne);var Ie=s(Ne,2);xe(Ie),l(Q);var g=s(Q,2);{var $=x=>{var ne=Lr(),oe=r(ne),q=r(oe,!0);l(oe),l(ne),R(()=>{oe.disabled=e(X),L(q,e(le)?"ðŸ“‹ Show My Gists":"âœï¸ Enter Gist ID Manually")}),F("click",oe,Ve),c(x,ne)};y(g,x=>{(b()==="load"||b()==="save"&&e(w))&&x($)})}var J=s(g,2);{var de=x=>{var ne=Fr(),oe=He(ne);{var q=Le=>{var Be=wr(),We=s(r(Be),2);xe(We),l(Be),R(()=>We.disabled=e(X)),Ee(We,()=>e(k),lt=>o(k,lt)),c(Le,Be)},v=Le=>{var Be=nt(),We=He(Be);{var lt=I=>{var Y=Dr();c(I,Y)},we=I=>{var Y=nt(),ke=He(Y);{var Te=ee=>{var ue=Ar(),Me=s(r(ue),2);_t(Me,5,()=>e(U),kt,(Qe,De)=>{var _=jr();let N;var fe=r(_),te=r(fe),me=r(te,!0);l(te);var D=s(te,2),T=r(D,!0);l(D),l(fe);var K=s(fe,2),je=r(K),Re=r(je);l(je);var rt=s(je,2),V=r(rt);l(rt),l(K),l(_),R(dt=>{N=ht(_,1,"gist-item svelte-1jb5ckg",null,N,{selected:e(re)?.id===e(De).id}),_.disabled=e(X),L(me,(e(De),i(()=>e(De).description||"Untitled"))),L(T,(e(De),i(()=>e(De).public?"ðŸŒ Public":"ðŸ”’ Private"))),L(Re,`ID: ${e(De),i(()=>e(De).id)??""}`),L(V,`Updated: ${dt??""}`)},[()=>(e(De),i(()=>new Date(e(De).updated_at).toLocaleDateString()))]),F("click",_,()=>Ue(e(De))),c(Qe,_)}),l(Me),l(ue),c(ee,ue)},qe=ee=>{var ue=nt(),Me=He(ue);{var Qe=De=>{var _=Br();c(De,_)};y(Me,De=>{e(w)&&De(Qe)},!0)}c(ee,ue)};y(ke,ee=>{e(U),i(()=>e(U).length>0)?ee(Te):ee(qe,!1)},!0)}c(I,Y)};y(We,I=>{e(ce)?I(lt):I(we,!1)},!0)}c(Le,Be)};y(oe,Le=>{e(le)||!e(w)?Le(q):Le(v,!1)})}var Pe=s(oe,2),pe=r(Pe),ge=r(pe);l(pe);var j=s(pe,2);xe(j),l(Pe),R(()=>{L(ge,`Description ${e(k)?"(optional)":""}`),j.disabled=e(X)}),Ee(j,()=>e(S),Le=>o(S,Le)),c(x,ne)},O=x=>{var ne=nt(),oe=He(ne);{var q=Pe=>{var pe=Mr(),ge=s(r(pe),2);xe(ge),l(pe),R(()=>ge.disabled=e(X)),Ee(ge,()=>e(k),j=>o(k,j)),c(Pe,pe)},v=Pe=>{var pe=nt(),ge=He(pe);{var j=Be=>{var We=Rr();c(Be,We)},Le=Be=>{var We=nt(),lt=He(We);{var we=Y=>{var ke=Pr(),Te=s(r(ke),2);_t(Te,5,()=>e(U),kt,(qe,ee)=>{var ue=Ir();let Me;var Qe=r(ue),De=r(Qe),_=r(De,!0);l(De);var N=s(De,2),fe=r(N,!0);l(N),l(Qe);var te=s(Qe,2),me=r(te),D=r(me);l(me);var T=s(me,2),K=r(T);l(T),l(te),l(ue),R(je=>{Me=ht(ue,1,"gist-item svelte-1jb5ckg",null,Me,{selected:e(re)?.id===e(ee).id}),ue.disabled=e(X),L(_,(e(ee),i(()=>e(ee).description||"Untitled"))),L(fe,(e(ee),i(()=>e(ee).public?"ðŸŒ Public":"ðŸ”’ Private"))),L(D,`ID: ${e(ee),i(()=>e(ee).id)??""}`),L(K,`Updated: ${je??""}`)},[()=>(e(ee),i(()=>new Date(e(ee).updated_at).toLocaleDateString()))]),F("click",ue,()=>Ue(e(ee))),c(qe,ue)}),l(Te),l(ke),c(Y,ke)},I=Y=>{var ke=nt(),Te=He(ke);{var qe=ee=>{var ue=Tr();c(ee,ue)};y(Te,ee=>{e(w)&&ee(qe)},!0)}c(Y,ke)};y(lt,Y=>{e(U),i(()=>e(U).length>0)?Y(we):Y(I,!1)},!0)}c(Be,We)};y(ge,Be=>{e(ce)?Be(j):Be(Le,!1)},!0)}c(Pe,pe)};y(oe,Pe=>{e(le)||!e(w)?Pe(q):Pe(v,!1)},!0)}c(x,ne)};y(J,x=>{b()==="save"?x(de):x(O,!1)})}var _e=s(J,2),Ge=r(_e),st=r(Ge);{var ye=x=>{var ne=Mt();R(()=>L(ne,b()==="save"?"Saving...":"Loading...")),c(x,ne)},Oe=x=>{var ne=Mt();R(()=>L(ne,b()==="save"?"Save":"Load")),c(x,ne)};y(st,x=>{e(X)?x(ye):x(Oe,!1)})}l(Ge);var B=s(Ge,2);l(_e),l(ve),l(ie),l(G),R(()=>{L(Fe,b()==="save"?"Save to GitHub Gist":"Load from GitHub Gist"),L(Je,`GitHub Token ${b()==="load"?"(optional for public gists)":"(required)"} `),Ie.disabled=e(X),Ge.disabled=e(X),B.disabled=e(X)}),F("click",A,Se),Ee(Ie,()=>e(w),x=>o(w,x)),F("blur",Ie,()=>{e(w)&&!e(le)&&Z()}),F("click",Ge,function(...x){(b()==="save"?W:at)?.apply(this,x)}),F("click",B,Se),F("click",ie,Ea(function(x){na.call(this,n,x)})),F("keydown",ie,function(x){na.call(this,n,x)}),F("click",G,Se),F("keydown",G,x=>x.key==="Escape"&&Se()),c(a,G),Et(),p()}var Ur=f('<div class="loading svelte-1ngjemu">Loading D&D data...</div>'),Nr=f("<option> </option>"),Gr=f('<select class="level-filter svelte-1ngjemu"><option>All Levels</option><option>Cantrip</option><!></select>'),Or=f('<div class="no-results svelte-1ngjemu"> </div>'),qr=f('<div class="item-meta svelte-1ngjemu"> </div>'),Wr=f('<div class="item-meta svelte-1ngjemu"> </div>'),zr=f('<button><div class="item-name svelte-1ngjemu"> </div> <!></button>'),Kr=f('<p class="higher-levels"><strong>At Higher Levels:</strong> </p>'),Vr=f('<p class="cantrip-upgrade"><strong>Cantrip Upgrade:</strong> </p>'),Jr=f('<h3 class="svelte-1ngjemu"> </h3> <p class="spell-meta svelte-1ngjemu"><!> <!></p> <p class="spell-classes"><strong>Classes:</strong> </p> <div class="spell-stats svelte-1ngjemu"><div><strong>Casting Time:</strong> </div> <div><strong>Range:</strong> </div> <div><strong>Components:</strong> <!></div> <div><strong>Duration:</strong> <!> </div></div> <p class="description svelte-1ngjemu"> </p> <!> <!>',1),Qr=f('<p class="prerequisite svelte-1ngjemu"><strong>Prerequisite:</strong> </p>'),Yr=f('<h3 class="svelte-1ngjemu"> </h3> <!> <p class="description svelte-1ngjemu"> </p> <a target="_blank" rel="noopener" class="source-link svelte-1ngjemu">View Full Details â†’</a>',1),Xr=f('<div class="item-details svelte-1ngjemu"><!></div>'),Zr=f('<div class="controls svelte-1ngjemu"><div class="tabs svelte-1ngjemu"><button> </button> <button> </button></div> <div class="search-controls svelte-1ngjemu"><input type="text" placeholder="Search by name or description..." class="search-input svelte-1ngjemu"/> <!></div></div> <div class="content-container svelte-1ngjemu"><div class="items-list svelte-1ngjemu"><!></div> <!></div>',1),ei=f('<div class="modal-backdrop svelte-1ngjemu" role="presentation"><div class="modal svelte-1ngjemu" role="dialog" aria-modal="true" tabindex="-1"><div class="modal-header svelte-1ngjemu"><h2 class="svelte-1ngjemu">Browse D&D Spells & Feats</h2> <button class="close-btn svelte-1ngjemu" aria-label="Close">&times;</button></div> <div class="modal-body svelte-1ngjemu"><!></div> <div class="modal-footer svelte-1ngjemu"><button class="btn-secondary svelte-1ngjemu">Cancel</button> <button class="btn-primary svelte-1ngjemu">Add to Character Sheet</button></div></div></div>');function ti(a,n){Tt(n,!1);const t=M(),d=M(),p=M();let m=yt(n,"onClose",8),b=M("spell"),w=M(!0),k=M(""),S=M(null),X=M([]),z=M([]),le=M(null);pa(async()=>{o(w,!0);try{o(X,await ss()),o(z,await Ys())}catch(A){console.error("Failed to load data:",A)}finally{o(w,!1)}});function ce(A){o(le,A)}function U(A){const ve=A.match(/(\d+d\d+(?:\s*\+\s*\d+)?)/i);return ve?ve[1]:""}function re(A){const ve=A.split(/\.( |$)/)[0].trim(),h=Array.from(A.matchAll(/\*\*(.*?)\*\*/g)).map(Q=>Q[1].replace(/\.$/,""));let P=ve;return h.length&&(P+=" | Effects: "+h.join(", ")),P}function be(){if(e(le)){if(e(b)==="spell"){const A=e(le);se.update(ve=>{const P=[];A.range&&P.push(`Range: ${A.range}`),A.castingTime&&P.push(`Cast: ${A.castingTime}`),A.duration&&P.push(`Duration: ${A.duration}`),A.actionType==="Save"&&P.push("Saving throw spell"),A.components&&A.components.length>0&&P.push(`Components: ${A.components.join(", ")}`),A.material&&P.push(`Material: ${A.material}`);const Q=P.join(" | "),Ne=re(A.description),Je={id:crypto.randomUUID(),name:`${A.name}${A.concentration?" (C)":""}${A.ritual?" (R)":""}`,bonus:A.actionType==="Attack"?5:0,damage:U(A.description),damageType:`${A.school} (Lvl ${A.level})`,spellRef:A.name,infoNotes:Q,generalNotes:Ne,castAtLevel:A.level};return ve.attacks=[...ve.attacks,Je],ve})}else if(e(b)==="feat"){const A=e(le);se.update(ve=>{const h=`${A.name}${A.prerequisite?` (Req: ${A.prerequisite})`:""}
${A.description}
`;return ve.features=ve.features?`${ve.features}
${h}`:h,ve})}o(le,null),m()()}}Ze(()=>(e(S),e(X),e(k)),()=>{o(t,e(S)!==null?Xs(za(e(X),e(k)),e(S)):za(e(X),e(k)))}),Ze(()=>(e(z),e(k)),()=>{o(d,Zs(e(z),e(k)))}),Ze(()=>(e(b),e(t),e(d)),()=>{o(p,e(b)==="spell"?e(t):e(d))}),Jt(),Pt();var Z=ei(),Ue=r(Z),Ve=r(Ue),W=s(r(Ve),2);l(Ve);var at=s(Ve,2),Se=r(at);{var G=A=>{var ve=Ur();c(A,ve)},ie=A=>{var ve=Zr(),h=He(ve),P=r(h),Q=r(P);let Ne;var Je=r(Q);l(Q);var Ie=s(Q,2);let g;var $=r(Ie);l(Ie),l(P);var J=s(P,2),de=r(J);xe(de);var O=s(de,2);{var _e=oe=>{var q=Gr();R(()=>{e(S),wt(()=>{})});var v=r(q);v.value=(v.__value=null)??"";var Pe=s(v);Pe.value=Pe.__value=0;var pe=s(Pe);_t(pe,0,()=>[1,2,3,4,5,6,7,8,9],kt,(ge,j)=>{var Le=Nr(),Be=r(Le);l(Le);var We={};R(()=>{L(Be,`Level ${j??""}`),We!==(We=j)&&(Le.value=(Le.__value=j)??"")}),c(ge,Le)}),l(q),Ba(q,()=>e(S),ge=>o(S,ge)),c(oe,q)};y(O,oe=>{e(b)==="spell"&&oe(_e)})}l(J),l(h);var Ge=s(h,2),st=r(Ge),ye=r(st);{var Oe=oe=>{var q=Or(),v=r(q);l(q),R(()=>L(v,`No ${e(b)??""}s found`)),c(oe,q)},B=oe=>{var q=nt(),v=He(q);_t(v,1,()=>e(p),kt,(Pe,pe)=>{var ge=zr();let j;var Le=r(ge),Be=r(Le,!0);l(Le);var We=s(Le,2);{var lt=I=>{const Y=ot(()=>e(pe));var ke=qr(),Te=r(ke);l(ke),R(()=>L(Te,`Level ${E(e(Y)),i(()=>e(Y).level)??""} â€¢ ${E(e(Y)),i(()=>e(Y).school)??""}`)),c(I,ke)},we=I=>{const Y=ot(()=>e(pe));var ke=nt(),Te=He(ke);{var qe=ee=>{var ue=Wr(),Me=r(ue,!0);l(ue),R(()=>L(Me,(E(e(Y)),i(()=>e(Y).prerequisite)))),c(ee,ue)};y(Te,ee=>{E(e(Y)),i(()=>e(Y).prerequisite)&&ee(qe)})}c(I,ke)};y(We,I=>{e(b)==="spell"?I(lt):I(we,!1)})}l(ge),R(()=>{j=ht(ge,1,"item-card svelte-1ngjemu",null,j,{selected:e(le)?.name===e(pe).name}),L(Be,(e(pe),i(()=>e(pe).name)))}),F("click",ge,()=>ce(e(pe))),c(Pe,ge)}),c(oe,q)};y(ye,oe=>{e(p),i(()=>e(p).length===0)?oe(Oe):oe(B,!1)})}l(st);var x=s(st,2);{var ne=oe=>{var q=Xr(),v=r(q);{var Pe=ge=>{const j=ot(()=>e(le));var Le=Jr(),Be=He(Le),We=r(Be,!0);l(Be);var lt=s(Be,2),we=r(lt);{var I=u=>{var H=Mt();R(()=>L(H,`${E(e(j)),i(()=>e(j).school)??""} cantrip`)),c(u,H)},Y=u=>{var H=Mt();R(()=>L(H,`Level ${E(e(j)),i(()=>e(j).level)??""} ${E(e(j)),i(()=>e(j).school)??""}`)),c(u,H)};y(we,u=>{E(e(j)),i(()=>e(j).level===0)?u(I):u(Y,!1)})}var ke=s(we,2);{var Te=u=>{var H=Mt("(ritual)");c(u,H)};y(ke,u=>{E(e(j)),i(()=>e(j).ritual)&&u(Te)})}l(lt);var qe=s(lt,2),ee=s(r(qe));l(qe);var ue=s(qe,2),Me=r(ue),Qe=s(r(Me));l(Me);var De=s(Me,2),_=s(r(De));l(De);var N=s(De,2),fe=s(r(N)),te=s(fe);{var me=u=>{var H=Mt();R(()=>L(H,`(${E(e(j)),i(()=>e(j).material)??""})`)),c(u,H)};y(te,u=>{E(e(j)),i(()=>e(j).material)&&u(me)})}l(N);var D=s(N,2),T=s(r(D),2);{var K=u=>{var H=Mt("Concentration,");c(u,H)};y(T,u=>{E(e(j)),i(()=>e(j).concentration)&&u(K)})}var je=s(T,1,!0);l(D),l(ue);var Re=s(ue,2),rt=r(Re,!0);l(Re);var V=s(Re,2);{var dt=u=>{var H=Kr(),C=s(r(H));l(H),R(()=>L(C,` ${E(e(j)),i(()=>e(j).higherLevelSlot)??""}`)),c(u,H)};y(V,u=>{E(e(j)),i(()=>e(j).higherLevelSlot)&&u(dt)})}var Dt=s(V,2);{var jt=u=>{var H=Vr(),C=s(r(H));l(H),R(()=>L(C,` ${E(e(j)),i(()=>e(j).cantripUpgrade)??""}`)),c(u,H)};y(Dt,u=>{E(e(j)),i(()=>e(j).cantripUpgrade)&&u(jt)})}R((u,H)=>{L(We,(E(e(j)),i(()=>e(j).name))),L(ee,` ${u??""}`),L(Qe,` ${E(e(j)),i(()=>e(j).castingTime||e(j).actionType)??""}`),L(_,` ${E(e(j)),i(()=>e(j).range)??""}`),L(fe,` ${H??""}`),L(je,(E(e(j)),i(()=>e(j).duration))),L(rt,(E(e(j)),i(()=>e(j).description)))},[()=>(E(e(j)),i(()=>e(j).classes.join(", "))),()=>(E(e(j)),i(()=>e(j).components.join(", ").toUpperCase()))]),c(ge,Le)},pe=ge=>{const j=ot(()=>e(le));var Le=Yr(),Be=He(Le),We=r(Be,!0);l(Be);var lt=s(Be,2);{var we=Te=>{var qe=Qr(),ee=s(r(qe));l(qe),R(()=>L(ee,` ${E(e(j)),i(()=>e(j).prerequisite)??""}`)),c(Te,qe)};y(lt,Te=>{E(e(j)),i(()=>e(j).prerequisite)&&Te(we)})}var I=s(lt,2),Y=r(I,!0);l(I);var ke=s(I,2);R(()=>{L(We,(E(e(j)),i(()=>e(j).name))),L(Y,(E(e(j)),i(()=>e(j).description))),Ke(ke,"href",(E(e(j)),i(()=>e(j).source)))}),c(ge,Le)};y(v,ge=>{e(b)==="spell"?ge(Pe):ge(pe,!1)})}l(q),c(oe,q)};y(x,oe=>{e(le)&&oe(ne)})}l(Ge),R(()=>{Ne=ht(Q,1,"tab svelte-1ngjemu",null,Ne,{active:e(b)==="spell"}),L(Je,`ðŸ“œ Spells (${e(X),i(()=>e(X).length)??""})`),g=ht(Ie,1,"tab svelte-1ngjemu",null,g,{active:e(b)==="feat"}),L($,`â­ Feats (${e(z),i(()=>e(z).length)??""})`)}),F("click",Q,()=>{o(b,"spell"),o(le,null),o(k,"")}),F("click",Ie,()=>{o(b,"feat"),o(le,null),o(k,"")}),Ee(de,()=>e(k),oe=>o(k,oe)),c(A,ve)};y(Se,A=>{e(w)?A(G):A(ie,!1)})}l(at);var Ce=s(at,2),he=r(Ce),Fe=s(he,2);l(Ce),l(Ue),l(Z),R(()=>Fe.disabled=!e(le)),F("click",W,function(...A){m()?.apply(this,A)}),F("click",he,function(...A){m()?.apply(this,A)}),F("click",Fe,be),F("click",Ue,Ea(function(A){na.call(this,n,A)})),F("keydown",Ue,function(A){na.call(this,n,A)}),F("click",Z,function(...A){m()?.apply(this,A)}),F("keydown",Z,A=>A.key==="Escape"&&m()()),c(a,Z),Et()}var ai=f('<link rel="icon" type="image/png" href="favicon4.png"/> <meta name="viewport" content="width=device-width, initial-scale=1"/>',1),si=f('<span class="character-name svelte-1uha8ag"> </span>'),li=f("<span> </span>"),ri=f('<div class="spell-slots-header svelte-1uha8ag"></div>'),ii=f("<span> </span><br/>",1),ni=f("<span> </span>"),oi=f('<span class="effect-tooltip"><strong> </strong><br/> <br/> <!> <!></span>'),ci=f('<button class="effect-remove-btn svelte-1uha8ag">Ã—</button>'),vi=f('<span class="effect-badge svelte-1uha8ag" tabindex="0"> <!> <!></span>'),di=f(`<div class="active-effects-header svelte-1uha8ag"></div> <style>.effect-badge {
              position: relative;
            }
            .effect-tooltip {
              position: absolute;
              top: 120%;
              left: 50%;
              transform: translateX(-50%);
              background: #fff;
              color: #222;
              border: 1px solid #a5b4fc;
              border-radius: 6px;
              padding: 8px 12px;
              font-size: 0.95em;
              box-shadow: 0 2px 8px rgba(0, 0, 0, 0.12);
              z-index: 10;
              min-width: 180px;
              max-width: 260px;
              white-space: normal;
              pointer-events: none;
              opacity: 1;
              transition: opacity 0.15s;
            }</style>`,1),ui=f('<div class="rest-menu svelte-1uha8ag"><button class="rest-option svelte-1uha8ag">â˜• Short Rest</button> <button class="rest-option svelte-1uha8ag">ðŸ›ï¸ Long Rest</button></div>'),pi=f('<div class="container svelte-1uha8ag"><header class="svelte-1uha8ag"><div class="header-top svelte-1uha8ag"><div class="header-title svelte-1uha8ag"><div class="title-row svelte-1uha8ag"><h1 class="svelte-1uha8ag">D&D Character Sheet</h1> <!></div> <!> <!></div> <div class="header-right svelte-1uha8ag"><div class="header-controls svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">ðŸŽ²</span><span class="btn-text svelte-1uha8ag">Roll Dice</span></button> <div class="rest-button-container svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">ðŸ˜´</span><span class="btn-text svelte-1uha8ag">Rest</span></button> <!></div> <div class="mode-toggle"><button><span class="btn-icon svelte-1uha8ag"> </span><span class="btn-text svelte-1uha8ag"> </span></button></div></div> <div class="header-search svelte-1uha8ag"><input type="text" placeholder="ðŸ” Search..." class="search-input use-enabled svelte-1uha8ag"/></div></div></div> <div class="header-actions svelte-1uha8ag"><button class="btn btn-mode svelte-1uha8ag">ðŸ“š Browse Spells & Feats</button> <button class="btn btn-secondary">Save to Gist</button> <button class="btn btn-secondary">Load from Gist</button> <button class="btn btn-secondary">Export JSON</button> <button class="btn btn-secondary">Import JSON</button> <input type="file" accept=".json" style="display: none;"/></div></header> <main class="svelte-1uha8ag"><!> <!> <!> <!> <!> <!> <!></main></div> <!> <!> <!> <!>',1);function Si(a,n){Tt(n,!1);const t=()=>tt(se,"$character",m),d=()=>tt(ia,"$isEditMode",m),p=()=>tt(Zt,"$searchFilter",m),[m,b]=Wt();function w(){const u=[],H=t().classFeatures.spellSlotsByLevel||{};for(let C=1;C<=9;C++){const Ae=H[C];if(Ae&&Ae.length>0){const ae=Ae.length,Xe=Ae.filter($e=>$e).length;u.push({level:C,available:ae-Xe,total:ae})}}return u}let k=M(!1),S=M(!1),X=M(!1),z=M("save"),le=M(void 0),ce=M(""),U=M(""),re=M(""),be=M(!1),Z=M([]),Ue=M("other"),Ve=M(),W=!1,at=1,Se=M(!1),G=M(null);function ie(u){o(G,u)}function Ce(){o(G,null)}function he(u){o(G,e(G)===u?null:u)}function Fe(){const u=[];se.update(C=>{const Ae=C.hitDice.current;C.hitDice.current=Math.min(C.hitDice.max,C.hitDice.current+Math.max(1,Math.floor(C.hitDice.max/2)));const ae=C.hitDice.current-Ae;if(ae>0&&u.push(`${ae} hit ${ae===1?"die":"dice"}`),C.class){const Xe=oa(C.class,C.level,C.subclass);C.classFeatures.features||(C.classFeatures.features={}),Xe.forEach($e=>{if($e.resetOn==="short"){const ut=$e.name.replace(/\s+/g,"");if($e.type==="uses"){const ze=typeof $e.maxUses=="function"?$e.maxUses(C.level):$e.maxUses;C.classFeatures.features[ut]=Array(ze).fill(!1),u.push($e.name)}else if($e.type==="pool"){const ze=typeof $e.maxPool=="function"?$e.maxPool(C.level):$e.maxPool;ze!==void 0&&(C.classFeatures.features[ut]=ze,u.push($e.name))}}})}return C}),o(Se,!1);const H=u.length>0?`Short rest taken! Restored: ${u.join(", ")}`:"Short rest taken!";Ot.add(H,"success")}function A(){const u=[];se.update(C=>{const Ae=C.maxHP-C.currentHP;Ae>0&&u.push(`${Ae} HP`),C.currentHP=C.maxHP,C.tempHP=0;const ae=C.hitDice.max-C.hitDice.current;ae>0&&u.push(`${ae} hit ${ae===1?"die":"dice"}`),C.hitDice.current=C.hitDice.max;let Xe=0;if(C.classFeatures.spellSlotsByLevel&&Object.keys(C.classFeatures.spellSlotsByLevel).forEach($e=>{const ut=C.classFeatures.spellSlotsByLevel[parseInt($e)];if(ut){const ze=ut.filter(it=>it).length;Xe+=ze,C.classFeatures.spellSlotsByLevel[parseInt($e)]=Array(ut.length).fill(!1)}}),Xe>0&&u.push(`${Xe} spell ${Xe===1?"slot":"slots"}`),C.class){const $e=oa(C.class,C.level,C.subclass);C.classFeatures.features||(C.classFeatures.features={});let ut=!1;$e.forEach(ze=>{const it=ze.name.replace(/\s+/g,"");if(!(ze.type==="info"||ze.type==="channelDivinity")){if(ze.type==="uses"){const et=typeof ze.maxUses=="function"?ze.maxUses(C.level):ze.maxUses;C.classFeatures.features[it]=Array(et).fill(!1),ut=!0}else if(ze.type==="pool"){const et=typeof ze.maxPool=="function"?ze.maxPool(C.level):ze.maxPool;et!==void 0&&(C.classFeatures.features[it]=et,ut=!0)}}}),ut&&u.push("all class features")}return C}),o(Se,!1);const H=u.length>0?`Long rest taken! Restored: ${u.join(", ")}`:"Long rest taken! Fully rested.";Ot.add(H,"success")}function ve(u){o(ce,""),o(U,""),o(re,""),o(be,!1),o(Z,[]),o(Ue,"other"),W=!1,typeof u=="string"?o(ce,u):(o(ce,u.notation),o(U,u.damageNotation||""),o(re,u.attackName||""),o(be,!!u.applyHalfDamage),o(Z,u.bonusBreakdown||[]),o(Ue,u.rollType||"other")),o(k,!0)}function h(u){const{notation:H,count:C}=u.detail;o(ce,""),W=!0,at=C||1,setTimeout(()=>{o(ce,H),o(U,""),o(re,"Hit Die")},0),o(k,!0)}function P(){if(o(k,!1),W&&e(Ve)){const u=e(Ve).getLastRollTotal();if(u!==null){const H=Math.max(1,u);se.update(C=>(C.hitDice.current=Math.max(0,C.hitDice.current-at),C.currentHP=Math.min(C.maxHP,C.currentHP+H),C))}W=!1}}function Q(){ia.update(u=>!u)}function Ne(u){u.target.closest(".rest-button-container")||o(Se,!1)}pa(()=>{const u=ia.subscribe(H=>{H?document.body.classList.remove("use-mode"):document.body.classList.add("use-mode")});return document.addEventListener("click",Ne),()=>{u(),document.removeEventListener("click",Ne)}});function Je(){hs(t())}function Ie(){e(le)?.click()}async function g(u){const C=u.target.files?.[0];if(C)try{const Ae=await _s(C);se.set(Ae),alert("Character imported successfully!")}catch{alert("Failed to import character file")}}Pt();var $=pi();ms("1uha8ag",u=>{var H=ai();ra(2),Xa(()=>{fs.title="D&D Character Sheet"}),c(u,H)});var J=He($),de=r(J),O=r(de),_e=r(O),Ge=r(_e),st=s(r(Ge),2);{var ye=u=>{var H=si(),C=r(H);l(H),R(()=>L(C,`${t().name??""} (${t().level??""})`)),c(u,H)};y(st,u=>{t().name&&u(ye)})}l(Ge);var Oe=s(Ge,2);{var B=u=>{var H=ri();_t(H,5,w,kt,(C,Ae)=>{var ae=li();let Xe;var $e=r(ae);l(ae),R(()=>{Xe=ht(ae,1,"slot-badge svelte-1uha8ag",null,Xe,{depleted:e(Ae).available===0}),L($e,`Lv${e(Ae).level??""}: ${e(Ae).available??""}/${e(Ae).total??""}`)}),c(C,ae)}),l(H),c(u,H)};y(Oe,u=>{w().length>0&&u(B)})}var x=s(Oe,2);{var ne=u=>{var H=di(),C=He(H);_t(C,5,()=>t().activeStates,kt,(Ae,ae,Xe)=>{var $e=vi(),ut=r($e),ze=s(ut);{var it=ft=>{var gt=oi(),Ye=r(gt),ct=r(Ye,!0);l(Ye);var mt=s(Ye,2),xt=s(mt,3);{var Ht=$t=>{var Ct=ii(),Nt=He(Ct),vt=r(Nt);l(Nt),ra(),R(()=>L(vt,`Attack Bonus: ${typeof e(ae).attackBonus=="number"&&e(ae).attackBonus>0?"+":""}${e(ae).attackBonus??""}`)),c($t,Ct)};y(xt,$t=>{e(ae).attackBonus&&$t(Ht)})}var Ut=s(xt,2);{var Bt=$t=>{var Ct=ni(),Nt=r(Ct);l(Ct),R(()=>L(Nt,`Damage Bonus: ${typeof e(ae).damageBonus=="number"&&e(ae).damageBonus>0?"+":""}${e(ae).damageBonus??""}`)),c($t,Ct)};y(Ut,$t=>{e(ae).damageBonus&&$t(Bt)})}l(gt),R(()=>{L(ct,e(ae).name),L(mt,` ${e(ae).description??""}`)}),c(ft,gt)};y(ze,ft=>{e(G)===Xe&&ft(it)})}var et=s(ze,2);{var pt=ft=>{var gt=ci();R(()=>Ke(gt,"title",`End ${e(ae).name??""}`)),F("click",gt,()=>{se.update(Ye=>{if(Ye.activeStates){const ct=Ye.activeStates[Xe];ct?.hpBonus&&ct.target!=="other"&&(Ye.maxHP-=ct.hpBonus,Ye.currentHP=Math.max(1,Math.min(Ye.currentHP-ct.hpBonus,Ye.maxHP))),Ye.activeStates=Ye.activeStates.filter((mt,xt)=>xt!==Xe)}return Ye})}),c(ft,gt)};y(et,ft=>{d()||ft(pt)})}l($e),R(()=>{Ke($e,"aria-label",e(ae).name),L(ut,`âœ¨ ${e(ae).name??""} `)}),F("mouseenter",$e,()=>ie(Xe)),F("mouseleave",$e,Ce),F("focus",$e,()=>ie(Xe)),F("blur",$e,Ce),F("click",$e,()=>he(Xe)),c(Ae,$e)}),l(C),ra(2),c(u,H)};y(x,u=>{t().activeStates&&t().activeStates.length>0&&u(ne)})}l(_e);var oe=s(_e,2),q=r(oe),v=r(q),Pe=s(v,2),pe=r(Pe),ge=s(pe,2);{var j=u=>{var H=ui(),C=r(H),Ae=s(C,2);l(H),F("click",C,Fe),F("click",Ae,A),c(u,H)};y(ge,u=>{e(Se)&&u(j)})}l(Pe);var Le=s(Pe,2),Be=r(Le);let We;var lt=r(Be),we=r(lt,!0);l(lt);var I=s(lt),Y=r(I,!0);l(I),l(Be),l(Le),l(q);var ke=s(q,2),Te=r(ke);xe(Te),l(ke),l(oe),l(O);var qe=s(O,2),ee=r(qe),ue=s(ee,2),Me=s(ue,2),Qe=s(Me,2),De=s(Qe,2),_=s(De,2);ja(_,u=>o(le,u),()=>e(le)),l(qe),l(de);var N=s(de,2),fe=r(N);Is(fe,{});var te=s(fe,2);Hs(te,{$$events:{roll:u=>ve(u.detail)}});var me=s(te,2);Qs(me,{$$events:{roll:u=>ve(u.detail)}});var D=s(me,2);zs(D,{$$events:{rollHitDice:h}});var T=s(D,2);El(T,{$$events:{roll:u=>ve(u.detail)}});var K=s(T,2);tr(K,{});var je=s(K,2);lr(je,{}),l(N),l(J);var Re=s(J,2);ja(_r(Re,{get notation(){return e(ce)},get damageNotation(){return e(U)},get attackName(){return e(re)},get applyHalfDamage(){return e(be)},get bonusBreakdown(){return e(Z)},get rollType(){return e(Ue)},get visible(){return e(k)},$$events:{close:P},$$legacy:!0}),u=>o(Ve,u),()=>e(Ve));var rt=s(Re,2);{var V=u=>{Hr(u,{get mode(){return e(z)},$$events:{close:()=>o(S,!1)}})};y(rt,u=>{e(S)&&u(V)})}var dt=s(rt,2);{var Dt=u=>{ti(u,{onClose:()=>o(X,!1)})};y(dt,u=>{e(X)&&u(Dt)})}var jt=s(dt,2);bs(jt,{}),R(()=>{We=ht(Be,1,"btn btn-mode svelte-1uha8ag",null,We,{"use-mode":!d()}),L(we,d()?"ðŸ“":"ðŸŽ²"),L(Y,d()?"Edit Mode":"Use Mode")}),F("click",v,()=>{o(Z,[]),o(k,!0)}),F("click",pe,()=>o(Se,!e(Se))),F("click",Be,Q),Ee(Te,p,u=>ys(Zt,u)),F("click",ee,()=>o(X,!0)),F("click",ue,()=>{o(z,"save"),o(S,!0)}),F("click",Me,()=>{o(z,"load"),o(S,!0)}),F("click",Qe,Je),F("click",De,Ie),F("change",_,g),c(a,$),Et(),b()}export{Si as component};
