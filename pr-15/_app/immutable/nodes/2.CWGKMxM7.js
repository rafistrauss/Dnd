import{f as b,e as j,a as o,s as $,c as lt,t as mt}from"../chunks/B7Yu7-pH.js";import{i as Ct}from"../chunks/Pgj_Karr.js";import{c as qt,o as ia,a as as}from"../chunks/YW1J0937.js";import{a7 as qa,i as Wa,aZ as ss,a_ as ls,a$ as Ma,K as Ut,e as za,b0 as Ka,T as ga,b1 as is,b2 as rs,q as ns,b3 as os,b4 as cs,b5 as vs,ab as ds,d as r,r as Ja,g as us,C as Lt,b6 as Ze,b7 as Tt,F as P,G as wt,s as c,a4 as M,H as i,J as s,I as l,f as e,E as qe,m as at,A as U,b8 as ht,b9 as aa,ba as Va,ao as Qa,bb as ps}from"../chunks/TSJapsqm.js";import{c as Y,a as _t,e as ct,i as dt,u as Ya,s as Nt,b as ut,d as ra,f as sa,t as St,h as fs,T as bs,g as gs,j as hs}from"../chunks/BW7xBItJ.js";import{i as x,s as jt,a as Qe,b as st,d as va,e as ms}from"../chunks/lg4VTcy2.js";import{p as yt,b as Da}from"../chunks/BPqayAlY.js";import{b as ta,r as _s}from"../chunks/l5uG-5fS.js";function fa(a,n,t=!1){if(a.multiple){if(n==null)return;if(!Wa(n))return ss();for(var v of a.options)v.selected=n.includes(la(v));return}for(v of a.options){var f=la(v);if(ls(f,n)){v.selected=!0;return}}(!t||n!==void 0)&&(a.selectedIndex=-1)}function ja(a){var n=new MutationObserver(()=>{fa(a,a.__value)});n.observe(a,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),qa(()=>{n.disconnect()})}function Xa(a,n,t=n){var v=new WeakSet,f=!0;Ma(a,"change",_=>{var k=_?"[selected]":":checked",F;if(a.multiple)F=[].map.call(a.querySelectorAll(k),la);else{var y=a.querySelector(k)??a.querySelector("option:not([disabled])");F=y&&la(y)}t(F),Ut!==null&&v.add(Ut)}),za(()=>{var _=n();if(a===document.activeElement){var k=Ka??Ut;if(v.has(k))return}if(fa(a,_,f),f&&_===void 0){var F=a.querySelector(":checked");F!==null&&(_=la(F),t(_))}a.__value=_,f=!1}),ja(a)}function la(a){return"__value"in a?a.__value:a.value}const ys=Symbol("is custom element"),ks=Symbol("is html");function Le(a){if(ga){var n=!1,t=()=>{if(!n){if(n=!0,a.hasAttribute("value")){var v=a.value;tt(a,"value",null),a.value=v}if(a.hasAttribute("checked")){var f=a.checked;tt(a,"checked",null),a.checked=f}}};a.__on_r=t,ns(t),os()}}function Ba(a,n){var t=Ia(a);t.value===(t.value=n??void 0)||a.value===n&&(n!==0||a.nodeName!=="PROGRESS")||(a.value=n??"")}function xs(a,n){var t=Ia(a);t.checked!==(t.checked=n??void 0)&&(a.checked=n)}function tt(a,n,t,v){var f=Ia(a);ga&&(f[n]=a.getAttribute(n),n==="src"||n==="srcset"||n==="href"&&a.nodeName==="LINK")||f[n]!==(f[n]=t)&&(n==="loading"&&(a[cs]=t),t==null?a.removeAttribute(n):typeof t!="string"&&Ss(a).includes(n)?a[n]=t:a.setAttribute(n,t))}function Ia(a){return a.__attributes??={[ys]:a.nodeName.includes("-"),[ks]:a.namespaceURI===is}}var Ea=new Map;function Ss(a){var n=a.getAttribute("is")||a.nodeName,t=Ea.get(n);if(t)return t;Ea.set(n,t=[]);for(var v,f=a,_=Element.prototype;_!==f;){v=vs(f);for(var k in v)v[k].set&&t.push(k);f=rs(f)}return t}function Fe(a,n,t=n){var v=new WeakSet;Ma(a,"input",async f=>{var _=f?a.defaultValue:a.value;if(_=Ca(a)?La(_):_,t(_),Ut!==null&&v.add(Ut),await ds(),_!==(_=n())){var k=a.selectionStart,F=a.selectionEnd,y=a.value.length;if(a.value=_??"",F!==null){var E=a.value.length;k===F&&F===y&&E>y?(a.selectionStart=E,a.selectionEnd=E):(a.selectionStart=k,a.selectionEnd=Math.min(F,E))}}}),(ga&&a.defaultValue!==a.value||r(n)==null&&a.value)&&(t(Ca(a)?La(a.value):a.value),Ut!==null&&v.add(Ut)),Ja(()=>{var f=n();if(a===document.activeElement){var _=Ka??Ut;if(v.has(_))return}Ca(a)&&f===La(a.value)||a.type==="date"&&!f&&!a.value||f!==a.value&&(a.value=f??"")})}function ba(a,n,t=n){Ma(a,"change",v=>{var f=v?a.defaultChecked:a.checked;t(f)}),(ga&&a.defaultChecked!==a.checked||r(n)==null)&&t(a.checked),Ja(()=>{var v=n();a.checked=!!v})}function Ca(a){var n=a.type;return n==="number"||n==="range"}function La(a){return a===""?null:+a}function $s(a,n,t){var v=us(a,n);v&&v.set&&(a[n]=t,qa(()=>{a[n]=null}))}function Ra(a){return function(...n){var t=n[0];return t.stopPropagation(),a?.apply(this,n)}}function Jt(a,n){var t=a.$$events?.[n.type],v=Wa(t)?t.slice():t==null?[]:[t];for(var f of v)f.call(this,n)}const Cs="";function Za(...a){return ta+Cs+_s(a[0],a[1])}const Aa={paladin:{name:"Paladin",hitDice:"d10",spellcaster:!0,spellcastingAbility:"charisma",spellSlotsByLevel:{1:0,2:2,3:3,4:3,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Divine Sense",type:"uses",maxUses:(a,n=1)=>1+Math.max(1,n),resetOn:"long",description:"Detect celestials, fiends, and undead within 60 feet",minLevel:1},{name:"Lay on Hands",type:"pool",maxPool:a=>a*5,resetOn:"long",description:"Heal wounds or cure disease",minLevel:1},{name:"Divine Smite",type:"spellSlot",description:"Expend spell slot to deal extra radiant damage",minLevel:2,rollable:!0},{name:"Channel Divinity",type:"pool",maxPool:a=>a>=18?3:a>=6?2:1,resetOn:"short",description:"Sacred Weapon or Turn Undead",minLevel:3}]},fighter:{name:"Fighter",hitDice:"d10",spellcaster:!1,features:[{name:"Second Wind",type:"uses",maxUses:1,resetOn:"short",description:"Regain 1d10 + fighter level HP as bonus action",minLevel:1,rollable:!0,rollFormula:a=>`1d10+${a}`},{name:"Action Surge",type:"uses",maxUses:a=>a>=17?2:1,resetOn:"short",description:"Take one additional action on your turn",minLevel:2},{name:"Indomitable",type:"uses",maxUses:a=>a>=17?3:a>=13?2:1,resetOn:"long",description:"Reroll a failed saving throw",minLevel:9}],subclasses:{champion:{name:"Champion",features:[{name:"Improved Critical",type:"info",description:"Critical hit on 19-20",minLevel:3},{name:"Remarkable Athlete",type:"info",description:"Add half proficiency to STR/DEX/CON checks, increase long jump distance",minLevel:7},{name:"Additional Fighting Style",type:"info",description:"Choose a second fighting style",minLevel:10},{name:"Superior Critical",type:"info",description:"Critical hit on 18-20",minLevel:15},{name:"Survivor",type:"info",description:"Regain 5 + CON mod HP at start of turn if below half HP",minLevel:18}]},battlemaster:{name:"Battle Master",features:[{name:"Combat Superiority",type:"uses",maxUses:a=>a>=15?6:a>=7?5:4,resetOn:"short",description:a=>`Use superiority dice (${a>=18?"d12":a>=10?"d10":"d8"}) for maneuvers`,minLevel:3},{name:"Know Your Enemy",type:"info",description:"Learn capabilities of creatures you observe",minLevel:7},{name:"Improved Combat Superiority",type:"info",description:"Superiority dice become d10",minLevel:10},{name:"Relentless",type:"info",description:"Regain 1 superiority die if you have none at start of turn",minLevel:15}]}}},rogue:{name:"Rogue",hitDice:"d8",spellcaster:!1,features:[{name:"Sneak Attack",type:"info",description:a=>`Deal ${Math.ceil(a/2)}d6 extra damage once per turn with advantage or ally nearby`,minLevel:1,rollable:!0,rollFormula:a=>`${Math.ceil(a/2)}d6`},{name:"Cunning Action",type:"info",description:"Dash, Disengage, or Hide as a bonus action",minLevel:2},{name:"Uncanny Dodge",type:"info",description:"Use reaction to halve damage from an attack",minLevel:5},{name:"Evasion",type:"info",description:"Take no damage on successful Dex save (half on fail)",minLevel:7}]},wizard:{name:"Wizard",hitDice:"d6",spellcaster:!0,spellcastingAbility:"intelligence",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Arcane Recovery",type:"uses",maxUses:1,resetOn:"long",description:a=>`Recover spell slots totaling up to ${Math.ceil(a/2)} levels during short rest`,minLevel:1},{name:"Spell Mastery",type:"info",description:"Cast one 1st-level and one 2nd-level spell at will",minLevel:18}]},cleric:{name:"Cleric",hitDice:"d8",spellcaster:!0,spellcastingAbility:"wisdom",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Channel Divinity",type:"pool",maxPool:a=>a>=18?3:a>=6?2:1,resetOn:"short",description:"Turn Undead or domain-specific ability",minLevel:2},{name:"Destroy Undead",type:"info",description:a=>`Channel Divinity destroys undead of CR ${a>=17?4:a>=14?3:a>=11?2:a>=8?1:.5} or lower`,minLevel:5},{name:"Divine Intervention",type:"uses",maxUses:1,resetOn:"long",description:a=>`${a}% chance to succeed, implore deity for aid`,minLevel:10}],subclasses:{war:{name:"War Domain",features:[{name:"War Priest",type:"uses",maxUses:(a,n=1)=>Math.max(1,n),resetOn:"long",description:"Make one weapon attack as a bonus action",minLevel:1},{name:"Guided Strike",type:"channelDivinity",description:"Use your Channel Divinity to gain +10 to an attack roll. Make this choice after you see the roll, but before the DM says whether the attack hits or misses.",minLevel:2,resetOn:"short"},{name:"War God's Blessing",type:"channelDivinity",description:"Use reaction to grant +10 to an ally's attack roll within 30 feet. Consumes one use of Channel Divinity.",minLevel:6,resetOn:"short"},{name:"Divine Strike",type:"info",description:a=>`Deal extra ${a>=14?"2d8":"1d8"} weapon damage once per turn`,minLevel:8,rollable:!0,rollFormula:a=>a>=14?"2d8":"1d8"},{name:"Avatar of Battle",type:"info",description:"Gain resistance to nonmagical weapon damage",minLevel:17}]},life:{name:"Life Domain",features:[{name:"Disciple of Life",type:"info",description:"Healing spells restore additional 2 + spell level HP",minLevel:1},{name:"Preserve Life",type:"pool",maxPool:a=>a*5,resetOn:"short",description:"Restore HP to creatures within 30 feet",minLevel:2},{name:"Blessed Healer",type:"info",description:"Regain 2 + spell level HP when you cast healing spell",minLevel:6},{name:"Divine Strike",type:"info",description:a=>`Deal extra ${a>=14?"2d8":"1d8"} radiant damage once per turn`,minLevel:8,rollable:!0,rollFormula:a=>a>=14?"2d8":"1d8"},{name:"Supreme Healing",type:"info",description:"Maximize healing dice instead of rolling",minLevel:17}]}}},barbarian:{name:"Barbarian",hitDice:"d12",spellcaster:!1,features:[{name:"Rage",type:"uses",maxUses:a=>a>=20?1/0:a>=17?6:a>=12?5:a>=6?4:a>=3?3:2,resetOn:"long",description:a=>`+${a>=16?4:a>=9?3:2} damage, resistance to physical damage`,minLevel:1},{name:"Reckless Attack",type:"info",description:"Gain advantage on melee attacks, enemies get advantage on you",minLevel:2},{name:"Danger Sense",type:"info",description:"Advantage on Dex saves against effects you can see",minLevel:2}],subclasses:{berserker:{name:"Path of the Berserker",features:[{name:"Frenzy",type:"info",description:"While raging, make melee attack as bonus action (gain 1 exhaustion after rage)",minLevel:3},{name:"Mindless Rage",type:"info",description:"Cannot be charmed or frightened while raging",minLevel:6},{name:"Intimidating Presence",type:"info",description:"Use action to frighten creature within 30 feet",minLevel:10},{name:"Retaliation",type:"info",description:"When damaged by creature within 5 feet, make melee attack as reaction",minLevel:14}]}}}};function $t(a){const n=a.toLowerCase();return Aa[n]||null}function Vt(a,n,t){const v=$t(a);if(!v)return[];const f=v.features.filter(_=>!_.minLevel||_.minLevel<=n);if(t&&v.subclasses&&v.subclasses[t]){const _=v.subclasses[t].features.filter(k=>!k.minLevel||k.minLevel<=n);return[...f,..._]}return f}function Pa(a){const n=$t(a);return!n||!n.subclasses?[]:Object.keys(n.subclasses).map(t=>({id:t,name:n.subclasses[t].name}))}function Ta(a,n){const t=$t(a);return!t||!t.spellcaster||!t.spellSlotsByLevel?0:t.spellSlotsByLevel[n]||0}function Ha(a,n,t){const v=$t(a);return!v||!v.spellcaster?0:Math.max(1,t+n)}function Ls(a,n,t){const v=$t(a);return!v||!v.spellcaster?null:8+n+t}function ws(){return Object.keys(Aa).map(a=>({id:a,name:Aa[a].name}))}var Ds=b("<option> </option>"),js=b("<option> </option>"),As=b('<div class="form-group svelte-172i2fj"><label for="characterSubclass" class="svelte-172i2fj">Subclass</label> <select id="characterSubclass" class="svelte-172i2fj"><option>Select Subclass</option><!></select></div>'),Fs=b('<div class="info-grid svelte-172i2fj"><div class="form-group svelte-172i2fj"><label for="characterName" class="svelte-172i2fj">Character Name</label> <input type="text" id="characterName" placeholder="Enter name" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterClass" class="svelte-172i2fj">Class</label> <select id="characterClass" class="svelte-172i2fj"><option>Select Class</option><!></select></div> <!> <div class="form-group svelte-172i2fj"><label for="characterLevel" class="svelte-172i2fj">Level</label> <input type="number" id="characterLevel" min="1" max="20" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterRace" class="svelte-172i2fj">Race</label> <input type="text" id="characterRace" placeholder="e.g., Human" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterBackground" class="svelte-172i2fj">Background</label> <input type="text" id="characterBackground" placeholder="e.g., Soldier" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterAlignment" class="svelte-172i2fj">Alignment</label> <input type="text" id="characterAlignment" placeholder="e.g., Lawful Good" class="svelte-172i2fj"/></div></div>'),Ms=b('<section class="character-info svelte-172i2fj"><div class="header svelte-172i2fj"><h2 class="svelte-172i2fj">Character Info</h2> <button class="collapse-btn svelte-172i2fj"> </button></div> <!></section>');function Bs(a,n){Lt(n,!1);const t=()=>Qe(Y,"$character",f),v=()=>Qe(_t,"$collapsedStates",f),[f,_]=jt(),k=M(),F=ws();function y(ae){const O=ae.target;Y.update(je=>(je.class=O.value,je.subclass="",je))}function E(ae){const O=ae.target;Y.update(je=>(je.subclass=O.value,je))}function re(ae){const O=ae.target;Y.update(je=>(je.level=parseInt(O.value)||1,je)),Ya()}function X(){_t.update(ae=>({...ae,characterInfo:!ae.characterInfo}))}Ze(()=>(t(),Pa),()=>{c(k,t().class?Pa(t().class):[])}),Tt(),Ct();var N=Ms(),Se=i(N),be=s(i(Se),2),De=i(be,!0);l(be),l(Se);var ne=s(Se,2);{var ge=ae=>{var O=Fs(),je=i(O),ye=s(i(je),2);Le(ye),l(je);var Z=s(je,2),q=s(i(Z),2),oe=i(q);oe.value=oe.__value="";var ke=s(oe);ct(ke,1,()=>F,dt,(L,ee)=>{var B=Ds(),K=i(B,!0);l(B);var Ne={};P(()=>{$(K,(e(ee),r(()=>e(ee).name))),Ne!==(Ne=(e(ee),r(()=>e(ee).id)))&&(B.value=(B.__value=(e(ee),r(()=>e(ee).id)))??"")}),o(L,B)}),l(q);var _e;ja(q),l(Z);var Ee=s(Z,2);{var C=L=>{var ee=As(),B=s(i(ee),2),K=i(B);K.value=K.__value="";var Ne=s(K);ct(Ne,1,()=>e(k),dt,(he,He)=>{var Me=js(),it=i(Me,!0);l(Me);var A={};P(()=>{$(it,(e(He),r(()=>e(He).name))),A!==(A=(e(He),r(()=>e(He).id)))&&(Me.value=(Me.__value=(e(He),r(()=>e(He).id)))??"")}),o(he,Me)}),l(B);var se;ja(B),l(ee),P(()=>{se!==(se=(t(),r(()=>t().subclass)))&&(B.value=(B.__value=(t(),r(()=>t().subclass)))??"",fa(B,(t(),r(()=>t().subclass))))}),j("change",B,E),o(L,ee)};x(Ee,L=>{e(k),r(()=>e(k).length>0)&&L(C)})}var ce=s(Ee,2),ve=s(i(ce),2);Le(ve),l(ce);var de=s(ce,2),g=s(i(de),2);Le(g),l(de);var T=s(de,2),ue=s(i(T),2);Le(ue),l(T);var Pe=s(T,2),m=s(i(Pe),2);Le(m),l(Pe),l(O),P(()=>{_e!==(_e=(t(),r(()=>t().class)))&&(q.value=(q.__value=(t(),r(()=>t().class)))??"",fa(q,(t(),r(()=>t().class)))),Ba(ve,(t(),r(()=>t().level)))}),Fe(ye,()=>t().name,L=>st(Y,r(t).name=L,r(t))),j("change",q,y),j("change",ve,re),Fe(g,()=>t().race,L=>st(Y,r(t).race=L,r(t))),Fe(ue,()=>t().background,L=>st(Y,r(t).background=L,r(t))),Fe(m,()=>t().alignment,L=>st(Y,r(t).alignment=L,r(t))),o(ae,O)};x(ne,ae=>{v(),r(()=>!v().characterInfo)&&ae(ge)})}l(N),P(()=>{tt(be,"aria-label",(v(),r(()=>v().characterInfo?"Expand":"Collapse"))),$(De,(v(),r(()=>v().characterInfo?"â–¼":"â–²")))}),j("click",be,X),o(a,N),wt(),_()}var Is=b('<div class="ability-card svelte-bbv1xt"><h3 class="svelte-bbv1xt"> </h3> <input type="number" class="ability-score svelte-bbv1xt" min="1" max="30"/> <div class="ability-modifier svelte-bbv1xt"> </div> <button class="roll-btn svelte-bbv1xt">Check</button> <div class="save-row svelte-bbv1xt"><input type="checkbox" class="svelte-bbv1xt"/> <label class="svelte-bbv1xt">Save</label> <button class="roll-btn-small svelte-bbv1xt">Roll</button></div></div>'),Rs=b('<div class="proficiency-bonus svelte-bbv1xt"><label for="profBonus">Proficiency Bonus</label> <input type="number" id="profBonus" class="prof-input svelte-bbv1xt"/></div> <div class="abilities-grid svelte-bbv1xt"></div>',1),Es=b('<section><div class="header svelte-bbv1xt"><h2 class="svelte-bbv1xt">Ability Scores</h2> <button class="collapse-btn svelte-bbv1xt"> </button></div> <!></section>');function Ps(a,n){Lt(n,!1);const t=()=>Qe(ra,"$abilityModifiers",k),v=()=>Qe(Y,"$character",k),f=()=>Qe(Nt,"$searchFilter",k),_=()=>Qe(_t,"$collapsedStates",k),[k,F]=jt(),y=M(),E=M(),re=qt(),X=[{key:"strength",label:"Strength"},{key:"dexterity",label:"Dexterity"},{key:"constitution",label:"Constitution"},{key:"intelligence",label:"Intelligence"},{key:"wisdom",label:"Wisdom"},{key:"charisma",label:"Charisma"}];function N(){Ya()}function Se(q){const oe=t()[q],ke=`1d20${oe>=0?"+":""}${oe}`;re("roll",ke)}function be(q){const oe=t()[q],ke=v().saveProficiencies[q]?v().proficiencyBonus:0,_e=oe+ke,Ee=`1d20${_e>=0?"+":""}${_e}`;re("roll",Ee)}function De(){_t.update(q=>({...q,abilityScores:!q.abilityScores}))}Ze(()=>f(),()=>{c(y,X.filter(({label:q})=>f()?q.toLowerCase().includes(f().toLowerCase()):!0))}),Ze(()=>(e(y),f()),()=>{c(E,e(y).length>0||!f()||f().toLowerCase().includes("proficiency"))}),Tt(),Ct();var ne=Es();let ge;var ae=i(ne),O=s(i(ae),2),je=i(O,!0);l(O),l(ae);var ye=s(ae,2);{var Z=q=>{var oe=Rs(),ke=qe(oe),_e=s(i(ke),2);Le(_e),l(ke);var Ee=s(ke,2);ct(Ee,5,()=>e(y),dt,(C,ce)=>{let ve=()=>e(ce).key,de=()=>e(ce).label;var g=Is(),T=i(g),ue=i(T,!0);l(T);var Pe=s(T,2);Le(Pe);var m=s(Pe,2),L=i(m);l(m);var ee=s(m,2),B=s(ee,2),K=i(B);Le(K);var Ne=s(K,2),se=s(Ne,2);l(B),l(g),P(he=>{$(ue,he),$(L,`${t(),ve(),r(()=>t()[ve()]>=0?"+":"")??""}${t(),ve(),r(()=>t()[ve()])??""}`),tt(K,"id",`${ve()}-save`),tt(Ne,"for",`${ve()}-save`)},[()=>(de(),r(()=>de().substring(0,3).toUpperCase()))]),Fe(Pe,()=>v().abilities[ve()],he=>st(Y,r(v).abilities[ve()]=he,r(v))),j("change",Pe,N),j("click",ee,()=>Se(ve())),ba(K,()=>v().saveProficiencies[ve()],he=>st(Y,r(v).saveProficiencies[ve()]=he,r(v))),j("click",se,()=>be(ve())),o(C,g)}),l(Ee),Fe(_e,()=>v().proficiencyBonus,C=>st(Y,r(v).proficiencyBonus=C,r(v))),o(q,oe)};x(ye,q=>{_(),r(()=>!_().abilityScores)&&q(Z)})}l(ne),P(()=>{ge=ut(ne,1,"ability-scores svelte-bbv1xt",null,ge,{hidden:!e(E)}),tt(O,"aria-label",(_(),r(()=>_().abilityScores?"Expand":"Collapse"))),$(je,(_(),r(()=>_().abilityScores?"â–¼":"â–²")))}),j("click",O,De),o(a,ne),wt(),F()}function Ts(a){return Math.floor((a-10)/2)}function Fa(a,n){if(!a.class)return null;const t=$t(a.class);if(!t||!t.spellcaster||!t.spellcastingAbility)return null;const v=n[t.spellcastingAbility];return 8+a.proficiencyBonus+v}function Hs(a,n){if(!a.class)return 0;const t=$t(a.class);return!t||!t.spellcaster||!t.spellcastingAbility?0:Ts(n[t.spellcastingAbility])}var Us=b('<div class="stat-box svelte-1r5hyyb"><label for="spellSaveDC" class="svelte-1r5hyyb">Spell Save DC</label> <input type="number" id="spellSaveDC" class="stat-input svelte-1r5hyyb" readonly="" title="8 + Proficiency Bonus + Spellcasting Ability Modifier"/></div>'),Ns=b('<span class="hit-dice-type"> </span>'),Gs=b('<div class="stats-grid svelte-1r5hyyb"><div class="stat-box svelte-1r5hyyb"><label for="armorClass" class="svelte-1r5hyyb">Armor Class</label> <input type="number" id="armorClass" class="stat-input svelte-1r5hyyb"/></div> <div class="stat-box svelte-1r5hyyb"><label for="initiative" class="svelte-1r5hyyb">Initiative</label> <input type="number" id="initiative" class="stat-input svelte-1r5hyyb"/></div> <div class="stat-box svelte-1r5hyyb"><label for="speed" class="svelte-1r5hyyb">Speed</label> <input type="text" id="speed" class="stat-input svelte-1r5hyyb"/></div> <!></div> <div class="hp-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Points</h3> <div class="hp-display svelte-1r5hyyb"><div class="hp-inputs svelte-1r5hyyb"><input type="number" class="hp-current svelte-1r5hyyb" min="0"/> <span class="hp-separator svelte-1r5hyyb">/</span> <input type="number" class="hp-max svelte-1r5hyyb" min="0"/></div> <div class="hp-controls svelte-1r5hyyb"><button class="hp-btn svelte-1r5hyyb">âˆ’</button> <button class="hp-btn svelte-1r5hyyb">+</button> <button class="hp-btn svelte-1r5hyyb">âˆ’5</button> <button class="hp-btn svelte-1r5hyyb">+5</button></div></div> <div class="temp-hp svelte-1r5hyyb"><label for="tempHP" class="svelte-1r5hyyb">Temp HP</label> <input type="number" id="tempHP" min="0" class="svelte-1r5hyyb"/></div></div> <div class="hit-dice-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Dice</h3> <div class="hit-dice-display svelte-1r5hyyb"><input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <span>/</span> <input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <!></div> <div class="hit-dice-controls"><label for="hitDiceCount" class="svelte-1r5hyyb">Roll</label> <input type="number" id="hitDiceCount" class="hit-dice-count-input svelte-1r5hyyb" min="1" value="1"/> <button class="btn btn-primary roll-hit-dice use-enabled svelte-1r5hyyb">ðŸŽ² Roll</button></div></div>',1),Os=b('<section><div class="header svelte-1r5hyyb"><h2 class="svelte-1r5hyyb">Combat Stats</h2> <button class="collapse-btn svelte-1r5hyyb"> </button></div> <!></section>');function qs(a,n){Lt(n,!1);const t=()=>Qe(Y,"$character",k),v=()=>Qe(ra,"$abilityModifiers",k),f=()=>Qe(Nt,"$searchFilter",k),_=()=>Qe(_t,"$collapsedStates",k),[k,F]=jt(),y=M(),E=M(),re=qt();function X(ye){Y.update(Z=>(Z.currentHP=Math.max(0,Math.min(Z.maxHP,Z.currentHP+ye)),Z))}function N(ye=1){if(t().hitDice.current<=0){alert("No hit dice remaining!");return}if(!t().class){alert("Please select a class first!");return}const Z=$t(t().class);if(!Z){alert("Invalid class configuration!");return}const q=Math.min(ye,t().hitDice.current),oe=Z.hitDice,ke=v().constitution,_e=ke>=0?`+${ke}`:`${ke}`,Ee=`${q}${oe}${_e}`;re("rollHitDice",{notation:Ee,hitDie:oe,count:q})}function Se(){_t.update(ye=>({...ye,combatStats:!ye.combatStats}))}Ze(()=>(t(),v()),()=>{c(y,Fa(t(),v()))}),Ze(()=>f(),()=>{c(E,!f()||"armor class".includes(f().toLowerCase())||"initiative".includes(f().toLowerCase())||"speed".includes(f().toLowerCase())||"hit points".includes(f().toLowerCase())||"hp".includes(f().toLowerCase())||"hit dice".includes(f().toLowerCase())||"spell save".includes(f().toLowerCase())||"combat".includes(f().toLowerCase()))}),Tt(),Ct();var be=Os();let De;var ne=i(be),ge=s(i(ne),2),ae=i(ge,!0);l(ge),l(ne);var O=s(ne,2);{var je=ye=>{var Z=Gs(),q=qe(Z),oe=i(q),ke=s(i(oe),2);Le(ke),l(oe);var _e=s(oe,2),Ee=s(i(_e),2);Le(Ee),l(_e);var C=s(_e,2),ce=s(i(C),2);Le(ce),l(C);var ve=s(C,2);{var de=I=>{var J=Us(),S=s(i(J),2);Le(S),l(J),P(()=>Ba(S,e(y))),o(I,J)};x(ve,I=>{e(y)!==null&&I(de)})}l(q);var g=s(q,2),T=s(i(g),2),ue=i(T),Pe=i(ue);Le(Pe);var m=s(Pe,4);Le(m),l(ue);var L=s(ue,2),ee=i(L),B=s(ee,2),K=s(B,2),Ne=s(K,2);l(L),l(T);var se=s(T,2),he=s(i(se),2);Le(he),l(se),l(g);var He=s(g,2),Me=s(i(He),2),it=i(Me);Le(it);var A=s(it,4);Le(A);var R=s(A,2);{var D=I=>{const J=at(()=>(U($t),t(),r(()=>$t(t().class))));var S=lt(),$e=qe(S);{var we=Ie=>{const We=at(()=>(v(),r(()=>v().constitution)));var ze=Ns(),Re=i(ze);l(ze),P(()=>$(Re,`(${U(e(J)),r(()=>e(J).hitDice)??""}${(e(We)>=0?`+${e(We)}`:e(We))??""})`)),o(Ie,ze)};x($e,Ie=>{e(J)&&Ie(we)})}o(I,S)};x(R,I=>{t(),r(()=>t().class)&&I(D)})}l(Me);var u=s(Me,2),Be=s(i(u),2),le=s(Be,2);l(u),l(He),P(()=>{tt(Pe,"max",(t(),r(()=>t().maxHP))),tt(it,"max",(t(),r(()=>t().hitDice.max))),tt(Be,"max",(t(),r(()=>t().hitDice.current))),le.disabled=(t(),r(()=>t().hitDice.current<=0||!t().class))}),Fe(ke,()=>t().armorClass,I=>st(Y,r(t).armorClass=I,r(t))),Fe(Ee,()=>t().initiative,I=>st(Y,r(t).initiative=I,r(t))),Fe(ce,()=>t().speed,I=>st(Y,r(t).speed=I,r(t))),Fe(Pe,()=>t().currentHP,I=>st(Y,r(t).currentHP=I,r(t))),Fe(m,()=>t().maxHP,I=>st(Y,r(t).maxHP=I,r(t))),j("click",ee,()=>X(-1)),j("click",B,()=>X(1)),j("click",K,()=>X(-5)),j("click",Ne,()=>X(5)),Fe(he,()=>t().tempHP,I=>st(Y,r(t).tempHP=I,r(t))),Fe(it,()=>t().hitDice.current,I=>st(Y,r(t).hitDice.current=I,r(t))),Fe(A,()=>t().hitDice.max,I=>st(Y,r(t).hitDice.max=I,r(t))),j("input",Be,I=>{const J=I.target,S=parseInt(J.value);S>t().hitDice.current&&(J.value=String(t().hitDice.current)),S<1&&(J.value="1")}),j("click",le,()=>{const I=document.getElementById("hitDiceCount"),J=parseInt(I?.value||"1");N(J)}),o(ye,Z)};x(O,ye=>{_(),r(()=>!_().combatStats)&&ye(je)})}l(be),P(()=>{De=ut(be,1,"combat-stats svelte-1r5hyyb",null,De,{hidden:!e(E)}),tt(ge,"aria-label",(_(),r(()=>_().combatStats?"Expand":"Collapse"))),$(ae,(_(),r(()=>_().combatStats?"â–¼":"â–²")))}),j("click",ge,Se),o(a,be),wt(),F()}const wa={acrobatics:"dexterity",animalHandling:"wisdom",arcana:"intelligence",athletics:"strength",deception:"charisma",history:"intelligence",insight:"wisdom",intimidation:"charisma",investigation:"intelligence",medicine:"wisdom",nature:"intelligence",perception:"wisdom",performance:"charisma",persuasion:"charisma",religion:"intelligence",sleightOfHand:"dexterity",stealth:"dexterity",survival:"wisdom"};var Ws=b('<div class="skill-row svelte-1f1pl16"><input type="checkbox" class="svelte-1f1pl16"/> <label class="svelte-1f1pl16"> <span class="ability-tag svelte-1f1pl16"> </span></label> <span class="skill-modifier svelte-1f1pl16"> </span> <button class="roll-btn svelte-1f1pl16">Roll</button></div>'),zs=b('<div class="skills-grid svelte-1f1pl16"></div>'),Ks=b('<section><div class="header svelte-1f1pl16"><h2 class="svelte-1f1pl16">Skills</h2> <button class="collapse-btn svelte-1f1pl16"> </button></div> <!></section>');function Js(a,n){Lt(n,!1);const t=()=>Qe(ra,"$abilityModifiers",k),v=()=>Qe(Y,"$character",k),f=()=>Qe(Nt,"$searchFilter",k),_=()=>Qe(_t,"$collapsedStates",k),[k,F]=jt(),y=M(),E=M(),re=qt(),X=[{key:"acrobatics",label:"Acrobatics"},{key:"animalHandling",label:"Animal Handling"},{key:"arcana",label:"Arcana"},{key:"athletics",label:"Athletics"},{key:"deception",label:"Deception"},{key:"history",label:"History"},{key:"insight",label:"Insight"},{key:"intimidation",label:"Intimidation"},{key:"investigation",label:"Investigation"},{key:"medicine",label:"Medicine"},{key:"nature",label:"Nature"},{key:"perception",label:"Perception"},{key:"performance",label:"Performance"},{key:"persuasion",label:"Persuasion"},{key:"religion",label:"Religion"},{key:"sleightOfHand",label:"Sleight of Hand"},{key:"stealth",label:"Stealth"},{key:"survival",label:"Survival"}];function N(Z){const q=wa[Z],oe=t()[q],ke=v().skillProficiencies[Z]?v().proficiencyBonus:0;return oe+ke}function Se(Z){const q=N(Z),oe=`1d20${q>=0?"+":""}${q}`;re("roll",oe)}function be(){_t.update(Z=>({...Z,skills:!Z.skills}))}Ze(()=>f(),()=>{c(y,X.filter(({label:Z})=>f()?Z.toLowerCase().includes(f().toLowerCase()):!0))}),Ze(()=>e(y),()=>{c(E,e(y).length>0)}),Tt(),Ct();var De=Ks();let ne;var ge=i(De),ae=s(i(ge),2),O=i(ae,!0);l(ae),l(ge);var je=s(ge,2);{var ye=Z=>{var q=zs();ct(q,5,()=>e(y),dt,(oe,ke)=>{let _e=()=>e(ke).key,Ee=()=>e(ke).label;const C=at(()=>(U(wa),_e(),r(()=>wa[_e()]))),ce=at(()=>(_e(),r(()=>N(_e()))));var ve=Ws(),de=i(ve);Le(de);var g=s(de,2),T=i(g),ue=s(T),Pe=i(ue);l(ue),l(g);var m=s(g,2),L=i(m);l(m);var ee=s(m,2);l(ve),P(B=>{tt(de,"id",_e()),tt(g,"for",_e()),$(T,`${Ee()??""} `),$(Pe,`(${B??""})`),$(L,`${e(ce)>=0?"+":""}${e(ce)??""}`)},[()=>(U(e(C)),r(()=>e(C).substring(0,3).toUpperCase()))]),ba(de,()=>v().skillProficiencies[_e()],B=>st(Y,r(v).skillProficiencies[_e()]=B,r(v))),j("click",ee,()=>Se(_e())),o(oe,ve)}),l(q),o(Z,q)};x(je,Z=>{_(),r(()=>!_().skills)&&Z(ye)})}l(De),P(()=>{ne=ut(De,1,"skills svelte-1f1pl16",null,ne,{hidden:!e(E)}),tt(ae,"aria-label",(_(),r(()=>_().skills?"Expand":"Collapse"))),$(O,(_(),r(()=>_().skills?"â–¼":"â–²")))}),j("click",ae,be),o(a,De),wt(),F()}let da=null,ua=null;async function es(){if(da)return da;try{return da=await(await fetch(Za("/data/spells.json"))).json(),da||[]}catch(a){return console.error("Failed to load spells:",a),[]}}async function Vs(){if(ua)return ua;try{return ua=await(await fetch(Za("/data/feats.json"))).json(),ua||[]}catch(a){return console.error("Failed to load feats:",a),[]}}function Ua(a,n){if(!n.trim())return a;const t=n.toLowerCase();return a.filter(v=>v.name.toLowerCase().includes(t)||v.school.toLowerCase().includes(t)||v.classes.some(f=>f.toLowerCase().includes(t))||v.description.toLowerCase().includes(t))}function Qs(a,n){return n===null?a:a.filter(t=>t.level===n)}function Ys(a,n){if(!n.trim())return a;const t=n.toLowerCase();return a.filter(v=>v.name.toLowerCase().includes(t)||v.description.toLowerCase().includes(t))}function pa(a){const n=a.description,t=/\b(Strength|Dexterity|Constitution|Intelligence|Wisdom|Charisma)\s+saving\s+throw/i,v=n.match(t);if(!v)return null;const f=v[1].toLowerCase(),k=/half\s+(?:as\s+much\s+)?damage\s+on\s+a\s+successful(?:\s+save)?/i.test(n),y=/saving\s+throw\s+or\s+take.*?damage/i.test(n)&&!k;return{ability:f,halfDamageOnSave:k,noDamageOnSave:y}}function Xs(a){const n=a.description;return/(plus|add)\s+your\s+spellcasting\s+(ability\s+)?modifier/i.test(n)}function Na(a){const n=a.description.toLowerCase(),v=["takes","take","deals","deal","damage equal to","force damage","fire damage","cold damage","lightning damage","thunder damage","acid damage","poison damage","necrotic damage","radiant damage","psychic damage","regain","regains","hit point"].some(k=>n.includes(k));return["bonus to attack","bonus to damage","bonus to ac","gains a +","gain a +","+1 bonus","+2 bonus","+3 bonus","advantage on","becomes a magic weapon"].some(k=>n.includes(k))&&!v}function Zs(a){const n=a.description;let t=0,v=0,f="";const _=n.match(/\+(\d+)\s+bonus\s+to\s+attack\s+rolls\s+and\s+damage\s+rolls/i);if(_){const F=parseInt(_[1]);t=F,v=F,f=`+${F} to attack and damage rolls`}a.name==="Bless"&&(f="Add 1d4 to attack rolls and saves");const k=n.match(/\+(\d+)\s+bonus\s+to\s+AC/i);return k&&(f=`+${parseInt(k[1])} to AC`),a.name==="Haste"&&(f="+2 AC, doubled speed, extra action"),f||t!==0||v!==0?{attackBonus:t,damageBonus:v,description:f||a.description.substring(0,100)}:null}var el=b('<button class="btn-remove svelte-14o91c5">Ã—</button>'),tl=b('<div class="spell-info-loading svelte-14o91c5">Loading spell info...</div>'),al=b('<div class="spell-notes svelte-14o91c5"><h4 class="svelte-14o91c5">General Notes</h4> <p> </p></div>'),sl=b('<li class="svelte-14o91c5"><strong>At Higher Levels:</strong> </li>'),ll=b('<ul class="svelte-14o91c5"><li class="svelte-14o91c5"><strong>Level:</strong> </li> <li class="svelte-14o91c5"><strong>Casting Time:</strong> </li> <li class="svelte-14o91c5"><strong>Range:</strong> </li> <li class="svelte-14o91c5"><strong>Components:</strong> <!></li> <li class="svelte-14o91c5"><strong>Duration:</strong> <!> </li> <li class="svelte-14o91c5"><strong>Description:</strong> </li> <!></ul>'),il=b("<option> </option>"),rl=b('<span class="scaled-damage svelte-14o91c5"><!> </span>'),nl=b('<span class="scaled-damage svelte-14o91c5"> </span>'),ol=b('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> Target is Fiend or Undead <!></label></div>'),cl=b('<span class="scaled-damage svelte-14o91c5" style="margin-left: 8px;"> </span>'),vl=b('<span class="scaled-damage svelte-14o91c5">(Half damage)</span>'),dl=b('<span class="scaled-damage svelte-14o91c5">(No damage)</span>'),ul=b('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> <!> <!></label></div>'),pl=b('<div class="spell-level-selector svelte-14o91c5"><label class="svelte-14o91c5">Cast at Level:</label> <select class="spell-level-select use-enabled svelte-14o91c5"></select> <!></div> <!> <!>',1),fl=b('<div class="spell-level-selector svelte-14o91c5"><span style="color: #dc3545; font-weight: bold;">No spell slots available!</span></div>'),bl=b('<!> <div class="spell-info svelte-14o91c5"><div class="spell-info-header svelte-14o91c5" role="button" tabindex="0"><h4 class="svelte-14o91c5">Spell Info</h4> <button class="collapse-btn-small svelte-14o91c5"> </button></div> <!></div> <!>',1),gl=b('<div class="spell-info-missing svelte-14o91c5">Spell info not found.</div>'),hl=b('<div class="attack-notes svelte-14o91c5"><label class="svelte-14o91c5">Notes</label> <textarea placeholder="e.g., DC 15 Dex save, Range 120 ft, Concentration" class="notes-input svelte-14o91c5" rows="2"></textarea></div>'),ml=b('<button class="btn btn-primary">Roll Attack</button>'),_l=b('<button class="btn btn-success">Cast Spell</button>'),yl=b('<button class="btn btn-secondary"><!></button>'),kl=b('<button class="btn btn-secondary">Roll Damage</button>'),xl=b('<div class="attack-card svelte-14o91c5"><div class="attack-header svelte-14o91c5"><input type="text" placeholder="Attack name" class="attack-name svelte-14o91c5"/> <!></div> <div class="attack-details svelte-14o91c5"><div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Bonus</label> <input type="number" class="attack-bonus svelte-14o91c5"/></div> <div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Damage</label> <input type="text" placeholder="e.g., 2d6+3" class="attack-damage svelte-14o91c5"/></div> <div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Type</label> <input type="text" placeholder="e.g., slashing" class="attack-type svelte-14o91c5"/></div></div> <!> <!> <div class="attack-actions svelte-14o91c5"><!> <!></div></div>'),Sl=b('<p class="no-attacks svelte-14o91c5">No attacks added yet. Click "Add Attack" to create one.</p>'),$l=b('<p class="no-attacks svelte-14o91c5">No attacks match your search.</p>'),Cl=b('<button class="btn-remove svelte-14o91c5">Ã—</button>'),Ll=b('<div class="state-card svelte-14o91c5"><div class="state-header svelte-14o91c5"><input type="text" placeholder="Effect name (e.g., Magic Weapon)" class="state-name svelte-14o91c5"/> <!></div> <div class="state-details svelte-14o91c5"><div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Attack Bonus</label> <input type="number" class="state-bonus svelte-14o91c5"/></div> <div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Damage Bonus</label> <input type="number" class="state-bonus svelte-14o91c5"/></div></div> <div class="state-description svelte-14o91c5"><label class="svelte-14o91c5">Description</label> <input type="text" placeholder="e.g., +1 to attack and damage rolls (Magic Weapon)" class="state-desc-input svelte-14o91c5"/></div></div>'),wl=b('<div class="states-list svelte-14o91c5"></div>'),Dl=b('<p class="no-states svelte-14o91c5">No active effects. Add spell effects that modify your attacks.</p>'),jl=b('<button class="btn btn-secondary">Add Attack</button> <div class="attacks-list svelte-14o91c5"><!> <!></div> <div class="active-states-section svelte-14o91c5"><h3 class="svelte-14o91c5">Active Spell Effects</h3> <p class="section-description svelte-14o91c5">Effects that modify attack and damage rolls (e.g., Magic Weapon, Bless)</p> <button class="btn btn-secondary">Add Effect</button> <!></div>',1),Al=b('<section><div class="header svelte-14o91c5"><h2 class="svelte-14o91c5">Attacks & Spells</h2> <button class="collapse-btn svelte-14o91c5"> </button></div> <!></section>');function Fl(a,n){Lt(n,!1);const t=()=>Qe(Y,"$character",F),v=()=>Qe(ra,"$abilityModifiers",F),f=()=>Qe(Nt,"$searchFilter",F),_=()=>Qe(_t,"$collapsedStates",F),k=()=>Qe(sa,"$isEditMode",F),[F,y]=jt(),E=M(),re=M(),X=qt();let N=M({});function Se(m){Va(N,e(N)[m]=!e(N)[m]),c(N,{...e(N)})}function be(m){return m.description.toLowerCase().includes("regain")&&(m.description.toLowerCase().includes("hit point")||m.description.toLowerCase().includes("hp"))}function De(){Y.update(m=>(m.attacks=[...m.attacks,{id:crypto.randomUUID(),name:"",bonus:0,damage:"",damageType:"",notes:""}],m))}function ne(m){Y.update(L=>(L.attacks=L.attacks.filter(ee=>ee.id!==m),L))}function ge(m){let L=m.damage,ee=!1;if(m.spellRef){const se=Z(m.spellRef);if(se&&se.level>0){const he=m.castAtLevel||se.level;if(!q(he)){St.add(`No level ${he} spell slots available!`,"error");return}const Me=pa(se);Me&&m.targetSucceededSave&&Me.noDamageOnSave?L="0":(ee=Me?.halfDamageOnSave&&m.targetSucceededSave||!1,L=oe(m,se))}}else if(t().activeStates&&t().activeStates.length>0){let se=0;for(const he of t().activeStates)se+=he.damageBonus;if(se!==0&&L){const he=L.match(/(\d+d\d+)([+-]\d+)?/);if(he){const[,He,Me]=he,A=(Me?parseInt(Me):0)+se;L=`${He}${A>=0?"+":""}${A}`}}}const B=[];m.bonus!==0&&B.push({value:m.bonus,source:"base"});let K=m.bonus;if(t().activeStates)for(const se of t().activeStates)se.attackBonus!==0&&(B.push({value:se.attackBonus,source:se.name.toLowerCase()}),K+=se.attackBonus);const Ne=`1d20${K>=0?"+":""}${K}`;X("roll",{notation:Ne,damageNotation:L,attackName:m.name,applyHalfDamage:ee,bonusBreakdown:B})}function ae(m){if(!m.damage){St.add(`${m.name}: No damage specified`,"error");return}let L=m.damage,ee=!1;const B=[];if(m.spellRef){const K=Z(m.spellRef);if(K&&K.level>0){const Ne=m.castAtLevel||K.level;if(!q(Ne)){St.add(`No level ${Ne} spell slots available!`,"error");return}const he=pa(K);he&&m.targetSucceededSave&&he.noDamageOnSave?L="0":(ee=he?.halfDamageOnSave&&m.targetSucceededSave||!1,L=oe(m,K))}}else{const K=L.match(/(\d+d\d+)([+-]\d+)?/);if(K){const[,Ne,se]=K,he=se?parseInt(se):0;if(he!==0&&B.push({value:he,source:"base"}),t().activeStates&&t().activeStates.length>0){let He=0;for(const Me of t().activeStates)Me.damageBonus!==0&&(B.push({value:Me.damageBonus,source:Me.name.toLowerCase()}),He+=Me.damageBonus);if(He!==0){const Me=he+He;L=`${Ne}${Me>=0?"+":""}${Me}`}}}}X("roll",{notation:L,attackName:m.name,applyHalfDamage:ee,bonusBreakdown:B})}function O(){_t.update(m=>({...m,attacks:!m.attacks}))}let je=M([]),ye=M(!1);ia(async()=>{c(je,await es()),c(ye,!0)});function Z(m){return e(je).find(L=>L.name===m)}function q(m){t().classFeatures.spellSlotsByLevel||st(Y,r(t).classFeatures.spellSlotsByLevel={},r(t)),t().classFeatures.spellSlotsByLevel[m]||st(Y,r(t).classFeatures.spellSlotsByLevel[m]=Array(2).fill(!1),r(t));const ee=t().classFeatures.spellSlotsByLevel[m].findIndex(B=>!B);return ee===-1?!1:(Y.update(B=>(B.classFeatures.spellSlotsByLevel||(B.classFeatures.spellSlotsByLevel={}),B.classFeatures.spellSlotsByLevel[m]||(B.classFeatures.spellSlotsByLevel[m]=Array(2).fill(!1)),B.classFeatures.spellSlotsByLevel[m][ee]=!0,B)),!0)}function oe(m,L){let ee=m.damage,B=0,K=0;if(Xs(L)&&(K+=Hs(t(),v())),t().activeStates)for(const D of t().activeStates)K+=D.damageBonus;if(L.higherLevelSlot&&m.castAtLevel){const D=L.level,Be=(m.castAtLevel||D)-D;if(Be>0){const le=L.higherLevelSlot.match(/(\d+)d(\d+)\s+for\s+each.*?level\s+above/i);if(le){const[,I]=le;B+=Be*parseInt(I)}}}if(m.targetIsFiendOrUndead&&L.description.includes("Fiend or an Undead")){const D=L.description.match(/increases by (\d+)d(\d+) if.*?Fiend or.*?Undead/i);if(D){const[,u]=D;B+=parseInt(u)}}const Ne=ee.match(/(\d+)d(\d+)([+-]\d+)?/);if(!Ne)return K!==0?K>=0?`${K}`:`${K}`:ee||"0";const[,se,he,He]=Ne,Me=parseInt(se)+B,A=(He?parseInt(He):0)+K;let R=`${Me}d${he}`;return A!==0&&(R+=A>=0?`+${A}`:`${A}`),R}function ke(m){const L=[];for(let B=m.level;B<=9;B++){const K=t().classFeatures.spellSlotsByLevel?.[B];K&&K.length>0&&L.push(B)}return L}function _e(){Y.update(m=>(m.activeStates||(m.activeStates=[]),m.activeStates=[...m.activeStates,{name:"",attackBonus:0,damageBonus:0,description:""}],m))}function Ee(m){Y.update(L=>(L.activeStates&&(L.activeStates=L.activeStates.filter((ee,B)=>B!==m)),L))}function C(m){const L=Z(m.spellRef);if(!L){St.add("Spell not found","error");return}const ee=m.castAtLevel||L.level;if(ee>0&&!q(ee)){St.add(`No level ${ee} spell slots available!`,"error");return}const B=Zs(L);if(!B){St.add(`${L.name} cast! Check spell description for effects.`,"info");return}Y.update(K=>(K.activeStates||(K.activeStates=[]),K.activeStates=K.activeStates.filter(Ne=>Ne.name!==L.name),K.activeStates=[...K.activeStates,{name:L.name,attackBonus:B.attackBonus,damageBonus:B.damageBonus,description:B.description}],K)),St.add(`${L.name} cast! Effect added to Active Spell Effects.`,"success")}Ze(()=>(t(),f()),()=>{c(E,t().attacks.filter(m=>{if(!f())return!0;const L=f().toLowerCase();return m.name.toLowerCase().includes(L)||m.damageType.toLowerCase().includes(L)}).sort((m,L)=>!m.spellRef&&L.spellRef?-1:m.spellRef&&!L.spellRef?1:0))}),Ze(()=>(f(),e(E)),()=>{c(re,!f()||e(E).length>0||"attack".includes(f().toLowerCase())||"spell".includes(f().toLowerCase()))}),Tt(),Ct();var ce=Al();let ve;var de=i(ce),g=s(i(de),2),T=i(g,!0);l(g),l(de);var ue=s(de,2);{var Pe=m=>{var L=jl(),ee=qe(L),B=s(ee,2),K=i(B);ct(K,1,()=>e(E),D=>D.id,(D,u,Be)=>{var le=xl(),I=i(le),J=i(I);Le(J);var S=s(J,2);{var $e=G=>{var Q=el();j("click",Q,()=>ne(e(u).id)),o(G,Q)};x(S,G=>{k()&&G($e)})}l(I);var we=s(I,2),Ie=i(we),We=s(i(Ie),2);Le(We),l(Ie);var ze=s(Ie,2),Re=s(i(ze),2);Le(Re),l(ze);var te=s(ze,2),Ce=s(i(te),2);Le(Ce),l(te),l(we);var Ue=s(we,2);{var Ge=G=>{var Q=lt(),fe=qe(Q);{var Ke=z=>{var d=tl();o(z,d)},p=z=>{const d=at(()=>(e(u),r(()=>Z(e(u).spellRef))));var Ae=lt(),Je=qe(Ae);{var et=me=>{var H=bl(),Te=qe(H);{var Xe=pt=>{var bt=al(),Rt=s(i(bt),2),Yt=i(Rt,!0);l(Rt),l(bt),P(()=>$(Yt,(e(u),r(()=>e(u).generalNotes)))),o(pt,bt)};x(Te,pt=>{e(u),r(()=>e(u).generalNotes)&&pt(Xe)})}var Gt=s(Te,2),ot=i(Gt),nt=s(i(ot),2),At=i(nt,!0);l(nt),l(ot);var kt=s(ot,2);{var Bt=pt=>{var bt=ll(),Rt=i(bt),Yt=s(i(Rt));l(Rt);var Xt=s(Rt,2),ma=s(i(Xt));l(Xt);var Ft=s(Xt,2),xt=s(i(Ft));l(Ft);var Wt=s(Ft,2),zt=s(i(Wt)),na=s(zt);{var Ot=Ye=>{var rt=mt();P(()=>$(rt,`(${U(e(d)),r(()=>e(d).material)??""})`)),o(Ye,rt)};x(na,Ye=>{U(e(d)),r(()=>e(d).material)&&Ye(Ot)})}l(Wt);var Zt=s(Wt,2),oa=s(i(Zt),2);{var ca=Ye=>{var rt=mt("Concentration,");o(Ye,rt)};x(oa,Ye=>{U(e(d)),r(()=>e(d).concentration)&&Ye(ca)})}var _a=s(oa,1,!0);l(Zt);var ea=s(Zt,2),ya=s(i(ea));l(ea);var vt=s(ea,2);{var ft=Ye=>{var rt=sl(),Dt=s(i(rt));l(rt),P(()=>$(Dt,` ${U(e(d)),r(()=>e(d).higherLevelSlot)??""}`)),o(Ye,rt)};x(vt,Ye=>{U(e(d)),r(()=>e(d).higherLevelSlot)&&Ye(ft)})}l(bt),P(Ye=>{$(Yt,` ${U(e(d)),r(()=>e(d).level)??""}`),$(ma,` ${U(e(d)),r(()=>e(d).castingTime||e(d).actionType)??""}`),$(xt,` ${U(e(d)),r(()=>e(d).range)??""}`),$(zt,` ${Ye??""}`),$(_a,(U(e(d)),r(()=>e(d).duration))),$(ya,` ${U(e(d)),r(()=>e(d).description)??""}`)},[()=>(U(e(d)),r(()=>e(d).components.join(", ")))]),o(pt,bt)};x(kt,pt=>{e(N),e(u),r(()=>!e(N)[e(u).id])&&pt(Bt)})}l(Gt);var It=s(Gt,2);{var Qt=pt=>{const bt=at(()=>(U(e(d)),r(()=>ke(e(d)))));var Rt=lt(),Yt=qe(Rt);{var Xt=Ft=>{const xt=at(()=>(U(pa),U(e(d)),r(()=>pa(e(d)))));var Wt=pl(),zt=qe(Wt),na=i(zt),Ot=s(na,2);P(()=>{e(u),ht(()=>{e(bt)})}),ct(Ot,5,()=>e(bt),dt,(vt,ft)=>{var Ye=il(),rt=i(Ye);l(Ye);var Dt={};P(()=>{$(rt,`Level ${e(ft)??""}`),Dt!==(Dt=e(ft))&&(Ye.value=(Ye.__value=e(ft))??"")}),o(vt,Ye)}),l(Ot);var Zt=s(Ot,2);{var oa=vt=>{const ft=at(()=>(e(u),U(e(d)),r(()=>oe(e(u),e(d)))));var Ye=rl(),rt=i(Ye);{var Dt=Mt=>{var Pt=mt("Healing");o(Mt,Pt)},Kt=Mt=>{var Pt=mt("Damage");o(Mt,Pt)};x(rt,Mt=>{U(e(d)),r(()=>be(e(d)))?Mt(Dt):Mt(Kt,!1)})}var Et=s(rt);l(Ye),P(()=>$(Et,` ${e(ft)??""}`)),o(vt,Ye)};x(Zt,vt=>{e(u),U(e(d)),r(()=>e(u).castAtLevel&&e(u).castAtLevel>e(d).level)&&vt(oa)})}l(zt);var ca=s(zt,2);{var _a=vt=>{var ft=ol(),Ye=i(ft),rt=i(Ye);Le(rt);var Dt=s(rt,2);{var Kt=Et=>{const Mt=at(()=>(e(u),U(e(d)),r(()=>oe(e(u),e(d)))));var Pt=nl(),ka=i(Pt);l(Pt),P(()=>$(ka,`(+1d8, total: ${e(Mt)??""})`)),o(Et,Pt)};x(Dt,Et=>{e(u),r(()=>e(u).targetIsFiendOrUndead)&&Et(Kt)})}l(Ye),l(ft),ba(rt,()=>e(u).targetIsFiendOrUndead,Et=>(e(u).targetIsFiendOrUndead=Et,ht(()=>(e(E),t(),f())))),o(vt,ft)};x(ca,vt=>{U(e(d)),r(()=>e(d).description.includes("Fiend or an Undead"))&&vt(_a)})}var ea=s(ca,2);{var ya=vt=>{var ft=ul(),Ye=i(ft),rt=i(Ye);Le(rt);var Dt=s(rt),Kt=s(Dt);{var Et=gt=>{var Ht=cl(),xa=i(Ht);l(Ht),P(Sa=>$(xa,`(Spell Save DC: ${Sa??""})`),[()=>(U(Fa),t(),v(),r(()=>Fa(t(),v())))]),o(gt,Ht)};x(Kt,gt=>{t(),r(()=>t().class)&&gt(Et)})}var Mt=s(Kt,2);{var Pt=gt=>{var Ht=vl();o(gt,Ht)},ka=gt=>{var Ht=lt(),xa=qe(Ht);{var Sa=$a=>{var ts=dl();o($a,ts)};x(xa,$a=>{e(u),U(e(xt)),r(()=>e(u).targetSucceededSave&&e(xt).noDamageOnSave)&&$a(Sa)},!0)}o(gt,Ht)};x(Mt,gt=>{e(u),U(e(xt)),r(()=>e(u).targetSucceededSave&&e(xt).halfDamageOnSave)?gt(Pt):gt(ka,!1)})}l(Ye),l(ft),P(gt=>$(Dt,` Target succeeded on ${gt??""} save `),[()=>(U(e(xt)),r(()=>e(xt).ability.charAt(0).toUpperCase()+e(xt).ability.slice(1)))]),ba(rt,()=>e(u).targetSucceededSave,gt=>(e(u).targetSucceededSave=gt,ht(()=>(e(E),t(),f())))),o(vt,ft)};x(ea,vt=>{e(xt)&&vt(ya)})}P(()=>{tt(na,"for",`castLevel-${e(u),r(()=>e(u).id)??""}`),tt(Ot,"id",`castLevel-${e(u),r(()=>e(u).id)??""}`)}),Xa(Ot,()=>e(u).castAtLevel,vt=>(e(u).castAtLevel=vt,ht(()=>(e(E),t(),f())))),o(Ft,Wt)},ma=Ft=>{var xt=fl();o(Ft,xt)};x(Yt,Ft=>{U(e(bt)),r(()=>e(bt).length>0)?Ft(Xt):Ft(ma,!1)})}o(pt,Rt)};x(It,pt=>{U(e(d)),r(()=>e(d).higherLevelSlot&&e(d).level>0)&&pt(Qt)})}P(()=>{tt(nt,"aria-label",(e(N),e(u),r(()=>e(N)[e(u).id]?"Expand":"Collapse"))),$(At,(e(N),e(u),r(()=>e(N)[e(u).id]?"â–¼":"â–²")))}),j("click",ot,()=>Se(e(u).id)),j("keydown",ot,pt=>pt.key==="Enter"&&Se(e(u).id)),o(me,H)},Ve=me=>{var H=gl();o(me,H)};x(Je,me=>{e(d)?me(et):me(Ve,!1)})}o(z,Ae)};x(fe,z=>{e(je),r(()=>e(je).length===0)?z(Ke):z(p,!1)})}o(G,Q)};x(Ue,G=>{e(u),r(()=>e(u).spellRef)&&G(Ge)})}var W=s(Ue,2);{var xe=G=>{var Q=hl(),fe=s(i(Q),2);aa(fe),l(Q),Fe(fe,()=>e(u).notes,Ke=>(e(u).notes=Ke,ht(()=>(e(E),t(),f())))),o(G,Q)};x(W,G=>{e(u),r(()=>!e(u).spellRef)&&G(xe)})}var Oe=s(W,2),h=i(Oe);{var w=G=>{var Q=ml();j("click",Q,()=>ge(e(u))),o(G,Q)};x(h,G=>{e(u),r(()=>e(u).bonus!==0||!e(u).spellRef)&&G(w)})}var ie=s(h,2);{var V=G=>{const Q=at(()=>(e(u),r(()=>Z(e(u).spellRef))));var fe=lt(),Ke=qe(fe);{var p=d=>{var Ae=_l();j("click",Ae,()=>C(e(u))),o(d,Ae)},z=d=>{var Ae=yl(),Je=i(Ae);{var et=me=>{var H=mt("Roll Healing");o(me,H)},Ve=me=>{var H=mt("Roll Damage");o(me,H)};x(Je,me=>{U(e(Q)),r(()=>e(Q)&&be(e(Q)))?me(et):me(Ve,!1)})}l(Ae),j("click",Ae,()=>ae(e(u))),o(d,Ae)};x(Ke,d=>{U(e(Q)),U(Na),r(()=>e(Q)&&Na(e(Q)))?d(p):d(z,!1)})}o(G,fe)},pe=G=>{var Q=kl();j("click",Q,()=>ae(e(u))),o(G,Q)};x(ie,G=>{e(u),e(ye),r(()=>e(u).spellRef&&e(ye))?G(V):G(pe,!1)})}l(Oe),l(le),Fe(J,()=>e(u).name,G=>(e(u).name=G,ht(()=>(e(E),t(),f())))),Fe(We,()=>e(u).bonus,G=>(e(u).bonus=G,ht(()=>(e(E),t(),f())))),Fe(Re,()=>e(u).damage,G=>(e(u).damage=G,ht(()=>(e(E),t(),f())))),Fe(Ce,()=>e(u).damageType,G=>(e(u).damageType=G,ht(()=>(e(E),t(),f())))),o(D,le)});var Ne=s(K,2);{var se=D=>{var u=Sl();o(D,u)},he=D=>{var u=lt(),Be=qe(u);{var le=I=>{var J=$l();o(I,J)};x(Be,I=>{e(E),r(()=>e(E).length===0)&&I(le)},!0)}o(D,u)};x(Ne,D=>{t(),r(()=>t().attacks.length===0)?D(se):D(he,!1)})}l(B);var He=s(B,2),Me=s(i(He),4),it=s(Me,2);{var A=D=>{var u=wl();ct(u,5,()=>(t(),r(()=>t().activeStates)),dt,(Be,le,I)=>{var J=Ll(),S=i(J),$e=i(S);Le($e);var we=s($e,2);{var Ie=W=>{var xe=Cl();j("click",xe,()=>Ee(I)),o(W,xe)};x(we,W=>{k()&&W(Ie)})}l(S);var We=s(S,2),ze=i(We),Re=s(i(ze),2);Le(Re),l(ze);var te=s(ze,2),Ce=s(i(te),2);Le(Ce),l(te),l(We);var Ue=s(We,2),Ge=s(i(Ue),2);Le(Ge),l(Ue),l(J),Fe($e,()=>e(le).name,W=>(e(le).name=W,ht(()=>t()),va(F,"$character"))),Fe(Re,()=>e(le).attackBonus,W=>(e(le).attackBonus=W,ht(()=>t()),va(F,"$character"))),Fe(Ce,()=>e(le).damageBonus,W=>(e(le).damageBonus=W,ht(()=>t()),va(F,"$character"))),Fe(Ge,()=>e(le).description,W=>(e(le).description=W,ht(()=>t()),va(F,"$character"))),o(Be,J)}),l(u),o(D,u)},R=D=>{var u=Dl();o(D,u)};x(it,D=>{t(),r(()=>t().activeStates&&t().activeStates.length>0)?D(A):D(R,!1)})}l(He),j("click",ee,De),j("click",Me,_e),o(m,L)};x(ue,m=>{_(),r(()=>!_().attacks)&&m(Pe)})}l(ce),P(()=>{ve=ut(ce,1,"attacks svelte-14o91c5",null,ve,{hidden:!e(re)}),tt(g,"aria-label",(_(),r(()=>_().attacks?"Expand":"Collapse"))),$(T,(_(),r(()=>_().attacks?"â–¼":"â–²")))}),j("click",g,O),o(a,ce),wt(),y()}var Ml=b('<span class="slot-checkbox-x svelte-serp1j">&#8212;</span>'),Bl=b('<label><input type="checkbox" class="slot-checkbox-input svelte-serp1j"/> <span><!></span></label>');function Ga(a,n){Lt(n,!1);const t=()=>Qe(sa,"$isEditMode",v),[v,f]=jt();let _=yt(n,"checked",8,!1),k=yt(n,"disabled",8,!1),F=yt(n,"className",8,""),y=yt(n,"index",8,void 0),E=yt(n,"ariaLabel",8,void 0);const re=qt();function X(ge){re("change",{checked:ge.currentTarget.checked,index:y()})}Ct();var N=Bl(),Se=i(N);Le(Se);var be=s(Se,2),De=i(be);{var ne=ge=>{var ae=Ml();o(ge,ae)};x(De,ge=>{_()&&ge(ne)})}l(be),l(N),P(()=>{ut(N,1,"slot-checkbox-label "+F()+(t()?"":" not-editable"),"svelte-serp1j"),xs(Se,_()),Se.disabled=k()||!t(),tt(Se,"aria-label",E()),tt(Se,"tabindex",t()?0:-1),ut(be,1,`slot-checkbox-custom ${_()?"used":""} ${t()?"":"readonly"}`,"svelte-serp1j")}),j("change",Se,X),o(a,N),wt(),f()}var Il=b('<p class="no-features svelte-1kpvv0n">Select a class to see available features</p>'),Rl=b('<p class="no-features svelte-1kpvv0n">No class features available at this level</p>'),El=b('<div class="spell-slots svelte-1kpvv0n"><label class="svelte-1kpvv0n"> </label> <div class="slots-tracker svelte-1kpvv0n"></div></div>'),Pl=b('<div class="all-spell-slots"></div>'),Tl=b('<div class="feature-box spellcasting svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"> </h3> <div class="spell-stats svelte-1kpvv0n"><div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Spell Save DC</label> <div class="spell-value svelte-1kpvv0n"> </div></div> <div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <div class="spell-value svelte-1kpvv0n"> </div></div></div> <!> <div class="prepared-spells svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <textarea placeholder="List your prepared spells..." class="svelte-1kpvv0n"></textarea></div></div>'),Hl=b('<p class="unlimited svelte-1kpvv0n">Unlimited Uses</p>'),Ul=b('<div class="slots-tracker svelte-1kpvv0n"></div> <div class="uses-actions-row"><button class="btn btn-primary use-enabled"> </button></div> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div>',1),Nl=b('<div class="uses-tracker svelte-1kpvv0n"><!></div>'),Gl=b('<div class="pool-tracker svelte-1kpvv0n"><input type="number" min="0" class="pool-input svelte-1kpvv0n"/> <span> </span> <button class="btn-small svelte-1kpvv0n"> </button></div>'),Ol=b('<p class="no-uses svelte-1kpvv0n">No Channel Divinity uses remaining</p>'),ql=b('<div class="channel-divinity-option svelte-1kpvv0n"><button class="btn btn-primary use-enabled svelte-1kpvv0n">Use Channel Divinity</button> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div> <!></div>'),Wl=b('<div class="feature-box svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"><!> </h3> <p class="feature-description svelte-1kpvv0n"> </p> <!></div>'),zl=b('<div class="features-grid svelte-1kpvv0n"><!> <!></div>'),Kl=b('<section><div class="header svelte-1kpvv0n"><h2 class="svelte-1kpvv0n">Class Features</h2> <button class="collapse-btn svelte-1kpvv0n"> </button></div> <!></section>');function Jl(a,n){Lt(n,!1);const t=()=>Qe(Y,"$character",k),v=()=>Qe(ra,"$abilityModifiers",k),f=()=>Qe(Nt,"$searchFilter",k),_=()=>Qe(_t,"$collapsedStates",k),[k,F]=jt(),y=M(),E=M(),re=M(),X=M(),N=M(),Se=M(),be=M();let De=M(0),ne=M(0);function ge(g,T){Y.update(ue=>(ue.classFeatures.features[g]=T,ue))}function ae(){Y.update(g=>(g.classFeatures.spellSlotsByLevel||(g.classFeatures.spellSlotsByLevel={}),e(X).forEach(({level:T,slots:ue})=>{g.classFeatures.spellSlotsByLevel[T]||(g.classFeatures.spellSlotsByLevel[T]=Array(ue).fill(!1))}),g))}function O(g){if(typeof g.maxUses=="function"){if((g.name==="Divine Sense"||g.name==="War Priest")&&e(y)?.spellcastingAbility){const T=v()[e(y).spellcastingAbility];return g.maxUses(t().level,T)}return g.maxUses(t().level)}return g.maxUses||0}function je(g,T){Y.update(ue=>((!ue.classFeatures.features[g]||!Array.isArray(ue.classFeatures.features[g])||ue.classFeatures.features[g].length!==T)&&(ue.classFeatures.features[g]=Array(T).fill(!1)),ue))}as(()=>{e(Se)&&t()&&t().classFeatures&&t().classFeatures.features&&e(Se).forEach(g=>{if(g.type==="uses"){const T=g.name.replace(/\s+/g,""),ue=O(g),Pe=t().classFeatures.features[T];(!Array.isArray(Pe)||Pe.length!==ue)&&je(T,ue)}})});function ye(g){return typeof g.maxPool=="function"?g.maxPool(t().level):g.maxPool||0}function Z(g){return typeof g.description=="function"?g.description(t().level):g.description}function q(){const g="ChannelDivinity";Y.update(T=>{const ue=T.classFeatures.features[g];return typeof ue=="number"&&ue>0&&(T.classFeatures.features[g]=ue-1),T})}function oe(){_t.update(g=>({...g,classFeatures:!g.classFeatures}))}Ze(()=>(t(),$t),()=>{c(y,t().class?$t(t().class):null)}),Ze(()=>(t(),Vt),()=>{c(E,t().class?Vt(t().class,t().level,t().subclass):[])}),Ze(()=>(t(),Ta),()=>{c(re,t().class?Ta(t().class,t().level):0)}),Ze(()=>(e(y),t()),()=>{c(X,(()=>{if(!e(y)?.spellcaster)return[];const g=t().level,T=[];return g>=1&&T.push({level:1,slots:Math.min(4,2+Math.floor(g/3))}),g>=3&&T.push({level:2,slots:Math.min(3,2+Math.floor((g-3)/4))}),g>=5&&T.push({level:3,slots:Math.min(3,2+Math.floor((g-5)/5))}),g>=7&&T.push({level:4,slots:Math.min(3,1+Math.floor((g-7)/6))}),g>=9&&T.push({level:5,slots:Math.min(2,1+Math.floor((g-9)/8))}),g>=11&&T.push({level:6,slots:1}),g>=13&&T.push({level:7,slots:1}),g>=15&&T.push({level:8,slots:1}),g>=17&&T.push({level:9,slots:1}),T})())}),Ze(()=>(e(y),v(),t(),Ha),()=>{if(e(y)?.spellcaster&&e(y).spellcastingAbility){const g=v()[e(y).spellcastingAbility];c(De,Ls(t().class,g,t().proficiencyBonus)||0),c(ne,Ha(t().class,t().level,g))}}),Ze(()=>(t(),e(y),e(X)),()=>{t().class&&e(y)?.spellcaster&&e(X).length>0&&ae()}),Ze(()=>t(),()=>{c(N,(()=>{const T=t().classFeatures.features["ChannelDivinity"];return typeof T=="number"?T:0})())}),Ze(()=>(e(E),f()),()=>{c(Se,e(E).filter(g=>{if(!f())return!0;const T=f().toLowerCase();return g.name.toLowerCase().includes(T)||Z(g).toLowerCase().includes(T)}))}),Ze(()=>(f(),t(),e(Se)),()=>{c(be,!f()||t().class||"class features".includes(f().toLowerCase())||"spellcasting".includes(f().toLowerCase())||e(Se).length>0)}),Tt(),Ct();var ke=Kl();let _e;var Ee=i(ke),C=s(i(Ee),2),ce=i(C,!0);l(C),l(Ee);var ve=s(Ee,2);{var de=g=>{var T=lt(),ue=qe(T);{var Pe=L=>{var ee=Il();o(L,ee)},m=L=>{var ee=lt(),B=qe(ee);{var K=se=>{var he=Rl();o(se,he)},Ne=se=>{var he=zl(),He=i(he);{var Me=A=>{var R=Tl(),D=i(R),u=i(D);l(D);var Be=s(D,2),le=i(Be),I=s(i(le),2),J=i(I,!0);l(I),l(le);var S=s(le,2),$e=s(i(S),2),we=i($e,!0);l($e),l(S),l(Be);var Ie=s(Be,2);{var We=te=>{var Ce=Pl();ct(Ce,5,()=>e(X),dt,(Ue,Ge)=>{let W=()=>e(Ge).level,xe=()=>e(Ge).slots;const Oe=at(()=>(t(),W(),xe(),r(()=>t().classFeatures.spellSlotsByLevel?.[W()]||Array(xe()).fill(!1))));var h=El(),w=i(h),ie=i(w);l(w);var V=s(w,2);ct(V,5,()=>e(Oe),dt,(pe,G,Q)=>{{let fe=at(()=>(U(e(Oe)),r(()=>e(Oe)[Q]||!1)));Ga(pe,{get checked(){return e(fe)},$$events:{change:Ke=>{Y.update(p=>(p.classFeatures.spellSlotsByLevel||(p.classFeatures.spellSlotsByLevel={}),p.classFeatures.spellSlotsByLevel[W()]||(p.classFeatures.spellSlotsByLevel[W()]=Array(xe()).fill(!1)),p.classFeatures.spellSlotsByLevel[W()][Q]=Ke.detail.checked,p))}}})}}),l(V),l(h),P(()=>$(ie,`${W()===1?"1st":W()===2?"2nd":W()===3?"3rd":`${W()}th`} Level Spell Slots`)),o(Ue,h)}),l(Ce),o(te,Ce)};x(Ie,te=>{e(X),r(()=>e(X).length>0)&&te(We)})}var ze=s(Ie,2),Re=s(i(ze),2);aa(Re),l(ze),l(R),P(te=>{$(u,`Spellcasting (${te??""})`),$(J,e(De)),$(we,e(ne))},[()=>(e(y),r(()=>e(y).spellcastingAbility?.toUpperCase()))]),Fe(Re,()=>t().classFeatures.preparedSpells,te=>st(Y,r(t).classFeatures.preparedSpells=te,r(t))),o(A,R)};x(He,A=>{e(y),r(()=>e(y)?.spellcaster)&&A(Me)})}var it=s(He,2);ct(it,1,()=>e(Se),dt,(A,R)=>{const D=at(()=>(e(R),r(()=>e(R).name.replace(/\s+/g,"")))),u=at(()=>(t(),U(e(D)),r(()=>t().classFeatures.features[e(D)]))),Be=at(()=>typeof e(u)=="number");var le=Wl(),I=i(le),J=i(I);{var S=te=>{var Ce=mt("Channel Divinity:");o(te,Ce)};x(J,te=>{e(R),r(()=>e(R).type==="channelDivinity")&&te(S)})}var $e=s(J);l(I);var we=s(I,2),Ie=i(we,!0);l(we);var We=s(we,2);{var ze=te=>{const Ce=at(()=>(e(R),r(()=>O(e(R))))),Ue=at(()=>(U(e(u)),U(e(Ce)),r(()=>Array.isArray(e(u))?e(u):Array(e(Ce)).fill(!1))));var Ge=Nl(),W=i(Ge);{var xe=h=>{var w=Hl();o(h,w)},Oe=h=>{var w=Ul(),ie=qe(w);ct(ie,5,()=>e(Ue),dt,(p,z,d)=>{Ga(p,{get checked(){return e(z)},index:d,$$events:{change:Ae=>{Y.update(Je=>(Je.classFeatures.features[e(D)]||(Je.classFeatures.features[e(D)]=Array(e(Ce)).fill(!1)),Je.classFeatures.features[e(D)][d]=Ae.detail.checked,Je))}}})}),l(ie);var V=s(ie,2),pe=i(V),G=i(pe);l(pe),l(V);var Q=s(V,2),fe=i(Q),Ke=i(fe);l(fe),l(Q),P(p=>{pe.disabled=p,$(G,`Use ${e(R),r(()=>e(R).name)??""}`),$(Ke,`Resets on ${e(R),r(()=>e(R).resetOn==="short"?"Short Rest":"Long Rest")??""}`)},[()=>(U(e(Ue)),r(()=>e(Ue).filter(p=>!p).length<=0))]),j("click",pe,()=>{Y.update(p=>{p.classFeatures.features[e(D)]||(p.classFeatures.features[e(D)]=Array(e(Ce)).fill(!1));const z=p.classFeatures.features[e(D)],d=z.findIndex(Ae=>!Ae);return d!==-1&&(z[d]=!0),p})}),o(h,w)};x(W,h=>{e(Ce)===1/0?h(xe):h(Oe,!1)})}l(Ge),o(te,Ge)},Re=te=>{var Ce=lt(),Ue=qe(Ce);{var Ge=xe=>{const Oe=at(()=>(e(R),r(()=>ye(e(R)))));var h=Gl(),w=i(h);Le(w);var ie=s(w,2),V=i(ie);l(ie);var pe=s(ie,2),G=i(pe,!0);l(pe),l(h),P(()=>{Ba(w,e(Be)&&e(u)!==void 0?e(u):e(Oe)),tt(w,"max",e(Oe)),$(V,`/ ${e(Oe)??""}`),$(G,(e(R),r(()=>e(R).resetOn==="short"?"Short Rest":"Long Rest")))}),j("input",w,Q=>{Y.update(fe=>(fe.classFeatures.features[e(D)]=parseInt(Q.currentTarget.value)||0,fe))}),j("click",pe,()=>ge(e(D),e(Oe))),o(xe,h)},W=xe=>{var Oe=lt(),h=qe(Oe);{var w=ie=>{var V=ql(),pe=i(V),G=s(pe,2),Q=i(G),fe=i(Q);l(Q),l(G);var Ke=s(G,2);{var p=z=>{var d=Ol();o(z,d)};x(Ke,z=>{e(N)<=0&&z(p)})}l(V),P(()=>{pe.disabled=e(N)<=0,$(fe,`Resets on ${e(R),r(()=>e(R).resetOn==="short"?"Short Rest":"Long Rest")??""}`)}),j("click",pe,q),o(ie,V)};x(h,ie=>{e(R),r(()=>e(R).type==="channelDivinity")&&ie(w)},!0)}o(xe,Oe)};x(Ue,xe=>{e(R),r(()=>e(R).type==="pool")?xe(Ge):xe(W,!1)},!0)}o(te,Ce)};x(We,te=>{e(R),r(()=>e(R).type==="uses")?te(ze):te(Re,!1)})}l(le),P(te=>{$($e,` ${e(R),r(()=>e(R).name)??""}`),$(Ie,te)},[()=>(e(R),r(()=>Z(e(R))))]),o(A,le)}),l(he),o(se,he)};x(B,se=>{e(E),r(()=>e(E).length===0)?se(K):se(Ne,!1)},!0)}o(L,ee)};x(ue,L=>{t(),r(()=>!t().class)?L(Pe):L(m,!1)})}o(g,T)};x(ve,g=>{_(),r(()=>!_().classFeatures)&&g(de)})}l(ke),P(()=>{_e=ut(ke,1,"class-features svelte-1kpvv0n",null,_e,{hidden:!e(be)}),tt(C,"aria-label",(_(),r(()=>_().classFeatures?"Expand":"Collapse"))),$(ce,(_(),r(()=>_().classFeatures?"â–¼":"â–²")))}),j("click",C,oe),o(a,ke),wt(),F()}var Vl=b('<textarea placeholder="Enter features, traits, and special abilities..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Equipment</h3> <textarea placeholder="List your equipment and inventory..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Notes</h3> <textarea placeholder="Additional notes..." class="svelte-wttn0l"></textarea>',1),Ql=b('<section><div class="header svelte-wttn0l"><h2 class="svelte-wttn0l">Features & Traits</h2> <button class="collapse-btn svelte-wttn0l"> </button></div> <!></section>');function Yl(a,n){Lt(n,!1);const t=()=>Qe(Nt,"$searchFilter",_),v=()=>Qe(Y,"$character",_),f=()=>Qe(_t,"$collapsedStates",_),[_,k]=jt(),F=M();function y(){_t.update(ne=>({...ne,notes:!ne.notes}))}Ze(()=>(t(),v()),()=>{c(F,!t()||"features".includes(t().toLowerCase())||"traits".includes(t().toLowerCase())||"equipment".includes(t().toLowerCase())||"notes".includes(t().toLowerCase())||v().features.toLowerCase().includes(t().toLowerCase())||v().equipment.toLowerCase().includes(t().toLowerCase())||v().notes.toLowerCase().includes(t().toLowerCase()))}),Tt(),Ct();var E=Ql();let re;var X=i(E),N=s(i(X),2),Se=i(N,!0);l(N),l(X);var be=s(X,2);{var De=ne=>{var ge=Vl(),ae=qe(ge);aa(ae);var O=s(ae,4);aa(O);var je=s(O,4);aa(je),Fe(ae,()=>v().features,ye=>st(Y,r(v).features=ye,r(v))),Fe(O,()=>v().equipment,ye=>st(Y,r(v).equipment=ye,r(v))),Fe(je,()=>v().notes,ye=>st(Y,r(v).notes=ye,r(v))),o(ne,ge)};x(be,ne=>{f(),r(()=>!f().notes)&&ne(De)})}l(E),P(()=>{re=ut(E,1,"notes svelte-wttn0l",null,re,{hidden:!e(F)}),tt(N,"aria-label",(f(),r(()=>f().notes?"Expand":"Collapse"))),$(Se,(f(),r(()=>f().notes?"â–¼":"â–²")))}),j("click",N,y),o(a,E),wt(),k()}var Xl=b('<div class="color-picker-section svelte-1r90jgp"><h3 class="svelte-1r90jgp">Dice Colors</h3> <div class="color-inputs svelte-1r90jgp"><div class="color-input-group svelte-1r90jgp"><label for="dice-color" class="svelte-1r90jgp">Dice Color</label> <input type="color" id="dice-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="label-color" class="svelte-1r90jgp">Label Color</label> <input type="color" id="label-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="desk-color" class="svelte-1r90jgp">Background Color</label> <input type="color" id="desk-color" class="svelte-1r90jgp"/></div></div></div>'),Zl=b('<div class="loading svelte-1r90jgp"><p class="svelte-1r90jgp">Loading 3D dice...</p></div>'),ei=b('<div class="custom-dice-selector svelte-1r90jgp"><h3 class="svelte-1r90jgp">Choose Dice to Roll</h3> <div class="dice-inputs svelte-1r90jgp"><div class="dice-input-group svelte-1r90jgp"><label for="d4" class="svelte-1r90jgp">d4</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d4" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d6" class="svelte-1r90jgp">d6</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d6" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d8" class="svelte-1r90jgp">d8</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d8" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d10" class="svelte-1r90jgp">d10</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d10" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d12" class="svelte-1r90jgp">d12</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d12" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d20" class="svelte-1r90jgp">d20</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d20" min="0" max="10"/></div></div> <div class="dice-controls svelte-1r90jgp"><button class="btn btn-primary use-enabled svelte-1r90jgp"> </button> <button class="btn btn-secondary use-enabled svelte-1r90jgp">Reset</button></div></div>'),ti=b('<span class="crit-badge svelte-1r90jgp">CRITICAL!</span>'),ai=b('<p class="svelte-1r90jgp"> </p>'),si=b('<div class="bonus-item svelte-1r90jgp"><span class="bonus-value svelte-1r90jgp"> </span> <span class="bonus-source svelte-1r90jgp"> </span></div>'),li=b('<div class="bonus-breakdown svelte-1r90jgp"></div>'),ii=b('<p class="modifier-text svelte-1r90jgp"> </p>'),ri=b('<button class="btn btn-follow-up svelte-1r90jgp"> </button>'),ni=b('<button class="btn btn-guided-strike svelte-1r90jgp">âš¡ Use Guided Strike (+10)</button>'),oi=b('<div class="follow-up-actions svelte-1r90jgp"><!> <!></div>'),ci=b('<div class="result-header svelte-1r90jgp"><h3 class="svelte-1r90jgp"> </h3> <!></div> <div class="result-total svelte-1r90jgp"> </div> <div class="result-details svelte-1r90jgp"><!> <!></div> <!>',1),vi=b('<div role="button" tabindex="-1"><div class="modal-content svelte-1r90jgp" role="dialog" tabindex="0"><div class="modal-header svelte-1r90jgp"><h2 class="svelte-1r90jgp">Dice Roller</h2> <div class="header-buttons svelte-1r90jgp"><button class="color-btn svelte-1r90jgp" title="Customize dice colors">ðŸŽ¨</button> <button class="close-btn svelte-1r90jgp">Ã—</button></div></div> <!> <!> <div class="dice-main-area svelte-1r90jgp"><div class="dice-container svelte-1r90jgp"></div> <!></div> <div><!></div></div></div>');function di(a,n){Lt(n,!1);const t=()=>Qe(Y,"$character",v),[v,f]=jt(),_=M(),k=M(),F=M(),y=qt();let E=yt(n,"notation",12,""),re=yt(n,"visible",8,!1),X=yt(n,"damageNotation",12,""),N=yt(n,"attackName",12,""),Se=yt(n,"applyHalfDamage",8,!1),be=yt(n,"bonusBreakdown",24,()=>[]),De=null,ne=M(void 0),ge=M(!1),ae=M(""),O=M(null);function je(){return e(O)?.resultTotal??null}let ye=M(0),Z=M(0),q=M(0),oe=M(0),ke=M(0),_e=M(0),Ee=M(0),C=M([]),ce=M(!1),ve=M("other"),de=M(!1),g=M("#051e0a"),T=M("#ffffff"),ue=M("#3a2004"),Pe=M(!1);function m(h){return h.length===9&&h.startsWith("#")?h.substring(0,7):h}function L(h,w="ff"){return h.length===7&&h.startsWith("#")?h+w:h}function ee(){if(window.DICE&&e(ne))try{De&&e(ne)&&Va(ne,e(ne).innerHTML="");const h=e(ne).clientWidth||500,w=e(ne).clientHeight||300;De=new window.DICE.dice_box(e(ne),{w:h,h:w}),c(ge,!0)}catch(h){console.error("Error initializing dice box:",h)}}ia(()=>{const h=V=>new Promise((pe,G)=>{if(document.querySelector(`script[src="${V}"]`)){console.log(`Script already loaded: ${V}`),pe(null);return}const fe=document.createElement("script");fe.src=V,fe.onload=()=>{console.log(`Loaded: ${V}`),pe(null)},fe.onerror=()=>{console.error(`Failed to load: ${V}`),G(new Error(`Failed to load ${V}`))},document.head.appendChild(fe)});setTimeout(()=>{h(`${ta}/libs/three.min.js`).then(()=>h(`${ta}/libs/cannon.min.js`)).then(()=>h(`${ta}/libs/teal.js`)).then(()=>h(`${ta}/dice.js`)).then(()=>{if(console.log("All scripts loaded, initializing dice box..."),console.log("DICE available:",!!window.DICE),console.log("Container available:",!!e(ne)),window.DICE){const V=window.DICE.getColors();c(g,m(V.dice_color)),c(T,m(V.label_color)),c(ue,m(V.desk_color))}ee()}).catch(V=>{console.error("Failed to load dice libraries:",V)})},100);const w=()=>{e(ge)&&(console.log("Window resized, reinitializing dice box..."),ee())},ie=V=>{re()&&V.key==="Escape"&&A()};return window.addEventListener("resize",w),window.addEventListener("keydown",ie),()=>{window.removeEventListener("resize",w),window.removeEventListener("keydown",ie)}});function B(h,w="other"){if(!De||!e(ge))return;console.log("Rolling dice:",h,"type:",w),c(ve,w),c(de,!1),De.diceToRoll=h;const ie=pe=>(console.log("Before roll:",pe),null),V=pe=>{console.log("After roll:",pe);let G=pe.resultTotal,Q=pe.resultString;if(Se()&&(G=Math.floor(G/2),Q=Q+" (halved)"),c(O,{...pe,resultTotal:G,resultString:Q}),w==="attack"||w==="check"||w==="save"){const fe=pe.results?.filter(Ke=>Ke.sides===20)||[];if(fe.length>0){const Ke=fe[0].value;c(ce,Ke===20)}}if(c(C,[]),w==="attack"&&X())if(e(ce)){const fe=se(X());e(C).push({label:`Roll Critical Damage (${fe})`,notation:fe})}else e(C).push({label:`Roll Damage (${X()})`,notation:X()})};De.start_throw(ie,V)}function K(){const h=[];e(ye)>0&&h.push(`${e(ye)}d4`),e(Z)>0&&h.push(`${e(Z)}d6`),e(q)>0&&h.push(`${e(q)}d8`),e(oe)>0&&h.push(`${e(oe)}d10`),e(ke)>0&&h.push(`${e(ke)}d12`),e(_e)>0&&h.push(`${e(_e)}d20`);let w=h.join("+")||"1d20";return e(Ee)!==0&&(w+=e(Ee)>=0?`+${e(Ee)}`:`${e(Ee)}`),w}function Ne(){const h=K();B(h)}function se(h){return h.replace(/(\d+)d(\d+)/g,(w,ie,V)=>`${parseInt(ie)*2}d${V}`)}function he(){c(ye,0),c(Z,0),c(q,0),c(oe,0),c(ke,0),c(_e,0),c(Ee,0),c(O,null),c(C,[]),c(ce,!1),c(ve,"other"),c(de,!1)}function He(){window.DICE&&(window.DICE.setColors({dice_color:L(e(g),"ff"),label_color:L(e(T),"ff"),desk_color:e(ue)}),De&&(De.updateDeskColor(e(ue)),De.updateDiceColors()))}function Me(){c(Pe,!e(Pe))}function it(){!e(O)||e(k)<=0||e(de)||(c(O,{...e(O),resultTotal:e(O).resultTotal+10,resultString:e(O).resultString+" + 10 (Guided Strike)"}),Y.update(h=>{const w="ChannelDivinity",ie=h.classFeatures.features[w];return typeof ie=="number"&&ie>0&&(h.classFeatures.features[w]=ie-1),h}),c(de,!0))}function A(){y("close"),E(""),X(""),N(""),c(ae,""),c(O,null),c(de,!1),he()}Ze(()=>(t(),Vt),()=>{c(_,t().class?Vt(t().class,t().level,t().subclass).some(w=>w.name==="Guided Strike"):!1)}),Ze(()=>t(),()=>{c(k,(()=>{const w=t().classFeatures.features["ChannelDivinity"];return typeof w=="number"?w:0})())}),Ze(()=>(e(ye),e(Z),e(q),e(oe),e(ke),e(_e),e(Ee)),()=>{c(F,(()=>{const h=[];e(ye)>0&&h.push(`${e(ye)}d4`),e(Z)>0&&h.push(`${e(Z)}d6`),e(q)>0&&h.push(`${e(q)}d8`),e(oe)>0&&h.push(`${e(oe)}d10`),e(ke)>0&&h.push(`${e(ke)}d12`),e(_e)>0&&h.push(`${e(_e)}d20`);let w=h.join("+")||"1d20";return e(Ee)!==0&&(w+=e(Ee)>=0?`+${e(Ee)}`:`${e(Ee)}`),w})())}),Ze(()=>(U(E()),e(ge),U(re()),e(ae),U(X()),U(N())),()=>{if(E()&&e(ge)&&re()&&E()!==e(ae)){c(ae,E()),c(O,null),c(C,[]),c(ce,!1),c(de,!1);const h=E().includes("1d20")?"attack":"other";console.log("Auto-roll triggered. notation:",E(),"damageNotation:",X(),"attackName:",N()),setTimeout(()=>B(E(),h),200)}}),Tt();var R={getLastRollTotal:je};Ct();var D=vi();let u;var Be=i(D),le=i(Be),I=s(i(le),2),J=i(I),S=s(J,2);l(I),l(le);var $e=s(le,2);{var we=h=>{var w=Xl(),ie=s(i(w),2),V=i(ie),pe=s(i(V),2);Le(pe),l(V);var G=s(V,2),Q=s(i(G),2);Le(Q),l(G);var fe=s(G,2),Ke=s(i(fe),2);Le(Ke),l(fe),l(ie),l(w),Fe(pe,()=>e(g),p=>c(g,p)),j("change",pe,He),Fe(Q,()=>e(T),p=>c(T,p)),j("change",Q,He),Fe(Ke,()=>e(ue),p=>c(ue,p)),j("change",Ke,He),o(h,w)};x($e,h=>{e(Pe)&&h(we)})}var Ie=s($e,2);{var We=h=>{var w=Zl();o(h,w)};x(Ie,h=>{e(ge)||h(We)})}var ze=s(Ie,2),Re=i(ze);Da(Re,h=>c(ne,h),()=>e(ne));var te=s(Re,2);{var Ce=h=>{var w=ei(),ie=s(i(w),2),V=i(ie),pe=s(i(V),2);Le(pe),l(V);var G=s(V,2),Q=s(i(G),2);Le(Q),l(G);var fe=s(G,2),Ke=s(i(fe),2);Le(Ke),l(fe);var p=s(fe,2),z=s(i(p),2);Le(z),l(p);var d=s(p,2),Ae=s(i(d),2);Le(Ae),l(d);var Je=s(d,2),et=s(i(Je),2);Le(et),l(Je),l(ie);var Ve=s(ie,2),me=i(Ve),H=i(me);l(me);var Te=s(me,2);l(Ve),l(w),P(()=>{me.disabled=!e(ge),$(H,`Roll ${e(F)??""}`)}),Fe(pe,()=>e(ye),Xe=>c(ye,Xe)),Fe(Q,()=>e(Z),Xe=>c(Z,Xe)),Fe(Ke,()=>e(q),Xe=>c(q,Xe)),Fe(z,()=>e(oe),Xe=>c(oe,Xe)),Fe(Ae,()=>e(ke),Xe=>c(ke,Xe)),Fe(et,()=>e(_e),Xe=>c(_e,Xe)),j("click",me,Ne),j("click",Te,he),o(h,w)};x(te,h=>{E()||h(Ce)})}l(ze);var Ue=s(ze,2);let Ge;var W=i(Ue);{var xe=h=>{var w=ci(),ie=qe(w),V=i(ie),pe=i(V,!0);l(V);var G=s(V,2);{var Q=me=>{var H=ti();o(me,H)};x(G,me=>{e(ce)&&me(Q)})}l(ie);var fe=s(ie,2),Ke=i(fe,!0);l(fe);var p=s(fe,2),z=i(p);{var d=me=>{var H=ai(),Te=i(H,!0);l(H),P(()=>$(Te,(e(O),r(()=>e(O).resultString)))),o(me,H)};x(z,me=>{e(O),r(()=>e(O).resultString)&&me(d)})}var Ae=s(z,2);{var Je=me=>{var H=lt(),Te=qe(H);{var Xe=ot=>{var nt=li();ct(nt,5,be,dt,(At,kt)=>{var Bt=si(),It=i(Bt),Qt=i(It);l(It);var pt=s(It,2),bt=i(pt);l(pt),l(Bt),P(()=>{$(Qt,`${e(kt),r(()=>e(kt).value>=0?"+":"")??""}${e(kt),r(()=>e(kt).value)??""}`),$(bt,`(${e(kt),r(()=>e(kt).source)??""})`)}),o(At,Bt)}),l(nt),o(ot,nt)},Gt=ot=>{var nt=lt(),At=qe(nt);{var kt=Bt=>{var It=ii(),Qt=i(It);l(It),P(()=>$(Qt,`Modifier: ${e(O),r(()=>e(O).constant>=0?"+":"")??""}${e(O),r(()=>e(O).constant)??""}`)),o(Bt,It)};x(At,Bt=>{e(O),r(()=>e(O).constant)&&Bt(kt)},!0)}o(ot,nt)};x(Te,ot=>{U(be()),r(()=>be().length>0)?ot(Xe):ot(Gt,!1)})}o(me,H)};x(Ae,me=>{e(O),U(be()),r(()=>e(O).constant||be().length>0)&&me(Je)})}l(p);var et=s(p,2);{var Ve=me=>{var H=oi(),Te=i(H);ct(Te,1,()=>e(C),dt,(ot,nt)=>{var At=ri(),kt=i(At,!0);l(At),P(()=>$(kt,(e(nt),r(()=>e(nt).label)))),j("click",At,()=>B(e(nt).notation,"damage")),o(ot,At)});var Xe=s(Te,2);{var Gt=ot=>{var nt=ni();P(()=>{nt.disabled=e(k)<=0,tt(nt,"title",e(k)<=0?"No Channel Divinity uses remaining":"Use Channel Divinity to add +10 to this attack roll")}),j("click",nt,it),o(ot,nt)};x(Xe,ot=>{e(_)&&e(ve)==="attack"&&!e(de)&&ot(Gt)})}l(H),o(me,H)};x(et,me=>{e(C),e(_),e(ve),e(de),r(()=>e(C).length>0||e(_)&&e(ve)==="attack"&&!e(de))&&me(Ve)})}P(()=>{$(pe,N()?`${N()} - Result`:"Result"),$(Ke,(e(O),r(()=>e(O).resultTotal)))}),o(h,w)};x(W,h=>{e(O)&&h(xe)})}l(Ue),l(Be),l(D),P(()=>{u=ut(D,1,"modal-overlay svelte-1r90jgp",null,u,{hidden:!re()}),Ge=ut(Ue,1,"roll-result svelte-1r90jgp",null,Ge,{"has-result":e(O)})}),j("click",J,Me),j("click",S,A),j("click",Be,Ra(function(h){Jt.call(this,n,h)})),j("keydown",Be,function(h){Jt.call(this,n,h)}),j("click",D,A),j("keydown",D,h=>h.key==="Escape"&&A()),o(a,D),$s(n,"getLastRollTotal",je);var Oe=wt(R);return f(),Oe}const ha="https://api.github.com/gists";async function ui(a,n,t){if(!n)throw new Error("GitHub token is required");const v=JSON.stringify(a,null,2),f=`${a.name||"character"}_dnd.json`,_={description:t||`D&D Character: ${a.name}`,public:!1,files:{[f]:{content:v}}},k=await fetch(ha,{method:"POST",headers:{Authorization:`token ${n}`,"Content-Type":"application/json"},body:JSON.stringify(_)});if(!k.ok)throw new Error(`Failed to create gist: ${k.statusText}`);return(await k.json()).id}async function pi(a,n,t){if(!n||!t)throw new Error("GitHub token and Gist ID are required");const v=JSON.stringify(a,null,2),_={files:{[`${a.name||"character"}_dnd.json`]:{content:v}}},k=await fetch(`${ha}/${t}`,{method:"PATCH",headers:{Authorization:`token ${n}`,"Content-Type":"application/json"},body:JSON.stringify(_)});if(!k.ok)throw new Error(`Failed to update gist: ${k.statusText}`)}async function fi(a,n){if(!a)throw new Error("Gist ID is required");const t={"Content-Type":"application/json"};n&&(t.Authorization=`token ${n}`);const v=await fetch(`${ha}/${a}`,{method:"GET",headers:t});if(!v.ok)throw new Error(`Failed to load gist: ${v.statusText}`);const f=await v.json(),_=Object.values(f.files);if(_.length===0)throw new Error("No files found in gist");const F=_[0].content;try{const y=JSON.parse(F);return y.attacks&&Array.isArray(y.attacks)&&(y.attacks=y.attacks.map(E=>({...E,id:E.id||crypto.randomUUID()}))),y.classFeatures?(y.classFeatures.features||(y.classFeatures.features={}),y.classFeatures.spellSlots||(y.classFeatures.spellSlots=[]),y.classFeatures.preparedSpells===void 0&&(y.classFeatures.preparedSpells="")):y.classFeatures={features:{},spellSlots:[],preparedSpells:""},y}catch{throw new Error("Invalid character data in gist")}}function Oa(a){typeof window<"u"&&localStorage.setItem("dnd_gist_config",JSON.stringify(a))}function bi(){if(typeof window<"u"){const a=localStorage.getItem("dnd_gist_config");if(a)return JSON.parse(a)}return{}}async function gi(a,n=30){if(!a)throw new Error("GitHub token is required to list gists");const t=await fetch(`${ha}?per_page=${n}`,{method:"GET",headers:{Authorization:`token ${a}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error(`Failed to list gists: ${t.statusText}`);return await t.json()}var hi=b('<div class="error-message svelte-1jb5ckg"> </div>'),mi=b('<div class="toggle-container svelte-1jb5ckg"><button type="button" class="toggle-btn svelte-1jb5ckg"> </button></div>'),_i=b('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID (leave empty to create new)</label> <input type="text" id="gistId" placeholder="Optional: existing Gist ID to update" class="svelte-1jb5ckg"/></div>'),yi=b('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),ki=b('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),xi=b('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Update (or leave unselected to create new)</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),Si=b('<div class="info-message svelte-1jb5ckg">No gists found. A new one will be created.</div>'),$i=b('<!> <div class="form-group svelte-1jb5ckg"><label for="description" class="svelte-1jb5ckg"> </label> <input type="text" id="description" placeholder="D&amp;D Character Sheet" class="svelte-1jb5ckg"/></div>',1),Ci=b('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID *</label> <input type="text" id="gistId" placeholder="Enter Gist ID (for public or your private gists)" required class="svelte-1jb5ckg"/></div>'),Li=b('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),wi=b('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),Di=b('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Load</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),ji=b('<div class="info-message svelte-1jb5ckg">No gists found. Enter a Gist ID manually or create a new one in Save mode.</div>'),Ai=b('<div class="modal-overlay svelte-1jb5ckg" role="button" tabindex="-1"><div class="modal-content svelte-1jb5ckg" role="dialog" tabindex="0"><div class="modal-header svelte-1jb5ckg"><h2 class="svelte-1jb5ckg"> </h2> <button class="close-btn svelte-1jb5ckg">Ã—</button></div> <div class="modal-body svelte-1jb5ckg"><!> <div class="form-group svelte-1jb5ckg"><label for="token" class="svelte-1jb5ckg"> <a href="https://github.com/settings/tokens" target="_blank" rel="noopener" class="svelte-1jb5ckg">Get token</a></label> <input type="password" id="token" placeholder="ghp_xxxxxxxxxxxxx" class="svelte-1jb5ckg"/></div> <!> <!> <div class="modal-actions svelte-1jb5ckg"><button class="btn btn-primary svelte-1jb5ckg"><!></button> <button class="btn btn-secondary svelte-1jb5ckg">Cancel</button></div></div></div></div>');function Fi(a,n){Lt(n,!1);const t=()=>Qe(Y,"$character",v),[v,f]=jt(),_=qt();let k=yt(n,"mode",8,"save"),F=M(""),y=M(""),E=M(""),re=M(!1),X=M(""),N=M(!1),Se=M(!1),be=M([]),De=M(null);const ne=bi();ne.token&&c(F,ne.token),ne.gistId&&c(y,ne.gistId),ia(async()=>{e(F)&&!e(N)&&await ge()});async function ge(){if(e(F)){c(Se,!0),c(X,"");try{c(be,await gi(e(F))),e(y)&&c(De,e(be).find(A=>A.id===e(y))||null)}catch(A){c(X,A.message||"Failed to load gists"),c(be,[])}finally{c(Se,!1)}}}function ae(A){c(De,A),c(y,A.id)}function O(){c(N,!e(N)),c(X,""),!e(N)&&e(F)&&ge()}async function je(){if(!e(F)){c(X,"GitHub token is required");return}const A=e(De)?.id||e(y);c(re,!0),c(X,"");try{if(A)await pi(t(),e(F),A),c(y,A),St.add("Character updated in Gist successfully!","success");else{const R=await ui(t(),e(F),e(E));c(y,R),St.add(`Character saved to Gist! ID: ${R}`,"success")}Oa({token:e(F),gistId:e(y)}),_("close")}catch(R){c(X,R.message||"Failed to save to Gist")}finally{c(re,!1)}}async function ye(){const A=e(De)?.id||e(y);if(!A){c(X,"Please select a gist or enter a Gist ID");return}c(re,!0),c(X,"");try{const R=await fi(A,e(F)||void 0);Y.set(R),c(y,A),Oa({token:e(F),gistId:e(y)}),St.add("Character loaded from Gist successfully!","success"),_("close")}catch(R){c(X,R.message||"Failed to load from Gist")}finally{c(re,!1)}}function Z(){_("close")}Ct();var q=Ai(),oe=i(q),ke=i(oe),_e=i(ke),Ee=i(_e,!0);l(_e);var C=s(_e,2);l(ke);var ce=s(ke,2),ve=i(ce);{var de=A=>{var R=hi(),D=i(R,!0);l(R),P(()=>$(D,e(X))),o(A,R)};x(ve,A=>{e(X)&&A(de)})}var g=s(ve,2),T=i(g),ue=i(T);Qa(),l(T);var Pe=s(T,2);Le(Pe),l(g);var m=s(g,2);{var L=A=>{var R=mi(),D=i(R),u=i(D,!0);l(D),l(R),P(()=>{D.disabled=e(re),$(u,e(N)?"ðŸ“‹ Show My Gists":"âœï¸ Enter Gist ID Manually")}),j("click",D,O),o(A,R)};x(m,A=>{(k()==="load"||k()==="save"&&e(F))&&A(L)})}var ee=s(m,2);{var B=A=>{var R=$i(),D=qe(R);{var u=$e=>{var we=_i(),Ie=s(i(we),2);Le(Ie),l(we),P(()=>Ie.disabled=e(re)),Fe(Ie,()=>e(y),We=>c(y,We)),o($e,we)},Be=$e=>{var we=lt(),Ie=qe(we);{var We=Re=>{var te=yi();o(Re,te)},ze=Re=>{var te=lt(),Ce=qe(te);{var Ue=W=>{var xe=xi(),Oe=s(i(xe),2);ct(Oe,5,()=>e(be),dt,(h,w)=>{var ie=ki();let V;var pe=i(ie),G=i(pe),Q=i(G,!0);l(G);var fe=s(G,2),Ke=i(fe,!0);l(fe),l(pe);var p=s(pe,2),z=i(p),d=i(z);l(z);var Ae=s(z,2),Je=i(Ae);l(Ae),l(p),l(ie),P(et=>{V=ut(ie,1,"gist-item svelte-1jb5ckg",null,V,{selected:e(De)?.id===e(w).id}),ie.disabled=e(re),$(Q,(e(w),r(()=>e(w).description||"Untitled"))),$(Ke,(e(w),r(()=>e(w).public?"ðŸŒ Public":"ðŸ”’ Private"))),$(d,`ID: ${e(w),r(()=>e(w).id)??""}`),$(Je,`Updated: ${et??""}`)},[()=>(e(w),r(()=>new Date(e(w).updated_at).toLocaleDateString()))]),j("click",ie,()=>ae(e(w))),o(h,ie)}),l(Oe),l(xe),o(W,xe)},Ge=W=>{var xe=lt(),Oe=qe(xe);{var h=w=>{var ie=Si();o(w,ie)};x(Oe,w=>{e(F)&&w(h)},!0)}o(W,xe)};x(Ce,W=>{e(be),r(()=>e(be).length>0)?W(Ue):W(Ge,!1)},!0)}o(Re,te)};x(Ie,Re=>{e(Se)?Re(We):Re(ze,!1)},!0)}o($e,we)};x(D,$e=>{e(N)||!e(F)?$e(u):$e(Be,!1)})}var le=s(D,2),I=i(le),J=i(I);l(I);var S=s(I,2);Le(S),l(le),P(()=>{$(J,`Description ${e(y)?"(optional)":""}`),S.disabled=e(re)}),Fe(S,()=>e(E),$e=>c(E,$e)),o(A,R)},K=A=>{var R=lt(),D=qe(R);{var u=le=>{var I=Ci(),J=s(i(I),2);Le(J),l(I),P(()=>J.disabled=e(re)),Fe(J,()=>e(y),S=>c(y,S)),o(le,I)},Be=le=>{var I=lt(),J=qe(I);{var S=we=>{var Ie=Li();o(we,Ie)},$e=we=>{var Ie=lt(),We=qe(Ie);{var ze=te=>{var Ce=Di(),Ue=s(i(Ce),2);ct(Ue,5,()=>e(be),dt,(Ge,W)=>{var xe=wi();let Oe;var h=i(xe),w=i(h),ie=i(w,!0);l(w);var V=s(w,2),pe=i(V,!0);l(V),l(h);var G=s(h,2),Q=i(G),fe=i(Q);l(Q);var Ke=s(Q,2),p=i(Ke);l(Ke),l(G),l(xe),P(z=>{Oe=ut(xe,1,"gist-item svelte-1jb5ckg",null,Oe,{selected:e(De)?.id===e(W).id}),xe.disabled=e(re),$(ie,(e(W),r(()=>e(W).description||"Untitled"))),$(pe,(e(W),r(()=>e(W).public?"ðŸŒ Public":"ðŸ”’ Private"))),$(fe,`ID: ${e(W),r(()=>e(W).id)??""}`),$(p,`Updated: ${z??""}`)},[()=>(e(W),r(()=>new Date(e(W).updated_at).toLocaleDateString()))]),j("click",xe,()=>ae(e(W))),o(Ge,xe)}),l(Ue),l(Ce),o(te,Ce)},Re=te=>{var Ce=lt(),Ue=qe(Ce);{var Ge=W=>{var xe=ji();o(W,xe)};x(Ue,W=>{e(F)&&W(Ge)},!0)}o(te,Ce)};x(We,te=>{e(be),r(()=>e(be).length>0)?te(ze):te(Re,!1)},!0)}o(we,Ie)};x(J,we=>{e(Se)?we(S):we($e,!1)},!0)}o(le,I)};x(D,le=>{e(N)||!e(F)?le(u):le(Be,!1)})}o(A,R)};x(ee,A=>{k()==="save"?A(B):A(K,!1)})}var Ne=s(ee,2),se=i(Ne),he=i(se);{var He=A=>{var R=mt();P(()=>$(R,k()==="save"?"Saving...":"Loading...")),o(A,R)},Me=A=>{var R=mt();P(()=>$(R,k()==="save"?"Save":"Load")),o(A,R)};x(he,A=>{e(re)?A(He):A(Me,!1)})}l(se);var it=s(se,2);l(Ne),l(ce),l(oe),l(q),P(()=>{$(Ee,k()==="save"?"Save to GitHub Gist":"Load from GitHub Gist"),$(ue,`GitHub Token ${k()==="load"?"(optional for public gists)":"(required)"} `),Pe.disabled=e(re),se.disabled=e(re),it.disabled=e(re)}),j("click",C,Z),Fe(Pe,()=>e(F),A=>c(F,A)),j("blur",Pe,()=>{e(F)&&!e(N)&&ge()}),j("click",se,function(...A){(k()==="save"?je:ye)?.apply(this,A)}),j("click",it,Z),j("click",oe,Ra(function(A){Jt.call(this,n,A)})),j("keydown",oe,function(A){Jt.call(this,n,A)}),j("click",q,Z),j("keydown",q,A=>A.key==="Escape"&&Z()),o(a,q),wt(),f()}var Mi=b('<div class="loading svelte-1ngjemu">Loading D&D data...</div>'),Bi=b("<option> </option>"),Ii=b('<select class="level-filter svelte-1ngjemu"><option>All Levels</option><option>Cantrip</option><!></select>'),Ri=b('<div class="no-results svelte-1ngjemu"> </div>'),Ei=b('<div class="item-meta svelte-1ngjemu"> </div>'),Pi=b('<div class="item-meta svelte-1ngjemu"> </div>'),Ti=b('<button><div class="item-name svelte-1ngjemu"> </div> <!></button>'),Hi=b('<p class="higher-levels"><strong>At Higher Levels:</strong> </p>'),Ui=b('<p class="cantrip-upgrade"><strong>Cantrip Upgrade:</strong> </p>'),Ni=b('<h3 class="svelte-1ngjemu"> </h3> <p class="spell-meta svelte-1ngjemu"><!> <!></p> <p class="spell-classes"><strong>Classes:</strong> </p> <div class="spell-stats svelte-1ngjemu"><div><strong>Casting Time:</strong> </div> <div><strong>Range:</strong> </div> <div><strong>Components:</strong> <!></div> <div><strong>Duration:</strong> <!> </div></div> <p class="description svelte-1ngjemu"> </p> <!> <!>',1),Gi=b('<p class="prerequisite svelte-1ngjemu"><strong>Prerequisite:</strong> </p>'),Oi=b('<h3 class="svelte-1ngjemu"> </h3> <!> <p class="description svelte-1ngjemu"> </p> <a target="_blank" rel="noopener" class="source-link svelte-1ngjemu">View Full Details â†’</a>',1),qi=b('<div class="item-details svelte-1ngjemu"><!></div>'),Wi=b('<div class="controls svelte-1ngjemu"><div class="tabs svelte-1ngjemu"><button> </button> <button> </button></div> <div class="search-controls svelte-1ngjemu"><input type="text" placeholder="Search by name or description..." class="search-input svelte-1ngjemu"/> <!></div></div> <div class="content-container svelte-1ngjemu"><div class="items-list svelte-1ngjemu"><!></div> <!></div>',1),zi=b('<div class="modal-backdrop svelte-1ngjemu" role="presentation"><div class="modal svelte-1ngjemu" role="dialog" aria-modal="true" tabindex="-1"><div class="modal-header svelte-1ngjemu"><h2 class="svelte-1ngjemu">Browse D&D Spells & Feats</h2> <button class="close-btn svelte-1ngjemu" aria-label="Close">&times;</button></div> <div class="modal-body svelte-1ngjemu"><!></div> <div class="modal-footer svelte-1ngjemu"><button class="btn-secondary svelte-1ngjemu">Cancel</button> <button class="btn-primary svelte-1ngjemu">Add to Character Sheet</button></div></div></div>');function Ki(a,n){Lt(n,!1);const t=M(),v=M(),f=M();let _=yt(n,"onClose",8),k=M("spell"),F=M(!0),y=M(""),E=M(null),re=M([]),X=M([]),N=M(null);ia(async()=>{c(F,!0);try{c(re,await es()),c(X,await Vs())}catch(C){console.error("Failed to load data:",C)}finally{c(F,!1)}});function Se(C){c(N,C)}function be(C){const ce=C.match(/(\d+d\d+(?:\s*\+\s*\d+)?)/i);return ce?ce[1]:""}function De(C){const ce=C.split(/\.( |$)/)[0].trim(),ve=Array.from(C.matchAll(/\*\*(.*?)\*\*/g)).map(g=>g[1].replace(/\.$/,""));let de=ce;return ve.length&&(de+=" | Effects: "+ve.join(", ")),de}function ne(){if(e(N)){if(e(k)==="spell"){const C=e(N);Y.update(ce=>{const de=[];C.range&&de.push(`Range: ${C.range}`),C.castingTime&&de.push(`Cast: ${C.castingTime}`),C.duration&&de.push(`Duration: ${C.duration}`),C.actionType==="Save"&&de.push("Saving throw spell"),C.components&&C.components.length>0&&de.push(`Components: ${C.components.join(", ")}`),C.material&&de.push(`Material: ${C.material}`);const g=de.join(" | "),T=De(C.description),ue={id:crypto.randomUUID(),name:`${C.name}${C.concentration?" (C)":""}${C.ritual?" (R)":""}`,bonus:C.actionType==="Attack"?5:0,damage:be(C.description),damageType:`${C.school} (Lvl ${C.level})`,spellRef:C.name,infoNotes:g,generalNotes:T,castAtLevel:C.level};return ce.attacks=[...ce.attacks,ue],ce})}else if(e(k)==="feat"){const C=e(N);Y.update(ce=>{const ve=`${C.name}${C.prerequisite?` (Req: ${C.prerequisite})`:""}
${C.description}
`;return ce.features=ce.features?`${ce.features}
${ve}`:ve,ce})}c(N,null),_()()}}Ze(()=>(e(E),e(re),e(y)),()=>{c(t,e(E)!==null?Qs(Ua(e(re),e(y)),e(E)):Ua(e(re),e(y)))}),Ze(()=>(e(X),e(y)),()=>{c(v,Ys(e(X),e(y)))}),Ze(()=>(e(k),e(t),e(v)),()=>{c(f,e(k)==="spell"?e(t):e(v))}),Tt(),Ct();var ge=zi(),ae=i(ge),O=i(ae),je=s(i(O),2);l(O);var ye=s(O,2),Z=i(ye);{var q=C=>{var ce=Mi();o(C,ce)},oe=C=>{var ce=Wi(),ve=qe(ce),de=i(ve),g=i(de);let T;var ue=i(g);l(g);var Pe=s(g,2);let m;var L=i(Pe);l(Pe),l(de);var ee=s(de,2),B=i(ee);Le(B);var K=s(B,2);{var Ne=D=>{var u=Ii();P(()=>{e(E),ht(()=>{})});var Be=i(u);Be.value=(Be.__value=null)??"";var le=s(Be);le.value=le.__value=0;var I=s(le);ct(I,0,()=>[1,2,3,4,5,6,7,8,9],dt,(J,S)=>{var $e=Bi(),we=i($e);l($e);var Ie={};P(()=>{$(we,`Level ${S??""}`),Ie!==(Ie=S)&&($e.value=($e.__value=S)??"")}),o(J,$e)}),l(u),Xa(u,()=>e(E),J=>c(E,J)),o(D,u)};x(K,D=>{e(k)==="spell"&&D(Ne)})}l(ee),l(ve);var se=s(ve,2),he=i(se),He=i(he);{var Me=D=>{var u=Ri(),Be=i(u);l(u),P(()=>$(Be,`No ${e(k)??""}s found`)),o(D,u)},it=D=>{var u=lt(),Be=qe(u);ct(Be,1,()=>e(f),dt,(le,I)=>{var J=Ti();let S;var $e=i(J),we=i($e,!0);l($e);var Ie=s($e,2);{var We=Re=>{const te=at(()=>e(I));var Ce=Ei(),Ue=i(Ce);l(Ce),P(()=>$(Ue,`Level ${U(e(te)),r(()=>e(te).level)??""} â€¢ ${U(e(te)),r(()=>e(te).school)??""}`)),o(Re,Ce)},ze=Re=>{const te=at(()=>e(I));var Ce=lt(),Ue=qe(Ce);{var Ge=W=>{var xe=Pi(),Oe=i(xe,!0);l(xe),P(()=>$(Oe,(U(e(te)),r(()=>e(te).prerequisite)))),o(W,xe)};x(Ue,W=>{U(e(te)),r(()=>e(te).prerequisite)&&W(Ge)})}o(Re,Ce)};x(Ie,Re=>{e(k)==="spell"?Re(We):Re(ze,!1)})}l(J),P(()=>{S=ut(J,1,"item-card svelte-1ngjemu",null,S,{selected:e(N)?.name===e(I).name}),$(we,(e(I),r(()=>e(I).name)))}),j("click",J,()=>Se(e(I))),o(le,J)}),o(D,u)};x(He,D=>{e(f),r(()=>e(f).length===0)?D(Me):D(it,!1)})}l(he);var A=s(he,2);{var R=D=>{var u=qi(),Be=i(u);{var le=J=>{const S=at(()=>e(N));var $e=Ni(),we=qe($e),Ie=i(we,!0);l(we);var We=s(we,2),ze=i(We);{var Re=H=>{var Te=mt();P(()=>$(Te,`${U(e(S)),r(()=>e(S).school)??""} cantrip`)),o(H,Te)},te=H=>{var Te=mt();P(()=>$(Te,`Level ${U(e(S)),r(()=>e(S).level)??""} ${U(e(S)),r(()=>e(S).school)??""}`)),o(H,Te)};x(ze,H=>{U(e(S)),r(()=>e(S).level===0)?H(Re):H(te,!1)})}var Ce=s(ze,2);{var Ue=H=>{var Te=mt("(ritual)");o(H,Te)};x(Ce,H=>{U(e(S)),r(()=>e(S).ritual)&&H(Ue)})}l(We);var Ge=s(We,2),W=s(i(Ge));l(Ge);var xe=s(Ge,2),Oe=i(xe),h=s(i(Oe));l(Oe);var w=s(Oe,2),ie=s(i(w));l(w);var V=s(w,2),pe=s(i(V)),G=s(pe);{var Q=H=>{var Te=mt();P(()=>$(Te,`(${U(e(S)),r(()=>e(S).material)??""})`)),o(H,Te)};x(G,H=>{U(e(S)),r(()=>e(S).material)&&H(Q)})}l(V);var fe=s(V,2),Ke=s(i(fe),2);{var p=H=>{var Te=mt("Concentration,");o(H,Te)};x(Ke,H=>{U(e(S)),r(()=>e(S).concentration)&&H(p)})}var z=s(Ke,1,!0);l(fe),l(xe);var d=s(xe,2),Ae=i(d,!0);l(d);var Je=s(d,2);{var et=H=>{var Te=Hi(),Xe=s(i(Te));l(Te),P(()=>$(Xe,` ${U(e(S)),r(()=>e(S).higherLevelSlot)??""}`)),o(H,Te)};x(Je,H=>{U(e(S)),r(()=>e(S).higherLevelSlot)&&H(et)})}var Ve=s(Je,2);{var me=H=>{var Te=Ui(),Xe=s(i(Te));l(Te),P(()=>$(Xe,` ${U(e(S)),r(()=>e(S).cantripUpgrade)??""}`)),o(H,Te)};x(Ve,H=>{U(e(S)),r(()=>e(S).cantripUpgrade)&&H(me)})}P((H,Te)=>{$(Ie,(U(e(S)),r(()=>e(S).name))),$(W,` ${H??""}`),$(h,` ${U(e(S)),r(()=>e(S).castingTime||e(S).actionType)??""}`),$(ie,` ${U(e(S)),r(()=>e(S).range)??""}`),$(pe,` ${Te??""}`),$(z,(U(e(S)),r(()=>e(S).duration))),$(Ae,(U(e(S)),r(()=>e(S).description)))},[()=>(U(e(S)),r(()=>e(S).classes.join(", "))),()=>(U(e(S)),r(()=>e(S).components.join(", ").toUpperCase()))]),o(J,$e)},I=J=>{const S=at(()=>e(N));var $e=Oi(),we=qe($e),Ie=i(we,!0);l(we);var We=s(we,2);{var ze=Ue=>{var Ge=Gi(),W=s(i(Ge));l(Ge),P(()=>$(W,` ${U(e(S)),r(()=>e(S).prerequisite)??""}`)),o(Ue,Ge)};x(We,Ue=>{U(e(S)),r(()=>e(S).prerequisite)&&Ue(ze)})}var Re=s(We,2),te=i(Re,!0);l(Re);var Ce=s(Re,2);P(()=>{$(Ie,(U(e(S)),r(()=>e(S).name))),$(te,(U(e(S)),r(()=>e(S).description))),tt(Ce,"href",(U(e(S)),r(()=>e(S).source)))}),o(J,$e)};x(Be,J=>{e(k)==="spell"?J(le):J(I,!1)})}l(u),o(D,u)};x(A,D=>{e(N)&&D(R)})}l(se),P(()=>{T=ut(g,1,"tab svelte-1ngjemu",null,T,{active:e(k)==="spell"}),$(ue,`ðŸ“œ Spells (${e(re),r(()=>e(re).length)??""})`),m=ut(Pe,1,"tab svelte-1ngjemu",null,m,{active:e(k)==="feat"}),$(L,`â­ Feats (${e(X),r(()=>e(X).length)??""})`)}),j("click",g,()=>{c(k,"spell"),c(N,null),c(y,"")}),j("click",Pe,()=>{c(k,"feat"),c(N,null),c(y,"")}),Fe(B,()=>e(y),D=>c(y,D)),o(C,ce)};x(Z,C=>{e(F)?C(q):C(oe,!1)})}l(ye);var ke=s(ye,2),_e=i(ke),Ee=s(_e,2);l(ke),l(ae),l(ge),P(()=>Ee.disabled=!e(N)),j("click",je,function(...C){_()?.apply(this,C)}),j("click",_e,function(...C){_()?.apply(this,C)}),j("click",Ee,ne),j("click",ae,Ra(function(C){Jt.call(this,n,C)})),j("keydown",ae,function(C){Jt.call(this,n,C)}),j("click",ge,function(...C){_()?.apply(this,C)}),j("keydown",ge,C=>C.key==="Escape"&&_()()),o(a,ge),wt()}var Ji=b('<link rel="icon" type="image/png" href="favicon4.png"/> <meta name="viewport" content="width=device-width, initial-scale=1"/>',1),Vi=b('<span class="character-name svelte-1uha8ag"> </span>'),Qi=b("<span> </span>"),Yi=b('<div class="spell-slots-header svelte-1uha8ag"></div>'),Xi=b('<div class="rest-menu svelte-1uha8ag"><button class="rest-option svelte-1uha8ag">â˜• Short Rest</button> <button class="rest-option svelte-1uha8ag">ðŸ›ï¸ Long Rest</button></div>'),Zi=b('<div class="container svelte-1uha8ag"><header class="svelte-1uha8ag"><div class="header-top svelte-1uha8ag"><div class="header-title svelte-1uha8ag"><div class="title-row svelte-1uha8ag"><h1 class="svelte-1uha8ag">D&D Character Sheet</h1> <!></div> <!></div> <div class="header-right svelte-1uha8ag"><div class="header-controls svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">ðŸŽ²</span><span class="btn-text svelte-1uha8ag">Roll Dice</span></button> <div class="rest-button-container svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">ðŸ˜´</span><span class="btn-text svelte-1uha8ag">Rest</span></button> <!></div> <div class="mode-toggle"><button><span class="btn-icon svelte-1uha8ag"> </span><span class="btn-text svelte-1uha8ag"> </span></button></div></div> <div class="header-search svelte-1uha8ag"><input type="text" placeholder="ðŸ” Search..." class="search-input use-enabled svelte-1uha8ag"/></div></div></div> <div class="header-actions svelte-1uha8ag"><button class="btn btn-mode svelte-1uha8ag">ðŸ“š Browse Spells & Feats</button> <button class="btn btn-secondary">Save to Gist</button> <button class="btn btn-secondary">Load from Gist</button> <button class="btn btn-secondary">Export JSON</button> <button class="btn btn-secondary">Import JSON</button> <input type="file" accept=".json" style="display: none;"/></div></header> <main class="svelte-1uha8ag"><!> <!> <!> <!> <!> <!> <!></main></div> <!> <!> <!> <!>',1);function or(a,n){Lt(n,!1);const t=()=>Qe(Y,"$character",_),v=()=>Qe(sa,"$isEditMode",_),f=()=>Qe(Nt,"$searchFilter",_),[_,k]=jt();function F(){const p=[],z=t().classFeatures.spellSlotsByLevel||{};for(let d=1;d<=9;d++){const Ae=z[d];if(Ae&&Ae.length>0){const Je=Ae.length,et=Ae.filter(Ve=>Ve).length;p.push({level:d,available:Je-et,total:Je})}}return p}let y=M(!1),E=M(!1),re=M(!1),X=M("save"),N=M(void 0),Se=M(""),be=M(""),De=M(""),ne=M(!1),ge=M([]),ae=M(),O=!1,je=M(!1);function ye(){const p=[];Y.update(d=>{const Ae=d.hitDice.current;d.hitDice.current=Math.min(d.hitDice.max,d.hitDice.current+Math.max(1,Math.floor(d.hitDice.max/2)));const Je=d.hitDice.current-Ae;if(Je>0&&p.push(`${Je} hit ${Je===1?"die":"dice"}`),d.class){const et=Vt(d.class,d.level,d.subclass);d.classFeatures.features||(d.classFeatures.features={}),et.forEach(Ve=>{if(Ve.resetOn==="short"){const me=Ve.name.replace(/\s+/g,"");if(Ve.type==="uses"){const H=typeof Ve.maxUses=="function"?Ve.maxUses(d.level):Ve.maxUses;d.classFeatures.features[me]=Array(H).fill(!1),p.push(Ve.name)}else if(Ve.type==="pool"){const H=typeof Ve.maxPool=="function"?Ve.maxPool(d.level):Ve.maxPool;H!==void 0&&(d.classFeatures.features[me]=H,p.push(Ve.name))}}})}return d}),c(je,!1);const z=p.length>0?`Short rest taken! Restored: ${p.join(", ")}`:"Short rest taken!";St.add(z,"success")}function Z(){const p=[];Y.update(d=>{const Ae=d.maxHP-d.currentHP;Ae>0&&p.push(`${Ae} HP`),d.currentHP=d.maxHP,d.tempHP=0;const Je=d.hitDice.max-d.hitDice.current;Je>0&&p.push(`${Je} hit ${Je===1?"die":"dice"}`),d.hitDice.current=d.hitDice.max;let et=0;if(d.classFeatures.spellSlotsByLevel&&Object.keys(d.classFeatures.spellSlotsByLevel).forEach(Ve=>{const me=d.classFeatures.spellSlotsByLevel[parseInt(Ve)];if(me){const H=me.filter(Te=>Te).length;et+=H,d.classFeatures.spellSlotsByLevel[parseInt(Ve)]=Array(me.length).fill(!1)}}),et>0&&p.push(`${et} spell ${et===1?"slot":"slots"}`),d.class){const Ve=Vt(d.class,d.level,d.subclass);d.classFeatures.features||(d.classFeatures.features={});let me=!1;Ve.forEach(H=>{const Te=H.name.replace(/\s+/g,"");if(!(H.type==="info"||H.type==="channelDivinity")){if(H.type==="uses"){const Xe=typeof H.maxUses=="function"?H.maxUses(d.level):H.maxUses;d.classFeatures.features[Te]=Array(Xe).fill(!1),me=!0}else if(H.type==="pool"){const Xe=typeof H.maxPool=="function"?H.maxPool(d.level):H.maxPool;Xe!==void 0&&(d.classFeatures.features[Te]=Xe,me=!0)}}}),me&&p.push("all class features")}return d}),c(je,!1);const z=p.length>0?`Long rest taken! Restored: ${p.join(", ")}`:"Long rest taken! Fully rested.";St.add(z,"success")}function q(p){c(Se,""),c(be,""),c(De,""),c(ne,!1),c(ge,[]),O=!1,typeof p=="string"?c(Se,p):(c(Se,p.notation),c(be,p.damageNotation||""),c(De,p.attackName||""),c(ne,!!p.applyHalfDamage),c(ge,p.bonusBreakdown||[])),c(y,!0)}function oe(p){const{notation:z}=p.detail;c(Se,""),O=!0,setTimeout(()=>{c(Se,z),c(be,""),c(De,"Hit Die")},0),c(y,!0)}function ke(){if(c(y,!1),O&&e(ae)){const p=e(ae).getLastRollTotal();if(p!==null){const z=Math.max(1,p);Y.update(d=>(d.hitDice.current=Math.max(0,d.hitDice.current-1),d.currentHP=Math.min(d.maxHP,d.currentHP+z),d))}O=!1}}function _e(){console.log("toggleMode called, current isEditMode:",v()),sa.update(p=>(console.log("Updating isEditMode from",p,"to",!p),!p))}function Ee(p){p.target.closest(".rest-button-container")||c(je,!1)}ia(()=>{console.log("onMount - initial isEditMode:",v()),console.log("onMount - body classes:",document.body.className);const p=sa.subscribe(z=>{console.log("isEditMode subscription triggered, value:",z),console.log("Body classes before:",document.body.className),z?(document.body.classList.remove("use-mode"),console.log("Removed use-mode class (Edit Mode)")):(document.body.classList.add("use-mode"),console.log("Added use-mode class (Use Mode)")),console.log("Body classes after:",document.body.className)});return document.addEventListener("click",Ee),()=>{p(),document.removeEventListener("click",Ee)}});function C(){gs(t())}function ce(){e(N)?.click()}async function ve(p){const d=p.target.files?.[0];if(d)try{const Ae=await hs(d);Y.set(Ae),alert("Character imported successfully!")}catch{alert("Failed to import character file")}}Ct();var de=Zi();fs("1uha8ag",p=>{var z=Ji();Qa(2),za(()=>{ps.title="D&D Character Sheet"}),o(p,z)});var g=qe(de),T=i(g),ue=i(T),Pe=i(ue),m=i(Pe),L=s(i(m),2);{var ee=p=>{var z=Vi(),d=i(z,!0);l(z),P(()=>$(d,t().name)),o(p,z)};x(L,p=>{t().name&&p(ee)})}l(m);var B=s(m,2);{var K=p=>{var z=Yi();ct(z,5,F,dt,(d,Ae)=>{var Je=Qi();let et;var Ve=i(Je);l(Je),P(()=>{et=ut(Je,1,"slot-badge svelte-1uha8ag",null,et,{depleted:e(Ae).available===0}),$(Ve,`Lv${e(Ae).level??""}: ${e(Ae).available??""}/${e(Ae).total??""}`)}),o(d,Je)}),l(z),o(p,z)};x(B,p=>{F().length>0&&p(K)})}l(Pe);var Ne=s(Pe,2),se=i(Ne),he=i(se),He=s(he,2),Me=i(He),it=s(Me,2);{var A=p=>{var z=Xi(),d=i(z),Ae=s(d,2);l(z),j("click",d,ye),j("click",Ae,Z),o(p,z)};x(it,p=>{e(je)&&p(A)})}l(He);var R=s(He,2),D=i(R);let u;var Be=i(D),le=i(Be,!0);l(Be);var I=s(Be),J=i(I,!0);l(I),l(D),l(R),l(se);var S=s(se,2),$e=i(S);Le($e),l(S),l(Ne),l(ue);var we=s(ue,2),Ie=i(we),We=s(Ie,2),ze=s(We,2),Re=s(ze,2),te=s(Re,2),Ce=s(te,2);Da(Ce,p=>c(N,p),()=>e(N)),l(we),l(T);var Ue=s(T,2),Ge=i(Ue);Bs(Ge,{});var W=s(Ge,2);qs(W,{$$events:{rollHitDice:oe}});var xe=s(W,2);Ps(xe,{$$events:{roll:p=>q(p.detail)}});var Oe=s(xe,2);Js(Oe,{$$events:{roll:p=>q(p.detail)}});var h=s(Oe,2);Fl(h,{$$events:{roll:p=>q(p.detail)}});var w=s(h,2);Jl(w,{});var ie=s(w,2);Yl(ie,{}),l(Ue),l(g);var V=s(g,2);Da(di(V,{get notation(){return e(Se)},get damageNotation(){return e(be)},get attackName(){return e(De)},get applyHalfDamage(){return e(ne)},get bonusBreakdown(){return e(ge)},get visible(){return e(y)},$$events:{close:ke},$$legacy:!0}),p=>c(ae,p),()=>e(ae));var pe=s(V,2);{var G=p=>{Fi(p,{get mode(){return e(X)},$$events:{close:()=>c(E,!1)}})};x(pe,p=>{e(E)&&p(G)})}var Q=s(pe,2);{var fe=p=>{Ki(p,{onClose:()=>c(re,!1)})};x(Q,p=>{e(re)&&p(fe)})}var Ke=s(Q,2);bs(Ke,{}),P(()=>{u=ut(D,1,"btn btn-mode svelte-1uha8ag",null,u,{"use-mode":!v()}),$(le,v()?"ðŸ“":"ðŸŽ²"),$(J,v()?"Edit Mode":"Use Mode")}),j("click",he,()=>c(y,!0)),j("click",Me,()=>c(je,!e(je))),j("click",D,_e),Fe($e,f,p=>ms(Nt,p)),j("click",Ie,()=>c(re,!0)),j("click",We,()=>{c(X,"save"),c(E,!0)}),j("click",ze,()=>{c(X,"load"),c(E,!0)}),j("click",Re,C),j("click",te,ce),j("change",Ce,ve),o(a,de),wt(),k()}export{or as component};
