import{f as p,e as j,a as c,s as C,c as it,t as ft}from"../chunks/B7Yu7-pH.js";import{i as kt}from"../chunks/Pgj_Karr.js";import{c as Ht,o as ea,a as as}from"../chunks/YW1J0937.js";import{a7 as Ua,i as Na,aZ as ss,a_ as ls,a$ as wa,K as Et,e as Ga,b0 as Oa,T as da,b1 as is,b2 as rs,q as ns,b3 as os,b4 as cs,b5 as vs,ab as ds,d as r,r as qa,g as us,C as xt,b6 as Xe,b7 as Mt,F as U,G as St,s as o,a4 as R,H as i,J as s,I as l,f as e,E as Ve,m as at,A as N,b8 as pt,b9 as Qt,ba as Wa,ao as za,bb as ps}from"../chunks/TSJapsqm.js";import{c as Z,a as bt,e as nt,i as ct,u as Ka,s as Bt,b as ot,d as ta,f as Yt,t as Xt,h as fs,T as bs,g as gs,j as hs}from"../chunks/BW7xBItJ.js";import{i as S,s as Ct,a as Je,b as st,d as ia,e as ms}from"../chunks/lg4VTcy2.js";import{p as _t,b as $a}from"../chunks/BPqayAlY.js";import{b as Jt,r as _s}from"../chunks/B3un6h8s.js";function ca(a,n,t=!1){if(a.multiple){if(n==null)return;if(!Na(n))return ss();for(var v of a.options)v.selected=n.includes(Zt(v));return}for(v of a.options){var u=Zt(v);if(ls(u,n)){v.selected=!0;return}}(!t||n!==void 0)&&(a.selectedIndex=-1)}function Ca(a){var n=new MutationObserver(()=>{ca(a,a.__value)});n.observe(a,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Ua(()=>{n.disconnect()})}function Va(a,n,t=n){var v=new WeakSet,u=!0;wa(a,"change",h=>{var k=h?"[selected]":":checked",M;if(a.multiple)M=[].map.call(a.querySelectorAll(k),Zt);else{var y=a.querySelector(k)??a.querySelector("option:not([disabled])");M=y&&Zt(y)}t(M),Et!==null&&v.add(Et)}),Ga(()=>{var h=n();if(a===document.activeElement){var k=Oa??Et;if(v.has(k))return}if(ca(a,h,u),u&&h===void 0){var M=a.querySelector(":checked");M!==null&&(h=Zt(M),t(h))}a.__value=h,u=!1}),Ca(a)}function Zt(a){return"__value"in a?a.__value:a.value}const ys=Symbol("is custom element"),ks=Symbol("is html");function $e(a){if(da){var n=!1,t=()=>{if(!n){if(n=!0,a.hasAttribute("value")){var v=a.value;et(a,"value",null),a.value=v}if(a.hasAttribute("checked")){var u=a.checked;et(a,"checked",null),a.checked=u}}};a.__on_r=t,ns(t),os()}}function ja(a,n){var t=Aa(a);t.value===(t.value=n??void 0)||a.value===n&&(n!==0||a.nodeName!=="PROGRESS")||(a.value=n??"")}function xs(a,n){var t=Aa(a);t.checked!==(t.checked=n??void 0)&&(a.checked=n)}function et(a,n,t,v){var u=Aa(a);da&&(u[n]=a.getAttribute(n),n==="src"||n==="srcset"||n==="href"&&a.nodeName==="LINK")||u[n]!==(u[n]=t)&&(n==="loading"&&(a[cs]=t),t==null?a.removeAttribute(n):typeof t!="string"&&Ss(a).includes(n)?a[n]=t:a.setAttribute(n,t))}function Aa(a){return a.__attributes??={[ys]:a.nodeName.includes("-"),[ks]:a.namespaceURI===is}}var Ma=new Map;function Ss(a){var n=a.getAttribute("is")||a.nodeName,t=Ma.get(n);if(t)return t;Ma.set(n,t=[]);for(var v,u=a,h=Element.prototype;h!==u;){v=vs(u);for(var k in v)v[k].set&&t.push(k);u=rs(u)}return t}function Fe(a,n,t=n){var v=new WeakSet;wa(a,"input",async u=>{var h=u?a.defaultValue:a.value;if(h=ka(a)?xa(h):h,t(h),Et!==null&&v.add(Et),await ds(),h!==(h=n())){var k=a.selectionStart,M=a.selectionEnd,y=a.value.length;if(a.value=h??"",M!==null){var P=a.value.length;k===M&&M===y&&P>y?(a.selectionStart=P,a.selectionEnd=P):(a.selectionStart=k,a.selectionEnd=Math.min(M,P))}}}),(da&&a.defaultValue!==a.value||r(n)==null&&a.value)&&(t(ka(a)?xa(a.value):a.value),Et!==null&&v.add(Et)),qa(()=>{var u=n();if(a===document.activeElement){var h=Oa??Et;if(v.has(h))return}ka(a)&&u===xa(a.value)||a.type==="date"&&!u&&!a.value||u!==a.value&&(a.value=u??"")})}function va(a,n,t=n){wa(a,"change",v=>{var u=v?a.defaultChecked:a.checked;t(u)}),(da&&a.defaultChecked!==a.checked||r(n)==null)&&t(a.checked),qa(()=>{var v=n();a.checked=!!v})}function ka(a){var n=a.type;return n==="number"||n==="range"}function xa(a){return a===""?null:+a}function $s(a,n,t){var v=us(a,n);v&&v.set&&(a[n]=t,Ua(()=>{a[n]=null}))}function Fa(a){return function(...n){var t=n[0];return t.stopPropagation(),a?.apply(this,n)}}function Ot(a,n){var t=a.$$events?.[n.type],v=Na(t)?t.slice():t==null?[]:[t];for(var u of v)u.call(this,n)}const Cs="";function Ja(...a){return Jt+Cs+_s(a[0],a[1])}const La={paladin:{name:"Paladin",hitDice:"d10",spellcaster:!0,spellcastingAbility:"charisma",spellSlotsByLevel:{1:0,2:2,3:3,4:3,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Divine Sense",type:"uses",maxUses:(a,n=1)=>1+Math.max(1,n),resetOn:"long",description:"Detect celestials, fiends, and undead within 60 feet",minLevel:1},{name:"Lay on Hands",type:"pool",maxPool:a=>a*5,resetOn:"long",description:"Heal wounds or cure disease",minLevel:1},{name:"Divine Smite",type:"spellSlot",description:"Expend spell slot to deal extra radiant damage",minLevel:2,rollable:!0},{name:"Channel Divinity",type:"pool",maxPool:a=>a>=18?3:a>=6?2:1,resetOn:"short",description:"Sacred Weapon or Turn Undead",minLevel:3}]},fighter:{name:"Fighter",hitDice:"d10",spellcaster:!1,features:[{name:"Second Wind",type:"uses",maxUses:1,resetOn:"short",description:"Regain 1d10 + fighter level HP as bonus action",minLevel:1,rollable:!0,rollFormula:a=>`1d10+${a}`},{name:"Action Surge",type:"uses",maxUses:a=>a>=17?2:1,resetOn:"short",description:"Take one additional action on your turn",minLevel:2},{name:"Indomitable",type:"uses",maxUses:a=>a>=17?3:a>=13?2:1,resetOn:"long",description:"Reroll a failed saving throw",minLevel:9}],subclasses:{champion:{name:"Champion",features:[{name:"Improved Critical",type:"info",description:"Critical hit on 19-20",minLevel:3},{name:"Remarkable Athlete",type:"info",description:"Add half proficiency to STR/DEX/CON checks, increase long jump distance",minLevel:7},{name:"Additional Fighting Style",type:"info",description:"Choose a second fighting style",minLevel:10},{name:"Superior Critical",type:"info",description:"Critical hit on 18-20",minLevel:15},{name:"Survivor",type:"info",description:"Regain 5 + CON mod HP at start of turn if below half HP",minLevel:18}]},battlemaster:{name:"Battle Master",features:[{name:"Combat Superiority",type:"uses",maxUses:a=>a>=15?6:a>=7?5:4,resetOn:"short",description:a=>`Use superiority dice (${a>=18?"d12":a>=10?"d10":"d8"}) for maneuvers`,minLevel:3},{name:"Know Your Enemy",type:"info",description:"Learn capabilities of creatures you observe",minLevel:7},{name:"Improved Combat Superiority",type:"info",description:"Superiority dice become d10",minLevel:10},{name:"Relentless",type:"info",description:"Regain 1 superiority die if you have none at start of turn",minLevel:15}]}}},rogue:{name:"Rogue",hitDice:"d8",spellcaster:!1,features:[{name:"Sneak Attack",type:"info",description:a=>`Deal ${Math.ceil(a/2)}d6 extra damage once per turn with advantage or ally nearby`,minLevel:1,rollable:!0,rollFormula:a=>`${Math.ceil(a/2)}d6`},{name:"Cunning Action",type:"info",description:"Dash, Disengage, or Hide as a bonus action",minLevel:2},{name:"Uncanny Dodge",type:"info",description:"Use reaction to halve damage from an attack",minLevel:5},{name:"Evasion",type:"info",description:"Take no damage on successful Dex save (half on fail)",minLevel:7}]},wizard:{name:"Wizard",hitDice:"d6",spellcaster:!0,spellcastingAbility:"intelligence",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Arcane Recovery",type:"uses",maxUses:1,resetOn:"long",description:a=>`Recover spell slots totaling up to ${Math.ceil(a/2)} levels during short rest`,minLevel:1},{name:"Spell Mastery",type:"info",description:"Cast one 1st-level and one 2nd-level spell at will",minLevel:18}]},cleric:{name:"Cleric",hitDice:"d8",spellcaster:!0,spellcastingAbility:"wisdom",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Channel Divinity",type:"pool",maxPool:a=>a>=18?3:a>=6?2:1,resetOn:"short",description:"Turn Undead or domain-specific ability",minLevel:2},{name:"Destroy Undead",type:"info",description:a=>`Channel Divinity destroys undead of CR ${a>=17?4:a>=14?3:a>=11?2:a>=8?1:.5} or lower`,minLevel:5},{name:"Divine Intervention",type:"uses",maxUses:1,resetOn:"long",description:a=>`${a}% chance to succeed, implore deity for aid`,minLevel:10}],subclasses:{war:{name:"War Domain",features:[{name:"War Priest",type:"uses",maxUses:(a,n=1)=>Math.max(1,n),resetOn:"long",description:"Make one weapon attack as a bonus action",minLevel:1},{name:"Guided Strike",type:"channelDivinity",description:"Use your Channel Divinity to gain +10 to an attack roll. Make this choice after you see the roll, but before the DM says whether the attack hits or misses.",minLevel:2,resetOn:"short"},{name:"War God's Blessing",type:"channelDivinity",description:"Use reaction to grant +10 to an ally's attack roll within 30 feet. Consumes one use of Channel Divinity.",minLevel:6,resetOn:"short"},{name:"Divine Strike",type:"info",description:a=>`Deal extra ${a>=14?"2d8":"1d8"} weapon damage once per turn`,minLevel:8,rollable:!0,rollFormula:a=>a>=14?"2d8":"1d8"},{name:"Avatar of Battle",type:"info",description:"Gain resistance to nonmagical weapon damage",minLevel:17}]},life:{name:"Life Domain",features:[{name:"Disciple of Life",type:"info",description:"Healing spells restore additional 2 + spell level HP",minLevel:1},{name:"Preserve Life",type:"pool",maxPool:a=>a*5,resetOn:"short",description:"Restore HP to creatures within 30 feet",minLevel:2},{name:"Blessed Healer",type:"info",description:"Regain 2 + spell level HP when you cast healing spell",minLevel:6},{name:"Divine Strike",type:"info",description:a=>`Deal extra ${a>=14?"2d8":"1d8"} radiant damage once per turn`,minLevel:8,rollable:!0,rollFormula:a=>a>=14?"2d8":"1d8"},{name:"Supreme Healing",type:"info",description:"Maximize healing dice instead of rolling",minLevel:17}]}}},barbarian:{name:"Barbarian",hitDice:"d12",spellcaster:!1,features:[{name:"Rage",type:"uses",maxUses:a=>a>=20?1/0:a>=17?6:a>=12?5:a>=6?4:a>=3?3:2,resetOn:"long",description:a=>`+${a>=16?4:a>=9?3:2} damage, resistance to physical damage`,minLevel:1},{name:"Reckless Attack",type:"info",description:"Gain advantage on melee attacks, enemies get advantage on you",minLevel:2},{name:"Danger Sense",type:"info",description:"Advantage on Dex saves against effects you can see",minLevel:2}],subclasses:{berserker:{name:"Path of the Berserker",features:[{name:"Frenzy",type:"info",description:"While raging, make melee attack as bonus action (gain 1 exhaustion after rage)",minLevel:3},{name:"Mindless Rage",type:"info",description:"Cannot be charmed or frightened while raging",minLevel:6},{name:"Intimidating Presence",type:"info",description:"Use action to frighten creature within 30 feet",minLevel:10},{name:"Retaliation",type:"info",description:"When damaged by creature within 5 feet, make melee attack as reaction",minLevel:14}]}}}};function yt(a){const n=a.toLowerCase();return La[n]||null}function qt(a,n,t){const v=yt(a);if(!v)return[];const u=v.features.filter(h=>!h.minLevel||h.minLevel<=n);if(t&&v.subclasses&&v.subclasses[t]){const h=v.subclasses[t].features.filter(k=>!k.minLevel||k.minLevel<=n);return[...u,...h]}return u}function Ia(a){const n=yt(a);return!n||!n.subclasses?[]:Object.keys(n.subclasses).map(t=>({id:t,name:n.subclasses[t].name}))}function Ra(a,n){const t=yt(a);return!t||!t.spellcaster||!t.spellSlotsByLevel?0:t.spellSlotsByLevel[n]||0}function Ea(a,n,t){const v=yt(a);return!v||!v.spellcaster?0:Math.max(1,t+n)}function Ls(a,n,t){const v=yt(a);return!v||!v.spellcaster?null:8+n+t}function Ds(){return Object.keys(La).map(a=>({id:a,name:La[a].name}))}var ws=p("<option> </option>"),js=p("<option> </option>"),As=p('<div class="form-group svelte-172i2fj"><label for="characterSubclass" class="svelte-172i2fj">Subclass</label> <select id="characterSubclass" class="svelte-172i2fj"><option>Select Subclass</option><!></select></div>'),Fs=p('<div class="info-grid svelte-172i2fj"><div class="form-group svelte-172i2fj"><label for="characterName" class="svelte-172i2fj">Character Name</label> <input type="text" id="characterName" placeholder="Enter name" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterClass" class="svelte-172i2fj">Class</label> <select id="characterClass" class="svelte-172i2fj"><option>Select Class</option><!></select></div> <!> <div class="form-group svelte-172i2fj"><label for="characterLevel" class="svelte-172i2fj">Level</label> <input type="number" id="characterLevel" min="1" max="20" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterRace" class="svelte-172i2fj">Race</label> <input type="text" id="characterRace" placeholder="e.g., Human" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterBackground" class="svelte-172i2fj">Background</label> <input type="text" id="characterBackground" placeholder="e.g., Soldier" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterAlignment" class="svelte-172i2fj">Alignment</label> <input type="text" id="characterAlignment" placeholder="e.g., Lawful Good" class="svelte-172i2fj"/></div></div>'),Ms=p('<section class="character-info svelte-172i2fj"><div class="header svelte-172i2fj"><h2 class="svelte-172i2fj">Character Info</h2> <button class="collapse-btn svelte-172i2fj"> </button></div> <!></section>');function Is(a,n){xt(n,!1);const t=()=>Je(Z,"$character",u),v=()=>Je(bt,"$collapsedStates",u),[u,h]=Ct(),k=R(),M=Ds();function y(T){const we=T.target;Z.update(Ce=>(Ce.class=we.value,Ce.subclass="",Ce))}function P(T){const we=T.target;Z.update(Ce=>(Ce.subclass=we.value,Ce))}function ce(T){const we=T.target;Z.update(Ce=>(Ce.level=parseInt(we.value)||1,Ce)),Ka()}function ee(){bt.update(T=>({...T,characterInfo:!T.characterInfo}))}Xe(()=>(t(),Ia),()=>{o(k,t().class?Ia(t().class):[])}),Mt(),kt();var G=Ms(),ye=i(G),ie=s(i(ye),2),ke=i(ie,!0);l(ie),l(ye);var be=s(ye,2);{var ge=T=>{var we=Fs(),Ce=i(we),he=s(i(Ce),2);$e(he),l(Ce);var Q=s(Ce,2),V=s(i(Q),2),ve=i(V);ve.value=ve.__value="";var me=s(ve);nt(me,1,()=>M,ct,(L,Y)=>{var A=ws(),te=i(A,!0);l(A);var Me={};U(()=>{C(te,(e(Y),r(()=>e(Y).name))),Me!==(Me=(e(Y),r(()=>e(Y).id)))&&(A.value=(A.__value=(e(Y),r(()=>e(Y).id)))??"")}),c(L,A)}),l(V);var ne;Ca(V),l(Q);var Ue=s(Q,2);{var D=L=>{var Y=As(),A=s(i(Y),2),te=i(A);te.value=te.__value="";var Me=s(te);nt(Me,1,()=>e(k),ct,(Ne,qe)=>{var Ze=js(),tt=i(Ze,!0);l(Ze);var E={};U(()=>{C(tt,(e(qe),r(()=>e(qe).name))),E!==(E=(e(qe),r(()=>e(qe).id)))&&(Ze.value=(Ze.__value=(e(qe),r(()=>e(qe).id)))??"")}),c(Ne,Ze)}),l(A);var je;Ca(A),l(Y),U(()=>{je!==(je=(t(),r(()=>t().subclass)))&&(A.value=(A.__value=(t(),r(()=>t().subclass)))??"",ca(A,(t(),r(()=>t().subclass))))}),j("change",A,P),c(L,Y)};S(Ue,L=>{e(k),r(()=>e(k).length>0)&&L(D)})}var de=s(Ue,2),se=s(i(de),2);$e(se),l(de);var xe=s(de,2),f=s(i(xe),2);$e(f),l(xe);var H=s(xe,2),pe=s(i(H),2);$e(pe),l(H);var Ee=s(H,2),m=s(i(Ee),2);$e(m),l(Ee),l(we),U(()=>{ne!==(ne=(t(),r(()=>t().class)))&&(V.value=(V.__value=(t(),r(()=>t().class)))??"",ca(V,(t(),r(()=>t().class)))),ja(se,(t(),r(()=>t().level)))}),Fe(he,()=>t().name,L=>st(Z,r(t).name=L,r(t))),j("change",V,y),j("change",se,ce),Fe(f,()=>t().race,L=>st(Z,r(t).race=L,r(t))),Fe(pe,()=>t().background,L=>st(Z,r(t).background=L,r(t))),Fe(m,()=>t().alignment,L=>st(Z,r(t).alignment=L,r(t))),c(T,we)};S(be,T=>{v(),r(()=>!v().characterInfo)&&T(ge)})}l(G),U(()=>{et(ie,"aria-label",(v(),r(()=>v().characterInfo?"Expand":"Collapse"))),C(ke,(v(),r(()=>v().characterInfo?"â–¼":"â–²")))}),j("click",ie,ee),c(a,G),St(),h()}var Rs=p('<div class="ability-card svelte-bbv1xt"><h3 class="svelte-bbv1xt"> </h3> <input type="number" class="ability-score svelte-bbv1xt" min="1" max="30"/> <div class="ability-modifier svelte-bbv1xt"> </div> <button class="roll-btn svelte-bbv1xt">Check</button> <div class="save-row svelte-bbv1xt"><input type="checkbox" class="svelte-bbv1xt"/> <label class="svelte-bbv1xt">Save</label> <button class="roll-btn-small svelte-bbv1xt">Roll</button></div></div>'),Es=p('<div class="proficiency-bonus svelte-bbv1xt"><label for="profBonus">Proficiency Bonus</label> <input type="number" id="profBonus" class="prof-input svelte-bbv1xt"/></div> <div class="abilities-grid svelte-bbv1xt"></div>',1),Bs=p('<section><div class="header svelte-bbv1xt"><h2 class="svelte-bbv1xt">Ability Scores</h2> <button class="collapse-btn svelte-bbv1xt"> </button></div> <!></section>');function Ps(a,n){xt(n,!1);const t=()=>Je(ta,"$abilityModifiers",k),v=()=>Je(Z,"$character",k),u=()=>Je(Bt,"$searchFilter",k),h=()=>Je(bt,"$collapsedStates",k),[k,M]=Ct(),y=R(),P=R(),ce=Ht(),ee=[{key:"strength",label:"Strength"},{key:"dexterity",label:"Dexterity"},{key:"constitution",label:"Constitution"},{key:"intelligence",label:"Intelligence"},{key:"wisdom",label:"Wisdom"},{key:"charisma",label:"Charisma"}];function G(){Ka()}function ye(V){const ve=t()[V],me=`1d20${ve>=0?"+":""}${ve}`;ce("roll",me)}function ie(V){const ve=t()[V],me=v().saveProficiencies[V]?v().proficiencyBonus:0,ne=ve+me,Ue=`1d20${ne>=0?"+":""}${ne}`;ce("roll",Ue)}function ke(){bt.update(V=>({...V,abilityScores:!V.abilityScores}))}Xe(()=>u(),()=>{o(y,ee.filter(({label:V})=>u()?V.toLowerCase().includes(u().toLowerCase()):!0))}),Xe(()=>(e(y),u()),()=>{o(P,e(y).length>0||!u()||u().toLowerCase().includes("proficiency"))}),Mt(),kt();var be=Bs();let ge;var T=i(be),we=s(i(T),2),Ce=i(we,!0);l(we),l(T);var he=s(T,2);{var Q=V=>{var ve=Es(),me=Ve(ve),ne=s(i(me),2);$e(ne),l(me);var Ue=s(me,2);nt(Ue,5,()=>e(y),ct,(D,de)=>{let se=()=>e(de).key,xe=()=>e(de).label;var f=Rs(),H=i(f),pe=i(H,!0);l(H);var Ee=s(H,2);$e(Ee);var m=s(Ee,2),L=i(m);l(m);var Y=s(m,2),A=s(Y,2),te=i(A);$e(te);var Me=s(te,2),je=s(Me,2);l(A),l(f),U(Ne=>{C(pe,Ne),C(L,`${t(),se(),r(()=>t()[se()]>=0?"+":"")??""}${t(),se(),r(()=>t()[se()])??""}`),et(te,"id",`${se()}-save`),et(Me,"for",`${se()}-save`)},[()=>(xe(),r(()=>xe().substring(0,3).toUpperCase()))]),Fe(Ee,()=>v().abilities[se()],Ne=>st(Z,r(v).abilities[se()]=Ne,r(v))),j("change",Ee,G),j("click",Y,()=>ye(se())),va(te,()=>v().saveProficiencies[se()],Ne=>st(Z,r(v).saveProficiencies[se()]=Ne,r(v))),j("click",je,()=>ie(se())),c(D,f)}),l(Ue),Fe(ne,()=>v().proficiencyBonus,D=>st(Z,r(v).proficiencyBonus=D,r(v))),c(V,ve)};S(he,V=>{h(),r(()=>!h().abilityScores)&&V(Q)})}l(be),U(()=>{ge=ot(be,1,"ability-scores svelte-bbv1xt",null,ge,{hidden:!e(P)}),et(we,"aria-label",(h(),r(()=>h().abilityScores?"Expand":"Collapse"))),C(Ce,(h(),r(()=>h().abilityScores?"â–¼":"â–²")))}),j("click",we,ke),c(a,be),St(),M()}function Ts(a){return Math.floor((a-10)/2)}function Da(a,n){if(!a.class)return null;const t=yt(a.class);if(!t||!t.spellcaster||!t.spellcastingAbility)return null;const v=n[t.spellcastingAbility];return 8+a.proficiencyBonus+v}function Hs(a,n){if(!a.class)return 0;const t=yt(a.class);return!t||!t.spellcaster||!t.spellcastingAbility?0:Ts(n[t.spellcastingAbility])}var Us=p('<div class="stat-box svelte-1r5hyyb"><label for="spellSaveDC" class="svelte-1r5hyyb">Spell Save DC</label> <input type="number" id="spellSaveDC" class="stat-input svelte-1r5hyyb" readonly="" title="8 + Proficiency Bonus + Spellcasting Ability Modifier"/></div>'),Ns=p('<span class="hit-dice-type"> </span>'),Gs=p('<div class="stats-grid svelte-1r5hyyb"><div class="stat-box svelte-1r5hyyb"><label for="armorClass" class="svelte-1r5hyyb">Armor Class</label> <input type="number" id="armorClass" class="stat-input svelte-1r5hyyb"/></div> <div class="stat-box svelte-1r5hyyb"><label for="initiative" class="svelte-1r5hyyb">Initiative</label> <input type="number" id="initiative" class="stat-input svelte-1r5hyyb"/></div> <div class="stat-box svelte-1r5hyyb"><label for="speed" class="svelte-1r5hyyb">Speed</label> <input type="text" id="speed" class="stat-input svelte-1r5hyyb"/></div> <!></div> <div class="hp-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Points</h3> <div class="hp-display svelte-1r5hyyb"><div class="hp-inputs svelte-1r5hyyb"><input type="number" class="hp-current svelte-1r5hyyb" min="0"/> <span class="hp-separator svelte-1r5hyyb">/</span> <input type="number" class="hp-max svelte-1r5hyyb" min="0"/></div> <div class="hp-controls svelte-1r5hyyb"><button class="hp-btn svelte-1r5hyyb">âˆ’</button> <button class="hp-btn svelte-1r5hyyb">+</button> <button class="hp-btn svelte-1r5hyyb">âˆ’5</button> <button class="hp-btn svelte-1r5hyyb">+5</button></div></div> <div class="temp-hp svelte-1r5hyyb"><label for="tempHP" class="svelte-1r5hyyb">Temp HP</label> <input type="number" id="tempHP" min="0" class="svelte-1r5hyyb"/></div></div> <div class="hit-dice-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Dice</h3> <div class="hit-dice-display svelte-1r5hyyb"><input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <span>/</span> <input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <!></div> <div class="hit-dice-controls"><label for="hitDiceCount" class="svelte-1r5hyyb">Roll</label> <input type="number" id="hitDiceCount" class="hit-dice-count-input svelte-1r5hyyb" min="1" value="1"/> <button class="btn btn-primary roll-hit-dice use-enabled svelte-1r5hyyb">ðŸŽ² Roll</button></div></div>',1),Os=p('<section><div class="header svelte-1r5hyyb"><h2 class="svelte-1r5hyyb">Combat Stats</h2> <button class="collapse-btn svelte-1r5hyyb"> </button></div> <!></section>');function qs(a,n){xt(n,!1);const t=()=>Je(Z,"$character",k),v=()=>Je(ta,"$abilityModifiers",k),u=()=>Je(Bt,"$searchFilter",k),h=()=>Je(bt,"$collapsedStates",k),[k,M]=Ct(),y=R(),P=R(),ce=Ht();function ee(he){Z.update(Q=>(Q.currentHP=Math.max(0,Math.min(Q.maxHP,Q.currentHP+he)),Q))}function G(he=1){if(t().hitDice.current<=0){alert("No hit dice remaining!");return}if(!t().class){alert("Please select a class first!");return}const Q=yt(t().class);if(!Q){alert("Invalid class configuration!");return}const V=Math.min(he,t().hitDice.current),ve=Q.hitDice,me=v().constitution,ne=me>=0?`+${me}`:`${me}`,Ue=`${V}${ve}${ne}`;ce("rollHitDice",{notation:Ue,hitDie:ve,count:V})}function ye(){bt.update(he=>({...he,combatStats:!he.combatStats}))}Xe(()=>(t(),v()),()=>{o(y,Da(t(),v()))}),Xe(()=>u(),()=>{o(P,!u()||"armor class".includes(u().toLowerCase())||"initiative".includes(u().toLowerCase())||"speed".includes(u().toLowerCase())||"hit points".includes(u().toLowerCase())||"hp".includes(u().toLowerCase())||"hit dice".includes(u().toLowerCase())||"spell save".includes(u().toLowerCase())||"combat".includes(u().toLowerCase()))}),Mt(),kt();var ie=Os();let ke;var be=i(ie),ge=s(i(be),2),T=i(ge,!0);l(ge),l(be);var we=s(be,2);{var Ce=he=>{var Q=Gs(),V=Ve(Q),ve=i(V),me=s(i(ve),2);$e(me),l(ve);var ne=s(ve,2),Ue=s(i(ne),2);$e(Ue),l(ne);var D=s(ne,2),de=s(i(D),2);$e(de),l(D);var se=s(D,2);{var xe=B=>{var X=Us(),x=s(i(X),2);$e(x),l(X),U(()=>ja(x,e(y))),c(B,X)};S(se,B=>{e(y)!==null&&B(xe)})}l(V);var f=s(V,2),H=s(i(f),2),pe=i(H),Ee=i(pe);$e(Ee);var m=s(Ee,4);$e(m),l(pe);var L=s(pe,2),Y=i(L),A=s(Y,2),te=s(A,2),Me=s(te,2);l(L),l(H);var je=s(H,2),Ne=s(i(je),2);$e(Ne),l(je),l(f);var qe=s(f,2),Ze=s(i(qe),2),tt=i(Ze);$e(tt);var E=s(tt,4);$e(E);var w=s(E,2);{var F=B=>{const X=at(()=>(N(yt),t(),r(()=>yt(t().class))));var x=it(),Le=Ve(x);{var Se=Be=>{const Ge=at(()=>(v(),r(()=>v().constitution)));var Ke=Ns(),Pe=i(Ke);l(Ke),U(()=>C(Pe,`(${N(e(X)),r(()=>e(X).hitDice)??""}${(e(Ge)>=0?`+${e(Ge)}`:e(Ge))??""})`)),c(Be,Ke)};S(Le,Be=>{e(X)&&Be(Se)})}c(B,x)};S(w,B=>{t(),r(()=>t().class)&&B(F)})}l(Ze);var d=s(Ze,2),He=s(i(d),2),le=s(He,2);l(d),l(qe),U(()=>{et(Ee,"max",(t(),r(()=>t().maxHP))),et(tt,"max",(t(),r(()=>t().hitDice.max))),et(He,"max",(t(),r(()=>t().hitDice.current))),le.disabled=(t(),r(()=>t().hitDice.current<=0||!t().class))}),Fe(me,()=>t().armorClass,B=>st(Z,r(t).armorClass=B,r(t))),Fe(Ue,()=>t().initiative,B=>st(Z,r(t).initiative=B,r(t))),Fe(de,()=>t().speed,B=>st(Z,r(t).speed=B,r(t))),Fe(Ee,()=>t().currentHP,B=>st(Z,r(t).currentHP=B,r(t))),Fe(m,()=>t().maxHP,B=>st(Z,r(t).maxHP=B,r(t))),j("click",Y,()=>ee(-1)),j("click",A,()=>ee(1)),j("click",te,()=>ee(-5)),j("click",Me,()=>ee(5)),Fe(Ne,()=>t().tempHP,B=>st(Z,r(t).tempHP=B,r(t))),Fe(tt,()=>t().hitDice.current,B=>st(Z,r(t).hitDice.current=B,r(t))),Fe(E,()=>t().hitDice.max,B=>st(Z,r(t).hitDice.max=B,r(t))),j("input",He,B=>{const X=B.target,x=parseInt(X.value);x>t().hitDice.current&&(X.value=String(t().hitDice.current)),x<1&&(X.value="1")}),j("click",le,()=>{const B=document.getElementById("hitDiceCount"),X=parseInt(B?.value||"1");G(X)}),c(he,Q)};S(we,he=>{h(),r(()=>!h().combatStats)&&he(Ce)})}l(ie),U(()=>{ke=ot(ie,1,"combat-stats svelte-1r5hyyb",null,ke,{hidden:!e(P)}),et(ge,"aria-label",(h(),r(()=>h().combatStats?"Expand":"Collapse"))),C(T,(h(),r(()=>h().combatStats?"â–¼":"â–²")))}),j("click",ge,ye),c(a,ie),St(),M()}const Sa={acrobatics:"dexterity",animalHandling:"wisdom",arcana:"intelligence",athletics:"strength",deception:"charisma",history:"intelligence",insight:"wisdom",intimidation:"charisma",investigation:"intelligence",medicine:"wisdom",nature:"intelligence",perception:"wisdom",performance:"charisma",persuasion:"charisma",religion:"intelligence",sleightOfHand:"dexterity",stealth:"dexterity",survival:"wisdom"};var Ws=p('<div class="skill-row svelte-1f1pl16"><input type="checkbox" class="svelte-1f1pl16"/> <label class="svelte-1f1pl16"> <span class="ability-tag svelte-1f1pl16"> </span></label> <span class="skill-modifier svelte-1f1pl16"> </span> <button class="roll-btn svelte-1f1pl16">Roll</button></div>'),zs=p('<div class="skills-grid svelte-1f1pl16"></div>'),Ks=p('<section><div class="header svelte-1f1pl16"><h2 class="svelte-1f1pl16">Skills</h2> <button class="collapse-btn svelte-1f1pl16"> </button></div> <!></section>');function Vs(a,n){xt(n,!1);const t=()=>Je(ta,"$abilityModifiers",k),v=()=>Je(Z,"$character",k),u=()=>Je(Bt,"$searchFilter",k),h=()=>Je(bt,"$collapsedStates",k),[k,M]=Ct(),y=R(),P=R(),ce=Ht(),ee=[{key:"acrobatics",label:"Acrobatics"},{key:"animalHandling",label:"Animal Handling"},{key:"arcana",label:"Arcana"},{key:"athletics",label:"Athletics"},{key:"deception",label:"Deception"},{key:"history",label:"History"},{key:"insight",label:"Insight"},{key:"intimidation",label:"Intimidation"},{key:"investigation",label:"Investigation"},{key:"medicine",label:"Medicine"},{key:"nature",label:"Nature"},{key:"perception",label:"Perception"},{key:"performance",label:"Performance"},{key:"persuasion",label:"Persuasion"},{key:"religion",label:"Religion"},{key:"sleightOfHand",label:"Sleight of Hand"},{key:"stealth",label:"Stealth"},{key:"survival",label:"Survival"}];function G(Q){const V=Sa[Q],ve=t()[V],me=v().skillProficiencies[Q]?v().proficiencyBonus:0;return ve+me}function ye(Q){const V=G(Q),ve=`1d20${V>=0?"+":""}${V}`;ce("roll",ve)}function ie(){bt.update(Q=>({...Q,skills:!Q.skills}))}Xe(()=>u(),()=>{o(y,ee.filter(({label:Q})=>u()?Q.toLowerCase().includes(u().toLowerCase()):!0))}),Xe(()=>e(y),()=>{o(P,e(y).length>0)}),Mt(),kt();var ke=Ks();let be;var ge=i(ke),T=s(i(ge),2),we=i(T,!0);l(T),l(ge);var Ce=s(ge,2);{var he=Q=>{var V=zs();nt(V,5,()=>e(y),ct,(ve,me)=>{let ne=()=>e(me).key,Ue=()=>e(me).label;const D=at(()=>(N(Sa),ne(),r(()=>Sa[ne()]))),de=at(()=>(ne(),r(()=>G(ne()))));var se=Ws(),xe=i(se);$e(xe);var f=s(xe,2),H=i(f),pe=s(H),Ee=i(pe);l(pe),l(f);var m=s(f,2),L=i(m);l(m);var Y=s(m,2);l(se),U(A=>{et(xe,"id",ne()),et(f,"for",ne()),C(H,`${Ue()??""} `),C(Ee,`(${A??""})`),C(L,`${e(de)>=0?"+":""}${e(de)??""}`)},[()=>(N(e(D)),r(()=>e(D).substring(0,3).toUpperCase()))]),va(xe,()=>v().skillProficiencies[ne()],A=>st(Z,r(v).skillProficiencies[ne()]=A,r(v))),j("click",Y,()=>ye(ne())),c(ve,se)}),l(V),c(Q,V)};S(Ce,Q=>{h(),r(()=>!h().skills)&&Q(he)})}l(ke),U(()=>{be=ot(ke,1,"skills svelte-1f1pl16",null,be,{hidden:!e(P)}),et(T,"aria-label",(h(),r(()=>h().skills?"Expand":"Collapse"))),C(we,(h(),r(()=>h().skills?"â–¼":"â–²")))}),j("click",T,ie),c(a,ke),St(),M()}let ra=null,na=null;async function Qa(){if(ra)return ra;try{return ra=await(await fetch(Ja("/data/spells.json"))).json(),ra||[]}catch(a){return console.error("Failed to load spells:",a),[]}}async function Js(){if(na)return na;try{return na=await(await fetch(Ja("/data/feats.json"))).json(),na||[]}catch(a){return console.error("Failed to load feats:",a),[]}}function Ba(a,n){if(!n.trim())return a;const t=n.toLowerCase();return a.filter(v=>v.name.toLowerCase().includes(t)||v.school.toLowerCase().includes(t)||v.classes.some(u=>u.toLowerCase().includes(t))||v.description.toLowerCase().includes(t))}function Qs(a,n){return n===null?a:a.filter(t=>t.level===n)}function Ys(a,n){if(!n.trim())return a;const t=n.toLowerCase();return a.filter(v=>v.name.toLowerCase().includes(t)||v.description.toLowerCase().includes(t))}function oa(a){const n=a.description,t=/\b(Strength|Dexterity|Constitution|Intelligence|Wisdom|Charisma)\s+saving\s+throw/i,v=n.match(t);if(!v)return null;const u=v[1].toLowerCase(),k=/half\s+(?:as\s+much\s+)?damage\s+on\s+a\s+successful(?:\s+save)?/i.test(n),y=/saving\s+throw\s+or\s+take.*?damage/i.test(n)&&!k;return{ability:u,halfDamageOnSave:k,noDamageOnSave:y}}function Xs(a){const n=a.description;return/(plus|add)\s+your\s+spellcasting\s+(ability\s+)?modifier/i.test(n)}function Pa(a){const n=a.description.toLowerCase(),v=["takes","take","deals","deal","damage equal to","force damage","fire damage","cold damage","lightning damage","thunder damage","acid damage","poison damage","necrotic damage","radiant damage","psychic damage","regain","regains","hit point"].some(k=>n.includes(k));return["bonus to attack","bonus to damage","bonus to ac","gains a +","gain a +","+1 bonus","+2 bonus","+3 bonus","advantage on","becomes a magic weapon"].some(k=>n.includes(k))&&!v}function Zs(a){const n=a.description;let t=0,v=0,u="";const h=n.match(/\+(\d+)\s+bonus\s+to\s+attack\s+rolls\s+and\s+damage\s+rolls/i);if(h){const M=parseInt(h[1]);t=M,v=M,u=`+${M} to attack and damage rolls`}a.name==="Bless"&&(u="Add 1d4 to attack rolls and saves");const k=n.match(/\+(\d+)\s+bonus\s+to\s+AC/i);return k&&(u=`+${parseInt(k[1])} to AC`),a.name==="Haste"&&(u="+2 AC, doubled speed, extra action"),u||t!==0||v!==0?{attackBonus:t,damageBonus:v,description:u||a.description.substring(0,100)}:null}var el=p('<button class="btn-remove svelte-14o91c5">Ã—</button>'),tl=p('<div class="spell-info-loading svelte-14o91c5">Loading spell info...</div>'),al=p('<div class="spell-notes svelte-14o91c5"><h4 class="svelte-14o91c5">General Notes</h4> <p> </p></div>'),sl=p('<li class="svelte-14o91c5"><strong>At Higher Levels:</strong> </li>'),ll=p('<ul class="svelte-14o91c5"><li class="svelte-14o91c5"><strong>Level:</strong> </li> <li class="svelte-14o91c5"><strong>Casting Time:</strong> </li> <li class="svelte-14o91c5"><strong>Range:</strong> </li> <li class="svelte-14o91c5"><strong>Components:</strong> <!></li> <li class="svelte-14o91c5"><strong>Duration:</strong> <!> </li> <li class="svelte-14o91c5"><strong>Description:</strong> </li> <!></ul>'),il=p("<option> </option>"),rl=p('<span class="scaled-damage svelte-14o91c5"><!> </span>'),nl=p('<span class="scaled-damage svelte-14o91c5"> </span>'),ol=p('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> Target is Fiend or Undead <!></label></div>'),cl=p('<span class="scaled-damage svelte-14o91c5" style="margin-left: 8px;"> </span>'),vl=p('<span class="scaled-damage svelte-14o91c5">(Half damage)</span>'),dl=p('<span class="scaled-damage svelte-14o91c5">(No damage)</span>'),ul=p('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> <!> <!></label></div>'),pl=p('<div class="spell-level-selector svelte-14o91c5"><label class="svelte-14o91c5">Cast at Level:</label> <select class="spell-level-select use-enabled svelte-14o91c5"></select> <!></div> <!> <!>',1),fl=p('<div class="spell-level-selector svelte-14o91c5"><span style="color: #dc3545; font-weight: bold;">No spell slots available!</span></div>'),bl=p('<!> <div class="spell-info svelte-14o91c5"><div class="spell-info-header svelte-14o91c5" role="button" tabindex="0"><h4 class="svelte-14o91c5">Spell Info</h4> <button class="collapse-btn-small svelte-14o91c5"> </button></div> <!></div> <!>',1),gl=p('<div class="spell-info-missing svelte-14o91c5">Spell info not found.</div>'),hl=p('<div class="attack-notes svelte-14o91c5"><label class="svelte-14o91c5">Notes</label> <textarea placeholder="e.g., DC 15 Dex save, Range 120 ft, Concentration" class="notes-input svelte-14o91c5" rows="2"></textarea></div>'),ml=p('<button class="btn btn-primary">Roll Attack</button>'),_l=p('<button class="btn btn-success">Cast Spell</button>'),yl=p('<button class="btn btn-secondary"><!></button>'),kl=p('<button class="btn btn-secondary">Roll Damage</button>'),xl=p('<div class="attack-card svelte-14o91c5"><div class="attack-header svelte-14o91c5"><input type="text" placeholder="Attack name" class="attack-name svelte-14o91c5"/> <!></div> <div class="attack-details svelte-14o91c5"><div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Bonus</label> <input type="number" class="attack-bonus svelte-14o91c5"/></div> <div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Damage</label> <input type="text" placeholder="e.g., 2d6+3" class="attack-damage svelte-14o91c5"/></div> <div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Type</label> <input type="text" placeholder="e.g., slashing" class="attack-type svelte-14o91c5"/></div></div> <!> <!> <div class="attack-actions svelte-14o91c5"><!> <!></div></div>'),Sl=p('<p class="no-attacks svelte-14o91c5">No attacks added yet. Click "Add Attack" to create one.</p>'),$l=p('<p class="no-attacks svelte-14o91c5">No attacks match your search.</p>'),Cl=p('<button class="btn-remove svelte-14o91c5">Ã—</button>'),Ll=p('<div class="state-card svelte-14o91c5"><div class="state-header svelte-14o91c5"><input type="text" placeholder="Effect name (e.g., Magic Weapon)" class="state-name svelte-14o91c5"/> <!></div> <div class="state-details svelte-14o91c5"><div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Attack Bonus</label> <input type="number" class="state-bonus svelte-14o91c5"/></div> <div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Damage Bonus</label> <input type="number" class="state-bonus svelte-14o91c5"/></div></div> <div class="state-description svelte-14o91c5"><label class="svelte-14o91c5">Description</label> <input type="text" placeholder="e.g., +1 to attack and damage rolls (Magic Weapon)" class="state-desc-input svelte-14o91c5"/></div></div>'),Dl=p('<div class="states-list svelte-14o91c5"></div>'),wl=p('<p class="no-states svelte-14o91c5">No active effects. Add spell effects that modify your attacks.</p>'),jl=p('<button class="btn btn-secondary">Add Attack</button> <div class="attacks-list svelte-14o91c5"><!> <!></div> <div class="active-states-section svelte-14o91c5"><h3 class="svelte-14o91c5">Active Spell Effects</h3> <p class="section-description svelte-14o91c5">Effects that modify attack and damage rolls (e.g., Magic Weapon, Bless)</p> <button class="btn btn-secondary">Add Effect</button> <!></div>',1),Al=p('<section><div class="header svelte-14o91c5"><h2 class="svelte-14o91c5">Attacks & Spells</h2> <button class="collapse-btn svelte-14o91c5"> </button></div> <!></section>');function Fl(a,n){xt(n,!1);const t=()=>Je(Z,"$character",M),v=()=>Je(ta,"$abilityModifiers",M),u=()=>Je(Bt,"$searchFilter",M),h=()=>Je(bt,"$collapsedStates",M),k=()=>Je(Yt,"$isEditMode",M),[M,y]=Ct(),P=R(),ce=R(),ee=Ht();let G=R({});function ye(m){Wa(G,e(G)[m]=!e(G)[m]),o(G,{...e(G)})}function ie(m){return m.description.toLowerCase().includes("regain")&&(m.description.toLowerCase().includes("hit point")||m.description.toLowerCase().includes("hp"))}function ke(){Z.update(m=>(m.attacks=[...m.attacks,{id:crypto.randomUUID(),name:"",bonus:0,damage:"",damageType:"",notes:""}],m))}function be(m){Z.update(L=>(L.attacks=L.attacks.filter(Y=>Y.id!==m),L))}function ge(m){let L=m.damage,Y=!1;if(m.spellRef){const Me=Q(m.spellRef);if(Me&&Me.level>0){const je=m.castAtLevel||Me.level;if(!V(je)){alert(`No level ${je} spell slots available!`);return}const qe=oa(Me);qe&&m.targetSucceededSave&&qe.noDamageOnSave?L="0":(Y=qe?.halfDamageOnSave&&m.targetSucceededSave||!1,L=ve(m,Me))}}let A=m.bonus;if(t().activeStates)for(const Me of t().activeStates)A+=Me.attackBonus;const te=`1d20${A>=0?"+":""}${A}`;ee("roll",{notation:te,damageNotation:L,attackName:m.name,applyHalfDamage:Y})}function T(m){if(!m.damage){alert(`${m.name}: No damage specified`);return}let L=m.damage,Y=!1;if(m.spellRef){const A=Q(m.spellRef);if(A&&A.level>0){const te=m.castAtLevel||A.level;if(!V(te)){alert(`No level ${te} spell slots available!`);return}const je=oa(A);je&&m.targetSucceededSave&&je.noDamageOnSave?L="0":(Y=je?.halfDamageOnSave&&m.targetSucceededSave||!1,L=ve(m,A))}}else if(t().activeStates&&t().activeStates.length>0){let A=0;for(const te of t().activeStates)A+=te.damageBonus;if(A!==0){const te=L.match(/(\d+d\d+)([+-]\d+)?/);if(te){const[,Me,je]=te,qe=(je?parseInt(je):0)+A;L=`${Me}${qe>=0?"+":""}${qe}`}else L=`${(parseInt(L)||0)+A}`}}ee("roll",{notation:L,attackName:m.name,applyHalfDamage:Y})}function we(){bt.update(m=>({...m,attacks:!m.attacks}))}let Ce=R([]),he=R(!1);ea(async()=>{o(Ce,await Qa()),o(he,!0)});function Q(m){return e(Ce).find(L=>L.name===m)}function V(m){t().classFeatures.spellSlotsByLevel||st(Z,r(t).classFeatures.spellSlotsByLevel={},r(t)),t().classFeatures.spellSlotsByLevel[m]||st(Z,r(t).classFeatures.spellSlotsByLevel[m]=Array(2).fill(!1),r(t));const Y=t().classFeatures.spellSlotsByLevel[m].findIndex(A=>!A);return Y===-1?!1:(Z.update(A=>(A.classFeatures.spellSlotsByLevel||(A.classFeatures.spellSlotsByLevel={}),A.classFeatures.spellSlotsByLevel[m]||(A.classFeatures.spellSlotsByLevel[m]=Array(2).fill(!1)),A.classFeatures.spellSlotsByLevel[m][Y]=!0,A)),!0)}function ve(m,L){let Y=m.damage,A=0,te=0;if(Xs(L)&&(te+=Hs(t(),v())),t().activeStates)for(const F of t().activeStates)te+=F.damageBonus;if(L.higherLevelSlot&&m.castAtLevel){const F=L.level,He=(m.castAtLevel||F)-F;if(He>0){const le=L.higherLevelSlot.match(/(\d+)d(\d+)\s+for\s+each.*?level\s+above/i);if(le){const[,B]=le;A+=He*parseInt(B)}}}if(m.targetIsFiendOrUndead&&L.description.includes("Fiend or an Undead")){const F=L.description.match(/increases by (\d+)d(\d+) if.*?Fiend or.*?Undead/i);if(F){const[,d]=F;A+=parseInt(d)}}const Me=Y.match(/(\d+)d(\d+)([+-]\d+)?/);if(!Me)return te!==0?te>=0?`${te}`:`${te}`:Y||"0";const[,je,Ne,qe]=Me,Ze=parseInt(je)+A,E=(qe?parseInt(qe):0)+te;let w=`${Ze}d${Ne}`;return E!==0&&(w+=E>=0?`+${E}`:`${E}`),w}function me(m){const L=[];for(let A=m.level;A<=9;A++){const te=t().classFeatures.spellSlotsByLevel?.[A];te&&te.length>0&&L.push(A)}return L}function ne(){Z.update(m=>(m.activeStates||(m.activeStates=[]),m.activeStates=[...m.activeStates,{name:"",attackBonus:0,damageBonus:0,description:""}],m))}function Ue(m){Z.update(L=>(L.activeStates&&(L.activeStates=L.activeStates.filter((Y,A)=>A!==m)),L))}function D(m){const L=Q(m.spellRef);if(!L){alert("Spell not found");return}const Y=m.castAtLevel||L.level;if(Y>0&&!V(Y)){alert(`No level ${Y} spell slots available!`);return}const A=Zs(L);if(!A){alert(`${L.name} cast! Check spell description for effects.`);return}Z.update(te=>(te.activeStates||(te.activeStates=[]),te.activeStates=te.activeStates.filter(Me=>Me.name!==L.name),te.activeStates=[...te.activeStates,{name:L.name,attackBonus:A.attackBonus,damageBonus:A.damageBonus,description:A.description}],te)),alert(`${L.name} cast! Effect added to Active Spell Effects.`)}Xe(()=>(t(),u()),()=>{o(P,t().attacks.filter(m=>{if(!u())return!0;const L=u().toLowerCase();return m.name.toLowerCase().includes(L)||m.damageType.toLowerCase().includes(L)}).sort((m,L)=>!m.spellRef&&L.spellRef?-1:m.spellRef&&!L.spellRef?1:0))}),Xe(()=>(u(),e(P)),()=>{o(ce,!u()||e(P).length>0||"attack".includes(u().toLowerCase())||"spell".includes(u().toLowerCase()))}),Mt(),kt();var de=Al();let se;var xe=i(de),f=s(i(xe),2),H=i(f,!0);l(f),l(xe);var pe=s(xe,2);{var Ee=m=>{var L=jl(),Y=Ve(L),A=s(Y,2),te=i(A);nt(te,1,()=>e(P),F=>F.id,(F,d,He)=>{var le=xl(),B=i(le),X=i(B);$e(X);var x=s(X,2);{var Le=q=>{var W=el();j("click",W,()=>be(e(d).id)),c(q,W)};S(x,q=>{k()&&q(Le)})}l(B);var Se=s(B,2),Be=i(Se),Ge=s(i(Be),2);$e(Ge),l(Be);var Ke=s(Be,2),Pe=s(i(Ke),2);$e(Pe),l(Ke);var ae=s(Ke,2),fe=s(i(ae),2);$e(fe),l(ae),l(Se);var Oe=s(Se,2);{var We=q=>{var W=it(),Ie=Ve(W);{var g=_=>{var $=tl();c(_,$)},z=_=>{const $=at(()=>(e(d),r(()=>Q(e(d).spellRef))));var Re=it(),Qe=Ve(Re);{var ze=oe=>{var re=bl(),De=Ve(re);{var Pt=gt=>{var ht=al(),jt=s(i(ht),2),Wt=i(jt,!0);l(jt),l(ht),U(()=>C(Wt,(e(d),r(()=>e(d).generalNotes)))),c(gt,ht)};S(De,gt=>{e(d),r(()=>e(d).generalNotes)&&gt(Pt)})}var wt=s(De,2),dt=i(wt),It=s(i(dt),2),pa=i(It,!0);l(It),l(dt);var Ya=s(dt,2);{var Xa=gt=>{var ht=ll(),jt=i(ht),Wt=s(i(jt));l(jt);var zt=s(jt,2),fa=s(i(zt));l(zt);var Lt=s(zt,2),mt=s(i(Lt));l(Lt);var Ut=s(Lt,2),Nt=s(i(Ut)),aa=s(Nt);{var Tt=Ye=>{var lt=ft();U(()=>C(lt,`(${N(e($)),r(()=>e($).material)??""})`)),c(Ye,lt)};S(aa,Ye=>{N(e($)),r(()=>e($).material)&&Ye(Tt)})}l(Ut);var Kt=s(Ut,2),sa=s(i(Kt),2);{var la=Ye=>{var lt=ft("Concentration,");c(Ye,lt)};S(sa,Ye=>{N(e($)),r(()=>e($).concentration)&&Ye(la)})}var ba=s(sa,1,!0);l(Kt);var Vt=s(Kt,2),ga=s(i(Vt));l(Vt);var rt=s(Vt,2);{var vt=Ye=>{var lt=sl(),$t=s(i(lt));l(lt),U(()=>C($t,` ${N(e($)),r(()=>e($).higherLevelSlot)??""}`)),c(Ye,lt)};S(rt,Ye=>{N(e($)),r(()=>e($).higherLevelSlot)&&Ye(vt)})}l(ht),U(Ye=>{C(Wt,` ${N(e($)),r(()=>e($).level)??""}`),C(fa,` ${N(e($)),r(()=>e($).castingTime||e($).actionType)??""}`),C(mt,` ${N(e($)),r(()=>e($).range)??""}`),C(Nt,` ${Ye??""}`),C(ba,(N(e($)),r(()=>e($).duration))),C(ga,` ${N(e($)),r(()=>e($).description)??""}`)},[()=>(N(e($)),r(()=>e($).components.join(", ")))]),c(gt,ht)};S(Ya,gt=>{e(G),e(d),r(()=>!e(G)[e(d).id])&&gt(Xa)})}l(wt);var Za=s(wt,2);{var es=gt=>{const ht=at(()=>(N(e($)),r(()=>me(e($)))));var jt=it(),Wt=Ve(jt);{var zt=Lt=>{const mt=at(()=>(N(oa),N(e($)),r(()=>oa(e($)))));var Ut=pl(),Nt=Ve(Ut),aa=i(Nt),Tt=s(aa,2);U(()=>{e(d),pt(()=>{e(ht)})}),nt(Tt,5,()=>e(ht),ct,(rt,vt)=>{var Ye=il(),lt=i(Ye);l(Ye);var $t={};U(()=>{C(lt,`Level ${e(vt)??""}`),$t!==($t=e(vt))&&(Ye.value=(Ye.__value=e(vt))??"")}),c(rt,Ye)}),l(Tt);var Kt=s(Tt,2);{var sa=rt=>{const vt=at(()=>(e(d),N(e($)),r(()=>ve(e(d),e($)))));var Ye=rl(),lt=i(Ye);{var $t=Dt=>{var Ft=ft("Healing");c(Dt,Ft)},Gt=Dt=>{var Ft=ft("Damage");c(Dt,Ft)};S(lt,Dt=>{N(e($)),r(()=>ie(e($)))?Dt($t):Dt(Gt,!1)})}var At=s(lt);l(Ye),U(()=>C(At,` ${e(vt)??""}`)),c(rt,Ye)};S(Kt,rt=>{e(d),N(e($)),r(()=>e(d).castAtLevel&&e(d).castAtLevel>e($).level)&&rt(sa)})}l(Nt);var la=s(Nt,2);{var ba=rt=>{var vt=ol(),Ye=i(vt),lt=i(Ye);$e(lt);var $t=s(lt,2);{var Gt=At=>{const Dt=at(()=>(e(d),N(e($)),r(()=>ve(e(d),e($)))));var Ft=nl(),ha=i(Ft);l(Ft),U(()=>C(ha,`(+1d8, total: ${e(Dt)??""})`)),c(At,Ft)};S($t,At=>{e(d),r(()=>e(d).targetIsFiendOrUndead)&&At(Gt)})}l(Ye),l(vt),va(lt,()=>e(d).targetIsFiendOrUndead,At=>(e(d).targetIsFiendOrUndead=At,pt(()=>(e(P),t(),u())))),c(rt,vt)};S(la,rt=>{N(e($)),r(()=>e($).description.includes("Fiend or an Undead"))&&rt(ba)})}var Vt=s(la,2);{var ga=rt=>{var vt=ul(),Ye=i(vt),lt=i(Ye);$e(lt);var $t=s(lt),Gt=s($t);{var At=ut=>{var Rt=cl(),ma=i(Rt);l(Rt),U(_a=>C(ma,`(Spell Save DC: ${_a??""})`),[()=>(N(Da),t(),v(),r(()=>Da(t(),v())))]),c(ut,Rt)};S(Gt,ut=>{t(),r(()=>t().class)&&ut(At)})}var Dt=s(Gt,2);{var Ft=ut=>{var Rt=vl();c(ut,Rt)},ha=ut=>{var Rt=it(),ma=Ve(Rt);{var _a=ya=>{var ts=dl();c(ya,ts)};S(ma,ya=>{e(d),N(e(mt)),r(()=>e(d).targetSucceededSave&&e(mt).noDamageOnSave)&&ya(_a)},!0)}c(ut,Rt)};S(Dt,ut=>{e(d),N(e(mt)),r(()=>e(d).targetSucceededSave&&e(mt).halfDamageOnSave)?ut(Ft):ut(ha,!1)})}l(Ye),l(vt),U(ut=>C($t,` Target succeeded on ${ut??""} save `),[()=>(N(e(mt)),r(()=>e(mt).ability.charAt(0).toUpperCase()+e(mt).ability.slice(1)))]),va(lt,()=>e(d).targetSucceededSave,ut=>(e(d).targetSucceededSave=ut,pt(()=>(e(P),t(),u())))),c(rt,vt)};S(Vt,rt=>{e(mt)&&rt(ga)})}U(()=>{et(aa,"for",`castLevel-${e(d),r(()=>e(d).id)??""}`),et(Tt,"id",`castLevel-${e(d),r(()=>e(d).id)??""}`)}),Va(Tt,()=>e(d).castAtLevel,rt=>(e(d).castAtLevel=rt,pt(()=>(e(P),t(),u())))),c(Lt,Ut)},fa=Lt=>{var mt=fl();c(Lt,mt)};S(Wt,Lt=>{N(e(ht)),r(()=>e(ht).length>0)?Lt(zt):Lt(fa,!1)})}c(gt,jt)};S(Za,gt=>{N(e($)),r(()=>e($).higherLevelSlot&&e($).level>0)&&gt(es)})}U(()=>{et(It,"aria-label",(e(G),e(d),r(()=>e(G)[e(d).id]?"Expand":"Collapse"))),C(pa,(e(G),e(d),r(()=>e(G)[e(d).id]?"â–¼":"â–²")))}),j("click",dt,()=>ye(e(d).id)),j("keydown",dt,gt=>gt.key==="Enter"&&ye(e(d).id)),c(oe,re)},Te=oe=>{var re=gl();c(oe,re)};S(Qe,oe=>{e($)?oe(ze):oe(Te,!1)})}c(_,Re)};S(Ie,_=>{e(Ce),r(()=>e(Ce).length===0)?_(g):_(z,!1)})}c(q,W)};S(Oe,q=>{e(d),r(()=>e(d).spellRef)&&q(We)})}var K=s(Oe,2);{var _e=q=>{var W=hl(),Ie=s(i(W),2);Qt(Ie),l(W),Fe(Ie,()=>e(d).notes,g=>(e(d).notes=g,pt(()=>(e(P),t(),u())))),c(q,W)};S(K,q=>{e(d),r(()=>!e(d).spellRef)&&q(_e)})}var b=s(K,2),I=i(b);{var O=q=>{var W=ml();j("click",W,()=>ge(e(d))),c(q,W)};S(I,q=>{e(d),r(()=>e(d).bonus!==0||!e(d).spellRef)&&q(O)})}var J=s(I,2);{var ue=q=>{const W=at(()=>(e(d),r(()=>Q(e(d).spellRef))));var Ie=it(),g=Ve(Ie);{var z=$=>{var Re=_l();j("click",Re,()=>D(e(d))),c($,Re)},_=$=>{var Re=yl(),Qe=i(Re);{var ze=oe=>{var re=ft("Roll Healing");c(oe,re)},Te=oe=>{var re=ft("Roll Damage");c(oe,re)};S(Qe,oe=>{N(e(W)),r(()=>e(W)&&ie(e(W)))?oe(ze):oe(Te,!1)})}l(Re),j("click",Re,()=>T(e(d))),c($,Re)};S(g,$=>{N(e(W)),N(Pa),r(()=>e(W)&&Pa(e(W)))?$(z):$(_,!1)})}c(q,Ie)},Ae=q=>{var W=kl();j("click",W,()=>T(e(d))),c(q,W)};S(J,q=>{e(d),e(he),r(()=>e(d).spellRef&&e(he))?q(ue):q(Ae,!1)})}l(b),l(le),Fe(X,()=>e(d).name,q=>(e(d).name=q,pt(()=>(e(P),t(),u())))),Fe(Ge,()=>e(d).bonus,q=>(e(d).bonus=q,pt(()=>(e(P),t(),u())))),Fe(Pe,()=>e(d).damage,q=>(e(d).damage=q,pt(()=>(e(P),t(),u())))),Fe(fe,()=>e(d).damageType,q=>(e(d).damageType=q,pt(()=>(e(P),t(),u())))),c(F,le)});var Me=s(te,2);{var je=F=>{var d=Sl();c(F,d)},Ne=F=>{var d=it(),He=Ve(d);{var le=B=>{var X=$l();c(B,X)};S(He,B=>{e(P),r(()=>e(P).length===0)&&B(le)},!0)}c(F,d)};S(Me,F=>{t(),r(()=>t().attacks.length===0)?F(je):F(Ne,!1)})}l(A);var qe=s(A,2),Ze=s(i(qe),4),tt=s(Ze,2);{var E=F=>{var d=Dl();nt(d,5,()=>(t(),r(()=>t().activeStates)),ct,(He,le,B)=>{var X=Ll(),x=i(X),Le=i(x);$e(Le);var Se=s(Le,2);{var Be=K=>{var _e=Cl();j("click",_e,()=>Ue(B)),c(K,_e)};S(Se,K=>{k()&&K(Be)})}l(x);var Ge=s(x,2),Ke=i(Ge),Pe=s(i(Ke),2);$e(Pe),l(Ke);var ae=s(Ke,2),fe=s(i(ae),2);$e(fe),l(ae),l(Ge);var Oe=s(Ge,2),We=s(i(Oe),2);$e(We),l(Oe),l(X),Fe(Le,()=>e(le).name,K=>(e(le).name=K,pt(()=>t()),ia(M,"$character"))),Fe(Pe,()=>e(le).attackBonus,K=>(e(le).attackBonus=K,pt(()=>t()),ia(M,"$character"))),Fe(fe,()=>e(le).damageBonus,K=>(e(le).damageBonus=K,pt(()=>t()),ia(M,"$character"))),Fe(We,()=>e(le).description,K=>(e(le).description=K,pt(()=>t()),ia(M,"$character"))),c(He,X)}),l(d),c(F,d)},w=F=>{var d=wl();c(F,d)};S(tt,F=>{t(),r(()=>t().activeStates&&t().activeStates.length>0)?F(E):F(w,!1)})}l(qe),j("click",Y,ke),j("click",Ze,ne),c(m,L)};S(pe,m=>{h(),r(()=>!h().attacks)&&m(Ee)})}l(de),U(()=>{se=ot(de,1,"attacks svelte-14o91c5",null,se,{hidden:!e(ce)}),et(f,"aria-label",(h(),r(()=>h().attacks?"Expand":"Collapse"))),C(H,(h(),r(()=>h().attacks?"â–¼":"â–²")))}),j("click",f,we),c(a,de),St(),y()}var Ml=p('<span class="slot-checkbox-x svelte-serp1j">&#8212;</span>'),Il=p('<label><input type="checkbox" class="slot-checkbox-input svelte-serp1j"/> <span><!></span></label>');function Ta(a,n){xt(n,!1);const t=()=>Je(Yt,"$isEditMode",v),[v,u]=Ct();let h=_t(n,"checked",8,!1),k=_t(n,"disabled",8,!1),M=_t(n,"className",8,""),y=_t(n,"index",8,void 0),P=_t(n,"ariaLabel",8,void 0);const ce=Ht();function ee(ge){ce("change",{checked:ge.currentTarget.checked,index:y()})}kt();var G=Il(),ye=i(G);$e(ye);var ie=s(ye,2),ke=i(ie);{var be=ge=>{var T=Ml();c(ge,T)};S(ke,ge=>{h()&&ge(be)})}l(ie),l(G),U(()=>{ot(G,1,"slot-checkbox-label "+M()+(t()?"":" not-editable"),"svelte-serp1j"),xs(ye,h()),ye.disabled=k()||!t(),et(ye,"aria-label",P()),et(ye,"tabindex",t()?0:-1),ot(ie,1,`slot-checkbox-custom ${h()?"used":""} ${t()?"":"readonly"}`,"svelte-serp1j")}),j("change",ye,ee),c(a,G),St(),u()}var Rl=p('<p class="no-features svelte-1kpvv0n">Select a class to see available features</p>'),El=p('<p class="no-features svelte-1kpvv0n">No class features available at this level</p>'),Bl=p('<div class="spell-slots svelte-1kpvv0n"><label class="svelte-1kpvv0n"> </label> <div class="slots-tracker svelte-1kpvv0n"></div></div>'),Pl=p('<div class="all-spell-slots"></div>'),Tl=p('<div class="feature-box spellcasting svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"> </h3> <div class="spell-stats svelte-1kpvv0n"><div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Spell Save DC</label> <div class="spell-value svelte-1kpvv0n"> </div></div> <div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <div class="spell-value svelte-1kpvv0n"> </div></div></div> <!> <div class="prepared-spells svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <textarea placeholder="List your prepared spells..." class="svelte-1kpvv0n"></textarea></div></div>'),Hl=p('<p class="unlimited svelte-1kpvv0n">Unlimited Uses</p>'),Ul=p('<div class="slots-tracker svelte-1kpvv0n"></div> <div class="uses-actions-row"><button class="btn btn-primary use-enabled"> </button></div> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div>',1),Nl=p('<div class="uses-tracker svelte-1kpvv0n"><!></div>'),Gl=p('<div class="pool-tracker svelte-1kpvv0n"><input type="number" min="0" class="pool-input svelte-1kpvv0n"/> <span> </span> <button class="btn-small svelte-1kpvv0n"> </button></div>'),Ol=p('<p class="no-uses svelte-1kpvv0n">No Channel Divinity uses remaining</p>'),ql=p('<div class="channel-divinity-option svelte-1kpvv0n"><button class="btn btn-primary use-enabled svelte-1kpvv0n">Use Channel Divinity</button> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div> <!></div>'),Wl=p('<div class="feature-box svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"><!> </h3> <p class="feature-description svelte-1kpvv0n"> </p> <!></div>'),zl=p('<div class="features-grid svelte-1kpvv0n"><!> <!></div>'),Kl=p('<section><div class="header svelte-1kpvv0n"><h2 class="svelte-1kpvv0n">Class Features</h2> <button class="collapse-btn svelte-1kpvv0n"> </button></div> <!></section>');function Vl(a,n){xt(n,!1);const t=()=>Je(Z,"$character",k),v=()=>Je(ta,"$abilityModifiers",k),u=()=>Je(Bt,"$searchFilter",k),h=()=>Je(bt,"$collapsedStates",k),[k,M]=Ct(),y=R(),P=R(),ce=R(),ee=R(),G=R(),ye=R(),ie=R();let ke=R(0),be=R(0);function ge(f,H){Z.update(pe=>(pe.classFeatures.features[f]=H,pe))}function T(){Z.update(f=>(f.classFeatures.spellSlotsByLevel||(f.classFeatures.spellSlotsByLevel={}),e(ee).forEach(({level:H,slots:pe})=>{f.classFeatures.spellSlotsByLevel[H]||(f.classFeatures.spellSlotsByLevel[H]=Array(pe).fill(!1))}),f))}function we(f){if(typeof f.maxUses=="function"){if((f.name==="Divine Sense"||f.name==="War Priest")&&e(y)?.spellcastingAbility){const H=v()[e(y).spellcastingAbility];return f.maxUses(t().level,H)}return f.maxUses(t().level)}return f.maxUses||0}function Ce(f,H){Z.update(pe=>((!pe.classFeatures.features[f]||!Array.isArray(pe.classFeatures.features[f])||pe.classFeatures.features[f].length!==H)&&(pe.classFeatures.features[f]=Array(H).fill(!1)),pe))}as(()=>{e(ye)&&t()&&t().classFeatures&&t().classFeatures.features&&e(ye).forEach(f=>{if(f.type==="uses"){const H=f.name.replace(/\s+/g,""),pe=we(f),Ee=t().classFeatures.features[H];(!Array.isArray(Ee)||Ee.length!==pe)&&Ce(H,pe)}})});function he(f){return typeof f.maxPool=="function"?f.maxPool(t().level):f.maxPool||0}function Q(f){return typeof f.description=="function"?f.description(t().level):f.description}function V(){const f="ChannelDivinity";Z.update(H=>{const pe=H.classFeatures.features[f];return typeof pe=="number"&&pe>0&&(H.classFeatures.features[f]=pe-1),H})}function ve(){bt.update(f=>({...f,classFeatures:!f.classFeatures}))}Xe(()=>(t(),yt),()=>{o(y,t().class?yt(t().class):null)}),Xe(()=>(t(),qt),()=>{o(P,t().class?qt(t().class,t().level,t().subclass):[])}),Xe(()=>(t(),Ra),()=>{o(ce,t().class?Ra(t().class,t().level):0)}),Xe(()=>(e(y),t()),()=>{o(ee,(()=>{if(!e(y)?.spellcaster)return[];const f=t().level,H=[];return f>=1&&H.push({level:1,slots:Math.min(4,2+Math.floor(f/3))}),f>=3&&H.push({level:2,slots:Math.min(3,2+Math.floor((f-3)/4))}),f>=5&&H.push({level:3,slots:Math.min(3,2+Math.floor((f-5)/5))}),f>=7&&H.push({level:4,slots:Math.min(3,1+Math.floor((f-7)/6))}),f>=9&&H.push({level:5,slots:Math.min(2,1+Math.floor((f-9)/8))}),f>=11&&H.push({level:6,slots:1}),f>=13&&H.push({level:7,slots:1}),f>=15&&H.push({level:8,slots:1}),f>=17&&H.push({level:9,slots:1}),H})())}),Xe(()=>(e(y),v(),t(),Ea),()=>{if(e(y)?.spellcaster&&e(y).spellcastingAbility){const f=v()[e(y).spellcastingAbility];o(ke,Ls(t().class,f,t().proficiencyBonus)||0),o(be,Ea(t().class,t().level,f))}}),Xe(()=>(t(),e(y),e(ee)),()=>{t().class&&e(y)?.spellcaster&&e(ee).length>0&&T()}),Xe(()=>t(),()=>{o(G,(()=>{const H=t().classFeatures.features["ChannelDivinity"];return typeof H=="number"?H:0})())}),Xe(()=>(e(P),u()),()=>{o(ye,e(P).filter(f=>{if(!u())return!0;const H=u().toLowerCase();return f.name.toLowerCase().includes(H)||Q(f).toLowerCase().includes(H)}))}),Xe(()=>(u(),t(),e(ye)),()=>{o(ie,!u()||t().class||"class features".includes(u().toLowerCase())||"spellcasting".includes(u().toLowerCase())||e(ye).length>0)}),Mt(),kt();var me=Kl();let ne;var Ue=i(me),D=s(i(Ue),2),de=i(D,!0);l(D),l(Ue);var se=s(Ue,2);{var xe=f=>{var H=it(),pe=Ve(H);{var Ee=L=>{var Y=Rl();c(L,Y)},m=L=>{var Y=it(),A=Ve(Y);{var te=je=>{var Ne=El();c(je,Ne)},Me=je=>{var Ne=zl(),qe=i(Ne);{var Ze=E=>{var w=Tl(),F=i(w),d=i(F);l(F);var He=s(F,2),le=i(He),B=s(i(le),2),X=i(B,!0);l(B),l(le);var x=s(le,2),Le=s(i(x),2),Se=i(Le,!0);l(Le),l(x),l(He);var Be=s(He,2);{var Ge=ae=>{var fe=Pl();nt(fe,5,()=>e(ee),ct,(Oe,We)=>{let K=()=>e(We).level,_e=()=>e(We).slots;const b=at(()=>(t(),K(),_e(),r(()=>t().classFeatures.spellSlotsByLevel?.[K()]||Array(_e()).fill(!1))));var I=Bl(),O=i(I),J=i(O);l(O);var ue=s(O,2);nt(ue,5,()=>e(b),ct,(Ae,q,W)=>{{let Ie=at(()=>(N(e(b)),r(()=>e(b)[W]||!1)));Ta(Ae,{get checked(){return e(Ie)},$$events:{change:g=>{Z.update(z=>(z.classFeatures.spellSlotsByLevel||(z.classFeatures.spellSlotsByLevel={}),z.classFeatures.spellSlotsByLevel[K()]||(z.classFeatures.spellSlotsByLevel[K()]=Array(_e()).fill(!1)),z.classFeatures.spellSlotsByLevel[K()][W]=g.detail.checked,z))}}})}}),l(ue),l(I),U(()=>C(J,`${K()===1?"1st":K()===2?"2nd":K()===3?"3rd":`${K()}th`} Level Spell Slots`)),c(Oe,I)}),l(fe),c(ae,fe)};S(Be,ae=>{e(ee),r(()=>e(ee).length>0)&&ae(Ge)})}var Ke=s(Be,2),Pe=s(i(Ke),2);Qt(Pe),l(Ke),l(w),U(ae=>{C(d,`Spellcasting (${ae??""})`),C(X,e(ke)),C(Se,e(be))},[()=>(e(y),r(()=>e(y).spellcastingAbility?.toUpperCase()))]),Fe(Pe,()=>t().classFeatures.preparedSpells,ae=>st(Z,r(t).classFeatures.preparedSpells=ae,r(t))),c(E,w)};S(qe,E=>{e(y),r(()=>e(y)?.spellcaster)&&E(Ze)})}var tt=s(qe,2);nt(tt,1,()=>e(ye),ct,(E,w)=>{const F=at(()=>(e(w),r(()=>e(w).name.replace(/\s+/g,"")))),d=at(()=>(t(),N(e(F)),r(()=>t().classFeatures.features[e(F)]))),He=at(()=>typeof e(d)=="number");var le=Wl(),B=i(le),X=i(B);{var x=ae=>{var fe=ft("Channel Divinity:");c(ae,fe)};S(X,ae=>{e(w),r(()=>e(w).type==="channelDivinity")&&ae(x)})}var Le=s(X);l(B);var Se=s(B,2),Be=i(Se,!0);l(Se);var Ge=s(Se,2);{var Ke=ae=>{const fe=at(()=>(e(w),r(()=>we(e(w))))),Oe=at(()=>(N(e(d)),N(e(fe)),r(()=>Array.isArray(e(d))?e(d):Array(e(fe)).fill(!1))));var We=Nl(),K=i(We);{var _e=I=>{var O=Hl();c(I,O)},b=I=>{var O=Ul(),J=Ve(O);nt(J,5,()=>e(Oe),ct,(z,_,$)=>{Ta(z,{get checked(){return e(_)},index:$,$$events:{change:Re=>{Z.update(Qe=>(Qe.classFeatures.features[e(F)]||(Qe.classFeatures.features[e(F)]=Array(e(fe)).fill(!1)),Qe.classFeatures.features[e(F)][$]=Re.detail.checked,Qe))}}})}),l(J);var ue=s(J,2),Ae=i(ue),q=i(Ae);l(Ae),l(ue);var W=s(ue,2),Ie=i(W),g=i(Ie);l(Ie),l(W),U(z=>{Ae.disabled=z,C(q,`Use ${e(w),r(()=>e(w).name)??""}`),C(g,`Resets on ${e(w),r(()=>e(w).resetOn==="short"?"Short Rest":"Long Rest")??""}`)},[()=>(N(e(Oe)),r(()=>e(Oe).filter(z=>!z).length<=0))]),j("click",Ae,()=>{Z.update(z=>{z.classFeatures.features[e(F)]||(z.classFeatures.features[e(F)]=Array(e(fe)).fill(!1));const _=z.classFeatures.features[e(F)],$=_.findIndex(Re=>!Re);return $!==-1&&(_[$]=!0),z})}),c(I,O)};S(K,I=>{e(fe)===1/0?I(_e):I(b,!1)})}l(We),c(ae,We)},Pe=ae=>{var fe=it(),Oe=Ve(fe);{var We=_e=>{const b=at(()=>(e(w),r(()=>he(e(w)))));var I=Gl(),O=i(I);$e(O);var J=s(O,2),ue=i(J);l(J);var Ae=s(J,2),q=i(Ae,!0);l(Ae),l(I),U(()=>{ja(O,e(He)&&e(d)!==void 0?e(d):e(b)),et(O,"max",e(b)),C(ue,`/ ${e(b)??""}`),C(q,(e(w),r(()=>e(w).resetOn==="short"?"Short Rest":"Long Rest")))}),j("input",O,W=>{Z.update(Ie=>(Ie.classFeatures.features[e(F)]=parseInt(W.currentTarget.value)||0,Ie))}),j("click",Ae,()=>ge(e(F),e(b))),c(_e,I)},K=_e=>{var b=it(),I=Ve(b);{var O=J=>{var ue=ql(),Ae=i(ue),q=s(Ae,2),W=i(q),Ie=i(W);l(W),l(q);var g=s(q,2);{var z=_=>{var $=Ol();c(_,$)};S(g,_=>{e(G)<=0&&_(z)})}l(ue),U(()=>{Ae.disabled=e(G)<=0,C(Ie,`Resets on ${e(w),r(()=>e(w).resetOn==="short"?"Short Rest":"Long Rest")??""}`)}),j("click",Ae,V),c(J,ue)};S(I,J=>{e(w),r(()=>e(w).type==="channelDivinity")&&J(O)},!0)}c(_e,b)};S(Oe,_e=>{e(w),r(()=>e(w).type==="pool")?_e(We):_e(K,!1)},!0)}c(ae,fe)};S(Ge,ae=>{e(w),r(()=>e(w).type==="uses")?ae(Ke):ae(Pe,!1)})}l(le),U(ae=>{C(Le,` ${e(w),r(()=>e(w).name)??""}`),C(Be,ae)},[()=>(e(w),r(()=>Q(e(w))))]),c(E,le)}),l(Ne),c(je,Ne)};S(A,je=>{e(P),r(()=>e(P).length===0)?je(te):je(Me,!1)},!0)}c(L,Y)};S(pe,L=>{t(),r(()=>!t().class)?L(Ee):L(m,!1)})}c(f,H)};S(se,f=>{h(),r(()=>!h().classFeatures)&&f(xe)})}l(me),U(()=>{ne=ot(me,1,"class-features svelte-1kpvv0n",null,ne,{hidden:!e(ie)}),et(D,"aria-label",(h(),r(()=>h().classFeatures?"Expand":"Collapse"))),C(de,(h(),r(()=>h().classFeatures?"â–¼":"â–²")))}),j("click",D,ve),c(a,me),St(),M()}var Jl=p('<textarea placeholder="Enter features, traits, and special abilities..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Equipment</h3> <textarea placeholder="List your equipment and inventory..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Notes</h3> <textarea placeholder="Additional notes..." class="svelte-wttn0l"></textarea>',1),Ql=p('<section><div class="header svelte-wttn0l"><h2 class="svelte-wttn0l">Features & Traits</h2> <button class="collapse-btn svelte-wttn0l"> </button></div> <!></section>');function Yl(a,n){xt(n,!1);const t=()=>Je(Bt,"$searchFilter",h),v=()=>Je(Z,"$character",h),u=()=>Je(bt,"$collapsedStates",h),[h,k]=Ct(),M=R();function y(){bt.update(be=>({...be,notes:!be.notes}))}Xe(()=>(t(),v()),()=>{o(M,!t()||"features".includes(t().toLowerCase())||"traits".includes(t().toLowerCase())||"equipment".includes(t().toLowerCase())||"notes".includes(t().toLowerCase())||v().features.toLowerCase().includes(t().toLowerCase())||v().equipment.toLowerCase().includes(t().toLowerCase())||v().notes.toLowerCase().includes(t().toLowerCase()))}),Mt(),kt();var P=Ql();let ce;var ee=i(P),G=s(i(ee),2),ye=i(G,!0);l(G),l(ee);var ie=s(ee,2);{var ke=be=>{var ge=Jl(),T=Ve(ge);Qt(T);var we=s(T,4);Qt(we);var Ce=s(we,4);Qt(Ce),Fe(T,()=>v().features,he=>st(Z,r(v).features=he,r(v))),Fe(we,()=>v().equipment,he=>st(Z,r(v).equipment=he,r(v))),Fe(Ce,()=>v().notes,he=>st(Z,r(v).notes=he,r(v))),c(be,ge)};S(ie,be=>{u(),r(()=>!u().notes)&&be(ke)})}l(P),U(()=>{ce=ot(P,1,"notes svelte-wttn0l",null,ce,{hidden:!e(M)}),et(G,"aria-label",(u(),r(()=>u().notes?"Expand":"Collapse"))),C(ye,(u(),r(()=>u().notes?"â–¼":"â–²")))}),j("click",G,y),c(a,P),St(),k()}var Xl=p('<div class="color-picker-section svelte-1r90jgp"><h3 class="svelte-1r90jgp">Dice Colors</h3> <div class="color-inputs svelte-1r90jgp"><div class="color-input-group svelte-1r90jgp"><label for="dice-color" class="svelte-1r90jgp">Dice Color</label> <input type="color" id="dice-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="label-color" class="svelte-1r90jgp">Label Color</label> <input type="color" id="label-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="desk-color" class="svelte-1r90jgp">Background Color</label> <input type="color" id="desk-color" class="svelte-1r90jgp"/></div></div></div>'),Zl=p('<div class="loading svelte-1r90jgp"><p class="svelte-1r90jgp">Loading 3D dice...</p></div>'),ei=p('<div class="custom-dice-selector svelte-1r90jgp"><h3 class="svelte-1r90jgp">Choose Dice to Roll</h3> <div class="dice-inputs svelte-1r90jgp"><div class="dice-input-group svelte-1r90jgp"><label for="d4" class="svelte-1r90jgp">d4</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d4" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d6" class="svelte-1r90jgp">d6</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d6" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d8" class="svelte-1r90jgp">d8</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d8" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d10" class="svelte-1r90jgp">d10</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d10" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d12" class="svelte-1r90jgp">d12</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d12" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d20" class="svelte-1r90jgp">d20</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d20" min="0" max="10"/></div></div> <div class="dice-controls svelte-1r90jgp"><button class="btn btn-primary use-enabled svelte-1r90jgp"> </button> <button class="btn btn-secondary use-enabled svelte-1r90jgp">Reset</button></div></div>'),ti=p('<span class="crit-badge svelte-1r90jgp">CRITICAL!</span>'),ai=p('<p class="svelte-1r90jgp"> </p>'),si=p('<p class="modifier-text svelte-1r90jgp"> </p>'),li=p('<button class="btn btn-follow-up svelte-1r90jgp"> </button>'),ii=p('<button class="btn btn-guided-strike svelte-1r90jgp">âš¡ Use Guided Strike (+10)</button>'),ri=p('<div class="follow-up-actions svelte-1r90jgp"><!> <!></div>'),ni=p('<div class="result-header svelte-1r90jgp"><h3 class="svelte-1r90jgp"> </h3> <!></div> <div class="result-total svelte-1r90jgp"> </div> <div class="result-details svelte-1r90jgp"><!> <!></div> <!>',1),oi=p('<div role="button" tabindex="-1"><div class="modal-content svelte-1r90jgp" role="dialog" tabindex="0"><div class="modal-header svelte-1r90jgp"><h2 class="svelte-1r90jgp">Dice Roller</h2> <div class="header-buttons svelte-1r90jgp"><button class="color-btn svelte-1r90jgp" title="Customize dice colors">ðŸŽ¨</button> <button class="close-btn svelte-1r90jgp">Ã—</button></div></div> <!> <!> <div class="dice-main-area svelte-1r90jgp"><div class="dice-container svelte-1r90jgp"></div> <!></div> <div><!></div></div></div>');function ci(a,n){xt(n,!1);const t=()=>Je(Z,"$character",v),[v,u]=Ct(),h=R(),k=R(),M=R(),y=Ht();let P=_t(n,"notation",12,""),ce=_t(n,"visible",8,!1),ee=_t(n,"damageNotation",12,""),G=_t(n,"attackName",12,""),ye=_t(n,"applyHalfDamage",8,!1),ie=null,ke=R(void 0),be=R(!1),ge=R(""),T=R(null);function we(){return e(T)?.resultTotal??null}let Ce=R(0),he=R(0),Q=R(0),V=R(0),ve=R(0),me=R(0),ne=R(0),Ue=R([]),D=R(!1),de=R("other"),se=R(!1),xe=R("#051e0a"),f=R("#ffffff"),H=R("#3a2004"),pe=R(!1);function Ee(b){return b.length===9&&b.startsWith("#")?b.substring(0,7):b}function m(b,I="ff"){return b.length===7&&b.startsWith("#")?b+I:b}function L(){if(window.DICE&&e(ke))try{ie&&e(ke)&&Wa(ke,e(ke).innerHTML="");const b=e(ke).clientWidth||500,I=e(ke).clientHeight||300;ie=new window.DICE.dice_box(e(ke),{w:b,h:I}),o(be,!0)}catch(b){console.error("Error initializing dice box:",b)}}ea(()=>{const b=J=>new Promise((ue,Ae)=>{if(document.querySelector(`script[src="${J}"]`)){console.log(`Script already loaded: ${J}`),ue(null);return}const W=document.createElement("script");W.src=J,W.onload=()=>{console.log(`Loaded: ${J}`),ue(null)},W.onerror=()=>{console.error(`Failed to load: ${J}`),Ae(new Error(`Failed to load ${J}`))},document.head.appendChild(W)});setTimeout(()=>{b(`${Jt}/libs/three.min.js`).then(()=>b(`${Jt}/libs/cannon.min.js`)).then(()=>b(`${Jt}/libs/teal.js`)).then(()=>b(`${Jt}/dice.js`)).then(()=>{if(console.log("All scripts loaded, initializing dice box..."),console.log("DICE available:",!!window.DICE),console.log("Container available:",!!e(ke)),window.DICE){const J=window.DICE.getColors();o(xe,Ee(J.dice_color)),o(f,Ee(J.label_color)),o(H,Ee(J.desk_color))}L()}).catch(J=>{console.error("Failed to load dice libraries:",J)})},100);const I=()=>{e(be)&&(console.log("Window resized, reinitializing dice box..."),L())},O=J=>{ce()&&J.key==="Escape"&&tt()};return window.addEventListener("resize",I),window.addEventListener("keydown",O),()=>{window.removeEventListener("resize",I),window.removeEventListener("keydown",O)}});function Y(b,I="other"){if(!ie||!e(be))return;console.log("Rolling dice:",b,"type:",I),o(de,I),o(se,!1),ie.diceToRoll=b;const O=ue=>(console.log("Before roll:",ue),null),J=ue=>{console.log("After roll:",ue);let Ae=ue.resultTotal,q=ue.resultString;if(ye()&&(Ae=Math.floor(Ae/2),q=q+" (halved)"),o(T,{...ue,resultTotal:Ae,resultString:q}),I==="attack"||I==="check"||I==="save"){const W=ue.results?.filter(Ie=>Ie.sides===20)||[];if(W.length>0){const Ie=W[0].value;o(D,Ie===20)}}if(o(Ue,[]),I==="attack"&&ee())if(e(D)){const W=Me(ee());e(Ue).push({label:`Roll Critical Damage (${W})`,notation:W})}else e(Ue).push({label:`Roll Damage (${ee()})`,notation:ee()})};ie.start_throw(O,J)}function A(){const b=[];e(Ce)>0&&b.push(`${e(Ce)}d4`),e(he)>0&&b.push(`${e(he)}d6`),e(Q)>0&&b.push(`${e(Q)}d8`),e(V)>0&&b.push(`${e(V)}d10`),e(ve)>0&&b.push(`${e(ve)}d12`),e(me)>0&&b.push(`${e(me)}d20`);let I=b.join("+")||"1d20";return e(ne)!==0&&(I+=e(ne)>=0?`+${e(ne)}`:`${e(ne)}`),I}function te(){const b=A();Y(b)}function Me(b){return b.replace(/(\d+)d(\d+)/g,(I,O,J)=>`${parseInt(O)*2}d${J}`)}function je(){o(Ce,0),o(he,0),o(Q,0),o(V,0),o(ve,0),o(me,0),o(ne,0),o(T,null),o(Ue,[]),o(D,!1),o(de,"other"),o(se,!1)}function Ne(){window.DICE&&(window.DICE.setColors({dice_color:m(e(xe),"ff"),label_color:m(e(f),"ff"),desk_color:e(H)}),ie&&(ie.updateDeskColor(e(H)),ie.updateDiceColors()))}function qe(){o(pe,!e(pe))}function Ze(){!e(T)||e(k)<=0||e(se)||(o(T,{...e(T),resultTotal:e(T).resultTotal+10,resultString:e(T).resultString+" + 10 (Guided Strike)"}),Z.update(b=>{const I="ChannelDivinity",O=b.classFeatures.features[I];return typeof O=="number"&&O>0&&(b.classFeatures.features[I]=O-1),b}),o(se,!0))}function tt(){y("close"),P(""),ee(""),G(""),o(ge,""),o(T,null),o(se,!1),je()}Xe(()=>(t(),qt),()=>{o(h,t().class?qt(t().class,t().level,t().subclass).some(I=>I.name==="Guided Strike"):!1)}),Xe(()=>t(),()=>{o(k,(()=>{const I=t().classFeatures.features["ChannelDivinity"];return typeof I=="number"?I:0})())}),Xe(()=>(e(Ce),e(he),e(Q),e(V),e(ve),e(me),e(ne)),()=>{o(M,(()=>{const b=[];e(Ce)>0&&b.push(`${e(Ce)}d4`),e(he)>0&&b.push(`${e(he)}d6`),e(Q)>0&&b.push(`${e(Q)}d8`),e(V)>0&&b.push(`${e(V)}d10`),e(ve)>0&&b.push(`${e(ve)}d12`),e(me)>0&&b.push(`${e(me)}d20`);let I=b.join("+")||"1d20";return e(ne)!==0&&(I+=e(ne)>=0?`+${e(ne)}`:`${e(ne)}`),I})())}),Xe(()=>(N(P()),e(be),N(ce()),e(ge),N(ee()),N(G())),()=>{if(P()&&e(be)&&ce()&&P()!==e(ge)){o(ge,P()),o(T,null),o(Ue,[]),o(D,!1),o(se,!1);const b=P().includes("1d20")?"attack":"other";console.log("Auto-roll triggered. notation:",P(),"damageNotation:",ee(),"attackName:",G()),setTimeout(()=>Y(P(),b),200)}}),Mt();var E={getLastRollTotal:we};kt();var w=oi();let F;var d=i(w),He=i(d),le=s(i(He),2),B=i(le),X=s(B,2);l(le),l(He);var x=s(He,2);{var Le=b=>{var I=Xl(),O=s(i(I),2),J=i(O),ue=s(i(J),2);$e(ue),l(J);var Ae=s(J,2),q=s(i(Ae),2);$e(q),l(Ae);var W=s(Ae,2),Ie=s(i(W),2);$e(Ie),l(W),l(O),l(I),Fe(ue,()=>e(xe),g=>o(xe,g)),j("change",ue,Ne),Fe(q,()=>e(f),g=>o(f,g)),j("change",q,Ne),Fe(Ie,()=>e(H),g=>o(H,g)),j("change",Ie,Ne),c(b,I)};S(x,b=>{e(pe)&&b(Le)})}var Se=s(x,2);{var Be=b=>{var I=Zl();c(b,I)};S(Se,b=>{e(be)||b(Be)})}var Ge=s(Se,2),Ke=i(Ge);$a(Ke,b=>o(ke,b),()=>e(ke));var Pe=s(Ke,2);{var ae=b=>{var I=ei(),O=s(i(I),2),J=i(O),ue=s(i(J),2);$e(ue),l(J);var Ae=s(J,2),q=s(i(Ae),2);$e(q),l(Ae);var W=s(Ae,2),Ie=s(i(W),2);$e(Ie),l(W);var g=s(W,2),z=s(i(g),2);$e(z),l(g);var _=s(g,2),$=s(i(_),2);$e($),l(_);var Re=s(_,2),Qe=s(i(Re),2);$e(Qe),l(Re),l(O);var ze=s(O,2),Te=i(ze),oe=i(Te);l(Te);var re=s(Te,2);l(ze),l(I),U(()=>{Te.disabled=!e(be),C(oe,`Roll ${e(M)??""}`)}),Fe(ue,()=>e(Ce),De=>o(Ce,De)),Fe(q,()=>e(he),De=>o(he,De)),Fe(Ie,()=>e(Q),De=>o(Q,De)),Fe(z,()=>e(V),De=>o(V,De)),Fe($,()=>e(ve),De=>o(ve,De)),Fe(Qe,()=>e(me),De=>o(me,De)),j("click",Te,te),j("click",re,je),c(b,I)};S(Pe,b=>{P()||b(ae)})}l(Ge);var fe=s(Ge,2);let Oe;var We=i(fe);{var K=b=>{var I=ni(),O=Ve(I),J=i(O),ue=i(J,!0);l(J);var Ae=s(J,2);{var q=Te=>{var oe=ti();c(Te,oe)};S(Ae,Te=>{e(D)&&Te(q)})}l(O);var W=s(O,2),Ie=i(W,!0);l(W);var g=s(W,2),z=i(g);{var _=Te=>{var oe=ai(),re=i(oe,!0);l(oe),U(()=>C(re,(e(T),r(()=>e(T).resultString)))),c(Te,oe)};S(z,Te=>{e(T),r(()=>e(T).resultString)&&Te(_)})}var $=s(z,2);{var Re=Te=>{var oe=si(),re=i(oe);l(oe),U(()=>C(re,`Modifier: ${e(T),r(()=>e(T).constant>=0?"+":"")??""}${e(T),r(()=>e(T).constant)??""}`)),c(Te,oe)};S($,Te=>{e(T),r(()=>e(T).constant)&&Te(Re)})}l(g);var Qe=s(g,2);{var ze=Te=>{var oe=ri(),re=i(oe);nt(re,1,()=>e(Ue),ct,(wt,dt)=>{var It=li(),pa=i(It,!0);l(It),U(()=>C(pa,(e(dt),r(()=>e(dt).label)))),j("click",It,()=>Y(e(dt).notation,"damage")),c(wt,It)});var De=s(re,2);{var Pt=wt=>{var dt=ii();U(()=>{dt.disabled=e(k)<=0,et(dt,"title",e(k)<=0?"No Channel Divinity uses remaining":"Use Channel Divinity to add +10 to this attack roll")}),j("click",dt,Ze),c(wt,dt)};S(De,wt=>{e(h)&&e(de)==="attack"&&!e(se)&&wt(Pt)})}l(oe),c(Te,oe)};S(Qe,Te=>{e(Ue),e(h),e(de),e(se),r(()=>e(Ue).length>0||e(h)&&e(de)==="attack"&&!e(se))&&Te(ze)})}U(()=>{C(ue,G()?`${G()} - Result`:"Result"),C(Ie,(e(T),r(()=>e(T).resultTotal)))}),c(b,I)};S(We,b=>{e(T)&&b(K)})}l(fe),l(d),l(w),U(()=>{F=ot(w,1,"modal-overlay svelte-1r90jgp",null,F,{hidden:!ce()}),Oe=ot(fe,1,"roll-result svelte-1r90jgp",null,Oe,{"has-result":e(T)})}),j("click",B,qe),j("click",X,tt),j("click",d,Fa(function(b){Ot.call(this,n,b)})),j("keydown",d,function(b){Ot.call(this,n,b)}),j("click",w,tt),j("keydown",w,b=>b.key==="Escape"&&tt()),c(a,w),$s(n,"getLastRollTotal",we);var _e=St(E);return u(),_e}const ua="https://api.github.com/gists";async function vi(a,n,t){if(!n)throw new Error("GitHub token is required");const v=JSON.stringify(a,null,2),u=`${a.name||"character"}_dnd.json`,h={description:t||`D&D Character: ${a.name}`,public:!1,files:{[u]:{content:v}}},k=await fetch(ua,{method:"POST",headers:{Authorization:`token ${n}`,"Content-Type":"application/json"},body:JSON.stringify(h)});if(!k.ok)throw new Error(`Failed to create gist: ${k.statusText}`);return(await k.json()).id}async function di(a,n,t){if(!n||!t)throw new Error("GitHub token and Gist ID are required");const v=JSON.stringify(a,null,2),h={files:{[`${a.name||"character"}_dnd.json`]:{content:v}}},k=await fetch(`${ua}/${t}`,{method:"PATCH",headers:{Authorization:`token ${n}`,"Content-Type":"application/json"},body:JSON.stringify(h)});if(!k.ok)throw new Error(`Failed to update gist: ${k.statusText}`)}async function ui(a,n){if(!a)throw new Error("Gist ID is required");const t={"Content-Type":"application/json"};n&&(t.Authorization=`token ${n}`);const v=await fetch(`${ua}/${a}`,{method:"GET",headers:t});if(!v.ok)throw new Error(`Failed to load gist: ${v.statusText}`);const u=await v.json(),h=Object.values(u.files);if(h.length===0)throw new Error("No files found in gist");const M=h[0].content;try{const y=JSON.parse(M);return y.attacks&&Array.isArray(y.attacks)&&(y.attacks=y.attacks.map(P=>({...P,id:P.id||crypto.randomUUID()}))),y.classFeatures?(y.classFeatures.features||(y.classFeatures.features={}),y.classFeatures.spellSlots||(y.classFeatures.spellSlots=[]),y.classFeatures.preparedSpells===void 0&&(y.classFeatures.preparedSpells="")):y.classFeatures={features:{},spellSlots:[],preparedSpells:""},y}catch{throw new Error("Invalid character data in gist")}}function Ha(a){typeof window<"u"&&localStorage.setItem("dnd_gist_config",JSON.stringify(a))}function pi(){if(typeof window<"u"){const a=localStorage.getItem("dnd_gist_config");if(a)return JSON.parse(a)}return{}}async function fi(a,n=30){if(!a)throw new Error("GitHub token is required to list gists");const t=await fetch(`${ua}?per_page=${n}`,{method:"GET",headers:{Authorization:`token ${a}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error(`Failed to list gists: ${t.statusText}`);return await t.json()}var bi=p('<div class="error-message svelte-1jb5ckg"> </div>'),gi=p('<div class="toggle-container svelte-1jb5ckg"><button type="button" class="toggle-btn svelte-1jb5ckg"> </button></div>'),hi=p('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID (leave empty to create new)</label> <input type="text" id="gistId" placeholder="Optional: existing Gist ID to update" class="svelte-1jb5ckg"/></div>'),mi=p('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),_i=p('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),yi=p('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Update (or leave unselected to create new)</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),ki=p('<div class="info-message svelte-1jb5ckg">No gists found. A new one will be created.</div>'),xi=p('<!> <div class="form-group svelte-1jb5ckg"><label for="description" class="svelte-1jb5ckg"> </label> <input type="text" id="description" placeholder="D&amp;D Character Sheet" class="svelte-1jb5ckg"/></div>',1),Si=p('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID *</label> <input type="text" id="gistId" placeholder="Enter Gist ID (for public or your private gists)" required class="svelte-1jb5ckg"/></div>'),$i=p('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),Ci=p('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),Li=p('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Load</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),Di=p('<div class="info-message svelte-1jb5ckg">No gists found. Enter a Gist ID manually or create a new one in Save mode.</div>'),wi=p('<div class="modal-overlay svelte-1jb5ckg" role="button" tabindex="-1"><div class="modal-content svelte-1jb5ckg" role="dialog" tabindex="0"><div class="modal-header svelte-1jb5ckg"><h2 class="svelte-1jb5ckg"> </h2> <button class="close-btn svelte-1jb5ckg">Ã—</button></div> <div class="modal-body svelte-1jb5ckg"><!> <div class="form-group svelte-1jb5ckg"><label for="token" class="svelte-1jb5ckg"> <a href="https://github.com/settings/tokens" target="_blank" rel="noopener" class="svelte-1jb5ckg">Get token</a></label> <input type="password" id="token" placeholder="ghp_xxxxxxxxxxxxx" class="svelte-1jb5ckg"/></div> <!> <!> <div class="modal-actions svelte-1jb5ckg"><button class="btn btn-primary svelte-1jb5ckg"><!></button> <button class="btn btn-secondary svelte-1jb5ckg">Cancel</button></div></div></div></div>');function ji(a,n){xt(n,!1);const t=()=>Je(Z,"$character",v),[v,u]=Ct(),h=Ht();let k=_t(n,"mode",8,"save"),M=R(""),y=R(""),P=R(""),ce=R(!1),ee=R(""),G=R(!1),ye=R(!1),ie=R([]),ke=R(null);const be=pi();be.token&&o(M,be.token),be.gistId&&o(y,be.gistId),ea(async()=>{e(M)&&!e(G)&&await ge()});async function ge(){if(e(M)){o(ye,!0),o(ee,"");try{o(ie,await fi(e(M))),e(y)&&o(ke,e(ie).find(E=>E.id===e(y))||null)}catch(E){o(ee,E.message||"Failed to load gists"),o(ie,[])}finally{o(ye,!1)}}}function T(E){o(ke,E),o(y,E.id)}function we(){o(G,!e(G)),o(ee,""),!e(G)&&e(M)&&ge()}async function Ce(){if(!e(M)){o(ee,"GitHub token is required");return}const E=e(ke)?.id||e(y);o(ce,!0),o(ee,"");try{if(E)await di(t(),e(M),E),o(y,E),Xt.add("Character updated in Gist successfully!","success");else{const w=await vi(t(),e(M),e(P));o(y,w),Xt.add(`Character saved to Gist! ID: ${w}`,"success")}Ha({token:e(M),gistId:e(y)}),h("close")}catch(w){o(ee,w.message||"Failed to save to Gist")}finally{o(ce,!1)}}async function he(){const E=e(ke)?.id||e(y);if(!E){o(ee,"Please select a gist or enter a Gist ID");return}o(ce,!0),o(ee,"");try{const w=await ui(E,e(M)||void 0);Z.set(w),o(y,E),Ha({token:e(M),gistId:e(y)}),Xt.add("Character loaded from Gist successfully!","success"),h("close")}catch(w){o(ee,w.message||"Failed to load from Gist")}finally{o(ce,!1)}}function Q(){h("close")}kt();var V=wi(),ve=i(V),me=i(ve),ne=i(me),Ue=i(ne,!0);l(ne);var D=s(ne,2);l(me);var de=s(me,2),se=i(de);{var xe=E=>{var w=bi(),F=i(w,!0);l(w),U(()=>C(F,e(ee))),c(E,w)};S(se,E=>{e(ee)&&E(xe)})}var f=s(se,2),H=i(f),pe=i(H);za(),l(H);var Ee=s(H,2);$e(Ee),l(f);var m=s(f,2);{var L=E=>{var w=gi(),F=i(w),d=i(F,!0);l(F),l(w),U(()=>{F.disabled=e(ce),C(d,e(G)?"ðŸ“‹ Show My Gists":"âœï¸ Enter Gist ID Manually")}),j("click",F,we),c(E,w)};S(m,E=>{(k()==="load"||k()==="save"&&e(M))&&E(L)})}var Y=s(m,2);{var A=E=>{var w=xi(),F=Ve(w);{var d=Le=>{var Se=hi(),Be=s(i(Se),2);$e(Be),l(Se),U(()=>Be.disabled=e(ce)),Fe(Be,()=>e(y),Ge=>o(y,Ge)),c(Le,Se)},He=Le=>{var Se=it(),Be=Ve(Se);{var Ge=Pe=>{var ae=mi();c(Pe,ae)},Ke=Pe=>{var ae=it(),fe=Ve(ae);{var Oe=K=>{var _e=yi(),b=s(i(_e),2);nt(b,5,()=>e(ie),ct,(I,O)=>{var J=_i();let ue;var Ae=i(J),q=i(Ae),W=i(q,!0);l(q);var Ie=s(q,2),g=i(Ie,!0);l(Ie),l(Ae);var z=s(Ae,2),_=i(z),$=i(_);l(_);var Re=s(_,2),Qe=i(Re);l(Re),l(z),l(J),U(ze=>{ue=ot(J,1,"gist-item svelte-1jb5ckg",null,ue,{selected:e(ke)?.id===e(O).id}),J.disabled=e(ce),C(W,(e(O),r(()=>e(O).description||"Untitled"))),C(g,(e(O),r(()=>e(O).public?"ðŸŒ Public":"ðŸ”’ Private"))),C($,`ID: ${e(O),r(()=>e(O).id)??""}`),C(Qe,`Updated: ${ze??""}`)},[()=>(e(O),r(()=>new Date(e(O).updated_at).toLocaleDateString()))]),j("click",J,()=>T(e(O))),c(I,J)}),l(b),l(_e),c(K,_e)},We=K=>{var _e=it(),b=Ve(_e);{var I=O=>{var J=ki();c(O,J)};S(b,O=>{e(M)&&O(I)},!0)}c(K,_e)};S(fe,K=>{e(ie),r(()=>e(ie).length>0)?K(Oe):K(We,!1)},!0)}c(Pe,ae)};S(Be,Pe=>{e(ye)?Pe(Ge):Pe(Ke,!1)},!0)}c(Le,Se)};S(F,Le=>{e(G)||!e(M)?Le(d):Le(He,!1)})}var le=s(F,2),B=i(le),X=i(B);l(B);var x=s(B,2);$e(x),l(le),U(()=>{C(X,`Description ${e(y)?"(optional)":""}`),x.disabled=e(ce)}),Fe(x,()=>e(P),Le=>o(P,Le)),c(E,w)},te=E=>{var w=it(),F=Ve(w);{var d=le=>{var B=Si(),X=s(i(B),2);$e(X),l(B),U(()=>X.disabled=e(ce)),Fe(X,()=>e(y),x=>o(y,x)),c(le,B)},He=le=>{var B=it(),X=Ve(B);{var x=Se=>{var Be=$i();c(Se,Be)},Le=Se=>{var Be=it(),Ge=Ve(Be);{var Ke=ae=>{var fe=Li(),Oe=s(i(fe),2);nt(Oe,5,()=>e(ie),ct,(We,K)=>{var _e=Ci();let b;var I=i(_e),O=i(I),J=i(O,!0);l(O);var ue=s(O,2),Ae=i(ue,!0);l(ue),l(I);var q=s(I,2),W=i(q),Ie=i(W);l(W);var g=s(W,2),z=i(g);l(g),l(q),l(_e),U(_=>{b=ot(_e,1,"gist-item svelte-1jb5ckg",null,b,{selected:e(ke)?.id===e(K).id}),_e.disabled=e(ce),C(J,(e(K),r(()=>e(K).description||"Untitled"))),C(Ae,(e(K),r(()=>e(K).public?"ðŸŒ Public":"ðŸ”’ Private"))),C(Ie,`ID: ${e(K),r(()=>e(K).id)??""}`),C(z,`Updated: ${_??""}`)},[()=>(e(K),r(()=>new Date(e(K).updated_at).toLocaleDateString()))]),j("click",_e,()=>T(e(K))),c(We,_e)}),l(Oe),l(fe),c(ae,fe)},Pe=ae=>{var fe=it(),Oe=Ve(fe);{var We=K=>{var _e=Di();c(K,_e)};S(Oe,K=>{e(M)&&K(We)},!0)}c(ae,fe)};S(Ge,ae=>{e(ie),r(()=>e(ie).length>0)?ae(Ke):ae(Pe,!1)},!0)}c(Se,Be)};S(X,Se=>{e(ye)?Se(x):Se(Le,!1)},!0)}c(le,B)};S(F,le=>{e(G)||!e(M)?le(d):le(He,!1)})}c(E,w)};S(Y,E=>{k()==="save"?E(A):E(te,!1)})}var Me=s(Y,2),je=i(Me),Ne=i(je);{var qe=E=>{var w=ft();U(()=>C(w,k()==="save"?"Saving...":"Loading...")),c(E,w)},Ze=E=>{var w=ft();U(()=>C(w,k()==="save"?"Save":"Load")),c(E,w)};S(Ne,E=>{e(ce)?E(qe):E(Ze,!1)})}l(je);var tt=s(je,2);l(Me),l(de),l(ve),l(V),U(()=>{C(Ue,k()==="save"?"Save to GitHub Gist":"Load from GitHub Gist"),C(pe,`GitHub Token ${k()==="load"?"(optional for public gists)":"(required)"} `),Ee.disabled=e(ce),je.disabled=e(ce),tt.disabled=e(ce)}),j("click",D,Q),Fe(Ee,()=>e(M),E=>o(M,E)),j("blur",Ee,()=>{e(M)&&!e(G)&&ge()}),j("click",je,function(...E){(k()==="save"?Ce:he)?.apply(this,E)}),j("click",tt,Q),j("click",ve,Fa(function(E){Ot.call(this,n,E)})),j("keydown",ve,function(E){Ot.call(this,n,E)}),j("click",V,Q),j("keydown",V,E=>E.key==="Escape"&&Q()),c(a,V),St(),u()}var Ai=p('<div class="loading svelte-1ngjemu">Loading D&D data...</div>'),Fi=p("<option> </option>"),Mi=p('<select class="level-filter svelte-1ngjemu"><option>All Levels</option><option>Cantrip</option><!></select>'),Ii=p('<div class="no-results svelte-1ngjemu"> </div>'),Ri=p('<div class="item-meta svelte-1ngjemu"> </div>'),Ei=p('<div class="item-meta svelte-1ngjemu"> </div>'),Bi=p('<button><div class="item-name svelte-1ngjemu"> </div> <!></button>'),Pi=p('<p class="higher-levels"><strong>At Higher Levels:</strong> </p>'),Ti=p('<p class="cantrip-upgrade"><strong>Cantrip Upgrade:</strong> </p>'),Hi=p('<h3 class="svelte-1ngjemu"> </h3> <p class="spell-meta svelte-1ngjemu"><!> <!></p> <p class="spell-classes"><strong>Classes:</strong> </p> <div class="spell-stats svelte-1ngjemu"><div><strong>Casting Time:</strong> </div> <div><strong>Range:</strong> </div> <div><strong>Components:</strong> <!></div> <div><strong>Duration:</strong> <!> </div></div> <p class="description svelte-1ngjemu"> </p> <!> <!>',1),Ui=p('<p class="prerequisite svelte-1ngjemu"><strong>Prerequisite:</strong> </p>'),Ni=p('<h3 class="svelte-1ngjemu"> </h3> <!> <p class="description svelte-1ngjemu"> </p> <a target="_blank" rel="noopener" class="source-link svelte-1ngjemu">View Full Details â†’</a>',1),Gi=p('<div class="item-details svelte-1ngjemu"><!></div>'),Oi=p('<div class="controls svelte-1ngjemu"><div class="tabs svelte-1ngjemu"><button> </button> <button> </button></div> <div class="search-controls svelte-1ngjemu"><input type="text" placeholder="Search by name or description..." class="search-input svelte-1ngjemu"/> <!></div></div> <div class="content-container svelte-1ngjemu"><div class="items-list svelte-1ngjemu"><!></div> <!></div>',1),qi=p('<div class="modal-backdrop svelte-1ngjemu" role="presentation"><div class="modal svelte-1ngjemu" role="dialog" aria-modal="true" tabindex="-1"><div class="modal-header svelte-1ngjemu"><h2 class="svelte-1ngjemu">Browse D&D Spells & Feats</h2> <button class="close-btn svelte-1ngjemu" aria-label="Close">&times;</button></div> <div class="modal-body svelte-1ngjemu"><!></div> <div class="modal-footer svelte-1ngjemu"><button class="btn-secondary svelte-1ngjemu">Cancel</button> <button class="btn-primary svelte-1ngjemu">Add to Character Sheet</button></div></div></div>');function Wi(a,n){xt(n,!1);const t=R(),v=R(),u=R();let h=_t(n,"onClose",8),k=R("spell"),M=R(!0),y=R(""),P=R(null),ce=R([]),ee=R([]),G=R(null);ea(async()=>{o(M,!0);try{o(ce,await Qa()),o(ee,await Js())}catch(D){console.error("Failed to load data:",D)}finally{o(M,!1)}});function ye(D){o(G,D)}function ie(D){const de=D.match(/(\d+d\d+(?:\s*\+\s*\d+)?)/i);return de?de[1]:""}function ke(D){const de=D.split(/\.( |$)/)[0].trim(),se=Array.from(D.matchAll(/\*\*(.*?)\*\*/g)).map(f=>f[1].replace(/\.$/,""));let xe=de;return se.length&&(xe+=" | Effects: "+se.join(", ")),xe}function be(){if(e(G)){if(e(k)==="spell"){const D=e(G);Z.update(de=>{const xe=[];D.range&&xe.push(`Range: ${D.range}`),D.castingTime&&xe.push(`Cast: ${D.castingTime}`),D.duration&&xe.push(`Duration: ${D.duration}`),D.actionType==="Save"&&xe.push("Saving throw spell"),D.components&&D.components.length>0&&xe.push(`Components: ${D.components.join(", ")}`),D.material&&xe.push(`Material: ${D.material}`);const f=xe.join(" | "),H=ke(D.description),pe={id:crypto.randomUUID(),name:`${D.name}${D.concentration?" (C)":""}${D.ritual?" (R)":""}`,bonus:D.actionType==="Attack"?5:0,damage:ie(D.description),damageType:`${D.school} (Lvl ${D.level})`,spellRef:D.name,infoNotes:f,generalNotes:H,castAtLevel:D.level};return de.attacks=[...de.attacks,pe],de})}else if(e(k)==="feat"){const D=e(G);Z.update(de=>{const se=`${D.name}${D.prerequisite?` (Req: ${D.prerequisite})`:""}
${D.description}
`;return de.features=de.features?`${de.features}
${se}`:se,de})}o(G,null),h()()}}Xe(()=>(e(P),e(ce),e(y)),()=>{o(t,e(P)!==null?Qs(Ba(e(ce),e(y)),e(P)):Ba(e(ce),e(y)))}),Xe(()=>(e(ee),e(y)),()=>{o(v,Ys(e(ee),e(y)))}),Xe(()=>(e(k),e(t),e(v)),()=>{o(u,e(k)==="spell"?e(t):e(v))}),Mt(),kt();var ge=qi(),T=i(ge),we=i(T),Ce=s(i(we),2);l(we);var he=s(we,2),Q=i(he);{var V=D=>{var de=Ai();c(D,de)},ve=D=>{var de=Oi(),se=Ve(de),xe=i(se),f=i(xe);let H;var pe=i(f);l(f);var Ee=s(f,2);let m;var L=i(Ee);l(Ee),l(xe);var Y=s(xe,2),A=i(Y);$e(A);var te=s(A,2);{var Me=F=>{var d=Mi();U(()=>{e(P),pt(()=>{})});var He=i(d);He.value=(He.__value=null)??"";var le=s(He);le.value=le.__value=0;var B=s(le);nt(B,0,()=>[1,2,3,4,5,6,7,8,9],ct,(X,x)=>{var Le=Fi(),Se=i(Le);l(Le);var Be={};U(()=>{C(Se,`Level ${x??""}`),Be!==(Be=x)&&(Le.value=(Le.__value=x)??"")}),c(X,Le)}),l(d),Va(d,()=>e(P),X=>o(P,X)),c(F,d)};S(te,F=>{e(k)==="spell"&&F(Me)})}l(Y),l(se);var je=s(se,2),Ne=i(je),qe=i(Ne);{var Ze=F=>{var d=Ii(),He=i(d);l(d),U(()=>C(He,`No ${e(k)??""}s found`)),c(F,d)},tt=F=>{var d=it(),He=Ve(d);nt(He,1,()=>e(u),ct,(le,B)=>{var X=Bi();let x;var Le=i(X),Se=i(Le,!0);l(Le);var Be=s(Le,2);{var Ge=Pe=>{const ae=at(()=>e(B));var fe=Ri(),Oe=i(fe);l(fe),U(()=>C(Oe,`Level ${N(e(ae)),r(()=>e(ae).level)??""} â€¢ ${N(e(ae)),r(()=>e(ae).school)??""}`)),c(Pe,fe)},Ke=Pe=>{const ae=at(()=>e(B));var fe=it(),Oe=Ve(fe);{var We=K=>{var _e=Ei(),b=i(_e,!0);l(_e),U(()=>C(b,(N(e(ae)),r(()=>e(ae).prerequisite)))),c(K,_e)};S(Oe,K=>{N(e(ae)),r(()=>e(ae).prerequisite)&&K(We)})}c(Pe,fe)};S(Be,Pe=>{e(k)==="spell"?Pe(Ge):Pe(Ke,!1)})}l(X),U(()=>{x=ot(X,1,"item-card svelte-1ngjemu",null,x,{selected:e(G)?.name===e(B).name}),C(Se,(e(B),r(()=>e(B).name)))}),j("click",X,()=>ye(e(B))),c(le,X)}),c(F,d)};S(qe,F=>{e(u),r(()=>e(u).length===0)?F(Ze):F(tt,!1)})}l(Ne);var E=s(Ne,2);{var w=F=>{var d=Gi(),He=i(d);{var le=X=>{const x=at(()=>e(G));var Le=Hi(),Se=Ve(Le),Be=i(Se,!0);l(Se);var Ge=s(Se,2),Ke=i(Ge);{var Pe=re=>{var De=ft();U(()=>C(De,`${N(e(x)),r(()=>e(x).school)??""} cantrip`)),c(re,De)},ae=re=>{var De=ft();U(()=>C(De,`Level ${N(e(x)),r(()=>e(x).level)??""} ${N(e(x)),r(()=>e(x).school)??""}`)),c(re,De)};S(Ke,re=>{N(e(x)),r(()=>e(x).level===0)?re(Pe):re(ae,!1)})}var fe=s(Ke,2);{var Oe=re=>{var De=ft("(ritual)");c(re,De)};S(fe,re=>{N(e(x)),r(()=>e(x).ritual)&&re(Oe)})}l(Ge);var We=s(Ge,2),K=s(i(We));l(We);var _e=s(We,2),b=i(_e),I=s(i(b));l(b);var O=s(b,2),J=s(i(O));l(O);var ue=s(O,2),Ae=s(i(ue)),q=s(Ae);{var W=re=>{var De=ft();U(()=>C(De,`(${N(e(x)),r(()=>e(x).material)??""})`)),c(re,De)};S(q,re=>{N(e(x)),r(()=>e(x).material)&&re(W)})}l(ue);var Ie=s(ue,2),g=s(i(Ie),2);{var z=re=>{var De=ft("Concentration,");c(re,De)};S(g,re=>{N(e(x)),r(()=>e(x).concentration)&&re(z)})}var _=s(g,1,!0);l(Ie),l(_e);var $=s(_e,2),Re=i($,!0);l($);var Qe=s($,2);{var ze=re=>{var De=Pi(),Pt=s(i(De));l(De),U(()=>C(Pt,` ${N(e(x)),r(()=>e(x).higherLevelSlot)??""}`)),c(re,De)};S(Qe,re=>{N(e(x)),r(()=>e(x).higherLevelSlot)&&re(ze)})}var Te=s(Qe,2);{var oe=re=>{var De=Ti(),Pt=s(i(De));l(De),U(()=>C(Pt,` ${N(e(x)),r(()=>e(x).cantripUpgrade)??""}`)),c(re,De)};S(Te,re=>{N(e(x)),r(()=>e(x).cantripUpgrade)&&re(oe)})}U((re,De)=>{C(Be,(N(e(x)),r(()=>e(x).name))),C(K,` ${re??""}`),C(I,` ${N(e(x)),r(()=>e(x).castingTime||e(x).actionType)??""}`),C(J,` ${N(e(x)),r(()=>e(x).range)??""}`),C(Ae,` ${De??""}`),C(_,(N(e(x)),r(()=>e(x).duration))),C(Re,(N(e(x)),r(()=>e(x).description)))},[()=>(N(e(x)),r(()=>e(x).classes.join(", "))),()=>(N(e(x)),r(()=>e(x).components.join(", ").toUpperCase()))]),c(X,Le)},B=X=>{const x=at(()=>e(G));var Le=Ni(),Se=Ve(Le),Be=i(Se,!0);l(Se);var Ge=s(Se,2);{var Ke=Oe=>{var We=Ui(),K=s(i(We));l(We),U(()=>C(K,` ${N(e(x)),r(()=>e(x).prerequisite)??""}`)),c(Oe,We)};S(Ge,Oe=>{N(e(x)),r(()=>e(x).prerequisite)&&Oe(Ke)})}var Pe=s(Ge,2),ae=i(Pe,!0);l(Pe);var fe=s(Pe,2);U(()=>{C(Be,(N(e(x)),r(()=>e(x).name))),C(ae,(N(e(x)),r(()=>e(x).description))),et(fe,"href",(N(e(x)),r(()=>e(x).source)))}),c(X,Le)};S(He,X=>{e(k)==="spell"?X(le):X(B,!1)})}l(d),c(F,d)};S(E,F=>{e(G)&&F(w)})}l(je),U(()=>{H=ot(f,1,"tab svelte-1ngjemu",null,H,{active:e(k)==="spell"}),C(pe,`ðŸ“œ Spells (${e(ce),r(()=>e(ce).length)??""})`),m=ot(Ee,1,"tab svelte-1ngjemu",null,m,{active:e(k)==="feat"}),C(L,`â­ Feats (${e(ee),r(()=>e(ee).length)??""})`)}),j("click",f,()=>{o(k,"spell"),o(G,null),o(y,"")}),j("click",Ee,()=>{o(k,"feat"),o(G,null),o(y,"")}),Fe(A,()=>e(y),F=>o(y,F)),c(D,de)};S(Q,D=>{e(M)?D(V):D(ve,!1)})}l(he);var me=s(he,2),ne=i(me),Ue=s(ne,2);l(me),l(T),l(ge),U(()=>Ue.disabled=!e(G)),j("click",Ce,function(...D){h()?.apply(this,D)}),j("click",ne,function(...D){h()?.apply(this,D)}),j("click",Ue,be),j("click",T,Fa(function(D){Ot.call(this,n,D)})),j("keydown",T,function(D){Ot.call(this,n,D)}),j("click",ge,function(...D){h()?.apply(this,D)}),j("keydown",ge,D=>D.key==="Escape"&&h()()),c(a,ge),St()}var zi=p('<link rel="icon" type="image/png" href="favicon4.png"/> <meta name="viewport" content="width=device-width, initial-scale=1"/>',1),Ki=p('<span class="character-name svelte-1uha8ag"> </span>'),Vi=p("<span> </span>"),Ji=p('<div class="spell-slots-header svelte-1uha8ag"></div>'),Qi=p('<div class="rest-menu svelte-1uha8ag"><button class="rest-option svelte-1uha8ag">â˜• Short Rest</button> <button class="rest-option svelte-1uha8ag">ðŸ›ï¸ Long Rest</button></div>'),Yi=p('<div class="container svelte-1uha8ag"><header class="svelte-1uha8ag"><div class="header-top svelte-1uha8ag"><div class="header-title svelte-1uha8ag"><div class="title-row svelte-1uha8ag"><h1 class="svelte-1uha8ag">D&D Character Sheet</h1> <!></div> <!></div> <div class="header-right svelte-1uha8ag"><div class="header-controls svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">ðŸŽ²</span><span class="btn-text svelte-1uha8ag">Roll Dice</span></button> <div class="rest-button-container svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">ðŸ˜´</span><span class="btn-text svelte-1uha8ag">Rest</span></button> <!></div> <div class="mode-toggle"><button><span class="btn-icon svelte-1uha8ag"> </span><span class="btn-text svelte-1uha8ag"> </span></button></div></div> <div class="header-search svelte-1uha8ag"><input type="text" placeholder="ðŸ” Search..." class="search-input use-enabled svelte-1uha8ag"/></div></div></div> <div class="header-actions svelte-1uha8ag"><button class="btn btn-mode svelte-1uha8ag">ðŸ“š Browse Spells & Feats</button> <button class="btn btn-secondary">Save to Gist</button> <button class="btn btn-secondary">Load from Gist</button> <button class="btn btn-secondary">Export JSON</button> <button class="btn btn-secondary">Import JSON</button> <input type="file" accept=".json" style="display: none;"/></div></header> <main class="svelte-1uha8ag"><!> <!> <!> <!> <!> <!> <!></main></div> <!> <!> <!> <!>',1);function rr(a,n){xt(n,!1);const t=()=>Je(Z,"$character",h),v=()=>Je(Yt,"$isEditMode",h),u=()=>Je(Bt,"$searchFilter",h),[h,k]=Ct();function M(){const g=[],z=t().classFeatures.spellSlotsByLevel||{};for(let _=1;_<=9;_++){const $=z[_];if($&&$.length>0){const Re=$.length,Qe=$.filter(ze=>ze).length;g.push({level:_,available:Re-Qe,total:Re})}}return g}let y=R(!1),P=R(!1),ce=R(!1),ee=R("save"),G=R(void 0),ye=R(""),ie=R(""),ke=R(""),be=R(!1),ge=R(),T=!1,we=R(!1);function Ce(){const g=[];Z.update(_=>{const $=_.hitDice.current;_.hitDice.current=Math.min(_.hitDice.max,_.hitDice.current+Math.max(1,Math.floor(_.hitDice.max/2)));const Re=_.hitDice.current-$;if(Re>0&&g.push(`${Re} hit ${Re===1?"die":"dice"}`),_.class){const Qe=qt(_.class,_.level,_.subclass);_.classFeatures.features||(_.classFeatures.features={}),Qe.forEach(ze=>{if(ze.resetOn==="short"){const Te=ze.name.replace(/\s+/g,"");if(ze.type==="uses"){const oe=typeof ze.maxUses=="function"?ze.maxUses(_.level):ze.maxUses;_.classFeatures.features[Te]=Array(oe).fill(!1),g.push(ze.name)}else if(ze.type==="pool"){const oe=typeof ze.maxPool=="function"?ze.maxPool(_.level):ze.maxPool;oe!==void 0&&(_.classFeatures.features[Te]=oe,g.push(ze.name))}}})}return _}),o(we,!1);const z=g.length>0?`Short rest taken! Restored: ${g.join(", ")}`:"Short rest taken!";Xt.add(z,"success")}function he(){const g=[];Z.update(_=>{const $=_.maxHP-_.currentHP;$>0&&g.push(`${$} HP`),_.currentHP=_.maxHP,_.tempHP=0;const Re=_.hitDice.max-_.hitDice.current;Re>0&&g.push(`${Re} hit ${Re===1?"die":"dice"}`),_.hitDice.current=_.hitDice.max;let Qe=0;if(_.classFeatures.spellSlotsByLevel&&Object.keys(_.classFeatures.spellSlotsByLevel).forEach(ze=>{const Te=_.classFeatures.spellSlotsByLevel[parseInt(ze)];if(Te){const oe=Te.filter(re=>re).length;Qe+=oe,_.classFeatures.spellSlotsByLevel[parseInt(ze)]=Array(Te.length).fill(!1)}}),Qe>0&&g.push(`${Qe} spell ${Qe===1?"slot":"slots"}`),_.class){const ze=qt(_.class,_.level,_.subclass);_.classFeatures.features||(_.classFeatures.features={});let Te=!1;ze.forEach(oe=>{const re=oe.name.replace(/\s+/g,"");if(!(oe.type==="info"||oe.type==="channelDivinity")){if(oe.type==="uses"){const De=typeof oe.maxUses=="function"?oe.maxUses(_.level):oe.maxUses;_.classFeatures.features[re]=Array(De).fill(!1),Te=!0}else if(oe.type==="pool"){const De=typeof oe.maxPool=="function"?oe.maxPool(_.level):oe.maxPool;De!==void 0&&(_.classFeatures.features[re]=De,Te=!0)}}}),Te&&g.push("all class features")}return _}),o(we,!1);const z=g.length>0?`Long rest taken! Restored: ${g.join(", ")}`:"Long rest taken! Fully rested.";Xt.add(z,"success")}function Q(g){o(ye,""),o(ie,""),o(ke,""),o(be,!1),T=!1,typeof g=="string"?o(ye,g):(o(ye,g.notation),o(ie,g.damageNotation||""),o(ke,g.attackName||""),o(be,!!g.applyHalfDamage)),o(y,!0)}function V(g){const{notation:z}=g.detail;o(ye,""),T=!0,setTimeout(()=>{o(ye,z),o(ie,""),o(ke,"Hit Die")},0),o(y,!0)}function ve(){if(o(y,!1),T&&e(ge)){const g=e(ge).getLastRollTotal();if(g!==null){const z=Math.max(1,g);Z.update(_=>(_.hitDice.current=Math.max(0,_.hitDice.current-1),_.currentHP=Math.min(_.maxHP,_.currentHP+z),_))}T=!1}}function me(){console.log("toggleMode called, current isEditMode:",v()),Yt.update(g=>(console.log("Updating isEditMode from",g,"to",!g),!g))}function ne(g){g.target.closest(".rest-button-container")||o(we,!1)}ea(()=>{console.log("onMount - initial isEditMode:",v()),console.log("onMount - body classes:",document.body.className);const g=Yt.subscribe(z=>{console.log("isEditMode subscription triggered, value:",z),console.log("Body classes before:",document.body.className),z?(document.body.classList.remove("use-mode"),console.log("Removed use-mode class (Edit Mode)")):(document.body.classList.add("use-mode"),console.log("Added use-mode class (Use Mode)")),console.log("Body classes after:",document.body.className)});return document.addEventListener("click",ne),()=>{g(),document.removeEventListener("click",ne)}});function Ue(){gs(t())}function D(){e(G)?.click()}async function de(g){const _=g.target.files?.[0];if(_)try{const $=await hs(_);Z.set($),alert("Character imported successfully!")}catch{alert("Failed to import character file")}}kt();var se=Yi();fs("1uha8ag",g=>{var z=zi();za(2),Ga(()=>{ps.title="D&D Character Sheet"}),c(g,z)});var xe=Ve(se),f=i(xe),H=i(f),pe=i(H),Ee=i(pe),m=s(i(Ee),2);{var L=g=>{var z=Ki(),_=i(z,!0);l(z),U(()=>C(_,t().name)),c(g,z)};S(m,g=>{t().name&&g(L)})}l(Ee);var Y=s(Ee,2);{var A=g=>{var z=Ji();nt(z,5,M,ct,(_,$)=>{var Re=Vi();let Qe;var ze=i(Re);l(Re),U(()=>{Qe=ot(Re,1,"slot-badge svelte-1uha8ag",null,Qe,{depleted:e($).available===0}),C(ze,`Lv${e($).level??""}: ${e($).available??""}/${e($).total??""}`)}),c(_,Re)}),l(z),c(g,z)};S(Y,g=>{M().length>0&&g(A)})}l(pe);var te=s(pe,2),Me=i(te),je=i(Me),Ne=s(je,2),qe=i(Ne),Ze=s(qe,2);{var tt=g=>{var z=Qi(),_=i(z),$=s(_,2);l(z),j("click",_,Ce),j("click",$,he),c(g,z)};S(Ze,g=>{e(we)&&g(tt)})}l(Ne);var E=s(Ne,2),w=i(E);let F;var d=i(w),He=i(d,!0);l(d);var le=s(d),B=i(le,!0);l(le),l(w),l(E),l(Me);var X=s(Me,2),x=i(X);$e(x),l(X),l(te),l(H);var Le=s(H,2),Se=i(Le),Be=s(Se,2),Ge=s(Be,2),Ke=s(Ge,2),Pe=s(Ke,2),ae=s(Pe,2);$a(ae,g=>o(G,g),()=>e(G)),l(Le),l(f);var fe=s(f,2),Oe=i(fe);Is(Oe,{});var We=s(Oe,2);qs(We,{$$events:{rollHitDice:V}});var K=s(We,2);Ps(K,{$$events:{roll:g=>Q(g.detail)}});var _e=s(K,2);Vs(_e,{$$events:{roll:g=>Q(g.detail)}});var b=s(_e,2);Fl(b,{$$events:{roll:g=>Q(g.detail)}});var I=s(b,2);Vl(I,{});var O=s(I,2);Yl(O,{}),l(fe),l(xe);var J=s(xe,2);$a(ci(J,{get notation(){return e(ye)},get damageNotation(){return e(ie)},get attackName(){return e(ke)},get applyHalfDamage(){return e(be)},get visible(){return e(y)},$$events:{close:ve},$$legacy:!0}),g=>o(ge,g),()=>e(ge));var ue=s(J,2);{var Ae=g=>{ji(g,{get mode(){return e(ee)},$$events:{close:()=>o(P,!1)}})};S(ue,g=>{e(P)&&g(Ae)})}var q=s(ue,2);{var W=g=>{Wi(g,{onClose:()=>o(ce,!1)})};S(q,g=>{e(ce)&&g(W)})}var Ie=s(q,2);bs(Ie,{}),U(()=>{F=ot(w,1,"btn btn-mode svelte-1uha8ag",null,F,{"use-mode":!v()}),C(He,v()?"ðŸ“":"ðŸŽ²"),C(B,v()?"Edit Mode":"Use Mode")}),j("click",je,()=>o(y,!0)),j("click",qe,()=>o(we,!e(we))),j("click",w,me),Fe(x,u,g=>ms(Bt,g)),j("click",Se,()=>o(ce,!0)),j("click",Be,()=>{o(ee,"save"),o(P,!0)}),j("click",Ge,()=>{o(ee,"load"),o(P,!0)}),j("click",Ke,Ue),j("click",Pe,D),j("change",ae,de),c(a,se),St(),k()}export{rr as component};
