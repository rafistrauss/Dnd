import{f as p,e as D,a as c,s as C,c as it,t as pt}from"../chunks/B7Yu7-pH.js";import{i as kt}from"../chunks/Pgj_Karr.js";import{c as Tt,o as ea,a as es}from"../chunks/YW1J0937.js";import{a7 as Ha,i as Ua,aZ as ts,a_ as as,a$ as wa,K as Et,e as Na,b0 as Ga,T as da,b1 as ss,b2 as ls,q as is,b3 as rs,b4 as ns,b5 as os,ab as cs,d as r,r as Oa,g as vs,C as xt,b6 as Ze,b7 as Rt,F as B,G as St,s as o,a4 as j,H as i,J as a,I as l,f as e,E as We,m as at,A as G,b8 as ut,b9 as Qt,ba as qa,ao as Wa,bb as ds}from"../chunks/TSJapsqm.js";import{c as Q,a as ft,e as nt,i as ct,u as za,s as Pt,b as ot,d as ta,f as Yt,t as Xt,h as us,T as ps,g as fs,j as bs}from"../chunks/BW7xBItJ.js";import{i as S,s as Lt,a as ze,b as st,d as ia,e as gs}from"../chunks/lg4VTcy2.js";import{p as _t,b as $a}from"../chunks/BPqayAlY.js";import{b as Jt,r as hs}from"../chunks/DxNdmt53.js";function ca(s,n,t=!1){if(s.multiple){if(n==null)return;if(!Ua(n))return ts();for(var d of s.options)d.selected=n.includes(Zt(d));return}for(d of s.options){var f=Zt(d);if(as(f,n)){d.selected=!0;return}}(!t||n!==void 0)&&(s.selectedIndex=-1)}function Ca(s){var n=new MutationObserver(()=>{ca(s,s.__value)});n.observe(s,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Ha(()=>{n.disconnect()})}function Va(s,n,t=n){var d=new WeakSet,f=!0;wa(s,"change",y=>{var L=y?"[selected]":":checked",T;if(s.multiple)T=[].map.call(s.querySelectorAll(L),Zt);else{var k=s.querySelector(L)??s.querySelector("option:not([disabled])");T=k&&Zt(k)}t(T),Et!==null&&d.add(Et)}),Na(()=>{var y=n();if(s===document.activeElement){var L=Ga??Et;if(d.has(L))return}if(ca(s,y,f),f&&y===void 0){var T=s.querySelector(":checked");T!==null&&(y=Zt(T),t(y))}s.__value=y,f=!1}),Ca(s)}function Zt(s){return"__value"in s?s.__value:s.value}const ms=Symbol("is custom element"),_s=Symbol("is html");function Se(s){if(da){var n=!1,t=()=>{if(!n){if(n=!0,s.hasAttribute("value")){var d=s.value;et(s,"value",null),s.value=d}if(s.hasAttribute("checked")){var f=s.checked;et(s,"checked",null),s.checked=f}}};s.__on_r=t,is(t),rs()}}function ja(s,n){var t=Fa(s);t.value===(t.value=n??void 0)||s.value===n&&(n!==0||s.nodeName!=="PROGRESS")||(s.value=n??"")}function ys(s,n){var t=Fa(s);t.checked!==(t.checked=n??void 0)&&(s.checked=n)}function et(s,n,t,d){var f=Fa(s);da&&(f[n]=s.getAttribute(n),n==="src"||n==="srcset"||n==="href"&&s.nodeName==="LINK")||f[n]!==(f[n]=t)&&(n==="loading"&&(s[ns]=t),t==null?s.removeAttribute(n):typeof t!="string"&&ks(s).includes(n)?s[n]=t:s.setAttribute(n,t))}function Fa(s){return s.__attributes??={[ms]:s.nodeName.includes("-"),[_s]:s.namespaceURI===ss}}var Ma=new Map;function ks(s){var n=s.getAttribute("is")||s.nodeName,t=Ma.get(n);if(t)return t;Ma.set(n,t=[]);for(var d,f=s,y=Element.prototype;y!==f;){d=os(f);for(var L in d)d[L].set&&t.push(L);f=ls(f)}return t}function Me(s,n,t=n){var d=new WeakSet;wa(s,"input",async f=>{var y=f?s.defaultValue:s.value;if(y=ka(s)?xa(y):y,t(y),Et!==null&&d.add(Et),await cs(),y!==(y=n())){var L=s.selectionStart,T=s.selectionEnd,k=s.value.length;if(s.value=y??"",T!==null){var A=s.value.length;L===T&&T===k&&A>k?(s.selectionStart=A,s.selectionEnd=A):(s.selectionStart=L,s.selectionEnd=Math.min(T,A))}}}),(da&&s.defaultValue!==s.value||r(n)==null&&s.value)&&(t(ka(s)?xa(s.value):s.value),Et!==null&&d.add(Et)),Oa(()=>{var f=n();if(s===document.activeElement){var y=Ga??Et;if(d.has(y))return}ka(s)&&f===xa(s.value)||s.type==="date"&&!f&&!s.value||f!==s.value&&(s.value=f??"")})}function va(s,n,t=n){wa(s,"change",d=>{var f=d?s.defaultChecked:s.checked;t(f)}),(da&&s.defaultChecked!==s.checked||r(n)==null)&&t(s.checked),Oa(()=>{var d=n();s.checked=!!d})}function ka(s){var n=s.type;return n==="number"||n==="range"}function xa(s){return s===""?null:+s}function xs(s,n,t){var d=vs(s,n);d&&d.set&&(s[n]=t,Ha(()=>{s[n]=null}))}function Aa(s){return function(...n){var t=n[0];return t.stopPropagation(),s?.apply(this,n)}}function Ot(s,n){var t=s.$$events?.[n.type],d=Ua(t)?t.slice():t==null?[]:[t];for(var f of d)f.call(this,n)}const Ss="";function Ka(...s){return Jt+Ss+hs(s[0],s[1])}const La={paladin:{name:"Paladin",hitDice:"d10",spellcaster:!0,spellcastingAbility:"charisma",spellSlotsByLevel:{1:0,2:2,3:3,4:3,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Divine Sense",type:"uses",maxUses:(s,n=1)=>1+Math.max(1,n),resetOn:"long",description:"Detect celestials, fiends, and undead within 60 feet",minLevel:1},{name:"Lay on Hands",type:"pool",maxPool:s=>s*5,resetOn:"long",description:"Heal wounds or cure disease",minLevel:1},{name:"Divine Smite",type:"spellSlot",description:"Expend spell slot to deal extra radiant damage",minLevel:2,rollable:!0},{name:"Channel Divinity",type:"pool",maxPool:s=>s>=18?3:s>=6?2:1,resetOn:"short",description:"Sacred Weapon or Turn Undead",minLevel:3}]},fighter:{name:"Fighter",hitDice:"d10",spellcaster:!1,features:[{name:"Second Wind",type:"uses",maxUses:1,resetOn:"short",description:"Regain 1d10 + fighter level HP as bonus action",minLevel:1,rollable:!0,rollFormula:s=>`1d10+${s}`},{name:"Action Surge",type:"uses",maxUses:s=>s>=17?2:1,resetOn:"short",description:"Take one additional action on your turn",minLevel:2},{name:"Indomitable",type:"uses",maxUses:s=>s>=17?3:s>=13?2:1,resetOn:"long",description:"Reroll a failed saving throw",minLevel:9}],subclasses:{champion:{name:"Champion",features:[{name:"Improved Critical",type:"info",description:"Critical hit on 19-20",minLevel:3},{name:"Remarkable Athlete",type:"info",description:"Add half proficiency to STR/DEX/CON checks, increase long jump distance",minLevel:7},{name:"Additional Fighting Style",type:"info",description:"Choose a second fighting style",minLevel:10},{name:"Superior Critical",type:"info",description:"Critical hit on 18-20",minLevel:15},{name:"Survivor",type:"info",description:"Regain 5 + CON mod HP at start of turn if below half HP",minLevel:18}]},battlemaster:{name:"Battle Master",features:[{name:"Combat Superiority",type:"uses",maxUses:s=>s>=15?6:s>=7?5:4,resetOn:"short",description:s=>`Use superiority dice (${s>=18?"d12":s>=10?"d10":"d8"}) for maneuvers`,minLevel:3},{name:"Know Your Enemy",type:"info",description:"Learn capabilities of creatures you observe",minLevel:7},{name:"Improved Combat Superiority",type:"info",description:"Superiority dice become d10",minLevel:10},{name:"Relentless",type:"info",description:"Regain 1 superiority die if you have none at start of turn",minLevel:15}]}}},rogue:{name:"Rogue",hitDice:"d8",spellcaster:!1,features:[{name:"Sneak Attack",type:"info",description:s=>`Deal ${Math.ceil(s/2)}d6 extra damage once per turn with advantage or ally nearby`,minLevel:1,rollable:!0,rollFormula:s=>`${Math.ceil(s/2)}d6`},{name:"Cunning Action",type:"info",description:"Dash, Disengage, or Hide as a bonus action",minLevel:2},{name:"Uncanny Dodge",type:"info",description:"Use reaction to halve damage from an attack",minLevel:5},{name:"Evasion",type:"info",description:"Take no damage on successful Dex save (half on fail)",minLevel:7}]},wizard:{name:"Wizard",hitDice:"d6",spellcaster:!0,spellcastingAbility:"intelligence",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Arcane Recovery",type:"uses",maxUses:1,resetOn:"long",description:s=>`Recover spell slots totaling up to ${Math.ceil(s/2)} levels during short rest`,minLevel:1},{name:"Spell Mastery",type:"info",description:"Cast one 1st-level and one 2nd-level spell at will",minLevel:18}]},cleric:{name:"Cleric",hitDice:"d8",spellcaster:!0,spellcastingAbility:"wisdom",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Channel Divinity",type:"pool",maxPool:s=>s>=18?3:s>=6?2:1,resetOn:"short",description:"Turn Undead or domain-specific ability",minLevel:2},{name:"Destroy Undead",type:"info",description:s=>`Channel Divinity destroys undead of CR ${s>=17?4:s>=14?3:s>=11?2:s>=8?1:.5} or lower`,minLevel:5},{name:"Divine Intervention",type:"uses",maxUses:1,resetOn:"long",description:s=>`${s}% chance to succeed, implore deity for aid`,minLevel:10}],subclasses:{war:{name:"War Domain",features:[{name:"War Priest",type:"uses",maxUses:(s,n=1)=>Math.max(1,n),resetOn:"long",description:"Make one weapon attack as a bonus action",minLevel:1},{name:"Guided Strike",type:"channelDivinity",description:"Use your Channel Divinity to gain +10 to an attack roll. Make this choice after you see the roll, but before the DM says whether the attack hits or misses.",minLevel:2,resetOn:"short"},{name:"War God's Blessing",type:"channelDivinity",description:"Use reaction to grant +10 to an ally's attack roll within 30 feet. Consumes one use of Channel Divinity.",minLevel:6,resetOn:"short"},{name:"Divine Strike",type:"info",description:s=>`Deal extra ${s>=14?"2d8":"1d8"} weapon damage once per turn`,minLevel:8,rollable:!0,rollFormula:s=>s>=14?"2d8":"1d8"},{name:"Avatar of Battle",type:"info",description:"Gain resistance to nonmagical weapon damage",minLevel:17}]},life:{name:"Life Domain",features:[{name:"Disciple of Life",type:"info",description:"Healing spells restore additional 2 + spell level HP",minLevel:1},{name:"Preserve Life",type:"pool",maxPool:s=>s*5,resetOn:"short",description:"Restore HP to creatures within 30 feet",minLevel:2},{name:"Blessed Healer",type:"info",description:"Regain 2 + spell level HP when you cast healing spell",minLevel:6},{name:"Divine Strike",type:"info",description:s=>`Deal extra ${s>=14?"2d8":"1d8"} radiant damage once per turn`,minLevel:8,rollable:!0,rollFormula:s=>s>=14?"2d8":"1d8"},{name:"Supreme Healing",type:"info",description:"Maximize healing dice instead of rolling",minLevel:17}]}}},barbarian:{name:"Barbarian",hitDice:"d12",spellcaster:!1,features:[{name:"Rage",type:"uses",maxUses:s=>s>=20?1/0:s>=17?6:s>=12?5:s>=6?4:s>=3?3:2,resetOn:"long",description:s=>`+${s>=16?4:s>=9?3:2} damage, resistance to physical damage`,minLevel:1},{name:"Reckless Attack",type:"info",description:"Gain advantage on melee attacks, enemies get advantage on you",minLevel:2},{name:"Danger Sense",type:"info",description:"Advantage on Dex saves against effects you can see",minLevel:2}],subclasses:{berserker:{name:"Path of the Berserker",features:[{name:"Frenzy",type:"info",description:"While raging, make melee attack as bonus action (gain 1 exhaustion after rage)",minLevel:3},{name:"Mindless Rage",type:"info",description:"Cannot be charmed or frightened while raging",minLevel:6},{name:"Intimidating Presence",type:"info",description:"Use action to frighten creature within 30 feet",minLevel:10},{name:"Retaliation",type:"info",description:"When damaged by creature within 5 feet, make melee attack as reaction",minLevel:14}]}}}};function yt(s){const n=s.toLowerCase();return La[n]||null}function qt(s,n,t){const d=yt(s);if(!d)return[];const f=d.features.filter(y=>!y.minLevel||y.minLevel<=n);if(t&&d.subclasses&&d.subclasses[t]){const y=d.subclasses[t].features.filter(L=>!L.minLevel||L.minLevel<=n);return[...f,...y]}return f}function Ra(s){const n=yt(s);return!n||!n.subclasses?[]:Object.keys(n.subclasses).map(t=>({id:t,name:n.subclasses[t].name}))}function Ia(s,n){const t=yt(s);return!t||!t.spellcaster||!t.spellSlotsByLevel?0:t.spellSlotsByLevel[n]||0}function Ea(s,n,t){const d=yt(s);return!d||!d.spellcaster?0:Math.max(1,t+n)}function $s(s,n,t){const d=yt(s);return!d||!d.spellcaster?null:8+n+t}function Cs(){return Object.keys(La).map(s=>({id:s,name:La[s].name}))}var Ls=p("<option> </option>"),Ds=p("<option> </option>"),ws=p('<div class="form-group svelte-172i2fj"><label for="characterSubclass" class="svelte-172i2fj">Subclass</label> <select id="characterSubclass" class="svelte-172i2fj"><option>Select Subclass</option><!></select></div>'),js=p('<div class="info-grid svelte-172i2fj"><div class="form-group svelte-172i2fj"><label for="characterName" class="svelte-172i2fj">Character Name</label> <input type="text" id="characterName" placeholder="Enter name" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterClass" class="svelte-172i2fj">Class</label> <select id="characterClass" class="svelte-172i2fj"><option>Select Class</option><!></select></div> <!> <div class="form-group svelte-172i2fj"><label for="characterLevel" class="svelte-172i2fj">Level</label> <input type="number" id="characterLevel" min="1" max="20" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterRace" class="svelte-172i2fj">Race</label> <input type="text" id="characterRace" placeholder="e.g., Human" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterBackground" class="svelte-172i2fj">Background</label> <input type="text" id="characterBackground" placeholder="e.g., Soldier" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterAlignment" class="svelte-172i2fj">Alignment</label> <input type="text" id="characterAlignment" placeholder="e.g., Lawful Good" class="svelte-172i2fj"/></div></div>'),Fs=p('<section class="character-info svelte-172i2fj"><div class="header svelte-172i2fj"><h2 class="svelte-172i2fj">Character Info</h2> <button class="collapse-btn svelte-172i2fj"> </button></div> <!></section>');function As(s,n){xt(n,!1);const t=()=>ze(Q,"$character",f),d=()=>ze(ft,"$collapsedStates",f),[f,y]=Lt(),L=j(),T=Cs();function k(M){const je=M.target;Q.update($e=>($e.class=je.value,$e.subclass="",$e))}function A(M){const je=M.target;Q.update($e=>($e.subclass=je.value,$e))}function re(M){const je=M.target;Q.update($e=>($e.level=parseInt(je.value)||1,$e)),za()}function K(){ft.update(M=>({...M,characterInfo:!M.characterInfo}))}Ze(()=>(t(),Ra),()=>{o(L,t().class?Ra(t().class):[])}),Rt(),kt();var N=Fs(),_e=i(N),se=a(i(_e),2),ye=i(se,!0);l(se),l(_e);var pe=a(_e,2);{var fe=M=>{var je=js(),$e=i(je),be=a(i($e),2);Se(be),l($e);var V=a($e,2),W=a(i(V),2),ne=i(W);ne.value=ne.__value="";var ge=a(ne);nt(ge,1,()=>T,ct,(X,w)=>{var z=Ls(),Re=i(z,!0);l(z);var Ne={};B(()=>{C(Re,(e(w),r(()=>e(w).name))),Ne!==(Ne=(e(w),r(()=>e(w).id)))&&(z.value=(z.__value=(e(w),r(()=>e(w).id)))??"")}),c(X,z)}),l(W);var le;Ca(W),l(V);var Ue=a(V,2);{var $=X=>{var w=ws(),z=a(i(w),2),Re=i(z);Re.value=Re.__value="";var Ne=a(Re);nt(Ne,1,()=>e(L),ct,(Fe,Xe)=>{var tt=Ds(),Ye=i(tt,!0);l(tt);var E={};B(()=>{C(Ye,(e(Xe),r(()=>e(Xe).name))),E!==(E=(e(Xe),r(()=>e(Xe).id)))&&(tt.value=(tt.__value=(e(Xe),r(()=>e(Xe).id)))??"")}),c(Fe,tt)}),l(z);var Ge;Ca(z),l(w),B(()=>{Ge!==(Ge=(t(),r(()=>t().subclass)))&&(z.value=(z.__value=(t(),r(()=>t().subclass)))??"",ca(z,(t(),r(()=>t().subclass))))}),D("change",z,A),c(X,w)};S(Ue,X=>{e(L),r(()=>e(L).length>0)&&X($)})}var ce=a(Ue,2),Y=a(i(ce),2);Se(Y),l(ce);var he=a(ce,2),h=a(i(he),2);Se(h),l(he);var R=a(he,2),ve=a(i(R),2);Se(ve),l(R);var b=a(R,2),U=a(i(b),2);Se(U),l(b),l(je),B(()=>{le!==(le=(t(),r(()=>t().class)))&&(W.value=(W.__value=(t(),r(()=>t().class)))??"",ca(W,(t(),r(()=>t().class)))),ja(Y,(t(),r(()=>t().level)))}),Me(be,()=>t().name,X=>st(Q,r(t).name=X,r(t))),D("change",W,k),D("change",Y,re),Me(h,()=>t().race,X=>st(Q,r(t).race=X,r(t))),Me(ve,()=>t().background,X=>st(Q,r(t).background=X,r(t))),Me(U,()=>t().alignment,X=>st(Q,r(t).alignment=X,r(t))),c(M,je)};S(pe,M=>{d(),r(()=>!d().characterInfo)&&M(fe)})}l(N),B(()=>{et(se,"aria-label",(d(),r(()=>d().characterInfo?"Expand":"Collapse"))),C(ye,(d(),r(()=>d().characterInfo?"â–¼":"â–²")))}),D("click",se,K),c(s,N),St(),y()}var Ms=p('<div class="ability-card svelte-bbv1xt"><h3 class="svelte-bbv1xt"> </h3> <input type="number" class="ability-score svelte-bbv1xt" min="1" max="30"/> <div class="ability-modifier svelte-bbv1xt"> </div> <button class="roll-btn svelte-bbv1xt">Check</button> <div class="save-row svelte-bbv1xt"><input type="checkbox" class="svelte-bbv1xt"/> <label class="svelte-bbv1xt">Save</label> <button class="roll-btn-small svelte-bbv1xt">Roll</button></div></div>'),Rs=p('<div class="proficiency-bonus svelte-bbv1xt"><label for="profBonus">Proficiency Bonus</label> <input type="number" id="profBonus" class="prof-input svelte-bbv1xt"/></div> <div class="abilities-grid svelte-bbv1xt"></div>',1),Is=p('<section><div class="header svelte-bbv1xt"><h2 class="svelte-bbv1xt">Ability Scores</h2> <button class="collapse-btn svelte-bbv1xt"> </button></div> <!></section>');function Es(s,n){xt(n,!1);const t=()=>ze(ta,"$abilityModifiers",L),d=()=>ze(Q,"$character",L),f=()=>ze(Pt,"$searchFilter",L),y=()=>ze(ft,"$collapsedStates",L),[L,T]=Lt(),k=j(),A=j(),re=Tt(),K=[{key:"strength",label:"Strength"},{key:"dexterity",label:"Dexterity"},{key:"constitution",label:"Constitution"},{key:"intelligence",label:"Intelligence"},{key:"wisdom",label:"Wisdom"},{key:"charisma",label:"Charisma"}];function N(){za()}function _e(W){const ne=t()[W],ge=`1d20${ne>=0?"+":""}${ne}`;re("roll",ge)}function se(W){const ne=t()[W],ge=d().saveProficiencies[W]?d().proficiencyBonus:0,le=ne+ge,Ue=`1d20${le>=0?"+":""}${le}`;re("roll",Ue)}function ye(){ft.update(W=>({...W,abilityScores:!W.abilityScores}))}Ze(()=>f(),()=>{o(k,K.filter(({label:W})=>f()?W.toLowerCase().includes(f().toLowerCase()):!0))}),Ze(()=>(e(k),f()),()=>{o(A,e(k).length>0||!f()||f().toLowerCase().includes("proficiency"))}),Rt(),kt();var pe=Is();let fe;var M=i(pe),je=a(i(M),2),$e=i(je,!0);l(je),l(M);var be=a(M,2);{var V=W=>{var ne=Rs(),ge=We(ne),le=a(i(ge),2);Se(le),l(ge);var Ue=a(ge,2);nt(Ue,5,()=>e(k),ct,($,ce)=>{let Y=()=>e(ce).key,he=()=>e(ce).label;var h=Ms(),R=i(h),ve=i(R,!0);l(R);var b=a(R,2);Se(b);var U=a(b,2),X=i(U);l(U);var w=a(U,2),z=a(w,2),Re=i(z);Se(Re);var Ne=a(Re,2),Ge=a(Ne,2);l(z),l(h),B(Fe=>{C(ve,Fe),C(X,`${t(),Y(),r(()=>t()[Y()]>=0?"+":"")??""}${t(),Y(),r(()=>t()[Y()])??""}`),et(Re,"id",`${Y()}-save`),et(Ne,"for",`${Y()}-save`)},[()=>(he(),r(()=>he().substring(0,3).toUpperCase()))]),Me(b,()=>d().abilities[Y()],Fe=>st(Q,r(d).abilities[Y()]=Fe,r(d))),D("change",b,N),D("click",w,()=>_e(Y())),va(Re,()=>d().saveProficiencies[Y()],Fe=>st(Q,r(d).saveProficiencies[Y()]=Fe,r(d))),D("click",Ge,()=>se(Y())),c($,h)}),l(Ue),Me(le,()=>d().proficiencyBonus,$=>st(Q,r(d).proficiencyBonus=$,r(d))),c(W,ne)};S(be,W=>{y(),r(()=>!y().abilityScores)&&W(V)})}l(pe),B(()=>{fe=ot(pe,1,"ability-scores svelte-bbv1xt",null,fe,{hidden:!e(A)}),et(je,"aria-label",(y(),r(()=>y().abilityScores?"Expand":"Collapse"))),C($e,(y(),r(()=>y().abilityScores?"â–¼":"â–²")))}),D("click",je,ye),c(s,pe),St(),T()}function Ps(s){return Math.floor((s-10)/2)}function Da(s,n){if(!s.class)return null;const t=yt(s.class);if(!t||!t.spellcaster||!t.spellcastingAbility)return null;const d=n[t.spellcastingAbility];return 8+s.proficiencyBonus+d}function Bs(s,n){if(!s.class)return 0;const t=yt(s.class);return!t||!t.spellcaster||!t.spellcastingAbility?0:Ps(n[t.spellcastingAbility])}var Ts=p('<div class="stat-box svelte-1r5hyyb"><label for="spellSaveDC" class="svelte-1r5hyyb">Spell Save DC</label> <input type="number" id="spellSaveDC" class="stat-input svelte-1r5hyyb" readonly="" title="8 + Proficiency Bonus + Spellcasting Ability Modifier"/></div>'),Hs=p('<span class="hit-dice-type"> </span>'),Us=p('<div class="stats-grid svelte-1r5hyyb"><div class="stat-box svelte-1r5hyyb"><label for="armorClass" class="svelte-1r5hyyb">Armor Class</label> <input type="number" id="armorClass" class="stat-input svelte-1r5hyyb"/></div> <div class="stat-box svelte-1r5hyyb"><label for="initiative" class="svelte-1r5hyyb">Initiative</label> <input type="number" id="initiative" class="stat-input svelte-1r5hyyb"/></div> <div class="stat-box svelte-1r5hyyb"><label for="speed" class="svelte-1r5hyyb">Speed</label> <input type="text" id="speed" class="stat-input svelte-1r5hyyb"/></div> <!></div> <div class="hp-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Points</h3> <div class="hp-display svelte-1r5hyyb"><div class="hp-inputs svelte-1r5hyyb"><input type="number" class="hp-current svelte-1r5hyyb" min="0"/> <span class="hp-separator svelte-1r5hyyb">/</span> <input type="number" class="hp-max svelte-1r5hyyb" min="0"/></div> <div class="hp-controls svelte-1r5hyyb"><button class="hp-btn svelte-1r5hyyb">âˆ’</button> <button class="hp-btn svelte-1r5hyyb">+</button> <button class="hp-btn svelte-1r5hyyb">âˆ’5</button> <button class="hp-btn svelte-1r5hyyb">+5</button></div></div> <div class="temp-hp svelte-1r5hyyb"><label for="tempHP" class="svelte-1r5hyyb">Temp HP</label> <input type="number" id="tempHP" min="0" class="svelte-1r5hyyb"/></div></div> <div class="hit-dice-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Dice</h3> <div class="hit-dice-display svelte-1r5hyyb"><input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <span>/</span> <input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <!></div> <div class="hit-dice-controls"><label for="hitDiceCount" class="svelte-1r5hyyb">Roll</label> <input type="number" id="hitDiceCount" class="hit-dice-count-input svelte-1r5hyyb" min="1" value="1"/> <button class="btn btn-primary roll-hit-dice use-enabled svelte-1r5hyyb">ðŸŽ² Roll</button></div></div>',1),Ns=p('<section><div class="header svelte-1r5hyyb"><h2 class="svelte-1r5hyyb">Combat Stats</h2> <button class="collapse-btn svelte-1r5hyyb"> </button></div> <!></section>');function Gs(s,n){xt(n,!1);const t=()=>ze(Q,"$character",L),d=()=>ze(ta,"$abilityModifiers",L),f=()=>ze(Pt,"$searchFilter",L),y=()=>ze(ft,"$collapsedStates",L),[L,T]=Lt(),k=j(),A=j(),re=Tt();function K(be){Q.update(V=>(V.currentHP=Math.max(0,Math.min(V.maxHP,V.currentHP+be)),V))}function N(be=1){if(t().hitDice.current<=0){alert("No hit dice remaining!");return}if(!t().class){alert("Please select a class first!");return}const V=yt(t().class);if(!V){alert("Invalid class configuration!");return}const W=Math.min(be,t().hitDice.current),ne=V.hitDice,ge=d().constitution,le=ge>=0?`+${ge}`:`${ge}`,Ue=`${W}${ne}${le}`;re("rollHitDice",{notation:Ue,hitDie:ne,count:W})}function _e(){ft.update(be=>({...be,combatStats:!be.combatStats}))}Ze(()=>(t(),d()),()=>{o(k,Da(t(),d()))}),Ze(()=>f(),()=>{o(A,!f()||"armor class".includes(f().toLowerCase())||"initiative".includes(f().toLowerCase())||"speed".includes(f().toLowerCase())||"hit points".includes(f().toLowerCase())||"hp".includes(f().toLowerCase())||"hit dice".includes(f().toLowerCase())||"spell save".includes(f().toLowerCase())||"combat".includes(f().toLowerCase()))}),Rt(),kt();var se=Ns();let ye;var pe=i(se),fe=a(i(pe),2),M=i(fe,!0);l(fe),l(pe);var je=a(pe,2);{var $e=be=>{var V=Us(),W=We(V),ne=i(W),ge=a(i(ne),2);Se(ge),l(ne);var le=a(ne,2),Ue=a(i(le),2);Se(Ue),l(le);var $=a(le,2),ce=a(i($),2);Se(ce),l($);var Y=a($,2);{var he=P=>{var Z=Ts(),x=a(i(Z),2);Se(x),l(Z),B(()=>ja(x,e(k))),c(P,Z)};S(Y,P=>{e(k)!==null&&P(he)})}l(W);var h=a(W,2),R=a(i(h),2),ve=i(R),b=i(ve);Se(b);var U=a(b,4);Se(U),l(ve);var X=a(ve,2),w=i(X),z=a(w,2),Re=a(z,2),Ne=a(Re,2);l(X),l(R);var Ge=a(R,2),Fe=a(i(Ge),2);Se(Fe),l(Ge),l(h);var Xe=a(h,2),tt=a(i(Xe),2),Ye=i(tt);Se(Ye);var E=a(Ye,4);Se(E);var _=a(E,2);{var u=P=>{const Z=at(()=>(G(yt),t(),r(()=>yt(t().class))));var x=it(),Ce=We(x);{var ke=Pe=>{const He=at(()=>(d(),r(()=>d().constitution)));var Ve=Hs(),Be=i(Ve);l(Ve),B(()=>C(Be,`(${G(e(Z)),r(()=>e(Z).hitDice)??""}${(e(He)>=0?`+${e(He)}`:e(He))??""})`)),c(Pe,Ve)};S(Ce,Pe=>{e(Z)&&Pe(ke)})}c(P,x)};S(_,P=>{t(),r(()=>t().class)&&P(u)})}l(tt);var ie=a(tt,2),de=a(i(ie),2),me=a(de,2);l(ie),l(Xe),B(()=>{et(b,"max",(t(),r(()=>t().maxHP))),et(Ye,"max",(t(),r(()=>t().hitDice.max))),et(de,"max",(t(),r(()=>t().hitDice.current))),me.disabled=(t(),r(()=>t().hitDice.current<=0||!t().class))}),Me(ge,()=>t().armorClass,P=>st(Q,r(t).armorClass=P,r(t))),Me(Ue,()=>t().initiative,P=>st(Q,r(t).initiative=P,r(t))),Me(ce,()=>t().speed,P=>st(Q,r(t).speed=P,r(t))),Me(b,()=>t().currentHP,P=>st(Q,r(t).currentHP=P,r(t))),Me(U,()=>t().maxHP,P=>st(Q,r(t).maxHP=P,r(t))),D("click",w,()=>K(-1)),D("click",z,()=>K(1)),D("click",Re,()=>K(-5)),D("click",Ne,()=>K(5)),Me(Fe,()=>t().tempHP,P=>st(Q,r(t).tempHP=P,r(t))),Me(Ye,()=>t().hitDice.current,P=>st(Q,r(t).hitDice.current=P,r(t))),Me(E,()=>t().hitDice.max,P=>st(Q,r(t).hitDice.max=P,r(t))),D("input",de,P=>{const Z=P.target,x=parseInt(Z.value);x>t().hitDice.current&&(Z.value=String(t().hitDice.current)),x<1&&(Z.value="1")}),D("click",me,()=>{const P=document.getElementById("hitDiceCount"),Z=parseInt(P?.value||"1");N(Z)}),c(be,V)};S(je,be=>{y(),r(()=>!y().combatStats)&&be($e)})}l(se),B(()=>{ye=ot(se,1,"combat-stats svelte-1r5hyyb",null,ye,{hidden:!e(A)}),et(fe,"aria-label",(y(),r(()=>y().combatStats?"Expand":"Collapse"))),C(M,(y(),r(()=>y().combatStats?"â–¼":"â–²")))}),D("click",fe,_e),c(s,se),St(),T()}const Sa={acrobatics:"dexterity",animalHandling:"wisdom",arcana:"intelligence",athletics:"strength",deception:"charisma",history:"intelligence",insight:"wisdom",intimidation:"charisma",investigation:"intelligence",medicine:"wisdom",nature:"intelligence",perception:"wisdom",performance:"charisma",persuasion:"charisma",religion:"intelligence",sleightOfHand:"dexterity",stealth:"dexterity",survival:"wisdom"};var Os=p('<div class="skill-row svelte-1f1pl16"><input type="checkbox" class="svelte-1f1pl16"/> <label class="svelte-1f1pl16"> <span class="ability-tag svelte-1f1pl16"> </span></label> <span class="skill-modifier svelte-1f1pl16"> </span> <button class="roll-btn svelte-1f1pl16">Roll</button></div>'),qs=p('<div class="skills-grid svelte-1f1pl16"></div>'),Ws=p('<section><div class="header svelte-1f1pl16"><h2 class="svelte-1f1pl16">Skills</h2> <button class="collapse-btn svelte-1f1pl16"> </button></div> <!></section>');function zs(s,n){xt(n,!1);const t=()=>ze(ta,"$abilityModifiers",L),d=()=>ze(Q,"$character",L),f=()=>ze(Pt,"$searchFilter",L),y=()=>ze(ft,"$collapsedStates",L),[L,T]=Lt(),k=j(),A=j(),re=Tt(),K=[{key:"acrobatics",label:"Acrobatics"},{key:"animalHandling",label:"Animal Handling"},{key:"arcana",label:"Arcana"},{key:"athletics",label:"Athletics"},{key:"deception",label:"Deception"},{key:"history",label:"History"},{key:"insight",label:"Insight"},{key:"intimidation",label:"Intimidation"},{key:"investigation",label:"Investigation"},{key:"medicine",label:"Medicine"},{key:"nature",label:"Nature"},{key:"perception",label:"Perception"},{key:"performance",label:"Performance"},{key:"persuasion",label:"Persuasion"},{key:"religion",label:"Religion"},{key:"sleightOfHand",label:"Sleight of Hand"},{key:"stealth",label:"Stealth"},{key:"survival",label:"Survival"}];function N(V){const W=Sa[V],ne=t()[W],ge=d().skillProficiencies[V]?d().proficiencyBonus:0;return ne+ge}function _e(V){const W=N(V),ne=`1d20${W>=0?"+":""}${W}`;re("roll",ne)}function se(){ft.update(V=>({...V,skills:!V.skills}))}Ze(()=>f(),()=>{o(k,K.filter(({label:V})=>f()?V.toLowerCase().includes(f().toLowerCase()):!0))}),Ze(()=>e(k),()=>{o(A,e(k).length>0)}),Rt(),kt();var ye=Ws();let pe;var fe=i(ye),M=a(i(fe),2),je=i(M,!0);l(M),l(fe);var $e=a(fe,2);{var be=V=>{var W=qs();nt(W,5,()=>e(k),ct,(ne,ge)=>{let le=()=>e(ge).key,Ue=()=>e(ge).label;const $=at(()=>(G(Sa),le(),r(()=>Sa[le()]))),ce=at(()=>(le(),r(()=>N(le()))));var Y=Os(),he=i(Y);Se(he);var h=a(he,2),R=i(h),ve=a(R),b=i(ve);l(ve),l(h);var U=a(h,2),X=i(U);l(U);var w=a(U,2);l(Y),B(z=>{et(he,"id",le()),et(h,"for",le()),C(R,`${Ue()??""} `),C(b,`(${z??""})`),C(X,`${e(ce)>=0?"+":""}${e(ce)??""}`)},[()=>(G(e($)),r(()=>e($).substring(0,3).toUpperCase()))]),va(he,()=>d().skillProficiencies[le()],z=>st(Q,r(d).skillProficiencies[le()]=z,r(d))),D("click",w,()=>_e(le())),c(ne,Y)}),l(W),c(V,W)};S($e,V=>{y(),r(()=>!y().skills)&&V(be)})}l(ye),B(()=>{pe=ot(ye,1,"skills svelte-1f1pl16",null,pe,{hidden:!e(A)}),et(M,"aria-label",(y(),r(()=>y().skills?"Expand":"Collapse"))),C(je,(y(),r(()=>y().skills?"â–¼":"â–²")))}),D("click",M,se),c(s,ye),St(),T()}let ra=null,na=null;async function Ja(){if(ra)return ra;try{return ra=await(await fetch(Ka("/data/spells.json"))).json(),ra||[]}catch(s){return console.error("Failed to load spells:",s),[]}}async function Vs(){if(na)return na;try{return na=await(await fetch(Ka("/data/feats.json"))).json(),na||[]}catch(s){return console.error("Failed to load feats:",s),[]}}function Pa(s,n){if(!n.trim())return s;const t=n.toLowerCase();return s.filter(d=>d.name.toLowerCase().includes(t)||d.school.toLowerCase().includes(t)||d.classes.some(f=>f.toLowerCase().includes(t))||d.description.toLowerCase().includes(t))}function Ks(s,n){return n===null?s:s.filter(t=>t.level===n)}function Js(s,n){if(!n.trim())return s;const t=n.toLowerCase();return s.filter(d=>d.name.toLowerCase().includes(t)||d.description.toLowerCase().includes(t))}function oa(s){const n=s.description,t=/\b(Strength|Dexterity|Constitution|Intelligence|Wisdom|Charisma)\s+saving\s+throw/i,d=n.match(t);if(!d)return null;const f=d[1].toLowerCase(),L=/half\s+(?:as\s+much\s+)?damage\s+on\s+a\s+successful(?:\s+save)?/i.test(n),k=/saving\s+throw\s+or\s+take.*?damage/i.test(n)&&!L;return{ability:f,halfDamageOnSave:L,noDamageOnSave:k}}function Qs(s){const n=s.description;return/(plus|add)\s+your\s+spellcasting\s+(ability\s+)?modifier/i.test(n)}var Ys=p('<button class="btn-remove svelte-14o91c5">Ã—</button>'),Xs=p('<div class="spell-info-loading svelte-14o91c5">Loading spell info...</div>'),Zs=p('<div class="spell-notes svelte-14o91c5"><h4 class="svelte-14o91c5">General Notes</h4> <p> </p></div>'),el=p('<li class="svelte-14o91c5"><strong>At Higher Levels:</strong> </li>'),tl=p('<ul class="svelte-14o91c5"><li class="svelte-14o91c5"><strong>Level:</strong> </li> <li class="svelte-14o91c5"><strong>Casting Time:</strong> </li> <li class="svelte-14o91c5"><strong>Range:</strong> </li> <li class="svelte-14o91c5"><strong>Components:</strong> <!></li> <li class="svelte-14o91c5"><strong>Duration:</strong> <!> </li> <li class="svelte-14o91c5"><strong>Description:</strong> </li> <!></ul>'),al=p("<option> </option>"),sl=p('<span class="scaled-damage svelte-14o91c5"><!> </span>'),ll=p('<span class="scaled-damage svelte-14o91c5"> </span>'),il=p('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> Target is Fiend or Undead <!></label></div>'),rl=p('<span class="scaled-damage svelte-14o91c5" style="margin-left: 8px;"> </span>'),nl=p('<span class="scaled-damage svelte-14o91c5">(Half damage)</span>'),ol=p('<span class="scaled-damage svelte-14o91c5">(No damage)</span>'),cl=p('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> <!> <!></label></div>'),vl=p('<div class="spell-level-selector svelte-14o91c5"><label class="svelte-14o91c5">Cast at Level:</label> <select class="spell-level-select use-enabled svelte-14o91c5"></select> <!></div> <!> <!>',1),dl=p('<div class="spell-level-selector svelte-14o91c5"><span style="color: #dc3545; font-weight: bold;">No spell slots available!</span></div>'),ul=p('<!> <div class="spell-info svelte-14o91c5"><div class="spell-info-header svelte-14o91c5" role="button" tabindex="0"><h4 class="svelte-14o91c5">Spell Info</h4> <button class="collapse-btn-small svelte-14o91c5"> </button></div> <!></div> <!>',1),pl=p('<div class="spell-info-missing svelte-14o91c5">Spell info not found.</div>'),fl=p('<div class="attack-notes svelte-14o91c5"><label class="svelte-14o91c5">Notes</label> <textarea placeholder="e.g., DC 15 Dex save, Range 120 ft, Concentration" class="notes-input svelte-14o91c5" rows="2"></textarea></div>'),bl=p('<button class="btn btn-primary">Roll Attack</button>'),gl=p('<button class="btn btn-secondary"><!></button>'),hl=p('<button class="btn btn-secondary">Roll Damage</button>'),ml=p('<div class="attack-card svelte-14o91c5"><div class="attack-header svelte-14o91c5"><input type="text" placeholder="Attack name" class="attack-name svelte-14o91c5"/> <!></div> <div class="attack-details svelte-14o91c5"><div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Bonus</label> <input type="number" class="attack-bonus svelte-14o91c5"/></div> <div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Damage</label> <input type="text" placeholder="e.g., 2d6+3" class="attack-damage svelte-14o91c5"/></div> <div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Type</label> <input type="text" placeholder="e.g., slashing" class="attack-type svelte-14o91c5"/></div></div> <!> <!> <div class="attack-actions svelte-14o91c5"><!> <!></div></div>'),_l=p('<p class="no-attacks svelte-14o91c5">No attacks added yet. Click "Add Attack" to create one.</p>'),yl=p('<p class="no-attacks svelte-14o91c5">No attacks match your search.</p>'),kl=p('<button class="btn-remove svelte-14o91c5">Ã—</button>'),xl=p('<div class="state-card svelte-14o91c5"><div class="state-header svelte-14o91c5"><input type="text" placeholder="Effect name (e.g., Magic Weapon)" class="state-name svelte-14o91c5"/> <!></div> <div class="state-details svelte-14o91c5"><div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Attack Bonus</label> <input type="number" class="state-bonus svelte-14o91c5"/></div> <div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Damage Bonus</label> <input type="number" class="state-bonus svelte-14o91c5"/></div></div> <div class="state-description svelte-14o91c5"><label class="svelte-14o91c5">Description</label> <input type="text" placeholder="e.g., +1 to attack and damage rolls (Magic Weapon)" class="state-desc-input svelte-14o91c5"/></div></div>'),Sl=p('<div class="states-list svelte-14o91c5"></div>'),$l=p('<p class="no-states svelte-14o91c5">No active effects. Add spell effects that modify your attacks.</p>'),Cl=p('<button class="btn btn-secondary">Add Attack</button> <div class="attacks-list svelte-14o91c5"><!> <!></div> <div class="active-states-section svelte-14o91c5"><h3 class="svelte-14o91c5">Active Spell Effects</h3> <p class="section-description svelte-14o91c5">Effects that modify attack and damage rolls (e.g., Magic Weapon, Bless)</p> <button class="btn btn-secondary">Add Effect</button> <!></div>',1),Ll=p('<section><div class="header svelte-14o91c5"><h2 class="svelte-14o91c5">Attacks & Spells</h2> <button class="collapse-btn svelte-14o91c5"> </button></div> <!></section>');function Dl(s,n){xt(n,!1);const t=()=>ze(Q,"$character",T),d=()=>ze(ta,"$abilityModifiers",T),f=()=>ze(Pt,"$searchFilter",T),y=()=>ze(ft,"$collapsedStates",T),L=()=>ze(Yt,"$isEditMode",T),[T,k]=Lt(),A=j(),re=j(),K=Tt();let N=j({});function _e(b){qa(N,e(N)[b]=!e(N)[b]),o(N,{...e(N)})}function se(b){return b.description.toLowerCase().includes("regain")&&(b.description.toLowerCase().includes("hit point")||b.description.toLowerCase().includes("hp"))}function ye(){Q.update(b=>(b.attacks=[...b.attacks,{id:crypto.randomUUID(),name:"",bonus:0,damage:"",damageType:"",notes:""}],b))}function pe(b){Q.update(U=>(U.attacks=U.attacks.filter(X=>X.id!==b),U))}function fe(b){let U=b.damage,X=!1;if(b.spellRef){const Re=V(b.spellRef);if(Re&&Re.level>0){const Ne=b.castAtLevel||Re.level;if(!W(Ne)){alert(`No level ${Ne} spell slots available!`);return}const Fe=oa(Re);Fe&&b.targetSucceededSave&&Fe.noDamageOnSave?U="0":(X=Fe?.halfDamageOnSave&&b.targetSucceededSave||!1,U=ne(b,Re))}}let w=b.bonus;if(t().activeStates)for(const Re of t().activeStates)w+=Re.attackBonus;const z=`1d20${w>=0?"+":""}${w}`;K("roll",{notation:z,damageNotation:U,attackName:b.name,applyHalfDamage:X})}function M(b){if(!b.damage){alert(`${b.name}: No damage specified`);return}let U=b.damage,X=!1;if(b.spellRef){const w=V(b.spellRef);if(w&&w.level>0){const z=b.castAtLevel||w.level;if(!W(z)){alert(`No level ${z} spell slots available!`);return}const Ne=oa(w);Ne&&b.targetSucceededSave&&Ne.noDamageOnSave?U="0":(X=Ne?.halfDamageOnSave&&b.targetSucceededSave||!1,U=ne(b,w))}}else if(t().activeStates&&t().activeStates.length>0){let w=0;for(const z of t().activeStates)w+=z.damageBonus;if(w!==0){const z=U.match(/(\d+d\d+)([+-]\d+)?/);if(z){const[,Re,Ne]=z,Fe=(Ne?parseInt(Ne):0)+w;U=`${Re}${Fe>=0?"+":""}${Fe}`}else U=`${(parseInt(U)||0)+w}`}}K("roll",{notation:U,attackName:b.name,applyHalfDamage:X})}function je(){ft.update(b=>({...b,attacks:!b.attacks}))}let $e=j([]),be=j(!1);ea(async()=>{o($e,await Ja()),o(be,!0)});function V(b){return e($e).find(U=>U.name===b)}function W(b){t().classFeatures.spellSlotsByLevel||st(Q,r(t).classFeatures.spellSlotsByLevel={},r(t)),t().classFeatures.spellSlotsByLevel[b]||st(Q,r(t).classFeatures.spellSlotsByLevel[b]=Array(2).fill(!1),r(t));const X=t().classFeatures.spellSlotsByLevel[b].findIndex(w=>!w);return X===-1?!1:(Q.update(w=>(w.classFeatures.spellSlotsByLevel||(w.classFeatures.spellSlotsByLevel={}),w.classFeatures.spellSlotsByLevel[b]||(w.classFeatures.spellSlotsByLevel[b]=Array(2).fill(!1)),w.classFeatures.spellSlotsByLevel[b][X]=!0,w)),!0)}function ne(b,U){let X=b.damage,w=0,z=0;if(Qs(U)&&(z+=Bs(t(),d())),t().activeStates)for(const _ of t().activeStates)z+=_.damageBonus;if(U.higherLevelSlot&&b.castAtLevel){const _=U.level,ie=(b.castAtLevel||_)-_;if(ie>0){const de=U.higherLevelSlot.match(/(\d+)d(\d+)\s+for\s+each.*?level\s+above/i);if(de){const[,me]=de;w+=ie*parseInt(me)}}}if(b.targetIsFiendOrUndead&&U.description.includes("Fiend or an Undead")){const _=U.description.match(/increases by (\d+)d(\d+) if.*?Fiend or.*?Undead/i);if(_){const[,u]=_;w+=parseInt(u)}}const Re=X.match(/(\d+)d(\d+)([+-]\d+)?/);if(!Re)return z!==0?z>=0?`${z}`:`${z}`:X||"0";const[,Ne,Ge,Fe]=Re,Xe=parseInt(Ne)+w,Ye=(Fe?parseInt(Fe):0)+z;let E=`${Xe}d${Ge}`;return Ye!==0&&(E+=Ye>=0?`+${Ye}`:`${Ye}`),E}function ge(b){const U=[];for(let w=b.level;w<=9;w++){const z=t().classFeatures.spellSlotsByLevel?.[w];z&&z.length>0&&U.push(w)}return U}function le(){Q.update(b=>(b.activeStates||(b.activeStates=[]),b.activeStates=[...b.activeStates,{name:"",attackBonus:0,damageBonus:0,description:""}],b))}function Ue(b){Q.update(U=>(U.activeStates&&(U.activeStates=U.activeStates.filter((X,w)=>w!==b)),U))}Ze(()=>(t(),f()),()=>{o(A,t().attacks.filter(b=>{if(!f())return!0;const U=f().toLowerCase();return b.name.toLowerCase().includes(U)||b.damageType.toLowerCase().includes(U)}).sort((b,U)=>!b.spellRef&&U.spellRef?-1:b.spellRef&&!U.spellRef?1:0))}),Ze(()=>(f(),e(A)),()=>{o(re,!f()||e(A).length>0||"attack".includes(f().toLowerCase())||"spell".includes(f().toLowerCase()))}),Rt(),kt();var $=Ll();let ce;var Y=i($),he=a(i(Y),2),h=i(he,!0);l(he),l(Y);var R=a(Y,2);{var ve=b=>{var U=Cl(),X=We(U),w=a(X,2),z=i(w);nt(z,1,()=>e(A),_=>_.id,(_,u,ie)=>{var de=ml(),me=i(de),P=i(me);Se(P);var Z=a(P,2);{var x=I=>{var ee=Ys();D("click",ee,()=>pe(e(u).id)),c(I,ee)};S(Z,I=>{L()&&I(x)})}l(me);var Ce=a(me,2),ke=i(Ce),Pe=a(i(ke),2);Se(Pe),l(ke);var He=a(ke,2),Ve=a(i(He),2);Se(Ve),l(He);var Be=a(He,2),J=a(i(Be),2);Se(J),l(Be),l(Ce);var ue=a(Ce,2);{var Oe=I=>{var ee=it(),ae=We(ee);{var Te=H=>{var v=Xs();c(H,v)},m=H=>{const v=at(()=>(e(u),r(()=>V(e(u).spellRef))));var we=it(),Ke=We(we);{var Qe=Ie=>{var Ee=ul(),xe=We(Ee);{var Ae=bt=>{var ht=Zs(),Ft=a(i(ht),2),Wt=i(Ft,!0);l(Ft),l(ht),B(()=>C(Wt,(e(u),r(()=>e(u).generalNotes)))),c(bt,ht)};S(xe,bt=>{e(u),r(()=>e(u).generalNotes)&&bt(Ae)})}var jt=a(xe,2),$t=i(jt),gt=a(i($t),2),Ht=i(gt,!0);l(gt),l($t);var pa=a($t,2);{var Qa=bt=>{var ht=tl(),Ft=i(ht),Wt=a(i(Ft));l(Ft);var zt=a(Ft,2),fa=a(i(zt));l(zt);var Dt=a(zt,2),mt=a(i(Dt));l(Dt);var Ut=a(Dt,2),Nt=a(i(Ut)),aa=a(Nt);{var Bt=Je=>{var lt=pt();B(()=>C(lt,`(${G(e(v)),r(()=>e(v).material)??""})`)),c(Je,lt)};S(aa,Je=>{G(e(v)),r(()=>e(v).material)&&Je(Bt)})}l(Ut);var Vt=a(Ut,2),sa=a(i(Vt),2);{var la=Je=>{var lt=pt("Concentration,");c(Je,lt)};S(sa,Je=>{G(e(v)),r(()=>e(v).concentration)&&Je(la)})}var ba=a(sa,1,!0);l(Vt);var Kt=a(Vt,2),ga=a(i(Kt));l(Kt);var rt=a(Kt,2);{var vt=Je=>{var lt=el(),Ct=a(i(lt));l(lt),B(()=>C(Ct,` ${G(e(v)),r(()=>e(v).higherLevelSlot)??""}`)),c(Je,lt)};S(rt,Je=>{G(e(v)),r(()=>e(v).higherLevelSlot)&&Je(vt)})}l(ht),B(Je=>{C(Wt,` ${G(e(v)),r(()=>e(v).level)??""}`),C(fa,` ${G(e(v)),r(()=>e(v).castingTime||e(v).actionType)??""}`),C(mt,` ${G(e(v)),r(()=>e(v).range)??""}`),C(Nt,` ${Je??""}`),C(ba,(G(e(v)),r(()=>e(v).duration))),C(ga,` ${G(e(v)),r(()=>e(v).description)??""}`)},[()=>(G(e(v)),r(()=>e(v).components.join(", ")))]),c(bt,ht)};S(pa,bt=>{e(N),e(u),r(()=>!e(N)[e(u).id])&&bt(Qa)})}l(jt);var Ya=a(jt,2);{var Xa=bt=>{const ht=at(()=>(G(e(v)),r(()=>ge(e(v)))));var Ft=it(),Wt=We(Ft);{var zt=Dt=>{const mt=at(()=>(G(oa),G(e(v)),r(()=>oa(e(v)))));var Ut=vl(),Nt=We(Ut),aa=i(Nt),Bt=a(aa,2);B(()=>{e(u),ut(()=>{e(ht)})}),nt(Bt,5,()=>e(ht),ct,(rt,vt)=>{var Je=al(),lt=i(Je);l(Je);var Ct={};B(()=>{C(lt,`Level ${e(vt)??""}`),Ct!==(Ct=e(vt))&&(Je.value=(Je.__value=e(vt))??"")}),c(rt,Je)}),l(Bt);var Vt=a(Bt,2);{var sa=rt=>{const vt=at(()=>(e(u),G(e(v)),r(()=>ne(e(u),e(v)))));var Je=sl(),lt=i(Je);{var Ct=wt=>{var Mt=pt("Healing");c(wt,Mt)},Gt=wt=>{var Mt=pt("Damage");c(wt,Mt)};S(lt,wt=>{G(e(v)),r(()=>se(e(v)))?wt(Ct):wt(Gt,!1)})}var At=a(lt);l(Je),B(()=>C(At,` ${e(vt)??""}`)),c(rt,Je)};S(Vt,rt=>{e(u),G(e(v)),r(()=>e(u).castAtLevel&&e(u).castAtLevel>e(v).level)&&rt(sa)})}l(Nt);var la=a(Nt,2);{var ba=rt=>{var vt=il(),Je=i(vt),lt=i(Je);Se(lt);var Ct=a(lt,2);{var Gt=At=>{const wt=at(()=>(e(u),G(e(v)),r(()=>ne(e(u),e(v)))));var Mt=ll(),ha=i(Mt);l(Mt),B(()=>C(ha,`(+1d8, total: ${e(wt)??""})`)),c(At,Mt)};S(Ct,At=>{e(u),r(()=>e(u).targetIsFiendOrUndead)&&At(Gt)})}l(Je),l(vt),va(lt,()=>e(u).targetIsFiendOrUndead,At=>(e(u).targetIsFiendOrUndead=At,ut(()=>(e(A),t(),f())))),c(rt,vt)};S(la,rt=>{G(e(v)),r(()=>e(v).description.includes("Fiend or an Undead"))&&rt(ba)})}var Kt=a(la,2);{var ga=rt=>{var vt=cl(),Je=i(vt),lt=i(Je);Se(lt);var Ct=a(lt),Gt=a(Ct);{var At=dt=>{var It=rl(),ma=i(It);l(It),B(_a=>C(ma,`(Spell Save DC: ${_a??""})`),[()=>(G(Da),t(),d(),r(()=>Da(t(),d())))]),c(dt,It)};S(Gt,dt=>{t(),r(()=>t().class)&&dt(At)})}var wt=a(Gt,2);{var Mt=dt=>{var It=nl();c(dt,It)},ha=dt=>{var It=it(),ma=We(It);{var _a=ya=>{var Za=ol();c(ya,Za)};S(ma,ya=>{e(u),G(e(mt)),r(()=>e(u).targetSucceededSave&&e(mt).noDamageOnSave)&&ya(_a)},!0)}c(dt,It)};S(wt,dt=>{e(u),G(e(mt)),r(()=>e(u).targetSucceededSave&&e(mt).halfDamageOnSave)?dt(Mt):dt(ha,!1)})}l(Je),l(vt),B(dt=>C(Ct,` Target succeeded on ${dt??""} save `),[()=>(G(e(mt)),r(()=>e(mt).ability.charAt(0).toUpperCase()+e(mt).ability.slice(1)))]),va(lt,()=>e(u).targetSucceededSave,dt=>(e(u).targetSucceededSave=dt,ut(()=>(e(A),t(),f())))),c(rt,vt)};S(Kt,rt=>{e(mt)&&rt(ga)})}B(()=>{et(aa,"for",`castLevel-${e(u),r(()=>e(u).id)??""}`),et(Bt,"id",`castLevel-${e(u),r(()=>e(u).id)??""}`)}),Va(Bt,()=>e(u).castAtLevel,rt=>(e(u).castAtLevel=rt,ut(()=>(e(A),t(),f())))),c(Dt,Ut)},fa=Dt=>{var mt=dl();c(Dt,mt)};S(Wt,Dt=>{G(e(ht)),r(()=>e(ht).length>0)?Dt(zt):Dt(fa,!1)})}c(bt,Ft)};S(Ya,bt=>{G(e(v)),r(()=>e(v).higherLevelSlot&&e(v).level>0)&&bt(Xa)})}B(()=>{et(gt,"aria-label",(e(N),e(u),r(()=>e(N)[e(u).id]?"Expand":"Collapse"))),C(Ht,(e(N),e(u),r(()=>e(N)[e(u).id]?"â–¼":"â–²")))}),D("click",$t,()=>_e(e(u).id)),D("keydown",$t,bt=>bt.key==="Enter"&&_e(e(u).id)),c(Ie,Ee)},qe=Ie=>{var Ee=pl();c(Ie,Ee)};S(Ke,Ie=>{e(v)?Ie(Qe):Ie(qe,!1)})}c(H,we)};S(ae,H=>{e($e),r(()=>e($e).length===0)?H(Te):H(m,!1)})}c(I,ee)};S(ue,I=>{e(u),r(()=>e(u).spellRef)&&I(Oe)})}var Le=a(ue,2);{var te=I=>{var ee=fl(),ae=a(i(ee),2);Qt(ae),l(ee),Me(ae,()=>e(u).notes,Te=>(e(u).notes=Te,ut(()=>(e(A),t(),f())))),c(I,ee)};S(Le,I=>{e(u),r(()=>!e(u).spellRef)&&I(te)})}var De=a(Le,2),g=i(De);{var F=I=>{var ee=bl();D("click",ee,()=>fe(e(u))),c(I,ee)};S(g,I=>{e(u),r(()=>e(u).bonus!==0||!e(u).spellRef)&&I(F)})}var O=a(g,2);{var q=I=>{const ee=at(()=>(e(u),r(()=>V(e(u).spellRef))));var ae=gl(),Te=i(ae);{var m=v=>{var we=pt("Roll Healing");c(v,we)},H=v=>{var we=pt("Roll Damage");c(v,we)};S(Te,v=>{G(e(ee)),r(()=>e(ee)&&se(e(ee)))?v(m):v(H,!1)})}l(ae),D("click",ae,()=>M(e(u))),c(I,ae)},oe=I=>{var ee=hl();D("click",ee,()=>M(e(u))),c(I,ee)};S(O,I=>{e(u),e(be),r(()=>e(u).spellRef&&e(be))?I(q):I(oe,!1)})}l(De),l(de),Me(P,()=>e(u).name,I=>(e(u).name=I,ut(()=>(e(A),t(),f())))),Me(Pe,()=>e(u).bonus,I=>(e(u).bonus=I,ut(()=>(e(A),t(),f())))),Me(Ve,()=>e(u).damage,I=>(e(u).damage=I,ut(()=>(e(A),t(),f())))),Me(J,()=>e(u).damageType,I=>(e(u).damageType=I,ut(()=>(e(A),t(),f())))),c(_,de)});var Re=a(z,2);{var Ne=_=>{var u=_l();c(_,u)},Ge=_=>{var u=it(),ie=We(u);{var de=me=>{var P=yl();c(me,P)};S(ie,me=>{e(A),r(()=>e(A).length===0)&&me(de)},!0)}c(_,u)};S(Re,_=>{t(),r(()=>t().attacks.length===0)?_(Ne):_(Ge,!1)})}l(w);var Fe=a(w,2),Xe=a(i(Fe),4),tt=a(Xe,2);{var Ye=_=>{var u=Sl();nt(u,5,()=>(t(),r(()=>t().activeStates)),ct,(ie,de,me)=>{var P=xl(),Z=i(P),x=i(Z);Se(x);var Ce=a(x,2);{var ke=Le=>{var te=kl();D("click",te,()=>Ue(me)),c(Le,te)};S(Ce,Le=>{L()&&Le(ke)})}l(Z);var Pe=a(Z,2),He=i(Pe),Ve=a(i(He),2);Se(Ve),l(He);var Be=a(He,2),J=a(i(Be),2);Se(J),l(Be),l(Pe);var ue=a(Pe,2),Oe=a(i(ue),2);Se(Oe),l(ue),l(P),Me(x,()=>e(de).name,Le=>(e(de).name=Le,ut(()=>t()),ia(T,"$character"))),Me(Ve,()=>e(de).attackBonus,Le=>(e(de).attackBonus=Le,ut(()=>t()),ia(T,"$character"))),Me(J,()=>e(de).damageBonus,Le=>(e(de).damageBonus=Le,ut(()=>t()),ia(T,"$character"))),Me(Oe,()=>e(de).description,Le=>(e(de).description=Le,ut(()=>t()),ia(T,"$character"))),c(ie,P)}),l(u),c(_,u)},E=_=>{var u=$l();c(_,u)};S(tt,_=>{t(),r(()=>t().activeStates&&t().activeStates.length>0)?_(Ye):_(E,!1)})}l(Fe),D("click",X,ye),D("click",Xe,le),c(b,U)};S(R,b=>{y(),r(()=>!y().attacks)&&b(ve)})}l($),B(()=>{ce=ot($,1,"attacks svelte-14o91c5",null,ce,{hidden:!e(re)}),et(he,"aria-label",(y(),r(()=>y().attacks?"Expand":"Collapse"))),C(h,(y(),r(()=>y().attacks?"â–¼":"â–²")))}),D("click",he,je),c(s,$),St(),k()}var wl=p('<span class="slot-checkbox-x svelte-serp1j">&#8212;</span>'),jl=p('<label><input type="checkbox" class="slot-checkbox-input svelte-serp1j"/> <span><!></span></label>');function Ba(s,n){xt(n,!1);const t=()=>ze(Yt,"$isEditMode",d),[d,f]=Lt();let y=_t(n,"checked",8,!1),L=_t(n,"disabled",8,!1),T=_t(n,"className",8,""),k=_t(n,"index",8,void 0),A=_t(n,"ariaLabel",8,void 0);const re=Tt();function K(fe){re("change",{checked:fe.currentTarget.checked,index:k()})}kt();var N=jl(),_e=i(N);Se(_e);var se=a(_e,2),ye=i(se);{var pe=fe=>{var M=wl();c(fe,M)};S(ye,fe=>{y()&&fe(pe)})}l(se),l(N),B(()=>{ot(N,1,"slot-checkbox-label "+T()+(t()?"":" not-editable"),"svelte-serp1j"),ys(_e,y()),_e.disabled=L()||!t(),et(_e,"aria-label",A()),et(_e,"tabindex",t()?0:-1),ot(se,1,`slot-checkbox-custom ${y()?"used":""} ${t()?"":"readonly"}`,"svelte-serp1j")}),D("change",_e,K),c(s,N),St(),f()}var Fl=p('<p class="no-features svelte-1kpvv0n">Select a class to see available features</p>'),Al=p('<p class="no-features svelte-1kpvv0n">No class features available at this level</p>'),Ml=p('<div class="spell-slots svelte-1kpvv0n"><label class="svelte-1kpvv0n"> </label> <div class="slots-tracker svelte-1kpvv0n"></div></div>'),Rl=p('<div class="all-spell-slots"></div>'),Il=p('<div class="feature-box spellcasting svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"> </h3> <div class="spell-stats svelte-1kpvv0n"><div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Spell Save DC</label> <div class="spell-value svelte-1kpvv0n"> </div></div> <div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <div class="spell-value svelte-1kpvv0n"> </div></div></div> <!> <div class="prepared-spells svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <textarea placeholder="List your prepared spells..." class="svelte-1kpvv0n"></textarea></div></div>'),El=p('<p class="unlimited svelte-1kpvv0n">Unlimited Uses</p>'),Pl=p('<div class="slots-tracker svelte-1kpvv0n"></div> <div class="uses-actions-row"><button class="btn btn-primary use-enabled"> </button></div> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div>',1),Bl=p('<div class="uses-tracker svelte-1kpvv0n"><!></div>'),Tl=p('<div class="pool-tracker svelte-1kpvv0n"><input type="number" min="0" class="pool-input svelte-1kpvv0n"/> <span> </span> <button class="btn-small svelte-1kpvv0n"> </button></div>'),Hl=p('<p class="no-uses svelte-1kpvv0n">No Channel Divinity uses remaining</p>'),Ul=p('<div class="channel-divinity-option svelte-1kpvv0n"><button class="btn btn-primary use-enabled svelte-1kpvv0n">Use Channel Divinity</button> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div> <!></div>'),Nl=p('<div class="feature-box svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"><!> </h3> <p class="feature-description svelte-1kpvv0n"> </p> <!></div>'),Gl=p('<div class="features-grid svelte-1kpvv0n"><!> <!></div>'),Ol=p('<section><div class="header svelte-1kpvv0n"><h2 class="svelte-1kpvv0n">Class Features</h2> <button class="collapse-btn svelte-1kpvv0n"> </button></div> <!></section>');function ql(s,n){xt(n,!1);const t=()=>ze(Q,"$character",L),d=()=>ze(ta,"$abilityModifiers",L),f=()=>ze(Pt,"$searchFilter",L),y=()=>ze(ft,"$collapsedStates",L),[L,T]=Lt(),k=j(),A=j(),re=j(),K=j(),N=j(),_e=j(),se=j();let ye=j(0),pe=j(0);function fe(h,R){Q.update(ve=>(ve.classFeatures.features[h]=R,ve))}function M(){Q.update(h=>(h.classFeatures.spellSlotsByLevel||(h.classFeatures.spellSlotsByLevel={}),e(K).forEach(({level:R,slots:ve})=>{h.classFeatures.spellSlotsByLevel[R]||(h.classFeatures.spellSlotsByLevel[R]=Array(ve).fill(!1))}),h))}function je(h){if(typeof h.maxUses=="function"){if((h.name==="Divine Sense"||h.name==="War Priest")&&e(k)?.spellcastingAbility){const R=d()[e(k).spellcastingAbility];return h.maxUses(t().level,R)}return h.maxUses(t().level)}return h.maxUses||0}function $e(h,R){Q.update(ve=>((!ve.classFeatures.features[h]||!Array.isArray(ve.classFeatures.features[h])||ve.classFeatures.features[h].length!==R)&&(ve.classFeatures.features[h]=Array(R).fill(!1)),ve))}es(()=>{e(_e)&&t()&&t().classFeatures&&t().classFeatures.features&&e(_e).forEach(h=>{if(h.type==="uses"){const R=h.name.replace(/\s+/g,""),ve=je(h),b=t().classFeatures.features[R];(!Array.isArray(b)||b.length!==ve)&&$e(R,ve)}})});function be(h){return typeof h.maxPool=="function"?h.maxPool(t().level):h.maxPool||0}function V(h){return typeof h.description=="function"?h.description(t().level):h.description}function W(){const h="ChannelDivinity";Q.update(R=>{const ve=R.classFeatures.features[h];return typeof ve=="number"&&ve>0&&(R.classFeatures.features[h]=ve-1),R})}function ne(){ft.update(h=>({...h,classFeatures:!h.classFeatures}))}Ze(()=>(t(),yt),()=>{o(k,t().class?yt(t().class):null)}),Ze(()=>(t(),qt),()=>{o(A,t().class?qt(t().class,t().level,t().subclass):[])}),Ze(()=>(t(),Ia),()=>{o(re,t().class?Ia(t().class,t().level):0)}),Ze(()=>(e(k),t()),()=>{o(K,(()=>{if(!e(k)?.spellcaster)return[];const h=t().level,R=[];return h>=1&&R.push({level:1,slots:Math.min(4,2+Math.floor(h/3))}),h>=3&&R.push({level:2,slots:Math.min(3,2+Math.floor((h-3)/4))}),h>=5&&R.push({level:3,slots:Math.min(3,2+Math.floor((h-5)/5))}),h>=7&&R.push({level:4,slots:Math.min(3,1+Math.floor((h-7)/6))}),h>=9&&R.push({level:5,slots:Math.min(2,1+Math.floor((h-9)/8))}),h>=11&&R.push({level:6,slots:1}),h>=13&&R.push({level:7,slots:1}),h>=15&&R.push({level:8,slots:1}),h>=17&&R.push({level:9,slots:1}),R})())}),Ze(()=>(e(k),d(),t(),Ea),()=>{if(e(k)?.spellcaster&&e(k).spellcastingAbility){const h=d()[e(k).spellcastingAbility];o(ye,$s(t().class,h,t().proficiencyBonus)||0),o(pe,Ea(t().class,t().level,h))}}),Ze(()=>(t(),e(k),e(K)),()=>{t().class&&e(k)?.spellcaster&&e(K).length>0&&M()}),Ze(()=>t(),()=>{o(N,(()=>{const R=t().classFeatures.features["ChannelDivinity"];return typeof R=="number"?R:0})())}),Ze(()=>(e(A),f()),()=>{o(_e,e(A).filter(h=>{if(!f())return!0;const R=f().toLowerCase();return h.name.toLowerCase().includes(R)||V(h).toLowerCase().includes(R)}))}),Ze(()=>(f(),t(),e(_e)),()=>{o(se,!f()||t().class||"class features".includes(f().toLowerCase())||"spellcasting".includes(f().toLowerCase())||e(_e).length>0)}),Rt(),kt();var ge=Ol();let le;var Ue=i(ge),$=a(i(Ue),2),ce=i($,!0);l($),l(Ue);var Y=a(Ue,2);{var he=h=>{var R=it(),ve=We(R);{var b=X=>{var w=Fl();c(X,w)},U=X=>{var w=it(),z=We(w);{var Re=Ge=>{var Fe=Al();c(Ge,Fe)},Ne=Ge=>{var Fe=Gl(),Xe=i(Fe);{var tt=E=>{var _=Il(),u=i(_),ie=i(u);l(u);var de=a(u,2),me=i(de),P=a(i(me),2),Z=i(P,!0);l(P),l(me);var x=a(me,2),Ce=a(i(x),2),ke=i(Ce,!0);l(Ce),l(x),l(de);var Pe=a(de,2);{var He=J=>{var ue=Rl();nt(ue,5,()=>e(K),ct,(Oe,Le)=>{let te=()=>e(Le).level,De=()=>e(Le).slots;const g=at(()=>(t(),te(),De(),r(()=>t().classFeatures.spellSlotsByLevel?.[te()]||Array(De()).fill(!1))));var F=Ml(),O=i(F),q=i(O);l(O);var oe=a(O,2);nt(oe,5,()=>e(g),ct,(I,ee,ae)=>{{let Te=at(()=>(G(e(g)),r(()=>e(g)[ae]||!1)));Ba(I,{get checked(){return e(Te)},$$events:{change:m=>{Q.update(H=>(H.classFeatures.spellSlotsByLevel||(H.classFeatures.spellSlotsByLevel={}),H.classFeatures.spellSlotsByLevel[te()]||(H.classFeatures.spellSlotsByLevel[te()]=Array(De()).fill(!1)),H.classFeatures.spellSlotsByLevel[te()][ae]=m.detail.checked,H))}}})}}),l(oe),l(F),B(()=>C(q,`${te()===1?"1st":te()===2?"2nd":te()===3?"3rd":`${te()}th`} Level Spell Slots`)),c(Oe,F)}),l(ue),c(J,ue)};S(Pe,J=>{e(K),r(()=>e(K).length>0)&&J(He)})}var Ve=a(Pe,2),Be=a(i(Ve),2);Qt(Be),l(Ve),l(_),B(J=>{C(ie,`Spellcasting (${J??""})`),C(Z,e(ye)),C(ke,e(pe))},[()=>(e(k),r(()=>e(k).spellcastingAbility?.toUpperCase()))]),Me(Be,()=>t().classFeatures.preparedSpells,J=>st(Q,r(t).classFeatures.preparedSpells=J,r(t))),c(E,_)};S(Xe,E=>{e(k),r(()=>e(k)?.spellcaster)&&E(tt)})}var Ye=a(Xe,2);nt(Ye,1,()=>e(_e),ct,(E,_)=>{const u=at(()=>(e(_),r(()=>e(_).name.replace(/\s+/g,"")))),ie=at(()=>(t(),G(e(u)),r(()=>t().classFeatures.features[e(u)]))),de=at(()=>typeof e(ie)=="number");var me=Nl(),P=i(me),Z=i(P);{var x=J=>{var ue=pt("Channel Divinity:");c(J,ue)};S(Z,J=>{e(_),r(()=>e(_).type==="channelDivinity")&&J(x)})}var Ce=a(Z);l(P);var ke=a(P,2),Pe=i(ke,!0);l(ke);var He=a(ke,2);{var Ve=J=>{const ue=at(()=>(e(_),r(()=>je(e(_))))),Oe=at(()=>(G(e(ie)),G(e(ue)),r(()=>Array.isArray(e(ie))?e(ie):Array(e(ue)).fill(!1))));var Le=Bl(),te=i(Le);{var De=F=>{var O=El();c(F,O)},g=F=>{var O=Pl(),q=We(O);nt(q,5,()=>e(Oe),ct,(H,v,we)=>{Ba(H,{get checked(){return e(v)},index:we,$$events:{change:Ke=>{Q.update(Qe=>(Qe.classFeatures.features[e(u)]||(Qe.classFeatures.features[e(u)]=Array(e(ue)).fill(!1)),Qe.classFeatures.features[e(u)][we]=Ke.detail.checked,Qe))}}})}),l(q);var oe=a(q,2),I=i(oe),ee=i(I);l(I),l(oe);var ae=a(oe,2),Te=i(ae),m=i(Te);l(Te),l(ae),B(H=>{I.disabled=H,C(ee,`Use ${e(_),r(()=>e(_).name)??""}`),C(m,`Resets on ${e(_),r(()=>e(_).resetOn==="short"?"Short Rest":"Long Rest")??""}`)},[()=>(G(e(Oe)),r(()=>e(Oe).filter(H=>!H).length<=0))]),D("click",I,()=>{Q.update(H=>{H.classFeatures.features[e(u)]||(H.classFeatures.features[e(u)]=Array(e(ue)).fill(!1));const v=H.classFeatures.features[e(u)],we=v.findIndex(Ke=>!Ke);return we!==-1&&(v[we]=!0),H})}),c(F,O)};S(te,F=>{e(ue)===1/0?F(De):F(g,!1)})}l(Le),c(J,Le)},Be=J=>{var ue=it(),Oe=We(ue);{var Le=De=>{const g=at(()=>(e(_),r(()=>be(e(_)))));var F=Tl(),O=i(F);Se(O);var q=a(O,2),oe=i(q);l(q);var I=a(q,2),ee=i(I,!0);l(I),l(F),B(()=>{ja(O,e(de)&&e(ie)!==void 0?e(ie):e(g)),et(O,"max",e(g)),C(oe,`/ ${e(g)??""}`),C(ee,(e(_),r(()=>e(_).resetOn==="short"?"Short Rest":"Long Rest")))}),D("input",O,ae=>{Q.update(Te=>(Te.classFeatures.features[e(u)]=parseInt(ae.currentTarget.value)||0,Te))}),D("click",I,()=>fe(e(u),e(g))),c(De,F)},te=De=>{var g=it(),F=We(g);{var O=q=>{var oe=Ul(),I=i(oe),ee=a(I,2),ae=i(ee),Te=i(ae);l(ae),l(ee);var m=a(ee,2);{var H=v=>{var we=Hl();c(v,we)};S(m,v=>{e(N)<=0&&v(H)})}l(oe),B(()=>{I.disabled=e(N)<=0,C(Te,`Resets on ${e(_),r(()=>e(_).resetOn==="short"?"Short Rest":"Long Rest")??""}`)}),D("click",I,W),c(q,oe)};S(F,q=>{e(_),r(()=>e(_).type==="channelDivinity")&&q(O)},!0)}c(De,g)};S(Oe,De=>{e(_),r(()=>e(_).type==="pool")?De(Le):De(te,!1)},!0)}c(J,ue)};S(He,J=>{e(_),r(()=>e(_).type==="uses")?J(Ve):J(Be,!1)})}l(me),B(J=>{C(Ce,` ${e(_),r(()=>e(_).name)??""}`),C(Pe,J)},[()=>(e(_),r(()=>V(e(_))))]),c(E,me)}),l(Fe),c(Ge,Fe)};S(z,Ge=>{e(A),r(()=>e(A).length===0)?Ge(Re):Ge(Ne,!1)},!0)}c(X,w)};S(ve,X=>{t(),r(()=>!t().class)?X(b):X(U,!1)})}c(h,R)};S(Y,h=>{y(),r(()=>!y().classFeatures)&&h(he)})}l(ge),B(()=>{le=ot(ge,1,"class-features svelte-1kpvv0n",null,le,{hidden:!e(se)}),et($,"aria-label",(y(),r(()=>y().classFeatures?"Expand":"Collapse"))),C(ce,(y(),r(()=>y().classFeatures?"â–¼":"â–²")))}),D("click",$,ne),c(s,ge),St(),T()}var Wl=p('<textarea placeholder="Enter features, traits, and special abilities..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Equipment</h3> <textarea placeholder="List your equipment and inventory..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Notes</h3> <textarea placeholder="Additional notes..." class="svelte-wttn0l"></textarea>',1),zl=p('<section><div class="header svelte-wttn0l"><h2 class="svelte-wttn0l">Features & Traits</h2> <button class="collapse-btn svelte-wttn0l"> </button></div> <!></section>');function Vl(s,n){xt(n,!1);const t=()=>ze(Pt,"$searchFilter",y),d=()=>ze(Q,"$character",y),f=()=>ze(ft,"$collapsedStates",y),[y,L]=Lt(),T=j();function k(){ft.update(pe=>({...pe,notes:!pe.notes}))}Ze(()=>(t(),d()),()=>{o(T,!t()||"features".includes(t().toLowerCase())||"traits".includes(t().toLowerCase())||"equipment".includes(t().toLowerCase())||"notes".includes(t().toLowerCase())||d().features.toLowerCase().includes(t().toLowerCase())||d().equipment.toLowerCase().includes(t().toLowerCase())||d().notes.toLowerCase().includes(t().toLowerCase()))}),Rt(),kt();var A=zl();let re;var K=i(A),N=a(i(K),2),_e=i(N,!0);l(N),l(K);var se=a(K,2);{var ye=pe=>{var fe=Wl(),M=We(fe);Qt(M);var je=a(M,4);Qt(je);var $e=a(je,4);Qt($e),Me(M,()=>d().features,be=>st(Q,r(d).features=be,r(d))),Me(je,()=>d().equipment,be=>st(Q,r(d).equipment=be,r(d))),Me($e,()=>d().notes,be=>st(Q,r(d).notes=be,r(d))),c(pe,fe)};S(se,pe=>{f(),r(()=>!f().notes)&&pe(ye)})}l(A),B(()=>{re=ot(A,1,"notes svelte-wttn0l",null,re,{hidden:!e(T)}),et(N,"aria-label",(f(),r(()=>f().notes?"Expand":"Collapse"))),C(_e,(f(),r(()=>f().notes?"â–¼":"â–²")))}),D("click",N,k),c(s,A),St(),L()}var Kl=p('<div class="color-picker-section svelte-1r90jgp"><h3 class="svelte-1r90jgp">Dice Colors</h3> <div class="color-inputs svelte-1r90jgp"><div class="color-input-group svelte-1r90jgp"><label for="dice-color" class="svelte-1r90jgp">Dice Color</label> <input type="color" id="dice-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="label-color" class="svelte-1r90jgp">Label Color</label> <input type="color" id="label-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="desk-color" class="svelte-1r90jgp">Background Color</label> <input type="color" id="desk-color" class="svelte-1r90jgp"/></div></div></div>'),Jl=p('<div class="loading svelte-1r90jgp"><p class="svelte-1r90jgp">Loading 3D dice...</p></div>'),Ql=p('<div class="custom-dice-selector svelte-1r90jgp"><h3 class="svelte-1r90jgp">Choose Dice to Roll</h3> <div class="dice-inputs svelte-1r90jgp"><div class="dice-input-group svelte-1r90jgp"><label for="d4" class="svelte-1r90jgp">d4</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d4" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d6" class="svelte-1r90jgp">d6</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d6" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d8" class="svelte-1r90jgp">d8</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d8" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d10" class="svelte-1r90jgp">d10</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d10" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d12" class="svelte-1r90jgp">d12</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d12" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d20" class="svelte-1r90jgp">d20</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d20" min="0" max="10"/></div></div> <div class="dice-controls svelte-1r90jgp"><button class="btn btn-primary use-enabled svelte-1r90jgp"> </button> <button class="btn btn-secondary use-enabled svelte-1r90jgp">Reset</button></div></div>'),Yl=p('<span class="crit-badge svelte-1r90jgp">CRITICAL!</span>'),Xl=p('<p class="svelte-1r90jgp"> </p>'),Zl=p('<p class="modifier-text svelte-1r90jgp"> </p>'),ei=p('<button class="btn btn-follow-up svelte-1r90jgp"> </button>'),ti=p('<button class="btn btn-guided-strike svelte-1r90jgp">âš¡ Use Guided Strike (+10)</button>'),ai=p('<div class="follow-up-actions svelte-1r90jgp"><!> <!></div>'),si=p('<div class="result-header svelte-1r90jgp"><h3 class="svelte-1r90jgp"> </h3> <!></div> <div class="result-total svelte-1r90jgp"> </div> <div class="result-details svelte-1r90jgp"><!> <!></div> <!>',1),li=p('<div role="button" tabindex="-1"><div class="modal-content svelte-1r90jgp" role="dialog" tabindex="0"><div class="modal-header svelte-1r90jgp"><h2 class="svelte-1r90jgp">Dice Roller</h2> <div class="header-buttons svelte-1r90jgp"><button class="color-btn svelte-1r90jgp" title="Customize dice colors">ðŸŽ¨</button> <button class="close-btn svelte-1r90jgp">Ã—</button></div></div> <!> <!> <div class="dice-main-area svelte-1r90jgp"><div class="dice-container svelte-1r90jgp"></div> <!></div> <div><!></div></div></div>');function ii(s,n){xt(n,!1);const t=()=>ze(Q,"$character",d),[d,f]=Lt(),y=j(),L=j(),T=j(),k=Tt();let A=_t(n,"notation",12,""),re=_t(n,"visible",8,!1),K=_t(n,"damageNotation",12,""),N=_t(n,"attackName",12,""),_e=_t(n,"applyHalfDamage",8,!1),se=null,ye=j(void 0),pe=j(!1),fe=j(""),M=j(null);function je(){return e(M)?.resultTotal??null}let $e=j(0),be=j(0),V=j(0),W=j(0),ne=j(0),ge=j(0),le=j(0),Ue=j([]),$=j(!1),ce=j("other"),Y=j(!1),he=j("#051e0a"),h=j("#ffffff"),R=j("#3a2004"),ve=j(!1);function b(g){return g.length===9&&g.startsWith("#")?g.substring(0,7):g}function U(g,F="ff"){return g.length===7&&g.startsWith("#")?g+F:g}function X(){if(window.DICE&&e(ye))try{se&&e(ye)&&qa(ye,e(ye).innerHTML="");const g=e(ye).clientWidth||500,F=e(ye).clientHeight||300;se=new window.DICE.dice_box(e(ye),{w:g,h:F}),o(pe,!0)}catch(g){console.error("Error initializing dice box:",g)}}ea(()=>{const g=q=>new Promise((oe,I)=>{if(document.querySelector(`script[src="${q}"]`)){console.log(`Script already loaded: ${q}`),oe(null);return}const ae=document.createElement("script");ae.src=q,ae.onload=()=>{console.log(`Loaded: ${q}`),oe(null)},ae.onerror=()=>{console.error(`Failed to load: ${q}`),I(new Error(`Failed to load ${q}`))},document.head.appendChild(ae)});setTimeout(()=>{g(`${Jt}/libs/three.min.js`).then(()=>g(`${Jt}/libs/cannon.min.js`)).then(()=>g(`${Jt}/libs/teal.js`)).then(()=>g(`${Jt}/dice.js`)).then(()=>{if(console.log("All scripts loaded, initializing dice box..."),console.log("DICE available:",!!window.DICE),console.log("Container available:",!!e(ye)),window.DICE){const q=window.DICE.getColors();o(he,b(q.dice_color)),o(h,b(q.label_color)),o(R,b(q.desk_color))}X()}).catch(q=>{console.error("Failed to load dice libraries:",q)})},100);const F=()=>{e(pe)&&(console.log("Window resized, reinitializing dice box..."),X())},O=q=>{re()&&q.key==="Escape"&&Ye()};return window.addEventListener("resize",F),window.addEventListener("keydown",O),()=>{window.removeEventListener("resize",F),window.removeEventListener("keydown",O)}});function w(g,F="other"){if(!se||!e(pe))return;console.log("Rolling dice:",g,"type:",F),o(ce,F),o(Y,!1),se.diceToRoll=g;const O=oe=>(console.log("Before roll:",oe),null),q=oe=>{console.log("After roll:",oe);let I=oe.resultTotal,ee=oe.resultString;if(_e()&&(I=Math.floor(I/2),ee=ee+" (halved)"),o(M,{...oe,resultTotal:I,resultString:ee}),F==="attack"||F==="check"||F==="save"){const ae=oe.results?.filter(Te=>Te.sides===20)||[];if(ae.length>0){const Te=ae[0].value;o($,Te===20)}}if(o(Ue,[]),F==="attack"&&K())if(e($)){const ae=Ne(K());e(Ue).push({label:`Roll Critical Damage (${ae})`,notation:ae})}else e(Ue).push({label:`Roll Damage (${K()})`,notation:K()})};se.start_throw(O,q)}function z(){const g=[];e($e)>0&&g.push(`${e($e)}d4`),e(be)>0&&g.push(`${e(be)}d6`),e(V)>0&&g.push(`${e(V)}d8`),e(W)>0&&g.push(`${e(W)}d10`),e(ne)>0&&g.push(`${e(ne)}d12`),e(ge)>0&&g.push(`${e(ge)}d20`);let F=g.join("+")||"1d20";return e(le)!==0&&(F+=e(le)>=0?`+${e(le)}`:`${e(le)}`),F}function Re(){const g=z();w(g)}function Ne(g){return g.replace(/(\d+)d(\d+)/g,(F,O,q)=>`${parseInt(O)*2}d${q}`)}function Ge(){o($e,0),o(be,0),o(V,0),o(W,0),o(ne,0),o(ge,0),o(le,0),o(M,null),o(Ue,[]),o($,!1),o(ce,"other"),o(Y,!1)}function Fe(){window.DICE&&(window.DICE.setColors({dice_color:U(e(he),"ff"),label_color:U(e(h),"ff"),desk_color:e(R)}),se&&(se.updateDeskColor(e(R)),se.updateDiceColors()))}function Xe(){o(ve,!e(ve))}function tt(){!e(M)||e(L)<=0||e(Y)||(o(M,{...e(M),resultTotal:e(M).resultTotal+10,resultString:e(M).resultString+" + 10 (Guided Strike)"}),Q.update(g=>{const F="ChannelDivinity",O=g.classFeatures.features[F];return typeof O=="number"&&O>0&&(g.classFeatures.features[F]=O-1),g}),o(Y,!0))}function Ye(){k("close"),A(""),K(""),N(""),o(fe,""),o(M,null),o(Y,!1),Ge()}Ze(()=>(t(),qt),()=>{o(y,t().class?qt(t().class,t().level,t().subclass).some(F=>F.name==="Guided Strike"):!1)}),Ze(()=>t(),()=>{o(L,(()=>{const F=t().classFeatures.features["ChannelDivinity"];return typeof F=="number"?F:0})())}),Ze(()=>(e($e),e(be),e(V),e(W),e(ne),e(ge),e(le)),()=>{o(T,(()=>{const g=[];e($e)>0&&g.push(`${e($e)}d4`),e(be)>0&&g.push(`${e(be)}d6`),e(V)>0&&g.push(`${e(V)}d8`),e(W)>0&&g.push(`${e(W)}d10`),e(ne)>0&&g.push(`${e(ne)}d12`),e(ge)>0&&g.push(`${e(ge)}d20`);let F=g.join("+")||"1d20";return e(le)!==0&&(F+=e(le)>=0?`+${e(le)}`:`${e(le)}`),F})())}),Ze(()=>(G(A()),e(pe),G(re()),e(fe),G(K()),G(N())),()=>{if(A()&&e(pe)&&re()&&A()!==e(fe)){o(fe,A()),o(M,null),o(Ue,[]),o($,!1),o(Y,!1);const g=A().includes("1d20")?"attack":"other";console.log("Auto-roll triggered. notation:",A(),"damageNotation:",K(),"attackName:",N()),setTimeout(()=>w(A(),g),200)}}),Rt();var E={getLastRollTotal:je};kt();var _=li();let u;var ie=i(_),de=i(ie),me=a(i(de),2),P=i(me),Z=a(P,2);l(me),l(de);var x=a(de,2);{var Ce=g=>{var F=Kl(),O=a(i(F),2),q=i(O),oe=a(i(q),2);Se(oe),l(q);var I=a(q,2),ee=a(i(I),2);Se(ee),l(I);var ae=a(I,2),Te=a(i(ae),2);Se(Te),l(ae),l(O),l(F),Me(oe,()=>e(he),m=>o(he,m)),D("change",oe,Fe),Me(ee,()=>e(h),m=>o(h,m)),D("change",ee,Fe),Me(Te,()=>e(R),m=>o(R,m)),D("change",Te,Fe),c(g,F)};S(x,g=>{e(ve)&&g(Ce)})}var ke=a(x,2);{var Pe=g=>{var F=Jl();c(g,F)};S(ke,g=>{e(pe)||g(Pe)})}var He=a(ke,2),Ve=i(He);$a(Ve,g=>o(ye,g),()=>e(ye));var Be=a(Ve,2);{var J=g=>{var F=Ql(),O=a(i(F),2),q=i(O),oe=a(i(q),2);Se(oe),l(q);var I=a(q,2),ee=a(i(I),2);Se(ee),l(I);var ae=a(I,2),Te=a(i(ae),2);Se(Te),l(ae);var m=a(ae,2),H=a(i(m),2);Se(H),l(m);var v=a(m,2),we=a(i(v),2);Se(we),l(v);var Ke=a(v,2),Qe=a(i(Ke),2);Se(Qe),l(Ke),l(O);var qe=a(O,2),Ie=i(qe),Ee=i(Ie);l(Ie);var xe=a(Ie,2);l(qe),l(F),B(()=>{Ie.disabled=!e(pe),C(Ee,`Roll ${e(T)??""}`)}),Me(oe,()=>e($e),Ae=>o($e,Ae)),Me(ee,()=>e(be),Ae=>o(be,Ae)),Me(Te,()=>e(V),Ae=>o(V,Ae)),Me(H,()=>e(W),Ae=>o(W,Ae)),Me(we,()=>e(ne),Ae=>o(ne,Ae)),Me(Qe,()=>e(ge),Ae=>o(ge,Ae)),D("click",Ie,Re),D("click",xe,Ge),c(g,F)};S(Be,g=>{A()||g(J)})}l(He);var ue=a(He,2);let Oe;var Le=i(ue);{var te=g=>{var F=si(),O=We(F),q=i(O),oe=i(q,!0);l(q);var I=a(q,2);{var ee=Ie=>{var Ee=Yl();c(Ie,Ee)};S(I,Ie=>{e($)&&Ie(ee)})}l(O);var ae=a(O,2),Te=i(ae,!0);l(ae);var m=a(ae,2),H=i(m);{var v=Ie=>{var Ee=Xl(),xe=i(Ee,!0);l(Ee),B(()=>C(xe,(e(M),r(()=>e(M).resultString)))),c(Ie,Ee)};S(H,Ie=>{e(M),r(()=>e(M).resultString)&&Ie(v)})}var we=a(H,2);{var Ke=Ie=>{var Ee=Zl(),xe=i(Ee);l(Ee),B(()=>C(xe,`Modifier: ${e(M),r(()=>e(M).constant>=0?"+":"")??""}${e(M),r(()=>e(M).constant)??""}`)),c(Ie,Ee)};S(we,Ie=>{e(M),r(()=>e(M).constant)&&Ie(Ke)})}l(m);var Qe=a(m,2);{var qe=Ie=>{var Ee=ai(),xe=i(Ee);nt(xe,1,()=>e(Ue),ct,($t,gt)=>{var Ht=ei(),pa=i(Ht,!0);l(Ht),B(()=>C(pa,(e(gt),r(()=>e(gt).label)))),D("click",Ht,()=>w(e(gt).notation,"damage")),c($t,Ht)});var Ae=a(xe,2);{var jt=$t=>{var gt=ti();B(()=>{gt.disabled=e(L)<=0,et(gt,"title",e(L)<=0?"No Channel Divinity uses remaining":"Use Channel Divinity to add +10 to this attack roll")}),D("click",gt,tt),c($t,gt)};S(Ae,$t=>{e(y)&&e(ce)==="attack"&&!e(Y)&&$t(jt)})}l(Ee),c(Ie,Ee)};S(Qe,Ie=>{e(Ue),e(y),e(ce),e(Y),r(()=>e(Ue).length>0||e(y)&&e(ce)==="attack"&&!e(Y))&&Ie(qe)})}B(()=>{C(oe,N()?`${N()} - Result`:"Result"),C(Te,(e(M),r(()=>e(M).resultTotal)))}),c(g,F)};S(Le,g=>{e(M)&&g(te)})}l(ue),l(ie),l(_),B(()=>{u=ot(_,1,"modal-overlay svelte-1r90jgp",null,u,{hidden:!re()}),Oe=ot(ue,1,"roll-result svelte-1r90jgp",null,Oe,{"has-result":e(M)})}),D("click",P,Xe),D("click",Z,Ye),D("click",ie,Aa(function(g){Ot.call(this,n,g)})),D("keydown",ie,function(g){Ot.call(this,n,g)}),D("click",_,Ye),D("keydown",_,g=>g.key==="Escape"&&Ye()),c(s,_),xs(n,"getLastRollTotal",je);var De=St(E);return f(),De}const ua="https://api.github.com/gists";async function ri(s,n,t){if(!n)throw new Error("GitHub token is required");const d=JSON.stringify(s,null,2),f=`${s.name||"character"}_dnd.json`,y={description:t||`D&D Character: ${s.name}`,public:!1,files:{[f]:{content:d}}},L=await fetch(ua,{method:"POST",headers:{Authorization:`token ${n}`,"Content-Type":"application/json"},body:JSON.stringify(y)});if(!L.ok)throw new Error(`Failed to create gist: ${L.statusText}`);return(await L.json()).id}async function ni(s,n,t){if(!n||!t)throw new Error("GitHub token and Gist ID are required");const d=JSON.stringify(s,null,2),y={files:{[`${s.name||"character"}_dnd.json`]:{content:d}}},L=await fetch(`${ua}/${t}`,{method:"PATCH",headers:{Authorization:`token ${n}`,"Content-Type":"application/json"},body:JSON.stringify(y)});if(!L.ok)throw new Error(`Failed to update gist: ${L.statusText}`)}async function oi(s,n){if(!s)throw new Error("Gist ID is required");const t={"Content-Type":"application/json"};n&&(t.Authorization=`token ${n}`);const d=await fetch(`${ua}/${s}`,{method:"GET",headers:t});if(!d.ok)throw new Error(`Failed to load gist: ${d.statusText}`);const f=await d.json(),y=Object.values(f.files);if(y.length===0)throw new Error("No files found in gist");const T=y[0].content;try{const k=JSON.parse(T);return k.attacks&&Array.isArray(k.attacks)&&(k.attacks=k.attacks.map(A=>({...A,id:A.id||crypto.randomUUID()}))),k.classFeatures?(k.classFeatures.features||(k.classFeatures.features={}),k.classFeatures.spellSlots||(k.classFeatures.spellSlots=[]),k.classFeatures.preparedSpells===void 0&&(k.classFeatures.preparedSpells="")):k.classFeatures={features:{},spellSlots:[],preparedSpells:""},k}catch{throw new Error("Invalid character data in gist")}}function Ta(s){typeof window<"u"&&localStorage.setItem("dnd_gist_config",JSON.stringify(s))}function ci(){if(typeof window<"u"){const s=localStorage.getItem("dnd_gist_config");if(s)return JSON.parse(s)}return{}}async function vi(s,n=30){if(!s)throw new Error("GitHub token is required to list gists");const t=await fetch(`${ua}?per_page=${n}`,{method:"GET",headers:{Authorization:`token ${s}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error(`Failed to list gists: ${t.statusText}`);return await t.json()}var di=p('<div class="error-message svelte-1jb5ckg"> </div>'),ui=p('<div class="toggle-container svelte-1jb5ckg"><button type="button" class="toggle-btn svelte-1jb5ckg"> </button></div>'),pi=p('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID (leave empty to create new)</label> <input type="text" id="gistId" placeholder="Optional: existing Gist ID to update" class="svelte-1jb5ckg"/></div>'),fi=p('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),bi=p('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),gi=p('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Update (or leave unselected to create new)</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),hi=p('<div class="info-message svelte-1jb5ckg">No gists found. A new one will be created.</div>'),mi=p('<!> <div class="form-group svelte-1jb5ckg"><label for="description" class="svelte-1jb5ckg"> </label> <input type="text" id="description" placeholder="D&amp;D Character Sheet" class="svelte-1jb5ckg"/></div>',1),_i=p('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID *</label> <input type="text" id="gistId" placeholder="Enter Gist ID (for public or your private gists)" required class="svelte-1jb5ckg"/></div>'),yi=p('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),ki=p('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),xi=p('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Load</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),Si=p('<div class="info-message svelte-1jb5ckg">No gists found. Enter a Gist ID manually or create a new one in Save mode.</div>'),$i=p('<div class="modal-overlay svelte-1jb5ckg" role="button" tabindex="-1"><div class="modal-content svelte-1jb5ckg" role="dialog" tabindex="0"><div class="modal-header svelte-1jb5ckg"><h2 class="svelte-1jb5ckg"> </h2> <button class="close-btn svelte-1jb5ckg">Ã—</button></div> <div class="modal-body svelte-1jb5ckg"><!> <div class="form-group svelte-1jb5ckg"><label for="token" class="svelte-1jb5ckg"> <a href="https://github.com/settings/tokens" target="_blank" rel="noopener" class="svelte-1jb5ckg">Get token</a></label> <input type="password" id="token" placeholder="ghp_xxxxxxxxxxxxx" class="svelte-1jb5ckg"/></div> <!> <!> <div class="modal-actions svelte-1jb5ckg"><button class="btn btn-primary svelte-1jb5ckg"><!></button> <button class="btn btn-secondary svelte-1jb5ckg">Cancel</button></div></div></div></div>');function Ci(s,n){xt(n,!1);const t=()=>ze(Q,"$character",d),[d,f]=Lt(),y=Tt();let L=_t(n,"mode",8,"save"),T=j(""),k=j(""),A=j(""),re=j(!1),K=j(""),N=j(!1),_e=j(!1),se=j([]),ye=j(null);const pe=ci();pe.token&&o(T,pe.token),pe.gistId&&o(k,pe.gistId),ea(async()=>{e(T)&&!e(N)&&await fe()});async function fe(){if(e(T)){o(_e,!0),o(K,"");try{o(se,await vi(e(T))),e(k)&&o(ye,e(se).find(E=>E.id===e(k))||null)}catch(E){o(K,E.message||"Failed to load gists"),o(se,[])}finally{o(_e,!1)}}}function M(E){o(ye,E),o(k,E.id)}function je(){o(N,!e(N)),o(K,""),!e(N)&&e(T)&&fe()}async function $e(){if(!e(T)){o(K,"GitHub token is required");return}const E=e(ye)?.id||e(k);o(re,!0),o(K,"");try{if(E)await ni(t(),e(T),E),o(k,E),Xt.add("Character updated in Gist successfully!","success");else{const _=await ri(t(),e(T),e(A));o(k,_),Xt.add(`Character saved to Gist! ID: ${_}`,"success")}Ta({token:e(T),gistId:e(k)}),y("close")}catch(_){o(K,_.message||"Failed to save to Gist")}finally{o(re,!1)}}async function be(){const E=e(ye)?.id||e(k);if(!E){o(K,"Please select a gist or enter a Gist ID");return}o(re,!0),o(K,"");try{const _=await oi(E,e(T)||void 0);Q.set(_),o(k,E),Ta({token:e(T),gistId:e(k)}),Xt.add("Character loaded from Gist successfully!","success"),y("close")}catch(_){o(K,_.message||"Failed to load from Gist")}finally{o(re,!1)}}function V(){y("close")}kt();var W=$i(),ne=i(W),ge=i(ne),le=i(ge),Ue=i(le,!0);l(le);var $=a(le,2);l(ge);var ce=a(ge,2),Y=i(ce);{var he=E=>{var _=di(),u=i(_,!0);l(_),B(()=>C(u,e(K))),c(E,_)};S(Y,E=>{e(K)&&E(he)})}var h=a(Y,2),R=i(h),ve=i(R);Wa(),l(R);var b=a(R,2);Se(b),l(h);var U=a(h,2);{var X=E=>{var _=ui(),u=i(_),ie=i(u,!0);l(u),l(_),B(()=>{u.disabled=e(re),C(ie,e(N)?"ðŸ“‹ Show My Gists":"âœï¸ Enter Gist ID Manually")}),D("click",u,je),c(E,_)};S(U,E=>{(L()==="load"||L()==="save"&&e(T))&&E(X)})}var w=a(U,2);{var z=E=>{var _=mi(),u=We(_);{var ie=Ce=>{var ke=pi(),Pe=a(i(ke),2);Se(Pe),l(ke),B(()=>Pe.disabled=e(re)),Me(Pe,()=>e(k),He=>o(k,He)),c(Ce,ke)},de=Ce=>{var ke=it(),Pe=We(ke);{var He=Be=>{var J=fi();c(Be,J)},Ve=Be=>{var J=it(),ue=We(J);{var Oe=te=>{var De=gi(),g=a(i(De),2);nt(g,5,()=>e(se),ct,(F,O)=>{var q=bi();let oe;var I=i(q),ee=i(I),ae=i(ee,!0);l(ee);var Te=a(ee,2),m=i(Te,!0);l(Te),l(I);var H=a(I,2),v=i(H),we=i(v);l(v);var Ke=a(v,2),Qe=i(Ke);l(Ke),l(H),l(q),B(qe=>{oe=ot(q,1,"gist-item svelte-1jb5ckg",null,oe,{selected:e(ye)?.id===e(O).id}),q.disabled=e(re),C(ae,(e(O),r(()=>e(O).description||"Untitled"))),C(m,(e(O),r(()=>e(O).public?"ðŸŒ Public":"ðŸ”’ Private"))),C(we,`ID: ${e(O),r(()=>e(O).id)??""}`),C(Qe,`Updated: ${qe??""}`)},[()=>(e(O),r(()=>new Date(e(O).updated_at).toLocaleDateString()))]),D("click",q,()=>M(e(O))),c(F,q)}),l(g),l(De),c(te,De)},Le=te=>{var De=it(),g=We(De);{var F=O=>{var q=hi();c(O,q)};S(g,O=>{e(T)&&O(F)},!0)}c(te,De)};S(ue,te=>{e(se),r(()=>e(se).length>0)?te(Oe):te(Le,!1)},!0)}c(Be,J)};S(Pe,Be=>{e(_e)?Be(He):Be(Ve,!1)},!0)}c(Ce,ke)};S(u,Ce=>{e(N)||!e(T)?Ce(ie):Ce(de,!1)})}var me=a(u,2),P=i(me),Z=i(P);l(P);var x=a(P,2);Se(x),l(me),B(()=>{C(Z,`Description ${e(k)?"(optional)":""}`),x.disabled=e(re)}),Me(x,()=>e(A),Ce=>o(A,Ce)),c(E,_)},Re=E=>{var _=it(),u=We(_);{var ie=me=>{var P=_i(),Z=a(i(P),2);Se(Z),l(P),B(()=>Z.disabled=e(re)),Me(Z,()=>e(k),x=>o(k,x)),c(me,P)},de=me=>{var P=it(),Z=We(P);{var x=ke=>{var Pe=yi();c(ke,Pe)},Ce=ke=>{var Pe=it(),He=We(Pe);{var Ve=J=>{var ue=xi(),Oe=a(i(ue),2);nt(Oe,5,()=>e(se),ct,(Le,te)=>{var De=ki();let g;var F=i(De),O=i(F),q=i(O,!0);l(O);var oe=a(O,2),I=i(oe,!0);l(oe),l(F);var ee=a(F,2),ae=i(ee),Te=i(ae);l(ae);var m=a(ae,2),H=i(m);l(m),l(ee),l(De),B(v=>{g=ot(De,1,"gist-item svelte-1jb5ckg",null,g,{selected:e(ye)?.id===e(te).id}),De.disabled=e(re),C(q,(e(te),r(()=>e(te).description||"Untitled"))),C(I,(e(te),r(()=>e(te).public?"ðŸŒ Public":"ðŸ”’ Private"))),C(Te,`ID: ${e(te),r(()=>e(te).id)??""}`),C(H,`Updated: ${v??""}`)},[()=>(e(te),r(()=>new Date(e(te).updated_at).toLocaleDateString()))]),D("click",De,()=>M(e(te))),c(Le,De)}),l(Oe),l(ue),c(J,ue)},Be=J=>{var ue=it(),Oe=We(ue);{var Le=te=>{var De=Si();c(te,De)};S(Oe,te=>{e(T)&&te(Le)},!0)}c(J,ue)};S(He,J=>{e(se),r(()=>e(se).length>0)?J(Ve):J(Be,!1)},!0)}c(ke,Pe)};S(Z,ke=>{e(_e)?ke(x):ke(Ce,!1)},!0)}c(me,P)};S(u,me=>{e(N)||!e(T)?me(ie):me(de,!1)})}c(E,_)};S(w,E=>{L()==="save"?E(z):E(Re,!1)})}var Ne=a(w,2),Ge=i(Ne),Fe=i(Ge);{var Xe=E=>{var _=pt();B(()=>C(_,L()==="save"?"Saving...":"Loading...")),c(E,_)},tt=E=>{var _=pt();B(()=>C(_,L()==="save"?"Save":"Load")),c(E,_)};S(Fe,E=>{e(re)?E(Xe):E(tt,!1)})}l(Ge);var Ye=a(Ge,2);l(Ne),l(ce),l(ne),l(W),B(()=>{C(Ue,L()==="save"?"Save to GitHub Gist":"Load from GitHub Gist"),C(ve,`GitHub Token ${L()==="load"?"(optional for public gists)":"(required)"} `),b.disabled=e(re),Ge.disabled=e(re),Ye.disabled=e(re)}),D("click",$,V),Me(b,()=>e(T),E=>o(T,E)),D("blur",b,()=>{e(T)&&!e(N)&&fe()}),D("click",Ge,function(...E){(L()==="save"?$e:be)?.apply(this,E)}),D("click",Ye,V),D("click",ne,Aa(function(E){Ot.call(this,n,E)})),D("keydown",ne,function(E){Ot.call(this,n,E)}),D("click",W,V),D("keydown",W,E=>E.key==="Escape"&&V()),c(s,W),St(),f()}var Li=p('<div class="loading svelte-1ngjemu">Loading D&D data...</div>'),Di=p("<option> </option>"),wi=p('<select class="level-filter svelte-1ngjemu"><option>All Levels</option><option>Cantrip</option><!></select>'),ji=p('<div class="no-results svelte-1ngjemu"> </div>'),Fi=p('<div class="item-meta svelte-1ngjemu"> </div>'),Ai=p('<div class="item-meta svelte-1ngjemu"> </div>'),Mi=p('<button><div class="item-name svelte-1ngjemu"> </div> <!></button>'),Ri=p('<p class="higher-levels"><strong>At Higher Levels:</strong> </p>'),Ii=p('<p class="cantrip-upgrade"><strong>Cantrip Upgrade:</strong> </p>'),Ei=p('<h3 class="svelte-1ngjemu"> </h3> <p class="spell-meta svelte-1ngjemu"><!> <!></p> <p class="spell-classes"><strong>Classes:</strong> </p> <div class="spell-stats svelte-1ngjemu"><div><strong>Casting Time:</strong> </div> <div><strong>Range:</strong> </div> <div><strong>Components:</strong> <!></div> <div><strong>Duration:</strong> <!> </div></div> <p class="description svelte-1ngjemu"> </p> <!> <!>',1),Pi=p('<p class="prerequisite svelte-1ngjemu"><strong>Prerequisite:</strong> </p>'),Bi=p('<h3 class="svelte-1ngjemu"> </h3> <!> <p class="description svelte-1ngjemu"> </p> <a target="_blank" rel="noopener" class="source-link svelte-1ngjemu">View Full Details â†’</a>',1),Ti=p('<div class="item-details svelte-1ngjemu"><!></div>'),Hi=p('<div class="controls svelte-1ngjemu"><div class="tabs svelte-1ngjemu"><button> </button> <button> </button></div> <div class="search-controls svelte-1ngjemu"><input type="text" placeholder="Search by name or description..." class="search-input svelte-1ngjemu"/> <!></div></div> <div class="content-container svelte-1ngjemu"><div class="items-list svelte-1ngjemu"><!></div> <!></div>',1),Ui=p('<div class="modal-backdrop svelte-1ngjemu" role="presentation"><div class="modal svelte-1ngjemu" role="dialog" aria-modal="true" tabindex="-1"><div class="modal-header svelte-1ngjemu"><h2 class="svelte-1ngjemu">Browse D&D Spells & Feats</h2> <button class="close-btn svelte-1ngjemu" aria-label="Close">&times;</button></div> <div class="modal-body svelte-1ngjemu"><!></div> <div class="modal-footer svelte-1ngjemu"><button class="btn-secondary svelte-1ngjemu">Cancel</button> <button class="btn-primary svelte-1ngjemu">Add to Character Sheet</button></div></div></div>');function Ni(s,n){xt(n,!1);const t=j(),d=j(),f=j();let y=_t(n,"onClose",8),L=j("spell"),T=j(!0),k=j(""),A=j(null),re=j([]),K=j([]),N=j(null);ea(async()=>{o(T,!0);try{o(re,await Ja()),o(K,await Vs())}catch($){console.error("Failed to load data:",$)}finally{o(T,!1)}});function _e($){o(N,$)}function se($){const ce=$.match(/(\d+d\d+(?:\s*\+\s*\d+)?)/i);return ce?ce[1]:""}function ye($){const ce=$.split(/\.( |$)/)[0].trim(),Y=Array.from($.matchAll(/\*\*(.*?)\*\*/g)).map(h=>h[1].replace(/\.$/,""));let he=ce;return Y.length&&(he+=" | Effects: "+Y.join(", ")),he}function pe(){if(e(N)){if(e(L)==="spell"){const $=e(N);Q.update(ce=>{const he=[];$.range&&he.push(`Range: ${$.range}`),$.castingTime&&he.push(`Cast: ${$.castingTime}`),$.duration&&he.push(`Duration: ${$.duration}`),$.actionType==="Save"&&he.push("Saving throw spell"),$.components&&$.components.length>0&&he.push(`Components: ${$.components.join(", ")}`),$.material&&he.push(`Material: ${$.material}`);const h=he.join(" | "),R=ye($.description),ve={id:crypto.randomUUID(),name:`${$.name}${$.concentration?" (C)":""}${$.ritual?" (R)":""}`,bonus:$.actionType==="Attack"?5:0,damage:se($.description),damageType:`${$.school} (Lvl ${$.level})`,spellRef:$.name,infoNotes:h,generalNotes:R,castAtLevel:$.level};return ce.attacks=[...ce.attacks,ve],ce})}else if(e(L)==="feat"){const $=e(N);Q.update(ce=>{const Y=`${$.name}${$.prerequisite?` (Req: ${$.prerequisite})`:""}
${$.description}
`;return ce.features=ce.features?`${ce.features}
${Y}`:Y,ce})}o(N,null),y()()}}Ze(()=>(e(A),e(re),e(k)),()=>{o(t,e(A)!==null?Ks(Pa(e(re),e(k)),e(A)):Pa(e(re),e(k)))}),Ze(()=>(e(K),e(k)),()=>{o(d,Js(e(K),e(k)))}),Ze(()=>(e(L),e(t),e(d)),()=>{o(f,e(L)==="spell"?e(t):e(d))}),Rt(),kt();var fe=Ui(),M=i(fe),je=i(M),$e=a(i(je),2);l(je);var be=a(je,2),V=i(be);{var W=$=>{var ce=Li();c($,ce)},ne=$=>{var ce=Hi(),Y=We(ce),he=i(Y),h=i(he);let R;var ve=i(h);l(h);var b=a(h,2);let U;var X=i(b);l(b),l(he);var w=a(he,2),z=i(w);Se(z);var Re=a(z,2);{var Ne=u=>{var ie=wi();B(()=>{e(A),ut(()=>{})});var de=i(ie);de.value=(de.__value=null)??"";var me=a(de);me.value=me.__value=0;var P=a(me);nt(P,0,()=>[1,2,3,4,5,6,7,8,9],ct,(Z,x)=>{var Ce=Di(),ke=i(Ce);l(Ce);var Pe={};B(()=>{C(ke,`Level ${x??""}`),Pe!==(Pe=x)&&(Ce.value=(Ce.__value=x)??"")}),c(Z,Ce)}),l(ie),Va(ie,()=>e(A),Z=>o(A,Z)),c(u,ie)};S(Re,u=>{e(L)==="spell"&&u(Ne)})}l(w),l(Y);var Ge=a(Y,2),Fe=i(Ge),Xe=i(Fe);{var tt=u=>{var ie=ji(),de=i(ie);l(ie),B(()=>C(de,`No ${e(L)??""}s found`)),c(u,ie)},Ye=u=>{var ie=it(),de=We(ie);nt(de,1,()=>e(f),ct,(me,P)=>{var Z=Mi();let x;var Ce=i(Z),ke=i(Ce,!0);l(Ce);var Pe=a(Ce,2);{var He=Be=>{const J=at(()=>e(P));var ue=Fi(),Oe=i(ue);l(ue),B(()=>C(Oe,`Level ${G(e(J)),r(()=>e(J).level)??""} â€¢ ${G(e(J)),r(()=>e(J).school)??""}`)),c(Be,ue)},Ve=Be=>{const J=at(()=>e(P));var ue=it(),Oe=We(ue);{var Le=te=>{var De=Ai(),g=i(De,!0);l(De),B(()=>C(g,(G(e(J)),r(()=>e(J).prerequisite)))),c(te,De)};S(Oe,te=>{G(e(J)),r(()=>e(J).prerequisite)&&te(Le)})}c(Be,ue)};S(Pe,Be=>{e(L)==="spell"?Be(He):Be(Ve,!1)})}l(Z),B(()=>{x=ot(Z,1,"item-card svelte-1ngjemu",null,x,{selected:e(N)?.name===e(P).name}),C(ke,(e(P),r(()=>e(P).name)))}),D("click",Z,()=>_e(e(P))),c(me,Z)}),c(u,ie)};S(Xe,u=>{e(f),r(()=>e(f).length===0)?u(tt):u(Ye,!1)})}l(Fe);var E=a(Fe,2);{var _=u=>{var ie=Ti(),de=i(ie);{var me=Z=>{const x=at(()=>e(N));var Ce=Ei(),ke=We(Ce),Pe=i(ke,!0);l(ke);var He=a(ke,2),Ve=i(He);{var Be=xe=>{var Ae=pt();B(()=>C(Ae,`${G(e(x)),r(()=>e(x).school)??""} cantrip`)),c(xe,Ae)},J=xe=>{var Ae=pt();B(()=>C(Ae,`Level ${G(e(x)),r(()=>e(x).level)??""} ${G(e(x)),r(()=>e(x).school)??""}`)),c(xe,Ae)};S(Ve,xe=>{G(e(x)),r(()=>e(x).level===0)?xe(Be):xe(J,!1)})}var ue=a(Ve,2);{var Oe=xe=>{var Ae=pt("(ritual)");c(xe,Ae)};S(ue,xe=>{G(e(x)),r(()=>e(x).ritual)&&xe(Oe)})}l(He);var Le=a(He,2),te=a(i(Le));l(Le);var De=a(Le,2),g=i(De),F=a(i(g));l(g);var O=a(g,2),q=a(i(O));l(O);var oe=a(O,2),I=a(i(oe)),ee=a(I);{var ae=xe=>{var Ae=pt();B(()=>C(Ae,`(${G(e(x)),r(()=>e(x).material)??""})`)),c(xe,Ae)};S(ee,xe=>{G(e(x)),r(()=>e(x).material)&&xe(ae)})}l(oe);var Te=a(oe,2),m=a(i(Te),2);{var H=xe=>{var Ae=pt("Concentration,");c(xe,Ae)};S(m,xe=>{G(e(x)),r(()=>e(x).concentration)&&xe(H)})}var v=a(m,1,!0);l(Te),l(De);var we=a(De,2),Ke=i(we,!0);l(we);var Qe=a(we,2);{var qe=xe=>{var Ae=Ri(),jt=a(i(Ae));l(Ae),B(()=>C(jt,` ${G(e(x)),r(()=>e(x).higherLevelSlot)??""}`)),c(xe,Ae)};S(Qe,xe=>{G(e(x)),r(()=>e(x).higherLevelSlot)&&xe(qe)})}var Ie=a(Qe,2);{var Ee=xe=>{var Ae=Ii(),jt=a(i(Ae));l(Ae),B(()=>C(jt,` ${G(e(x)),r(()=>e(x).cantripUpgrade)??""}`)),c(xe,Ae)};S(Ie,xe=>{G(e(x)),r(()=>e(x).cantripUpgrade)&&xe(Ee)})}B((xe,Ae)=>{C(Pe,(G(e(x)),r(()=>e(x).name))),C(te,` ${xe??""}`),C(F,` ${G(e(x)),r(()=>e(x).castingTime||e(x).actionType)??""}`),C(q,` ${G(e(x)),r(()=>e(x).range)??""}`),C(I,` ${Ae??""}`),C(v,(G(e(x)),r(()=>e(x).duration))),C(Ke,(G(e(x)),r(()=>e(x).description)))},[()=>(G(e(x)),r(()=>e(x).classes.join(", "))),()=>(G(e(x)),r(()=>e(x).components.join(", ").toUpperCase()))]),c(Z,Ce)},P=Z=>{const x=at(()=>e(N));var Ce=Bi(),ke=We(Ce),Pe=i(ke,!0);l(ke);var He=a(ke,2);{var Ve=Oe=>{var Le=Pi(),te=a(i(Le));l(Le),B(()=>C(te,` ${G(e(x)),r(()=>e(x).prerequisite)??""}`)),c(Oe,Le)};S(He,Oe=>{G(e(x)),r(()=>e(x).prerequisite)&&Oe(Ve)})}var Be=a(He,2),J=i(Be,!0);l(Be);var ue=a(Be,2);B(()=>{C(Pe,(G(e(x)),r(()=>e(x).name))),C(J,(G(e(x)),r(()=>e(x).description))),et(ue,"href",(G(e(x)),r(()=>e(x).source)))}),c(Z,Ce)};S(de,Z=>{e(L)==="spell"?Z(me):Z(P,!1)})}l(ie),c(u,ie)};S(E,u=>{e(N)&&u(_)})}l(Ge),B(()=>{R=ot(h,1,"tab svelte-1ngjemu",null,R,{active:e(L)==="spell"}),C(ve,`ðŸ“œ Spells (${e(re),r(()=>e(re).length)??""})`),U=ot(b,1,"tab svelte-1ngjemu",null,U,{active:e(L)==="feat"}),C(X,`â­ Feats (${e(K),r(()=>e(K).length)??""})`)}),D("click",h,()=>{o(L,"spell"),o(N,null),o(k,"")}),D("click",b,()=>{o(L,"feat"),o(N,null),o(k,"")}),Me(z,()=>e(k),u=>o(k,u)),c($,ce)};S(V,$=>{e(T)?$(W):$(ne,!1)})}l(be);var ge=a(be,2),le=i(ge),Ue=a(le,2);l(ge),l(M),l(fe),B(()=>Ue.disabled=!e(N)),D("click",$e,function(...$){y()?.apply(this,$)}),D("click",le,function(...$){y()?.apply(this,$)}),D("click",Ue,pe),D("click",M,Aa(function($){Ot.call(this,n,$)})),D("keydown",M,function($){Ot.call(this,n,$)}),D("click",fe,function(...$){y()?.apply(this,$)}),D("keydown",fe,$=>$.key==="Escape"&&y()()),c(s,fe),St()}var Gi=p('<link rel="icon" type="image/png" href="favicon4.png"/> <meta name="viewport" content="width=device-width, initial-scale=1"/>',1),Oi=p('<span class="character-name svelte-1uha8ag"> </span>'),qi=p("<span> </span>"),Wi=p('<div class="spell-slots-header svelte-1uha8ag"></div>'),zi=p('<div class="rest-menu svelte-1uha8ag"><button class="rest-option svelte-1uha8ag">â˜• Short Rest</button> <button class="rest-option svelte-1uha8ag">ðŸ›ï¸ Long Rest</button></div>'),Vi=p('<div class="container svelte-1uha8ag"><header class="svelte-1uha8ag"><div class="header-top svelte-1uha8ag"><div class="header-title svelte-1uha8ag"><div class="title-row svelte-1uha8ag"><h1 class="svelte-1uha8ag">D&D Character Sheet</h1> <!></div> <!></div> <div class="header-right svelte-1uha8ag"><div class="header-controls svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">ðŸŽ²</span><span class="btn-text svelte-1uha8ag">Roll Dice</span></button> <div class="rest-button-container svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">ðŸ˜´</span><span class="btn-text svelte-1uha8ag">Rest</span></button> <!></div> <div class="mode-toggle"><button><span class="btn-icon svelte-1uha8ag"> </span><span class="btn-text svelte-1uha8ag"> </span></button></div></div> <div class="header-search svelte-1uha8ag"><input type="text" placeholder="ðŸ” Search..." class="search-input use-enabled svelte-1uha8ag"/></div></div></div> <div class="header-actions svelte-1uha8ag"><button class="btn btn-mode svelte-1uha8ag">ðŸ“š Browse Spells & Feats</button> <button class="btn btn-secondary">Save to Gist</button> <button class="btn btn-secondary">Load from Gist</button> <button class="btn btn-secondary">Export JSON</button> <button class="btn btn-secondary">Import JSON</button> <input type="file" accept=".json" style="display: none;"/></div></header> <main class="svelte-1uha8ag"><!> <!> <!> <!> <!> <!> <!></main></div> <!> <!> <!> <!>',1);function ar(s,n){xt(n,!1);const t=()=>ze(Q,"$character",y),d=()=>ze(Yt,"$isEditMode",y),f=()=>ze(Pt,"$searchFilter",y),[y,L]=Lt();function T(){const m=[],H=t().classFeatures.spellSlotsByLevel||{};for(let v=1;v<=9;v++){const we=H[v];if(we&&we.length>0){const Ke=we.length,Qe=we.filter(qe=>qe).length;m.push({level:v,available:Ke-Qe,total:Ke})}}return m}let k=j(!1),A=j(!1),re=j(!1),K=j("save"),N=j(void 0),_e=j(""),se=j(""),ye=j(""),pe=j(!1),fe=j(),M=!1,je=j(!1);function $e(){const m=[];Q.update(v=>{const we=v.hitDice.current;v.hitDice.current=Math.min(v.hitDice.max,v.hitDice.current+Math.max(1,Math.floor(v.hitDice.max/2)));const Ke=v.hitDice.current-we;if(Ke>0&&m.push(`${Ke} hit ${Ke===1?"die":"dice"}`),v.class){const Qe=qt(v.class,v.level,v.subclass);v.classFeatures.features||(v.classFeatures.features={}),Qe.forEach(qe=>{if(qe.resetOn==="short"){const Ie=qe.name.replace(/\s+/g,"");if(qe.type==="uses"){const Ee=typeof qe.maxUses=="function"?qe.maxUses(v.level):qe.maxUses;v.classFeatures.features[Ie]=Array(Ee).fill(!1),m.push(qe.name)}else if(qe.type==="pool"){const Ee=typeof qe.maxPool=="function"?qe.maxPool(v.level):qe.maxPool;Ee!==void 0&&(v.classFeatures.features[Ie]=Ee,m.push(qe.name))}}})}return v}),o(je,!1);const H=m.length>0?`Short rest taken! Restored: ${m.join(", ")}`:"Short rest taken!";Xt.add(H,"success")}function be(){const m=[];Q.update(v=>{const we=v.maxHP-v.currentHP;we>0&&m.push(`${we} HP`),v.currentHP=v.maxHP,v.tempHP=0;const Ke=v.hitDice.max-v.hitDice.current;Ke>0&&m.push(`${Ke} hit ${Ke===1?"die":"dice"}`),v.hitDice.current=v.hitDice.max;let Qe=0;if(v.classFeatures.spellSlotsByLevel&&Object.keys(v.classFeatures.spellSlotsByLevel).forEach(qe=>{const Ie=v.classFeatures.spellSlotsByLevel[parseInt(qe)];if(Ie){const Ee=Ie.filter(xe=>xe).length;Qe+=Ee,v.classFeatures.spellSlotsByLevel[parseInt(qe)]=Array(Ie.length).fill(!1)}}),Qe>0&&m.push(`${Qe} spell ${Qe===1?"slot":"slots"}`),v.class){const qe=qt(v.class,v.level,v.subclass);v.classFeatures.features||(v.classFeatures.features={});let Ie=!1;qe.forEach(Ee=>{const xe=Ee.name.replace(/\s+/g,"");if(!(Ee.type==="info"||Ee.type==="channelDivinity")){if(Ee.type==="uses"){const Ae=typeof Ee.maxUses=="function"?Ee.maxUses(v.level):Ee.maxUses;v.classFeatures.features[xe]=Array(Ae).fill(!1),Ie=!0}else if(Ee.type==="pool"){const Ae=typeof Ee.maxPool=="function"?Ee.maxPool(v.level):Ee.maxPool;Ae!==void 0&&(v.classFeatures.features[xe]=Ae,Ie=!0)}}}),Ie&&m.push("all class features")}return v}),o(je,!1);const H=m.length>0?`Long rest taken! Restored: ${m.join(", ")}`:"Long rest taken! Fully rested.";Xt.add(H,"success")}function V(m){o(_e,""),o(se,""),o(ye,""),o(pe,!1),M=!1,typeof m=="string"?o(_e,m):(o(_e,m.notation),o(se,m.damageNotation||""),o(ye,m.attackName||""),o(pe,!!m.applyHalfDamage)),o(k,!0)}function W(m){const{notation:H}=m.detail;o(_e,""),M=!0,setTimeout(()=>{o(_e,H),o(se,""),o(ye,"Hit Die")},0),o(k,!0)}function ne(){if(o(k,!1),M&&e(fe)){const m=e(fe).getLastRollTotal();if(m!==null){const H=Math.max(1,m);Q.update(v=>(v.hitDice.current=Math.max(0,v.hitDice.current-1),v.currentHP=Math.min(v.maxHP,v.currentHP+H),v))}M=!1}}function ge(){console.log("toggleMode called, current isEditMode:",d()),Yt.update(m=>(console.log("Updating isEditMode from",m,"to",!m),!m))}function le(m){m.target.closest(".rest-button-container")||o(je,!1)}ea(()=>{console.log("onMount - initial isEditMode:",d()),console.log("onMount - body classes:",document.body.className);const m=Yt.subscribe(H=>{console.log("isEditMode subscription triggered, value:",H),console.log("Body classes before:",document.body.className),H?(document.body.classList.remove("use-mode"),console.log("Removed use-mode class (Edit Mode)")):(document.body.classList.add("use-mode"),console.log("Added use-mode class (Use Mode)")),console.log("Body classes after:",document.body.className)});return document.addEventListener("click",le),()=>{m(),document.removeEventListener("click",le)}});function Ue(){fs(t())}function $(){e(N)?.click()}async function ce(m){const v=m.target.files?.[0];if(v)try{const we=await bs(v);Q.set(we),alert("Character imported successfully!")}catch{alert("Failed to import character file")}}kt();var Y=Vi();us("1uha8ag",m=>{var H=Gi();Wa(2),Na(()=>{ds.title="D&D Character Sheet"}),c(m,H)});var he=We(Y),h=i(he),R=i(h),ve=i(R),b=i(ve),U=a(i(b),2);{var X=m=>{var H=Oi(),v=i(H,!0);l(H),B(()=>C(v,t().name)),c(m,H)};S(U,m=>{t().name&&m(X)})}l(b);var w=a(b,2);{var z=m=>{var H=Wi();nt(H,5,T,ct,(v,we)=>{var Ke=qi();let Qe;var qe=i(Ke);l(Ke),B(()=>{Qe=ot(Ke,1,"slot-badge svelte-1uha8ag",null,Qe,{depleted:e(we).available===0}),C(qe,`Lv${e(we).level??""}: ${e(we).available??""}/${e(we).total??""}`)}),c(v,Ke)}),l(H),c(m,H)};S(w,m=>{T().length>0&&m(z)})}l(ve);var Re=a(ve,2),Ne=i(Re),Ge=i(Ne),Fe=a(Ge,2),Xe=i(Fe),tt=a(Xe,2);{var Ye=m=>{var H=zi(),v=i(H),we=a(v,2);l(H),D("click",v,$e),D("click",we,be),c(m,H)};S(tt,m=>{e(je)&&m(Ye)})}l(Fe);var E=a(Fe,2),_=i(E);let u;var ie=i(_),de=i(ie,!0);l(ie);var me=a(ie),P=i(me,!0);l(me),l(_),l(E),l(Ne);var Z=a(Ne,2),x=i(Z);Se(x),l(Z),l(Re),l(R);var Ce=a(R,2),ke=i(Ce),Pe=a(ke,2),He=a(Pe,2),Ve=a(He,2),Be=a(Ve,2),J=a(Be,2);$a(J,m=>o(N,m),()=>e(N)),l(Ce),l(h);var ue=a(h,2),Oe=i(ue);As(Oe,{});var Le=a(Oe,2);Gs(Le,{$$events:{rollHitDice:W}});var te=a(Le,2);Es(te,{$$events:{roll:m=>V(m.detail)}});var De=a(te,2);zs(De,{$$events:{roll:m=>V(m.detail)}});var g=a(De,2);Dl(g,{$$events:{roll:m=>V(m.detail)}});var F=a(g,2);ql(F,{});var O=a(F,2);Vl(O,{}),l(ue),l(he);var q=a(he,2);$a(ii(q,{get notation(){return e(_e)},get damageNotation(){return e(se)},get attackName(){return e(ye)},get applyHalfDamage(){return e(pe)},get visible(){return e(k)},$$events:{close:ne},$$legacy:!0}),m=>o(fe,m),()=>e(fe));var oe=a(q,2);{var I=m=>{Ci(m,{get mode(){return e(K)},$$events:{close:()=>o(A,!1)}})};S(oe,m=>{e(A)&&m(I)})}var ee=a(oe,2);{var ae=m=>{Ni(m,{onClose:()=>o(re,!1)})};S(ee,m=>{e(re)&&m(ae)})}var Te=a(ee,2);ps(Te,{}),B(()=>{u=ot(_,1,"btn btn-mode svelte-1uha8ag",null,u,{"use-mode":!d()}),C(de,d()?"ðŸ“":"ðŸŽ²"),C(P,d()?"Edit Mode":"Use Mode")}),D("click",Ge,()=>o(k,!0)),D("click",Xe,()=>o(je,!e(je))),D("click",_,ge),Me(x,f,m=>gs(Pt,m)),D("click",ke,()=>o(re,!0)),D("click",Pe,()=>{o(K,"save"),o(A,!0)}),D("click",He,()=>{o(K,"load"),o(A,!0)}),D("click",Ve,Ue),D("click",Be,$),D("change",J,ce),c(s,Y),St(),L()}export{ar as component};
