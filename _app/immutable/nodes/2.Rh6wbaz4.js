import{d as Za,g as xs,f as p,e as L,a as v,s as A,c as ot,t as Ut}from"../chunks/BESELRjb.js";import{i as It}from"../chunks/JMgyEzd3.js";import{c as ma,o as _a,a as $s,b as Cs}from"../chunks/CtPH092J.js";import{F as M,T as ta,Y as qa,j as ws,aZ as Ds,U as es,ag as Ls,aD as js,aK as As,aE as Bs,a1 as Ms,av as ja,a7 as Ja,i as us,a_ as Fs,a$ as fs,b0 as Ia,K as ca,e as ps,b1 as ms,b2 as Rs,b3 as Ts,b4 as Is,q as Wa,b5 as Ps,b6 as Es,ab as Hs,d as n,r as Ya,g as Ns,C as Pt,G as Et,H as i,I as l,J as s,b7 as Ve,b8 as aa,s as o,a4 as D,f as e,m as vt,E as He,b9 as Lt,ao as pa,A as R,ba as ia,bb as Sa,bc as Us}from"../chunks/DyJ43TGI.js";import{t as Os,c as Ot,a as ee,e as St,i as wt,u as bs,s as da,b as xt,d as Da,f as va,g as Gs,j as Wt,h as qs,T as Ws,k as zs,l as Ks}from"../chunks/D6-WMxVZ.js";import{i as x,s as Yt,a as Ze,b as kt,d as ya,e as Vs}from"../chunks/CCL4udNy.js";import{p as pt,b as wa}from"../chunks/iXw84bXb.js";import{b as ka,r as Js}from"../chunks/BmexqBcG.js";function Ys(a,r,t=!1,c=!1,d=!1){var f=a,b="";M(()=>{var C=ws;if(b===(b=r()??"")){ta&&qa();return}if(C.nodes_start!==null&&(Ds(C.nodes_start,C.nodes_end),C.nodes_start=C.nodes_end=null),b!==""){if(ta){es.data;for(var $=qa(),S=$;$!==null&&($.nodeType!==Ls||$.data!=="");)S=$,$=js($);if($===null)throw As(),Bs;Za(es,S),f=Ms($);return}var K=b+"";t?K=`<svg>${K}</svg>`:c&&(K=`<math>${K}</math>`);var E=xs(K);if((t||c)&&(E=ja(E)),Za(ja(E),E.lastChild),t||c)for(;ja(E);)f.before(ja(E));else f.before(E)}})}function Qs(a,r,t,c,d){ta&&qa();var f=r.$$slots?.[t],b=!1;f===!0&&(f=r[t],b=!0),f===void 0?d!==null&&d(a):f(a,b?()=>c:c)}function Xs(a,r,t,c){var d=a.__style;if(ta||d!==r){var f=Os(r);(!ta||f!==a.getAttribute("style"))&&(f==null?a.removeAttribute("style"):a.style.cssText=f),a.__style=r}return c}function Ra(a,r,t=!1){if(a.multiple){if(r==null)return;if(!us(r))return Fs();for(var c of a.options)c.selected=r.includes(xa(c));return}for(c of a.options){var d=xa(c);if(fs(d,r)){c.selected=!0;return}}(!t||r!==void 0)&&(a.selectedIndex=-1)}function za(a){var r=new MutationObserver(()=>{Ra(a,a.__value)});r.observe(a,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Ja(()=>{r.disconnect()})}function Ta(a,r,t=r){var c=new WeakSet,d=!0;Ia(a,"change",f=>{var b=f?"[selected]":":checked",C;if(a.multiple)C=[].map.call(a.querySelectorAll(b),xa);else{var $=a.querySelector(b)??a.querySelector("option:not([disabled])");C=$&&xa($)}t(C),ca!==null&&c.add(ca)}),ps(()=>{var f=r();if(a===document.activeElement){var b=ms??ca;if(c.has(b))return}if(Ra(a,f,d),d&&f===void 0){var C=a.querySelector(":checked");C!==null&&(f=xa(C),t(f))}a.__value=f,d=!1}),za(a)}function xa(a){return"__value"in a?a.__value:a.value}const Zs=Symbol("is custom element"),el=Symbol("is html");function Be(a){if(ta){var r=!1,t=()=>{if(!r){if(r=!0,a.hasAttribute("value")){var c=a.value;Ke(a,"value",null),a.value=c}if(a.hasAttribute("checked")){var d=a.checked;Ke(a,"checked",null),a.checked=d}}};a.__on_r=t,Wa(t),Ps()}}function $a(a,r){var t=Qa(a);t.value===(t.value=r??void 0)||a.value===r&&(r!==0||a.nodeName!=="PROGRESS")||(a.value=r??"")}function gs(a,r){var t=Qa(a);t.checked!==(t.checked=r??void 0)&&(a.checked=r)}function Ke(a,r,t,c){var d=Qa(a);ta&&(d[r]=a.getAttribute(r),r==="src"||r==="srcset"||r==="href"&&a.nodeName==="LINK")||d[r]!==(d[r]=t)&&(r==="loading"&&(a[Rs]=t),t==null?a.removeAttribute(r):typeof t!="string"&&tl(a).includes(r)?a[r]=t:a.setAttribute(r,t))}function Qa(a){return a.__attributes??={[Zs]:a.nodeName.includes("-"),[el]:a.namespaceURI===Ts}}var ts=new Map;function tl(a){var r=a.getAttribute("is")||a.nodeName,t=ts.get(r);if(t)return t;ts.set(r,t=[]);for(var c,d=a,f=Element.prototype;f!==d;){c=Es(d);for(var b in c)c[b].set&&t.push(b);d=Is(d)}return t}function Je(a,r,t=r){var c=new WeakSet;Ia(a,"input",async d=>{var f=d?a.defaultValue:a.value;if(f=Ha(a)?Na(f):f,t(f),ca!==null&&c.add(ca),await Hs(),f!==(f=r())){var b=a.selectionStart,C=a.selectionEnd,$=a.value.length;if(a.value=f??"",C!==null){var S=a.value.length;b===C&&C===$&&S>$?(a.selectionStart=S,a.selectionEnd=S):(a.selectionStart=b,a.selectionEnd=Math.min(C,S))}}}),(ta&&a.defaultValue!==a.value||n(r)==null&&a.value)&&(t(Ha(a)?Na(a.value):a.value),ca!==null&&c.add(ca)),Ya(()=>{var d=r();if(a===document.activeElement){var f=ms??ca;if(c.has(f))return}Ha(a)&&d===Na(a.value)||a.type==="date"&&!d&&!a.value||d!==a.value&&(a.value=d??"")})}const Ea=new Set;function as(a,r,t,c,d=c){var f=t.getAttribute("type")==="checkbox",b=a;let C=!1;if(r!==null)for(var $ of r)b=b[$]??=[];b.push(t),Ia(t,"change",()=>{var S=t.__value;f&&(S=ss(b,S,t.checked)),d(S)},()=>d(f?[]:null)),Ya(()=>{var S=c();if(ta&&t.defaultChecked!==t.checked){C=!0;return}f?(S=S||[],t.checked=S.includes(t.__value)):t.checked=fs(t.__value,S)}),Ja(()=>{var S=b.indexOf(t);S!==-1&&b.splice(S,1)}),Ea.has(b)||(Ea.add(b),Wa(()=>{b.sort((S,K)=>S.compareDocumentPosition(K)===4?-1:1),Ea.delete(b)})),Wa(()=>{if(C){var S;if(f)S=ss(b,S,t.checked);else{var K=b.find(E=>E.checked);S=K?.__value}d(S)}})}function Ca(a,r,t=r){Ia(a,"change",c=>{var d=c?a.defaultChecked:a.checked;t(d)}),(ta&&a.defaultChecked!==a.checked||n(r)==null)&&t(a.checked),Ya(()=>{var c=r();a.checked=!!c})}function ss(a,r,t){for(var c=new Set,d=0;d<a.length;d+=1)a[d].checked&&c.add(a[d].__value);return t||c.delete(r),Array.from(c)}function Ha(a){var r=a.type;return r==="number"||r==="range"}function Na(a){return a===""?null:+a}function al(a,r,t){var c=Ns(a,r);c&&c.set&&(a[r]=t,Ja(()=>{a[r]=null}))}function Xa(a){return function(...r){var t=r[0];return t.stopPropagation(),a?.apply(this,r)}}function ga(a,r){var t=a.$$events?.[r.type],c=us(t)?t.slice():t==null?[]:[t];for(var d of c)d.call(this,r)}const sl="";function hs(...a){return ka+sl+Js(a[0],a[1])}const Ka={paladin:{name:"Paladin",hitDice:"d10",spellcaster:!0,spellcastingAbility:"charisma",spellSlotsByLevel:{1:0,2:2,3:3,4:3,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Divine Sense",type:"uses",maxUses:(a,r=1)=>1+Math.max(1,r),resetOn:"long",description:"Detect celestials, fiends, and undead within 60 feet",minLevel:1},{name:"Lay on Hands",type:"pool",maxPool:a=>a*5,resetOn:"long",description:"Heal wounds or cure disease",minLevel:1},{name:"Divine Smite",type:"spellSlot",description:"Expend spell slot to deal extra radiant damage",minLevel:2,rollable:!0},{name:"Channel Divinity",type:"pool",maxPool:a=>a>=18?3:a>=6?2:1,resetOn:"short",description:"Sacred Weapon or Turn Undead",minLevel:3}]},fighter:{name:"Fighter",hitDice:"d10",spellcaster:!1,features:[{name:"Second Wind",type:"uses",maxUses:1,resetOn:"short",description:"Regain 1d10 + fighter level HP as bonus action",minLevel:1,rollable:!0,rollFormula:a=>`1d10+${a}`},{name:"Action Surge",type:"uses",maxUses:a=>a>=17?2:1,resetOn:"short",description:"Take one additional action on your turn",minLevel:2},{name:"Indomitable",type:"uses",maxUses:a=>a>=17?3:a>=13?2:1,resetOn:"long",description:"Reroll a failed saving throw",minLevel:9}],subclasses:{champion:{name:"Champion",features:[{name:"Improved Critical",type:"info",description:"Critical hit on 19-20",minLevel:3},{name:"Remarkable Athlete",type:"info",description:"Add half proficiency to STR/DEX/CON checks, increase long jump distance",minLevel:7},{name:"Additional Fighting Style",type:"info",description:"Choose a second fighting style",minLevel:10},{name:"Superior Critical",type:"info",description:"Critical hit on 18-20",minLevel:15},{name:"Survivor",type:"info",description:"Regain 5 + CON mod HP at start of turn if below half HP",minLevel:18}]},battlemaster:{name:"Battle Master",features:[{name:"Combat Superiority",type:"uses",maxUses:a=>a>=15?6:a>=7?5:4,resetOn:"short",description:a=>`Use superiority dice (${a>=18?"d12":a>=10?"d10":"d8"}) for maneuvers`,minLevel:3},{name:"Know Your Enemy",type:"info",description:"Learn capabilities of creatures you observe",minLevel:7},{name:"Improved Combat Superiority",type:"info",description:"Superiority dice become d10",minLevel:10},{name:"Relentless",type:"info",description:"Regain 1 superiority die if you have none at start of turn",minLevel:15}]}}},rogue:{name:"Rogue",hitDice:"d8",spellcaster:!1,features:[{name:"Sneak Attack",type:"info",description:a=>`Deal ${Math.ceil(a/2)}d6 extra damage once per turn with advantage or ally nearby`,minLevel:1,rollable:!0,rollFormula:a=>`${Math.ceil(a/2)}d6`},{name:"Cunning Action",type:"info",description:"Dash, Disengage, or Hide as a bonus action",minLevel:2},{name:"Uncanny Dodge",type:"info",description:"Use reaction to halve damage from an attack",minLevel:5},{name:"Evasion",type:"info",description:"Take no damage on successful Dex save (half on fail)",minLevel:7}]},wizard:{name:"Wizard",hitDice:"d6",spellcaster:!0,spellcastingAbility:"intelligence",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Arcane Recovery",type:"uses",maxUses:1,resetOn:"long",description:a=>`Recover spell slots totaling up to ${Math.ceil(a/2)} levels during short rest`,minLevel:1},{name:"Spell Mastery",type:"info",description:"Cast one 1st-level and one 2nd-level spell at will",minLevel:18}]},cleric:{name:"Cleric",hitDice:"d8",spellcaster:!0,spellcastingAbility:"wisdom",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Channel Divinity",type:"pool",maxPool:a=>a>=18?3:a>=6?2:1,resetOn:"short",description:"Turn Undead or domain-specific ability",minLevel:2},{name:"Destroy Undead",type:"info",description:a=>`Channel Divinity destroys undead of CR ${a>=17?4:a>=14?3:a>=11?2:a>=8?1:.5} or lower`,minLevel:5},{name:"Divine Intervention",type:"uses",maxUses:1,resetOn:"long",description:a=>`${a}% chance to succeed, implore deity for aid`,minLevel:10}],subclasses:{war:{name:"War Domain",features:[{name:"War Priest",type:"uses",maxUses:(a,r=1)=>Math.max(1,r),resetOn:"long",description:"Make one weapon attack as a bonus action",minLevel:1},{name:"Guided Strike",type:"channelDivinity",description:"Use your Channel Divinity to gain +10 to an attack roll. Make this choice after you see the roll, but before the DM says whether the attack hits or misses.",minLevel:2,resetOn:"short"},{name:"War God's Blessing",type:"channelDivinity",description:"Use reaction to grant +10 to an ally's attack roll within 30 feet. Consumes one use of Channel Divinity.",minLevel:6,resetOn:"short"},{name:"Divine Strike",type:"info",description:a=>`Deal extra ${a>=14?"2d8":"1d8"} weapon damage once per turn`,minLevel:8,rollable:!0,rollFormula:a=>a>=14?"2d8":"1d8"},{name:"Avatar of Battle",type:"info",description:"Gain resistance to nonmagical weapon damage",minLevel:17}]},life:{name:"Life Domain",features:[{name:"Disciple of Life",type:"info",description:"Healing spells restore additional 2 + spell level HP",minLevel:1},{name:"Preserve Life",type:"pool",maxPool:a=>a*5,resetOn:"short",description:"Restore HP to creatures within 30 feet",minLevel:2},{name:"Blessed Healer",type:"info",description:"Regain 2 + spell level HP when you cast healing spell",minLevel:6},{name:"Divine Strike",type:"info",description:a=>`Deal extra ${a>=14?"2d8":"1d8"} radiant damage once per turn`,minLevel:8,rollable:!0,rollFormula:a=>a>=14?"2d8":"1d8"},{name:"Supreme Healing",type:"info",description:"Maximize healing dice instead of rolling",minLevel:17}]}}},barbarian:{name:"Barbarian",hitDice:"d12",spellcaster:!1,features:[{name:"Rage",type:"uses",maxUses:a=>a>=20?1/0:a>=17?6:a>=12?5:a>=6?4:a>=3?3:2,resetOn:"long",description:a=>`+${a>=16?4:a>=9?3:2} damage, resistance to physical damage`,minLevel:1},{name:"Reckless Attack",type:"info",description:"Gain advantage on melee attacks, enemies get advantage on you",minLevel:2},{name:"Danger Sense",type:"info",description:"Advantage on Dex saves against effects you can see",minLevel:2}],subclasses:{berserker:{name:"Path of the Berserker",features:[{name:"Frenzy",type:"info",description:"While raging, make melee attack as bonus action (gain 1 exhaustion after rage)",minLevel:3},{name:"Mindless Rage",type:"info",description:"Cannot be charmed or frightened while raging",minLevel:6},{name:"Intimidating Presence",type:"info",description:"Use action to frighten creature within 30 feet",minLevel:10},{name:"Retaliation",type:"info",description:"When damaged by creature within 5 feet, make melee attack as reaction",minLevel:14}]}}}};function zt(a){const r=a.toLowerCase();return Ka[r]||null}function ha(a,r,t){const c=zt(a);if(!c)return[];const d=c.features.filter(f=>!f.minLevel||f.minLevel<=r);if(t&&c.subclasses&&c.subclasses[t]){const f=c.subclasses[t].features.filter(b=>!b.minLevel||b.minLevel<=r);return[...d,...f]}return d}function ls(a){const r=zt(a);return!r||!r.subclasses?[]:Object.keys(r.subclasses).map(t=>({id:t,name:r.subclasses[t].name}))}function is(a,r){const t=zt(a);return!t||!t.spellcaster||!t.spellSlotsByLevel?0:t.spellSlotsByLevel[r]||0}function ns(a,r,t){const c=zt(a);return!c||!c.spellcaster?0:Math.max(1,t+r)}function ll(a,r,t){const c=zt(a);return!c||!c.spellcaster?null:8+r+t}function il(){return Object.keys(Ka).map(a=>({id:a,name:Ka[a].name}))}var nl=p('<div class="section-header svelte-ls99y2" role="button" tabindex="0"><h2 class="svelte-ls99y2"> </h2> <span class="collapse-btn svelte-ls99y2"> </span></div>');function ba(a,r){Pt(r,!1);let t=pt(r,"title",8),c=pt(r,"collapsed",8),d=pt(r,"ariaLabel",8,""),f=pt(r,"onToggle",8);It();var b=nl(),C=i(b),$=i(C,!0);l(C);var S=s(C,2),K=i(S,!0);l(S),l(b),M(()=>{Ke(b,"aria-expanded",!c()),Ke(b,"aria-label",d()),A($,t()),A(K,c()?"‚ñº":"‚ñ≤")}),L("click",b,function(...E){f()?.apply(this,E)}),L("keydown",b,E=>{(E.key==="Enter"||E.key===" ")&&f()()}),v(a,b),Et()}var rl=p("<option> </option>"),ol=p("<option> </option>"),cl=p('<div class="form-group svelte-172i2fj"><label for="characterSubclass" class="svelte-172i2fj">Subclass</label> <select id="characterSubclass" class="svelte-172i2fj"><option>Select Subclass</option><!></select></div>'),vl=p('<div class="info-grid svelte-172i2fj"><div class="form-group svelte-172i2fj"><label for="characterName" class="svelte-172i2fj">Character Name</label> <input type="text" id="characterName" placeholder="Enter name" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterClass" class="svelte-172i2fj">Class</label> <select id="characterClass" class="svelte-172i2fj"><option>Select Class</option><!></select></div> <!> <div class="form-group svelte-172i2fj"><label for="characterLevel" class="svelte-172i2fj">Level</label> <input type="number" id="characterLevel" min="1" max="20" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterRace" class="svelte-172i2fj">Race</label> <input type="text" id="characterRace" placeholder="e.g., Human" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterBackground" class="svelte-172i2fj">Background</label> <input type="text" id="characterBackground" placeholder="e.g., Soldier" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterAlignment" class="svelte-172i2fj">Alignment</label> <input type="text" id="characterAlignment" placeholder="e.g., Lawful Good" class="svelte-172i2fj"/></div></div>'),dl=p('<section class="character-info svelte-172i2fj"><!> <!></section>');function ul(a,r){Pt(r,!1);const t=()=>Ze(ee,"$character",d),c=()=>Ze(Ot,"$collapsedStates",d),[d,f]=Yt(),b=D(),C=il();function $(de){const W=de.target;ee.update(P=>(P.class=W.value,P.subclass="",P))}function S(de){const W=de.target;ee.update(P=>(P.subclass=W.value,P))}function K(de){const W=de.target;ee.update(P=>(P.level=parseInt(W.value)||1,P)),bs()}Ve(()=>(t(),ls),()=>{o(b,t().class?ls(t().class):[])}),aa(),It();var E=dl(),ae=i(E);{let de=vt(()=>(c(),n(()=>c().characterInfo?"Expand":"Collapse")));ba(ae,{title:"Character Info",get collapsed(){return c(),n(()=>c().characterInfo)},get ariaLabel(){return e(de)},onToggle:()=>Ot.update(W=>({...W,characterInfo:!W.characterInfo}))})}var V=s(ae,2);{var X=de=>{var W=vl(),P=i(W),Se=s(i(P),2);Be(Se),l(P);var Ne=s(P,2),ne=s(i(Ne),2),Me=i(ne);Me.value=Me.__value="";var qe=s(Me);St(qe,1,()=>C,wt,(je,xe)=>{var Ae=rl(),tt=i(Ae,!0);l(Ae);var Xe={};M(()=>{A(tt,(e(xe),n(()=>e(xe).name))),Xe!==(Xe=(e(xe),n(()=>e(xe).id)))&&(Ae.value=(Ae.__value=(e(xe),n(()=>e(xe).id)))??"")}),v(je,Ae)}),l(ne);var se;za(ne),l(Ne);var _e=s(Ne,2);{var Te=je=>{var xe=cl(),Ae=s(i(xe),2),tt=i(Ae);tt.value=tt.__value="";var Xe=s(tt);St(Xe,1,()=>e(b),wt,(it,at)=>{var k=ol(),U=i(k,!0);l(k);var ye={};M(()=>{A(U,(e(at),n(()=>e(at).name))),ye!==(ye=(e(at),n(()=>e(at).id)))&&(k.value=(k.__value=(e(at),n(()=>e(at).id)))??"")}),v(it,k)}),l(Ae);var ct;za(Ae),l(xe),M(()=>{ct!==(ct=(t(),n(()=>t().subclass)))&&(Ae.value=(Ae.__value=(t(),n(()=>t().subclass)))??"",Ra(Ae,(t(),n(()=>t().subclass))))}),L("change",Ae,S),v(je,xe)};x(_e,je=>{e(b),n(()=>e(b).length>0)&&je(Te)})}var w=s(_e,2),B=s(i(w),2);Be(B),l(w);var _=s(w,2),H=s(i(_),2);Be(H),l(_);var h=s(_,2),F=s(i(h),2);Be(F),l(h);var J=s(h,2),Ie=s(i(J),2);Be(Ie),l(J),l(W),M(()=>{se!==(se=(t(),n(()=>t().class)))&&(ne.value=(ne.__value=(t(),n(()=>t().class)))??"",Ra(ne,(t(),n(()=>t().class)))),$a(B,(t(),n(()=>t().level)))}),Je(Se,()=>t().name,je=>kt(ee,n(t).name=je,n(t))),L("change",ne,$),L("change",B,K),Je(H,()=>t().race,je=>kt(ee,n(t).race=je,n(t))),Je(F,()=>t().background,je=>kt(ee,n(t).background=je,n(t))),Je(Ie,()=>t().alignment,je=>kt(ee,n(t).alignment=je,n(t))),v(de,W)};x(V,de=>{c(),n(()=>!c().characterInfo)&&de(X)})}l(E),v(a,E),Et(),f()}var fl=p('<div class="ability-card svelte-bbv1xt"><h3 class="svelte-bbv1xt"> </h3> <input type="number" class="ability-score svelte-bbv1xt" min="1" max="30"/> <div class="ability-modifier svelte-bbv1xt"> </div> <div class="roll-buttons svelte-bbv1xt"><button class="roll-btn svelte-bbv1xt">Check</button> <button class="roll-btn svelte-bbv1xt">Save</button></div> <div class="save-proficiency svelte-bbv1xt"><input type="checkbox" class="svelte-bbv1xt"/> <label class="svelte-bbv1xt">Save Prof.</label></div></div>'),pl=p('<div class="proficiency-bonus svelte-bbv1xt"><label for="profBonus">Proficiency Bonus</label> <input type="number" id="profBonus" class="prof-input svelte-bbv1xt"/></div> <div class="abilities-grid svelte-bbv1xt"></div>',1),ml=p("<section><!> <!></section>");function bl(a,r){Pt(r,!1);const t=()=>Ze(Da,"$abilityModifiers",C),c=()=>Ze(ee,"$character",C),d=()=>Ze(da,"$searchFilter",C),f=()=>Ze(Ot,"$collapsedStates",C),b=()=>Ze(va,"$isEditMode",C),[C,$]=Yt(),S=D(),K=D(),E=ma(),ae=[{key:"strength",label:"Strength"},{key:"dexterity",label:"Dexterity"},{key:"constitution",label:"Constitution"},{key:"intelligence",label:"Intelligence"},{key:"wisdom",label:"Wisdom"},{key:"charisma",label:"Charisma"}];function V(){bs()}function X(Me){const qe=t()[Me],se=`1d20${qe>=0?"+":""}${qe}`,_e=[];_e.push({value:"1d20",source:"base die"}),qe!==0&&_e.push({value:qe,source:Me}),E("roll",{notation:se,rollType:"check",bonusBreakdown:_e})}function de(Me){const qe=t()[Me],se=c().saveProficiencies[Me]?c().proficiencyBonus:0,_e=qe+se,Te=`1d20${_e>=0?"+":""}${_e}`,w=[];w.push({value:"1d20",source:"base die"}),qe!==0&&w.push({value:qe,source:Me}),se!==0&&w.push({value:se,source:"proficiency"}),E("roll",{notation:Te,rollType:"save",bonusBreakdown:w})}Ve(()=>d(),()=>{o(S,ae.filter(({label:Me})=>d()?Me.toLowerCase().includes(d().toLowerCase()):!0))}),Ve(()=>(e(S),d()),()=>{o(K,e(S).length>0||!d()||d().toLowerCase().includes("proficiency"))}),aa(),It();var W=ml();let P;var Se=i(W);ba(Se,{title:"Ability Scores",get collapsed(){return f(),n(()=>f().abilityScores)},ariaLabel:"Toggle Ability Scores Section",onToggle:()=>Ot.update(Me=>({...Me,abilityScores:!Me.abilityScores}))});var Ne=s(Se,2);{var ne=Me=>{var qe=pl(),se=He(qe),_e=s(i(se),2);Be(_e),l(se);var Te=s(se,2);St(Te,5,()=>e(S),wt,(w,B)=>{let _=()=>e(B).key,H=()=>e(B).label;var h=fl(),F=i(h),J=i(F,!0);l(F);var Ie=s(F,2);Be(Ie);var je=s(Ie,2),xe=i(je);l(je);var Ae=s(je,2),tt=i(Ae),Xe=s(tt,2);l(Ae);var ct=s(Ae,2),it=i(ct);Be(it);var at=s(it,2);l(ct),l(h),M(k=>{A(J,k),A(xe,`${t(),_(),n(()=>t()[_()]>=0?"+":"")??""}${t(),_(),n(()=>t()[_()])??""}`),it.disabled=!b(),Ke(it,"id",`${_()}-save`),Ke(at,"for",`${_()}-save`)},[()=>(H(),n(()=>H().substring(0,3).toUpperCase()))]),Je(Ie,()=>c().abilities[_()],k=>kt(ee,n(c).abilities[_()]=k,n(c))),L("change",Ie,V),L("click",tt,()=>X(_())),L("click",Xe,()=>de(_())),Ca(it,()=>c().saveProficiencies[_()],k=>kt(ee,n(c).saveProficiencies[_()]=k,n(c))),v(w,h)}),l(Te),Je(_e,()=>c().proficiencyBonus,w=>kt(ee,n(c).proficiencyBonus=w,n(c))),v(Me,qe)};x(Ne,Me=>{f(),n(()=>!f().abilityScores)&&Me(ne)})}l(W),M(()=>P=xt(W,1,"ability-scores svelte-bbv1xt",null,P,{hidden:!e(K)})),v(a,W),Et(),$()}const _s=[{name:"Unarmored",type:"none",baseAC:10},{name:"Padded",type:"light",baseAC:11},{name:"Leather",type:"light",baseAC:11},{name:"Studded Leather",type:"light",baseAC:12},{name:"Hide",type:"medium",baseAC:12,maxDexBonus:2},{name:"Chain Shirt",type:"medium",baseAC:13,maxDexBonus:2},{name:"Scale Mail",type:"medium",baseAC:14,maxDexBonus:2},{name:"Breastplate",type:"medium",baseAC:14,maxDexBonus:2},{name:"Half Plate",type:"medium",baseAC:15,maxDexBonus:2},{name:"Ring Mail",type:"heavy",baseAC:14,maxDexBonus:0},{name:"Chain Mail",type:"heavy",baseAC:16,maxDexBonus:0},{name:"Splint",type:"heavy",baseAC:17,maxDexBonus:0},{name:"Plate",type:"heavy",baseAC:18,maxDexBonus:0}];function ys(a){return _s.find(r=>r.name===a)}function gl(a,r,t){if(!a)return 10+r+(t?2:0);const c=ys(a);if(!c)return 10+r+(t?2:0);let d=c.baseAC;return c.maxDexBonus===void 0?d+=r:c.maxDexBonus>0&&(d+=Math.min(r,c.maxDexBonus)),t&&(d+=2),d}function La(a){return Math.floor((a-10)/2)}function Va(a,r){if(!a.class)return null;const t=zt(a.class);if(!t||!t.spellcaster||!t.spellcastingAbility)return null;const c=La(r[t.spellcastingAbility]);return 8+a.proficiencyBonus+c}function rs(a,r){if(!a.class)return 0;const t=zt(a.class);return!t||!t.spellcaster||!t.spellcastingAbility?0:La(r[t.spellcastingAbility])}function hl(a,r){const t=[],c=La(r.dexterity),d=a.armorName?ys(a.armorName):void 0;if(d){if(d.type==="none")t.push("Unarmored"),t.push("Base: 10"),t.push(`Dexterity: ${c>=0?"+":""}${c}`);else if(d.type==="light")t.push(`${d.name}: ${d.baseAC}`),t.push(`Dexterity: ${c>=0?"+":""}${c}`);else if(d.type==="medium"){const f=Math.min(2,c);t.push(`${d.name}: ${d.baseAC}`),t.push(`Dexterity: ${f>=0?"+":""}${f} (max +2)`)}else d.type==="heavy"&&(t.push(`${d.name}: ${d.baseAC}`),t.push("Dexterity: +0 (heavy armor)"));a.shieldEquipped&&t.push("Shield: +2")}else{t.push("Base: 10"),c!==0&&t.push(`Dexterity: ${c>=0?"+":""}${c}`);const f=10+c,b=a.armorClass-f;b!==0&&t.push(`Other: ${b>=0?"+":""}${b}`)}return a.activeStates&&a.activeStates.length>0&&a.activeStates.forEach(f=>{typeof f.acBonus=="number"&&f.acBonus!==0&&(!f.target||f.target==="self")&&t.push(`${f.name}: ${f.acBonus>=0?"+":""}${f.acBonus}`)}),t.join(`
`)}function _l(a,r){const t=[],c=La(r.dexterity);t.push(`Dexterity: ${c>=0?"+":""}${c}`);const d=a.initiative-c;return d!==0&&t.push(`Other Bonuses: ${d>=0?"+":""}${d}`),t.join(`
`)}function yl(a,r){if(!a.class)return"";const t=zt(a.class);if(!t||!t.spellcaster||!t.spellcastingAbility)return"";const c=[],d=La(r[t.spellcastingAbility]),f=t.spellcastingAbility.charAt(0).toUpperCase()+t.spellcastingAbility.slice(1);return c.push("Base: 8"),c.push(`Proficiency: +${a.proficiencyBonus}`),c.push(`${f}: ${d>=0?"+":""}${d}`),c.join(`
`)}var kl=p('<button class="info-icon svelte-1o8ci7b" type="button">‚ÑπÔ∏è</button>'),Sl=p('<button class="info-icon svelte-1o8ci7b" type="button">‚ÑπÔ∏è</button>'),xl=p("<div><!></div>"),$l=p('<div class="tooltip-wrapper svelte-1o8ci7b"><!> <!></div>');function Ua(a,r){Pt(r,!1);let t=pt(r,"tooltipContent",8),c=pt(r,"ariaLabel",8,"Show information"),d=D(!1),f=D(),b=D(!1),C=D(null),$=D(!1),S=D(!1),K=D("");const E=Math.random().toString(36).slice(2);function ae(){window.dispatchEvent(new CustomEvent("tooltip-open",{detail:E}))}function V(w){w.detail!==E&&(o(d,!1),o($,!1))}function X(){o(b,window.matchMedia("(pointer: coarse)").matches||"ontouchstart"in window)}function de(){if(!e(C)||!e(f))return;const w=e(f).getBoundingClientRect(),B=e(C).getBoundingClientRect();let _=w.bottom+5,H=w.left;o($,!1),H+B.width>window.innerWidth-8&&(H=w.right-B.width,o($,!0),H<8&&(H=8)),H<8&&(H=8),_+B.height>window.innerHeight-8&&(_=w.top-B.height-5),o(K,`position:fixed;top:${_}px;left:${H}px;z-index:1000;`),o(S,!0)}function W(){ae(),o(d,!1),o(S,!1),requestAnimationFrame(()=>{o(d,!0),o(S,!1),setTimeout(de,0)})}function P(){o(d,!1),o($,!1)}function Se(w){w.stopPropagation(),e(d)?(o(d,!1),o($,!1),o(S,!1)):(ae(),o(d,!1),o(S,!1),requestAnimationFrame(()=>{o(d,!0),o(S,!1),setTimeout(de,0)}))}function Ne(w){e(f)&&!e(f).contains(w.target)&&(o(d,!1),o($,!1))}_a(()=>{X(),document.addEventListener("click",Ne),window.addEventListener("tooltip-open",V)}),$s(()=>{document.removeEventListener("click",Ne),window.removeEventListener("tooltip-open",V)}),It();var ne=$l(),Me=i(ne);{var qe=w=>{var B=kl();M(()=>Ke(B,"aria-label",c())),L("click",B,Se),v(w,B)},se=w=>{var B=Sl();M(()=>Ke(B,"aria-label",c())),L("mouseenter",B,W),L("mouseleave",B,P),v(w,B)};x(Me,w=>{e(b)?w(qe):w(se,!1)})}var _e=s(Me,2);{var Te=w=>{var B=xl(),_=i(B);Qs(_,r,"content",{},H=>{var h=ot(),F=He(h);Ys(F,t),v(H,h)}),l(B),wa(B,H=>o(C,H),()=>e(C)),M(()=>{xt(B,1,`tooltip-popup ${e($)?"right-align":""}`,"svelte-1o8ci7b"),Xs(B,e(S)?e(K)+"opacity:1;pointer-events:auto;":"opacity:0;pointer-events:none;position:fixed;top:0;left:0;z-index:1000;")}),v(w,B)};x(_e,w=>{e(d)&&w(Te)})}l(ne),wa(ne,w=>o(f,w),()=>e(f)),v(a,ne),Et()}var Cl=p("<option> </option>"),wl=p('<div class="armor-config svelte-1r5hyyb"><h4 class="svelte-1r5hyyb">Armor Configuration</h4> <div class="armor-controls svelte-1r5hyyb"><div class="armor-field svelte-1r5hyyb"><label for="armorName" class="svelte-1r5hyyb">Armor</label> <select id="armorName" class="armor-select svelte-1r5hyyb"><option>None (Unarmored)</option><!></select></div> <div class="armor-field svelte-1r5hyyb"><label class="shield-label svelte-1r5hyyb"><input type="checkbox" class="shield-checkbox svelte-1r5hyyb"/> Shield Equipped (+2 AC)</label></div></div></div>'),Dl=p('<div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="spellSaveDC" class="svelte-1r5hyyb">Spell Save DC</label> <!></div> <input type="number" id="spellSaveDC" class="stat-input svelte-1r5hyyb" readonly=""/></div>'),Ll=p('<span class="hit-dice-type"> </span>'),jl=p('<!> <div class="stats-grid svelte-1r5hyyb"><div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="armorClass" class="svelte-1r5hyyb">Armor Class</label> <!></div> <input type="text" id="armorClass" readonly=""/></div> <div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="initiative" class="svelte-1r5hyyb">Initiative</label> <!></div> <input type="text" id="initiative" class="stat-input svelte-1r5hyyb" readonly=""/></div> <div class="stat-box svelte-1r5hyyb"><label for="speed" class="svelte-1r5hyyb">Speed</label> <input type="text" id="speed" class="stat-input svelte-1r5hyyb"/></div> <!></div> <div class="hp-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Points</h3> <div><div class="hp-inputs svelte-1r5hyyb"><input type="number" class="hp-current svelte-1r5hyyb" min="0"/> <span class="hp-separator svelte-1r5hyyb">/</span> <input type="number" class="hp-max svelte-1r5hyyb" min="0"/></div> <div class="hp-controls svelte-1r5hyyb"><button class="hp-btn svelte-1r5hyyb">‚àí</button> <button class="hp-btn svelte-1r5hyyb">+</button> <button class="hp-btn svelte-1r5hyyb">‚àí5</button> <button class="hp-btn svelte-1r5hyyb">+5</button></div></div> <div class="temp-hp svelte-1r5hyyb"><label for="tempHP" class="svelte-1r5hyyb">Temp HP</label> <input type="number" id="tempHP" min="0" class="svelte-1r5hyyb"/></div></div> <div class="hit-dice-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Dice</h3> <div class="hit-dice-display svelte-1r5hyyb"><input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <span>/</span> <input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <!></div> <div class="hit-dice-controls svelte-1r5hyyb"><label for="hitDiceCount" class="svelte-1r5hyyb">Roll</label> <div class="hit-dice-count-controls svelte-1r5hyyb"><button class="hit-dice-btn svelte-1r5hyyb">‚àí</button> <input type="number" id="hitDiceCount" class="hit-dice-count-input svelte-1r5hyyb" min="1"/> <button class="hit-dice-btn svelte-1r5hyyb">+</button></div> <button class="btn btn-primary roll-hit-dice use-enabled svelte-1r5hyyb">üé≤ Roll</button></div></div>',1),Al=p("<section><!> <!></section>");function Bl(a,r){Pt(r,!1);const t=()=>Ze(ee,"$character",C),c=()=>Ze(Da,"$abilityModifiers",C),d=()=>Ze(da,"$searchFilter",C),f=()=>Ze(Ot,"$collapsedStates",C),b=()=>Ze(va,"$isEditMode",C),[C,$]=Yt(),S=D(),K=D(),E=D(),ae=D(),V=D(),X=D(),de=D(),W=ma();let P=D(1);function Se(w){ee.update(B=>(B.currentHP=Math.max(0,Math.min(B.maxHP,B.currentHP+w)),B))}function Ne(w){const B=e(P)+w,_=t().hitDice.current;o(P,Math.max(1,Math.min(_,B)))}function ne(w=1){if(t().hitDice.current<=0){alert("No hit dice remaining!");return}if(!t().class){alert("Please select a class first!");return}const B=zt(t().class);if(!B){alert("Invalid class configuration!");return}const _=Math.min(w,t().hitDice.current),H=B.hitDice,h=c().constitution,F=h*_,J=F>=0?`+${F}`:`${F}`,Ie=`${_}${H}${J}`,je=[];if(je.push({value:`${_}${H}`,source:"hit dice"}),h!==0)for(let xe=0;xe<_;xe++)je.push({value:h,source:"constitution"});W("rollHitDice",{notation:Ie,hitDie:H,count:_,bonusBreakdown:je})}Ve(()=>(t(),c(),ee),()=>{if(t().armorName!==void 0||t().shieldEquipped!==void 0){const w=c().dexterity,B=gl(t().armorName,w,t().shieldEquipped||!1);t().armorClass!==B&&ee.update(_=>({..._,armorClass:B}))}}),Ve(()=>(c(),t(),ee),()=>{const w=c().dexterity;t().initiative!==w&&ee.update(B=>({...B,initiative:w}))}),Ve(()=>t(),()=>{o(S,Va(t(),t().abilities))}),Ve(()=>t(),()=>{o(K,hl(t(),t().abilities))}),Ve(()=>t(),()=>{o(E,_l(t(),t().abilities))}),Ve(()=>t(),()=>{o(ae,yl(t(),t().abilities))}),Ve(()=>(t(),e(P)),()=>{const w=t().hitDice.current;w>0&&e(P)>w&&o(P,w)}),Ve(()=>t(),()=>{o(V,t().activeStates&&t().activeStates.length>0?t().activeStates.reduce((w,B)=>w+(B.acBonus||0),0):0)}),Ve(()=>t(),()=>{o(X,t().activeStates&&t().activeStates.length>0?t().activeStates.some(w=>w.name==="Aid"&&w.target==="self"):!1)}),Ve(()=>d(),()=>{o(de,!d()||"armor class".includes(d().toLowerCase())||"initiative".includes(d().toLowerCase())||"speed".includes(d().toLowerCase())||"hit points".includes(d().toLowerCase())||"hp".includes(d().toLowerCase())||"hit dice".includes(d().toLowerCase())||"spell save".includes(d().toLowerCase())||"combat".includes(d().toLowerCase()))}),aa(),It();var Me=Al();let qe;var se=i(Me);{let w=vt(()=>(f(),n(()=>f().combatStats?"Expand":"Collapse")));ba(se,{title:"Combat Stats",get collapsed(){return f(),n(()=>f().combatStats)},get ariaLabel(){return e(w)},onToggle:()=>Ot.update(B=>({...B,combatStats:!B.combatStats}))})}var _e=s(se,2);{var Te=w=>{var B=jl(),_=He(B);{var H=Y=>{var Fe=wl(),ue=s(i(Fe),2),y=i(ue),N=s(i(y),2);M(()=>{t(),Lt(()=>{})});var Z=i(N);Z.value=(Z.__value=void 0)??"";var Q=s(Z);St(Q,1,()=>_s,wt,(fe,Oe)=>{var Ye=ot(),et=He(Ye);{var me=te=>{var Qe=Cl(),st=i(Qe);l(Qe);var m={};M(()=>{A(st,`${e(Oe),n(()=>e(Oe).name)??""} (AC ${e(Oe),n(()=>e(Oe).baseAC)??""})`),m!==(m=(e(Oe),n(()=>e(Oe).name)))&&(Qe.value=(Qe.__value=(e(Oe),n(()=>e(Oe).name)))??"")}),v(te,Qe)};x(et,te=>{e(Oe),n(()=>e(Oe).name!=="Unarmored")&&te(me)})}v(fe,Ye)}),l(N),l(y);var ke=s(y,2),ie=i(ke),Ue=i(ie);Be(Ue),pa(),l(ie),l(ke),l(ue),l(Fe),Ta(N,()=>t().armorName,fe=>kt(ee,n(t).armorName=fe,n(t))),Ca(Ue,()=>t().shieldEquipped,fe=>kt(ee,n(t).shieldEquipped=fe,n(t))),v(Y,Fe)};x(_,Y=>{b()&&Y(H)})}var h=s(_,2),F=i(h),J=i(F),Ie=s(i(J),2);Ua(Ie,{get tooltipContent(){return e(K)},ariaLabel:"Show AC breakdown"}),l(J);var je=s(J,2);Be(je),l(F);var xe=s(F,2),Ae=i(xe),tt=s(i(Ae),2);Ua(tt,{get tooltipContent(){return e(E)},ariaLabel:"Show Initiative breakdown"}),l(Ae);var Xe=s(Ae,2);Be(Xe),l(xe);var ct=s(xe,2),it=s(i(ct),2);Be(it),l(ct);var at=s(ct,2);{var k=Y=>{var Fe=Dl(),ue=i(Fe),y=s(i(ue),2);Ua(y,{get tooltipContent(){return e(ae)},ariaLabel:"Show Spell Save DC breakdown"}),l(ue);var N=s(ue,2);Be(N),l(Fe),M(()=>$a(N,e(S))),v(Y,Fe)};x(at,Y=>{e(S)!==null&&Y(k)})}l(h);var U=s(h,2),ye=s(i(U),2);let $e;var T=i(ye),j=i(T);Be(j);var le=s(j,4);Be(le),l(T);var re=s(T,2),z=i(re),pe=s(z,2),O=s(pe,2),he=s(O,2);l(re),l(ye);var Ce=s(ye,2),I=s(i(Ce),2);Be(I),l(Ce),l(U);var q=s(U,2),u=s(i(q),2),Re=i(u);Be(Re);var we=s(Re,4);Be(we);var ce=s(we,2);{var be=Y=>{const Fe=vt(()=>(R(zt),t(),n(()=>zt(t().class))));var ue=ot(),y=He(ue);{var N=Z=>{const Q=vt(()=>(c(),n(()=>c().constitution)));var ke=Ll(),ie=i(ke);l(ke),M(()=>A(ie,`(${R(e(Fe)),n(()=>e(Fe).hitDice)??""}${(e(Q)>=0?`+${e(Q)}`:e(Q))??""})`)),v(Z,ke)};x(y,Z=>{e(Fe)&&Z(N)})}v(Y,ue)};x(ce,Y=>{t(),n(()=>t().class)&&Y(be)})}l(u);var De=s(u,2),Ge=s(i(De),2),We=i(Ge),ze=s(We,2);Be(ze);var oe=s(ze,2);l(Ge);var ge=s(Ge,2);l(De),l(q),M(()=>{$a(je,(e(V),t(),n(()=>e(V)!==0?`${t().armorClass} ‚Üí ${t().armorClass+e(V)}`:`${t().armorClass}`))),xt(je,1,Gs(e(V)!==0?"stat-input ac-enhanced":"stat-input"),"svelte-1r5hyyb"),$a(Xe,(t(),n(()=>t().initiative))),$e=xt(ye,1,"hp-display svelte-1r5hyyb",null,$e,{"aid-active":e(X)}),Ke(j,"max",(t(),n(()=>t().maxHP))),Ke(Re,"max",(t(),n(()=>t().hitDice.max))),We.disabled=e(P)<=1,Ke(ze,"max",(t(),n(()=>t().hitDice.current))),oe.disabled=(e(P),t(),n(()=>e(P)>=t().hitDice.current)),ge.disabled=(t(),n(()=>t().hitDice.current<=0||!t().class))}),Je(it,()=>t().speed,Y=>kt(ee,n(t).speed=Y,n(t))),Je(j,()=>t().currentHP,Y=>kt(ee,n(t).currentHP=Y,n(t))),Je(le,()=>t().maxHP,Y=>kt(ee,n(t).maxHP=Y,n(t))),L("click",z,()=>Se(-1)),L("click",pe,()=>Se(1)),L("click",O,()=>Se(-5)),L("click",he,()=>Se(5)),Je(I,()=>t().tempHP,Y=>kt(ee,n(t).tempHP=Y,n(t))),Je(Re,()=>t().hitDice.current,Y=>kt(ee,n(t).hitDice.current=Y,n(t))),Je(we,()=>t().hitDice.max,Y=>kt(ee,n(t).hitDice.max=Y,n(t))),L("click",We,()=>Ne(-1)),Je(ze,()=>e(P),Y=>o(P,Y)),L("input",ze,Y=>{const Fe=Y.target,ue=parseInt(Fe.value);ue>t().hitDice.current&&o(P,t().hitDice.current),ue<1&&o(P,1)}),L("click",oe,()=>Ne(1)),L("click",ge,()=>ne(e(P))),v(w,B)};x(_e,w=>{f(),n(()=>!f().combatStats)&&w(Te)})}l(Me),M(()=>qe=xt(Me,1,"combat-stats svelte-1r5hyyb",null,qe,{hidden:!e(de)})),v(a,Me),Et(),$()}const Aa={acrobatics:"dexterity",animalHandling:"wisdom",arcana:"intelligence",athletics:"strength",deception:"charisma",history:"intelligence",insight:"wisdom",intimidation:"charisma",investigation:"intelligence",medicine:"wisdom",nature:"intelligence",perception:"wisdom",performance:"charisma",persuasion:"charisma",religion:"intelligence",sleightOfHand:"dexterity",stealth:"dexterity",survival:"wisdom"};var Ml=p('<div class="skill-row svelte-1f1pl16"><input type="checkbox" class="svelte-1f1pl16"/> <label class="svelte-1f1pl16"> <span class="ability-tag svelte-1f1pl16"> </span></label> <span class="skill-modifier svelte-1f1pl16"> </span> <button class="roll-btn svelte-1f1pl16">Roll</button></div>'),Fl=p('<div class="skills-grid svelte-1f1pl16"></div>'),Rl=p("<section><!> <!></section>");function Tl(a,r){Pt(r,!1);const t=()=>Ze(ee,"$character",C),c=()=>Ze(Da,"$abilityModifiers",C),d=()=>Ze(da,"$searchFilter",C),f=()=>Ze(Ot,"$collapsedStates",C),b=()=>Ze(va,"$isEditMode",C),[C,$]=Yt(),S=D(),K=D(),E=D(),ae=D(),V=D(),X=D(),de=ma(),W=[{key:"acrobatics",label:"Acrobatics"},{key:"animalHandling",label:"Animal Handling"},{key:"arcana",label:"Arcana"},{key:"athletics",label:"Athletics"},{key:"deception",label:"Deception"},{key:"history",label:"History"},{key:"insight",label:"Insight"},{key:"intimidation",label:"Intimidation"},{key:"investigation",label:"Investigation"},{key:"medicine",label:"Medicine"},{key:"nature",label:"Nature"},{key:"perception",label:"Perception"},{key:"performance",label:"Performance"},{key:"persuasion",label:"Persuasion"},{key:"religion",label:"Religion"},{key:"sleightOfHand",label:"Sleight of Hand"},{key:"stealth",label:"Stealth"},{key:"survival",label:"Survival"}];function P(se){const _e=Aa[se],Te=c()[_e],w=t().skillProficiencies[se]?t().proficiencyBonus:0,B=e(S)[se],_=`1d20${B>=0?"+":""}${B}`,H=[];H.push({value:"1d20",source:"base die"}),Te!==0&&H.push({value:Te,source:_e}),w!==0&&H.push({value:w,source:"proficiency"}),de("roll",{notation:_,rollType:"check",bonusBreakdown:H})}Ve(()=>{},()=>{o(S,{})}),Ve(()=>t(),()=>{o(K,t().skillProficiencies)}),Ve(()=>t(),()=>{o(E,t().proficiencyBonus)}),Ve(()=>c(),()=>{o(ae,c())}),Ve(()=>(e(ae),e(K),e(E)),()=>{for(const{key:se}of W){const _e=Aa[se],Te=e(ae)[_e],w=e(K)[se]?e(E):0;ia(S,e(S)[se]=Te+w)}}),Ve(()=>d(),()=>{o(V,W.filter(({label:se})=>d()?se.toLowerCase().includes(d().toLowerCase()):!0))}),Ve(()=>e(V),()=>{o(X,e(V).length>0)}),aa(),It();var Se=Rl();let Ne;var ne=i(Se);{let se=vt(()=>(f(),n(()=>f().skills?"Expand":"Collapse")));ba(ne,{title:"Skills",get collapsed(){return f(),n(()=>f().skills)},get ariaLabel(){return e(se)},onToggle:()=>Ot.update(_e=>({..._e,skills:!_e.skills}))})}var Me=s(ne,2);{var qe=se=>{var _e=Fl();St(_e,5,()=>e(V),wt,(Te,w)=>{let B=()=>e(w).key,_=()=>e(w).label;var H=Ml(),h=i(H);Be(h);var F=s(h,2),J=i(F),Ie=s(J),je=i(Ie);l(Ie),l(F);var xe=s(F,2),Ae=i(xe);l(xe);var tt=s(xe,2);l(H),M(Xe=>{gs(h,(e(K),B(),n(()=>e(K)[B()]))),h.disabled=!b(),Ke(h,"id",B()),Ke(F,"for",B()),A(J,`${_()??""} `),A(je,`(${Xe??""})`),A(Ae,`${e(S),B(),n(()=>e(S)[B()]>=0?"+":"")??""}${e(S),B(),n(()=>e(S)[B()])??""}`)},[()=>(R(Aa),B(),n(()=>Aa[B()].substring(0,3).toUpperCase()))]),L("change",h,Xe=>{console.log("Skill proficiency changed:",B(),Xe.target.checked),ee.update(ct=>({...ct,skillProficiencies:{...ct.skillProficiencies,[B()]:Xe.target.checked}}))}),L("click",tt,()=>P(B())),v(Te,H)}),l(_e),v(se,_e)};x(Me,se=>{f(),n(()=>!f().skills)&&se(qe)})}l(Se),M(()=>Ne=xt(Se,1,"skills svelte-1f1pl16",null,Ne,{hidden:!e(X)})),v(a,Se),Et(),$()}var Il=p('<p class="empty-message svelte-1123ljy">No attacks or spells to reorder.</p>'),Pl=p('<li class="reorder-item svelte-1123ljy"><span class="attack-name svelte-1123ljy"> </span> <div class="reorder-buttons svelte-1123ljy"><button class="btn-move svelte-1123ljy" aria-label="Move up">‚ñ≤</button> <button class="btn-move svelte-1123ljy" aria-label="Move down">‚ñº</button></div></li>'),El=p('<ul class="reorder-list svelte-1123ljy"></ul>'),Hl=p('<div class="modal-backdrop svelte-1123ljy" role="presentation"><div class="modal-content svelte-1123ljy" role="dialog" aria-modal="true" aria-labelledby="modal-title"><div class="modal-header svelte-1123ljy"><h3 id="modal-title" class="svelte-1123ljy">Reorder Attacks & Spells</h3> <button class="btn-close svelte-1123ljy" aria-label="Close">√ó</button></div> <div class="modal-body svelte-1123ljy"><!></div> <div class="modal-footer svelte-1123ljy"><button class="btn btn-secondary svelte-1123ljy">Cancel</button> <button class="btn btn-primary svelte-1123ljy">Save Order</button></div></div></div>');function Nl(a,r){Pt(r,!1);let t=pt(r,"show",8,!1),c=pt(r,"attacks",24,()=>[]),d=pt(r,"onSave",8),f=pt(r,"onCancel",8),b=D([]);function C(W,P){const Se=e(b)[W];ia(b,e(b)[W]=e(b)[P]),ia(b,e(b)[P]=Se),o(b,[...e(b)])}function $(W){W>0&&C(W,W-1)}function S(W){W<e(b).length-1&&C(W,W+1)}function K(){d()(e(b))}function E(){f()()}function ae(W){W.target===W.currentTarget&&E()}Ve(()=>(R(t()),R(c())),()=>{t()&&o(b,[...c()])}),aa(),It();var V=ot(),X=He(V);{var de=W=>{var P=Hl(),Se=i(P),Ne=i(Se),ne=s(i(Ne),2);l(Ne);var Me=s(Ne,2),qe=i(Me);{var se=_=>{var H=Il();v(_,H)},_e=_=>{var H=El();St(H,7,()=>e(b),h=>h.id,(h,F,J)=>{var Ie=Pl(),je=i(Ie),xe=i(je,!0);l(je);var Ae=s(je,2),tt=i(Ae),Xe=s(tt,2);l(Ae),l(Ie),M(()=>{A(xe,(e(F),n(()=>e(F).name||"(Unnamed attack or spell)"))),tt.disabled=e(J)===0,Xe.disabled=(R(e(J)),e(b),n(()=>e(J)===e(b).length-1))}),L("click",tt,()=>$(e(J))),L("click",Xe,()=>S(e(J))),v(h,Ie)}),l(H),v(_,H)};x(qe,_=>{e(b),n(()=>e(b).length===0)?_(se):_(_e,!1)})}l(Me);var Te=s(Me,2),w=i(Te),B=s(w,2);l(Te),l(Se),l(P),L("click",ne,E),L("click",w,E),L("click",B,K),L("click",P,ae),v(W,P)};x(X,W=>{t()&&W(de)})}v(a,V),Et()}let Ba=null,Ma=null;async function ks(){if(Ba)return Ba;try{return Ba=await(await fetch(hs("/data/spells.json"))).json(),Ba||[]}catch(a){return console.error("Failed to load spells:",a),[]}}async function Ul(){if(Ma)return Ma;try{return Ma=await(await fetch(hs("/data/feats.json"))).json(),Ma||[]}catch(a){return console.error("Failed to load feats:",a),[]}}function os(a,r){if(!r.trim())return a;const t=r.toLowerCase();return a.filter(c=>c.name.toLowerCase().includes(t)||c.school.toLowerCase().includes(t)||c.classes.some(d=>d.toLowerCase().includes(t))||c.description.toLowerCase().includes(t))}function Ol(a,r){return r===null?a:a.filter(t=>t.level===r)}function Gl(a,r){if(!r.trim())return a;const t=r.toLowerCase();return a.filter(c=>c.name.toLowerCase().includes(t)||c.description.toLowerCase().includes(t))}function Fa(a){const r=a.description,t=/\b(Strength|Dexterity|Constitution|Intelligence|Wisdom|Charisma)\s+saving\s+throw/i,c=r.match(t);if(!c)return null;const d=c[1].toLowerCase(),b=/half\s+(?:as\s+much\s+)?damage\s+on\s+a\s+successful(?:\s+save)?/i.test(r),$=/saving\s+throw\s+or\s+take.*?damage/i.test(r)&&!b;return{ability:d,halfDamageOnSave:b,noDamageOnSave:$}}function ql(a){const r=a.description;return/(plus|add)\s+your\s+spellcasting\s+(ability\s+)?modifier/i.test(r)}function Oa(a){const r=a.description.toLowerCase();return r.includes("ranged spell attack")||r.includes("melee spell attack")}function cs(a){const r=a.description.toLowerCase();if(["Divine Favor","Bless","Aid","Command"].includes(a.name))return!0;const d=["takes","take","deals","deal","damage equal to","force damage","fire damage","cold damage","lightning damage","thunder damage","acid damage","poison damage","necrotic damage","radiant damage","psychic damage","regain","regains","hit point"].some(C=>r.includes(C));return["bonus to attack","bonus to damage","bonus to ac","gains a +","gain a +","+1 bonus","+2 bonus","+3 bonus","advantage on","becomes a magic weapon"].some(C=>r.includes(C))&&!d}function Wl(a){const r=a.description;let t=0,c=0,d=0,f="";const b=r.match(/\+(\d+)\s+bonus\s+to\s+attack\s+rolls\s+and\s+damage\s+rolls/i);if(b){const $=parseInt(b[1]);t=$,c=$,f=`+${$} to attack and damage rolls`}if(a.name==="Bless"&&(f="Add 1d4 to attack rolls and saves",t="1d4"),a.name==="Aid")return f="+5 HP (max and current) for 8 hours",{attackBonus:0,damageBonus:0,acBonus:0,hpBonus:5,description:f,name:a.name};a.name==="Divine Favor"&&(f="Your weapon attacks deal an extra 1d4 radiant damage on a hit.",c="1d4");const C=r.match(/\+(\d+)\s+bonus\s+to\s+AC/i);return C&&(d=parseInt(C[1]),f=`+${d} to AC`),a.name==="Haste"&&(f="+2 AC, doubled speed, extra action",d=2),f||t!==0||c!==0||d!==0?{attackBonus:t,damageBonus:c,acBonus:d,description:f||a.description.substring(0,100),name:a.name}:null}function Ga(a){const r=a.description,t=/takes?\s+(\d+d\d+)\s+\w+\s+damage[^.]*\.\s*If\s+the\s+target\s+is\s+missing.*?instead\s+takes?\s+(\d+d\d+)/is,c=r.match(t);return c?{baseDamage:c[1],alternateDamage:c[2]}:null}var zl=p('<button class="btn btn-secondary">Reorder</button>'),Kl=p('<div class="edit-buttons svelte-14o91c5"><button class="btn btn-secondary">Add Attack</button> <!></div>'),Vl=p('<input type="text" placeholder="Attack name" class="attack-name svelte-14o91c5"/>'),Jl=p('<h4 class="attack-name-display svelte-14o91c5"> </h4>'),Yl=p('<button class="btn-remove svelte-14o91c5">√ó</button>'),Ql=p('<div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Bonus</label> <input type="number" class="attack-bonus svelte-14o91c5"/></div>'),Xl=p('<div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Damage</label> <input type="text" placeholder="e.g., 2d6+3" class="attack-damage svelte-14o91c5"/></div>'),Zl=p('<div class="spell-info-loading svelte-14o91c5">Loading spell info...</div>'),ei=p('<li class="svelte-14o91c5"><strong>At Higher Levels:</strong> </li>'),ti=p('<ul class="svelte-14o91c5"><li class="svelte-14o91c5"><strong>Level:</strong> </li> <li class="svelte-14o91c5"><strong>Casting Time:</strong> </li> <li class="svelte-14o91c5"><strong>Range:</strong> </li> <li class="svelte-14o91c5"><strong>Components:</strong> <!></li> <li class="svelte-14o91c5"><strong>Duration:</strong> <!> </li> <li class="svelte-14o91c5"><strong>Description:</strong> </li> <!></ul>'),ai=p('<span class="scaled-damage svelte-14o91c5" style="margin-left: 8px;"> </span>'),si=p('<span class="scaled-damage svelte-14o91c5">(Half damage)</span>'),li=p('<span class="scaled-damage svelte-14o91c5">(No damage)</span>'),ii=p('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> <!> <!></label></div>'),ni=p('<span class="scaled-damage svelte-14o91c5"> </span>'),ri=p('<span class="scaled-damage svelte-14o91c5"> </span>'),oi=p('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> Target is missing HP <!></label></div>'),ci=p("<option> </option>"),vi=p('<span class="scaled-damage svelte-14o91c5"><!> </span>'),di=p('<span class="scaled-damage svelte-14o91c5"> </span>'),ui=p('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> Target is Fiend or Undead <!></label></div>'),fi=p('<div class="spell-level-selector svelte-14o91c5"><label class="svelte-14o91c5">Cast at Level:</label> <select class="spell-level-select use-enabled svelte-14o91c5"></select> <!></div> <!>',1),pi=p('<div class="spell-level-selector svelte-14o91c5"><span style="color: #dc3545; font-weight: bold;">No spell slots available!</span></div>'),mi=p('<div class="spell-info svelte-14o91c5"><div class="spell-info-header svelte-14o91c5" role="button" tabindex="0"><h4 class="svelte-14o91c5">Spell Info</h4> <button class="collapse-btn-small svelte-14o91c5"> </button></div> <!></div> <!> <!> <!>',1),bi=p('<div class="spell-info-missing svelte-14o91c5">Spell info not found.</div>'),gi=p('<div class="attack-notes svelte-14o91c5"><label class="svelte-14o91c5">Notes</label> <textarea placeholder="e.g., DC 15 Dex save, Range 120 ft, Concentration" class="notes-input svelte-14o91c5" rows="2"></textarea></div>'),hi=p('<button class="btn btn-primary">Roll Attack</button>'),_i=p('<div class="buff-target-selection svelte-14o91c5"><div class="target-options svelte-14o91c5"><label class="target-option svelte-14o91c5"><input type="radio" class="svelte-14o91c5"/> Self</label> <label class="target-option svelte-14o91c5"><input type="radio" class="svelte-14o91c5"/> Other</label></div> <button class="btn btn-info"> </button></div>'),yi=p('<button class="btn btn-info">Cast Spell</button>'),ki=p("<button><!></button>"),Si=p('<button class="btn btn-info">Cast Spell</button>'),xi=p('<button class="btn btn-secondary">Roll Damage</button>'),$i=p('<button class="btn btn-primary">Roll Attack</button> <!>',1),Ci=p('<div class="attack-card svelte-14o91c5"><div class="attack-header svelte-14o91c5"><!> <!></div> <div class="attack-details svelte-14o91c5"><!> <!> <div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Type</label> <input type="text" placeholder="e.g., slashing" class="attack-type svelte-14o91c5"/></div></div> <!> <!> <div class="attack-actions svelte-14o91c5"><!></div></div>'),wi=p('<p class="no-attacks svelte-14o91c5">No attacks added yet. Click "Add Attack" to create one.</p>'),Di=p('<p class="no-attacks svelte-14o91c5">No attacks match your search.</p>'),Li=p('<button class="btn-remove svelte-14o91c5">√ó</button>'),ji=p('<div class="state-card svelte-14o91c5"><div class="state-header svelte-14o91c5"><input type="text" placeholder="Effect name (e.g., Magic Weapon)" class="state-name svelte-14o91c5"/> <!></div> <div class="state-details svelte-14o91c5"><div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Attack Bonus</label> <input type="number" class="state-bonus svelte-14o91c5"/></div> <div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Damage Bonus</label> <input type="text" class="state-bonus svelte-14o91c5"/></div> <div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Target</label> <select class="state-bonus svelte-14o91c5"><option>Self</option><option>Other</option></select></div></div> <div class="state-description svelte-14o91c5"><label class="svelte-14o91c5">Description</label> <input type="text" placeholder="e.g., +1 to attack and damage rolls (Magic Weapon)" class="state-desc-input svelte-14o91c5"/></div></div>'),Ai=p('<div class="states-list svelte-14o91c5"></div>'),Bi=p('<p class="no-states svelte-14o91c5">No active effects. Add spell effects that modify your attacks.</p>'),Mi=p('<!> <div class="attacks-list svelte-14o91c5"><!> <!></div> <div class="active-states-section svelte-14o91c5"><h3 class="svelte-14o91c5">Active Spell Effects</h3> <p class="section-description svelte-14o91c5">Effects that modify attack and damage rolls (e.g., Magic Weapon, Bless)</p> <button class="btn btn-secondary">Add Effect</button> <!></div>',1),Fi=p("<section><!> <!></section> <!>",1);function Ri(a,r){Pt(r,!1);const t=()=>Ze(ee,"$character",C),c=()=>Ze(Da,"$abilityModifiers",C),d=()=>Ze(da,"$searchFilter",C),f=()=>Ze(Ot,"$collapsedStates",C),b=()=>Ze(va,"$isEditMode",C),[C,$]=Yt(),S=D(),K=D(),E=[],ae=ma();let V=D({}),X=D({}),de=D(!1);function W(k){ia(V,e(V)[k]=!e(V)[k]),o(V,{...e(V)})}function P(k){return k.description.toLowerCase().includes("regain")&&(k.description.toLowerCase().includes("hit point")||k.description.toLowerCase().includes("hp"))}function Se(k){return["Shield of Faith","Bless","Aid","Magic Weapon"].includes(k)}function Ne(){ee.update(k=>(k.attacks=[...k.attacks,{id:crypto.randomUUID(),name:"",bonus:0,damage:"",damageType:"",notes:""}],k))}function ne(k){ee.update(U=>(U.attacks=U.attacks.filter(ye=>ye.id!==k),U))}function Me(){o(de,!0)}function qe(){o(de,!1)}function se(k){ee.update(U=>(U.attacks=k,U)),o(de,!1),Wt.add("Attack order updated successfully!","success")}function _e(k){let U=k.damage,ye=!1,$e=!1;if(k.spellRef){const z=_(k.spellRef);if(z&&($e=Oa(z),z.level>0)){const pe=k.castAtLevel||z.level;if(!H(pe)){Wt.add(`No level ${pe} spell slots available!`,"error");return}const he=Fa(z);he&&k.targetSucceededSave&&he.noDamageOnSave?U="0":(ye=he?.halfDamageOnSave&&k.targetSucceededSave||!1,U=h(k,z))}}else if(t().activeStates&&t().activeStates.length>0){let z=0,pe=[];for(const O of t().activeStates)O.target!=="other"&&(typeof O.damageBonus=="string"?pe.push(O.damageBonus):typeof O.damageBonus=="number"&&(z+=O.damageBonus));if((z!==0||pe.length>0)&&U){const O=U.match(/(\d+d\d+)([+-]\d+)?/);if(O){const[,he,Ce]=O,q=(Ce?parseInt(Ce):0)+z;let u=`${he}`;q!==0&&(u+=`${q>=0?"+":""}${q}`),pe.length>0&&(u+=" + "+pe.join(" + ")),U=u}}}const T=[];let j=0;if($e){const z=rs(t(),c()),pe=t().proficiencyBonus||0;T.push({value:pe,source:"proficiency"}),T.push({value:z,source:"spellcasting"}),j=pe+z}else k.bonus!==0&&T.push({value:k.bonus,source:"base"}),j=k.bonus;let le=[];if(t().activeStates)for(const z of t().activeStates)z.target!=="other"&&(typeof z.attackBonus=="number"&&z.attackBonus!==0?(T.push({value:z.attackBonus,source:z.name.toLowerCase()}),j+=z.attackBonus):typeof z.attackBonus=="string"&&z.attackBonus&&(le.push(z.attackBonus),T.push({value:z.attackBonus,source:z.name.toLowerCase()})));let re=`1d20${j>=0?"+":""}${j}`;le.length>0&&(re+="+"+le.join("+")),ae("roll",{notation:re,damageNotation:U,attackName:k.name,applyHalfDamage:ye,bonusBreakdown:T,rollType:"attack"})}function Te(k){if(!k.damage){Wt.add(`${k.name}: No damage specified`,"error");return}let U=k.damage,ye=!1;const $e=[];if(k.spellRef){const T=_(k.spellRef);if(T&&T.level>0){const j=k.castAtLevel||T.level;if(!H(j)){Wt.add(`No level ${j} spell slots available!`,"error");return}const re=Fa(T);re&&k.targetSucceededSave&&re.noDamageOnSave?U="0":(ye=re?.halfDamageOnSave&&k.targetSucceededSave||!1,U=h(k,T))}}else{const T=U.match(/(\d+d\d+)([+-]\d+)?/);if(T){const[,j,le]=T,re=le?parseInt(le):0;if(re!==0&&$e.push({value:re,source:"base"}),t().activeStates&&t().activeStates.length>0){let z=0,pe=[];for(const O of t().activeStates)O.target!=="other"&&(typeof O.damageBonus=="string"?pe.push(O.damageBonus):typeof O.damageBonus=="number"&&O.damageBonus!==0&&($e.push({value:O.damageBonus,source:O.name.toLowerCase()}),z+=O.damageBonus));if(z!==0||pe.length>0){const O=re+z;let he=`${j}`;O!==0&&(he+=`${O>=0?"+":""}${O}`),pe.length>0&&(he+=" + "+pe.join(" + ")),U=he}}}}ae("roll",{notation:U,attackName:k.name,applyHalfDamage:ye,bonusBreakdown:$e})}let w=D([]),B=D(!1);_a(async()=>{o(w,await ks()),o(B,!0)});function _(k){return e(w).find(U=>U.name===k)}function H(k){t().classFeatures.spellSlotsByLevel||kt(ee,n(t).classFeatures.spellSlotsByLevel={},n(t)),t().classFeatures.spellSlotsByLevel[k]||kt(ee,n(t).classFeatures.spellSlotsByLevel[k]=Array(2).fill(!1),n(t));const ye=t().classFeatures.spellSlotsByLevel[k].findIndex($e=>!$e);return ye===-1?!1:(ee.update($e=>($e.classFeatures.spellSlotsByLevel||($e.classFeatures.spellSlotsByLevel={}),$e.classFeatures.spellSlotsByLevel[k]||($e.classFeatures.spellSlotsByLevel[k]=Array(2).fill(!1)),$e.classFeatures.spellSlotsByLevel[k][ye]=!0,$e)),!0)}function h(k,U){let ye=k.damage,$e=0,T=0;const j=Ga(U);if(j&&k.targetIsDamaged&&(ye=j.alternateDamage),ql(U)&&(T+=rs(t(),c())),t().activeStates)for(const q of t().activeStates)q.target!=="other"&&typeof q.damageBonus=="number"&&(T+=q.damageBonus);if(U.higherLevelSlot&&k.castAtLevel){const q=U.level,Re=(k.castAtLevel||q)-q;if(Re>0){const we=U.higherLevelSlot.match(/(\d+)d(\d+)\s+for\s+each.*?level\s+above/i);if(we){const[,ce]=we;$e+=Re*parseInt(ce)}}}if(k.targetIsFiendOrUndead&&U.description.includes("Fiend or an Undead")){const q=U.description.match(/increases by (\d+)d(\d+) if.*?Fiend or.*?Undead/i);if(q){const[,u]=q;$e+=parseInt(u)}}const le=ye.match(/(\d+)d(\d+)([+-]\d+)?/);if(!le)return T!==0?T>=0?`${T}`:`${T}`:ye||"0";const[,re,z,pe]=le,O=parseInt(re)+$e,Ce=(pe?parseInt(pe):0)+T;let I=`${O}d${z}`;return Ce!==0&&(I+=Ce>=0?`+${Ce}`:`${Ce}`),I}function F(k){const U=[];for(let $e=k.level;$e<=9;$e++){const T=t().classFeatures.spellSlotsByLevel?.[$e];T&&T.length>0&&U.push($e)}return U}function J(){ee.update(k=>(k.activeStates||(k.activeStates=[]),k.activeStates=[...k.activeStates,{name:"",attackBonus:0,damageBonus:0,description:"",target:"self"}],k))}function Ie(k){ee.update(U=>{if(U.activeStates){const ye=U.activeStates[k];ye?.hpBonus&&ye.target!=="other"&&(U.maxHP-=ye.hpBonus,U.currentHP=Math.max(1,Math.min(U.currentHP-ye.hpBonus,U.maxHP))),U.activeStates=U.activeStates.filter(($e,T)=>T!==k)}return U})}function je(k,U="self"){const ye=_(k.spellRef);if(!ye){Wt.add("Spell not found","error");return}const $e=k.castAtLevel||ye.level;if($e>0&&!H($e)){Wt.add(`No level ${$e} spell slots available!`,"error");return}const T=Wl(ye);if(!T){Wt.add(`${ye.name} cast! Check spell description for effects.`,"info");return}let j=T.hpBonus||0,le=T.description;ye.name==="Aid"&&$e>ye.level&&(j=5+($e-ye.level)*5,le=`+${j} HP (max and current) for 8 hours`);const z=["Shield of Faith","Bless","Aid","Magic Weapon"].includes(ye.name);ee.update(O=>{O.activeStates||(O.activeStates=[]);const he=O.activeStates.find(Ce=>Ce.name===ye.name);return he&&he.hpBonus&&he.target!=="other"&&(O.maxHP-=he.hpBonus,O.currentHP=Math.max(1,Math.min(O.currentHP-he.hpBonus,O.maxHP))),O.activeStates=O.activeStates.filter(Ce=>Ce.name!==ye.name),j>0&&U==="self"&&(O.maxHP+=j,O.currentHP+=j),O.activeStates=[...O.activeStates,{name:ye.name,attackBonus:T.attackBonus,damageBonus:T.damageBonus,acBonus:T.acBonus,description:le,target:U,hpBonus:j}],O});const pe=U==="self"?" on self":" on other";Wt.add(`${ye.name} cast${z?pe:""}! Effect added to Active Spell Effects.`,"success")}Ve(()=>(t(),e(V),e(X)),()=>{if(t()&&t().attacks)for(const k of t().attacks)k.spellRef&&e(V)[k.id]===void 0&&ia(V,e(V)[k.id]=!0),k.spellRef&&e(X)[k.id]===void 0&&ia(X,e(X)[k.id]="self")}),Ve(()=>(t(),d()),()=>{o(S,t().attacks.filter(k=>{if(!d())return!0;const U=d().toLowerCase();return k.name.toLowerCase().includes(U)||k.damageType.toLowerCase().includes(U)}).sort((k,U)=>!k.spellRef&&U.spellRef?-1:k.spellRef&&!U.spellRef?1:0))}),Ve(()=>(d(),e(S)),()=>{o(K,!d()||e(S).length>0||"attack".includes(d().toLowerCase())||"spell".includes(d().toLowerCase()))}),aa(),It();var xe=Fi(),Ae=He(xe);let tt;var Xe=i(Ae);{let k=vt(()=>(f(),n(()=>f().attacks?"Expand":"Collapse")));ba(Xe,{title:"Attacks & Spells",get collapsed(){return f(),n(()=>f().attacks)},get ariaLabel(){return e(k)},onToggle:()=>Ot.update(U=>({...U,attacks:!U.attacks}))})}var ct=s(Xe,2);{var it=k=>{var U=Mi(),ye=He(U);{var $e=q=>{var u=Kl(),Re=i(u),we=s(Re,2);{var ce=be=>{var De=zl();L("click",De,Me),v(be,De)};x(we,be=>{t(),n(()=>t().attacks.length>0)&&be(ce)})}l(u),L("click",Re,Ne),v(q,u)};x(ye,q=>{b()&&q($e)})}var T=s(ye,2),j=i(T);St(j,1,()=>e(S),q=>q.id,(q,u,Re)=>{var we=Ci(),ce=i(we),be=i(ce);{var De=me=>{var te=Vl();Be(te),Je(te,()=>e(u).name,Qe=>(e(u).name=Qe,Lt(()=>(e(S),t(),d())))),v(me,te)},Ge=me=>{var te=Jl(),Qe=i(te,!0);l(te),M(()=>A(Qe,(e(u),n(()=>e(u).name||"(Unnamed Attack)")))),v(me,te)};x(be,me=>{b()?me(De):me(Ge,!1)})}var We=s(be,2);{var ze=me=>{var te=Yl();L("click",te,()=>ne(e(u).id)),v(me,te)};x(We,me=>{b()&&me(ze)})}l(ce);var oe=s(ce,2),ge=i(oe);{var Y=me=>{var te=Ql(),Qe=i(te),st=s(Qe,2);Be(st),l(te),M(()=>{Ke(Qe,"for",`attack-bonus-${e(u),n(()=>e(u).id)??""}`),Ke(st,"id",`attack-bonus-${e(u),n(()=>e(u).id)??""}`)}),Je(st,()=>e(u).bonus,m=>(e(u).bonus=m,Lt(()=>(e(S),t(),d())))),v(me,te)};x(ge,me=>{e(u),n(()=>e(u).bonus!==0&&e(u).bonus!==void 0)&&me(Y)})}var Fe=s(ge,2);{var ue=me=>{var te=Xl(),Qe=i(te),st=s(Qe,2);Be(st),l(te),M(()=>{Ke(Qe,"for",`attack-damage-${e(u),n(()=>e(u).id)??""}`),Ke(st,"id",`attack-damage-${e(u),n(()=>e(u).id)??""}`)}),Je(st,()=>e(u).damage,m=>(e(u).damage=m,Lt(()=>(e(S),t(),d())))),v(me,te)};x(Fe,me=>{e(u),n(()=>e(u).damage&&e(u).damage.trim()!=="")&&me(ue)})}var y=s(Fe,2),N=i(y),Z=s(N,2);Be(Z),l(y),l(oe);var Q=s(oe,2);{var ke=me=>{var te=ot(),Qe=He(te);{var st=G=>{var g=Zl();v(G,g)},m=G=>{const g=vt(()=>(e(u),n(()=>_(e(u).spellRef))));var Le=ot(),ve=He(Le);{var lt=nt=>{const Ee=vt(()=>(R(Fa),R(e(g)),n(()=>Fa(e(g))))),rt=vt(()=>(R(Ga),R(e(g)),n(()=>Ga(e(g)))));var $t=mi(),ht=He($t),dt=i(ht),mt=s(i(dt),2),bt=i(mt,!0);l(mt),l(dt);var Ft=s(dt,2);{var _t=ut=>{var Ct=ti(),Bt=i(Ct),Jt=s(i(Bt));l(Bt);var Xt=s(Bt,2),na=s(i(Xt));l(Xt);var Ht=s(Xt,2),jt=s(i(Ht));l(Ht);var Rt=s(Ht,2),Gt=s(i(Rt)),ft=s(Gt);{var Kt=At=>{var Mt=Ut();M(()=>A(Mt,`(${R(e(g)),n(()=>e(g).material)??""})`)),v(At,Mt)};x(ft,At=>{R(e(g)),n(()=>e(g).material)&&At(Kt)})}l(Rt);var la=s(Rt,2),ra=s(i(la),2);{var ua=At=>{var Mt=Ut("Concentration,");v(At,Mt)};x(ra,At=>{R(e(g)),n(()=>e(g).concentration)&&At(ua)})}var Tt=s(ra,1,!0);l(la);var qt=s(la,2),Nt=s(i(qt));l(qt);var Zt=s(qt,2);{var oa=At=>{var Mt=ei(),ea=s(i(Mt));l(Mt),M(()=>A(ea,` ${R(e(g)),n(()=>e(g).higherLevelSlot)??""}`)),v(At,Mt)};x(Zt,At=>{R(e(g)),n(()=>e(g).higherLevelSlot)&&At(oa)})}l(Ct),M(At=>{A(Jt,` ${R(e(g)),n(()=>e(g).level)??""}`),A(na,` ${R(e(g)),n(()=>e(g).castingTime||e(g).actionType)??""}`),A(jt,` ${R(e(g)),n(()=>e(g).range)??""}`),A(Gt,` ${At??""}`),A(Tt,(R(e(g)),n(()=>e(g).duration))),A(Nt,` ${R(e(g)),n(()=>e(g).description)??""}`)},[()=>(R(e(g)),n(()=>e(g).components.join(", ")))]),v(ut,Ct)};x(Ft,ut=>{e(V),e(u),n(()=>!e(V)[e(u).id])&&ut(_t)})}l(ht);var gt=s(ht,2);{var sa=ut=>{var Ct=ii(),Bt=i(Ct),Jt=i(Bt);Be(Jt);var Xt=s(Jt),na=s(Xt);{var Ht=ft=>{var Kt=ai(),la=i(Kt);l(Kt),M(ra=>A(la,`(Spell Save DC: ${ra??""})`),[()=>(R(Va),t(),c(),n(()=>Va(t(),c())))]),v(ft,Kt)};x(na,ft=>{t(),n(()=>t().class)&&ft(Ht)})}var jt=s(na,2);{var Rt=ft=>{var Kt=si();v(ft,Kt)},Gt=ft=>{var Kt=ot(),la=He(Kt);{var ra=ua=>{var Tt=li();v(ua,Tt)};x(la,ua=>{e(u),R(e(Ee)),n(()=>e(u).targetSucceededSave&&e(Ee).noDamageOnSave)&&ua(ra)},!0)}v(ft,Kt)};x(jt,ft=>{e(u),R(e(Ee)),n(()=>e(u).targetSucceededSave&&e(Ee).halfDamageOnSave)?ft(Rt):ft(Gt,!1)})}l(Bt),l(Ct),M(ft=>A(Xt,` Target succeeded on ${ft??""} save `),[()=>(R(e(Ee)),n(()=>e(Ee).ability.charAt(0).toUpperCase()+e(Ee).ability.slice(1)))]),Ca(Jt,()=>e(u).targetSucceededSave,ft=>(e(u).targetSucceededSave=ft,Lt(()=>(e(S),t(),d())))),v(ut,Ct)};x(gt,ut=>{e(Ee)&&ut(sa)})}var Qt=s(gt,2);{var Vt=ut=>{var Ct=oi(),Bt=i(Ct),Jt=i(Bt);Be(Jt);var Xt=s(Jt,2);{var na=jt=>{const Rt=vt(()=>(e(u),R(e(g)),n(()=>h(e(u),e(g)))));var Gt=ni(),ft=i(Gt);l(Gt),M(()=>A(ft,`(${R(e(rt)),n(()=>e(rt).alternateDamage)??""}, total: ${e(Rt)??""})`)),v(jt,Gt)},Ht=jt=>{var Rt=ri(),Gt=i(Rt);l(Rt),M(()=>A(Gt,`(${R(e(rt)),n(()=>e(rt).baseDamage)??""})`)),v(jt,Rt)};x(Xt,jt=>{e(u),n(()=>e(u).targetIsDamaged)?jt(na):jt(Ht,!1)})}l(Bt),l(Ct),Ca(Jt,()=>e(u).targetIsDamaged,jt=>(e(u).targetIsDamaged=jt,Lt(()=>(e(S),t(),d())))),v(ut,Ct)};x(Qt,ut=>{e(rt)&&ut(Vt)})}var yt=s(Qt,2);{var Dt=ut=>{const Ct=vt(()=>(R(e(g)),n(()=>F(e(g)))));var Bt=ot(),Jt=He(Bt);{var Xt=Ht=>{var jt=fi(),Rt=He(jt),Gt=i(Rt),ft=s(Gt,2);M(()=>{e(u),Lt(()=>{e(Ct)})}),St(ft,5,()=>e(Ct),wt,(Tt,qt)=>{var Nt=ci(),Zt=i(Nt);l(Nt);var oa={};M(()=>{A(Zt,`Level ${e(qt)??""}`),oa!==(oa=e(qt))&&(Nt.value=(Nt.__value=e(qt))??"")}),v(Tt,Nt)}),l(ft);var Kt=s(ft,2);{var la=Tt=>{const qt=vt(()=>(e(u),R(e(g)),n(()=>h(e(u),e(g)))));var Nt=vi(),Zt=i(Nt);{var oa=ea=>{var fa=Ut("Healing");v(ea,fa)},At=ea=>{var fa=Ut("Damage");v(ea,fa)};x(Zt,ea=>{R(e(g)),n(()=>P(e(g)))?ea(oa):ea(At,!1)})}var Mt=s(Zt);l(Nt),M(()=>A(Mt,` ${e(qt)??""}`)),v(Tt,Nt)};x(Kt,Tt=>{e(u),R(e(g)),n(()=>e(u).castAtLevel&&e(u).castAtLevel>e(g).level)&&Tt(la)})}l(Rt);var ra=s(Rt,2);{var ua=Tt=>{var qt=ui(),Nt=i(qt),Zt=i(Nt);Be(Zt);var oa=s(Zt,2);{var At=Mt=>{const ea=vt(()=>(e(u),R(e(g)),n(()=>h(e(u),e(g)))));var fa=di(),Ss=i(fa);l(fa),M(()=>A(Ss,`(+1d8, total: ${e(ea)??""})`)),v(Mt,fa)};x(oa,Mt=>{e(u),n(()=>e(u).targetIsFiendOrUndead)&&Mt(At)})}l(Nt),l(qt),Ca(Zt,()=>e(u).targetIsFiendOrUndead,Mt=>(e(u).targetIsFiendOrUndead=Mt,Lt(()=>(e(S),t(),d())))),v(Tt,qt)};x(ra,Tt=>{R(e(g)),n(()=>e(g).description.includes("Fiend or an Undead"))&&Tt(ua)})}M(()=>{Ke(Gt,"for",`castLevel-${e(u),n(()=>e(u).id)??""}`),Ke(ft,"id",`castLevel-${e(u),n(()=>e(u).id)??""}`)}),Ta(ft,()=>e(u).castAtLevel,Tt=>(e(u).castAtLevel=Tt,Lt(()=>(e(S),t(),d())))),v(Ht,jt)},na=Ht=>{var jt=pi();v(Ht,jt)};x(Jt,Ht=>{R(e(Ct)),n(()=>e(Ct).length>0)?Ht(Xt):Ht(na,!1)})}v(ut,Bt)};x(yt,ut=>{R(e(g)),n(()=>e(g).higherLevelSlot&&e(g).level>0)&&ut(Dt)})}M(()=>{Ke(mt,"aria-label",(e(V),e(u),n(()=>e(V)[e(u).id]?"Expand":"Collapse"))),A(bt,(e(V),e(u),n(()=>e(V)[e(u).id]?"‚ñº":"‚ñ≤")))}),L("click",dt,()=>W(e(u).id)),L("keydown",dt,ut=>ut.key==="Enter"&&W(e(u).id)),v(nt,$t)},Pe=nt=>{var Ee=bi();v(nt,Ee)};x(ve,nt=>{e(g)?nt(lt):nt(Pe,!1)})}v(G,Le)};x(Qe,G=>{e(w),n(()=>e(w).length===0)?G(st):G(m,!1)})}v(me,te)};x(Q,me=>{e(u),n(()=>e(u).spellRef)&&me(ke)})}var ie=s(Q,2);{var Ue=me=>{var te=gi(),Qe=i(te),st=s(Qe,2);Sa(st),l(te),M(()=>{Ke(Qe,"for",`attack-notes-${e(u),n(()=>e(u).id)??""}`),Ke(st,"id",`attack-notes-${e(u),n(()=>e(u).id)??""}`)}),Je(st,()=>e(u).notes,m=>(e(u).notes=m,Lt(()=>(e(S),t(),d())))),v(me,te)};x(ie,me=>{e(u),n(()=>!e(u).spellRef)&&me(Ue)})}var fe=s(ie,2),Oe=i(fe);{var Ye=me=>{const te=vt(()=>(e(u),n(()=>_(e(u).spellRef))));var Qe=ot(),st=He(Qe);{var m=G=>{var g=ot(),Le=He(g);{var ve=Pe=>{var nt=hi();L("click",nt,()=>_e(e(u))),v(Pe,nt)},lt=Pe=>{var nt=ot(),Ee=He(nt);{var rt=ht=>{var dt=ot(),mt=He(dt);{var bt=_t=>{var gt=_i(),sa=i(gt),Qt=i(sa),Vt=i(Qt);Be(Vt),Vt.value=Vt.__value="self",pa(),l(Qt);var yt=s(Qt,2),Dt=i(yt);Be(Dt),Dt.value=Dt.__value="other",pa(),l(yt),l(sa);var ut=s(sa,2),Ct=i(ut);l(ut),l(gt),M(()=>{Ke(Vt,"name",`target-${e(u),n(()=>e(u).id)??""}`),Ke(Dt,"name",`target-${e(u),n(()=>e(u).id)??""}`),A(Ct,`Cast ${R(e(te)),n(()=>e(te).name)??""}`)}),as(E,[Re],Vt,()=>e(X)[e(u).id],Bt=>ia(X,e(X)[e(u).id]=Bt)),as(E,[Re],Dt,()=>e(X)[e(u).id],Bt=>ia(X,e(X)[e(u).id]=Bt)),L("click",ut,()=>je(e(u),e(X)[e(u).id])),v(_t,gt)},Ft=_t=>{var gt=yi();L("click",gt,()=>je(e(u),"self")),v(_t,gt)};x(mt,_t=>{R(e(te)),n(()=>Se(e(te).name))?_t(bt):_t(Ft,!1)})}v(ht,dt)},$t=ht=>{var dt=ot(),mt=He(dt);{var bt=_t=>{var gt=ki(),sa=i(gt);{var Qt=yt=>{var Dt=Ut("Roll Healing");v(yt,Dt)},Vt=yt=>{var Dt=Ut("Roll Damage");v(yt,Dt)};x(sa,yt=>{R(e(te)),n(()=>P(e(te)))?yt(Qt):yt(Vt,!1)})}l(gt),M(yt=>xt(gt,1,`btn ${yt??""}`),[()=>(R(e(te)),n(()=>P(e(te))?"btn-success":"btn-secondary"))]),L("click",gt,()=>Te(e(u))),v(_t,gt)},Ft=_t=>{var gt=Si();L("click",gt,()=>je(e(u),"self")),v(_t,gt)};x(mt,_t=>{e(u),n(()=>e(u).damage&&e(u).damage.trim()!=="")?_t(bt):_t(Ft,!1)})}v(ht,dt)};x(Ee,ht=>{R(cs),R(e(te)),n(()=>cs(e(te)))?ht(rt):ht($t,!1)},!0)}v(Pe,nt)};x(Le,Pe=>{R(Oa),R(e(te)),n(()=>Oa(e(te)))?Pe(ve):Pe(lt,!1)})}v(G,g)};x(st,G=>{e(te)&&G(m)})}v(me,Qe)},et=me=>{var te=ot(),Qe=He(te);{var st=m=>{var G=$i(),g=He(G),Le=s(g,2);{var ve=lt=>{var Pe=xi();L("click",Pe,()=>Te(e(u))),v(lt,Pe)};x(Le,lt=>{e(u),n(()=>e(u).damage&&e(u).damage.trim()!=="")&&lt(ve)})}L("click",g,()=>_e(e(u))),v(m,G)};x(Qe,m=>{e(u),n(()=>!e(u).spellRef)&&m(st)},!0)}v(me,te)};x(Oe,me=>{e(u),e(B),n(()=>e(u).spellRef&&e(B))?me(Ye):me(et,!1)})}l(fe),l(we),M(()=>{Ke(N,"for",`attack-type-${e(u),n(()=>e(u).id)??""}`),Ke(Z,"id",`attack-type-${e(u),n(()=>e(u).id)??""}`)}),Je(Z,()=>e(u).damageType,me=>(e(u).damageType=me,Lt(()=>(e(S),t(),d())))),v(q,we)});var le=s(j,2);{var re=q=>{var u=wi();v(q,u)},z=q=>{var u=ot(),Re=He(u);{var we=ce=>{var be=Di();v(ce,be)};x(Re,ce=>{e(S),n(()=>e(S).length===0)&&ce(we)},!0)}v(q,u)};x(le,q=>{t(),n(()=>t().attacks.length===0)?q(re):q(z,!1)})}l(T);var pe=s(T,2),O=s(i(pe),4),he=s(O,2);{var Ce=q=>{var u=Ai();St(u,5,()=>(t(),n(()=>t().activeStates)),wt,(Re,we,ce)=>{var be=ji(),De=i(be),Ge=i(De);Be(Ge);var We=s(Ge,2);{var ze=et=>{var me=Li();L("click",me,()=>Ie(ce)),v(et,me)};x(We,et=>{b()&&et(ze)})}l(De);var oe=s(De,2),ge=i(oe),Y=i(ge);Ke(Y,"for",`state-attack-bonus-${ce}`);var Fe=s(Y,2);Be(Fe),Ke(Fe,"id",`state-attack-bonus-${ce}`),l(ge);var ue=s(ge,2),y=i(ue);Ke(y,"for",`state-damage-bonus-${ce}`);var N=s(y,2);Be(N),Ke(N,"id",`state-damage-bonus-${ce}`),l(ue);var Z=s(ue,2),Q=i(Z);Ke(Q,"for",`state-target-${ce}`);var ke=s(Q,2);M(()=>{e(we),Lt(()=>{})}),Ke(ke,"id",`state-target-${ce}`);var ie=i(ke);ie.value=ie.__value="self";var Ue=s(ie);Ue.value=Ue.__value="other",l(ke),l(Z),l(oe);var fe=s(oe,2),Oe=i(fe);Ke(Oe,"for",`state-desc-${ce}`);var Ye=s(Oe,2);Be(Ye),Ke(Ye,"id",`state-desc-${ce}`),l(fe),l(be),Je(Ge,()=>e(we).name,et=>(e(we).name=et,Lt(()=>t()),ya(C,"$character"))),Je(Fe,()=>e(we).attackBonus,et=>(e(we).attackBonus=et,Lt(()=>t()),ya(C,"$character"))),Je(N,()=>e(we).damageBonus,et=>(e(we).damageBonus=et,Lt(()=>t()),ya(C,"$character"))),Ta(ke,()=>e(we).target,et=>(e(we).target=et,Lt(()=>t()),ya(C,"$character"))),Je(Ye,()=>e(we).description,et=>(e(we).description=et,Lt(()=>t()),ya(C,"$character"))),v(Re,be)}),l(u),v(q,u)},I=q=>{var u=Bi();v(q,u)};x(he,q=>{t(),n(()=>t().activeStates&&t().activeStates.length>0)?q(Ce):q(I,!1)})}l(pe),L("click",O,J),v(k,U)};x(ct,k=>{f(),n(()=>!f().attacks)&&k(it)})}l(Ae);var at=s(Ae,2);Nl(at,{get show(){return e(de)},get attacks(){return t(),n(()=>t().attacks)},onSave:se,onCancel:qe}),M(()=>tt=xt(Ae,1,"attacks svelte-14o91c5",null,tt,{hidden:!e(K)})),v(a,xe),Et(),$()}var Ti=p('<span class="slot-checkbox-x svelte-serp1j">&#8212;</span>'),Ii=p('<label><input type="checkbox" class="slot-checkbox-input svelte-serp1j"/> <span><!></span></label>');function vs(a,r){Pt(r,!1);const t=()=>Ze(va,"$isEditMode",c),[c,d]=Yt();let f=pt(r,"checked",8,!1),b=pt(r,"disabled",8,!1),C=pt(r,"className",8,""),$=pt(r,"index",8,void 0),S=pt(r,"ariaLabel",8,void 0);const K=ma();function E(P){K("change",{checked:P.currentTarget.checked,index:$()})}It();var ae=Ii(),V=i(ae);Be(V);var X=s(V,2),de=i(X);{var W=P=>{var Se=Ti();v(P,Se)};x(de,P=>{f()&&P(W)})}l(X),l(ae),M(()=>{xt(ae,1,"slot-checkbox-label "+C()+(t()?"":" not-editable"),"svelte-serp1j"),gs(V,f()),V.disabled=b()||!t(),Ke(V,"aria-label",S()),Ke(V,"tabindex",t()?0:-1),xt(X,1,`slot-checkbox-custom ${f()?"used":""} ${t()?"":"readonly"}`,"svelte-serp1j")}),L("change",V,E),v(a,ae),Et(),d()}var Pi=p('<p class="no-features svelte-1kpvv0n">Select a class to see available features</p>'),Ei=p('<p class="no-features svelte-1kpvv0n">No class features available at this level</p>'),Hi=p('<div class="spell-slots svelte-1kpvv0n"><label class="svelte-1kpvv0n"> </label> <div class="slots-tracker svelte-1kpvv0n"></div></div>'),Ni=p('<div class="all-spell-slots"></div>'),Ui=p('<div class="feature-box spellcasting svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"> </h3> <div class="spell-stats svelte-1kpvv0n"><div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Spell Save DC</label> <div class="spell-value svelte-1kpvv0n"> </div></div> <div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <div class="spell-value svelte-1kpvv0n"> </div></div></div> <!> <div class="prepared-spells svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <textarea placeholder="List your prepared spells..." class="svelte-1kpvv0n"></textarea></div></div>'),Oi=p('<p class="unlimited svelte-1kpvv0n">Unlimited Uses</p>'),Gi=p('<div class="slots-tracker svelte-1kpvv0n"></div> <div class="uses-actions-row"><button class="btn btn-primary use-enabled"> </button></div> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div>',1),qi=p('<div class="uses-tracker svelte-1kpvv0n"><!></div>'),Wi=p('<div class="pool-tracker svelte-1kpvv0n"><input type="number" min="0" class="pool-input svelte-1kpvv0n"/> <span> </span> <button class="btn-small svelte-1kpvv0n"> </button></div>'),zi=p('<p class="no-uses svelte-1kpvv0n">No Channel Divinity uses remaining</p>'),Ki=p('<div class="channel-divinity-option svelte-1kpvv0n"><button class="btn btn-primary use-enabled svelte-1kpvv0n">Use Channel Divinity</button> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div> <!></div>'),Vi=p('<div class="feature-box svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"><!> </h3> <p class="feature-description svelte-1kpvv0n"> </p> <!></div>'),Ji=p('<div class="features-grid svelte-1kpvv0n"><!> <!></div>'),Yi=p("<section><!> <!></section>");function Qi(a,r){Pt(r,!1);const t=()=>Ze(ee,"$character",b),c=()=>Ze(Da,"$abilityModifiers",b),d=()=>Ze(da,"$searchFilter",b),f=()=>Ze(Ot,"$collapsedStates",b),[b,C]=Yt(),$=D(),S=D(),K=D(),E=D(),ae=D(),V=D(),X=D();let de=D(0),W=D(0);function P(h,F){ee.update(J=>(J.classFeatures.features[h]=F,J))}function Se(){ee.update(h=>(h.classFeatures.spellSlotsByLevel||(h.classFeatures.spellSlotsByLevel={}),e(E).forEach(({level:F,slots:J})=>{h.classFeatures.spellSlotsByLevel[F]||(h.classFeatures.spellSlotsByLevel[F]=Array(J).fill(!1))}),h))}function Ne(h){if(typeof h.maxUses=="function"){if((h.name==="Divine Sense"||h.name==="War Priest")&&e($)?.spellcastingAbility){const F=c()[e($).spellcastingAbility];return h.maxUses(t().level,F)}return h.maxUses(t().level)}return h.maxUses||0}function ne(h,F){ee.update(J=>((!J.classFeatures.features[h]||!Array.isArray(J.classFeatures.features[h])||J.classFeatures.features[h].length!==F)&&(J.classFeatures.features[h]=Array(F).fill(!1)),J))}Cs(()=>{e(V)&&t()&&t().classFeatures&&t().classFeatures.features&&e(V).forEach(h=>{if(h.type==="uses"){const F=h.name.replace(/\s+/g,""),J=Ne(h),Ie=t().classFeatures.features[F];(!Array.isArray(Ie)||Ie.length!==J)&&ne(F,J)}})});function Me(h){return typeof h.maxPool=="function"?h.maxPool(t().level):h.maxPool||0}function qe(h){return typeof h.description=="function"?h.description(t().level):h.description}function se(){const h="ChannelDivinity";ee.update(F=>{const J=F.classFeatures.features[h];return typeof J=="number"&&J>0&&(F.classFeatures.features[h]=J-1),F})}function _e(){Ot.update(h=>({...h,classFeatures:!h.classFeatures}))}Ve(()=>(t(),zt),()=>{o($,t().class?zt(t().class):null)}),Ve(()=>(t(),ha),()=>{o(S,t().class?ha(t().class,t().level,t().subclass):[])}),Ve(()=>(t(),is),()=>{o(K,t().class?is(t().class,t().level):0)}),Ve(()=>(e($),t()),()=>{o(E,(()=>{if(!e($)?.spellcaster)return[];const h=t().level,F=[];return h>=1&&F.push({level:1,slots:Math.min(4,2+Math.floor(h/3))}),h>=3&&F.push({level:2,slots:Math.min(3,2+Math.floor((h-3)/4))}),h>=5&&F.push({level:3,slots:Math.min(3,2+Math.floor((h-5)/5))}),h>=7&&F.push({level:4,slots:Math.min(3,1+Math.floor((h-7)/6))}),h>=9&&F.push({level:5,slots:Math.min(2,1+Math.floor((h-9)/8))}),h>=11&&F.push({level:6,slots:1}),h>=13&&F.push({level:7,slots:1}),h>=15&&F.push({level:8,slots:1}),h>=17&&F.push({level:9,slots:1}),F})())}),Ve(()=>(e($),c(),t(),ns),()=>{if(e($)?.spellcaster&&e($).spellcastingAbility){const h=c()[e($).spellcastingAbility];o(de,ll(t().class,h,t().proficiencyBonus)||0),o(W,ns(t().class,t().level,h))}}),Ve(()=>(t(),e($),e(E)),()=>{t().class&&e($)?.spellcaster&&e(E).length>0&&Se()}),Ve(()=>t(),()=>{o(ae,(()=>{const F=t().classFeatures.features["ChannelDivinity"];return typeof F=="number"?F:0})())}),Ve(()=>(e(S),d()),()=>{o(V,e(S).filter(h=>{if(!d())return!0;const F=d().toLowerCase();return h.name.toLowerCase().includes(F)||qe(h).toLowerCase().includes(F)}))}),Ve(()=>(d(),t(),e(V)),()=>{o(X,!d()||t().class||"class features".includes(d().toLowerCase())||"spellcasting".includes(d().toLowerCase())||e(V).length>0)}),aa(),It();var Te=Yi();let w;var B=i(Te);{let h=vt(()=>(f(),n(()=>f().classFeatures?"Expand":"Collapse")));ba(B,{title:"Class Features",get collapsed(){return f(),n(()=>f().classFeatures)},get ariaLabel(){return e(h)},onToggle:_e})}var _=s(B,2);{var H=h=>{var F=ot(),J=He(F);{var Ie=xe=>{var Ae=Pi();v(xe,Ae)},je=xe=>{var Ae=ot(),tt=He(Ae);{var Xe=it=>{var at=Ei();v(it,at)},ct=it=>{var at=Ji(),k=i(at);{var U=$e=>{var T=Ui(),j=i(T),le=i(j);l(j);var re=s(j,2),z=i(re),pe=s(i(z),2),O=i(pe,!0);l(pe),l(z);var he=s(z,2),Ce=s(i(he),2),I=i(Ce,!0);l(Ce),l(he),l(re);var q=s(re,2);{var u=ce=>{var be=Ni();St(be,5,()=>e(E),wt,(De,Ge)=>{let We=()=>e(Ge).level,ze=()=>e(Ge).slots;const oe=vt(()=>(t(),We(),ze(),n(()=>t().classFeatures.spellSlotsByLevel?.[We()]||Array(ze()).fill(!1))));var ge=Hi(),Y=i(ge),Fe=i(Y);l(Y);var ue=s(Y,2);St(ue,5,()=>e(oe),wt,(y,N,Z)=>{{let Q=vt(()=>(R(e(oe)),n(()=>e(oe)[Z]||!1)));vs(y,{get checked(){return e(Q)},$$events:{change:ke=>{ee.update(ie=>(ie.classFeatures.spellSlotsByLevel||(ie.classFeatures.spellSlotsByLevel={}),ie.classFeatures.spellSlotsByLevel[We()]||(ie.classFeatures.spellSlotsByLevel[We()]=Array(ze()).fill(!1)),ie.classFeatures.spellSlotsByLevel[We()][Z]=ke.detail.checked,ie))}}})}}),l(ue),l(ge),M(()=>A(Fe,`${We()===1?"1st":We()===2?"2nd":We()===3?"3rd":`${We()}th`} Level Spell Slots`)),v(De,ge)}),l(be),v(ce,be)};x(q,ce=>{e(E),n(()=>e(E).length>0)&&ce(u)})}var Re=s(q,2),we=s(i(Re),2);Sa(we),l(Re),l(T),M(ce=>{A(le,`Spellcasting (${ce??""})`),A(O,e(de)),A(I,e(W))},[()=>(e($),n(()=>e($).spellcastingAbility?.toUpperCase()))]),Je(we,()=>t().classFeatures.preparedSpells,ce=>kt(ee,n(t).classFeatures.preparedSpells=ce,n(t))),v($e,T)};x(k,$e=>{e($),n(()=>e($)?.spellcaster)&&$e(U)})}var ye=s(k,2);St(ye,1,()=>e(V),wt,($e,T)=>{const j=vt(()=>(e(T),n(()=>e(T).name.replace(/\s+/g,"")))),le=vt(()=>(t(),R(e(j)),n(()=>t().classFeatures.features[e(j)]))),re=vt(()=>typeof e(le)=="number");var z=Vi(),pe=i(z),O=i(pe);{var he=ce=>{var be=Ut("Channel Divinity:");v(ce,be)};x(O,ce=>{e(T),n(()=>e(T).type==="channelDivinity")&&ce(he)})}var Ce=s(O);l(pe);var I=s(pe,2),q=i(I,!0);l(I);var u=s(I,2);{var Re=ce=>{const be=vt(()=>(e(T),n(()=>Ne(e(T))))),De=vt(()=>(R(e(le)),R(e(be)),n(()=>Array.isArray(e(le))?e(le):Array(e(be)).fill(!1))));var Ge=qi(),We=i(Ge);{var ze=ge=>{var Y=Oi();v(ge,Y)},oe=ge=>{var Y=Gi(),Fe=He(Y);St(Fe,5,()=>e(De),wt,(ie,Ue,fe)=>{vs(ie,{get checked(){return e(Ue)},index:fe,$$events:{change:Oe=>{ee.update(Ye=>(Ye.classFeatures.features[e(j)]||(Ye.classFeatures.features[e(j)]=Array(e(be)).fill(!1)),Ye.classFeatures.features[e(j)][fe]=Oe.detail.checked,Ye))}}})}),l(Fe);var ue=s(Fe,2),y=i(ue),N=i(y);l(y),l(ue);var Z=s(ue,2),Q=i(Z),ke=i(Q);l(Q),l(Z),M(ie=>{y.disabled=ie,A(N,`Use ${e(T),n(()=>e(T).name)??""}`),A(ke,`Resets on ${e(T),n(()=>e(T).resetOn==="short"?"Short Rest":"Long Rest")??""}`)},[()=>(R(e(De)),n(()=>e(De).filter(ie=>!ie).length<=0))]),L("click",y,()=>{ee.update(ie=>{ie.classFeatures.features[e(j)]||(ie.classFeatures.features[e(j)]=Array(e(be)).fill(!1));const Ue=ie.classFeatures.features[e(j)],fe=Ue.findIndex(Oe=>!Oe);return fe!==-1&&(Ue[fe]=!0),ie})}),v(ge,Y)};x(We,ge=>{e(be)===1/0?ge(ze):ge(oe,!1)})}l(Ge),v(ce,Ge)},we=ce=>{var be=ot(),De=He(be);{var Ge=ze=>{const oe=vt(()=>(e(T),n(()=>Me(e(T)))));var ge=Wi(),Y=i(ge);Be(Y);var Fe=s(Y,2),ue=i(Fe);l(Fe);var y=s(Fe,2),N=i(y,!0);l(y),l(ge),M(()=>{$a(Y,e(re)&&e(le)!==void 0?e(le):e(oe)),Ke(Y,"max",e(oe)),A(ue,`/ ${e(oe)??""}`),A(N,(e(T),n(()=>e(T).resetOn==="short"?"Short Rest":"Long Rest")))}),L("input",Y,Z=>{ee.update(Q=>(Q.classFeatures.features[e(j)]=parseInt(Z.currentTarget.value)||0,Q))}),L("click",y,()=>P(e(j),e(oe))),v(ze,ge)},We=ze=>{var oe=ot(),ge=He(oe);{var Y=Fe=>{var ue=Ki(),y=i(ue),N=s(y,2),Z=i(N),Q=i(Z);l(Z),l(N);var ke=s(N,2);{var ie=Ue=>{var fe=zi();v(Ue,fe)};x(ke,Ue=>{e(ae)<=0&&Ue(ie)})}l(ue),M(()=>{y.disabled=e(ae)<=0,A(Q,`Resets on ${e(T),n(()=>e(T).resetOn==="short"?"Short Rest":"Long Rest")??""}`)}),L("click",y,se),v(Fe,ue)};x(ge,Fe=>{e(T),n(()=>e(T).type==="channelDivinity")&&Fe(Y)},!0)}v(ze,oe)};x(De,ze=>{e(T),n(()=>e(T).type==="pool")?ze(Ge):ze(We,!1)},!0)}v(ce,be)};x(u,ce=>{e(T),n(()=>e(T).type==="uses")?ce(Re):ce(we,!1)})}l(z),M(ce=>{A(Ce,` ${e(T),n(()=>e(T).name)??""}`),A(q,ce)},[()=>(e(T),n(()=>qe(e(T))))]),v($e,z)}),l(at),v(it,at)};x(tt,it=>{e(S),n(()=>e(S).length===0)?it(Xe):it(ct,!1)},!0)}v(xe,Ae)};x(J,xe=>{t(),n(()=>!t().class)?xe(Ie):xe(je,!1)})}v(h,F)};x(_,h=>{f(),n(()=>!f().classFeatures)&&h(H)})}l(Te),M(()=>w=xt(Te,1,"class-features svelte-1kpvv0n",null,w,{hidden:!e(X)})),v(a,Te),Et(),C()}var Xi=p('<textarea placeholder="Enter features, traits, and special abilities..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Equipment</h3> <textarea placeholder="List your equipment and inventory..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Notes</h3> <textarea placeholder="Additional notes..." class="svelte-wttn0l"></textarea>',1),Zi=p("<section><!> <!></section>");function en(a,r){Pt(r,!1);const t=()=>Ze(da,"$searchFilter",f),c=()=>Ze(ee,"$character",f),d=()=>Ze(Ot,"$collapsedStates",f),[f,b]=Yt(),C=D();function $(){Ot.update(X=>({...X,notes:!X.notes}))}Ve(()=>(t(),c()),()=>{o(C,!t()||"features".includes(t().toLowerCase())||"traits".includes(t().toLowerCase())||"equipment".includes(t().toLowerCase())||"notes".includes(t().toLowerCase())||c().features.toLowerCase().includes(t().toLowerCase())||c().equipment.toLowerCase().includes(t().toLowerCase())||c().notes.toLowerCase().includes(t().toLowerCase()))}),aa(),It();var S=Zi();let K;var E=i(S);{let X=vt(()=>(d(),n(()=>d().notes?"Expand":"Collapse")));ba(E,{title:"Features & Traits",get collapsed(){return d(),n(()=>d().notes)},get ariaLabel(){return e(X)},onToggle:$})}var ae=s(E,2);{var V=X=>{var de=Xi(),W=He(de);Sa(W);var P=s(W,4);Sa(P);var Se=s(P,4);Sa(Se),Je(W,()=>c().features,Ne=>kt(ee,n(c).features=Ne,n(c))),Je(P,()=>c().equipment,Ne=>kt(ee,n(c).equipment=Ne,n(c))),Je(Se,()=>c().notes,Ne=>kt(ee,n(c).notes=Ne,n(c))),v(X,de)};x(ae,X=>{d(),n(()=>!d().notes)&&X(V)})}l(S),M(()=>K=xt(S,1,"notes svelte-wttn0l",null,K,{hidden:!e(C)})),v(a,S),Et(),b()}var tn=p('<div class="color-picker-section svelte-1r90jgp"><h3 class="svelte-1r90jgp">Dice Colors</h3> <div class="color-inputs svelte-1r90jgp"><div class="color-input-group svelte-1r90jgp"><label for="dice-color" class="svelte-1r90jgp">Dice Color</label> <input type="color" id="dice-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="label-color" class="svelte-1r90jgp">Label Color</label> <input type="color" id="label-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="desk-color" class="svelte-1r90jgp">Background Color</label> <input type="color" id="desk-color" class="svelte-1r90jgp"/></div></div></div>'),an=p('<div class="loading svelte-1r90jgp"><p class="svelte-1r90jgp">Loading 3D dice...</p></div>'),sn=p('<div class="custom-dice-selector svelte-1r90jgp"><h3 class="svelte-1r90jgp">Choose Dice to Roll</h3> <div class="dice-inputs svelte-1r90jgp"><div class="dice-input-group svelte-1r90jgp"><label for="d4" class="svelte-1r90jgp">d4</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d4" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d6" class="svelte-1r90jgp">d6</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d6" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d8" class="svelte-1r90jgp">d8</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d8" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d10" class="svelte-1r90jgp">d10</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d10" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d12" class="svelte-1r90jgp">d12</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d12" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d20" class="svelte-1r90jgp">d20</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d20" min="0" max="10"/></div></div> <div class="dice-controls svelte-1r90jgp"><button class="btn btn-primary use-enabled svelte-1r90jgp"> </button> <button class="btn btn-secondary use-enabled svelte-1r90jgp">Reset</button></div></div>'),ln=p('<span class="crit-badge svelte-1r90jgp">CRITICAL HIT!</span>'),nn=p('<span class="crit-badge crit-fail svelte-1r90jgp">CRITICAL MISS!</span>'),rn=p('<div class="bonus-item svelte-1r90jgp"><span class="bonus-value svelte-1r90jgp"> </span> <span class="bonus-source svelte-1r90jgp"> </span></div>'),on=p('<div class="bonus-breakdown svelte-1r90jgp"></div>'),cn=p('<p class="modifier-text svelte-1r90jgp"> </p>'),vn=p('<div class="svelte-1r90jgp"><em class="svelte-1r90jgp">No damage is dealt on a critical miss.</em></div>'),dn=p('<button class="btn btn-follow-up svelte-1r90jgp"> </button>'),un=p('<button class="btn btn-guided-strike svelte-1r90jgp">‚ö° Use Guided Strike (+10)</button>'),fn=p('<div class="follow-up-actions svelte-1r90jgp"><!> <!></div>'),pn=p('<div class="result-header svelte-1r90jgp"><h3 class="svelte-1r90jgp"> </h3> <!> <!></div> <div class="result-total svelte-1r90jgp"> </div> <div class="result-details svelte-1r90jgp"><!></div> <!> <!>',1),mn=p('<div role="button" tabindex="-1"><div class="modal-content svelte-1r90jgp" role="dialog" tabindex="0"><div class="modal-header svelte-1r90jgp"><h2 class="svelte-1r90jgp">Dice Roller</h2> <div class="header-buttons svelte-1r90jgp"><button class="color-btn svelte-1r90jgp" title="Customize dice colors">üé®</button> <button class="close-btn svelte-1r90jgp">√ó</button></div></div> <!> <!> <div class="dice-main-area svelte-1r90jgp"><div class="dice-container svelte-1r90jgp"></div> <!></div> <div><!></div></div></div>');function bn(a,r){Pt(r,!1);const t=()=>Ze(ee,"$character",c),[c,d]=Yt(),f=D(),b=D(),C=D(),$=ma();let S=pt(r,"notation",12,""),K=pt(r,"visible",8,!1),E=pt(r,"damageNotation",12,""),ae=pt(r,"attackName",12,""),V=pt(r,"applyHalfDamage",8,!1),X=pt(r,"bonusBreakdown",28,()=>[]),de=pt(r,"rollType",12,"other"),W=null,P=D(void 0),Se=D(!1),Ne=D(""),ne=D(null);function Me(){return e(ne)?.resultTotal??null}function qe(y,N,Z){const Q=[];if(!y||!y.result)return Q;const ke=N.match(/([+-]?\d*d\d+|[+-]?\d+)/g)||[];let ie=0;const Ue=new Set;for(const fe of ke){const Oe=fe.trim();if(!Oe)continue;const Ye=Oe.match(/([+-]?)(\d*)d(\d+)/);if(Ye){const et=parseInt(Ye[2]||"1"),me=`${et}d${Ye[3]}`,te=Z.findIndex((m,G)=>!Ue.has(G)&&typeof m.value=="string"&&m.value===me),Qe=[];for(let m=0;m<et&&ie<y.result.length;m++)Qe.push(y.result[ie++]);const st=te>=0?Z[te].source:"base die";te>=0&&Ue.add(te);for(const m of Qe)Q.push({display:`${m}`,source:st})}}for(let fe=0;fe<Z.length;fe++)if(!Ue.has(fe)&&typeof Z[fe].value=="number"){const Oe=Z[fe].value;Q.push({display:Oe>=0?`+${Oe}`:`${Oe}`,source:Z[fe].source})}return Q}let se=D(0),_e=D(0),Te=D(0),w=D(0),B=D(0),_=D(0),H=D(0),h=D([]),F=D(!1),J=D(!1),Ie=D(!1),je=D("#051e0a"),xe=D("#ffffff"),Ae=D("#3a2004"),tt=D(!1);function Xe(y){return y.length===9&&y.startsWith("#")?y.substring(0,7):y}function ct(y,N="ff"){return y.length===7&&y.startsWith("#")?y+N:y}function it(){if(window.DICE&&e(P))try{W&&e(P)&&ia(P,e(P).innerHTML="");const y=e(P).clientWidth||500,N=e(P).clientHeight||300;W=new window.DICE.dice_box(e(P),{w:y,h:N}),o(Se,!0)}catch(y){console.error("Error initializing dice box:",y)}}_a(()=>{const y=Q=>new Promise((ke,ie)=>{if(document.querySelector(`script[src="${Q}"]`)){ke(null);return}const fe=document.createElement("script");fe.src=Q,fe.onload=()=>{ke(null)},fe.onerror=()=>{console.error(`Failed to load: ${Q}`),ie(new Error(`Failed to load ${Q}`))},document.head.appendChild(fe)});setTimeout(()=>{y(`${ka}/libs/three.min.js`).then(()=>y(`${ka}/libs/cannon.min.js`)).then(()=>y(`${ka}/libs/teal.js`)).then(()=>y(`${ka}/dice.js`)).then(()=>{if(window.DICE){const Q=window.DICE.getColors();o(je,Xe(Q.dice_color)),o(xe,Xe(Q.label_color)),o(Ae,Xe(Q.desk_color))}it()}).catch(Q=>{console.error("Failed to load dice libraries:",Q)})},100);const N=()=>{e(Se)&&it()},Z=Q=>{K()&&Q.key==="Escape"&&re()};return window.addEventListener("resize",N),window.addEventListener("keydown",Z),()=>{window.removeEventListener("resize",N),window.removeEventListener("keydown",Z)}});function at(y,N="other"){if(!W||!e(Se))return;o(ne,null),o(h,[]),o(F,!1),o(J,!1),N==="damage"&&X([]),de(N),o(Ie,!1),W.diceToRoll=y;const Z=ke=>null,Q=ke=>{let ie=ke.resultTotal,Ue=ke.resultString;if(V()&&(ie=Math.floor(ie/2),Ue=Ue+" (halved)"),o(ne,{...ke,resultTotal:ie,resultString:Ue}),console.log("Final roll result:",e(ne)),console.log({type:N}),N==="attack"&&ke.result&&ke.result.length>0){const fe=ke.result[0];o(F,fe===20),o(J,fe===1)}if(o(h,[]),console.log("Setting up follow-up actions. Type:",N,"damageNotation:",E(),"isCriticalSuccess:",e(F),"isCriticalFail:",e(J)),N==="attack"&&E())if(e(F)){const fe=ye(E());e(h).push({label:`Roll Critical Damage (${fe})`,notation:fe})}else e(J)||e(h).push({label:`Roll Damage (${E()})`,notation:E()})};W.start_throw(Z,Q)}function k(){const y=[];e(se)>0&&y.push(`${e(se)}d4`),e(_e)>0&&y.push(`${e(_e)}d6`),e(Te)>0&&y.push(`${e(Te)}d8`),e(w)>0&&y.push(`${e(w)}d10`),e(B)>0&&y.push(`${e(B)}d12`),e(_)>0&&y.push(`${e(_)}d20`);let N=y.join("+")||"1d20";return e(H)!==0&&(N+=e(H)>=0?`+${e(H)}`:`${e(H)}`),N}function U(){const y=k();at(y)}function ye(y){return y.replace(/(\d+)d(\d+)/g,(N,Z,Q)=>`${parseInt(Z)*2}d${Q}`)}function $e(){o(se,0),o(_e,0),o(Te,0),o(w,0),o(B,0),o(_,0),o(H,0),o(ne,null),o(h,[]),o(F,!1),o(J,!1),de("other"),o(Ie,!1)}function T(){window.DICE&&(window.DICE.setColors({dice_color:ct(e(je),"ff"),label_color:ct(e(xe),"ff"),desk_color:e(Ae)}),W&&(W.updateDeskColor(e(Ae)),W.updateDiceColors()))}function j(){o(tt,!e(tt))}function le(){!e(ne)||e(b)<=0||e(Ie)||(o(ne,{...e(ne),resultTotal:e(ne).resultTotal+10,resultString:e(ne).resultString+" + 10 (Guided Strike)"}),ee.update(y=>{const N="ChannelDivinity",Z=y.classFeatures.features[N];return typeof Z=="number"&&Z>0&&(y.classFeatures.features[N]=Z-1),y}),o(Ie,!0))}function re(){$("close"),S(""),E(""),ae(""),o(Ne,""),o(ne,null),o(Ie,!1),o(F,!1),o(J,!1),$e()}Ve(()=>(t(),ha),()=>{o(f,t().class?ha(t().class,t().level,t().subclass).some(N=>N.name==="Guided Strike"):!1)}),Ve(()=>t(),()=>{o(b,(()=>{const N=t().classFeatures.features["ChannelDivinity"];return typeof N=="number"?N:0})())}),Ve(()=>(e(se),e(_e),e(Te),e(w),e(B),e(_),e(H)),()=>{o(C,(()=>{const y=[];e(se)>0&&y.push(`${e(se)}d4`),e(_e)>0&&y.push(`${e(_e)}d6`),e(Te)>0&&y.push(`${e(Te)}d8`),e(w)>0&&y.push(`${e(w)}d10`),e(B)>0&&y.push(`${e(B)}d12`),e(_)>0&&y.push(`${e(_)}d20`);let N=y.join("+")||"1d20";return e(H)!==0&&(N+=e(H)>=0?`+${e(H)}`:`${e(H)}`),N})())}),Ve(()=>(R(S()),e(Se),R(K()),e(Ne),R(E()),R(ae()),R(de())),()=>{S()&&e(Se)&&K()&&S()!==e(Ne)&&(o(Ne,S()),o(ne,null),o(h,[]),o(F,!1),o(J,!1),o(Ie,!1),console.log("Auto-roll triggered. notation:",S(),"damageNotation:",E(),"attackName:",ae(),"rollType:",de()),setTimeout(()=>at(S(),de()),200))}),aa();var z={getLastRollTotal:Me};It();var pe=mn();let O;var he=i(pe),Ce=i(he),I=s(i(Ce),2),q=i(I),u=s(q,2);l(I),l(Ce);var Re=s(Ce,2);{var we=y=>{var N=tn(),Z=s(i(N),2),Q=i(Z),ke=s(i(Q),2);Be(ke),l(Q);var ie=s(Q,2),Ue=s(i(ie),2);Be(Ue),l(ie);var fe=s(ie,2),Oe=s(i(fe),2);Be(Oe),l(fe),l(Z),l(N),Je(ke,()=>e(je),Ye=>o(je,Ye)),L("change",ke,T),Je(Ue,()=>e(xe),Ye=>o(xe,Ye)),L("change",Ue,T),Je(Oe,()=>e(Ae),Ye=>o(Ae,Ye)),L("change",Oe,T),v(y,N)};x(Re,y=>{e(tt)&&y(we)})}var ce=s(Re,2);{var be=y=>{var N=an();v(y,N)};x(ce,y=>{e(Se)||y(be)})}var De=s(ce,2),Ge=i(De);wa(Ge,y=>o(P,y),()=>e(P));var We=s(Ge,2);{var ze=y=>{var N=sn(),Z=s(i(N),2),Q=i(Z),ke=s(i(Q),2);Be(ke),l(Q);var ie=s(Q,2),Ue=s(i(ie),2);Be(Ue),l(ie);var fe=s(ie,2),Oe=s(i(fe),2);Be(Oe),l(fe);var Ye=s(fe,2),et=s(i(Ye),2);Be(et),l(Ye);var me=s(Ye,2),te=s(i(me),2);Be(te),l(me);var Qe=s(me,2),st=s(i(Qe),2);Be(st),l(Qe),l(Z);var m=s(Z,2),G=i(m),g=i(G);l(G);var Le=s(G,2);l(m),l(N),M(()=>{G.disabled=!e(Se),A(g,`Roll ${e(C)??""}`)}),Je(ke,()=>e(se),ve=>o(se,ve)),Je(Ue,()=>e(_e),ve=>o(_e,ve)),Je(Oe,()=>e(Te),ve=>o(Te,ve)),Je(et,()=>e(w),ve=>o(w,ve)),Je(te,()=>e(B),ve=>o(B,ve)),Je(st,()=>e(_),ve=>o(_,ve)),L("click",G,U),L("click",Le,$e),v(y,N)};x(We,y=>{S()||y(ze)})}l(De);var oe=s(De,2);let ge;var Y=i(oe);{var Fe=y=>{var N=pn(),Z=He(N),Q=i(Z),ke=i(Q,!0);l(Q);var ie=s(Q,2);{var Ue=Le=>{var ve=ln();v(Le,ve)};x(ie,Le=>{e(F)&&Le(Ue)})}var fe=s(ie,2);{var Oe=Le=>{var ve=nn();v(Le,ve)};x(fe,Le=>{e(J)&&Le(Oe)})}l(Z);var Ye=s(Z,2),et=i(Ye,!0);l(Ye);var me=s(Ye,2),te=i(me);{var Qe=Le=>{var ve=ot(),lt=He(ve);{var Pe=Ee=>{var rt=on();St(rt,5,()=>(e(ne),R(S()),R(X()),n(()=>qe(e(ne),S(),X()))),wt,($t,ht)=>{var dt=rn(),mt=i(dt),bt=i(mt,!0);l(mt);var Ft=s(mt,2),_t=i(Ft);l(Ft),l(dt),M(()=>{A(bt,(e(ht),n(()=>e(ht).display))),A(_t,`(${e(ht),n(()=>e(ht).source)??""})`)}),v($t,dt)}),l(rt),v(Ee,rt)},nt=Ee=>{var rt=ot(),$t=He(rt);{var ht=dt=>{var mt=cn(),bt=i(mt);l(mt),M(()=>A(bt,`Modifier: ${e(ne),n(()=>e(ne).constant>=0?"+":"")??""}${e(ne),n(()=>e(ne).constant)??""}`)),v(dt,mt)};x($t,dt=>{e(ne),n(()=>e(ne).constant)&&dt(ht)},!0)}v(Ee,rt)};x(lt,Ee=>{R(X()),n(()=>X().length>0)?Ee(Pe):Ee(nt,!1)})}v(Le,ve)};x(te,Le=>{e(ne),R(X()),n(()=>e(ne).constant||X().length>0)&&Le(Qe)})}l(me);var st=s(me,2);{var m=Le=>{var ve=vn();v(Le,ve)};x(st,Le=>{e(J)&&Le(m)})}var G=s(st,2);{var g=Le=>{var ve=fn(),lt=i(ve);St(lt,1,()=>e(h),wt,(Ee,rt)=>{var $t=dn(),ht=i($t,!0);l($t),M(()=>A(ht,(e(rt),n(()=>e(rt).label)))),L("click",$t,()=>at(e(rt).notation,"damage")),v(Ee,$t)});var Pe=s(lt,2);{var nt=Ee=>{var rt=un();M(()=>{rt.disabled=e(b)<=0,Ke(rt,"title",e(b)<=0?"No Channel Divinity uses remaining":"Use Channel Divinity to add +10 to this attack roll")}),L("click",rt,le),v(Ee,rt)};x(Pe,Ee=>{e(f)&&de()==="attack"&&!e(Ie)&&e(b)>0&&!e(J)&&Ee(nt)})}l(ve),v(Le,ve)};x(G,Le=>{e(h),e(f),R(de()),e(Ie),e(b),n(()=>e(h).length>0||e(f)&&de()==="attack"&&!e(Ie)&&e(b)>0)&&Le(g)})}M(()=>{A(ke,ae()?`${ae()} - Result`:"Result"),A(et,(e(ne),n(()=>e(ne).resultTotal)))}),v(y,N)};x(Y,y=>{e(ne)&&y(Fe)})}l(oe),l(he),l(pe),M(()=>{O=xt(pe,1,"modal-overlay svelte-1r90jgp",null,O,{hidden:!K()}),ge=xt(oe,1,"roll-result svelte-1r90jgp",null,ge,{"has-result":e(ne)})}),L("click",q,j),L("click",u,re),L("click",he,Xa(function(y){ga.call(this,r,y)})),L("keydown",he,function(y){ga.call(this,r,y)}),L("click",pe,re),L("keydown",pe,y=>y.key==="Escape"&&re()),v(a,pe),al(r,"getLastRollTotal",Me);var ue=Et(z);return d(),ue}const Pa="https://api.github.com/gists";async function gn(a,r,t){if(!r)throw new Error("GitHub token is required");const c=JSON.stringify(a,null,2),d=`${a.name||"character"}_dnd.json`,f={description:t||`D&D Character: ${a.name}`,public:!1,files:{[d]:{content:c}}},b=await fetch(Pa,{method:"POST",headers:{Authorization:`token ${r}`,"Content-Type":"application/json"},body:JSON.stringify(f)});if(!b.ok)throw new Error(`Failed to create gist: ${b.statusText}`);return(await b.json()).id}async function hn(a,r,t){if(!r||!t)throw new Error("GitHub token and Gist ID are required");const c=JSON.stringify(a,null,2),f={files:{[`${a.name||"character"}_dnd.json`]:{content:c}}},b=await fetch(`${Pa}/${t}`,{method:"PATCH",headers:{Authorization:`token ${r}`,"Content-Type":"application/json"},body:JSON.stringify(f)});if(!b.ok)throw new Error(`Failed to update gist: ${b.statusText}`)}async function _n(a,r){if(!a)throw new Error("Gist ID is required");const t={"Content-Type":"application/json"};r&&(t.Authorization=`token ${r}`);const c=await fetch(`${Pa}/${a}`,{method:"GET",headers:t});if(!c.ok)throw new Error(`Failed to load gist: ${c.statusText}`);const d=await c.json(),f=Object.values(d.files);if(f.length===0)throw new Error("No files found in gist");const C=f[0].content;try{const $=JSON.parse(C);return $.attacks&&Array.isArray($.attacks)&&($.attacks=$.attacks.map(S=>({...S,id:S.id||crypto.randomUUID()}))),$.classFeatures?($.classFeatures.features||($.classFeatures.features={}),$.classFeatures.spellSlots||($.classFeatures.spellSlots=[]),$.classFeatures.preparedSpells===void 0&&($.classFeatures.preparedSpells="")):$.classFeatures={features:{},spellSlots:[],preparedSpells:""},$}catch{throw new Error("Invalid character data in gist")}}function ds(a){typeof window<"u"&&localStorage.setItem("dnd_gist_config",JSON.stringify(a))}function yn(){if(typeof window<"u"){const a=localStorage.getItem("dnd_gist_config");if(a)return JSON.parse(a)}return{}}async function kn(a,r=30){if(!a)throw new Error("GitHub token is required to list gists");const t=await fetch(`${Pa}?per_page=${r}`,{method:"GET",headers:{Authorization:`token ${a}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error(`Failed to list gists: ${t.statusText}`);return await t.json()}var Sn=p('<div class="error-message svelte-1jb5ckg"> </div>'),xn=p('<div class="toggle-container svelte-1jb5ckg"><button type="button" class="toggle-btn svelte-1jb5ckg"> </button></div>'),$n=p('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID (leave empty to create new)</label> <input type="text" id="gistId" placeholder="Optional: existing Gist ID to update" class="svelte-1jb5ckg"/></div>'),Cn=p('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),wn=p('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),Dn=p('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Update (or leave unselected to create new)</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),Ln=p('<div class="info-message svelte-1jb5ckg">No gists found. A new one will be created.</div>'),jn=p('<!> <div class="form-group svelte-1jb5ckg"><label for="description" class="svelte-1jb5ckg"> </label> <input type="text" id="description" placeholder="D&amp;D Character Sheet" class="svelte-1jb5ckg"/></div>',1),An=p('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID *</label> <input type="text" id="gistId" placeholder="Enter Gist ID (for public or your private gists)" required class="svelte-1jb5ckg"/></div>'),Bn=p('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),Mn=p('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),Fn=p('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Load</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),Rn=p('<div class="info-message svelte-1jb5ckg">No gists found. Enter a Gist ID manually or create a new one in Save mode.</div>'),Tn=p('<div class="modal-overlay svelte-1jb5ckg" role="button" tabindex="-1"><div class="modal-content svelte-1jb5ckg" role="dialog" tabindex="0"><div class="modal-header svelte-1jb5ckg"><h2 class="svelte-1jb5ckg"> </h2> <button class="close-btn svelte-1jb5ckg">√ó</button></div> <div class="modal-body svelte-1jb5ckg"><!> <div class="form-group svelte-1jb5ckg"><label for="token" class="svelte-1jb5ckg"> <a href="https://github.com/settings/tokens" target="_blank" rel="noopener" class="svelte-1jb5ckg">Get token</a></label> <input type="password" id="token" placeholder="ghp_xxxxxxxxxxxxx" class="svelte-1jb5ckg"/></div> <!> <!> <div class="modal-actions svelte-1jb5ckg"><button class="btn btn-primary svelte-1jb5ckg"><!></button> <button class="btn btn-secondary svelte-1jb5ckg">Cancel</button></div></div></div></div>');function In(a,r){Pt(r,!1);const t=()=>Ze(ee,"$character",c),[c,d]=Yt(),f=ma();let b=pt(r,"mode",8,"save"),C=D(""),$=D(""),S=D(""),K=D(!1),E=D(""),ae=D(!1),V=D(!1),X=D([]),de=D(null);const W=yn();W.token&&o(C,W.token),W.gistId&&o($,W.gistId),_a(async()=>{e(C)&&!e(ae)&&await P()});async function P(){if(e(C)){o(V,!0),o(E,"");try{o(X,await kn(e(C))),e($)&&o(de,e(X).find(j=>j.id===e($))||null)}catch(j){o(E,j.message||"Failed to load gists"),o(X,[])}finally{o(V,!1)}}}function Se(j){o(de,j),o($,j.id)}function Ne(){o(ae,!e(ae)),o(E,""),!e(ae)&&e(C)&&P()}async function ne(){if(!e(C)){o(E,"GitHub token is required");return}const j=e(de)?.id||e($);o(K,!0),o(E,"");try{if(j)await hn(t(),e(C),j),o($,j),Wt.add("Character updated in Gist successfully!","success");else{const le=await gn(t(),e(C),e(S));o($,le),Wt.add(`Character saved to Gist! ID: ${le}`,"success")}ds({token:e(C),gistId:e($)}),f("close")}catch(le){o(E,le.message||"Failed to save to Gist")}finally{o(K,!1)}}async function Me(){const j=e(de)?.id||e($);if(!j){o(E,"Please select a gist or enter a Gist ID");return}o(K,!0),o(E,"");try{const le=await _n(j,e(C)||void 0);ee.set(le),o($,j),ds({token:e(C),gistId:e($)}),Wt.add("Character loaded from Gist successfully!","success"),f("close")}catch(le){o(E,le.message||"Failed to load from Gist")}finally{o(K,!1)}}function qe(){f("close")}It();var se=Tn(),_e=i(se),Te=i(_e),w=i(Te),B=i(w,!0);l(w);var _=s(w,2);l(Te);var H=s(Te,2),h=i(H);{var F=j=>{var le=Sn(),re=i(le,!0);l(le),M(()=>A(re,e(E))),v(j,le)};x(h,j=>{e(E)&&j(F)})}var J=s(h,2),Ie=i(J),je=i(Ie);pa(),l(Ie);var xe=s(Ie,2);Be(xe),l(J);var Ae=s(J,2);{var tt=j=>{var le=xn(),re=i(le),z=i(re,!0);l(re),l(le),M(()=>{re.disabled=e(K),A(z,e(ae)?"üìã Show My Gists":"‚úèÔ∏è Enter Gist ID Manually")}),L("click",re,Ne),v(j,le)};x(Ae,j=>{(b()==="load"||b()==="save"&&e(C))&&j(tt)})}var Xe=s(Ae,2);{var ct=j=>{var le=jn(),re=He(le);{var z=q=>{var u=$n(),Re=s(i(u),2);Be(Re),l(u),M(()=>Re.disabled=e(K)),Je(Re,()=>e($),we=>o($,we)),v(q,u)},pe=q=>{var u=ot(),Re=He(u);{var we=be=>{var De=Cn();v(be,De)},ce=be=>{var De=ot(),Ge=He(De);{var We=oe=>{var ge=Dn(),Y=s(i(ge),2);St(Y,5,()=>e(X),wt,(Fe,ue)=>{var y=wn();let N;var Z=i(y),Q=i(Z),ke=i(Q,!0);l(Q);var ie=s(Q,2),Ue=i(ie,!0);l(ie),l(Z);var fe=s(Z,2),Oe=i(fe),Ye=i(Oe);l(Oe);var et=s(Oe,2),me=i(et);l(et),l(fe),l(y),M(te=>{N=xt(y,1,"gist-item svelte-1jb5ckg",null,N,{selected:e(de)?.id===e(ue).id}),y.disabled=e(K),A(ke,(e(ue),n(()=>e(ue).description||"Untitled"))),A(Ue,(e(ue),n(()=>e(ue).public?"üåê Public":"üîí Private"))),A(Ye,`ID: ${e(ue),n(()=>e(ue).id)??""}`),A(me,`Updated: ${te??""}`)},[()=>(e(ue),n(()=>new Date(e(ue).updated_at).toLocaleDateString()))]),L("click",y,()=>Se(e(ue))),v(Fe,y)}),l(Y),l(ge),v(oe,ge)},ze=oe=>{var ge=ot(),Y=He(ge);{var Fe=ue=>{var y=Ln();v(ue,y)};x(Y,ue=>{e(C)&&ue(Fe)},!0)}v(oe,ge)};x(Ge,oe=>{e(X),n(()=>e(X).length>0)?oe(We):oe(ze,!1)},!0)}v(be,De)};x(Re,be=>{e(V)?be(we):be(ce,!1)},!0)}v(q,u)};x(re,q=>{e(ae)||!e(C)?q(z):q(pe,!1)})}var O=s(re,2),he=i(O),Ce=i(he);l(he);var I=s(he,2);Be(I),l(O),M(()=>{A(Ce,`Description ${e($)?"(optional)":""}`),I.disabled=e(K)}),Je(I,()=>e(S),q=>o(S,q)),v(j,le)},it=j=>{var le=ot(),re=He(le);{var z=O=>{var he=An(),Ce=s(i(he),2);Be(Ce),l(he),M(()=>Ce.disabled=e(K)),Je(Ce,()=>e($),I=>o($,I)),v(O,he)},pe=O=>{var he=ot(),Ce=He(he);{var I=u=>{var Re=Bn();v(u,Re)},q=u=>{var Re=ot(),we=He(Re);{var ce=De=>{var Ge=Fn(),We=s(i(Ge),2);St(We,5,()=>e(X),wt,(ze,oe)=>{var ge=Mn();let Y;var Fe=i(ge),ue=i(Fe),y=i(ue,!0);l(ue);var N=s(ue,2),Z=i(N,!0);l(N),l(Fe);var Q=s(Fe,2),ke=i(Q),ie=i(ke);l(ke);var Ue=s(ke,2),fe=i(Ue);l(Ue),l(Q),l(ge),M(Oe=>{Y=xt(ge,1,"gist-item svelte-1jb5ckg",null,Y,{selected:e(de)?.id===e(oe).id}),ge.disabled=e(K),A(y,(e(oe),n(()=>e(oe).description||"Untitled"))),A(Z,(e(oe),n(()=>e(oe).public?"üåê Public":"üîí Private"))),A(ie,`ID: ${e(oe),n(()=>e(oe).id)??""}`),A(fe,`Updated: ${Oe??""}`)},[()=>(e(oe),n(()=>new Date(e(oe).updated_at).toLocaleDateString()))]),L("click",ge,()=>Se(e(oe))),v(ze,ge)}),l(We),l(Ge),v(De,Ge)},be=De=>{var Ge=ot(),We=He(Ge);{var ze=oe=>{var ge=Rn();v(oe,ge)};x(We,oe=>{e(C)&&oe(ze)},!0)}v(De,Ge)};x(we,De=>{e(X),n(()=>e(X).length>0)?De(ce):De(be,!1)},!0)}v(u,Re)};x(Ce,u=>{e(V)?u(I):u(q,!1)},!0)}v(O,he)};x(re,O=>{e(ae)||!e(C)?O(z):O(pe,!1)},!0)}v(j,le)};x(Xe,j=>{b()==="save"?j(ct):j(it,!1)})}var at=s(Xe,2),k=i(at),U=i(k);{var ye=j=>{var le=Ut();M(()=>A(le,b()==="save"?"Saving...":"Loading...")),v(j,le)},$e=j=>{var le=Ut();M(()=>A(le,b()==="save"?"Save":"Load")),v(j,le)};x(U,j=>{e(K)?j(ye):j($e,!1)})}l(k);var T=s(k,2);l(at),l(H),l(_e),l(se),M(()=>{A(B,b()==="save"?"Save to GitHub Gist":"Load from GitHub Gist"),A(je,`GitHub Token ${b()==="load"?"(optional for public gists)":"(required)"} `),xe.disabled=e(K),k.disabled=e(K),T.disabled=e(K)}),L("click",_,qe),Je(xe,()=>e(C),j=>o(C,j)),L("blur",xe,()=>{e(C)&&!e(ae)&&P()}),L("click",k,function(...j){(b()==="save"?ne:Me)?.apply(this,j)}),L("click",T,qe),L("click",_e,Xa(function(j){ga.call(this,r,j)})),L("keydown",_e,function(j){ga.call(this,r,j)}),L("click",se,qe),L("keydown",se,j=>j.key==="Escape"&&qe()),v(a,se),Et(),d()}var Pn=p('<div class="loading svelte-1ngjemu">Loading D&D data...</div>'),En=p("<option> </option>"),Hn=p('<select class="level-filter svelte-1ngjemu"><option>All Levels</option><option>Cantrip</option><!></select>'),Nn=p('<div class="no-results svelte-1ngjemu"> </div>'),Un=p('<div class="item-meta svelte-1ngjemu"> </div>'),On=p('<div class="item-meta svelte-1ngjemu"> </div>'),Gn=p('<button><div class="item-name svelte-1ngjemu"> </div> <!></button>'),qn=p('<p class="higher-levels"><strong>At Higher Levels:</strong> </p>'),Wn=p('<p class="cantrip-upgrade"><strong>Cantrip Upgrade:</strong> </p>'),zn=p('<h3 class="svelte-1ngjemu"> </h3> <p class="spell-meta svelte-1ngjemu"><!> <!></p> <p class="spell-classes"><strong>Classes:</strong> </p> <div class="spell-stats svelte-1ngjemu"><div><strong>Casting Time:</strong> </div> <div><strong>Range:</strong> </div> <div><strong>Components:</strong> <!></div> <div><strong>Duration:</strong> <!> </div></div> <p class="description svelte-1ngjemu"> </p> <!> <!>',1),Kn=p('<p class="prerequisite svelte-1ngjemu"><strong>Prerequisite:</strong> </p>'),Vn=p('<h3 class="svelte-1ngjemu"> </h3> <!> <p class="description svelte-1ngjemu"> </p> <a target="_blank" rel="noopener" class="source-link svelte-1ngjemu">View Full Details ‚Üí</a>',1),Jn=p('<div class="item-details svelte-1ngjemu"><!></div>'),Yn=p('<div class="controls svelte-1ngjemu"><div class="tabs svelte-1ngjemu"><button> </button> <button> </button></div> <div class="search-controls svelte-1ngjemu"><input type="text" placeholder="Search by name or description..." class="search-input svelte-1ngjemu"/> <!></div></div> <div class="content-container svelte-1ngjemu"><div class="items-list svelte-1ngjemu"><!></div> <!></div>',1),Qn=p('<div class="modal-backdrop svelte-1ngjemu" role="presentation"><div class="modal svelte-1ngjemu" role="dialog" aria-modal="true" tabindex="-1"><div class="modal-header svelte-1ngjemu"><h2 class="svelte-1ngjemu">Browse D&D Spells & Feats</h2> <button class="close-btn svelte-1ngjemu" aria-label="Close">&times;</button></div> <div class="modal-body svelte-1ngjemu"><!></div> <div class="modal-footer svelte-1ngjemu"><button class="btn-secondary svelte-1ngjemu">Cancel</button> <button class="btn-primary svelte-1ngjemu">Add to Character Sheet</button></div></div></div>');function Xn(a,r){Pt(r,!1);const t=D(),c=D(),d=D();let f=pt(r,"onClose",8),b=D("spell"),C=D(!0),$=D(""),S=D(null),K=D([]),E=D([]),ae=D(null);_a(async()=>{o(C,!0);try{o(K,await ks()),o(E,await Ul())}catch(_){console.error("Failed to load data:",_)}finally{o(C,!1)}});function V(_){o(ae,_)}function X(_){const H=_.match(/(\d+d\d+(?:\s*\+\s*\d+)?)/i);return H?H[1]:""}function de(_){const H=_.split(/\.( |$)/)[0].trim(),h=Array.from(_.matchAll(/\*\*(.*?)\*\*/g)).map(J=>J[1].replace(/\.$/,""));let F=H;return h.length&&(F+=" | Effects: "+h.join(", ")),F}function W(){if(e(ae)){if(e(b)==="spell"){const _=e(ae);ee.update(H=>{const F=[];_.range&&F.push(`Range: ${_.range}`),_.castingTime&&F.push(`Cast: ${_.castingTime}`),_.duration&&F.push(`Duration: ${_.duration}`),_.actionType==="Save"&&F.push("Saving throw spell"),_.components&&_.components.length>0&&F.push(`Components: ${_.components.join(", ")}`),_.material&&F.push(`Material: ${_.material}`);const J=F.join(" | "),Ie=de(_.description),je={id:crypto.randomUUID(),name:`${_.name}${_.concentration?" (C)":""}${_.ritual?" (R)":""}`,bonus:_.actionType==="Attack"?5:0,damage:X(_.description),damageType:`${_.school} (Lvl ${_.level})`,spellRef:_.name,infoNotes:J,generalNotes:Ie,castAtLevel:_.level};return H.attacks=[...H.attacks,je],H})}else if(e(b)==="feat"){const _=e(ae);ee.update(H=>{const h=`${_.name}${_.prerequisite?` (Req: ${_.prerequisite})`:""}
${_.description}
`;return H.features=H.features?`${H.features}
${h}`:h,H})}o(ae,null),f()()}}Ve(()=>(e(S),e(K),e($)),()=>{o(t,e(S)!==null?Ol(os(e(K),e($)),e(S)):os(e(K),e($)))}),Ve(()=>(e(E),e($)),()=>{o(c,Gl(e(E),e($)))}),Ve(()=>(e(b),e(t),e(c)),()=>{o(d,e(b)==="spell"?e(t):e(c))}),aa(),It();var P=Qn(),Se=i(P),Ne=i(Se),ne=s(i(Ne),2);l(Ne);var Me=s(Ne,2),qe=i(Me);{var se=_=>{var H=Pn();v(_,H)},_e=_=>{var H=Yn(),h=He(H),F=i(h),J=i(F);let Ie;var je=i(J);l(J);var xe=s(J,2);let Ae;var tt=i(xe);l(xe),l(F);var Xe=s(F,2),ct=i(Xe);Be(ct);var it=s(ct,2);{var at=re=>{var z=Hn();M(()=>{e(S),Lt(()=>{})});var pe=i(z);pe.value=(pe.__value=null)??"";var O=s(pe);O.value=O.__value=0;var he=s(O);St(he,0,()=>[1,2,3,4,5,6,7,8,9],wt,(Ce,I)=>{var q=En(),u=i(q);l(q);var Re={};M(()=>{A(u,`Level ${I??""}`),Re!==(Re=I)&&(q.value=(q.__value=I)??"")}),v(Ce,q)}),l(z),Ta(z,()=>e(S),Ce=>o(S,Ce)),v(re,z)};x(it,re=>{e(b)==="spell"&&re(at)})}l(Xe),l(h);var k=s(h,2),U=i(k),ye=i(U);{var $e=re=>{var z=Nn(),pe=i(z);l(z),M(()=>A(pe,`No ${e(b)??""}s found`)),v(re,z)},T=re=>{var z=ot(),pe=He(z);St(pe,1,()=>e(d),wt,(O,he)=>{var Ce=Gn();let I;var q=i(Ce),u=i(q,!0);l(q);var Re=s(q,2);{var we=be=>{const De=vt(()=>e(he));var Ge=Un(),We=i(Ge);l(Ge),M(()=>A(We,`Level ${R(e(De)),n(()=>e(De).level)??""} ‚Ä¢ ${R(e(De)),n(()=>e(De).school)??""}`)),v(be,Ge)},ce=be=>{const De=vt(()=>e(he));var Ge=ot(),We=He(Ge);{var ze=oe=>{var ge=On(),Y=i(ge,!0);l(ge),M(()=>A(Y,(R(e(De)),n(()=>e(De).prerequisite)))),v(oe,ge)};x(We,oe=>{R(e(De)),n(()=>e(De).prerequisite)&&oe(ze)})}v(be,Ge)};x(Re,be=>{e(b)==="spell"?be(we):be(ce,!1)})}l(Ce),M(()=>{I=xt(Ce,1,"item-card svelte-1ngjemu",null,I,{selected:e(ae)?.name===e(he).name}),A(u,(e(he),n(()=>e(he).name)))}),L("click",Ce,()=>V(e(he))),v(O,Ce)}),v(re,z)};x(ye,re=>{e(d),n(()=>e(d).length===0)?re($e):re(T,!1)})}l(U);var j=s(U,2);{var le=re=>{var z=Jn(),pe=i(z);{var O=Ce=>{const I=vt(()=>e(ae));var q=zn(),u=He(q),Re=i(u,!0);l(u);var we=s(u,2),ce=i(we);{var be=m=>{var G=Ut();M(()=>A(G,`${R(e(I)),n(()=>e(I).school)??""} cantrip`)),v(m,G)},De=m=>{var G=Ut();M(()=>A(G,`Level ${R(e(I)),n(()=>e(I).level)??""} ${R(e(I)),n(()=>e(I).school)??""}`)),v(m,G)};x(ce,m=>{R(e(I)),n(()=>e(I).level===0)?m(be):m(De,!1)})}var Ge=s(ce,2);{var We=m=>{var G=Ut("(ritual)");v(m,G)};x(Ge,m=>{R(e(I)),n(()=>e(I).ritual)&&m(We)})}l(we);var ze=s(we,2),oe=s(i(ze));l(ze);var ge=s(ze,2),Y=i(ge),Fe=s(i(Y));l(Y);var ue=s(Y,2),y=s(i(ue));l(ue);var N=s(ue,2),Z=s(i(N)),Q=s(Z);{var ke=m=>{var G=Ut();M(()=>A(G,`(${R(e(I)),n(()=>e(I).material)??""})`)),v(m,G)};x(Q,m=>{R(e(I)),n(()=>e(I).material)&&m(ke)})}l(N);var ie=s(N,2),Ue=s(i(ie),2);{var fe=m=>{var G=Ut("Concentration,");v(m,G)};x(Ue,m=>{R(e(I)),n(()=>e(I).concentration)&&m(fe)})}var Oe=s(Ue,1,!0);l(ie),l(ge);var Ye=s(ge,2),et=i(Ye,!0);l(Ye);var me=s(Ye,2);{var te=m=>{var G=qn(),g=s(i(G));l(G),M(()=>A(g,` ${R(e(I)),n(()=>e(I).higherLevelSlot)??""}`)),v(m,G)};x(me,m=>{R(e(I)),n(()=>e(I).higherLevelSlot)&&m(te)})}var Qe=s(me,2);{var st=m=>{var G=Wn(),g=s(i(G));l(G),M(()=>A(g,` ${R(e(I)),n(()=>e(I).cantripUpgrade)??""}`)),v(m,G)};x(Qe,m=>{R(e(I)),n(()=>e(I).cantripUpgrade)&&m(st)})}M((m,G)=>{A(Re,(R(e(I)),n(()=>e(I).name))),A(oe,` ${m??""}`),A(Fe,` ${R(e(I)),n(()=>e(I).castingTime||e(I).actionType)??""}`),A(y,` ${R(e(I)),n(()=>e(I).range)??""}`),A(Z,` ${G??""}`),A(Oe,(R(e(I)),n(()=>e(I).duration))),A(et,(R(e(I)),n(()=>e(I).description)))},[()=>(R(e(I)),n(()=>e(I).classes.join(", "))),()=>(R(e(I)),n(()=>e(I).components.join(", ").toUpperCase()))]),v(Ce,q)},he=Ce=>{const I=vt(()=>e(ae));var q=Vn(),u=He(q),Re=i(u,!0);l(u);var we=s(u,2);{var ce=We=>{var ze=Kn(),oe=s(i(ze));l(ze),M(()=>A(oe,` ${R(e(I)),n(()=>e(I).prerequisite)??""}`)),v(We,ze)};x(we,We=>{R(e(I)),n(()=>e(I).prerequisite)&&We(ce)})}var be=s(we,2),De=i(be,!0);l(be);var Ge=s(be,2);M(()=>{A(Re,(R(e(I)),n(()=>e(I).name))),A(De,(R(e(I)),n(()=>e(I).description))),Ke(Ge,"href",(R(e(I)),n(()=>e(I).source)))}),v(Ce,q)};x(pe,Ce=>{e(b)==="spell"?Ce(O):Ce(he,!1)})}l(z),v(re,z)};x(j,re=>{e(ae)&&re(le)})}l(k),M(()=>{Ie=xt(J,1,"tab svelte-1ngjemu",null,Ie,{active:e(b)==="spell"}),A(je,`üìú Spells (${e(K),n(()=>e(K).length)??""})`),Ae=xt(xe,1,"tab svelte-1ngjemu",null,Ae,{active:e(b)==="feat"}),A(tt,`‚≠ê Feats (${e(E),n(()=>e(E).length)??""})`)}),L("click",J,()=>{o(b,"spell"),o(ae,null),o($,"")}),L("click",xe,()=>{o(b,"feat"),o(ae,null),o($,"")}),Je(ct,()=>e($),re=>o($,re)),v(_,H)};x(qe,_=>{e(C)?_(se):_(_e,!1)})}l(Me);var Te=s(Me,2),w=i(Te),B=s(w,2);l(Te),l(Se),l(P),M(()=>B.disabled=!e(ae)),L("click",ne,function(..._){f()?.apply(this,_)}),L("click",w,function(..._){f()?.apply(this,_)}),L("click",B,W),L("click",Se,Xa(function(_){ga.call(this,r,_)})),L("keydown",Se,function(_){ga.call(this,r,_)}),L("click",P,function(..._){f()?.apply(this,_)}),L("keydown",P,_=>_.key==="Escape"&&f()()),v(a,P),Et()}var Zn=p('<link rel="icon" type="image/png" href="favicon4.png"/> <meta name="viewport" content="width=device-width, initial-scale=1"/>',1),er=p('<span class="character-name svelte-1uha8ag"> </span>'),tr=p("<span> </span>"),ar=p('<div class="spell-slots-header svelte-1uha8ag"></div>'),sr=p("<span> </span><br/>",1),lr=p("<span> </span>"),ir=p('<span class="effect-tooltip"><strong> </strong><br/> <br/> <!> <!></span>'),nr=p('<button class="effect-remove-btn svelte-1uha8ag">√ó</button>'),rr=p('<span class="effect-badge svelte-1uha8ag" tabindex="0"> <!> <!></span>'),or=p(`<div class="active-effects-header svelte-1uha8ag"></div> <style>.effect-badge {
              position: relative;
            }
            .effect-tooltip {
              position: absolute;
              top: 120%;
              left: 50%;
              transform: translateX(-50%);
              background: #fff;
              color: #222;
              border: 1px solid #a5b4fc;
              border-radius: 6px;
              padding: 8px 12px;
              font-size: 0.95em;
              box-shadow: 0 2px 8px rgba(0, 0, 0, 0.12);
              z-index: 10;
              min-width: 180px;
              max-width: 260px;
              white-space: normal;
              pointer-events: none;
              opacity: 1;
              transition: opacity 0.15s;
            }</style>`,1),cr=p('<div class="rest-menu svelte-1uha8ag"><button class="rest-option svelte-1uha8ag">‚òï Short Rest</button> <button class="rest-option svelte-1uha8ag">üõèÔ∏è Long Rest</button></div>'),vr=p('<div class="container svelte-1uha8ag"><header class="svelte-1uha8ag"><div class="header-top svelte-1uha8ag"><div class="header-title svelte-1uha8ag"><div class="title-row svelte-1uha8ag"><h1 class="svelte-1uha8ag">D&D Character Sheet</h1> <!></div> <!> <!></div> <div class="header-right svelte-1uha8ag"><div class="header-controls svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">üé≤</span><span class="btn-text svelte-1uha8ag">Roll Dice</span></button> <div class="rest-button-container svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">üò¥</span><span class="btn-text svelte-1uha8ag">Rest</span></button> <!></div> <div class="mode-toggle"><button><span class="btn-icon svelte-1uha8ag"> </span><span class="btn-text svelte-1uha8ag"> </span></button></div></div> <div class="header-search svelte-1uha8ag"><input type="text" placeholder="üîç Search..." class="search-input use-enabled svelte-1uha8ag"/></div></div></div> <div class="header-actions svelte-1uha8ag"><button class="btn btn-mode svelte-1uha8ag">üìö Browse Spells & Feats</button> <button class="btn btn-secondary">Save to Gist</button> <button class="btn btn-secondary">Load from Gist</button> <button class="btn btn-secondary">Export JSON</button> <button class="btn btn-secondary">Import JSON</button> <input type="file" accept=".json" style="display: none;"/></div></header> <main class="svelte-1uha8ag"><!> <!> <!> <!> <!> <!> <!></main></div> <!> <!> <!> <!>',1);function _r(a,r){Pt(r,!1);const t=()=>Ze(ee,"$character",f),c=()=>Ze(va,"$isEditMode",f),d=()=>Ze(da,"$searchFilter",f),[f,b]=Yt();function C(){const m=[],G=t().classFeatures.spellSlotsByLevel||{};for(let g=1;g<=9;g++){const Le=G[g];if(Le&&Le.length>0){const ve=Le.length,lt=Le.filter(Pe=>Pe).length;m.push({level:g,available:ve-lt,total:ve})}}return m}let $=D(!1),S=D(!1),K=D(!1),E=D("save"),ae=D(void 0),V=D(""),X=D(""),de=D(""),W=D(!1),P=D([]),Se=D("other"),Ne=D(),ne=!1,Me=1,qe=D(!1),se=D(null);function _e(m){o(se,m)}function Te(){o(se,null)}function w(m){o(se,e(se)===m?null:m)}function B(){const m=[];ee.update(g=>{const Le=g.hitDice.current;g.hitDice.current=Math.min(g.hitDice.max,g.hitDice.current+Math.max(1,Math.floor(g.hitDice.max/2)));const ve=g.hitDice.current-Le;if(ve>0&&m.push(`${ve} hit ${ve===1?"die":"dice"}`),g.class){const lt=ha(g.class,g.level,g.subclass);g.classFeatures.features||(g.classFeatures.features={}),lt.forEach(Pe=>{if(Pe.resetOn==="short"){const nt=Pe.name.replace(/\s+/g,"");if(Pe.type==="uses"){const Ee=typeof Pe.maxUses=="function"?Pe.maxUses(g.level):Pe.maxUses;g.classFeatures.features[nt]=Array(Ee).fill(!1),m.push(Pe.name)}else if(Pe.type==="pool"){const Ee=typeof Pe.maxPool=="function"?Pe.maxPool(g.level):Pe.maxPool;Ee!==void 0&&(g.classFeatures.features[nt]=Ee,m.push(Pe.name))}}})}return g}),o(qe,!1);const G=m.length>0?`Short rest taken! Restored: ${m.join(", ")}`:"Short rest taken!";Wt.add(G,"success")}function _(){const m=[];ee.update(g=>{const Le=g.maxHP-g.currentHP;Le>0&&m.push(`${Le} HP`),g.currentHP=g.maxHP,g.tempHP=0;const ve=g.hitDice.max-g.hitDice.current;ve>0&&m.push(`${ve} hit ${ve===1?"die":"dice"}`),g.hitDice.current=g.hitDice.max;let lt=0;if(g.classFeatures.spellSlotsByLevel&&Object.keys(g.classFeatures.spellSlotsByLevel).forEach(Pe=>{const nt=g.classFeatures.spellSlotsByLevel[parseInt(Pe)];if(nt){const Ee=nt.filter(rt=>rt).length;lt+=Ee,g.classFeatures.spellSlotsByLevel[parseInt(Pe)]=Array(nt.length).fill(!1)}}),lt>0&&m.push(`${lt} spell ${lt===1?"slot":"slots"}`),g.class){const Pe=ha(g.class,g.level,g.subclass);g.classFeatures.features||(g.classFeatures.features={});let nt=!1;Pe.forEach(Ee=>{const rt=Ee.name.replace(/\s+/g,"");if(!(Ee.type==="info"||Ee.type==="channelDivinity")){if(Ee.type==="uses"){const $t=typeof Ee.maxUses=="function"?Ee.maxUses(g.level):Ee.maxUses;g.classFeatures.features[rt]=Array($t).fill(!1),nt=!0}else if(Ee.type==="pool"){const $t=typeof Ee.maxPool=="function"?Ee.maxPool(g.level):Ee.maxPool;$t!==void 0&&(g.classFeatures.features[rt]=$t,nt=!0)}}}),nt&&m.push("all class features")}return g}),o(qe,!1);const G=m.length>0?`Long rest taken! Restored: ${m.join(", ")}`:"Long rest taken! Fully rested.";Wt.add(G,"success")}function H(m){o(V,""),o(X,""),o(de,""),o(W,!1),o(P,[]),o(Se,"other"),ne=!1,typeof m=="string"?o(V,m):(o(V,m.notation),o(X,m.damageNotation||""),o(de,m.attackName||""),o(W,!!m.applyHalfDamage),o(P,m.bonusBreakdown||[]),o(Se,m.rollType||"other")),o($,!0)}function h(m){const{notation:G,count:g,bonusBreakdown:Le}=m.detail;o(V,""),ne=!0,Me=g||1,setTimeout(()=>{o(V,G),o(X,""),o(de,"Hit Die"),o(P,Le||[]),o(Se,"other")},0),o($,!0)}function F(){if(o($,!1),ne&&e(Ne)){const m=e(Ne).getLastRollTotal();if(m!==null){const G=Math.max(1,m);ee.update(g=>(g.hitDice.current=Math.max(0,g.hitDice.current-Me),g.currentHP=Math.min(g.maxHP,g.currentHP+G),g))}ne=!1}}function J(){va.update(m=>!m)}function Ie(m){m.target.closest(".rest-button-container")||o(qe,!1)}_a(()=>{const m=va.subscribe(G=>{G?document.body.classList.remove("use-mode"):document.body.classList.add("use-mode")});return document.addEventListener("click",Ie),()=>{m(),document.removeEventListener("click",Ie)}});function je(){zs(t())}function xe(){e(ae)?.click()}async function Ae(m){const g=m.target.files?.[0];if(g)try{const Le=await Ks(g);ee.set(Le),alert("Character imported successfully!")}catch{alert("Failed to import character file")}}It();var tt=vr();qs("1uha8ag",m=>{var G=Zn();pa(2),ps(()=>{Us.title="D&D Character Sheet"}),v(m,G)});var Xe=He(tt),ct=i(Xe),it=i(ct),at=i(it),k=i(at),U=s(i(k),2);{var ye=m=>{var G=er(),g=i(G);l(G),M(()=>A(g,`${t().name??""} (${t().level??""})`)),v(m,G)};x(U,m=>{t().name&&m(ye)})}l(k);var $e=s(k,2);{var T=m=>{var G=ar();St(G,5,C,wt,(g,Le)=>{var ve=tr();let lt;var Pe=i(ve);l(ve),M(()=>{lt=xt(ve,1,"slot-badge svelte-1uha8ag",null,lt,{depleted:e(Le).available===0}),A(Pe,`Lv${e(Le).level??""}: ${e(Le).available??""}/${e(Le).total??""}`)}),v(g,ve)}),l(G),v(m,G)};x($e,m=>{C().length>0&&m(T)})}var j=s($e,2);{var le=m=>{var G=or(),g=He(G);St(g,5,()=>t().activeStates,wt,(Le,ve,lt)=>{var Pe=rr(),nt=i(Pe),Ee=s(nt);{var rt=dt=>{var mt=ir(),bt=i(mt),Ft=i(bt,!0);l(bt);var _t=s(bt,2),gt=s(_t,3);{var sa=yt=>{var Dt=sr(),ut=He(Dt),Ct=i(ut);l(ut),pa(),M(()=>A(Ct,`Attack Bonus: ${typeof e(ve).attackBonus=="number"&&e(ve).attackBonus>0?"+":""}${e(ve).attackBonus??""}`)),v(yt,Dt)};x(gt,yt=>{e(ve).attackBonus&&yt(sa)})}var Qt=s(gt,2);{var Vt=yt=>{var Dt=lr(),ut=i(Dt);l(Dt),M(()=>A(ut,`Damage Bonus: ${typeof e(ve).damageBonus=="number"&&e(ve).damageBonus>0?"+":""}${e(ve).damageBonus??""}`)),v(yt,Dt)};x(Qt,yt=>{e(ve).damageBonus&&yt(Vt)})}l(mt),M(()=>{A(Ft,e(ve).name),A(_t,` ${e(ve).description??""}`)}),v(dt,mt)};x(Ee,dt=>{e(se)===lt&&dt(rt)})}var $t=s(Ee,2);{var ht=dt=>{var mt=nr();M(()=>Ke(mt,"title",`End ${e(ve).name??""}`)),L("click",mt,()=>{ee.update(bt=>{if(bt.activeStates){const Ft=bt.activeStates[lt];Ft?.hpBonus&&Ft.target!=="other"&&(bt.maxHP-=Ft.hpBonus,bt.currentHP=Math.max(1,Math.min(bt.currentHP-Ft.hpBonus,bt.maxHP))),bt.activeStates=bt.activeStates.filter((_t,gt)=>gt!==lt)}return bt})}),v(dt,mt)};x($t,dt=>{c()||dt(ht)})}l(Pe),M(()=>{Ke(Pe,"aria-label",e(ve).name),A(nt,`‚ú® ${e(ve).name??""} `)}),L("mouseenter",Pe,()=>_e(lt)),L("mouseleave",Pe,Te),L("focus",Pe,()=>_e(lt)),L("blur",Pe,Te),L("click",Pe,()=>w(lt)),v(Le,Pe)}),l(g),pa(2),v(m,G)};x(j,m=>{t().activeStates&&t().activeStates.length>0&&m(le)})}l(at);var re=s(at,2),z=i(re),pe=i(z),O=s(pe,2),he=i(O),Ce=s(he,2);{var I=m=>{var G=cr(),g=i(G),Le=s(g,2);l(G),L("click",g,B),L("click",Le,_),v(m,G)};x(Ce,m=>{e(qe)&&m(I)})}l(O);var q=s(O,2),u=i(q);let Re;var we=i(u),ce=i(we,!0);l(we);var be=s(we),De=i(be,!0);l(be),l(u),l(q),l(z);var Ge=s(z,2),We=i(Ge);Be(We),l(Ge),l(re),l(it);var ze=s(it,2),oe=i(ze),ge=s(oe,2),Y=s(ge,2),Fe=s(Y,2),ue=s(Fe,2),y=s(ue,2);wa(y,m=>o(ae,m),()=>e(ae)),l(ze),l(ct);var N=s(ct,2),Z=i(N);ul(Z,{});var Q=s(Z,2);bl(Q,{$$events:{roll:m=>H(m.detail)}});var ke=s(Q,2);Tl(ke,{$$events:{roll:m=>H(m.detail)}});var ie=s(ke,2);Bl(ie,{$$events:{rollHitDice:h}});var Ue=s(ie,2);Ri(Ue,{$$events:{roll:m=>H(m.detail)}});var fe=s(Ue,2);Qi(fe,{});var Oe=s(fe,2);en(Oe,{}),l(N),l(Xe);var Ye=s(Xe,2);wa(bn(Ye,{get notation(){return e(V)},get damageNotation(){return e(X)},get attackName(){return e(de)},get applyHalfDamage(){return e(W)},get bonusBreakdown(){return e(P)},get rollType(){return e(Se)},get visible(){return e($)},$$events:{close:F},$$legacy:!0}),m=>o(Ne,m),()=>e(Ne));var et=s(Ye,2);{var me=m=>{In(m,{get mode(){return e(E)},$$events:{close:()=>o(S,!1)}})};x(et,m=>{e(S)&&m(me)})}var te=s(et,2);{var Qe=m=>{Xn(m,{onClose:()=>o(K,!1)})};x(te,m=>{e(K)&&m(Qe)})}var st=s(te,2);Ws(st,{}),M(()=>{Re=xt(u,1,"btn btn-mode svelte-1uha8ag",null,Re,{"use-mode":!c()}),A(ce,c()?"üìù":"üé≤"),A(De,c()?"Edit Mode":"Use Mode")}),L("click",pe,()=>{o(P,[]),o($,!0)}),L("click",he,()=>o(qe,!e(qe))),L("click",u,J),Je(We,d,m=>Vs(da,m)),L("click",oe,()=>o(K,!0)),L("click",ge,()=>{o(E,"save"),o(S,!0)}),L("click",Y,()=>{o(E,"load"),o(S,!0)}),L("click",Fe,je),L("click",ue,xe),L("change",y,Ae),v(a,tt),Et(),b()}export{_r as component};
