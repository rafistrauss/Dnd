import{f as _,e as A,a as v,s as y,c as at,t as yt}from"../chunks/DByWoho_.js";import{i as ht}from"../chunks/B8VD8sBm.js";import{c as At,o as Ut}from"../chunks/rdJCzvYT.js";import{a6 as ba,i as ga,b1 as Ua,b2 as Na,b3 as ia,J as Ct,e as ha,b4 as ma,ay as Ta,b as i,r as _a,R as ya,g as Ha,B as mt,b5 as Oe,b6 as xt,E,F as _t,s as o,a3 as M,G as l,I as a,H as s,d as e,C as Pe,k as Xe,z as B,b7 as $t,b8 as Et,b9 as Ga,aI as ka,ba as Oa}from"../chunks/BMWhyEAP.js";import{a as Ze,c as Q,b as ct,r as ke,e as it,i as ot,d as $a,u as qa,f as St,s as rt,g as zt,j as Ot,k as za,t as Yt,h as Wa,l as Va,m as Ja}from"../chunks/D9whcMjT.js";import{i as D,s as kt,a as Be,b as Ke,d as Ka}from"../chunks/D39sVKQV.js";import{p as Dt,b as aa}from"../chunks/Ds54jWm4.js";import{b as Mt,r as Qa}from"../chunks/CcHl9fOg.js";function qt(r,u,t=!1){if(r.multiple){if(u==null)return;if(!ga(u))return Ua();for(var c of r.options)c.selected=u.includes(Pt(c));return}for(c of r.options){var x=Pt(c);if(Na(x,u)){c.selected=!0;return}}(!t||u!==void 0)&&(r.selectedIndex=-1)}function sa(r){var u=new MutationObserver(()=>{qt(r,r.__value)});u.observe(r,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),ba(()=>{u.disconnect()})}function xa(r,u,t=u){var c=new WeakSet,x=!0;ia(r,"change",k=>{var w=k?"[selected]":":checked",N;if(r.multiple)N=[].map.call(r.querySelectorAll(w),Pt);else{var g=r.querySelector(w)??r.querySelector("option:not([disabled])");N=g&&Pt(g)}t(N),Ct!==null&&c.add(Ct)}),ha(()=>{var k=u();if(r===document.activeElement){var w=ma??Ct;if(c.has(w))return}if(qt(r,k,x),x&&k===void 0){var N=r.querySelector(":checked");N!==null&&(k=Pt(N),t(k))}r.__value=k,x=!1}),sa(r)}function Pt(r){return"__value"in r?r.__value:r.value}function Ce(r,u,t=u){var c=new WeakSet;ia(r,"input",async x=>{var k=x?r.defaultValue:r.value;if(k=Zt(r)?ea(k):k,t(k),Ct!==null&&c.add(Ct),await Ta(),k!==(k=u())){var w=r.selectionStart,N=r.selectionEnd,g=r.value.length;if(r.value=k??"",N!==null){var G=r.value.length;w===N&&N===g&&G>g?(r.selectionStart=G,r.selectionEnd=G):(r.selectionStart=w,r.selectionEnd=Math.min(N,G))}}}),(ya&&r.defaultValue!==r.value||i(u)==null&&r.value)&&(t(Zt(r)?ea(r.value):r.value),Ct!==null&&c.add(Ct)),_a(()=>{var x=u();if(r===document.activeElement){var k=ma??Ct;if(c.has(k))return}Zt(r)&&x===ea(r.value)||r.type==="date"&&!x&&!r.value||x!==r.value&&(r.value=x??"")})}function ra(r,u,t=u){ia(r,"change",c=>{var x=c?r.defaultChecked:r.checked;t(x)}),(ya&&r.defaultChecked!==r.checked||i(u)==null)&&t(r.checked),_a(()=>{var c=u();r.checked=!!c})}function Zt(r){var u=r.type;return u==="number"||u==="range"}function ea(r){return r===""?null:+r}function Xa(r,u,t){var c=Ha(r,u);c&&c.set&&(r[u]=t,ba(()=>{r[u]=null}))}function na(r){return function(...u){var t=u[0];return t.stopPropagation(),r?.apply(this,u)}}function Ft(r,u){var t=r.$$events?.[u.type],c=ga(t)?t.slice():t==null?[]:[t];for(var x of c)x.call(this,u)}const Ya="";function Ca(...r){return Mt+Ya+Qa(r[0],r[1])}const la={paladin:{name:"Paladin",hitDice:"d10",spellcaster:!0,spellcastingAbility:"charisma",spellSlotsByLevel:{1:0,2:2,3:3,4:3,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Divine Sense",type:"uses",maxUses:(r,u=1)=>1+Math.max(1,u),resetOn:"long",description:"Detect celestials, fiends, and undead within 60 feet",minLevel:1},{name:"Lay on Hands",type:"pool",maxPool:r=>r*5,resetOn:"long",description:"Heal wounds or cure disease",minLevel:1},{name:"Divine Smite",type:"spellSlot",description:"Expend spell slot to deal extra radiant damage",minLevel:2,rollable:!0},{name:"Channel Divinity",type:"pool",maxPool:r=>r>=18?3:r>=6?2:1,resetOn:"short",description:"Sacred Weapon or Turn Undead",minLevel:3}]},fighter:{name:"Fighter",hitDice:"d10",spellcaster:!1,features:[{name:"Second Wind",type:"uses",maxUses:1,resetOn:"short",description:"Regain 1d10 + fighter level HP as bonus action",minLevel:1,rollable:!0,rollFormula:r=>`1d10+${r}`},{name:"Action Surge",type:"uses",maxUses:r=>r>=17?2:1,resetOn:"short",description:"Take one additional action on your turn",minLevel:2},{name:"Indomitable",type:"uses",maxUses:r=>r>=17?3:r>=13?2:1,resetOn:"long",description:"Reroll a failed saving throw",minLevel:9}],subclasses:{champion:{name:"Champion",features:[{name:"Improved Critical",type:"info",description:"Critical hit on 19-20",minLevel:3},{name:"Remarkable Athlete",type:"info",description:"Add half proficiency to STR/DEX/CON checks, increase long jump distance",minLevel:7},{name:"Additional Fighting Style",type:"info",description:"Choose a second fighting style",minLevel:10},{name:"Superior Critical",type:"info",description:"Critical hit on 18-20",minLevel:15},{name:"Survivor",type:"info",description:"Regain 5 + CON mod HP at start of turn if below half HP",minLevel:18}]},battlemaster:{name:"Battle Master",features:[{name:"Combat Superiority",type:"uses",maxUses:r=>r>=15?6:r>=7?5:4,resetOn:"short",description:r=>`Use superiority dice (${r>=18?"d12":r>=10?"d10":"d8"}) for maneuvers`,minLevel:3},{name:"Know Your Enemy",type:"info",description:"Learn capabilities of creatures you observe",minLevel:7},{name:"Improved Combat Superiority",type:"info",description:"Superiority dice become d10",minLevel:10},{name:"Relentless",type:"info",description:"Regain 1 superiority die if you have none at start of turn",minLevel:15}]}}},rogue:{name:"Rogue",hitDice:"d8",spellcaster:!1,features:[{name:"Sneak Attack",type:"info",description:r=>`Deal ${Math.ceil(r/2)}d6 extra damage once per turn with advantage or ally nearby`,minLevel:1,rollable:!0,rollFormula:r=>`${Math.ceil(r/2)}d6`},{name:"Cunning Action",type:"info",description:"Dash, Disengage, or Hide as a bonus action",minLevel:2},{name:"Uncanny Dodge",type:"info",description:"Use reaction to halve damage from an attack",minLevel:5},{name:"Evasion",type:"info",description:"Take no damage on successful Dex save (half on fail)",minLevel:7}]},wizard:{name:"Wizard",hitDice:"d6",spellcaster:!0,spellcastingAbility:"intelligence",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Arcane Recovery",type:"uses",maxUses:1,resetOn:"long",description:r=>`Recover spell slots totaling up to ${Math.ceil(r/2)} levels during short rest`,minLevel:1},{name:"Spell Mastery",type:"info",description:"Cast one 1st-level and one 2nd-level spell at will",minLevel:18}]},cleric:{name:"Cleric",hitDice:"d8",spellcaster:!0,spellcastingAbility:"wisdom",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Channel Divinity",type:"pool",maxPool:r=>r>=18?3:r>=6?2:1,resetOn:"short",description:"Turn Undead or domain-specific ability",minLevel:2},{name:"Destroy Undead",type:"info",description:r=>`Channel Divinity destroys undead of CR ${r>=17?4:r>=14?3:r>=11?2:r>=8?1:.5} or lower`,minLevel:5},{name:"Divine Intervention",type:"uses",maxUses:1,resetOn:"long",description:r=>`${r}% chance to succeed, implore deity for aid`,minLevel:10}],subclasses:{war:{name:"War Domain",features:[{name:"War Priest",type:"uses",maxUses:(r,u=1)=>Math.max(1,u),resetOn:"long",description:"Make one weapon attack as a bonus action",minLevel:1},{name:"Guided Strike",type:"channelDivinity",description:"Use your Channel Divinity to gain +10 to an attack roll. Make this choice after you see the roll, but before the DM says whether the attack hits or misses.",minLevel:2,resetOn:"short"},{name:"War God's Blessing",type:"channelDivinity",description:"Use reaction to grant +10 to an ally's attack roll within 30 feet. Consumes one use of Channel Divinity.",minLevel:6,resetOn:"short"},{name:"Divine Strike",type:"info",description:r=>`Deal extra ${r>=14?"2d8":"1d8"} weapon damage once per turn`,minLevel:8,rollable:!0,rollFormula:r=>r>=14?"2d8":"1d8"},{name:"Avatar of Battle",type:"info",description:"Gain resistance to nonmagical weapon damage",minLevel:17}]},life:{name:"Life Domain",features:[{name:"Disciple of Life",type:"info",description:"Healing spells restore additional 2 + spell level HP",minLevel:1},{name:"Preserve Life",type:"pool",maxPool:r=>r*5,resetOn:"short",description:"Restore HP to creatures within 30 feet",minLevel:2},{name:"Blessed Healer",type:"info",description:"Regain 2 + spell level HP when you cast healing spell",minLevel:6},{name:"Divine Strike",type:"info",description:r=>`Deal extra ${r>=14?"2d8":"1d8"} radiant damage once per turn`,minLevel:8,rollable:!0,rollFormula:r=>r>=14?"2d8":"1d8"},{name:"Supreme Healing",type:"info",description:"Maximize healing dice instead of rolling",minLevel:17}]}}},barbarian:{name:"Barbarian",hitDice:"d12",spellcaster:!1,features:[{name:"Rage",type:"uses",maxUses:r=>r>=20?1/0:r>=17?6:r>=12?5:r>=6?4:r>=3?3:2,resetOn:"long",description:r=>`+${r>=16?4:r>=9?3:2} damage, resistance to physical damage`,minLevel:1},{name:"Reckless Attack",type:"info",description:"Gain advantage on melee attacks, enemies get advantage on you",minLevel:2},{name:"Danger Sense",type:"info",description:"Advantage on Dex saves against effects you can see",minLevel:2}],subclasses:{berserker:{name:"Path of the Berserker",features:[{name:"Frenzy",type:"info",description:"While raging, make melee attack as bonus action (gain 1 exhaustion after rage)",minLevel:3},{name:"Mindless Rage",type:"info",description:"Cannot be charmed or frightened while raging",minLevel:6},{name:"Intimidating Presence",type:"info",description:"Use action to frighten creature within 30 feet",minLevel:10},{name:"Retaliation",type:"info",description:"When damaged by creature within 5 feet, make melee attack as reaction",minLevel:14}]}}}};function gt(r){const u=r.toLowerCase();return la[u]||null}function Bt(r,u,t){const c=gt(r);if(!c)return[];const x=c.features.filter(k=>!k.minLevel||k.minLevel<=u);if(t&&c.subclasses&&c.subclasses[t]){const k=c.subclasses[t].features.filter(w=>!w.minLevel||w.minLevel<=u);return[...x,...k]}return x}function va(r){const u=gt(r);return!u||!u.subclasses?[]:Object.keys(u.subclasses).map(t=>({id:t,name:u.subclasses[t].name}))}function da(r,u){const t=gt(r);return!t||!t.spellcaster||!t.spellSlotsByLevel?0:t.spellSlotsByLevel[u]||0}function ua(r,u,t){const c=gt(r);return!c||!c.spellcaster?0:Math.max(1,t+u)}function Za(r,u,t){const c=gt(r);return!c||!c.spellcaster?null:8+u+t}function es(){return Object.keys(la).map(r=>({id:r,name:la[r].name}))}var ts=_("<option> </option>"),as=_("<option> </option>"),ss=_('<div class="form-group svelte-172i2fj"><label for="characterSubclass" class="svelte-172i2fj">Subclass</label> <select id="characterSubclass" class="svelte-172i2fj"><option>Select Subclass</option><!></select></div>'),ls=_('<div class="info-grid svelte-172i2fj"><div class="form-group svelte-172i2fj"><label for="characterName" class="svelte-172i2fj">Character Name</label> <input type="text" id="characterName" placeholder="Enter name" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterClass" class="svelte-172i2fj">Class</label> <select id="characterClass" class="svelte-172i2fj"><option>Select Class</option><!></select></div> <!> <div class="form-group svelte-172i2fj"><label for="characterLevel" class="svelte-172i2fj">Level</label> <input type="number" id="characterLevel" min="1" max="20" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterRace" class="svelte-172i2fj">Race</label> <input type="text" id="characterRace" placeholder="e.g., Human" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterBackground" class="svelte-172i2fj">Background</label> <input type="text" id="characterBackground" placeholder="e.g., Soldier" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterAlignment" class="svelte-172i2fj">Alignment</label> <input type="text" id="characterAlignment" placeholder="e.g., Lawful Good" class="svelte-172i2fj"/></div></div>'),is=_('<section class="character-info svelte-172i2fj"><div class="header svelte-172i2fj"><h2 class="svelte-172i2fj">Character Info</h2> <button class="collapse-btn svelte-172i2fj"> </button></div> <!></section>');function rs(r,u){mt(u,!1);const t=()=>Be(Q,"$character",x),c=()=>Be(ct,"$collapsedStates",x),[x,k]=kt(),w=M(),N=es();function g(te){const oe=te.target;Q.update(ae=>(ae.class=oe.value,ae.subclass="",ae))}function G(te){const oe=te.target;Q.update(ae=>(ae.subclass=oe.value,ae))}function ee(te){const oe=te.target;Q.update(ae=>(ae.level=parseInt(oe.value)||1,ae)),qa()}function X(){ct.update(te=>({...te,characterInfo:!te.characterInfo}))}Oe(()=>(t(),va),()=>{o(w,t().class?va(t().class):[])}),xt(),ht();var W=is(),de=l(W),re=a(l(de),2),me=l(re,!0);s(re),s(de);var ne=a(de,2);{var T=te=>{var oe=ls(),ae=l(oe),ce=a(l(ae),2);ke(ce),s(ae);var V=a(ae,2),U=a(l(V),2),Y=l(U);Y.value=Y.__value="";var le=a(Y);it(le,1,()=>N,ot,(J,S)=>{var ge=ts(),Re=l(ge,!0);s(ge);var $e={};E(()=>{y(Re,(e(S),i(()=>e(S).name))),$e!==($e=(e(S),i(()=>e(S).id)))&&(ge.value=(ge.__value=(e(S),i(()=>e(S).id)))??"")}),v(J,ge)}),s(U);var ie;sa(U),s(V);var Ie=a(V,2);{var L=J=>{var S=ss(),ge=a(l(S),2),Re=l(ge);Re.value=Re.__value="";var $e=a(Re);it($e,1,()=>e(w),ot,(Ne,Ve)=>{var qe=as(),ze=l(qe,!0);s(qe);var h={};E(()=>{y(ze,(e(Ve),i(()=>e(Ve).name))),h!==(h=(e(Ve),i(()=>e(Ve).id)))&&(qe.value=(qe.__value=(e(Ve),i(()=>e(Ve).id)))??"")}),v(Ne,qe)}),s(ge);var Se;sa(ge),s(S),E(()=>{Se!==(Se=(t(),i(()=>t().subclass)))&&(ge.value=(ge.__value=(t(),i(()=>t().subclass)))??"",qt(ge,(t(),i(()=>t().subclass))))}),A("change",ge,G),v(J,S)};D(Ie,J=>{e(w),i(()=>e(w).length>0)&&J(L)})}var f=a(Ie,2),C=a(l(f),2);ke(C),s(f);var d=a(f,2),b=a(l(d),2);ke(b),s(d);var O=a(d,2),Me=a(l(O),2);ke(Me),s(O);var De=a(O,2),Fe=a(l(De),2);ke(Fe),s(De),s(oe),E(()=>{ie!==(ie=(t(),i(()=>t().class)))&&(U.value=(U.__value=(t(),i(()=>t().class)))??"",qt(U,(t(),i(()=>t().class)))),$a(C,(t(),i(()=>t().level)))}),Ce(ce,()=>t().name,J=>Ke(Q,i(t).name=J,i(t))),A("change",U,g),A("change",C,ee),Ce(b,()=>t().race,J=>Ke(Q,i(t).race=J,i(t))),Ce(Me,()=>t().background,J=>Ke(Q,i(t).background=J,i(t))),Ce(Fe,()=>t().alignment,J=>Ke(Q,i(t).alignment=J,i(t))),v(te,oe)};D(ne,te=>{c(),i(()=>!c().characterInfo)&&te(T)})}s(W),E(()=>{Ze(re,"aria-label",(c(),i(()=>c().characterInfo?"Expand":"Collapse"))),y(me,(c(),i(()=>c().characterInfo?"â–¼":"â–²")))}),A("click",re,X),v(r,W),_t(),k()}var ns=_('<div class="ability-card svelte-bbv1xt"><h3 class="svelte-bbv1xt"> </h3> <input type="number" class="ability-score svelte-bbv1xt" min="1" max="30"/> <div class="ability-modifier svelte-bbv1xt"> </div> <button class="roll-btn svelte-bbv1xt">Check</button> <div class="save-row svelte-bbv1xt"><input type="checkbox" class="svelte-bbv1xt"/> <label class="svelte-bbv1xt">Save</label> <button class="roll-btn-small svelte-bbv1xt">Roll</button></div></div>'),os=_('<div class="proficiency-bonus svelte-bbv1xt"><label for="profBonus">Proficiency Bonus</label> <input type="number" id="profBonus" class="prof-input svelte-bbv1xt"/></div> <div class="abilities-grid svelte-bbv1xt"></div>',1),cs=_('<section><div class="header svelte-bbv1xt"><h2 class="svelte-bbv1xt">Ability Scores</h2> <button class="collapse-btn svelte-bbv1xt"> </button></div> <!></section>');function vs(r,u){mt(u,!1);const t=()=>Be(zt,"$abilityModifiers",w),c=()=>Be(Q,"$character",w),x=()=>Be(St,"$searchFilter",w),k=()=>Be(ct,"$collapsedStates",w),[w,N]=kt(),g=M(),G=M(),ee=At(),X=[{key:"strength",label:"Strength"},{key:"dexterity",label:"Dexterity"},{key:"constitution",label:"Constitution"},{key:"intelligence",label:"Intelligence"},{key:"wisdom",label:"Wisdom"},{key:"charisma",label:"Charisma"}];function W(){updateProficiencyBonus()}function de(U){const Y=t()[U],le=`1d20${Y>=0?"+":""}${Y}`;ee("roll",le)}function re(U){const Y=t()[U],le=c().saveProficiencies[U]?c().proficiencyBonus:0,ie=Y+le,Ie=`1d20${ie>=0?"+":""}${ie}`;ee("roll",Ie)}function me(){ct.update(U=>({...U,abilityScores:!U.abilityScores}))}Oe(()=>x(),()=>{o(g,X.filter(({label:U})=>x()?U.toLowerCase().includes(x().toLowerCase()):!0))}),Oe(()=>(e(g),x()),()=>{o(G,e(g).length>0||!x()||x().toLowerCase().includes("proficiency"))}),xt(),ht();var ne=cs();let T;var te=l(ne),oe=a(l(te),2),ae=l(oe,!0);s(oe),s(te);var ce=a(te,2);{var V=U=>{var Y=os(),le=Pe(Y),ie=a(l(le),2);ke(ie),s(le);var Ie=a(le,2);it(Ie,5,()=>e(g),ot,(L,f)=>{let C=()=>e(f).key,d=()=>e(f).label;var b=ns(),O=l(b),Me=l(O,!0);s(O);var De=a(O,2);ke(De);var Fe=a(De,2),J=l(Fe);s(Fe);var S=a(Fe,2),ge=a(S,2),Re=l(ge);ke(Re);var $e=a(Re,2),Se=a($e,2);s(ge),s(b),E(Ne=>{y(Me,Ne),y(J,`${t(),C(),i(()=>t()[C()]>=0?"+":"")??""}${t(),C(),i(()=>t()[C()])??""}`),Ze(Re,"id",`${C()}-save`),Ze($e,"for",`${C()}-save`)},[()=>(d(),i(()=>d().substring(0,3).toUpperCase()))]),Ce(De,()=>c().abilities[C()],Ne=>Ke(Q,i(c).abilities[C()]=Ne,i(c))),A("change",De,W),A("click",S,()=>de(C())),ra(Re,()=>c().saveProficiencies[C()],Ne=>Ke(Q,i(c).saveProficiencies[C()]=Ne,i(c))),A("click",Se,()=>re(C())),v(L,b)}),s(Ie),Ce(ie,()=>c().proficiencyBonus,L=>Ke(Q,i(c).proficiencyBonus=L,i(c))),v(U,Y)};D(ce,U=>{k(),i(()=>!k().abilityScores)&&U(V)})}s(ne),E(()=>{T=rt(ne,1,"ability-scores svelte-bbv1xt",null,T,{hidden:!e(G)}),Ze(oe,"aria-label",(k(),i(()=>k().abilityScores?"Expand":"Collapse"))),y(ae,(k(),i(()=>k().abilityScores?"â–¼":"â–²")))}),A("click",oe,me),v(r,ne),_t(),N()}var ds=_('<span class="hit-dice-type"> </span>'),us=_('<div class="stats-grid svelte-1r5hyyb"><div class="stat-box svelte-1r5hyyb"><label for="armorClass" class="svelte-1r5hyyb">Armor Class</label> <input type="number" id="armorClass" class="stat-input svelte-1r5hyyb"/></div> <div class="stat-box svelte-1r5hyyb"><label for="initiative" class="svelte-1r5hyyb">Initiative</label> <input type="number" id="initiative" class="stat-input svelte-1r5hyyb"/></div> <div class="stat-box svelte-1r5hyyb"><label for="speed" class="svelte-1r5hyyb">Speed</label> <input type="text" id="speed" class="stat-input svelte-1r5hyyb"/></div></div> <div class="hp-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Points</h3> <div class="hp-display svelte-1r5hyyb"><div class="hp-inputs svelte-1r5hyyb"><input type="number" class="hp-current svelte-1r5hyyb" min="0"/> <span class="hp-separator svelte-1r5hyyb">/</span> <input type="number" class="hp-max svelte-1r5hyyb" min="0"/></div> <div class="hp-controls svelte-1r5hyyb"><button class="hp-btn svelte-1r5hyyb">âˆ’</button> <button class="hp-btn svelte-1r5hyyb">+</button> <button class="hp-btn svelte-1r5hyyb">âˆ’5</button> <button class="hp-btn svelte-1r5hyyb">+5</button></div></div> <div class="temp-hp svelte-1r5hyyb"><label for="tempHP" class="svelte-1r5hyyb">Temp HP</label> <input type="number" id="tempHP" min="0" class="svelte-1r5hyyb"/></div></div> <div class="hit-dice-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Dice</h3> <div class="hit-dice-display svelte-1r5hyyb"><input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <span>/</span> <input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <!></div> <div class="hit-dice-controls"><label for="hitDiceCount" class="svelte-1r5hyyb">Roll</label> <input type="number" id="hitDiceCount" class="hit-dice-count-input svelte-1r5hyyb" min="1" value="1"/> <button class="btn btn-primary roll-hit-dice use-enabled svelte-1r5hyyb">ðŸŽ² Roll</button></div></div>',1),ps=_('<section><div class="header svelte-1r5hyyb"><h2 class="svelte-1r5hyyb">Combat Stats</h2> <button class="collapse-btn svelte-1r5hyyb"> </button></div> <!></section>');function fs(r,u){mt(u,!1);const t=()=>Be(Q,"$character",w),c=()=>Be(zt,"$abilityModifiers",w),x=()=>Be(St,"$searchFilter",w),k=()=>Be(ct,"$collapsedStates",w),[w,N]=kt(),g=M(),G=At();function ee(ae){Q.update(ce=>(ce.currentHP=Math.max(0,Math.min(ce.maxHP,ce.currentHP+ae)),ce))}function X(ae=1){if(t().hitDice.current<=0){alert("No hit dice remaining!");return}if(!t().class){alert("Please select a class first!");return}const ce=gt(t().class);if(!ce){alert("Invalid class configuration!");return}const V=Math.min(ae,t().hitDice.current),U=ce.hitDice,Y=c().constitution,le=Y>=0?`+${Y}`:`${Y}`,ie=`${V}${U}${le}`;G("rollHitDice",{notation:ie,hitDie:U,count:V})}function W(){ct.update(ae=>({...ae,combatStats:!ae.combatStats}))}Oe(()=>x(),()=>{o(g,!x()||"armor class".includes(x().toLowerCase())||"initiative".includes(x().toLowerCase())||"speed".includes(x().toLowerCase())||"hit points".includes(x().toLowerCase())||"hp".includes(x().toLowerCase())||"hit dice".includes(x().toLowerCase())||"combat".includes(x().toLowerCase()))}),xt(),ht();var de=ps();let re;var me=l(de),ne=a(l(me),2),T=l(ne,!0);s(ne),s(me);var te=a(me,2);{var oe=ae=>{var ce=us(),V=Pe(ce),U=l(V),Y=a(l(U),2);ke(Y),s(U);var le=a(U,2),ie=a(l(le),2);ke(ie),s(le);var Ie=a(le,2),L=a(l(Ie),2);ke(L),s(Ie),s(V);var f=a(V,2),C=a(l(f),2),d=l(C),b=l(d);ke(b);var O=a(b,4);ke(O),s(d);var Me=a(d,2),De=l(Me),Fe=a(De,2),J=a(Fe,2),S=a(J,2);s(Me),s(C);var ge=a(C,2),Re=a(l(ge),2);ke(Re),s(ge),s(f);var $e=a(f,2),Se=a(l($e),2),Ne=l(Se);ke(Ne);var Ve=a(Ne,4);ke(Ve);var qe=a(Ve,2);{var ze=P=>{const xe=Xe(()=>(B(gt),t(),i(()=>gt(t().class))));var ye=at(),we=Pe(ye);{var _e=j=>{const fe=Xe(()=>(c(),i(()=>c().constitution)));var ue=ds(),Ae=l(ue);s(ue),E(()=>y(Ae,`(${B(e(xe)),i(()=>e(xe).hitDice)??""}${(e(fe)>=0?`+${e(fe)}`:e(fe))??""})`)),v(j,ue)};D(we,j=>{e(xe)&&j(_e)})}v(P,ye)};D(qe,P=>{t(),i(()=>t().class)&&P(ze)})}s(Se);var h=a(Se,2),q=a(l(h),2),Z=a(q,2);s(h),s($e),E(()=>{Ze(b,"max",(t(),i(()=>t().maxHP))),Ze(Ne,"max",(t(),i(()=>t().hitDice.max))),Ze(q,"max",(t(),i(()=>t().hitDice.current))),Z.disabled=(t(),i(()=>t().hitDice.current<=0||!t().class))}),Ce(Y,()=>t().armorClass,P=>Ke(Q,i(t).armorClass=P,i(t))),Ce(ie,()=>t().initiative,P=>Ke(Q,i(t).initiative=P,i(t))),Ce(L,()=>t().speed,P=>Ke(Q,i(t).speed=P,i(t))),Ce(b,()=>t().currentHP,P=>Ke(Q,i(t).currentHP=P,i(t))),Ce(O,()=>t().maxHP,P=>Ke(Q,i(t).maxHP=P,i(t))),A("click",De,()=>ee(-1)),A("click",Fe,()=>ee(1)),A("click",J,()=>ee(-5)),A("click",S,()=>ee(5)),Ce(Re,()=>t().tempHP,P=>Ke(Q,i(t).tempHP=P,i(t))),Ce(Ne,()=>t().hitDice.current,P=>Ke(Q,i(t).hitDice.current=P,i(t))),Ce(Ve,()=>t().hitDice.max,P=>Ke(Q,i(t).hitDice.max=P,i(t))),A("input",q,P=>{const xe=P.target,ye=parseInt(xe.value);ye>t().hitDice.current&&(xe.value=String(t().hitDice.current)),ye<1&&(xe.value="1")}),A("click",Z,()=>{const P=document.getElementById("hitDiceCount"),xe=parseInt(P?.value||"1");X(xe)}),v(ae,ce)};D(te,ae=>{k(),i(()=>!k().combatStats)&&ae(oe)})}s(de),E(()=>{re=rt(de,1,"combat-stats svelte-1r5hyyb",null,re,{hidden:!e(g)}),Ze(ne,"aria-label",(k(),i(()=>k().combatStats?"Expand":"Collapse"))),y(T,(k(),i(()=>k().combatStats?"â–¼":"â–²")))}),A("click",ne,W),v(r,de),_t(),N()}const ta={acrobatics:"dexterity",animalHandling:"wisdom",arcana:"intelligence",athletics:"strength",deception:"charisma",history:"intelligence",insight:"wisdom",intimidation:"charisma",investigation:"intelligence",medicine:"wisdom",nature:"intelligence",perception:"wisdom",performance:"charisma",persuasion:"charisma",religion:"intelligence",sleightOfHand:"dexterity",stealth:"dexterity",survival:"wisdom"};var bs=_('<div class="skill-row svelte-1f1pl16"><input type="checkbox" class="svelte-1f1pl16"/> <label class="svelte-1f1pl16"> <span class="ability-tag svelte-1f1pl16"> </span></label> <span class="skill-modifier svelte-1f1pl16"> </span> <button class="roll-btn svelte-1f1pl16">Roll</button></div>'),gs=_('<div class="skills-grid svelte-1f1pl16"></div>'),hs=_('<section><div class="header svelte-1f1pl16"><h2 class="svelte-1f1pl16">Skills</h2> <button class="collapse-btn svelte-1f1pl16"> </button></div> <!></section>');function ms(r,u){mt(u,!1);const t=()=>Be(zt,"$abilityModifiers",w),c=()=>Be(Q,"$character",w),x=()=>Be(St,"$searchFilter",w),k=()=>Be(ct,"$collapsedStates",w),[w,N]=kt(),g=M(),G=M(),ee=At(),X=[{key:"acrobatics",label:"Acrobatics"},{key:"animalHandling",label:"Animal Handling"},{key:"arcana",label:"Arcana"},{key:"athletics",label:"Athletics"},{key:"deception",label:"Deception"},{key:"history",label:"History"},{key:"insight",label:"Insight"},{key:"intimidation",label:"Intimidation"},{key:"investigation",label:"Investigation"},{key:"medicine",label:"Medicine"},{key:"nature",label:"Nature"},{key:"perception",label:"Perception"},{key:"performance",label:"Performance"},{key:"persuasion",label:"Persuasion"},{key:"religion",label:"Religion"},{key:"sleightOfHand",label:"Sleight of Hand"},{key:"stealth",label:"Stealth"},{key:"survival",label:"Survival"}];function W(V){const U=ta[V],Y=t()[U],le=c().skillProficiencies[V]?c().proficiencyBonus:0;return Y+le}function de(V){const U=W(V),Y=`1d20${U>=0?"+":""}${U}`;ee("roll",Y)}function re(){ct.update(V=>({...V,skills:!V.skills}))}Oe(()=>x(),()=>{o(g,X.filter(({label:V})=>x()?V.toLowerCase().includes(x().toLowerCase()):!0))}),Oe(()=>e(g),()=>{o(G,e(g).length>0)}),xt(),ht();var me=hs();let ne;var T=l(me),te=a(l(T),2),oe=l(te,!0);s(te),s(T);var ae=a(T,2);{var ce=V=>{var U=gs();it(U,5,()=>e(g),ot,(Y,le)=>{let ie=()=>e(le).key,Ie=()=>e(le).label;const L=Xe(()=>(B(ta),ie(),i(()=>ta[ie()]))),f=Xe(()=>(ie(),i(()=>W(ie()))));var C=bs(),d=l(C);ke(d);var b=a(d,2),O=l(b),Me=a(O),De=l(Me);s(Me),s(b);var Fe=a(b,2),J=l(Fe);s(Fe);var S=a(Fe,2);s(C),E(ge=>{Ze(d,"id",ie()),Ze(b,"for",ie()),y(O,`${Ie()??""} `),y(De,`(${ge??""})`),y(J,`${e(f)>=0?"+":""}${e(f)??""}`)},[()=>(B(e(L)),i(()=>e(L).substring(0,3).toUpperCase()))]),ra(d,()=>c().skillProficiencies[ie()],ge=>Ke(Q,i(c).skillProficiencies[ie()]=ge,i(c))),A("click",S,()=>de(ie())),v(Y,C)}),s(U),v(V,U)};D(ae,V=>{k(),i(()=>!k().skills)&&V(ce)})}s(me),E(()=>{ne=rt(me,1,"skills svelte-1f1pl16",null,ne,{hidden:!e(G)}),Ze(te,"aria-label",(k(),i(()=>k().skills?"Expand":"Collapse"))),y(oe,(k(),i(()=>k().skills?"â–¼":"â–²")))}),A("click",te,re),v(r,me),_t(),N()}let Ht=null,Gt=null;async function Sa(){if(Ht)return Ht;try{return Ht=await(await fetch(Ca("/data/spells.json"))).json(),Ht||[]}catch(r){return console.error("Failed to load spells:",r),[]}}async function _s(){if(Gt)return Gt;try{return Gt=await(await fetch(Ca("/data/feats.json"))).json(),Gt||[]}catch(r){return console.error("Failed to load feats:",r),[]}}function pa(r,u){if(!u.trim())return r;const t=u.toLowerCase();return r.filter(c=>c.name.toLowerCase().includes(t)||c.school.toLowerCase().includes(t)||c.classes.some(x=>x.toLowerCase().includes(t))||c.description.toLowerCase().includes(t))}function ys(r,u){return u===null?r:r.filter(t=>t.level===u)}function ks(r,u){if(!u.trim())return r;const t=u.toLowerCase();return r.filter(c=>c.name.toLowerCase().includes(t)||c.description.toLowerCase().includes(t))}var $s=_('<button class="btn-remove svelte-14o91c5">Ã—</button>'),xs=_('<div class="spell-info-loading svelte-14o91c5">Loading spell info...</div>'),Cs=_('<li class="svelte-14o91c5"><strong>At Higher Levels:</strong> </li>'),Ss=_("<option> </option>"),Ls=_('<span class="scaled-damage svelte-14o91c5"> </span>'),js=_('<span class="scaled-damage svelte-14o91c5"> </span>'),ws=_('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> Target is Fiend or Undead <!></label></div>'),Ds=_('<div class="spell-level-selector svelte-14o91c5"><label class="svelte-14o91c5">Cast at Level:</label> <select class="spell-level-select use-enabled svelte-14o91c5"></select> <!></div> <!>',1),Fs=_('<div class="spell-level-selector svelte-14o91c5"><span style="color: #dc3545; font-weight: bold;">No spell slots available!</span></div>'),As=_('<div class="spell-notes svelte-14o91c5"><h4 class="svelte-14o91c5">General Notes</h4> <p> </p></div>'),Rs=_('<div class="spell-info svelte-14o91c5"><h4 class="svelte-14o91c5">Spell Info</h4> <ul class="svelte-14o91c5"><li class="svelte-14o91c5"><strong>Level:</strong> </li> <li class="svelte-14o91c5"><strong>Casting Time:</strong> </li> <li class="svelte-14o91c5"><strong>Range:</strong> </li> <li class="svelte-14o91c5"><strong>Components:</strong> <!></li> <li class="svelte-14o91c5"><strong>Duration:</strong> <!> </li> <li class="svelte-14o91c5"><strong>Description:</strong> </li> <!></ul></div> <!> <!>',1),Is=_('<div class="spell-info-missing svelte-14o91c5">Spell info not found.</div>'),Ms=_('<div class="attack-notes svelte-14o91c5"><label class="svelte-14o91c5">Notes</label> <textarea placeholder="e.g., DC 15 Dex save, Range 120 ft, Concentration" class="notes-input svelte-14o91c5" rows="2"></textarea></div>'),Es=_('<button class="btn btn-primary">Roll Attack</button>'),Ps=_('<div class="attack-card svelte-14o91c5"><div class="attack-header svelte-14o91c5"><input type="text" placeholder="Attack name" class="attack-name svelte-14o91c5"/> <!></div> <div class="attack-details svelte-14o91c5"><div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Bonus</label> <input type="number" class="attack-bonus svelte-14o91c5"/></div> <div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Damage</label> <input type="text" placeholder="e.g., 2d6+3" class="attack-damage svelte-14o91c5"/></div> <div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Type</label> <input type="text" placeholder="e.g., slashing" class="attack-type svelte-14o91c5"/></div></div> <!> <!> <div class="attack-actions svelte-14o91c5"><!> <button class="btn btn-secondary">Roll Damage</button></div></div>'),Bs=_('<p class="no-attacks svelte-14o91c5">No attacks added yet. Click "Add Attack" to create one.</p>'),Us=_('<p class="no-attacks svelte-14o91c5">No attacks match your search.</p>'),Ns=_('<button class="btn btn-secondary">Add Attack</button> <div class="attacks-list svelte-14o91c5"><!> <!></div>',1),Ts=_('<section><div class="header svelte-14o91c5"><h2 class="svelte-14o91c5">Attacks & Spells</h2> <button class="collapse-btn svelte-14o91c5"> </button></div> <!></section>');function Hs(r,u){mt(u,!1);const t=()=>Be(Q,"$character",w),c=()=>Be(St,"$searchFilter",w),x=()=>Be(ct,"$collapsedStates",w),k=()=>Be(Ot,"$isEditMode",w),[w,N]=kt(),g=M(),G=M(),ee=At();function X(){Q.update(f=>(f.attacks=[...f.attacks,{id:crypto.randomUUID(),name:"",bonus:0,damage:"",damageType:"",notes:""}],f))}function W(f){Q.update(C=>(C.attacks=C.attacks.filter(d=>d.id!==f),C))}function de(f){let C=f.damage;if(f.spellRef){const b=T(f.spellRef);if(b&&b.level>0){const O=f.castAtLevel||b.level;if(!te(O)){alert(`No level ${O} spell slots available!`);return}C=oe(f,b)}}const d=`1d20${f.bonus>=0?"+":""}${f.bonus}`;ee("roll",{notation:d,damageNotation:C,attackName:f.name})}function re(f){if(!f.damage){alert(`${f.name}: No damage specified`);return}let C=f.damage;if(f.spellRef){const d=T(f.spellRef);if(d&&d.level>0){const b=f.castAtLevel||d.level;if(!te(b)){alert(`No level ${b} spell slots available!`);return}C=oe(f,d)}}ee("roll",{notation:C,attackName:f.name})}function me(){ct.update(f=>({...f,attacks:!f.attacks}))}let ne=M([]);Ut(async()=>{o(ne,await Sa())});function T(f){return e(ne).find(C=>C.name===f)}function te(f){t().classFeatures.spellSlotsByLevel||Ke(Q,i(t).classFeatures.spellSlotsByLevel={},i(t)),t().classFeatures.spellSlotsByLevel[f]||Ke(Q,i(t).classFeatures.spellSlotsByLevel[f]=Array(2).fill(!1),i(t));const d=t().classFeatures.spellSlotsByLevel[f].findIndex(b=>!b);return d===-1?!1:(Q.update(b=>(b.classFeatures.spellSlotsByLevel||(b.classFeatures.spellSlotsByLevel={}),b.classFeatures.spellSlotsByLevel[f]||(b.classFeatures.spellSlotsByLevel[f]=Array(2).fill(!1)),b.classFeatures.spellSlotsByLevel[f][d]=!0,b)),!0)}function oe(f,C){let d=f.damage,b=0;if(C.higherLevelSlot&&f.castAtLevel){const J=C.level,ge=(f.castAtLevel||J)-J;if(ge>0){const Re=C.higherLevelSlot.match(/(\d+)d(\d+)\s+for\s+each.*?level\s+above/i);if(Re){const[,$e]=Re;b+=ge*parseInt($e)}}}if(f.targetIsFiendOrUndead&&C.description.includes("Fiend or an Undead")){const J=C.description.match(/increases by (\d+)d(\d+) if.*?Fiend or.*?Undead/i);if(J){const[,S]=J;b+=parseInt(S)}}const O=d.match(/(\d+)d(\d+)/);if(!O)return d;const[,Me,De]=O;return`${parseInt(Me)+b}d${De}`}function ae(f){const C=[];for(let b=f.level;b<=9;b++){const O=t().classFeatures.spellSlotsByLevel?.[b];O&&O.length>0&&C.push(b)}return C}function ce(f){const C=t().classFeatures.spellSlotsByLevel?.[f]||[],d=C.length,b=C.filter(O=>O).length;return{available:d-b,total:d}}Oe(()=>(t(),c()),()=>{o(g,t().attacks.filter(f=>{if(!c())return!0;const C=c().toLowerCase();return f.name.toLowerCase().includes(C)||f.damageType.toLowerCase().includes(C)}).sort((f,C)=>!f.spellRef&&C.spellRef?-1:f.spellRef&&!C.spellRef?1:0))}),Oe(()=>(c(),e(g)),()=>{o(G,!c()||e(g).length>0||"attack".includes(c().toLowerCase())||"spell".includes(c().toLowerCase()))}),xt(),ht();var V=Ts();let U;var Y=l(V),le=a(l(Y),2),ie=l(le,!0);s(le),s(Y);var Ie=a(Y,2);{var L=f=>{var C=Ns(),d=Pe(C),b=a(d,2),O=l(b);it(O,1,()=>e(g),J=>J.id,(J,S,ge)=>{var Re=Ps(),$e=l(Re),Se=l($e);ke(Se);var Ne=a(Se,2);{var Ve=pe=>{var se=$s();A("click",se,()=>W(e(S).id)),v(pe,se)};D(Ne,pe=>{k()&&pe(Ve)})}s($e);var qe=a($e,2),ze=l(qe),h=a(l(ze),2);ke(h),s(ze);var q=a(ze,2),Z=a(l(q),2);ke(Z),s(q);var P=a(q,2),xe=a(l(P),2);ke(xe),s(P),s(qe);var ye=a(qe,2);{var we=pe=>{var se=at(),z=Pe(se);{var he=be=>{var $=xs();v(be,$)},Ee=be=>{const $=Xe(()=>(e(S),i(()=>T(e(S).spellRef))));var p=at(),R=Pe(p);{var K=m=>{var F=Rs(),I=Pe(F),H=a(l(I),2),Le=l(H),je=a(l(Le));s(Le);var Te=a(Le,2),et=a(l(Te));s(Te);var Je=a(Te,2),We=a(l(Je));s(Je);var tt=a(Je,2),lt=a(l(tt)),Ue=a(lt);{var Ye=Qe=>{var st=yt();E(()=>y(st,`(${B(e($)),i(()=>e($).material)??""})`)),v(Qe,st)};D(Ue,Qe=>{B(e($)),i(()=>e($).material)&&Qe(Ye)})}s(tt);var nt=a(tt,2),ve=a(l(nt),2);{var Ge=Qe=>{var st=yt("Concentration,");v(Qe,st)};D(ve,Qe=>{B(e($)),i(()=>e($).concentration)&&Qe(Ge)})}var dt=a(ve,1,!0);s(nt);var vt=a(nt,2),jt=a(l(vt));s(vt);var Vt=a(vt,2);{var La=Qe=>{var st=Cs(),Lt=a(l(st));s(st),E(()=>y(Lt,` ${B(e($)),i(()=>e($).higherLevelSlot)??""}`)),v(Qe,st)};D(Vt,Qe=>{B(e($)),i(()=>e($).higherLevelSlot)&&Qe(La)})}s(H),s(I);var oa=a(I,2);{var ja=Qe=>{const st=Xe(()=>(B(e($)),i(()=>ae(e($)))));var Lt=at(),Jt=Pe(Lt);{var Fa=wt=>{var Nt=Ds(),Kt=Pe(Nt),ca=l(Kt),Rt=a(ca,2);E(()=>{e(S),$t(()=>{e(st)})}),it(Rt,5,()=>e(st),ot,(ut,pt)=>{const ft=Xe(()=>(e(pt),i(()=>ce(e(pt)))));var bt=Ss(),Qt=l(bt);s(bt);var Tt={};E(()=>{y(Qt,`Level ${e(pt)??""} (${B(e(ft)),i(()=>e(ft).available)??""}/${B(e(ft)),i(()=>e(ft).total)??""} slots)`),Tt!==(Tt=e(pt))&&(bt.value=(bt.__value=e(pt))??"")}),v(ut,bt)}),s(Rt);var Ra=a(Rt,2);{var Ia=ut=>{const pt=Xe(()=>(e(S),B(e($)),i(()=>oe(e(S),e($)))));var ft=Ls(),bt=l(ft);s(ft),E(()=>y(bt,`Damage: ${e(pt)??""}`)),v(ut,ft)};D(Ra,ut=>{e(S),B(e($)),i(()=>e(S).castAtLevel&&e(S).castAtLevel>e($).level)&&ut(Ia)})}s(Kt);var Ma=a(Kt,2);{var Ea=ut=>{var pt=ws(),ft=l(pt),bt=l(ft);ke(bt);var Qt=a(bt,2);{var Tt=It=>{const Pa=Xe(()=>(e(S),B(e($)),i(()=>oe(e(S),e($)))));var Xt=js(),Ba=l(Xt);s(Xt),E(()=>y(Ba,`(+1d8, total: ${e(Pa)??""})`)),v(It,Xt)};D(Qt,It=>{e(S),i(()=>e(S).targetIsFiendOrUndead)&&It(Tt)})}s(ft),s(pt),ra(bt,()=>e(S).targetIsFiendOrUndead,It=>(e(S).targetIsFiendOrUndead=It,$t(()=>(e(g),t(),c())))),v(ut,pt)};D(Ma,ut=>{B(e($)),i(()=>e($).description.includes("Fiend or an Undead"))&&ut(Ea)})}E(()=>{Ze(ca,"for",`castLevel-${e(S),i(()=>e(S).id)??""}`),Ze(Rt,"id",`castLevel-${e(S),i(()=>e(S).id)??""}`)}),xa(Rt,()=>e(S).castAtLevel,ut=>(e(S).castAtLevel=ut,$t(()=>(e(g),t(),c())))),v(wt,Nt)},Aa=wt=>{var Nt=Fs();v(wt,Nt)};D(Jt,wt=>{B(e(st)),i(()=>e(st).length>0)?wt(Fa):wt(Aa,!1)})}v(Qe,Lt)};D(oa,Qe=>{B(e($)),i(()=>e($).higherLevelSlot&&e($).level>0)&&Qe(ja)})}var wa=a(oa,2);{var Da=Qe=>{var st=As(),Lt=a(l(st),2),Jt=l(Lt,!0);s(Lt),s(st),E(()=>y(Jt,(e(S),i(()=>e(S).generalNotes)))),v(Qe,st)};D(wa,Qe=>{e(S),i(()=>e(S).generalNotes)&&Qe(Da)})}E(Qe=>{y(je,` ${B(e($)),i(()=>e($).level)??""}`),y(et,` ${B(e($)),i(()=>e($).castingTime||e($).actionType)??""}`),y(We,` ${B(e($)),i(()=>e($).range)??""}`),y(lt,` ${Qe??""}`),y(dt,(B(e($)),i(()=>e($).duration))),y(jt,` ${B(e($)),i(()=>e($).description)??""}`)},[()=>(B(e($)),i(()=>e($).components.join(", ")))]),v(m,F)},n=m=>{var F=Is();v(m,F)};D(R,m=>{e($)?m(K):m(n,!1)})}v(be,p)};D(z,be=>{e(ne),i(()=>e(ne).length===0)?be(he):be(Ee,!1)})}v(pe,se)};D(ye,pe=>{e(S),i(()=>e(S).spellRef)&&pe(we)})}var _e=a(ye,2);{var j=pe=>{var se=Ms(),z=a(l(se),2);Et(z),s(se),Ce(z,()=>e(S).notes,he=>(e(S).notes=he,$t(()=>(e(g),t(),c())))),v(pe,se)};D(_e,pe=>{e(S),i(()=>!e(S).spellRef)&&pe(j)})}var fe=a(_e,2),ue=l(fe);{var Ae=pe=>{var se=Es();A("click",se,()=>de(e(S))),v(pe,se)};D(ue,pe=>{e(S),i(()=>e(S).bonus!==0||!e(S).spellRef)&&pe(Ae)})}var He=a(ue,2);s(fe),s(Re),Ce(Se,()=>e(S).name,pe=>(e(S).name=pe,$t(()=>(e(g),t(),c())))),Ce(h,()=>e(S).bonus,pe=>(e(S).bonus=pe,$t(()=>(e(g),t(),c())))),Ce(Z,()=>e(S).damage,pe=>(e(S).damage=pe,$t(()=>(e(g),t(),c())))),Ce(xe,()=>e(S).damageType,pe=>(e(S).damageType=pe,$t(()=>(e(g),t(),c())))),A("click",He,()=>re(e(S))),v(J,Re)});var Me=a(O,2);{var De=J=>{var S=Bs();v(J,S)},Fe=J=>{var S=at(),ge=Pe(S);{var Re=$e=>{var Se=Us();v($e,Se)};D(ge,$e=>{e(g),i(()=>e(g).length===0)&&$e(Re)},!0)}v(J,S)};D(Me,J=>{t(),i(()=>t().attacks.length===0)?J(De):J(Fe,!1)})}s(b),A("click",d,X),v(f,C)};D(Ie,f=>{x(),i(()=>!x().attacks)&&f(L)})}s(V),E(()=>{U=rt(V,1,"attacks svelte-14o91c5",null,U,{hidden:!e(G)}),Ze(le,"aria-label",(x(),i(()=>x().attacks?"Expand":"Collapse"))),y(ie,(x(),i(()=>x().attacks?"â–¼":"â–²")))}),A("click",le,me),v(r,V),_t(),N()}var Gs=_('<p class="no-features svelte-1kpvv0n">Select a class to see available features</p>'),Os=_('<p class="no-features svelte-1kpvv0n">No class features available at this level</p>'),qs=_('<input type="checkbox" class="slot-checkbox svelte-1kpvv0n"/>'),zs=_('<div class="spell-slots svelte-1kpvv0n"><label class="svelte-1kpvv0n"> </label> <div class="slots-tracker svelte-1kpvv0n"></div></div>'),Ws=_('<div class="all-spell-slots"></div>'),Vs=_('<div class="feature-box spellcasting svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"> </h3> <div class="spell-stats svelte-1kpvv0n"><div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Spell Save DC</label> <div class="spell-value svelte-1kpvv0n"> </div></div> <div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <div class="spell-value svelte-1kpvv0n"> </div></div></div> <!> <div class="prepared-spells svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <textarea placeholder="List your prepared spells..." class="svelte-1kpvv0n"></textarea></div></div>'),Js=_('<p class="unlimited svelte-1kpvv0n">Unlimited Uses</p>'),Ks=_('<p class="no-uses svelte-1kpvv0n">No uses remaining</p>'),Qs=_('<div class="uses-with-button svelte-1kpvv0n"><button class="btn btn-primary use-enabled"> </button> <div class="uses-info svelte-1kpvv0n"><span class="uses-remaining svelte-1kpvv0n"> </span> <span class="reset-info svelte-1kpvv0n"> </span></div> <!></div>'),Xs=_('<div class="uses-tracker svelte-1kpvv0n"><!></div>'),Ys=_('<div class="pool-tracker svelte-1kpvv0n"><input type="number" min="0" class="pool-input svelte-1kpvv0n"/> <span> </span> <button class="btn-small svelte-1kpvv0n"> </button></div>'),Zs=_('<p class="no-uses svelte-1kpvv0n">No Channel Divinity uses remaining</p>'),el=_('<div class="channel-divinity-option svelte-1kpvv0n"><button class="btn btn-primary use-enabled svelte-1kpvv0n">Use Channel Divinity</button> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div> <!></div>'),tl=_('<div class="feature-box svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"><!> </h3> <p class="feature-description svelte-1kpvv0n"> </p> <!></div>'),al=_('<div class="features-grid svelte-1kpvv0n"><!> <!></div>'),sl=_('<section><div class="header svelte-1kpvv0n"><h2 class="svelte-1kpvv0n">Class Features</h2> <button class="collapse-btn svelte-1kpvv0n"> </button></div> <!></section>');function ll(r,u){mt(u,!1);const t=()=>Be(Q,"$character",w),c=()=>Be(zt,"$abilityModifiers",w),x=()=>Be(St,"$searchFilter",w),k=()=>Be(ct,"$collapsedStates",w),[w,N]=kt(),g=M(),G=M(),ee=M(),X=M(),W=M(),de=M(),re=M();let me=M(0),ne=M(0);function T(d,b){Q.update(O=>(O.classFeatures.features[d]=b,O))}function te(){Q.update(d=>(d.classFeatures.spellSlotsByLevel||(d.classFeatures.spellSlotsByLevel={}),e(X).forEach(({level:b,slots:O})=>{d.classFeatures.spellSlotsByLevel[b]||(d.classFeatures.spellSlotsByLevel[b]=Array(O).fill(!1))}),d))}function oe(d){if(typeof d.maxUses=="function"){if((d.name==="Divine Sense"||d.name==="War Priest")&&e(g)?.spellcastingAbility){const b=c()[e(g).spellcastingAbility];return d.maxUses(t().level,b)}return d.maxUses(t().level)}return d.maxUses||0}function ae(d){return typeof d.maxPool=="function"?d.maxPool(t().level):d.maxPool||0}function ce(d){return typeof d.description=="function"?d.description(t().level):d.description}function V(){const d="ChannelDivinity";Q.update(b=>{const O=b.classFeatures.features[d];return typeof O=="number"&&O>0&&(b.classFeatures.features[d]=O-1),b})}function U(){ct.update(d=>({...d,classFeatures:!d.classFeatures}))}Oe(()=>(t(),gt),()=>{o(g,t().class?gt(t().class):null)}),Oe(()=>(t(),Bt),()=>{o(G,t().class?Bt(t().class,t().level,t().subclass):[])}),Oe(()=>(t(),da),()=>{o(ee,t().class?da(t().class,t().level):0)}),Oe(()=>(e(g),t()),()=>{o(X,(()=>{if(!e(g)?.spellcaster)return[];const d=t().level,b=[];return d>=1&&b.push({level:1,slots:Math.min(4,2+Math.floor(d/3))}),d>=3&&b.push({level:2,slots:Math.min(3,2+Math.floor((d-3)/4))}),d>=5&&b.push({level:3,slots:Math.min(3,2+Math.floor((d-5)/5))}),d>=7&&b.push({level:4,slots:Math.min(3,1+Math.floor((d-7)/6))}),d>=9&&b.push({level:5,slots:Math.min(2,1+Math.floor((d-9)/8))}),d>=11&&b.push({level:6,slots:1}),d>=13&&b.push({level:7,slots:1}),d>=15&&b.push({level:8,slots:1}),d>=17&&b.push({level:9,slots:1}),b})())}),Oe(()=>(e(g),c(),t(),ua),()=>{if(e(g)?.spellcaster&&e(g).spellcastingAbility){const d=c()[e(g).spellcastingAbility];o(me,Za(t().class,d,t().proficiencyBonus)||0),o(ne,ua(t().class,t().level,d))}}),Oe(()=>(t(),e(g),e(X)),()=>{t().class&&e(g)?.spellcaster&&e(X).length>0&&te()}),Oe(()=>t(),()=>{o(W,(()=>{const b=t().classFeatures.features["ChannelDivinity"];return typeof b=="number"?b:0})())}),Oe(()=>(e(G),x()),()=>{o(de,e(G).filter(d=>{if(!x())return!0;const b=x().toLowerCase();return d.name.toLowerCase().includes(b)||ce(d).toLowerCase().includes(b)}))}),Oe(()=>(x(),t(),e(de)),()=>{o(re,!x()||t().class||"class features".includes(x().toLowerCase())||"spellcasting".includes(x().toLowerCase())||e(de).length>0)}),xt(),ht();var Y=sl();let le;var ie=l(Y),Ie=a(l(ie),2),L=l(Ie,!0);s(Ie),s(ie);var f=a(ie,2);{var C=d=>{var b=at(),O=Pe(b);{var Me=Fe=>{var J=Gs();v(Fe,J)},De=Fe=>{var J=at(),S=Pe(J);{var ge=$e=>{var Se=Os();v($e,Se)},Re=$e=>{var Se=al(),Ne=l(Se);{var Ve=ze=>{var h=Vs(),q=l(h),Z=l(q);s(q);var P=a(q,2),xe=l(P),ye=a(l(xe),2),we=l(ye,!0);s(ye),s(xe);var _e=a(xe,2),j=a(l(_e),2),fe=l(j,!0);s(j),s(_e),s(P);var ue=a(P,2);{var Ae=se=>{var z=Ws();it(z,5,()=>e(X),ot,(he,Ee)=>{let be=()=>e(Ee).level,$=()=>e(Ee).slots;const p=Xe(()=>(t(),be(),$(),i(()=>t().classFeatures.spellSlotsByLevel?.[be()]||Array($()).fill(!1))));var R=zs(),K=l(R),n=l(K);s(K);var m=a(K,2);it(m,5,()=>($(),i(()=>Array($()))),ot,(F,I,H)=>{var Le=qs();ke(Le),E(()=>za(Le,(B(e(p)),i(()=>e(p)[H]||!1)))),A("change",Le,je=>{Q.update(Te=>(Te.classFeatures.spellSlotsByLevel||(Te.classFeatures.spellSlotsByLevel={}),Te.classFeatures.spellSlotsByLevel[be()]||(Te.classFeatures.spellSlotsByLevel[be()]=Array($()).fill(!1)),Te.classFeatures.spellSlotsByLevel[be()][H]=je.currentTarget.checked,Te))}),v(F,Le)}),s(m),s(R),E(()=>y(n,`${be()===1?"1st":be()===2?"2nd":be()===3?"3rd":`${be()}th`} Level Spell Slots`)),v(he,R)}),s(z),v(se,z)};D(ue,se=>{e(X),i(()=>e(X).length>0)&&se(Ae)})}var He=a(ue,2),pe=a(l(He),2);Et(pe),s(He),s(h),E(se=>{y(Z,`Spellcasting (${se??""})`),y(we,e(me)),y(fe,e(ne))},[()=>(e(g),i(()=>e(g).spellcastingAbility?.toUpperCase()))]),Ce(pe,()=>t().classFeatures.preparedSpells,se=>Ke(Q,i(t).classFeatures.preparedSpells=se,i(t))),v(ze,h)};D(Ne,ze=>{e(g),i(()=>e(g)?.spellcaster)&&ze(Ve)})}var qe=a(Ne,2);it(qe,1,()=>e(de),ot,(ze,h)=>{const q=Xe(()=>(e(h),i(()=>e(h).name.replace(/\s+/g,"")))),Z=Xe(()=>(t(),B(e(q)),i(()=>t().classFeatures.features[e(q)]))),P=Xe(()=>(B(e(Z)),i(()=>Array.isArray(e(Z))))),xe=Xe(()=>typeof e(Z)=="number");var ye=tl(),we=l(ye),_e=l(we);{var j=z=>{var he=yt("Channel Divinity:");v(z,he)};D(_e,z=>{e(h),i(()=>e(h).type==="channelDivinity")&&z(j)})}var fe=a(_e);s(we);var ue=a(we,2),Ae=l(ue,!0);s(ue);var He=a(ue,2);{var pe=z=>{const he=Xe(()=>(e(h),i(()=>oe(e(h))))),Ee=Xe(()=>(B(e(P)),B(e(he)),B(e(Z)),i(()=>e(P)?e(Z).filter(n=>!n).length:e(he))));var be=Xs(),$=l(be);{var p=K=>{var n=Js();v(K,n)},R=K=>{var n=Qs(),m=l(n),F=l(m);s(m);var I=a(m,2),H=l(I),Le=l(H);s(H);var je=a(H,2),Te=l(je);s(je),s(I);var et=a(I,2);{var Je=We=>{var tt=Ks();v(We,tt)};D(et,We=>{e(Ee)<=0&&We(Je)})}s(n),E(()=>{m.disabled=e(Ee)<=0,y(F,`Use ${e(h),i(()=>e(h).name)??""}`),y(Le,`${e(Ee)??""} / ${e(he)??""} uses`),y(Te,`Resets on ${e(h),i(()=>e(h).resetOn==="short"?"Short Rest":"Long Rest")??""}`)}),A("click",m,()=>{Q.update(We=>{We.classFeatures.features[e(q)]||(We.classFeatures.features[e(q)]=Array(e(he)).fill(!1));const tt=We.classFeatures.features[e(q)],lt=tt.findIndex(Ue=>!Ue);return lt!==-1&&(tt[lt]=!0),We})}),v(K,n)};D($,K=>{e(he)===1/0?K(p):K(R,!1)})}s(be),v(z,be)},se=z=>{var he=at(),Ee=Pe(he);{var be=p=>{const R=Xe(()=>(e(h),i(()=>ae(e(h)))));var K=Ys(),n=l(K);ke(n);var m=a(n,2),F=l(m);s(m);var I=a(m,2),H=l(I,!0);s(I),s(K),E(()=>{$a(n,e(xe)&&e(Z)!==void 0?e(Z):e(R)),Ze(n,"max",e(R)),y(F,`/ ${e(R)??""}`),y(H,(e(h),i(()=>e(h).resetOn==="short"?"Short Rest":"Long Rest")))}),A("input",n,Le=>{Q.update(je=>(je.classFeatures.features[e(q)]=parseInt(Le.currentTarget.value)||0,je))}),A("click",I,()=>T(e(q),e(R))),v(p,K)},$=p=>{var R=at(),K=Pe(R);{var n=m=>{var F=el(),I=l(F),H=a(I,2),Le=l(H),je=l(Le);s(Le),s(H);var Te=a(H,2);{var et=Je=>{var We=Zs();v(Je,We)};D(Te,Je=>{e(W)<=0&&Je(et)})}s(F),E(()=>{I.disabled=e(W)<=0,y(je,`Resets on ${e(h),i(()=>e(h).resetOn==="short"?"Short Rest":"Long Rest")??""}`)}),A("click",I,V),v(m,F)};D(K,m=>{e(h),i(()=>e(h).type==="channelDivinity")&&m(n)},!0)}v(p,R)};D(Ee,p=>{e(h),i(()=>e(h).type==="pool")?p(be):p($,!1)},!0)}v(z,he)};D(He,z=>{e(h),i(()=>e(h).type==="uses")?z(pe):z(se,!1)})}s(ye),E(z=>{y(fe,` ${e(h),i(()=>e(h).name)??""}`),y(Ae,z)},[()=>(e(h),i(()=>ce(e(h))))]),v(ze,ye)}),s(Se),v($e,Se)};D(S,$e=>{e(G),i(()=>e(G).length===0)?$e(ge):$e(Re,!1)},!0)}v(Fe,J)};D(O,Fe=>{t(),i(()=>!t().class)?Fe(Me):Fe(De,!1)})}v(d,b)};D(f,d=>{k(),i(()=>!k().classFeatures)&&d(C)})}s(Y),E(()=>{le=rt(Y,1,"class-features svelte-1kpvv0n",null,le,{hidden:!e(re)}),Ze(Ie,"aria-label",(k(),i(()=>k().classFeatures?"Expand":"Collapse"))),y(L,(k(),i(()=>k().classFeatures?"â–¼":"â–²")))}),A("click",Ie,U),v(r,Y),_t(),N()}var il=_('<textarea placeholder="Enter features, traits, and special abilities..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Equipment</h3> <textarea placeholder="List your equipment and inventory..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Notes</h3> <textarea placeholder="Additional notes..." class="svelte-wttn0l"></textarea>',1),rl=_('<section><div class="header svelte-wttn0l"><h2 class="svelte-wttn0l">Features & Traits</h2> <button class="collapse-btn svelte-wttn0l"> </button></div> <!></section>');function nl(r,u){mt(u,!1);const t=()=>Be(St,"$searchFilter",k),c=()=>Be(Q,"$character",k),x=()=>Be(ct,"$collapsedStates",k),[k,w]=kt(),N=M();function g(){ct.update(ne=>({...ne,notes:!ne.notes}))}Oe(()=>(t(),c()),()=>{o(N,!t()||"features".includes(t().toLowerCase())||"traits".includes(t().toLowerCase())||"equipment".includes(t().toLowerCase())||"notes".includes(t().toLowerCase())||c().features.toLowerCase().includes(t().toLowerCase())||c().equipment.toLowerCase().includes(t().toLowerCase())||c().notes.toLowerCase().includes(t().toLowerCase()))}),xt(),ht();var G=rl();let ee;var X=l(G),W=a(l(X),2),de=l(W,!0);s(W),s(X);var re=a(X,2);{var me=ne=>{var T=il(),te=Pe(T);Et(te);var oe=a(te,4);Et(oe);var ae=a(oe,4);Et(ae),Ce(te,()=>c().features,ce=>Ke(Q,i(c).features=ce,i(c))),Ce(oe,()=>c().equipment,ce=>Ke(Q,i(c).equipment=ce,i(c))),Ce(ae,()=>c().notes,ce=>Ke(Q,i(c).notes=ce,i(c))),v(ne,T)};D(re,ne=>{x(),i(()=>!x().notes)&&ne(me)})}s(G),E(()=>{ee=rt(G,1,"notes svelte-wttn0l",null,ee,{hidden:!e(N)}),Ze(W,"aria-label",(x(),i(()=>x().notes?"Expand":"Collapse"))),y(de,(x(),i(()=>x().notes?"â–¼":"â–²")))}),A("click",W,g),v(r,G),_t(),w()}var ol=_('<div class="color-picker-section svelte-1r90jgp"><h3 class="svelte-1r90jgp">Dice Colors</h3> <div class="color-inputs svelte-1r90jgp"><div class="color-input-group svelte-1r90jgp"><label for="dice-color" class="svelte-1r90jgp">Dice Color</label> <input type="color" id="dice-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="label-color" class="svelte-1r90jgp">Label Color</label> <input type="color" id="label-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="desk-color" class="svelte-1r90jgp">Background Color</label> <input type="color" id="desk-color" class="svelte-1r90jgp"/></div></div></div>'),cl=_('<div class="loading svelte-1r90jgp"><p class="svelte-1r90jgp">Loading 3D dice...</p></div>'),vl=_('<div class="custom-dice-selector svelte-1r90jgp"><h3 class="svelte-1r90jgp">Choose Dice to Roll</h3> <div class="dice-inputs svelte-1r90jgp"><div class="dice-input-group svelte-1r90jgp"><label for="d4" class="svelte-1r90jgp">d4</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d4" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d6" class="svelte-1r90jgp">d6</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d6" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d8" class="svelte-1r90jgp">d8</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d8" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d10" class="svelte-1r90jgp">d10</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d10" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d12" class="svelte-1r90jgp">d12</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d12" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d20" class="svelte-1r90jgp">d20</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d20" min="0" max="10"/></div></div> <div class="dice-controls svelte-1r90jgp"><button class="btn btn-primary use-enabled svelte-1r90jgp"> </button> <button class="btn btn-secondary use-enabled svelte-1r90jgp">Reset</button></div></div>'),dl=_('<span class="crit-badge svelte-1r90jgp">CRITICAL!</span>'),ul=_('<p class="svelte-1r90jgp"> </p>'),pl=_('<p class="modifier-text svelte-1r90jgp"> </p>'),fl=_('<button class="btn btn-follow-up svelte-1r90jgp"> </button>'),bl=_('<button class="btn btn-guided-strike svelte-1r90jgp">âš¡ Use Guided Strike (+10)</button>'),gl=_('<div class="follow-up-actions svelte-1r90jgp"><!> <!></div>'),hl=_('<div class="result-header svelte-1r90jgp"><h3 class="svelte-1r90jgp"> </h3> <!></div> <div class="result-total svelte-1r90jgp"> </div> <div class="result-details svelte-1r90jgp"><!> <!></div> <!>',1),ml=_('<div role="button" tabindex="-1"><div class="modal-content svelte-1r90jgp" role="dialog" tabindex="0"><div class="modal-header svelte-1r90jgp"><h2 class="svelte-1r90jgp">Dice Roller</h2> <div class="header-buttons svelte-1r90jgp"><button class="color-btn svelte-1r90jgp" title="Customize dice colors">ðŸŽ¨</button> <button class="close-btn svelte-1r90jgp">Ã—</button></div></div> <!> <!> <div class="dice-main-area svelte-1r90jgp"><div class="dice-container svelte-1r90jgp"></div> <!></div> <div><!></div></div></div>');function _l(r,u){mt(u,!1);const t=()=>Be(Q,"$character",c),[c,x]=kt(),k=M(),w=M(),N=M(),g=At();let G=Dt(u,"notation",12,""),ee=Dt(u,"visible",8,!1),X=Dt(u,"damageNotation",12,""),W=Dt(u,"attackName",12,""),de=null,re=M(void 0),me=M(!1),ne=M(""),T=M(null);function te(){return e(T)?.resultTotal??null}let oe=M(0),ae=M(0),ce=M(0),V=M(0),U=M(0),Y=M(0),le=M(0),ie=M([]),Ie=M(!1),L=M("other"),f=M(!1),C=M("#051e0a"),d=M("#ffffff"),b=M("#3a2004"),O=M(!1);function Me(p){return p.length===9&&p.startsWith("#")?p.substring(0,7):p}function De(p,R="ff"){return p.length===7&&p.startsWith("#")?p+R:p}function Fe(){if(window.DICE&&e(re))try{de&&e(re)&&Ga(re,e(re).innerHTML="");const p=e(re).clientWidth||500,R=e(re).clientHeight||300;de=new window.DICE.dice_box(e(re),{w:p,h:R}),o(me,!0)}catch(p){console.error("Error initializing dice box:",p)}}Ut(()=>{const p=n=>new Promise((m,F)=>{if(document.querySelector(`script[src="${n}"]`)){console.log(`Script already loaded: ${n}`),m(null);return}const H=document.createElement("script");H.src=n,H.onload=()=>{console.log(`Loaded: ${n}`),m(null)},H.onerror=()=>{console.error(`Failed to load: ${n}`),F(new Error(`Failed to load ${n}`))},document.head.appendChild(H)});setTimeout(()=>{p(`${Mt}/libs/three.min.js`).then(()=>p(`${Mt}/libs/cannon.min.js`)).then(()=>p(`${Mt}/libs/teal.js`)).then(()=>p(`${Mt}/dice.js`)).then(()=>{if(console.log("All scripts loaded, initializing dice box..."),console.log("DICE available:",!!window.DICE),console.log("Container available:",!!e(re)),window.DICE){const n=window.DICE.getColors();o(C,Me(n.dice_color)),o(d,Me(n.label_color)),o(b,Me(n.desk_color))}Fe()}).catch(n=>{console.error("Failed to load dice libraries:",n)})},100);const R=()=>{e(me)&&(console.log("Window resized, reinitializing dice box..."),Fe())},K=n=>{ee()&&n.key==="Escape"&&qe()};return window.addEventListener("resize",R),window.addEventListener("keydown",K),()=>{window.removeEventListener("resize",R),window.removeEventListener("keydown",K)}});function J(p,R="other"){if(!de||!e(me))return;console.log("Rolling dice:",p,"type:",R),o(L,R),o(f,!1),de.diceToRoll=p;const K=m=>(console.log("Before roll:",m),null),n=m=>{if(console.log("After roll:",m),console.log("Result:",m.resultTotal),o(T,m),R==="attack"||R==="check"||R==="save"){const F=m.results?.filter(I=>I.sides===20)||[];if(F.length>0){const I=F[0].value;o(Ie,I===20)}}if(o(ie,[]),R==="attack"&&X())if(e(Ie)){const F=Re(X());e(ie).push({label:`Roll Critical Damage (${F})`,notation:F})}else e(ie).push({label:`Roll Damage (${X()})`,notation:X()})};de.start_throw(K,n)}function S(){const p=[];e(oe)>0&&p.push(`${e(oe)}d4`),e(ae)>0&&p.push(`${e(ae)}d6`),e(ce)>0&&p.push(`${e(ce)}d8`),e(V)>0&&p.push(`${e(V)}d10`),e(U)>0&&p.push(`${e(U)}d12`),e(Y)>0&&p.push(`${e(Y)}d20`);let R=p.join("+")||"1d20";return e(le)!==0&&(R+=e(le)>=0?`+${e(le)}`:`${e(le)}`),R}function ge(){const p=S();J(p)}function Re(p){return p.replace(/(\d+)d(\d+)/g,(R,K,n)=>`${parseInt(K)*2}d${n}`)}function $e(){o(oe,0),o(ae,0),o(ce,0),o(V,0),o(U,0),o(Y,0),o(le,0),o(T,null),o(ie,[]),o(Ie,!1),o(L,"other"),o(f,!1)}function Se(){window.DICE&&(window.DICE.setColors({dice_color:De(e(C),"ff"),label_color:De(e(d),"ff"),desk_color:e(b)}),de&&(de.updateDeskColor(e(b)),de.updateDiceColors()))}function Ne(){o(O,!e(O))}function Ve(){!e(T)||e(w)<=0||e(f)||(o(T,{...e(T),resultTotal:e(T).resultTotal+10,resultString:e(T).resultString+" + 10 (Guided Strike)"}),Q.update(p=>{const R="ChannelDivinity",K=p.classFeatures.features[R];return typeof K=="number"&&K>0&&(p.classFeatures.features[R]=K-1),p}),o(f,!0))}function qe(){g("close"),G(""),X(""),W(""),o(ne,""),o(T,null),o(f,!1),$e()}Oe(()=>(t(),Bt),()=>{o(k,t().class?Bt(t().class,t().level,t().subclass).some(R=>R.name==="Guided Strike"):!1)}),Oe(()=>t(),()=>{o(w,(()=>{const R=t().classFeatures.features["ChannelDivinity"];return typeof R=="number"?R:0})())}),Oe(()=>(e(oe),e(ae),e(ce),e(V),e(U),e(Y),e(le)),()=>{o(N,(()=>{const p=[];e(oe)>0&&p.push(`${e(oe)}d4`),e(ae)>0&&p.push(`${e(ae)}d6`),e(ce)>0&&p.push(`${e(ce)}d8`),e(V)>0&&p.push(`${e(V)}d10`),e(U)>0&&p.push(`${e(U)}d12`),e(Y)>0&&p.push(`${e(Y)}d20`);let R=p.join("+")||"1d20";return e(le)!==0&&(R+=e(le)>=0?`+${e(le)}`:`${e(le)}`),R})())}),Oe(()=>(B(G()),e(me),B(ee()),e(ne),B(X()),B(W())),()=>{if(G()&&e(me)&&ee()&&G()!==e(ne)){o(ne,G()),o(T,null),o(ie,[]),o(Ie,!1),o(f,!1);const p=G().includes("1d20")?"attack":"other";console.log("Auto-roll triggered. notation:",G(),"damageNotation:",X(),"attackName:",W()),setTimeout(()=>J(G(),p),200)}}),xt();var ze={getLastRollTotal:te};ht();var h=ml();let q;var Z=l(h),P=l(Z),xe=a(l(P),2),ye=l(xe),we=a(ye,2);s(xe),s(P);var _e=a(P,2);{var j=p=>{var R=ol(),K=a(l(R),2),n=l(K),m=a(l(n),2);ke(m),s(n);var F=a(n,2),I=a(l(F),2);ke(I),s(F);var H=a(F,2),Le=a(l(H),2);ke(Le),s(H),s(K),s(R),Ce(m,()=>e(C),je=>o(C,je)),A("change",m,Se),Ce(I,()=>e(d),je=>o(d,je)),A("change",I,Se),Ce(Le,()=>e(b),je=>o(b,je)),A("change",Le,Se),v(p,R)};D(_e,p=>{e(O)&&p(j)})}var fe=a(_e,2);{var ue=p=>{var R=cl();v(p,R)};D(fe,p=>{e(me)||p(ue)})}var Ae=a(fe,2),He=l(Ae);aa(He,p=>o(re,p),()=>e(re));var pe=a(He,2);{var se=p=>{var R=vl(),K=a(l(R),2),n=l(K),m=a(l(n),2);ke(m),s(n);var F=a(n,2),I=a(l(F),2);ke(I),s(F);var H=a(F,2),Le=a(l(H),2);ke(Le),s(H);var je=a(H,2),Te=a(l(je),2);ke(Te),s(je);var et=a(je,2),Je=a(l(et),2);ke(Je),s(et);var We=a(et,2),tt=a(l(We),2);ke(tt),s(We),s(K);var lt=a(K,2),Ue=l(lt),Ye=l(Ue);s(Ue);var nt=a(Ue,2);s(lt),s(R),E(()=>{Ue.disabled=!e(me),y(Ye,`Roll ${e(N)??""}`)}),Ce(m,()=>e(oe),ve=>o(oe,ve)),Ce(I,()=>e(ae),ve=>o(ae,ve)),Ce(Le,()=>e(ce),ve=>o(ce,ve)),Ce(Te,()=>e(V),ve=>o(V,ve)),Ce(Je,()=>e(U),ve=>o(U,ve)),Ce(tt,()=>e(Y),ve=>o(Y,ve)),A("click",Ue,ge),A("click",nt,$e),v(p,R)};D(pe,p=>{G()||p(se)})}s(Ae);var z=a(Ae,2);let he;var Ee=l(z);{var be=p=>{var R=hl(),K=Pe(R),n=l(K),m=l(n,!0);s(n);var F=a(n,2);{var I=Ue=>{var Ye=dl();v(Ue,Ye)};D(F,Ue=>{e(Ie)&&Ue(I)})}s(K);var H=a(K,2),Le=l(H,!0);s(H);var je=a(H,2),Te=l(je);{var et=Ue=>{var Ye=ul(),nt=l(Ye,!0);s(Ye),E(()=>y(nt,(e(T),i(()=>e(T).resultString)))),v(Ue,Ye)};D(Te,Ue=>{e(T),i(()=>e(T).resultString)&&Ue(et)})}var Je=a(Te,2);{var We=Ue=>{var Ye=pl(),nt=l(Ye);s(Ye),E(()=>y(nt,`Modifier: ${e(T),i(()=>e(T).constant>=0?"+":"")??""}${e(T),i(()=>e(T).constant)??""}`)),v(Ue,Ye)};D(Je,Ue=>{e(T),i(()=>e(T).constant)&&Ue(We)})}s(je);var tt=a(je,2);{var lt=Ue=>{var Ye=gl(),nt=l(Ye);it(nt,1,()=>e(ie),ot,(dt,vt)=>{var jt=fl(),Vt=l(jt,!0);s(jt),E(()=>y(Vt,(e(vt),i(()=>e(vt).label)))),A("click",jt,()=>J(e(vt).notation,"damage")),v(dt,jt)});var ve=a(nt,2);{var Ge=dt=>{var vt=bl();E(()=>{vt.disabled=e(w)<=0,Ze(vt,"title",e(w)<=0?"No Channel Divinity uses remaining":"Use Channel Divinity to add +10 to this attack roll")}),A("click",vt,Ve),v(dt,vt)};D(ve,dt=>{e(k)&&e(L)==="attack"&&!e(f)&&dt(Ge)})}s(Ye),v(Ue,Ye)};D(tt,Ue=>{e(ie),e(k),e(L),e(f),i(()=>e(ie).length>0||e(k)&&e(L)==="attack"&&!e(f))&&Ue(lt)})}E(()=>{y(m,W()?`${W()} - Result`:"Result"),y(Le,(e(T),i(()=>e(T).resultTotal)))}),v(p,R)};D(Ee,p=>{e(T)&&p(be)})}s(z),s(Z),s(h),E(()=>{q=rt(h,1,"modal-overlay svelte-1r90jgp",null,q,{hidden:!ee()}),he=rt(z,1,"roll-result svelte-1r90jgp",null,he,{"has-result":e(T)})}),A("click",ye,Ne),A("click",we,qe),A("click",Z,na(function(p){Ft.call(this,u,p)})),A("keydown",Z,function(p){Ft.call(this,u,p)}),A("click",h,qe),A("keydown",h,p=>p.key==="Escape"&&qe()),v(r,h),Xa(u,"getLastRollTotal",te);var $=_t(ze);return x(),$}const Wt="https://api.github.com/gists";async function yl(r,u,t){if(!u)throw new Error("GitHub token is required");const c=JSON.stringify(r,null,2),x=`${r.name||"character"}_dnd.json`,k={description:t||`D&D Character: ${r.name}`,public:!1,files:{[x]:{content:c}}},w=await fetch(Wt,{method:"POST",headers:{Authorization:`token ${u}`,"Content-Type":"application/json"},body:JSON.stringify(k)});if(!w.ok)throw new Error(`Failed to create gist: ${w.statusText}`);return(await w.json()).id}async function kl(r,u,t){if(!u||!t)throw new Error("GitHub token and Gist ID are required");const c=JSON.stringify(r,null,2),k={files:{[`${r.name||"character"}_dnd.json`]:{content:c}}},w=await fetch(`${Wt}/${t}`,{method:"PATCH",headers:{Authorization:`token ${u}`,"Content-Type":"application/json"},body:JSON.stringify(k)});if(!w.ok)throw new Error(`Failed to update gist: ${w.statusText}`)}async function $l(r,u){if(!r)throw new Error("Gist ID is required");const t={"Content-Type":"application/json"};u&&(t.Authorization=`token ${u}`);const c=await fetch(`${Wt}/${r}`,{method:"GET",headers:t});if(!c.ok)throw new Error(`Failed to load gist: ${c.statusText}`);const x=await c.json(),k=Object.values(x.files);if(k.length===0)throw new Error("No files found in gist");const N=k[0].content;try{const g=JSON.parse(N);return g.attacks&&Array.isArray(g.attacks)&&(g.attacks=g.attacks.map(G=>({...G,id:G.id||crypto.randomUUID()}))),g.classFeatures?(g.classFeatures.features||(g.classFeatures.features={}),g.classFeatures.spellSlots||(g.classFeatures.spellSlots=[]),g.classFeatures.preparedSpells===void 0&&(g.classFeatures.preparedSpells="")):g.classFeatures={features:{},spellSlots:[],preparedSpells:""},g}catch{throw new Error("Invalid character data in gist")}}function fa(r){typeof window<"u"&&localStorage.setItem("dnd_gist_config",JSON.stringify(r))}function xl(){if(typeof window<"u"){const r=localStorage.getItem("dnd_gist_config");if(r)return JSON.parse(r)}return{}}async function Cl(r,u=30){if(!r)throw new Error("GitHub token is required to list gists");const t=await fetch(`${Wt}?per_page=${u}`,{method:"GET",headers:{Authorization:`token ${r}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error(`Failed to list gists: ${t.statusText}`);return await t.json()}var Sl=_('<div class="error-message svelte-1jb5ckg"> </div>'),Ll=_('<div class="toggle-container svelte-1jb5ckg"><button type="button" class="toggle-btn svelte-1jb5ckg"> </button></div>'),jl=_('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID (leave empty to create new)</label> <input type="text" id="gistId" placeholder="Optional: existing Gist ID to update" class="svelte-1jb5ckg"/></div>'),wl=_('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),Dl=_('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),Fl=_('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Update (or leave unselected to create new)</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),Al=_('<div class="info-message svelte-1jb5ckg">No gists found. A new one will be created.</div>'),Rl=_('<!> <div class="form-group svelte-1jb5ckg"><label for="description" class="svelte-1jb5ckg"> </label> <input type="text" id="description" placeholder="D&amp;D Character Sheet" class="svelte-1jb5ckg"/></div>',1),Il=_('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID *</label> <input type="text" id="gistId" placeholder="Enter Gist ID (for public or your private gists)" required class="svelte-1jb5ckg"/></div>'),Ml=_('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),El=_('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),Pl=_('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Load</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),Bl=_('<div class="info-message svelte-1jb5ckg">No gists found. Enter a Gist ID manually or create a new one in Save mode.</div>'),Ul=_('<div class="modal-overlay svelte-1jb5ckg" role="button" tabindex="-1"><div class="modal-content svelte-1jb5ckg" role="dialog" tabindex="0"><div class="modal-header svelte-1jb5ckg"><h2 class="svelte-1jb5ckg"> </h2> <button class="close-btn svelte-1jb5ckg">Ã—</button></div> <div class="modal-body svelte-1jb5ckg"><!> <div class="form-group svelte-1jb5ckg"><label for="token" class="svelte-1jb5ckg"> <a href="https://github.com/settings/tokens" target="_blank" rel="noopener" class="svelte-1jb5ckg">Get token</a></label> <input type="password" id="token" placeholder="ghp_xxxxxxxxxxxxx" class="svelte-1jb5ckg"/></div> <!> <!> <div class="modal-actions svelte-1jb5ckg"><button class="btn btn-primary svelte-1jb5ckg"><!></button> <button class="btn btn-secondary svelte-1jb5ckg">Cancel</button></div></div></div></div>');function Nl(r,u){mt(u,!1);const t=()=>Be(Q,"$character",c),[c,x]=kt(),k=At();let w=Dt(u,"mode",8,"save"),N=M(""),g=M(""),G=M(""),ee=M(!1),X=M(""),W=M(!1),de=M(!1),re=M([]),me=M(null);const ne=xl();ne.token&&o(N,ne.token),ne.gistId&&o(g,ne.gistId),Ut(async()=>{e(N)&&!e(W)&&await T()});async function T(){if(e(N)){o(de,!0),o(X,"");try{o(re,await Cl(e(N))),e(g)&&o(me,e(re).find(h=>h.id===e(g))||null)}catch(h){o(X,h.message||"Failed to load gists"),o(re,[])}finally{o(de,!1)}}}function te(h){o(me,h),o(g,h.id)}function oe(){o(W,!e(W)),o(X,""),!e(W)&&e(N)&&T()}async function ae(){if(!e(N)){o(X,"GitHub token is required");return}const h=e(me)?.id||e(g);o(ee,!0),o(X,"");try{if(h)await kl(t(),e(N),h),o(g,h),Yt.add("Character updated in Gist successfully!","success");else{const q=await yl(t(),e(N),e(G));o(g,q),Yt.add(`Character saved to Gist! ID: ${q}`,"success")}fa({token:e(N),gistId:e(g)}),k("close")}catch(q){o(X,q.message||"Failed to save to Gist")}finally{o(ee,!1)}}async function ce(){const h=e(me)?.id||e(g);if(!h){o(X,"Please select a gist or enter a Gist ID");return}o(ee,!0),o(X,"");try{const q=await $l(h,e(N)||void 0);Q.set(q),o(g,h),fa({token:e(N),gistId:e(g)}),Yt.add("Character loaded from Gist successfully!","success"),k("close")}catch(q){o(X,q.message||"Failed to load from Gist")}finally{o(ee,!1)}}function V(){k("close")}ht();var U=Ul(),Y=l(U),le=l(Y),ie=l(le),Ie=l(ie,!0);s(ie);var L=a(ie,2);s(le);var f=a(le,2),C=l(f);{var d=h=>{var q=Sl(),Z=l(q,!0);s(q),E(()=>y(Z,e(X))),v(h,q)};D(C,h=>{e(X)&&h(d)})}var b=a(C,2),O=l(b),Me=l(O);ka(),s(O);var De=a(O,2);ke(De),s(b);var Fe=a(b,2);{var J=h=>{var q=Ll(),Z=l(q),P=l(Z,!0);s(Z),s(q),E(()=>{Z.disabled=e(ee),y(P,e(W)?"ðŸ“‹ Show My Gists":"âœï¸ Enter Gist ID Manually")}),A("click",Z,oe),v(h,q)};D(Fe,h=>{(w()==="load"||w()==="save"&&e(N))&&h(J)})}var S=a(Fe,2);{var ge=h=>{var q=Rl(),Z=Pe(q);{var P=fe=>{var ue=jl(),Ae=a(l(ue),2);ke(Ae),s(ue),E(()=>Ae.disabled=e(ee)),Ce(Ae,()=>e(g),He=>o(g,He)),v(fe,ue)},xe=fe=>{var ue=at(),Ae=Pe(ue);{var He=se=>{var z=wl();v(se,z)},pe=se=>{var z=at(),he=Pe(z);{var Ee=$=>{var p=Fl(),R=a(l(p),2);it(R,5,()=>e(re),ot,(K,n)=>{var m=Dl();let F;var I=l(m),H=l(I),Le=l(H,!0);s(H);var je=a(H,2),Te=l(je,!0);s(je),s(I);var et=a(I,2),Je=l(et),We=l(Je);s(Je);var tt=a(Je,2),lt=l(tt);s(tt),s(et),s(m),E(Ue=>{F=rt(m,1,"gist-item svelte-1jb5ckg",null,F,{selected:e(me)?.id===e(n).id}),m.disabled=e(ee),y(Le,(e(n),i(()=>e(n).description||"Untitled"))),y(Te,(e(n),i(()=>e(n).public?"ðŸŒ Public":"ðŸ”’ Private"))),y(We,`ID: ${e(n),i(()=>e(n).id)??""}`),y(lt,`Updated: ${Ue??""}`)},[()=>(e(n),i(()=>new Date(e(n).updated_at).toLocaleDateString()))]),A("click",m,()=>te(e(n))),v(K,m)}),s(R),s(p),v($,p)},be=$=>{var p=at(),R=Pe(p);{var K=n=>{var m=Al();v(n,m)};D(R,n=>{e(N)&&n(K)},!0)}v($,p)};D(he,$=>{e(re),i(()=>e(re).length>0)?$(Ee):$(be,!1)},!0)}v(se,z)};D(Ae,se=>{e(de)?se(He):se(pe,!1)},!0)}v(fe,ue)};D(Z,fe=>{e(W)||!e(N)?fe(P):fe(xe,!1)})}var ye=a(Z,2),we=l(ye),_e=l(we);s(we);var j=a(we,2);ke(j),s(ye),E(()=>{y(_e,`Description ${e(g)?"(optional)":""}`),j.disabled=e(ee)}),Ce(j,()=>e(G),fe=>o(G,fe)),v(h,q)},Re=h=>{var q=at(),Z=Pe(q);{var P=ye=>{var we=Il(),_e=a(l(we),2);ke(_e),s(we),E(()=>_e.disabled=e(ee)),Ce(_e,()=>e(g),j=>o(g,j)),v(ye,we)},xe=ye=>{var we=at(),_e=Pe(we);{var j=ue=>{var Ae=Ml();v(ue,Ae)},fe=ue=>{var Ae=at(),He=Pe(Ae);{var pe=z=>{var he=Pl(),Ee=a(l(he),2);it(Ee,5,()=>e(re),ot,(be,$)=>{var p=El();let R;var K=l(p),n=l(K),m=l(n,!0);s(n);var F=a(n,2),I=l(F,!0);s(F),s(K);var H=a(K,2),Le=l(H),je=l(Le);s(Le);var Te=a(Le,2),et=l(Te);s(Te),s(H),s(p),E(Je=>{R=rt(p,1,"gist-item svelte-1jb5ckg",null,R,{selected:e(me)?.id===e($).id}),p.disabled=e(ee),y(m,(e($),i(()=>e($).description||"Untitled"))),y(I,(e($),i(()=>e($).public?"ðŸŒ Public":"ðŸ”’ Private"))),y(je,`ID: ${e($),i(()=>e($).id)??""}`),y(et,`Updated: ${Je??""}`)},[()=>(e($),i(()=>new Date(e($).updated_at).toLocaleDateString()))]),A("click",p,()=>te(e($))),v(be,p)}),s(Ee),s(he),v(z,he)},se=z=>{var he=at(),Ee=Pe(he);{var be=$=>{var p=Bl();v($,p)};D(Ee,$=>{e(N)&&$(be)},!0)}v(z,he)};D(He,z=>{e(re),i(()=>e(re).length>0)?z(pe):z(se,!1)},!0)}v(ue,Ae)};D(_e,ue=>{e(de)?ue(j):ue(fe,!1)},!0)}v(ye,we)};D(Z,ye=>{e(W)||!e(N)?ye(P):ye(xe,!1)})}v(h,q)};D(S,h=>{w()==="save"?h(ge):h(Re,!1)})}var $e=a(S,2),Se=l($e),Ne=l(Se);{var Ve=h=>{var q=yt();E(()=>y(q,w()==="save"?"Saving...":"Loading...")),v(h,q)},qe=h=>{var q=yt();E(()=>y(q,w()==="save"?"Save":"Load")),v(h,q)};D(Ne,h=>{e(ee)?h(Ve):h(qe,!1)})}s(Se);var ze=a(Se,2);s($e),s(f),s(Y),s(U),E(()=>{y(Ie,w()==="save"?"Save to GitHub Gist":"Load from GitHub Gist"),y(Me,`GitHub Token ${w()==="load"?"(optional for public gists)":"(required)"} `),De.disabled=e(ee),Se.disabled=e(ee),ze.disabled=e(ee)}),A("click",L,V),Ce(De,()=>e(N),h=>o(N,h)),A("blur",De,()=>{e(N)&&!e(W)&&T()}),A("click",Se,function(...h){(w()==="save"?ae:ce)?.apply(this,h)}),A("click",ze,V),A("click",Y,na(function(h){Ft.call(this,u,h)})),A("keydown",Y,function(h){Ft.call(this,u,h)}),A("click",U,V),A("keydown",U,h=>h.key==="Escape"&&V()),v(r,U),_t(),x()}var Tl=_('<div class="loading svelte-1ngjemu">Loading D&D data...</div>'),Hl=_("<option> </option>"),Gl=_('<select class="level-filter svelte-1ngjemu"><option>All Levels</option><option>Cantrip</option><!></select>'),Ol=_('<div class="no-results svelte-1ngjemu"> </div>'),ql=_('<div class="item-meta svelte-1ngjemu"> </div>'),zl=_('<div class="item-meta svelte-1ngjemu"> </div>'),Wl=_('<button><div class="item-name svelte-1ngjemu"> </div> <!></button>'),Vl=_('<p class="higher-levels"><strong>At Higher Levels:</strong> </p>'),Jl=_('<p class="cantrip-upgrade"><strong>Cantrip Upgrade:</strong> </p>'),Kl=_('<h3 class="svelte-1ngjemu"> </h3> <p class="spell-meta svelte-1ngjemu"><!> <!></p> <p class="spell-classes"><strong>Classes:</strong> </p> <div class="spell-stats svelte-1ngjemu"><div><strong>Casting Time:</strong> </div> <div><strong>Range:</strong> </div> <div><strong>Components:</strong> <!></div> <div><strong>Duration:</strong> <!> </div></div> <p class="description svelte-1ngjemu"> </p> <!> <!>',1),Ql=_('<p class="prerequisite svelte-1ngjemu"><strong>Prerequisite:</strong> </p>'),Xl=_('<h3 class="svelte-1ngjemu"> </h3> <!> <p class="description svelte-1ngjemu"> </p> <a target="_blank" rel="noopener" class="source-link svelte-1ngjemu">View Full Details â†’</a>',1),Yl=_('<div class="item-details svelte-1ngjemu"><!></div>'),Zl=_('<div class="controls svelte-1ngjemu"><div class="tabs svelte-1ngjemu"><button> </button> <button> </button></div> <div class="search-controls svelte-1ngjemu"><input type="text" placeholder="Search by name or description..." class="search-input svelte-1ngjemu"/> <!></div></div> <div class="content-container svelte-1ngjemu"><div class="items-list svelte-1ngjemu"><!></div> <!></div>',1),ei=_('<div class="modal-backdrop svelte-1ngjemu" role="presentation"><div class="modal svelte-1ngjemu" role="dialog" aria-modal="true" tabindex="-1"><div class="modal-header svelte-1ngjemu"><h2 class="svelte-1ngjemu">Browse D&D Spells & Feats</h2> <button class="close-btn svelte-1ngjemu" aria-label="Close">&times;</button></div> <div class="modal-body svelte-1ngjemu"><!></div> <div class="modal-footer svelte-1ngjemu"><button class="btn-secondary svelte-1ngjemu">Cancel</button> <button class="btn-primary svelte-1ngjemu">Add to Character Sheet</button></div></div></div>');function ti(r,u){mt(u,!1);const t=M(),c=M(),x=M();let k=Dt(u,"onClose",8),w=M("spell"),N=M(!0),g=M(""),G=M(null),ee=M([]),X=M([]),W=M(null);Ut(async()=>{o(N,!0);try{o(ee,await Sa()),o(X,await _s())}catch(L){console.error("Failed to load data:",L)}finally{o(N,!1)}});function de(L){o(W,L)}function re(L){const f=L.match(/(\d+d\d+(?:\s*\+\s*\d+)?)/i);return f?f[1]:""}function me(L){const f=L.split(/\.( |$)/)[0].trim(),C=Array.from(L.matchAll(/\*\*(.*?)\*\*/g)).map(b=>b[1].replace(/\.$/,""));let d=f;return C.length&&(d+=" | Effects: "+C.join(", ")),d}function ne(){if(e(W)){if(e(w)==="spell"){const L=e(W);Q.update(f=>{const d=[];L.range&&d.push(`Range: ${L.range}`),L.castingTime&&d.push(`Cast: ${L.castingTime}`),L.duration&&d.push(`Duration: ${L.duration}`),L.actionType==="Save"&&d.push("Saving throw spell"),L.components&&L.components.length>0&&d.push(`Components: ${L.components.join(", ")}`),L.material&&d.push(`Material: ${L.material}`);const b=d.join(" | "),O=me(L.description),Me={id:crypto.randomUUID(),name:`${L.name}${L.concentration?" (C)":""}${L.ritual?" (R)":""}`,bonus:L.actionType==="Attack"?5:0,damage:re(L.description),damageType:`${L.school} (Lvl ${L.level})`,spellRef:L.name,infoNotes:b,generalNotes:O,castAtLevel:L.level};return f.attacks=[...f.attacks,Me],f})}else if(e(w)==="feat"){const L=e(W);Q.update(f=>{const C=`${L.name}${L.prerequisite?` (Req: ${L.prerequisite})`:""}
${L.description}
`;return f.features=f.features?`${f.features}
${C}`:C,f})}o(W,null),k()()}}Oe(()=>(e(G),e(ee),e(g)),()=>{o(t,e(G)!==null?ys(pa(e(ee),e(g)),e(G)):pa(e(ee),e(g)))}),Oe(()=>(e(X),e(g)),()=>{o(c,ks(e(X),e(g)))}),Oe(()=>(e(w),e(t),e(c)),()=>{o(x,e(w)==="spell"?e(t):e(c))}),xt(),ht();var T=ei(),te=l(T),oe=l(te),ae=a(l(oe),2);s(oe);var ce=a(oe,2),V=l(ce);{var U=L=>{var f=Tl();v(L,f)},Y=L=>{var f=Zl(),C=Pe(f),d=l(C),b=l(d);let O;var Me=l(b);s(b);var De=a(b,2);let Fe;var J=l(De);s(De),s(d);var S=a(d,2),ge=l(S);ke(ge);var Re=a(ge,2);{var $e=Z=>{var P=Gl();E(()=>{e(G),$t(()=>{})});var xe=l(P);xe.value=(xe.__value=null)??"";var ye=a(xe);ye.value=ye.__value=0;var we=a(ye);it(we,0,()=>[1,2,3,4,5,6,7,8,9],ot,(_e,j)=>{var fe=Hl(),ue=l(fe);s(fe);var Ae={};E(()=>{y(ue,`Level ${j??""}`),Ae!==(Ae=j)&&(fe.value=(fe.__value=j)??"")}),v(_e,fe)}),s(P),xa(P,()=>e(G),_e=>o(G,_e)),v(Z,P)};D(Re,Z=>{e(w)==="spell"&&Z($e)})}s(S),s(C);var Se=a(C,2),Ne=l(Se),Ve=l(Ne);{var qe=Z=>{var P=Ol(),xe=l(P);s(P),E(()=>y(xe,`No ${e(w)??""}s found`)),v(Z,P)},ze=Z=>{var P=at(),xe=Pe(P);it(xe,1,()=>e(x),ot,(ye,we)=>{var _e=Wl();let j;var fe=l(_e),ue=l(fe,!0);s(fe);var Ae=a(fe,2);{var He=se=>{const z=Xe(()=>e(we));var he=ql(),Ee=l(he);s(he),E(()=>y(Ee,`Level ${B(e(z)),i(()=>e(z).level)??""} â€¢ ${B(e(z)),i(()=>e(z).school)??""}`)),v(se,he)},pe=se=>{const z=Xe(()=>e(we));var he=at(),Ee=Pe(he);{var be=$=>{var p=zl(),R=l(p,!0);s(p),E(()=>y(R,(B(e(z)),i(()=>e(z).prerequisite)))),v($,p)};D(Ee,$=>{B(e(z)),i(()=>e(z).prerequisite)&&$(be)})}v(se,he)};D(Ae,se=>{e(w)==="spell"?se(He):se(pe,!1)})}s(_e),E(()=>{j=rt(_e,1,"item-card svelte-1ngjemu",null,j,{selected:e(W)?.name===e(we).name}),y(ue,(e(we),i(()=>e(we).name)))}),A("click",_e,()=>de(e(we))),v(ye,_e)}),v(Z,P)};D(Ve,Z=>{e(x),i(()=>e(x).length===0)?Z(qe):Z(ze,!1)})}s(Ne);var h=a(Ne,2);{var q=Z=>{var P=Yl(),xe=l(P);{var ye=_e=>{const j=Xe(()=>e(W));var fe=Kl(),ue=Pe(fe),Ae=l(ue,!0);s(ue);var He=a(ue,2),pe=l(He);{var se=ve=>{var Ge=yt();E(()=>y(Ge,`${B(e(j)),i(()=>e(j).school)??""} cantrip`)),v(ve,Ge)},z=ve=>{var Ge=yt();E(()=>y(Ge,`Level ${B(e(j)),i(()=>e(j).level)??""} ${B(e(j)),i(()=>e(j).school)??""}`)),v(ve,Ge)};D(pe,ve=>{B(e(j)),i(()=>e(j).level===0)?ve(se):ve(z,!1)})}var he=a(pe,2);{var Ee=ve=>{var Ge=yt("(ritual)");v(ve,Ge)};D(he,ve=>{B(e(j)),i(()=>e(j).ritual)&&ve(Ee)})}s(He);var be=a(He,2),$=a(l(be));s(be);var p=a(be,2),R=l(p),K=a(l(R));s(R);var n=a(R,2),m=a(l(n));s(n);var F=a(n,2),I=a(l(F)),H=a(I);{var Le=ve=>{var Ge=yt();E(()=>y(Ge,`(${B(e(j)),i(()=>e(j).material)??""})`)),v(ve,Ge)};D(H,ve=>{B(e(j)),i(()=>e(j).material)&&ve(Le)})}s(F);var je=a(F,2),Te=a(l(je),2);{var et=ve=>{var Ge=yt("Concentration,");v(ve,Ge)};D(Te,ve=>{B(e(j)),i(()=>e(j).concentration)&&ve(et)})}var Je=a(Te,1,!0);s(je),s(p);var We=a(p,2),tt=l(We,!0);s(We);var lt=a(We,2);{var Ue=ve=>{var Ge=Vl(),dt=a(l(Ge));s(Ge),E(()=>y(dt,` ${B(e(j)),i(()=>e(j).higherLevelSlot)??""}`)),v(ve,Ge)};D(lt,ve=>{B(e(j)),i(()=>e(j).higherLevelSlot)&&ve(Ue)})}var Ye=a(lt,2);{var nt=ve=>{var Ge=Jl(),dt=a(l(Ge));s(Ge),E(()=>y(dt,` ${B(e(j)),i(()=>e(j).cantripUpgrade)??""}`)),v(ve,Ge)};D(Ye,ve=>{B(e(j)),i(()=>e(j).cantripUpgrade)&&ve(nt)})}E((ve,Ge)=>{y(Ae,(B(e(j)),i(()=>e(j).name))),y($,` ${ve??""}`),y(K,` ${B(e(j)),i(()=>e(j).castingTime||e(j).actionType)??""}`),y(m,` ${B(e(j)),i(()=>e(j).range)??""}`),y(I,` ${Ge??""}`),y(Je,(B(e(j)),i(()=>e(j).duration))),y(tt,(B(e(j)),i(()=>e(j).description)))},[()=>(B(e(j)),i(()=>e(j).classes.join(", "))),()=>(B(e(j)),i(()=>e(j).components.join(", ").toUpperCase()))]),v(_e,fe)},we=_e=>{const j=Xe(()=>e(W));var fe=Xl(),ue=Pe(fe),Ae=l(ue,!0);s(ue);var He=a(ue,2);{var pe=Ee=>{var be=Ql(),$=a(l(be));s(be),E(()=>y($,` ${B(e(j)),i(()=>e(j).prerequisite)??""}`)),v(Ee,be)};D(He,Ee=>{B(e(j)),i(()=>e(j).prerequisite)&&Ee(pe)})}var se=a(He,2),z=l(se,!0);s(se);var he=a(se,2);E(()=>{y(Ae,(B(e(j)),i(()=>e(j).name))),y(z,(B(e(j)),i(()=>e(j).description))),Ze(he,"href",(B(e(j)),i(()=>e(j).source)))}),v(_e,fe)};D(xe,_e=>{e(w)==="spell"?_e(ye):_e(we,!1)})}s(P),v(Z,P)};D(h,Z=>{e(W)&&Z(q)})}s(Se),E(()=>{O=rt(b,1,"tab svelte-1ngjemu",null,O,{active:e(w)==="spell"}),y(Me,`ðŸ“œ Spells (${e(ee),i(()=>e(ee).length)??""})`),Fe=rt(De,1,"tab svelte-1ngjemu",null,Fe,{active:e(w)==="feat"}),y(J,`â­ Feats (${e(X),i(()=>e(X).length)??""})`)}),A("click",b,()=>{o(w,"spell"),o(W,null),o(g,"")}),A("click",De,()=>{o(w,"feat"),o(W,null),o(g,"")}),Ce(ge,()=>e(g),Z=>o(g,Z)),v(L,f)};D(V,L=>{e(N)?L(U):L(Y,!1)})}s(ce);var le=a(ce,2),ie=l(le),Ie=a(ie,2);s(le),s(te),s(T),E(()=>Ie.disabled=!e(W)),A("click",ae,function(...L){k()?.apply(this,L)}),A("click",ie,function(...L){k()?.apply(this,L)}),A("click",Ie,ne),A("click",te,na(function(L){Ft.call(this,u,L)})),A("keydown",te,function(L){Ft.call(this,u,L)}),A("click",T,function(...L){k()?.apply(this,L)}),A("keydown",T,L=>L.key==="Escape"&&k()()),v(r,T),_t()}var ai=_('<link rel="icon" type="image/png" href="/favicon.png"/> <meta name="viewport" content="width=device-width, initial-scale=1"/>',1),si=_('<span class="character-name svelte-1uha8ag"> </span>'),li=_("<span> </span>"),ii=_('<div class="spell-slots-header svelte-1uha8ag"></div>'),ri=_('<div class="rest-menu svelte-1uha8ag"><button class="rest-option svelte-1uha8ag">â˜• Short Rest</button> <button class="rest-option svelte-1uha8ag">ðŸ›ï¸ Long Rest</button></div>'),ni=_('<div class="container svelte-1uha8ag"><header class="svelte-1uha8ag"><div class="header-top svelte-1uha8ag"><div class="header-title svelte-1uha8ag"><h1 class="svelte-1uha8ag">D&D Character Sheet</h1> <!> <!> <input type="text" placeholder="ðŸ” Search (e.g., Religion, Strength, Attack...)" class="search-input use-enabled svelte-1uha8ag"/></div> <div class="header-controls svelte-1uha8ag"><button class="btn btn-secondary use-enabled">ðŸŽ² Roll Dice</button> <div class="rest-button-container svelte-1uha8ag"><button class="btn btn-secondary use-enabled">ðŸ˜´ Rest</button> <!></div> <div class="mode-toggle"><button> </button></div></div></div> <div class="header-actions svelte-1uha8ag"><button class="btn btn-mode svelte-1uha8ag">ðŸ“š Browse Spells & Feats</button> <button class="btn btn-secondary">Save to Gist</button> <button class="btn btn-secondary">Load from Gist</button> <button class="btn btn-secondary">Export JSON</button> <button class="btn btn-secondary">Import JSON</button> <input type="file" accept=".json" style="display: none;"/></div></header> <main class="svelte-1uha8ag"><!> <!> <!> <!> <!> <!> <!></main></div> <!> <!> <!>',1);function gi(r,u){mt(u,!1);const t=()=>Be(Q,"$character",k),c=()=>Be(Ot,"$isEditMode",k),x=()=>Be(St,"$searchFilter",k),[k,w]=kt();function N(){const n=[],m=t().classFeatures.spellSlotsByLevel||{};for(let F=1;F<=9;F++){const I=m[F];if(I&&I.length>0){const H=I.length,Le=I.filter(je=>je).length;n.push({level:F,available:H-Le,total:H})}}return n}let g=M(!1),G=M(!1),ee=M(!1),X=M("save"),W=M(void 0),de=M(""),re=M(""),me=M(""),ne=M(),T=!1,te=M(!1);function oe(){Q.update(n=>(n.hitDice.current=Math.min(n.hitDice.max,n.hitDice.current+Math.max(1,Math.floor(n.hitDice.max/2))),n.classFeatures.features&&Object.keys(n.classFeatures.features).forEach(m=>{const F=ce(m);if(F?.resetOn==="short"){if(Array.isArray(n.classFeatures.features[m])){const I=F.maxUses,H=typeof I=="function"?I(n.level):I;n.classFeatures.features[m]=Array(H).fill(!1)}else if(typeof n.classFeatures.features[m]=="number"){const I=F.maxPool,H=typeof I=="function"?I(n.level):I;H!==void 0&&(n.classFeatures.features[m]=H)}}}),n)),o(te,!1)}function ae(){Q.update(n=>(n.currentHP=n.maxHP,n.tempHP=0,n.hitDice.current=n.hitDice.max,n.classFeatures.spellSlotsByLevel&&Object.keys(n.classFeatures.spellSlotsByLevel).forEach(m=>{const F=n.classFeatures.spellSlotsByLevel[parseInt(m)];F&&(n.classFeatures.spellSlotsByLevel[parseInt(m)]=Array(F.length).fill(!1))}),n.classFeatures.features&&Object.keys(n.classFeatures.features).forEach(m=>{const F=ce(m);if(F){if(Array.isArray(n.classFeatures.features[m])){const I=F.maxUses,H=typeof I=="function"?I(n.level):I;n.classFeatures.features[m]=Array(H).fill(!1)}else if(typeof n.classFeatures.features[m]=="number"){const I=F.maxPool,H=typeof I=="function"?I(n.level):I;H!==void 0&&(n.classFeatures.features[m]=H)}}}),n)),o(te,!1)}function ce(n){return(t().class?gt(t().class):null)?Bt(t().class,t().level,t().subclass).find(I=>I.name.replace(/\s+/g,"")===n):null}function V(n){o(de,""),o(re,""),o(me,""),T=!1,typeof n=="string"?o(de,n):(o(de,n.notation),o(re,n.damageNotation||""),o(me,n.attackName||"")),o(g,!0)}function U(n){const{notation:m}=n.detail;o(de,""),T=!0,setTimeout(()=>{o(de,m),o(re,""),o(me,"Hit Die")},0),o(g,!0)}function Y(){if(o(g,!1),T&&e(ne)){const n=e(ne).getLastRollTotal();if(n!==null){const m=Math.max(1,n);Q.update(F=>(F.hitDice.current=Math.max(0,F.hitDice.current-1),F.currentHP=Math.min(F.maxHP,F.currentHP+m),F))}T=!1}}function le(){console.log("toggleMode called, current isEditMode:",c()),Ot.update(n=>(console.log("Updating isEditMode from",n,"to",!n),!n))}function ie(n){n.target.closest(".rest-button-container")||o(te,!1)}Ut(()=>{console.log("onMount - initial isEditMode:",c()),console.log("onMount - body classes:",document.body.className);const n=Ot.subscribe(m=>{console.log("isEditMode subscription triggered, value:",m),console.log("Body classes before:",document.body.className),m?(document.body.classList.remove("use-mode"),console.log("Removed use-mode class (Edit Mode)")):(document.body.classList.add("use-mode"),console.log("Added use-mode class (Use Mode)")),console.log("Body classes after:",document.body.className)});return document.addEventListener("click",ie),()=>{n(),document.removeEventListener("click",ie)}});function Ie(){Va(t())}function L(){e(W)?.click()}async function f(n){const F=n.target.files?.[0];if(F)try{const I=await Ja(F);Q.set(I),alert("Character imported successfully!")}catch{alert("Failed to import character file")}}ht();var C=ni();Wa("1uha8ag",n=>{var m=ai();ka(2),ha(()=>{Oa.title="D&D Character Sheet"}),v(n,m)});var d=Pe(C),b=l(d),O=l(b),Me=l(O),De=a(l(Me),2);{var Fe=n=>{var m=si(),F=l(m,!0);s(m),E(()=>y(F,t().name)),v(n,m)};D(De,n=>{t().name&&n(Fe)})}var J=a(De,2);{var S=n=>{var m=ii();it(m,5,N,ot,(F,I)=>{var H=li();let Le;var je=l(H);s(H),E(()=>{Le=rt(H,1,"slot-badge svelte-1uha8ag",null,Le,{depleted:e(I).available===0}),y(je,`Lv${e(I).level??""}: ${e(I).available??""}/${e(I).total??""}`)}),v(F,H)}),s(m),v(n,m)};D(J,n=>{N().length>0&&n(S)})}var ge=a(J,2);ke(ge),s(Me);var Re=a(Me,2),$e=l(Re),Se=a($e,2),Ne=l(Se),Ve=a(Ne,2);{var qe=n=>{var m=ri(),F=l(m),I=a(F,2);s(m),A("click",F,oe),A("click",I,ae),v(n,m)};D(Ve,n=>{e(te)&&n(qe)})}s(Se);var ze=a(Se,2),h=l(ze);let q;var Z=l(h,!0);s(h),s(ze),s(Re),s(O);var P=a(O,2),xe=l(P),ye=a(xe,2),we=a(ye,2),_e=a(we,2),j=a(_e,2),fe=a(j,2);aa(fe,n=>o(W,n),()=>e(W)),s(P),s(b);var ue=a(b,2),Ae=l(ue);rs(Ae,{});var He=a(Ae,2);fs(He,{$$events:{rollHitDice:U}});var pe=a(He,2);vs(pe,{$$events:{roll:n=>V(n.detail)}});var se=a(pe,2);ms(se,{$$events:{roll:n=>V(n.detail)}});var z=a(se,2);Hs(z,{$$events:{roll:n=>V(n.detail)}});var he=a(z,2);ll(he,{});var Ee=a(he,2);nl(Ee,{}),s(ue),s(d);var be=a(d,2);aa(_l(be,{get notation(){return e(de)},get damageNotation(){return e(re)},get attackName(){return e(me)},get visible(){return e(g)},$$events:{close:Y},$$legacy:!0}),n=>o(ne,n),()=>e(ne));var $=a(be,2);{var p=n=>{Nl(n,{get mode(){return e(X)},$$events:{close:()=>o(G,!1)}})};D($,n=>{e(G)&&n(p)})}var R=a($,2);{var K=n=>{ti(n,{onClose:()=>o(ee,!1)})};D(R,n=>{e(ee)&&n(K)})}E(()=>{q=rt(h,1,"btn btn-mode svelte-1uha8ag",null,q,{"use-mode":!c()}),y(Z,c()?"ðŸ“ Edit Mode":"ðŸŽ² Use Mode")}),Ce(ge,x,n=>Ka(St,n)),A("click",$e,()=>o(g,!0)),A("click",Ne,()=>o(te,!e(te))),A("click",h,le),A("click",xe,()=>o(ee,!0)),A("click",ye,()=>{o(X,"save"),o(G,!0)}),A("click",we,()=>{o(X,"load"),o(G,!0)}),A("click",_e,Ie),A("click",j,L),A("change",fe,f),v(r,C),_t(),w()}export{gi as component};
