import{f,e as R,a as o,s as D,c as rt,t as jt}from"../chunks/DBs_ODQp.js";import{i as Rt}from"../chunks/BbaRvQ4Z.js";import{c as sa,o as pa,a as ns}from"../chunks/CHX4V4AM.js";import{a7 as Pa,i as Qa,aZ as rs,a_ as Ya,a$ as ka,K as Yt,e as Xa,b0 as Za,T as fa,b1 as is,b2 as os,b3 as cs,q as Da,b4 as vs,b5 as ds,ab as us,d as r,r as Ia,g as ps,C as Pt,F as M,G as It,H as n,I as l,J as s,b6 as tt,b7 as Vt,s as c,a4 as P,f as e,m as it,E as Ue,A as E,b8 as aa,b9 as Lt,ba as da,ao as na,bb as fs}from"../chunks/DwmZeGF1.js";import{c as Bt,a as ee,e as _t,i as kt,u as es,s as Xt,b as mt,d as ga,f as ra,g as gs,t as Ut,h as ms,T as bs,j as hs,k as _s}from"../chunks/DQJFtNtV.js";import{i as k,s as qt,a as at,b as dt,d as ca,e as ys}from"../chunks/0ovU14Ao.js";import{p as $t,b as ja}from"../chunks/CFUzmRYW.js";import{b as va,r as ks}from"../chunks/DZHX2LaF.js";function _a(a,i,t=!1){if(a.multiple){if(i==null)return;if(!Qa(i))return rs();for(var v of a.options)v.selected=i.includes(ua(v));return}for(v of a.options){var u=ua(v);if(Ya(u,i)){v.selected=!0;return}}(!t||i!==void 0)&&(a.selectedIndex=-1)}function Ba(a){var i=new MutationObserver(()=>{_a(a,a.__value)});i.observe(a,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Pa(()=>{i.disconnect()})}function Aa(a,i,t=i){var v=new WeakSet,u=!0;ka(a,"change",b=>{var h=b?"[selected]":":checked",j;if(a.multiple)j=[].map.call(a.querySelectorAll(h),ua);else{var y=a.querySelector(h)??a.querySelector("option:not([disabled])");j=y&&ua(y)}t(j),Yt!==null&&v.add(Yt)}),Xa(()=>{var b=i();if(a===document.activeElement){var h=Za??Yt;if(v.has(h))return}if(_a(a,b,u),u&&b===void 0){var j=a.querySelector(":checked");j!==null&&(b=ua(j),t(b))}a.__value=b,u=!1}),Ba(a)}function ua(a){return"__value"in a?a.__value:a.value}const Ss=Symbol("is custom element"),xs=Symbol("is html");function je(a){if(fa){var i=!1,t=()=>{if(!i){if(i=!0,a.hasAttribute("value")){var v=a.value;Ke(a,"value",null),a.value=v}if(a.hasAttribute("checked")){var u=a.checked;Ke(a,"checked",null),a.checked=u}}};a.__on_r=t,Da(t),vs()}}function ya(a,i){var t=Ta(a);t.value===(t.value=i??void 0)||a.value===i&&(i!==0||a.nodeName!=="PROGRESS")||(a.value=i??"")}function ts(a,i){var t=Ta(a);t.checked!==(t.checked=i??void 0)&&(a.checked=i)}function Ke(a,i,t,v){var u=Ta(a);fa&&(u[i]=a.getAttribute(i),i==="src"||i==="srcset"||i==="href"&&a.nodeName==="LINK")||u[i]!==(u[i]=t)&&(i==="loading"&&(a[is]=t),t==null?a.removeAttribute(i):typeof t!="string"&&$s(a).includes(i)?a[i]=t:a.setAttribute(i,t))}function Ta(a){return a.__attributes??={[Ss]:a.nodeName.includes("-"),[xs]:a.namespaceURI===os}}var Ha=new Map;function $s(a){var i=a.getAttribute("is")||a.nodeName,t=Ha.get(i);if(t)return t;Ha.set(i,t=[]);for(var v,u=a,b=Element.prototype;b!==u;){v=ds(u);for(var h in v)v[h].set&&t.push(h);u=cs(u)}return t}function Ne(a,i,t=i){var v=new WeakSet;ka(a,"input",async u=>{var b=u?a.defaultValue:a.value;if(b=$a(a)?Ca(b):b,t(b),Yt!==null&&v.add(Yt),await us(),b!==(b=i())){var h=a.selectionStart,j=a.selectionEnd,y=a.value.length;if(a.value=b??"",j!==null){var x=a.value.length;h===j&&j===y&&x>y?(a.selectionStart=x,a.selectionEnd=x):(a.selectionStart=h,a.selectionEnd=Math.min(j,x))}}}),(fa&&a.defaultValue!==a.value||r(i)==null&&a.value)&&(t($a(a)?Ca(a.value):a.value),Yt!==null&&v.add(Yt)),Ia(()=>{var u=i();if(a===document.activeElement){var b=Za??Yt;if(v.has(b))return}$a(a)&&u===Ca(a.value)||a.type==="date"&&!u&&!a.value||u!==a.value&&(a.value=u??"")})}const xa=new Set;function Ua(a,i,t,v,u=v){var b=t.getAttribute("type")==="checkbox",h=a;let j=!1;if(i!==null)for(var y of i)h=h[y]??=[];h.push(t),ka(t,"change",()=>{var x=t.__value;b&&(x=Na(h,x,t.checked)),u(x)},()=>u(b?[]:null)),Ia(()=>{var x=v();if(fa&&t.defaultChecked!==t.checked){j=!0;return}b?(x=x||[],t.checked=x.includes(t.__value)):t.checked=Ya(t.__value,x)}),Pa(()=>{var x=h.indexOf(t);x!==-1&&h.splice(x,1)}),xa.has(h)||(xa.add(h),Da(()=>{h.sort((x,J)=>x.compareDocumentPosition(J)===4?-1:1),xa.delete(h)})),Da(()=>{if(j){var x;if(b)x=Na(h,x,t.checked);else{var J=h.find(G=>G.checked);x=J?.__value}u(x)}})}function Fa(a,i,t=i){ka(a,"change",v=>{var u=v?a.defaultChecked:a.checked;t(u)}),(fa&&a.defaultChecked!==a.checked||r(i)==null)&&t(a.checked),Ia(()=>{var v=i();a.checked=!!v})}function Na(a,i,t){for(var v=new Set,u=0;u<a.length;u+=1)a[u].checked&&v.add(a[u].__value);return t||v.delete(i),Array.from(v)}function $a(a){var i=a.type;return i==="number"||i==="range"}function Ca(a){return a===""?null:+a}function Cs(a,i,t){var v=ps(a,i);v&&v.set&&(a[i]=t,Pa(()=>{a[i]=null}))}function Ea(a){return function(...i){var t=i[0];return t.stopPropagation(),a?.apply(this,i)}}function ia(a,i){var t=a.$$events?.[i.type],v=Qa(t)?t.slice():t==null?[]:[t];for(var u of v)u.call(this,i)}const Ls="";function as(...a){return va+Ls+ks(a[0],a[1])}const Ma={paladin:{name:"Paladin",hitDice:"d10",spellcaster:!0,spellcastingAbility:"charisma",spellSlotsByLevel:{1:0,2:2,3:3,4:3,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Divine Sense",type:"uses",maxUses:(a,i=1)=>1+Math.max(1,i),resetOn:"long",description:"Detect celestials, fiends, and undead within 60 feet",minLevel:1},{name:"Lay on Hands",type:"pool",maxPool:a=>a*5,resetOn:"long",description:"Heal wounds or cure disease",minLevel:1},{name:"Divine Smite",type:"spellSlot",description:"Expend spell slot to deal extra radiant damage",minLevel:2,rollable:!0},{name:"Channel Divinity",type:"pool",maxPool:a=>a>=18?3:a>=6?2:1,resetOn:"short",description:"Sacred Weapon or Turn Undead",minLevel:3}]},fighter:{name:"Fighter",hitDice:"d10",spellcaster:!1,features:[{name:"Second Wind",type:"uses",maxUses:1,resetOn:"short",description:"Regain 1d10 + fighter level HP as bonus action",minLevel:1,rollable:!0,rollFormula:a=>`1d10+${a}`},{name:"Action Surge",type:"uses",maxUses:a=>a>=17?2:1,resetOn:"short",description:"Take one additional action on your turn",minLevel:2},{name:"Indomitable",type:"uses",maxUses:a=>a>=17?3:a>=13?2:1,resetOn:"long",description:"Reroll a failed saving throw",minLevel:9}],subclasses:{champion:{name:"Champion",features:[{name:"Improved Critical",type:"info",description:"Critical hit on 19-20",minLevel:3},{name:"Remarkable Athlete",type:"info",description:"Add half proficiency to STR/DEX/CON checks, increase long jump distance",minLevel:7},{name:"Additional Fighting Style",type:"info",description:"Choose a second fighting style",minLevel:10},{name:"Superior Critical",type:"info",description:"Critical hit on 18-20",minLevel:15},{name:"Survivor",type:"info",description:"Regain 5 + CON mod HP at start of turn if below half HP",minLevel:18}]},battlemaster:{name:"Battle Master",features:[{name:"Combat Superiority",type:"uses",maxUses:a=>a>=15?6:a>=7?5:4,resetOn:"short",description:a=>`Use superiority dice (${a>=18?"d12":a>=10?"d10":"d8"}) for maneuvers`,minLevel:3},{name:"Know Your Enemy",type:"info",description:"Learn capabilities of creatures you observe",minLevel:7},{name:"Improved Combat Superiority",type:"info",description:"Superiority dice become d10",minLevel:10},{name:"Relentless",type:"info",description:"Regain 1 superiority die if you have none at start of turn",minLevel:15}]}}},rogue:{name:"Rogue",hitDice:"d8",spellcaster:!1,features:[{name:"Sneak Attack",type:"info",description:a=>`Deal ${Math.ceil(a/2)}d6 extra damage once per turn with advantage or ally nearby`,minLevel:1,rollable:!0,rollFormula:a=>`${Math.ceil(a/2)}d6`},{name:"Cunning Action",type:"info",description:"Dash, Disengage, or Hide as a bonus action",minLevel:2},{name:"Uncanny Dodge",type:"info",description:"Use reaction to halve damage from an attack",minLevel:5},{name:"Evasion",type:"info",description:"Take no damage on successful Dex save (half on fail)",minLevel:7}]},wizard:{name:"Wizard",hitDice:"d6",spellcaster:!0,spellcastingAbility:"intelligence",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Arcane Recovery",type:"uses",maxUses:1,resetOn:"long",description:a=>`Recover spell slots totaling up to ${Math.ceil(a/2)} levels during short rest`,minLevel:1},{name:"Spell Mastery",type:"info",description:"Cast one 1st-level and one 2nd-level spell at will",minLevel:18}]},cleric:{name:"Cleric",hitDice:"d8",spellcaster:!0,spellcastingAbility:"wisdom",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Channel Divinity",type:"pool",maxPool:a=>a>=18?3:a>=6?2:1,resetOn:"short",description:"Turn Undead or domain-specific ability",minLevel:2},{name:"Destroy Undead",type:"info",description:a=>`Channel Divinity destroys undead of CR ${a>=17?4:a>=14?3:a>=11?2:a>=8?1:.5} or lower`,minLevel:5},{name:"Divine Intervention",type:"uses",maxUses:1,resetOn:"long",description:a=>`${a}% chance to succeed, implore deity for aid`,minLevel:10}],subclasses:{war:{name:"War Domain",features:[{name:"War Priest",type:"uses",maxUses:(a,i=1)=>Math.max(1,i),resetOn:"long",description:"Make one weapon attack as a bonus action",minLevel:1},{name:"Guided Strike",type:"channelDivinity",description:"Use your Channel Divinity to gain +10 to an attack roll. Make this choice after you see the roll, but before the DM says whether the attack hits or misses.",minLevel:2,resetOn:"short"},{name:"War God's Blessing",type:"channelDivinity",description:"Use reaction to grant +10 to an ally's attack roll within 30 feet. Consumes one use of Channel Divinity.",minLevel:6,resetOn:"short"},{name:"Divine Strike",type:"info",description:a=>`Deal extra ${a>=14?"2d8":"1d8"} weapon damage once per turn`,minLevel:8,rollable:!0,rollFormula:a=>a>=14?"2d8":"1d8"},{name:"Avatar of Battle",type:"info",description:"Gain resistance to nonmagical weapon damage",minLevel:17}]},life:{name:"Life Domain",features:[{name:"Disciple of Life",type:"info",description:"Healing spells restore additional 2 + spell level HP",minLevel:1},{name:"Preserve Life",type:"pool",maxPool:a=>a*5,resetOn:"short",description:"Restore HP to creatures within 30 feet",minLevel:2},{name:"Blessed Healer",type:"info",description:"Regain 2 + spell level HP when you cast healing spell",minLevel:6},{name:"Divine Strike",type:"info",description:a=>`Deal extra ${a>=14?"2d8":"1d8"} radiant damage once per turn`,minLevel:8,rollable:!0,rollFormula:a=>a>=14?"2d8":"1d8"},{name:"Supreme Healing",type:"info",description:"Maximize healing dice instead of rolling",minLevel:17}]}}},barbarian:{name:"Barbarian",hitDice:"d12",spellcaster:!1,features:[{name:"Rage",type:"uses",maxUses:a=>a>=20?1/0:a>=17?6:a>=12?5:a>=6?4:a>=3?3:2,resetOn:"long",description:a=>`+${a>=16?4:a>=9?3:2} damage, resistance to physical damage`,minLevel:1},{name:"Reckless Attack",type:"info",description:"Gain advantage on melee attacks, enemies get advantage on you",minLevel:2},{name:"Danger Sense",type:"info",description:"Advantage on Dex saves against effects you can see",minLevel:2}],subclasses:{berserker:{name:"Path of the Berserker",features:[{name:"Frenzy",type:"info",description:"While raging, make melee attack as bonus action (gain 1 exhaustion after rage)",minLevel:3},{name:"Mindless Rage",type:"info",description:"Cannot be charmed or frightened while raging",minLevel:6},{name:"Intimidating Presence",type:"info",description:"Use action to frighten creature within 30 feet",minLevel:10},{name:"Retaliation",type:"info",description:"When damaged by creature within 5 feet, make melee attack as reaction",minLevel:14}]}}}};function Nt(a){const i=a.toLowerCase();return Ma[i]||null}function oa(a,i,t){const v=Nt(a);if(!v)return[];const u=v.features.filter(b=>!b.minLevel||b.minLevel<=i);if(t&&v.subclasses&&v.subclasses[t]){const b=v.subclasses[t].features.filter(h=>!h.minLevel||h.minLevel<=i);return[...u,...b]}return u}function Ga(a){const i=Nt(a);return!i||!i.subclasses?[]:Object.keys(i.subclasses).map(t=>({id:t,name:i.subclasses[t].name}))}function Oa(a,i){const t=Nt(a);return!t||!t.spellcaster||!t.spellSlotsByLevel?0:t.spellSlotsByLevel[i]||0}function qa(a,i,t){const v=Nt(a);return!v||!v.spellcaster?0:Math.max(1,t+i)}function ws(a,i,t){const v=Nt(a);return!v||!v.spellcaster?null:8+i+t}function Ds(){return Object.keys(Ma).map(a=>({id:a,name:Ma[a].name}))}var js=f('<div class="section-header svelte-ls99y2" role="button" tabindex="0"><h2 class="svelte-ls99y2"> </h2> <span class="collapse-btn svelte-ls99y2"> </span></div>');function la(a,i){Pt(i,!1);let t=$t(i,"title",8),v=$t(i,"collapsed",8),u=$t(i,"ariaLabel",8,""),b=$t(i,"onToggle",8);Rt();var h=js(),j=n(h),y=n(j,!0);l(j);var x=s(j,2),J=n(x,!0);l(x),l(h),M(()=>{Ke(h,"aria-expanded",!v()),Ke(h,"aria-label",u()),D(y,t()),D(J,v()?"â–¼":"â–²")}),R("click",h,function(...G){b()?.apply(this,G)}),R("keydown",h,G=>{(G.key==="Enter"||G.key===" ")&&b()()}),o(a,h),It()}var Bs=f("<option> </option>"),As=f("<option> </option>"),Fs=f('<div class="form-group svelte-172i2fj"><label for="characterSubclass" class="svelte-172i2fj">Subclass</label> <select id="characterSubclass" class="svelte-172i2fj"><option>Select Subclass</option><!></select></div>'),Ms=f('<div class="info-grid svelte-172i2fj"><div class="form-group svelte-172i2fj"><label for="characterName" class="svelte-172i2fj">Character Name</label> <input type="text" id="characterName" placeholder="Enter name" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterClass" class="svelte-172i2fj">Class</label> <select id="characterClass" class="svelte-172i2fj"><option>Select Class</option><!></select></div> <!> <div class="form-group svelte-172i2fj"><label for="characterLevel" class="svelte-172i2fj">Level</label> <input type="number" id="characterLevel" min="1" max="20" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterRace" class="svelte-172i2fj">Race</label> <input type="text" id="characterRace" placeholder="e.g., Human" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterBackground" class="svelte-172i2fj">Background</label> <input type="text" id="characterBackground" placeholder="e.g., Soldier" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterAlignment" class="svelte-172i2fj">Alignment</label> <input type="text" id="characterAlignment" placeholder="e.g., Lawful Good" class="svelte-172i2fj"/></div></div>'),Rs=f('<section class="character-info svelte-172i2fj"><!> <!></section>');function Ps(a,i){Pt(i,!1);const t=()=>at(ee,"$character",u),v=()=>at(Bt,"$collapsedStates",u),[u,b]=qt(),h=P(),j=Ds();function y(ue){const ie=ue.target;ee.update(Z=>(Z.class=ie.value,Z.subclass="",Z))}function x(ue){const ie=ue.target;ee.update(Z=>(Z.subclass=ie.value,Z))}function J(ue){const ie=ue.target;ee.update(Z=>(Z.level=parseInt(ie.value)||1,Z)),es()}tt(()=>(t(),Ga),()=>{c(h,t().class?Ga(t().class):[])}),Vt(),Rt();var G=Rs(),te=n(G);{let ue=it(()=>(v(),r(()=>v().characterInfo?"Expand":"Collapse")));la(te,{title:"Character Info",get collapsed(){return v(),r(()=>v().characterInfo)},get ariaLabel(){return e(ue)},onToggle:()=>Bt.update(ie=>({...ie,characterInfo:!ie.characterInfo}))})}var se=s(te,2);{var V=ue=>{var ie=Ms(),Z=n(ie),Je=s(n(Z),2);je(Je),l(Z);var ae=s(Z,2),Re=s(n(ae),2),Be=n(Re);Be.value=Be.__value="";var O=s(Be);_t(O,1,()=>j,kt,(ze,$e)=>{var p=Bs(),w=n(p,!0);l(p);var q={};M(()=>{D(w,(e($e),r(()=>e($e).name))),q!==(q=(e($e),r(()=>e($e).id)))&&(p.value=(p.__value=(e($e),r(()=>e($e).id)))??"")}),o(ze,p)}),l(Re);var ge;Ba(Re),l(ae);var Ae=s(ae,2);{var Ie=ze=>{var $e=Fs(),p=s(n($e),2),w=n(p);w.value=w.__value="";var q=s(w);_t(q,1,()=>e(h),kt,(N,Ce)=>{var Ve=As(),Ze=n(Ve,!0);l(Ve);var he={};M(()=>{D(Ze,(e(Ce),r(()=>e(Ce).name))),he!==(he=(e(Ce),r(()=>e(Ce).id)))&&(Ve.value=(Ve.__value=(e(Ce),r(()=>e(Ce).id)))??"")}),o(N,Ve)}),l(p);var oe;Ba(p),l($e),M(()=>{oe!==(oe=(t(),r(()=>t().subclass)))&&(p.value=(p.__value=(t(),r(()=>t().subclass)))??"",_a(p,(t(),r(()=>t().subclass))))}),R("change",p,x),o(ze,$e)};k(Ae,ze=>{e(h),r(()=>e(h).length>0)&&ze(Ie)})}var Se=s(Ae,2),Fe=s(n(Se),2);je(Fe),l(Se);var B=s(Se,2),me=s(n(B),2);je(me),l(B);var _=s(B,2),T=s(n(_),2);je(T),l(_);var Y=s(_,2),Xe=s(n(Y),2);je(Xe),l(Y),l(ie),M(()=>{ge!==(ge=(t(),r(()=>t().class)))&&(Re.value=(Re.__value=(t(),r(()=>t().class)))??"",_a(Re,(t(),r(()=>t().class)))),ya(Fe,(t(),r(()=>t().level)))}),Ne(Je,()=>t().name,ze=>dt(ee,r(t).name=ze,r(t))),R("change",Re,y),R("change",Fe,J),Ne(me,()=>t().race,ze=>dt(ee,r(t).race=ze,r(t))),Ne(T,()=>t().background,ze=>dt(ee,r(t).background=ze,r(t))),Ne(Xe,()=>t().alignment,ze=>dt(ee,r(t).alignment=ze,r(t))),o(ue,ie)};k(se,ue=>{v(),r(()=>!v().characterInfo)&&ue(V)})}l(G),o(a,G),It(),b()}var Is=f('<div class="ability-card svelte-bbv1xt"><h3 class="svelte-bbv1xt"> </h3> <input type="number" class="ability-score svelte-bbv1xt" min="1" max="30"/> <div class="ability-modifier svelte-bbv1xt"> </div> <button class="roll-btn svelte-bbv1xt">Check</button> <div class="save-row svelte-bbv1xt"><input type="checkbox" class="svelte-bbv1xt"/> <label class="svelte-bbv1xt">Save</label> <button class="roll-btn-small svelte-bbv1xt">Roll</button></div></div>'),Ts=f('<div class="proficiency-bonus svelte-bbv1xt"><label for="profBonus">Proficiency Bonus</label> <input type="number" id="profBonus" class="prof-input svelte-bbv1xt"/></div> <div class="abilities-grid svelte-bbv1xt"></div>',1),Es=f("<section><!> <!></section>");function Hs(a,i){Pt(i,!1);const t=()=>at(ga,"$abilityModifiers",h),v=()=>at(ee,"$character",h),u=()=>at(Xt,"$searchFilter",h),b=()=>at(Bt,"$collapsedStates",h),[h,j]=qt(),y=P(),x=P(),J=sa(),G=[{key:"strength",label:"Strength"},{key:"dexterity",label:"Dexterity"},{key:"constitution",label:"Constitution"},{key:"intelligence",label:"Intelligence"},{key:"wisdom",label:"Wisdom"},{key:"charisma",label:"Charisma"}];function te(){es()}function se(Re){const Be=t()[Re],O=`1d20${Be>=0?"+":""}${Be}`;J("roll",O)}function V(Re){const Be=t()[Re],O=v().saveProficiencies[Re]?v().proficiencyBonus:0,ge=Be+O,Ae=`1d20${ge>=0?"+":""}${ge}`;J("roll",Ae)}tt(()=>u(),()=>{c(y,G.filter(({label:Re})=>u()?Re.toLowerCase().includes(u().toLowerCase()):!0))}),tt(()=>(e(y),u()),()=>{c(x,e(y).length>0||!u()||u().toLowerCase().includes("proficiency"))}),Vt(),Rt();var ue=Es();let ie;var Z=n(ue);la(Z,{title:"Ability Scores",get collapsed(){return b(),r(()=>b().abilityScores)},ariaLabel:"Toggle Ability Scores Section",onToggle:()=>Bt.update(Re=>({...Re,abilityScores:!Re.abilityScores}))});var Je=s(Z,2);{var ae=Re=>{var Be=Ts(),O=Ue(Be),ge=s(n(O),2);je(ge),l(O);var Ae=s(O,2);_t(Ae,5,()=>e(y),kt,(Ie,Se)=>{let Fe=()=>e(Se).key,B=()=>e(Se).label;var me=Is(),_=n(me),T=n(_,!0);l(_);var Y=s(_,2);je(Y);var Xe=s(Y,2),ze=n(Xe);l(Xe);var $e=s(Xe,2),p=s($e,2),w=n(p);je(w);var q=s(w,2),oe=s(q,2);l(p),l(me),M(N=>{D(T,N),D(ze,`${t(),Fe(),r(()=>t()[Fe()]>=0?"+":"")??""}${t(),Fe(),r(()=>t()[Fe()])??""}`),Ke(w,"id",`${Fe()}-save`),Ke(q,"for",`${Fe()}-save`)},[()=>(B(),r(()=>B().substring(0,3).toUpperCase()))]),Ne(Y,()=>v().abilities[Fe()],N=>dt(ee,r(v).abilities[Fe()]=N,r(v))),R("change",Y,te),R("click",$e,()=>se(Fe())),Fa(w,()=>v().saveProficiencies[Fe()],N=>dt(ee,r(v).saveProficiencies[Fe()]=N,r(v))),R("click",oe,()=>V(Fe())),o(Ie,me)}),l(Ae),Ne(ge,()=>v().proficiencyBonus,Ie=>dt(ee,r(v).proficiencyBonus=Ie,r(v))),o(Re,Be)};k(Je,Re=>{b(),r(()=>!b().abilityScores)&&Re(ae)})}l(ue),M(()=>ie=mt(ue,1,"ability-scores svelte-bbv1xt",null,ie,{hidden:!e(x)})),o(a,ue),It(),j()}function Ra(a,i){if(!a.class)return null;const t=Nt(a.class);if(!t||!t.spellcaster||!t.spellcastingAbility)return null;const v=i[t.spellcastingAbility];return 8+a.proficiencyBonus+v}function Wa(a,i){if(!a.class)return 0;const t=Nt(a.class);return!t||!t.spellcaster||!t.spellcastingAbility?0:i[t.spellcastingAbility]}var Us=f('<input type="number" id="armorClass" class="stat-input svelte-1r5hyyb"/>'),Ns=f('<input type="text" id="armorClass" readonly=""/>'),Gs=f('<div class="stat-box svelte-1r5hyyb"><label for="spellSaveDC" class="svelte-1r5hyyb">Spell Save DC</label> <input type="number" id="spellSaveDC" class="stat-input svelte-1r5hyyb" readonly="" title="8 + Proficiency Bonus + Spellcasting Ability Modifier"/></div>'),Os=f('<span class="hit-dice-type"> </span>'),qs=f('<div class="stats-grid svelte-1r5hyyb"><div class="stat-box svelte-1r5hyyb"><label for="armorClass" class="svelte-1r5hyyb">Armor Class</label> <!></div> <div class="stat-box svelte-1r5hyyb"><label for="initiative" class="svelte-1r5hyyb">Initiative</label> <input type="number" id="initiative" class="stat-input svelte-1r5hyyb"/></div> <div class="stat-box svelte-1r5hyyb"><label for="speed" class="svelte-1r5hyyb">Speed</label> <input type="text" id="speed" class="stat-input svelte-1r5hyyb"/></div> <!></div> <div class="hp-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Points</h3> <div><div class="hp-inputs svelte-1r5hyyb"><input type="number" class="hp-current svelte-1r5hyyb" min="0"/> <span class="hp-separator svelte-1r5hyyb">/</span> <input type="number" class="hp-max svelte-1r5hyyb" min="0"/></div> <div class="hp-controls svelte-1r5hyyb"><button class="hp-btn svelte-1r5hyyb">âˆ’</button> <button class="hp-btn svelte-1r5hyyb">+</button> <button class="hp-btn svelte-1r5hyyb">âˆ’5</button> <button class="hp-btn svelte-1r5hyyb">+5</button></div></div> <div class="temp-hp svelte-1r5hyyb"><label for="tempHP" class="svelte-1r5hyyb">Temp HP</label> <input type="number" id="tempHP" min="0" class="svelte-1r5hyyb"/></div></div> <div class="hit-dice-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Dice</h3> <div class="hit-dice-display svelte-1r5hyyb"><input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <span>/</span> <input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <!></div> <div class="hit-dice-controls"><label for="hitDiceCount" class="svelte-1r5hyyb">Roll</label> <input type="number" id="hitDiceCount" class="hit-dice-count-input svelte-1r5hyyb" min="1" value="1"/> <button class="btn btn-primary roll-hit-dice use-enabled svelte-1r5hyyb">ðŸŽ² Roll</button></div></div>',1),Ws=f("<section><!> <!></section>");function zs(a,i){Pt(i,!1);const t=()=>at(ee,"$character",j),v=()=>at(ga,"$abilityModifiers",j),u=()=>at(Xt,"$searchFilter",j),b=()=>at(Bt,"$collapsedStates",j),h=()=>at(ra,"$isEditMode",j),[j,y]=qt(),x=P(),J=P(),G=P(),te=P(),se=sa();function V(Be){ee.update(O=>(O.currentHP=Math.max(0,Math.min(O.maxHP,O.currentHP+Be)),O))}function ue(Be=1){if(t().hitDice.current<=0){alert("No hit dice remaining!");return}if(!t().class){alert("Please select a class first!");return}const O=Nt(t().class);if(!O){alert("Invalid class configuration!");return}const ge=Math.min(Be,t().hitDice.current),Ae=O.hitDice,Ie=v().constitution,Se=Ie>=0?`+${Ie}`:`${Ie}`,Fe=`${ge}${Ae}${Se}`;se("rollHitDice",{notation:Fe,hitDie:Ae,count:ge})}tt(()=>(t(),v()),()=>{c(x,Ra(t(),v()))}),tt(()=>t(),()=>{c(J,t().activeStates&&t().activeStates.length>0?t().activeStates.reduce((Be,O)=>Be+(O.acBonus||0),0):0)}),tt(()=>t(),()=>{c(G,t().activeStates&&t().activeStates.length>0?t().activeStates.some(Be=>Be.name==="Aid"&&Be.target==="self"):!1)}),tt(()=>u(),()=>{c(te,!u()||"armor class".includes(u().toLowerCase())||"initiative".includes(u().toLowerCase())||"speed".includes(u().toLowerCase())||"hit points".includes(u().toLowerCase())||"hp".includes(u().toLowerCase())||"hit dice".includes(u().toLowerCase())||"spell save".includes(u().toLowerCase())||"combat".includes(u().toLowerCase()))}),Vt(),Rt();var ie=Ws();let Z;var Je=n(ie);{let Be=it(()=>(b(),r(()=>b().combatStats?"Expand":"Collapse")));la(Je,{title:"Combat Stats",get collapsed(){return b(),r(()=>b().combatStats)},get ariaLabel(){return e(Be)},onToggle:()=>Bt.update(O=>({...O,combatStats:!O.combatStats}))})}var ae=s(Je,2);{var Re=Be=>{var O=qs(),ge=Ue(O),Ae=n(ge),Ie=s(n(Ae),2);{var Se=H=>{var W=Us();je(W),Ne(W,()=>t().armorClass,Te=>dt(ee,r(t).armorClass=Te,r(t))),o(H,W)},Fe=H=>{var W=Ns();je(W),M(()=>{ya(W,(e(J),t(),r(()=>e(J)!==0?`${t().armorClass} â†’ ${t().armorClass+e(J)}`:`${t().armorClass}`))),mt(W,1,gs(e(J)!==0?"stat-input ac-enhanced":"stat-input"),"svelte-1r5hyyb"),Ke(W,"title",e(J)!==0?"Base AC plus active effect bonuses":"Base Armor Class")}),o(H,W)};k(Ie,H=>{h()?H(Se):H(Fe,!1)})}l(Ae);var B=s(Ae,2),me=s(n(B),2);je(me),l(B);var _=s(B,2),T=s(n(_),2);je(T),l(_);var Y=s(_,2);{var Xe=H=>{var W=Gs(),Te=s(n(W),2);je(Te),l(W),M(()=>ya(Te,e(x))),o(H,W)};k(Y,H=>{e(x)!==null&&H(Xe)})}l(ge);var ze=s(ge,2),$e=s(n(ze),2);let p;var w=n($e),q=n(w);je(q);var oe=s(q,4);je(oe),l(w);var N=s(w,2),Ce=n(N),Ve=s(Ce,2),Ze=s(Ve,2),he=s(Ze,2);l(N),l($e);var Ge=s($e,2),F=s(n(Ge),2);je(F),l(Ge),l(ze);var $=s(ze,2),K=s(n($),2),le=n(K);je(le);var U=s(le,4);je(U);var d=s(U,2);{var Oe=H=>{const W=it(()=>(E(Nt),t(),r(()=>Nt(t().class))));var Te=rt(),st=Ue(Te);{var Me=fe=>{const Le=it(()=>(v(),r(()=>v().constitution)));var Pe=Os(),Ee=n(Pe);l(Pe),M(()=>D(Ee,`(${E(e(W)),r(()=>e(W).hitDice)??""}${(e(Le)>=0?`+${e(Le)}`:e(Le))??""})`)),o(fe,Pe)};k(st,fe=>{e(W)&&fe(Me)})}o(H,Te)};k(d,H=>{t(),r(()=>t().class)&&H(Oe)})}l(K);var pe=s(K,2),ne=s(n(pe),2),L=s(ne,2);l(pe),l($),M(()=>{p=mt($e,1,"hp-display svelte-1r5hyyb",null,p,{"aid-active":e(G)}),Ke(q,"max",(t(),r(()=>t().maxHP))),Ke(le,"max",(t(),r(()=>t().hitDice.max))),Ke(ne,"max",(t(),r(()=>t().hitDice.current))),L.disabled=(t(),r(()=>t().hitDice.current<=0||!t().class))}),Ne(me,()=>t().initiative,H=>dt(ee,r(t).initiative=H,r(t))),Ne(T,()=>t().speed,H=>dt(ee,r(t).speed=H,r(t))),Ne(q,()=>t().currentHP,H=>dt(ee,r(t).currentHP=H,r(t))),Ne(oe,()=>t().maxHP,H=>dt(ee,r(t).maxHP=H,r(t))),R("click",Ce,()=>V(-1)),R("click",Ve,()=>V(1)),R("click",Ze,()=>V(-5)),R("click",he,()=>V(5)),Ne(F,()=>t().tempHP,H=>dt(ee,r(t).tempHP=H,r(t))),Ne(le,()=>t().hitDice.current,H=>dt(ee,r(t).hitDice.current=H,r(t))),Ne(U,()=>t().hitDice.max,H=>dt(ee,r(t).hitDice.max=H,r(t))),R("input",ne,H=>{const W=H.target,Te=parseInt(W.value);Te>t().hitDice.current&&(W.value=String(t().hitDice.current)),Te<1&&(W.value="1")}),R("click",L,()=>{const H=document.getElementById("hitDiceCount"),W=parseInt(H?.value||"1");ue(W)}),o(Be,O)};k(ae,Be=>{b(),r(()=>!b().combatStats)&&Be(Re)})}l(ie),M(()=>Z=mt(ie,1,"combat-stats svelte-1r5hyyb",null,Z,{hidden:!e(te)})),o(a,ie),It(),y()}const La={acrobatics:"dexterity",animalHandling:"wisdom",arcana:"intelligence",athletics:"strength",deception:"charisma",history:"intelligence",insight:"wisdom",intimidation:"charisma",investigation:"intelligence",medicine:"wisdom",nature:"intelligence",perception:"wisdom",performance:"charisma",persuasion:"charisma",religion:"intelligence",sleightOfHand:"dexterity",stealth:"dexterity",survival:"wisdom"};var Ks=f('<div class="skill-row svelte-1f1pl16"><input type="checkbox" class="svelte-1f1pl16"/> <label class="svelte-1f1pl16"> <span class="ability-tag svelte-1f1pl16"> </span></label> <span class="skill-modifier svelte-1f1pl16"> </span> <button class="roll-btn svelte-1f1pl16">Roll</button></div>'),Vs=f('<div class="skills-grid svelte-1f1pl16"></div>'),Js=f("<section><!> <!></section>");function Qs(a,i){Pt(i,!1);const t=()=>at(ee,"$character",h),v=()=>at(ga,"$abilityModifiers",h),u=()=>at(Xt,"$searchFilter",h),b=()=>at(Bt,"$collapsedStates",h),[h,j]=qt(),y=P(),x=P(),J=P(),G=P(),te=P(),se=P(),V=sa(),ue=[{key:"acrobatics",label:"Acrobatics"},{key:"animalHandling",label:"Animal Handling"},{key:"arcana",label:"Arcana"},{key:"athletics",label:"Athletics"},{key:"deception",label:"Deception"},{key:"history",label:"History"},{key:"insight",label:"Insight"},{key:"intimidation",label:"Intimidation"},{key:"investigation",label:"Investigation"},{key:"medicine",label:"Medicine"},{key:"nature",label:"Nature"},{key:"perception",label:"Perception"},{key:"performance",label:"Performance"},{key:"persuasion",label:"Persuasion"},{key:"religion",label:"Religion"},{key:"sleightOfHand",label:"Sleight of Hand"},{key:"stealth",label:"Stealth"},{key:"survival",label:"Survival"}];function ie(O){const ge=e(y)[O],Ae=`1d20${ge>=0?"+":""}${ge}`;V("roll",Ae)}tt(()=>{},()=>{c(y,{})}),tt(()=>t(),()=>{c(x,t().skillProficiencies)}),tt(()=>t(),()=>{c(J,t().proficiencyBonus)}),tt(()=>v(),()=>{c(G,v())}),tt(()=>(e(G),e(x),e(J)),()=>{for(const{key:O}of ue){const ge=La[O],Ae=e(G)[ge],Ie=e(x)[O]?e(J):0;aa(y,e(y)[O]=Ae+Ie)}}),tt(()=>u(),()=>{c(te,ue.filter(({label:O})=>u()?O.toLowerCase().includes(u().toLowerCase()):!0))}),tt(()=>e(te),()=>{c(se,e(te).length>0)}),Vt(),Rt();var Z=Js();let Je;var ae=n(Z);{let O=it(()=>(b(),r(()=>b().skills?"Expand":"Collapse")));la(ae,{title:"Skills",get collapsed(){return b(),r(()=>b().skills)},get ariaLabel(){return e(O)},onToggle:()=>Bt.update(ge=>({...ge,skills:!ge.skills}))})}var Re=s(ae,2);{var Be=O=>{var ge=Vs();_t(ge,5,()=>e(te),kt,(Ae,Ie)=>{let Se=()=>e(Ie).key,Fe=()=>e(Ie).label;var B=Ks(),me=n(B);je(me);var _=s(me,2),T=n(_),Y=s(T),Xe=n(Y);l(Y),l(_);var ze=s(_,2),$e=n(ze);l(ze);var p=s(ze,2);l(B),M(w=>{ts(me,(e(x),Se(),r(()=>e(x)[Se()]))),Ke(me,"id",Se()),Ke(_,"for",Se()),D(T,`${Fe()??""} `),D(Xe,`(${w??""})`),D($e,`${e(y),Se(),r(()=>e(y)[Se()]>=0?"+":"")??""}${e(y),Se(),r(()=>e(y)[Se()])??""}`)},[()=>(E(La),Se(),r(()=>La[Se()].substring(0,3).toUpperCase()))]),R("change",me,w=>{console.log("Skill proficiency changed:",Se(),w.target.checked),ee.update(q=>({...q,skillProficiencies:{...q.skillProficiencies,[Se()]:w.target.checked}}))}),R("click",p,()=>ie(Se())),o(Ae,B)}),l(ge),o(O,ge)};k(Re,O=>{b(),r(()=>!b().skills)&&O(Be)})}l(Z),M(()=>Je=mt(Z,1,"skills svelte-1f1pl16",null,Je,{hidden:!e(se)})),o(a,Z),It(),j()}let ma=null,ba=null;async function ss(){if(ma)return ma;try{return ma=await(await fetch(as("/data/spells.json"))).json(),ma||[]}catch(a){return console.error("Failed to load spells:",a),[]}}async function Ys(){if(ba)return ba;try{return ba=await(await fetch(as("/data/feats.json"))).json(),ba||[]}catch(a){return console.error("Failed to load feats:",a),[]}}function za(a,i){if(!i.trim())return a;const t=i.toLowerCase();return a.filter(v=>v.name.toLowerCase().includes(t)||v.school.toLowerCase().includes(t)||v.classes.some(u=>u.toLowerCase().includes(t))||v.description.toLowerCase().includes(t))}function Xs(a,i){return i===null?a:a.filter(t=>t.level===i)}function Zs(a,i){if(!i.trim())return a;const t=i.toLowerCase();return a.filter(v=>v.name.toLowerCase().includes(t)||v.description.toLowerCase().includes(t))}function ha(a){const i=a.description,t=/\b(Strength|Dexterity|Constitution|Intelligence|Wisdom|Charisma)\s+saving\s+throw/i,v=i.match(t);if(!v)return null;const u=v[1].toLowerCase(),h=/half\s+(?:as\s+much\s+)?damage\s+on\s+a\s+successful(?:\s+save)?/i.test(i),y=/saving\s+throw\s+or\s+take.*?damage/i.test(i)&&!h;return{ability:u,halfDamageOnSave:h,noDamageOnSave:y}}function el(a){const i=a.description;return/(plus|add)\s+your\s+spellcasting\s+(ability\s+)?modifier/i.test(i)}function wa(a){const i=a.description.toLowerCase();return i.includes("ranged spell attack")||i.includes("melee spell attack")}function Ka(a){const i=a.description.toLowerCase();if(["Divine Favor","Bless","Aid","Command"].includes(a.name))return!0;const u=["takes","take","deals","deal","damage equal to","force damage","fire damage","cold damage","lightning damage","thunder damage","acid damage","poison damage","necrotic damage","radiant damage","psychic damage","regain","regains","hit point"].some(j=>i.includes(j));return["bonus to attack","bonus to damage","bonus to ac","gains a +","gain a +","+1 bonus","+2 bonus","+3 bonus","advantage on","becomes a magic weapon"].some(j=>i.includes(j))&&!u}function tl(a){const i=a.description;let t=0,v=0,u=0,b="";const h=i.match(/\+(\d+)\s+bonus\s+to\s+attack\s+rolls\s+and\s+damage\s+rolls/i);if(h){const y=parseInt(h[1]);t=y,v=y,b=`+${y} to attack and damage rolls`}if(a.name==="Bless"&&(b="Add 1d4 to attack rolls and saves",t="1d4"),a.name==="Aid")return b="+5 HP (max and current) for 8 hours",{attackBonus:0,damageBonus:0,acBonus:0,hpBonus:5,description:b,name:a.name};a.name==="Divine Favor"&&(b="Your weapon attacks deal an extra 1d4 radiant damage on a hit.",v="1d4");const j=i.match(/\+(\d+)\s+bonus\s+to\s+AC/i);return j&&(u=parseInt(j[1]),b=`+${u} to AC`),a.name==="Haste"&&(b="+2 AC, doubled speed, extra action",u=2),b||t!==0||v!==0||u!==0?{attackBonus:t,damageBonus:v,acBonus:u,description:b||a.description.substring(0,100),name:a.name}:null}var al=f('<button class="btn btn-secondary">Add Attack</button>'),sl=f('<input type="text" placeholder="Attack name" class="attack-name svelte-14o91c5"/>'),ll=f('<h4 class="attack-name-display svelte-14o91c5"> </h4>'),nl=f('<button class="btn-remove svelte-14o91c5">Ã—</button>'),rl=f('<div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Bonus</label> <input type="number" class="attack-bonus svelte-14o91c5"/></div>'),il=f('<div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Damage</label> <input type="text" placeholder="e.g., 2d6+3" class="attack-damage svelte-14o91c5"/></div>'),ol=f('<div class="spell-info-loading svelte-14o91c5">Loading spell info...</div>'),cl=f('<li class="svelte-14o91c5"><strong>At Higher Levels:</strong> </li>'),vl=f('<ul class="svelte-14o91c5"><li class="svelte-14o91c5"><strong>Level:</strong> </li> <li class="svelte-14o91c5"><strong>Casting Time:</strong> </li> <li class="svelte-14o91c5"><strong>Range:</strong> </li> <li class="svelte-14o91c5"><strong>Components:</strong> <!></li> <li class="svelte-14o91c5"><strong>Duration:</strong> <!> </li> <li class="svelte-14o91c5"><strong>Description:</strong> </li> <!></ul>'),dl=f('<span class="scaled-damage svelte-14o91c5" style="margin-left: 8px;"> </span>'),ul=f('<span class="scaled-damage svelte-14o91c5">(Half damage)</span>'),pl=f('<span class="scaled-damage svelte-14o91c5">(No damage)</span>'),fl=f('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> <!> <!></label></div>'),gl=f("<option> </option>"),ml=f('<span class="scaled-damage svelte-14o91c5"><!> </span>'),bl=f('<span class="scaled-damage svelte-14o91c5"> </span>'),hl=f('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> Target is Fiend or Undead <!></label></div>'),_l=f('<div class="spell-level-selector svelte-14o91c5"><label class="svelte-14o91c5">Cast at Level:</label> <select class="spell-level-select use-enabled svelte-14o91c5"></select> <!></div> <!>',1),yl=f('<div class="spell-level-selector svelte-14o91c5"><span style="color: #dc3545; font-weight: bold;">No spell slots available!</span></div>'),kl=f('<div class="spell-info svelte-14o91c5"><div class="spell-info-header svelte-14o91c5" role="button" tabindex="0"><h4 class="svelte-14o91c5">Spell Info</h4> <button class="collapse-btn-small svelte-14o91c5"> </button></div> <!></div> <!> <!>',1),Sl=f('<div class="spell-info-missing svelte-14o91c5">Spell info not found.</div>'),xl=f('<div class="attack-notes svelte-14o91c5"><label class="svelte-14o91c5">Notes</label> <textarea placeholder="e.g., DC 15 Dex save, Range 120 ft, Concentration" class="notes-input svelte-14o91c5" rows="2"></textarea></div>'),$l=f('<button class="btn btn-primary">Roll Attack</button>'),Cl=f('<div class="buff-target-selection svelte-14o91c5"><div class="target-options svelte-14o91c5"><label class="target-option svelte-14o91c5"><input type="radio" class="svelte-14o91c5"/> Self</label> <label class="target-option svelte-14o91c5"><input type="radio" class="svelte-14o91c5"/> Other</label></div> <button class="btn btn-info"> </button></div>'),Ll=f('<button class="btn btn-info">Cast Spell</button>'),wl=f("<button><!></button>"),Dl=f('<button class="btn btn-primary">Roll Attack</button> <button class="btn btn-secondary">Roll Damage</button>',1),jl=f('<div class="attack-card svelte-14o91c5"><div class="attack-header svelte-14o91c5"><!> <!></div> <div class="attack-details svelte-14o91c5"><!> <!> <div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Type</label> <input type="text" placeholder="e.g., slashing" class="attack-type svelte-14o91c5"/></div></div> <!> <!> <div class="attack-actions svelte-14o91c5"><!></div></div>'),Bl=f('<p class="no-attacks svelte-14o91c5">No attacks added yet. Click "Add Attack" to create one.</p>'),Al=f('<p class="no-attacks svelte-14o91c5">No attacks match your search.</p>'),Fl=f('<button class="btn-remove svelte-14o91c5">Ã—</button>'),Ml=f('<div class="state-card svelte-14o91c5"><div class="state-header svelte-14o91c5"><input type="text" placeholder="Effect name (e.g., Magic Weapon)" class="state-name svelte-14o91c5"/> <!></div> <div class="state-details svelte-14o91c5"><div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Attack Bonus</label> <input type="number" class="state-bonus svelte-14o91c5"/></div> <div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Damage Bonus</label> <input type="text" class="state-bonus svelte-14o91c5"/></div> <div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Target</label> <select class="state-bonus svelte-14o91c5"><option>Self</option><option>Other</option></select></div></div> <div class="state-description svelte-14o91c5"><label class="svelte-14o91c5">Description</label> <input type="text" placeholder="e.g., +1 to attack and damage rolls (Magic Weapon)" class="state-desc-input svelte-14o91c5"/></div></div>'),Rl=f('<div class="states-list svelte-14o91c5"></div>'),Pl=f('<p class="no-states svelte-14o91c5">No active effects. Add spell effects that modify your attacks.</p>'),Il=f('<!> <div class="attacks-list svelte-14o91c5"><!> <!></div> <div class="active-states-section svelte-14o91c5"><h3 class="svelte-14o91c5">Active Spell Effects</h3> <p class="section-description svelte-14o91c5">Effects that modify attack and damage rolls (e.g., Magic Weapon, Bless)</p> <button class="btn btn-secondary">Add Effect</button> <!></div>',1),Tl=f("<section><!> <!></section>");function El(a,i){Pt(i,!1);const t=()=>at(ee,"$character",j),v=()=>at(ga,"$abilityModifiers",j),u=()=>at(Xt,"$searchFilter",j),b=()=>at(Bt,"$collapsedStates",j),h=()=>at(ra,"$isEditMode",j),[j,y]=qt(),x=P(),J=P(),G=[],te=sa();let se=P({}),V=P({});function ue(p){aa(se,e(se)[p]=!e(se)[p]),c(se,{...e(se)})}function ie(p){return p.description.toLowerCase().includes("regain")&&(p.description.toLowerCase().includes("hit point")||p.description.toLowerCase().includes("hp"))}function Z(p){return["Shield of Faith","Bless","Aid","Magic Weapon"].includes(p)}function Je(){ee.update(p=>(p.attacks=[...p.attacks,{id:crypto.randomUUID(),name:"",bonus:0,damage:"",damageType:"",notes:""}],p))}function ae(p){ee.update(w=>(w.attacks=w.attacks.filter(q=>q.id!==p),w))}function Re(p){let w=p.damage,q=!1,oe=!1;if(p.spellRef){const he=Ae(p.spellRef);if(he&&(oe=wa(he),he.level>0)){const Ge=p.castAtLevel||he.level;if(!Ie(Ge)){Ut.add(`No level ${Ge} spell slots available!`,"error");return}const $=ha(he);$&&p.targetSucceededSave&&$.noDamageOnSave?w="0":(q=$?.halfDamageOnSave&&p.targetSucceededSave||!1,w=Se(p,he))}}else if(t().activeStates&&t().activeStates.length>0){let he=0,Ge=[];for(const F of t().activeStates)F.target!=="other"&&(typeof F.damageBonus=="string"?Ge.push(F.damageBonus):typeof F.damageBonus=="number"&&(he+=F.damageBonus));if((he!==0||Ge.length>0)&&w){const F=w.match(/(\d+d\d+)([+-]\d+)?/);if(F){const[,$,K]=F,U=(K?parseInt(K):0)+he;let d=`${$}`;U!==0&&(d+=`${U>=0?"+":""}${U}`),Ge.length>0&&(d+=" + "+Ge.join(" + ")),w=d}}}const N=[];let Ce=0;if(oe){const he=Wa(t(),v()),Ge=t().proficiencyBonus||0;N.push({value:Ge,source:"proficiency"}),N.push({value:he,source:"spellcasting"}),Ce=Ge+he}else p.bonus!==0&&N.push({value:p.bonus,source:"base"}),Ce=p.bonus;let Ve=[];if(t().activeStates)for(const he of t().activeStates)he.target!=="other"&&(typeof he.attackBonus=="number"&&he.attackBonus!==0?(N.push({value:he.attackBonus,source:he.name.toLowerCase()}),Ce+=he.attackBonus):typeof he.attackBonus=="string"&&he.attackBonus&&(Ve.push(he.attackBonus),N.push({value:he.attackBonus,source:he.name.toLowerCase()})));let Ze;Ze=`1d20${Ce>=0?"+":""}${Ce}`,Ve.length>0&&(Ze+="+"+Ve.join("+")),te("roll",{notation:Ze,damageNotation:w,attackName:p.name,applyHalfDamage:q,bonusBreakdown:N})}function Be(p){if(!p.damage){Ut.add(`${p.name}: No damage specified`,"error");return}let w=p.damage,q=!1;const oe=[];if(p.spellRef){const N=Ae(p.spellRef);if(N&&N.level>0){const Ce=p.castAtLevel||N.level;if(!Ie(Ce)){Ut.add(`No level ${Ce} spell slots available!`,"error");return}const Ze=ha(N);Ze&&p.targetSucceededSave&&Ze.noDamageOnSave?w="0":(q=Ze?.halfDamageOnSave&&p.targetSucceededSave||!1,w=Se(p,N))}}else{const N=w.match(/(\d+d\d+)([+-]\d+)?/);if(N){const[,Ce,Ve]=N,Ze=Ve?parseInt(Ve):0;if(Ze!==0&&oe.push({value:Ze,source:"base"}),t().activeStates&&t().activeStates.length>0){let he=0,Ge=[];for(const F of t().activeStates)F.target!=="other"&&(typeof F.damageBonus=="string"?Ge.push(F.damageBonus):typeof F.damageBonus=="number"&&F.damageBonus!==0&&(oe.push({value:F.damageBonus,source:F.name.toLowerCase()}),he+=F.damageBonus));if(he!==0||Ge.length>0){const F=Ze+he;let $=`${Ce}`;F!==0&&($+=`${F>=0?"+":""}${F}`),Ge.length>0&&($+=" + "+Ge.join(" + ")),w=$}}}}te("roll",{notation:w,attackName:p.name,applyHalfDamage:q,bonusBreakdown:oe})}let O=P([]),ge=P(!1);pa(async()=>{c(O,await ss()),c(ge,!0)});function Ae(p){return e(O).find(w=>w.name===p)}function Ie(p){t().classFeatures.spellSlotsByLevel||dt(ee,r(t).classFeatures.spellSlotsByLevel={},r(t)),t().classFeatures.spellSlotsByLevel[p]||dt(ee,r(t).classFeatures.spellSlotsByLevel[p]=Array(2).fill(!1),r(t));const q=t().classFeatures.spellSlotsByLevel[p].findIndex(oe=>!oe);return q===-1?!1:(ee.update(oe=>(oe.classFeatures.spellSlotsByLevel||(oe.classFeatures.spellSlotsByLevel={}),oe.classFeatures.spellSlotsByLevel[p]||(oe.classFeatures.spellSlotsByLevel[p]=Array(2).fill(!1)),oe.classFeatures.spellSlotsByLevel[p][q]=!0,oe)),!0)}function Se(p,w){let q=p.damage,oe=0,N=0;if(el(w)&&(N+=Wa(t(),v())),t().activeStates)for(const le of t().activeStates)le.target!=="other"&&typeof le.damageBonus=="number"&&(N+=le.damageBonus);if(w.higherLevelSlot&&p.castAtLevel){const le=w.level,d=(p.castAtLevel||le)-le;if(d>0){const Oe=w.higherLevelSlot.match(/(\d+)d(\d+)\s+for\s+each.*?level\s+above/i);if(Oe){const[,pe]=Oe;oe+=d*parseInt(pe)}}}if(p.targetIsFiendOrUndead&&w.description.includes("Fiend or an Undead")){const le=w.description.match(/increases by (\d+)d(\d+) if.*?Fiend or.*?Undead/i);if(le){const[,U]=le;oe+=parseInt(U)}}const Ce=q.match(/(\d+)d(\d+)([+-]\d+)?/);if(!Ce)return N!==0?N>=0?`${N}`:`${N}`:q||"0";const[,Ve,Ze,he]=Ce,Ge=parseInt(Ve)+oe,$=(he?parseInt(he):0)+N;let K=`${Ge}d${Ze}`;return $!==0&&(K+=$>=0?`+${$}`:`${$}`),K}function Fe(p){const w=[];for(let oe=p.level;oe<=9;oe++){const N=t().classFeatures.spellSlotsByLevel?.[oe];N&&N.length>0&&w.push(oe)}return w}function B(){ee.update(p=>(p.activeStates||(p.activeStates=[]),p.activeStates=[...p.activeStates,{name:"",attackBonus:0,damageBonus:0,description:"",target:"self"}],p))}function me(p){ee.update(w=>{if(w.activeStates){const q=w.activeStates[p];q?.hpBonus&&q.target!=="other"&&(w.maxHP-=q.hpBonus,w.currentHP=Math.max(1,Math.min(w.currentHP-q.hpBonus,w.maxHP))),w.activeStates=w.activeStates.filter((oe,N)=>N!==p)}return w})}function _(p,w="self"){const q=Ae(p.spellRef);if(!q){Ut.add("Spell not found","error");return}const oe=p.castAtLevel||q.level;if(oe>0&&!Ie(oe)){Ut.add(`No level ${oe} spell slots available!`,"error");return}const N=tl(q);if(!N){Ut.add(`${q.name} cast! Check spell description for effects.`,"info");return}let Ce=N.hpBonus||0,Ve=N.description;q.name==="Aid"&&oe>q.level&&(Ce=5+(oe-q.level)*5,Ve=`+${Ce} HP (max and current) for 8 hours`);const he=["Shield of Faith","Bless","Aid","Magic Weapon"].includes(q.name);ee.update(F=>{F.activeStates||(F.activeStates=[]);const $=F.activeStates.find(K=>K.name===q.name);return $&&$.hpBonus&&$.target!=="other"&&(F.maxHP-=$.hpBonus,F.currentHP=Math.max(1,Math.min(F.currentHP-$.hpBonus,F.maxHP))),F.activeStates=F.activeStates.filter(K=>K.name!==q.name),Ce>0&&w==="self"&&(F.maxHP+=Ce,F.currentHP+=Ce),F.activeStates=[...F.activeStates,{name:q.name,attackBonus:N.attackBonus,damageBonus:N.damageBonus,acBonus:N.acBonus,description:Ve,target:w,hpBonus:Ce}],F});const Ge=w==="self"?" on self":" on other";Ut.add(`${q.name} cast${he?Ge:""}! Effect added to Active Spell Effects.`,"success")}tt(()=>(t(),e(se),e(V)),()=>{if(t()&&t().attacks)for(const p of t().attacks)p.spellRef&&e(se)[p.id]===void 0&&aa(se,e(se)[p.id]=!0),p.spellRef&&e(V)[p.id]===void 0&&aa(V,e(V)[p.id]="self")}),tt(()=>(t(),u()),()=>{c(x,t().attacks.filter(p=>{if(!u())return!0;const w=u().toLowerCase();return p.name.toLowerCase().includes(w)||p.damageType.toLowerCase().includes(w)}).sort((p,w)=>!p.spellRef&&w.spellRef?-1:p.spellRef&&!w.spellRef?1:0))}),tt(()=>(u(),e(x)),()=>{c(J,!u()||e(x).length>0||"attack".includes(u().toLowerCase())||"spell".includes(u().toLowerCase()))}),Vt(),Rt();var T=Tl();let Y;var Xe=n(T);{let p=it(()=>(b(),r(()=>b().attacks?"Expand":"Collapse")));la(Xe,{title:"Attacks & Spells",get collapsed(){return b(),r(()=>b().attacks)},get ariaLabel(){return e(p)},onToggle:()=>Bt.update(w=>({...w,attacks:!w.attacks}))})}var ze=s(Xe,2);{var $e=p=>{var w=Il(),q=Ue(w);{var oe=U=>{var d=al();R("click",d,Je),o(U,d)};k(q,U=>{h()&&U(oe)})}var N=s(q,2),Ce=n(N);_t(Ce,1,()=>e(x),U=>U.id,(U,d,Oe)=>{var pe=jl(),ne=n(pe),L=n(ne);{var H=A=>{var C=sl();je(C),Ne(C,()=>e(d).name,re=>(e(d).name=re,Lt(()=>(e(x),t(),u())))),o(A,C)},W=A=>{var C=ll(),re=n(C,!0);l(C),M(()=>D(re,(e(d),r(()=>e(d).name||"(Unnamed Attack)")))),o(A,C)};k(L,A=>{h()?A(H):A(W,!1)})}var Te=s(L,2);{var st=A=>{var C=nl();R("click",C,()=>ae(e(d).id)),o(A,C)};k(Te,A=>{h()&&A(st)})}l(ne);var Me=s(ne,2),fe=n(Me);{var Le=A=>{var C=rl(),re=n(C),xe=s(re,2);je(xe),l(C),M(()=>{Ke(re,"for",`attack-bonus-${e(d),r(()=>e(d).id)??""}`),Ke(xe,"id",`attack-bonus-${e(d),r(()=>e(d).id)??""}`)}),Ne(xe,()=>e(d).bonus,et=>(e(d).bonus=et,Lt(()=>(e(x),t(),u())))),o(A,C)};k(fe,A=>{e(d),r(()=>e(d).bonus!==0&&e(d).bonus!==void 0)&&A(Le)})}var Pe=s(fe,2);{var Ee=A=>{var C=il(),re=n(C),xe=s(re,2);je(xe),l(C),M(()=>{Ke(re,"for",`attack-damage-${e(d),r(()=>e(d).id)??""}`),Ke(xe,"id",`attack-damage-${e(d),r(()=>e(d).id)??""}`)}),Ne(xe,()=>e(d).damage,et=>(e(d).damage=et,Lt(()=>(e(x),t(),u())))),o(A,C)};k(Pe,A=>{e(d),r(()=>e(d).damage&&e(d).damage.trim()!=="")&&A(Ee)})}var qe=s(Pe,2),ce=n(qe),_e=s(ce,2);je(_e),l(qe),l(Me);var We=s(Me,2);{var Qe=A=>{var C=rt(),re=Ue(C);{var xe=lt=>{var z=ol();o(lt,z)},et=lt=>{const z=it(()=>(e(d),r(()=>Ae(e(d).spellRef))));var ut=rt(),S=Ue(ut);{var de=Q=>{const ye=it(()=>(E(ha),E(e(z)),r(()=>ha(e(z)))));var De=kl(),be=Ue(De),Ye=n(be),He=s(n(Ye),2),pt=n(He,!0);l(He),l(Ye);var ft=s(Ye,2);{var Gt=ot=>{var gt=vl(),St=n(gt),At=s(n(St));l(St);var Et=s(St,2),yt=s(n(Et));l(Et);var ht=s(Et,2),Ft=s(n(ht));l(ht);var Ot=s(ht,2),Zt=s(n(Ot)),vt=s(Zt);{var Ht=xt=>{var Ct=jt();M(()=>D(Ct,`(${E(e(z)),r(()=>e(z).material)??""})`)),o(xt,Ct)};k(vt,xt=>{E(e(z)),r(()=>e(z).material)&&xt(Ht)})}l(Ot);var Kt=s(Ot,2),Jt=s(n(Kt),2);{var ea=xt=>{var Ct=jt("Concentration,");o(xt,Ct)};k(Jt,xt=>{E(e(z)),r(()=>e(z).concentration)&&xt(ea)})}var wt=s(Jt,1,!0);l(Kt);var Mt=s(Kt,2),Dt=s(n(Mt));l(Mt);var Wt=s(Mt,2);{var Qt=xt=>{var Ct=cl(),zt=s(n(Ct));l(Ct),M(()=>D(zt,` ${E(e(z)),r(()=>e(z).higherLevelSlot)??""}`)),o(xt,Ct)};k(Wt,xt=>{E(e(z)),r(()=>e(z).higherLevelSlot)&&xt(Qt)})}l(gt),M(xt=>{D(At,` ${E(e(z)),r(()=>e(z).level)??""}`),D(yt,` ${E(e(z)),r(()=>e(z).castingTime||e(z).actionType)??""}`),D(Ft,` ${E(e(z)),r(()=>e(z).range)??""}`),D(Zt,` ${xt??""}`),D(wt,(E(e(z)),r(()=>e(z).duration))),D(Dt,` ${E(e(z)),r(()=>e(z).description)??""}`)},[()=>(E(e(z)),r(()=>e(z).components.join(", ")))]),o(ot,gt)};k(ft,ot=>{e(se),e(d),r(()=>!e(se)[e(d).id])&&ot(Gt)})}l(be);var nt=s(be,2);{var ct=ot=>{var gt=fl(),St=n(gt),At=n(St);je(At);var Et=s(At),yt=s(Et);{var ht=vt=>{var Ht=dl(),Kt=n(Ht);l(Ht),M(Jt=>D(Kt,`(Spell Save DC: ${Jt??""})`),[()=>(E(Ra),t(),v(),r(()=>Ra(t(),v())))]),o(vt,Ht)};k(yt,vt=>{t(),r(()=>t().class)&&vt(ht)})}var Ft=s(yt,2);{var Ot=vt=>{var Ht=ul();o(vt,Ht)},Zt=vt=>{var Ht=rt(),Kt=Ue(Ht);{var Jt=ea=>{var wt=pl();o(ea,wt)};k(Kt,ea=>{e(d),E(e(ye)),r(()=>e(d).targetSucceededSave&&e(ye).noDamageOnSave)&&ea(Jt)},!0)}o(vt,Ht)};k(Ft,vt=>{e(d),E(e(ye)),r(()=>e(d).targetSucceededSave&&e(ye).halfDamageOnSave)?vt(Ot):vt(Zt,!1)})}l(St),l(gt),M(vt=>D(Et,` Target succeeded on ${vt??""} save `),[()=>(E(e(ye)),r(()=>e(ye).ability.charAt(0).toUpperCase()+e(ye).ability.slice(1)))]),Fa(At,()=>e(d).targetSucceededSave,vt=>(e(d).targetSucceededSave=vt,Lt(()=>(e(x),t(),u())))),o(ot,gt)};k(nt,ot=>{e(ye)&&ot(ct)})}var bt=s(nt,2);{var Tt=ot=>{const gt=it(()=>(E(e(z)),r(()=>Fe(e(z)))));var St=rt(),At=Ue(St);{var Et=ht=>{var Ft=_l(),Ot=Ue(Ft),Zt=n(Ot),vt=s(Zt,2);M(()=>{e(d),Lt(()=>{e(gt)})}),_t(vt,5,()=>e(gt),kt,(wt,Mt)=>{var Dt=gl(),Wt=n(Dt);l(Dt);var Qt={};M(()=>{D(Wt,`Level ${e(Mt)??""}`),Qt!==(Qt=e(Mt))&&(Dt.value=(Dt.__value=e(Mt))??"")}),o(wt,Dt)}),l(vt);var Ht=s(vt,2);{var Kt=wt=>{const Mt=it(()=>(e(d),E(e(z)),r(()=>Se(e(d),e(z)))));var Dt=ml(),Wt=n(Dt);{var Qt=zt=>{var ta=jt("Healing");o(zt,ta)},xt=zt=>{var ta=jt("Damage");o(zt,ta)};k(Wt,zt=>{E(e(z)),r(()=>ie(e(z)))?zt(Qt):zt(xt,!1)})}var Ct=s(Wt);l(Dt),M(()=>D(Ct,` ${e(Mt)??""}`)),o(wt,Dt)};k(Ht,wt=>{e(d),E(e(z)),r(()=>e(d).castAtLevel&&e(d).castAtLevel>e(z).level)&&wt(Kt)})}l(Ot);var Jt=s(Ot,2);{var ea=wt=>{var Mt=hl(),Dt=n(Mt),Wt=n(Dt);je(Wt);var Qt=s(Wt,2);{var xt=Ct=>{const zt=it(()=>(e(d),E(e(z)),r(()=>Se(e(d),e(z)))));var ta=bl(),ls=n(ta);l(ta),M(()=>D(ls,`(+1d8, total: ${e(zt)??""})`)),o(Ct,ta)};k(Qt,Ct=>{e(d),r(()=>e(d).targetIsFiendOrUndead)&&Ct(xt)})}l(Dt),l(Mt),Fa(Wt,()=>e(d).targetIsFiendOrUndead,Ct=>(e(d).targetIsFiendOrUndead=Ct,Lt(()=>(e(x),t(),u())))),o(wt,Mt)};k(Jt,wt=>{E(e(z)),r(()=>e(z).description.includes("Fiend or an Undead"))&&wt(ea)})}M(()=>{Ke(Zt,"for",`castLevel-${e(d),r(()=>e(d).id)??""}`),Ke(vt,"id",`castLevel-${e(d),r(()=>e(d).id)??""}`)}),Aa(vt,()=>e(d).castAtLevel,wt=>(e(d).castAtLevel=wt,Lt(()=>(e(x),t(),u())))),o(ht,Ft)},yt=ht=>{var Ft=yl();o(ht,Ft)};k(At,ht=>{E(e(gt)),r(()=>e(gt).length>0)?ht(Et):ht(yt,!1)})}o(ot,St)};k(bt,ot=>{E(e(z)),r(()=>e(z).higherLevelSlot&&e(z).level>0)&&ot(Tt)})}M(()=>{Ke(He,"aria-label",(e(se),e(d),r(()=>e(se)[e(d).id]?"Expand":"Collapse"))),D(pt,(e(se),e(d),r(()=>e(se)[e(d).id]?"â–¼":"â–²")))}),R("click",Ye,()=>ue(e(d).id)),R("keydown",Ye,ot=>ot.key==="Enter"&&ue(e(d).id)),o(Q,De)},m=Q=>{var ye=Sl();o(Q,ye)};k(S,Q=>{e(z)?Q(de):Q(m,!1)})}o(lt,ut)};k(re,lt=>{e(O),r(()=>e(O).length===0)?lt(xe):lt(et,!1)})}o(A,C)};k(We,A=>{e(d),r(()=>e(d).spellRef)&&A(Qe)})}var g=s(We,2);{var I=A=>{var C=xl(),re=n(C),xe=s(re,2);da(xe),l(C),M(()=>{Ke(re,"for",`attack-notes-${e(d),r(()=>e(d).id)??""}`),Ke(xe,"id",`attack-notes-${e(d),r(()=>e(d).id)??""}`)}),Ne(xe,()=>e(d).notes,et=>(e(d).notes=et,Lt(()=>(e(x),t(),u())))),o(A,C)};k(g,A=>{e(d),r(()=>!e(d).spellRef)&&A(I)})}var ve=s(g,2),X=n(ve);{var we=A=>{const C=it(()=>(e(d),r(()=>Ae(e(d).spellRef))));var re=rt(),xe=Ue(re);{var et=lt=>{var z=rt(),ut=Ue(z);{var S=m=>{var Q=$l();R("click",Q,()=>Re(e(d))),o(m,Q)},de=m=>{var Q=rt(),ye=Ue(Q);{var De=Ye=>{var He=rt(),pt=Ue(He);{var ft=nt=>{var ct=Cl(),bt=n(ct),Tt=n(bt),ot=n(Tt);je(ot),ot.value=ot.__value="self",na(),l(Tt);var gt=s(Tt,2),St=n(gt);je(St),St.value=St.__value="other",na(),l(gt),l(bt);var At=s(bt,2),Et=n(At);l(At),l(ct),M(()=>{Ke(ot,"name",`target-${e(d),r(()=>e(d).id)??""}`),Ke(St,"name",`target-${e(d),r(()=>e(d).id)??""}`),D(Et,`Cast ${E(e(C)),r(()=>e(C).name)??""}`)}),Ua(G,[Oe],ot,()=>e(V)[e(d).id],yt=>aa(V,e(V)[e(d).id]=yt)),Ua(G,[Oe],St,()=>e(V)[e(d).id],yt=>aa(V,e(V)[e(d).id]=yt)),R("click",At,()=>_(e(d),e(V)[e(d).id])),o(nt,ct)},Gt=nt=>{var ct=Ll();R("click",ct,()=>_(e(d),"self")),o(nt,ct)};k(pt,nt=>{E(e(C)),r(()=>Z(e(C).name))?nt(ft):nt(Gt,!1)})}o(Ye,He)},be=Ye=>{var He=wl(),pt=n(He);{var ft=nt=>{var ct=jt("Roll Healing");o(nt,ct)},Gt=nt=>{var ct=jt("Roll Damage");o(nt,ct)};k(pt,nt=>{E(e(C)),r(()=>ie(e(C)))?nt(ft):nt(Gt,!1)})}l(He),M(nt=>mt(He,1,`btn ${nt??""}`),[()=>(E(e(C)),r(()=>ie(e(C))?"btn-success":"btn-secondary"))]),R("click",He,()=>Be(e(d))),o(Ye,He)};k(ye,Ye=>{E(Ka),E(e(C)),r(()=>Ka(e(C)))?Ye(De):Ye(be,!1)},!0)}o(m,Q)};k(ut,m=>{E(wa),E(e(C)),r(()=>wa(e(C)))?m(S):m(de,!1)})}o(lt,z)};k(xe,lt=>{e(C)&&lt(et)})}o(A,re)},ke=A=>{var C=rt(),re=Ue(C);{var xe=et=>{var lt=Dl(),z=Ue(lt),ut=s(z,2);R("click",z,()=>Re(e(d))),R("click",ut,()=>Be(e(d))),o(et,lt)};k(re,et=>{e(d),r(()=>!e(d).spellRef)&&et(xe)},!0)}o(A,C)};k(X,A=>{e(d),e(ge),r(()=>e(d).spellRef&&e(ge))?A(we):A(ke,!1)})}l(ve),l(pe),M(()=>{Ke(ce,"for",`attack-type-${e(d),r(()=>e(d).id)??""}`),Ke(_e,"id",`attack-type-${e(d),r(()=>e(d).id)??""}`)}),Ne(_e,()=>e(d).damageType,A=>(e(d).damageType=A,Lt(()=>(e(x),t(),u())))),o(U,pe)});var Ve=s(Ce,2);{var Ze=U=>{var d=Bl();o(U,d)},he=U=>{var d=rt(),Oe=Ue(d);{var pe=ne=>{var L=Al();o(ne,L)};k(Oe,ne=>{e(x),r(()=>e(x).length===0)&&ne(pe)},!0)}o(U,d)};k(Ve,U=>{t(),r(()=>t().attacks.length===0)?U(Ze):U(he,!1)})}l(N);var Ge=s(N,2),F=s(n(Ge),4),$=s(F,2);{var K=U=>{var d=Rl();_t(d,5,()=>(t(),r(()=>t().activeStates)),kt,(Oe,pe,ne)=>{var L=Ml(),H=n(L),W=n(H);je(W);var Te=s(W,2);{var st=ke=>{var A=Fl();R("click",A,()=>me(ne)),o(ke,A)};k(Te,ke=>{h()&&ke(st)})}l(H);var Me=s(H,2),fe=n(Me),Le=n(fe);Ke(Le,"for",`state-attack-bonus-${ne}`);var Pe=s(Le,2);je(Pe),Ke(Pe,"id",`state-attack-bonus-${ne}`),l(fe);var Ee=s(fe,2),qe=n(Ee);Ke(qe,"for",`state-damage-bonus-${ne}`);var ce=s(qe,2);je(ce),Ke(ce,"id",`state-damage-bonus-${ne}`),l(Ee);var _e=s(Ee,2),We=n(_e);Ke(We,"for",`state-target-${ne}`);var Qe=s(We,2);M(()=>{e(pe),Lt(()=>{})}),Ke(Qe,"id",`state-target-${ne}`);var g=n(Qe);g.value=g.__value="self";var I=s(g);I.value=I.__value="other",l(Qe),l(_e),l(Me);var ve=s(Me,2),X=n(ve);Ke(X,"for",`state-desc-${ne}`);var we=s(X,2);je(we),Ke(we,"id",`state-desc-${ne}`),l(ve),l(L),Ne(W,()=>e(pe).name,ke=>(e(pe).name=ke,Lt(()=>t()),ca(j,"$character"))),Ne(Pe,()=>e(pe).attackBonus,ke=>(e(pe).attackBonus=ke,Lt(()=>t()),ca(j,"$character"))),Ne(ce,()=>e(pe).damageBonus,ke=>(e(pe).damageBonus=ke,Lt(()=>t()),ca(j,"$character"))),Aa(Qe,()=>e(pe).target,ke=>(e(pe).target=ke,Lt(()=>t()),ca(j,"$character"))),Ne(we,()=>e(pe).description,ke=>(e(pe).description=ke,Lt(()=>t()),ca(j,"$character"))),o(Oe,L)}),l(d),o(U,d)},le=U=>{var d=Pl();o(U,d)};k($,U=>{t(),r(()=>t().activeStates&&t().activeStates.length>0)?U(K):U(le,!1)})}l(Ge),R("click",F,B),o(p,w)};k(ze,p=>{b(),r(()=>!b().attacks)&&p($e)})}l(T),M(()=>Y=mt(T,1,"attacks svelte-14o91c5",null,Y,{hidden:!e(J)})),o(a,T),It(),y()}var Hl=f('<span class="slot-checkbox-x svelte-serp1j">&#8212;</span>'),Ul=f('<label><input type="checkbox" class="slot-checkbox-input svelte-serp1j"/> <span><!></span></label>');function Va(a,i){Pt(i,!1);const t=()=>at(ra,"$isEditMode",v),[v,u]=qt();let b=$t(i,"checked",8,!1),h=$t(i,"disabled",8,!1),j=$t(i,"className",8,""),y=$t(i,"index",8,void 0),x=$t(i,"ariaLabel",8,void 0);const J=sa();function G(Z){J("change",{checked:Z.currentTarget.checked,index:y()})}Rt();var te=Ul(),se=n(te);je(se);var V=s(se,2),ue=n(V);{var ie=Z=>{var Je=Hl();o(Z,Je)};k(ue,Z=>{b()&&Z(ie)})}l(V),l(te),M(()=>{mt(te,1,"slot-checkbox-label "+j()+(t()?"":" not-editable"),"svelte-serp1j"),ts(se,b()),se.disabled=h()||!t(),Ke(se,"aria-label",x()),Ke(se,"tabindex",t()?0:-1),mt(V,1,`slot-checkbox-custom ${b()?"used":""} ${t()?"":"readonly"}`,"svelte-serp1j")}),R("change",se,G),o(a,te),It(),u()}var Nl=f('<p class="no-features svelte-1kpvv0n">Select a class to see available features</p>'),Gl=f('<p class="no-features svelte-1kpvv0n">No class features available at this level</p>'),Ol=f('<div class="spell-slots svelte-1kpvv0n"><label class="svelte-1kpvv0n"> </label> <div class="slots-tracker svelte-1kpvv0n"></div></div>'),ql=f('<div class="all-spell-slots"></div>'),Wl=f('<div class="feature-box spellcasting svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"> </h3> <div class="spell-stats svelte-1kpvv0n"><div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Spell Save DC</label> <div class="spell-value svelte-1kpvv0n"> </div></div> <div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <div class="spell-value svelte-1kpvv0n"> </div></div></div> <!> <div class="prepared-spells svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <textarea placeholder="List your prepared spells..." class="svelte-1kpvv0n"></textarea></div></div>'),zl=f('<p class="unlimited svelte-1kpvv0n">Unlimited Uses</p>'),Kl=f('<div class="slots-tracker svelte-1kpvv0n"></div> <div class="uses-actions-row"><button class="btn btn-primary use-enabled"> </button></div> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div>',1),Vl=f('<div class="uses-tracker svelte-1kpvv0n"><!></div>'),Jl=f('<div class="pool-tracker svelte-1kpvv0n"><input type="number" min="0" class="pool-input svelte-1kpvv0n"/> <span> </span> <button class="btn-small svelte-1kpvv0n"> </button></div>'),Ql=f('<p class="no-uses svelte-1kpvv0n">No Channel Divinity uses remaining</p>'),Yl=f('<div class="channel-divinity-option svelte-1kpvv0n"><button class="btn btn-primary use-enabled svelte-1kpvv0n">Use Channel Divinity</button> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div> <!></div>'),Xl=f('<div class="feature-box svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"><!> </h3> <p class="feature-description svelte-1kpvv0n"> </p> <!></div>'),Zl=f('<div class="features-grid svelte-1kpvv0n"><!> <!></div>'),en=f("<section><!> <!></section>");function tn(a,i){Pt(i,!1);const t=()=>at(ee,"$character",h),v=()=>at(ga,"$abilityModifiers",h),u=()=>at(Xt,"$searchFilter",h),b=()=>at(Bt,"$collapsedStates",h),[h,j]=qt(),y=P(),x=P(),J=P(),G=P(),te=P(),se=P(),V=P();let ue=P(0),ie=P(0);function Z(_,T){ee.update(Y=>(Y.classFeatures.features[_]=T,Y))}function Je(){ee.update(_=>(_.classFeatures.spellSlotsByLevel||(_.classFeatures.spellSlotsByLevel={}),e(G).forEach(({level:T,slots:Y})=>{_.classFeatures.spellSlotsByLevel[T]||(_.classFeatures.spellSlotsByLevel[T]=Array(Y).fill(!1))}),_))}function ae(_){if(typeof _.maxUses=="function"){if((_.name==="Divine Sense"||_.name==="War Priest")&&e(y)?.spellcastingAbility){const T=v()[e(y).spellcastingAbility];return _.maxUses(t().level,T)}return _.maxUses(t().level)}return _.maxUses||0}function Re(_,T){ee.update(Y=>((!Y.classFeatures.features[_]||!Array.isArray(Y.classFeatures.features[_])||Y.classFeatures.features[_].length!==T)&&(Y.classFeatures.features[_]=Array(T).fill(!1)),Y))}ns(()=>{e(se)&&t()&&t().classFeatures&&t().classFeatures.features&&e(se).forEach(_=>{if(_.type==="uses"){const T=_.name.replace(/\s+/g,""),Y=ae(_),Xe=t().classFeatures.features[T];(!Array.isArray(Xe)||Xe.length!==Y)&&Re(T,Y)}})});function Be(_){return typeof _.maxPool=="function"?_.maxPool(t().level):_.maxPool||0}function O(_){return typeof _.description=="function"?_.description(t().level):_.description}function ge(){const _="ChannelDivinity";ee.update(T=>{const Y=T.classFeatures.features[_];return typeof Y=="number"&&Y>0&&(T.classFeatures.features[_]=Y-1),T})}function Ae(){Bt.update(_=>({..._,classFeatures:!_.classFeatures}))}tt(()=>(t(),Nt),()=>{c(y,t().class?Nt(t().class):null)}),tt(()=>(t(),oa),()=>{c(x,t().class?oa(t().class,t().level,t().subclass):[])}),tt(()=>(t(),Oa),()=>{c(J,t().class?Oa(t().class,t().level):0)}),tt(()=>(e(y),t()),()=>{c(G,(()=>{if(!e(y)?.spellcaster)return[];const _=t().level,T=[];return _>=1&&T.push({level:1,slots:Math.min(4,2+Math.floor(_/3))}),_>=3&&T.push({level:2,slots:Math.min(3,2+Math.floor((_-3)/4))}),_>=5&&T.push({level:3,slots:Math.min(3,2+Math.floor((_-5)/5))}),_>=7&&T.push({level:4,slots:Math.min(3,1+Math.floor((_-7)/6))}),_>=9&&T.push({level:5,slots:Math.min(2,1+Math.floor((_-9)/8))}),_>=11&&T.push({level:6,slots:1}),_>=13&&T.push({level:7,slots:1}),_>=15&&T.push({level:8,slots:1}),_>=17&&T.push({level:9,slots:1}),T})())}),tt(()=>(e(y),v(),t(),qa),()=>{if(e(y)?.spellcaster&&e(y).spellcastingAbility){const _=v()[e(y).spellcastingAbility];c(ue,ws(t().class,_,t().proficiencyBonus)||0),c(ie,qa(t().class,t().level,_))}}),tt(()=>(t(),e(y),e(G)),()=>{t().class&&e(y)?.spellcaster&&e(G).length>0&&Je()}),tt(()=>t(),()=>{c(te,(()=>{const T=t().classFeatures.features["ChannelDivinity"];return typeof T=="number"?T:0})())}),tt(()=>(e(x),u()),()=>{c(se,e(x).filter(_=>{if(!u())return!0;const T=u().toLowerCase();return _.name.toLowerCase().includes(T)||O(_).toLowerCase().includes(T)}))}),tt(()=>(u(),t(),e(se)),()=>{c(V,!u()||t().class||"class features".includes(u().toLowerCase())||"spellcasting".includes(u().toLowerCase())||e(se).length>0)}),Vt(),Rt();var Ie=en();let Se;var Fe=n(Ie);{let _=it(()=>(b(),r(()=>b().classFeatures?"Expand":"Collapse")));la(Fe,{title:"Class Features",get collapsed(){return b(),r(()=>b().classFeatures)},get ariaLabel(){return e(_)},onToggle:Ae})}var B=s(Fe,2);{var me=_=>{var T=rt(),Y=Ue(T);{var Xe=$e=>{var p=Nl();o($e,p)},ze=$e=>{var p=rt(),w=Ue(p);{var q=N=>{var Ce=Gl();o(N,Ce)},oe=N=>{var Ce=Zl(),Ve=n(Ce);{var Ze=Ge=>{var F=Wl(),$=n(F),K=n($);l($);var le=s($,2),U=n(le),d=s(n(U),2),Oe=n(d,!0);l(d),l(U);var pe=s(U,2),ne=s(n(pe),2),L=n(ne,!0);l(ne),l(pe),l(le);var H=s(le,2);{var W=Me=>{var fe=ql();_t(fe,5,()=>e(G),kt,(Le,Pe)=>{let Ee=()=>e(Pe).level,qe=()=>e(Pe).slots;const ce=it(()=>(t(),Ee(),qe(),r(()=>t().classFeatures.spellSlotsByLevel?.[Ee()]||Array(qe()).fill(!1))));var _e=Ol(),We=n(_e),Qe=n(We);l(We);var g=s(We,2);_t(g,5,()=>e(ce),kt,(I,ve,X)=>{{let we=it(()=>(E(e(ce)),r(()=>e(ce)[X]||!1)));Va(I,{get checked(){return e(we)},$$events:{change:ke=>{ee.update(A=>(A.classFeatures.spellSlotsByLevel||(A.classFeatures.spellSlotsByLevel={}),A.classFeatures.spellSlotsByLevel[Ee()]||(A.classFeatures.spellSlotsByLevel[Ee()]=Array(qe()).fill(!1)),A.classFeatures.spellSlotsByLevel[Ee()][X]=ke.detail.checked,A))}}})}}),l(g),l(_e),M(()=>D(Qe,`${Ee()===1?"1st":Ee()===2?"2nd":Ee()===3?"3rd":`${Ee()}th`} Level Spell Slots`)),o(Le,_e)}),l(fe),o(Me,fe)};k(H,Me=>{e(G),r(()=>e(G).length>0)&&Me(W)})}var Te=s(H,2),st=s(n(Te),2);da(st),l(Te),l(F),M(Me=>{D(K,`Spellcasting (${Me??""})`),D(Oe,e(ue)),D(L,e(ie))},[()=>(e(y),r(()=>e(y).spellcastingAbility?.toUpperCase()))]),Ne(st,()=>t().classFeatures.preparedSpells,Me=>dt(ee,r(t).classFeatures.preparedSpells=Me,r(t))),o(Ge,F)};k(Ve,Ge=>{e(y),r(()=>e(y)?.spellcaster)&&Ge(Ze)})}var he=s(Ve,2);_t(he,1,()=>e(se),kt,(Ge,F)=>{const $=it(()=>(e(F),r(()=>e(F).name.replace(/\s+/g,"")))),K=it(()=>(t(),E(e($)),r(()=>t().classFeatures.features[e($)]))),le=it(()=>typeof e(K)=="number");var U=Xl(),d=n(U),Oe=n(d);{var pe=Me=>{var fe=jt("Channel Divinity:");o(Me,fe)};k(Oe,Me=>{e(F),r(()=>e(F).type==="channelDivinity")&&Me(pe)})}var ne=s(Oe);l(d);var L=s(d,2),H=n(L,!0);l(L);var W=s(L,2);{var Te=Me=>{const fe=it(()=>(e(F),r(()=>ae(e(F))))),Le=it(()=>(E(e(K)),E(e(fe)),r(()=>Array.isArray(e(K))?e(K):Array(e(fe)).fill(!1))));var Pe=Vl(),Ee=n(Pe);{var qe=_e=>{var We=zl();o(_e,We)},ce=_e=>{var We=Kl(),Qe=Ue(We);_t(Qe,5,()=>e(Le),kt,(A,C,re)=>{Va(A,{get checked(){return e(C)},index:re,$$events:{change:xe=>{ee.update(et=>(et.classFeatures.features[e($)]||(et.classFeatures.features[e($)]=Array(e(fe)).fill(!1)),et.classFeatures.features[e($)][re]=xe.detail.checked,et))}}})}),l(Qe);var g=s(Qe,2),I=n(g),ve=n(I);l(I),l(g);var X=s(g,2),we=n(X),ke=n(we);l(we),l(X),M(A=>{I.disabled=A,D(ve,`Use ${e(F),r(()=>e(F).name)??""}`),D(ke,`Resets on ${e(F),r(()=>e(F).resetOn==="short"?"Short Rest":"Long Rest")??""}`)},[()=>(E(e(Le)),r(()=>e(Le).filter(A=>!A).length<=0))]),R("click",I,()=>{ee.update(A=>{A.classFeatures.features[e($)]||(A.classFeatures.features[e($)]=Array(e(fe)).fill(!1));const C=A.classFeatures.features[e($)],re=C.findIndex(xe=>!xe);return re!==-1&&(C[re]=!0),A})}),o(_e,We)};k(Ee,_e=>{e(fe)===1/0?_e(qe):_e(ce,!1)})}l(Pe),o(Me,Pe)},st=Me=>{var fe=rt(),Le=Ue(fe);{var Pe=qe=>{const ce=it(()=>(e(F),r(()=>Be(e(F)))));var _e=Jl(),We=n(_e);je(We);var Qe=s(We,2),g=n(Qe);l(Qe);var I=s(Qe,2),ve=n(I,!0);l(I),l(_e),M(()=>{ya(We,e(le)&&e(K)!==void 0?e(K):e(ce)),Ke(We,"max",e(ce)),D(g,`/ ${e(ce)??""}`),D(ve,(e(F),r(()=>e(F).resetOn==="short"?"Short Rest":"Long Rest")))}),R("input",We,X=>{ee.update(we=>(we.classFeatures.features[e($)]=parseInt(X.currentTarget.value)||0,we))}),R("click",I,()=>Z(e($),e(ce))),o(qe,_e)},Ee=qe=>{var ce=rt(),_e=Ue(ce);{var We=Qe=>{var g=Yl(),I=n(g),ve=s(I,2),X=n(ve),we=n(X);l(X),l(ve);var ke=s(ve,2);{var A=C=>{var re=Ql();o(C,re)};k(ke,C=>{e(te)<=0&&C(A)})}l(g),M(()=>{I.disabled=e(te)<=0,D(we,`Resets on ${e(F),r(()=>e(F).resetOn==="short"?"Short Rest":"Long Rest")??""}`)}),R("click",I,ge),o(Qe,g)};k(_e,Qe=>{e(F),r(()=>e(F).type==="channelDivinity")&&Qe(We)},!0)}o(qe,ce)};k(Le,qe=>{e(F),r(()=>e(F).type==="pool")?qe(Pe):qe(Ee,!1)},!0)}o(Me,fe)};k(W,Me=>{e(F),r(()=>e(F).type==="uses")?Me(Te):Me(st,!1)})}l(U),M(Me=>{D(ne,` ${e(F),r(()=>e(F).name)??""}`),D(H,Me)},[()=>(e(F),r(()=>O(e(F))))]),o(Ge,U)}),l(Ce),o(N,Ce)};k(w,N=>{e(x),r(()=>e(x).length===0)?N(q):N(oe,!1)},!0)}o($e,p)};k(Y,$e=>{t(),r(()=>!t().class)?$e(Xe):$e(ze,!1)})}o(_,T)};k(B,_=>{b(),r(()=>!b().classFeatures)&&_(me)})}l(Ie),M(()=>Se=mt(Ie,1,"class-features svelte-1kpvv0n",null,Se,{hidden:!e(V)})),o(a,Ie),It(),j()}var an=f('<textarea placeholder="Enter features, traits, and special abilities..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Equipment</h3> <textarea placeholder="List your equipment and inventory..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Notes</h3> <textarea placeholder="Additional notes..." class="svelte-wttn0l"></textarea>',1),sn=f("<section><!> <!></section>");function ln(a,i){Pt(i,!1);const t=()=>at(Xt,"$searchFilter",b),v=()=>at(ee,"$character",b),u=()=>at(Bt,"$collapsedStates",b),[b,h]=qt(),j=P();function y(){Bt.update(V=>({...V,notes:!V.notes}))}tt(()=>(t(),v()),()=>{c(j,!t()||"features".includes(t().toLowerCase())||"traits".includes(t().toLowerCase())||"equipment".includes(t().toLowerCase())||"notes".includes(t().toLowerCase())||v().features.toLowerCase().includes(t().toLowerCase())||v().equipment.toLowerCase().includes(t().toLowerCase())||v().notes.toLowerCase().includes(t().toLowerCase()))}),Vt(),Rt();var x=sn();let J;var G=n(x);{let V=it(()=>(u(),r(()=>u().notes?"Expand":"Collapse")));la(G,{title:"Features & Traits",get collapsed(){return u(),r(()=>u().notes)},get ariaLabel(){return e(V)},onToggle:y})}var te=s(G,2);{var se=V=>{var ue=an(),ie=Ue(ue);da(ie);var Z=s(ie,4);da(Z);var Je=s(Z,4);da(Je),Ne(ie,()=>v().features,ae=>dt(ee,r(v).features=ae,r(v))),Ne(Z,()=>v().equipment,ae=>dt(ee,r(v).equipment=ae,r(v))),Ne(Je,()=>v().notes,ae=>dt(ee,r(v).notes=ae,r(v))),o(V,ue)};k(te,V=>{u(),r(()=>!u().notes)&&V(se)})}l(x),M(()=>J=mt(x,1,"notes svelte-wttn0l",null,J,{hidden:!e(j)})),o(a,x),It(),h()}var nn=f('<div class="color-picker-section svelte-1r90jgp"><h3 class="svelte-1r90jgp">Dice Colors</h3> <div class="color-inputs svelte-1r90jgp"><div class="color-input-group svelte-1r90jgp"><label for="dice-color" class="svelte-1r90jgp">Dice Color</label> <input type="color" id="dice-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="label-color" class="svelte-1r90jgp">Label Color</label> <input type="color" id="label-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="desk-color" class="svelte-1r90jgp">Background Color</label> <input type="color" id="desk-color" class="svelte-1r90jgp"/></div></div></div>'),rn=f('<div class="loading svelte-1r90jgp"><p class="svelte-1r90jgp">Loading 3D dice...</p></div>'),on=f('<div class="custom-dice-selector svelte-1r90jgp"><h3 class="svelte-1r90jgp">Choose Dice to Roll</h3> <div class="dice-inputs svelte-1r90jgp"><div class="dice-input-group svelte-1r90jgp"><label for="d4" class="svelte-1r90jgp">d4</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d4" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d6" class="svelte-1r90jgp">d6</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d6" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d8" class="svelte-1r90jgp">d8</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d8" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d10" class="svelte-1r90jgp">d10</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d10" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d12" class="svelte-1r90jgp">d12</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d12" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d20" class="svelte-1r90jgp">d20</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d20" min="0" max="10"/></div></div> <div class="dice-controls svelte-1r90jgp"><button class="btn btn-primary use-enabled svelte-1r90jgp"> </button> <button class="btn btn-secondary use-enabled svelte-1r90jgp">Reset</button></div></div>'),cn=f('<span class="crit-badge svelte-1r90jgp">CRITICAL!</span>'),vn=f('<div class="bonus-item svelte-1r90jgp"><span class="bonus-value svelte-1r90jgp"> </span> <span class="bonus-source svelte-1r90jgp"> </span></div>'),dn=f('<div class="bonus-breakdown svelte-1r90jgp"></div>'),un=f('<p class="modifier-text svelte-1r90jgp"> </p>'),pn=f('<button class="btn btn-follow-up svelte-1r90jgp"> </button>'),fn=f('<button class="btn btn-guided-strike svelte-1r90jgp">âš¡ Use Guided Strike (+10)</button>'),gn=f('<div class="follow-up-actions svelte-1r90jgp"><!> <!></div>'),mn=f('<div class="result-header svelte-1r90jgp"><h3 class="svelte-1r90jgp"> </h3> <!></div> <div class="result-total svelte-1r90jgp"> </div> <div class="result-details svelte-1r90jgp"><!></div> <!>',1),bn=f('<div role="button" tabindex="-1"><div class="modal-content svelte-1r90jgp" role="dialog" tabindex="0"><div class="modal-header svelte-1r90jgp"><h2 class="svelte-1r90jgp">Dice Roller</h2> <div class="header-buttons svelte-1r90jgp"><button class="color-btn svelte-1r90jgp" title="Customize dice colors">ðŸŽ¨</button> <button class="close-btn svelte-1r90jgp">Ã—</button></div></div> <!> <!> <div class="dice-main-area svelte-1r90jgp"><div class="dice-container svelte-1r90jgp"></div> <!></div> <div><!></div></div></div>');function hn(a,i){Pt(i,!1);const t=()=>at(ee,"$character",v),[v,u]=qt(),b=P(),h=P(),j=P(),y=sa();let x=$t(i,"notation",12,""),J=$t(i,"visible",8,!1),G=$t(i,"damageNotation",12,""),te=$t(i,"attackName",12,""),se=$t(i,"applyHalfDamage",8,!1),V=$t(i,"bonusBreakdown",28,()=>[]),ue=null,ie=P(void 0),Z=P(!1),Je=P(""),ae=P(null);function Re(){return e(ae)?.resultTotal??null}function Be(g,I,ve){const X=[];if(!g||!g.result)return X;const we=I.match(/([+-]?\d*d\d+|[+-]?\d+)/g)||[];let ke=0;const A=new Set;for(const C of we){const re=C.trim();if(!re)continue;const xe=re.match(/([+-]?)(\d*)d(\d+)/);if(xe){const et=parseInt(xe[2]||"1"),lt=`${et}d${xe[3]}`,z=ve.findIndex((de,m)=>!A.has(m)&&typeof de.value=="string"&&de.value===lt),ut=[];for(let de=0;de<et&&ke<g.result.length;de++)ut.push(g.result[ke++]);const S=z>=0?ve[z].source:"base die";z>=0&&A.add(z);for(const de of ut)X.push({display:`${de}`,source:S})}}for(let C=0;C<ve.length;C++)if(!A.has(C)&&typeof ve[C].value=="number"){const re=ve[C].value;X.push({display:re>=0?`+${re}`:`${re}`,source:ve[C].source})}return X}let O=P(0),ge=P(0),Ae=P(0),Ie=P(0),Se=P(0),Fe=P(0),B=P(0),me=P([]),_=P(!1),T=P("other"),Y=P(!1),Xe=P("#051e0a"),ze=P("#ffffff"),$e=P("#3a2004"),p=P(!1);function w(g){return g.length===9&&g.startsWith("#")?g.substring(0,7):g}function q(g,I="ff"){return g.length===7&&g.startsWith("#")?g+I:g}function oe(){if(window.DICE&&e(ie))try{ue&&e(ie)&&aa(ie,e(ie).innerHTML="");const g=e(ie).clientWidth||500,I=e(ie).clientHeight||300;ue=new window.DICE.dice_box(e(ie),{w:g,h:I}),c(Z,!0)}catch(g){console.error("Error initializing dice box:",g)}}pa(()=>{const g=X=>new Promise((we,ke)=>{if(document.querySelector(`script[src="${X}"]`)){we(null);return}const C=document.createElement("script");C.src=X,C.onload=()=>{we(null)},C.onerror=()=>{console.error(`Failed to load: ${X}`),ke(new Error(`Failed to load ${X}`))},document.head.appendChild(C)});setTimeout(()=>{g(`${va}/libs/three.min.js`).then(()=>g(`${va}/libs/cannon.min.js`)).then(()=>g(`${va}/libs/teal.js`)).then(()=>g(`${va}/dice.js`)).then(()=>{if(window.DICE){const X=window.DICE.getColors();c(Xe,w(X.dice_color)),c(ze,w(X.label_color)),c($e,w(X.desk_color))}oe()}).catch(X=>{console.error("Failed to load dice libraries:",X)})},100);const I=()=>{e(Z)&&oe()},ve=X=>{J()&&X.key==="Escape"&&K()};return window.addEventListener("resize",I),window.addEventListener("keydown",ve),()=>{window.removeEventListener("resize",I),window.removeEventListener("keydown",ve)}});function N(g,I="other"){if(!ue||!e(Z))return;c(ae,null),c(me,[]),c(_,!1),I==="damage"&&V([]),c(T,I),c(Y,!1),ue.diceToRoll=g;const ve=we=>null,X=we=>{let ke=we.resultTotal,A=we.resultString;if(se()&&(ke=Math.floor(ke/2),A=A+" (halved)"),c(ae,{...we,resultTotal:ke,resultString:A}),I==="attack"||I==="check"||I==="save"){const C=we.result?.filter(re=>re===20)||[];if(C.length>0){const re=C[0];c(_,re===20)}}if(c(me,[]),console.log("Setting up follow-up actions. Type:",I,"damageNotation:",G(),"isCritical:",e(_)),I==="attack"&&G())if(e(_)){const C=Ze(G());e(me).push({label:`Roll Critical Damage (${C})`,notation:C})}else e(me).push({label:`Roll Damage (${G()})`,notation:G()})};ue.start_throw(ve,X)}function Ce(){const g=[];e(O)>0&&g.push(`${e(O)}d4`),e(ge)>0&&g.push(`${e(ge)}d6`),e(Ae)>0&&g.push(`${e(Ae)}d8`),e(Ie)>0&&g.push(`${e(Ie)}d10`),e(Se)>0&&g.push(`${e(Se)}d12`),e(Fe)>0&&g.push(`${e(Fe)}d20`);let I=g.join("+")||"1d20";return e(B)!==0&&(I+=e(B)>=0?`+${e(B)}`:`${e(B)}`),I}function Ve(){const g=Ce();N(g)}function Ze(g){return g.replace(/(\d+)d(\d+)/g,(I,ve,X)=>`${parseInt(ve)*2}d${X}`)}function he(){c(O,0),c(ge,0),c(Ae,0),c(Ie,0),c(Se,0),c(Fe,0),c(B,0),c(ae,null),c(me,[]),c(_,!1),c(T,"other"),c(Y,!1)}function Ge(){window.DICE&&(window.DICE.setColors({dice_color:q(e(Xe),"ff"),label_color:q(e(ze),"ff"),desk_color:e($e)}),ue&&(ue.updateDeskColor(e($e)),ue.updateDiceColors()))}function F(){c(p,!e(p))}function $(){!e(ae)||e(h)<=0||e(Y)||(c(ae,{...e(ae),resultTotal:e(ae).resultTotal+10,resultString:e(ae).resultString+" + 10 (Guided Strike)"}),ee.update(g=>{const I="ChannelDivinity",ve=g.classFeatures.features[I];return typeof ve=="number"&&ve>0&&(g.classFeatures.features[I]=ve-1),g}),c(Y,!0))}function K(){y("close"),x(""),G(""),te(""),c(Je,""),c(ae,null),c(Y,!1),he()}tt(()=>(t(),oa),()=>{c(b,t().class?oa(t().class,t().level,t().subclass).some(I=>I.name==="Guided Strike"):!1)}),tt(()=>t(),()=>{c(h,(()=>{const I=t().classFeatures.features["ChannelDivinity"];return typeof I=="number"?I:0})())}),tt(()=>(e(O),e(ge),e(Ae),e(Ie),e(Se),e(Fe),e(B)),()=>{c(j,(()=>{const g=[];e(O)>0&&g.push(`${e(O)}d4`),e(ge)>0&&g.push(`${e(ge)}d6`),e(Ae)>0&&g.push(`${e(Ae)}d8`),e(Ie)>0&&g.push(`${e(Ie)}d10`),e(Se)>0&&g.push(`${e(Se)}d12`),e(Fe)>0&&g.push(`${e(Fe)}d20`);let I=g.join("+")||"1d20";return e(B)!==0&&(I+=e(B)>=0?`+${e(B)}`:`${e(B)}`),I})())}),tt(()=>(E(x()),e(Z),E(J()),e(Je),E(G()),E(te())),()=>{if(x()&&e(Z)&&J()&&x()!==e(Je)){c(Je,x()),c(ae,null),c(me,[]),c(_,!1),c(Y,!1);const g=x().includes("1d20")?"attack":"other";console.log("Auto-roll triggered. notation:",x(),"damageNotation:",G(),"attackName:",te()),setTimeout(()=>N(x(),g),200)}}),Vt();var le={getLastRollTotal:Re};Rt();var U=bn();let d;var Oe=n(U),pe=n(Oe),ne=s(n(pe),2),L=n(ne),H=s(L,2);l(ne),l(pe);var W=s(pe,2);{var Te=g=>{var I=nn(),ve=s(n(I),2),X=n(ve),we=s(n(X),2);je(we),l(X);var ke=s(X,2),A=s(n(ke),2);je(A),l(ke);var C=s(ke,2),re=s(n(C),2);je(re),l(C),l(ve),l(I),Ne(we,()=>e(Xe),xe=>c(Xe,xe)),R("change",we,Ge),Ne(A,()=>e(ze),xe=>c(ze,xe)),R("change",A,Ge),Ne(re,()=>e($e),xe=>c($e,xe)),R("change",re,Ge),o(g,I)};k(W,g=>{e(p)&&g(Te)})}var st=s(W,2);{var Me=g=>{var I=rn();o(g,I)};k(st,g=>{e(Z)||g(Me)})}var fe=s(st,2),Le=n(fe);ja(Le,g=>c(ie,g),()=>e(ie));var Pe=s(Le,2);{var Ee=g=>{var I=on(),ve=s(n(I),2),X=n(ve),we=s(n(X),2);je(we),l(X);var ke=s(X,2),A=s(n(ke),2);je(A),l(ke);var C=s(ke,2),re=s(n(C),2);je(re),l(C);var xe=s(C,2),et=s(n(xe),2);je(et),l(xe);var lt=s(xe,2),z=s(n(lt),2);je(z),l(lt);var ut=s(lt,2),S=s(n(ut),2);je(S),l(ut),l(ve);var de=s(ve,2),m=n(de),Q=n(m);l(m);var ye=s(m,2);l(de),l(I),M(()=>{m.disabled=!e(Z),D(Q,`Roll ${e(j)??""}`)}),Ne(we,()=>e(O),De=>c(O,De)),Ne(A,()=>e(ge),De=>c(ge,De)),Ne(re,()=>e(Ae),De=>c(Ae,De)),Ne(et,()=>e(Ie),De=>c(Ie,De)),Ne(z,()=>e(Se),De=>c(Se,De)),Ne(S,()=>e(Fe),De=>c(Fe,De)),R("click",m,Ve),R("click",ye,he),o(g,I)};k(Pe,g=>{x()||g(Ee)})}l(fe);var qe=s(fe,2);let ce;var _e=n(qe);{var We=g=>{var I=mn(),ve=Ue(I),X=n(ve),we=n(X,!0);l(X);var ke=s(X,2);{var A=S=>{var de=cn();o(S,de)};k(ke,S=>{e(_)&&S(A)})}l(ve);var C=s(ve,2),re=n(C,!0);l(C);var xe=s(C,2),et=n(xe);{var lt=S=>{var de=rt(),m=Ue(de);{var Q=De=>{var be=dn();_t(be,5,()=>(e(ae),E(x()),E(V()),r(()=>Be(e(ae),x(),V()))),kt,(Ye,He)=>{var pt=vn(),ft=n(pt),Gt=n(ft,!0);l(ft);var nt=s(ft,2),ct=n(nt);l(nt),l(pt),M(()=>{D(Gt,(e(He),r(()=>e(He).display))),D(ct,`(${e(He),r(()=>e(He).source)??""})`)}),o(Ye,pt)}),l(be),o(De,be)},ye=De=>{var be=rt(),Ye=Ue(be);{var He=pt=>{var ft=un(),Gt=n(ft);l(ft),M(()=>D(Gt,`Modifier: ${e(ae),r(()=>e(ae).constant>=0?"+":"")??""}${e(ae),r(()=>e(ae).constant)??""}`)),o(pt,ft)};k(Ye,pt=>{e(ae),r(()=>e(ae).constant)&&pt(He)},!0)}o(De,be)};k(m,De=>{E(V()),r(()=>V().length>0)?De(Q):De(ye,!1)})}o(S,de)};k(et,S=>{e(ae),E(V()),r(()=>e(ae).constant||V().length>0)&&S(lt)})}l(xe);var z=s(xe,2);{var ut=S=>{var de=gn(),m=n(de);_t(m,1,()=>e(me),kt,(De,be)=>{var Ye=pn(),He=n(Ye,!0);l(Ye),M(()=>D(He,(e(be),r(()=>e(be).label)))),R("click",Ye,()=>N(e(be).notation,"damage")),o(De,Ye)});var Q=s(m,2);{var ye=De=>{var be=fn();M(()=>{be.disabled=e(h)<=0,Ke(be,"title",e(h)<=0?"No Channel Divinity uses remaining":"Use Channel Divinity to add +10 to this attack roll")}),R("click",be,$),o(De,be)};k(Q,De=>{e(b)&&e(T)==="attack"&&!e(Y)&&De(ye)})}l(de),o(S,de)};k(z,S=>{e(me),e(b),e(T),e(Y),r(()=>e(me).length>0||e(b)&&e(T)==="attack"&&!e(Y))&&S(ut)})}M(()=>{D(we,te()?`${te()} - Result`:"Result"),D(re,(e(ae),r(()=>e(ae).resultTotal)))}),o(g,I)};k(_e,g=>{e(ae)&&g(We)})}l(qe),l(Oe),l(U),M(()=>{d=mt(U,1,"modal-overlay svelte-1r90jgp",null,d,{hidden:!J()}),ce=mt(qe,1,"roll-result svelte-1r90jgp",null,ce,{"has-result":e(ae)})}),R("click",L,F),R("click",H,K),R("click",Oe,Ea(function(g){ia.call(this,i,g)})),R("keydown",Oe,function(g){ia.call(this,i,g)}),R("click",U,K),R("keydown",U,g=>g.key==="Escape"&&K()),o(a,U),Cs(i,"getLastRollTotal",Re);var Qe=It(le);return u(),Qe}const Sa="https://api.github.com/gists";async function _n(a,i,t){if(!i)throw new Error("GitHub token is required");const v=JSON.stringify(a,null,2),u=`${a.name||"character"}_dnd.json`,b={description:t||`D&D Character: ${a.name}`,public:!1,files:{[u]:{content:v}}},h=await fetch(Sa,{method:"POST",headers:{Authorization:`token ${i}`,"Content-Type":"application/json"},body:JSON.stringify(b)});if(!h.ok)throw new Error(`Failed to create gist: ${h.statusText}`);return(await h.json()).id}async function yn(a,i,t){if(!i||!t)throw new Error("GitHub token and Gist ID are required");const v=JSON.stringify(a,null,2),b={files:{[`${a.name||"character"}_dnd.json`]:{content:v}}},h=await fetch(`${Sa}/${t}`,{method:"PATCH",headers:{Authorization:`token ${i}`,"Content-Type":"application/json"},body:JSON.stringify(b)});if(!h.ok)throw new Error(`Failed to update gist: ${h.statusText}`)}async function kn(a,i){if(!a)throw new Error("Gist ID is required");const t={"Content-Type":"application/json"};i&&(t.Authorization=`token ${i}`);const v=await fetch(`${Sa}/${a}`,{method:"GET",headers:t});if(!v.ok)throw new Error(`Failed to load gist: ${v.statusText}`);const u=await v.json(),b=Object.values(u.files);if(b.length===0)throw new Error("No files found in gist");const j=b[0].content;try{const y=JSON.parse(j);return y.attacks&&Array.isArray(y.attacks)&&(y.attacks=y.attacks.map(x=>({...x,id:x.id||crypto.randomUUID()}))),y.classFeatures?(y.classFeatures.features||(y.classFeatures.features={}),y.classFeatures.spellSlots||(y.classFeatures.spellSlots=[]),y.classFeatures.preparedSpells===void 0&&(y.classFeatures.preparedSpells="")):y.classFeatures={features:{},spellSlots:[],preparedSpells:""},y}catch{throw new Error("Invalid character data in gist")}}function Ja(a){typeof window<"u"&&localStorage.setItem("dnd_gist_config",JSON.stringify(a))}function Sn(){if(typeof window<"u"){const a=localStorage.getItem("dnd_gist_config");if(a)return JSON.parse(a)}return{}}async function xn(a,i=30){if(!a)throw new Error("GitHub token is required to list gists");const t=await fetch(`${Sa}?per_page=${i}`,{method:"GET",headers:{Authorization:`token ${a}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error(`Failed to list gists: ${t.statusText}`);return await t.json()}var $n=f('<div class="error-message svelte-1jb5ckg"> </div>'),Cn=f('<div class="toggle-container svelte-1jb5ckg"><button type="button" class="toggle-btn svelte-1jb5ckg"> </button></div>'),Ln=f('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID (leave empty to create new)</label> <input type="text" id="gistId" placeholder="Optional: existing Gist ID to update" class="svelte-1jb5ckg"/></div>'),wn=f('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),Dn=f('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),jn=f('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Update (or leave unselected to create new)</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),Bn=f('<div class="info-message svelte-1jb5ckg">No gists found. A new one will be created.</div>'),An=f('<!> <div class="form-group svelte-1jb5ckg"><label for="description" class="svelte-1jb5ckg"> </label> <input type="text" id="description" placeholder="D&amp;D Character Sheet" class="svelte-1jb5ckg"/></div>',1),Fn=f('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID *</label> <input type="text" id="gistId" placeholder="Enter Gist ID (for public or your private gists)" required class="svelte-1jb5ckg"/></div>'),Mn=f('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),Rn=f('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),Pn=f('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Load</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),In=f('<div class="info-message svelte-1jb5ckg">No gists found. Enter a Gist ID manually or create a new one in Save mode.</div>'),Tn=f('<div class="modal-overlay svelte-1jb5ckg" role="button" tabindex="-1"><div class="modal-content svelte-1jb5ckg" role="dialog" tabindex="0"><div class="modal-header svelte-1jb5ckg"><h2 class="svelte-1jb5ckg"> </h2> <button class="close-btn svelte-1jb5ckg">Ã—</button></div> <div class="modal-body svelte-1jb5ckg"><!> <div class="form-group svelte-1jb5ckg"><label for="token" class="svelte-1jb5ckg"> <a href="https://github.com/settings/tokens" target="_blank" rel="noopener" class="svelte-1jb5ckg">Get token</a></label> <input type="password" id="token" placeholder="ghp_xxxxxxxxxxxxx" class="svelte-1jb5ckg"/></div> <!> <!> <div class="modal-actions svelte-1jb5ckg"><button class="btn btn-primary svelte-1jb5ckg"><!></button> <button class="btn btn-secondary svelte-1jb5ckg">Cancel</button></div></div></div></div>');function En(a,i){Pt(i,!1);const t=()=>at(ee,"$character",v),[v,u]=qt(),b=sa();let h=$t(i,"mode",8,"save"),j=P(""),y=P(""),x=P(""),J=P(!1),G=P(""),te=P(!1),se=P(!1),V=P([]),ue=P(null);const ie=Sn();ie.token&&c(j,ie.token),ie.gistId&&c(y,ie.gistId),pa(async()=>{e(j)&&!e(te)&&await Z()});async function Z(){if(e(j)){c(se,!0),c(G,"");try{c(V,await xn(e(j))),e(y)&&c(ue,e(V).find($=>$.id===e(y))||null)}catch($){c(G,$.message||"Failed to load gists"),c(V,[])}finally{c(se,!1)}}}function Je($){c(ue,$),c(y,$.id)}function ae(){c(te,!e(te)),c(G,""),!e(te)&&e(j)&&Z()}async function Re(){if(!e(j)){c(G,"GitHub token is required");return}const $=e(ue)?.id||e(y);c(J,!0),c(G,"");try{if($)await yn(t(),e(j),$),c(y,$),Ut.add("Character updated in Gist successfully!","success");else{const K=await _n(t(),e(j),e(x));c(y,K),Ut.add(`Character saved to Gist! ID: ${K}`,"success")}Ja({token:e(j),gistId:e(y)}),b("close")}catch(K){c(G,K.message||"Failed to save to Gist")}finally{c(J,!1)}}async function Be(){const $=e(ue)?.id||e(y);if(!$){c(G,"Please select a gist or enter a Gist ID");return}c(J,!0),c(G,"");try{const K=await kn($,e(j)||void 0);ee.set(K),c(y,$),Ja({token:e(j),gistId:e(y)}),Ut.add("Character loaded from Gist successfully!","success"),b("close")}catch(K){c(G,K.message||"Failed to load from Gist")}finally{c(J,!1)}}function O(){b("close")}Rt();var ge=Tn(),Ae=n(ge),Ie=n(Ae),Se=n(Ie),Fe=n(Se,!0);l(Se);var B=s(Se,2);l(Ie);var me=s(Ie,2),_=n(me);{var T=$=>{var K=$n(),le=n(K,!0);l(K),M(()=>D(le,e(G))),o($,K)};k(_,$=>{e(G)&&$(T)})}var Y=s(_,2),Xe=n(Y),ze=n(Xe);na(),l(Xe);var $e=s(Xe,2);je($e),l(Y);var p=s(Y,2);{var w=$=>{var K=Cn(),le=n(K),U=n(le,!0);l(le),l(K),M(()=>{le.disabled=e(J),D(U,e(te)?"ðŸ“‹ Show My Gists":"âœï¸ Enter Gist ID Manually")}),R("click",le,ae),o($,K)};k(p,$=>{(h()==="load"||h()==="save"&&e(j))&&$(w)})}var q=s(p,2);{var oe=$=>{var K=An(),le=Ue(K);{var U=H=>{var W=Ln(),Te=s(n(W),2);je(Te),l(W),M(()=>Te.disabled=e(J)),Ne(Te,()=>e(y),st=>c(y,st)),o(H,W)},d=H=>{var W=rt(),Te=Ue(W);{var st=fe=>{var Le=wn();o(fe,Le)},Me=fe=>{var Le=rt(),Pe=Ue(Le);{var Ee=ce=>{var _e=jn(),We=s(n(_e),2);_t(We,5,()=>e(V),kt,(Qe,g)=>{var I=Dn();let ve;var X=n(I),we=n(X),ke=n(we,!0);l(we);var A=s(we,2),C=n(A,!0);l(A),l(X);var re=s(X,2),xe=n(re),et=n(xe);l(xe);var lt=s(xe,2),z=n(lt);l(lt),l(re),l(I),M(ut=>{ve=mt(I,1,"gist-item svelte-1jb5ckg",null,ve,{selected:e(ue)?.id===e(g).id}),I.disabled=e(J),D(ke,(e(g),r(()=>e(g).description||"Untitled"))),D(C,(e(g),r(()=>e(g).public?"ðŸŒ Public":"ðŸ”’ Private"))),D(et,`ID: ${e(g),r(()=>e(g).id)??""}`),D(z,`Updated: ${ut??""}`)},[()=>(e(g),r(()=>new Date(e(g).updated_at).toLocaleDateString()))]),R("click",I,()=>Je(e(g))),o(Qe,I)}),l(We),l(_e),o(ce,_e)},qe=ce=>{var _e=rt(),We=Ue(_e);{var Qe=g=>{var I=Bn();o(g,I)};k(We,g=>{e(j)&&g(Qe)},!0)}o(ce,_e)};k(Pe,ce=>{e(V),r(()=>e(V).length>0)?ce(Ee):ce(qe,!1)},!0)}o(fe,Le)};k(Te,fe=>{e(se)?fe(st):fe(Me,!1)},!0)}o(H,W)};k(le,H=>{e(te)||!e(j)?H(U):H(d,!1)})}var Oe=s(le,2),pe=n(Oe),ne=n(pe);l(pe);var L=s(pe,2);je(L),l(Oe),M(()=>{D(ne,`Description ${e(y)?"(optional)":""}`),L.disabled=e(J)}),Ne(L,()=>e(x),H=>c(x,H)),o($,K)},N=$=>{var K=rt(),le=Ue(K);{var U=Oe=>{var pe=Fn(),ne=s(n(pe),2);je(ne),l(pe),M(()=>ne.disabled=e(J)),Ne(ne,()=>e(y),L=>c(y,L)),o(Oe,pe)},d=Oe=>{var pe=rt(),ne=Ue(pe);{var L=W=>{var Te=Mn();o(W,Te)},H=W=>{var Te=rt(),st=Ue(Te);{var Me=Le=>{var Pe=Pn(),Ee=s(n(Pe),2);_t(Ee,5,()=>e(V),kt,(qe,ce)=>{var _e=Rn();let We;var Qe=n(_e),g=n(Qe),I=n(g,!0);l(g);var ve=s(g,2),X=n(ve,!0);l(ve),l(Qe);var we=s(Qe,2),ke=n(we),A=n(ke);l(ke);var C=s(ke,2),re=n(C);l(C),l(we),l(_e),M(xe=>{We=mt(_e,1,"gist-item svelte-1jb5ckg",null,We,{selected:e(ue)?.id===e(ce).id}),_e.disabled=e(J),D(I,(e(ce),r(()=>e(ce).description||"Untitled"))),D(X,(e(ce),r(()=>e(ce).public?"ðŸŒ Public":"ðŸ”’ Private"))),D(A,`ID: ${e(ce),r(()=>e(ce).id)??""}`),D(re,`Updated: ${xe??""}`)},[()=>(e(ce),r(()=>new Date(e(ce).updated_at).toLocaleDateString()))]),R("click",_e,()=>Je(e(ce))),o(qe,_e)}),l(Ee),l(Pe),o(Le,Pe)},fe=Le=>{var Pe=rt(),Ee=Ue(Pe);{var qe=ce=>{var _e=In();o(ce,_e)};k(Ee,ce=>{e(j)&&ce(qe)},!0)}o(Le,Pe)};k(st,Le=>{e(V),r(()=>e(V).length>0)?Le(Me):Le(fe,!1)},!0)}o(W,Te)};k(ne,W=>{e(se)?W(L):W(H,!1)},!0)}o(Oe,pe)};k(le,Oe=>{e(te)||!e(j)?Oe(U):Oe(d,!1)},!0)}o($,K)};k(q,$=>{h()==="save"?$(oe):$(N,!1)})}var Ce=s(q,2),Ve=n(Ce),Ze=n(Ve);{var he=$=>{var K=jt();M(()=>D(K,h()==="save"?"Saving...":"Loading...")),o($,K)},Ge=$=>{var K=jt();M(()=>D(K,h()==="save"?"Save":"Load")),o($,K)};k(Ze,$=>{e(J)?$(he):$(Ge,!1)})}l(Ve);var F=s(Ve,2);l(Ce),l(me),l(Ae),l(ge),M(()=>{D(Fe,h()==="save"?"Save to GitHub Gist":"Load from GitHub Gist"),D(ze,`GitHub Token ${h()==="load"?"(optional for public gists)":"(required)"} `),$e.disabled=e(J),Ve.disabled=e(J),F.disabled=e(J)}),R("click",B,O),Ne($e,()=>e(j),$=>c(j,$)),R("blur",$e,()=>{e(j)&&!e(te)&&Z()}),R("click",Ve,function(...$){(h()==="save"?Re:Be)?.apply(this,$)}),R("click",F,O),R("click",Ae,Ea(function($){ia.call(this,i,$)})),R("keydown",Ae,function($){ia.call(this,i,$)}),R("click",ge,O),R("keydown",ge,$=>$.key==="Escape"&&O()),o(a,ge),It(),u()}var Hn=f('<div class="loading svelte-1ngjemu">Loading D&D data...</div>'),Un=f("<option> </option>"),Nn=f('<select class="level-filter svelte-1ngjemu"><option>All Levels</option><option>Cantrip</option><!></select>'),Gn=f('<div class="no-results svelte-1ngjemu"> </div>'),On=f('<div class="item-meta svelte-1ngjemu"> </div>'),qn=f('<div class="item-meta svelte-1ngjemu"> </div>'),Wn=f('<button><div class="item-name svelte-1ngjemu"> </div> <!></button>'),zn=f('<p class="higher-levels"><strong>At Higher Levels:</strong> </p>'),Kn=f('<p class="cantrip-upgrade"><strong>Cantrip Upgrade:</strong> </p>'),Vn=f('<h3 class="svelte-1ngjemu"> </h3> <p class="spell-meta svelte-1ngjemu"><!> <!></p> <p class="spell-classes"><strong>Classes:</strong> </p> <div class="spell-stats svelte-1ngjemu"><div><strong>Casting Time:</strong> </div> <div><strong>Range:</strong> </div> <div><strong>Components:</strong> <!></div> <div><strong>Duration:</strong> <!> </div></div> <p class="description svelte-1ngjemu"> </p> <!> <!>',1),Jn=f('<p class="prerequisite svelte-1ngjemu"><strong>Prerequisite:</strong> </p>'),Qn=f('<h3 class="svelte-1ngjemu"> </h3> <!> <p class="description svelte-1ngjemu"> </p> <a target="_blank" rel="noopener" class="source-link svelte-1ngjemu">View Full Details â†’</a>',1),Yn=f('<div class="item-details svelte-1ngjemu"><!></div>'),Xn=f('<div class="controls svelte-1ngjemu"><div class="tabs svelte-1ngjemu"><button> </button> <button> </button></div> <div class="search-controls svelte-1ngjemu"><input type="text" placeholder="Search by name or description..." class="search-input svelte-1ngjemu"/> <!></div></div> <div class="content-container svelte-1ngjemu"><div class="items-list svelte-1ngjemu"><!></div> <!></div>',1),Zn=f('<div class="modal-backdrop svelte-1ngjemu" role="presentation"><div class="modal svelte-1ngjemu" role="dialog" aria-modal="true" tabindex="-1"><div class="modal-header svelte-1ngjemu"><h2 class="svelte-1ngjemu">Browse D&D Spells & Feats</h2> <button class="close-btn svelte-1ngjemu" aria-label="Close">&times;</button></div> <div class="modal-body svelte-1ngjemu"><!></div> <div class="modal-footer svelte-1ngjemu"><button class="btn-secondary svelte-1ngjemu">Cancel</button> <button class="btn-primary svelte-1ngjemu">Add to Character Sheet</button></div></div></div>');function er(a,i){Pt(i,!1);const t=P(),v=P(),u=P();let b=$t(i,"onClose",8),h=P("spell"),j=P(!0),y=P(""),x=P(null),J=P([]),G=P([]),te=P(null);pa(async()=>{c(j,!0);try{c(J,await ss()),c(G,await Ys())}catch(B){console.error("Failed to load data:",B)}finally{c(j,!1)}});function se(B){c(te,B)}function V(B){const me=B.match(/(\d+d\d+(?:\s*\+\s*\d+)?)/i);return me?me[1]:""}function ue(B){const me=B.split(/\.( |$)/)[0].trim(),_=Array.from(B.matchAll(/\*\*(.*?)\*\*/g)).map(Y=>Y[1].replace(/\.$/,""));let T=me;return _.length&&(T+=" | Effects: "+_.join(", ")),T}function ie(){if(e(te)){if(e(h)==="spell"){const B=e(te);ee.update(me=>{const T=[];B.range&&T.push(`Range: ${B.range}`),B.castingTime&&T.push(`Cast: ${B.castingTime}`),B.duration&&T.push(`Duration: ${B.duration}`),B.actionType==="Save"&&T.push("Saving throw spell"),B.components&&B.components.length>0&&T.push(`Components: ${B.components.join(", ")}`),B.material&&T.push(`Material: ${B.material}`);const Y=T.join(" | "),Xe=ue(B.description),ze={id:crypto.randomUUID(),name:`${B.name}${B.concentration?" (C)":""}${B.ritual?" (R)":""}`,bonus:B.actionType==="Attack"?5:0,damage:V(B.description),damageType:`${B.school} (Lvl ${B.level})`,spellRef:B.name,infoNotes:Y,generalNotes:Xe,castAtLevel:B.level};return me.attacks=[...me.attacks,ze],me})}else if(e(h)==="feat"){const B=e(te);ee.update(me=>{const _=`${B.name}${B.prerequisite?` (Req: ${B.prerequisite})`:""}
${B.description}
`;return me.features=me.features?`${me.features}
${_}`:_,me})}c(te,null),b()()}}tt(()=>(e(x),e(J),e(y)),()=>{c(t,e(x)!==null?Xs(za(e(J),e(y)),e(x)):za(e(J),e(y)))}),tt(()=>(e(G),e(y)),()=>{c(v,Zs(e(G),e(y)))}),tt(()=>(e(h),e(t),e(v)),()=>{c(u,e(h)==="spell"?e(t):e(v))}),Vt(),Rt();var Z=Zn(),Je=n(Z),ae=n(Je),Re=s(n(ae),2);l(ae);var Be=s(ae,2),O=n(Be);{var ge=B=>{var me=Hn();o(B,me)},Ae=B=>{var me=Xn(),_=Ue(me),T=n(_),Y=n(T);let Xe;var ze=n(Y);l(Y);var $e=s(Y,2);let p;var w=n($e);l($e),l(T);var q=s(T,2),oe=n(q);je(oe);var N=s(oe,2);{var Ce=le=>{var U=Nn();M(()=>{e(x),Lt(()=>{})});var d=n(U);d.value=(d.__value=null)??"";var Oe=s(d);Oe.value=Oe.__value=0;var pe=s(Oe);_t(pe,0,()=>[1,2,3,4,5,6,7,8,9],kt,(ne,L)=>{var H=Un(),W=n(H);l(H);var Te={};M(()=>{D(W,`Level ${L??""}`),Te!==(Te=L)&&(H.value=(H.__value=L)??"")}),o(ne,H)}),l(U),Aa(U,()=>e(x),ne=>c(x,ne)),o(le,U)};k(N,le=>{e(h)==="spell"&&le(Ce)})}l(q),l(_);var Ve=s(_,2),Ze=n(Ve),he=n(Ze);{var Ge=le=>{var U=Gn(),d=n(U);l(U),M(()=>D(d,`No ${e(h)??""}s found`)),o(le,U)},F=le=>{var U=rt(),d=Ue(U);_t(d,1,()=>e(u),kt,(Oe,pe)=>{var ne=Wn();let L;var H=n(ne),W=n(H,!0);l(H);var Te=s(H,2);{var st=fe=>{const Le=it(()=>e(pe));var Pe=On(),Ee=n(Pe);l(Pe),M(()=>D(Ee,`Level ${E(e(Le)),r(()=>e(Le).level)??""} â€¢ ${E(e(Le)),r(()=>e(Le).school)??""}`)),o(fe,Pe)},Me=fe=>{const Le=it(()=>e(pe));var Pe=rt(),Ee=Ue(Pe);{var qe=ce=>{var _e=qn(),We=n(_e,!0);l(_e),M(()=>D(We,(E(e(Le)),r(()=>e(Le).prerequisite)))),o(ce,_e)};k(Ee,ce=>{E(e(Le)),r(()=>e(Le).prerequisite)&&ce(qe)})}o(fe,Pe)};k(Te,fe=>{e(h)==="spell"?fe(st):fe(Me,!1)})}l(ne),M(()=>{L=mt(ne,1,"item-card svelte-1ngjemu",null,L,{selected:e(te)?.name===e(pe).name}),D(W,(e(pe),r(()=>e(pe).name)))}),R("click",ne,()=>se(e(pe))),o(Oe,ne)}),o(le,U)};k(he,le=>{e(u),r(()=>e(u).length===0)?le(Ge):le(F,!1)})}l(Ze);var $=s(Ze,2);{var K=le=>{var U=Yn(),d=n(U);{var Oe=ne=>{const L=it(()=>e(te));var H=Vn(),W=Ue(H),Te=n(W,!0);l(W);var st=s(W,2),Me=n(st);{var fe=m=>{var Q=jt();M(()=>D(Q,`${E(e(L)),r(()=>e(L).school)??""} cantrip`)),o(m,Q)},Le=m=>{var Q=jt();M(()=>D(Q,`Level ${E(e(L)),r(()=>e(L).level)??""} ${E(e(L)),r(()=>e(L).school)??""}`)),o(m,Q)};k(Me,m=>{E(e(L)),r(()=>e(L).level===0)?m(fe):m(Le,!1)})}var Pe=s(Me,2);{var Ee=m=>{var Q=jt("(ritual)");o(m,Q)};k(Pe,m=>{E(e(L)),r(()=>e(L).ritual)&&m(Ee)})}l(st);var qe=s(st,2),ce=s(n(qe));l(qe);var _e=s(qe,2),We=n(_e),Qe=s(n(We));l(We);var g=s(We,2),I=s(n(g));l(g);var ve=s(g,2),X=s(n(ve)),we=s(X);{var ke=m=>{var Q=jt();M(()=>D(Q,`(${E(e(L)),r(()=>e(L).material)??""})`)),o(m,Q)};k(we,m=>{E(e(L)),r(()=>e(L).material)&&m(ke)})}l(ve);var A=s(ve,2),C=s(n(A),2);{var re=m=>{var Q=jt("Concentration,");o(m,Q)};k(C,m=>{E(e(L)),r(()=>e(L).concentration)&&m(re)})}var xe=s(C,1,!0);l(A),l(_e);var et=s(_e,2),lt=n(et,!0);l(et);var z=s(et,2);{var ut=m=>{var Q=zn(),ye=s(n(Q));l(Q),M(()=>D(ye,` ${E(e(L)),r(()=>e(L).higherLevelSlot)??""}`)),o(m,Q)};k(z,m=>{E(e(L)),r(()=>e(L).higherLevelSlot)&&m(ut)})}var S=s(z,2);{var de=m=>{var Q=Kn(),ye=s(n(Q));l(Q),M(()=>D(ye,` ${E(e(L)),r(()=>e(L).cantripUpgrade)??""}`)),o(m,Q)};k(S,m=>{E(e(L)),r(()=>e(L).cantripUpgrade)&&m(de)})}M((m,Q)=>{D(Te,(E(e(L)),r(()=>e(L).name))),D(ce,` ${m??""}`),D(Qe,` ${E(e(L)),r(()=>e(L).castingTime||e(L).actionType)??""}`),D(I,` ${E(e(L)),r(()=>e(L).range)??""}`),D(X,` ${Q??""}`),D(xe,(E(e(L)),r(()=>e(L).duration))),D(lt,(E(e(L)),r(()=>e(L).description)))},[()=>(E(e(L)),r(()=>e(L).classes.join(", "))),()=>(E(e(L)),r(()=>e(L).components.join(", ").toUpperCase()))]),o(ne,H)},pe=ne=>{const L=it(()=>e(te));var H=Qn(),W=Ue(H),Te=n(W,!0);l(W);var st=s(W,2);{var Me=Ee=>{var qe=Jn(),ce=s(n(qe));l(qe),M(()=>D(ce,` ${E(e(L)),r(()=>e(L).prerequisite)??""}`)),o(Ee,qe)};k(st,Ee=>{E(e(L)),r(()=>e(L).prerequisite)&&Ee(Me)})}var fe=s(st,2),Le=n(fe,!0);l(fe);var Pe=s(fe,2);M(()=>{D(Te,(E(e(L)),r(()=>e(L).name))),D(Le,(E(e(L)),r(()=>e(L).description))),Ke(Pe,"href",(E(e(L)),r(()=>e(L).source)))}),o(ne,H)};k(d,ne=>{e(h)==="spell"?ne(Oe):ne(pe,!1)})}l(U),o(le,U)};k($,le=>{e(te)&&le(K)})}l(Ve),M(()=>{Xe=mt(Y,1,"tab svelte-1ngjemu",null,Xe,{active:e(h)==="spell"}),D(ze,`ðŸ“œ Spells (${e(J),r(()=>e(J).length)??""})`),p=mt($e,1,"tab svelte-1ngjemu",null,p,{active:e(h)==="feat"}),D(w,`â­ Feats (${e(G),r(()=>e(G).length)??""})`)}),R("click",Y,()=>{c(h,"spell"),c(te,null),c(y,"")}),R("click",$e,()=>{c(h,"feat"),c(te,null),c(y,"")}),Ne(oe,()=>e(y),le=>c(y,le)),o(B,me)};k(O,B=>{e(j)?B(ge):B(Ae,!1)})}l(Be);var Ie=s(Be,2),Se=n(Ie),Fe=s(Se,2);l(Ie),l(Je),l(Z),M(()=>Fe.disabled=!e(te)),R("click",Re,function(...B){b()?.apply(this,B)}),R("click",Se,function(...B){b()?.apply(this,B)}),R("click",Fe,ie),R("click",Je,Ea(function(B){ia.call(this,i,B)})),R("keydown",Je,function(B){ia.call(this,i,B)}),R("click",Z,function(...B){b()?.apply(this,B)}),R("keydown",Z,B=>B.key==="Escape"&&b()()),o(a,Z),It()}var tr=f('<link rel="icon" type="image/png" href="favicon4.png"/> <meta name="viewport" content="width=device-width, initial-scale=1"/>',1),ar=f('<span class="character-name svelte-1uha8ag"> </span>'),sr=f("<span> </span>"),lr=f('<div class="spell-slots-header svelte-1uha8ag"></div>'),nr=f("<span> </span><br/>",1),rr=f("<span> </span>"),ir=f('<span class="effect-tooltip"><strong> </strong><br/> <br/> <!> <!></span>'),or=f('<button class="effect-remove-btn svelte-1uha8ag">Ã—</button>'),cr=f('<span class="effect-badge svelte-1uha8ag" tabindex="0"> <!> <!></span>'),vr=f(`<div class="active-effects-header svelte-1uha8ag"></div> <style>.effect-badge {
              position: relative;
            }
            .effect-tooltip {
              position: absolute;
              top: 120%;
              left: 50%;
              transform: translateX(-50%);
              background: #fff;
              color: #222;
              border: 1px solid #a5b4fc;
              border-radius: 6px;
              padding: 8px 12px;
              font-size: 0.95em;
              box-shadow: 0 2px 8px rgba(0, 0, 0, 0.12);
              z-index: 10;
              min-width: 180px;
              max-width: 260px;
              white-space: normal;
              pointer-events: none;
              opacity: 1;
              transition: opacity 0.15s;
            }</style>`,1),dr=f('<div class="rest-menu svelte-1uha8ag"><button class="rest-option svelte-1uha8ag">â˜• Short Rest</button> <button class="rest-option svelte-1uha8ag">ðŸ›ï¸ Long Rest</button></div>'),ur=f('<div class="container svelte-1uha8ag"><header class="svelte-1uha8ag"><div class="header-top svelte-1uha8ag"><div class="header-title svelte-1uha8ag"><div class="title-row svelte-1uha8ag"><h1 class="svelte-1uha8ag">D&D Character Sheet</h1> <!></div> <!> <!></div> <div class="header-right svelte-1uha8ag"><div class="header-controls svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">ðŸŽ²</span><span class="btn-text svelte-1uha8ag">Roll Dice</span></button> <div class="rest-button-container svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">ðŸ˜´</span><span class="btn-text svelte-1uha8ag">Rest</span></button> <!></div> <div class="mode-toggle"><button><span class="btn-icon svelte-1uha8ag"> </span><span class="btn-text svelte-1uha8ag"> </span></button></div></div> <div class="header-search svelte-1uha8ag"><input type="text" placeholder="ðŸ” Search..." class="search-input use-enabled svelte-1uha8ag"/></div></div></div> <div class="header-actions svelte-1uha8ag"><button class="btn btn-mode svelte-1uha8ag">ðŸ“š Browse Spells & Feats</button> <button class="btn btn-secondary">Save to Gist</button> <button class="btn btn-secondary">Load from Gist</button> <button class="btn btn-secondary">Export JSON</button> <button class="btn btn-secondary">Import JSON</button> <input type="file" accept=".json" style="display: none;"/></div></header> <main class="svelte-1uha8ag"><!> <!> <!> <!> <!> <!> <!></main></div> <!> <!> <!> <!>',1);function kr(a,i){Pt(i,!1);const t=()=>at(ee,"$character",b),v=()=>at(ra,"$isEditMode",b),u=()=>at(Xt,"$searchFilter",b),[b,h]=qt();function j(){const S=[],de=t().classFeatures.spellSlotsByLevel||{};for(let m=1;m<=9;m++){const Q=de[m];if(Q&&Q.length>0){const ye=Q.length,De=Q.filter(be=>be).length;S.push({level:m,available:ye-De,total:ye})}}return S}let y=P(!1),x=P(!1),J=P(!1),G=P("save"),te=P(void 0),se=P(""),V=P(""),ue=P(""),ie=P(!1),Z=P([]),Je=P(),ae=!1,Re=P(!1),Be=P(null);function O(S){c(Be,S)}function ge(){c(Be,null)}function Ae(S){c(Be,e(Be)===S?null:S)}function Ie(){const S=[];ee.update(m=>{const Q=m.hitDice.current;m.hitDice.current=Math.min(m.hitDice.max,m.hitDice.current+Math.max(1,Math.floor(m.hitDice.max/2)));const ye=m.hitDice.current-Q;if(ye>0&&S.push(`${ye} hit ${ye===1?"die":"dice"}`),m.class){const De=oa(m.class,m.level,m.subclass);m.classFeatures.features||(m.classFeatures.features={}),De.forEach(be=>{if(be.resetOn==="short"){const Ye=be.name.replace(/\s+/g,"");if(be.type==="uses"){const He=typeof be.maxUses=="function"?be.maxUses(m.level):be.maxUses;m.classFeatures.features[Ye]=Array(He).fill(!1),S.push(be.name)}else if(be.type==="pool"){const He=typeof be.maxPool=="function"?be.maxPool(m.level):be.maxPool;He!==void 0&&(m.classFeatures.features[Ye]=He,S.push(be.name))}}})}return m}),c(Re,!1);const de=S.length>0?`Short rest taken! Restored: ${S.join(", ")}`:"Short rest taken!";Ut.add(de,"success")}function Se(){const S=[];ee.update(m=>{const Q=m.maxHP-m.currentHP;Q>0&&S.push(`${Q} HP`),m.currentHP=m.maxHP,m.tempHP=0;const ye=m.hitDice.max-m.hitDice.current;ye>0&&S.push(`${ye} hit ${ye===1?"die":"dice"}`),m.hitDice.current=m.hitDice.max;let De=0;if(m.classFeatures.spellSlotsByLevel&&Object.keys(m.classFeatures.spellSlotsByLevel).forEach(be=>{const Ye=m.classFeatures.spellSlotsByLevel[parseInt(be)];if(Ye){const He=Ye.filter(pt=>pt).length;De+=He,m.classFeatures.spellSlotsByLevel[parseInt(be)]=Array(Ye.length).fill(!1)}}),De>0&&S.push(`${De} spell ${De===1?"slot":"slots"}`),m.class){const be=oa(m.class,m.level,m.subclass);m.classFeatures.features||(m.classFeatures.features={});let Ye=!1;be.forEach(He=>{const pt=He.name.replace(/\s+/g,"");if(!(He.type==="info"||He.type==="channelDivinity")){if(He.type==="uses"){const ft=typeof He.maxUses=="function"?He.maxUses(m.level):He.maxUses;m.classFeatures.features[pt]=Array(ft).fill(!1),Ye=!0}else if(He.type==="pool"){const ft=typeof He.maxPool=="function"?He.maxPool(m.level):He.maxPool;ft!==void 0&&(m.classFeatures.features[pt]=ft,Ye=!0)}}}),Ye&&S.push("all class features")}return m}),c(Re,!1);const de=S.length>0?`Long rest taken! Restored: ${S.join(", ")}`:"Long rest taken! Fully rested.";Ut.add(de,"success")}function Fe(S){c(se,""),c(V,""),c(ue,""),c(ie,!1),c(Z,[]),ae=!1,typeof S=="string"?c(se,S):(c(se,S.notation),c(V,S.damageNotation||""),c(ue,S.attackName||""),c(ie,!!S.applyHalfDamage),c(Z,S.bonusBreakdown||[])),c(y,!0)}function B(S){const{notation:de}=S.detail;c(se,""),ae=!0,setTimeout(()=>{c(se,de),c(V,""),c(ue,"Hit Die")},0),c(y,!0)}function me(){if(c(y,!1),ae&&e(Je)){const S=e(Je).getLastRollTotal();if(S!==null){const de=Math.max(1,S);ee.update(m=>(m.hitDice.current=Math.max(0,m.hitDice.current-1),m.currentHP=Math.min(m.maxHP,m.currentHP+de),m))}ae=!1}}function _(){ra.update(S=>!S)}function T(S){S.target.closest(".rest-button-container")||c(Re,!1)}pa(()=>{const S=ra.subscribe(de=>{de?document.body.classList.remove("use-mode"):document.body.classList.add("use-mode")});return document.addEventListener("click",T),()=>{S(),document.removeEventListener("click",T)}});function Y(){hs(t())}function Xe(){e(te)?.click()}async function ze(S){const m=S.target.files?.[0];if(m)try{const Q=await _s(m);ee.set(Q),alert("Character imported successfully!")}catch{alert("Failed to import character file")}}Rt();var $e=ur();ms("1uha8ag",S=>{var de=tr();na(2),Xa(()=>{fs.title="D&D Character Sheet"}),o(S,de)});var p=Ue($e),w=n(p),q=n(w),oe=n(q),N=n(oe),Ce=s(n(N),2);{var Ve=S=>{var de=ar(),m=n(de);l(de),M(()=>D(m,`${t().name??""} (${t().level??""})`)),o(S,de)};k(Ce,S=>{t().name&&S(Ve)})}l(N);var Ze=s(N,2);{var he=S=>{var de=lr();_t(de,5,j,kt,(m,Q)=>{var ye=sr();let De;var be=n(ye);l(ye),M(()=>{De=mt(ye,1,"slot-badge svelte-1uha8ag",null,De,{depleted:e(Q).available===0}),D(be,`Lv${e(Q).level??""}: ${e(Q).available??""}/${e(Q).total??""}`)}),o(m,ye)}),l(de),o(S,de)};k(Ze,S=>{j().length>0&&S(he)})}var Ge=s(Ze,2);{var F=S=>{var de=vr(),m=Ue(de);_t(m,5,()=>t().activeStates,kt,(Q,ye,De)=>{var be=cr(),Ye=n(be),He=s(Ye);{var pt=nt=>{var ct=ir(),bt=n(ct),Tt=n(bt,!0);l(bt);var ot=s(bt,2),gt=s(ot,3);{var St=yt=>{var ht=nr(),Ft=Ue(ht),Ot=n(Ft);l(Ft),na(),M(()=>D(Ot,`Attack Bonus: ${typeof e(ye).attackBonus=="number"&&e(ye).attackBonus>0?"+":""}${e(ye).attackBonus??""}`)),o(yt,ht)};k(gt,yt=>{e(ye).attackBonus&&yt(St)})}var At=s(gt,2);{var Et=yt=>{var ht=rr(),Ft=n(ht);l(ht),M(()=>D(Ft,`Damage Bonus: ${typeof e(ye).damageBonus=="number"&&e(ye).damageBonus>0?"+":""}${e(ye).damageBonus??""}`)),o(yt,ht)};k(At,yt=>{e(ye).damageBonus&&yt(Et)})}l(ct),M(()=>{D(Tt,e(ye).name),D(ot,` ${e(ye).description??""}`)}),o(nt,ct)};k(He,nt=>{e(Be)===De&&nt(pt)})}var ft=s(He,2);{var Gt=nt=>{var ct=or();M(()=>Ke(ct,"title",`End ${e(ye).name??""}`)),R("click",ct,()=>{ee.update(bt=>{if(bt.activeStates){const Tt=bt.activeStates[De];Tt?.hpBonus&&Tt.target!=="other"&&(bt.maxHP-=Tt.hpBonus,bt.currentHP=Math.max(1,Math.min(bt.currentHP-Tt.hpBonus,bt.maxHP))),bt.activeStates=bt.activeStates.filter((ot,gt)=>gt!==De)}return bt})}),o(nt,ct)};k(ft,nt=>{v()||nt(Gt)})}l(be),M(()=>{Ke(be,"aria-label",e(ye).name),D(Ye,`âœ¨ ${e(ye).name??""} `)}),R("mouseenter",be,()=>O(De)),R("mouseleave",be,ge),R("focus",be,()=>O(De)),R("blur",be,ge),R("click",be,()=>Ae(De)),o(Q,be)}),l(m),na(2),o(S,de)};k(Ge,S=>{t().activeStates&&t().activeStates.length>0&&S(F)})}l(oe);var $=s(oe,2),K=n($),le=n(K),U=s(le,2),d=n(U),Oe=s(d,2);{var pe=S=>{var de=dr(),m=n(de),Q=s(m,2);l(de),R("click",m,Ie),R("click",Q,Se),o(S,de)};k(Oe,S=>{e(Re)&&S(pe)})}l(U);var ne=s(U,2),L=n(ne);let H;var W=n(L),Te=n(W,!0);l(W);var st=s(W),Me=n(st,!0);l(st),l(L),l(ne),l(K);var fe=s(K,2),Le=n(fe);je(Le),l(fe),l($),l(q);var Pe=s(q,2),Ee=n(Pe),qe=s(Ee,2),ce=s(qe,2),_e=s(ce,2),We=s(_e,2),Qe=s(We,2);ja(Qe,S=>c(te,S),()=>e(te)),l(Pe),l(w);var g=s(w,2),I=n(g);Ps(I,{});var ve=s(I,2);Hs(ve,{$$events:{roll:S=>Fe(S.detail)}});var X=s(ve,2);Qs(X,{$$events:{roll:S=>Fe(S.detail)}});var we=s(X,2);zs(we,{$$events:{rollHitDice:B}});var ke=s(we,2);El(ke,{$$events:{roll:S=>Fe(S.detail)}});var A=s(ke,2);tn(A,{});var C=s(A,2);ln(C,{}),l(g),l(p);var re=s(p,2);ja(hn(re,{get notation(){return e(se)},get damageNotation(){return e(V)},get attackName(){return e(ue)},get applyHalfDamage(){return e(ie)},get bonusBreakdown(){return e(Z)},get visible(){return e(y)},$$events:{close:me},$$legacy:!0}),S=>c(Je,S),()=>e(Je));var xe=s(re,2);{var et=S=>{En(S,{get mode(){return e(G)},$$events:{close:()=>c(x,!1)}})};k(xe,S=>{e(x)&&S(et)})}var lt=s(xe,2);{var z=S=>{er(S,{onClose:()=>c(J,!1)})};k(lt,S=>{e(J)&&S(z)})}var ut=s(lt,2);bs(ut,{}),M(()=>{H=mt(L,1,"btn btn-mode svelte-1uha8ag",null,H,{"use-mode":!v()}),D(Te,v()?"ðŸ“":"ðŸŽ²"),D(Me,v()?"Edit Mode":"Use Mode")}),R("click",le,()=>c(y,!0)),R("click",d,()=>c(Re,!e(Re))),R("click",L,_),Ne(Le,u,S=>ys(Xt,S)),R("click",Ee,()=>c(J,!0)),R("click",qe,()=>{c(G,"save"),c(x,!0)}),R("click",ce,()=>{c(G,"load"),c(x,!0)}),R("click",_e,Y),R("click",We,Xe),R("change",Qe,ze),o(a,$e),It(),h()}export{kr as component};
