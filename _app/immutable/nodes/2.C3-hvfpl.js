import{d as os,g as Rs,f,e as A,a as c,s as D,c as pt,t as Dt}from"../chunks/BESELRjb.js";import{i as zt}from"../chunks/JMgyEzd3.js";import{c as _a,o as Ca,a as Ms,b as Fs}from"../chunks/CtPH092J.js";import{F as L,T as pa,Y as Za,j as Ps,aZ as Ts,U as cs,ag as Is,aD as Es,aK as Hs,aE as Us,a1 as Ns,av as Ia,a7 as ls,i as xs,a_ as Os,a$ as ks,b0 as Ga,K as ba,e as ws,b1 as $s,b2 as Gs,b3 as qs,b4 as Ws,q as es,b5 as zs,b6 as Ks,ab as Vs,d as n,r as is,g as Js,C as Kt,G as Vt,H as l,I as s,J as a,b7 as Je,b8 as da,s as r,a4 as S,f as e,m as ht,E as je,b9 as It,ao as Xt,A as z,ba as ma,bb as xa,bc as Ys}from"../chunks/DyJ43TGI.js";import{t as Qs,c as Zt,a as ve,e as xt,i as $t,u as Ss,s as ga,b as Lt,d as Fa,f as ha,g as Xs,j as Et,h as Zs,T as el,k as tl,l as al}from"../chunks/ByvjJ_Au.js";import{i as _,s as oa,a as rt,b as jt,d as La,e as sl}from"../chunks/CCL4udNy.js";import{p as kt,b as Ra}from"../chunks/iXw84bXb.js";import{b as Aa,r as ll}from"../chunks/CCVFIwa-.js";function il(i,o,t=!1,v=!1,d=!1){var p=i,m="";L(()=>{var w=Ps;if(m===(m=o()??"")){pa&&Za();return}if(w.nodes_start!==null&&(Ts(w.nodes_start,w.nodes_end),w.nodes_start=w.nodes_end=null),m!==""){if(pa){cs.data;for(var y=Za(),k=y;y!==null&&(y.nodeType!==Is||y.data!=="");)k=y,y=Es(y);if(y===null)throw Hs(),Us;os(cs,k),p=Ns(y);return}var H=m+"";t?H=`<svg>${H}</svg>`:v&&(H=`<math>${H}</math>`);var P=Rs(H);if((t||v)&&(P=Ia(P)),os(Ia(P),P.lastChild),t||v)for(;Ia(P);)p.before(Ia(P));else p.before(P)}})}function nl(i,o,t,v,d){pa&&Za();var p=o.$$slots?.[t],m=!1;p===!0&&(p=o[t],m=!0),p===void 0?d!==null&&d(i):p(i,m?()=>v:v)}function rl(i,o,t,v){var d=i.__style;if(pa||d!==o){var p=Qs(o);(!pa||p!==i.getAttribute("style"))&&(p==null?i.removeAttribute("style"):i.style.cssText=p),i.__style=o}return v}function Oa(i,o,t=!1){if(i.multiple){if(o==null)return;if(!xs(o))return Os();for(var v of i.options)v.selected=o.includes(ja(v));return}for(v of i.options){var d=ja(v);if(ks(d,o)){v.selected=!0;return}}(!t||o!==void 0)&&(i.selectedIndex=-1)}function ts(i){var o=new MutationObserver(()=>{Oa(i,i.__value)});o.observe(i,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),ls(()=>{o.disconnect()})}function Ma(i,o,t=o){var v=new WeakSet,d=!0;Ga(i,"change",p=>{var m=p?"[selected]":":checked",w;if(i.multiple)w=[].map.call(i.querySelectorAll(m),ja);else{var y=i.querySelector(m)??i.querySelector("option:not([disabled])");w=y&&ja(y)}t(w),ba!==null&&v.add(ba)}),ws(()=>{var p=o();if(i===document.activeElement){var m=$s??ba;if(v.has(m))return}if(Oa(i,p,d),d&&p===void 0){var w=i.querySelector(":checked");w!==null&&(p=ja(w),t(p))}i.__value=p,d=!1}),ts(i)}function ja(i){return"__value"in i?i.__value:i.value}const ol=Symbol("is custom element"),cl=Symbol("is html");function Ce(i){if(pa){var o=!1,t=()=>{if(!o){if(o=!0,i.hasAttribute("value")){var v=i.value;Ve(i,"value",null),i.value=v}if(i.hasAttribute("checked")){var d=i.checked;Ve(i,"checked",null),i.checked=d}}};i.__on_r=t,es(t),zs()}}function Ba(i,o){var t=ns(i);t.value===(t.value=o??void 0)||i.value===o&&(o!==0||i.nodeName!=="PROGRESS")||(i.value=o??"")}function Cs(i,o){var t=ns(i);t.checked!==(t.checked=o??void 0)&&(i.checked=o)}function Ve(i,o,t,v){var d=ns(i);pa&&(d[o]=i.getAttribute(o),o==="src"||o==="srcset"||o==="href"&&i.nodeName==="LINK")||d[o]!==(d[o]=t)&&(o==="loading"&&(i[Gs]=t),t==null?i.removeAttribute(o):typeof t!="string"&&vl(i).includes(o)?i[o]=t:i.setAttribute(o,t))}function ns(i){return i.__attributes??={[ol]:i.nodeName.includes("-"),[cl]:i.namespaceURI===qs}}var vs=new Map;function vl(i){var o=i.getAttribute("is")||i.nodeName,t=vs.get(o);if(t)return t;vs.set(o,t=[]);for(var v,d=i,p=Element.prototype;p!==d;){v=Ks(d);for(var m in v)v[m].set&&t.push(m);d=Ws(d)}return t}function Ie(i,o,t=o){var v=new WeakSet;Ga(i,"input",async d=>{var p=d?i.defaultValue:i.value;if(p=Va(i)?Ja(p):p,t(p),ba!==null&&v.add(ba),await Vs(),p!==(p=o())){var m=i.selectionStart,w=i.selectionEnd,y=i.value.length;if(i.value=p??"",w!==null){var k=i.value.length;m===w&&w===y&&k>y?(i.selectionStart=k,i.selectionEnd=k):(i.selectionStart=m,i.selectionEnd=Math.min(w,k))}}}),(pa&&i.defaultValue!==i.value||n(o)==null&&i.value)&&(t(Va(i)?Ja(i.value):i.value),ba!==null&&v.add(ba)),is(()=>{var d=o();if(i===document.activeElement){var p=$s??ba;if(v.has(p))return}Va(i)&&d===Ja(i.value)||i.type==="date"&&!d&&!i.value||d!==i.value&&(i.value=d??"")})}const Ka=new Set;function ds(i,o,t,v,d=v){var p=t.getAttribute("type")==="checkbox",m=i;let w=!1;if(o!==null)for(var y of o)m=m[y]??=[];m.push(t),Ga(t,"change",()=>{var k=t.__value;p&&(k=us(m,k,t.checked)),d(k)},()=>d(p?[]:null)),is(()=>{var k=v();if(pa&&t.defaultChecked!==t.checked){w=!0;return}p?(k=k||[],t.checked=k.includes(t.__value)):t.checked=ks(t.__value,k)}),ls(()=>{var k=m.indexOf(t);k!==-1&&m.splice(k,1)}),Ka.has(m)||(Ka.add(m),es(()=>{m.sort((k,H)=>k.compareDocumentPosition(H)===4?-1:1),Ka.delete(m)})),es(()=>{if(w){var k;if(p)k=us(m,k,t.checked);else{var H=m.find(P=>P.checked);k=H?.__value}d(k)}})}function wa(i,o,t=o){Ga(i,"change",v=>{var d=v?i.defaultChecked:i.checked;t(d)}),(pa&&i.defaultChecked!==i.checked||n(o)==null)&&t(i.checked),is(()=>{var v=o();i.checked=!!v})}function us(i,o,t){for(var v=new Set,d=0;d<i.length;d+=1)i[d].checked&&v.add(i[d].__value);return t||v.delete(o),Array.from(v)}function Va(i){var o=i.type;return o==="number"||o==="range"}function Ja(i){return i===""?null:+i}function dl(i,o,t){var v=Js(i,o);v&&v.set&&(i[o]=t,ls(()=>{i[o]=null}))}function rs(i){return function(...o){var t=o[0];return t.stopPropagation(),i?.apply(this,o)}}function $a(i,o){var t=i.$$events?.[o.type],v=xs(t)?t.slice():t==null?[]:[t];for(var d of v)d.call(this,o)}const ul="";function Ds(...i){return Aa+ul+ll(i[0],i[1])}const as={paladin:{name:"Paladin",hitDice:"d10",spellcaster:!0,spellcastingAbility:"charisma",spellSlotsByLevel:{1:0,2:2,3:3,4:3,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Divine Sense",type:"uses",maxUses:(i,o=1)=>1+Math.max(1,o),resetOn:"long",description:"Detect celestials, fiends, and undead within 60 feet",minLevel:1},{name:"Lay on Hands",type:"pool",maxPool:i=>i*5,resetOn:"long",description:"Heal wounds or cure disease",minLevel:1},{name:"Divine Smite",type:"spellSlot",description:"Expend spell slot to deal extra radiant damage",minLevel:2,rollable:!0},{name:"Channel Divinity",type:"pool",maxPool:i=>i>=18?3:i>=6?2:1,resetOn:"short",description:"Sacred Weapon or Turn Undead",minLevel:3}]},fighter:{name:"Fighter",hitDice:"d10",spellcaster:!1,features:[{name:"Second Wind",type:"uses",maxUses:1,resetOn:"short",description:"Regain 1d10 + fighter level HP as bonus action",minLevel:1,rollable:!0,rollFormula:i=>`1d10+${i}`},{name:"Action Surge",type:"uses",maxUses:i=>i>=17?2:1,resetOn:"short",description:"Take one additional action on your turn",minLevel:2},{name:"Indomitable",type:"uses",maxUses:i=>i>=17?3:i>=13?2:1,resetOn:"long",description:"Reroll a failed saving throw",minLevel:9}],subclasses:{champion:{name:"Champion",features:[{name:"Improved Critical",type:"info",description:"Critical hit on 19-20",minLevel:3},{name:"Remarkable Athlete",type:"info",description:"Add half proficiency to STR/DEX/CON checks, increase long jump distance",minLevel:7},{name:"Additional Fighting Style",type:"info",description:"Choose a second fighting style",minLevel:10},{name:"Superior Critical",type:"info",description:"Critical hit on 18-20",minLevel:15},{name:"Survivor",type:"info",description:"Regain 5 + CON mod HP at start of turn if below half HP",minLevel:18}]},battlemaster:{name:"Battle Master",features:[{name:"Combat Superiority",type:"uses",maxUses:i=>i>=15?6:i>=7?5:4,resetOn:"short",description:i=>`Use superiority dice (${i>=18?"d12":i>=10?"d10":"d8"}) for maneuvers`,minLevel:3},{name:"Know Your Enemy",type:"info",description:"Learn capabilities of creatures you observe",minLevel:7},{name:"Improved Combat Superiority",type:"info",description:"Superiority dice become d10",minLevel:10},{name:"Relentless",type:"info",description:"Regain 1 superiority die if you have none at start of turn",minLevel:15}]}}},rogue:{name:"Rogue",hitDice:"d8",spellcaster:!1,features:[{name:"Sneak Attack",type:"info",description:i=>`Deal ${Math.ceil(i/2)}d6 extra damage once per turn with advantage or ally nearby`,minLevel:1,rollable:!0,rollFormula:i=>`${Math.ceil(i/2)}d6`},{name:"Cunning Action",type:"info",description:"Dash, Disengage, or Hide as a bonus action",minLevel:2},{name:"Uncanny Dodge",type:"info",description:"Use reaction to halve damage from an attack",minLevel:5},{name:"Evasion",type:"info",description:"Take no damage on successful Dex save (half on fail)",minLevel:7}]},wizard:{name:"Wizard",hitDice:"d6",spellcaster:!0,spellcastingAbility:"intelligence",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Arcane Recovery",type:"uses",maxUses:1,resetOn:"long",description:i=>`Recover spell slots totaling up to ${Math.ceil(i/2)} levels during short rest`,minLevel:1},{name:"Spell Mastery",type:"info",description:"Cast one 1st-level and one 2nd-level spell at will",minLevel:18}]},cleric:{name:"Cleric",hitDice:"d8",spellcaster:!0,spellcastingAbility:"wisdom",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Channel Divinity",type:"pool",maxPool:i=>i>=18?3:i>=6?2:1,resetOn:"short",description:"Turn Undead or domain-specific ability",minLevel:2},{name:"Destroy Undead",type:"info",description:i=>`Channel Divinity destroys undead of CR ${i>=17?4:i>=14?3:i>=11?2:i>=8?1:.5} or lower`,minLevel:5},{name:"Divine Intervention",type:"uses",maxUses:1,resetOn:"long",description:i=>`${i}% chance to succeed, implore deity for aid`,minLevel:10}],subclasses:{war:{name:"War Domain",features:[{name:"War Priest",type:"uses",maxUses:(i,o=1)=>Math.max(1,o),resetOn:"long",description:"Make one weapon attack as a bonus action",minLevel:1},{name:"Guided Strike",type:"channelDivinity",description:"Use your Channel Divinity to gain +10 to an attack roll. Make this choice after you see the roll, but before the DM says whether the attack hits or misses.",minLevel:2,resetOn:"short"},{name:"War God's Blessing",type:"channelDivinity",description:"Use reaction to grant +10 to an ally's attack roll within 30 feet. Consumes one use of Channel Divinity.",minLevel:6,resetOn:"short"},{name:"Divine Strike",type:"info",description:i=>`Deal extra ${i>=14?"2d8":"1d8"} weapon damage once per turn`,minLevel:8,rollable:!0,rollFormula:i=>i>=14?"2d8":"1d8"},{name:"Avatar of Battle",type:"info",description:"Gain resistance to nonmagical weapon damage",minLevel:17}]},life:{name:"Life Domain",features:[{name:"Disciple of Life",type:"info",description:"Healing spells restore additional 2 + spell level HP",minLevel:1},{name:"Preserve Life",type:"pool",maxPool:i=>i*5,resetOn:"short",description:"Restore HP to creatures within 30 feet",minLevel:2},{name:"Blessed Healer",type:"info",description:"Regain 2 + spell level HP when you cast healing spell",minLevel:6},{name:"Divine Strike",type:"info",description:i=>`Deal extra ${i>=14?"2d8":"1d8"} radiant damage once per turn`,minLevel:8,rollable:!0,rollFormula:i=>i>=14?"2d8":"1d8"},{name:"Supreme Healing",type:"info",description:"Maximize healing dice instead of rolling",minLevel:17}]}}},barbarian:{name:"Barbarian",hitDice:"d12",spellcaster:!1,features:[{name:"Rage",type:"uses",maxUses:i=>i>=20?1/0:i>=17?6:i>=12?5:i>=6?4:i>=3?3:2,resetOn:"long",description:i=>`+${i>=16?4:i>=9?3:2} damage, resistance to physical damage`,minLevel:1},{name:"Reckless Attack",type:"info",description:"Gain advantage on melee attacks, enemies get advantage on you",minLevel:2},{name:"Danger Sense",type:"info",description:"Advantage on Dex saves against effects you can see",minLevel:2}],subclasses:{berserker:{name:"Path of the Berserker",features:[{name:"Frenzy",type:"info",description:"While raging, make melee attack as bonus action (gain 1 exhaustion after rage)",minLevel:3},{name:"Mindless Rage",type:"info",description:"Cannot be charmed or frightened while raging",minLevel:6},{name:"Intimidating Presence",type:"info",description:"Use action to frighten creature within 30 feet",minLevel:10},{name:"Retaliation",type:"info",description:"When damaged by creature within 5 feet, make melee attack as reaction",minLevel:14}]}}}};function ra(i){const o=i.toLowerCase();return as[o]||null}function Sa(i,o,t){const v=ra(i);if(!v)return[];const d=v.features.filter(p=>!p.minLevel||p.minLevel<=o);if(t&&v.subclasses&&v.subclasses[t]){const p=v.subclasses[t].features.filter(m=>!m.minLevel||m.minLevel<=o);return[...d,...p]}return d}function fs(i){const o=ra(i);return!o||!o.subclasses?[]:Object.keys(o.subclasses).map(t=>({id:t,name:o.subclasses[t].name}))}function ps(i,o){const t=ra(i);return!t||!t.spellcaster||!t.spellSlotsByLevel?0:t.spellSlotsByLevel[o]||0}function ms(i,o,t){const v=ra(i);return!v||!v.spellcaster?0:Math.max(1,t+o)}function fl(i,o,t){const v=ra(i);return!v||!v.spellcaster?null:8+o+t}function pl(){return Object.keys(as).map(i=>({id:i,name:as[i].name}))}var ml=f('<div class="section-header svelte-ls99y2" role="button" tabindex="0"><h2 class="svelte-ls99y2"> </h2> <span class="collapse-btn svelte-ls99y2"> </span></div>');function ya(i,o){Kt(o,!1);let t=kt(o,"title",8),v=kt(o,"collapsed",8),d=kt(o,"ariaLabel",8,""),p=kt(o,"onToggle",8);zt();var m=ml(),w=l(m),y=l(w,!0);s(w);var k=a(w,2),H=l(k,!0);s(k),s(m),L(()=>{Ve(m,"aria-expanded",!v()),Ve(m,"aria-label",d()),D(y,t()),D(H,v()?"‚ñº":"‚ñ≤")}),A("click",m,function(...P){p()?.apply(this,P)}),A("keydown",m,P=>{(P.key==="Enter"||P.key===" ")&&p()()}),c(i,m),Vt()}var gl=f("<option> </option>"),bl=f("<option> </option>"),hl=f('<div class="form-group svelte-172i2fj"><label for="characterSubclass" class="svelte-172i2fj">Subclass</label> <select id="characterSubclass" class="svelte-172i2fj"><option>Select Subclass</option><!></select></div>'),_l=f('<div class="info-grid svelte-172i2fj"><div class="form-group svelte-172i2fj"><label for="characterName" class="svelte-172i2fj">Character Name</label> <input type="text" id="characterName" placeholder="Enter name" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterClass" class="svelte-172i2fj">Class</label> <select id="characterClass" class="svelte-172i2fj"><option>Select Class</option><!></select></div> <!> <div class="form-group svelte-172i2fj"><label for="characterLevel" class="svelte-172i2fj">Level</label> <input type="number" id="characterLevel" min="1" max="20" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterRace" class="svelte-172i2fj">Race</label> <input type="text" id="characterRace" placeholder="e.g., Human" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterBackground" class="svelte-172i2fj">Background</label> <input type="text" id="characterBackground" placeholder="e.g., Soldier" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterAlignment" class="svelte-172i2fj">Alignment</label> <input type="text" id="characterAlignment" placeholder="e.g., Lawful Good" class="svelte-172i2fj"/></div></div>'),yl=f('<section class="character-info svelte-172i2fj"><!> <!></section>');function xl(i,o){Kt(o,!1);const t=()=>rt(ve,"$character",d),v=()=>rt(Zt,"$collapsedStates",d),[d,p]=oa(),m=S(),w=pl();function y(V){const N=V.target;ve.update(U=>(U.class=N.value,U.subclass="",U))}function k(V){const N=V.target;ve.update(U=>(U.subclass=N.value,U))}function H(V){const N=V.target;ve.update(U=>(U.level=parseInt(N.value)||1,U)),Ss()}Je(()=>(t(),fs),()=>{r(m,t().class?fs(t().class):[])}),da(),zt();var P=yl(),Z=l(P);{let V=ht(()=>(v(),n(()=>v().characterInfo?"Expand":"Collapse")));ya(Z,{title:"Character Info",get collapsed(){return v(),n(()=>v().characterInfo)},get ariaLabel(){return e(V)},onToggle:()=>Zt.update(N=>({...N,characterInfo:!N.characterInfo}))})}var fe=a(Z,2);{var ne=V=>{var N=_l(),U=l(N),he=a(l(U),2);Ce(he),s(U);var Pe=a(U,2),pe=a(l(Pe),2),Re=l(pe);Re.value=Re.__value="";var Ee=a(Re);xt(Ee,1,()=>w,$t,(Ue,le)=>{var re=gl(),We=l(re,!0);s(re);var qe={};L(()=>{D(We,(e(le),n(()=>e(le).name))),qe!==(qe=(e(le),n(()=>e(le).id)))&&(re.value=(re.__value=(e(le),n(()=>e(le).id)))??"")}),c(Ue,re)}),s(pe);var ee;ts(pe),s(Pe);var xe=a(Pe,2);{var Me=Ue=>{var le=hl(),re=a(l(le),2),We=l(re);We.value=We.__value="";var qe=a(We);xt(qe,1,()=>e(m),$t,(ct,vt)=>{var at=bl(),_t=l(at,!0);s(at);var $={};L(()=>{D(_t,(e(vt),n(()=>e(vt).name))),$!==($=(e(vt),n(()=>e(vt).id)))&&(at.value=(at.__value=(e(vt),n(()=>e(vt).id)))??"")}),c(ct,at)}),s(re);var ot;ts(re),s(le),L(()=>{ot!==(ot=(t(),n(()=>t().subclass)))&&(re.value=(re.__value=(t(),n(()=>t().subclass)))??"",Oa(re,(t(),n(()=>t().subclass))))}),A("change",re,k),c(Ue,le)};_(xe,Ue=>{e(m),n(()=>e(m).length>0)&&Ue(Me)})}var R=a(xe,2),T=a(l(R),2);Ce(T),s(R);var x=a(R,2),J=a(l(x),2);Ce(J),s(x);var g=a(x,2),M=a(l(g),2);Ce(M),s(g);var Y=a(g,2),He=a(l(Y),2);Ce(He),s(Y),s(N),L(()=>{ee!==(ee=(t(),n(()=>t().class)))&&(pe.value=(pe.__value=(t(),n(()=>t().class)))??"",Oa(pe,(t(),n(()=>t().class)))),Ba(T,(t(),n(()=>t().level)))}),Ie(he,()=>t().name,Ue=>jt(ve,n(t).name=Ue,n(t))),A("change",pe,y),A("change",T,H),Ie(J,()=>t().race,Ue=>jt(ve,n(t).race=Ue,n(t))),Ie(M,()=>t().background,Ue=>jt(ve,n(t).background=Ue,n(t))),Ie(He,()=>t().alignment,Ue=>jt(ve,n(t).alignment=Ue,n(t))),c(V,N)};_(fe,V=>{v(),n(()=>!v().characterInfo)&&V(ne)})}s(P),c(i,P),Vt(),p()}var kl=f('<div class="ability-card svelte-bbv1xt"><h3 class="svelte-bbv1xt"> </h3> <input type="number" class="ability-score svelte-bbv1xt" min="1" max="30"/> <div class="ability-modifier svelte-bbv1xt"> </div> <div class="roll-buttons svelte-bbv1xt"><button class="roll-btn svelte-bbv1xt">Check</button> <button class="roll-btn svelte-bbv1xt">Save</button></div> <div class="save-proficiency svelte-bbv1xt"><input type="checkbox" class="svelte-bbv1xt"/> <label class="svelte-bbv1xt">Save Prof.</label></div></div>'),wl=f('<div class="proficiency-bonus svelte-bbv1xt"><label for="profBonus">Proficiency Bonus</label> <input type="number" id="profBonus" class="prof-input svelte-bbv1xt"/></div> <div class="abilities-grid svelte-bbv1xt"></div>',1),$l=f("<section><!> <!></section>");function Sl(i,o){Kt(o,!1);const t=()=>rt(Fa,"$abilityModifiers",w),v=()=>rt(ve,"$character",w),d=()=>rt(ga,"$searchFilter",w),p=()=>rt(Zt,"$collapsedStates",w),m=()=>rt(ha,"$isEditMode",w),[w,y]=oa(),k=S(),H=S(),P=_a(),Z=[{key:"strength",label:"Strength"},{key:"dexterity",label:"Dexterity"},{key:"constitution",label:"Constitution"},{key:"intelligence",label:"Intelligence"},{key:"wisdom",label:"Wisdom"},{key:"charisma",label:"Charisma"}];function fe(){Ss()}function ne(Re){const Ee=t()[Re],ee=`1d20${Ee>=0?"+":""}${Ee}`,xe=[];xe.push({value:"1d20",source:"base die"}),Ee!==0&&xe.push({value:Ee,source:Re}),P("roll",{notation:ee,rollType:"check",bonusBreakdown:xe})}function V(Re){const Ee=t()[Re],ee=v().saveProficiencies[Re]?v().proficiencyBonus:0,xe=Ee+ee,Me=`1d20${xe>=0?"+":""}${xe}`,R=[];R.push({value:"1d20",source:"base die"}),Ee!==0&&R.push({value:Ee,source:Re}),ee!==0&&R.push({value:ee,source:"proficiency"}),P("roll",{notation:Me,rollType:"save",bonusBreakdown:R})}Je(()=>d(),()=>{r(k,Z.filter(({label:Re})=>d()?Re.toLowerCase().includes(d().toLowerCase()):!0))}),Je(()=>(e(k),d()),()=>{r(H,e(k).length>0||!d()||d().toLowerCase().includes("proficiency"))}),da(),zt();var N=$l();let U;var he=l(N);ya(he,{title:"Ability Scores",get collapsed(){return p(),n(()=>p().abilityScores)},ariaLabel:"Toggle Ability Scores Section",onToggle:()=>Zt.update(Re=>({...Re,abilityScores:!Re.abilityScores}))});var Pe=a(he,2);{var pe=Re=>{var Ee=wl(),ee=je(Ee),xe=a(l(ee),2);Ce(xe),s(ee);var Me=a(ee,2);xt(Me,5,()=>e(k),$t,(R,T)=>{let x=()=>e(T).key,J=()=>e(T).label;var g=kl(),M=l(g),Y=l(M,!0);s(M);var He=a(M,2);Ce(He);var Ue=a(He,2),le=l(Ue);s(Ue);var re=a(Ue,2),We=l(re),qe=a(We,2);s(re);var ot=a(re,2),ct=l(ot);Ce(ct);var vt=a(ct,2);s(ot),s(g),L(at=>{D(Y,at),D(le,`${t(),x(),n(()=>t()[x()]>=0?"+":"")??""}${t(),x(),n(()=>t()[x()])??""}`),ct.disabled=!m(),Ve(ct,"id",`${x()}-save`),Ve(vt,"for",`${x()}-save`)},[()=>(J(),n(()=>J().substring(0,3).toUpperCase()))]),Ie(He,()=>v().abilities[x()],at=>jt(ve,n(v).abilities[x()]=at,n(v))),A("change",He,fe),A("click",We,()=>ne(x())),A("click",qe,()=>V(x())),wa(ct,()=>v().saveProficiencies[x()],at=>jt(ve,n(v).saveProficiencies[x()]=at,n(v))),c(R,g)}),s(Me),Ie(xe,()=>v().proficiencyBonus,R=>jt(ve,n(v).proficiencyBonus=R,n(v))),c(Re,Ee)};_(Pe,Re=>{p(),n(()=>!p().abilityScores)&&Re(pe)})}s(N),L(()=>U=Lt(N,1,"ability-scores svelte-bbv1xt",null,U,{hidden:!e(H)})),c(i,N),Vt(),y()}const Ls=[{name:"Unarmored",type:"none",baseAC:10},{name:"Padded",type:"light",baseAC:11},{name:"Leather",type:"light",baseAC:11},{name:"Studded Leather",type:"light",baseAC:12},{name:"Hide",type:"medium",baseAC:12,maxDexBonus:2},{name:"Chain Shirt",type:"medium",baseAC:13,maxDexBonus:2},{name:"Scale Mail",type:"medium",baseAC:14,maxDexBonus:2},{name:"Breastplate",type:"medium",baseAC:14,maxDexBonus:2},{name:"Half Plate",type:"medium",baseAC:15,maxDexBonus:2},{name:"Ring Mail",type:"heavy",baseAC:14,maxDexBonus:0},{name:"Chain Mail",type:"heavy",baseAC:16,maxDexBonus:0},{name:"Splint",type:"heavy",baseAC:17,maxDexBonus:0},{name:"Plate",type:"heavy",baseAC:18,maxDexBonus:0}];function As(i){return Ls.find(o=>o.name===i)}function Cl(i,o,t){if(!i)return 10+o+(t?2:0);const v=As(i);if(!v)return 10+o+(t?2:0);let d=v.baseAC;return v.maxDexBonus===void 0?d+=o:v.maxDexBonus>0&&(d+=Math.min(o,v.maxDexBonus)),t&&(d+=2),d}function Pa(i){return Math.floor((i-10)/2)}function ss(i,o){if(!i.class)return null;const t=ra(i.class);if(!t||!t.spellcaster||!t.spellcastingAbility)return null;const v=Pa(o[t.spellcastingAbility]);return 8+i.proficiencyBonus+v}function gs(i,o){if(!i.class)return 0;const t=ra(i.class);return!t||!t.spellcaster||!t.spellcastingAbility?0:Pa(o[t.spellcastingAbility])}function Dl(i,o){const t=[],v=Pa(o.dexterity),d=i.armorName?As(i.armorName):void 0;if(d){if(d.type==="none")t.push("Unarmored"),t.push("Base: 10"),t.push(`Dexterity: ${v>=0?"+":""}${v}`);else if(d.type==="light")t.push(`${d.name}: ${d.baseAC}`),t.push(`Dexterity: ${v>=0?"+":""}${v}`);else if(d.type==="medium"){const p=Math.min(2,v);t.push(`${d.name}: ${d.baseAC}`),t.push(`Dexterity: ${p>=0?"+":""}${p} (max +2)`)}else d.type==="heavy"&&(t.push(`${d.name}: ${d.baseAC}`),t.push("Dexterity: +0 (heavy armor)"));i.shieldEquipped&&t.push("Shield: +2")}else{t.push("Base: 10"),v!==0&&t.push(`Dexterity: ${v>=0?"+":""}${v}`);const p=10+v,m=i.armorClass-p;m!==0&&t.push(`Other: ${m>=0?"+":""}${m}`)}return i.activeStates&&i.activeStates.length>0&&i.activeStates.forEach(p=>{typeof p.acBonus=="number"&&p.acBonus!==0&&(!p.target||p.target==="self")&&t.push(`${p.name}: ${p.acBonus>=0?"+":""}${p.acBonus}`)}),t.join(`
`)}function Ll(i,o){const t=[],v=Pa(o.dexterity);t.push(`Dexterity: ${v>=0?"+":""}${v}`);const d=i.initiative-v;return d!==0&&t.push(`Other Bonuses: ${d>=0?"+":""}${d}`),t.join(`
`)}function Al(i,o){if(!i.class)return"";const t=ra(i.class);if(!t||!t.spellcaster||!t.spellcastingAbility)return"";const v=[],d=Pa(o[t.spellcastingAbility]),p=t.spellcastingAbility.charAt(0).toUpperCase()+t.spellcastingAbility.slice(1);return v.push("Base: 8"),v.push(`Proficiency: +${i.proficiencyBonus}`),v.push(`${p}: ${d>=0?"+":""}${d}`),v.join(`
`)}function jl(i,o,t){const v=[];let d=i;const p=o.toLowerCase().trim();if(t.activeStates){for(const m of t.activeStates)if(m.immunities&&m.immunities.length>0&&m.immunities.some(y=>y.toLowerCase().trim()===p))return v.push(`Immune to ${o} (${m.name})`),{finalDamage:0,adjustments:v}}if(t.activeStates){for(const m of t.activeStates)if(m.resistances&&m.resistances.length>0&&m.resistances.some(y=>y.toLowerCase().trim()===p)){const y=Math.floor(d/2);v.push(`Resistant to ${o} (${m.name}): ${d} ‚Üí ${y}`),d=y;break}}return v.length===0&&v.push(`No adjustments for ${o}`),{finalDamage:d,adjustments:v}}function Bl(i,o){const t={...i};if(t.tempHP>0){if(o<=t.tempHP)return t.tempHP-=o,t;o-=t.tempHP,t.tempHP=0}return t.currentHP=Math.max(0,t.currentHP-o),t}var Rl=f('<button class="info-icon svelte-1o8ci7b" type="button">‚ÑπÔ∏è</button>'),Ml=f('<button class="info-icon svelte-1o8ci7b" type="button">‚ÑπÔ∏è</button>'),Fl=f("<div><!></div>"),Pl=f('<div class="tooltip-wrapper svelte-1o8ci7b"><!> <!></div>');function Ya(i,o){Kt(o,!1);let t=kt(o,"tooltipContent",8),v=kt(o,"ariaLabel",8,"Show information"),d=S(!1),p=S(),m=S(!1),w=S(null),y=S(!1),k=S(!1),H=S("");const P=Math.random().toString(36).slice(2);function Z(){window.dispatchEvent(new CustomEvent("tooltip-open",{detail:P}))}function fe(R){R.detail!==P&&(r(d,!1),r(y,!1))}function ne(){r(m,window.matchMedia("(pointer: coarse)").matches||"ontouchstart"in window)}function V(){if(!e(w)||!e(p))return;const R=e(p).getBoundingClientRect(),T=e(w).getBoundingClientRect();let x=R.bottom+5,J=R.left;r(y,!1),J+T.width>window.innerWidth-8&&(J=R.right-T.width,r(y,!0),J<8&&(J=8)),J<8&&(J=8),x+T.height>window.innerHeight-8&&(x=R.top-T.height-5),r(H,`position:fixed;top:${x}px;left:${J}px;z-index:1000;`),r(k,!0)}function N(){Z(),r(d,!1),r(k,!1),requestAnimationFrame(()=>{r(d,!0),r(k,!1),setTimeout(V,0)})}function U(){r(d,!1),r(y,!1)}function he(R){R.stopPropagation(),e(d)?(r(d,!1),r(y,!1),r(k,!1)):(Z(),r(d,!1),r(k,!1),requestAnimationFrame(()=>{r(d,!0),r(k,!1),setTimeout(V,0)}))}function Pe(R){e(p)&&!e(p).contains(R.target)&&(r(d,!1),r(y,!1))}Ca(()=>{ne(),document.addEventListener("click",Pe),window.addEventListener("tooltip-open",fe)}),Ms(()=>{document.removeEventListener("click",Pe),window.removeEventListener("tooltip-open",fe)}),zt();var pe=Pl(),Re=l(pe);{var Ee=R=>{var T=Rl();L(()=>Ve(T,"aria-label",v())),A("click",T,he),c(R,T)},ee=R=>{var T=Ml();L(()=>Ve(T,"aria-label",v())),A("mouseenter",T,N),A("mouseleave",T,U),c(R,T)};_(Re,R=>{e(m)?R(Ee):R(ee,!1)})}var xe=a(Re,2);{var Me=R=>{var T=Fl(),x=l(T);nl(x,o,"content",{},J=>{var g=pt(),M=je(g);il(M,t),c(J,g)}),s(T),Ra(T,J=>r(w,J),()=>e(w)),L(()=>{Lt(T,1,`tooltip-popup ${e(y)?"right-align":""}`,"svelte-1o8ci7b"),rl(T,e(k)?e(H)+"opacity:1;pointer-events:auto;":"opacity:0;pointer-events:none;position:fixed;top:0;left:0;z-index:1000;")}),c(R,T)};_(xe,R=>{e(d)&&R(Me)})}s(pe),Ra(pe,R=>r(p,R),()=>e(p)),c(i,pe),Vt()}var Tl=f("<option> </option>"),Il=f('<div class="armor-config svelte-1r5hyyb"><h4 class="svelte-1r5hyyb">Armor Configuration</h4> <div class="armor-controls svelte-1r5hyyb"><div class="armor-field svelte-1r5hyyb"><label for="armorName" class="svelte-1r5hyyb">Armor</label> <select id="armorName" class="armor-select svelte-1r5hyyb"><option>None (Unarmored)</option><!></select></div> <div class="armor-field svelte-1r5hyyb"><label class="shield-label svelte-1r5hyyb"><input type="checkbox" class="shield-checkbox svelte-1r5hyyb"/> Shield Equipped (+2 AC)</label></div></div></div>'),El=f('<div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="spellSaveDC" class="svelte-1r5hyyb">Spell Save DC</label> <!></div> <input type="number" id="spellSaveDC" class="stat-input svelte-1r5hyyb" readonly=""/></div>'),Hl=f('<span class="hit-dice-type"> </span>'),Ul=f('<!> <div class="stats-grid svelte-1r5hyyb"><div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="armorClass" class="svelte-1r5hyyb">Armor Class</label> <!></div> <input type="text" id="armorClass" readonly=""/></div> <div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="initiative" class="svelte-1r5hyyb">Initiative</label> <!></div> <input type="text" id="initiative" class="stat-input svelte-1r5hyyb" readonly=""/></div> <div class="stat-box svelte-1r5hyyb"><label for="speed" class="svelte-1r5hyyb">Speed</label> <input type="text" id="speed" class="stat-input svelte-1r5hyyb"/></div> <!></div> <div class="hp-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Points</h3> <div><div class="hp-inputs svelte-1r5hyyb"><input type="number" class="hp-current svelte-1r5hyyb" min="0"/> <span class="hp-separator svelte-1r5hyyb">/</span> <input type="number" class="hp-max svelte-1r5hyyb" min="0"/></div> <div class="hp-controls svelte-1r5hyyb"><button class="hp-btn svelte-1r5hyyb">‚àí</button> <button class="hp-btn svelte-1r5hyyb">+</button> <button class="hp-btn svelte-1r5hyyb">‚àí5</button> <button class="hp-btn svelte-1r5hyyb">+5</button></div></div> <div class="temp-hp svelte-1r5hyyb"><label for="tempHP" class="svelte-1r5hyyb">Temp HP</label> <input type="number" id="tempHP" min="0" class="svelte-1r5hyyb"/></div></div> <div class="hit-dice-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Dice</h3> <div class="hit-dice-display svelte-1r5hyyb"><input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <span>/</span> <input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <!></div> <div class="hit-dice-controls svelte-1r5hyyb"><label for="hitDiceCount" class="svelte-1r5hyyb">Roll</label> <div class="hit-dice-count-controls svelte-1r5hyyb"><button class="hit-dice-btn svelte-1r5hyyb">‚àí</button> <input type="number" id="hitDiceCount" class="hit-dice-count-input svelte-1r5hyyb" min="1"/> <button class="hit-dice-btn svelte-1r5hyyb">+</button></div> <button class="btn btn-primary roll-hit-dice use-enabled svelte-1r5hyyb">üé≤ Roll</button></div></div>',1),Nl=f("<section><!> <!></section>");function Ol(i,o){Kt(o,!1);const t=()=>rt(ve,"$character",w),v=()=>rt(Fa,"$abilityModifiers",w),d=()=>rt(ga,"$searchFilter",w),p=()=>rt(Zt,"$collapsedStates",w),m=()=>rt(ha,"$isEditMode",w),[w,y]=oa(),k=S(),H=S(),P=S(),Z=S(),fe=S(),ne=S(),V=S(),N=_a();let U=S(1);function he(R){ve.update(T=>(T.currentHP=Math.max(0,Math.min(T.maxHP,T.currentHP+R)),T))}function Pe(R){const T=e(U)+R,x=t().hitDice.current;r(U,Math.max(1,Math.min(x,T)))}function pe(R=1){if(t().hitDice.current<=0){alert("No hit dice remaining!");return}if(!t().class){alert("Please select a class first!");return}const T=ra(t().class);if(!T){alert("Invalid class configuration!");return}const x=Math.min(R,t().hitDice.current),J=T.hitDice,g=v().constitution,M=g*x,Y=M>=0?`+${M}`:`${M}`,He=`${x}${J}${Y}`,Ue=[];if(Ue.push({value:`${x}${J}`,source:"hit dice"}),g!==0)for(let le=0;le<x;le++)Ue.push({value:g,source:"constitution"});N("rollHitDice",{notation:He,hitDie:J,count:x,bonusBreakdown:Ue})}Je(()=>(t(),v(),ve),()=>{if(t().armorName!==void 0||t().shieldEquipped!==void 0){const R=v().dexterity,T=Cl(t().armorName,R,t().shieldEquipped||!1);t().armorClass!==T&&ve.update(x=>({...x,armorClass:T}))}}),Je(()=>(v(),t(),ve),()=>{const R=v().dexterity;t().initiative!==R&&ve.update(T=>({...T,initiative:R}))}),Je(()=>t(),()=>{r(k,ss(t(),t().abilities))}),Je(()=>t(),()=>{r(H,Dl(t(),t().abilities))}),Je(()=>t(),()=>{r(P,Ll(t(),t().abilities))}),Je(()=>t(),()=>{r(Z,Al(t(),t().abilities))}),Je(()=>(t(),e(U)),()=>{const R=t().hitDice.current;R>0&&e(U)>R&&r(U,R)}),Je(()=>t(),()=>{r(fe,t().activeStates&&t().activeStates.length>0?t().activeStates.reduce((R,T)=>R+(T.acBonus||0),0):0)}),Je(()=>t(),()=>{r(ne,t().activeStates&&t().activeStates.length>0?t().activeStates.some(R=>R.name==="Aid"&&R.target==="self"):!1)}),Je(()=>d(),()=>{r(V,!d()||"armor class".includes(d().toLowerCase())||"initiative".includes(d().toLowerCase())||"speed".includes(d().toLowerCase())||"hit points".includes(d().toLowerCase())||"hp".includes(d().toLowerCase())||"hit dice".includes(d().toLowerCase())||"spell save".includes(d().toLowerCase())||"combat".includes(d().toLowerCase()))}),da(),zt();var Re=Nl();let Ee;var ee=l(Re);{let R=ht(()=>(p(),n(()=>p().combatStats?"Expand":"Collapse")));ya(ee,{title:"Combat Stats",get collapsed(){return p(),n(()=>p().combatStats)},get ariaLabel(){return e(R)},onToggle:()=>Zt.update(T=>({...T,combatStats:!T.combatStats}))})}var xe=a(ee,2);{var Me=R=>{var T=Ul(),x=je(T);{var J=ae=>{var Oe=Il(),de=a(l(Oe),2),Fe=l(de),Qe=a(l(Fe),2);L(()=>{t(),It(()=>{})});var Ke=l(Qe);Ke.value=(Ke.__value=void 0)??"";var st=a(Ke);xt(st,1,()=>Ls,$t,(q,ye)=>{var me=pt(),Ge=je(me);{var Ae=dt=>{var Ze=Tl(),lt=l(Ze);s(Ze);var W={};L(()=>{D(lt,`${e(ye),n(()=>e(ye).name)??""} (AC ${e(ye),n(()=>e(ye).baseAC)??""})`),W!==(W=(e(ye),n(()=>e(ye).name)))&&(Ze.value=(Ze.__value=(e(ye),n(()=>e(ye).name)))??"")}),c(dt,Ze)};_(Ge,dt=>{e(ye),n(()=>e(ye).name!=="Unarmored")&&dt(Ae)})}c(q,me)}),s(Qe),s(Fe);var b=a(Fe,2),F=l(b),ue=l(F);Ce(ue),Xt(),s(F),s(b),s(de),s(Oe),Ma(Qe,()=>t().armorName,q=>jt(ve,n(t).armorName=q,n(t))),wa(ue,()=>t().shieldEquipped,q=>jt(ve,n(t).shieldEquipped=q,n(t))),c(ae,Oe)};_(x,ae=>{m()&&ae(J)})}var g=a(x,2),M=l(g),Y=l(M),He=a(l(Y),2);Ya(He,{get tooltipContent(){return e(H)},ariaLabel:"Show AC breakdown"}),s(Y);var Ue=a(Y,2);Ce(Ue),s(M);var le=a(M,2),re=l(le),We=a(l(re),2);Ya(We,{get tooltipContent(){return e(P)},ariaLabel:"Show Initiative breakdown"}),s(re);var qe=a(re,2);Ce(qe),s(le);var ot=a(le,2),ct=a(l(ot),2);Ce(ct),s(ot);var vt=a(ot,2);{var at=ae=>{var Oe=El(),de=l(Oe),Fe=a(l(de),2);Ya(Fe,{get tooltipContent(){return e(Z)},ariaLabel:"Show Spell Save DC breakdown"}),s(de);var Qe=a(de,2);Ce(Qe),s(Oe),L(()=>Ba(Qe,e(k))),c(ae,Oe)};_(vt,ae=>{e(k)!==null&&ae(at)})}s(g);var _t=a(g,2),$=a(l(_t),2);let O;var I=l($),C=l(I);Ce(C);var E=a(C,4);Ce(E),s(I);var X=a(I,2),ge=l(X),we=a(ge,2),se=a(we,2),_e=a(se,2);s(X),s($);var K=a($,2),B=a(l(K),2);Ce(B),s(K),s(_t);var Le=a(_t,2),ze=a(l(Le),2),Te=l(ze);Ce(Te);var Ye=a(Te,4);Ce(Ye);var te=a(Ye,2);{var u=ae=>{const Oe=ht(()=>(z(ra),t(),n(()=>ra(t().class))));var de=pt(),Fe=je(de);{var Qe=Ke=>{const st=ht(()=>(v(),n(()=>v().constitution)));var b=Hl(),F=l(b);s(b),L(()=>D(F,`(${z(e(Oe)),n(()=>e(Oe).hitDice)??""}${(e(st)>=0?`+${e(st)}`:e(st))??""})`)),c(Ke,b)};_(Fe,Ke=>{e(Oe)&&Ke(Qe)})}c(ae,de)};_(te,ae=>{t(),n(()=>t().class)&&ae(u)})}s(ze);var $e=a(ze,2),be=a(l($e),2),G=l(be),De=a(G,2);Ce(De);var oe=a(De,2);s(be);var ke=a(be,2);s($e),s(Le),L(()=>{Ba(Ue,(e(fe),t(),n(()=>e(fe)!==0?`${t().armorClass} ‚Üí ${t().armorClass+e(fe)}`:`${t().armorClass}`))),Lt(Ue,1,Xs(e(fe)!==0?"stat-input ac-enhanced":"stat-input"),"svelte-1r5hyyb"),Ba(qe,(t(),n(()=>t().initiative))),O=Lt($,1,"hp-display svelte-1r5hyyb",null,O,{"aid-active":e(ne)}),Ve(C,"max",(t(),n(()=>t().maxHP))),Ve(Te,"max",(t(),n(()=>t().hitDice.max))),G.disabled=e(U)<=1,Ve(De,"max",(t(),n(()=>t().hitDice.current))),oe.disabled=(e(U),t(),n(()=>e(U)>=t().hitDice.current)),ke.disabled=(t(),n(()=>t().hitDice.current<=0||!t().class))}),Ie(ct,()=>t().speed,ae=>jt(ve,n(t).speed=ae,n(t))),Ie(C,()=>t().currentHP,ae=>jt(ve,n(t).currentHP=ae,n(t))),Ie(E,()=>t().maxHP,ae=>jt(ve,n(t).maxHP=ae,n(t))),A("click",ge,()=>he(-1)),A("click",we,()=>he(1)),A("click",se,()=>he(-5)),A("click",_e,()=>he(5)),Ie(B,()=>t().tempHP,ae=>jt(ve,n(t).tempHP=ae,n(t))),Ie(Te,()=>t().hitDice.current,ae=>jt(ve,n(t).hitDice.current=ae,n(t))),Ie(Ye,()=>t().hitDice.max,ae=>jt(ve,n(t).hitDice.max=ae,n(t))),A("click",G,()=>Pe(-1)),Ie(De,()=>e(U),ae=>r(U,ae)),A("input",De,ae=>{const Oe=ae.target,de=parseInt(Oe.value);de>t().hitDice.current&&r(U,t().hitDice.current),de<1&&r(U,1)}),A("click",oe,()=>Pe(1)),A("click",ke,()=>pe(e(U))),c(R,T)};_(xe,R=>{p(),n(()=>!p().combatStats)&&R(Me)})}s(Re),L(()=>Ee=Lt(Re,1,"combat-stats svelte-1r5hyyb",null,Ee,{hidden:!e(V)})),c(i,Re),Vt(),y()}const Ea={acrobatics:"dexterity",animalHandling:"wisdom",arcana:"intelligence",athletics:"strength",deception:"charisma",history:"intelligence",insight:"wisdom",intimidation:"charisma",investigation:"intelligence",medicine:"wisdom",nature:"intelligence",perception:"wisdom",performance:"charisma",persuasion:"charisma",religion:"intelligence",sleightOfHand:"dexterity",stealth:"dexterity",survival:"wisdom"};var Gl=f('<div class="skill-row svelte-1f1pl16"><input type="checkbox" class="svelte-1f1pl16"/> <label class="svelte-1f1pl16"> <span class="ability-tag svelte-1f1pl16"> </span></label> <span class="skill-modifier svelte-1f1pl16"> </span> <button class="roll-btn svelte-1f1pl16">Roll</button></div>'),ql=f('<div class="skills-grid svelte-1f1pl16"></div>'),Wl=f("<section><!> <!></section>");function zl(i,o){Kt(o,!1);const t=()=>rt(ve,"$character",w),v=()=>rt(Fa,"$abilityModifiers",w),d=()=>rt(ga,"$searchFilter",w),p=()=>rt(Zt,"$collapsedStates",w),m=()=>rt(ha,"$isEditMode",w),[w,y]=oa(),k=S(),H=S(),P=S(),Z=S(),fe=S(),ne=S(),V=_a(),N=[{key:"acrobatics",label:"Acrobatics"},{key:"animalHandling",label:"Animal Handling"},{key:"arcana",label:"Arcana"},{key:"athletics",label:"Athletics"},{key:"deception",label:"Deception"},{key:"history",label:"History"},{key:"insight",label:"Insight"},{key:"intimidation",label:"Intimidation"},{key:"investigation",label:"Investigation"},{key:"medicine",label:"Medicine"},{key:"nature",label:"Nature"},{key:"perception",label:"Perception"},{key:"performance",label:"Performance"},{key:"persuasion",label:"Persuasion"},{key:"religion",label:"Religion"},{key:"sleightOfHand",label:"Sleight of Hand"},{key:"stealth",label:"Stealth"},{key:"survival",label:"Survival"}];function U(ee){const xe=Ea[ee],Me=v()[xe],R=t().skillProficiencies[ee]?t().proficiencyBonus:0,T=e(k)[ee],x=`1d20${T>=0?"+":""}${T}`,J=[];J.push({value:"1d20",source:"base die"}),Me!==0&&J.push({value:Me,source:xe}),R!==0&&J.push({value:R,source:"proficiency"}),V("roll",{notation:x,rollType:"check",bonusBreakdown:J})}Je(()=>{},()=>{r(k,{})}),Je(()=>t(),()=>{r(H,t().skillProficiencies)}),Je(()=>t(),()=>{r(P,t().proficiencyBonus)}),Je(()=>v(),()=>{r(Z,v())}),Je(()=>(e(Z),e(H),e(P)),()=>{for(const{key:ee}of N){const xe=Ea[ee],Me=e(Z)[xe],R=e(H)[ee]?e(P):0;ma(k,e(k)[ee]=Me+R)}}),Je(()=>d(),()=>{r(fe,N.filter(({label:ee})=>d()?ee.toLowerCase().includes(d().toLowerCase()):!0))}),Je(()=>e(fe),()=>{r(ne,e(fe).length>0)}),da(),zt();var he=Wl();let Pe;var pe=l(he);{let ee=ht(()=>(p(),n(()=>p().skills?"Expand":"Collapse")));ya(pe,{title:"Skills",get collapsed(){return p(),n(()=>p().skills)},get ariaLabel(){return e(ee)},onToggle:()=>Zt.update(xe=>({...xe,skills:!xe.skills}))})}var Re=a(pe,2);{var Ee=ee=>{var xe=ql();xt(xe,5,()=>e(fe),$t,(Me,R)=>{let T=()=>e(R).key,x=()=>e(R).label;var J=Gl(),g=l(J);Ce(g);var M=a(g,2),Y=l(M),He=a(Y),Ue=l(He);s(He),s(M);var le=a(M,2),re=l(le);s(le);var We=a(le,2);s(J),L(qe=>{Cs(g,(e(H),T(),n(()=>e(H)[T()]))),g.disabled=!m(),Ve(g,"id",T()),Ve(M,"for",T()),D(Y,`${x()??""} `),D(Ue,`(${qe??""})`),D(re,`${e(k),T(),n(()=>e(k)[T()]>=0?"+":"")??""}${e(k),T(),n(()=>e(k)[T()])??""}`)},[()=>(z(Ea),T(),n(()=>Ea[T()].substring(0,3).toUpperCase()))]),A("change",g,qe=>{console.log("Skill proficiency changed:",T(),qe.target.checked),ve.update(ot=>({...ot,skillProficiencies:{...ot.skillProficiencies,[T()]:qe.target.checked}}))}),A("click",We,()=>U(T())),c(Me,J)}),s(xe),c(ee,xe)};_(Re,ee=>{p(),n(()=>!p().skills)&&ee(Ee)})}s(he),L(()=>Pe=Lt(he,1,"skills svelte-1f1pl16",null,Pe,{hidden:!e(ne)})),c(i,he),Vt(),y()}var Kl=f('<p class="empty-message svelte-1123ljy">No attacks or spells to reorder.</p>'),Vl=f('<li class="reorder-item svelte-1123ljy"><span class="attack-name svelte-1123ljy"> </span> <div class="reorder-buttons svelte-1123ljy"><button class="btn-move svelte-1123ljy" aria-label="Move up">‚ñ≤</button> <button class="btn-move svelte-1123ljy" aria-label="Move down">‚ñº</button></div></li>'),Jl=f('<ul class="reorder-list svelte-1123ljy"></ul>'),Yl=f('<div class="modal-backdrop svelte-1123ljy" role="presentation"><div class="modal-content svelte-1123ljy" role="dialog" aria-modal="true" aria-labelledby="modal-title"><div class="modal-header svelte-1123ljy"><h3 id="modal-title" class="svelte-1123ljy">Reorder Attacks & Spells</h3> <button class="btn-close svelte-1123ljy" aria-label="Close">√ó</button></div> <div class="modal-body svelte-1123ljy"><!></div> <div class="modal-footer svelte-1123ljy"><button class="btn btn-secondary svelte-1123ljy">Cancel</button> <button class="btn btn-primary svelte-1123ljy">Save Order</button></div></div></div>');function Ql(i,o){Kt(o,!1);let t=kt(o,"show",8,!1),v=kt(o,"attacks",24,()=>[]),d=kt(o,"onSave",8),p=kt(o,"onCancel",8),m=S([]);function w(N,U){const he=e(m)[N];ma(m,e(m)[N]=e(m)[U]),ma(m,e(m)[U]=he),r(m,[...e(m)])}function y(N){N>0&&w(N,N-1)}function k(N){N<e(m).length-1&&w(N,N+1)}function H(){d()(e(m))}function P(){p()()}function Z(N){N.target===N.currentTarget&&P()}Je(()=>(z(t()),z(v())),()=>{t()&&r(m,[...v()])}),da(),zt();var fe=pt(),ne=je(fe);{var V=N=>{var U=Yl(),he=l(U),Pe=l(he),pe=a(l(Pe),2);s(Pe);var Re=a(Pe,2),Ee=l(Re);{var ee=x=>{var J=Kl();c(x,J)},xe=x=>{var J=Jl();xt(J,7,()=>e(m),g=>g.id,(g,M,Y)=>{var He=Vl(),Ue=l(He),le=l(Ue,!0);s(Ue);var re=a(Ue,2),We=l(re),qe=a(We,2);s(re),s(He),L(()=>{D(le,(e(M),n(()=>e(M).name||"(Unnamed attack or spell)"))),We.disabled=e(Y)===0,qe.disabled=(z(e(Y)),e(m),n(()=>e(Y)===e(m).length-1))}),A("click",We,()=>y(e(Y))),A("click",qe,()=>k(e(Y))),c(g,He)}),s(J),c(x,J)};_(Ee,x=>{e(m),n(()=>e(m).length===0)?x(ee):x(xe,!1)})}s(Re);var Me=a(Re,2),R=l(Me),T=a(R,2);s(Me),s(he),s(U),A("click",pe,P),A("click",R,P),A("click",T,H),A("click",U,Z),c(N,U)};_(ne,N=>{t()&&N(V)})}c(i,fe),Vt()}let Ha=null,Ua=null;async function js(){if(Ha)return Ha;try{return Ha=await(await fetch(Ds("/data/spells.json"))).json(),Ha||[]}catch(i){return console.error("Failed to load spells:",i),[]}}async function Xl(){if(Ua)return Ua;try{return Ua=await(await fetch(Ds("/data/feats.json"))).json(),Ua||[]}catch(i){return console.error("Failed to load feats:",i),[]}}function bs(i,o){if(!o.trim())return i;const t=o.toLowerCase();return i.filter(v=>v.name.toLowerCase().includes(t)||v.school.toLowerCase().includes(t)||v.classes.some(d=>d.toLowerCase().includes(t))||v.description.toLowerCase().includes(t))}function Zl(i,o){return o===null?i:i.filter(t=>t.level===o)}function ei(i,o){if(!o.trim())return i;const t=o.toLowerCase();return i.filter(v=>v.name.toLowerCase().includes(t)||v.description.toLowerCase().includes(t))}function Na(i){const o=i.description,t=/\b(Strength|Dexterity|Constitution|Intelligence|Wisdom|Charisma)\s+saving\s+throw/i,v=o.match(t);if(!v)return null;const d=v[1].toLowerCase(),m=/half\s+(?:as\s+much\s+)?damage\s+on\s+a\s+successful(?:\s+save)?/i.test(o),y=/saving\s+throw\s+or\s+take.*?damage/i.test(o)&&!m;return{ability:d,halfDamageOnSave:m,noDamageOnSave:y}}function ti(i){const o=i.description;return/(plus|add)\s+your\s+spellcasting\s+(ability\s+)?modifier/i.test(o)}function Qa(i){const o=i.description.toLowerCase();return o.includes("ranged spell attack")||o.includes("melee spell attack")}function hs(i){const o=i.description.toLowerCase();if(["Divine Favor","Bless","Aid","Command"].includes(i.name))return!0;const d=["takes","take","deals","deal","damage equal to","force damage","fire damage","cold damage","lightning damage","thunder damage","acid damage","poison damage","necrotic damage","radiant damage","psychic damage","regain","regains","hit point"].some(w=>o.includes(w));return["bonus to attack","bonus to damage","bonus to ac","gains a +","gain a +","+1 bonus","+2 bonus","+3 bonus","advantage on","becomes a magic weapon"].some(w=>o.includes(w))&&!d}function ai(i){const o=i.description;let t=0,v=0,d=0,p="";const m=o.match(/\+(\d+)\s+bonus\s+to\s+attack\s+rolls\s+and\s+damage\s+rolls/i);if(m){const y=parseInt(m[1]);t=y,v=y,p=`+${y} to attack and damage rolls`}if(i.name==="Bless"&&(p="Add 1d4 to attack rolls and saves",t="1d4"),i.name==="Aid")return p="+5 HP (max and current) for 8 hours",{attackBonus:0,damageBonus:0,acBonus:0,hpBonus:5,description:p,name:i.name};i.name==="Divine Favor"&&(p="Your weapon attacks deal an extra 1d4 radiant damage on a hit.",v="1d4");const w=o.match(/\+(\d+)\s+bonus\s+to\s+AC/i);return w&&(d=parseInt(w[1]),p=`+${d} to AC`),i.name==="Haste"&&(p="+2 AC, doubled speed, extra action",d=2),p||t!==0||v!==0||d!==0?{attackBonus:t,damageBonus:v,acBonus:d,description:p||i.description.substring(0,100),name:i.name}:null}function Xa(i){const o=i.description,t=/takes?\s+(\d+d\d+)\s+\w+\s+damage[^.]*\.\s*If\s+the\s+target\s+is\s+missing.*?instead\s+takes?\s+(\d+d\d+)/is,v=o.match(t);return v?{baseDamage:v[1],alternateDamage:v[2]}:null}var si=f('<button class="btn btn-secondary">Reorder</button>'),li=f('<div class="edit-buttons svelte-14o91c5"><button class="btn btn-secondary">Add Attack</button> <!></div>'),ii=f('<input type="text" placeholder="Attack name" class="attack-name svelte-14o91c5"/>'),ni=f('<h4 class="attack-name-display svelte-14o91c5"> </h4>'),ri=f('<button class="btn-remove svelte-14o91c5">√ó</button>'),oi=f('<div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Bonus</label> <input type="number" class="attack-bonus svelte-14o91c5"/></div>'),ci=f('<div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Damage</label> <input type="text" placeholder="e.g., 2d6+3" class="attack-damage svelte-14o91c5"/></div>'),vi=f('<div class="spell-info-loading svelte-14o91c5">Loading spell info...</div>'),di=f('<li class="svelte-14o91c5"><strong>At Higher Levels:</strong> </li>'),ui=f('<ul class="svelte-14o91c5"><li class="svelte-14o91c5"><strong>Level:</strong> </li> <li class="svelte-14o91c5"><strong>Casting Time:</strong> </li> <li class="svelte-14o91c5"><strong>Range:</strong> </li> <li class="svelte-14o91c5"><strong>Components:</strong> <!></li> <li class="svelte-14o91c5"><strong>Duration:</strong> <!> </li> <li class="svelte-14o91c5"><strong>Description:</strong> </li> <!></ul>'),fi=f('<span class="scaled-damage svelte-14o91c5" style="margin-left: 8px;"> </span>'),pi=f('<span class="scaled-damage svelte-14o91c5">(Half damage)</span>'),mi=f('<span class="scaled-damage svelte-14o91c5">(No damage)</span>'),gi=f('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> <!> <!></label></div>'),bi=f('<span class="scaled-damage svelte-14o91c5"> </span>'),hi=f('<span class="scaled-damage svelte-14o91c5"> </span>'),_i=f('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> Target is missing HP <!></label></div>'),yi=f("<option> </option>"),xi=f('<span class="scaled-damage svelte-14o91c5"><!> </span>'),ki=f('<span class="scaled-damage svelte-14o91c5"> </span>'),wi=f('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> Target is Fiend or Undead <!></label></div>'),$i=f('<div class="spell-level-selector svelte-14o91c5"><label class="svelte-14o91c5">Cast at Level:</label> <select class="spell-level-select use-enabled svelte-14o91c5"></select> <!></div> <!>',1),Si=f('<div class="spell-level-selector svelte-14o91c5"><span style="color: #dc3545; font-weight: bold;">No spell slots available!</span></div>'),Ci=f('<div class="spell-info svelte-14o91c5"><div class="spell-info-header svelte-14o91c5" role="button" tabindex="0"><h4 class="svelte-14o91c5">Spell Info</h4> <button class="collapse-btn-small svelte-14o91c5"> </button></div> <!></div> <!> <!> <!>',1),Di=f('<div class="spell-info-missing svelte-14o91c5">Spell info not found.</div>'),Li=f('<div class="attack-notes svelte-14o91c5"><label class="svelte-14o91c5">Notes</label> <textarea placeholder="e.g., DC 15 Dex save, Range 120 ft, Concentration" class="notes-input svelte-14o91c5" rows="2"></textarea></div>'),Ai=f('<button class="btn btn-primary">Roll Attack</button>'),ji=f('<div class="buff-target-selection svelte-14o91c5"><div class="target-options svelte-14o91c5"><label class="target-option svelte-14o91c5"><input type="radio" class="svelte-14o91c5"/> Self</label> <label class="target-option svelte-14o91c5"><input type="radio" class="svelte-14o91c5"/> Other</label></div> <button class="btn btn-info"> </button></div>'),Bi=f('<button class="btn btn-info">Cast Spell</button>'),Ri=f("<button><!></button>"),Mi=f('<button class="btn btn-info">Cast Spell</button>'),Fi=f('<button class="btn btn-secondary">Roll Damage</button>'),Pi=f('<button class="btn btn-primary">Roll Attack</button> <!>',1),Ti=f('<div class="attack-card svelte-14o91c5"><div class="attack-header svelte-14o91c5"><!> <!></div> <div class="attack-details svelte-14o91c5"><!> <!> <div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Type</label> <input type="text" placeholder="e.g., slashing" class="attack-type svelte-14o91c5"/></div></div> <!> <!> <div class="attack-actions svelte-14o91c5"><!></div></div>'),Ii=f('<p class="no-attacks svelte-14o91c5">No attacks added yet. Click "Add Attack" to create one.</p>'),Ei=f('<p class="no-attacks svelte-14o91c5">No attacks match your search.</p>'),Hi=f('<span class="ability-uses svelte-14o91c5"> <!></span>'),Ui=f('<span class="ability-reaction svelte-14o91c5">‚ö° Reaction</span>'),Ni=f('<button class="btn btn-ability svelte-14o91c5">Use Ability</button>'),Oi=f('<div class="ability-card svelte-14o91c5"><div class="ability-header svelte-14o91c5"><h4 class="ability-name svelte-14o91c5"> </h4> <span class="ability-source svelte-14o91c5"> </span></div> <p class="ability-description svelte-14o91c5"> </p> <div class="ability-footer svelte-14o91c5"><!> <!> <!></div></div>'),Gi=f('<div class="condition-abilities-section svelte-14o91c5"><h3 class="abilities-header svelte-14o91c5">Condition Abilities</h3> <p class="section-description svelte-14o91c5">Special actions granted by active conditions (e.g., Flicker of Deceit)</p> <div class="abilities-list svelte-14o91c5"></div></div>'),qi=f('<button class="btn-remove svelte-14o91c5">√ó</button>'),Wi=f('<div class="state-card svelte-14o91c5"><div class="state-header svelte-14o91c5"><input type="text" placeholder="Effect name (e.g., Magic Weapon)" class="state-name svelte-14o91c5"/> <!></div> <div class="state-details svelte-14o91c5"><div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Attack Bonus</label> <input type="number" class="state-bonus svelte-14o91c5"/></div> <div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Damage Bonus</label> <input type="text" class="state-bonus svelte-14o91c5"/></div> <div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Target</label> <select class="state-bonus svelte-14o91c5"><option>Self</option><option>Other</option></select></div></div> <div class="state-description svelte-14o91c5"><label class="svelte-14o91c5">Description</label> <input type="text" placeholder="e.g., +1 to attack and damage rolls (Magic Weapon)" class="state-desc-input svelte-14o91c5"/></div></div>'),zi=f('<div class="states-list svelte-14o91c5"></div>'),Ki=f('<p class="no-states svelte-14o91c5">No active effects. Add spell effects that modify your attacks.</p>'),Vi=f('<!> <div class="attacks-list svelte-14o91c5"><!> <!></div> <!> <div class="active-states-section svelte-14o91c5"><h3 class="svelte-14o91c5">Active Spell Effects</h3> <p class="section-description svelte-14o91c5">Effects that modify attack and damage rolls (e.g., Magic Weapon, Bless)</p> <button class="btn btn-secondary">Add Effect</button> <!></div>',1),Ji=f("<section><!> <!></section> <!>",1);function Yi(i,o){Kt(o,!1);const t=()=>rt(ve,"$character",w),v=()=>rt(Fa,"$abilityModifiers",w),d=()=>rt(ga,"$searchFilter",w),p=()=>rt(Zt,"$collapsedStates",w),m=()=>rt(ha,"$isEditMode",w),[w,y]=oa(),k=S(),H=S(),P=S(),Z=[];function fe($,O){ve.update(I=>{if(!I.activeStates)return I;const C=I.activeStates.findIndex(we=>we.name===$);if(C===-1)return I;const E=I.activeStates[C];if(!E.abilities)return I;const X=E.abilities.findIndex(we=>we.name===O);if(X===-1)return I;const ge=E.abilities[X];return ge.currentUses!==void 0&&ge.currentUses>0&&(ge.currentUses-=1,ge.usesPerRest!==void 0?Et.add(`Used ${O} (${ge.currentUses}/${ge.usesPerRest} remaining)`,"info"):Et.add(`Used ${O}`,"info")),I})}const ne=_a();let V=S({}),N=S({}),U=S(!1);function he($){ma(V,e(V)[$]=!e(V)[$]),r(V,{...e(V)})}function Pe($){return $.description.toLowerCase().includes("regain")&&($.description.toLowerCase().includes("hit point")||$.description.toLowerCase().includes("hp"))}function pe($){return["Shield of Faith","Bless","Aid","Magic Weapon"].includes($)}function Re(){ve.update($=>($.attacks=[...$.attacks,{id:crypto.randomUUID(),name:"",bonus:0,damage:"",damageType:"",notes:""}],$))}function Ee($){ve.update(O=>(O.attacks=O.attacks.filter(I=>I.id!==$),O))}function ee(){r(U,!0)}function xe(){r(U,!1)}function Me($){ve.update(O=>(O.attacks=$,O)),r(U,!1),Et.add("Attack order updated successfully!","success")}function R($){let O=$.damage,I=!1,C=!1;if($.spellRef){const se=g($.spellRef);if(se&&(C=Qa(se),se.level>0)){const _e=$.castAtLevel||se.level;if(!M(_e)){Et.add(`No level ${_e} spell slots available!`,"error");return}const B=Na(se);B&&$.targetSucceededSave&&B.noDamageOnSave?O="0":(I=B?.halfDamageOnSave&&$.targetSucceededSave||!1,O=Y($,se))}}else if(t().activeStates&&t().activeStates.length>0){let se=0,_e=[];for(const K of t().activeStates)K.target!=="other"&&(typeof K.damageBonus=="string"?_e.push(K.damageBonus):typeof K.damageBonus=="number"&&(se+=K.damageBonus));if((se!==0||_e.length>0)&&O){const K=O.match(/(\d+d\d+)([+-]\d+)?/);if(K){const[,B,Le]=K,Te=(Le?parseInt(Le):0)+se;let Ye=`${B}`;Te!==0&&(Ye+=`${Te>=0?"+":""}${Te}`),_e.length>0&&(Ye+=" + "+_e.join(" + ")),O=Ye}}}const E=[];let X=0;if(C){const se=gs(t(),v()),_e=t().proficiencyBonus||0;E.push({value:_e,source:"proficiency"}),E.push({value:se,source:"spellcasting"}),X=_e+se}else $.bonus!==0&&E.push({value:$.bonus,source:"base"}),X=$.bonus;let ge=[];if(t().activeStates)for(const se of t().activeStates)se.target!=="other"&&(typeof se.attackBonus=="number"&&se.attackBonus!==0?(E.push({value:se.attackBonus,source:se.name.toLowerCase()}),X+=se.attackBonus):typeof se.attackBonus=="string"&&se.attackBonus&&(ge.push(se.attackBonus),E.push({value:se.attackBonus,source:se.name.toLowerCase()})));let we=`1d20${X>=0?"+":""}${X}`;ge.length>0&&(we+="+"+ge.join("+")),ne("roll",{notation:we,damageNotation:O,attackName:$.name,applyHalfDamage:I,bonusBreakdown:E,rollType:"attack"})}function T($){if(!$.damage){Et.add(`${$.name}: No damage specified`,"error");return}let O=$.damage,I=!1;const C=[];if($.spellRef){const E=g($.spellRef);if(E&&E.level>0){const X=$.castAtLevel||E.level;if(!M(X)){Et.add(`No level ${X} spell slots available!`,"error");return}const we=Na(E);we&&$.targetSucceededSave&&we.noDamageOnSave?O="0":(I=we?.halfDamageOnSave&&$.targetSucceededSave||!1,O=Y($,E))}}else{const E=O.match(/(\d+d\d+)([+-]\d+)?/);if(E){const[,X,ge]=E,we=ge?parseInt(ge):0;if(we!==0&&C.push({value:we,source:"base"}),t().activeStates&&t().activeStates.length>0){let se=0,_e=[];for(const K of t().activeStates)K.target!=="other"&&(typeof K.damageBonus=="string"?_e.push(K.damageBonus):typeof K.damageBonus=="number"&&K.damageBonus!==0&&(C.push({value:K.damageBonus,source:K.name.toLowerCase()}),se+=K.damageBonus));if(se!==0||_e.length>0){const K=we+se;let B=`${X}`;K!==0&&(B+=`${K>=0?"+":""}${K}`),_e.length>0&&(B+=" + "+_e.join(" + ")),O=B}}}}ne("roll",{notation:O,attackName:$.name,applyHalfDamage:I,bonusBreakdown:C})}let x=S([]),J=S(!1);Ca(async()=>{r(x,await js()),r(J,!0)});function g($){return e(x).find(O=>O.name===$)}function M($){t().classFeatures.spellSlotsByLevel||jt(ve,n(t).classFeatures.spellSlotsByLevel={},n(t)),t().classFeatures.spellSlotsByLevel[$]||jt(ve,n(t).classFeatures.spellSlotsByLevel[$]=Array(2).fill(!1),n(t));const I=t().classFeatures.spellSlotsByLevel[$].findIndex(C=>!C);return I===-1?!1:(ve.update(C=>(C.classFeatures.spellSlotsByLevel||(C.classFeatures.spellSlotsByLevel={}),C.classFeatures.spellSlotsByLevel[$]||(C.classFeatures.spellSlotsByLevel[$]=Array(2).fill(!1)),C.classFeatures.spellSlotsByLevel[$][I]=!0,C)),!0)}function Y($,O){let I=$.damage,C=0,E=0;const X=Xa(O);if(X&&$.targetIsDamaged&&(I=X.alternateDamage),ti(O)&&(E+=gs(t(),v())),t().activeStates)for(const Te of t().activeStates)Te.target!=="other"&&typeof Te.damageBonus=="number"&&(E+=Te.damageBonus);if(O.higherLevelSlot&&$.castAtLevel){const Te=O.level,te=($.castAtLevel||Te)-Te;if(te>0){const u=O.higherLevelSlot.match(/(\d+)d(\d+)\s+for\s+each.*?level\s+above/i);if(u){const[,$e]=u;C+=te*parseInt($e)}}}if($.targetIsFiendOrUndead&&O.description.includes("Fiend or an Undead")){const Te=O.description.match(/increases by (\d+)d(\d+) if.*?Fiend or.*?Undead/i);if(Te){const[,Ye]=Te;C+=parseInt(Ye)}}const ge=I.match(/(\d+)d(\d+)([+-]\d+)?/);if(!ge)return E!==0?E>=0?`${E}`:`${E}`:I||"0";const[,we,se,_e]=ge,K=parseInt(we)+C,Le=(_e?parseInt(_e):0)+E;let ze=`${K}d${se}`;return Le!==0&&(ze+=Le>=0?`+${Le}`:`${Le}`),ze}function He($){const O=[];for(let C=$.level;C<=9;C++){const E=t().classFeatures.spellSlotsByLevel?.[C];E&&E.length>0&&O.push(C)}return O}function Ue(){ve.update($=>($.activeStates||($.activeStates=[]),$.activeStates=[...$.activeStates,{name:"",attackBonus:0,damageBonus:0,description:"",target:"self"}],$))}function le($){ve.update(O=>{if(O.activeStates){const I=O.activeStates[$];I?.hpBonus&&I.target!=="other"&&(O.maxHP-=I.hpBonus,O.currentHP=Math.max(1,Math.min(O.currentHP-I.hpBonus,O.maxHP))),O.activeStates=O.activeStates.filter((C,E)=>E!==$)}return O})}function re($,O="self"){const I=g($.spellRef);if(!I){Et.add("Spell not found","error");return}const C=$.castAtLevel||I.level;if(C>0&&!M(C)){Et.add(`No level ${C} spell slots available!`,"error");return}const E=ai(I);if(!E){Et.add(`${I.name} cast! Check spell description for effects.`,"info");return}let X=E.hpBonus||0,ge=E.description;I.name==="Aid"&&C>I.level&&(X=5+(C-I.level)*5,ge=`+${X} HP (max and current) for 8 hours`);const se=["Shield of Faith","Bless","Aid","Magic Weapon"].includes(I.name);ve.update(K=>{K.activeStates||(K.activeStates=[]);const B=K.activeStates.find(Le=>Le.name===I.name);return B&&B.hpBonus&&B.target!=="other"&&(K.maxHP-=B.hpBonus,K.currentHP=Math.max(1,Math.min(K.currentHP-B.hpBonus,K.maxHP))),K.activeStates=K.activeStates.filter(Le=>Le.name!==I.name),X>0&&O==="self"&&(K.maxHP+=X,K.currentHP+=X),K.activeStates=[...K.activeStates,{name:I.name,attackBonus:E.attackBonus,damageBonus:E.damageBonus,acBonus:E.acBonus,description:ge,target:O,hpBonus:X}],K});const _e=O==="self"?" on self":" on other";Et.add(`${I.name} cast${se?_e:""}! Effect added to Active Spell Effects.`,"success")}Je(()=>t(),()=>{r(k,t().activeStates?t().activeStates.filter($=>$.abilities&&$.abilities.length>0).flatMap($=>$.abilities.map(O=>({...O,conditionName:$.name}))):[])}),Je(()=>(t(),e(V),e(N)),()=>{if(t()&&t().attacks)for(const $ of t().attacks)$.spellRef&&e(V)[$.id]===void 0&&ma(V,e(V)[$.id]=!0),$.spellRef&&e(N)[$.id]===void 0&&ma(N,e(N)[$.id]="self")}),Je(()=>(t(),d()),()=>{r(H,t().attacks.filter($=>{if(!d())return!0;const O=d().toLowerCase();return $.name.toLowerCase().includes(O)||$.damageType.toLowerCase().includes(O)}).sort(($,O)=>!$.spellRef&&O.spellRef?-1:$.spellRef&&!O.spellRef?1:0))}),Je(()=>(d(),e(H)),()=>{r(P,!d()||e(H).length>0||"attack".includes(d().toLowerCase())||"spell".includes(d().toLowerCase()))}),da(),zt();var We=Ji(),qe=je(We);let ot;var ct=l(qe);{let $=ht(()=>(p(),n(()=>p().attacks?"Expand":"Collapse")));ya(ct,{title:"Attacks & Spells",get collapsed(){return p(),n(()=>p().attacks)},get ariaLabel(){return e($)},onToggle:()=>Zt.update(O=>({...O,attacks:!O.attacks}))})}var vt=a(ct,2);{var at=$=>{var O=Vi(),I=je(O);{var C=te=>{var u=li(),$e=l(u),be=a($e,2);{var G=De=>{var oe=si();A("click",oe,ee),c(De,oe)};_(be,De=>{t(),n(()=>t().attacks.length>0)&&De(G)})}s(u),A("click",$e,Re),c(te,u)};_(I,te=>{m()&&te(C)})}var E=a(I,2),X=l(E);xt(X,1,()=>e(H),te=>te.id,(te,u,$e)=>{var be=Ti(),G=l(be),De=l(G);{var oe=W=>{var Q=ii();Ce(Q),Ie(Q,()=>e(u).name,Be=>(e(u).name=Be,It(()=>(e(H),t(),d())))),c(W,Q)},ke=W=>{var Q=ni(),Be=l(Q,!0);s(Q),L(()=>D(Be,(e(u),n(()=>e(u).name||"(Unnamed Attack)")))),c(W,Q)};_(De,W=>{m()?W(oe):W(ke,!1)})}var ae=a(De,2);{var Oe=W=>{var Q=ri();A("click",Q,()=>Ee(e(u).id)),c(W,Q)};_(ae,W=>{m()&&W(Oe)})}s(G);var de=a(G,2),Fe=l(de);{var Qe=W=>{var Q=oi(),Be=l(Q),it=a(Be,2);Ce(it),s(Q),L(()=>{Ve(Be,"for",`attack-bonus-${e(u),n(()=>e(u).id)??""}`),Ve(it,"id",`attack-bonus-${e(u),n(()=>e(u).id)??""}`)}),Ie(it,()=>e(u).bonus,ut=>(e(u).bonus=ut,It(()=>(e(H),t(),d())))),c(W,Q)};_(Fe,W=>{e(u),n(()=>e(u).bonus!==0&&e(u).bonus!==void 0)&&W(Qe)})}var Ke=a(Fe,2);{var st=W=>{var Q=ci(),Be=l(Q),it=a(Be,2);Ce(it),s(Q),L(()=>{Ve(Be,"for",`attack-damage-${e(u),n(()=>e(u).id)??""}`),Ve(it,"id",`attack-damage-${e(u),n(()=>e(u).id)??""}`)}),Ie(it,()=>e(u).damage,ut=>(e(u).damage=ut,It(()=>(e(H),t(),d())))),c(W,Q)};_(Ke,W=>{e(u),n(()=>e(u).damage&&e(u).damage.trim()!=="")&&W(st)})}var b=a(Ke,2),F=l(b),ue=a(F,2);Ce(ue),s(b),s(de);var q=a(de,2);{var ye=W=>{var Q=pt(),Be=je(Q);{var it=mt=>{var h=vi();c(mt,h)},ut=mt=>{const h=ht(()=>(e(u),n(()=>g(e(u).spellRef))));var ie=pt(),j=je(ie);{var et=nt=>{const ce=ht(()=>(z(Na),z(e(h)),n(()=>Na(e(h))))),Xe=ht(()=>(z(Xa),z(e(h)),n(()=>Xa(e(h)))));var tt=Ci(),yt=je(tt),wt=l(yt),Ut=a(l(wt),2),Nt=l(Ut,!0);s(Ut),s(wt);var Jt=a(wt,2);{var gt=Ct=>{var Bt=ui(),Mt=l(Bt),sa=a(l(Mt));s(Mt);var la=a(Mt,2),ua=a(l(la));s(la);var Ot=a(la,2),Ft=a(l(Ot));s(Ot);var Gt=a(Ot,2),ea=a(l(Gt)),Ne=a(ea);{var ft=Tt=>{var Ht=Dt();L(()=>D(Ht,`(${z(e(h)),n(()=>e(h).material)??""})`)),c(Tt,Ht)};_(Ne,Tt=>{z(e(h)),n(()=>e(h).material)&&Tt(ft)})}s(Gt);var bt=a(Gt,2),At=a(l(bt),2);{var Rt=Tt=>{var Ht=Dt("Concentration,");c(Tt,Ht)};_(At,Tt=>{z(e(h)),n(()=>e(h).concentration)&&Tt(Rt)})}var Pt=a(At,1,!0);s(bt);var qt=a(bt,2),Qt=a(l(qt));s(qt);var ia=a(qt,2);{var fa=Tt=>{var Ht=di(),Wt=a(l(Ht));s(Ht),L(()=>D(Wt,` ${z(e(h)),n(()=>e(h).higherLevelSlot)??""}`)),c(Tt,Ht)};_(ia,Tt=>{z(e(h)),n(()=>e(h).higherLevelSlot)&&Tt(fa)})}s(Bt),L(Tt=>{D(sa,` ${z(e(h)),n(()=>e(h).level)??""}`),D(ua,` ${z(e(h)),n(()=>e(h).castingTime||e(h).actionType)??""}`),D(Ft,` ${z(e(h)),n(()=>e(h).range)??""}`),D(ea,` ${Tt??""}`),D(Pt,(z(e(h)),n(()=>e(h).duration))),D(Qt,` ${z(e(h)),n(()=>e(h).description)??""}`)},[()=>(z(e(h)),n(()=>e(h).components.join(", ")))]),c(Ct,Bt)};_(Jt,Ct=>{e(V),e(u),n(()=>!e(V)[e(u).id])&&Ct(gt)})}s(yt);var St=a(yt,2);{var ca=Ct=>{var Bt=gi(),Mt=l(Bt),sa=l(Mt);Ce(sa);var la=a(sa),ua=a(la);{var Ot=Ne=>{var ft=fi(),bt=l(ft);s(ft),L(At=>D(bt,`(Spell Save DC: ${At??""})`),[()=>(z(ss),t(),n(()=>ss(t(),t().abilities)))]),c(Ne,ft)};_(ua,Ne=>{t(),n(()=>t().class)&&Ne(Ot)})}var Ft=a(ua,2);{var Gt=Ne=>{var ft=pi();c(Ne,ft)},ea=Ne=>{var ft=pt(),bt=je(ft);{var At=Rt=>{var Pt=mi();c(Rt,Pt)};_(bt,Rt=>{e(u),z(e(ce)),n(()=>e(u).targetSucceededSave&&e(ce).noDamageOnSave)&&Rt(At)},!0)}c(Ne,ft)};_(Ft,Ne=>{e(u),z(e(ce)),n(()=>e(u).targetSucceededSave&&e(ce).halfDamageOnSave)?Ne(Gt):Ne(ea,!1)})}s(Mt),s(Bt),L(Ne=>D(la,` Target succeeded on ${Ne??""} save `),[()=>(z(e(ce)),n(()=>e(ce).ability.charAt(0).toUpperCase()+e(ce).ability.slice(1)))]),wa(sa,()=>e(u).targetSucceededSave,Ne=>(e(u).targetSucceededSave=Ne,It(()=>(e(H),t(),d())))),c(Ct,Bt)};_(St,Ct=>{e(ce)&&Ct(ca)})}var ta=a(St,2);{var va=Ct=>{var Bt=_i(),Mt=l(Bt),sa=l(Mt);Ce(sa);var la=a(sa,2);{var ua=Ft=>{const Gt=ht(()=>(e(u),z(e(h)),n(()=>Y(e(u),e(h)))));var ea=bi(),Ne=l(ea);s(ea),L(()=>D(Ne,`(${z(e(Xe)),n(()=>e(Xe).alternateDamage)??""}, total: ${e(Gt)??""})`)),c(Ft,ea)},Ot=Ft=>{var Gt=hi(),ea=l(Gt);s(Gt),L(()=>D(ea,`(${z(e(Xe)),n(()=>e(Xe).baseDamage)??""})`)),c(Ft,Gt)};_(la,Ft=>{e(u),n(()=>e(u).targetIsDamaged)?Ft(ua):Ft(Ot,!1)})}s(Mt),s(Bt),wa(sa,()=>e(u).targetIsDamaged,Ft=>(e(u).targetIsDamaged=Ft,It(()=>(e(H),t(),d())))),c(Ct,Bt)};_(ta,Ct=>{e(Xe)&&Ct(va)})}var Yt=a(ta,2);{var aa=Ct=>{const Bt=ht(()=>(z(e(h)),n(()=>He(e(h)))));var Mt=pt(),sa=je(Mt);{var la=Ot=>{var Ft=$i(),Gt=je(Ft),ea=l(Gt),Ne=a(ea,2);L(()=>{e(u),It(()=>{e(Bt)})}),xt(Ne,5,()=>e(Bt),$t,(Pt,qt)=>{var Qt=yi(),ia=l(Qt);s(Qt);var fa={};L(()=>{D(ia,`Level ${e(qt)??""}`),fa!==(fa=e(qt))&&(Qt.value=(Qt.__value=e(qt))??"")}),c(Pt,Qt)}),s(Ne);var ft=a(Ne,2);{var bt=Pt=>{const qt=ht(()=>(e(u),z(e(h)),n(()=>Y(e(u),e(h)))));var Qt=xi(),ia=l(Qt);{var fa=Wt=>{var na=Dt("Healing");c(Wt,na)},Tt=Wt=>{var na=Dt("Damage");c(Wt,na)};_(ia,Wt=>{z(e(h)),n(()=>Pe(e(h)))?Wt(fa):Wt(Tt,!1)})}var Ht=a(ia);s(Qt),L(()=>D(Ht,` ${e(qt)??""}`)),c(Pt,Qt)};_(ft,Pt=>{e(u),z(e(h)),n(()=>e(u).castAtLevel&&e(u).castAtLevel>e(h).level)&&Pt(bt)})}s(Gt);var At=a(Gt,2);{var Rt=Pt=>{var qt=wi(),Qt=l(qt),ia=l(Qt);Ce(ia);var fa=a(ia,2);{var Tt=Ht=>{const Wt=ht(()=>(e(u),z(e(h)),n(()=>Y(e(u),e(h)))));var na=ki(),ka=l(na);s(na),L(()=>D(ka,`(+1d8, total: ${e(Wt)??""})`)),c(Ht,na)};_(fa,Ht=>{e(u),n(()=>e(u).targetIsFiendOrUndead)&&Ht(Tt)})}s(Qt),s(qt),wa(ia,()=>e(u).targetIsFiendOrUndead,Ht=>(e(u).targetIsFiendOrUndead=Ht,It(()=>(e(H),t(),d())))),c(Pt,qt)};_(At,Pt=>{z(e(h)),n(()=>e(h).description.includes("Fiend or an Undead"))&&Pt(Rt)})}L(()=>{Ve(ea,"for",`castLevel-${e(u),n(()=>e(u).id)??""}`),Ve(Ne,"id",`castLevel-${e(u),n(()=>e(u).id)??""}`)}),Ma(Ne,()=>e(u).castAtLevel,Pt=>(e(u).castAtLevel=Pt,It(()=>(e(H),t(),d())))),c(Ot,Ft)},ua=Ot=>{var Ft=Si();c(Ot,Ft)};_(sa,Ot=>{z(e(Bt)),n(()=>e(Bt).length>0)?Ot(la):Ot(ua,!1)})}c(Ct,Mt)};_(Yt,Ct=>{z(e(h)),n(()=>e(h).higherLevelSlot&&e(h).level>0)&&Ct(aa)})}L(()=>{Ve(Ut,"aria-label",(e(V),e(u),n(()=>e(V)[e(u).id]?"Expand":"Collapse"))),D(Nt,(e(V),e(u),n(()=>e(V)[e(u).id]?"‚ñº":"‚ñ≤")))}),A("click",wt,()=>he(e(u).id)),A("keydown",wt,Ct=>Ct.key==="Enter"&&he(e(u).id)),c(nt,tt)},Se=nt=>{var ce=Di();c(nt,ce)};_(j,nt=>{e(h)?nt(et):nt(Se,!1)})}c(mt,ie)};_(Be,mt=>{e(x),n(()=>e(x).length===0)?mt(it):mt(ut,!1)})}c(W,Q)};_(q,W=>{e(u),n(()=>e(u).spellRef)&&W(ye)})}var me=a(q,2);{var Ge=W=>{var Q=Li(),Be=l(Q),it=a(Be,2);xa(it),s(Q),L(()=>{Ve(Be,"for",`attack-notes-${e(u),n(()=>e(u).id)??""}`),Ve(it,"id",`attack-notes-${e(u),n(()=>e(u).id)??""}`)}),Ie(it,()=>e(u).notes,ut=>(e(u).notes=ut,It(()=>(e(H),t(),d())))),c(W,Q)};_(me,W=>{e(u),n(()=>!e(u).spellRef)&&W(Ge)})}var Ae=a(me,2),dt=l(Ae);{var Ze=W=>{const Q=ht(()=>(e(u),n(()=>g(e(u).spellRef))));var Be=pt(),it=je(Be);{var ut=mt=>{var h=pt(),ie=je(h);{var j=Se=>{var nt=Ai();A("click",nt,()=>R(e(u))),c(Se,nt)},et=Se=>{var nt=pt(),ce=je(nt);{var Xe=yt=>{var wt=pt(),Ut=je(wt);{var Nt=gt=>{var St=ji(),ca=l(St),ta=l(ca),va=l(ta);Ce(va),va.value=va.__value="self",Xt(),s(ta);var Yt=a(ta,2),aa=l(Yt);Ce(aa),aa.value=aa.__value="other",Xt(),s(Yt),s(ca);var Ct=a(ca,2),Bt=l(Ct);s(Ct),s(St),L(()=>{Ve(va,"name",`target-${e(u),n(()=>e(u).id)??""}`),Ve(aa,"name",`target-${e(u),n(()=>e(u).id)??""}`),D(Bt,`Cast ${z(e(Q)),n(()=>e(Q).name)??""}`)}),ds(Z,[$e],va,()=>e(N)[e(u).id],Mt=>ma(N,e(N)[e(u).id]=Mt)),ds(Z,[$e],aa,()=>e(N)[e(u).id],Mt=>ma(N,e(N)[e(u).id]=Mt)),A("click",Ct,()=>re(e(u),e(N)[e(u).id])),c(gt,St)},Jt=gt=>{var St=Bi();A("click",St,()=>re(e(u),"self")),c(gt,St)};_(Ut,gt=>{z(e(Q)),n(()=>pe(e(Q).name))?gt(Nt):gt(Jt,!1)})}c(yt,wt)},tt=yt=>{var wt=pt(),Ut=je(wt);{var Nt=gt=>{var St=Ri(),ca=l(St);{var ta=Yt=>{var aa=Dt("Roll Healing");c(Yt,aa)},va=Yt=>{var aa=Dt("Roll Damage");c(Yt,aa)};_(ca,Yt=>{z(e(Q)),n(()=>Pe(e(Q)))?Yt(ta):Yt(va,!1)})}s(St),L(Yt=>Lt(St,1,`btn ${Yt??""}`),[()=>(z(e(Q)),n(()=>Pe(e(Q))?"btn-success":"btn-secondary"))]),A("click",St,()=>T(e(u))),c(gt,St)},Jt=gt=>{var St=Mi();A("click",St,()=>re(e(u),"self")),c(gt,St)};_(Ut,gt=>{e(u),n(()=>e(u).damage&&e(u).damage.trim()!=="")?gt(Nt):gt(Jt,!1)})}c(yt,wt)};_(ce,yt=>{z(hs),z(e(Q)),n(()=>hs(e(Q)))?yt(Xe):yt(tt,!1)},!0)}c(Se,nt)};_(ie,Se=>{z(Qa),z(e(Q)),n(()=>Qa(e(Q)))?Se(j):Se(et,!1)})}c(mt,h)};_(it,mt=>{e(Q)&&mt(ut)})}c(W,Be)},lt=W=>{var Q=pt(),Be=je(Q);{var it=ut=>{var mt=Pi(),h=je(mt),ie=a(h,2);{var j=et=>{var Se=Fi();A("click",Se,()=>T(e(u))),c(et,Se)};_(ie,et=>{e(u),n(()=>e(u).damage&&e(u).damage.trim()!=="")&&et(j)})}A("click",h,()=>R(e(u))),c(ut,mt)};_(Be,ut=>{e(u),n(()=>!e(u).spellRef)&&ut(it)},!0)}c(W,Q)};_(dt,W=>{e(u),e(J),n(()=>e(u).spellRef&&e(J))?W(Ze):W(lt,!1)})}s(Ae),s(be),L(()=>{Ve(F,"for",`attack-type-${e(u),n(()=>e(u).id)??""}`),Ve(ue,"id",`attack-type-${e(u),n(()=>e(u).id)??""}`)}),Ie(ue,()=>e(u).damageType,W=>(e(u).damageType=W,It(()=>(e(H),t(),d())))),c(te,be)});var ge=a(X,2);{var we=te=>{var u=Ii();c(te,u)},se=te=>{var u=pt(),$e=je(u);{var be=G=>{var De=Ei();c(G,De)};_($e,G=>{e(H),n(()=>e(H).length===0)&&G(be)},!0)}c(te,u)};_(ge,te=>{t(),n(()=>t().attacks.length===0)?te(we):te(se,!1)})}s(E);var _e=a(E,2);{var K=te=>{var u=Gi(),$e=a(l(u),4);xt($e,5,()=>e(k),$t,(be,G)=>{var De=Oi(),oe=l(De),ke=l(oe),ae=l(ke,!0);s(ke);var Oe=a(ke,2),de=l(Oe);s(Oe),s(oe);var Fe=a(oe,2),Qe=l(Fe,!0);s(Fe);var Ke=a(Fe,2),st=l(Ke);{var b=me=>{var Ge=Hi(),Ae=l(Ge),dt=a(Ae);{var Ze=lt=>{var W=Dt();L(()=>D(W,`per ${e(G),n(()=>e(G).restType)??""} rest`)),c(lt,W)};_(dt,lt=>{e(G),n(()=>e(G).restType)&&lt(Ze)})}s(Ge),L(()=>D(Ae,`${e(G),n(()=>e(G).currentUses??e(G).usesPerRest)??""}/${e(G),n(()=>e(G).usesPerRest)??""} uses `)),c(me,Ge)};_(st,me=>{e(G),n(()=>e(G).usesPerRest)&&me(b)})}var F=a(st,2);{var ue=me=>{var Ge=Ui();c(me,Ge)};_(F,me=>{e(G),n(()=>e(G).requiresReaction)&&me(ue)})}var q=a(F,2);{var ye=me=>{var Ge=Ni();L(()=>Ge.disabled=(e(G),n(()=>e(G).currentUses===void 0||e(G).currentUses===0))),A("click",Ge,()=>fe(e(G).conditionName,e(G).name)),c(me,Ge)};_(q,me=>{m(),e(G),n(()=>!m()&&e(G).usesPerRest)&&me(ye)})}s(Ke),s(De),L(()=>{D(ae,(e(G),n(()=>e(G).name))),D(de,`(${e(G),n(()=>e(G).conditionName)??""})`),D(Qe,(e(G),n(()=>e(G).description)))}),c(be,De)}),s($e),s(u),c(te,u)};_(_e,te=>{e(k),n(()=>e(k).length>0)&&te(K)})}var B=a(_e,2),Le=a(l(B),4),ze=a(Le,2);{var Te=te=>{var u=zi();xt(u,5,()=>(t(),n(()=>t().activeStates)),$t,($e,be,G)=>{var De=Wi(),oe=l(De),ke=l(oe);Ce(ke);var ae=a(ke,2);{var Oe=lt=>{var W=qi();A("click",W,()=>le(G)),c(lt,W)};_(ae,lt=>{m()&&lt(Oe)})}s(oe);var de=a(oe,2),Fe=l(de),Qe=l(Fe);Ve(Qe,"for",`state-attack-bonus-${G}`);var Ke=a(Qe,2);Ce(Ke),Ve(Ke,"id",`state-attack-bonus-${G}`),s(Fe);var st=a(Fe,2),b=l(st);Ve(b,"for",`state-damage-bonus-${G}`);var F=a(b,2);Ce(F),Ve(F,"id",`state-damage-bonus-${G}`),s(st);var ue=a(st,2),q=l(ue);Ve(q,"for",`state-target-${G}`);var ye=a(q,2);L(()=>{e(be),It(()=>{})}),Ve(ye,"id",`state-target-${G}`);var me=l(ye);me.value=me.__value="self";var Ge=a(me);Ge.value=Ge.__value="other",s(ye),s(ue),s(de);var Ae=a(de,2),dt=l(Ae);Ve(dt,"for",`state-desc-${G}`);var Ze=a(dt,2);Ce(Ze),Ve(Ze,"id",`state-desc-${G}`),s(Ae),s(De),Ie(ke,()=>e(be).name,lt=>(e(be).name=lt,It(()=>t()),La(w,"$character"))),Ie(Ke,()=>e(be).attackBonus,lt=>(e(be).attackBonus=lt,It(()=>t()),La(w,"$character"))),Ie(F,()=>e(be).damageBonus,lt=>(e(be).damageBonus=lt,It(()=>t()),La(w,"$character"))),Ma(ye,()=>e(be).target,lt=>(e(be).target=lt,It(()=>t()),La(w,"$character"))),Ie(Ze,()=>e(be).description,lt=>(e(be).description=lt,It(()=>t()),La(w,"$character"))),c($e,De)}),s(u),c(te,u)},Ye=te=>{var u=Ki();c(te,u)};_(ze,te=>{t(),n(()=>t().activeStates&&t().activeStates.length>0)?te(Te):te(Ye,!1)})}s(B),A("click",Le,Ue),c($,O)};_(vt,$=>{p(),n(()=>!p().attacks)&&$(at)})}s(qe);var _t=a(qe,2);Ql(_t,{get show(){return e(U)},get attacks(){return t(),n(()=>t().attacks)},onSave:Me,onCancel:xe}),L(()=>ot=Lt(qe,1,"attacks svelte-14o91c5",null,ot,{hidden:!e(P)})),c(i,We),Vt(),y()}var Qi=f('<span class="slot-checkbox-x svelte-serp1j">&#8212;</span>'),Xi=f('<label><input type="checkbox" class="slot-checkbox-input svelte-serp1j"/> <span><!></span></label>');function _s(i,o){Kt(o,!1);const t=()=>rt(ha,"$isEditMode",v),[v,d]=oa();let p=kt(o,"checked",8,!1),m=kt(o,"disabled",8,!1),w=kt(o,"className",8,""),y=kt(o,"index",8,void 0),k=kt(o,"ariaLabel",8,void 0);const H=_a();function P(U){H("change",{checked:U.currentTarget.checked,index:y()})}zt();var Z=Xi(),fe=l(Z);Ce(fe);var ne=a(fe,2),V=l(ne);{var N=U=>{var he=Qi();c(U,he)};_(V,U=>{p()&&U(N)})}s(ne),s(Z),L(()=>{Lt(Z,1,"slot-checkbox-label "+w()+(t()?"":" not-editable"),"svelte-serp1j"),Cs(fe,p()),fe.disabled=m()||!t(),Ve(fe,"aria-label",k()),Ve(fe,"tabindex",t()?0:-1),Lt(ne,1,`slot-checkbox-custom ${p()?"used":""} ${t()?"":"readonly"}`,"svelte-serp1j")}),A("change",fe,P),c(i,Z),Vt(),d()}var Zi=f('<p class="no-features svelte-1kpvv0n">Select a class to see available features</p>'),en=f('<p class="no-features svelte-1kpvv0n">No class features available at this level</p>'),tn=f('<div class="spell-slots svelte-1kpvv0n"><label class="svelte-1kpvv0n"> </label> <div class="slots-tracker svelte-1kpvv0n"></div></div>'),an=f('<div class="all-spell-slots"></div>'),sn=f('<div class="feature-box spellcasting svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"> </h3> <div class="spell-stats svelte-1kpvv0n"><div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Spell Save DC</label> <div class="spell-value svelte-1kpvv0n"> </div></div> <div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <div class="spell-value svelte-1kpvv0n"> </div></div></div> <!> <div class="prepared-spells svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <textarea placeholder="List your prepared spells..." class="svelte-1kpvv0n"></textarea></div></div>'),ln=f('<p class="unlimited svelte-1kpvv0n">Unlimited Uses</p>'),nn=f('<div class="slots-tracker svelte-1kpvv0n"></div> <div class="uses-actions-row"><button class="btn btn-primary use-enabled"> </button></div> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div>',1),rn=f('<div class="uses-tracker svelte-1kpvv0n"><!></div>'),on=f('<div class="pool-tracker svelte-1kpvv0n"><input type="number" min="0" class="pool-input svelte-1kpvv0n"/> <span> </span> <button class="btn-small svelte-1kpvv0n"> </button></div>'),cn=f('<p class="no-uses svelte-1kpvv0n">No Channel Divinity uses remaining</p>'),vn=f('<div class="channel-divinity-option svelte-1kpvv0n"><button class="btn btn-primary use-enabled svelte-1kpvv0n">Use Channel Divinity</button> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div> <!></div>'),dn=f('<div class="feature-box svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"><!> </h3> <p class="feature-description svelte-1kpvv0n"> </p> <!></div>'),un=f('<div class="features-grid svelte-1kpvv0n"><!> <!></div>'),fn=f("<section><!> <!></section>");function pn(i,o){Kt(o,!1);const t=()=>rt(ve,"$character",m),v=()=>rt(Fa,"$abilityModifiers",m),d=()=>rt(ga,"$searchFilter",m),p=()=>rt(Zt,"$collapsedStates",m),[m,w]=oa(),y=S(),k=S(),H=S(),P=S(),Z=S(),fe=S(),ne=S();let V=S(0),N=S(0);function U(g,M){ve.update(Y=>(Y.classFeatures.features[g]=M,Y))}function he(){ve.update(g=>(g.classFeatures.spellSlotsByLevel||(g.classFeatures.spellSlotsByLevel={}),e(P).forEach(({level:M,slots:Y})=>{g.classFeatures.spellSlotsByLevel[M]||(g.classFeatures.spellSlotsByLevel[M]=Array(Y).fill(!1))}),g))}function Pe(g){if(typeof g.maxUses=="function"){if((g.name==="Divine Sense"||g.name==="War Priest")&&e(y)?.spellcastingAbility){const M=v()[e(y).spellcastingAbility];return g.maxUses(t().level,M)}return g.maxUses(t().level)}return g.maxUses||0}function pe(g,M){ve.update(Y=>((!Y.classFeatures.features[g]||!Array.isArray(Y.classFeatures.features[g])||Y.classFeatures.features[g].length!==M)&&(Y.classFeatures.features[g]=Array(M).fill(!1)),Y))}Fs(()=>{e(fe)&&t()&&t().classFeatures&&t().classFeatures.features&&e(fe).forEach(g=>{if(g.type==="uses"){const M=g.name.replace(/\s+/g,""),Y=Pe(g),He=t().classFeatures.features[M];(!Array.isArray(He)||He.length!==Y)&&pe(M,Y)}})});function Re(g){return typeof g.maxPool=="function"?g.maxPool(t().level):g.maxPool||0}function Ee(g){return typeof g.description=="function"?g.description(t().level):g.description}function ee(){const g="ChannelDivinity";ve.update(M=>{const Y=M.classFeatures.features[g];return typeof Y=="number"&&Y>0&&(M.classFeatures.features[g]=Y-1),M})}function xe(){Zt.update(g=>({...g,classFeatures:!g.classFeatures}))}Je(()=>(t(),ra),()=>{r(y,t().class?ra(t().class):null)}),Je(()=>(t(),Sa),()=>{r(k,t().class?Sa(t().class,t().level,t().subclass):[])}),Je(()=>(t(),ps),()=>{r(H,t().class?ps(t().class,t().level):0)}),Je(()=>(e(y),t()),()=>{r(P,(()=>{if(!e(y)?.spellcaster)return[];const g=t().level,M=[];return g>=1&&M.push({level:1,slots:Math.min(4,2+Math.floor(g/3))}),g>=3&&M.push({level:2,slots:Math.min(3,2+Math.floor((g-3)/4))}),g>=5&&M.push({level:3,slots:Math.min(3,2+Math.floor((g-5)/5))}),g>=7&&M.push({level:4,slots:Math.min(3,1+Math.floor((g-7)/6))}),g>=9&&M.push({level:5,slots:Math.min(2,1+Math.floor((g-9)/8))}),g>=11&&M.push({level:6,slots:1}),g>=13&&M.push({level:7,slots:1}),g>=15&&M.push({level:8,slots:1}),g>=17&&M.push({level:9,slots:1}),M})())}),Je(()=>(e(y),v(),t(),ms),()=>{if(e(y)?.spellcaster&&e(y).spellcastingAbility){const g=v()[e(y).spellcastingAbility];r(V,fl(t().class,g,t().proficiencyBonus)||0),r(N,ms(t().class,t().level,g))}}),Je(()=>(t(),e(y),e(P)),()=>{t().class&&e(y)?.spellcaster&&e(P).length>0&&he()}),Je(()=>t(),()=>{r(Z,(()=>{const M=t().classFeatures.features["ChannelDivinity"];return typeof M=="number"?M:0})())}),Je(()=>(e(k),d()),()=>{r(fe,e(k).filter(g=>{if(!d())return!0;const M=d().toLowerCase();return g.name.toLowerCase().includes(M)||Ee(g).toLowerCase().includes(M)}))}),Je(()=>(d(),t(),e(fe)),()=>{r(ne,!d()||t().class||"class features".includes(d().toLowerCase())||"spellcasting".includes(d().toLowerCase())||e(fe).length>0)}),da(),zt();var Me=fn();let R;var T=l(Me);{let g=ht(()=>(p(),n(()=>p().classFeatures?"Expand":"Collapse")));ya(T,{title:"Class Features",get collapsed(){return p(),n(()=>p().classFeatures)},get ariaLabel(){return e(g)},onToggle:xe})}var x=a(T,2);{var J=g=>{var M=pt(),Y=je(M);{var He=le=>{var re=Zi();c(le,re)},Ue=le=>{var re=pt(),We=je(re);{var qe=ct=>{var vt=en();c(ct,vt)},ot=ct=>{var vt=un(),at=l(vt);{var _t=O=>{var I=sn(),C=l(I),E=l(C);s(C);var X=a(C,2),ge=l(X),we=a(l(ge),2),se=l(we,!0);s(we),s(ge);var _e=a(ge,2),K=a(l(_e),2),B=l(K,!0);s(K),s(_e),s(X);var Le=a(X,2);{var ze=te=>{var u=an();xt(u,5,()=>e(P),$t,($e,be)=>{let G=()=>e(be).level,De=()=>e(be).slots;const oe=ht(()=>(t(),G(),De(),n(()=>t().classFeatures.spellSlotsByLevel?.[G()]||Array(De()).fill(!1))));var ke=tn(),ae=l(ke),Oe=l(ae);s(ae);var de=a(ae,2);xt(de,5,()=>e(oe),$t,(Fe,Qe,Ke)=>{{let st=ht(()=>(z(e(oe)),n(()=>e(oe)[Ke]||!1)));_s(Fe,{get checked(){return e(st)},$$events:{change:b=>{ve.update(F=>(F.classFeatures.spellSlotsByLevel||(F.classFeatures.spellSlotsByLevel={}),F.classFeatures.spellSlotsByLevel[G()]||(F.classFeatures.spellSlotsByLevel[G()]=Array(De()).fill(!1)),F.classFeatures.spellSlotsByLevel[G()][Ke]=b.detail.checked,F))}}})}}),s(de),s(ke),L(()=>D(Oe,`${G()===1?"1st":G()===2?"2nd":G()===3?"3rd":`${G()}th`} Level Spell Slots`)),c($e,ke)}),s(u),c(te,u)};_(Le,te=>{e(P),n(()=>e(P).length>0)&&te(ze)})}var Te=a(Le,2),Ye=a(l(Te),2);xa(Ye),s(Te),s(I),L(te=>{D(E,`Spellcasting (${te??""})`),D(se,e(V)),D(B,e(N))},[()=>(e(y),n(()=>e(y).spellcastingAbility?.toUpperCase()))]),Ie(Ye,()=>t().classFeatures.preparedSpells,te=>jt(ve,n(t).classFeatures.preparedSpells=te,n(t))),c(O,I)};_(at,O=>{e(y),n(()=>e(y)?.spellcaster)&&O(_t)})}var $=a(at,2);xt($,1,()=>e(fe),$t,(O,I)=>{const C=ht(()=>(e(I),n(()=>e(I).name.replace(/\s+/g,"")))),E=ht(()=>(t(),z(e(C)),n(()=>t().classFeatures.features[e(C)]))),X=ht(()=>typeof e(E)=="number");var ge=dn(),we=l(ge),se=l(we);{var _e=te=>{var u=Dt("Channel Divinity:");c(te,u)};_(se,te=>{e(I),n(()=>e(I).type==="channelDivinity")&&te(_e)})}var K=a(se);s(we);var B=a(we,2),Le=l(B,!0);s(B);var ze=a(B,2);{var Te=te=>{const u=ht(()=>(e(I),n(()=>Pe(e(I))))),$e=ht(()=>(z(e(E)),z(e(u)),n(()=>Array.isArray(e(E))?e(E):Array(e(u)).fill(!1))));var be=rn(),G=l(be);{var De=ke=>{var ae=ln();c(ke,ae)},oe=ke=>{var ae=nn(),Oe=je(ae);xt(Oe,5,()=>e($e),$t,(F,ue,q)=>{_s(F,{get checked(){return e(ue)},index:q,$$events:{change:ye=>{ve.update(me=>(me.classFeatures.features[e(C)]||(me.classFeatures.features[e(C)]=Array(e(u)).fill(!1)),me.classFeatures.features[e(C)][q]=ye.detail.checked,me))}}})}),s(Oe);var de=a(Oe,2),Fe=l(de),Qe=l(Fe);s(Fe),s(de);var Ke=a(de,2),st=l(Ke),b=l(st);s(st),s(Ke),L(F=>{Fe.disabled=F,D(Qe,`Use ${e(I),n(()=>e(I).name)??""}`),D(b,`Resets on ${e(I),n(()=>e(I).resetOn==="short"?"Short Rest":"Long Rest")??""}`)},[()=>(z(e($e)),n(()=>e($e).filter(F=>!F).length<=0))]),A("click",Fe,()=>{ve.update(F=>{F.classFeatures.features[e(C)]||(F.classFeatures.features[e(C)]=Array(e(u)).fill(!1));const ue=F.classFeatures.features[e(C)],q=ue.findIndex(ye=>!ye);return q!==-1&&(ue[q]=!0),F})}),c(ke,ae)};_(G,ke=>{e(u)===1/0?ke(De):ke(oe,!1)})}s(be),c(te,be)},Ye=te=>{var u=pt(),$e=je(u);{var be=De=>{const oe=ht(()=>(e(I),n(()=>Re(e(I)))));var ke=on(),ae=l(ke);Ce(ae);var Oe=a(ae,2),de=l(Oe);s(Oe);var Fe=a(Oe,2),Qe=l(Fe,!0);s(Fe),s(ke),L(()=>{Ba(ae,e(X)&&e(E)!==void 0?e(E):e(oe)),Ve(ae,"max",e(oe)),D(de,`/ ${e(oe)??""}`),D(Qe,(e(I),n(()=>e(I).resetOn==="short"?"Short Rest":"Long Rest")))}),A("input",ae,Ke=>{ve.update(st=>(st.classFeatures.features[e(C)]=parseInt(Ke.currentTarget.value)||0,st))}),A("click",Fe,()=>U(e(C),e(oe))),c(De,ke)},G=De=>{var oe=pt(),ke=je(oe);{var ae=Oe=>{var de=vn(),Fe=l(de),Qe=a(Fe,2),Ke=l(Qe),st=l(Ke);s(Ke),s(Qe);var b=a(Qe,2);{var F=ue=>{var q=cn();c(ue,q)};_(b,ue=>{e(Z)<=0&&ue(F)})}s(de),L(()=>{Fe.disabled=e(Z)<=0,D(st,`Resets on ${e(I),n(()=>e(I).resetOn==="short"?"Short Rest":"Long Rest")??""}`)}),A("click",Fe,ee),c(Oe,de)};_(ke,Oe=>{e(I),n(()=>e(I).type==="channelDivinity")&&Oe(ae)},!0)}c(De,oe)};_($e,De=>{e(I),n(()=>e(I).type==="pool")?De(be):De(G,!1)},!0)}c(te,u)};_(ze,te=>{e(I),n(()=>e(I).type==="uses")?te(Te):te(Ye,!1)})}s(ge),L(te=>{D(K,` ${e(I),n(()=>e(I).name)??""}`),D(Le,te)},[()=>(e(I),n(()=>Ee(e(I))))]),c(O,ge)}),s(vt),c(ct,vt)};_(We,ct=>{e(k),n(()=>e(k).length===0)?ct(qe):ct(ot,!1)},!0)}c(le,re)};_(Y,le=>{t(),n(()=>!t().class)?le(He):le(Ue,!1)})}c(g,M)};_(x,g=>{p(),n(()=>!p().classFeatures)&&g(J)})}s(Me),L(()=>R=Lt(Me,1,"class-features svelte-1kpvv0n",null,R,{hidden:!e(ne)})),c(i,Me),Vt(),w()}var mn=f('<textarea placeholder="Enter features, traits, and special abilities..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Equipment</h3> <textarea placeholder="List your equipment and inventory..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Notes</h3> <textarea placeholder="Additional notes..." class="svelte-wttn0l"></textarea>',1),gn=f("<section><!> <!></section>");function bn(i,o){Kt(o,!1);const t=()=>rt(ga,"$searchFilter",p),v=()=>rt(ve,"$character",p),d=()=>rt(Zt,"$collapsedStates",p),[p,m]=oa(),w=S();function y(){Zt.update(ne=>({...ne,notes:!ne.notes}))}Je(()=>(t(),v()),()=>{r(w,!t()||"features".includes(t().toLowerCase())||"traits".includes(t().toLowerCase())||"equipment".includes(t().toLowerCase())||"notes".includes(t().toLowerCase())||v().features.toLowerCase().includes(t().toLowerCase())||v().equipment.toLowerCase().includes(t().toLowerCase())||v().notes.toLowerCase().includes(t().toLowerCase()))}),da(),zt();var k=gn();let H;var P=l(k);{let ne=ht(()=>(d(),n(()=>d().notes?"Expand":"Collapse")));ya(P,{title:"Features & Traits",get collapsed(){return d(),n(()=>d().notes)},get ariaLabel(){return e(ne)},onToggle:y})}var Z=a(P,2);{var fe=ne=>{var V=mn(),N=je(V);xa(N);var U=a(N,4);xa(U);var he=a(U,4);xa(he),Ie(N,()=>v().features,Pe=>jt(ve,n(v).features=Pe,n(v))),Ie(U,()=>v().equipment,Pe=>jt(ve,n(v).equipment=Pe,n(v))),Ie(he,()=>v().notes,Pe=>jt(ve,n(v).notes=Pe,n(v))),c(ne,V)};_(Z,ne=>{d(),n(()=>!d().notes)&&ne(fe)})}s(k),L(()=>H=Lt(k,1,"notes svelte-wttn0l",null,H,{hidden:!e(w)})),c(i,k),Vt(),m()}var hn=f(" <!> <!> <!> <!> <!>",1),_n=f('<div class="color-picker-section svelte-1r90jgp"><h3 class="svelte-1r90jgp">Dice Colors</h3> <div class="color-inputs svelte-1r90jgp"><div class="color-input-group svelte-1r90jgp"><label for="dice-color" class="svelte-1r90jgp">Dice Color</label> <input type="color" id="dice-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="label-color" class="svelte-1r90jgp">Label Color</label> <input type="color" id="label-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="desk-color" class="svelte-1r90jgp">Background Color</label> <input type="color" id="desk-color" class="svelte-1r90jgp"/></div></div></div>'),yn=f('<div class="loading svelte-1r90jgp"><p class="svelte-1r90jgp">Loading 3D dice...</p></div>'),xn=f('<div class="custom-dice-selector svelte-1r90jgp"><h3 class="svelte-1r90jgp">Choose Dice to Roll</h3> <div class="dice-inputs svelte-1r90jgp"><div class="dice-input-group svelte-1r90jgp"><label for="d4" class="svelte-1r90jgp">d4</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d4" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d6" class="svelte-1r90jgp">d6</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d6" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d8" class="svelte-1r90jgp">d8</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d8" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d10" class="svelte-1r90jgp">d10</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d10" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d12" class="svelte-1r90jgp">d12</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d12" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d20" class="svelte-1r90jgp">d20</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d20" min="0" max="10"/></div></div> <div class="dice-controls svelte-1r90jgp"><button class="btn btn-primary use-enabled svelte-1r90jgp"> </button> <button class="btn btn-secondary use-enabled svelte-1r90jgp">Reset</button></div></div>'),kn=f('<span class="crit-badge svelte-1r90jgp">CRITICAL HIT!</span>'),wn=f('<span class="crit-badge crit-fail svelte-1r90jgp">CRITICAL MISS!</span>'),$n=f('<div class="bonus-item svelte-1r90jgp"><span class="bonus-value svelte-1r90jgp"> </span> <span class="bonus-source svelte-1r90jgp"> </span></div>'),Sn=f('<div class="bonus-breakdown svelte-1r90jgp"></div>'),Cn=f('<p class="modifier-text svelte-1r90jgp"> </p>'),Dn=f('<div class="svelte-1r90jgp"><em class="svelte-1r90jgp">No damage is dealt on a critical miss.</em></div>'),Ln=f('<button class="btn btn-follow-up svelte-1r90jgp"> </button>'),An=f('<button class="btn btn-guided-strike svelte-1r90jgp">‚ö° Use Guided Strike (+10)</button>'),jn=f('<div class="follow-up-actions svelte-1r90jgp"><!> <!></div>'),Bn=f('<div class="result-header svelte-1r90jgp"><h3 class="svelte-1r90jgp"> </h3> <!> <!></div> <div class="result-total svelte-1r90jgp"> </div> <div class="result-details svelte-1r90jgp"><!></div> <!> <!>',1),Rn=f('<div role="button" tabindex="-1"><div class="modal-content svelte-1r90jgp" role="dialog" tabindex="0"><div class="modal-header svelte-1r90jgp"><h2 class="svelte-1r90jgp"><!></h2> <div class="header-buttons svelte-1r90jgp"><button class="color-btn svelte-1r90jgp" title="Customize dice colors">üé®</button> <button class="close-btn svelte-1r90jgp">√ó</button></div></div> <!> <!> <div class="dice-main-area svelte-1r90jgp"><div class="dice-container svelte-1r90jgp"></div> <!></div> <div><!></div></div></div>');function Mn(i,o){Kt(o,!1);const t=()=>rt(ve,"$character",v),[v,d]=oa(),p=S(),m=S(),w=S(),y=_a();let k=kt(o,"notation",12,""),H=kt(o,"visible",8,!1),P=kt(o,"damageNotation",12,""),Z=kt(o,"attackName",12,""),fe=kt(o,"applyHalfDamage",8,!1),ne=kt(o,"bonusBreakdown",28,()=>[]),V=kt(o,"rollType",12,"other"),N=null,U=S(void 0),he=S(!1),Pe=S(""),pe=S(null);function Re(){return e(pe)?.resultTotal??null}function Ee(b,F,ue){const q=[];if(!b||!b.result)return q;const ye=F.match(/([+-]?\d*d\d+|[+-]?\d+)/g)||[];let me=0;const Ge=new Set;for(const Ae of ye){const dt=Ae.trim();if(!dt)continue;const Ze=dt.match(/([+-]?)(\d*)d(\d+)/);if(Ze){const lt=parseInt(Ze[2]||"1"),W=`${lt}d${Ze[3]}`,Q=ue.findIndex((ut,mt)=>!Ge.has(mt)&&typeof ut.value=="string"&&ut.value===W),Be=[];for(let ut=0;ut<lt&&me<b.result.length;ut++)Be.push(b.result[me++]);const it=Q>=0?ue[Q].source:"base die";Q>=0&&Ge.add(Q);for(const ut of Be)q.push({display:`${ut}`,source:it})}}for(let Ae=0;Ae<ue.length;Ae++)if(!Ge.has(Ae)&&typeof ue[Ae].value=="number"){const dt=ue[Ae].value;q.push({display:dt>=0?`+${dt}`:`${dt}`,source:ue[Ae].source})}return q}let ee=S(0),xe=S(0),Me=S(0),R=S(0),T=S(0),x=S(0),J=S(0),g=S([]),M=S(!1),Y=S(!1),He=S(!1),Ue=S("#051e0a"),le=S("#ffffff"),re=S("#3a2004"),We=S(!1);function qe(b){return b.length===9&&b.startsWith("#")?b.substring(0,7):b}function ot(b,F="ff"){return b.length===7&&b.startsWith("#")?b+F:b}function ct(){if(window.DICE&&e(U))try{N&&e(U)&&ma(U,e(U).innerHTML="");const b=e(U).clientWidth||500,F=e(U).clientHeight||300;N=new window.DICE.dice_box(e(U),{w:b,h:F}),r(he,!0)}catch(b){console.error("Error initializing dice box:",b)}}Ca(()=>{const b=q=>new Promise((ye,me)=>{if(document.querySelector(`script[src="${q}"]`)){ye(null);return}const Ae=document.createElement("script");Ae.src=q,Ae.onload=()=>{ye(null)},Ae.onerror=()=>{console.error(`Failed to load: ${q}`),me(new Error(`Failed to load ${q}`))},document.head.appendChild(Ae)});setTimeout(()=>{b(`${Aa}/libs/three.min.js`).then(()=>b(`${Aa}/libs/cannon.min.js`)).then(()=>b(`${Aa}/libs/teal.js`)).then(()=>b(`${Aa}/dice.js`)).then(()=>{if(window.DICE){const q=window.DICE.getColors();r(Ue,qe(q.dice_color)),r(le,qe(q.label_color)),r(re,qe(q.desk_color))}ct()}).catch(q=>{console.error("Failed to load dice libraries:",q)})},100);const F=()=>{e(he)&&ct()},ue=q=>{H()&&q.key==="Escape"&&X()};return window.addEventListener("resize",F),window.addEventListener("keydown",ue),()=>{window.removeEventListener("resize",F),window.removeEventListener("keydown",ue)}});function vt(b,F="other"){if(!N||!e(he))return;r(pe,null),r(g,[]),r(M,!1),r(Y,!1),F==="damage"&&ne([]),V(F),r(He,!1),N.diceToRoll=b;const ue=ye=>null,q=ye=>{let me=ye.resultTotal,Ge=ye.resultString;if(fe()&&(me=Math.floor(me/2),Ge=Ge+" (halved)"),r(pe,{...ye,resultTotal:me,resultString:Ge}),console.log("Final roll result:",e(pe)),console.log({type:F}),F==="attack"&&ye.result&&ye.result.length>0){const Ae=ye.result[0];r(M,Ae===20),r(Y,Ae===1)}if(r(g,[]),console.log("Setting up follow-up actions. Type:",F,"damageNotation:",P(),"isCriticalSuccess:",e(M),"isCriticalFail:",e(Y)),F==="attack"&&P())if(e(M)){const Ae=$(P());e(g).push({label:`Roll Critical Damage (${Ae})`,notation:Ae})}else e(Y)||e(g).push({label:`Roll Damage (${P()})`,notation:P()})};N.start_throw(ue,q)}function at(){const b=[];e(ee)>0&&b.push(`${e(ee)}d4`),e(xe)>0&&b.push(`${e(xe)}d6`),e(Me)>0&&b.push(`${e(Me)}d8`),e(R)>0&&b.push(`${e(R)}d10`),e(T)>0&&b.push(`${e(T)}d12`),e(x)>0&&b.push(`${e(x)}d20`);let F=b.join("+")||"1d20";return e(J)!==0&&(F+=e(J)>=0?`+${e(J)}`:`${e(J)}`),F}function _t(){const b=at();vt(b)}function $(b){return b.replace(/(\d+)d(\d+)/g,(F,ue,q)=>`${parseInt(ue)*2}d${q}`)}function O(){r(ee,0),r(xe,0),r(Me,0),r(R,0),r(T,0),r(x,0),r(J,0),r(pe,null),r(g,[]),r(M,!1),r(Y,!1),V("other"),r(He,!1)}function I(){window.DICE&&(window.DICE.setColors({dice_color:ot(e(Ue),"ff"),label_color:ot(e(le),"ff"),desk_color:e(re)}),N&&(N.updateDeskColor(e(re)),N.updateDiceColors()))}function C(){r(We,!e(We))}function E(){!e(pe)||e(m)<=0||e(He)||(r(pe,{...e(pe),resultTotal:e(pe).resultTotal+10,resultString:e(pe).resultString+" + 10 (Guided Strike)"}),ve.update(b=>{const F="ChannelDivinity",ue=b.classFeatures.features[F];return typeof ue=="number"&&ue>0&&(b.classFeatures.features[F]=ue-1),b}),r(He,!0))}function X(){y("close"),k(""),P(""),Z(""),r(Pe,""),r(pe,null),r(He,!1),r(M,!1),r(Y,!1),O()}Je(()=>(t(),Sa),()=>{r(p,t().class?Sa(t().class,t().level,t().subclass).some(F=>F.name==="Guided Strike"):!1)}),Je(()=>t(),()=>{r(m,(()=>{const F=t().classFeatures.features["ChannelDivinity"];return typeof F=="number"?F:0})())}),Je(()=>(e(ee),e(xe),e(Me),e(R),e(T),e(x),e(J)),()=>{r(w,(()=>{const b=[];e(ee)>0&&b.push(`${e(ee)}d4`),e(xe)>0&&b.push(`${e(xe)}d6`),e(Me)>0&&b.push(`${e(Me)}d8`),e(R)>0&&b.push(`${e(R)}d10`),e(T)>0&&b.push(`${e(T)}d12`),e(x)>0&&b.push(`${e(x)}d20`);let F=b.join("+")||"1d20";return e(J)!==0&&(F+=e(J)>=0?`+${e(J)}`:`${e(J)}`),F})())}),Je(()=>(z(k()),e(he),z(H()),e(Pe),z(P()),z(Z()),z(V())),()=>{k()&&e(he)&&H()&&k()!==e(Pe)&&(r(Pe,k()),r(pe,null),r(g,[]),r(M,!1),r(Y,!1),r(He,!1),console.log("Auto-roll triggered. notation:",k(),"damageNotation:",P(),"attackName:",Z(),"rollType:",V()),setTimeout(()=>vt(k(),V()),200))}),da();var ge={getLastRollTotal:Re};zt();var we=Rn();let se;var _e=l(we),K=l(_e),B=l(K),Le=l(B);{var ze=b=>{var F=hn(),ue=je(F),q=a(ue);{var ye=Be=>{var it=Dt("- Attack Roll");c(Be,it)};_(q,Be=>{V()==="attack"&&Be(ye)})}var me=a(q,2);{var Ge=Be=>{var it=Dt("- Damage Roll");c(Be,it)};_(me,Be=>{V()==="damage"&&Be(Ge)})}var Ae=a(me,2);{var dt=Be=>{var it=Dt("- Healing Roll");c(Be,it)};_(Ae,Be=>{V()==="healing"&&Be(dt)})}var Ze=a(Ae,2);{var lt=Be=>{var it=Dt("- Ability Check");c(Be,it)};_(Ze,Be=>{V()==="check"&&Be(lt)})}var W=a(Ze,2);{var Q=Be=>{var it=Dt("- Saving Throw");c(Be,it)};_(W,Be=>{V()==="save"&&Be(Q)})}L(()=>D(ue,`${Z()??""} `)),c(b,F)},Te=b=>{var F=Dt("Dice Roller");c(b,F)};_(Le,b=>{Z()?b(ze):b(Te,!1)})}s(B);var Ye=a(B,2),te=l(Ye),u=a(te,2);s(Ye),s(K);var $e=a(K,2);{var be=b=>{var F=_n(),ue=a(l(F),2),q=l(ue),ye=a(l(q),2);Ce(ye),s(q);var me=a(q,2),Ge=a(l(me),2);Ce(Ge),s(me);var Ae=a(me,2),dt=a(l(Ae),2);Ce(dt),s(Ae),s(ue),s(F),Ie(ye,()=>e(Ue),Ze=>r(Ue,Ze)),A("change",ye,I),Ie(Ge,()=>e(le),Ze=>r(le,Ze)),A("change",Ge,I),Ie(dt,()=>e(re),Ze=>r(re,Ze)),A("change",dt,I),c(b,F)};_($e,b=>{e(We)&&b(be)})}var G=a($e,2);{var De=b=>{var F=yn();c(b,F)};_(G,b=>{e(he)||b(De)})}var oe=a(G,2),ke=l(oe);Ra(ke,b=>r(U,b),()=>e(U));var ae=a(ke,2);{var Oe=b=>{var F=xn(),ue=a(l(F),2),q=l(ue),ye=a(l(q),2);Ce(ye),s(q);var me=a(q,2),Ge=a(l(me),2);Ce(Ge),s(me);var Ae=a(me,2),dt=a(l(Ae),2);Ce(dt),s(Ae);var Ze=a(Ae,2),lt=a(l(Ze),2);Ce(lt),s(Ze);var W=a(Ze,2),Q=a(l(W),2);Ce(Q),s(W);var Be=a(W,2),it=a(l(Be),2);Ce(it),s(Be),s(ue);var ut=a(ue,2),mt=l(ut),h=l(mt);s(mt);var ie=a(mt,2);s(ut),s(F),L(()=>{mt.disabled=!e(he),D(h,`Roll ${e(w)??""}`)}),Ie(ye,()=>e(ee),j=>r(ee,j)),Ie(Ge,()=>e(xe),j=>r(xe,j)),Ie(dt,()=>e(Me),j=>r(Me,j)),Ie(lt,()=>e(R),j=>r(R,j)),Ie(Q,()=>e(T),j=>r(T,j)),Ie(it,()=>e(x),j=>r(x,j)),A("click",mt,_t),A("click",ie,O),c(b,F)};_(ae,b=>{k()||b(Oe)})}s(oe);var de=a(oe,2);let Fe;var Qe=l(de);{var Ke=b=>{var F=Bn(),ue=je(F),q=l(ue),ye=l(q,!0);s(q);var me=a(q,2);{var Ge=ie=>{var j=kn();c(ie,j)};_(me,ie=>{e(M)&&ie(Ge)})}var Ae=a(me,2);{var dt=ie=>{var j=wn();c(ie,j)};_(Ae,ie=>{e(Y)&&ie(dt)})}s(ue);var Ze=a(ue,2),lt=l(Ze,!0);s(Ze);var W=a(Ze,2),Q=l(W);{var Be=ie=>{var j=pt(),et=je(j);{var Se=ce=>{var Xe=Sn();xt(Xe,5,()=>(e(pe),z(k()),z(ne()),n(()=>Ee(e(pe),k(),ne()))),$t,(tt,yt)=>{var wt=$n(),Ut=l(wt),Nt=l(Ut,!0);s(Ut);var Jt=a(Ut,2),gt=l(Jt);s(Jt),s(wt),L(()=>{D(Nt,(e(yt),n(()=>e(yt).display))),D(gt,`(${e(yt),n(()=>e(yt).source)??""})`)}),c(tt,wt)}),s(Xe),c(ce,Xe)},nt=ce=>{var Xe=pt(),tt=je(Xe);{var yt=wt=>{var Ut=Cn(),Nt=l(Ut);s(Ut),L(()=>D(Nt,`Modifier: ${e(pe),n(()=>e(pe).constant>=0?"+":"")??""}${e(pe),n(()=>e(pe).constant)??""}`)),c(wt,Ut)};_(tt,wt=>{e(pe),n(()=>e(pe).constant)&&wt(yt)},!0)}c(ce,Xe)};_(et,ce=>{z(ne()),n(()=>ne().length>0)?ce(Se):ce(nt,!1)})}c(ie,j)};_(Q,ie=>{e(pe),z(ne()),n(()=>e(pe).constant||ne().length>0)&&ie(Be)})}s(W);var it=a(W,2);{var ut=ie=>{var j=Dn();c(ie,j)};_(it,ie=>{e(Y)&&ie(ut)})}var mt=a(it,2);{var h=ie=>{var j=jn(),et=l(j);xt(et,1,()=>e(g),$t,(ce,Xe)=>{var tt=Ln(),yt=l(tt,!0);s(tt),L(()=>D(yt,(e(Xe),n(()=>e(Xe).label)))),A("click",tt,()=>vt(e(Xe).notation,"damage")),c(ce,tt)});var Se=a(et,2);{var nt=ce=>{var Xe=An();L(()=>{Xe.disabled=e(m)<=0,Ve(Xe,"title",e(m)<=0?"No Channel Divinity uses remaining":"Use Channel Divinity to add +10 to this attack roll")}),A("click",Xe,E),c(ce,Xe)};_(Se,ce=>{e(p)&&V()==="attack"&&!e(He)&&e(m)>0&&!e(Y)&&ce(nt)})}s(j),c(ie,j)};_(mt,ie=>{e(g),e(p),z(V()),e(He),e(m),n(()=>e(g).length>0||e(p)&&V()==="attack"&&!e(He)&&e(m)>0)&&ie(h)})}L(()=>{D(ye,Z()?`${Z()} - Result`:"Result"),D(lt,(e(pe),n(()=>e(pe).resultTotal)))}),c(b,F)};_(Qe,b=>{e(pe)&&b(Ke)})}s(de),s(_e),s(we),L(()=>{se=Lt(we,1,"modal-overlay svelte-1r90jgp",null,se,{hidden:!H()}),Fe=Lt(de,1,"roll-result svelte-1r90jgp",null,Fe,{"has-result":e(pe)})}),A("click",te,C),A("click",u,X),A("click",_e,rs(function(b){$a.call(this,o,b)})),A("keydown",_e,function(b){$a.call(this,o,b)}),A("click",we,X),A("keydown",we,b=>b.key==="Escape"&&X()),c(i,we),dl(o,"getLastRollTotal",Re);var st=Vt(ge);return d(),st}const qa="https://api.github.com/gists";async function Fn(i,o,t){if(!o)throw new Error("GitHub token is required");const v=JSON.stringify(i,null,2),d=`${i.name||"character"}_dnd.json`,p={description:t||`D&D Character: ${i.name}`,public:!1,files:{[d]:{content:v}}},m=await fetch(qa,{method:"POST",headers:{Authorization:`token ${o}`,"Content-Type":"application/json"},body:JSON.stringify(p)});if(!m.ok)throw new Error(`Failed to create gist: ${m.statusText}`);return(await m.json()).id}async function Pn(i,o,t){if(!o||!t)throw new Error("GitHub token and Gist ID are required");const v=JSON.stringify(i,null,2),p={files:{[`${i.name||"character"}_dnd.json`]:{content:v}}},m=await fetch(`${qa}/${t}`,{method:"PATCH",headers:{Authorization:`token ${o}`,"Content-Type":"application/json"},body:JSON.stringify(p)});if(!m.ok)throw new Error(`Failed to update gist: ${m.statusText}`)}async function Tn(i,o){if(!i)throw new Error("Gist ID is required");const t={"Content-Type":"application/json"};o&&(t.Authorization=`token ${o}`);const v=await fetch(`${qa}/${i}`,{method:"GET",headers:t});if(!v.ok)throw new Error(`Failed to load gist: ${v.statusText}`);const d=await v.json(),p=Object.values(d.files);if(p.length===0)throw new Error("No files found in gist");const w=p[0].content;try{const y=JSON.parse(w);return y.attacks&&Array.isArray(y.attacks)&&(y.attacks=y.attacks.map(k=>({...k,id:k.id||crypto.randomUUID()}))),y.classFeatures?(y.classFeatures.features||(y.classFeatures.features={}),y.classFeatures.spellSlots||(y.classFeatures.spellSlots=[]),y.classFeatures.preparedSpells===void 0&&(y.classFeatures.preparedSpells="")):y.classFeatures={features:{},spellSlots:[],preparedSpells:""},y}catch{throw new Error("Invalid character data in gist")}}function ys(i){typeof window<"u"&&localStorage.setItem("dnd_gist_config",JSON.stringify(i))}function In(){if(typeof window<"u"){const i=localStorage.getItem("dnd_gist_config");if(i)return JSON.parse(i)}return{}}async function En(i,o=30){if(!i)throw new Error("GitHub token is required to list gists");const t=await fetch(`${qa}?per_page=${o}`,{method:"GET",headers:{Authorization:`token ${i}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error(`Failed to list gists: ${t.statusText}`);return await t.json()}var Hn=f('<div class="error-message svelte-1jb5ckg"> </div>'),Un=f('<div class="toggle-container svelte-1jb5ckg"><button type="button" class="toggle-btn svelte-1jb5ckg"> </button></div>'),Nn=f('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID (leave empty to create new)</label> <input type="text" id="gistId" placeholder="Optional: existing Gist ID to update" class="svelte-1jb5ckg"/></div>'),On=f('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),Gn=f('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),qn=f('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Update (or leave unselected to create new)</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),Wn=f('<div class="info-message svelte-1jb5ckg">No gists found. A new one will be created.</div>'),zn=f('<!> <div class="form-group svelte-1jb5ckg"><label for="description" class="svelte-1jb5ckg"> </label> <input type="text" id="description" placeholder="D&amp;D Character Sheet" class="svelte-1jb5ckg"/></div>',1),Kn=f('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID *</label> <input type="text" id="gistId" placeholder="Enter Gist ID (for public or your private gists)" required class="svelte-1jb5ckg"/></div>'),Vn=f('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),Jn=f('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),Yn=f('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Load</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),Qn=f('<div class="info-message svelte-1jb5ckg">No gists found. Enter a Gist ID manually or create a new one in Save mode.</div>'),Xn=f('<div class="modal-overlay svelte-1jb5ckg" role="button" tabindex="-1"><div class="modal-content svelte-1jb5ckg" role="dialog" tabindex="0"><div class="modal-header svelte-1jb5ckg"><h2 class="svelte-1jb5ckg"> </h2> <button class="close-btn svelte-1jb5ckg">√ó</button></div> <div class="modal-body svelte-1jb5ckg"><!> <div class="form-group svelte-1jb5ckg"><label for="token" class="svelte-1jb5ckg"> <a href="https://github.com/settings/tokens" target="_blank" rel="noopener" class="svelte-1jb5ckg">Get token</a></label> <input type="password" id="token" placeholder="ghp_xxxxxxxxxxxxx" class="svelte-1jb5ckg"/></div> <!> <!> <div class="modal-actions svelte-1jb5ckg"><button class="btn btn-primary svelte-1jb5ckg"><!></button> <button class="btn btn-secondary svelte-1jb5ckg">Cancel</button></div></div></div></div>');function Zn(i,o){Kt(o,!1);const t=()=>rt(ve,"$character",v),[v,d]=oa(),p=_a();let m=kt(o,"mode",8,"save"),w=S(""),y=S(""),k=S(""),H=S(!1),P=S(""),Z=S(!1),fe=S(!1),ne=S([]),V=S(null);const N=In();N.token&&r(w,N.token),N.gistId&&r(y,N.gistId),Ca(async()=>{e(w)&&!e(Z)&&await U()});async function U(){if(e(w)){r(fe,!0),r(P,"");try{r(ne,await En(e(w))),e(y)&&r(V,e(ne).find(C=>C.id===e(y))||null)}catch(C){r(P,C.message||"Failed to load gists"),r(ne,[])}finally{r(fe,!1)}}}function he(C){r(V,C),r(y,C.id)}function Pe(){r(Z,!e(Z)),r(P,""),!e(Z)&&e(w)&&U()}async function pe(){if(!e(w)){r(P,"GitHub token is required");return}const C=e(V)?.id||e(y);r(H,!0),r(P,"");try{if(C)await Pn(t(),e(w),C),r(y,C),Et.add("Character updated in Gist successfully!","success");else{const E=await Fn(t(),e(w),e(k));r(y,E),Et.add(`Character saved to Gist! ID: ${E}`,"success")}ys({token:e(w),gistId:e(y)}),p("close")}catch(E){r(P,E.message||"Failed to save to Gist")}finally{r(H,!1)}}async function Re(){const C=e(V)?.id||e(y);if(!C){r(P,"Please select a gist or enter a Gist ID");return}r(H,!0),r(P,"");try{const E=await Tn(C,e(w)||void 0);ve.set(E),r(y,C),ys({token:e(w),gistId:e(y)}),Et.add("Character loaded from Gist successfully!","success"),p("close")}catch(E){r(P,E.message||"Failed to load from Gist")}finally{r(H,!1)}}function Ee(){p("close")}zt();var ee=Xn(),xe=l(ee),Me=l(xe),R=l(Me),T=l(R,!0);s(R);var x=a(R,2);s(Me);var J=a(Me,2),g=l(J);{var M=C=>{var E=Hn(),X=l(E,!0);s(E),L(()=>D(X,e(P))),c(C,E)};_(g,C=>{e(P)&&C(M)})}var Y=a(g,2),He=l(Y),Ue=l(He);Xt(),s(He);var le=a(He,2);Ce(le),s(Y);var re=a(Y,2);{var We=C=>{var E=Un(),X=l(E),ge=l(X,!0);s(X),s(E),L(()=>{X.disabled=e(H),D(ge,e(Z)?"üìã Show My Gists":"‚úèÔ∏è Enter Gist ID Manually")}),A("click",X,Pe),c(C,E)};_(re,C=>{(m()==="load"||m()==="save"&&e(w))&&C(We)})}var qe=a(re,2);{var ot=C=>{var E=zn(),X=je(E);{var ge=Le=>{var ze=Nn(),Te=a(l(ze),2);Ce(Te),s(ze),L(()=>Te.disabled=e(H)),Ie(Te,()=>e(y),Ye=>r(y,Ye)),c(Le,ze)},we=Le=>{var ze=pt(),Te=je(ze);{var Ye=u=>{var $e=On();c(u,$e)},te=u=>{var $e=pt(),be=je($e);{var G=oe=>{var ke=qn(),ae=a(l(ke),2);xt(ae,5,()=>e(ne),$t,(Oe,de)=>{var Fe=Gn();let Qe;var Ke=l(Fe),st=l(Ke),b=l(st,!0);s(st);var F=a(st,2),ue=l(F,!0);s(F),s(Ke);var q=a(Ke,2),ye=l(q),me=l(ye);s(ye);var Ge=a(ye,2),Ae=l(Ge);s(Ge),s(q),s(Fe),L(dt=>{Qe=Lt(Fe,1,"gist-item svelte-1jb5ckg",null,Qe,{selected:e(V)?.id===e(de).id}),Fe.disabled=e(H),D(b,(e(de),n(()=>e(de).description||"Untitled"))),D(ue,(e(de),n(()=>e(de).public?"üåê Public":"üîí Private"))),D(me,`ID: ${e(de),n(()=>e(de).id)??""}`),D(Ae,`Updated: ${dt??""}`)},[()=>(e(de),n(()=>new Date(e(de).updated_at).toLocaleDateString()))]),A("click",Fe,()=>he(e(de))),c(Oe,Fe)}),s(ae),s(ke),c(oe,ke)},De=oe=>{var ke=pt(),ae=je(ke);{var Oe=de=>{var Fe=Wn();c(de,Fe)};_(ae,de=>{e(w)&&de(Oe)},!0)}c(oe,ke)};_(be,oe=>{e(ne),n(()=>e(ne).length>0)?oe(G):oe(De,!1)},!0)}c(u,$e)};_(Te,u=>{e(fe)?u(Ye):u(te,!1)},!0)}c(Le,ze)};_(X,Le=>{e(Z)||!e(w)?Le(ge):Le(we,!1)})}var se=a(X,2),_e=l(se),K=l(_e);s(_e);var B=a(_e,2);Ce(B),s(se),L(()=>{D(K,`Description ${e(y)?"(optional)":""}`),B.disabled=e(H)}),Ie(B,()=>e(k),Le=>r(k,Le)),c(C,E)},ct=C=>{var E=pt(),X=je(E);{var ge=se=>{var _e=Kn(),K=a(l(_e),2);Ce(K),s(_e),L(()=>K.disabled=e(H)),Ie(K,()=>e(y),B=>r(y,B)),c(se,_e)},we=se=>{var _e=pt(),K=je(_e);{var B=ze=>{var Te=Vn();c(ze,Te)},Le=ze=>{var Te=pt(),Ye=je(Te);{var te=$e=>{var be=Yn(),G=a(l(be),2);xt(G,5,()=>e(ne),$t,(De,oe)=>{var ke=Jn();let ae;var Oe=l(ke),de=l(Oe),Fe=l(de,!0);s(de);var Qe=a(de,2),Ke=l(Qe,!0);s(Qe),s(Oe);var st=a(Oe,2),b=l(st),F=l(b);s(b);var ue=a(b,2),q=l(ue);s(ue),s(st),s(ke),L(ye=>{ae=Lt(ke,1,"gist-item svelte-1jb5ckg",null,ae,{selected:e(V)?.id===e(oe).id}),ke.disabled=e(H),D(Fe,(e(oe),n(()=>e(oe).description||"Untitled"))),D(Ke,(e(oe),n(()=>e(oe).public?"üåê Public":"üîí Private"))),D(F,`ID: ${e(oe),n(()=>e(oe).id)??""}`),D(q,`Updated: ${ye??""}`)},[()=>(e(oe),n(()=>new Date(e(oe).updated_at).toLocaleDateString()))]),A("click",ke,()=>he(e(oe))),c(De,ke)}),s(G),s(be),c($e,be)},u=$e=>{var be=pt(),G=je(be);{var De=oe=>{var ke=Qn();c(oe,ke)};_(G,oe=>{e(w)&&oe(De)},!0)}c($e,be)};_(Ye,$e=>{e(ne),n(()=>e(ne).length>0)?$e(te):$e(u,!1)},!0)}c(ze,Te)};_(K,ze=>{e(fe)?ze(B):ze(Le,!1)},!0)}c(se,_e)};_(X,se=>{e(Z)||!e(w)?se(ge):se(we,!1)},!0)}c(C,E)};_(qe,C=>{m()==="save"?C(ot):C(ct,!1)})}var vt=a(qe,2),at=l(vt),_t=l(at);{var $=C=>{var E=Dt();L(()=>D(E,m()==="save"?"Saving...":"Loading...")),c(C,E)},O=C=>{var E=Dt();L(()=>D(E,m()==="save"?"Save":"Load")),c(C,E)};_(_t,C=>{e(H)?C($):C(O,!1)})}s(at);var I=a(at,2);s(vt),s(J),s(xe),s(ee),L(()=>{D(T,m()==="save"?"Save to GitHub Gist":"Load from GitHub Gist"),D(Ue,`GitHub Token ${m()==="load"?"(optional for public gists)":"(required)"} `),le.disabled=e(H),at.disabled=e(H),I.disabled=e(H)}),A("click",x,Ee),Ie(le,()=>e(w),C=>r(w,C)),A("blur",le,()=>{e(w)&&!e(Z)&&U()}),A("click",at,function(...C){(m()==="save"?pe:Re)?.apply(this,C)}),A("click",I,Ee),A("click",xe,rs(function(C){$a.call(this,o,C)})),A("keydown",xe,function(C){$a.call(this,o,C)}),A("click",ee,Ee),A("keydown",ee,C=>C.key==="Escape"&&Ee()),c(i,ee),Vt(),d()}var er=f('<div class="loading svelte-1ngjemu">Loading D&D data...</div>'),tr=f("<option> </option>"),ar=f('<select class="level-filter svelte-1ngjemu"><option>All Levels</option><option>Cantrip</option><!></select>'),sr=f('<div class="no-results svelte-1ngjemu"> </div>'),lr=f('<div class="item-meta svelte-1ngjemu"> </div>'),ir=f('<div class="item-meta svelte-1ngjemu"> </div>'),nr=f('<button><div class="item-name svelte-1ngjemu"> </div> <!></button>'),rr=f('<p class="higher-levels"><strong>At Higher Levels:</strong> </p>'),or=f('<p class="cantrip-upgrade"><strong>Cantrip Upgrade:</strong> </p>'),cr=f('<h3 class="svelte-1ngjemu"> </h3> <p class="spell-meta svelte-1ngjemu"><!> <!></p> <p class="spell-classes"><strong>Classes:</strong> </p> <div class="spell-stats svelte-1ngjemu"><div><strong>Casting Time:</strong> </div> <div><strong>Range:</strong> </div> <div><strong>Components:</strong> <!></div> <div><strong>Duration:</strong> <!> </div></div> <p class="description svelte-1ngjemu"> </p> <!> <!>',1),vr=f('<p class="prerequisite svelte-1ngjemu"><strong>Prerequisite:</strong> </p>'),dr=f('<h3 class="svelte-1ngjemu"> </h3> <!> <p class="description svelte-1ngjemu"> </p> <a target="_blank" rel="noopener" class="source-link svelte-1ngjemu">View Full Details ‚Üí</a>',1),ur=f('<div class="item-details svelte-1ngjemu"><!></div>'),fr=f('<div class="controls svelte-1ngjemu"><div class="tabs svelte-1ngjemu"><button> </button> <button> </button></div> <div class="search-controls svelte-1ngjemu"><input type="text" placeholder="Search by name or description..." class="search-input svelte-1ngjemu"/> <!></div></div> <div class="content-container svelte-1ngjemu"><div class="items-list svelte-1ngjemu"><!></div> <!></div>',1),pr=f('<div class="modal-backdrop svelte-1ngjemu" role="presentation"><div class="modal svelte-1ngjemu" role="dialog" aria-modal="true" tabindex="-1"><div class="modal-header svelte-1ngjemu"><h2 class="svelte-1ngjemu">Browse D&D Spells & Feats</h2> <button class="close-btn svelte-1ngjemu" aria-label="Close">&times;</button></div> <div class="modal-body svelte-1ngjemu"><!></div> <div class="modal-footer svelte-1ngjemu"><button class="btn-secondary svelte-1ngjemu">Cancel</button> <button class="btn-primary svelte-1ngjemu">Add to Character Sheet</button></div></div></div>');function mr(i,o){Kt(o,!1);const t=S(),v=S(),d=S();let p=kt(o,"onClose",8),m=S("spell"),w=S(!0),y=S(""),k=S(null),H=S([]),P=S([]),Z=S(null);Ca(async()=>{r(w,!0);try{r(H,await js()),r(P,await Xl())}catch(x){console.error("Failed to load data:",x)}finally{r(w,!1)}});function fe(x){r(Z,x)}function ne(x){const J=x.match(/(\d+d\d+(?:\s*\+\s*\d+)?)/i);return J?J[1]:""}function V(x){const J=x.split(/\.( |$)/)[0].trim(),g=Array.from(x.matchAll(/\*\*(.*?)\*\*/g)).map(Y=>Y[1].replace(/\.$/,""));let M=J;return g.length&&(M+=" | Effects: "+g.join(", ")),M}function N(){if(e(Z)){if(e(m)==="spell"){const x=e(Z);ve.update(J=>{const M=[];x.range&&M.push(`Range: ${x.range}`),x.castingTime&&M.push(`Cast: ${x.castingTime}`),x.duration&&M.push(`Duration: ${x.duration}`),x.actionType==="Save"&&M.push("Saving throw spell"),x.components&&x.components.length>0&&M.push(`Components: ${x.components.join(", ")}`),x.material&&M.push(`Material: ${x.material}`);const Y=M.join(" | "),He=V(x.description),Ue={id:crypto.randomUUID(),name:`${x.name}${x.concentration?" (C)":""}${x.ritual?" (R)":""}`,bonus:x.actionType==="Attack"?5:0,damage:ne(x.description),damageType:`${x.school} (Lvl ${x.level})`,spellRef:x.name,infoNotes:Y,generalNotes:He,castAtLevel:x.level};return J.attacks=[...J.attacks,Ue],J})}else if(e(m)==="feat"){const x=e(Z);ve.update(J=>{const g=`${x.name}${x.prerequisite?` (Req: ${x.prerequisite})`:""}
${x.description}
`;return J.features=J.features?`${J.features}
${g}`:g,J})}r(Z,null),p()()}}Je(()=>(e(k),e(H),e(y)),()=>{r(t,e(k)!==null?Zl(bs(e(H),e(y)),e(k)):bs(e(H),e(y)))}),Je(()=>(e(P),e(y)),()=>{r(v,ei(e(P),e(y)))}),Je(()=>(e(m),e(t),e(v)),()=>{r(d,e(m)==="spell"?e(t):e(v))}),da(),zt();var U=pr(),he=l(U),Pe=l(he),pe=a(l(Pe),2);s(Pe);var Re=a(Pe,2),Ee=l(Re);{var ee=x=>{var J=er();c(x,J)},xe=x=>{var J=fr(),g=je(J),M=l(g),Y=l(M);let He;var Ue=l(Y);s(Y);var le=a(Y,2);let re;var We=l(le);s(le),s(M);var qe=a(M,2),ot=l(qe);Ce(ot);var ct=a(ot,2);{var vt=X=>{var ge=ar();L(()=>{e(k),It(()=>{})});var we=l(ge);we.value=(we.__value=null)??"";var se=a(we);se.value=se.__value=0;var _e=a(se);xt(_e,0,()=>[1,2,3,4,5,6,7,8,9],$t,(K,B)=>{var Le=tr(),ze=l(Le);s(Le);var Te={};L(()=>{D(ze,`Level ${B??""}`),Te!==(Te=B)&&(Le.value=(Le.__value=B)??"")}),c(K,Le)}),s(ge),Ma(ge,()=>e(k),K=>r(k,K)),c(X,ge)};_(ct,X=>{e(m)==="spell"&&X(vt)})}s(qe),s(g);var at=a(g,2),_t=l(at),$=l(_t);{var O=X=>{var ge=sr(),we=l(ge);s(ge),L(()=>D(we,`No ${e(m)??""}s found`)),c(X,ge)},I=X=>{var ge=pt(),we=je(ge);xt(we,1,()=>e(d),$t,(se,_e)=>{var K=nr();let B;var Le=l(K),ze=l(Le,!0);s(Le);var Te=a(Le,2);{var Ye=u=>{const $e=ht(()=>e(_e));var be=lr(),G=l(be);s(be),L(()=>D(G,`Level ${z(e($e)),n(()=>e($e).level)??""} ‚Ä¢ ${z(e($e)),n(()=>e($e).school)??""}`)),c(u,be)},te=u=>{const $e=ht(()=>e(_e));var be=pt(),G=je(be);{var De=oe=>{var ke=ir(),ae=l(ke,!0);s(ke),L(()=>D(ae,(z(e($e)),n(()=>e($e).prerequisite)))),c(oe,ke)};_(G,oe=>{z(e($e)),n(()=>e($e).prerequisite)&&oe(De)})}c(u,be)};_(Te,u=>{e(m)==="spell"?u(Ye):u(te,!1)})}s(K),L(()=>{B=Lt(K,1,"item-card svelte-1ngjemu",null,B,{selected:e(Z)?.name===e(_e).name}),D(ze,(e(_e),n(()=>e(_e).name)))}),A("click",K,()=>fe(e(_e))),c(se,K)}),c(X,ge)};_($,X=>{e(d),n(()=>e(d).length===0)?X(O):X(I,!1)})}s(_t);var C=a(_t,2);{var E=X=>{var ge=ur(),we=l(ge);{var se=K=>{const B=ht(()=>e(Z));var Le=cr(),ze=je(Le),Te=l(ze,!0);s(ze);var Ye=a(ze,2),te=l(Ye);{var u=W=>{var Q=Dt();L(()=>D(Q,`${z(e(B)),n(()=>e(B).school)??""} cantrip`)),c(W,Q)},$e=W=>{var Q=Dt();L(()=>D(Q,`Level ${z(e(B)),n(()=>e(B).level)??""} ${z(e(B)),n(()=>e(B).school)??""}`)),c(W,Q)};_(te,W=>{z(e(B)),n(()=>e(B).level===0)?W(u):W($e,!1)})}var be=a(te,2);{var G=W=>{var Q=Dt("(ritual)");c(W,Q)};_(be,W=>{z(e(B)),n(()=>e(B).ritual)&&W(G)})}s(Ye);var De=a(Ye,2),oe=a(l(De));s(De);var ke=a(De,2),ae=l(ke),Oe=a(l(ae));s(ae);var de=a(ae,2),Fe=a(l(de));s(de);var Qe=a(de,2),Ke=a(l(Qe)),st=a(Ke);{var b=W=>{var Q=Dt();L(()=>D(Q,`(${z(e(B)),n(()=>e(B).material)??""})`)),c(W,Q)};_(st,W=>{z(e(B)),n(()=>e(B).material)&&W(b)})}s(Qe);var F=a(Qe,2),ue=a(l(F),2);{var q=W=>{var Q=Dt("Concentration,");c(W,Q)};_(ue,W=>{z(e(B)),n(()=>e(B).concentration)&&W(q)})}var ye=a(ue,1,!0);s(F),s(ke);var me=a(ke,2),Ge=l(me,!0);s(me);var Ae=a(me,2);{var dt=W=>{var Q=rr(),Be=a(l(Q));s(Q),L(()=>D(Be,` ${z(e(B)),n(()=>e(B).higherLevelSlot)??""}`)),c(W,Q)};_(Ae,W=>{z(e(B)),n(()=>e(B).higherLevelSlot)&&W(dt)})}var Ze=a(Ae,2);{var lt=W=>{var Q=or(),Be=a(l(Q));s(Q),L(()=>D(Be,` ${z(e(B)),n(()=>e(B).cantripUpgrade)??""}`)),c(W,Q)};_(Ze,W=>{z(e(B)),n(()=>e(B).cantripUpgrade)&&W(lt)})}L((W,Q)=>{D(Te,(z(e(B)),n(()=>e(B).name))),D(oe,` ${W??""}`),D(Oe,` ${z(e(B)),n(()=>e(B).castingTime||e(B).actionType)??""}`),D(Fe,` ${z(e(B)),n(()=>e(B).range)??""}`),D(Ke,` ${Q??""}`),D(ye,(z(e(B)),n(()=>e(B).duration))),D(Ge,(z(e(B)),n(()=>e(B).description)))},[()=>(z(e(B)),n(()=>e(B).classes.join(", "))),()=>(z(e(B)),n(()=>e(B).components.join(", ").toUpperCase()))]),c(K,Le)},_e=K=>{const B=ht(()=>e(Z));var Le=dr(),ze=je(Le),Te=l(ze,!0);s(ze);var Ye=a(ze,2);{var te=G=>{var De=vr(),oe=a(l(De));s(De),L(()=>D(oe,` ${z(e(B)),n(()=>e(B).prerequisite)??""}`)),c(G,De)};_(Ye,G=>{z(e(B)),n(()=>e(B).prerequisite)&&G(te)})}var u=a(Ye,2),$e=l(u,!0);s(u);var be=a(u,2);L(()=>{D(Te,(z(e(B)),n(()=>e(B).name))),D($e,(z(e(B)),n(()=>e(B).description))),Ve(be,"href",(z(e(B)),n(()=>e(B).source)))}),c(K,Le)};_(we,K=>{e(m)==="spell"?K(se):K(_e,!1)})}s(ge),c(X,ge)};_(C,X=>{e(Z)&&X(E)})}s(at),L(()=>{He=Lt(Y,1,"tab svelte-1ngjemu",null,He,{active:e(m)==="spell"}),D(Ue,`üìú Spells (${e(H),n(()=>e(H).length)??""})`),re=Lt(le,1,"tab svelte-1ngjemu",null,re,{active:e(m)==="feat"}),D(We,`‚≠ê Feats (${e(P),n(()=>e(P).length)??""})`)}),A("click",Y,()=>{r(m,"spell"),r(Z,null),r(y,"")}),A("click",le,()=>{r(m,"feat"),r(Z,null),r(y,"")}),Ie(ot,()=>e(y),X=>r(y,X)),c(x,J)};_(Ee,x=>{e(w)?x(ee):x(xe,!1)})}s(Re);var Me=a(Re,2),R=l(Me),T=a(R,2);s(Me),s(he),s(U),L(()=>T.disabled=!e(Z)),A("click",pe,function(...x){p()?.apply(this,x)}),A("click",R,function(...x){p()?.apply(this,x)}),A("click",T,N),A("click",he,rs(function(x){$a.call(this,o,x)})),A("keydown",he,function(x){$a.call(this,o,x)}),A("click",U,function(...x){p()?.apply(this,x)}),A("keydown",U,x=>x.key==="Escape"&&p()()),c(i,U),Vt()}var gr=f('<span class="resistance-tag svelte-gdwwx1"> <button type="button" class="tag-remove svelte-gdwwx1">√ó</button></span>'),br=f('<div class="resistance-list svelte-gdwwx1"></div>'),hr=f('<p class="ability-meta svelte-gdwwx1"> <!></p>'),_r=f('<p class="ability-meta svelte-gdwwx1">Requires Reaction</p>'),yr=f('<div class="ability-card svelte-gdwwx1"><div class="ability-header svelte-gdwwx1"><strong class="svelte-gdwwx1"> </strong> <button type="button" class="ability-remove svelte-gdwwx1">√ó</button></div> <p class="ability-description svelte-gdwwx1"> </p> <!></div>'),xr=f('<div class="abilities-list svelte-gdwwx1"></div>'),kr=f(`<div class="modal-backdrop svelte-gdwwx1" role="presentation"><div class="modal-content svelte-gdwwx1" role="dialog" aria-modal="true" aria-labelledby="modal-title"><div class="modal-header svelte-gdwwx1"><h3 id="modal-title" class="svelte-gdwwx1">Add Custom Condition</h3> <button class="btn-close svelte-gdwwx1" aria-label="Close">√ó</button></div> <div class="modal-body svelte-gdwwx1"><div class="form-group svelte-gdwwx1"><label for="conditionName" class="svelte-gdwwx1">Condition Name*</label> <input type="text" id="conditionName" placeholder="e.g., Cazna's Mark" class="svelte-gdwwx1"/></div> <div class="form-group svelte-gdwwx1"><label for="description" class="svelte-gdwwx1">Description</label> <textarea id="description" placeholder="Describe the condition..." rows="3" class="svelte-gdwwx1"></textarea></div> <div class="form-row svelte-gdwwx1"><div class="form-group svelte-gdwwx1"><label for="attackBonus" class="svelte-gdwwx1">Attack Bonus</label> <input type="text" id="attackBonus" placeholder="0 or 1d4" class="svelte-gdwwx1"/></div> <div class="form-group svelte-gdwwx1"><label for="damageBonus" class="svelte-gdwwx1">Damage Bonus</label> <input type="text" id="damageBonus" placeholder="0 or 1d6" class="svelte-gdwwx1"/></div> <div class="form-group svelte-gdwwx1"><label for="acBonus" class="svelte-gdwwx1">AC Bonus</label> <input type="number" id="acBonus" placeholder="0" class="svelte-gdwwx1"/></div></div> <div class="form-group svelte-gdwwx1"><label for="darkvision" class="svelte-gdwwx1">Darkvision (feet)</label> <input type="number" id="darkvision" placeholder="0" min="0" step="30" class="svelte-gdwwx1"/> <small class="help-text svelte-gdwwx1">Grant or extend darkvision (e.g., 60 for 60 feet)</small></div> <div class="form-group svelte-gdwwx1"><label class="svelte-gdwwx1">Damage Resistances</label> <div class="resistance-input-group svelte-gdwwx1"><input type="text" placeholder="e.g., cold, fire, poison" class="svelte-gdwwx1"/> <button type="button" class="btn-add svelte-gdwwx1">Add</button></div> <!></div> <div class="form-group svelte-gdwwx1"><label class="svelte-gdwwx1">Special Abilities</label> <div class="ability-form svelte-gdwwx1"><input type="text" placeholder="Ability name (e.g., Flicker of Deceit)" class="ability-name-input svelte-gdwwx1"/> <textarea placeholder="Ability description..." rows="2" class="ability-desc-input svelte-gdwwx1"></textarea> <div class="ability-options svelte-gdwwx1"><div class="ability-option svelte-gdwwx1"><label for="abilityUses" class="svelte-gdwwx1">Uses per rest</label> <input type="number" id="abilityUses" min="0" class="svelte-gdwwx1"/></div> <div class="ability-option svelte-gdwwx1"><label for="restType" class="svelte-gdwwx1">Rest type</label> <select id="restType" class="svelte-gdwwx1"><option>Short</option><option>Long</option></select></div> <div class="ability-option svelte-gdwwx1"><label class="svelte-gdwwx1"><input type="checkbox" class="svelte-gdwwx1"/> Requires Reaction</label></div></div> <button type="button" class="btn-add svelte-gdwwx1">Add Ability</button></div> <!></div></div> <div class="modal-footer svelte-gdwwx1"><button class="btn btn-secondary svelte-gdwwx1">Cancel</button> <button class="btn btn-primary svelte-gdwwx1">Add Condition</button></div></div></div>`);function wr(i,o){Kt(o,!1);let t=kt(o,"show",8,!1),v=kt(o,"onSave",8),d=kt(o,"onCancel",8),p=S(""),m=S(""),w=S(0),y=S(0),k=S(0),H=S(0),P=S([]),Z=S(""),fe=S([]),ne=S(""),V=S(""),N=S(0),U=S("short"),he=S(!1);function Pe(){r(p,""),r(m,""),r(w,0),r(y,0),r(k,0),r(H,0),r(P,[]),r(Z,""),r(fe,[]),r(ne,""),r(V,""),r(N,0),r(U,"short"),r(he,!1)}function pe(){e(Z).trim()&&(r(P,[...e(P),e(Z).trim()]),r(Z,""))}function Re(g){r(P,e(P).filter((M,Y)=>Y!==g))}function Ee(){if(e(ne).trim()&&e(V).trim()){const g={name:e(ne).trim(),description:e(V).trim(),requiresReaction:e(he)};e(N)>0&&(g.usesPerRest=e(N),g.currentUses=e(N),g.restType=e(U)),r(fe,[...e(fe),g]),r(ne,""),r(V,""),r(N,0),r(U,"short"),r(he,!1)}}function ee(g){r(fe,e(fe).filter((M,Y)=>Y!==g))}function xe(){if(!e(p).trim()){alert("Please enter a condition name");return}const g={name:e(p).trim(),description:e(m).trim()||"Custom condition",attackBonus:e(w)||0,damageBonus:e(y)||0,target:"self"};e(k)!==0&&(g.acBonus=e(k)),e(H)>0&&(g.darkvision=e(H)),e(P).length>0&&(g.resistances=e(P)),e(fe).length>0&&(g.abilities=e(fe)),v()(g),Pe()}function Me(){Pe(),d()()}function R(g){g.target===g.currentTarget&&Me()}zt();var T=pt(),x=je(T);{var J=g=>{var M=kr(),Y=l(M),He=l(Y),Ue=a(l(He),2);s(He);var le=a(He,2),re=l(le),We=a(l(re),2);Ce(We),s(re);var qe=a(re,2),ot=a(l(qe),2);xa(ot),s(qe);var ct=a(qe,2),vt=l(ct),at=a(l(vt),2);Ce(at),s(vt);var _t=a(vt,2),$=a(l(_t),2);Ce($),s(_t);var O=a(_t,2),I=a(l(O),2);Ce(I),s(O),s(ct);var C=a(ct,2),E=a(l(C),2);Ce(E),Xt(2),s(C);var X=a(C,2),ge=a(l(X),2),we=l(ge);Ce(we);var se=a(we,2);s(ge);var _e=a(ge,2);{var K=b=>{var F=br();xt(F,5,()=>e(P),$t,(ue,q,ye)=>{var me=gr(),Ge=l(me),Ae=a(Ge);s(me),L(()=>{D(Ge,`${e(q)??""} `),Ve(Ae,"aria-label",`Remove ${e(q)??""}`)}),A("click",Ae,()=>Re(ye)),c(ue,me)}),s(F),c(b,F)};_(_e,b=>{e(P),n(()=>e(P).length>0)&&b(K)})}s(X);var B=a(X,2),Le=a(l(B),2),ze=l(Le);Ce(ze);var Te=a(ze,2);xa(Te);var Ye=a(Te,2),te=l(Ye),u=a(l(te),2);Ce(u),s(te);var $e=a(te,2),be=a(l($e),2);L(()=>{e(U),It(()=>{})});var G=l(be);G.value=G.__value="short";var De=a(G);De.value=De.__value="long",s(be),s($e);var oe=a($e,2),ke=l(oe),ae=l(ke);Ce(ae),Xt(),s(ke),s(oe),s(Ye);var Oe=a(Ye,2);s(Le);var de=a(Le,2);{var Fe=b=>{var F=xr();xt(F,5,()=>e(fe),$t,(ue,q,ye)=>{var me=yr(),Ge=l(me),Ae=l(Ge),dt=l(Ae,!0);s(Ae);var Ze=a(Ae,2);s(Ge);var lt=a(Ge,2),W=l(lt,!0);s(lt);var Q=a(lt,2);{var Be=ut=>{var mt=hr(),h=l(mt),ie=a(h);{var j=et=>{var Se=Dt("‚Ä¢ Requires Reaction");c(et,Se)};_(ie,et=>{e(q),n(()=>e(q).requiresReaction)&&et(j)})}s(mt),L(()=>D(h,`${e(q),n(()=>e(q).usesPerRest)??""} use${e(q),n(()=>e(q).usesPerRest>1?"s":"")??""} per ${e(q),n(()=>e(q).restType)??""}
                      rest `)),c(ut,mt)},it=ut=>{var mt=pt(),h=je(mt);{var ie=j=>{var et=_r();c(j,et)};_(h,j=>{e(q),n(()=>e(q).requiresReaction)&&j(ie)},!0)}c(ut,mt)};_(Q,ut=>{e(q),n(()=>e(q).usesPerRest)?ut(Be):ut(it,!1)})}s(me),L(()=>{D(dt,(e(q),n(()=>e(q).name))),Ve(Ze,"aria-label",`Remove ${e(q),n(()=>e(q).name)??""}`),D(W,(e(q),n(()=>e(q).description)))}),A("click",Ze,()=>ee(ye)),c(ue,me)}),s(F),c(b,F)};_(de,b=>{e(fe),n(()=>e(fe).length>0)&&b(Fe)})}s(B),s(le);var Qe=a(le,2),Ke=l(Qe),st=a(Ke,2);s(Qe),s(Y),s(M),A("click",Ue,Me),Ie(We,()=>e(p),b=>r(p,b)),Ie(ot,()=>e(m),b=>r(m,b)),Ie(at,()=>e(w),b=>r(w,b)),Ie($,()=>e(y),b=>r(y,b)),Ie(I,()=>e(k),b=>r(k,b)),Ie(E,()=>e(H),b=>r(H,b)),Ie(we,()=>e(Z),b=>r(Z,b)),A("keydown",we,b=>b.key==="Enter"&&pe()),A("click",se,pe),Ie(ze,()=>e(ne),b=>r(ne,b)),Ie(Te,()=>e(V),b=>r(V,b)),Ie(u,()=>e(N),b=>r(N,b)),Ma(be,()=>e(U),b=>r(U,b)),wa(ae,()=>e(he),b=>r(he,b)),A("click",Oe,Ee),A("click",Ke,Me),A("click",st,xe),A("click",M,R),c(g,M)};_(x,g=>{t()&&g(J)})}c(i,T),Vt()}var $r=f("<option></option>"),Sr=f("<button> </button>"),Cr=f('<button class="btn btn-primary calculate-btn use-enabled svelte-uvfntf">Calculate Damage</button>'),Dr=f('<div class="adjustment-msg svelte-uvfntf"> </div>'),Lr=f('<div class="calculation-result svelte-uvfntf"><div class="result-header svelte-uvfntf"><h4 class="svelte-uvfntf">Damage Calculation</h4></div> <div class="result-content svelte-uvfntf"><div class="damage-breakdown svelte-uvfntf"><div class="damage-row svelte-uvfntf"><span class="label svelte-uvfntf">Original Damage:</span> <span class="value svelte-uvfntf"> </span></div> <div class="adjustments svelte-uvfntf"></div> <div class="damage-row final svelte-uvfntf"><span class="label svelte-uvfntf">Final Damage:</span> <span class="value damage-value svelte-uvfntf"> </span></div></div></div> <div class="result-actions svelte-uvfntf"><button class="btn btn-primary apply-btn use-enabled svelte-uvfntf">Apply Damage</button> <button class="btn btn-secondary cancel-btn use-enabled svelte-uvfntf">Cancel</button></div></div>'),Ar=f('<div class="damage-form svelte-uvfntf"><div class="input-group svelte-uvfntf"><div class="input-field svelte-uvfntf"><label for="damageAmount" class="svelte-uvfntf">Damage Amount</label> <input type="number" id="damageAmount" min="0" placeholder="0" class="damage-input-field use-enabled svelte-uvfntf"/></div> <div class="input-field svelte-uvfntf"><label for="damageType" class="svelte-uvfntf">Damage Type</label> <input type="text" id="damageType" list="damageTypes" placeholder="e.g., fire, cold" class="damage-input-field use-enabled svelte-uvfntf"/> <datalist id="damageTypes"></datalist></div></div> <div class="quick-types svelte-uvfntf"><span class="quick-types-label svelte-uvfntf">Quick Select:</span> <!></div> <!></div>'),jr=f("<section><!> <!></section>");function Br(i,o){Kt(o,!1);const t=()=>rt(ve,"$character",p),v=()=>rt(ga,"$searchFilter",p),d=()=>rt(Zt,"$collapsedStates",p),[p,m]=oa(),w=S();_a();let y=S(0),k=S(""),H=S(!1),P=S(0),Z=S([]);const fe=["slashing","piercing","bludgeoning","fire","cold","lightning","thunder","acid","poison","necrotic","radiant","psychic","force"];function ne(){if(e(y)<0){Et.add("Damage amount cannot be negative","error");return}if(!e(k).trim()){Et.add("Please enter or select a damage type","error");return}const Ee=jl(e(y),e(k),t());r(P,Ee.finalDamage),r(Z,Ee.adjustments),r(H,!0)}function V(){ve.update(Ee=>Bl(Ee,e(P))),Et.add(`Applied ${e(P)} damage to character (${e(k)})`,"info"),r(y,0),r(k,""),r(H,!1),r(P,0),r(Z,[])}function N(){r(H,!1),r(P,0),r(Z,[])}Je(()=>v(),()=>{r(w,!v()||"damage".includes(v().toLowerCase())||"resistance".includes(v().toLowerCase())||"immune".includes(v().toLowerCase()))}),da(),zt();var U=jr();let he;var Pe=l(U);{let Ee=ht(()=>(d(),n(()=>d().damageInput?"Expand":"Collapse")));ya(Pe,{title:"Apply Damage",get collapsed(){return d(),n(()=>d().damageInput)},get ariaLabel(){return e(Ee)},onToggle:()=>Zt.update(ee=>({...ee,damageInput:!ee.damageInput}))})}var pe=a(Pe,2);{var Re=Ee=>{var ee=Ar(),xe=l(ee),Me=l(xe),R=a(l(Me),2);Ce(R),s(Me);var T=a(Me,2),x=a(l(T),2);Ce(x);var J=a(x,2);xt(J,5,()=>fe,$t,(le,re)=>{var We=$r(),qe={};L(()=>{qe!==(qe=e(re))&&(We.value=(We.__value=e(re))??"")}),c(le,We)}),s(J),s(T),s(xe);var g=a(xe,2),M=a(l(g),2);xt(M,1,()=>n(()=>fe.slice(0,6)),$t,(le,re)=>{var We=Sr();let qe;var ot=l(We,!0);s(We),L(()=>{qe=Lt(We,1,"quick-type-btn use-enabled svelte-uvfntf",null,qe,{active:e(k)===e(re)}),D(ot,e(re))}),A("click",We,()=>r(k,e(re))),c(le,We)}),s(g);var Y=a(g,2);{var He=le=>{var re=Cr();A("click",re,ne),c(le,re)},Ue=le=>{var re=Lr(),We=a(l(re),2),qe=l(We),ot=l(qe),ct=a(l(ot),2),vt=l(ct);s(ct),s(ot);var at=a(ot,2);xt(at,5,()=>e(Z),$t,(X,ge)=>{var we=Dr(),se=l(we,!0);s(we),L(()=>D(se,e(ge))),c(X,we)}),s(at);var _t=a(at,2),$=a(l(_t),2),O=l($,!0);s($),s(_t),s(qe),s(We);var I=a(We,2),C=l(I),E=a(C,2);s(I),s(re),L(()=>{D(vt,`${e(y)??""} ${e(k)??""}`),D(O,e(P))}),A("click",C,V),A("click",E,N),c(le,re)};_(Y,le=>{e(H)?le(Ue,!1):le(He)})}s(ee),Ie(R,()=>e(y),le=>r(y,le)),Ie(x,()=>e(k),le=>r(k,le)),c(Ee,ee)};_(pe,Ee=>{d(),n(()=>!d().damageInput)&&Ee(Re)})}s(U),L(()=>he=Lt(U,1,"damage-input svelte-uvfntf",null,he,{hidden:!e(w)})),c(i,U),Vt(),m()}var Rr=f('<link rel="icon" type="image/png" href="favicon4.png"/> <meta name="viewport" content="width=device-width, initial-scale=1"/>',1),Mr=f('<span class="character-name svelte-1uha8ag"> </span>'),Fr=f("<span> </span>"),Pr=f('<div class="spell-slots-header svelte-1uha8ag"></div>'),Tr=f("<span> </span><br/>",1),Ir=f("<span> </span><br/>",1),Er=f("<span> </span><br/>",1),Hr=f("<span> </span><br/>",1),Ur=f("<span> </span><br/>",1),Nr=f("<span> </span><br/>",1),Or=f("<br/><em> <!>)</em>",1),Gr=f("<br/><em>(requires reaction)</em>",1),qr=f('<div class="ability-detail"><strong> </strong> <!></div>'),Wr=f('<div class="abilities-section"><strong>Abilities:</strong><br/> <!></div>'),zr=f('<span class="effect-tooltip"><strong> </strong><br/> <br/> <!> <!> <!> <!> <!> <!> <!></span>'),Kr=f('<button class="effect-remove-btn svelte-1uha8ag">√ó</button>'),Vr=f('<span class="effect-badge svelte-1uha8ag" tabindex="0"> <!> <!></span>'),Jr=f(`<div class="active-effects-header svelte-1uha8ag"></div> <style>.effect-badge {
              position: relative;
            }
            .effect-tooltip {
              position: absolute;
              top: 120%;
              left: 50%;
              transform: translateX(-50%);
              background: #fff;
              color: #222;
              border: 1px solid #a5b4fc;
              border-radius: 6px;
              padding: 8px 12px;
              font-size: 0.95em;
              box-shadow: 0 2px 8px rgba(0, 0, 0, 0.12);
              z-index: 10;
              min-width: 180px;
              max-width: 300px;
              white-space: normal;
              pointer-events: none;
              opacity: 1;
              transition: opacity 0.15s;
            }

            .abilities-section {
              margin-top: 8px;
              padding-top: 8px;
              border-top: 1px solid #e5e7eb;
            }

            .ability-detail {
              margin-top: 6px;
              padding: 4px;
              background: #f9fafb;
              border-radius: 4px;
              font-size: 0.9em;
            }

            .ability-detail strong {
              color: #6366f1;
            }

            .ability-detail em {
              font-size: 0.85em;
              color: #6b7280;
            }</style>`,1),Yr=f('<div class="rest-menu svelte-1uha8ag"><button class="rest-option svelte-1uha8ag">‚òï Short Rest</button> <button class="rest-option svelte-1uha8ag">üõèÔ∏è Long Rest</button></div>'),Qr=f('<div class="container svelte-1uha8ag"><header class="svelte-1uha8ag"><div class="header-top svelte-1uha8ag"><div class="header-title svelte-1uha8ag"><div class="title-row svelte-1uha8ag"><h1 class="svelte-1uha8ag">D&D Character Sheet</h1> <!></div> <!> <!></div> <div class="header-right svelte-1uha8ag"><div class="header-controls svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">üé≤</span><span class="btn-text svelte-1uha8ag">Roll Dice</span></button> <div class="rest-button-container svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">üò¥</span><span class="btn-text svelte-1uha8ag">Rest</span></button> <!></div> <button class="btn btn-secondary use-enabled" title="Add custom condition with effects"><span class="btn-icon svelte-1uha8ag">‚ú®</span><span class="btn-text svelte-1uha8ag">Add Condition</span></button> <div class="mode-toggle"><button><span class="btn-icon svelte-1uha8ag"> </span><span class="btn-text svelte-1uha8ag"> </span></button></div></div> <div class="header-search svelte-1uha8ag"><input type="text" placeholder="üîç Search..." class="search-input use-enabled svelte-1uha8ag"/></div></div></div> <div class="header-actions svelte-1uha8ag"><button class="btn btn-mode svelte-1uha8ag">üìö Browse Spells & Feats</button> <button class="btn btn-secondary">Save to Gist</button> <button class="btn btn-secondary">Load from Gist</button> <button class="btn btn-secondary">Export JSON</button> <button class="btn btn-secondary">Import JSON</button> <input type="file" accept=".json" style="display: none;"/></div></header> <main class="svelte-1uha8ag"><!> <!> <!> <!> <!> <!> <!> <!></main></div> <!> <!> <!> <!> <!>',1);function no(i,o){Kt(o,!1);const t=()=>rt(ve,"$character",p),v=()=>rt(ha,"$isEditMode",p),d=()=>rt(ga,"$searchFilter",p),[p,m]=oa();function w(){const h=[],ie=t().classFeatures.spellSlotsByLevel||{};for(let j=1;j<=9;j++){const et=ie[j];if(et&&et.length>0){const Se=et.length,nt=et.filter(ce=>ce).length;h.push({level:j,available:Se-nt,total:Se})}}return h}let y=S(!1),k=S(!1),H=S(!1),P=S(!1),Z=S("save"),fe=S(void 0),ne=S(""),V=S(""),N=S(""),U=S(!1),he=S([]),Pe=S("other"),pe=S(),Re=!1,Ee=1,ee=S(!1),xe=S(null);function Me(h){r(xe,h)}function R(){r(xe,null)}function T(h){r(xe,e(xe)===h?null:h)}function x(h){ve.update(ie=>(ie.activeStates||(ie.activeStates=[]),ie.activeStates=[...ie.activeStates,h],ie)),r(P,!1),Et.add(`Added condition: ${h.name}`,"success")}function J(){r(P,!1)}function g(){const h=[];ve.update(j=>{const et=j.hitDice.current;j.hitDice.current=Math.min(j.hitDice.max,j.hitDice.current+Math.max(1,Math.floor(j.hitDice.max/2)));const Se=j.hitDice.current-et;if(Se>0&&h.push(`${Se} hit ${Se===1?"die":"dice"}`),j.class){const nt=Sa(j.class,j.level,j.subclass);j.classFeatures.features||(j.classFeatures.features={}),nt.forEach(ce=>{if(ce.resetOn==="short"){const Xe=ce.name.replace(/\s+/g,"");if(ce.type==="uses"){const tt=typeof ce.maxUses=="function"?ce.maxUses(j.level):ce.maxUses;j.classFeatures.features[Xe]=Array(tt).fill(!1),h.push(ce.name)}else if(ce.type==="pool"){const tt=typeof ce.maxPool=="function"?ce.maxPool(j.level):ce.maxPool;tt!==void 0&&(j.classFeatures.features[Xe]=tt,h.push(ce.name))}}})}return j.activeStates&&j.activeStates.forEach(nt=>{nt.abilities&&nt.abilities.forEach(ce=>{if(ce.restType==="short"&&ce.usesPerRest){const Xe=ce.usesPerRest-(ce.currentUses||0)>0;ce.currentUses=ce.usesPerRest,Xe&&h.push(`${nt.name}: ${ce.name}`)}})}),j}),r(ee,!1);const ie=h.length>0?`Short rest taken! Restored: ${h.join(", ")}`:"Short rest taken!";Et.add(ie,"success")}function M(){const h=[];ve.update(j=>{const et=j.maxHP-j.currentHP;et>0&&h.push(`${et} HP`),j.currentHP=j.maxHP,j.tempHP=0;const Se=j.hitDice.max-j.hitDice.current;Se>0&&h.push(`${Se} hit ${Se===1?"die":"dice"}`),j.hitDice.current=j.hitDice.max;let nt=0;if(j.classFeatures.spellSlotsByLevel&&Object.keys(j.classFeatures.spellSlotsByLevel).forEach(ce=>{const Xe=j.classFeatures.spellSlotsByLevel[parseInt(ce)];if(Xe){const tt=Xe.filter(yt=>yt).length;nt+=tt,j.classFeatures.spellSlotsByLevel[parseInt(ce)]=Array(Xe.length).fill(!1)}}),nt>0&&h.push(`${nt} spell ${nt===1?"slot":"slots"}`),j.class){const ce=Sa(j.class,j.level,j.subclass);j.classFeatures.features||(j.classFeatures.features={});let Xe=!1;ce.forEach(tt=>{const yt=tt.name.replace(/\s+/g,"");if(!(tt.type==="info"||tt.type==="channelDivinity")){if(tt.type==="uses"){const wt=typeof tt.maxUses=="function"?tt.maxUses(j.level):tt.maxUses;j.classFeatures.features[yt]=Array(wt).fill(!1),Xe=!0}else if(tt.type==="pool"){const wt=typeof tt.maxPool=="function"?tt.maxPool(j.level):tt.maxPool;wt!==void 0&&(j.classFeatures.features[yt]=wt,Xe=!0)}}}),Xe&&h.push("all class features")}if(j.activeStates){let ce=!1;j.activeStates.forEach(Xe=>{Xe.abilities&&Xe.abilities.forEach(tt=>{if(tt.usesPerRest){const yt=(tt.currentUses||0)<tt.usesPerRest;tt.currentUses=tt.usesPerRest,yt&&(ce=!0)}})}),ce&&h.push("condition abilities")}return j}),r(ee,!1);const ie=h.length>0?`Long rest taken! Restored: ${h.join(", ")}`:"Long rest taken! Fully rested.";Et.add(ie,"success")}function Y(h){r(ne,""),r(V,""),r(N,""),r(U,!1),r(he,[]),r(Pe,"other"),Re=!1,typeof h=="string"?r(ne,h):(r(ne,h.notation),r(V,h.damageNotation||""),r(N,h.attackName||""),r(U,!!h.applyHalfDamage),r(he,h.bonusBreakdown||[]),r(Pe,h.rollType||"other")),r(y,!0)}function He(h){const{notation:ie,count:j,bonusBreakdown:et}=h.detail;r(ne,""),Re=!0,Ee=j||1,setTimeout(()=>{r(ne,ie),r(V,""),r(N,"Hit Die"),r(he,et||[]),r(Pe,"other")},0),r(y,!0)}function Ue(){if(r(y,!1),Re&&e(pe)){const h=e(pe).getLastRollTotal();if(h!==null){const ie=Math.max(1,h);ve.update(j=>(j.hitDice.current=Math.max(0,j.hitDice.current-Ee),j.currentHP=Math.min(j.maxHP,j.currentHP+ie),j))}Re=!1}}function le(){ha.update(h=>!h)}function re(h){h.target.closest(".rest-button-container")||r(ee,!1)}Ca(()=>{const h=ha.subscribe(ie=>{ie?document.body.classList.remove("use-mode"):document.body.classList.add("use-mode")});return document.addEventListener("click",re),()=>{h(),document.removeEventListener("click",re)}});function We(){tl(t())}function qe(){e(fe)?.click()}async function ot(h){const j=h.target.files?.[0];if(j)try{const et=await al(j);ve.set(et),alert("Character imported successfully!")}catch{alert("Failed to import character file")}}zt();var ct=Qr();Zs("1uha8ag",h=>{var ie=Rr();Xt(2),ws(()=>{Ys.title="D&D Character Sheet"}),c(h,ie)});var vt=je(ct),at=l(vt),_t=l(at),$=l(_t),O=l($),I=a(l(O),2);{var C=h=>{var ie=Mr(),j=l(ie);s(ie),L(()=>D(j,`${t().name??""} (${t().level??""})`)),c(h,ie)};_(I,h=>{t().name&&h(C)})}s(O);var E=a(O,2);{var X=h=>{var ie=Pr();xt(ie,5,w,$t,(j,et)=>{var Se=Fr();let nt;var ce=l(Se);s(Se),L(()=>{nt=Lt(Se,1,"slot-badge svelte-1uha8ag",null,nt,{depleted:e(et).available===0}),D(ce,`Lv${e(et).level??""}: ${e(et).available??""}/${e(et).total??""}`)}),c(j,Se)}),s(ie),c(h,ie)};_(E,h=>{w().length>0&&h(X)})}var ge=a(E,2);{var we=h=>{var ie=Jr(),j=je(ie);xt(j,5,()=>t().activeStates,$t,(et,Se,nt)=>{var ce=Vr(),Xe=l(ce),tt=a(Xe);{var yt=Nt=>{var Jt=zr(),gt=l(Jt),St=l(gt,!0);s(gt);var ca=a(gt,2),ta=a(ca,3);{var va=Ne=>{var ft=Tr(),bt=je(ft),At=l(bt);s(bt),Xt(),L(()=>D(At,`Attack Bonus: ${typeof e(Se).attackBonus=="number"&&e(Se).attackBonus>0?"+":""}${e(Se).attackBonus??""}`)),c(Ne,ft)};_(ta,Ne=>{e(Se).attackBonus&&Ne(va)})}var Yt=a(ta,2);{var aa=Ne=>{var ft=Ir(),bt=je(ft),At=l(bt);s(bt),Xt(),L(()=>D(At,`Damage Bonus: ${typeof e(Se).damageBonus=="number"&&e(Se).damageBonus>0?"+":""}${e(Se).damageBonus??""}`)),c(Ne,ft)};_(Yt,Ne=>{e(Se).damageBonus&&Ne(aa)})}var Ct=a(Yt,2);{var Bt=Ne=>{var ft=Er(),bt=je(ft),At=l(bt);s(bt),Xt(),L(()=>D(At,`AC Bonus: ${e(Se).acBonus>0?"+":""}${e(Se).acBonus??""}`)),c(Ne,ft)};_(Ct,Ne=>{e(Se).acBonus&&Ne(Bt)})}var Mt=a(Ct,2);{var sa=Ne=>{var ft=Hr(),bt=je(ft),At=l(bt);s(bt),Xt(),L(()=>D(At,`Darkvision: ${e(Se).darkvision??""} feet`)),c(Ne,ft)};_(Mt,Ne=>{e(Se).darkvision&&Ne(sa)})}var la=a(Mt,2);{var ua=Ne=>{var ft=Ur(),bt=je(ft),At=l(bt);s(bt),Xt(),L(Rt=>D(At,`Resistances: ${Rt??""}`),[()=>e(Se).resistances.join(", ")]),c(Ne,ft)};_(la,Ne=>{e(Se).resistances&&e(Se).resistances.length>0&&Ne(ua)})}var Ot=a(la,2);{var Ft=Ne=>{var ft=Nr(),bt=je(ft),At=l(bt);s(bt),Xt(),L(Rt=>D(At,`Immunities: ${Rt??""}`),[()=>e(Se).immunities.join(", ")]),c(Ne,ft)};_(Ot,Ne=>{e(Se).immunities&&e(Se).immunities.length>0&&Ne(Ft)})}var Gt=a(Ot,2);{var ea=Ne=>{var ft=Wr(),bt=a(l(ft),3);xt(bt,1,()=>e(Se).abilities,$t,(At,Rt)=>{var Pt=qr(),qt=l(Pt),Qt=l(qt);s(qt);var ia=a(qt),fa=a(ia);{var Tt=Wt=>{var na=Or(),ka=a(je(na)),Ta=l(ka),Da=a(Ta);{var Wa=za=>{var Bs=Dt(", requires reaction");c(za,Bs)};_(Da,za=>{e(Rt).requiresReaction&&za(Wa)})}Xt(),s(ka),L(()=>D(Ta,`(${(e(Rt).currentUses||0)??""}/${e(Rt).usesPerRest??""} uses per ${e(Rt).restType??""}
                                rest`)),c(Wt,na)},Ht=Wt=>{var na=pt(),ka=je(na);{var Ta=Da=>{var Wa=Gr();Xt(),c(Da,Wa)};_(ka,Da=>{e(Rt).requiresReaction&&Da(Ta)},!0)}c(Wt,na)};_(fa,Wt=>{e(Rt).usesPerRest?Wt(Tt):Wt(Ht,!1)})}s(Pt),L(()=>{D(Qt,`${e(Rt).name??""}:`),D(ia,` ${e(Rt).description??""} `)}),c(At,Pt)}),s(ft),c(Ne,ft)};_(Gt,Ne=>{e(Se).abilities&&e(Se).abilities.length>0&&Ne(ea)})}s(Jt),L(()=>{D(St,e(Se).name),D(ca,` ${e(Se).description??""}`)}),c(Nt,Jt)};_(tt,Nt=>{e(xe)===nt&&Nt(yt)})}var wt=a(tt,2);{var Ut=Nt=>{var Jt=Kr();L(()=>Ve(Jt,"title",`End ${e(Se).name??""}`)),A("click",Jt,()=>{ve.update(gt=>{if(gt.activeStates){const St=gt.activeStates[nt];St?.hpBonus&&St.target!=="other"&&(gt.maxHP-=St.hpBonus,gt.currentHP=Math.max(1,Math.min(gt.currentHP-St.hpBonus,gt.maxHP))),gt.activeStates=gt.activeStates.filter((ca,ta)=>ta!==nt)}return gt})}),c(Nt,Jt)};_(wt,Nt=>{v()||Nt(Ut)})}s(ce),L(()=>{Ve(ce,"aria-label",e(Se).name),D(Xe,`‚ú® ${e(Se).name??""} `)}),A("mouseenter",ce,()=>Me(nt)),A("mouseleave",ce,R),A("focus",ce,()=>Me(nt)),A("blur",ce,R),A("click",ce,()=>T(nt)),c(et,ce)}),s(j),Xt(2),c(h,ie)};_(ge,h=>{t().activeStates&&t().activeStates.length>0&&h(we)})}s($);var se=a($,2),_e=l(se),K=l(_e),B=a(K,2),Le=l(B),ze=a(Le,2);{var Te=h=>{var ie=Yr(),j=l(ie),et=a(j,2);s(ie),A("click",j,g),A("click",et,M),c(h,ie)};_(ze,h=>{e(ee)&&h(Te)})}s(B);var Ye=a(B,2),te=a(Ye,2),u=l(te);let $e;var be=l(u),G=l(be,!0);s(be);var De=a(be),oe=l(De,!0);s(De),s(u),s(te),s(_e);var ke=a(_e,2),ae=l(ke);Ce(ae),s(ke),s(se),s(_t);var Oe=a(_t,2),de=l(Oe),Fe=a(de,2),Qe=a(Fe,2),Ke=a(Qe,2),st=a(Ke,2),b=a(st,2);Ra(b,h=>r(fe,h),()=>e(fe)),s(Oe),s(at);var F=a(at,2),ue=l(F);xl(ue,{});var q=a(ue,2);Sl(q,{$$events:{roll:h=>Y(h.detail)}});var ye=a(q,2);zl(ye,{$$events:{roll:h=>Y(h.detail)}});var me=a(ye,2);Ol(me,{$$events:{rollHitDice:He}});var Ge=a(me,2);Br(Ge,{});var Ae=a(Ge,2);Yi(Ae,{$$events:{roll:h=>Y(h.detail)}});var dt=a(Ae,2);pn(dt,{});var Ze=a(dt,2);bn(Ze,{}),s(F),s(vt);var lt=a(vt,2);Ra(Mn(lt,{get notation(){return e(ne)},get damageNotation(){return e(V)},get attackName(){return e(N)},get applyHalfDamage(){return e(U)},get bonusBreakdown(){return e(he)},get rollType(){return e(Pe)},get visible(){return e(y)},$$events:{close:Ue},$$legacy:!0}),h=>r(pe,h),()=>e(pe));var W=a(lt,2);{var Q=h=>{Zn(h,{get mode(){return e(Z)},$$events:{close:()=>r(k,!1)}})};_(W,h=>{e(k)&&h(Q)})}var Be=a(W,2);{var it=h=>{mr(h,{onClose:()=>r(H,!1)})};_(Be,h=>{e(H)&&h(it)})}var ut=a(Be,2);wr(ut,{get show(){return e(P)},onSave:x,onCancel:J});var mt=a(ut,2);el(mt,{}),L(()=>{$e=Lt(u,1,"btn btn-mode svelte-1uha8ag",null,$e,{"use-mode":!v()}),D(G,v()?"üìù":"üé≤"),D(oe,v()?"Edit Mode":"Use Mode")}),A("click",K,()=>{r(he,[]),r(y,!0)}),A("click",Le,()=>r(ee,!e(ee))),A("click",Ye,()=>r(P,!0)),A("click",u,le),Ie(ae,d,h=>sl(ga,h)),A("click",de,()=>r(H,!0)),A("click",Fe,()=>{r(Z,"save"),r(k,!0)}),A("click",Qe,()=>{r(Z,"load"),r(k,!0)}),A("click",Ke,We),A("click",st,qe),A("change",b,ot),c(i,ct),Vt(),m()}export{no as component};
