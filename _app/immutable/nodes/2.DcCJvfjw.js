import{f as p,e as I,a as o,s as L,c as vt,t as Ft}from"../chunks/DBs_ODQp.js";import{i as Pt}from"../chunks/BbaRvQ4Z.js";import{c as sa,o as pa,a as rs}from"../chunks/CHX4V4AM.js";import{a7 as Ra,i as Qa,aZ as ns,a_ as Ya,a$ as ka,K as Xt,e as Xa,b0 as Za,T as fa,b1 as is,b2 as os,b3 as cs,q as Da,b4 as vs,b5 as ds,ab as us,d as n,r as Pa,g as ps,C as Tt,F as M,G as Et,H as r,I as l,J as s,b6 as Xe,b7 as Jt,s as c,a4 as F,f as e,m as dt,E as Ee,A as E,b8 as aa,b9 as Lt,ba as da,ao as ra,bb as fs}from"../chunks/DwmZeGF1.js";import{c as Mt,a as se,e as kt,i as xt,u as es,s as Zt,b as yt,d as ga,f as na,g as gs,t as Gt,h as ms,T as hs,j as bs,k as _s}from"../chunks/DQJFtNtV.js";import{i as y,s as qt,a as Ze,b as bt,d as ca,e as ys}from"../chunks/0ovU14Ao.js";import{p as St,b as ja}from"../chunks/CFUzmRYW.js";import{b as va,r as ks}from"../chunks/CtAHgKeS.js";function _a(a,i,t=!1){if(a.multiple){if(i==null)return;if(!Qa(i))return ns();for(var d of a.options)d.selected=i.includes(ua(d));return}for(d of a.options){var u=ua(d);if(Ya(u,i)){d.selected=!0;return}}(!t||i!==void 0)&&(a.selectedIndex=-1)}function Ba(a){var i=new MutationObserver(()=>{_a(a,a.__value)});i.observe(a,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Ra(()=>{i.disconnect()})}function Aa(a,i,t=i){var d=new WeakSet,u=!0;ka(a,"change",g=>{var h=g?"[selected]":":checked",w;if(a.multiple)w=[].map.call(a.querySelectorAll(h),ua);else{var k=a.querySelector(h)??a.querySelector("option:not([disabled])");w=k&&ua(k)}t(w),Xt!==null&&d.add(Xt)}),Xa(()=>{var g=i();if(a===document.activeElement){var h=Za??Xt;if(d.has(h))return}if(_a(a,g,u),u&&g===void 0){var w=a.querySelector(":checked");w!==null&&(g=ua(w),t(g))}a.__value=g,u=!1}),Ba(a)}function ua(a){return"__value"in a?a.__value:a.value}const Ss=Symbol("is custom element"),xs=Symbol("is html");function we(a){if(fa){var i=!1,t=()=>{if(!i){if(i=!0,a.hasAttribute("value")){var d=a.value;We(a,"value",null),a.value=d}if(a.hasAttribute("checked")){var u=a.checked;We(a,"checked",null),a.checked=u}}};a.__on_r=t,Da(t),vs()}}function ya(a,i){var t=Ta(a);t.value===(t.value=i??void 0)||a.value===i&&(i!==0||a.nodeName!=="PROGRESS")||(a.value=i??"")}function ts(a,i){var t=Ta(a);t.checked!==(t.checked=i??void 0)&&(a.checked=i)}function We(a,i,t,d){var u=Ta(a);fa&&(u[i]=a.getAttribute(i),i==="src"||i==="srcset"||i==="href"&&a.nodeName==="LINK")||u[i]!==(u[i]=t)&&(i==="loading"&&(a[is]=t),t==null?a.removeAttribute(i):typeof t!="string"&&$s(a).includes(i)?a[i]=t:a.setAttribute(i,t))}function Ta(a){return a.__attributes??={[Ss]:a.nodeName.includes("-"),[xs]:a.namespaceURI===os}}var Ha=new Map;function $s(a){var i=a.getAttribute("is")||a.nodeName,t=Ha.get(i);if(t)return t;Ha.set(i,t=[]);for(var d,u=a,g=Element.prototype;g!==u;){d=ds(u);for(var h in d)d[h].set&&t.push(h);u=cs(u)}return t}function He(a,i,t=i){var d=new WeakSet;ka(a,"input",async u=>{var g=u?a.defaultValue:a.value;if(g=$a(a)?Ca(g):g,t(g),Xt!==null&&d.add(Xt),await us(),g!==(g=i())){var h=a.selectionStart,w=a.selectionEnd,k=a.value.length;if(a.value=g??"",w!==null){var S=a.value.length;h===w&&w===k&&S>k?(a.selectionStart=S,a.selectionEnd=S):(a.selectionStart=h,a.selectionEnd=Math.min(w,S))}}}),(fa&&a.defaultValue!==a.value||n(i)==null&&a.value)&&(t($a(a)?Ca(a.value):a.value),Xt!==null&&d.add(Xt)),Pa(()=>{var u=i();if(a===document.activeElement){var g=Za??Xt;if(d.has(g))return}$a(a)&&u===Ca(a.value)||a.type==="date"&&!u&&!a.value||u!==a.value&&(a.value=u??"")})}const xa=new Set;function Ua(a,i,t,d,u=d){var g=t.getAttribute("type")==="checkbox",h=a;let w=!1;if(i!==null)for(var k of i)h=h[k]??=[];h.push(t),ka(t,"change",()=>{var S=t.__value;g&&(S=Na(h,S,t.checked)),u(S)},()=>u(g?[]:null)),Pa(()=>{var S=d();if(fa&&t.defaultChecked!==t.checked){w=!0;return}g?(S=S||[],t.checked=S.includes(t.__value)):t.checked=Ya(t.__value,S)}),Ra(()=>{var S=h.indexOf(t);S!==-1&&h.splice(S,1)}),xa.has(h)||(xa.add(h),Da(()=>{h.sort((S,X)=>S.compareDocumentPosition(X)===4?-1:1),xa.delete(h)})),Da(()=>{if(w){var S;if(g)S=Na(h,S,t.checked);else{var X=h.find(W=>W.checked);S=X?.__value}u(S)}})}function Fa(a,i,t=i){ka(a,"change",d=>{var u=d?a.defaultChecked:a.checked;t(u)}),(fa&&a.defaultChecked!==a.checked||n(i)==null)&&t(a.checked),Pa(()=>{var d=i();a.checked=!!d})}function Na(a,i,t){for(var d=new Set,u=0;u<a.length;u+=1)a[u].checked&&d.add(a[u].__value);return t||d.delete(i),Array.from(d)}function $a(a){var i=a.type;return i==="number"||i==="range"}function Ca(a){return a===""?null:+a}function Cs(a,i,t){var d=ps(a,i);d&&d.set&&(a[i]=t,Ra(()=>{a[i]=null}))}function Ea(a){return function(...i){var t=i[0];return t.stopPropagation(),a?.apply(this,i)}}function ia(a,i){var t=a.$$events?.[i.type],d=Qa(t)?t.slice():t==null?[]:[t];for(var u of d)u.call(this,i)}const Ls="";function as(...a){return va+Ls+ks(a[0],a[1])}const Ma={paladin:{name:"Paladin",hitDice:"d10",spellcaster:!0,spellcastingAbility:"charisma",spellSlotsByLevel:{1:0,2:2,3:3,4:3,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Divine Sense",type:"uses",maxUses:(a,i=1)=>1+Math.max(1,i),resetOn:"long",description:"Detect celestials, fiends, and undead within 60 feet",minLevel:1},{name:"Lay on Hands",type:"pool",maxPool:a=>a*5,resetOn:"long",description:"Heal wounds or cure disease",minLevel:1},{name:"Divine Smite",type:"spellSlot",description:"Expend spell slot to deal extra radiant damage",minLevel:2,rollable:!0},{name:"Channel Divinity",type:"pool",maxPool:a=>a>=18?3:a>=6?2:1,resetOn:"short",description:"Sacred Weapon or Turn Undead",minLevel:3}]},fighter:{name:"Fighter",hitDice:"d10",spellcaster:!1,features:[{name:"Second Wind",type:"uses",maxUses:1,resetOn:"short",description:"Regain 1d10 + fighter level HP as bonus action",minLevel:1,rollable:!0,rollFormula:a=>`1d10+${a}`},{name:"Action Surge",type:"uses",maxUses:a=>a>=17?2:1,resetOn:"short",description:"Take one additional action on your turn",minLevel:2},{name:"Indomitable",type:"uses",maxUses:a=>a>=17?3:a>=13?2:1,resetOn:"long",description:"Reroll a failed saving throw",minLevel:9}],subclasses:{champion:{name:"Champion",features:[{name:"Improved Critical",type:"info",description:"Critical hit on 19-20",minLevel:3},{name:"Remarkable Athlete",type:"info",description:"Add half proficiency to STR/DEX/CON checks, increase long jump distance",minLevel:7},{name:"Additional Fighting Style",type:"info",description:"Choose a second fighting style",minLevel:10},{name:"Superior Critical",type:"info",description:"Critical hit on 18-20",minLevel:15},{name:"Survivor",type:"info",description:"Regain 5 + CON mod HP at start of turn if below half HP",minLevel:18}]},battlemaster:{name:"Battle Master",features:[{name:"Combat Superiority",type:"uses",maxUses:a=>a>=15?6:a>=7?5:4,resetOn:"short",description:a=>`Use superiority dice (${a>=18?"d12":a>=10?"d10":"d8"}) for maneuvers`,minLevel:3},{name:"Know Your Enemy",type:"info",description:"Learn capabilities of creatures you observe",minLevel:7},{name:"Improved Combat Superiority",type:"info",description:"Superiority dice become d10",minLevel:10},{name:"Relentless",type:"info",description:"Regain 1 superiority die if you have none at start of turn",minLevel:15}]}}},rogue:{name:"Rogue",hitDice:"d8",spellcaster:!1,features:[{name:"Sneak Attack",type:"info",description:a=>`Deal ${Math.ceil(a/2)}d6 extra damage once per turn with advantage or ally nearby`,minLevel:1,rollable:!0,rollFormula:a=>`${Math.ceil(a/2)}d6`},{name:"Cunning Action",type:"info",description:"Dash, Disengage, or Hide as a bonus action",minLevel:2},{name:"Uncanny Dodge",type:"info",description:"Use reaction to halve damage from an attack",minLevel:5},{name:"Evasion",type:"info",description:"Take no damage on successful Dex save (half on fail)",minLevel:7}]},wizard:{name:"Wizard",hitDice:"d6",spellcaster:!0,spellcastingAbility:"intelligence",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Arcane Recovery",type:"uses",maxUses:1,resetOn:"long",description:a=>`Recover spell slots totaling up to ${Math.ceil(a/2)} levels during short rest`,minLevel:1},{name:"Spell Mastery",type:"info",description:"Cast one 1st-level and one 2nd-level spell at will",minLevel:18}]},cleric:{name:"Cleric",hitDice:"d8",spellcaster:!0,spellcastingAbility:"wisdom",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Channel Divinity",type:"pool",maxPool:a=>a>=18?3:a>=6?2:1,resetOn:"short",description:"Turn Undead or domain-specific ability",minLevel:2},{name:"Destroy Undead",type:"info",description:a=>`Channel Divinity destroys undead of CR ${a>=17?4:a>=14?3:a>=11?2:a>=8?1:.5} or lower`,minLevel:5},{name:"Divine Intervention",type:"uses",maxUses:1,resetOn:"long",description:a=>`${a}% chance to succeed, implore deity for aid`,minLevel:10}],subclasses:{war:{name:"War Domain",features:[{name:"War Priest",type:"uses",maxUses:(a,i=1)=>Math.max(1,i),resetOn:"long",description:"Make one weapon attack as a bonus action",minLevel:1},{name:"Guided Strike",type:"channelDivinity",description:"Use your Channel Divinity to gain +10 to an attack roll. Make this choice after you see the roll, but before the DM says whether the attack hits or misses.",minLevel:2,resetOn:"short"},{name:"War God's Blessing",type:"channelDivinity",description:"Use reaction to grant +10 to an ally's attack roll within 30 feet. Consumes one use of Channel Divinity.",minLevel:6,resetOn:"short"},{name:"Divine Strike",type:"info",description:a=>`Deal extra ${a>=14?"2d8":"1d8"} weapon damage once per turn`,minLevel:8,rollable:!0,rollFormula:a=>a>=14?"2d8":"1d8"},{name:"Avatar of Battle",type:"info",description:"Gain resistance to nonmagical weapon damage",minLevel:17}]},life:{name:"Life Domain",features:[{name:"Disciple of Life",type:"info",description:"Healing spells restore additional 2 + spell level HP",minLevel:1},{name:"Preserve Life",type:"pool",maxPool:a=>a*5,resetOn:"short",description:"Restore HP to creatures within 30 feet",minLevel:2},{name:"Blessed Healer",type:"info",description:"Regain 2 + spell level HP when you cast healing spell",minLevel:6},{name:"Divine Strike",type:"info",description:a=>`Deal extra ${a>=14?"2d8":"1d8"} radiant damage once per turn`,minLevel:8,rollable:!0,rollFormula:a=>a>=14?"2d8":"1d8"},{name:"Supreme Healing",type:"info",description:"Maximize healing dice instead of rolling",minLevel:17}]}}},barbarian:{name:"Barbarian",hitDice:"d12",spellcaster:!1,features:[{name:"Rage",type:"uses",maxUses:a=>a>=20?1/0:a>=17?6:a>=12?5:a>=6?4:a>=3?3:2,resetOn:"long",description:a=>`+${a>=16?4:a>=9?3:2} damage, resistance to physical damage`,minLevel:1},{name:"Reckless Attack",type:"info",description:"Gain advantage on melee attacks, enemies get advantage on you",minLevel:2},{name:"Danger Sense",type:"info",description:"Advantage on Dex saves against effects you can see",minLevel:2}],subclasses:{berserker:{name:"Path of the Berserker",features:[{name:"Frenzy",type:"info",description:"While raging, make melee attack as bonus action (gain 1 exhaustion after rage)",minLevel:3},{name:"Mindless Rage",type:"info",description:"Cannot be charmed or frightened while raging",minLevel:6},{name:"Intimidating Presence",type:"info",description:"Use action to frighten creature within 30 feet",minLevel:10},{name:"Retaliation",type:"info",description:"When damaged by creature within 5 feet, make melee attack as reaction",minLevel:14}]}}}};function Ot(a){const i=a.toLowerCase();return Ma[i]||null}function oa(a,i,t){const d=Ot(a);if(!d)return[];const u=d.features.filter(g=>!g.minLevel||g.minLevel<=i);if(t&&d.subclasses&&d.subclasses[t]){const g=d.subclasses[t].features.filter(h=>!h.minLevel||h.minLevel<=i);return[...u,...g]}return u}function Ga(a){const i=Ot(a);return!i||!i.subclasses?[]:Object.keys(i.subclasses).map(t=>({id:t,name:i.subclasses[t].name}))}function Oa(a,i){const t=Ot(a);return!t||!t.spellcaster||!t.spellSlotsByLevel?0:t.spellSlotsByLevel[i]||0}function qa(a,i,t){const d=Ot(a);return!d||!d.spellcaster?0:Math.max(1,t+i)}function ws(a,i,t){const d=Ot(a);return!d||!d.spellcaster?null:8+i+t}function Ds(){return Object.keys(Ma).map(a=>({id:a,name:Ma[a].name}))}var js=p('<div class="section-header svelte-ls99y2" role="button" tabindex="0"><h2 class="svelte-ls99y2"> </h2> <span class="collapse-btn svelte-ls99y2"> </span></div>');function la(a,i){Tt(i,!1);let t=St(i,"title",8),d=St(i,"collapsed",8),u=St(i,"ariaLabel",8,""),g=St(i,"onToggle",8);Pt();var h=js(),w=r(h),k=r(w,!0);l(w);var S=s(w,2),X=r(S,!0);l(S),l(h),M(()=>{We(h,"aria-expanded",!d()),We(h,"aria-label",u()),L(k,t()),L(X,d()?"â–¼":"â–²")}),I("click",h,function(...W){g()?.apply(this,W)}),I("keydown",h,W=>{(W.key==="Enter"||W.key===" ")&&g()()}),o(a,h),Et()}var Bs=p("<option> </option>"),As=p("<option> </option>"),Fs=p('<div class="form-group svelte-172i2fj"><label for="characterSubclass" class="svelte-172i2fj">Subclass</label> <select id="characterSubclass" class="svelte-172i2fj"><option>Select Subclass</option><!></select></div>'),Ms=p('<div class="info-grid svelte-172i2fj"><div class="form-group svelte-172i2fj"><label for="characterName" class="svelte-172i2fj">Character Name</label> <input type="text" id="characterName" placeholder="Enter name" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterClass" class="svelte-172i2fj">Class</label> <select id="characterClass" class="svelte-172i2fj"><option>Select Class</option><!></select></div> <!> <div class="form-group svelte-172i2fj"><label for="characterLevel" class="svelte-172i2fj">Level</label> <input type="number" id="characterLevel" min="1" max="20" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterRace" class="svelte-172i2fj">Race</label> <input type="text" id="characterRace" placeholder="e.g., Human" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterBackground" class="svelte-172i2fj">Background</label> <input type="text" id="characterBackground" placeholder="e.g., Soldier" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterAlignment" class="svelte-172i2fj">Alignment</label> <input type="text" id="characterAlignment" placeholder="e.g., Lawful Good" class="svelte-172i2fj"/></div></div>'),Is=p('<section class="character-info svelte-172i2fj"><!> <!></section>');function Rs(a,i){Tt(i,!1);const t=()=>Ze(se,"$character",u),d=()=>Ze(Mt,"$collapsedStates",u),[u,g]=qt(),h=F(),w=Ds();function k(ue){const pe=ue.target;se.update(Q=>(Q.class=pe.value,Q.subclass="",Q))}function S(ue){const pe=ue.target;se.update(Q=>(Q.subclass=pe.value,Q))}function X(ue){const pe=ue.target;se.update(Q=>(Q.level=parseInt(pe.value)||1,Q)),es()}Xe(()=>(t(),Ga),()=>{c(h,t().class?Ga(t().class):[])}),Jt(),Pt();var W=Is(),le=r(W);{let ue=dt(()=>(d(),n(()=>d().characterInfo?"Expand":"Collapse")));la(le,{title:"Character Info",get collapsed(){return d(),n(()=>d().characterInfo)},get ariaLabel(){return e(ue)},onToggle:()=>Mt.update(pe=>({...pe,characterInfo:!pe.characterInfo}))})}var re=s(le,2);{var J=ue=>{var pe=Ms(),Q=r(pe),ze=s(r(Q),2);we(ze),l(Q);var Qe=s(Q,2),z=s(r(Qe),2),Se=r(z);Se.value=Se.__value="";var Z=s(Se);kt(Z,1,()=>w,xt,(Ge,Ae)=>{var f=Bs(),C=r(f,!0);l(f);var G={};M(()=>{L(C,(e(Ae),n(()=>e(Ae).name))),G!==(G=(e(Ae),n(()=>e(Ae).id)))&&(f.value=(f.__value=(e(Ae),n(()=>e(Ae).id)))??"")}),o(Ge,f)}),l(z);var me;Ba(z),l(Qe);var De=s(Qe,2);{var Re=Ge=>{var Ae=Fs(),f=s(r(Ae),2),C=r(f);C.value=C.__value="";var G=s(C);kt(G,1,()=>e(h),xt,(N,be)=>{var Ve=As(),et=r(Ve,!0);l(Ve);var _e={};M(()=>{L(et,(e(be),n(()=>e(be).name))),_e!==(_e=(e(be),n(()=>e(be).id)))&&(Ve.value=(Ve.__value=(e(be),n(()=>e(be).id)))??"")}),o(N,Ve)}),l(f);var oe;Ba(f),l(Ae),M(()=>{oe!==(oe=(t(),n(()=>t().subclass)))&&(f.value=(f.__value=(t(),n(()=>t().subclass)))??"",_a(f,(t(),n(()=>t().subclass))))}),I("change",f,S),o(Ge,Ae)};y(De,Ge=>{e(h),n(()=>e(h).length>0)&&Ge(Re)})}var ke=s(De,2),Pe=s(r(ke),2);we(Pe),l(ke);var D=s(ke,2),ge=s(r(D),2);we(ge),l(D);var b=s(D,2),P=s(r(b),2);we(P),l(b);var Y=s(b,2),Ke=s(r(Y),2);we(Ke),l(Y),l(pe),M(()=>{me!==(me=(t(),n(()=>t().class)))&&(z.value=(z.__value=(t(),n(()=>t().class)))??"",_a(z,(t(),n(()=>t().class)))),ya(Pe,(t(),n(()=>t().level)))}),He(ze,()=>t().name,Ge=>bt(se,n(t).name=Ge,n(t))),I("change",z,k),I("change",Pe,X),He(ge,()=>t().race,Ge=>bt(se,n(t).race=Ge,n(t))),He(P,()=>t().background,Ge=>bt(se,n(t).background=Ge,n(t))),He(Ke,()=>t().alignment,Ge=>bt(se,n(t).alignment=Ge,n(t))),o(ue,pe)};y(re,ue=>{d(),n(()=>!d().characterInfo)&&ue(J)})}l(W),o(a,W),Et(),g()}var Ps=p('<div class="ability-card svelte-bbv1xt"><h3 class="svelte-bbv1xt"> </h3> <input type="number" class="ability-score svelte-bbv1xt" min="1" max="30"/> <div class="ability-modifier svelte-bbv1xt"> </div> <button class="roll-btn svelte-bbv1xt">Check</button> <div class="save-row svelte-bbv1xt"><input type="checkbox" class="svelte-bbv1xt"/> <label class="svelte-bbv1xt">Save</label> <button class="roll-btn-small svelte-bbv1xt">Roll</button></div></div>'),Ts=p('<div class="proficiency-bonus svelte-bbv1xt"><label for="profBonus">Proficiency Bonus</label> <input type="number" id="profBonus" class="prof-input svelte-bbv1xt"/></div> <div class="abilities-grid svelte-bbv1xt"></div>',1),Es=p("<section><!> <!></section>");function Hs(a,i){Tt(i,!1);const t=()=>Ze(ga,"$abilityModifiers",h),d=()=>Ze(se,"$character",h),u=()=>Ze(Zt,"$searchFilter",h),g=()=>Ze(Mt,"$collapsedStates",h),[h,w]=qt(),k=F(),S=F(),X=sa(),W=[{key:"strength",label:"Strength"},{key:"dexterity",label:"Dexterity"},{key:"constitution",label:"Constitution"},{key:"intelligence",label:"Intelligence"},{key:"wisdom",label:"Wisdom"},{key:"charisma",label:"Charisma"}];function le(){es()}function re(z){const Se=t()[z],Z=`1d20${Se>=0?"+":""}${Se}`;X("roll",{notation:Z,rollType:"check"})}function J(z){const Se=t()[z],Z=d().saveProficiencies[z]?d().proficiencyBonus:0,me=Se+Z,De=`1d20${me>=0?"+":""}${me}`;X("roll",{notation:De,rollType:"save"})}Xe(()=>u(),()=>{c(k,W.filter(({label:z})=>u()?z.toLowerCase().includes(u().toLowerCase()):!0))}),Xe(()=>(e(k),u()),()=>{c(S,e(k).length>0||!u()||u().toLowerCase().includes("proficiency"))}),Jt(),Pt();var ue=Es();let pe;var Q=r(ue);la(Q,{title:"Ability Scores",get collapsed(){return g(),n(()=>g().abilityScores)},ariaLabel:"Toggle Ability Scores Section",onToggle:()=>Mt.update(z=>({...z,abilityScores:!z.abilityScores}))});var ze=s(Q,2);{var Qe=z=>{var Se=Ts(),Z=Ee(Se),me=s(r(Z),2);we(me),l(Z);var De=s(Z,2);kt(De,5,()=>e(k),xt,(Re,ke)=>{let Pe=()=>e(ke).key,D=()=>e(ke).label;var ge=Ps(),b=r(ge),P=r(b,!0);l(b);var Y=s(b,2);we(Y);var Ke=s(Y,2),Ge=r(Ke);l(Ke);var Ae=s(Ke,2),f=s(Ae,2),C=r(f);we(C);var G=s(C,2),oe=s(G,2);l(f),l(ge),M(N=>{L(P,N),L(Ge,`${t(),Pe(),n(()=>t()[Pe()]>=0?"+":"")??""}${t(),Pe(),n(()=>t()[Pe()])??""}`),We(C,"id",`${Pe()}-save`),We(G,"for",`${Pe()}-save`)},[()=>(D(),n(()=>D().substring(0,3).toUpperCase()))]),He(Y,()=>d().abilities[Pe()],N=>bt(se,n(d).abilities[Pe()]=N,n(d))),I("change",Y,le),I("click",Ae,()=>re(Pe())),Fa(C,()=>d().saveProficiencies[Pe()],N=>bt(se,n(d).saveProficiencies[Pe()]=N,n(d))),I("click",oe,()=>J(Pe())),o(Re,ge)}),l(De),He(me,()=>d().proficiencyBonus,Re=>bt(se,n(d).proficiencyBonus=Re,n(d))),o(z,Se)};y(ze,z=>{g(),n(()=>!g().abilityScores)&&z(Qe)})}l(ue),M(()=>pe=yt(ue,1,"ability-scores svelte-bbv1xt",null,pe,{hidden:!e(S)})),o(a,ue),Et(),w()}function Ia(a,i){if(!a.class)return null;const t=Ot(a.class);if(!t||!t.spellcaster||!t.spellcastingAbility)return null;const d=i[t.spellcastingAbility];return 8+a.proficiencyBonus+d}function Wa(a,i){if(!a.class)return 0;const t=Ot(a.class);return!t||!t.spellcaster||!t.spellcastingAbility?0:i[t.spellcastingAbility]}var Us=p('<input type="number" id="armorClass" class="stat-input svelte-1r5hyyb"/>'),Ns=p('<input type="text" id="armorClass" readonly=""/>'),Gs=p('<div class="stat-box svelte-1r5hyyb"><label for="spellSaveDC" class="svelte-1r5hyyb">Spell Save DC</label> <input type="number" id="spellSaveDC" class="stat-input svelte-1r5hyyb" readonly="" title="8 + Proficiency Bonus + Spellcasting Ability Modifier"/></div>'),Os=p('<span class="hit-dice-type"> </span>'),qs=p('<div class="stats-grid svelte-1r5hyyb"><div class="stat-box svelte-1r5hyyb"><label for="armorClass" class="svelte-1r5hyyb">Armor Class</label> <!></div> <div class="stat-box svelte-1r5hyyb"><label for="initiative" class="svelte-1r5hyyb">Initiative</label> <input type="number" id="initiative" class="stat-input svelte-1r5hyyb"/></div> <div class="stat-box svelte-1r5hyyb"><label for="speed" class="svelte-1r5hyyb">Speed</label> <input type="text" id="speed" class="stat-input svelte-1r5hyyb"/></div> <!></div> <div class="hp-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Points</h3> <div><div class="hp-inputs svelte-1r5hyyb"><input type="number" class="hp-current svelte-1r5hyyb" min="0"/> <span class="hp-separator svelte-1r5hyyb">/</span> <input type="number" class="hp-max svelte-1r5hyyb" min="0"/></div> <div class="hp-controls svelte-1r5hyyb"><button class="hp-btn svelte-1r5hyyb">âˆ’</button> <button class="hp-btn svelte-1r5hyyb">+</button> <button class="hp-btn svelte-1r5hyyb">âˆ’5</button> <button class="hp-btn svelte-1r5hyyb">+5</button></div></div> <div class="temp-hp svelte-1r5hyyb"><label for="tempHP" class="svelte-1r5hyyb">Temp HP</label> <input type="number" id="tempHP" min="0" class="svelte-1r5hyyb"/></div></div> <div class="hit-dice-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Dice</h3> <div class="hit-dice-display svelte-1r5hyyb"><input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <span>/</span> <input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <!></div> <div class="hit-dice-controls"><label for="hitDiceCount" class="svelte-1r5hyyb">Roll</label> <input type="number" id="hitDiceCount" class="hit-dice-count-input svelte-1r5hyyb" min="1" value="1"/> <button class="btn btn-primary roll-hit-dice use-enabled svelte-1r5hyyb">ðŸŽ² Roll</button></div></div>',1),Ws=p("<section><!> <!></section>");function zs(a,i){Tt(i,!1);const t=()=>Ze(se,"$character",w),d=()=>Ze(ga,"$abilityModifiers",w),u=()=>Ze(Zt,"$searchFilter",w),g=()=>Ze(Mt,"$collapsedStates",w),h=()=>Ze(na,"$isEditMode",w),[w,k]=qt(),S=F(),X=F(),W=F(),le=F(),re=sa();function J(Se){se.update(Z=>(Z.currentHP=Math.max(0,Math.min(Z.maxHP,Z.currentHP+Se)),Z))}function ue(Se=1){if(t().hitDice.current<=0){alert("No hit dice remaining!");return}if(!t().class){alert("Please select a class first!");return}const Z=Ot(t().class);if(!Z){alert("Invalid class configuration!");return}const me=Math.min(Se,t().hitDice.current),De=Z.hitDice,Re=d().constitution,ke=Re>=0?`+${Re}`:`${Re}`,Pe=`${me}${De}${ke}`;re("rollHitDice",{notation:Pe,hitDie:De,count:me})}Xe(()=>(t(),d()),()=>{c(S,Ia(t(),d()))}),Xe(()=>t(),()=>{c(X,t().activeStates&&t().activeStates.length>0?t().activeStates.reduce((Se,Z)=>Se+(Z.acBonus||0),0):0)}),Xe(()=>t(),()=>{c(W,t().activeStates&&t().activeStates.length>0?t().activeStates.some(Se=>Se.name==="Aid"&&Se.target==="self"):!1)}),Xe(()=>u(),()=>{c(le,!u()||"armor class".includes(u().toLowerCase())||"initiative".includes(u().toLowerCase())||"speed".includes(u().toLowerCase())||"hit points".includes(u().toLowerCase())||"hp".includes(u().toLowerCase())||"hit dice".includes(u().toLowerCase())||"spell save".includes(u().toLowerCase())||"combat".includes(u().toLowerCase()))}),Jt(),Pt();var pe=Ws();let Q;var ze=r(pe);{let Se=dt(()=>(g(),n(()=>g().combatStats?"Expand":"Collapse")));la(ze,{title:"Combat Stats",get collapsed(){return g(),n(()=>g().combatStats)},get ariaLabel(){return e(Se)},onToggle:()=>Mt.update(Z=>({...Z,combatStats:!Z.combatStats}))})}var Qe=s(ze,2);{var z=Se=>{var Z=qs(),me=Ee(Z),De=r(me),Re=s(r(De),2);{var ke=H=>{var V=Us();we(V),He(V,()=>t().armorClass,Fe=>bt(se,n(t).armorClass=Fe,n(t))),o(H,V)},Pe=H=>{var V=Ns();we(V),M(()=>{ya(V,(e(X),t(),n(()=>e(X)!==0?`${t().armorClass} â†’ ${t().armorClass+e(X)}`:`${t().armorClass}`))),yt(V,1,gs(e(X)!==0?"stat-input ac-enhanced":"stat-input"),"svelte-1r5hyyb"),We(V,"title",e(X)!==0?"Base AC plus active effect bonuses":"Base Armor Class")}),o(H,V)};y(Re,H=>{h()?H(ke):H(Pe,!1)})}l(De);var D=s(De,2),ge=s(r(D),2);we(ge),l(D);var b=s(D,2),P=s(r(b),2);we(P),l(b);var Y=s(b,2);{var Ke=H=>{var V=Gs(),Fe=s(r(V),2);we(Fe),l(V),M(()=>ya(Fe,e(S))),o(H,V)};y(Y,H=>{e(S)!==null&&H(Ke)})}l(me);var Ge=s(me,2),Ae=s(r(Ge),2);let f;var C=r(Ae),G=r(C);we(G);var oe=s(G,4);we(oe),l(C);var N=s(C,2),be=r(N),Ve=s(be,2),et=s(Ve,2),_e=s(et,2);l(N),l(Ae);var Oe=s(Ae,2),A=s(r(Oe),2);we(A),l(Oe),l(Ge);var $=s(Ge,2),ae=s(r($),2),ee=r(ae);we(ee);var O=s(ee,4);we(O);var v=s(O,2);{var qe=H=>{const V=dt(()=>(E(Ot),t(),n(()=>Ot(t().class))));var Fe=vt(),lt=Ee(Fe);{var je=ye=>{const xe=dt(()=>(d(),n(()=>d().constitution)));var Me=Os(),Te=r(Me);l(Me),M(()=>L(Te,`(${E(e(V)),n(()=>e(V).hitDice)??""}${(e(xe)>=0?`+${e(xe)}`:e(xe))??""})`)),o(ye,Me)};y(lt,ye=>{e(V)&&ye(je)})}o(H,Fe)};y(v,H=>{t(),n(()=>t().class)&&H(qe)})}l(ae);var ce=s(ae,2),ne=s(r(ce),2),j=s(ne,2);l(ce),l($),M(()=>{f=yt(Ae,1,"hp-display svelte-1r5hyyb",null,f,{"aid-active":e(W)}),We(G,"max",(t(),n(()=>t().maxHP))),We(ee,"max",(t(),n(()=>t().hitDice.max))),We(ne,"max",(t(),n(()=>t().hitDice.current))),j.disabled=(t(),n(()=>t().hitDice.current<=0||!t().class))}),He(ge,()=>t().initiative,H=>bt(se,n(t).initiative=H,n(t))),He(P,()=>t().speed,H=>bt(se,n(t).speed=H,n(t))),He(G,()=>t().currentHP,H=>bt(se,n(t).currentHP=H,n(t))),He(oe,()=>t().maxHP,H=>bt(se,n(t).maxHP=H,n(t))),I("click",be,()=>J(-1)),I("click",Ve,()=>J(1)),I("click",et,()=>J(-5)),I("click",_e,()=>J(5)),He(A,()=>t().tempHP,H=>bt(se,n(t).tempHP=H,n(t))),He(ee,()=>t().hitDice.current,H=>bt(se,n(t).hitDice.current=H,n(t))),He(O,()=>t().hitDice.max,H=>bt(se,n(t).hitDice.max=H,n(t))),I("input",ne,H=>{const V=H.target,Fe=parseInt(V.value);Fe>t().hitDice.current&&(V.value=String(t().hitDice.current)),Fe<1&&(V.value="1")}),I("click",j,()=>{const H=document.getElementById("hitDiceCount"),V=parseInt(H?.value||"1");ue(V)}),o(Se,Z)};y(Qe,Se=>{g(),n(()=>!g().combatStats)&&Se(z)})}l(pe),M(()=>Q=yt(pe,1,"combat-stats svelte-1r5hyyb",null,Q,{hidden:!e(le)})),o(a,pe),Et(),k()}const La={acrobatics:"dexterity",animalHandling:"wisdom",arcana:"intelligence",athletics:"strength",deception:"charisma",history:"intelligence",insight:"wisdom",intimidation:"charisma",investigation:"intelligence",medicine:"wisdom",nature:"intelligence",perception:"wisdom",performance:"charisma",persuasion:"charisma",religion:"intelligence",sleightOfHand:"dexterity",stealth:"dexterity",survival:"wisdom"};var Ks=p('<div class="skill-row svelte-1f1pl16"><input type="checkbox" class="svelte-1f1pl16"/> <label class="svelte-1f1pl16"> <span class="ability-tag svelte-1f1pl16"> </span></label> <span class="skill-modifier svelte-1f1pl16"> </span> <button class="roll-btn svelte-1f1pl16">Roll</button></div>'),Vs=p('<div class="skills-grid svelte-1f1pl16"></div>'),Js=p("<section><!> <!></section>");function Qs(a,i){Tt(i,!1);const t=()=>Ze(se,"$character",h),d=()=>Ze(ga,"$abilityModifiers",h),u=()=>Ze(Zt,"$searchFilter",h),g=()=>Ze(Mt,"$collapsedStates",h),[h,w]=qt(),k=F(),S=F(),X=F(),W=F(),le=F(),re=F(),J=sa(),ue=[{key:"acrobatics",label:"Acrobatics"},{key:"animalHandling",label:"Animal Handling"},{key:"arcana",label:"Arcana"},{key:"athletics",label:"Athletics"},{key:"deception",label:"Deception"},{key:"history",label:"History"},{key:"insight",label:"Insight"},{key:"intimidation",label:"Intimidation"},{key:"investigation",label:"Investigation"},{key:"medicine",label:"Medicine"},{key:"nature",label:"Nature"},{key:"perception",label:"Perception"},{key:"performance",label:"Performance"},{key:"persuasion",label:"Persuasion"},{key:"religion",label:"Religion"},{key:"sleightOfHand",label:"Sleight of Hand"},{key:"stealth",label:"Stealth"},{key:"survival",label:"Survival"}];function pe(Z){const me=e(k)[Z],De=`1d20${me>=0?"+":""}${me}`;J("roll",{notation:De,rollType:"check"})}Xe(()=>{},()=>{c(k,{})}),Xe(()=>t(),()=>{c(S,t().skillProficiencies)}),Xe(()=>t(),()=>{c(X,t().proficiencyBonus)}),Xe(()=>d(),()=>{c(W,d())}),Xe(()=>(e(W),e(S),e(X)),()=>{for(const{key:Z}of ue){const me=La[Z],De=e(W)[me],Re=e(S)[Z]?e(X):0;aa(k,e(k)[Z]=De+Re)}}),Xe(()=>u(),()=>{c(le,ue.filter(({label:Z})=>u()?Z.toLowerCase().includes(u().toLowerCase()):!0))}),Xe(()=>e(le),()=>{c(re,e(le).length>0)}),Jt(),Pt();var Q=Js();let ze;var Qe=r(Q);{let Z=dt(()=>(g(),n(()=>g().skills?"Expand":"Collapse")));la(Qe,{title:"Skills",get collapsed(){return g(),n(()=>g().skills)},get ariaLabel(){return e(Z)},onToggle:()=>Mt.update(me=>({...me,skills:!me.skills}))})}var z=s(Qe,2);{var Se=Z=>{var me=Vs();kt(me,5,()=>e(le),xt,(De,Re)=>{let ke=()=>e(Re).key,Pe=()=>e(Re).label;var D=Ks(),ge=r(D);we(ge);var b=s(ge,2),P=r(b),Y=s(P),Ke=r(Y);l(Y),l(b);var Ge=s(b,2),Ae=r(Ge);l(Ge);var f=s(Ge,2);l(D),M(C=>{ts(ge,(e(S),ke(),n(()=>e(S)[ke()]))),We(ge,"id",ke()),We(b,"for",ke()),L(P,`${Pe()??""} `),L(Ke,`(${C??""})`),L(Ae,`${e(k),ke(),n(()=>e(k)[ke()]>=0?"+":"")??""}${e(k),ke(),n(()=>e(k)[ke()])??""}`)},[()=>(E(La),ke(),n(()=>La[ke()].substring(0,3).toUpperCase()))]),I("change",ge,C=>{console.log("Skill proficiency changed:",ke(),C.target.checked),se.update(G=>({...G,skillProficiencies:{...G.skillProficiencies,[ke()]:C.target.checked}}))}),I("click",f,()=>pe(ke())),o(De,D)}),l(me),o(Z,me)};y(z,Z=>{g(),n(()=>!g().skills)&&Z(Se)})}l(Q),M(()=>ze=yt(Q,1,"skills svelte-1f1pl16",null,ze,{hidden:!e(re)})),o(a,Q),Et(),w()}let ma=null,ha=null;async function ss(){if(ma)return ma;try{return ma=await(await fetch(as("/data/spells.json"))).json(),ma||[]}catch(a){return console.error("Failed to load spells:",a),[]}}async function Ys(){if(ha)return ha;try{return ha=await(await fetch(as("/data/feats.json"))).json(),ha||[]}catch(a){return console.error("Failed to load feats:",a),[]}}function za(a,i){if(!i.trim())return a;const t=i.toLowerCase();return a.filter(d=>d.name.toLowerCase().includes(t)||d.school.toLowerCase().includes(t)||d.classes.some(u=>u.toLowerCase().includes(t))||d.description.toLowerCase().includes(t))}function Xs(a,i){return i===null?a:a.filter(t=>t.level===i)}function Zs(a,i){if(!i.trim())return a;const t=i.toLowerCase();return a.filter(d=>d.name.toLowerCase().includes(t)||d.description.toLowerCase().includes(t))}function ba(a){const i=a.description,t=/\b(Strength|Dexterity|Constitution|Intelligence|Wisdom|Charisma)\s+saving\s+throw/i,d=i.match(t);if(!d)return null;const u=d[1].toLowerCase(),h=/half\s+(?:as\s+much\s+)?damage\s+on\s+a\s+successful(?:\s+save)?/i.test(i),k=/saving\s+throw\s+or\s+take.*?damage/i.test(i)&&!h;return{ability:u,halfDamageOnSave:h,noDamageOnSave:k}}function el(a){const i=a.description;return/(plus|add)\s+your\s+spellcasting\s+(ability\s+)?modifier/i.test(i)}function wa(a){const i=a.description.toLowerCase();return i.includes("ranged spell attack")||i.includes("melee spell attack")}function Ka(a){const i=a.description.toLowerCase();if(["Divine Favor","Bless","Aid","Command"].includes(a.name))return!0;const u=["takes","take","deals","deal","damage equal to","force damage","fire damage","cold damage","lightning damage","thunder damage","acid damage","poison damage","necrotic damage","radiant damage","psychic damage","regain","regains","hit point"].some(w=>i.includes(w));return["bonus to attack","bonus to damage","bonus to ac","gains a +","gain a +","+1 bonus","+2 bonus","+3 bonus","advantage on","becomes a magic weapon"].some(w=>i.includes(w))&&!u}function tl(a){const i=a.description;let t=0,d=0,u=0,g="";const h=i.match(/\+(\d+)\s+bonus\s+to\s+attack\s+rolls\s+and\s+damage\s+rolls/i);if(h){const k=parseInt(h[1]);t=k,d=k,g=`+${k} to attack and damage rolls`}if(a.name==="Bless"&&(g="Add 1d4 to attack rolls and saves",t="1d4"),a.name==="Aid")return g="+5 HP (max and current) for 8 hours",{attackBonus:0,damageBonus:0,acBonus:0,hpBonus:5,description:g,name:a.name};a.name==="Divine Favor"&&(g="Your weapon attacks deal an extra 1d4 radiant damage on a hit.",d="1d4");const w=i.match(/\+(\d+)\s+bonus\s+to\s+AC/i);return w&&(u=parseInt(w[1]),g=`+${u} to AC`),a.name==="Haste"&&(g="+2 AC, doubled speed, extra action",u=2),g||t!==0||d!==0||u!==0?{attackBonus:t,damageBonus:d,acBonus:u,description:g||a.description.substring(0,100),name:a.name}:null}var al=p('<button class="btn btn-secondary">Add Attack</button>'),sl=p('<input type="text" placeholder="Attack name" class="attack-name svelte-14o91c5"/>'),ll=p('<h4 class="attack-name-display svelte-14o91c5"> </h4>'),rl=p('<button class="btn-remove svelte-14o91c5">Ã—</button>'),nl=p('<div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Bonus</label> <input type="number" class="attack-bonus svelte-14o91c5"/></div>'),il=p('<div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Damage</label> <input type="text" placeholder="e.g., 2d6+3" class="attack-damage svelte-14o91c5"/></div>'),ol=p('<div class="spell-info-loading svelte-14o91c5">Loading spell info...</div>'),cl=p('<li class="svelte-14o91c5"><strong>At Higher Levels:</strong> </li>'),vl=p('<ul class="svelte-14o91c5"><li class="svelte-14o91c5"><strong>Level:</strong> </li> <li class="svelte-14o91c5"><strong>Casting Time:</strong> </li> <li class="svelte-14o91c5"><strong>Range:</strong> </li> <li class="svelte-14o91c5"><strong>Components:</strong> <!></li> <li class="svelte-14o91c5"><strong>Duration:</strong> <!> </li> <li class="svelte-14o91c5"><strong>Description:</strong> </li> <!></ul>'),dl=p('<span class="scaled-damage svelte-14o91c5" style="margin-left: 8px;"> </span>'),ul=p('<span class="scaled-damage svelte-14o91c5">(Half damage)</span>'),pl=p('<span class="scaled-damage svelte-14o91c5">(No damage)</span>'),fl=p('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> <!> <!></label></div>'),gl=p("<option> </option>"),ml=p('<span class="scaled-damage svelte-14o91c5"><!> </span>'),hl=p('<span class="scaled-damage svelte-14o91c5"> </span>'),bl=p('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> Target is Fiend or Undead <!></label></div>'),_l=p('<div class="spell-level-selector svelte-14o91c5"><label class="svelte-14o91c5">Cast at Level:</label> <select class="spell-level-select use-enabled svelte-14o91c5"></select> <!></div> <!>',1),yl=p('<div class="spell-level-selector svelte-14o91c5"><span style="color: #dc3545; font-weight: bold;">No spell slots available!</span></div>'),kl=p('<div class="spell-info svelte-14o91c5"><div class="spell-info-header svelte-14o91c5" role="button" tabindex="0"><h4 class="svelte-14o91c5">Spell Info</h4> <button class="collapse-btn-small svelte-14o91c5"> </button></div> <!></div> <!> <!>',1),Sl=p('<div class="spell-info-missing svelte-14o91c5">Spell info not found.</div>'),xl=p('<div class="attack-notes svelte-14o91c5"><label class="svelte-14o91c5">Notes</label> <textarea placeholder="e.g., DC 15 Dex save, Range 120 ft, Concentration" class="notes-input svelte-14o91c5" rows="2"></textarea></div>'),$l=p('<button class="btn btn-primary">Roll Attack</button>'),Cl=p('<div class="buff-target-selection svelte-14o91c5"><div class="target-options svelte-14o91c5"><label class="target-option svelte-14o91c5"><input type="radio" class="svelte-14o91c5"/> Self</label> <label class="target-option svelte-14o91c5"><input type="radio" class="svelte-14o91c5"/> Other</label></div> <button class="btn btn-info"> </button></div>'),Ll=p('<button class="btn btn-info">Cast Spell</button>'),wl=p("<button><!></button>"),Dl=p('<button class="btn btn-primary">Roll Attack</button> <button class="btn btn-secondary">Roll Damage</button>',1),jl=p('<div class="attack-card svelte-14o91c5"><div class="attack-header svelte-14o91c5"><!> <!></div> <div class="attack-details svelte-14o91c5"><!> <!> <div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Type</label> <input type="text" placeholder="e.g., slashing" class="attack-type svelte-14o91c5"/></div></div> <!> <!> <div class="attack-actions svelte-14o91c5"><!></div></div>'),Bl=p('<p class="no-attacks svelte-14o91c5">No attacks added yet. Click "Add Attack" to create one.</p>'),Al=p('<p class="no-attacks svelte-14o91c5">No attacks match your search.</p>'),Fl=p('<button class="btn-remove svelte-14o91c5">Ã—</button>'),Ml=p('<div class="state-card svelte-14o91c5"><div class="state-header svelte-14o91c5"><input type="text" placeholder="Effect name (e.g., Magic Weapon)" class="state-name svelte-14o91c5"/> <!></div> <div class="state-details svelte-14o91c5"><div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Attack Bonus</label> <input type="number" class="state-bonus svelte-14o91c5"/></div> <div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Damage Bonus</label> <input type="text" class="state-bonus svelte-14o91c5"/></div> <div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Target</label> <select class="state-bonus svelte-14o91c5"><option>Self</option><option>Other</option></select></div></div> <div class="state-description svelte-14o91c5"><label class="svelte-14o91c5">Description</label> <input type="text" placeholder="e.g., +1 to attack and damage rolls (Magic Weapon)" class="state-desc-input svelte-14o91c5"/></div></div>'),Il=p('<div class="states-list svelte-14o91c5"></div>'),Rl=p('<p class="no-states svelte-14o91c5">No active effects. Add spell effects that modify your attacks.</p>'),Pl=p('<!> <div class="attacks-list svelte-14o91c5"><!> <!></div> <div class="active-states-section svelte-14o91c5"><h3 class="svelte-14o91c5">Active Spell Effects</h3> <p class="section-description svelte-14o91c5">Effects that modify attack and damage rolls (e.g., Magic Weapon, Bless)</p> <button class="btn btn-secondary">Add Effect</button> <!></div>',1),Tl=p("<section><!> <!></section>");function El(a,i){Tt(i,!1);const t=()=>Ze(se,"$character",w),d=()=>Ze(ga,"$abilityModifiers",w),u=()=>Ze(Zt,"$searchFilter",w),g=()=>Ze(Mt,"$collapsedStates",w),h=()=>Ze(na,"$isEditMode",w),[w,k]=qt(),S=F(),X=F(),W=[],le=sa();let re=F({}),J=F({});function ue(f){aa(re,e(re)[f]=!e(re)[f]),c(re,{...e(re)})}function pe(f){return f.description.toLowerCase().includes("regain")&&(f.description.toLowerCase().includes("hit point")||f.description.toLowerCase().includes("hp"))}function Q(f){return["Shield of Faith","Bless","Aid","Magic Weapon"].includes(f)}function ze(){se.update(f=>(f.attacks=[...f.attacks,{id:crypto.randomUUID(),name:"",bonus:0,damage:"",damageType:"",notes:""}],f))}function Qe(f){se.update(C=>(C.attacks=C.attacks.filter(G=>G.id!==f),C))}function z(f){let C=f.damage,G=!1,oe=!1;if(f.spellRef){const _e=De(f.spellRef);if(_e&&(oe=wa(_e),_e.level>0)){const Oe=f.castAtLevel||_e.level;if(!Re(Oe)){Gt.add(`No level ${Oe} spell slots available!`,"error");return}const $=ba(_e);$&&f.targetSucceededSave&&$.noDamageOnSave?C="0":(G=$?.halfDamageOnSave&&f.targetSucceededSave||!1,C=ke(f,_e))}}else if(t().activeStates&&t().activeStates.length>0){let _e=0,Oe=[];for(const A of t().activeStates)A.target!=="other"&&(typeof A.damageBonus=="string"?Oe.push(A.damageBonus):typeof A.damageBonus=="number"&&(_e+=A.damageBonus));if((_e!==0||Oe.length>0)&&C){const A=C.match(/(\d+d\d+)([+-]\d+)?/);if(A){const[,$,ae]=A,O=(ae?parseInt(ae):0)+_e;let v=`${$}`;O!==0&&(v+=`${O>=0?"+":""}${O}`),Oe.length>0&&(v+=" + "+Oe.join(" + ")),C=v}}}const N=[];let be=0;if(oe){const _e=Wa(t(),d()),Oe=t().proficiencyBonus||0;N.push({value:Oe,source:"proficiency"}),N.push({value:_e,source:"spellcasting"}),be=Oe+_e}else f.bonus!==0&&N.push({value:f.bonus,source:"base"}),be=f.bonus;let Ve=[];if(t().activeStates)for(const _e of t().activeStates)_e.target!=="other"&&(typeof _e.attackBonus=="number"&&_e.attackBonus!==0?(N.push({value:_e.attackBonus,source:_e.name.toLowerCase()}),be+=_e.attackBonus):typeof _e.attackBonus=="string"&&_e.attackBonus&&(Ve.push(_e.attackBonus),N.push({value:_e.attackBonus,source:_e.name.toLowerCase()})));let et=`1d20${be>=0?"+":""}${be}`;Ve.length>0&&(et+="+"+Ve.join("+")),le("roll",{notation:et,damageNotation:C,attackName:f.name,applyHalfDamage:G,bonusBreakdown:N,rollType:"attack"})}function Se(f){if(!f.damage){Gt.add(`${f.name}: No damage specified`,"error");return}let C=f.damage,G=!1;const oe=[];if(f.spellRef){const N=De(f.spellRef);if(N&&N.level>0){const be=f.castAtLevel||N.level;if(!Re(be)){Gt.add(`No level ${be} spell slots available!`,"error");return}const et=ba(N);et&&f.targetSucceededSave&&et.noDamageOnSave?C="0":(G=et?.halfDamageOnSave&&f.targetSucceededSave||!1,C=ke(f,N))}}else{const N=C.match(/(\d+d\d+)([+-]\d+)?/);if(N){const[,be,Ve]=N,et=Ve?parseInt(Ve):0;if(et!==0&&oe.push({value:et,source:"base"}),t().activeStates&&t().activeStates.length>0){let _e=0,Oe=[];for(const A of t().activeStates)A.target!=="other"&&(typeof A.damageBonus=="string"?Oe.push(A.damageBonus):typeof A.damageBonus=="number"&&A.damageBonus!==0&&(oe.push({value:A.damageBonus,source:A.name.toLowerCase()}),_e+=A.damageBonus));if(_e!==0||Oe.length>0){const A=et+_e;let $=`${be}`;A!==0&&($+=`${A>=0?"+":""}${A}`),Oe.length>0&&($+=" + "+Oe.join(" + ")),C=$}}}}le("roll",{notation:C,attackName:f.name,applyHalfDamage:G,bonusBreakdown:oe})}let Z=F([]),me=F(!1);pa(async()=>{c(Z,await ss()),c(me,!0)});function De(f){return e(Z).find(C=>C.name===f)}function Re(f){t().classFeatures.spellSlotsByLevel||bt(se,n(t).classFeatures.spellSlotsByLevel={},n(t)),t().classFeatures.spellSlotsByLevel[f]||bt(se,n(t).classFeatures.spellSlotsByLevel[f]=Array(2).fill(!1),n(t));const G=t().classFeatures.spellSlotsByLevel[f].findIndex(oe=>!oe);return G===-1?!1:(se.update(oe=>(oe.classFeatures.spellSlotsByLevel||(oe.classFeatures.spellSlotsByLevel={}),oe.classFeatures.spellSlotsByLevel[f]||(oe.classFeatures.spellSlotsByLevel[f]=Array(2).fill(!1)),oe.classFeatures.spellSlotsByLevel[f][G]=!0,oe)),!0)}function ke(f,C){let G=f.damage,oe=0,N=0;if(el(C)&&(N+=Wa(t(),d())),t().activeStates)for(const ee of t().activeStates)ee.target!=="other"&&typeof ee.damageBonus=="number"&&(N+=ee.damageBonus);if(C.higherLevelSlot&&f.castAtLevel){const ee=C.level,v=(f.castAtLevel||ee)-ee;if(v>0){const qe=C.higherLevelSlot.match(/(\d+)d(\d+)\s+for\s+each.*?level\s+above/i);if(qe){const[,ce]=qe;oe+=v*parseInt(ce)}}}if(f.targetIsFiendOrUndead&&C.description.includes("Fiend or an Undead")){const ee=C.description.match(/increases by (\d+)d(\d+) if.*?Fiend or.*?Undead/i);if(ee){const[,O]=ee;oe+=parseInt(O)}}const be=G.match(/(\d+)d(\d+)([+-]\d+)?/);if(!be)return N!==0?N>=0?`${N}`:`${N}`:G||"0";const[,Ve,et,_e]=be,Oe=parseInt(Ve)+oe,$=(_e?parseInt(_e):0)+N;let ae=`${Oe}d${et}`;return $!==0&&(ae+=$>=0?`+${$}`:`${$}`),ae}function Pe(f){const C=[];for(let oe=f.level;oe<=9;oe++){const N=t().classFeatures.spellSlotsByLevel?.[oe];N&&N.length>0&&C.push(oe)}return C}function D(){se.update(f=>(f.activeStates||(f.activeStates=[]),f.activeStates=[...f.activeStates,{name:"",attackBonus:0,damageBonus:0,description:"",target:"self"}],f))}function ge(f){se.update(C=>{if(C.activeStates){const G=C.activeStates[f];G?.hpBonus&&G.target!=="other"&&(C.maxHP-=G.hpBonus,C.currentHP=Math.max(1,Math.min(C.currentHP-G.hpBonus,C.maxHP))),C.activeStates=C.activeStates.filter((oe,N)=>N!==f)}return C})}function b(f,C="self"){const G=De(f.spellRef);if(!G){Gt.add("Spell not found","error");return}const oe=f.castAtLevel||G.level;if(oe>0&&!Re(oe)){Gt.add(`No level ${oe} spell slots available!`,"error");return}const N=tl(G);if(!N){Gt.add(`${G.name} cast! Check spell description for effects.`,"info");return}let be=N.hpBonus||0,Ve=N.description;G.name==="Aid"&&oe>G.level&&(be=5+(oe-G.level)*5,Ve=`+${be} HP (max and current) for 8 hours`);const _e=["Shield of Faith","Bless","Aid","Magic Weapon"].includes(G.name);se.update(A=>{A.activeStates||(A.activeStates=[]);const $=A.activeStates.find(ae=>ae.name===G.name);return $&&$.hpBonus&&$.target!=="other"&&(A.maxHP-=$.hpBonus,A.currentHP=Math.max(1,Math.min(A.currentHP-$.hpBonus,A.maxHP))),A.activeStates=A.activeStates.filter(ae=>ae.name!==G.name),be>0&&C==="self"&&(A.maxHP+=be,A.currentHP+=be),A.activeStates=[...A.activeStates,{name:G.name,attackBonus:N.attackBonus,damageBonus:N.damageBonus,acBonus:N.acBonus,description:Ve,target:C,hpBonus:be}],A});const Oe=C==="self"?" on self":" on other";Gt.add(`${G.name} cast${_e?Oe:""}! Effect added to Active Spell Effects.`,"success")}Xe(()=>(t(),e(re),e(J)),()=>{if(t()&&t().attacks)for(const f of t().attacks)f.spellRef&&e(re)[f.id]===void 0&&aa(re,e(re)[f.id]=!0),f.spellRef&&e(J)[f.id]===void 0&&aa(J,e(J)[f.id]="self")}),Xe(()=>(t(),u()),()=>{c(S,t().attacks.filter(f=>{if(!u())return!0;const C=u().toLowerCase();return f.name.toLowerCase().includes(C)||f.damageType.toLowerCase().includes(C)}).sort((f,C)=>!f.spellRef&&C.spellRef?-1:f.spellRef&&!C.spellRef?1:0))}),Xe(()=>(u(),e(S)),()=>{c(X,!u()||e(S).length>0||"attack".includes(u().toLowerCase())||"spell".includes(u().toLowerCase()))}),Jt(),Pt();var P=Tl();let Y;var Ke=r(P);{let f=dt(()=>(g(),n(()=>g().attacks?"Expand":"Collapse")));la(Ke,{title:"Attacks & Spells",get collapsed(){return g(),n(()=>g().attacks)},get ariaLabel(){return e(f)},onToggle:()=>Mt.update(C=>({...C,attacks:!C.attacks}))})}var Ge=s(Ke,2);{var Ae=f=>{var C=Pl(),G=Ee(C);{var oe=O=>{var v=al();I("click",v,ze),o(O,v)};y(G,O=>{h()&&O(oe)})}var N=s(G,2),be=r(N);kt(be,1,()=>e(S),O=>O.id,(O,v,qe)=>{var ce=jl(),ne=r(ce),j=r(ne);{var H=B=>{var T=sl();we(T),He(T,()=>e(v).name,K=>(e(v).name=K,Lt(()=>(e(S),t(),u())))),o(B,T)},V=B=>{var T=ll(),K=r(T,!0);l(T),M(()=>L(K,(e(v),n(()=>e(v).name||"(Unnamed Attack)")))),o(B,T)};y(j,B=>{h()?B(H):B(V,!1)})}var Fe=s(j,2);{var lt=B=>{var T=rl();I("click",T,()=>Qe(e(v).id)),o(B,T)};y(Fe,B=>{h()&&B(lt)})}l(ne);var je=s(ne,2),ye=r(je);{var xe=B=>{var T=nl(),K=r(T),Le=s(K,2);we(Le),l(T),M(()=>{We(K,"for",`attack-bonus-${e(v),n(()=>e(v).id)??""}`),We(Le,"id",`attack-bonus-${e(v),n(()=>e(v).id)??""}`)}),He(Le,()=>e(v).bonus,Ie=>(e(v).bonus=Ie,Lt(()=>(e(S),t(),u())))),o(B,T)};y(ye,B=>{e(v),n(()=>e(v).bonus!==0&&e(v).bonus!==void 0)&&B(xe)})}var Me=s(ye,2);{var Te=B=>{var T=il(),K=r(T),Le=s(K,2);we(Le),l(T),M(()=>{We(K,"for",`attack-damage-${e(v),n(()=>e(v).id)??""}`),We(Le,"id",`attack-damage-${e(v),n(()=>e(v).id)??""}`)}),He(Le,()=>e(v).damage,Ie=>(e(v).damage=Ie,Lt(()=>(e(S),t(),u())))),o(B,T)};y(Me,B=>{e(v),n(()=>e(v).damage&&e(v).damage.trim()!=="")&&B(Te)})}var Je=s(Me,2),ie=r(Je),he=s(ie,2);we(he),l(Je),l(je);var Ue=s(je,2);{var Ye=B=>{var T=vt(),K=Ee(T);{var Le=it=>{var q=ol();o(it,q)},Ie=it=>{const q=dt(()=>(e(v),n(()=>De(e(v).spellRef))));var pt=vt(),wt=Ee(pt);{var x=m=>{const Ne=dt(()=>(E(ba),E(e(q)),n(()=>ba(e(q)))));var de=kl(),$e=Ee(de),Ce=r($e),at=s(r(Ce),2),tt=r(at,!0);l(at),l(Ce);var ut=s(Ce,2);{var ot=st=>{var ft=vl(),gt=r(ft),It=s(r(gt));l(gt);var Ht=s(gt,2),Ut=s(r(Ht));l(Ht);var _t=s(Ht,2),Dt=s(r(_t));l(_t);var Bt=s(_t,2),Kt=s(r(Bt)),mt=s(Kt);{var Nt=$t=>{var Ct=Ft();M(()=>L(Ct,`(${E(e(q)),n(()=>e(q).material)??""})`)),o($t,Ct)};y(mt,$t=>{E(e(q)),n(()=>e(q).material)&&$t(Nt)})}l(Bt);var Vt=s(Bt,2),Qt=s(r(Vt),2);{var ea=$t=>{var Ct=Ft("Concentration,");o($t,Ct)};y(Qt,$t=>{E(e(q)),n(()=>e(q).concentration)&&$t(ea)})}var jt=s(Qt,1,!0);l(Vt);var Rt=s(Vt,2),At=s(r(Rt));l(Rt);var Wt=s(Rt,2);{var Yt=$t=>{var Ct=cl(),zt=s(r(Ct));l(Ct),M(()=>L(zt,` ${E(e(q)),n(()=>e(q).higherLevelSlot)??""}`)),o($t,Ct)};y(Wt,$t=>{E(e(q)),n(()=>e(q).higherLevelSlot)&&$t(Yt)})}l(ft),M($t=>{L(It,` ${E(e(q)),n(()=>e(q).level)??""}`),L(Ut,` ${E(e(q)),n(()=>e(q).castingTime||e(q).actionType)??""}`),L(Dt,` ${E(e(q)),n(()=>e(q).range)??""}`),L(Kt,` ${$t??""}`),L(jt,(E(e(q)),n(()=>e(q).duration))),L(At,` ${E(e(q)),n(()=>e(q).description)??""}`)},[()=>(E(e(q)),n(()=>e(q).components.join(", ")))]),o(st,ft)};y(ut,st=>{e(re),e(v),n(()=>!e(re)[e(v).id])&&st(ot)})}l($e);var rt=s($e,2);{var nt=st=>{var ft=fl(),gt=r(ft),It=r(gt);we(It);var Ht=s(It),Ut=s(Ht);{var _t=mt=>{var Nt=dl(),Vt=r(Nt);l(Nt),M(Qt=>L(Vt,`(Spell Save DC: ${Qt??""})`),[()=>(E(Ia),t(),d(),n(()=>Ia(t(),d())))]),o(mt,Nt)};y(Ut,mt=>{t(),n(()=>t().class)&&mt(_t)})}var Dt=s(Ut,2);{var Bt=mt=>{var Nt=ul();o(mt,Nt)},Kt=mt=>{var Nt=vt(),Vt=Ee(Nt);{var Qt=ea=>{var jt=pl();o(ea,jt)};y(Vt,ea=>{e(v),E(e(Ne)),n(()=>e(v).targetSucceededSave&&e(Ne).noDamageOnSave)&&ea(Qt)},!0)}o(mt,Nt)};y(Dt,mt=>{e(v),E(e(Ne)),n(()=>e(v).targetSucceededSave&&e(Ne).halfDamageOnSave)?mt(Bt):mt(Kt,!1)})}l(gt),l(ft),M(mt=>L(Ht,` Target succeeded on ${mt??""} save `),[()=>(E(e(Ne)),n(()=>e(Ne).ability.charAt(0).toUpperCase()+e(Ne).ability.slice(1)))]),Fa(It,()=>e(v).targetSucceededSave,mt=>(e(v).targetSucceededSave=mt,Lt(()=>(e(S),t(),u())))),o(st,ft)};y(rt,st=>{e(Ne)&&st(nt)})}var ht=s(rt,2);{var ct=st=>{const ft=dt(()=>(E(e(q)),n(()=>Pe(e(q)))));var gt=vt(),It=Ee(gt);{var Ht=_t=>{var Dt=_l(),Bt=Ee(Dt),Kt=r(Bt),mt=s(Kt,2);M(()=>{e(v),Lt(()=>{e(ft)})}),kt(mt,5,()=>e(ft),xt,(jt,Rt)=>{var At=gl(),Wt=r(At);l(At);var Yt={};M(()=>{L(Wt,`Level ${e(Rt)??""}`),Yt!==(Yt=e(Rt))&&(At.value=(At.__value=e(Rt))??"")}),o(jt,At)}),l(mt);var Nt=s(mt,2);{var Vt=jt=>{const Rt=dt(()=>(e(v),E(e(q)),n(()=>ke(e(v),e(q)))));var At=ml(),Wt=r(At);{var Yt=zt=>{var ta=Ft("Healing");o(zt,ta)},$t=zt=>{var ta=Ft("Damage");o(zt,ta)};y(Wt,zt=>{E(e(q)),n(()=>pe(e(q)))?zt(Yt):zt($t,!1)})}var Ct=s(Wt);l(At),M(()=>L(Ct,` ${e(Rt)??""}`)),o(jt,At)};y(Nt,jt=>{e(v),E(e(q)),n(()=>e(v).castAtLevel&&e(v).castAtLevel>e(q).level)&&jt(Vt)})}l(Bt);var Qt=s(Bt,2);{var ea=jt=>{var Rt=bl(),At=r(Rt),Wt=r(At);we(Wt);var Yt=s(Wt,2);{var $t=Ct=>{const zt=dt(()=>(e(v),E(e(q)),n(()=>ke(e(v),e(q)))));var ta=hl(),ls=r(ta);l(ta),M(()=>L(ls,`(+1d8, total: ${e(zt)??""})`)),o(Ct,ta)};y(Yt,Ct=>{e(v),n(()=>e(v).targetIsFiendOrUndead)&&Ct($t)})}l(At),l(Rt),Fa(Wt,()=>e(v).targetIsFiendOrUndead,Ct=>(e(v).targetIsFiendOrUndead=Ct,Lt(()=>(e(S),t(),u())))),o(jt,Rt)};y(Qt,jt=>{E(e(q)),n(()=>e(q).description.includes("Fiend or an Undead"))&&jt(ea)})}M(()=>{We(Kt,"for",`castLevel-${e(v),n(()=>e(v).id)??""}`),We(mt,"id",`castLevel-${e(v),n(()=>e(v).id)??""}`)}),Aa(mt,()=>e(v).castAtLevel,jt=>(e(v).castAtLevel=jt,Lt(()=>(e(S),t(),u())))),o(_t,Dt)},Ut=_t=>{var Dt=yl();o(_t,Dt)};y(It,_t=>{E(e(ft)),n(()=>e(ft).length>0)?_t(Ht):_t(Ut,!1)})}o(st,gt)};y(ht,st=>{E(e(q)),n(()=>e(q).higherLevelSlot&&e(q).level>0)&&st(ct)})}M(()=>{We(at,"aria-label",(e(re),e(v),n(()=>e(re)[e(v).id]?"Expand":"Collapse"))),L(tt,(e(re),e(v),n(()=>e(re)[e(v).id]?"â–¼":"â–²")))}),I("click",Ce,()=>ue(e(v).id)),I("keydown",Ce,st=>st.key==="Enter"&&ue(e(v).id)),o(m,de)},R=m=>{var Ne=Sl();o(m,Ne)};y(wt,m=>{e(q)?m(x):m(R,!1)})}o(it,pt)};y(K,it=>{e(Z),n(()=>e(Z).length===0)?it(Le):it(Ie,!1)})}o(B,T)};y(Ue,B=>{e(v),n(()=>e(v).spellRef)&&B(Ye)})}var Be=s(Ue,2);{var _=B=>{var T=xl(),K=r(T),Le=s(K,2);da(Le),l(T),M(()=>{We(K,"for",`attack-notes-${e(v),n(()=>e(v).id)??""}`),We(Le,"id",`attack-notes-${e(v),n(()=>e(v).id)??""}`)}),He(Le,()=>e(v).notes,Ie=>(e(v).notes=Ie,Lt(()=>(e(S),t(),u())))),o(B,T)};y(Be,B=>{e(v),n(()=>!e(v).spellRef)&&B(_)})}var U=s(Be,2),ve=r(U);{var te=B=>{const T=dt(()=>(e(v),n(()=>De(e(v).spellRef))));var K=vt(),Le=Ee(K);{var Ie=it=>{var q=vt(),pt=Ee(q);{var wt=R=>{var m=$l();I("click",m,()=>z(e(v))),o(R,m)},x=R=>{var m=vt(),Ne=Ee(m);{var de=Ce=>{var at=vt(),tt=Ee(at);{var ut=rt=>{var nt=Cl(),ht=r(nt),ct=r(ht),st=r(ct);we(st),st.value=st.__value="self",ra(),l(ct);var ft=s(ct,2),gt=r(ft);we(gt),gt.value=gt.__value="other",ra(),l(ft),l(ht);var It=s(ht,2),Ht=r(It);l(It),l(nt),M(()=>{We(st,"name",`target-${e(v),n(()=>e(v).id)??""}`),We(gt,"name",`target-${e(v),n(()=>e(v).id)??""}`),L(Ht,`Cast ${E(e(T)),n(()=>e(T).name)??""}`)}),Ua(W,[qe],st,()=>e(J)[e(v).id],Ut=>aa(J,e(J)[e(v).id]=Ut)),Ua(W,[qe],gt,()=>e(J)[e(v).id],Ut=>aa(J,e(J)[e(v).id]=Ut)),I("click",It,()=>b(e(v),e(J)[e(v).id])),o(rt,nt)},ot=rt=>{var nt=Ll();I("click",nt,()=>b(e(v),"self")),o(rt,nt)};y(tt,rt=>{E(e(T)),n(()=>Q(e(T).name))?rt(ut):rt(ot,!1)})}o(Ce,at)},$e=Ce=>{var at=wl(),tt=r(at);{var ut=rt=>{var nt=Ft("Roll Healing");o(rt,nt)},ot=rt=>{var nt=Ft("Roll Damage");o(rt,nt)};y(tt,rt=>{E(e(T)),n(()=>pe(e(T)))?rt(ut):rt(ot,!1)})}l(at),M(rt=>yt(at,1,`btn ${rt??""}`),[()=>(E(e(T)),n(()=>pe(e(T))?"btn-success":"btn-secondary"))]),I("click",at,()=>Se(e(v))),o(Ce,at)};y(Ne,Ce=>{E(Ka),E(e(T)),n(()=>Ka(e(T)))?Ce(de):Ce($e,!1)},!0)}o(R,m)};y(pt,R=>{E(wa),E(e(T)),n(()=>wa(e(T)))?R(wt):R(x,!1)})}o(it,q)};y(Le,it=>{e(T)&&it(Ie)})}o(B,K)},fe=B=>{var T=vt(),K=Ee(T);{var Le=Ie=>{var it=Dl(),q=Ee(it),pt=s(q,2);I("click",q,()=>z(e(v))),I("click",pt,()=>Se(e(v))),o(Ie,it)};y(K,Ie=>{e(v),n(()=>!e(v).spellRef)&&Ie(Le)},!0)}o(B,T)};y(ve,B=>{e(v),e(me),n(()=>e(v).spellRef&&e(me))?B(te):B(fe,!1)})}l(U),l(ce),M(()=>{We(ie,"for",`attack-type-${e(v),n(()=>e(v).id)??""}`),We(he,"id",`attack-type-${e(v),n(()=>e(v).id)??""}`)}),He(he,()=>e(v).damageType,B=>(e(v).damageType=B,Lt(()=>(e(S),t(),u())))),o(O,ce)});var Ve=s(be,2);{var et=O=>{var v=Bl();o(O,v)},_e=O=>{var v=vt(),qe=Ee(v);{var ce=ne=>{var j=Al();o(ne,j)};y(qe,ne=>{e(S),n(()=>e(S).length===0)&&ne(ce)},!0)}o(O,v)};y(Ve,O=>{t(),n(()=>t().attacks.length===0)?O(et):O(_e,!1)})}l(N);var Oe=s(N,2),A=s(r(Oe),4),$=s(A,2);{var ae=O=>{var v=Il();kt(v,5,()=>(t(),n(()=>t().activeStates)),xt,(qe,ce,ne)=>{var j=Ml(),H=r(j),V=r(H);we(V);var Fe=s(V,2);{var lt=fe=>{var B=Fl();I("click",B,()=>ge(ne)),o(fe,B)};y(Fe,fe=>{h()&&fe(lt)})}l(H);var je=s(H,2),ye=r(je),xe=r(ye);We(xe,"for",`state-attack-bonus-${ne}`);var Me=s(xe,2);we(Me),We(Me,"id",`state-attack-bonus-${ne}`),l(ye);var Te=s(ye,2),Je=r(Te);We(Je,"for",`state-damage-bonus-${ne}`);var ie=s(Je,2);we(ie),We(ie,"id",`state-damage-bonus-${ne}`),l(Te);var he=s(Te,2),Ue=r(he);We(Ue,"for",`state-target-${ne}`);var Ye=s(Ue,2);M(()=>{e(ce),Lt(()=>{})}),We(Ye,"id",`state-target-${ne}`);var Be=r(Ye);Be.value=Be.__value="self";var _=s(Be);_.value=_.__value="other",l(Ye),l(he),l(je);var U=s(je,2),ve=r(U);We(ve,"for",`state-desc-${ne}`);var te=s(ve,2);we(te),We(te,"id",`state-desc-${ne}`),l(U),l(j),He(V,()=>e(ce).name,fe=>(e(ce).name=fe,Lt(()=>t()),ca(w,"$character"))),He(Me,()=>e(ce).attackBonus,fe=>(e(ce).attackBonus=fe,Lt(()=>t()),ca(w,"$character"))),He(ie,()=>e(ce).damageBonus,fe=>(e(ce).damageBonus=fe,Lt(()=>t()),ca(w,"$character"))),Aa(Ye,()=>e(ce).target,fe=>(e(ce).target=fe,Lt(()=>t()),ca(w,"$character"))),He(te,()=>e(ce).description,fe=>(e(ce).description=fe,Lt(()=>t()),ca(w,"$character"))),o(qe,j)}),l(v),o(O,v)},ee=O=>{var v=Rl();o(O,v)};y($,O=>{t(),n(()=>t().activeStates&&t().activeStates.length>0)?O(ae):O(ee,!1)})}l(Oe),I("click",A,D),o(f,C)};y(Ge,f=>{g(),n(()=>!g().attacks)&&f(Ae)})}l(P),M(()=>Y=yt(P,1,"attacks svelte-14o91c5",null,Y,{hidden:!e(X)})),o(a,P),Et(),k()}var Hl=p('<span class="slot-checkbox-x svelte-serp1j">&#8212;</span>'),Ul=p('<label><input type="checkbox" class="slot-checkbox-input svelte-serp1j"/> <span><!></span></label>');function Va(a,i){Tt(i,!1);const t=()=>Ze(na,"$isEditMode",d),[d,u]=qt();let g=St(i,"checked",8,!1),h=St(i,"disabled",8,!1),w=St(i,"className",8,""),k=St(i,"index",8,void 0),S=St(i,"ariaLabel",8,void 0);const X=sa();function W(Q){X("change",{checked:Q.currentTarget.checked,index:k()})}Pt();var le=Ul(),re=r(le);we(re);var J=s(re,2),ue=r(J);{var pe=Q=>{var ze=Hl();o(Q,ze)};y(ue,Q=>{g()&&Q(pe)})}l(J),l(le),M(()=>{yt(le,1,"slot-checkbox-label "+w()+(t()?"":" not-editable"),"svelte-serp1j"),ts(re,g()),re.disabled=h()||!t(),We(re,"aria-label",S()),We(re,"tabindex",t()?0:-1),yt(J,1,`slot-checkbox-custom ${g()?"used":""} ${t()?"":"readonly"}`,"svelte-serp1j")}),I("change",re,W),o(a,le),Et(),u()}var Nl=p('<p class="no-features svelte-1kpvv0n">Select a class to see available features</p>'),Gl=p('<p class="no-features svelte-1kpvv0n">No class features available at this level</p>'),Ol=p('<div class="spell-slots svelte-1kpvv0n"><label class="svelte-1kpvv0n"> </label> <div class="slots-tracker svelte-1kpvv0n"></div></div>'),ql=p('<div class="all-spell-slots"></div>'),Wl=p('<div class="feature-box spellcasting svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"> </h3> <div class="spell-stats svelte-1kpvv0n"><div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Spell Save DC</label> <div class="spell-value svelte-1kpvv0n"> </div></div> <div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <div class="spell-value svelte-1kpvv0n"> </div></div></div> <!> <div class="prepared-spells svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <textarea placeholder="List your prepared spells..." class="svelte-1kpvv0n"></textarea></div></div>'),zl=p('<p class="unlimited svelte-1kpvv0n">Unlimited Uses</p>'),Kl=p('<div class="slots-tracker svelte-1kpvv0n"></div> <div class="uses-actions-row"><button class="btn btn-primary use-enabled"> </button></div> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div>',1),Vl=p('<div class="uses-tracker svelte-1kpvv0n"><!></div>'),Jl=p('<div class="pool-tracker svelte-1kpvv0n"><input type="number" min="0" class="pool-input svelte-1kpvv0n"/> <span> </span> <button class="btn-small svelte-1kpvv0n"> </button></div>'),Ql=p('<p class="no-uses svelte-1kpvv0n">No Channel Divinity uses remaining</p>'),Yl=p('<div class="channel-divinity-option svelte-1kpvv0n"><button class="btn btn-primary use-enabled svelte-1kpvv0n">Use Channel Divinity</button> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div> <!></div>'),Xl=p('<div class="feature-box svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"><!> </h3> <p class="feature-description svelte-1kpvv0n"> </p> <!></div>'),Zl=p('<div class="features-grid svelte-1kpvv0n"><!> <!></div>'),er=p("<section><!> <!></section>");function tr(a,i){Tt(i,!1);const t=()=>Ze(se,"$character",h),d=()=>Ze(ga,"$abilityModifiers",h),u=()=>Ze(Zt,"$searchFilter",h),g=()=>Ze(Mt,"$collapsedStates",h),[h,w]=qt(),k=F(),S=F(),X=F(),W=F(),le=F(),re=F(),J=F();let ue=F(0),pe=F(0);function Q(b,P){se.update(Y=>(Y.classFeatures.features[b]=P,Y))}function ze(){se.update(b=>(b.classFeatures.spellSlotsByLevel||(b.classFeatures.spellSlotsByLevel={}),e(W).forEach(({level:P,slots:Y})=>{b.classFeatures.spellSlotsByLevel[P]||(b.classFeatures.spellSlotsByLevel[P]=Array(Y).fill(!1))}),b))}function Qe(b){if(typeof b.maxUses=="function"){if((b.name==="Divine Sense"||b.name==="War Priest")&&e(k)?.spellcastingAbility){const P=d()[e(k).spellcastingAbility];return b.maxUses(t().level,P)}return b.maxUses(t().level)}return b.maxUses||0}function z(b,P){se.update(Y=>((!Y.classFeatures.features[b]||!Array.isArray(Y.classFeatures.features[b])||Y.classFeatures.features[b].length!==P)&&(Y.classFeatures.features[b]=Array(P).fill(!1)),Y))}rs(()=>{e(re)&&t()&&t().classFeatures&&t().classFeatures.features&&e(re).forEach(b=>{if(b.type==="uses"){const P=b.name.replace(/\s+/g,""),Y=Qe(b),Ke=t().classFeatures.features[P];(!Array.isArray(Ke)||Ke.length!==Y)&&z(P,Y)}})});function Se(b){return typeof b.maxPool=="function"?b.maxPool(t().level):b.maxPool||0}function Z(b){return typeof b.description=="function"?b.description(t().level):b.description}function me(){const b="ChannelDivinity";se.update(P=>{const Y=P.classFeatures.features[b];return typeof Y=="number"&&Y>0&&(P.classFeatures.features[b]=Y-1),P})}function De(){Mt.update(b=>({...b,classFeatures:!b.classFeatures}))}Xe(()=>(t(),Ot),()=>{c(k,t().class?Ot(t().class):null)}),Xe(()=>(t(),oa),()=>{c(S,t().class?oa(t().class,t().level,t().subclass):[])}),Xe(()=>(t(),Oa),()=>{c(X,t().class?Oa(t().class,t().level):0)}),Xe(()=>(e(k),t()),()=>{c(W,(()=>{if(!e(k)?.spellcaster)return[];const b=t().level,P=[];return b>=1&&P.push({level:1,slots:Math.min(4,2+Math.floor(b/3))}),b>=3&&P.push({level:2,slots:Math.min(3,2+Math.floor((b-3)/4))}),b>=5&&P.push({level:3,slots:Math.min(3,2+Math.floor((b-5)/5))}),b>=7&&P.push({level:4,slots:Math.min(3,1+Math.floor((b-7)/6))}),b>=9&&P.push({level:5,slots:Math.min(2,1+Math.floor((b-9)/8))}),b>=11&&P.push({level:6,slots:1}),b>=13&&P.push({level:7,slots:1}),b>=15&&P.push({level:8,slots:1}),b>=17&&P.push({level:9,slots:1}),P})())}),Xe(()=>(e(k),d(),t(),qa),()=>{if(e(k)?.spellcaster&&e(k).spellcastingAbility){const b=d()[e(k).spellcastingAbility];c(ue,ws(t().class,b,t().proficiencyBonus)||0),c(pe,qa(t().class,t().level,b))}}),Xe(()=>(t(),e(k),e(W)),()=>{t().class&&e(k)?.spellcaster&&e(W).length>0&&ze()}),Xe(()=>t(),()=>{c(le,(()=>{const P=t().classFeatures.features["ChannelDivinity"];return typeof P=="number"?P:0})())}),Xe(()=>(e(S),u()),()=>{c(re,e(S).filter(b=>{if(!u())return!0;const P=u().toLowerCase();return b.name.toLowerCase().includes(P)||Z(b).toLowerCase().includes(P)}))}),Xe(()=>(u(),t(),e(re)),()=>{c(J,!u()||t().class||"class features".includes(u().toLowerCase())||"spellcasting".includes(u().toLowerCase())||e(re).length>0)}),Jt(),Pt();var Re=er();let ke;var Pe=r(Re);{let b=dt(()=>(g(),n(()=>g().classFeatures?"Expand":"Collapse")));la(Pe,{title:"Class Features",get collapsed(){return g(),n(()=>g().classFeatures)},get ariaLabel(){return e(b)},onToggle:De})}var D=s(Pe,2);{var ge=b=>{var P=vt(),Y=Ee(P);{var Ke=Ae=>{var f=Nl();o(Ae,f)},Ge=Ae=>{var f=vt(),C=Ee(f);{var G=N=>{var be=Gl();o(N,be)},oe=N=>{var be=Zl(),Ve=r(be);{var et=Oe=>{var A=Wl(),$=r(A),ae=r($);l($);var ee=s($,2),O=r(ee),v=s(r(O),2),qe=r(v,!0);l(v),l(O);var ce=s(O,2),ne=s(r(ce),2),j=r(ne,!0);l(ne),l(ce),l(ee);var H=s(ee,2);{var V=je=>{var ye=ql();kt(ye,5,()=>e(W),xt,(xe,Me)=>{let Te=()=>e(Me).level,Je=()=>e(Me).slots;const ie=dt(()=>(t(),Te(),Je(),n(()=>t().classFeatures.spellSlotsByLevel?.[Te()]||Array(Je()).fill(!1))));var he=Ol(),Ue=r(he),Ye=r(Ue);l(Ue);var Be=s(Ue,2);kt(Be,5,()=>e(ie),xt,(_,U,ve)=>{{let te=dt(()=>(E(e(ie)),n(()=>e(ie)[ve]||!1)));Va(_,{get checked(){return e(te)},$$events:{change:fe=>{se.update(B=>(B.classFeatures.spellSlotsByLevel||(B.classFeatures.spellSlotsByLevel={}),B.classFeatures.spellSlotsByLevel[Te()]||(B.classFeatures.spellSlotsByLevel[Te()]=Array(Je()).fill(!1)),B.classFeatures.spellSlotsByLevel[Te()][ve]=fe.detail.checked,B))}}})}}),l(Be),l(he),M(()=>L(Ye,`${Te()===1?"1st":Te()===2?"2nd":Te()===3?"3rd":`${Te()}th`} Level Spell Slots`)),o(xe,he)}),l(ye),o(je,ye)};y(H,je=>{e(W),n(()=>e(W).length>0)&&je(V)})}var Fe=s(H,2),lt=s(r(Fe),2);da(lt),l(Fe),l(A),M(je=>{L(ae,`Spellcasting (${je??""})`),L(qe,e(ue)),L(j,e(pe))},[()=>(e(k),n(()=>e(k).spellcastingAbility?.toUpperCase()))]),He(lt,()=>t().classFeatures.preparedSpells,je=>bt(se,n(t).classFeatures.preparedSpells=je,n(t))),o(Oe,A)};y(Ve,Oe=>{e(k),n(()=>e(k)?.spellcaster)&&Oe(et)})}var _e=s(Ve,2);kt(_e,1,()=>e(re),xt,(Oe,A)=>{const $=dt(()=>(e(A),n(()=>e(A).name.replace(/\s+/g,"")))),ae=dt(()=>(t(),E(e($)),n(()=>t().classFeatures.features[e($)]))),ee=dt(()=>typeof e(ae)=="number");var O=Xl(),v=r(O),qe=r(v);{var ce=je=>{var ye=Ft("Channel Divinity:");o(je,ye)};y(qe,je=>{e(A),n(()=>e(A).type==="channelDivinity")&&je(ce)})}var ne=s(qe);l(v);var j=s(v,2),H=r(j,!0);l(j);var V=s(j,2);{var Fe=je=>{const ye=dt(()=>(e(A),n(()=>Qe(e(A))))),xe=dt(()=>(E(e(ae)),E(e(ye)),n(()=>Array.isArray(e(ae))?e(ae):Array(e(ye)).fill(!1))));var Me=Vl(),Te=r(Me);{var Je=he=>{var Ue=zl();o(he,Ue)},ie=he=>{var Ue=Kl(),Ye=Ee(Ue);kt(Ye,5,()=>e(xe),xt,(B,T,K)=>{Va(B,{get checked(){return e(T)},index:K,$$events:{change:Le=>{se.update(Ie=>(Ie.classFeatures.features[e($)]||(Ie.classFeatures.features[e($)]=Array(e(ye)).fill(!1)),Ie.classFeatures.features[e($)][K]=Le.detail.checked,Ie))}}})}),l(Ye);var Be=s(Ye,2),_=r(Be),U=r(_);l(_),l(Be);var ve=s(Be,2),te=r(ve),fe=r(te);l(te),l(ve),M(B=>{_.disabled=B,L(U,`Use ${e(A),n(()=>e(A).name)??""}`),L(fe,`Resets on ${e(A),n(()=>e(A).resetOn==="short"?"Short Rest":"Long Rest")??""}`)},[()=>(E(e(xe)),n(()=>e(xe).filter(B=>!B).length<=0))]),I("click",_,()=>{se.update(B=>{B.classFeatures.features[e($)]||(B.classFeatures.features[e($)]=Array(e(ye)).fill(!1));const T=B.classFeatures.features[e($)],K=T.findIndex(Le=>!Le);return K!==-1&&(T[K]=!0),B})}),o(he,Ue)};y(Te,he=>{e(ye)===1/0?he(Je):he(ie,!1)})}l(Me),o(je,Me)},lt=je=>{var ye=vt(),xe=Ee(ye);{var Me=Je=>{const ie=dt(()=>(e(A),n(()=>Se(e(A)))));var he=Jl(),Ue=r(he);we(Ue);var Ye=s(Ue,2),Be=r(Ye);l(Ye);var _=s(Ye,2),U=r(_,!0);l(_),l(he),M(()=>{ya(Ue,e(ee)&&e(ae)!==void 0?e(ae):e(ie)),We(Ue,"max",e(ie)),L(Be,`/ ${e(ie)??""}`),L(U,(e(A),n(()=>e(A).resetOn==="short"?"Short Rest":"Long Rest")))}),I("input",Ue,ve=>{se.update(te=>(te.classFeatures.features[e($)]=parseInt(ve.currentTarget.value)||0,te))}),I("click",_,()=>Q(e($),e(ie))),o(Je,he)},Te=Je=>{var ie=vt(),he=Ee(ie);{var Ue=Ye=>{var Be=Yl(),_=r(Be),U=s(_,2),ve=r(U),te=r(ve);l(ve),l(U);var fe=s(U,2);{var B=T=>{var K=Ql();o(T,K)};y(fe,T=>{e(le)<=0&&T(B)})}l(Be),M(()=>{_.disabled=e(le)<=0,L(te,`Resets on ${e(A),n(()=>e(A).resetOn==="short"?"Short Rest":"Long Rest")??""}`)}),I("click",_,me),o(Ye,Be)};y(he,Ye=>{e(A),n(()=>e(A).type==="channelDivinity")&&Ye(Ue)},!0)}o(Je,ie)};y(xe,Je=>{e(A),n(()=>e(A).type==="pool")?Je(Me):Je(Te,!1)},!0)}o(je,ye)};y(V,je=>{e(A),n(()=>e(A).type==="uses")?je(Fe):je(lt,!1)})}l(O),M(je=>{L(ne,` ${e(A),n(()=>e(A).name)??""}`),L(H,je)},[()=>(e(A),n(()=>Z(e(A))))]),o(Oe,O)}),l(be),o(N,be)};y(C,N=>{e(S),n(()=>e(S).length===0)?N(G):N(oe,!1)},!0)}o(Ae,f)};y(Y,Ae=>{t(),n(()=>!t().class)?Ae(Ke):Ae(Ge,!1)})}o(b,P)};y(D,b=>{g(),n(()=>!g().classFeatures)&&b(ge)})}l(Re),M(()=>ke=yt(Re,1,"class-features svelte-1kpvv0n",null,ke,{hidden:!e(J)})),o(a,Re),Et(),w()}var ar=p('<textarea placeholder="Enter features, traits, and special abilities..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Equipment</h3> <textarea placeholder="List your equipment and inventory..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Notes</h3> <textarea placeholder="Additional notes..." class="svelte-wttn0l"></textarea>',1),sr=p("<section><!> <!></section>");function lr(a,i){Tt(i,!1);const t=()=>Ze(Zt,"$searchFilter",g),d=()=>Ze(se,"$character",g),u=()=>Ze(Mt,"$collapsedStates",g),[g,h]=qt(),w=F();function k(){Mt.update(J=>({...J,notes:!J.notes}))}Xe(()=>(t(),d()),()=>{c(w,!t()||"features".includes(t().toLowerCase())||"traits".includes(t().toLowerCase())||"equipment".includes(t().toLowerCase())||"notes".includes(t().toLowerCase())||d().features.toLowerCase().includes(t().toLowerCase())||d().equipment.toLowerCase().includes(t().toLowerCase())||d().notes.toLowerCase().includes(t().toLowerCase()))}),Jt(),Pt();var S=sr();let X;var W=r(S);{let J=dt(()=>(u(),n(()=>u().notes?"Expand":"Collapse")));la(W,{title:"Features & Traits",get collapsed(){return u(),n(()=>u().notes)},get ariaLabel(){return e(J)},onToggle:k})}var le=s(W,2);{var re=J=>{var ue=ar(),pe=Ee(ue);da(pe);var Q=s(pe,4);da(Q);var ze=s(Q,4);da(ze),He(pe,()=>d().features,Qe=>bt(se,n(d).features=Qe,n(d))),He(Q,()=>d().equipment,Qe=>bt(se,n(d).equipment=Qe,n(d))),He(ze,()=>d().notes,Qe=>bt(se,n(d).notes=Qe,n(d))),o(J,ue)};y(le,J=>{u(),n(()=>!u().notes)&&J(re)})}l(S),M(()=>X=yt(S,1,"notes svelte-wttn0l",null,X,{hidden:!e(w)})),o(a,S),Et(),h()}var rr=p('<div class="color-picker-section svelte-1r90jgp"><h3 class="svelte-1r90jgp">Dice Colors</h3> <div class="color-inputs svelte-1r90jgp"><div class="color-input-group svelte-1r90jgp"><label for="dice-color" class="svelte-1r90jgp">Dice Color</label> <input type="color" id="dice-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="label-color" class="svelte-1r90jgp">Label Color</label> <input type="color" id="label-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="desk-color" class="svelte-1r90jgp">Background Color</label> <input type="color" id="desk-color" class="svelte-1r90jgp"/></div></div></div>'),nr=p('<div class="loading svelte-1r90jgp"><p class="svelte-1r90jgp">Loading 3D dice...</p></div>'),ir=p('<div class="custom-dice-selector svelte-1r90jgp"><h3 class="svelte-1r90jgp">Choose Dice to Roll</h3> <div class="dice-inputs svelte-1r90jgp"><div class="dice-input-group svelte-1r90jgp"><label for="d4" class="svelte-1r90jgp">d4</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d4" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d6" class="svelte-1r90jgp">d6</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d6" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d8" class="svelte-1r90jgp">d8</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d8" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d10" class="svelte-1r90jgp">d10</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d10" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d12" class="svelte-1r90jgp">d12</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d12" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d20" class="svelte-1r90jgp">d20</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d20" min="0" max="10"/></div></div> <div class="dice-controls svelte-1r90jgp"><button class="btn btn-primary use-enabled svelte-1r90jgp"> </button> <button class="btn btn-secondary use-enabled svelte-1r90jgp">Reset</button></div></div>'),or=p('<span class="crit-badge svelte-1r90jgp">CRITICAL HIT!</span>'),cr=p('<span class="crit-badge crit-fail svelte-1r90jgp">CRITICAL MISS!</span>'),vr=p('<div class="bonus-item svelte-1r90jgp"><span class="bonus-value svelte-1r90jgp"> </span> <span class="bonus-source svelte-1r90jgp"> </span></div>'),dr=p('<div class="bonus-breakdown svelte-1r90jgp"></div>'),ur=p('<p class="modifier-text svelte-1r90jgp"> </p>'),pr=p('<div class="svelte-1r90jgp"><em class="svelte-1r90jgp">No damage is dealt on a critical miss.</em></div>'),fr=p('<button class="btn btn-follow-up svelte-1r90jgp"> </button>'),gr=p('<button class="btn btn-guided-strike svelte-1r90jgp">âš¡ Use Guided Strike (+10)</button>'),mr=p('<div class="follow-up-actions svelte-1r90jgp"><!> <!></div>'),hr=p('<div class="result-header svelte-1r90jgp"><h3 class="svelte-1r90jgp"> </h3> <!> <!></div> <div class="result-total svelte-1r90jgp"> </div> <div class="result-details svelte-1r90jgp"><!></div> <!> <!>',1),br=p('<div role="button" tabindex="-1"><div class="modal-content svelte-1r90jgp" role="dialog" tabindex="0"><div class="modal-header svelte-1r90jgp"><h2 class="svelte-1r90jgp">Dice Roller</h2> <div class="header-buttons svelte-1r90jgp"><button class="color-btn svelte-1r90jgp" title="Customize dice colors">ðŸŽ¨</button> <button class="close-btn svelte-1r90jgp">Ã—</button></div></div> <!> <!> <div class="dice-main-area svelte-1r90jgp"><div class="dice-container svelte-1r90jgp"></div> <!></div> <div><!></div></div></div>');function _r(a,i){Tt(i,!1);const t=()=>Ze(se,"$character",d),[d,u]=qt(),g=F(),h=F(),w=F(),k=sa();let S=St(i,"notation",12,""),X=St(i,"visible",8,!1),W=St(i,"damageNotation",12,""),le=St(i,"attackName",12,""),re=St(i,"applyHalfDamage",8,!1),J=St(i,"bonusBreakdown",28,()=>[]),ue=St(i,"rollType",12,"other"),pe=null,Q=F(void 0),ze=F(!1),Qe=F(""),z=F(null);function Se(){return e(z)?.resultTotal??null}function Z(_,U,ve){const te=[];if(!_||!_.result)return te;const fe=U.match(/([+-]?\d*d\d+|[+-]?\d+)/g)||[];let B=0;const T=new Set;for(const K of fe){const Le=K.trim();if(!Le)continue;const Ie=Le.match(/([+-]?)(\d*)d(\d+)/);if(Ie){const it=parseInt(Ie[2]||"1"),q=`${it}d${Ie[3]}`,pt=ve.findIndex((R,m)=>!T.has(m)&&typeof R.value=="string"&&R.value===q),wt=[];for(let R=0;R<it&&B<_.result.length;R++)wt.push(_.result[B++]);const x=pt>=0?ve[pt].source:"base die";pt>=0&&T.add(pt);for(const R of wt)te.push({display:`${R}`,source:x})}}for(let K=0;K<ve.length;K++)if(!T.has(K)&&typeof ve[K].value=="number"){const Le=ve[K].value;te.push({display:Le>=0?`+${Le}`:`${Le}`,source:ve[K].source})}return te}let me=F(0),De=F(0),Re=F(0),ke=F(0),Pe=F(0),D=F(0),ge=F(0),b=F([]),P=F(!1),Y=F(!1),Ke=F(!1),Ge=F("#051e0a"),Ae=F("#ffffff"),f=F("#3a2004"),C=F(!1);function G(_){return _.length===9&&_.startsWith("#")?_.substring(0,7):_}function oe(_,U="ff"){return _.length===7&&_.startsWith("#")?_+U:_}function N(){if(window.DICE&&e(Q))try{pe&&e(Q)&&aa(Q,e(Q).innerHTML="");const _=e(Q).clientWidth||500,U=e(Q).clientHeight||300;pe=new window.DICE.dice_box(e(Q),{w:_,h:U}),c(ze,!0)}catch(_){console.error("Error initializing dice box:",_)}}pa(()=>{const _=te=>new Promise((fe,B)=>{if(document.querySelector(`script[src="${te}"]`)){fe(null);return}const K=document.createElement("script");K.src=te,K.onload=()=>{fe(null)},K.onerror=()=>{console.error(`Failed to load: ${te}`),B(new Error(`Failed to load ${te}`))},document.head.appendChild(K)});setTimeout(()=>{_(`${va}/libs/three.min.js`).then(()=>_(`${va}/libs/cannon.min.js`)).then(()=>_(`${va}/libs/teal.js`)).then(()=>_(`${va}/dice.js`)).then(()=>{if(window.DICE){const te=window.DICE.getColors();c(Ge,G(te.dice_color)),c(Ae,G(te.label_color)),c(f,G(te.desk_color))}N()}).catch(te=>{console.error("Failed to load dice libraries:",te)})},100);const U=()=>{e(ze)&&N()},ve=te=>{X()&&te.key==="Escape"&&ee()};return window.addEventListener("resize",U),window.addEventListener("keydown",ve),()=>{window.removeEventListener("resize",U),window.removeEventListener("keydown",ve)}});function be(_,U="other"){if(!pe||!e(ze))return;c(z,null),c(b,[]),c(P,!1),c(Y,!1),U==="damage"&&J([]),ue(U),c(Ke,!1),pe.diceToRoll=_;const ve=fe=>null,te=fe=>{let B=fe.resultTotal,T=fe.resultString;if(re()&&(B=Math.floor(B/2),T=T+" (halved)"),c(z,{...fe,resultTotal:B,resultString:T}),console.log("Final roll result:",e(z)),console.log({type:U}),U==="attack"&&fe.result&&fe.result.length>0){const K=fe.result[0];c(P,K===20),c(Y,K===1)}if(c(b,[]),console.log("Setting up follow-up actions. Type:",U,"damageNotation:",W(),"isCriticalSuccess:",e(P),"isCriticalFail:",e(Y)),U==="attack"&&W())if(e(P)){const K=_e(W());e(b).push({label:`Roll Critical Damage (${K})`,notation:K})}else e(Y)||e(b).push({label:`Roll Damage (${W()})`,notation:W()})};pe.start_throw(ve,te)}function Ve(){const _=[];e(me)>0&&_.push(`${e(me)}d4`),e(De)>0&&_.push(`${e(De)}d6`),e(Re)>0&&_.push(`${e(Re)}d8`),e(ke)>0&&_.push(`${e(ke)}d10`),e(Pe)>0&&_.push(`${e(Pe)}d12`),e(D)>0&&_.push(`${e(D)}d20`);let U=_.join("+")||"1d20";return e(ge)!==0&&(U+=e(ge)>=0?`+${e(ge)}`:`${e(ge)}`),U}function et(){const _=Ve();be(_)}function _e(_){return _.replace(/(\d+)d(\d+)/g,(U,ve,te)=>`${parseInt(ve)*2}d${te}`)}function Oe(){c(me,0),c(De,0),c(Re,0),c(ke,0),c(Pe,0),c(D,0),c(ge,0),c(z,null),c(b,[]),c(P,!1),c(Y,!1),ue("other"),c(Ke,!1)}function A(){window.DICE&&(window.DICE.setColors({dice_color:oe(e(Ge),"ff"),label_color:oe(e(Ae),"ff"),desk_color:e(f)}),pe&&(pe.updateDeskColor(e(f)),pe.updateDiceColors()))}function $(){c(C,!e(C))}function ae(){!e(z)||e(h)<=0||e(Ke)||(c(z,{...e(z),resultTotal:e(z).resultTotal+10,resultString:e(z).resultString+" + 10 (Guided Strike)"}),se.update(_=>{const U="ChannelDivinity",ve=_.classFeatures.features[U];return typeof ve=="number"&&ve>0&&(_.classFeatures.features[U]=ve-1),_}),c(Ke,!0))}function ee(){k("close"),S(""),W(""),le(""),c(Qe,""),c(z,null),c(Ke,!1),c(P,!1),c(Y,!1),Oe()}Xe(()=>(t(),oa),()=>{c(g,t().class?oa(t().class,t().level,t().subclass).some(U=>U.name==="Guided Strike"):!1)}),Xe(()=>t(),()=>{c(h,(()=>{const U=t().classFeatures.features["ChannelDivinity"];return typeof U=="number"?U:0})())}),Xe(()=>(e(me),e(De),e(Re),e(ke),e(Pe),e(D),e(ge)),()=>{c(w,(()=>{const _=[];e(me)>0&&_.push(`${e(me)}d4`),e(De)>0&&_.push(`${e(De)}d6`),e(Re)>0&&_.push(`${e(Re)}d8`),e(ke)>0&&_.push(`${e(ke)}d10`),e(Pe)>0&&_.push(`${e(Pe)}d12`),e(D)>0&&_.push(`${e(D)}d20`);let U=_.join("+")||"1d20";return e(ge)!==0&&(U+=e(ge)>=0?`+${e(ge)}`:`${e(ge)}`),U})())}),Xe(()=>(E(S()),e(ze),E(X()),e(Qe),E(W()),E(le()),E(ue())),()=>{S()&&e(ze)&&X()&&S()!==e(Qe)&&(c(Qe,S()),c(z,null),c(b,[]),c(P,!1),c(Y,!1),c(Ke,!1),console.log("Auto-roll triggered. notation:",S(),"damageNotation:",W(),"attackName:",le(),"rollType:",ue()),setTimeout(()=>be(S(),ue()),200))}),Jt();var O={getLastRollTotal:Se};Pt();var v=br();let qe;var ce=r(v),ne=r(ce),j=s(r(ne),2),H=r(j),V=s(H,2);l(j),l(ne);var Fe=s(ne,2);{var lt=_=>{var U=rr(),ve=s(r(U),2),te=r(ve),fe=s(r(te),2);we(fe),l(te);var B=s(te,2),T=s(r(B),2);we(T),l(B);var K=s(B,2),Le=s(r(K),2);we(Le),l(K),l(ve),l(U),He(fe,()=>e(Ge),Ie=>c(Ge,Ie)),I("change",fe,A),He(T,()=>e(Ae),Ie=>c(Ae,Ie)),I("change",T,A),He(Le,()=>e(f),Ie=>c(f,Ie)),I("change",Le,A),o(_,U)};y(Fe,_=>{e(C)&&_(lt)})}var je=s(Fe,2);{var ye=_=>{var U=nr();o(_,U)};y(je,_=>{e(ze)||_(ye)})}var xe=s(je,2),Me=r(xe);ja(Me,_=>c(Q,_),()=>e(Q));var Te=s(Me,2);{var Je=_=>{var U=ir(),ve=s(r(U),2),te=r(ve),fe=s(r(te),2);we(fe),l(te);var B=s(te,2),T=s(r(B),2);we(T),l(B);var K=s(B,2),Le=s(r(K),2);we(Le),l(K);var Ie=s(K,2),it=s(r(Ie),2);we(it),l(Ie);var q=s(Ie,2),pt=s(r(q),2);we(pt),l(q);var wt=s(q,2),x=s(r(wt),2);we(x),l(wt),l(ve);var R=s(ve,2),m=r(R),Ne=r(m);l(m);var de=s(m,2);l(R),l(U),M(()=>{m.disabled=!e(ze),L(Ne,`Roll ${e(w)??""}`)}),He(fe,()=>e(me),$e=>c(me,$e)),He(T,()=>e(De),$e=>c(De,$e)),He(Le,()=>e(Re),$e=>c(Re,$e)),He(it,()=>e(ke),$e=>c(ke,$e)),He(pt,()=>e(Pe),$e=>c(Pe,$e)),He(x,()=>e(D),$e=>c(D,$e)),I("click",m,et),I("click",de,Oe),o(_,U)};y(Te,_=>{S()||_(Je)})}l(xe);var ie=s(xe,2);let he;var Ue=r(ie);{var Ye=_=>{var U=hr(),ve=Ee(U),te=r(ve),fe=r(te,!0);l(te);var B=s(te,2);{var T=de=>{var $e=or();o(de,$e)};y(B,de=>{e(P)&&de(T)})}var K=s(B,2);{var Le=de=>{var $e=cr();o(de,$e)};y(K,de=>{e(Y)&&de(Le)})}l(ve);var Ie=s(ve,2),it=r(Ie,!0);l(Ie);var q=s(Ie,2),pt=r(q);{var wt=de=>{var $e=vt(),Ce=Ee($e);{var at=ut=>{var ot=dr();kt(ot,5,()=>(e(z),E(S()),E(J()),n(()=>Z(e(z),S(),J()))),xt,(rt,nt)=>{var ht=vr(),ct=r(ht),st=r(ct,!0);l(ct);var ft=s(ct,2),gt=r(ft);l(ft),l(ht),M(()=>{L(st,(e(nt),n(()=>e(nt).display))),L(gt,`(${e(nt),n(()=>e(nt).source)??""})`)}),o(rt,ht)}),l(ot),o(ut,ot)},tt=ut=>{var ot=vt(),rt=Ee(ot);{var nt=ht=>{var ct=ur(),st=r(ct);l(ct),M(()=>L(st,`Modifier: ${e(z),n(()=>e(z).constant>=0?"+":"")??""}${e(z),n(()=>e(z).constant)??""}`)),o(ht,ct)};y(rt,ht=>{e(z),n(()=>e(z).constant)&&ht(nt)},!0)}o(ut,ot)};y(Ce,ut=>{E(J()),n(()=>J().length>0)?ut(at):ut(tt,!1)})}o(de,$e)};y(pt,de=>{e(z),E(J()),n(()=>e(z).constant||J().length>0)&&de(wt)})}l(q);var x=s(q,2);{var R=de=>{var $e=pr();o(de,$e)};y(x,de=>{e(Y)&&de(R)})}var m=s(x,2);{var Ne=de=>{var $e=mr(),Ce=r($e);kt(Ce,1,()=>e(b),xt,(ut,ot)=>{var rt=fr(),nt=r(rt,!0);l(rt),M(()=>L(nt,(e(ot),n(()=>e(ot).label)))),I("click",rt,()=>be(e(ot).notation,"damage")),o(ut,rt)});var at=s(Ce,2);{var tt=ut=>{var ot=gr();M(()=>{ot.disabled=e(h)<=0,We(ot,"title",e(h)<=0?"No Channel Divinity uses remaining":"Use Channel Divinity to add +10 to this attack roll")}),I("click",ot,ae),o(ut,ot)};y(at,ut=>{e(g)&&ue()==="attack"&&!e(Ke)&&e(h)>0&&!e(Y)&&ut(tt)})}l($e),o(de,$e)};y(m,de=>{e(b),e(g),E(ue()),e(Ke),e(h),n(()=>e(b).length>0||e(g)&&ue()==="attack"&&!e(Ke)&&e(h)>0)&&de(Ne)})}M(()=>{L(fe,le()?`${le()} - Result`:"Result"),L(it,(e(z),n(()=>e(z).resultTotal)))}),o(_,U)};y(Ue,_=>{e(z)&&_(Ye)})}l(ie),l(ce),l(v),M(()=>{qe=yt(v,1,"modal-overlay svelte-1r90jgp",null,qe,{hidden:!X()}),he=yt(ie,1,"roll-result svelte-1r90jgp",null,he,{"has-result":e(z)})}),I("click",H,$),I("click",V,ee),I("click",ce,Ea(function(_){ia.call(this,i,_)})),I("keydown",ce,function(_){ia.call(this,i,_)}),I("click",v,ee),I("keydown",v,_=>_.key==="Escape"&&ee()),o(a,v),Cs(i,"getLastRollTotal",Se);var Be=Et(O);return u(),Be}const Sa="https://api.github.com/gists";async function yr(a,i,t){if(!i)throw new Error("GitHub token is required");const d=JSON.stringify(a,null,2),u=`${a.name||"character"}_dnd.json`,g={description:t||`D&D Character: ${a.name}`,public:!1,files:{[u]:{content:d}}},h=await fetch(Sa,{method:"POST",headers:{Authorization:`token ${i}`,"Content-Type":"application/json"},body:JSON.stringify(g)});if(!h.ok)throw new Error(`Failed to create gist: ${h.statusText}`);return(await h.json()).id}async function kr(a,i,t){if(!i||!t)throw new Error("GitHub token and Gist ID are required");const d=JSON.stringify(a,null,2),g={files:{[`${a.name||"character"}_dnd.json`]:{content:d}}},h=await fetch(`${Sa}/${t}`,{method:"PATCH",headers:{Authorization:`token ${i}`,"Content-Type":"application/json"},body:JSON.stringify(g)});if(!h.ok)throw new Error(`Failed to update gist: ${h.statusText}`)}async function Sr(a,i){if(!a)throw new Error("Gist ID is required");const t={"Content-Type":"application/json"};i&&(t.Authorization=`token ${i}`);const d=await fetch(`${Sa}/${a}`,{method:"GET",headers:t});if(!d.ok)throw new Error(`Failed to load gist: ${d.statusText}`);const u=await d.json(),g=Object.values(u.files);if(g.length===0)throw new Error("No files found in gist");const w=g[0].content;try{const k=JSON.parse(w);return k.attacks&&Array.isArray(k.attacks)&&(k.attacks=k.attacks.map(S=>({...S,id:S.id||crypto.randomUUID()}))),k.classFeatures?(k.classFeatures.features||(k.classFeatures.features={}),k.classFeatures.spellSlots||(k.classFeatures.spellSlots=[]),k.classFeatures.preparedSpells===void 0&&(k.classFeatures.preparedSpells="")):k.classFeatures={features:{},spellSlots:[],preparedSpells:""},k}catch{throw new Error("Invalid character data in gist")}}function Ja(a){typeof window<"u"&&localStorage.setItem("dnd_gist_config",JSON.stringify(a))}function xr(){if(typeof window<"u"){const a=localStorage.getItem("dnd_gist_config");if(a)return JSON.parse(a)}return{}}async function $r(a,i=30){if(!a)throw new Error("GitHub token is required to list gists");const t=await fetch(`${Sa}?per_page=${i}`,{method:"GET",headers:{Authorization:`token ${a}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error(`Failed to list gists: ${t.statusText}`);return await t.json()}var Cr=p('<div class="error-message svelte-1jb5ckg"> </div>'),Lr=p('<div class="toggle-container svelte-1jb5ckg"><button type="button" class="toggle-btn svelte-1jb5ckg"> </button></div>'),wr=p('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID (leave empty to create new)</label> <input type="text" id="gistId" placeholder="Optional: existing Gist ID to update" class="svelte-1jb5ckg"/></div>'),Dr=p('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),jr=p('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),Br=p('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Update (or leave unselected to create new)</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),Ar=p('<div class="info-message svelte-1jb5ckg">No gists found. A new one will be created.</div>'),Fr=p('<!> <div class="form-group svelte-1jb5ckg"><label for="description" class="svelte-1jb5ckg"> </label> <input type="text" id="description" placeholder="D&amp;D Character Sheet" class="svelte-1jb5ckg"/></div>',1),Mr=p('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID *</label> <input type="text" id="gistId" placeholder="Enter Gist ID (for public or your private gists)" required class="svelte-1jb5ckg"/></div>'),Ir=p('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),Rr=p('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),Pr=p('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Load</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),Tr=p('<div class="info-message svelte-1jb5ckg">No gists found. Enter a Gist ID manually or create a new one in Save mode.</div>'),Er=p('<div class="modal-overlay svelte-1jb5ckg" role="button" tabindex="-1"><div class="modal-content svelte-1jb5ckg" role="dialog" tabindex="0"><div class="modal-header svelte-1jb5ckg"><h2 class="svelte-1jb5ckg"> </h2> <button class="close-btn svelte-1jb5ckg">Ã—</button></div> <div class="modal-body svelte-1jb5ckg"><!> <div class="form-group svelte-1jb5ckg"><label for="token" class="svelte-1jb5ckg"> <a href="https://github.com/settings/tokens" target="_blank" rel="noopener" class="svelte-1jb5ckg">Get token</a></label> <input type="password" id="token" placeholder="ghp_xxxxxxxxxxxxx" class="svelte-1jb5ckg"/></div> <!> <!> <div class="modal-actions svelte-1jb5ckg"><button class="btn btn-primary svelte-1jb5ckg"><!></button> <button class="btn btn-secondary svelte-1jb5ckg">Cancel</button></div></div></div></div>');function Hr(a,i){Tt(i,!1);const t=()=>Ze(se,"$character",d),[d,u]=qt(),g=sa();let h=St(i,"mode",8,"save"),w=F(""),k=F(""),S=F(""),X=F(!1),W=F(""),le=F(!1),re=F(!1),J=F([]),ue=F(null);const pe=xr();pe.token&&c(w,pe.token),pe.gistId&&c(k,pe.gistId),pa(async()=>{e(w)&&!e(le)&&await Q()});async function Q(){if(e(w)){c(re,!0),c(W,"");try{c(J,await $r(e(w))),e(k)&&c(ue,e(J).find($=>$.id===e(k))||null)}catch($){c(W,$.message||"Failed to load gists"),c(J,[])}finally{c(re,!1)}}}function ze($){c(ue,$),c(k,$.id)}function Qe(){c(le,!e(le)),c(W,""),!e(le)&&e(w)&&Q()}async function z(){if(!e(w)){c(W,"GitHub token is required");return}const $=e(ue)?.id||e(k);c(X,!0),c(W,"");try{if($)await kr(t(),e(w),$),c(k,$),Gt.add("Character updated in Gist successfully!","success");else{const ae=await yr(t(),e(w),e(S));c(k,ae),Gt.add(`Character saved to Gist! ID: ${ae}`,"success")}Ja({token:e(w),gistId:e(k)}),g("close")}catch(ae){c(W,ae.message||"Failed to save to Gist")}finally{c(X,!1)}}async function Se(){const $=e(ue)?.id||e(k);if(!$){c(W,"Please select a gist or enter a Gist ID");return}c(X,!0),c(W,"");try{const ae=await Sr($,e(w)||void 0);se.set(ae),c(k,$),Ja({token:e(w),gistId:e(k)}),Gt.add("Character loaded from Gist successfully!","success"),g("close")}catch(ae){c(W,ae.message||"Failed to load from Gist")}finally{c(X,!1)}}function Z(){g("close")}Pt();var me=Er(),De=r(me),Re=r(De),ke=r(Re),Pe=r(ke,!0);l(ke);var D=s(ke,2);l(Re);var ge=s(Re,2),b=r(ge);{var P=$=>{var ae=Cr(),ee=r(ae,!0);l(ae),M(()=>L(ee,e(W))),o($,ae)};y(b,$=>{e(W)&&$(P)})}var Y=s(b,2),Ke=r(Y),Ge=r(Ke);ra(),l(Ke);var Ae=s(Ke,2);we(Ae),l(Y);var f=s(Y,2);{var C=$=>{var ae=Lr(),ee=r(ae),O=r(ee,!0);l(ee),l(ae),M(()=>{ee.disabled=e(X),L(O,e(le)?"ðŸ“‹ Show My Gists":"âœï¸ Enter Gist ID Manually")}),I("click",ee,Qe),o($,ae)};y(f,$=>{(h()==="load"||h()==="save"&&e(w))&&$(C)})}var G=s(f,2);{var oe=$=>{var ae=Fr(),ee=Ee(ae);{var O=H=>{var V=wr(),Fe=s(r(V),2);we(Fe),l(V),M(()=>Fe.disabled=e(X)),He(Fe,()=>e(k),lt=>c(k,lt)),o(H,V)},v=H=>{var V=vt(),Fe=Ee(V);{var lt=ye=>{var xe=Dr();o(ye,xe)},je=ye=>{var xe=vt(),Me=Ee(xe);{var Te=ie=>{var he=Br(),Ue=s(r(he),2);kt(Ue,5,()=>e(J),xt,(Ye,Be)=>{var _=jr();let U;var ve=r(_),te=r(ve),fe=r(te,!0);l(te);var B=s(te,2),T=r(B,!0);l(B),l(ve);var K=s(ve,2),Le=r(K),Ie=r(Le);l(Le);var it=s(Le,2),q=r(it);l(it),l(K),l(_),M(pt=>{U=yt(_,1,"gist-item svelte-1jb5ckg",null,U,{selected:e(ue)?.id===e(Be).id}),_.disabled=e(X),L(fe,(e(Be),n(()=>e(Be).description||"Untitled"))),L(T,(e(Be),n(()=>e(Be).public?"ðŸŒ Public":"ðŸ”’ Private"))),L(Ie,`ID: ${e(Be),n(()=>e(Be).id)??""}`),L(q,`Updated: ${pt??""}`)},[()=>(e(Be),n(()=>new Date(e(Be).updated_at).toLocaleDateString()))]),I("click",_,()=>ze(e(Be))),o(Ye,_)}),l(Ue),l(he),o(ie,he)},Je=ie=>{var he=vt(),Ue=Ee(he);{var Ye=Be=>{var _=Ar();o(Be,_)};y(Ue,Be=>{e(w)&&Be(Ye)},!0)}o(ie,he)};y(Me,ie=>{e(J),n(()=>e(J).length>0)?ie(Te):ie(Je,!1)},!0)}o(ye,xe)};y(Fe,ye=>{e(re)?ye(lt):ye(je,!1)},!0)}o(H,V)};y(ee,H=>{e(le)||!e(w)?H(O):H(v,!1)})}var qe=s(ee,2),ce=r(qe),ne=r(ce);l(ce);var j=s(ce,2);we(j),l(qe),M(()=>{L(ne,`Description ${e(k)?"(optional)":""}`),j.disabled=e(X)}),He(j,()=>e(S),H=>c(S,H)),o($,ae)},N=$=>{var ae=vt(),ee=Ee(ae);{var O=qe=>{var ce=Mr(),ne=s(r(ce),2);we(ne),l(ce),M(()=>ne.disabled=e(X)),He(ne,()=>e(k),j=>c(k,j)),o(qe,ce)},v=qe=>{var ce=vt(),ne=Ee(ce);{var j=V=>{var Fe=Ir();o(V,Fe)},H=V=>{var Fe=vt(),lt=Ee(Fe);{var je=xe=>{var Me=Pr(),Te=s(r(Me),2);kt(Te,5,()=>e(J),xt,(Je,ie)=>{var he=Rr();let Ue;var Ye=r(he),Be=r(Ye),_=r(Be,!0);l(Be);var U=s(Be,2),ve=r(U,!0);l(U),l(Ye);var te=s(Ye,2),fe=r(te),B=r(fe);l(fe);var T=s(fe,2),K=r(T);l(T),l(te),l(he),M(Le=>{Ue=yt(he,1,"gist-item svelte-1jb5ckg",null,Ue,{selected:e(ue)?.id===e(ie).id}),he.disabled=e(X),L(_,(e(ie),n(()=>e(ie).description||"Untitled"))),L(ve,(e(ie),n(()=>e(ie).public?"ðŸŒ Public":"ðŸ”’ Private"))),L(B,`ID: ${e(ie),n(()=>e(ie).id)??""}`),L(K,`Updated: ${Le??""}`)},[()=>(e(ie),n(()=>new Date(e(ie).updated_at).toLocaleDateString()))]),I("click",he,()=>ze(e(ie))),o(Je,he)}),l(Te),l(Me),o(xe,Me)},ye=xe=>{var Me=vt(),Te=Ee(Me);{var Je=ie=>{var he=Tr();o(ie,he)};y(Te,ie=>{e(w)&&ie(Je)},!0)}o(xe,Me)};y(lt,xe=>{e(J),n(()=>e(J).length>0)?xe(je):xe(ye,!1)},!0)}o(V,Fe)};y(ne,V=>{e(re)?V(j):V(H,!1)},!0)}o(qe,ce)};y(ee,qe=>{e(le)||!e(w)?qe(O):qe(v,!1)},!0)}o($,ae)};y(G,$=>{h()==="save"?$(oe):$(N,!1)})}var be=s(G,2),Ve=r(be),et=r(Ve);{var _e=$=>{var ae=Ft();M(()=>L(ae,h()==="save"?"Saving...":"Loading...")),o($,ae)},Oe=$=>{var ae=Ft();M(()=>L(ae,h()==="save"?"Save":"Load")),o($,ae)};y(et,$=>{e(X)?$(_e):$(Oe,!1)})}l(Ve);var A=s(Ve,2);l(be),l(ge),l(De),l(me),M(()=>{L(Pe,h()==="save"?"Save to GitHub Gist":"Load from GitHub Gist"),L(Ge,`GitHub Token ${h()==="load"?"(optional for public gists)":"(required)"} `),Ae.disabled=e(X),Ve.disabled=e(X),A.disabled=e(X)}),I("click",D,Z),He(Ae,()=>e(w),$=>c(w,$)),I("blur",Ae,()=>{e(w)&&!e(le)&&Q()}),I("click",Ve,function(...$){(h()==="save"?z:Se)?.apply(this,$)}),I("click",A,Z),I("click",De,Ea(function($){ia.call(this,i,$)})),I("keydown",De,function($){ia.call(this,i,$)}),I("click",me,Z),I("keydown",me,$=>$.key==="Escape"&&Z()),o(a,me),Et(),u()}var Ur=p('<div class="loading svelte-1ngjemu">Loading D&D data...</div>'),Nr=p("<option> </option>"),Gr=p('<select class="level-filter svelte-1ngjemu"><option>All Levels</option><option>Cantrip</option><!></select>'),Or=p('<div class="no-results svelte-1ngjemu"> </div>'),qr=p('<div class="item-meta svelte-1ngjemu"> </div>'),Wr=p('<div class="item-meta svelte-1ngjemu"> </div>'),zr=p('<button><div class="item-name svelte-1ngjemu"> </div> <!></button>'),Kr=p('<p class="higher-levels"><strong>At Higher Levels:</strong> </p>'),Vr=p('<p class="cantrip-upgrade"><strong>Cantrip Upgrade:</strong> </p>'),Jr=p('<h3 class="svelte-1ngjemu"> </h3> <p class="spell-meta svelte-1ngjemu"><!> <!></p> <p class="spell-classes"><strong>Classes:</strong> </p> <div class="spell-stats svelte-1ngjemu"><div><strong>Casting Time:</strong> </div> <div><strong>Range:</strong> </div> <div><strong>Components:</strong> <!></div> <div><strong>Duration:</strong> <!> </div></div> <p class="description svelte-1ngjemu"> </p> <!> <!>',1),Qr=p('<p class="prerequisite svelte-1ngjemu"><strong>Prerequisite:</strong> </p>'),Yr=p('<h3 class="svelte-1ngjemu"> </h3> <!> <p class="description svelte-1ngjemu"> </p> <a target="_blank" rel="noopener" class="source-link svelte-1ngjemu">View Full Details â†’</a>',1),Xr=p('<div class="item-details svelte-1ngjemu"><!></div>'),Zr=p('<div class="controls svelte-1ngjemu"><div class="tabs svelte-1ngjemu"><button> </button> <button> </button></div> <div class="search-controls svelte-1ngjemu"><input type="text" placeholder="Search by name or description..." class="search-input svelte-1ngjemu"/> <!></div></div> <div class="content-container svelte-1ngjemu"><div class="items-list svelte-1ngjemu"><!></div> <!></div>',1),en=p('<div class="modal-backdrop svelte-1ngjemu" role="presentation"><div class="modal svelte-1ngjemu" role="dialog" aria-modal="true" tabindex="-1"><div class="modal-header svelte-1ngjemu"><h2 class="svelte-1ngjemu">Browse D&D Spells & Feats</h2> <button class="close-btn svelte-1ngjemu" aria-label="Close">&times;</button></div> <div class="modal-body svelte-1ngjemu"><!></div> <div class="modal-footer svelte-1ngjemu"><button class="btn-secondary svelte-1ngjemu">Cancel</button> <button class="btn-primary svelte-1ngjemu">Add to Character Sheet</button></div></div></div>');function tn(a,i){Tt(i,!1);const t=F(),d=F(),u=F();let g=St(i,"onClose",8),h=F("spell"),w=F(!0),k=F(""),S=F(null),X=F([]),W=F([]),le=F(null);pa(async()=>{c(w,!0);try{c(X,await ss()),c(W,await Ys())}catch(D){console.error("Failed to load data:",D)}finally{c(w,!1)}});function re(D){c(le,D)}function J(D){const ge=D.match(/(\d+d\d+(?:\s*\+\s*\d+)?)/i);return ge?ge[1]:""}function ue(D){const ge=D.split(/\.( |$)/)[0].trim(),b=Array.from(D.matchAll(/\*\*(.*?)\*\*/g)).map(Y=>Y[1].replace(/\.$/,""));let P=ge;return b.length&&(P+=" | Effects: "+b.join(", ")),P}function pe(){if(e(le)){if(e(h)==="spell"){const D=e(le);se.update(ge=>{const P=[];D.range&&P.push(`Range: ${D.range}`),D.castingTime&&P.push(`Cast: ${D.castingTime}`),D.duration&&P.push(`Duration: ${D.duration}`),D.actionType==="Save"&&P.push("Saving throw spell"),D.components&&D.components.length>0&&P.push(`Components: ${D.components.join(", ")}`),D.material&&P.push(`Material: ${D.material}`);const Y=P.join(" | "),Ke=ue(D.description),Ge={id:crypto.randomUUID(),name:`${D.name}${D.concentration?" (C)":""}${D.ritual?" (R)":""}`,bonus:D.actionType==="Attack"?5:0,damage:J(D.description),damageType:`${D.school} (Lvl ${D.level})`,spellRef:D.name,infoNotes:Y,generalNotes:Ke,castAtLevel:D.level};return ge.attacks=[...ge.attacks,Ge],ge})}else if(e(h)==="feat"){const D=e(le);se.update(ge=>{const b=`${D.name}${D.prerequisite?` (Req: ${D.prerequisite})`:""}
${D.description}
`;return ge.features=ge.features?`${ge.features}
${b}`:b,ge})}c(le,null),g()()}}Xe(()=>(e(S),e(X),e(k)),()=>{c(t,e(S)!==null?Xs(za(e(X),e(k)),e(S)):za(e(X),e(k)))}),Xe(()=>(e(W),e(k)),()=>{c(d,Zs(e(W),e(k)))}),Xe(()=>(e(h),e(t),e(d)),()=>{c(u,e(h)==="spell"?e(t):e(d))}),Jt(),Pt();var Q=en(),ze=r(Q),Qe=r(ze),z=s(r(Qe),2);l(Qe);var Se=s(Qe,2),Z=r(Se);{var me=D=>{var ge=Ur();o(D,ge)},De=D=>{var ge=Zr(),b=Ee(ge),P=r(b),Y=r(P);let Ke;var Ge=r(Y);l(Y);var Ae=s(Y,2);let f;var C=r(Ae);l(Ae),l(P);var G=s(P,2),oe=r(G);we(oe);var N=s(oe,2);{var be=ee=>{var O=Gr();M(()=>{e(S),Lt(()=>{})});var v=r(O);v.value=(v.__value=null)??"";var qe=s(v);qe.value=qe.__value=0;var ce=s(qe);kt(ce,0,()=>[1,2,3,4,5,6,7,8,9],xt,(ne,j)=>{var H=Nr(),V=r(H);l(H);var Fe={};M(()=>{L(V,`Level ${j??""}`),Fe!==(Fe=j)&&(H.value=(H.__value=j)??"")}),o(ne,H)}),l(O),Aa(O,()=>e(S),ne=>c(S,ne)),o(ee,O)};y(N,ee=>{e(h)==="spell"&&ee(be)})}l(G),l(b);var Ve=s(b,2),et=r(Ve),_e=r(et);{var Oe=ee=>{var O=Or(),v=r(O);l(O),M(()=>L(v,`No ${e(h)??""}s found`)),o(ee,O)},A=ee=>{var O=vt(),v=Ee(O);kt(v,1,()=>e(u),xt,(qe,ce)=>{var ne=zr();let j;var H=r(ne),V=r(H,!0);l(H);var Fe=s(H,2);{var lt=ye=>{const xe=dt(()=>e(ce));var Me=qr(),Te=r(Me);l(Me),M(()=>L(Te,`Level ${E(e(xe)),n(()=>e(xe).level)??""} â€¢ ${E(e(xe)),n(()=>e(xe).school)??""}`)),o(ye,Me)},je=ye=>{const xe=dt(()=>e(ce));var Me=vt(),Te=Ee(Me);{var Je=ie=>{var he=Wr(),Ue=r(he,!0);l(he),M(()=>L(Ue,(E(e(xe)),n(()=>e(xe).prerequisite)))),o(ie,he)};y(Te,ie=>{E(e(xe)),n(()=>e(xe).prerequisite)&&ie(Je)})}o(ye,Me)};y(Fe,ye=>{e(h)==="spell"?ye(lt):ye(je,!1)})}l(ne),M(()=>{j=yt(ne,1,"item-card svelte-1ngjemu",null,j,{selected:e(le)?.name===e(ce).name}),L(V,(e(ce),n(()=>e(ce).name)))}),I("click",ne,()=>re(e(ce))),o(qe,ne)}),o(ee,O)};y(_e,ee=>{e(u),n(()=>e(u).length===0)?ee(Oe):ee(A,!1)})}l(et);var $=s(et,2);{var ae=ee=>{var O=Xr(),v=r(O);{var qe=ne=>{const j=dt(()=>e(le));var H=Jr(),V=Ee(H),Fe=r(V,!0);l(V);var lt=s(V,2),je=r(lt);{var ye=R=>{var m=Ft();M(()=>L(m,`${E(e(j)),n(()=>e(j).school)??""} cantrip`)),o(R,m)},xe=R=>{var m=Ft();M(()=>L(m,`Level ${E(e(j)),n(()=>e(j).level)??""} ${E(e(j)),n(()=>e(j).school)??""}`)),o(R,m)};y(je,R=>{E(e(j)),n(()=>e(j).level===0)?R(ye):R(xe,!1)})}var Me=s(je,2);{var Te=R=>{var m=Ft("(ritual)");o(R,m)};y(Me,R=>{E(e(j)),n(()=>e(j).ritual)&&R(Te)})}l(lt);var Je=s(lt,2),ie=s(r(Je));l(Je);var he=s(Je,2),Ue=r(he),Ye=s(r(Ue));l(Ue);var Be=s(Ue,2),_=s(r(Be));l(Be);var U=s(Be,2),ve=s(r(U)),te=s(ve);{var fe=R=>{var m=Ft();M(()=>L(m,`(${E(e(j)),n(()=>e(j).material)??""})`)),o(R,m)};y(te,R=>{E(e(j)),n(()=>e(j).material)&&R(fe)})}l(U);var B=s(U,2),T=s(r(B),2);{var K=R=>{var m=Ft("Concentration,");o(R,m)};y(T,R=>{E(e(j)),n(()=>e(j).concentration)&&R(K)})}var Le=s(T,1,!0);l(B),l(he);var Ie=s(he,2),it=r(Ie,!0);l(Ie);var q=s(Ie,2);{var pt=R=>{var m=Kr(),Ne=s(r(m));l(m),M(()=>L(Ne,` ${E(e(j)),n(()=>e(j).higherLevelSlot)??""}`)),o(R,m)};y(q,R=>{E(e(j)),n(()=>e(j).higherLevelSlot)&&R(pt)})}var wt=s(q,2);{var x=R=>{var m=Vr(),Ne=s(r(m));l(m),M(()=>L(Ne,` ${E(e(j)),n(()=>e(j).cantripUpgrade)??""}`)),o(R,m)};y(wt,R=>{E(e(j)),n(()=>e(j).cantripUpgrade)&&R(x)})}M((R,m)=>{L(Fe,(E(e(j)),n(()=>e(j).name))),L(ie,` ${R??""}`),L(Ye,` ${E(e(j)),n(()=>e(j).castingTime||e(j).actionType)??""}`),L(_,` ${E(e(j)),n(()=>e(j).range)??""}`),L(ve,` ${m??""}`),L(Le,(E(e(j)),n(()=>e(j).duration))),L(it,(E(e(j)),n(()=>e(j).description)))},[()=>(E(e(j)),n(()=>e(j).classes.join(", "))),()=>(E(e(j)),n(()=>e(j).components.join(", ").toUpperCase()))]),o(ne,H)},ce=ne=>{const j=dt(()=>e(le));var H=Yr(),V=Ee(H),Fe=r(V,!0);l(V);var lt=s(V,2);{var je=Te=>{var Je=Qr(),ie=s(r(Je));l(Je),M(()=>L(ie,` ${E(e(j)),n(()=>e(j).prerequisite)??""}`)),o(Te,Je)};y(lt,Te=>{E(e(j)),n(()=>e(j).prerequisite)&&Te(je)})}var ye=s(lt,2),xe=r(ye,!0);l(ye);var Me=s(ye,2);M(()=>{L(Fe,(E(e(j)),n(()=>e(j).name))),L(xe,(E(e(j)),n(()=>e(j).description))),We(Me,"href",(E(e(j)),n(()=>e(j).source)))}),o(ne,H)};y(v,ne=>{e(h)==="spell"?ne(qe):ne(ce,!1)})}l(O),o(ee,O)};y($,ee=>{e(le)&&ee(ae)})}l(Ve),M(()=>{Ke=yt(Y,1,"tab svelte-1ngjemu",null,Ke,{active:e(h)==="spell"}),L(Ge,`ðŸ“œ Spells (${e(X),n(()=>e(X).length)??""})`),f=yt(Ae,1,"tab svelte-1ngjemu",null,f,{active:e(h)==="feat"}),L(C,`â­ Feats (${e(W),n(()=>e(W).length)??""})`)}),I("click",Y,()=>{c(h,"spell"),c(le,null),c(k,"")}),I("click",Ae,()=>{c(h,"feat"),c(le,null),c(k,"")}),He(oe,()=>e(k),ee=>c(k,ee)),o(D,ge)};y(Z,D=>{e(w)?D(me):D(De,!1)})}l(Se);var Re=s(Se,2),ke=r(Re),Pe=s(ke,2);l(Re),l(ze),l(Q),M(()=>Pe.disabled=!e(le)),I("click",z,function(...D){g()?.apply(this,D)}),I("click",ke,function(...D){g()?.apply(this,D)}),I("click",Pe,pe),I("click",ze,Ea(function(D){ia.call(this,i,D)})),I("keydown",ze,function(D){ia.call(this,i,D)}),I("click",Q,function(...D){g()?.apply(this,D)}),I("keydown",Q,D=>D.key==="Escape"&&g()()),o(a,Q),Et()}var an=p('<link rel="icon" type="image/png" href="favicon4.png"/> <meta name="viewport" content="width=device-width, initial-scale=1"/>',1),sn=p('<span class="character-name svelte-1uha8ag"> </span>'),ln=p("<span> </span>"),rn=p('<div class="spell-slots-header svelte-1uha8ag"></div>'),nn=p("<span> </span><br/>",1),on=p("<span> </span>"),cn=p('<span class="effect-tooltip"><strong> </strong><br/> <br/> <!> <!></span>'),vn=p('<button class="effect-remove-btn svelte-1uha8ag">Ã—</button>'),dn=p('<span class="effect-badge svelte-1uha8ag" tabindex="0"> <!> <!></span>'),un=p(`<div class="active-effects-header svelte-1uha8ag"></div> <style>.effect-badge {
              position: relative;
            }
            .effect-tooltip {
              position: absolute;
              top: 120%;
              left: 50%;
              transform: translateX(-50%);
              background: #fff;
              color: #222;
              border: 1px solid #a5b4fc;
              border-radius: 6px;
              padding: 8px 12px;
              font-size: 0.95em;
              box-shadow: 0 2px 8px rgba(0, 0, 0, 0.12);
              z-index: 10;
              min-width: 180px;
              max-width: 260px;
              white-space: normal;
              pointer-events: none;
              opacity: 1;
              transition: opacity 0.15s;
            }</style>`,1),pn=p('<div class="rest-menu svelte-1uha8ag"><button class="rest-option svelte-1uha8ag">â˜• Short Rest</button> <button class="rest-option svelte-1uha8ag">ðŸ›ï¸ Long Rest</button></div>'),fn=p('<div class="container svelte-1uha8ag"><header class="svelte-1uha8ag"><div class="header-top svelte-1uha8ag"><div class="header-title svelte-1uha8ag"><div class="title-row svelte-1uha8ag"><h1 class="svelte-1uha8ag">D&D Character Sheet</h1> <!></div> <!> <!></div> <div class="header-right svelte-1uha8ag"><div class="header-controls svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">ðŸŽ²</span><span class="btn-text svelte-1uha8ag">Roll Dice</span></button> <div class="rest-button-container svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">ðŸ˜´</span><span class="btn-text svelte-1uha8ag">Rest</span></button> <!></div> <div class="mode-toggle"><button><span class="btn-icon svelte-1uha8ag"> </span><span class="btn-text svelte-1uha8ag"> </span></button></div></div> <div class="header-search svelte-1uha8ag"><input type="text" placeholder="ðŸ” Search..." class="search-input use-enabled svelte-1uha8ag"/></div></div></div> <div class="header-actions svelte-1uha8ag"><button class="btn btn-mode svelte-1uha8ag">ðŸ“š Browse Spells & Feats</button> <button class="btn btn-secondary">Save to Gist</button> <button class="btn btn-secondary">Load from Gist</button> <button class="btn btn-secondary">Export JSON</button> <button class="btn btn-secondary">Import JSON</button> <input type="file" accept=".json" style="display: none;"/></div></header> <main class="svelte-1uha8ag"><!> <!> <!> <!> <!> <!> <!></main></div> <!> <!> <!> <!>',1);function xn(a,i){Tt(i,!1);const t=()=>Ze(se,"$character",g),d=()=>Ze(na,"$isEditMode",g),u=()=>Ze(Zt,"$searchFilter",g),[g,h]=qt();function w(){const x=[],R=t().classFeatures.spellSlotsByLevel||{};for(let m=1;m<=9;m++){const Ne=R[m];if(Ne&&Ne.length>0){const de=Ne.length,$e=Ne.filter(Ce=>Ce).length;x.push({level:m,available:de-$e,total:de})}}return x}let k=F(!1),S=F(!1),X=F(!1),W=F("save"),le=F(void 0),re=F(""),J=F(""),ue=F(""),pe=F(!1),Q=F([]),ze=F("other"),Qe=F(),z=!1,Se=F(!1),Z=F(null);function me(x){c(Z,x)}function De(){c(Z,null)}function Re(x){c(Z,e(Z)===x?null:x)}function ke(){const x=[];se.update(m=>{const Ne=m.hitDice.current;m.hitDice.current=Math.min(m.hitDice.max,m.hitDice.current+Math.max(1,Math.floor(m.hitDice.max/2)));const de=m.hitDice.current-Ne;if(de>0&&x.push(`${de} hit ${de===1?"die":"dice"}`),m.class){const $e=oa(m.class,m.level,m.subclass);m.classFeatures.features||(m.classFeatures.features={}),$e.forEach(Ce=>{if(Ce.resetOn==="short"){const at=Ce.name.replace(/\s+/g,"");if(Ce.type==="uses"){const tt=typeof Ce.maxUses=="function"?Ce.maxUses(m.level):Ce.maxUses;m.classFeatures.features[at]=Array(tt).fill(!1),x.push(Ce.name)}else if(Ce.type==="pool"){const tt=typeof Ce.maxPool=="function"?Ce.maxPool(m.level):Ce.maxPool;tt!==void 0&&(m.classFeatures.features[at]=tt,x.push(Ce.name))}}})}return m}),c(Se,!1);const R=x.length>0?`Short rest taken! Restored: ${x.join(", ")}`:"Short rest taken!";Gt.add(R,"success")}function Pe(){const x=[];se.update(m=>{const Ne=m.maxHP-m.currentHP;Ne>0&&x.push(`${Ne} HP`),m.currentHP=m.maxHP,m.tempHP=0;const de=m.hitDice.max-m.hitDice.current;de>0&&x.push(`${de} hit ${de===1?"die":"dice"}`),m.hitDice.current=m.hitDice.max;let $e=0;if(m.classFeatures.spellSlotsByLevel&&Object.keys(m.classFeatures.spellSlotsByLevel).forEach(Ce=>{const at=m.classFeatures.spellSlotsByLevel[parseInt(Ce)];if(at){const tt=at.filter(ut=>ut).length;$e+=tt,m.classFeatures.spellSlotsByLevel[parseInt(Ce)]=Array(at.length).fill(!1)}}),$e>0&&x.push(`${$e} spell ${$e===1?"slot":"slots"}`),m.class){const Ce=oa(m.class,m.level,m.subclass);m.classFeatures.features||(m.classFeatures.features={});let at=!1;Ce.forEach(tt=>{const ut=tt.name.replace(/\s+/g,"");if(!(tt.type==="info"||tt.type==="channelDivinity")){if(tt.type==="uses"){const ot=typeof tt.maxUses=="function"?tt.maxUses(m.level):tt.maxUses;m.classFeatures.features[ut]=Array(ot).fill(!1),at=!0}else if(tt.type==="pool"){const ot=typeof tt.maxPool=="function"?tt.maxPool(m.level):tt.maxPool;ot!==void 0&&(m.classFeatures.features[ut]=ot,at=!0)}}}),at&&x.push("all class features")}return m}),c(Se,!1);const R=x.length>0?`Long rest taken! Restored: ${x.join(", ")}`:"Long rest taken! Fully rested.";Gt.add(R,"success")}function D(x){c(re,""),c(J,""),c(ue,""),c(pe,!1),c(Q,[]),c(ze,"other"),z=!1,typeof x=="string"?c(re,x):(c(re,x.notation),c(J,x.damageNotation||""),c(ue,x.attackName||""),c(pe,!!x.applyHalfDamage),c(Q,x.bonusBreakdown||[]),c(ze,x.rollType||"other")),c(k,!0)}function ge(x){const{notation:R}=x.detail;c(re,""),z=!0,setTimeout(()=>{c(re,R),c(J,""),c(ue,"Hit Die")},0),c(k,!0)}function b(){if(c(k,!1),z&&e(Qe)){const x=e(Qe).getLastRollTotal();if(x!==null){const R=Math.max(1,x);se.update(m=>(m.hitDice.current=Math.max(0,m.hitDice.current-1),m.currentHP=Math.min(m.maxHP,m.currentHP+R),m))}z=!1}}function P(){na.update(x=>!x)}function Y(x){x.target.closest(".rest-button-container")||c(Se,!1)}pa(()=>{const x=na.subscribe(R=>{R?document.body.classList.remove("use-mode"):document.body.classList.add("use-mode")});return document.addEventListener("click",Y),()=>{x(),document.removeEventListener("click",Y)}});function Ke(){bs(t())}function Ge(){e(le)?.click()}async function Ae(x){const m=x.target.files?.[0];if(m)try{const Ne=await _s(m);se.set(Ne),alert("Character imported successfully!")}catch{alert("Failed to import character file")}}Pt();var f=fn();ms("1uha8ag",x=>{var R=an();ra(2),Xa(()=>{fs.title="D&D Character Sheet"}),o(x,R)});var C=Ee(f),G=r(C),oe=r(G),N=r(oe),be=r(N),Ve=s(r(be),2);{var et=x=>{var R=sn(),m=r(R);l(R),M(()=>L(m,`${t().name??""} (${t().level??""})`)),o(x,R)};y(Ve,x=>{t().name&&x(et)})}l(be);var _e=s(be,2);{var Oe=x=>{var R=rn();kt(R,5,w,xt,(m,Ne)=>{var de=ln();let $e;var Ce=r(de);l(de),M(()=>{$e=yt(de,1,"slot-badge svelte-1uha8ag",null,$e,{depleted:e(Ne).available===0}),L(Ce,`Lv${e(Ne).level??""}: ${e(Ne).available??""}/${e(Ne).total??""}`)}),o(m,de)}),l(R),o(x,R)};y(_e,x=>{w().length>0&&x(Oe)})}var A=s(_e,2);{var $=x=>{var R=un(),m=Ee(R);kt(m,5,()=>t().activeStates,xt,(Ne,de,$e)=>{var Ce=dn(),at=r(Ce),tt=s(at);{var ut=nt=>{var ht=cn(),ct=r(ht),st=r(ct,!0);l(ct);var ft=s(ct,2),gt=s(ft,3);{var It=_t=>{var Dt=nn(),Bt=Ee(Dt),Kt=r(Bt);l(Bt),ra(),M(()=>L(Kt,`Attack Bonus: ${typeof e(de).attackBonus=="number"&&e(de).attackBonus>0?"+":""}${e(de).attackBonus??""}`)),o(_t,Dt)};y(gt,_t=>{e(de).attackBonus&&_t(It)})}var Ht=s(gt,2);{var Ut=_t=>{var Dt=on(),Bt=r(Dt);l(Dt),M(()=>L(Bt,`Damage Bonus: ${typeof e(de).damageBonus=="number"&&e(de).damageBonus>0?"+":""}${e(de).damageBonus??""}`)),o(_t,Dt)};y(Ht,_t=>{e(de).damageBonus&&_t(Ut)})}l(ht),M(()=>{L(st,e(de).name),L(ft,` ${e(de).description??""}`)}),o(nt,ht)};y(tt,nt=>{e(Z)===$e&&nt(ut)})}var ot=s(tt,2);{var rt=nt=>{var ht=vn();M(()=>We(ht,"title",`End ${e(de).name??""}`)),I("click",ht,()=>{se.update(ct=>{if(ct.activeStates){const st=ct.activeStates[$e];st?.hpBonus&&st.target!=="other"&&(ct.maxHP-=st.hpBonus,ct.currentHP=Math.max(1,Math.min(ct.currentHP-st.hpBonus,ct.maxHP))),ct.activeStates=ct.activeStates.filter((ft,gt)=>gt!==$e)}return ct})}),o(nt,ht)};y(ot,nt=>{d()||nt(rt)})}l(Ce),M(()=>{We(Ce,"aria-label",e(de).name),L(at,`âœ¨ ${e(de).name??""} `)}),I("mouseenter",Ce,()=>me($e)),I("mouseleave",Ce,De),I("focus",Ce,()=>me($e)),I("blur",Ce,De),I("click",Ce,()=>Re($e)),o(Ne,Ce)}),l(m),ra(2),o(x,R)};y(A,x=>{t().activeStates&&t().activeStates.length>0&&x($)})}l(N);var ae=s(N,2),ee=r(ae),O=r(ee),v=s(O,2),qe=r(v),ce=s(qe,2);{var ne=x=>{var R=pn(),m=r(R),Ne=s(m,2);l(R),I("click",m,ke),I("click",Ne,Pe),o(x,R)};y(ce,x=>{e(Se)&&x(ne)})}l(v);var j=s(v,2),H=r(j);let V;var Fe=r(H),lt=r(Fe,!0);l(Fe);var je=s(Fe),ye=r(je,!0);l(je),l(H),l(j),l(ee);var xe=s(ee,2),Me=r(xe);we(Me),l(xe),l(ae),l(oe);var Te=s(oe,2),Je=r(Te),ie=s(Je,2),he=s(ie,2),Ue=s(he,2),Ye=s(Ue,2),Be=s(Ye,2);ja(Be,x=>c(le,x),()=>e(le)),l(Te),l(G);var _=s(G,2),U=r(_);Rs(U,{});var ve=s(U,2);Hs(ve,{$$events:{roll:x=>D(x.detail)}});var te=s(ve,2);Qs(te,{$$events:{roll:x=>D(x.detail)}});var fe=s(te,2);zs(fe,{$$events:{rollHitDice:ge}});var B=s(fe,2);El(B,{$$events:{roll:x=>D(x.detail)}});var T=s(B,2);tr(T,{});var K=s(T,2);lr(K,{}),l(_),l(C);var Le=s(C,2);ja(_r(Le,{get notation(){return e(re)},get damageNotation(){return e(J)},get attackName(){return e(ue)},get applyHalfDamage(){return e(pe)},get bonusBreakdown(){return e(Q)},get rollType(){return e(ze)},get visible(){return e(k)},$$events:{close:b},$$legacy:!0}),x=>c(Qe,x),()=>e(Qe));var Ie=s(Le,2);{var it=x=>{Hr(x,{get mode(){return e(W)},$$events:{close:()=>c(S,!1)}})};y(Ie,x=>{e(S)&&x(it)})}var q=s(Ie,2);{var pt=x=>{tn(x,{onClose:()=>c(X,!1)})};y(q,x=>{e(X)&&x(pt)})}var wt=s(q,2);hs(wt,{}),M(()=>{V=yt(H,1,"btn btn-mode svelte-1uha8ag",null,V,{"use-mode":!d()}),L(lt,d()?"ðŸ“":"ðŸŽ²"),L(ye,d()?"Edit Mode":"Use Mode")}),I("click",O,()=>{c(Q,[]),c(k,!0)}),I("click",qe,()=>c(Se,!e(Se))),I("click",H,P),He(Me,u,x=>ys(Zt,x)),I("click",Je,()=>c(X,!0)),I("click",ie,()=>{c(W,"save"),c(S,!0)}),I("click",he,()=>{c(W,"load"),c(S,!0)}),I("click",Ue,Ke),I("click",Ye,Ge),I("change",Be,Ae),o(a,f),Et(),h()}export{xn as component};
