import{f as p,e as D,a as o,s as k,c as nt,t as wt}from"../chunks/DN9NmC1v.js";import{i as Et}from"../chunks/Dlg-HS1s.js";import{c as ta,o as oa,a as Qa}from"../chunks/Icie54Zd.js";import{a7 as Na,i as Ua,aZ as Xa,a_ as Ya,a$ as ja,K as Qt,e as Ga,b0 as Oa,T as _a,b1 as Za,b2 as es,q as ts,b3 as as,b4 as ss,b5 as ls,ab as is,d as r,r as qa,g as rs,C as Pt,b6 as Ze,b7 as Kt,F as M,G as Tt,s as c,a4 as I,H as i,J as a,I as l,f as e,E as Oe,m as it,A as U,b8 as $a,b9 as Ct,ba as ra,ao as ga,bb as ns}from"../chunks/swQEjlmu.js";import{c as X,a as Lt,e as pt,i as ft,u as Wa,s as Xt,b as gt,d as ca,f as aa,g as os,t as It,h as cs,T as vs,j as ds,k as us}from"../chunks/DXoUWR_X.js";import{i as _,s as Gt,a as Xe,b as rt,d as da,e as ps}from"../chunks/BEkqXdCA.js";import{p as At,b as Ca}from"../chunks/gdGGBrOz.js";import{b as ia,r as fs}from"../chunks/BYO4FEvm.js";function ba(s,n,t=!1){if(s.multiple){if(n==null)return;if(!Ua(n))return Xa();for(var v of s.options)v.selected=n.includes(na(v));return}for(v of s.options){var f=na(v);if(Ya(f,n)){v.selected=!0;return}}(!t||n!==void 0)&&(s.selectedIndex=-1)}function wa(s){var n=new MutationObserver(()=>{ba(s,s.__value)});n.observe(s,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Na(()=>{n.disconnect()})}function za(s,n,t=n){var v=new WeakSet,f=!0;ja(s,"change",h=>{var C=h?"[selected]":":checked",B;if(s.multiple)B=[].map.call(s.querySelectorAll(C),na);else{var y=s.querySelector(C)??s.querySelector("option:not([disabled])");B=y&&na(y)}t(B),Qt!==null&&v.add(Qt)}),Ga(()=>{var h=n();if(s===document.activeElement){var C=Oa??Qt;if(v.has(C))return}if(ba(s,h,f),f&&h===void 0){var B=s.querySelector(":checked");B!==null&&(h=na(B),t(h))}s.__value=h,f=!1}),wa(s)}function na(s){return"__value"in s?s.__value:s.value}const gs=Symbol("is custom element"),bs=Symbol("is html");function je(s){if(_a){var n=!1,t=()=>{if(!n){if(n=!0,s.hasAttribute("value")){var v=s.value;tt(s,"value",null),s.value=v}if(s.hasAttribute("checked")){var f=s.checked;tt(s,"checked",null),s.checked=f}}};s.__on_r=t,ts(t),as()}}function ma(s,n){var t=Aa(s);t.value===(t.value=n??void 0)||s.value===n&&(n!==0||s.nodeName!=="PROGRESS")||(s.value=n??"")}function ms(s,n){var t=Aa(s);t.checked!==(t.checked=n??void 0)&&(s.checked=n)}function tt(s,n,t,v){var f=Aa(s);_a&&(f[n]=s.getAttribute(n),n==="src"||n==="srcset"||n==="href"&&s.nodeName==="LINK")||f[n]!==(f[n]=t)&&(n==="loading"&&(s[ss]=t),t==null?s.removeAttribute(n):typeof t!="string"&&hs(s).includes(n)?s[n]=t:s.setAttribute(n,t))}function Aa(s){return s.__attributes??={[gs]:s.nodeName.includes("-"),[bs]:s.namespaceURI===Za}}var Ma=new Map;function hs(s){var n=s.getAttribute("is")||s.nodeName,t=Ma.get(n);if(t)return t;Ma.set(n,t=[]);for(var v,f=s,h=Element.prototype;h!==f;){v=ls(f);for(var C in v)v[C].set&&t.push(C);f=es(f)}return t}function Be(s,n,t=n){var v=new WeakSet;ja(s,"input",async f=>{var h=f?s.defaultValue:s.value;if(h=ka(s)?xa(h):h,t(h),Qt!==null&&v.add(Qt),await is(),h!==(h=n())){var C=s.selectionStart,B=s.selectionEnd,y=s.value.length;if(s.value=h??"",B!==null){var P=s.value.length;C===B&&B===y&&P>y?(s.selectionStart=P,s.selectionEnd=P):(s.selectionStart=C,s.selectionEnd=Math.min(B,P))}}}),(_a&&s.defaultValue!==s.value||r(n)==null&&s.value)&&(t(ka(s)?xa(s.value):s.value),Qt!==null&&v.add(Qt)),qa(()=>{var f=n();if(s===document.activeElement){var h=Oa??Qt;if(v.has(h))return}ka(s)&&f===xa(s.value)||s.type==="date"&&!f&&!s.value||f!==s.value&&(s.value=f??"")})}function ha(s,n,t=n){ja(s,"change",v=>{var f=v?s.defaultChecked:s.checked;t(f)}),(_a&&s.defaultChecked!==s.checked||r(n)==null)&&t(s.checked),qa(()=>{var v=n();s.checked=!!v})}function ka(s){var n=s.type;return n==="number"||n==="range"}function xa(s){return s===""?null:+s}function _s(s,n,t){var v=rs(s,n);v&&v.set&&(s[n]=t,Na(()=>{s[n]=null}))}function Fa(s){return function(...n){var t=n[0];return t.stopPropagation(),s?.apply(this,n)}}function sa(s,n){var t=s.$$events?.[n.type],v=Ua(t)?t.slice():t==null?[]:[t];for(var f of v)f.call(this,n)}const ys="";function Ka(...s){return ia+ys+fs(s[0],s[1])}const La={paladin:{name:"Paladin",hitDice:"d10",spellcaster:!0,spellcastingAbility:"charisma",spellSlotsByLevel:{1:0,2:2,3:3,4:3,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Divine Sense",type:"uses",maxUses:(s,n=1)=>1+Math.max(1,n),resetOn:"long",description:"Detect celestials, fiends, and undead within 60 feet",minLevel:1},{name:"Lay on Hands",type:"pool",maxPool:s=>s*5,resetOn:"long",description:"Heal wounds or cure disease",minLevel:1},{name:"Divine Smite",type:"spellSlot",description:"Expend spell slot to deal extra radiant damage",minLevel:2,rollable:!0},{name:"Channel Divinity",type:"pool",maxPool:s=>s>=18?3:s>=6?2:1,resetOn:"short",description:"Sacred Weapon or Turn Undead",minLevel:3}]},fighter:{name:"Fighter",hitDice:"d10",spellcaster:!1,features:[{name:"Second Wind",type:"uses",maxUses:1,resetOn:"short",description:"Regain 1d10 + fighter level HP as bonus action",minLevel:1,rollable:!0,rollFormula:s=>`1d10+${s}`},{name:"Action Surge",type:"uses",maxUses:s=>s>=17?2:1,resetOn:"short",description:"Take one additional action on your turn",minLevel:2},{name:"Indomitable",type:"uses",maxUses:s=>s>=17?3:s>=13?2:1,resetOn:"long",description:"Reroll a failed saving throw",minLevel:9}],subclasses:{champion:{name:"Champion",features:[{name:"Improved Critical",type:"info",description:"Critical hit on 19-20",minLevel:3},{name:"Remarkable Athlete",type:"info",description:"Add half proficiency to STR/DEX/CON checks, increase long jump distance",minLevel:7},{name:"Additional Fighting Style",type:"info",description:"Choose a second fighting style",minLevel:10},{name:"Superior Critical",type:"info",description:"Critical hit on 18-20",minLevel:15},{name:"Survivor",type:"info",description:"Regain 5 + CON mod HP at start of turn if below half HP",minLevel:18}]},battlemaster:{name:"Battle Master",features:[{name:"Combat Superiority",type:"uses",maxUses:s=>s>=15?6:s>=7?5:4,resetOn:"short",description:s=>`Use superiority dice (${s>=18?"d12":s>=10?"d10":"d8"}) for maneuvers`,minLevel:3},{name:"Know Your Enemy",type:"info",description:"Learn capabilities of creatures you observe",minLevel:7},{name:"Improved Combat Superiority",type:"info",description:"Superiority dice become d10",minLevel:10},{name:"Relentless",type:"info",description:"Regain 1 superiority die if you have none at start of turn",minLevel:15}]}}},rogue:{name:"Rogue",hitDice:"d8",spellcaster:!1,features:[{name:"Sneak Attack",type:"info",description:s=>`Deal ${Math.ceil(s/2)}d6 extra damage once per turn with advantage or ally nearby`,minLevel:1,rollable:!0,rollFormula:s=>`${Math.ceil(s/2)}d6`},{name:"Cunning Action",type:"info",description:"Dash, Disengage, or Hide as a bonus action",minLevel:2},{name:"Uncanny Dodge",type:"info",description:"Use reaction to halve damage from an attack",minLevel:5},{name:"Evasion",type:"info",description:"Take no damage on successful Dex save (half on fail)",minLevel:7}]},wizard:{name:"Wizard",hitDice:"d6",spellcaster:!0,spellcastingAbility:"intelligence",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Arcane Recovery",type:"uses",maxUses:1,resetOn:"long",description:s=>`Recover spell slots totaling up to ${Math.ceil(s/2)} levels during short rest`,minLevel:1},{name:"Spell Mastery",type:"info",description:"Cast one 1st-level and one 2nd-level spell at will",minLevel:18}]},cleric:{name:"Cleric",hitDice:"d8",spellcaster:!0,spellcastingAbility:"wisdom",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Channel Divinity",type:"pool",maxPool:s=>s>=18?3:s>=6?2:1,resetOn:"short",description:"Turn Undead or domain-specific ability",minLevel:2},{name:"Destroy Undead",type:"info",description:s=>`Channel Divinity destroys undead of CR ${s>=17?4:s>=14?3:s>=11?2:s>=8?1:.5} or lower`,minLevel:5},{name:"Divine Intervention",type:"uses",maxUses:1,resetOn:"long",description:s=>`${s}% chance to succeed, implore deity for aid`,minLevel:10}],subclasses:{war:{name:"War Domain",features:[{name:"War Priest",type:"uses",maxUses:(s,n=1)=>Math.max(1,n),resetOn:"long",description:"Make one weapon attack as a bonus action",minLevel:1},{name:"Guided Strike",type:"channelDivinity",description:"Use your Channel Divinity to gain +10 to an attack roll. Make this choice after you see the roll, but before the DM says whether the attack hits or misses.",minLevel:2,resetOn:"short"},{name:"War God's Blessing",type:"channelDivinity",description:"Use reaction to grant +10 to an ally's attack roll within 30 feet. Consumes one use of Channel Divinity.",minLevel:6,resetOn:"short"},{name:"Divine Strike",type:"info",description:s=>`Deal extra ${s>=14?"2d8":"1d8"} weapon damage once per turn`,minLevel:8,rollable:!0,rollFormula:s=>s>=14?"2d8":"1d8"},{name:"Avatar of Battle",type:"info",description:"Gain resistance to nonmagical weapon damage",minLevel:17}]},life:{name:"Life Domain",features:[{name:"Disciple of Life",type:"info",description:"Healing spells restore additional 2 + spell level HP",minLevel:1},{name:"Preserve Life",type:"pool",maxPool:s=>s*5,resetOn:"short",description:"Restore HP to creatures within 30 feet",minLevel:2},{name:"Blessed Healer",type:"info",description:"Regain 2 + spell level HP when you cast healing spell",minLevel:6},{name:"Divine Strike",type:"info",description:s=>`Deal extra ${s>=14?"2d8":"1d8"} radiant damage once per turn`,minLevel:8,rollable:!0,rollFormula:s=>s>=14?"2d8":"1d8"},{name:"Supreme Healing",type:"info",description:"Maximize healing dice instead of rolling",minLevel:17}]}}},barbarian:{name:"Barbarian",hitDice:"d12",spellcaster:!1,features:[{name:"Rage",type:"uses",maxUses:s=>s>=20?1/0:s>=17?6:s>=12?5:s>=6?4:s>=3?3:2,resetOn:"long",description:s=>`+${s>=16?4:s>=9?3:2} damage, resistance to physical damage`,minLevel:1},{name:"Reckless Attack",type:"info",description:"Gain advantage on melee attacks, enemies get advantage on you",minLevel:2},{name:"Danger Sense",type:"info",description:"Advantage on Dex saves against effects you can see",minLevel:2}],subclasses:{berserker:{name:"Path of the Berserker",features:[{name:"Frenzy",type:"info",description:"While raging, make melee attack as bonus action (gain 1 exhaustion after rage)",minLevel:3},{name:"Mindless Rage",type:"info",description:"Cannot be charmed or frightened while raging",minLevel:6},{name:"Intimidating Presence",type:"info",description:"Use action to frighten creature within 30 feet",minLevel:10},{name:"Retaliation",type:"info",description:"When damaged by creature within 5 feet, make melee attack as reaction",minLevel:14}]}}}};function Rt(s){const n=s.toLowerCase();return La[n]||null}function la(s,n,t){const v=Rt(s);if(!v)return[];const f=v.features.filter(h=>!h.minLevel||h.minLevel<=n);if(t&&v.subclasses&&v.subclasses[t]){const h=v.subclasses[t].features.filter(C=>!C.minLevel||C.minLevel<=n);return[...f,...h]}return f}function Ba(s){const n=Rt(s);return!n||!n.subclasses?[]:Object.keys(n.subclasses).map(t=>({id:t,name:n.subclasses[t].name}))}function Ia(s,n){const t=Rt(s);return!t||!t.spellcaster||!t.spellSlotsByLevel?0:t.spellSlotsByLevel[n]||0}function Ra(s,n,t){const v=Rt(s);return!v||!v.spellcaster?0:Math.max(1,t+n)}function ks(s,n,t){const v=Rt(s);return!v||!v.spellcaster?null:8+n+t}function xs(){return Object.keys(La).map(s=>({id:s,name:La[s].name}))}var Ss=p("<option> </option>"),$s=p("<option> </option>"),Cs=p('<div class="form-group svelte-172i2fj"><label for="characterSubclass" class="svelte-172i2fj">Subclass</label> <select id="characterSubclass" class="svelte-172i2fj"><option>Select Subclass</option><!></select></div>'),ws=p('<div class="info-grid svelte-172i2fj"><div class="form-group svelte-172i2fj"><label for="characterName" class="svelte-172i2fj">Character Name</label> <input type="text" id="characterName" placeholder="Enter name" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterClass" class="svelte-172i2fj">Class</label> <select id="characterClass" class="svelte-172i2fj"><option>Select Class</option><!></select></div> <!> <div class="form-group svelte-172i2fj"><label for="characterLevel" class="svelte-172i2fj">Level</label> <input type="number" id="characterLevel" min="1" max="20" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterRace" class="svelte-172i2fj">Race</label> <input type="text" id="characterRace" placeholder="e.g., Human" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterBackground" class="svelte-172i2fj">Background</label> <input type="text" id="characterBackground" placeholder="e.g., Soldier" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterAlignment" class="svelte-172i2fj">Alignment</label> <input type="text" id="characterAlignment" placeholder="e.g., Lawful Good" class="svelte-172i2fj"/></div></div>'),Ls=p('<section class="character-info svelte-172i2fj"><div class="header svelte-172i2fj"><h2 class="svelte-172i2fj">Character Info</h2> <button class="collapse-btn svelte-172i2fj"> </button></div> <!></section>');function Ds(s,n){Pt(n,!1);const t=()=>Xe(X,"$character",f),v=()=>Xe(Lt,"$collapsedStates",f),[f,h]=Gt(),C=I(),B=xs();function y(ie){const G=ie.target;X.update(Fe=>(Fe.class=G.value,Fe.subclass="",Fe))}function P(ie){const G=ie.target;X.update(Fe=>(Fe.subclass=G.value,Fe))}function le(ie){const G=ie.target;X.update(Fe=>(Fe.level=parseInt(G.value)||1,Fe)),Wa()}function ee(){Lt.update(ie=>({...ie,characterInfo:!ie.characterInfo}))}Ze(()=>(t(),Ba),()=>{c(C,t().class?Ba(t().class):[])}),Kt(),Et();var T=Ls(),me=i(T),$e=a(i(me),2),Me=i($e,!0);l($e),l(me);var ve=a(me,2);{var Ce=ie=>{var G=ws(),Fe=i(G),Ie=a(i(Fe),2);je(Ie),l(Fe);var fe=a(Fe,2),O=a(i(fe),2),ae=i(O);ae.value=ae.__value="";var we=a(ae);pt(we,1,()=>B,ft,($,Q)=>{var A=Ss(),J=i(A,!0);l(A);var qe={};M(()=>{k(J,(e(Q),r(()=>e(Q).name))),qe!==(qe=(e(Q),r(()=>e(Q).id)))&&(A.value=(A.__value=(e(Q),r(()=>e(Q).id)))??"")}),o($,A)}),l(O);var he;wa(O),l(fe);var Re=a(fe,2);{var S=$=>{var Q=Cs(),A=a(i(Q),2),J=i(A);J.value=J.__value="";var qe=a(J);pt(qe,1,()=>e(C),ft,(_e,ze)=>{var Ue=$s(),ct=i(Ue,!0);l(Ue);var F={};M(()=>{k(ct,(e(ze),r(()=>e(ze).name))),F!==(F=(e(ze),r(()=>e(ze).id)))&&(Ue.value=(Ue.__value=(e(ze),r(()=>e(ze).id)))??"")}),o(_e,Ue)}),l(A);var ue;wa(A),l(Q),M(()=>{ue!==(ue=(t(),r(()=>t().subclass)))&&(A.value=(A.__value=(t(),r(()=>t().subclass)))??"",ba(A,(t(),r(()=>t().subclass))))}),D("change",A,P),o($,Q)};_(Re,$=>{e(C),r(()=>e(C).length>0)&&$(S)})}var ne=a(Re,2),oe=a(i(ne),2);je(oe),l(ne);var de=a(ne,2),m=a(i(de),2);je(m),l(de);var W=a(de,2),Ae=a(i(W),2);je(Ae),l(W);var We=a(W,2),g=a(i(We),2);je(g),l(We),l(G),M(()=>{he!==(he=(t(),r(()=>t().class)))&&(O.value=(O.__value=(t(),r(()=>t().class)))??"",ba(O,(t(),r(()=>t().class)))),ma(oe,(t(),r(()=>t().level)))}),Be(Ie,()=>t().name,$=>rt(X,r(t).name=$,r(t))),D("change",O,y),D("change",oe,le),Be(m,()=>t().race,$=>rt(X,r(t).race=$,r(t))),Be(Ae,()=>t().background,$=>rt(X,r(t).background=$,r(t))),Be(g,()=>t().alignment,$=>rt(X,r(t).alignment=$,r(t))),o(ie,G)};_(ve,ie=>{v(),r(()=>!v().characterInfo)&&ie(Ce)})}l(T),M(()=>{tt($e,"aria-label",(v(),r(()=>v().characterInfo?"Expand":"Collapse"))),k(Me,(v(),r(()=>v().characterInfo?"â–¼":"â–²")))}),D("click",$e,ee),o(s,T),Tt(),h()}var js=p('<div class="ability-card svelte-bbv1xt"><h3 class="svelte-bbv1xt"> </h3> <input type="number" class="ability-score svelte-bbv1xt" min="1" max="30"/> <div class="ability-modifier svelte-bbv1xt"> </div> <button class="roll-btn svelte-bbv1xt">Check</button> <div class="save-row svelte-bbv1xt"><input type="checkbox" class="svelte-bbv1xt"/> <label class="svelte-bbv1xt">Save</label> <button class="roll-btn-small svelte-bbv1xt">Roll</button></div></div>'),As=p('<div class="proficiency-bonus svelte-bbv1xt"><label for="profBonus">Proficiency Bonus</label> <input type="number" id="profBonus" class="prof-input svelte-bbv1xt"/></div> <div class="abilities-grid svelte-bbv1xt"></div>',1),Fs=p('<section><div class="header svelte-bbv1xt"><h2 class="svelte-bbv1xt">Ability Scores</h2> <button class="collapse-btn svelte-bbv1xt"> </button></div> <!></section>');function Ms(s,n){Pt(n,!1);const t=()=>Xe(ca,"$abilityModifiers",C),v=()=>Xe(X,"$character",C),f=()=>Xe(Xt,"$searchFilter",C),h=()=>Xe(Lt,"$collapsedStates",C),[C,B]=Gt(),y=I(),P=I(),le=ta(),ee=[{key:"strength",label:"Strength"},{key:"dexterity",label:"Dexterity"},{key:"constitution",label:"Constitution"},{key:"intelligence",label:"Intelligence"},{key:"wisdom",label:"Wisdom"},{key:"charisma",label:"Charisma"}];function T(){Wa()}function me(O){const ae=t()[O],we=`1d20${ae>=0?"+":""}${ae}`;le("roll",we)}function $e(O){const ae=t()[O],we=v().saveProficiencies[O]?v().proficiencyBonus:0,he=ae+we,Re=`1d20${he>=0?"+":""}${he}`;le("roll",Re)}function Me(){Lt.update(O=>({...O,abilityScores:!O.abilityScores}))}Ze(()=>f(),()=>{c(y,ee.filter(({label:O})=>f()?O.toLowerCase().includes(f().toLowerCase()):!0))}),Ze(()=>(e(y),f()),()=>{c(P,e(y).length>0||!f()||f().toLowerCase().includes("proficiency"))}),Kt(),Et();var ve=Fs();let Ce;var ie=i(ve),G=a(i(ie),2),Fe=i(G,!0);l(G),l(ie);var Ie=a(ie,2);{var fe=O=>{var ae=As(),we=Oe(ae),he=a(i(we),2);je(he),l(we);var Re=a(we,2);pt(Re,5,()=>e(y),ft,(S,ne)=>{let oe=()=>e(ne).key,de=()=>e(ne).label;var m=js(),W=i(m),Ae=i(W,!0);l(W);var We=a(W,2);je(We);var g=a(We,2),$=i(g);l(g);var Q=a(g,2),A=a(Q,2),J=i(A);je(J);var qe=a(J,2),ue=a(qe,2);l(A),l(m),M(_e=>{k(Ae,_e),k($,`${t(),oe(),r(()=>t()[oe()]>=0?"+":"")??""}${t(),oe(),r(()=>t()[oe()])??""}`),tt(J,"id",`${oe()}-save`),tt(qe,"for",`${oe()}-save`)},[()=>(de(),r(()=>de().substring(0,3).toUpperCase()))]),Be(We,()=>v().abilities[oe()],_e=>rt(X,r(v).abilities[oe()]=_e,r(v))),D("change",We,T),D("click",Q,()=>me(oe())),ha(J,()=>v().saveProficiencies[oe()],_e=>rt(X,r(v).saveProficiencies[oe()]=_e,r(v))),D("click",ue,()=>$e(oe())),o(S,m)}),l(Re),Be(he,()=>v().proficiencyBonus,S=>rt(X,r(v).proficiencyBonus=S,r(v))),o(O,ae)};_(Ie,O=>{h(),r(()=>!h().abilityScores)&&O(fe)})}l(ve),M(()=>{Ce=gt(ve,1,"ability-scores svelte-bbv1xt",null,Ce,{hidden:!e(P)}),tt(G,"aria-label",(h(),r(()=>h().abilityScores?"Expand":"Collapse"))),k(Fe,(h(),r(()=>h().abilityScores?"â–¼":"â–²")))}),D("click",G,Me),o(s,ve),Tt(),B()}function Bs(s){return Math.floor((s-10)/2)}function Da(s,n){if(!s.class)return null;const t=Rt(s.class);if(!t||!t.spellcaster||!t.spellcastingAbility)return null;const v=n[t.spellcastingAbility];return 8+s.proficiencyBonus+v}function Is(s,n){if(!s.class)return 0;const t=Rt(s.class);return!t||!t.spellcaster||!t.spellcastingAbility?0:Bs(n[t.spellcastingAbility])}var Rs=p('<input type="number" id="armorClass" class="stat-input svelte-1r5hyyb"/>'),Es=p('<input type="text" id="armorClass" readonly=""/>'),Ps=p('<div class="stat-box svelte-1r5hyyb"><label for="spellSaveDC" class="svelte-1r5hyyb">Spell Save DC</label> <input type="number" id="spellSaveDC" class="stat-input svelte-1r5hyyb" readonly="" title="8 + Proficiency Bonus + Spellcasting Ability Modifier"/></div>'),Ts=p('<span class="hit-dice-type"> </span>'),Hs=p('<div class="stats-grid svelte-1r5hyyb"><div class="stat-box svelte-1r5hyyb"><label for="armorClass" class="svelte-1r5hyyb">Armor Class</label> <!></div> <div class="stat-box svelte-1r5hyyb"><label for="initiative" class="svelte-1r5hyyb">Initiative</label> <input type="number" id="initiative" class="stat-input svelte-1r5hyyb"/></div> <div class="stat-box svelte-1r5hyyb"><label for="speed" class="svelte-1r5hyyb">Speed</label> <input type="text" id="speed" class="stat-input svelte-1r5hyyb"/></div> <!></div> <div class="hp-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Points</h3> <div class="hp-display svelte-1r5hyyb"><div class="hp-inputs svelte-1r5hyyb"><input type="number" class="hp-current svelte-1r5hyyb" min="0"/> <span class="hp-separator svelte-1r5hyyb">/</span> <input type="number" class="hp-max svelte-1r5hyyb" min="0"/></div> <div class="hp-controls svelte-1r5hyyb"><button class="hp-btn svelte-1r5hyyb">âˆ’</button> <button class="hp-btn svelte-1r5hyyb">+</button> <button class="hp-btn svelte-1r5hyyb">âˆ’5</button> <button class="hp-btn svelte-1r5hyyb">+5</button></div></div> <div class="temp-hp svelte-1r5hyyb"><label for="tempHP" class="svelte-1r5hyyb">Temp HP</label> <input type="number" id="tempHP" min="0" class="svelte-1r5hyyb"/></div></div> <div class="hit-dice-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Dice</h3> <div class="hit-dice-display svelte-1r5hyyb"><input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <span>/</span> <input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <!></div> <div class="hit-dice-controls"><label for="hitDiceCount" class="svelte-1r5hyyb">Roll</label> <input type="number" id="hitDiceCount" class="hit-dice-count-input svelte-1r5hyyb" min="1" value="1"/> <button class="btn btn-primary roll-hit-dice use-enabled svelte-1r5hyyb">ðŸŽ² Roll</button></div></div>',1),Ns=p('<section><div class="header svelte-1r5hyyb"><h2 class="svelte-1r5hyyb">Combat Stats</h2> <button class="collapse-btn svelte-1r5hyyb"> </button></div> <!></section>');function Us(s,n){Pt(n,!1);const t=()=>Xe(X,"$character",B),v=()=>Xe(ca,"$abilityModifiers",B),f=()=>Xe(Xt,"$searchFilter",B),h=()=>Xe(Lt,"$collapsedStates",B),C=()=>Xe(aa,"$isEditMode",B),[B,y]=Gt(),P=I(),le=I(),ee=I(),T=ta();function me(O){X.update(ae=>(ae.currentHP=Math.max(0,Math.min(ae.maxHP,ae.currentHP+O)),ae))}function $e(O=1){if(t().hitDice.current<=0){alert("No hit dice remaining!");return}if(!t().class){alert("Please select a class first!");return}const ae=Rt(t().class);if(!ae){alert("Invalid class configuration!");return}const we=Math.min(O,t().hitDice.current),he=ae.hitDice,Re=v().constitution,S=Re>=0?`+${Re}`:`${Re}`,ne=`${we}${he}${S}`;T("rollHitDice",{notation:ne,hitDie:he,count:we})}function Me(){Lt.update(O=>({...O,combatStats:!O.combatStats}))}console.log("Active States:",t().activeStates),Ze(()=>(t(),v()),()=>{c(P,Da(t(),v()))}),Ze(()=>t(),()=>{c(le,t().activeStates&&t().activeStates.length>0?t().activeStates.reduce((O,ae)=>O+(ae.acBonus||0),0):0)}),Ze(()=>f(),()=>{c(ee,!f()||"armor class".includes(f().toLowerCase())||"initiative".includes(f().toLowerCase())||"speed".includes(f().toLowerCase())||"hit points".includes(f().toLowerCase())||"hp".includes(f().toLowerCase())||"hit dice".includes(f().toLowerCase())||"spell save".includes(f().toLowerCase())||"combat".includes(f().toLowerCase()))}),Kt(),Et();var ve=Ns();let Ce;var ie=i(ve),G=a(i(ie),2),Fe=i(G,!0);l(G),l(ie);var Ie=a(ie,2);{var fe=O=>{var ae=Hs(),we=Oe(ae),he=i(we),Re=a(i(he),2);{var S=R=>{var Y=Rs();je(Y),Be(Y,()=>t().armorClass,Pe=>rt(X,r(t).armorClass=Pe,r(t))),o(R,Y)},ne=R=>{var Y=Es();je(Y),M(()=>{ma(Y,(e(le),t(),r(()=>e(le)!==0?`${t().armorClass} â†’ ${t().armorClass+e(le)}`:`${t().armorClass}`))),gt(Y,1,os(e(le)!==0?"stat-input ac-enhanced":"stat-input"),"svelte-1r5hyyb"),tt(Y,"title",e(le)!==0?"Base AC plus active effect bonuses":"Base Armor Class")}),o(R,Y)};_(Re,R=>{C()?R(S):R(ne,!1)})}l(he);var oe=a(he,2),de=a(i(oe),2);je(de),l(oe);var m=a(oe,2),W=a(i(m),2);je(W),l(m);var Ae=a(m,2);{var We=R=>{var Y=Ps(),Pe=a(i(Y),2);je(Pe),l(Y),M(()=>ma(Pe,e(P))),o(R,Y)};_(Ae,R=>{e(P)!==null&&R(We)})}l(we);var g=a(we,2),$=a(i(g),2),Q=i($),A=i(Q);je(A);var J=a(A,4);je(J),l(Q);var qe=a(Q,2),ue=i(qe),_e=a(ue,2),ze=a(_e,2),Ue=a(ze,2);l(qe),l($);var ct=a($,2),F=a(i(ct),2);je(F),l(ct),l(g);var E=a(g,2),j=a(i(E),2),d=i(j);je(d);var Te=a(d,4);je(Te);var ce=a(Te,2);{var xe=R=>{const Y=it(()=>(U(Rt),t(),r(()=>Rt(t().class))));var Pe=nt(),Ye=Oe(Pe);{var He=V=>{const ge=it(()=>(v(),r(()=>v().constitution)));var Ee=Ts(),Ge=i(Ee);l(Ee),M(()=>k(Ge,`(${U(e(Y)),r(()=>e(Y).hitDice)??""}${(e(ge)>=0?`+${e(ge)}`:e(ge))??""})`)),o(V,Ee)};_(Ye,V=>{e(Y)&&V(He)})}o(R,Pe)};_(ce,R=>{t(),r(()=>t().class)&&R(xe)})}l(j);var ye=a(j,2),L=a(i(ye),2),Le=a(L,2);l(ye),l(E),M(()=>{tt(A,"max",(t(),r(()=>t().maxHP))),tt(d,"max",(t(),r(()=>t().hitDice.max))),tt(L,"max",(t(),r(()=>t().hitDice.current))),Le.disabled=(t(),r(()=>t().hitDice.current<=0||!t().class))}),Be(de,()=>t().initiative,R=>rt(X,r(t).initiative=R,r(t))),Be(W,()=>t().speed,R=>rt(X,r(t).speed=R,r(t))),Be(A,()=>t().currentHP,R=>rt(X,r(t).currentHP=R,r(t))),Be(J,()=>t().maxHP,R=>rt(X,r(t).maxHP=R,r(t))),D("click",ue,()=>me(-1)),D("click",_e,()=>me(1)),D("click",ze,()=>me(-5)),D("click",Ue,()=>me(5)),Be(F,()=>t().tempHP,R=>rt(X,r(t).tempHP=R,r(t))),Be(d,()=>t().hitDice.current,R=>rt(X,r(t).hitDice.current=R,r(t))),Be(Te,()=>t().hitDice.max,R=>rt(X,r(t).hitDice.max=R,r(t))),D("input",L,R=>{const Y=R.target,Pe=parseInt(Y.value);Pe>t().hitDice.current&&(Y.value=String(t().hitDice.current)),Pe<1&&(Y.value="1")}),D("click",Le,()=>{const R=document.getElementById("hitDiceCount"),Y=parseInt(R?.value||"1");$e(Y)}),o(O,ae)};_(Ie,O=>{h(),r(()=>!h().combatStats)&&O(fe)})}l(ve),M(()=>{Ce=gt(ve,1,"combat-stats svelte-1r5hyyb",null,Ce,{hidden:!e(ee)}),tt(G,"aria-label",(h(),r(()=>h().combatStats?"Expand":"Collapse"))),k(Fe,(h(),r(()=>h().combatStats?"â–¼":"â–²")))}),D("click",G,Me),o(s,ve),Tt(),y()}const Sa={acrobatics:"dexterity",animalHandling:"wisdom",arcana:"intelligence",athletics:"strength",deception:"charisma",history:"intelligence",insight:"wisdom",intimidation:"charisma",investigation:"intelligence",medicine:"wisdom",nature:"intelligence",perception:"wisdom",performance:"charisma",persuasion:"charisma",religion:"intelligence",sleightOfHand:"dexterity",stealth:"dexterity",survival:"wisdom"};var Gs=p('<div class="skill-row svelte-1f1pl16"><input type="checkbox" class="svelte-1f1pl16"/> <label class="svelte-1f1pl16"> <span class="ability-tag svelte-1f1pl16"> </span></label> <span class="skill-modifier svelte-1f1pl16"> </span> <button class="roll-btn svelte-1f1pl16">Roll</button></div>'),Os=p('<div class="skills-grid svelte-1f1pl16"></div>'),qs=p('<section><div class="header svelte-1f1pl16"><h2 class="svelte-1f1pl16">Skills</h2> <button class="collapse-btn svelte-1f1pl16"> </button></div> <!></section>');function Ws(s,n){Pt(n,!1);const t=()=>Xe(ca,"$abilityModifiers",C),v=()=>Xe(X,"$character",C),f=()=>Xe(Xt,"$searchFilter",C),h=()=>Xe(Lt,"$collapsedStates",C),[C,B]=Gt(),y=I(),P=I(),le=ta(),ee=[{key:"acrobatics",label:"Acrobatics"},{key:"animalHandling",label:"Animal Handling"},{key:"arcana",label:"Arcana"},{key:"athletics",label:"Athletics"},{key:"deception",label:"Deception"},{key:"history",label:"History"},{key:"insight",label:"Insight"},{key:"intimidation",label:"Intimidation"},{key:"investigation",label:"Investigation"},{key:"medicine",label:"Medicine"},{key:"nature",label:"Nature"},{key:"perception",label:"Perception"},{key:"performance",label:"Performance"},{key:"persuasion",label:"Persuasion"},{key:"religion",label:"Religion"},{key:"sleightOfHand",label:"Sleight of Hand"},{key:"stealth",label:"Stealth"},{key:"survival",label:"Survival"}];function T(fe){const O=Sa[fe],ae=t()[O],we=v().skillProficiencies[fe]?v().proficiencyBonus:0;return ae+we}function me(fe){const O=T(fe),ae=`1d20${O>=0?"+":""}${O}`;le("roll",ae)}function $e(){Lt.update(fe=>({...fe,skills:!fe.skills}))}Ze(()=>f(),()=>{c(y,ee.filter(({label:fe})=>f()?fe.toLowerCase().includes(f().toLowerCase()):!0))}),Ze(()=>e(y),()=>{c(P,e(y).length>0)}),Kt(),Et();var Me=qs();let ve;var Ce=i(Me),ie=a(i(Ce),2),G=i(ie,!0);l(ie),l(Ce);var Fe=a(Ce,2);{var Ie=fe=>{var O=Os();pt(O,5,()=>e(y),ft,(ae,we)=>{let he=()=>e(we).key,Re=()=>e(we).label;const S=it(()=>(U(Sa),he(),r(()=>Sa[he()]))),ne=it(()=>(he(),r(()=>T(he()))));var oe=Gs(),de=i(oe);je(de);var m=a(de,2),W=i(m),Ae=a(W),We=i(Ae);l(Ae),l(m);var g=a(m,2),$=i(g);l(g);var Q=a(g,2);l(oe),M(A=>{tt(de,"id",he()),tt(m,"for",he()),k(W,`${Re()??""} `),k(We,`(${A??""})`),k($,`${e(ne)>=0?"+":""}${e(ne)??""}`)},[()=>(U(e(S)),r(()=>e(S).substring(0,3).toUpperCase()))]),ha(de,()=>v().skillProficiencies[he()],A=>rt(X,r(v).skillProficiencies[he()]=A,r(v))),D("click",Q,()=>me(he())),o(ae,oe)}),l(O),o(fe,O)};_(Fe,fe=>{h(),r(()=>!h().skills)&&fe(Ie)})}l(Me),M(()=>{ve=gt(Me,1,"skills svelte-1f1pl16",null,ve,{hidden:!e(P)}),tt(ie,"aria-label",(h(),r(()=>h().skills?"Expand":"Collapse"))),k(G,(h(),r(()=>h().skills?"â–¼":"â–²")))}),D("click",ie,$e),o(s,Me),Tt(),B()}let ua=null,pa=null;async function Ja(){if(ua)return ua;try{return ua=await(await fetch(Ka("/data/spells.json"))).json(),ua||[]}catch(s){return console.error("Failed to load spells:",s),[]}}async function zs(){if(pa)return pa;try{return pa=await(await fetch(Ka("/data/feats.json"))).json(),pa||[]}catch(s){return console.error("Failed to load feats:",s),[]}}function Ea(s,n){if(!n.trim())return s;const t=n.toLowerCase();return s.filter(v=>v.name.toLowerCase().includes(t)||v.school.toLowerCase().includes(t)||v.classes.some(f=>f.toLowerCase().includes(t))||v.description.toLowerCase().includes(t))}function Ks(s,n){return n===null?s:s.filter(t=>t.level===n)}function Js(s,n){if(!n.trim())return s;const t=n.toLowerCase();return s.filter(v=>v.name.toLowerCase().includes(t)||v.description.toLowerCase().includes(t))}function fa(s){const n=s.description,t=/\b(Strength|Dexterity|Constitution|Intelligence|Wisdom|Charisma)\s+saving\s+throw/i,v=n.match(t);if(!v)return null;const f=v[1].toLowerCase(),C=/half\s+(?:as\s+much\s+)?damage\s+on\s+a\s+successful(?:\s+save)?/i.test(n),y=/saving\s+throw\s+or\s+take.*?damage/i.test(n)&&!C;return{ability:f,halfDamageOnSave:C,noDamageOnSave:y}}function Vs(s){const n=s.description;return/(plus|add)\s+your\s+spellcasting\s+(ability\s+)?modifier/i.test(n)}function Pa(s){const n=s.description.toLowerCase(),v=["takes","take","deals","deal","damage equal to","force damage","fire damage","cold damage","lightning damage","thunder damage","acid damage","poison damage","necrotic damage","radiant damage","psychic damage","regain","regains","hit point"].some(C=>n.includes(C));return["bonus to attack","bonus to damage","bonus to ac","gains a +","gain a +","+1 bonus","+2 bonus","+3 bonus","advantage on","becomes a magic weapon"].some(C=>n.includes(C))&&!v}function Qs(s){const n=s.description;let t=0,v=0,f=0,h="";const C=n.match(/\+(\d+)\s+bonus\s+to\s+attack\s+rolls\s+and\s+damage\s+rolls/i);if(C){const y=parseInt(C[1]);t=y,v=y,h=`+${y} to attack and damage rolls`}s.name==="Bless"&&(h="Add 1d4 to attack rolls and saves");const B=n.match(/\+(\d+)\s+bonus\s+to\s+AC/i);return B&&(f=parseInt(B[1]),h=`+${f} to AC`),s.name==="Haste"&&(h="+2 AC, doubled speed, extra action"),h||t!==0||v!==0||f!==0?{attackBonus:t,damageBonus:v,acBonus:f,description:h||s.description.substring(0,100)}:null}var Xs=p('<button class="btn-remove svelte-14o91c5">Ã—</button>'),Ys=p('<div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Bonus</label> <input type="number" class="attack-bonus svelte-14o91c5"/></div>'),Zs=p('<div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Damage</label> <input type="text" placeholder="e.g., 2d6+3" class="attack-damage svelte-14o91c5"/></div>'),el=p('<div class="spell-info-loading svelte-14o91c5">Loading spell info...</div>'),tl=p('<div class="spell-notes svelte-14o91c5"><h4 class="svelte-14o91c5">General Notes</h4> <p> </p></div>'),al=p('<li class="svelte-14o91c5"><strong>At Higher Levels:</strong> </li>'),sl=p('<ul class="svelte-14o91c5"><li class="svelte-14o91c5"><strong>Level:</strong> </li> <li class="svelte-14o91c5"><strong>Casting Time:</strong> </li> <li class="svelte-14o91c5"><strong>Range:</strong> </li> <li class="svelte-14o91c5"><strong>Components:</strong> <!></li> <li class="svelte-14o91c5"><strong>Duration:</strong> <!> </li> <li class="svelte-14o91c5"><strong>Description:</strong> </li> <!></ul>'),ll=p('<span class="scaled-damage svelte-14o91c5" style="margin-left: 8px;"> </span>'),il=p('<span class="scaled-damage svelte-14o91c5">(Half damage)</span>'),rl=p('<span class="scaled-damage svelte-14o91c5">(No damage)</span>'),nl=p('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> <!> <!></label></div>'),ol=p("<option> </option>"),cl=p('<span class="scaled-damage svelte-14o91c5"><!> </span>'),vl=p('<span class="scaled-damage svelte-14o91c5"> </span>'),dl=p('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> Target is Fiend or Undead <!></label></div>'),ul=p('<div class="spell-level-selector svelte-14o91c5"><label class="svelte-14o91c5">Cast at Level:</label> <select class="spell-level-select use-enabled svelte-14o91c5"></select> <!></div> <!>',1),pl=p('<div class="spell-level-selector svelte-14o91c5"><span style="color: #dc3545; font-weight: bold;">No spell slots available!</span></div>'),fl=p('<!> <div class="spell-info svelte-14o91c5"><div class="spell-info-header svelte-14o91c5" role="button" tabindex="0"><h4 class="svelte-14o91c5">Spell Info</h4> <button class="collapse-btn-small svelte-14o91c5"> </button></div> <!></div> <!> <!>',1),gl=p('<div class="spell-info-missing svelte-14o91c5">Spell info not found.</div>'),bl=p('<div class="attack-notes svelte-14o91c5"><label class="svelte-14o91c5">Notes</label> <textarea placeholder="e.g., DC 15 Dex save, Range 120 ft, Concentration" class="notes-input svelte-14o91c5" rows="2"></textarea></div>'),ml=p('<button class="btn btn-primary">Roll Attack</button>'),hl=p('<button class="btn btn-success">Cast Spell</button>'),_l=p('<button class="btn btn-secondary"><!></button>'),yl=p('<button class="btn btn-secondary">Roll Damage</button>'),kl=p('<div class="attack-card svelte-14o91c5"><div class="attack-header svelte-14o91c5"><input type="text" placeholder="Attack name" class="attack-name svelte-14o91c5"/> <!></div> <div class="attack-details svelte-14o91c5"><!> <!> <div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Type</label> <input type="text" placeholder="e.g., slashing" class="attack-type svelte-14o91c5"/></div></div> <!> <!> <div class="attack-actions svelte-14o91c5"><!> <!></div></div>'),xl=p('<p class="no-attacks svelte-14o91c5">No attacks added yet. Click "Add Attack" to create one.</p>'),Sl=p('<p class="no-attacks svelte-14o91c5">No attacks match your search.</p>'),$l=p('<button class="btn-remove svelte-14o91c5">Ã—</button>'),Cl=p('<div class="state-card svelte-14o91c5"><div class="state-header svelte-14o91c5"><input type="text" placeholder="Effect name (e.g., Magic Weapon)" class="state-name svelte-14o91c5"/> <!></div> <div class="state-details svelte-14o91c5"><div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Attack Bonus</label> <input type="number" class="state-bonus svelte-14o91c5"/></div> <div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Damage Bonus</label> <input type="number" class="state-bonus svelte-14o91c5"/></div></div> <div class="state-description svelte-14o91c5"><label class="svelte-14o91c5">Description</label> <input type="text" placeholder="e.g., +1 to attack and damage rolls (Magic Weapon)" class="state-desc-input svelte-14o91c5"/></div></div>'),wl=p('<div class="states-list svelte-14o91c5"></div>'),Ll=p('<p class="no-states svelte-14o91c5">No active effects. Add spell effects that modify your attacks.</p>'),Dl=p('<button class="btn btn-secondary">Add Attack</button> <div class="attacks-list svelte-14o91c5"><!> <!></div> <div class="active-states-section svelte-14o91c5"><h3 class="svelte-14o91c5">Active Spell Effects</h3> <p class="section-description svelte-14o91c5">Effects that modify attack and damage rolls (e.g., Magic Weapon, Bless)</p> <button class="btn btn-secondary">Add Effect</button> <!></div>',1),jl=p('<section><div class="header svelte-14o91c5"><h2 class="svelte-14o91c5">Attacks & Spells</h2> <button class="collapse-btn svelte-14o91c5"> </button></div> <!></section>');function Al(s,n){Pt(n,!1);const t=()=>Xe(X,"$character",B),v=()=>Xe(ca,"$abilityModifiers",B),f=()=>Xe(Xt,"$searchFilter",B),h=()=>Xe(Lt,"$collapsedStates",B),C=()=>Xe(aa,"$isEditMode",B),[B,y]=Gt(),P=I(),le=I(),ee=ta();let T=I({});function me(g){$a(T,e(T)[g]=!e(T)[g]),c(T,{...e(T)})}function $e(g){return g.description.toLowerCase().includes("regain")&&(g.description.toLowerCase().includes("hit point")||g.description.toLowerCase().includes("hp"))}function Me(){X.update(g=>(g.attacks=[...g.attacks,{id:crypto.randomUUID(),name:"",bonus:0,damage:"",damageType:"",notes:""}],g))}function ve(g){X.update($=>($.attacks=$.attacks.filter(Q=>Q.id!==g),$))}function Ce(g){let $=g.damage,Q=!1;if(g.spellRef){const ue=fe(g.spellRef);if(ue&&ue.level>0){const _e=g.castAtLevel||ue.level;if(!O(_e)){It.add(`No level ${_e} spell slots available!`,"error");return}const Ue=fa(ue);Ue&&g.targetSucceededSave&&Ue.noDamageOnSave?$="0":(Q=Ue?.halfDamageOnSave&&g.targetSucceededSave||!1,$=ae(g,ue))}}else if(t().activeStates&&t().activeStates.length>0){let ue=0;for(const _e of t().activeStates)ue+=_e.damageBonus;if(ue!==0&&$){const _e=$.match(/(\d+d\d+)([+-]\d+)?/);if(_e){const[,ze,Ue]=_e,F=(Ue?parseInt(Ue):0)+ue;$=`${ze}${F>=0?"+":""}${F}`}}}const A=[];g.bonus!==0&&A.push({value:g.bonus,source:"base"});let J=g.bonus;if(t().activeStates)for(const ue of t().activeStates)ue.attackBonus!==0&&(A.push({value:ue.attackBonus,source:ue.name.toLowerCase()}),J+=ue.attackBonus);let qe;qe=`1d20${J>=0?"+":""}${J}`,ee("roll",{notation:qe,damageNotation:$,attackName:g.name,applyHalfDamage:Q,bonusBreakdown:A})}function ie(g){if(!g.damage){It.add(`${g.name}: No damage specified`,"error");return}let $=g.damage,Q=!1;const A=[];if(g.spellRef){const J=fe(g.spellRef);if(J&&J.level>0){const qe=g.castAtLevel||J.level;if(!O(qe)){It.add(`No level ${qe} spell slots available!`,"error");return}const _e=fa(J);_e&&g.targetSucceededSave&&_e.noDamageOnSave?$="0":(Q=_e?.halfDamageOnSave&&g.targetSucceededSave||!1,$=ae(g,J))}}else{const J=$.match(/(\d+d\d+)([+-]\d+)?/);if(J){const[,qe,ue]=J,_e=ue?parseInt(ue):0;if(_e!==0&&A.push({value:_e,source:"base"}),t().activeStates&&t().activeStates.length>0){let ze=0;for(const Ue of t().activeStates)Ue.damageBonus!==0&&(A.push({value:Ue.damageBonus,source:Ue.name.toLowerCase()}),ze+=Ue.damageBonus);if(ze!==0){const Ue=_e+ze;$=`${qe}${Ue>=0?"+":""}${Ue}`}}}}ee("roll",{notation:$,attackName:g.name,applyHalfDamage:Q,bonusBreakdown:A})}function G(){Lt.update(g=>({...g,attacks:!g.attacks}))}let Fe=I([]),Ie=I(!1);oa(async()=>{c(Fe,await Ja()),c(Ie,!0)});function fe(g){return e(Fe).find($=>$.name===g)}function O(g){t().classFeatures.spellSlotsByLevel||rt(X,r(t).classFeatures.spellSlotsByLevel={},r(t)),t().classFeatures.spellSlotsByLevel[g]||rt(X,r(t).classFeatures.spellSlotsByLevel[g]=Array(2).fill(!1),r(t));const Q=t().classFeatures.spellSlotsByLevel[g].findIndex(A=>!A);return Q===-1?!1:(X.update(A=>(A.classFeatures.spellSlotsByLevel||(A.classFeatures.spellSlotsByLevel={}),A.classFeatures.spellSlotsByLevel[g]||(A.classFeatures.spellSlotsByLevel[g]=Array(2).fill(!1)),A.classFeatures.spellSlotsByLevel[g][Q]=!0,A)),!0)}function ae(g,$){let Q=g.damage,A=0,J=0;if(Vs($)&&(J+=Is(t(),v())),t().activeStates)for(const j of t().activeStates)J+=j.damageBonus;if($.higherLevelSlot&&g.castAtLevel){const j=$.level,Te=(g.castAtLevel||j)-j;if(Te>0){const ce=$.higherLevelSlot.match(/(\d+)d(\d+)\s+for\s+each.*?level\s+above/i);if(ce){const[,xe]=ce;A+=Te*parseInt(xe)}}}if(g.targetIsFiendOrUndead&&$.description.includes("Fiend or an Undead")){const j=$.description.match(/increases by (\d+)d(\d+) if.*?Fiend or.*?Undead/i);if(j){const[,d]=j;A+=parseInt(d)}}const qe=Q.match(/(\d+)d(\d+)([+-]\d+)?/);if(!qe)return J!==0?J>=0?`${J}`:`${J}`:Q||"0";const[,ue,_e,ze]=qe,Ue=parseInt(ue)+A,F=(ze?parseInt(ze):0)+J;let E=`${Ue}d${_e}`;return F!==0&&(E+=F>=0?`+${F}`:`${F}`),E}function we(g){const $=[];for(let A=g.level;A<=9;A++){const J=t().classFeatures.spellSlotsByLevel?.[A];J&&J.length>0&&$.push(A)}return $}function he(){X.update(g=>(g.activeStates||(g.activeStates=[]),g.activeStates=[...g.activeStates,{name:"",attackBonus:0,damageBonus:0,description:""}],g))}function Re(g){X.update($=>($.activeStates&&($.activeStates=$.activeStates.filter((Q,A)=>A!==g)),$))}function S(g){const $=fe(g.spellRef);if(!$){It.add("Spell not found","error");return}const Q=g.castAtLevel||$.level;if(Q>0&&!O(Q)){It.add(`No level ${Q} spell slots available!`,"error");return}const A=Qs($);if(!A){It.add(`${$.name} cast! Check spell description for effects.`,"info");return}X.update(J=>(J.activeStates||(J.activeStates=[]),J.activeStates=J.activeStates.filter(qe=>qe.name!==$.name),J.activeStates=[...J.activeStates,{name:$.name,attackBonus:A.attackBonus,damageBonus:A.damageBonus,acBonus:A.acBonus,description:A.description}],J)),It.add(`${$.name} cast! Effect added to Active Spell Effects.`,"success")}Ze(()=>(t(),e(T)),()=>{if(t()&&t().attacks)for(const g of t().attacks)g.spellRef&&e(T)[g.id]===void 0&&$a(T,e(T)[g.id]=!0)}),Ze(()=>(t(),f()),()=>{c(P,t().attacks.filter(g=>{if(!f())return!0;const $=f().toLowerCase();return g.name.toLowerCase().includes($)||g.damageType.toLowerCase().includes($)}).sort((g,$)=>!g.spellRef&&$.spellRef?-1:g.spellRef&&!$.spellRef?1:0))}),Ze(()=>(f(),e(P)),()=>{c(le,!f()||e(P).length>0||"attack".includes(f().toLowerCase())||"spell".includes(f().toLowerCase()))}),Kt(),Et();var ne=jl();let oe;var de=i(ne),m=a(i(de),2),W=i(m,!0);l(m),l(de);var Ae=a(de,2);{var We=g=>{var $=Dl(),Q=Oe($),A=a(Q,2),J=i(A);pt(J,1,()=>e(P),j=>j.id,(j,d,Te)=>{var ce=kl(),xe=i(ce),ye=i(xe);je(ye);var L=a(ye,2);{var Le=N=>{var z=Xs();D("click",z,()=>ve(e(d).id)),o(N,z)};_(L,N=>{C()&&N(Le)})}l(xe);var R=a(xe,2),Y=i(R);{var Pe=N=>{var z=Ys(),te=a(i(z),2);je(te),l(z),Be(te,()=>e(d).bonus,Ne=>(e(d).bonus=Ne,Ct(()=>(e(P),t(),f())))),o(N,z)};_(Y,N=>{e(d),r(()=>e(d).bonus!==0&&e(d).bonus!==void 0)&&N(Pe)})}var Ye=a(Y,2);{var He=N=>{var z=Zs(),te=a(i(z),2);je(te),l(z),Be(te,()=>e(d).damage,Ne=>(e(d).damage=Ne,Ct(()=>(e(P),t(),f())))),o(N,z)};_(Ye,N=>{e(d),r(()=>e(d).damage&&e(d).damage.trim()!=="")&&N(He)})}var V=a(Ye,2),ge=a(i(V),2);je(ge),l(V),l(R);var Ee=a(R,2);{var Ge=N=>{var z=nt(),te=Oe(z);{var Ne=Ve=>{var H=el();o(Ve,H)},Se=Ve=>{const H=it(()=>(e(d),r(()=>fe(e(d).spellRef))));var et=nt(),ot=Oe(et);{var yt=q=>{const u=it(()=>(U(fa),U(e(H)),r(()=>fa(e(H)))));var se=fl(),pe=Oe(se);{var at=st=>{var dt=tl(),xt=a(i(dt),2),Nt=i(xt,!0);l(xt),l(dt),M(()=>k(Nt,(e(d),r(()=>e(d).generalNotes)))),o(st,dt)};_(pe,st=>{e(d),r(()=>e(d).generalNotes)&&st(at)})}var ke=a(pe,2),Je=i(ke),Qe=a(i(Je),2),vt=i(Qe,!0);l(Qe),l(Je);var mt=a(Je,2);{var Ht=st=>{var dt=sl(),xt=i(dt),Nt=a(i(xt));l(xt);var Ot=a(xt,2),St=a(i(Ot));l(Ot);var ut=a(Ot,2),Dt=a(i(ut));l(ut);var Ut=a(ut,2),Yt=a(i(Ut)),lt=a(Yt);{var Bt=bt=>{var ht=wt();M(()=>k(ht,`(${U(e(H)),r(()=>e(H).material)??""})`)),o(bt,ht)};_(lt,bt=>{U(e(H)),r(()=>e(H).material)&&bt(Bt)})}l(Ut);var zt=a(Ut,2),Jt=a(i(zt),2);{var Zt=bt=>{var ht=wt("Concentration,");o(bt,ht)};_(Jt,bt=>{U(e(H)),r(()=>e(H).concentration)&&bt(Zt)})}var _t=a(Jt,1,!0);l(zt);var jt=a(zt,2),$t=a(i(jt));l(jt);var qt=a(jt,2);{var Vt=bt=>{var ht=al(),Wt=a(i(ht));l(ht),M(()=>k(Wt,` ${U(e(H)),r(()=>e(H).higherLevelSlot)??""}`)),o(bt,ht)};_(qt,bt=>{U(e(H)),r(()=>e(H).higherLevelSlot)&&bt(Vt)})}l(dt),M(bt=>{k(Nt,` ${U(e(H)),r(()=>e(H).level)??""}`),k(St,` ${U(e(H)),r(()=>e(H).castingTime||e(H).actionType)??""}`),k(Dt,` ${U(e(H)),r(()=>e(H).range)??""}`),k(Yt,` ${bt??""}`),k(_t,(U(e(H)),r(()=>e(H).duration))),k($t,` ${U(e(H)),r(()=>e(H).description)??""}`)},[()=>(U(e(H)),r(()=>e(H).components.join(", ")))]),o(st,dt)};_(mt,st=>{e(T),e(d),r(()=>!e(T)[e(d).id])&&st(Ht)})}l(ke);var kt=a(ke,2);{var Ft=st=>{var dt=nl(),xt=i(dt),Nt=i(xt);je(Nt);var Ot=a(Nt),St=a(Ot);{var ut=lt=>{var Bt=ll(),zt=i(Bt);l(Bt),M(Jt=>k(zt,`(Spell Save DC: ${Jt??""})`),[()=>(U(Da),t(),v(),r(()=>Da(t(),v())))]),o(lt,Bt)};_(St,lt=>{t(),r(()=>t().class)&&lt(ut)})}var Dt=a(St,2);{var Ut=lt=>{var Bt=il();o(lt,Bt)},Yt=lt=>{var Bt=nt(),zt=Oe(Bt);{var Jt=Zt=>{var _t=rl();o(Zt,_t)};_(zt,Zt=>{e(d),U(e(u)),r(()=>e(d).targetSucceededSave&&e(u).noDamageOnSave)&&Zt(Jt)},!0)}o(lt,Bt)};_(Dt,lt=>{e(d),U(e(u)),r(()=>e(d).targetSucceededSave&&e(u).halfDamageOnSave)?lt(Ut):lt(Yt,!1)})}l(xt),l(dt),M(lt=>k(Ot,` Target succeeded on ${lt??""} save `),[()=>(U(e(u)),r(()=>e(u).ability.charAt(0).toUpperCase()+e(u).ability.slice(1)))]),ha(Nt,()=>e(d).targetSucceededSave,lt=>(e(d).targetSucceededSave=lt,Ct(()=>(e(P),t(),f())))),o(st,dt)};_(kt,st=>{e(u)&&st(Ft)})}var Mt=a(kt,2);{var va=st=>{const dt=it(()=>(U(e(H)),r(()=>we(e(H)))));var xt=nt(),Nt=Oe(xt);{var Ot=ut=>{var Dt=ul(),Ut=Oe(Dt),Yt=i(Ut),lt=a(Yt,2);M(()=>{e(d),Ct(()=>{e(dt)})}),pt(lt,5,()=>e(dt),ft,(_t,jt)=>{var $t=ol(),qt=i($t);l($t);var Vt={};M(()=>{k(qt,`Level ${e(jt)??""}`),Vt!==(Vt=e(jt))&&($t.value=($t.__value=e(jt))??"")}),o(_t,$t)}),l(lt);var Bt=a(lt,2);{var zt=_t=>{const jt=it(()=>(e(d),U(e(H)),r(()=>ae(e(d),e(H)))));var $t=cl(),qt=i($t);{var Vt=Wt=>{var ea=wt("Healing");o(Wt,ea)},bt=Wt=>{var ea=wt("Damage");o(Wt,ea)};_(qt,Wt=>{U(e(H)),r(()=>$e(e(H)))?Wt(Vt):Wt(bt,!1)})}var ht=a(qt);l($t),M(()=>k(ht,` ${e(jt)??""}`)),o(_t,$t)};_(Bt,_t=>{e(d),U(e(H)),r(()=>e(d).castAtLevel&&e(d).castAtLevel>e(H).level)&&_t(zt)})}l(Ut);var Jt=a(Ut,2);{var Zt=_t=>{var jt=dl(),$t=i(jt),qt=i($t);je(qt);var Vt=a(qt,2);{var bt=ht=>{const Wt=it(()=>(e(d),U(e(H)),r(()=>ae(e(d),e(H)))));var ea=vl(),Va=i(ea);l(ea),M(()=>k(Va,`(+1d8, total: ${e(Wt)??""})`)),o(ht,ea)};_(Vt,ht=>{e(d),r(()=>e(d).targetIsFiendOrUndead)&&ht(bt)})}l($t),l(jt),ha(qt,()=>e(d).targetIsFiendOrUndead,ht=>(e(d).targetIsFiendOrUndead=ht,Ct(()=>(e(P),t(),f())))),o(_t,jt)};_(Jt,_t=>{U(e(H)),r(()=>e(H).description.includes("Fiend or an Undead"))&&_t(Zt)})}M(()=>{tt(Yt,"for",`castLevel-${e(d),r(()=>e(d).id)??""}`),tt(lt,"id",`castLevel-${e(d),r(()=>e(d).id)??""}`)}),za(lt,()=>e(d).castAtLevel,_t=>(e(d).castAtLevel=_t,Ct(()=>(e(P),t(),f())))),o(ut,Dt)},St=ut=>{var Dt=pl();o(ut,Dt)};_(Nt,ut=>{U(e(dt)),r(()=>e(dt).length>0)?ut(Ot):ut(St,!1)})}o(st,xt)};_(Mt,st=>{U(e(H)),r(()=>e(H).higherLevelSlot&&e(H).level>0)&&st(va)})}M(()=>{tt(Qe,"aria-label",(e(T),e(d),r(()=>e(T)[e(d).id]?"Expand":"Collapse"))),k(vt,(e(T),e(d),r(()=>e(T)[e(d).id]?"â–¼":"â–²")))}),D("click",Je,()=>me(e(d).id)),D("keydown",Je,st=>st.key==="Enter"&&me(e(d).id)),o(q,se)},x=q=>{var u=gl();o(q,u)};_(ot,q=>{e(H)?q(yt):q(x,!1)})}o(Ve,et)};_(te,Ve=>{e(Fe),r(()=>e(Fe).length===0)?Ve(Ne):Ve(Se,!1)})}o(N,z)};_(Ee,N=>{e(d),r(()=>e(d).spellRef)&&N(Ge)})}var K=a(Ee,2);{var De=N=>{var z=bl(),te=a(i(z),2);ra(te),l(z),Be(te,()=>e(d).notes,Ne=>(e(d).notes=Ne,Ct(()=>(e(P),t(),f())))),o(N,z)};_(K,N=>{e(d),r(()=>!e(d).spellRef)&&N(De)})}var Ke=a(K,2),b=i(Ke);{var w=N=>{var z=ml();D("click",z,()=>Ce(e(d))),o(N,z)};_(b,N=>{e(d),r(()=>e(d).bonus!==0||!e(d).spellRef)&&N(w)})}var re=a(b,2);{var Z=N=>{const z=it(()=>(e(d),r(()=>fe(e(d).spellRef))));var te=nt(),Ne=Oe(te);{var Se=H=>{var et=hl();D("click",et,()=>S(e(d))),o(H,et)},Ve=H=>{var et=_l(),ot=i(et);{var yt=q=>{var u=wt("Roll Healing");o(q,u)},x=q=>{var u=wt("Roll Damage");o(q,u)};_(ot,q=>{U(e(z)),r(()=>e(z)&&$e(e(z)))?q(yt):q(x,!1)})}l(et),D("click",et,()=>ie(e(d))),o(H,et)};_(Ne,H=>{U(e(z)),U(Pa),r(()=>e(z)&&Pa(e(z)))?H(Se):H(Ve,!1)})}o(N,te)},be=N=>{var z=yl();D("click",z,()=>ie(e(d))),o(N,z)};_(re,N=>{e(d),e(Ie),r(()=>e(d).spellRef&&e(Ie))?N(Z):N(be,!1)})}l(Ke),l(ce),Be(ye,()=>e(d).name,N=>(e(d).name=N,Ct(()=>(e(P),t(),f())))),Be(ge,()=>e(d).damageType,N=>(e(d).damageType=N,Ct(()=>(e(P),t(),f())))),o(j,ce)});var qe=a(J,2);{var ue=j=>{var d=xl();o(j,d)},_e=j=>{var d=nt(),Te=Oe(d);{var ce=xe=>{var ye=Sl();o(xe,ye)};_(Te,xe=>{e(P),r(()=>e(P).length===0)&&xe(ce)},!0)}o(j,d)};_(qe,j=>{t(),r(()=>t().attacks.length===0)?j(ue):j(_e,!1)})}l(A);var ze=a(A,2),Ue=a(i(ze),4),ct=a(Ue,2);{var F=j=>{var d=wl();pt(d,5,()=>(t(),r(()=>t().activeStates)),ft,(Te,ce,xe)=>{var ye=Cl(),L=i(ye),Le=i(L);je(Le);var R=a(Le,2);{var Y=K=>{var De=$l();D("click",De,()=>Re(xe)),o(K,De)};_(R,K=>{C()&&K(Y)})}l(L);var Pe=a(L,2),Ye=i(Pe),He=a(i(Ye),2);je(He),l(Ye);var V=a(Ye,2),ge=a(i(V),2);je(ge),l(V),l(Pe);var Ee=a(Pe,2),Ge=a(i(Ee),2);je(Ge),l(Ee),l(ye),Be(Le,()=>e(ce).name,K=>(e(ce).name=K,Ct(()=>t()),da(B,"$character"))),Be(He,()=>e(ce).attackBonus,K=>(e(ce).attackBonus=K,Ct(()=>t()),da(B,"$character"))),Be(ge,()=>e(ce).damageBonus,K=>(e(ce).damageBonus=K,Ct(()=>t()),da(B,"$character"))),Be(Ge,()=>e(ce).description,K=>(e(ce).description=K,Ct(()=>t()),da(B,"$character"))),o(Te,ye)}),l(d),o(j,d)},E=j=>{var d=Ll();o(j,d)};_(ct,j=>{t(),r(()=>t().activeStates&&t().activeStates.length>0)?j(F):j(E,!1)})}l(ze),D("click",Q,Me),D("click",Ue,he),o(g,$)};_(Ae,g=>{h(),r(()=>!h().attacks)&&g(We)})}l(ne),M(()=>{oe=gt(ne,1,"attacks svelte-14o91c5",null,oe,{hidden:!e(le)}),tt(m,"aria-label",(h(),r(()=>h().attacks?"Expand":"Collapse"))),k(W,(h(),r(()=>h().attacks?"â–¼":"â–²")))}),D("click",m,G),o(s,ne),Tt(),y()}var Fl=p('<span class="slot-checkbox-x svelte-serp1j">&#8212;</span>'),Ml=p('<label><input type="checkbox" class="slot-checkbox-input svelte-serp1j"/> <span><!></span></label>');function Ta(s,n){Pt(n,!1);const t=()=>Xe(aa,"$isEditMode",v),[v,f]=Gt();let h=At(n,"checked",8,!1),C=At(n,"disabled",8,!1),B=At(n,"className",8,""),y=At(n,"index",8,void 0),P=At(n,"ariaLabel",8,void 0);const le=ta();function ee(Ce){le("change",{checked:Ce.currentTarget.checked,index:y()})}Et();var T=Ml(),me=i(T);je(me);var $e=a(me,2),Me=i($e);{var ve=Ce=>{var ie=Fl();o(Ce,ie)};_(Me,Ce=>{h()&&Ce(ve)})}l($e),l(T),M(()=>{gt(T,1,"slot-checkbox-label "+B()+(t()?"":" not-editable"),"svelte-serp1j"),ms(me,h()),me.disabled=C()||!t(),tt(me,"aria-label",P()),tt(me,"tabindex",t()?0:-1),gt($e,1,`slot-checkbox-custom ${h()?"used":""} ${t()?"":"readonly"}`,"svelte-serp1j")}),D("change",me,ee),o(s,T),Tt(),f()}var Bl=p('<p class="no-features svelte-1kpvv0n">Select a class to see available features</p>'),Il=p('<p class="no-features svelte-1kpvv0n">No class features available at this level</p>'),Rl=p('<div class="spell-slots svelte-1kpvv0n"><label class="svelte-1kpvv0n"> </label> <div class="slots-tracker svelte-1kpvv0n"></div></div>'),El=p('<div class="all-spell-slots"></div>'),Pl=p('<div class="feature-box spellcasting svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"> </h3> <div class="spell-stats svelte-1kpvv0n"><div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Spell Save DC</label> <div class="spell-value svelte-1kpvv0n"> </div></div> <div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <div class="spell-value svelte-1kpvv0n"> </div></div></div> <!> <div class="prepared-spells svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <textarea placeholder="List your prepared spells..." class="svelte-1kpvv0n"></textarea></div></div>'),Tl=p('<p class="unlimited svelte-1kpvv0n">Unlimited Uses</p>'),Hl=p('<div class="slots-tracker svelte-1kpvv0n"></div> <div class="uses-actions-row"><button class="btn btn-primary use-enabled"> </button></div> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div>',1),Nl=p('<div class="uses-tracker svelte-1kpvv0n"><!></div>'),Ul=p('<div class="pool-tracker svelte-1kpvv0n"><input type="number" min="0" class="pool-input svelte-1kpvv0n"/> <span> </span> <button class="btn-small svelte-1kpvv0n"> </button></div>'),Gl=p('<p class="no-uses svelte-1kpvv0n">No Channel Divinity uses remaining</p>'),Ol=p('<div class="channel-divinity-option svelte-1kpvv0n"><button class="btn btn-primary use-enabled svelte-1kpvv0n">Use Channel Divinity</button> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div> <!></div>'),ql=p('<div class="feature-box svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"><!> </h3> <p class="feature-description svelte-1kpvv0n"> </p> <!></div>'),Wl=p('<div class="features-grid svelte-1kpvv0n"><!> <!></div>'),zl=p('<section><div class="header svelte-1kpvv0n"><h2 class="svelte-1kpvv0n">Class Features</h2> <button class="collapse-btn svelte-1kpvv0n"> </button></div> <!></section>');function Kl(s,n){Pt(n,!1);const t=()=>Xe(X,"$character",C),v=()=>Xe(ca,"$abilityModifiers",C),f=()=>Xe(Xt,"$searchFilter",C),h=()=>Xe(Lt,"$collapsedStates",C),[C,B]=Gt(),y=I(),P=I(),le=I(),ee=I(),T=I(),me=I(),$e=I();let Me=I(0),ve=I(0);function Ce(m,W){X.update(Ae=>(Ae.classFeatures.features[m]=W,Ae))}function ie(){X.update(m=>(m.classFeatures.spellSlotsByLevel||(m.classFeatures.spellSlotsByLevel={}),e(ee).forEach(({level:W,slots:Ae})=>{m.classFeatures.spellSlotsByLevel[W]||(m.classFeatures.spellSlotsByLevel[W]=Array(Ae).fill(!1))}),m))}function G(m){if(typeof m.maxUses=="function"){if((m.name==="Divine Sense"||m.name==="War Priest")&&e(y)?.spellcastingAbility){const W=v()[e(y).spellcastingAbility];return m.maxUses(t().level,W)}return m.maxUses(t().level)}return m.maxUses||0}function Fe(m,W){X.update(Ae=>((!Ae.classFeatures.features[m]||!Array.isArray(Ae.classFeatures.features[m])||Ae.classFeatures.features[m].length!==W)&&(Ae.classFeatures.features[m]=Array(W).fill(!1)),Ae))}Qa(()=>{e(me)&&t()&&t().classFeatures&&t().classFeatures.features&&e(me).forEach(m=>{if(m.type==="uses"){const W=m.name.replace(/\s+/g,""),Ae=G(m),We=t().classFeatures.features[W];(!Array.isArray(We)||We.length!==Ae)&&Fe(W,Ae)}})});function Ie(m){return typeof m.maxPool=="function"?m.maxPool(t().level):m.maxPool||0}function fe(m){return typeof m.description=="function"?m.description(t().level):m.description}function O(){const m="ChannelDivinity";X.update(W=>{const Ae=W.classFeatures.features[m];return typeof Ae=="number"&&Ae>0&&(W.classFeatures.features[m]=Ae-1),W})}function ae(){Lt.update(m=>({...m,classFeatures:!m.classFeatures}))}Ze(()=>(t(),Rt),()=>{c(y,t().class?Rt(t().class):null)}),Ze(()=>(t(),la),()=>{c(P,t().class?la(t().class,t().level,t().subclass):[])}),Ze(()=>(t(),Ia),()=>{c(le,t().class?Ia(t().class,t().level):0)}),Ze(()=>(e(y),t()),()=>{c(ee,(()=>{if(!e(y)?.spellcaster)return[];const m=t().level,W=[];return m>=1&&W.push({level:1,slots:Math.min(4,2+Math.floor(m/3))}),m>=3&&W.push({level:2,slots:Math.min(3,2+Math.floor((m-3)/4))}),m>=5&&W.push({level:3,slots:Math.min(3,2+Math.floor((m-5)/5))}),m>=7&&W.push({level:4,slots:Math.min(3,1+Math.floor((m-7)/6))}),m>=9&&W.push({level:5,slots:Math.min(2,1+Math.floor((m-9)/8))}),m>=11&&W.push({level:6,slots:1}),m>=13&&W.push({level:7,slots:1}),m>=15&&W.push({level:8,slots:1}),m>=17&&W.push({level:9,slots:1}),W})())}),Ze(()=>(e(y),v(),t(),Ra),()=>{if(e(y)?.spellcaster&&e(y).spellcastingAbility){const m=v()[e(y).spellcastingAbility];c(Me,ks(t().class,m,t().proficiencyBonus)||0),c(ve,Ra(t().class,t().level,m))}}),Ze(()=>(t(),e(y),e(ee)),()=>{t().class&&e(y)?.spellcaster&&e(ee).length>0&&ie()}),Ze(()=>t(),()=>{c(T,(()=>{const W=t().classFeatures.features["ChannelDivinity"];return typeof W=="number"?W:0})())}),Ze(()=>(e(P),f()),()=>{c(me,e(P).filter(m=>{if(!f())return!0;const W=f().toLowerCase();return m.name.toLowerCase().includes(W)||fe(m).toLowerCase().includes(W)}))}),Ze(()=>(f(),t(),e(me)),()=>{c($e,!f()||t().class||"class features".includes(f().toLowerCase())||"spellcasting".includes(f().toLowerCase())||e(me).length>0)}),Kt(),Et();var we=zl();let he;var Re=i(we),S=a(i(Re),2),ne=i(S,!0);l(S),l(Re);var oe=a(Re,2);{var de=m=>{var W=nt(),Ae=Oe(W);{var We=$=>{var Q=Bl();o($,Q)},g=$=>{var Q=nt(),A=Oe(Q);{var J=ue=>{var _e=Il();o(ue,_e)},qe=ue=>{var _e=Wl(),ze=i(_e);{var Ue=F=>{var E=Pl(),j=i(E),d=i(j);l(j);var Te=a(j,2),ce=i(Te),xe=a(i(ce),2),ye=i(xe,!0);l(xe),l(ce);var L=a(ce,2),Le=a(i(L),2),R=i(Le,!0);l(Le),l(L),l(Te);var Y=a(Te,2);{var Pe=V=>{var ge=El();pt(ge,5,()=>e(ee),ft,(Ee,Ge)=>{let K=()=>e(Ge).level,De=()=>e(Ge).slots;const Ke=it(()=>(t(),K(),De(),r(()=>t().classFeatures.spellSlotsByLevel?.[K()]||Array(De()).fill(!1))));var b=Rl(),w=i(b),re=i(w);l(w);var Z=a(w,2);pt(Z,5,()=>e(Ke),ft,(be,N,z)=>{{let te=it(()=>(U(e(Ke)),r(()=>e(Ke)[z]||!1)));Ta(be,{get checked(){return e(te)},$$events:{change:Ne=>{X.update(Se=>(Se.classFeatures.spellSlotsByLevel||(Se.classFeatures.spellSlotsByLevel={}),Se.classFeatures.spellSlotsByLevel[K()]||(Se.classFeatures.spellSlotsByLevel[K()]=Array(De()).fill(!1)),Se.classFeatures.spellSlotsByLevel[K()][z]=Ne.detail.checked,Se))}}})}}),l(Z),l(b),M(()=>k(re,`${K()===1?"1st":K()===2?"2nd":K()===3?"3rd":`${K()}th`} Level Spell Slots`)),o(Ee,b)}),l(ge),o(V,ge)};_(Y,V=>{e(ee),r(()=>e(ee).length>0)&&V(Pe)})}var Ye=a(Y,2),He=a(i(Ye),2);ra(He),l(Ye),l(E),M(V=>{k(d,`Spellcasting (${V??""})`),k(ye,e(Me)),k(R,e(ve))},[()=>(e(y),r(()=>e(y).spellcastingAbility?.toUpperCase()))]),Be(He,()=>t().classFeatures.preparedSpells,V=>rt(X,r(t).classFeatures.preparedSpells=V,r(t))),o(F,E)};_(ze,F=>{e(y),r(()=>e(y)?.spellcaster)&&F(Ue)})}var ct=a(ze,2);pt(ct,1,()=>e(me),ft,(F,E)=>{const j=it(()=>(e(E),r(()=>e(E).name.replace(/\s+/g,"")))),d=it(()=>(t(),U(e(j)),r(()=>t().classFeatures.features[e(j)]))),Te=it(()=>typeof e(d)=="number");var ce=ql(),xe=i(ce),ye=i(xe);{var L=V=>{var ge=wt("Channel Divinity:");o(V,ge)};_(ye,V=>{e(E),r(()=>e(E).type==="channelDivinity")&&V(L)})}var Le=a(ye);l(xe);var R=a(xe,2),Y=i(R,!0);l(R);var Pe=a(R,2);{var Ye=V=>{const ge=it(()=>(e(E),r(()=>G(e(E))))),Ee=it(()=>(U(e(d)),U(e(ge)),r(()=>Array.isArray(e(d))?e(d):Array(e(ge)).fill(!1))));var Ge=Nl(),K=i(Ge);{var De=b=>{var w=Tl();o(b,w)},Ke=b=>{var w=Hl(),re=Oe(w);pt(re,5,()=>e(Ee),ft,(Se,Ve,H)=>{Ta(Se,{get checked(){return e(Ve)},index:H,$$events:{change:et=>{X.update(ot=>(ot.classFeatures.features[e(j)]||(ot.classFeatures.features[e(j)]=Array(e(ge)).fill(!1)),ot.classFeatures.features[e(j)][H]=et.detail.checked,ot))}}})}),l(re);var Z=a(re,2),be=i(Z),N=i(be);l(be),l(Z);var z=a(Z,2),te=i(z),Ne=i(te);l(te),l(z),M(Se=>{be.disabled=Se,k(N,`Use ${e(E),r(()=>e(E).name)??""}`),k(Ne,`Resets on ${e(E),r(()=>e(E).resetOn==="short"?"Short Rest":"Long Rest")??""}`)},[()=>(U(e(Ee)),r(()=>e(Ee).filter(Se=>!Se).length<=0))]),D("click",be,()=>{X.update(Se=>{Se.classFeatures.features[e(j)]||(Se.classFeatures.features[e(j)]=Array(e(ge)).fill(!1));const Ve=Se.classFeatures.features[e(j)],H=Ve.findIndex(et=>!et);return H!==-1&&(Ve[H]=!0),Se})}),o(b,w)};_(K,b=>{e(ge)===1/0?b(De):b(Ke,!1)})}l(Ge),o(V,Ge)},He=V=>{var ge=nt(),Ee=Oe(ge);{var Ge=De=>{const Ke=it(()=>(e(E),r(()=>Ie(e(E)))));var b=Ul(),w=i(b);je(w);var re=a(w,2),Z=i(re);l(re);var be=a(re,2),N=i(be,!0);l(be),l(b),M(()=>{ma(w,e(Te)&&e(d)!==void 0?e(d):e(Ke)),tt(w,"max",e(Ke)),k(Z,`/ ${e(Ke)??""}`),k(N,(e(E),r(()=>e(E).resetOn==="short"?"Short Rest":"Long Rest")))}),D("input",w,z=>{X.update(te=>(te.classFeatures.features[e(j)]=parseInt(z.currentTarget.value)||0,te))}),D("click",be,()=>Ce(e(j),e(Ke))),o(De,b)},K=De=>{var Ke=nt(),b=Oe(Ke);{var w=re=>{var Z=Ol(),be=i(Z),N=a(be,2),z=i(N),te=i(z);l(z),l(N);var Ne=a(N,2);{var Se=Ve=>{var H=Gl();o(Ve,H)};_(Ne,Ve=>{e(T)<=0&&Ve(Se)})}l(Z),M(()=>{be.disabled=e(T)<=0,k(te,`Resets on ${e(E),r(()=>e(E).resetOn==="short"?"Short Rest":"Long Rest")??""}`)}),D("click",be,O),o(re,Z)};_(b,re=>{e(E),r(()=>e(E).type==="channelDivinity")&&re(w)},!0)}o(De,Ke)};_(Ee,De=>{e(E),r(()=>e(E).type==="pool")?De(Ge):De(K,!1)},!0)}o(V,ge)};_(Pe,V=>{e(E),r(()=>e(E).type==="uses")?V(Ye):V(He,!1)})}l(ce),M(V=>{k(Le,` ${e(E),r(()=>e(E).name)??""}`),k(Y,V)},[()=>(e(E),r(()=>fe(e(E))))]),o(F,ce)}),l(_e),o(ue,_e)};_(A,ue=>{e(P),r(()=>e(P).length===0)?ue(J):ue(qe,!1)},!0)}o($,Q)};_(Ae,$=>{t(),r(()=>!t().class)?$(We):$(g,!1)})}o(m,W)};_(oe,m=>{h(),r(()=>!h().classFeatures)&&m(de)})}l(we),M(()=>{he=gt(we,1,"class-features svelte-1kpvv0n",null,he,{hidden:!e($e)}),tt(S,"aria-label",(h(),r(()=>h().classFeatures?"Expand":"Collapse"))),k(ne,(h(),r(()=>h().classFeatures?"â–¼":"â–²")))}),D("click",S,ae),o(s,we),Tt(),B()}var Jl=p('<textarea placeholder="Enter features, traits, and special abilities..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Equipment</h3> <textarea placeholder="List your equipment and inventory..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Notes</h3> <textarea placeholder="Additional notes..." class="svelte-wttn0l"></textarea>',1),Vl=p('<section><div class="header svelte-wttn0l"><h2 class="svelte-wttn0l">Features & Traits</h2> <button class="collapse-btn svelte-wttn0l"> </button></div> <!></section>');function Ql(s,n){Pt(n,!1);const t=()=>Xe(Xt,"$searchFilter",h),v=()=>Xe(X,"$character",h),f=()=>Xe(Lt,"$collapsedStates",h),[h,C]=Gt(),B=I();function y(){Lt.update(ve=>({...ve,notes:!ve.notes}))}Ze(()=>(t(),v()),()=>{c(B,!t()||"features".includes(t().toLowerCase())||"traits".includes(t().toLowerCase())||"equipment".includes(t().toLowerCase())||"notes".includes(t().toLowerCase())||v().features.toLowerCase().includes(t().toLowerCase())||v().equipment.toLowerCase().includes(t().toLowerCase())||v().notes.toLowerCase().includes(t().toLowerCase()))}),Kt(),Et();var P=Vl();let le;var ee=i(P),T=a(i(ee),2),me=i(T,!0);l(T),l(ee);var $e=a(ee,2);{var Me=ve=>{var Ce=Jl(),ie=Oe(Ce);ra(ie);var G=a(ie,4);ra(G);var Fe=a(G,4);ra(Fe),Be(ie,()=>v().features,Ie=>rt(X,r(v).features=Ie,r(v))),Be(G,()=>v().equipment,Ie=>rt(X,r(v).equipment=Ie,r(v))),Be(Fe,()=>v().notes,Ie=>rt(X,r(v).notes=Ie,r(v))),o(ve,Ce)};_($e,ve=>{f(),r(()=>!f().notes)&&ve(Me)})}l(P),M(()=>{le=gt(P,1,"notes svelte-wttn0l",null,le,{hidden:!e(B)}),tt(T,"aria-label",(f(),r(()=>f().notes?"Expand":"Collapse"))),k(me,(f(),r(()=>f().notes?"â–¼":"â–²")))}),D("click",T,y),o(s,P),Tt(),C()}var Xl=p('<div class="color-picker-section svelte-1r90jgp"><h3 class="svelte-1r90jgp">Dice Colors</h3> <div class="color-inputs svelte-1r90jgp"><div class="color-input-group svelte-1r90jgp"><label for="dice-color" class="svelte-1r90jgp">Dice Color</label> <input type="color" id="dice-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="label-color" class="svelte-1r90jgp">Label Color</label> <input type="color" id="label-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="desk-color" class="svelte-1r90jgp">Background Color</label> <input type="color" id="desk-color" class="svelte-1r90jgp"/></div></div></div>'),Yl=p('<div class="loading svelte-1r90jgp"><p class="svelte-1r90jgp">Loading 3D dice...</p></div>'),Zl=p('<div class="custom-dice-selector svelte-1r90jgp"><h3 class="svelte-1r90jgp">Choose Dice to Roll</h3> <div class="dice-inputs svelte-1r90jgp"><div class="dice-input-group svelte-1r90jgp"><label for="d4" class="svelte-1r90jgp">d4</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d4" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d6" class="svelte-1r90jgp">d6</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d6" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d8" class="svelte-1r90jgp">d8</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d8" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d10" class="svelte-1r90jgp">d10</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d10" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d12" class="svelte-1r90jgp">d12</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d12" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d20" class="svelte-1r90jgp">d20</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d20" min="0" max="10"/></div></div> <div class="dice-controls svelte-1r90jgp"><button class="btn btn-primary use-enabled svelte-1r90jgp"> </button> <button class="btn btn-secondary use-enabled svelte-1r90jgp">Reset</button></div></div>'),ei=p('<span class="crit-badge svelte-1r90jgp">CRITICAL!</span>'),ti=p('<p class="svelte-1r90jgp"> </p>'),ai=p('<div class="bonus-item svelte-1r90jgp"><span class="bonus-value svelte-1r90jgp"> </span> <span class="bonus-source svelte-1r90jgp"> </span></div>'),si=p('<div class="bonus-breakdown svelte-1r90jgp"></div>'),li=p('<p class="modifier-text svelte-1r90jgp"> </p>'),ii=p('<button class="btn btn-follow-up svelte-1r90jgp"> </button>'),ri=p('<button class="btn btn-guided-strike svelte-1r90jgp">âš¡ Use Guided Strike (+10)</button>'),ni=p('<div class="follow-up-actions svelte-1r90jgp"><!> <!></div>'),oi=p('<div class="result-header svelte-1r90jgp"><h3 class="svelte-1r90jgp"> </h3> <!></div> <div class="result-total svelte-1r90jgp"> </div> <div class="result-details svelte-1r90jgp"><!> <!></div> <!>',1),ci=p('<div role="button" tabindex="-1"><div class="modal-content svelte-1r90jgp" role="dialog" tabindex="0"><div class="modal-header svelte-1r90jgp"><h2 class="svelte-1r90jgp">Dice Roller</h2> <div class="header-buttons svelte-1r90jgp"><button class="color-btn svelte-1r90jgp" title="Customize dice colors">ðŸŽ¨</button> <button class="close-btn svelte-1r90jgp">Ã—</button></div></div> <!> <!> <div class="dice-main-area svelte-1r90jgp"><div class="dice-container svelte-1r90jgp"></div> <!></div> <div><!></div></div></div>');function vi(s,n){Pt(n,!1);const t=()=>Xe(X,"$character",v),[v,f]=Gt(),h=I(),C=I(),B=I(),y=ta();let P=At(n,"notation",12,""),le=At(n,"visible",8,!1),ee=At(n,"damageNotation",12,""),T=At(n,"attackName",12,""),me=At(n,"applyHalfDamage",8,!1),$e=At(n,"bonusBreakdown",28,()=>[]),Me=null,ve=I(void 0),Ce=I(!1),ie=I(""),G=I(null);function Fe(){return e(G)?.resultTotal??null}let Ie=I(0),fe=I(0),O=I(0),ae=I(0),we=I(0),he=I(0),Re=I(0),S=I([]),ne=I(!1),oe=I("other"),de=I(!1),m=I("#051e0a"),W=I("#ffffff"),Ae=I("#3a2004"),We=I(!1);function g(b){return b.length===9&&b.startsWith("#")?b.substring(0,7):b}function $(b,w="ff"){return b.length===7&&b.startsWith("#")?b+w:b}function Q(){if(window.DICE&&e(ve))try{Me&&e(ve)&&$a(ve,e(ve).innerHTML="");const b=e(ve).clientWidth||500,w=e(ve).clientHeight||300;Me=new window.DICE.dice_box(e(ve),{w:b,h:w}),c(Ce,!0)}catch(b){console.error("Error initializing dice box:",b)}}oa(()=>{const b=Z=>new Promise((be,N)=>{if(document.querySelector(`script[src="${Z}"]`)){console.log(`Script already loaded: ${Z}`),be(null);return}const te=document.createElement("script");te.src=Z,te.onload=()=>{console.log(`Loaded: ${Z}`),be(null)},te.onerror=()=>{console.error(`Failed to load: ${Z}`),N(new Error(`Failed to load ${Z}`))},document.head.appendChild(te)});setTimeout(()=>{b(`${ia}/libs/three.min.js`).then(()=>b(`${ia}/libs/cannon.min.js`)).then(()=>b(`${ia}/libs/teal.js`)).then(()=>b(`${ia}/dice.js`)).then(()=>{if(console.log("All scripts loaded, initializing dice box..."),console.log("DICE available:",!!window.DICE),console.log("Container available:",!!e(ve)),window.DICE){const Z=window.DICE.getColors();c(m,g(Z.dice_color)),c(W,g(Z.label_color)),c(Ae,g(Z.desk_color))}Q()}).catch(Z=>{console.error("Failed to load dice libraries:",Z)})},100);const w=()=>{e(Ce)&&(console.log("Window resized, reinitializing dice box..."),Q())},re=Z=>{le()&&Z.key==="Escape"&&F()};return window.addEventListener("resize",w),window.addEventListener("keydown",re),()=>{window.removeEventListener("resize",w),window.removeEventListener("keydown",re)}});function A(b,w="other"){if(!Me||!e(Ce))return;console.log("Rolling dice:",b,"type:",w),c(G,null),c(S,[]),c(ne,!1),w==="damage"&&$e([]),c(oe,w),c(de,!1),Me.diceToRoll=b;const re=be=>(console.log("Before roll:",be),null),Z=be=>{console.log("After roll:",be);let N=be.resultTotal,z=be.resultString;if(me()&&(N=Math.floor(N/2),z=z+" (halved)"),c(G,{...be,resultTotal:N,resultString:z}),w==="attack"||w==="check"||w==="save"){const te=be.result?.filter(Ne=>Ne===20)||[];if(te.length>0){const Ne=te[0];c(ne,Ne===20)}}if(c(S,[]),console.log("Setting up follow-up actions. Type:",w,"damageNotation:",ee(),"isCritical:",e(ne)),w==="attack")if(ee()){if(e(ne)){const te=ue(ee());console.log("Creating critical damage button:",te),e(S).push({label:`Roll Critical Damage (${te})`,notation:te})}else console.log("Creating normal damage button:",ee()),e(S).push({label:`Roll Damage (${ee()})`,notation:ee()});console.log("Follow-up actions after setup:",e(S))}else console.log("No damageNotation provided for attack roll");console.log("Final followUpActions:",e(S))};Me.start_throw(re,Z)}function J(){const b=[];e(Ie)>0&&b.push(`${e(Ie)}d4`),e(fe)>0&&b.push(`${e(fe)}d6`),e(O)>0&&b.push(`${e(O)}d8`),e(ae)>0&&b.push(`${e(ae)}d10`),e(we)>0&&b.push(`${e(we)}d12`),e(he)>0&&b.push(`${e(he)}d20`);let w=b.join("+")||"1d20";return e(Re)!==0&&(w+=e(Re)>=0?`+${e(Re)}`:`${e(Re)}`),w}function qe(){const b=J();A(b)}function ue(b){return b.replace(/(\d+)d(\d+)/g,(w,re,Z)=>`${parseInt(re)*2}d${Z}`)}function _e(){c(Ie,0),c(fe,0),c(O,0),c(ae,0),c(we,0),c(he,0),c(Re,0),c(G,null),c(S,[]),c(ne,!1),c(oe,"other"),c(de,!1)}function ze(){window.DICE&&(window.DICE.setColors({dice_color:$(e(m),"ff"),label_color:$(e(W),"ff"),desk_color:e(Ae)}),Me&&(Me.updateDeskColor(e(Ae)),Me.updateDiceColors()))}function Ue(){c(We,!e(We))}function ct(){!e(G)||e(C)<=0||e(de)||(c(G,{...e(G),resultTotal:e(G).resultTotal+10,resultString:e(G).resultString+" + 10 (Guided Strike)"}),X.update(b=>{const w="ChannelDivinity",re=b.classFeatures.features[w];return typeof re=="number"&&re>0&&(b.classFeatures.features[w]=re-1),b}),c(de,!0))}function F(){y("close"),P(""),ee(""),T(""),c(ie,""),c(G,null),c(de,!1),_e()}Ze(()=>(t(),la),()=>{c(h,t().class?la(t().class,t().level,t().subclass).some(w=>w.name==="Guided Strike"):!1)}),Ze(()=>t(),()=>{c(C,(()=>{const w=t().classFeatures.features["ChannelDivinity"];return typeof w=="number"?w:0})())}),Ze(()=>(e(Ie),e(fe),e(O),e(ae),e(we),e(he),e(Re)),()=>{c(B,(()=>{const b=[];e(Ie)>0&&b.push(`${e(Ie)}d4`),e(fe)>0&&b.push(`${e(fe)}d6`),e(O)>0&&b.push(`${e(O)}d8`),e(ae)>0&&b.push(`${e(ae)}d10`),e(we)>0&&b.push(`${e(we)}d12`),e(he)>0&&b.push(`${e(he)}d20`);let w=b.join("+")||"1d20";return e(Re)!==0&&(w+=e(Re)>=0?`+${e(Re)}`:`${e(Re)}`),w})())}),Ze(()=>(U(P()),e(Ce),U(le()),e(ie),U(ee()),U(T())),()=>{if(P()&&e(Ce)&&le()&&P()!==e(ie)){c(ie,P()),c(G,null),c(S,[]),c(ne,!1),c(de,!1);const b=P().includes("1d20")?"attack":"other";console.log("Auto-roll triggered. notation:",P(),"damageNotation:",ee(),"attackName:",T()),setTimeout(()=>A(P(),b),200)}}),Kt();var E={getLastRollTotal:Fe};Et();var j=ci();let d;var Te=i(j),ce=i(Te),xe=a(i(ce),2),ye=i(xe),L=a(ye,2);l(xe),l(ce);var Le=a(ce,2);{var R=b=>{var w=Xl(),re=a(i(w),2),Z=i(re),be=a(i(Z),2);je(be),l(Z);var N=a(Z,2),z=a(i(N),2);je(z),l(N);var te=a(N,2),Ne=a(i(te),2);je(Ne),l(te),l(re),l(w),Be(be,()=>e(m),Se=>c(m,Se)),D("change",be,ze),Be(z,()=>e(W),Se=>c(W,Se)),D("change",z,ze),Be(Ne,()=>e(Ae),Se=>c(Ae,Se)),D("change",Ne,ze),o(b,w)};_(Le,b=>{e(We)&&b(R)})}var Y=a(Le,2);{var Pe=b=>{var w=Yl();o(b,w)};_(Y,b=>{e(Ce)||b(Pe)})}var Ye=a(Y,2),He=i(Ye);Ca(He,b=>c(ve,b),()=>e(ve));var V=a(He,2);{var ge=b=>{var w=Zl(),re=a(i(w),2),Z=i(re),be=a(i(Z),2);je(be),l(Z);var N=a(Z,2),z=a(i(N),2);je(z),l(N);var te=a(N,2),Ne=a(i(te),2);je(Ne),l(te);var Se=a(te,2),Ve=a(i(Se),2);je(Ve),l(Se);var H=a(Se,2),et=a(i(H),2);je(et),l(H);var ot=a(H,2),yt=a(i(ot),2);je(yt),l(ot),l(re);var x=a(re,2),q=i(x),u=i(q);l(q);var se=a(q,2);l(x),l(w),M(()=>{q.disabled=!e(Ce),k(u,`Roll ${e(B)??""}`)}),Be(be,()=>e(Ie),pe=>c(Ie,pe)),Be(z,()=>e(fe),pe=>c(fe,pe)),Be(Ne,()=>e(O),pe=>c(O,pe)),Be(Ve,()=>e(ae),pe=>c(ae,pe)),Be(et,()=>e(we),pe=>c(we,pe)),Be(yt,()=>e(he),pe=>c(he,pe)),D("click",q,qe),D("click",se,_e),o(b,w)};_(V,b=>{P()||b(ge)})}l(Ye);var Ee=a(Ye,2);let Ge;var K=i(Ee);{var De=b=>{var w=oi(),re=Oe(w),Z=i(re),be=i(Z,!0);l(Z);var N=a(Z,2);{var z=q=>{var u=ei();o(q,u)};_(N,q=>{e(ne)&&q(z)})}l(re);var te=a(re,2),Ne=i(te,!0);l(te);var Se=a(te,2),Ve=i(Se);{var H=q=>{var u=ti(),se=i(u,!0);l(u),M(()=>k(se,(e(G),r(()=>e(G).resultString)))),o(q,u)};_(Ve,q=>{e(G),r(()=>e(G).resultString)&&q(H)})}var et=a(Ve,2);{var ot=q=>{var u=nt(),se=Oe(u);{var pe=ke=>{var Je=si();pt(Je,5,$e,ft,(Qe,vt)=>{var mt=ai(),Ht=i(mt),kt=i(Ht);l(Ht);var Ft=a(Ht,2),Mt=i(Ft);l(Ft),l(mt),M(()=>{k(kt,`${e(vt),r(()=>e(vt).value>=0?"+":"")??""}${e(vt),r(()=>e(vt).value)??""}`),k(Mt,`(${e(vt),r(()=>e(vt).source)??""})`)}),o(Qe,mt)}),l(Je),o(ke,Je)},at=ke=>{var Je=nt(),Qe=Oe(Je);{var vt=mt=>{var Ht=li(),kt=i(Ht);l(Ht),M(()=>k(kt,`Modifier: ${e(G),r(()=>e(G).constant>=0?"+":"")??""}${e(G),r(()=>e(G).constant)??""}`)),o(mt,Ht)};_(Qe,mt=>{e(G),r(()=>e(G).constant)&&mt(vt)},!0)}o(ke,Je)};_(se,ke=>{U($e()),r(()=>$e().length>0)?ke(pe):ke(at,!1)})}o(q,u)};_(et,q=>{e(G),U($e()),r(()=>e(G).constant||$e().length>0)&&q(ot)})}l(Se);var yt=a(Se,2);{var x=q=>{var u=ni(),se=i(u);pt(se,1,()=>e(S),ft,(ke,Je)=>{var Qe=ii(),vt=i(Qe,!0);l(Qe),M(()=>k(vt,(e(Je),r(()=>e(Je).label)))),D("click",Qe,()=>A(e(Je).notation,"damage")),o(ke,Qe)});var pe=a(se,2);{var at=ke=>{var Je=ri();M(()=>{Je.disabled=e(C)<=0,tt(Je,"title",e(C)<=0?"No Channel Divinity uses remaining":"Use Channel Divinity to add +10 to this attack roll")}),D("click",Je,ct),o(ke,Je)};_(pe,ke=>{e(h)&&e(oe)==="attack"&&!e(de)&&ke(at)})}l(u),o(q,u)};_(yt,q=>{e(S),e(h),e(oe),e(de),r(()=>e(S).length>0||e(h)&&e(oe)==="attack"&&!e(de))&&q(x)})}M(()=>{k(be,T()?`${T()} - Result`:"Result"),k(Ne,(e(G),r(()=>e(G).resultTotal)))}),o(b,w)};_(K,b=>{e(G)&&b(De)})}l(Ee),l(Te),l(j),M(()=>{d=gt(j,1,"modal-overlay svelte-1r90jgp",null,d,{hidden:!le()}),Ge=gt(Ee,1,"roll-result svelte-1r90jgp",null,Ge,{"has-result":e(G)})}),D("click",ye,Ue),D("click",L,F),D("click",Te,Fa(function(b){sa.call(this,n,b)})),D("keydown",Te,function(b){sa.call(this,n,b)}),D("click",j,F),D("keydown",j,b=>b.key==="Escape"&&F()),o(s,j),_s(n,"getLastRollTotal",Fe);var Ke=Tt(E);return f(),Ke}const ya="https://api.github.com/gists";async function di(s,n,t){if(!n)throw new Error("GitHub token is required");const v=JSON.stringify(s,null,2),f=`${s.name||"character"}_dnd.json`,h={description:t||`D&D Character: ${s.name}`,public:!1,files:{[f]:{content:v}}},C=await fetch(ya,{method:"POST",headers:{Authorization:`token ${n}`,"Content-Type":"application/json"},body:JSON.stringify(h)});if(!C.ok)throw new Error(`Failed to create gist: ${C.statusText}`);return(await C.json()).id}async function ui(s,n,t){if(!n||!t)throw new Error("GitHub token and Gist ID are required");const v=JSON.stringify(s,null,2),h={files:{[`${s.name||"character"}_dnd.json`]:{content:v}}},C=await fetch(`${ya}/${t}`,{method:"PATCH",headers:{Authorization:`token ${n}`,"Content-Type":"application/json"},body:JSON.stringify(h)});if(!C.ok)throw new Error(`Failed to update gist: ${C.statusText}`)}async function pi(s,n){if(!s)throw new Error("Gist ID is required");const t={"Content-Type":"application/json"};n&&(t.Authorization=`token ${n}`);const v=await fetch(`${ya}/${s}`,{method:"GET",headers:t});if(!v.ok)throw new Error(`Failed to load gist: ${v.statusText}`);const f=await v.json(),h=Object.values(f.files);if(h.length===0)throw new Error("No files found in gist");const B=h[0].content;try{const y=JSON.parse(B);return y.attacks&&Array.isArray(y.attacks)&&(y.attacks=y.attacks.map(P=>({...P,id:P.id||crypto.randomUUID()}))),y.classFeatures?(y.classFeatures.features||(y.classFeatures.features={}),y.classFeatures.spellSlots||(y.classFeatures.spellSlots=[]),y.classFeatures.preparedSpells===void 0&&(y.classFeatures.preparedSpells="")):y.classFeatures={features:{},spellSlots:[],preparedSpells:""},y}catch{throw new Error("Invalid character data in gist")}}function Ha(s){typeof window<"u"&&localStorage.setItem("dnd_gist_config",JSON.stringify(s))}function fi(){if(typeof window<"u"){const s=localStorage.getItem("dnd_gist_config");if(s)return JSON.parse(s)}return{}}async function gi(s,n=30){if(!s)throw new Error("GitHub token is required to list gists");const t=await fetch(`${ya}?per_page=${n}`,{method:"GET",headers:{Authorization:`token ${s}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error(`Failed to list gists: ${t.statusText}`);return await t.json()}var bi=p('<div class="error-message svelte-1jb5ckg"> </div>'),mi=p('<div class="toggle-container svelte-1jb5ckg"><button type="button" class="toggle-btn svelte-1jb5ckg"> </button></div>'),hi=p('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID (leave empty to create new)</label> <input type="text" id="gistId" placeholder="Optional: existing Gist ID to update" class="svelte-1jb5ckg"/></div>'),_i=p('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),yi=p('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),ki=p('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Update (or leave unselected to create new)</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),xi=p('<div class="info-message svelte-1jb5ckg">No gists found. A new one will be created.</div>'),Si=p('<!> <div class="form-group svelte-1jb5ckg"><label for="description" class="svelte-1jb5ckg"> </label> <input type="text" id="description" placeholder="D&amp;D Character Sheet" class="svelte-1jb5ckg"/></div>',1),$i=p('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID *</label> <input type="text" id="gistId" placeholder="Enter Gist ID (for public or your private gists)" required class="svelte-1jb5ckg"/></div>'),Ci=p('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),wi=p('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),Li=p('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Load</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),Di=p('<div class="info-message svelte-1jb5ckg">No gists found. Enter a Gist ID manually or create a new one in Save mode.</div>'),ji=p('<div class="modal-overlay svelte-1jb5ckg" role="button" tabindex="-1"><div class="modal-content svelte-1jb5ckg" role="dialog" tabindex="0"><div class="modal-header svelte-1jb5ckg"><h2 class="svelte-1jb5ckg"> </h2> <button class="close-btn svelte-1jb5ckg">Ã—</button></div> <div class="modal-body svelte-1jb5ckg"><!> <div class="form-group svelte-1jb5ckg"><label for="token" class="svelte-1jb5ckg"> <a href="https://github.com/settings/tokens" target="_blank" rel="noopener" class="svelte-1jb5ckg">Get token</a></label> <input type="password" id="token" placeholder="ghp_xxxxxxxxxxxxx" class="svelte-1jb5ckg"/></div> <!> <!> <div class="modal-actions svelte-1jb5ckg"><button class="btn btn-primary svelte-1jb5ckg"><!></button> <button class="btn btn-secondary svelte-1jb5ckg">Cancel</button></div></div></div></div>');function Ai(s,n){Pt(n,!1);const t=()=>Xe(X,"$character",v),[v,f]=Gt(),h=ta();let C=At(n,"mode",8,"save"),B=I(""),y=I(""),P=I(""),le=I(!1),ee=I(""),T=I(!1),me=I(!1),$e=I([]),Me=I(null);const ve=fi();ve.token&&c(B,ve.token),ve.gistId&&c(y,ve.gistId),oa(async()=>{e(B)&&!e(T)&&await Ce()});async function Ce(){if(e(B)){c(me,!0),c(ee,"");try{c($e,await gi(e(B))),e(y)&&c(Me,e($e).find(F=>F.id===e(y))||null)}catch(F){c(ee,F.message||"Failed to load gists"),c($e,[])}finally{c(me,!1)}}}function ie(F){c(Me,F),c(y,F.id)}function G(){c(T,!e(T)),c(ee,""),!e(T)&&e(B)&&Ce()}async function Fe(){if(!e(B)){c(ee,"GitHub token is required");return}const F=e(Me)?.id||e(y);c(le,!0),c(ee,"");try{if(F)await ui(t(),e(B),F),c(y,F),It.add("Character updated in Gist successfully!","success");else{const E=await di(t(),e(B),e(P));c(y,E),It.add(`Character saved to Gist! ID: ${E}`,"success")}Ha({token:e(B),gistId:e(y)}),h("close")}catch(E){c(ee,E.message||"Failed to save to Gist")}finally{c(le,!1)}}async function Ie(){const F=e(Me)?.id||e(y);if(!F){c(ee,"Please select a gist or enter a Gist ID");return}c(le,!0),c(ee,"");try{const E=await pi(F,e(B)||void 0);X.set(E),c(y,F),Ha({token:e(B),gistId:e(y)}),It.add("Character loaded from Gist successfully!","success"),h("close")}catch(E){c(ee,E.message||"Failed to load from Gist")}finally{c(le,!1)}}function fe(){h("close")}Et();var O=ji(),ae=i(O),we=i(ae),he=i(we),Re=i(he,!0);l(he);var S=a(he,2);l(we);var ne=a(we,2),oe=i(ne);{var de=F=>{var E=bi(),j=i(E,!0);l(E),M(()=>k(j,e(ee))),o(F,E)};_(oe,F=>{e(ee)&&F(de)})}var m=a(oe,2),W=i(m),Ae=i(W);ga(),l(W);var We=a(W,2);je(We),l(m);var g=a(m,2);{var $=F=>{var E=mi(),j=i(E),d=i(j,!0);l(j),l(E),M(()=>{j.disabled=e(le),k(d,e(T)?"ðŸ“‹ Show My Gists":"âœï¸ Enter Gist ID Manually")}),D("click",j,G),o(F,E)};_(g,F=>{(C()==="load"||C()==="save"&&e(B))&&F($)})}var Q=a(g,2);{var A=F=>{var E=Si(),j=Oe(E);{var d=Le=>{var R=hi(),Y=a(i(R),2);je(Y),l(R),M(()=>Y.disabled=e(le)),Be(Y,()=>e(y),Pe=>c(y,Pe)),o(Le,R)},Te=Le=>{var R=nt(),Y=Oe(R);{var Pe=He=>{var V=_i();o(He,V)},Ye=He=>{var V=nt(),ge=Oe(V);{var Ee=K=>{var De=ki(),Ke=a(i(De),2);pt(Ke,5,()=>e($e),ft,(b,w)=>{var re=yi();let Z;var be=i(re),N=i(be),z=i(N,!0);l(N);var te=a(N,2),Ne=i(te,!0);l(te),l(be);var Se=a(be,2),Ve=i(Se),H=i(Ve);l(Ve);var et=a(Ve,2),ot=i(et);l(et),l(Se),l(re),M(yt=>{Z=gt(re,1,"gist-item svelte-1jb5ckg",null,Z,{selected:e(Me)?.id===e(w).id}),re.disabled=e(le),k(z,(e(w),r(()=>e(w).description||"Untitled"))),k(Ne,(e(w),r(()=>e(w).public?"ðŸŒ Public":"ðŸ”’ Private"))),k(H,`ID: ${e(w),r(()=>e(w).id)??""}`),k(ot,`Updated: ${yt??""}`)},[()=>(e(w),r(()=>new Date(e(w).updated_at).toLocaleDateString()))]),D("click",re,()=>ie(e(w))),o(b,re)}),l(Ke),l(De),o(K,De)},Ge=K=>{var De=nt(),Ke=Oe(De);{var b=w=>{var re=xi();o(w,re)};_(Ke,w=>{e(B)&&w(b)},!0)}o(K,De)};_(ge,K=>{e($e),r(()=>e($e).length>0)?K(Ee):K(Ge,!1)},!0)}o(He,V)};_(Y,He=>{e(me)?He(Pe):He(Ye,!1)},!0)}o(Le,R)};_(j,Le=>{e(T)||!e(B)?Le(d):Le(Te,!1)})}var ce=a(j,2),xe=i(ce),ye=i(xe);l(xe);var L=a(xe,2);je(L),l(ce),M(()=>{k(ye,`Description ${e(y)?"(optional)":""}`),L.disabled=e(le)}),Be(L,()=>e(P),Le=>c(P,Le)),o(F,E)},J=F=>{var E=nt(),j=Oe(E);{var d=ce=>{var xe=$i(),ye=a(i(xe),2);je(ye),l(xe),M(()=>ye.disabled=e(le)),Be(ye,()=>e(y),L=>c(y,L)),o(ce,xe)},Te=ce=>{var xe=nt(),ye=Oe(xe);{var L=R=>{var Y=Ci();o(R,Y)},Le=R=>{var Y=nt(),Pe=Oe(Y);{var Ye=V=>{var ge=Li(),Ee=a(i(ge),2);pt(Ee,5,()=>e($e),ft,(Ge,K)=>{var De=wi();let Ke;var b=i(De),w=i(b),re=i(w,!0);l(w);var Z=a(w,2),be=i(Z,!0);l(Z),l(b);var N=a(b,2),z=i(N),te=i(z);l(z);var Ne=a(z,2),Se=i(Ne);l(Ne),l(N),l(De),M(Ve=>{Ke=gt(De,1,"gist-item svelte-1jb5ckg",null,Ke,{selected:e(Me)?.id===e(K).id}),De.disabled=e(le),k(re,(e(K),r(()=>e(K).description||"Untitled"))),k(be,(e(K),r(()=>e(K).public?"ðŸŒ Public":"ðŸ”’ Private"))),k(te,`ID: ${e(K),r(()=>e(K).id)??""}`),k(Se,`Updated: ${Ve??""}`)},[()=>(e(K),r(()=>new Date(e(K).updated_at).toLocaleDateString()))]),D("click",De,()=>ie(e(K))),o(Ge,De)}),l(Ee),l(ge),o(V,ge)},He=V=>{var ge=nt(),Ee=Oe(ge);{var Ge=K=>{var De=Di();o(K,De)};_(Ee,K=>{e(B)&&K(Ge)},!0)}o(V,ge)};_(Pe,V=>{e($e),r(()=>e($e).length>0)?V(Ye):V(He,!1)},!0)}o(R,Y)};_(ye,R=>{e(me)?R(L):R(Le,!1)},!0)}o(ce,xe)};_(j,ce=>{e(T)||!e(B)?ce(d):ce(Te,!1)},!0)}o(F,E)};_(Q,F=>{C()==="save"?F(A):F(J,!1)})}var qe=a(Q,2),ue=i(qe),_e=i(ue);{var ze=F=>{var E=wt();M(()=>k(E,C()==="save"?"Saving...":"Loading...")),o(F,E)},Ue=F=>{var E=wt();M(()=>k(E,C()==="save"?"Save":"Load")),o(F,E)};_(_e,F=>{e(le)?F(ze):F(Ue,!1)})}l(ue);var ct=a(ue,2);l(qe),l(ne),l(ae),l(O),M(()=>{k(Re,C()==="save"?"Save to GitHub Gist":"Load from GitHub Gist"),k(Ae,`GitHub Token ${C()==="load"?"(optional for public gists)":"(required)"} `),We.disabled=e(le),ue.disabled=e(le),ct.disabled=e(le)}),D("click",S,fe),Be(We,()=>e(B),F=>c(B,F)),D("blur",We,()=>{e(B)&&!e(T)&&Ce()}),D("click",ue,function(...F){(C()==="save"?Fe:Ie)?.apply(this,F)}),D("click",ct,fe),D("click",ae,Fa(function(F){sa.call(this,n,F)})),D("keydown",ae,function(F){sa.call(this,n,F)}),D("click",O,fe),D("keydown",O,F=>F.key==="Escape"&&fe()),o(s,O),Tt(),f()}var Fi=p('<div class="loading svelte-1ngjemu">Loading D&D data...</div>'),Mi=p("<option> </option>"),Bi=p('<select class="level-filter svelte-1ngjemu"><option>All Levels</option><option>Cantrip</option><!></select>'),Ii=p('<div class="no-results svelte-1ngjemu"> </div>'),Ri=p('<div class="item-meta svelte-1ngjemu"> </div>'),Ei=p('<div class="item-meta svelte-1ngjemu"> </div>'),Pi=p('<button><div class="item-name svelte-1ngjemu"> </div> <!></button>'),Ti=p('<p class="higher-levels"><strong>At Higher Levels:</strong> </p>'),Hi=p('<p class="cantrip-upgrade"><strong>Cantrip Upgrade:</strong> </p>'),Ni=p('<h3 class="svelte-1ngjemu"> </h3> <p class="spell-meta svelte-1ngjemu"><!> <!></p> <p class="spell-classes"><strong>Classes:</strong> </p> <div class="spell-stats svelte-1ngjemu"><div><strong>Casting Time:</strong> </div> <div><strong>Range:</strong> </div> <div><strong>Components:</strong> <!></div> <div><strong>Duration:</strong> <!> </div></div> <p class="description svelte-1ngjemu"> </p> <!> <!>',1),Ui=p('<p class="prerequisite svelte-1ngjemu"><strong>Prerequisite:</strong> </p>'),Gi=p('<h3 class="svelte-1ngjemu"> </h3> <!> <p class="description svelte-1ngjemu"> </p> <a target="_blank" rel="noopener" class="source-link svelte-1ngjemu">View Full Details â†’</a>',1),Oi=p('<div class="item-details svelte-1ngjemu"><!></div>'),qi=p('<div class="controls svelte-1ngjemu"><div class="tabs svelte-1ngjemu"><button> </button> <button> </button></div> <div class="search-controls svelte-1ngjemu"><input type="text" placeholder="Search by name or description..." class="search-input svelte-1ngjemu"/> <!></div></div> <div class="content-container svelte-1ngjemu"><div class="items-list svelte-1ngjemu"><!></div> <!></div>',1),Wi=p('<div class="modal-backdrop svelte-1ngjemu" role="presentation"><div class="modal svelte-1ngjemu" role="dialog" aria-modal="true" tabindex="-1"><div class="modal-header svelte-1ngjemu"><h2 class="svelte-1ngjemu">Browse D&D Spells & Feats</h2> <button class="close-btn svelte-1ngjemu" aria-label="Close">&times;</button></div> <div class="modal-body svelte-1ngjemu"><!></div> <div class="modal-footer svelte-1ngjemu"><button class="btn-secondary svelte-1ngjemu">Cancel</button> <button class="btn-primary svelte-1ngjemu">Add to Character Sheet</button></div></div></div>');function zi(s,n){Pt(n,!1);const t=I(),v=I(),f=I();let h=At(n,"onClose",8),C=I("spell"),B=I(!0),y=I(""),P=I(null),le=I([]),ee=I([]),T=I(null);oa(async()=>{c(B,!0);try{c(le,await Ja()),c(ee,await zs())}catch(S){console.error("Failed to load data:",S)}finally{c(B,!1)}});function me(S){c(T,S)}function $e(S){const ne=S.match(/(\d+d\d+(?:\s*\+\s*\d+)?)/i);return ne?ne[1]:""}function Me(S){const ne=S.split(/\.( |$)/)[0].trim(),oe=Array.from(S.matchAll(/\*\*(.*?)\*\*/g)).map(m=>m[1].replace(/\.$/,""));let de=ne;return oe.length&&(de+=" | Effects: "+oe.join(", ")),de}function ve(){if(e(T)){if(e(C)==="spell"){const S=e(T);X.update(ne=>{const de=[];S.range&&de.push(`Range: ${S.range}`),S.castingTime&&de.push(`Cast: ${S.castingTime}`),S.duration&&de.push(`Duration: ${S.duration}`),S.actionType==="Save"&&de.push("Saving throw spell"),S.components&&S.components.length>0&&de.push(`Components: ${S.components.join(", ")}`),S.material&&de.push(`Material: ${S.material}`);const m=de.join(" | "),W=Me(S.description),Ae={id:crypto.randomUUID(),name:`${S.name}${S.concentration?" (C)":""}${S.ritual?" (R)":""}`,bonus:S.actionType==="Attack"?5:0,damage:$e(S.description),damageType:`${S.school} (Lvl ${S.level})`,spellRef:S.name,infoNotes:m,generalNotes:W,castAtLevel:S.level};return ne.attacks=[...ne.attacks,Ae],ne})}else if(e(C)==="feat"){const S=e(T);X.update(ne=>{const oe=`${S.name}${S.prerequisite?` (Req: ${S.prerequisite})`:""}
${S.description}
`;return ne.features=ne.features?`${ne.features}
${oe}`:oe,ne})}c(T,null),h()()}}Ze(()=>(e(P),e(le),e(y)),()=>{c(t,e(P)!==null?Ks(Ea(e(le),e(y)),e(P)):Ea(e(le),e(y)))}),Ze(()=>(e(ee),e(y)),()=>{c(v,Js(e(ee),e(y)))}),Ze(()=>(e(C),e(t),e(v)),()=>{c(f,e(C)==="spell"?e(t):e(v))}),Kt(),Et();var Ce=Wi(),ie=i(Ce),G=i(ie),Fe=a(i(G),2);l(G);var Ie=a(G,2),fe=i(Ie);{var O=S=>{var ne=Fi();o(S,ne)},ae=S=>{var ne=qi(),oe=Oe(ne),de=i(oe),m=i(de);let W;var Ae=i(m);l(m);var We=a(m,2);let g;var $=i(We);l(We),l(de);var Q=a(de,2),A=i(Q);je(A);var J=a(A,2);{var qe=j=>{var d=Bi();M(()=>{e(P),Ct(()=>{})});var Te=i(d);Te.value=(Te.__value=null)??"";var ce=a(Te);ce.value=ce.__value=0;var xe=a(ce);pt(xe,0,()=>[1,2,3,4,5,6,7,8,9],ft,(ye,L)=>{var Le=Mi(),R=i(Le);l(Le);var Y={};M(()=>{k(R,`Level ${L??""}`),Y!==(Y=L)&&(Le.value=(Le.__value=L)??"")}),o(ye,Le)}),l(d),za(d,()=>e(P),ye=>c(P,ye)),o(j,d)};_(J,j=>{e(C)==="spell"&&j(qe)})}l(Q),l(oe);var ue=a(oe,2),_e=i(ue),ze=i(_e);{var Ue=j=>{var d=Ii(),Te=i(d);l(d),M(()=>k(Te,`No ${e(C)??""}s found`)),o(j,d)},ct=j=>{var d=nt(),Te=Oe(d);pt(Te,1,()=>e(f),ft,(ce,xe)=>{var ye=Pi();let L;var Le=i(ye),R=i(Le,!0);l(Le);var Y=a(Le,2);{var Pe=He=>{const V=it(()=>e(xe));var ge=Ri(),Ee=i(ge);l(ge),M(()=>k(Ee,`Level ${U(e(V)),r(()=>e(V).level)??""} â€¢ ${U(e(V)),r(()=>e(V).school)??""}`)),o(He,ge)},Ye=He=>{const V=it(()=>e(xe));var ge=nt(),Ee=Oe(ge);{var Ge=K=>{var De=Ei(),Ke=i(De,!0);l(De),M(()=>k(Ke,(U(e(V)),r(()=>e(V).prerequisite)))),o(K,De)};_(Ee,K=>{U(e(V)),r(()=>e(V).prerequisite)&&K(Ge)})}o(He,ge)};_(Y,He=>{e(C)==="spell"?He(Pe):He(Ye,!1)})}l(ye),M(()=>{L=gt(ye,1,"item-card svelte-1ngjemu",null,L,{selected:e(T)?.name===e(xe).name}),k(R,(e(xe),r(()=>e(xe).name)))}),D("click",ye,()=>me(e(xe))),o(ce,ye)}),o(j,d)};_(ze,j=>{e(f),r(()=>e(f).length===0)?j(Ue):j(ct,!1)})}l(_e);var F=a(_e,2);{var E=j=>{var d=Oi(),Te=i(d);{var ce=ye=>{const L=it(()=>e(T));var Le=Ni(),R=Oe(Le),Y=i(R,!0);l(R);var Pe=a(R,2),Ye=i(Pe);{var He=u=>{var se=wt();M(()=>k(se,`${U(e(L)),r(()=>e(L).school)??""} cantrip`)),o(u,se)},V=u=>{var se=wt();M(()=>k(se,`Level ${U(e(L)),r(()=>e(L).level)??""} ${U(e(L)),r(()=>e(L).school)??""}`)),o(u,se)};_(Ye,u=>{U(e(L)),r(()=>e(L).level===0)?u(He):u(V,!1)})}var ge=a(Ye,2);{var Ee=u=>{var se=wt("(ritual)");o(u,se)};_(ge,u=>{U(e(L)),r(()=>e(L).ritual)&&u(Ee)})}l(Pe);var Ge=a(Pe,2),K=a(i(Ge));l(Ge);var De=a(Ge,2),Ke=i(De),b=a(i(Ke));l(Ke);var w=a(Ke,2),re=a(i(w));l(w);var Z=a(w,2),be=a(i(Z)),N=a(be);{var z=u=>{var se=wt();M(()=>k(se,`(${U(e(L)),r(()=>e(L).material)??""})`)),o(u,se)};_(N,u=>{U(e(L)),r(()=>e(L).material)&&u(z)})}l(Z);var te=a(Z,2),Ne=a(i(te),2);{var Se=u=>{var se=wt("Concentration,");o(u,se)};_(Ne,u=>{U(e(L)),r(()=>e(L).concentration)&&u(Se)})}var Ve=a(Ne,1,!0);l(te),l(De);var H=a(De,2),et=i(H,!0);l(H);var ot=a(H,2);{var yt=u=>{var se=Ti(),pe=a(i(se));l(se),M(()=>k(pe,` ${U(e(L)),r(()=>e(L).higherLevelSlot)??""}`)),o(u,se)};_(ot,u=>{U(e(L)),r(()=>e(L).higherLevelSlot)&&u(yt)})}var x=a(ot,2);{var q=u=>{var se=Hi(),pe=a(i(se));l(se),M(()=>k(pe,` ${U(e(L)),r(()=>e(L).cantripUpgrade)??""}`)),o(u,se)};_(x,u=>{U(e(L)),r(()=>e(L).cantripUpgrade)&&u(q)})}M((u,se)=>{k(Y,(U(e(L)),r(()=>e(L).name))),k(K,` ${u??""}`),k(b,` ${U(e(L)),r(()=>e(L).castingTime||e(L).actionType)??""}`),k(re,` ${U(e(L)),r(()=>e(L).range)??""}`),k(be,` ${se??""}`),k(Ve,(U(e(L)),r(()=>e(L).duration))),k(et,(U(e(L)),r(()=>e(L).description)))},[()=>(U(e(L)),r(()=>e(L).classes.join(", "))),()=>(U(e(L)),r(()=>e(L).components.join(", ").toUpperCase()))]),o(ye,Le)},xe=ye=>{const L=it(()=>e(T));var Le=Gi(),R=Oe(Le),Y=i(R,!0);l(R);var Pe=a(R,2);{var Ye=Ee=>{var Ge=Ui(),K=a(i(Ge));l(Ge),M(()=>k(K,` ${U(e(L)),r(()=>e(L).prerequisite)??""}`)),o(Ee,Ge)};_(Pe,Ee=>{U(e(L)),r(()=>e(L).prerequisite)&&Ee(Ye)})}var He=a(Pe,2),V=i(He,!0);l(He);var ge=a(He,2);M(()=>{k(Y,(U(e(L)),r(()=>e(L).name))),k(V,(U(e(L)),r(()=>e(L).description))),tt(ge,"href",(U(e(L)),r(()=>e(L).source)))}),o(ye,Le)};_(Te,ye=>{e(C)==="spell"?ye(ce):ye(xe,!1)})}l(d),o(j,d)};_(F,j=>{e(T)&&j(E)})}l(ue),M(()=>{W=gt(m,1,"tab svelte-1ngjemu",null,W,{active:e(C)==="spell"}),k(Ae,`ðŸ“œ Spells (${e(le),r(()=>e(le).length)??""})`),g=gt(We,1,"tab svelte-1ngjemu",null,g,{active:e(C)==="feat"}),k($,`â­ Feats (${e(ee),r(()=>e(ee).length)??""})`)}),D("click",m,()=>{c(C,"spell"),c(T,null),c(y,"")}),D("click",We,()=>{c(C,"feat"),c(T,null),c(y,"")}),Be(A,()=>e(y),j=>c(y,j)),o(S,ne)};_(fe,S=>{e(B)?S(O):S(ae,!1)})}l(Ie);var we=a(Ie,2),he=i(we),Re=a(he,2);l(we),l(ie),l(Ce),M(()=>Re.disabled=!e(T)),D("click",Fe,function(...S){h()?.apply(this,S)}),D("click",he,function(...S){h()?.apply(this,S)}),D("click",Re,ve),D("click",ie,Fa(function(S){sa.call(this,n,S)})),D("keydown",ie,function(S){sa.call(this,n,S)}),D("click",Ce,function(...S){h()?.apply(this,S)}),D("keydown",Ce,S=>S.key==="Escape"&&h()()),o(s,Ce),Tt()}var Ki=p('<link rel="icon" type="image/png" href="favicon4.png"/> <meta name="viewport" content="width=device-width, initial-scale=1"/>',1),Ji=p('<span class="character-name svelte-1uha8ag"> </span>'),Vi=p("<span> </span>"),Qi=p('<div class="spell-slots-header svelte-1uha8ag"></div>'),Xi=p("<span> </span><br/>",1),Yi=p("<span> </span>"),Zi=p('<span class="effect-tooltip"><strong> </strong><br/> <br/> <!> <!></span>'),er=p('<button class="effect-remove-btn svelte-1uha8ag">Ã—</button>'),tr=p('<span class="effect-badge svelte-1uha8ag" tabindex="0"> <!> <!></span>'),ar=p(`<div class="active-effects-header svelte-1uha8ag"></div> <style>.effect-badge {
            position: relative;
          }
          .effect-tooltip {
            position: absolute;
            top: 120%;
            left: 50%;
            transform: translateX(-50%);
            background: #fff;
            color: #222;
            border: 1px solid #a5b4fc;
            border-radius: 6px;
            padding: 8px 12px;
            font-size: 0.95em;
            box-shadow: 0 2px 8px rgba(0,0,0,0.12);
            z-index: 10;
            min-width: 180px;
            max-width: 260px;
            white-space: normal;
            pointer-events: none;
            opacity: 1;
            transition: opacity 0.15s;
          }</style>`,1),sr=p('<div class="rest-menu svelte-1uha8ag"><button class="rest-option svelte-1uha8ag">â˜• Short Rest</button> <button class="rest-option svelte-1uha8ag">ðŸ›ï¸ Long Rest</button></div>'),lr=p('<div class="container svelte-1uha8ag"><header class="svelte-1uha8ag"><div class="header-top svelte-1uha8ag"><div class="header-title svelte-1uha8ag"><div class="title-row svelte-1uha8ag"><h1 class="svelte-1uha8ag">D&D Character Sheet</h1> <!></div> <!> <!></div> <div class="header-right svelte-1uha8ag"><div class="header-controls svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">ðŸŽ²</span><span class="btn-text svelte-1uha8ag">Roll Dice</span></button> <div class="rest-button-container svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">ðŸ˜´</span><span class="btn-text svelte-1uha8ag">Rest</span></button> <!></div> <div class="mode-toggle"><button><span class="btn-icon svelte-1uha8ag"> </span><span class="btn-text svelte-1uha8ag"> </span></button></div></div> <div class="header-search svelte-1uha8ag"><input type="text" placeholder="ðŸ” Search..." class="search-input use-enabled svelte-1uha8ag"/></div></div></div> <div class="header-actions svelte-1uha8ag"><button class="btn btn-mode svelte-1uha8ag">ðŸ“š Browse Spells & Feats</button> <button class="btn btn-secondary">Save to Gist</button> <button class="btn btn-secondary">Load from Gist</button> <button class="btn btn-secondary">Export JSON</button> <button class="btn btn-secondary">Import JSON</button> <input type="file" accept=".json" style="display: none;"/></div></header> <main class="svelte-1uha8ag"><!> <!> <!> <!> <!> <!> <!></main></div> <!> <!> <!> <!>',1);function pr(s,n){Pt(n,!1);const t=()=>Xe(X,"$character",h),v=()=>Xe(aa,"$isEditMode",h),f=()=>Xe(Xt,"$searchFilter",h),[h,C]=Gt();function B(){const x=[],q=t().classFeatures.spellSlotsByLevel||{};for(let u=1;u<=9;u++){const se=q[u];if(se&&se.length>0){const pe=se.length,at=se.filter(ke=>ke).length;x.push({level:u,available:pe-at,total:pe})}}return x}let y=I(!1),P=I(!1),le=I(!1),ee=I("save"),T=I(void 0),me=I(""),$e=I(""),Me=I(""),ve=I(!1),Ce=I([]),ie=I(),G=!1,Fe=I(!1),Ie=I(null);function fe(x){c(Ie,x)}function O(){c(Ie,null)}function ae(x){c(Ie,e(Ie)===x?null:x)}function we(){const x=[];X.update(u=>{const se=u.hitDice.current;u.hitDice.current=Math.min(u.hitDice.max,u.hitDice.current+Math.max(1,Math.floor(u.hitDice.max/2)));const pe=u.hitDice.current-se;if(pe>0&&x.push(`${pe} hit ${pe===1?"die":"dice"}`),u.class){const at=la(u.class,u.level,u.subclass);u.classFeatures.features||(u.classFeatures.features={}),at.forEach(ke=>{if(ke.resetOn==="short"){const Je=ke.name.replace(/\s+/g,"");if(ke.type==="uses"){const Qe=typeof ke.maxUses=="function"?ke.maxUses(u.level):ke.maxUses;u.classFeatures.features[Je]=Array(Qe).fill(!1),x.push(ke.name)}else if(ke.type==="pool"){const Qe=typeof ke.maxPool=="function"?ke.maxPool(u.level):ke.maxPool;Qe!==void 0&&(u.classFeatures.features[Je]=Qe,x.push(ke.name))}}})}return u}),c(Fe,!1);const q=x.length>0?`Short rest taken! Restored: ${x.join(", ")}`:"Short rest taken!";It.add(q,"success")}function he(){const x=[];X.update(u=>{const se=u.maxHP-u.currentHP;se>0&&x.push(`${se} HP`),u.currentHP=u.maxHP,u.tempHP=0;const pe=u.hitDice.max-u.hitDice.current;pe>0&&x.push(`${pe} hit ${pe===1?"die":"dice"}`),u.hitDice.current=u.hitDice.max;let at=0;if(u.classFeatures.spellSlotsByLevel&&Object.keys(u.classFeatures.spellSlotsByLevel).forEach(ke=>{const Je=u.classFeatures.spellSlotsByLevel[parseInt(ke)];if(Je){const Qe=Je.filter(vt=>vt).length;at+=Qe,u.classFeatures.spellSlotsByLevel[parseInt(ke)]=Array(Je.length).fill(!1)}}),at>0&&x.push(`${at} spell ${at===1?"slot":"slots"}`),u.class){const ke=la(u.class,u.level,u.subclass);u.classFeatures.features||(u.classFeatures.features={});let Je=!1;ke.forEach(Qe=>{const vt=Qe.name.replace(/\s+/g,"");if(!(Qe.type==="info"||Qe.type==="channelDivinity")){if(Qe.type==="uses"){const mt=typeof Qe.maxUses=="function"?Qe.maxUses(u.level):Qe.maxUses;u.classFeatures.features[vt]=Array(mt).fill(!1),Je=!0}else if(Qe.type==="pool"){const mt=typeof Qe.maxPool=="function"?Qe.maxPool(u.level):Qe.maxPool;mt!==void 0&&(u.classFeatures.features[vt]=mt,Je=!0)}}}),Je&&x.push("all class features")}return u}),c(Fe,!1);const q=x.length>0?`Long rest taken! Restored: ${x.join(", ")}`:"Long rest taken! Fully rested.";It.add(q,"success")}function Re(x){c(me,""),c($e,""),c(Me,""),c(ve,!1),c(Ce,[]),G=!1,typeof x=="string"?c(me,x):(c(me,x.notation),c($e,x.damageNotation||""),c(Me,x.attackName||""),c(ve,!!x.applyHalfDamage),c(Ce,x.bonusBreakdown||[])),c(y,!0)}function S(x){const{notation:q}=x.detail;c(me,""),G=!0,setTimeout(()=>{c(me,q),c($e,""),c(Me,"Hit Die")},0),c(y,!0)}function ne(){if(c(y,!1),G&&e(ie)){const x=e(ie).getLastRollTotal();if(x!==null){const q=Math.max(1,x);X.update(u=>(u.hitDice.current=Math.max(0,u.hitDice.current-1),u.currentHP=Math.min(u.maxHP,u.currentHP+q),u))}G=!1}}function oe(){console.log("toggleMode called, current isEditMode:",v()),aa.update(x=>(console.log("Updating isEditMode from",x,"to",!x),!x))}function de(x){x.target.closest(".rest-button-container")||c(Fe,!1)}oa(()=>{console.log("onMount - initial isEditMode:",v()),console.log("onMount - body classes:",document.body.className);const x=aa.subscribe(q=>{console.log("isEditMode subscription triggered, value:",q),console.log("Body classes before:",document.body.className),q?(document.body.classList.remove("use-mode"),console.log("Removed use-mode class (Edit Mode)")):(document.body.classList.add("use-mode"),console.log("Added use-mode class (Use Mode)")),console.log("Body classes after:",document.body.className)});return document.addEventListener("click",de),()=>{x(),document.removeEventListener("click",de)}});function m(){ds(t())}function W(){e(T)?.click()}async function Ae(x){const u=x.target.files?.[0];if(u)try{const se=await us(u);X.set(se),alert("Character imported successfully!")}catch{alert("Failed to import character file")}}Et();var We=lr();cs("1uha8ag",x=>{var q=Ki();ga(2),Ga(()=>{ns.title="D&D Character Sheet"}),o(x,q)});var g=Oe(We),$=i(g),Q=i($),A=i(Q),J=i(A),qe=a(i(J),2);{var ue=x=>{var q=Ji(),u=i(q);l(q),M(()=>k(u,`${t().name??""} (${t().level??""})`)),o(x,q)};_(qe,x=>{t().name&&x(ue)})}l(J);var _e=a(J,2);{var ze=x=>{var q=Qi();pt(q,5,B,ft,(u,se)=>{var pe=Vi();let at;var ke=i(pe);l(pe),M(()=>{at=gt(pe,1,"slot-badge svelte-1uha8ag",null,at,{depleted:e(se).available===0}),k(ke,`Lv${e(se).level??""}: ${e(se).available??""}/${e(se).total??""}`)}),o(u,pe)}),l(q),o(x,q)};_(_e,x=>{B().length>0&&x(ze)})}var Ue=a(_e,2);{var ct=x=>{var q=ar(),u=Oe(q);pt(u,5,()=>t().activeStates,ft,(se,pe,at)=>{var ke=tr(),Je=i(ke),Qe=a(Je);{var vt=kt=>{var Ft=Zi(),Mt=i(Ft),va=i(Mt,!0);l(Mt);var st=a(Mt,2),dt=a(st,3);{var xt=St=>{var ut=Xi(),Dt=Oe(ut),Ut=i(Dt);l(Dt),ga(),M(()=>k(Ut,`Attack Bonus: ${e(pe).attackBonus>0?"+":""}${e(pe).attackBonus??""}`)),o(St,ut)};_(dt,St=>{e(pe).attackBonus&&St(xt)})}var Nt=a(dt,2);{var Ot=St=>{var ut=Yi(),Dt=i(ut);l(ut),M(()=>k(Dt,`Damage Bonus: ${e(pe).damageBonus>0?"+":""}${e(pe).damageBonus??""}`)),o(St,ut)};_(Nt,St=>{e(pe).damageBonus&&St(Ot)})}l(Ft),M(()=>{k(va,e(pe).name),k(st,` ${e(pe).description??""}`)}),o(kt,Ft)};_(Qe,kt=>{e(Ie)===at&&kt(vt)})}var mt=a(Qe,2);{var Ht=kt=>{var Ft=er();M(()=>tt(Ft,"title",`End ${e(pe).name??""}`)),D("click",Ft,()=>{X.update(Mt=>(Mt.activeStates&&(Mt.activeStates=Mt.activeStates.filter((va,st)=>st!==at)),Mt))}),o(kt,Ft)};_(mt,kt=>{v()||kt(Ht)})}l(ke),M(()=>{tt(ke,"aria-label",e(pe).name),k(Je,`âœ¨ ${e(pe).name??""} `)}),D("mouseenter",ke,()=>fe(at)),D("mouseleave",ke,O),D("focus",ke,()=>fe(at)),D("blur",ke,O),D("click",ke,()=>ae(at)),o(se,ke)}),l(u),ga(2),o(x,q)};_(Ue,x=>{t().activeStates&&t().activeStates.length>0&&x(ct)})}l(A);var F=a(A,2),E=i(F),j=i(E),d=a(j,2),Te=i(d),ce=a(Te,2);{var xe=x=>{var q=sr(),u=i(q),se=a(u,2);l(q),D("click",u,we),D("click",se,he),o(x,q)};_(ce,x=>{e(Fe)&&x(xe)})}l(d);var ye=a(d,2),L=i(ye);let Le;var R=i(L),Y=i(R,!0);l(R);var Pe=a(R),Ye=i(Pe,!0);l(Pe),l(L),l(ye),l(E);var He=a(E,2),V=i(He);je(V),l(He),l(F),l(Q);var ge=a(Q,2),Ee=i(ge),Ge=a(Ee,2),K=a(Ge,2),De=a(K,2),Ke=a(De,2),b=a(Ke,2);Ca(b,x=>c(T,x),()=>e(T)),l(ge),l($);var w=a($,2),re=i(w);Ds(re,{});var Z=a(re,2);Us(Z,{$$events:{rollHitDice:S}});var be=a(Z,2);Ms(be,{$$events:{roll:x=>Re(x.detail)}});var N=a(be,2);Ws(N,{$$events:{roll:x=>Re(x.detail)}});var z=a(N,2);Al(z,{$$events:{roll:x=>Re(x.detail)}});var te=a(z,2);Kl(te,{});var Ne=a(te,2);Ql(Ne,{}),l(w),l(g);var Se=a(g,2);Ca(vi(Se,{get notation(){return e(me)},get damageNotation(){return e($e)},get attackName(){return e(Me)},get applyHalfDamage(){return e(ve)},get bonusBreakdown(){return e(Ce)},get visible(){return e(y)},$$events:{close:ne},$$legacy:!0}),x=>c(ie,x),()=>e(ie));var Ve=a(Se,2);{var H=x=>{Ai(x,{get mode(){return e(ee)},$$events:{close:()=>c(P,!1)}})};_(Ve,x=>{e(P)&&x(H)})}var et=a(Ve,2);{var ot=x=>{zi(x,{onClose:()=>c(le,!1)})};_(et,x=>{e(le)&&x(ot)})}var yt=a(et,2);vs(yt,{}),M(()=>{Le=gt(L,1,"btn btn-mode svelte-1uha8ag",null,Le,{"use-mode":!v()}),k(Y,v()?"ðŸ“":"ðŸŽ²"),k(Ye,v()?"Edit Mode":"Use Mode")}),D("click",j,()=>c(y,!0)),D("click",Te,()=>c(Fe,!e(Fe))),D("click",L,oe),Be(V,f,x=>ps(Xt,x)),D("click",Ee,()=>c(le,!0)),D("click",Ge,()=>{c(ee,"save"),c(P,!0)}),D("click",K,()=>{c(ee,"load"),c(P,!0)}),D("click",De,m),D("click",Ke,W),D("change",b,Ae),o(s,We),Tt(),C()}export{pr as component};
