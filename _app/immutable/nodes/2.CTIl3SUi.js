import{f,e as F,a as c,s as w,c as nt,t as Mt}from"../chunks/DBs_ODQp.js";import{i as It}from"../chunks/BbaRvQ4Z.js";import{c as sa,o as pa,a as rs}from"../chunks/CHX4V4AM.js";import{a7 as Pa,i as Qa,aZ as is,a_ as Ya,a$ as Sa,K as Xt,e as Xa,b0 as Za,T as fa,b1 as ns,b2 as os,b3 as cs,q as Da,b4 as vs,b5 as ds,ab as us,d as i,r as Ia,g as ps,C as Tt,F as P,G as Et,H as r,I as l,J as s,b6 as et,b7 as Jt,s as o,a4 as M,f as e,m as ot,E as Ue,A as E,b8 as aa,b9 as wt,ba as da,ao as ra,bb as fs}from"../chunks/DwmZeGF1.js";import{c as Rt,a as le,e as _t,i as kt,u as es,s as Zt,b as mt,d as ga,f as ia,g as gs,t as Ot,h as hs,T as bs,j as ms,k as _s}from"../chunks/DQJFtNtV.js";import{i as y,s as Wt,a as at,b as bt,d as ca,e as ys}from"../chunks/0ovU14Ao.js";import{p as yt,b as ja}from"../chunks/CFUzmRYW.js";import{b as va,r as ks}from"../chunks/BrzSMLBC.js";function ya(a,n,t=!1){if(a.multiple){if(n==null)return;if(!Qa(n))return is();for(var d of a.options)d.selected=n.includes(ua(d));return}for(d of a.options){var p=ua(d);if(Ya(p,n)){d.selected=!0;return}}(!t||n!==void 0)&&(a.selectedIndex=-1)}function Ba(a){var n=new MutationObserver(()=>{ya(a,a.__value)});n.observe(a,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Pa(()=>{n.disconnect()})}function Aa(a,n,t=n){var d=new WeakSet,p=!0;Sa(a,"change",h=>{var m=h?"[selected]":":checked",D;if(a.multiple)D=[].map.call(a.querySelectorAll(m),ua);else{var k=a.querySelector(m)??a.querySelector("option:not([disabled])");D=k&&ua(k)}t(D),Xt!==null&&d.add(Xt)}),Xa(()=>{var h=n();if(a===document.activeElement){var m=Za??Xt;if(d.has(m))return}if(ya(a,h,p),p&&h===void 0){var D=a.querySelector(":checked");D!==null&&(h=ua(D),t(h))}a.__value=h,p=!1}),Ba(a)}function ua(a){return"__value"in a?a.__value:a.value}const Ss=Symbol("is custom element"),xs=Symbol("is html");function Ce(a){if(fa){var n=!1,t=()=>{if(!n){if(n=!0,a.hasAttribute("value")){var d=a.value;Ke(a,"value",null),a.value=d}if(a.hasAttribute("checked")){var p=a.checked;Ke(a,"checked",null),a.checked=p}}};a.__on_r=t,Da(t),vs()}}function ka(a,n){var t=Ta(a);t.value===(t.value=n??void 0)||a.value===n&&(n!==0||a.nodeName!=="PROGRESS")||(a.value=n??"")}function ts(a,n){var t=Ta(a);t.checked!==(t.checked=n??void 0)&&(a.checked=n)}function Ke(a,n,t,d){var p=Ta(a);fa&&(p[n]=a.getAttribute(n),n==="src"||n==="srcset"||n==="href"&&a.nodeName==="LINK")||p[n]!==(p[n]=t)&&(n==="loading"&&(a[ns]=t),t==null?a.removeAttribute(n):typeof t!="string"&&$s(a).includes(n)?a[n]=t:a.setAttribute(n,t))}function Ta(a){return a.__attributes??={[Ss]:a.nodeName.includes("-"),[xs]:a.namespaceURI===os}}var Ha=new Map;function $s(a){var n=a.getAttribute("is")||a.nodeName,t=Ha.get(n);if(t)return t;Ha.set(n,t=[]);for(var d,p=a,h=Element.prototype;h!==p;){d=ds(p);for(var m in d)d[m].set&&t.push(m);p=cs(p)}return t}function Ee(a,n,t=n){var d=new WeakSet;Sa(a,"input",async p=>{var h=p?a.defaultValue:a.value;if(h=Ca(a)?La(h):h,t(h),Xt!==null&&d.add(Xt),await us(),h!==(h=n())){var m=a.selectionStart,D=a.selectionEnd,k=a.value.length;if(a.value=h??"",D!==null){var S=a.value.length;m===D&&D===k&&S>k?(a.selectionStart=S,a.selectionEnd=S):(a.selectionStart=m,a.selectionEnd=Math.min(D,S))}}}),(fa&&a.defaultValue!==a.value||i(n)==null&&a.value)&&(t(Ca(a)?La(a.value):a.value),Xt!==null&&d.add(Xt)),Ia(()=>{var p=n();if(a===document.activeElement){var h=Za??Xt;if(d.has(h))return}Ca(a)&&p===La(a.value)||a.type==="date"&&!p&&!a.value||p!==a.value&&(a.value=p??"")})}const $a=new Set;function Ua(a,n,t,d,p=d){var h=t.getAttribute("type")==="checkbox",m=a;let D=!1;if(n!==null)for(var k of n)m=m[k]??=[];m.push(t),Sa(t,"change",()=>{var S=t.__value;h&&(S=Na(m,S,t.checked)),p(S)},()=>p(h?[]:null)),Ia(()=>{var S=d();if(fa&&t.defaultChecked!==t.checked){D=!0;return}h?(S=S||[],t.checked=S.includes(t.__value)):t.checked=Ya(t.__value,S)}),Pa(()=>{var S=m.indexOf(t);S!==-1&&m.splice(S,1)}),$a.has(m)||($a.add(m),Da(()=>{m.sort((S,Z)=>S.compareDocumentPosition(Z)===4?-1:1),$a.delete(m)})),Da(()=>{if(D){var S;if(h)S=Na(m,S,t.checked);else{var Z=m.find(K=>K.checked);S=Z?.__value}p(S)}})}function Fa(a,n,t=n){Sa(a,"change",d=>{var p=d?a.defaultChecked:a.checked;t(p)}),(fa&&a.defaultChecked!==a.checked||i(n)==null)&&t(a.checked),Ia(()=>{var d=n();a.checked=!!d})}function Na(a,n,t){for(var d=new Set,p=0;p<a.length;p+=1)a[p].checked&&d.add(a[p].__value);return t||d.delete(n),Array.from(d)}function Ca(a){var n=a.type;return n==="number"||n==="range"}function La(a){return a===""?null:+a}function Cs(a,n,t){var d=ps(a,n);d&&d.set&&(a[n]=t,Pa(()=>{a[n]=null}))}function Ea(a){return function(...n){var t=n[0];return t.stopPropagation(),a?.apply(this,n)}}function na(a,n){var t=a.$$events?.[n.type],d=Qa(t)?t.slice():t==null?[]:[t];for(var p of d)p.call(this,n)}const Ls="";function as(...a){return va+Ls+ks(a[0],a[1])}const Ma={paladin:{name:"Paladin",hitDice:"d10",spellcaster:!0,spellcastingAbility:"charisma",spellSlotsByLevel:{1:0,2:2,3:3,4:3,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Divine Sense",type:"uses",maxUses:(a,n=1)=>1+Math.max(1,n),resetOn:"long",description:"Detect celestials, fiends, and undead within 60 feet",minLevel:1},{name:"Lay on Hands",type:"pool",maxPool:a=>a*5,resetOn:"long",description:"Heal wounds or cure disease",minLevel:1},{name:"Divine Smite",type:"spellSlot",description:"Expend spell slot to deal extra radiant damage",minLevel:2,rollable:!0},{name:"Channel Divinity",type:"pool",maxPool:a=>a>=18?3:a>=6?2:1,resetOn:"short",description:"Sacred Weapon or Turn Undead",minLevel:3}]},fighter:{name:"Fighter",hitDice:"d10",spellcaster:!1,features:[{name:"Second Wind",type:"uses",maxUses:1,resetOn:"short",description:"Regain 1d10 + fighter level HP as bonus action",minLevel:1,rollable:!0,rollFormula:a=>`1d10+${a}`},{name:"Action Surge",type:"uses",maxUses:a=>a>=17?2:1,resetOn:"short",description:"Take one additional action on your turn",minLevel:2},{name:"Indomitable",type:"uses",maxUses:a=>a>=17?3:a>=13?2:1,resetOn:"long",description:"Reroll a failed saving throw",minLevel:9}],subclasses:{champion:{name:"Champion",features:[{name:"Improved Critical",type:"info",description:"Critical hit on 19-20",minLevel:3},{name:"Remarkable Athlete",type:"info",description:"Add half proficiency to STR/DEX/CON checks, increase long jump distance",minLevel:7},{name:"Additional Fighting Style",type:"info",description:"Choose a second fighting style",minLevel:10},{name:"Superior Critical",type:"info",description:"Critical hit on 18-20",minLevel:15},{name:"Survivor",type:"info",description:"Regain 5 + CON mod HP at start of turn if below half HP",minLevel:18}]},battlemaster:{name:"Battle Master",features:[{name:"Combat Superiority",type:"uses",maxUses:a=>a>=15?6:a>=7?5:4,resetOn:"short",description:a=>`Use superiority dice (${a>=18?"d12":a>=10?"d10":"d8"}) for maneuvers`,minLevel:3},{name:"Know Your Enemy",type:"info",description:"Learn capabilities of creatures you observe",minLevel:7},{name:"Improved Combat Superiority",type:"info",description:"Superiority dice become d10",minLevel:10},{name:"Relentless",type:"info",description:"Regain 1 superiority die if you have none at start of turn",minLevel:15}]}}},rogue:{name:"Rogue",hitDice:"d8",spellcaster:!1,features:[{name:"Sneak Attack",type:"info",description:a=>`Deal ${Math.ceil(a/2)}d6 extra damage once per turn with advantage or ally nearby`,minLevel:1,rollable:!0,rollFormula:a=>`${Math.ceil(a/2)}d6`},{name:"Cunning Action",type:"info",description:"Dash, Disengage, or Hide as a bonus action",minLevel:2},{name:"Uncanny Dodge",type:"info",description:"Use reaction to halve damage from an attack",minLevel:5},{name:"Evasion",type:"info",description:"Take no damage on successful Dex save (half on fail)",minLevel:7}]},wizard:{name:"Wizard",hitDice:"d6",spellcaster:!0,spellcastingAbility:"intelligence",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Arcane Recovery",type:"uses",maxUses:1,resetOn:"long",description:a=>`Recover spell slots totaling up to ${Math.ceil(a/2)} levels during short rest`,minLevel:1},{name:"Spell Mastery",type:"info",description:"Cast one 1st-level and one 2nd-level spell at will",minLevel:18}]},cleric:{name:"Cleric",hitDice:"d8",spellcaster:!0,spellcastingAbility:"wisdom",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Channel Divinity",type:"pool",maxPool:a=>a>=18?3:a>=6?2:1,resetOn:"short",description:"Turn Undead or domain-specific ability",minLevel:2},{name:"Destroy Undead",type:"info",description:a=>`Channel Divinity destroys undead of CR ${a>=17?4:a>=14?3:a>=11?2:a>=8?1:.5} or lower`,minLevel:5},{name:"Divine Intervention",type:"uses",maxUses:1,resetOn:"long",description:a=>`${a}% chance to succeed, implore deity for aid`,minLevel:10}],subclasses:{war:{name:"War Domain",features:[{name:"War Priest",type:"uses",maxUses:(a,n=1)=>Math.max(1,n),resetOn:"long",description:"Make one weapon attack as a bonus action",minLevel:1},{name:"Guided Strike",type:"channelDivinity",description:"Use your Channel Divinity to gain +10 to an attack roll. Make this choice after you see the roll, but before the DM says whether the attack hits or misses.",minLevel:2,resetOn:"short"},{name:"War God's Blessing",type:"channelDivinity",description:"Use reaction to grant +10 to an ally's attack roll within 30 feet. Consumes one use of Channel Divinity.",minLevel:6,resetOn:"short"},{name:"Divine Strike",type:"info",description:a=>`Deal extra ${a>=14?"2d8":"1d8"} weapon damage once per turn`,minLevel:8,rollable:!0,rollFormula:a=>a>=14?"2d8":"1d8"},{name:"Avatar of Battle",type:"info",description:"Gain resistance to nonmagical weapon damage",minLevel:17}]},life:{name:"Life Domain",features:[{name:"Disciple of Life",type:"info",description:"Healing spells restore additional 2 + spell level HP",minLevel:1},{name:"Preserve Life",type:"pool",maxPool:a=>a*5,resetOn:"short",description:"Restore HP to creatures within 30 feet",minLevel:2},{name:"Blessed Healer",type:"info",description:"Regain 2 + spell level HP when you cast healing spell",minLevel:6},{name:"Divine Strike",type:"info",description:a=>`Deal extra ${a>=14?"2d8":"1d8"} radiant damage once per turn`,minLevel:8,rollable:!0,rollFormula:a=>a>=14?"2d8":"1d8"},{name:"Supreme Healing",type:"info",description:"Maximize healing dice instead of rolling",minLevel:17}]}}},barbarian:{name:"Barbarian",hitDice:"d12",spellcaster:!1,features:[{name:"Rage",type:"uses",maxUses:a=>a>=20?1/0:a>=17?6:a>=12?5:a>=6?4:a>=3?3:2,resetOn:"long",description:a=>`+${a>=16?4:a>=9?3:2} damage, resistance to physical damage`,minLevel:1},{name:"Reckless Attack",type:"info",description:"Gain advantage on melee attacks, enemies get advantage on you",minLevel:2},{name:"Danger Sense",type:"info",description:"Advantage on Dex saves against effects you can see",minLevel:2}],subclasses:{berserker:{name:"Path of the Berserker",features:[{name:"Frenzy",type:"info",description:"While raging, make melee attack as bonus action (gain 1 exhaustion after rage)",minLevel:3},{name:"Mindless Rage",type:"info",description:"Cannot be charmed or frightened while raging",minLevel:6},{name:"Intimidating Presence",type:"info",description:"Use action to frighten creature within 30 feet",minLevel:10},{name:"Retaliation",type:"info",description:"When damaged by creature within 5 feet, make melee attack as reaction",minLevel:14}]}}}};function qt(a){const n=a.toLowerCase();return Ma[n]||null}function oa(a,n,t){const d=qt(a);if(!d)return[];const p=d.features.filter(h=>!h.minLevel||h.minLevel<=n);if(t&&d.subclasses&&d.subclasses[t]){const h=d.subclasses[t].features.filter(m=>!m.minLevel||m.minLevel<=n);return[...p,...h]}return p}function Ga(a){const n=qt(a);return!n||!n.subclasses?[]:Object.keys(n.subclasses).map(t=>({id:t,name:n.subclasses[t].name}))}function Oa(a,n){const t=qt(a);return!t||!t.spellcaster||!t.spellSlotsByLevel?0:t.spellSlotsByLevel[n]||0}function qa(a,n,t){const d=qt(a);return!d||!d.spellcaster?0:Math.max(1,t+n)}function ws(a,n,t){const d=qt(a);return!d||!d.spellcaster?null:8+n+t}function Ds(){return Object.keys(Ma).map(a=>({id:a,name:Ma[a].name}))}var js=f('<div class="section-header svelte-ls99y2" role="button" tabindex="0"><h2 class="svelte-ls99y2"> </h2> <span class="collapse-btn svelte-ls99y2"> </span></div>');function la(a,n){Tt(n,!1);let t=yt(n,"title",8),d=yt(n,"collapsed",8),p=yt(n,"ariaLabel",8,""),h=yt(n,"onToggle",8);It();var m=js(),D=r(m),k=r(D,!0);l(D);var S=s(D,2),Z=r(S,!0);l(S),l(m),P(()=>{Ke(m,"aria-expanded",!d()),Ke(m,"aria-label",p()),w(k,t()),w(Z,d()?"â–¼":"â–²")}),F("click",m,function(...K){h()?.apply(this,K)}),F("keydown",m,K=>{(K.key==="Enter"||K.key===" ")&&h()()}),c(a,m),Et()}var Bs=f("<option> </option>"),As=f("<option> </option>"),Fs=f('<div class="form-group svelte-172i2fj"><label for="characterSubclass" class="svelte-172i2fj">Subclass</label> <select id="characterSubclass" class="svelte-172i2fj"><option>Select Subclass</option><!></select></div>'),Ms=f('<div class="info-grid svelte-172i2fj"><div class="form-group svelte-172i2fj"><label for="characterName" class="svelte-172i2fj">Character Name</label> <input type="text" id="characterName" placeholder="Enter name" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterClass" class="svelte-172i2fj">Class</label> <select id="characterClass" class="svelte-172i2fj"><option>Select Class</option><!></select></div> <!> <div class="form-group svelte-172i2fj"><label for="characterLevel" class="svelte-172i2fj">Level</label> <input type="number" id="characterLevel" min="1" max="20" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterRace" class="svelte-172i2fj">Race</label> <input type="text" id="characterRace" placeholder="e.g., Human" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterBackground" class="svelte-172i2fj">Background</label> <input type="text" id="characterBackground" placeholder="e.g., Soldier" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterAlignment" class="svelte-172i2fj">Alignment</label> <input type="text" id="characterAlignment" placeholder="e.g., Lawful Good" class="svelte-172i2fj"/></div></div>'),Rs=f('<section class="character-info svelte-172i2fj"><!> <!></section>');function Ps(a,n){Tt(n,!1);const t=()=>at(le,"$character",p),d=()=>at(Rt,"$collapsedStates",p),[p,h]=Wt(),m=M(),D=Ds();function k(ie){const _e=ie.target;le.update(X=>(X.class=_e.value,X.subclass="",X))}function S(ie){const _e=ie.target;le.update(X=>(X.subclass=_e.value,X))}function Z(ie){const _e=ie.target;le.update(X=>(X.level=parseInt(_e.value)||1,X)),es()}et(()=>(t(),Ga),()=>{o(m,t().class?Ga(t().class):[])}),Jt(),It();var K=Rs(),re=r(K);{let ie=ot(()=>(d(),i(()=>d().characterInfo?"Expand":"Collapse")));la(re,{title:"Character Info",get collapsed(){return d(),i(()=>d().characterInfo)},get ariaLabel(){return e(ie)},onToggle:()=>Rt.update(_e=>({..._e,characterInfo:!_e.characterInfo}))})}var ve=s(re,2);{var N=ie=>{var _e=Ms(),X=r(_e),He=s(r(X),2);Ce(He),l(X);var Ve=s(X,2),q=s(r(Ve),2),Xe=r(q);Xe.value=Xe.__value="";var ye=s(Xe);_t(ye,1,()=>D,kt,(Je,Pe)=>{var g=Bs(),C=r(g,!0);l(g);var Q={};P(()=>{w(C,(e(Pe),i(()=>e(Pe).name))),Q!==(Q=(e(Pe),i(()=>e(Pe).id)))&&(g.value=(g.__value=(e(Pe),i(()=>e(Pe).id)))??"")}),c(Je,g)}),l(q);var U;Ba(q),l(Ve);var se=s(Ve,2);{var ne=Je=>{var Pe=Fs(),g=s(r(Pe),2),C=r(g);C.value=C.__value="";var Q=s(C);_t(Q,1,()=>e(m),kt,(O,ke)=>{var Ge=As(),st=r(Ge,!0);l(Ge);var Se={};P(()=>{w(st,(e(ke),i(()=>e(ke).name))),Se!==(Se=(e(ke),i(()=>e(ke).id)))&&(Ge.value=(Ge.__value=(e(ke),i(()=>e(ke).id)))??"")}),c(O,Ge)}),l(g);var pe;Ba(g),l(Pe),P(()=>{pe!==(pe=(t(),i(()=>t().subclass)))&&(g.value=(g.__value=(t(),i(()=>t().subclass)))??"",ya(g,(t(),i(()=>t().subclass))))}),F("change",g,S),c(Je,Pe)};y(se,Je=>{e(m),i(()=>e(m).length>0)&&Je(ne)})}var de=s(se,2),we=s(r(de),2);Ce(we),l(de);var x=s(de,2),ue=s(r(x),2);Ce(ue),l(x);var b=s(x,2),R=s(r(b),2);Ce(R),l(b);var z=s(b,2),Ne=s(r(z),2);Ce(Ne),l(z),l(_e),P(()=>{U!==(U=(t(),i(()=>t().class)))&&(q.value=(q.__value=(t(),i(()=>t().class)))??"",ya(q,(t(),i(()=>t().class)))),ka(we,(t(),i(()=>t().level)))}),Ee(He,()=>t().name,Je=>bt(le,i(t).name=Je,i(t))),F("change",q,k),F("change",we,Z),Ee(ue,()=>t().race,Je=>bt(le,i(t).race=Je,i(t))),Ee(R,()=>t().background,Je=>bt(le,i(t).background=Je,i(t))),Ee(Ne,()=>t().alignment,Je=>bt(le,i(t).alignment=Je,i(t))),c(ie,_e)};y(ve,ie=>{d(),i(()=>!d().characterInfo)&&ie(N)})}l(K),c(a,K),Et(),h()}var Is=f('<div class="ability-card svelte-bbv1xt"><h3 class="svelte-bbv1xt"> </h3> <input type="number" class="ability-score svelte-bbv1xt" min="1" max="30"/> <div class="ability-modifier svelte-bbv1xt"> </div> <button class="roll-btn svelte-bbv1xt">Check</button> <div class="save-row svelte-bbv1xt"><input type="checkbox" class="svelte-bbv1xt"/> <label class="svelte-bbv1xt">Save</label> <button class="roll-btn-small svelte-bbv1xt">Roll</button></div></div>'),Ts=f('<div class="proficiency-bonus svelte-bbv1xt"><label for="profBonus">Proficiency Bonus</label> <input type="number" id="profBonus" class="prof-input svelte-bbv1xt"/></div> <div class="abilities-grid svelte-bbv1xt"></div>',1),Es=f("<section><!> <!></section>");function Hs(a,n){Tt(n,!1);const t=()=>at(ga,"$abilityModifiers",m),d=()=>at(le,"$character",m),p=()=>at(Zt,"$searchFilter",m),h=()=>at(Rt,"$collapsedStates",m),[m,D]=Wt(),k=M(),S=M(),Z=sa(),K=[{key:"strength",label:"Strength"},{key:"dexterity",label:"Dexterity"},{key:"constitution",label:"Constitution"},{key:"intelligence",label:"Intelligence"},{key:"wisdom",label:"Wisdom"},{key:"charisma",label:"Charisma"}];function re(){es()}function ve(q){const Xe=t()[q],ye=`1d20${Xe>=0?"+":""}${Xe}`,U=[];U.push({value:"1d20",source:"base die"}),Xe!==0&&U.push({value:Xe,source:q}),Z("roll",{notation:ye,rollType:"check",bonusBreakdown:U})}function N(q){const Xe=t()[q],ye=d().saveProficiencies[q]?d().proficiencyBonus:0,U=Xe+ye,se=`1d20${U>=0?"+":""}${U}`,ne=[];ne.push({value:"1d20",source:"base die"}),Xe!==0&&ne.push({value:Xe,source:q}),ye!==0&&ne.push({value:ye,source:"proficiency"}),Z("roll",{notation:se,rollType:"save",bonusBreakdown:ne})}et(()=>p(),()=>{o(k,K.filter(({label:q})=>p()?q.toLowerCase().includes(p().toLowerCase()):!0))}),et(()=>(e(k),p()),()=>{o(S,e(k).length>0||!p()||p().toLowerCase().includes("proficiency"))}),Jt(),It();var ie=Es();let _e;var X=r(ie);la(X,{title:"Ability Scores",get collapsed(){return h(),i(()=>h().abilityScores)},ariaLabel:"Toggle Ability Scores Section",onToggle:()=>Rt.update(q=>({...q,abilityScores:!q.abilityScores}))});var He=s(X,2);{var Ve=q=>{var Xe=Ts(),ye=Ue(Xe),U=s(r(ye),2);Ce(U),l(ye);var se=s(ye,2);_t(se,5,()=>e(k),kt,(ne,de)=>{let we=()=>e(de).key,x=()=>e(de).label;var ue=Is(),b=r(ue),R=r(b,!0);l(b);var z=s(b,2);Ce(z);var Ne=s(z,2),Je=r(Ne);l(Ne);var Pe=s(Ne,2),g=s(Pe,2),C=r(g);Ce(C);var Q=s(C,2),pe=s(Q,2);l(g),l(ue),P(O=>{w(R,O),w(Je,`${t(),we(),i(()=>t()[we()]>=0?"+":"")??""}${t(),we(),i(()=>t()[we()])??""}`),Ke(C,"id",`${we()}-save`),Ke(Q,"for",`${we()}-save`)},[()=>(x(),i(()=>x().substring(0,3).toUpperCase()))]),Ee(z,()=>d().abilities[we()],O=>bt(le,i(d).abilities[we()]=O,i(d))),F("change",z,re),F("click",Pe,()=>ve(we())),Fa(C,()=>d().saveProficiencies[we()],O=>bt(le,i(d).saveProficiencies[we()]=O,i(d))),F("click",pe,()=>N(we())),c(ne,ue)}),l(se),Ee(U,()=>d().proficiencyBonus,ne=>bt(le,i(d).proficiencyBonus=ne,i(d))),c(q,Xe)};y(He,q=>{h(),i(()=>!h().abilityScores)&&q(Ve)})}l(ie),P(()=>_e=mt(ie,1,"ability-scores svelte-bbv1xt",null,_e,{hidden:!e(S)})),c(a,ie),Et(),D()}function Ra(a,n){if(!a.class)return null;const t=qt(a.class);if(!t||!t.spellcaster||!t.spellcastingAbility)return null;const d=n[t.spellcastingAbility];return 8+a.proficiencyBonus+d}function Wa(a,n){if(!a.class)return 0;const t=qt(a.class);return!t||!t.spellcaster||!t.spellcastingAbility?0:n[t.spellcastingAbility]}var Us=f('<input type="number" id="armorClass" class="stat-input svelte-1r5hyyb"/>'),Ns=f('<input type="text" id="armorClass" readonly=""/>'),Gs=f('<div class="stat-box svelte-1r5hyyb"><label for="spellSaveDC" class="svelte-1r5hyyb">Spell Save DC</label> <input type="number" id="spellSaveDC" class="stat-input svelte-1r5hyyb" readonly="" title="8 + Proficiency Bonus + Spellcasting Ability Modifier"/></div>'),Os=f('<span class="hit-dice-type"> </span>'),qs=f('<div class="stats-grid svelte-1r5hyyb"><div class="stat-box svelte-1r5hyyb"><label for="armorClass" class="svelte-1r5hyyb">Armor Class</label> <!></div> <div class="stat-box svelte-1r5hyyb"><label for="initiative" class="svelte-1r5hyyb">Initiative</label> <input type="number" id="initiative" class="stat-input svelte-1r5hyyb"/></div> <div class="stat-box svelte-1r5hyyb"><label for="speed" class="svelte-1r5hyyb">Speed</label> <input type="text" id="speed" class="stat-input svelte-1r5hyyb"/></div> <!></div> <div class="hp-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Points</h3> <div><div class="hp-inputs svelte-1r5hyyb"><input type="number" class="hp-current svelte-1r5hyyb" min="0"/> <span class="hp-separator svelte-1r5hyyb">/</span> <input type="number" class="hp-max svelte-1r5hyyb" min="0"/></div> <div class="hp-controls svelte-1r5hyyb"><button class="hp-btn svelte-1r5hyyb">âˆ’</button> <button class="hp-btn svelte-1r5hyyb">+</button> <button class="hp-btn svelte-1r5hyyb">âˆ’5</button> <button class="hp-btn svelte-1r5hyyb">+5</button></div></div> <div class="temp-hp svelte-1r5hyyb"><label for="tempHP" class="svelte-1r5hyyb">Temp HP</label> <input type="number" id="tempHP" min="0" class="svelte-1r5hyyb"/></div></div> <div class="hit-dice-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Dice</h3> <div class="hit-dice-display svelte-1r5hyyb"><input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <span>/</span> <input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <!></div> <div class="hit-dice-controls svelte-1r5hyyb"><label for="hitDiceCount" class="svelte-1r5hyyb">Roll</label> <div class="hit-dice-count-controls svelte-1r5hyyb"><button class="hit-dice-btn svelte-1r5hyyb">âˆ’</button> <input type="number" id="hitDiceCount" class="hit-dice-count-input svelte-1r5hyyb" min="1"/> <button class="hit-dice-btn svelte-1r5hyyb">+</button></div> <button class="btn btn-primary roll-hit-dice use-enabled svelte-1r5hyyb">ðŸŽ² Roll</button></div></div>',1),Ws=f("<section><!> <!></section>");function zs(a,n){Tt(n,!1);const t=()=>at(le,"$character",D),d=()=>at(ga,"$abilityModifiers",D),p=()=>at(Zt,"$searchFilter",D),h=()=>at(Rt,"$collapsedStates",D),m=()=>at(ia,"$isEditMode",D),[D,k]=Wt(),S=M(),Z=M(),K=M(),re=M(),ve=sa();let N=M(1);function ie(U){le.update(se=>(se.currentHP=Math.max(0,Math.min(se.maxHP,se.currentHP+U)),se))}function _e(U){const se=e(N)+U,ne=t().hitDice.current;o(N,Math.max(1,Math.min(ne,se)))}function X(U=1){if(t().hitDice.current<=0){alert("No hit dice remaining!");return}if(!t().class){alert("Please select a class first!");return}const se=qt(t().class);if(!se){alert("Invalid class configuration!");return}const ne=Math.min(U,t().hitDice.current),de=se.hitDice,we=d().constitution,x=we*ne,ue=x>=0?`+${x}`:`${x}`,b=`${ne}${de}${ue}`,R=[];if(R.push({value:`${ne}${de}`,source:"hit dice"}),we!==0)for(let z=0;z<ne;z++)R.push({value:we,source:"constitution"});ve("rollHitDice",{notation:b,hitDie:de,count:ne,bonusBreakdown:R})}et(()=>(t(),d()),()=>{o(S,Ra(t(),d()))}),et(()=>(t(),e(N)),()=>{const U=t().hitDice.current;U>0&&e(N)>U&&o(N,U)}),et(()=>t(),()=>{o(Z,t().activeStates&&t().activeStates.length>0?t().activeStates.reduce((U,se)=>U+(se.acBonus||0),0):0)}),et(()=>t(),()=>{o(K,t().activeStates&&t().activeStates.length>0?t().activeStates.some(U=>U.name==="Aid"&&U.target==="self"):!1)}),et(()=>p(),()=>{o(re,!p()||"armor class".includes(p().toLowerCase())||"initiative".includes(p().toLowerCase())||"speed".includes(p().toLowerCase())||"hit points".includes(p().toLowerCase())||"hp".includes(p().toLowerCase())||"hit dice".includes(p().toLowerCase())||"spell save".includes(p().toLowerCase())||"combat".includes(p().toLowerCase()))}),Jt(),It();var He=Ws();let Ve;var q=r(He);{let U=ot(()=>(h(),i(()=>h().combatStats?"Expand":"Collapse")));la(q,{title:"Combat Stats",get collapsed(){return h(),i(()=>h().combatStats)},get ariaLabel(){return e(U)},onToggle:()=>Rt.update(se=>({...se,combatStats:!se.combatStats}))})}var Xe=s(q,2);{var ye=U=>{var se=qs(),ne=Ue(se),de=r(ne),we=s(r(de),2);{var x=I=>{var Y=Us();Ce(Y),Ee(Y,()=>t().armorClass,xe=>bt(le,i(t).armorClass=xe,i(t))),c(I,Y)},ue=I=>{var Y=Ns();Ce(Y),P(()=>{ka(Y,(e(Z),t(),i(()=>e(Z)!==0?`${t().armorClass} â†’ ${t().armorClass+e(Z)}`:`${t().armorClass}`))),mt(Y,1,gs(e(Z)!==0?"stat-input ac-enhanced":"stat-input"),"svelte-1r5hyyb"),Ke(Y,"title",e(Z)!==0?"Base AC plus active effect bonuses":"Base Armor Class")}),c(I,Y)};y(we,I=>{m()?I(x):I(ue,!1)})}l(de);var b=s(de,2),R=s(r(b),2);Ce(R),l(b);var z=s(b,2),Ne=s(r(z),2);Ce(Ne),l(z);var Je=s(z,2);{var Pe=I=>{var Y=Gs(),xe=s(r(Y),2);Ce(xe),l(Y),P(()=>ka(xe,e(S))),c(I,Y)};y(Je,I=>{e(S)!==null&&I(Pe)})}l(ne);var g=s(ne,2),C=s(r(g),2);let Q;var pe=r(C),O=r(pe);Ce(O);var ke=s(O,4);Ce(ke),l(pe);var Ge=s(pe,2),st=r(Ge),Se=s(st,2),Oe=s(Se,2),A=s(Oe,2);l(Ge),l(C);var $=s(C,2),oe=s(r($),2);Ce(oe),l($),l(g);var ce=s(g,2),W=s(r(ce),2),v=r(W);Ce(v);var Ie=s(v,4);Ce(Ie);var ge=s(Ie,2);{var be=I=>{const Y=ot(()=>(E(qt),t(),i(()=>qt(t().class))));var xe=nt(),Te=Ue(xe);{var qe=ee=>{const fe=ot(()=>(d(),i(()=>d().constitution)));var Me=Os(),Qe=r(Me);l(Me),P(()=>w(Qe,`(${E(e(Y)),i(()=>e(Y).hitDice)??""}${(e(fe)>=0?`+${e(fe)}`:e(fe))??""})`)),c(ee,Me)};y(Te,ee=>{e(Y)&&ee(qe)})}c(I,xe)};y(ge,I=>{t(),i(()=>t().class)&&I(be)})}l(W);var B=s(W,2),De=s(r(B),2),Fe=r(De),We=s(Fe,2);Ce(We);var lt=s(We,2);l(De);var je=s(De,2);l(B),l(ce),P(()=>{Q=mt(C,1,"hp-display svelte-1r5hyyb",null,Q,{"aid-active":e(K)}),Ke(O,"max",(t(),i(()=>t().maxHP))),Ke(v,"max",(t(),i(()=>t().hitDice.max))),Fe.disabled=e(N)<=1,Ke(We,"max",(t(),i(()=>t().hitDice.current))),lt.disabled=(e(N),t(),i(()=>e(N)>=t().hitDice.current)),je.disabled=(t(),i(()=>t().hitDice.current<=0||!t().class))}),Ee(R,()=>t().initiative,I=>bt(le,i(t).initiative=I,i(t))),Ee(Ne,()=>t().speed,I=>bt(le,i(t).speed=I,i(t))),Ee(O,()=>t().currentHP,I=>bt(le,i(t).currentHP=I,i(t))),Ee(ke,()=>t().maxHP,I=>bt(le,i(t).maxHP=I,i(t))),F("click",st,()=>ie(-1)),F("click",Se,()=>ie(1)),F("click",Oe,()=>ie(-5)),F("click",A,()=>ie(5)),Ee(oe,()=>t().tempHP,I=>bt(le,i(t).tempHP=I,i(t))),Ee(v,()=>t().hitDice.current,I=>bt(le,i(t).hitDice.current=I,i(t))),Ee(Ie,()=>t().hitDice.max,I=>bt(le,i(t).hitDice.max=I,i(t))),F("click",Fe,()=>_e(-1)),Ee(We,()=>e(N),I=>o(N,I)),F("input",We,I=>{const Y=I.target,xe=parseInt(Y.value);xe>t().hitDice.current&&o(N,t().hitDice.current),xe<1&&o(N,1)}),F("click",lt,()=>_e(1)),F("click",je,()=>X(e(N))),c(U,se)};y(Xe,U=>{h(),i(()=>!h().combatStats)&&U(ye)})}l(He),P(()=>Ve=mt(He,1,"combat-stats svelte-1r5hyyb",null,Ve,{hidden:!e(re)})),c(a,He),Et(),k()}const ha={acrobatics:"dexterity",animalHandling:"wisdom",arcana:"intelligence",athletics:"strength",deception:"charisma",history:"intelligence",insight:"wisdom",intimidation:"charisma",investigation:"intelligence",medicine:"wisdom",nature:"intelligence",perception:"wisdom",performance:"charisma",persuasion:"charisma",religion:"intelligence",sleightOfHand:"dexterity",stealth:"dexterity",survival:"wisdom"};var Ks=f('<div class="skill-row svelte-1f1pl16"><input type="checkbox" class="svelte-1f1pl16"/> <label class="svelte-1f1pl16"> <span class="ability-tag svelte-1f1pl16"> </span></label> <span class="skill-modifier svelte-1f1pl16"> </span> <button class="roll-btn svelte-1f1pl16">Roll</button></div>'),Vs=f('<div class="skills-grid svelte-1f1pl16"></div>'),Js=f("<section><!> <!></section>");function Qs(a,n){Tt(n,!1);const t=()=>at(le,"$character",m),d=()=>at(ga,"$abilityModifiers",m),p=()=>at(Zt,"$searchFilter",m),h=()=>at(Rt,"$collapsedStates",m),[m,D]=Wt(),k=M(),S=M(),Z=M(),K=M(),re=M(),ve=M(),N=sa(),ie=[{key:"acrobatics",label:"Acrobatics"},{key:"animalHandling",label:"Animal Handling"},{key:"arcana",label:"Arcana"},{key:"athletics",label:"Athletics"},{key:"deception",label:"Deception"},{key:"history",label:"History"},{key:"insight",label:"Insight"},{key:"intimidation",label:"Intimidation"},{key:"investigation",label:"Investigation"},{key:"medicine",label:"Medicine"},{key:"nature",label:"Nature"},{key:"perception",label:"Perception"},{key:"performance",label:"Performance"},{key:"persuasion",label:"Persuasion"},{key:"religion",label:"Religion"},{key:"sleightOfHand",label:"Sleight of Hand"},{key:"stealth",label:"Stealth"},{key:"survival",label:"Survival"}];function _e(ye){const U=ha[ye],se=d()[U],ne=t().skillProficiencies[ye]?t().proficiencyBonus:0,de=e(k)[ye],we=`1d20${de>=0?"+":""}${de}`,x=[];x.push({value:"1d20",source:"base die"}),se!==0&&x.push({value:se,source:U}),ne!==0&&x.push({value:ne,source:"proficiency"}),N("roll",{notation:we,rollType:"check",bonusBreakdown:x})}et(()=>{},()=>{o(k,{})}),et(()=>t(),()=>{o(S,t().skillProficiencies)}),et(()=>t(),()=>{o(Z,t().proficiencyBonus)}),et(()=>d(),()=>{o(K,d())}),et(()=>(e(K),e(S),e(Z)),()=>{for(const{key:ye}of ie){const U=ha[ye],se=e(K)[U],ne=e(S)[ye]?e(Z):0;aa(k,e(k)[ye]=se+ne)}}),et(()=>p(),()=>{o(re,ie.filter(({label:ye})=>p()?ye.toLowerCase().includes(p().toLowerCase()):!0))}),et(()=>e(re),()=>{o(ve,e(re).length>0)}),Jt(),It();var X=Js();let He;var Ve=r(X);{let ye=ot(()=>(h(),i(()=>h().skills?"Expand":"Collapse")));la(Ve,{title:"Skills",get collapsed(){return h(),i(()=>h().skills)},get ariaLabel(){return e(ye)},onToggle:()=>Rt.update(U=>({...U,skills:!U.skills}))})}var q=s(Ve,2);{var Xe=ye=>{var U=Vs();_t(U,5,()=>e(re),kt,(se,ne)=>{let de=()=>e(ne).key,we=()=>e(ne).label;var x=Ks(),ue=r(x);Ce(ue);var b=s(ue,2),R=r(b),z=s(R),Ne=r(z);l(z),l(b);var Je=s(b,2),Pe=r(Je);l(Je);var g=s(Je,2);l(x),P(C=>{ts(ue,(e(S),de(),i(()=>e(S)[de()]))),Ke(ue,"id",de()),Ke(b,"for",de()),w(R,`${we()??""} `),w(Ne,`(${C??""})`),w(Pe,`${e(k),de(),i(()=>e(k)[de()]>=0?"+":"")??""}${e(k),de(),i(()=>e(k)[de()])??""}`)},[()=>(E(ha),de(),i(()=>ha[de()].substring(0,3).toUpperCase()))]),F("change",ue,C=>{console.log("Skill proficiency changed:",de(),C.target.checked),le.update(Q=>({...Q,skillProficiencies:{...Q.skillProficiencies,[de()]:C.target.checked}}))}),F("click",g,()=>_e(de())),c(se,x)}),l(U),c(ye,U)};y(q,ye=>{h(),i(()=>!h().skills)&&ye(Xe)})}l(X),P(()=>He=mt(X,1,"skills svelte-1f1pl16",null,He,{hidden:!e(ve)})),c(a,X),Et(),D()}let ba=null,ma=null;async function ss(){if(ba)return ba;try{return ba=await(await fetch(as("/data/spells.json"))).json(),ba||[]}catch(a){return console.error("Failed to load spells:",a),[]}}async function Ys(){if(ma)return ma;try{return ma=await(await fetch(as("/data/feats.json"))).json(),ma||[]}catch(a){return console.error("Failed to load feats:",a),[]}}function za(a,n){if(!n.trim())return a;const t=n.toLowerCase();return a.filter(d=>d.name.toLowerCase().includes(t)||d.school.toLowerCase().includes(t)||d.classes.some(p=>p.toLowerCase().includes(t))||d.description.toLowerCase().includes(t))}function Xs(a,n){return n===null?a:a.filter(t=>t.level===n)}function Zs(a,n){if(!n.trim())return a;const t=n.toLowerCase();return a.filter(d=>d.name.toLowerCase().includes(t)||d.description.toLowerCase().includes(t))}function _a(a){const n=a.description,t=/\b(Strength|Dexterity|Constitution|Intelligence|Wisdom|Charisma)\s+saving\s+throw/i,d=n.match(t);if(!d)return null;const p=d[1].toLowerCase(),m=/half\s+(?:as\s+much\s+)?damage\s+on\s+a\s+successful(?:\s+save)?/i.test(n),k=/saving\s+throw\s+or\s+take.*?damage/i.test(n)&&!m;return{ability:p,halfDamageOnSave:m,noDamageOnSave:k}}function el(a){const n=a.description;return/(plus|add)\s+your\s+spellcasting\s+(ability\s+)?modifier/i.test(n)}function wa(a){const n=a.description.toLowerCase();return n.includes("ranged spell attack")||n.includes("melee spell attack")}function Ka(a){const n=a.description.toLowerCase();if(["Divine Favor","Bless","Aid","Command"].includes(a.name))return!0;const p=["takes","take","deals","deal","damage equal to","force damage","fire damage","cold damage","lightning damage","thunder damage","acid damage","poison damage","necrotic damage","radiant damage","psychic damage","regain","regains","hit point"].some(D=>n.includes(D));return["bonus to attack","bonus to damage","bonus to ac","gains a +","gain a +","+1 bonus","+2 bonus","+3 bonus","advantage on","becomes a magic weapon"].some(D=>n.includes(D))&&!p}function tl(a){const n=a.description;let t=0,d=0,p=0,h="";const m=n.match(/\+(\d+)\s+bonus\s+to\s+attack\s+rolls\s+and\s+damage\s+rolls/i);if(m){const k=parseInt(m[1]);t=k,d=k,h=`+${k} to attack and damage rolls`}if(a.name==="Bless"&&(h="Add 1d4 to attack rolls and saves",t="1d4"),a.name==="Aid")return h="+5 HP (max and current) for 8 hours",{attackBonus:0,damageBonus:0,acBonus:0,hpBonus:5,description:h,name:a.name};a.name==="Divine Favor"&&(h="Your weapon attacks deal an extra 1d4 radiant damage on a hit.",d="1d4");const D=n.match(/\+(\d+)\s+bonus\s+to\s+AC/i);return D&&(p=parseInt(D[1]),h=`+${p} to AC`),a.name==="Haste"&&(h="+2 AC, doubled speed, extra action",p=2),h||t!==0||d!==0||p!==0?{attackBonus:t,damageBonus:d,acBonus:p,description:h||a.description.substring(0,100),name:a.name}:null}var al=f('<button class="btn btn-secondary">Add Attack</button>'),sl=f('<input type="text" placeholder="Attack name" class="attack-name svelte-14o91c5"/>'),ll=f('<h4 class="attack-name-display svelte-14o91c5"> </h4>'),rl=f('<button class="btn-remove svelte-14o91c5">Ã—</button>'),il=f('<div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Bonus</label> <input type="number" class="attack-bonus svelte-14o91c5"/></div>'),nl=f('<div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Damage</label> <input type="text" placeholder="e.g., 2d6+3" class="attack-damage svelte-14o91c5"/></div>'),ol=f('<div class="spell-info-loading svelte-14o91c5">Loading spell info...</div>'),cl=f('<li class="svelte-14o91c5"><strong>At Higher Levels:</strong> </li>'),vl=f('<ul class="svelte-14o91c5"><li class="svelte-14o91c5"><strong>Level:</strong> </li> <li class="svelte-14o91c5"><strong>Casting Time:</strong> </li> <li class="svelte-14o91c5"><strong>Range:</strong> </li> <li class="svelte-14o91c5"><strong>Components:</strong> <!></li> <li class="svelte-14o91c5"><strong>Duration:</strong> <!> </li> <li class="svelte-14o91c5"><strong>Description:</strong> </li> <!></ul>'),dl=f('<span class="scaled-damage svelte-14o91c5" style="margin-left: 8px;"> </span>'),ul=f('<span class="scaled-damage svelte-14o91c5">(Half damage)</span>'),pl=f('<span class="scaled-damage svelte-14o91c5">(No damage)</span>'),fl=f('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> <!> <!></label></div>'),gl=f("<option> </option>"),hl=f('<span class="scaled-damage svelte-14o91c5"><!> </span>'),bl=f('<span class="scaled-damage svelte-14o91c5"> </span>'),ml=f('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> Target is Fiend or Undead <!></label></div>'),_l=f('<div class="spell-level-selector svelte-14o91c5"><label class="svelte-14o91c5">Cast at Level:</label> <select class="spell-level-select use-enabled svelte-14o91c5"></select> <!></div> <!>',1),yl=f('<div class="spell-level-selector svelte-14o91c5"><span style="color: #dc3545; font-weight: bold;">No spell slots available!</span></div>'),kl=f('<div class="spell-info svelte-14o91c5"><div class="spell-info-header svelte-14o91c5" role="button" tabindex="0"><h4 class="svelte-14o91c5">Spell Info</h4> <button class="collapse-btn-small svelte-14o91c5"> </button></div> <!></div> <!> <!>',1),Sl=f('<div class="spell-info-missing svelte-14o91c5">Spell info not found.</div>'),xl=f('<div class="attack-notes svelte-14o91c5"><label class="svelte-14o91c5">Notes</label> <textarea placeholder="e.g., DC 15 Dex save, Range 120 ft, Concentration" class="notes-input svelte-14o91c5" rows="2"></textarea></div>'),$l=f('<button class="btn btn-primary">Roll Attack</button>'),Cl=f('<div class="buff-target-selection svelte-14o91c5"><div class="target-options svelte-14o91c5"><label class="target-option svelte-14o91c5"><input type="radio" class="svelte-14o91c5"/> Self</label> <label class="target-option svelte-14o91c5"><input type="radio" class="svelte-14o91c5"/> Other</label></div> <button class="btn btn-info"> </button></div>'),Ll=f('<button class="btn btn-info">Cast Spell</button>'),wl=f("<button><!></button>"),Dl=f('<button class="btn btn-primary">Roll Attack</button> <button class="btn btn-secondary">Roll Damage</button>',1),jl=f('<div class="attack-card svelte-14o91c5"><div class="attack-header svelte-14o91c5"><!> <!></div> <div class="attack-details svelte-14o91c5"><!> <!> <div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Type</label> <input type="text" placeholder="e.g., slashing" class="attack-type svelte-14o91c5"/></div></div> <!> <!> <div class="attack-actions svelte-14o91c5"><!></div></div>'),Bl=f('<p class="no-attacks svelte-14o91c5">No attacks added yet. Click "Add Attack" to create one.</p>'),Al=f('<p class="no-attacks svelte-14o91c5">No attacks match your search.</p>'),Fl=f('<button class="btn-remove svelte-14o91c5">Ã—</button>'),Ml=f('<div class="state-card svelte-14o91c5"><div class="state-header svelte-14o91c5"><input type="text" placeholder="Effect name (e.g., Magic Weapon)" class="state-name svelte-14o91c5"/> <!></div> <div class="state-details svelte-14o91c5"><div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Attack Bonus</label> <input type="number" class="state-bonus svelte-14o91c5"/></div> <div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Damage Bonus</label> <input type="text" class="state-bonus svelte-14o91c5"/></div> <div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Target</label> <select class="state-bonus svelte-14o91c5"><option>Self</option><option>Other</option></select></div></div> <div class="state-description svelte-14o91c5"><label class="svelte-14o91c5">Description</label> <input type="text" placeholder="e.g., +1 to attack and damage rolls (Magic Weapon)" class="state-desc-input svelte-14o91c5"/></div></div>'),Rl=f('<div class="states-list svelte-14o91c5"></div>'),Pl=f('<p class="no-states svelte-14o91c5">No active effects. Add spell effects that modify your attacks.</p>'),Il=f('<!> <div class="attacks-list svelte-14o91c5"><!> <!></div> <div class="active-states-section svelte-14o91c5"><h3 class="svelte-14o91c5">Active Spell Effects</h3> <p class="section-description svelte-14o91c5">Effects that modify attack and damage rolls (e.g., Magic Weapon, Bless)</p> <button class="btn btn-secondary">Add Effect</button> <!></div>',1),Tl=f("<section><!> <!></section>");function El(a,n){Tt(n,!1);const t=()=>at(le,"$character",D),d=()=>at(ga,"$abilityModifiers",D),p=()=>at(Zt,"$searchFilter",D),h=()=>at(Rt,"$collapsedStates",D),m=()=>at(ia,"$isEditMode",D),[D,k]=Wt(),S=M(),Z=M(),K=[],re=sa();let ve=M({}),N=M({});function ie(g){aa(ve,e(ve)[g]=!e(ve)[g]),o(ve,{...e(ve)})}function _e(g){return g.description.toLowerCase().includes("regain")&&(g.description.toLowerCase().includes("hit point")||g.description.toLowerCase().includes("hp"))}function X(g){return["Shield of Faith","Bless","Aid","Magic Weapon"].includes(g)}function He(){le.update(g=>(g.attacks=[...g.attacks,{id:crypto.randomUUID(),name:"",bonus:0,damage:"",damageType:"",notes:""}],g))}function Ve(g){le.update(C=>(C.attacks=C.attacks.filter(Q=>Q.id!==g),C))}function q(g){let C=g.damage,Q=!1,pe=!1;if(g.spellRef){const Se=se(g.spellRef);if(Se&&(pe=wa(Se),Se.level>0)){const Oe=g.castAtLevel||Se.level;if(!ne(Oe)){Ot.add(`No level ${Oe} spell slots available!`,"error");return}const $=_a(Se);$&&g.targetSucceededSave&&$.noDamageOnSave?C="0":(Q=$?.halfDamageOnSave&&g.targetSucceededSave||!1,C=de(g,Se))}}else if(t().activeStates&&t().activeStates.length>0){let Se=0,Oe=[];for(const A of t().activeStates)A.target!=="other"&&(typeof A.damageBonus=="string"?Oe.push(A.damageBonus):typeof A.damageBonus=="number"&&(Se+=A.damageBonus));if((Se!==0||Oe.length>0)&&C){const A=C.match(/(\d+d\d+)([+-]\d+)?/);if(A){const[,$,oe]=A,W=(oe?parseInt(oe):0)+Se;let v=`${$}`;W!==0&&(v+=`${W>=0?"+":""}${W}`),Oe.length>0&&(v+=" + "+Oe.join(" + ")),C=v}}}const O=[];let ke=0;if(pe){const Se=Wa(t(),d()),Oe=t().proficiencyBonus||0;O.push({value:Oe,source:"proficiency"}),O.push({value:Se,source:"spellcasting"}),ke=Oe+Se}else g.bonus!==0&&O.push({value:g.bonus,source:"base"}),ke=g.bonus;let Ge=[];if(t().activeStates)for(const Se of t().activeStates)Se.target!=="other"&&(typeof Se.attackBonus=="number"&&Se.attackBonus!==0?(O.push({value:Se.attackBonus,source:Se.name.toLowerCase()}),ke+=Se.attackBonus):typeof Se.attackBonus=="string"&&Se.attackBonus&&(Ge.push(Se.attackBonus),O.push({value:Se.attackBonus,source:Se.name.toLowerCase()})));let st=`1d20${ke>=0?"+":""}${ke}`;Ge.length>0&&(st+="+"+Ge.join("+")),re("roll",{notation:st,damageNotation:C,attackName:g.name,applyHalfDamage:Q,bonusBreakdown:O,rollType:"attack"})}function Xe(g){if(!g.damage){Ot.add(`${g.name}: No damage specified`,"error");return}let C=g.damage,Q=!1;const pe=[];if(g.spellRef){const O=se(g.spellRef);if(O&&O.level>0){const ke=g.castAtLevel||O.level;if(!ne(ke)){Ot.add(`No level ${ke} spell slots available!`,"error");return}const st=_a(O);st&&g.targetSucceededSave&&st.noDamageOnSave?C="0":(Q=st?.halfDamageOnSave&&g.targetSucceededSave||!1,C=de(g,O))}}else{const O=C.match(/(\d+d\d+)([+-]\d+)?/);if(O){const[,ke,Ge]=O,st=Ge?parseInt(Ge):0;if(st!==0&&pe.push({value:st,source:"base"}),t().activeStates&&t().activeStates.length>0){let Se=0,Oe=[];for(const A of t().activeStates)A.target!=="other"&&(typeof A.damageBonus=="string"?Oe.push(A.damageBonus):typeof A.damageBonus=="number"&&A.damageBonus!==0&&(pe.push({value:A.damageBonus,source:A.name.toLowerCase()}),Se+=A.damageBonus));if(Se!==0||Oe.length>0){const A=st+Se;let $=`${ke}`;A!==0&&($+=`${A>=0?"+":""}${A}`),Oe.length>0&&($+=" + "+Oe.join(" + ")),C=$}}}}re("roll",{notation:C,attackName:g.name,applyHalfDamage:Q,bonusBreakdown:pe})}let ye=M([]),U=M(!1);pa(async()=>{o(ye,await ss()),o(U,!0)});function se(g){return e(ye).find(C=>C.name===g)}function ne(g){t().classFeatures.spellSlotsByLevel||bt(le,i(t).classFeatures.spellSlotsByLevel={},i(t)),t().classFeatures.spellSlotsByLevel[g]||bt(le,i(t).classFeatures.spellSlotsByLevel[g]=Array(2).fill(!1),i(t));const Q=t().classFeatures.spellSlotsByLevel[g].findIndex(pe=>!pe);return Q===-1?!1:(le.update(pe=>(pe.classFeatures.spellSlotsByLevel||(pe.classFeatures.spellSlotsByLevel={}),pe.classFeatures.spellSlotsByLevel[g]||(pe.classFeatures.spellSlotsByLevel[g]=Array(2).fill(!1)),pe.classFeatures.spellSlotsByLevel[g][Q]=!0,pe)),!0)}function de(g,C){let Q=g.damage,pe=0,O=0;if(el(C)&&(O+=Wa(t(),d())),t().activeStates)for(const ce of t().activeStates)ce.target!=="other"&&typeof ce.damageBonus=="number"&&(O+=ce.damageBonus);if(C.higherLevelSlot&&g.castAtLevel){const ce=C.level,v=(g.castAtLevel||ce)-ce;if(v>0){const Ie=C.higherLevelSlot.match(/(\d+)d(\d+)\s+for\s+each.*?level\s+above/i);if(Ie){const[,ge]=Ie;pe+=v*parseInt(ge)}}}if(g.targetIsFiendOrUndead&&C.description.includes("Fiend or an Undead")){const ce=C.description.match(/increases by (\d+)d(\d+) if.*?Fiend or.*?Undead/i);if(ce){const[,W]=ce;pe+=parseInt(W)}}const ke=Q.match(/(\d+)d(\d+)([+-]\d+)?/);if(!ke)return O!==0?O>=0?`${O}`:`${O}`:Q||"0";const[,Ge,st,Se]=ke,Oe=parseInt(Ge)+pe,$=(Se?parseInt(Se):0)+O;let oe=`${Oe}d${st}`;return $!==0&&(oe+=$>=0?`+${$}`:`${$}`),oe}function we(g){const C=[];for(let pe=g.level;pe<=9;pe++){const O=t().classFeatures.spellSlotsByLevel?.[pe];O&&O.length>0&&C.push(pe)}return C}function x(){le.update(g=>(g.activeStates||(g.activeStates=[]),g.activeStates=[...g.activeStates,{name:"",attackBonus:0,damageBonus:0,description:"",target:"self"}],g))}function ue(g){le.update(C=>{if(C.activeStates){const Q=C.activeStates[g];Q?.hpBonus&&Q.target!=="other"&&(C.maxHP-=Q.hpBonus,C.currentHP=Math.max(1,Math.min(C.currentHP-Q.hpBonus,C.maxHP))),C.activeStates=C.activeStates.filter((pe,O)=>O!==g)}return C})}function b(g,C="self"){const Q=se(g.spellRef);if(!Q){Ot.add("Spell not found","error");return}const pe=g.castAtLevel||Q.level;if(pe>0&&!ne(pe)){Ot.add(`No level ${pe} spell slots available!`,"error");return}const O=tl(Q);if(!O){Ot.add(`${Q.name} cast! Check spell description for effects.`,"info");return}let ke=O.hpBonus||0,Ge=O.description;Q.name==="Aid"&&pe>Q.level&&(ke=5+(pe-Q.level)*5,Ge=`+${ke} HP (max and current) for 8 hours`);const Se=["Shield of Faith","Bless","Aid","Magic Weapon"].includes(Q.name);le.update(A=>{A.activeStates||(A.activeStates=[]);const $=A.activeStates.find(oe=>oe.name===Q.name);return $&&$.hpBonus&&$.target!=="other"&&(A.maxHP-=$.hpBonus,A.currentHP=Math.max(1,Math.min(A.currentHP-$.hpBonus,A.maxHP))),A.activeStates=A.activeStates.filter(oe=>oe.name!==Q.name),ke>0&&C==="self"&&(A.maxHP+=ke,A.currentHP+=ke),A.activeStates=[...A.activeStates,{name:Q.name,attackBonus:O.attackBonus,damageBonus:O.damageBonus,acBonus:O.acBonus,description:Ge,target:C,hpBonus:ke}],A});const Oe=C==="self"?" on self":" on other";Ot.add(`${Q.name} cast${Se?Oe:""}! Effect added to Active Spell Effects.`,"success")}et(()=>(t(),e(ve),e(N)),()=>{if(t()&&t().attacks)for(const g of t().attacks)g.spellRef&&e(ve)[g.id]===void 0&&aa(ve,e(ve)[g.id]=!0),g.spellRef&&e(N)[g.id]===void 0&&aa(N,e(N)[g.id]="self")}),et(()=>(t(),p()),()=>{o(S,t().attacks.filter(g=>{if(!p())return!0;const C=p().toLowerCase();return g.name.toLowerCase().includes(C)||g.damageType.toLowerCase().includes(C)}).sort((g,C)=>!g.spellRef&&C.spellRef?-1:g.spellRef&&!C.spellRef?1:0))}),et(()=>(p(),e(S)),()=>{o(Z,!p()||e(S).length>0||"attack".includes(p().toLowerCase())||"spell".includes(p().toLowerCase()))}),Jt(),It();var R=Tl();let z;var Ne=r(R);{let g=ot(()=>(h(),i(()=>h().attacks?"Expand":"Collapse")));la(Ne,{title:"Attacks & Spells",get collapsed(){return h(),i(()=>h().attacks)},get ariaLabel(){return e(g)},onToggle:()=>Rt.update(C=>({...C,attacks:!C.attacks}))})}var Je=s(Ne,2);{var Pe=g=>{var C=Il(),Q=Ue(C);{var pe=W=>{var v=al();F("click",v,He),c(W,v)};y(Q,W=>{m()&&W(pe)})}var O=s(Q,2),ke=r(O);_t(ke,1,()=>e(S),W=>W.id,(W,v,Ie)=>{var ge=jl(),be=r(ge),B=r(be);{var De=j=>{var T=sl();Ce(T),Ee(T,()=>e(v).name,V=>(e(v).name=V,wt(()=>(e(S),t(),p())))),c(j,T)},Fe=j=>{var T=ll(),V=r(T,!0);l(T),P(()=>w(V,(e(v),i(()=>e(v).name||"(Unnamed Attack)")))),c(j,T)};y(B,j=>{m()?j(De):j(Fe,!1)})}var We=s(B,2);{var lt=j=>{var T=rl();F("click",T,()=>Ve(e(v).id)),c(j,T)};y(We,j=>{m()&&j(lt)})}l(be);var je=s(be,2),I=r(je);{var Y=j=>{var T=il(),V=r(T),Ae=s(V,2);Ce(Ae),l(T),P(()=>{Ke(V,"for",`attack-bonus-${e(v),i(()=>e(v).id)??""}`),Ke(Ae,"id",`attack-bonus-${e(v),i(()=>e(v).id)??""}`)}),Ee(Ae,()=>e(v).bonus,Re=>(e(v).bonus=Re,wt(()=>(e(S),t(),p())))),c(j,T)};y(I,j=>{e(v),i(()=>e(v).bonus!==0&&e(v).bonus!==void 0)&&j(Y)})}var xe=s(I,2);{var Te=j=>{var T=nl(),V=r(T),Ae=s(V,2);Ce(Ae),l(T),P(()=>{Ke(V,"for",`attack-damage-${e(v),i(()=>e(v).id)??""}`),Ke(Ae,"id",`attack-damage-${e(v),i(()=>e(v).id)??""}`)}),Ee(Ae,()=>e(v).damage,Re=>(e(v).damage=Re,wt(()=>(e(S),t(),p())))),c(j,T)};y(xe,j=>{e(v),i(()=>e(v).damage&&e(v).damage.trim()!=="")&&j(Te)})}var qe=s(xe,2),ee=r(qe),fe=s(ee,2);Ce(fe),l(qe),l(je);var Me=s(je,2);{var Qe=j=>{var T=nt(),V=Ue(T);{var Ae=rt=>{var J=ol();c(rt,J)},Re=rt=>{const J=ot(()=>(e(v),i(()=>se(e(v).spellRef))));var dt=nt(),Dt=Ue(dt);{var jt=H=>{const L=ot(()=>(E(_a),E(e(J)),i(()=>_a(e(J)))));var $e=kl(),ae=Ue($e),Ze=r(ae),Le=s(r(Ze),2),ut=r(Le,!0);l(Le),l(Ze);var ze=s(Ze,2);{var it=Ye=>{var ct=vl(),ht=r(ct),xt=s(r(ht));l(ht);var Ht=s(ht,2),Ut=s(r(Ht));l(Ht);var At=s(Ht,2),$t=s(r(At));l(At);var Ct=s(At,2),Nt=s(r(Ct)),vt=s(Nt);{var Gt=St=>{var Lt=Mt();P(()=>w(Lt,`(${E(e(J)),i(()=>e(J).material)??""})`)),c(St,Lt)};y(vt,St=>{E(e(J)),i(()=>e(J).material)&&St(Gt)})}l(Ct);var Vt=s(Ct,2),Qt=s(r(Vt),2);{var ea=St=>{var Lt=Mt("Concentration,");c(St,Lt)};y(Qt,St=>{E(e(J)),i(()=>e(J).concentration)&&St(ea)})}var Bt=s(Qt,1,!0);l(Vt);var Pt=s(Vt,2),Ft=s(r(Pt));l(Pt);var zt=s(Pt,2);{var Yt=St=>{var Lt=cl(),Kt=s(r(Lt));l(Lt),P(()=>w(Kt,` ${E(e(J)),i(()=>e(J).higherLevelSlot)??""}`)),c(St,Lt)};y(zt,St=>{E(e(J)),i(()=>e(J).higherLevelSlot)&&St(Yt)})}l(ct),P(St=>{w(xt,` ${E(e(J)),i(()=>e(J).level)??""}`),w(Ut,` ${E(e(J)),i(()=>e(J).castingTime||e(J).actionType)??""}`),w($t,` ${E(e(J)),i(()=>e(J).range)??""}`),w(Nt,` ${St??""}`),w(Bt,(E(e(J)),i(()=>e(J).duration))),w(Ft,` ${E(e(J)),i(()=>e(J).description)??""}`)},[()=>(E(e(J)),i(()=>e(J).components.join(", ")))]),c(Ye,ct)};y(ze,Ye=>{e(ve),e(v),i(()=>!e(ve)[e(v).id])&&Ye(it)})}l(ae);var tt=s(ae,2);{var pt=Ye=>{var ct=fl(),ht=r(ct),xt=r(ht);Ce(xt);var Ht=s(xt),Ut=s(Ht);{var At=vt=>{var Gt=dl(),Vt=r(Gt);l(Gt),P(Qt=>w(Vt,`(Spell Save DC: ${Qt??""})`),[()=>(E(Ra),t(),d(),i(()=>Ra(t(),d())))]),c(vt,Gt)};y(Ut,vt=>{t(),i(()=>t().class)&&vt(At)})}var $t=s(Ut,2);{var Ct=vt=>{var Gt=ul();c(vt,Gt)},Nt=vt=>{var Gt=nt(),Vt=Ue(Gt);{var Qt=ea=>{var Bt=pl();c(ea,Bt)};y(Vt,ea=>{e(v),E(e(L)),i(()=>e(v).targetSucceededSave&&e(L).noDamageOnSave)&&ea(Qt)},!0)}c(vt,Gt)};y($t,vt=>{e(v),E(e(L)),i(()=>e(v).targetSucceededSave&&e(L).halfDamageOnSave)?vt(Ct):vt(Nt,!1)})}l(ht),l(ct),P(vt=>w(Ht,` Target succeeded on ${vt??""} save `),[()=>(E(e(L)),i(()=>e(L).ability.charAt(0).toUpperCase()+e(L).ability.slice(1)))]),Fa(xt,()=>e(v).targetSucceededSave,vt=>(e(v).targetSucceededSave=vt,wt(()=>(e(S),t(),p())))),c(Ye,ct)};y(tt,Ye=>{e(L)&&Ye(pt)})}var ft=s(tt,2);{var gt=Ye=>{const ct=ot(()=>(E(e(J)),i(()=>we(e(J)))));var ht=nt(),xt=Ue(ht);{var Ht=At=>{var $t=_l(),Ct=Ue($t),Nt=r(Ct),vt=s(Nt,2);P(()=>{e(v),wt(()=>{e(ct)})}),_t(vt,5,()=>e(ct),kt,(Bt,Pt)=>{var Ft=gl(),zt=r(Ft);l(Ft);var Yt={};P(()=>{w(zt,`Level ${e(Pt)??""}`),Yt!==(Yt=e(Pt))&&(Ft.value=(Ft.__value=e(Pt))??"")}),c(Bt,Ft)}),l(vt);var Gt=s(vt,2);{var Vt=Bt=>{const Pt=ot(()=>(e(v),E(e(J)),i(()=>de(e(v),e(J)))));var Ft=hl(),zt=r(Ft);{var Yt=Kt=>{var ta=Mt("Healing");c(Kt,ta)},St=Kt=>{var ta=Mt("Damage");c(Kt,ta)};y(zt,Kt=>{E(e(J)),i(()=>_e(e(J)))?Kt(Yt):Kt(St,!1)})}var Lt=s(zt);l(Ft),P(()=>w(Lt,` ${e(Pt)??""}`)),c(Bt,Ft)};y(Gt,Bt=>{e(v),E(e(J)),i(()=>e(v).castAtLevel&&e(v).castAtLevel>e(J).level)&&Bt(Vt)})}l(Ct);var Qt=s(Ct,2);{var ea=Bt=>{var Pt=ml(),Ft=r(Pt),zt=r(Ft);Ce(zt);var Yt=s(zt,2);{var St=Lt=>{const Kt=ot(()=>(e(v),E(e(J)),i(()=>de(e(v),e(J)))));var ta=bl(),ls=r(ta);l(ta),P(()=>w(ls,`(+1d8, total: ${e(Kt)??""})`)),c(Lt,ta)};y(Yt,Lt=>{e(v),i(()=>e(v).targetIsFiendOrUndead)&&Lt(St)})}l(Ft),l(Pt),Fa(zt,()=>e(v).targetIsFiendOrUndead,Lt=>(e(v).targetIsFiendOrUndead=Lt,wt(()=>(e(S),t(),p())))),c(Bt,Pt)};y(Qt,Bt=>{E(e(J)),i(()=>e(J).description.includes("Fiend or an Undead"))&&Bt(ea)})}P(()=>{Ke(Nt,"for",`castLevel-${e(v),i(()=>e(v).id)??""}`),Ke(vt,"id",`castLevel-${e(v),i(()=>e(v).id)??""}`)}),Aa(vt,()=>e(v).castAtLevel,Bt=>(e(v).castAtLevel=Bt,wt(()=>(e(S),t(),p())))),c(At,$t)},Ut=At=>{var $t=yl();c(At,$t)};y(xt,At=>{E(e(ct)),i(()=>e(ct).length>0)?At(Ht):At(Ut,!1)})}c(Ye,ht)};y(ft,Ye=>{E(e(J)),i(()=>e(J).higherLevelSlot&&e(J).level>0)&&Ye(gt)})}P(()=>{Ke(Le,"aria-label",(e(ve),e(v),i(()=>e(ve)[e(v).id]?"Expand":"Collapse"))),w(ut,(e(ve),e(v),i(()=>e(ve)[e(v).id]?"â–¼":"â–²")))}),F("click",Ze,()=>ie(e(v).id)),F("keydown",Ze,Ye=>Ye.key==="Enter"&&ie(e(v).id)),c(H,$e)},u=H=>{var L=Sl();c(H,L)};y(Dt,H=>{e(J)?H(jt):H(u,!1)})}c(rt,dt)};y(V,rt=>{e(ye),i(()=>e(ye).length===0)?rt(Ae):rt(Re,!1)})}c(j,T)};y(Me,j=>{e(v),i(()=>e(v).spellRef)&&j(Qe)})}var Be=s(Me,2);{var _=j=>{var T=xl(),V=r(T),Ae=s(V,2);da(Ae),l(T),P(()=>{Ke(V,"for",`attack-notes-${e(v),i(()=>e(v).id)??""}`),Ke(Ae,"id",`attack-notes-${e(v),i(()=>e(v).id)??""}`)}),Ee(Ae,()=>e(v).notes,Re=>(e(v).notes=Re,wt(()=>(e(S),t(),p())))),c(j,T)};y(Be,j=>{e(v),i(()=>!e(v).spellRef)&&j(_)})}var G=s(Be,2),he=r(G);{var te=j=>{const T=ot(()=>(e(v),i(()=>se(e(v).spellRef))));var V=nt(),Ae=Ue(V);{var Re=rt=>{var J=nt(),dt=Ue(J);{var Dt=u=>{var H=$l();F("click",H,()=>q(e(v))),c(u,H)},jt=u=>{var H=nt(),L=Ue(H);{var $e=Ze=>{var Le=nt(),ut=Ue(Le);{var ze=tt=>{var pt=Cl(),ft=r(pt),gt=r(ft),Ye=r(gt);Ce(Ye),Ye.value=Ye.__value="self",ra(),l(gt);var ct=s(gt,2),ht=r(ct);Ce(ht),ht.value=ht.__value="other",ra(),l(ct),l(ft);var xt=s(ft,2),Ht=r(xt);l(xt),l(pt),P(()=>{Ke(Ye,"name",`target-${e(v),i(()=>e(v).id)??""}`),Ke(ht,"name",`target-${e(v),i(()=>e(v).id)??""}`),w(Ht,`Cast ${E(e(T)),i(()=>e(T).name)??""}`)}),Ua(K,[Ie],Ye,()=>e(N)[e(v).id],Ut=>aa(N,e(N)[e(v).id]=Ut)),Ua(K,[Ie],ht,()=>e(N)[e(v).id],Ut=>aa(N,e(N)[e(v).id]=Ut)),F("click",xt,()=>b(e(v),e(N)[e(v).id])),c(tt,pt)},it=tt=>{var pt=Ll();F("click",pt,()=>b(e(v),"self")),c(tt,pt)};y(ut,tt=>{E(e(T)),i(()=>X(e(T).name))?tt(ze):tt(it,!1)})}c(Ze,Le)},ae=Ze=>{var Le=wl(),ut=r(Le);{var ze=tt=>{var pt=Mt("Roll Healing");c(tt,pt)},it=tt=>{var pt=Mt("Roll Damage");c(tt,pt)};y(ut,tt=>{E(e(T)),i(()=>_e(e(T)))?tt(ze):tt(it,!1)})}l(Le),P(tt=>mt(Le,1,`btn ${tt??""}`),[()=>(E(e(T)),i(()=>_e(e(T))?"btn-success":"btn-secondary"))]),F("click",Le,()=>Xe(e(v))),c(Ze,Le)};y(L,Ze=>{E(Ka),E(e(T)),i(()=>Ka(e(T)))?Ze($e):Ze(ae,!1)},!0)}c(u,H)};y(dt,u=>{E(wa),E(e(T)),i(()=>wa(e(T)))?u(Dt):u(jt,!1)})}c(rt,J)};y(Ae,rt=>{e(T)&&rt(Re)})}c(j,V)},me=j=>{var T=nt(),V=Ue(T);{var Ae=Re=>{var rt=Dl(),J=Ue(rt),dt=s(J,2);F("click",J,()=>q(e(v))),F("click",dt,()=>Xe(e(v))),c(Re,rt)};y(V,Re=>{e(v),i(()=>!e(v).spellRef)&&Re(Ae)},!0)}c(j,T)};y(he,j=>{e(v),e(U),i(()=>e(v).spellRef&&e(U))?j(te):j(me,!1)})}l(G),l(ge),P(()=>{Ke(ee,"for",`attack-type-${e(v),i(()=>e(v).id)??""}`),Ke(fe,"id",`attack-type-${e(v),i(()=>e(v).id)??""}`)}),Ee(fe,()=>e(v).damageType,j=>(e(v).damageType=j,wt(()=>(e(S),t(),p())))),c(W,ge)});var Ge=s(ke,2);{var st=W=>{var v=Bl();c(W,v)},Se=W=>{var v=nt(),Ie=Ue(v);{var ge=be=>{var B=Al();c(be,B)};y(Ie,be=>{e(S),i(()=>e(S).length===0)&&be(ge)},!0)}c(W,v)};y(Ge,W=>{t(),i(()=>t().attacks.length===0)?W(st):W(Se,!1)})}l(O);var Oe=s(O,2),A=s(r(Oe),4),$=s(A,2);{var oe=W=>{var v=Rl();_t(v,5,()=>(t(),i(()=>t().activeStates)),kt,(Ie,ge,be)=>{var B=Ml(),De=r(B),Fe=r(De);Ce(Fe);var We=s(Fe,2);{var lt=me=>{var j=Fl();F("click",j,()=>ue(be)),c(me,j)};y(We,me=>{m()&&me(lt)})}l(De);var je=s(De,2),I=r(je),Y=r(I);Ke(Y,"for",`state-attack-bonus-${be}`);var xe=s(Y,2);Ce(xe),Ke(xe,"id",`state-attack-bonus-${be}`),l(I);var Te=s(I,2),qe=r(Te);Ke(qe,"for",`state-damage-bonus-${be}`);var ee=s(qe,2);Ce(ee),Ke(ee,"id",`state-damage-bonus-${be}`),l(Te);var fe=s(Te,2),Me=r(fe);Ke(Me,"for",`state-target-${be}`);var Qe=s(Me,2);P(()=>{e(ge),wt(()=>{})}),Ke(Qe,"id",`state-target-${be}`);var Be=r(Qe);Be.value=Be.__value="self";var _=s(Be);_.value=_.__value="other",l(Qe),l(fe),l(je);var G=s(je,2),he=r(G);Ke(he,"for",`state-desc-${be}`);var te=s(he,2);Ce(te),Ke(te,"id",`state-desc-${be}`),l(G),l(B),Ee(Fe,()=>e(ge).name,me=>(e(ge).name=me,wt(()=>t()),ca(D,"$character"))),Ee(xe,()=>e(ge).attackBonus,me=>(e(ge).attackBonus=me,wt(()=>t()),ca(D,"$character"))),Ee(ee,()=>e(ge).damageBonus,me=>(e(ge).damageBonus=me,wt(()=>t()),ca(D,"$character"))),Aa(Qe,()=>e(ge).target,me=>(e(ge).target=me,wt(()=>t()),ca(D,"$character"))),Ee(te,()=>e(ge).description,me=>(e(ge).description=me,wt(()=>t()),ca(D,"$character"))),c(Ie,B)}),l(v),c(W,v)},ce=W=>{var v=Pl();c(W,v)};y($,W=>{t(),i(()=>t().activeStates&&t().activeStates.length>0)?W(oe):W(ce,!1)})}l(Oe),F("click",A,x),c(g,C)};y(Je,g=>{h(),i(()=>!h().attacks)&&g(Pe)})}l(R),P(()=>z=mt(R,1,"attacks svelte-14o91c5",null,z,{hidden:!e(Z)})),c(a,R),Et(),k()}var Hl=f('<span class="slot-checkbox-x svelte-serp1j">&#8212;</span>'),Ul=f('<label><input type="checkbox" class="slot-checkbox-input svelte-serp1j"/> <span><!></span></label>');function Va(a,n){Tt(n,!1);const t=()=>at(ia,"$isEditMode",d),[d,p]=Wt();let h=yt(n,"checked",8,!1),m=yt(n,"disabled",8,!1),D=yt(n,"className",8,""),k=yt(n,"index",8,void 0),S=yt(n,"ariaLabel",8,void 0);const Z=sa();function K(X){Z("change",{checked:X.currentTarget.checked,index:k()})}It();var re=Ul(),ve=r(re);Ce(ve);var N=s(ve,2),ie=r(N);{var _e=X=>{var He=Hl();c(X,He)};y(ie,X=>{h()&&X(_e)})}l(N),l(re),P(()=>{mt(re,1,"slot-checkbox-label "+D()+(t()?"":" not-editable"),"svelte-serp1j"),ts(ve,h()),ve.disabled=m()||!t(),Ke(ve,"aria-label",S()),Ke(ve,"tabindex",t()?0:-1),mt(N,1,`slot-checkbox-custom ${h()?"used":""} ${t()?"":"readonly"}`,"svelte-serp1j")}),F("change",ve,K),c(a,re),Et(),p()}var Nl=f('<p class="no-features svelte-1kpvv0n">Select a class to see available features</p>'),Gl=f('<p class="no-features svelte-1kpvv0n">No class features available at this level</p>'),Ol=f('<div class="spell-slots svelte-1kpvv0n"><label class="svelte-1kpvv0n"> </label> <div class="slots-tracker svelte-1kpvv0n"></div></div>'),ql=f('<div class="all-spell-slots"></div>'),Wl=f('<div class="feature-box spellcasting svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"> </h3> <div class="spell-stats svelte-1kpvv0n"><div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Spell Save DC</label> <div class="spell-value svelte-1kpvv0n"> </div></div> <div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <div class="spell-value svelte-1kpvv0n"> </div></div></div> <!> <div class="prepared-spells svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <textarea placeholder="List your prepared spells..." class="svelte-1kpvv0n"></textarea></div></div>'),zl=f('<p class="unlimited svelte-1kpvv0n">Unlimited Uses</p>'),Kl=f('<div class="slots-tracker svelte-1kpvv0n"></div> <div class="uses-actions-row"><button class="btn btn-primary use-enabled"> </button></div> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div>',1),Vl=f('<div class="uses-tracker svelte-1kpvv0n"><!></div>'),Jl=f('<div class="pool-tracker svelte-1kpvv0n"><input type="number" min="0" class="pool-input svelte-1kpvv0n"/> <span> </span> <button class="btn-small svelte-1kpvv0n"> </button></div>'),Ql=f('<p class="no-uses svelte-1kpvv0n">No Channel Divinity uses remaining</p>'),Yl=f('<div class="channel-divinity-option svelte-1kpvv0n"><button class="btn btn-primary use-enabled svelte-1kpvv0n">Use Channel Divinity</button> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div> <!></div>'),Xl=f('<div class="feature-box svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"><!> </h3> <p class="feature-description svelte-1kpvv0n"> </p> <!></div>'),Zl=f('<div class="features-grid svelte-1kpvv0n"><!> <!></div>'),er=f("<section><!> <!></section>");function tr(a,n){Tt(n,!1);const t=()=>at(le,"$character",m),d=()=>at(ga,"$abilityModifiers",m),p=()=>at(Zt,"$searchFilter",m),h=()=>at(Rt,"$collapsedStates",m),[m,D]=Wt(),k=M(),S=M(),Z=M(),K=M(),re=M(),ve=M(),N=M();let ie=M(0),_e=M(0);function X(b,R){le.update(z=>(z.classFeatures.features[b]=R,z))}function He(){le.update(b=>(b.classFeatures.spellSlotsByLevel||(b.classFeatures.spellSlotsByLevel={}),e(K).forEach(({level:R,slots:z})=>{b.classFeatures.spellSlotsByLevel[R]||(b.classFeatures.spellSlotsByLevel[R]=Array(z).fill(!1))}),b))}function Ve(b){if(typeof b.maxUses=="function"){if((b.name==="Divine Sense"||b.name==="War Priest")&&e(k)?.spellcastingAbility){const R=d()[e(k).spellcastingAbility];return b.maxUses(t().level,R)}return b.maxUses(t().level)}return b.maxUses||0}function q(b,R){le.update(z=>((!z.classFeatures.features[b]||!Array.isArray(z.classFeatures.features[b])||z.classFeatures.features[b].length!==R)&&(z.classFeatures.features[b]=Array(R).fill(!1)),z))}rs(()=>{e(ve)&&t()&&t().classFeatures&&t().classFeatures.features&&e(ve).forEach(b=>{if(b.type==="uses"){const R=b.name.replace(/\s+/g,""),z=Ve(b),Ne=t().classFeatures.features[R];(!Array.isArray(Ne)||Ne.length!==z)&&q(R,z)}})});function Xe(b){return typeof b.maxPool=="function"?b.maxPool(t().level):b.maxPool||0}function ye(b){return typeof b.description=="function"?b.description(t().level):b.description}function U(){const b="ChannelDivinity";le.update(R=>{const z=R.classFeatures.features[b];return typeof z=="number"&&z>0&&(R.classFeatures.features[b]=z-1),R})}function se(){Rt.update(b=>({...b,classFeatures:!b.classFeatures}))}et(()=>(t(),qt),()=>{o(k,t().class?qt(t().class):null)}),et(()=>(t(),oa),()=>{o(S,t().class?oa(t().class,t().level,t().subclass):[])}),et(()=>(t(),Oa),()=>{o(Z,t().class?Oa(t().class,t().level):0)}),et(()=>(e(k),t()),()=>{o(K,(()=>{if(!e(k)?.spellcaster)return[];const b=t().level,R=[];return b>=1&&R.push({level:1,slots:Math.min(4,2+Math.floor(b/3))}),b>=3&&R.push({level:2,slots:Math.min(3,2+Math.floor((b-3)/4))}),b>=5&&R.push({level:3,slots:Math.min(3,2+Math.floor((b-5)/5))}),b>=7&&R.push({level:4,slots:Math.min(3,1+Math.floor((b-7)/6))}),b>=9&&R.push({level:5,slots:Math.min(2,1+Math.floor((b-9)/8))}),b>=11&&R.push({level:6,slots:1}),b>=13&&R.push({level:7,slots:1}),b>=15&&R.push({level:8,slots:1}),b>=17&&R.push({level:9,slots:1}),R})())}),et(()=>(e(k),d(),t(),qa),()=>{if(e(k)?.spellcaster&&e(k).spellcastingAbility){const b=d()[e(k).spellcastingAbility];o(ie,ws(t().class,b,t().proficiencyBonus)||0),o(_e,qa(t().class,t().level,b))}}),et(()=>(t(),e(k),e(K)),()=>{t().class&&e(k)?.spellcaster&&e(K).length>0&&He()}),et(()=>t(),()=>{o(re,(()=>{const R=t().classFeatures.features["ChannelDivinity"];return typeof R=="number"?R:0})())}),et(()=>(e(S),p()),()=>{o(ve,e(S).filter(b=>{if(!p())return!0;const R=p().toLowerCase();return b.name.toLowerCase().includes(R)||ye(b).toLowerCase().includes(R)}))}),et(()=>(p(),t(),e(ve)),()=>{o(N,!p()||t().class||"class features".includes(p().toLowerCase())||"spellcasting".includes(p().toLowerCase())||e(ve).length>0)}),Jt(),It();var ne=er();let de;var we=r(ne);{let b=ot(()=>(h(),i(()=>h().classFeatures?"Expand":"Collapse")));la(we,{title:"Class Features",get collapsed(){return h(),i(()=>h().classFeatures)},get ariaLabel(){return e(b)},onToggle:se})}var x=s(we,2);{var ue=b=>{var R=nt(),z=Ue(R);{var Ne=Pe=>{var g=Nl();c(Pe,g)},Je=Pe=>{var g=nt(),C=Ue(g);{var Q=O=>{var ke=Gl();c(O,ke)},pe=O=>{var ke=Zl(),Ge=r(ke);{var st=Oe=>{var A=Wl(),$=r(A),oe=r($);l($);var ce=s($,2),W=r(ce),v=s(r(W),2),Ie=r(v,!0);l(v),l(W);var ge=s(W,2),be=s(r(ge),2),B=r(be,!0);l(be),l(ge),l(ce);var De=s(ce,2);{var Fe=je=>{var I=ql();_t(I,5,()=>e(K),kt,(Y,xe)=>{let Te=()=>e(xe).level,qe=()=>e(xe).slots;const ee=ot(()=>(t(),Te(),qe(),i(()=>t().classFeatures.spellSlotsByLevel?.[Te()]||Array(qe()).fill(!1))));var fe=Ol(),Me=r(fe),Qe=r(Me);l(Me);var Be=s(Me,2);_t(Be,5,()=>e(ee),kt,(_,G,he)=>{{let te=ot(()=>(E(e(ee)),i(()=>e(ee)[he]||!1)));Va(_,{get checked(){return e(te)},$$events:{change:me=>{le.update(j=>(j.classFeatures.spellSlotsByLevel||(j.classFeatures.spellSlotsByLevel={}),j.classFeatures.spellSlotsByLevel[Te()]||(j.classFeatures.spellSlotsByLevel[Te()]=Array(qe()).fill(!1)),j.classFeatures.spellSlotsByLevel[Te()][he]=me.detail.checked,j))}}})}}),l(Be),l(fe),P(()=>w(Qe,`${Te()===1?"1st":Te()===2?"2nd":Te()===3?"3rd":`${Te()}th`} Level Spell Slots`)),c(Y,fe)}),l(I),c(je,I)};y(De,je=>{e(K),i(()=>e(K).length>0)&&je(Fe)})}var We=s(De,2),lt=s(r(We),2);da(lt),l(We),l(A),P(je=>{w(oe,`Spellcasting (${je??""})`),w(Ie,e(ie)),w(B,e(_e))},[()=>(e(k),i(()=>e(k).spellcastingAbility?.toUpperCase()))]),Ee(lt,()=>t().classFeatures.preparedSpells,je=>bt(le,i(t).classFeatures.preparedSpells=je,i(t))),c(Oe,A)};y(Ge,Oe=>{e(k),i(()=>e(k)?.spellcaster)&&Oe(st)})}var Se=s(Ge,2);_t(Se,1,()=>e(ve),kt,(Oe,A)=>{const $=ot(()=>(e(A),i(()=>e(A).name.replace(/\s+/g,"")))),oe=ot(()=>(t(),E(e($)),i(()=>t().classFeatures.features[e($)]))),ce=ot(()=>typeof e(oe)=="number");var W=Xl(),v=r(W),Ie=r(v);{var ge=je=>{var I=Mt("Channel Divinity:");c(je,I)};y(Ie,je=>{e(A),i(()=>e(A).type==="channelDivinity")&&je(ge)})}var be=s(Ie);l(v);var B=s(v,2),De=r(B,!0);l(B);var Fe=s(B,2);{var We=je=>{const I=ot(()=>(e(A),i(()=>Ve(e(A))))),Y=ot(()=>(E(e(oe)),E(e(I)),i(()=>Array.isArray(e(oe))?e(oe):Array(e(I)).fill(!1))));var xe=Vl(),Te=r(xe);{var qe=fe=>{var Me=zl();c(fe,Me)},ee=fe=>{var Me=Kl(),Qe=Ue(Me);_t(Qe,5,()=>e(Y),kt,(j,T,V)=>{Va(j,{get checked(){return e(T)},index:V,$$events:{change:Ae=>{le.update(Re=>(Re.classFeatures.features[e($)]||(Re.classFeatures.features[e($)]=Array(e(I)).fill(!1)),Re.classFeatures.features[e($)][V]=Ae.detail.checked,Re))}}})}),l(Qe);var Be=s(Qe,2),_=r(Be),G=r(_);l(_),l(Be);var he=s(Be,2),te=r(he),me=r(te);l(te),l(he),P(j=>{_.disabled=j,w(G,`Use ${e(A),i(()=>e(A).name)??""}`),w(me,`Resets on ${e(A),i(()=>e(A).resetOn==="short"?"Short Rest":"Long Rest")??""}`)},[()=>(E(e(Y)),i(()=>e(Y).filter(j=>!j).length<=0))]),F("click",_,()=>{le.update(j=>{j.classFeatures.features[e($)]||(j.classFeatures.features[e($)]=Array(e(I)).fill(!1));const T=j.classFeatures.features[e($)],V=T.findIndex(Ae=>!Ae);return V!==-1&&(T[V]=!0),j})}),c(fe,Me)};y(Te,fe=>{e(I)===1/0?fe(qe):fe(ee,!1)})}l(xe),c(je,xe)},lt=je=>{var I=nt(),Y=Ue(I);{var xe=qe=>{const ee=ot(()=>(e(A),i(()=>Xe(e(A)))));var fe=Jl(),Me=r(fe);Ce(Me);var Qe=s(Me,2),Be=r(Qe);l(Qe);var _=s(Qe,2),G=r(_,!0);l(_),l(fe),P(()=>{ka(Me,e(ce)&&e(oe)!==void 0?e(oe):e(ee)),Ke(Me,"max",e(ee)),w(Be,`/ ${e(ee)??""}`),w(G,(e(A),i(()=>e(A).resetOn==="short"?"Short Rest":"Long Rest")))}),F("input",Me,he=>{le.update(te=>(te.classFeatures.features[e($)]=parseInt(he.currentTarget.value)||0,te))}),F("click",_,()=>X(e($),e(ee))),c(qe,fe)},Te=qe=>{var ee=nt(),fe=Ue(ee);{var Me=Qe=>{var Be=Yl(),_=r(Be),G=s(_,2),he=r(G),te=r(he);l(he),l(G);var me=s(G,2);{var j=T=>{var V=Ql();c(T,V)};y(me,T=>{e(re)<=0&&T(j)})}l(Be),P(()=>{_.disabled=e(re)<=0,w(te,`Resets on ${e(A),i(()=>e(A).resetOn==="short"?"Short Rest":"Long Rest")??""}`)}),F("click",_,U),c(Qe,Be)};y(fe,Qe=>{e(A),i(()=>e(A).type==="channelDivinity")&&Qe(Me)},!0)}c(qe,ee)};y(Y,qe=>{e(A),i(()=>e(A).type==="pool")?qe(xe):qe(Te,!1)},!0)}c(je,I)};y(Fe,je=>{e(A),i(()=>e(A).type==="uses")?je(We):je(lt,!1)})}l(W),P(je=>{w(be,` ${e(A),i(()=>e(A).name)??""}`),w(De,je)},[()=>(e(A),i(()=>ye(e(A))))]),c(Oe,W)}),l(ke),c(O,ke)};y(C,O=>{e(S),i(()=>e(S).length===0)?O(Q):O(pe,!1)},!0)}c(Pe,g)};y(z,Pe=>{t(),i(()=>!t().class)?Pe(Ne):Pe(Je,!1)})}c(b,R)};y(x,b=>{h(),i(()=>!h().classFeatures)&&b(ue)})}l(ne),P(()=>de=mt(ne,1,"class-features svelte-1kpvv0n",null,de,{hidden:!e(N)})),c(a,ne),Et(),D()}var ar=f('<textarea placeholder="Enter features, traits, and special abilities..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Equipment</h3> <textarea placeholder="List your equipment and inventory..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Notes</h3> <textarea placeholder="Additional notes..." class="svelte-wttn0l"></textarea>',1),sr=f("<section><!> <!></section>");function lr(a,n){Tt(n,!1);const t=()=>at(Zt,"$searchFilter",h),d=()=>at(le,"$character",h),p=()=>at(Rt,"$collapsedStates",h),[h,m]=Wt(),D=M();function k(){Rt.update(N=>({...N,notes:!N.notes}))}et(()=>(t(),d()),()=>{o(D,!t()||"features".includes(t().toLowerCase())||"traits".includes(t().toLowerCase())||"equipment".includes(t().toLowerCase())||"notes".includes(t().toLowerCase())||d().features.toLowerCase().includes(t().toLowerCase())||d().equipment.toLowerCase().includes(t().toLowerCase())||d().notes.toLowerCase().includes(t().toLowerCase()))}),Jt(),It();var S=sr();let Z;var K=r(S);{let N=ot(()=>(p(),i(()=>p().notes?"Expand":"Collapse")));la(K,{title:"Features & Traits",get collapsed(){return p(),i(()=>p().notes)},get ariaLabel(){return e(N)},onToggle:k})}var re=s(K,2);{var ve=N=>{var ie=ar(),_e=Ue(ie);da(_e);var X=s(_e,4);da(X);var He=s(X,4);da(He),Ee(_e,()=>d().features,Ve=>bt(le,i(d).features=Ve,i(d))),Ee(X,()=>d().equipment,Ve=>bt(le,i(d).equipment=Ve,i(d))),Ee(He,()=>d().notes,Ve=>bt(le,i(d).notes=Ve,i(d))),c(N,ie)};y(re,N=>{p(),i(()=>!p().notes)&&N(ve)})}l(S),P(()=>Z=mt(S,1,"notes svelte-wttn0l",null,Z,{hidden:!e(D)})),c(a,S),Et(),m()}var rr=f('<div class="color-picker-section svelte-1r90jgp"><h3 class="svelte-1r90jgp">Dice Colors</h3> <div class="color-inputs svelte-1r90jgp"><div class="color-input-group svelte-1r90jgp"><label for="dice-color" class="svelte-1r90jgp">Dice Color</label> <input type="color" id="dice-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="label-color" class="svelte-1r90jgp">Label Color</label> <input type="color" id="label-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="desk-color" class="svelte-1r90jgp">Background Color</label> <input type="color" id="desk-color" class="svelte-1r90jgp"/></div></div></div>'),ir=f('<div class="loading svelte-1r90jgp"><p class="svelte-1r90jgp">Loading 3D dice...</p></div>'),nr=f('<div class="custom-dice-selector svelte-1r90jgp"><h3 class="svelte-1r90jgp">Choose Dice to Roll</h3> <div class="dice-inputs svelte-1r90jgp"><div class="dice-input-group svelte-1r90jgp"><label for="d4" class="svelte-1r90jgp">d4</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d4" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d6" class="svelte-1r90jgp">d6</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d6" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d8" class="svelte-1r90jgp">d8</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d8" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d10" class="svelte-1r90jgp">d10</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d10" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d12" class="svelte-1r90jgp">d12</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d12" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d20" class="svelte-1r90jgp">d20</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d20" min="0" max="10"/></div></div> <div class="dice-controls svelte-1r90jgp"><button class="btn btn-primary use-enabled svelte-1r90jgp"> </button> <button class="btn btn-secondary use-enabled svelte-1r90jgp">Reset</button></div></div>'),or=f('<span class="crit-badge svelte-1r90jgp">CRITICAL HIT!</span>'),cr=f('<span class="crit-badge crit-fail svelte-1r90jgp">CRITICAL MISS!</span>'),vr=f('<div class="bonus-item svelte-1r90jgp"><span class="bonus-value svelte-1r90jgp"> </span> <span class="bonus-source svelte-1r90jgp"> </span></div>'),dr=f('<div class="bonus-breakdown svelte-1r90jgp"></div>'),ur=f('<p class="modifier-text svelte-1r90jgp"> </p>'),pr=f('<div class="svelte-1r90jgp"><em class="svelte-1r90jgp">No damage is dealt on a critical miss.</em></div>'),fr=f('<button class="btn btn-follow-up svelte-1r90jgp"> </button>'),gr=f('<button class="btn btn-guided-strike svelte-1r90jgp">âš¡ Use Guided Strike (+10)</button>'),hr=f('<div class="follow-up-actions svelte-1r90jgp"><!> <!></div>'),br=f('<div class="result-header svelte-1r90jgp"><h3 class="svelte-1r90jgp"> </h3> <!> <!></div> <div class="result-total svelte-1r90jgp"> </div> <div class="result-details svelte-1r90jgp"><!></div> <!> <!>',1),mr=f('<div role="button" tabindex="-1"><div class="modal-content svelte-1r90jgp" role="dialog" tabindex="0"><div class="modal-header svelte-1r90jgp"><h2 class="svelte-1r90jgp">Dice Roller</h2> <div class="header-buttons svelte-1r90jgp"><button class="color-btn svelte-1r90jgp" title="Customize dice colors">ðŸŽ¨</button> <button class="close-btn svelte-1r90jgp">Ã—</button></div></div> <!> <!> <div class="dice-main-area svelte-1r90jgp"><div class="dice-container svelte-1r90jgp"></div> <!></div> <div><!></div></div></div>');function _r(a,n){Tt(n,!1);const t=()=>at(le,"$character",d),[d,p]=Wt(),h=M(),m=M(),D=M(),k=sa();let S=yt(n,"notation",12,""),Z=yt(n,"visible",8,!1),K=yt(n,"damageNotation",12,""),re=yt(n,"attackName",12,""),ve=yt(n,"applyHalfDamage",8,!1),N=yt(n,"bonusBreakdown",28,()=>[]),ie=yt(n,"rollType",12,"other"),_e=null,X=M(void 0),He=M(!1),Ve=M(""),q=M(null);function Xe(){return e(q)?.resultTotal??null}function ye(_,G,he){const te=[];if(!_||!_.result)return te;const me=G.match(/([+-]?\d*d\d+|[+-]?\d+)/g)||[];let j=0;const T=new Set;for(const V of me){const Ae=V.trim();if(!Ae)continue;const Re=Ae.match(/([+-]?)(\d*)d(\d+)/);if(Re){const rt=parseInt(Re[2]||"1"),J=`${rt}d${Re[3]}`,dt=he.findIndex((u,H)=>!T.has(H)&&typeof u.value=="string"&&u.value===J),Dt=[];for(let u=0;u<rt&&j<_.result.length;u++)Dt.push(_.result[j++]);const jt=dt>=0?he[dt].source:"base die";dt>=0&&T.add(dt);for(const u of Dt)te.push({display:`${u}`,source:jt})}}for(let V=0;V<he.length;V++)if(!T.has(V)&&typeof he[V].value=="number"){const Ae=he[V].value;te.push({display:Ae>=0?`+${Ae}`:`${Ae}`,source:he[V].source})}return te}let U=M(0),se=M(0),ne=M(0),de=M(0),we=M(0),x=M(0),ue=M(0),b=M([]),R=M(!1),z=M(!1),Ne=M(!1),Je=M("#051e0a"),Pe=M("#ffffff"),g=M("#3a2004"),C=M(!1);function Q(_){return _.length===9&&_.startsWith("#")?_.substring(0,7):_}function pe(_,G="ff"){return _.length===7&&_.startsWith("#")?_+G:_}function O(){if(window.DICE&&e(X))try{_e&&e(X)&&aa(X,e(X).innerHTML="");const _=e(X).clientWidth||500,G=e(X).clientHeight||300;_e=new window.DICE.dice_box(e(X),{w:_,h:G}),o(He,!0)}catch(_){console.error("Error initializing dice box:",_)}}pa(()=>{const _=te=>new Promise((me,j)=>{if(document.querySelector(`script[src="${te}"]`)){me(null);return}const V=document.createElement("script");V.src=te,V.onload=()=>{me(null)},V.onerror=()=>{console.error(`Failed to load: ${te}`),j(new Error(`Failed to load ${te}`))},document.head.appendChild(V)});setTimeout(()=>{_(`${va}/libs/three.min.js`).then(()=>_(`${va}/libs/cannon.min.js`)).then(()=>_(`${va}/libs/teal.js`)).then(()=>_(`${va}/dice.js`)).then(()=>{if(window.DICE){const te=window.DICE.getColors();o(Je,Q(te.dice_color)),o(Pe,Q(te.label_color)),o(g,Q(te.desk_color))}O()}).catch(te=>{console.error("Failed to load dice libraries:",te)})},100);const G=()=>{e(He)&&O()},he=te=>{Z()&&te.key==="Escape"&&ce()};return window.addEventListener("resize",G),window.addEventListener("keydown",he),()=>{window.removeEventListener("resize",G),window.removeEventListener("keydown",he)}});function ke(_,G="other"){if(!_e||!e(He))return;o(q,null),o(b,[]),o(R,!1),o(z,!1),G==="damage"&&N([]),ie(G),o(Ne,!1),_e.diceToRoll=_;const he=me=>null,te=me=>{let j=me.resultTotal,T=me.resultString;if(ve()&&(j=Math.floor(j/2),T=T+" (halved)"),o(q,{...me,resultTotal:j,resultString:T}),console.log("Final roll result:",e(q)),console.log({type:G}),G==="attack"&&me.result&&me.result.length>0){const V=me.result[0];o(R,V===20),o(z,V===1)}if(o(b,[]),console.log("Setting up follow-up actions. Type:",G,"damageNotation:",K(),"isCriticalSuccess:",e(R),"isCriticalFail:",e(z)),G==="attack"&&K())if(e(R)){const V=Se(K());e(b).push({label:`Roll Critical Damage (${V})`,notation:V})}else e(z)||e(b).push({label:`Roll Damage (${K()})`,notation:K()})};_e.start_throw(he,te)}function Ge(){const _=[];e(U)>0&&_.push(`${e(U)}d4`),e(se)>0&&_.push(`${e(se)}d6`),e(ne)>0&&_.push(`${e(ne)}d8`),e(de)>0&&_.push(`${e(de)}d10`),e(we)>0&&_.push(`${e(we)}d12`),e(x)>0&&_.push(`${e(x)}d20`);let G=_.join("+")||"1d20";return e(ue)!==0&&(G+=e(ue)>=0?`+${e(ue)}`:`${e(ue)}`),G}function st(){const _=Ge();ke(_)}function Se(_){return _.replace(/(\d+)d(\d+)/g,(G,he,te)=>`${parseInt(he)*2}d${te}`)}function Oe(){o(U,0),o(se,0),o(ne,0),o(de,0),o(we,0),o(x,0),o(ue,0),o(q,null),o(b,[]),o(R,!1),o(z,!1),ie("other"),o(Ne,!1)}function A(){window.DICE&&(window.DICE.setColors({dice_color:pe(e(Je),"ff"),label_color:pe(e(Pe),"ff"),desk_color:e(g)}),_e&&(_e.updateDeskColor(e(g)),_e.updateDiceColors()))}function $(){o(C,!e(C))}function oe(){!e(q)||e(m)<=0||e(Ne)||(o(q,{...e(q),resultTotal:e(q).resultTotal+10,resultString:e(q).resultString+" + 10 (Guided Strike)"}),le.update(_=>{const G="ChannelDivinity",he=_.classFeatures.features[G];return typeof he=="number"&&he>0&&(_.classFeatures.features[G]=he-1),_}),o(Ne,!0))}function ce(){k("close"),S(""),K(""),re(""),o(Ve,""),o(q,null),o(Ne,!1),o(R,!1),o(z,!1),Oe()}et(()=>(t(),oa),()=>{o(h,t().class?oa(t().class,t().level,t().subclass).some(G=>G.name==="Guided Strike"):!1)}),et(()=>t(),()=>{o(m,(()=>{const G=t().classFeatures.features["ChannelDivinity"];return typeof G=="number"?G:0})())}),et(()=>(e(U),e(se),e(ne),e(de),e(we),e(x),e(ue)),()=>{o(D,(()=>{const _=[];e(U)>0&&_.push(`${e(U)}d4`),e(se)>0&&_.push(`${e(se)}d6`),e(ne)>0&&_.push(`${e(ne)}d8`),e(de)>0&&_.push(`${e(de)}d10`),e(we)>0&&_.push(`${e(we)}d12`),e(x)>0&&_.push(`${e(x)}d20`);let G=_.join("+")||"1d20";return e(ue)!==0&&(G+=e(ue)>=0?`+${e(ue)}`:`${e(ue)}`),G})())}),et(()=>(E(S()),e(He),E(Z()),e(Ve),E(K()),E(re()),E(ie())),()=>{S()&&e(He)&&Z()&&S()!==e(Ve)&&(o(Ve,S()),o(q,null),o(b,[]),o(R,!1),o(z,!1),o(Ne,!1),console.log("Auto-roll triggered. notation:",S(),"damageNotation:",K(),"attackName:",re(),"rollType:",ie()),setTimeout(()=>ke(S(),ie()),200))}),Jt();var W={getLastRollTotal:Xe};It();var v=mr();let Ie;var ge=r(v),be=r(ge),B=s(r(be),2),De=r(B),Fe=s(De,2);l(B),l(be);var We=s(be,2);{var lt=_=>{var G=rr(),he=s(r(G),2),te=r(he),me=s(r(te),2);Ce(me),l(te);var j=s(te,2),T=s(r(j),2);Ce(T),l(j);var V=s(j,2),Ae=s(r(V),2);Ce(Ae),l(V),l(he),l(G),Ee(me,()=>e(Je),Re=>o(Je,Re)),F("change",me,A),Ee(T,()=>e(Pe),Re=>o(Pe,Re)),F("change",T,A),Ee(Ae,()=>e(g),Re=>o(g,Re)),F("change",Ae,A),c(_,G)};y(We,_=>{e(C)&&_(lt)})}var je=s(We,2);{var I=_=>{var G=ir();c(_,G)};y(je,_=>{e(He)||_(I)})}var Y=s(je,2),xe=r(Y);ja(xe,_=>o(X,_),()=>e(X));var Te=s(xe,2);{var qe=_=>{var G=nr(),he=s(r(G),2),te=r(he),me=s(r(te),2);Ce(me),l(te);var j=s(te,2),T=s(r(j),2);Ce(T),l(j);var V=s(j,2),Ae=s(r(V),2);Ce(Ae),l(V);var Re=s(V,2),rt=s(r(Re),2);Ce(rt),l(Re);var J=s(Re,2),dt=s(r(J),2);Ce(dt),l(J);var Dt=s(J,2),jt=s(r(Dt),2);Ce(jt),l(Dt),l(he);var u=s(he,2),H=r(u),L=r(H);l(H);var $e=s(H,2);l(u),l(G),P(()=>{H.disabled=!e(He),w(L,`Roll ${e(D)??""}`)}),Ee(me,()=>e(U),ae=>o(U,ae)),Ee(T,()=>e(se),ae=>o(se,ae)),Ee(Ae,()=>e(ne),ae=>o(ne,ae)),Ee(rt,()=>e(de),ae=>o(de,ae)),Ee(dt,()=>e(we),ae=>o(we,ae)),Ee(jt,()=>e(x),ae=>o(x,ae)),F("click",H,st),F("click",$e,Oe),c(_,G)};y(Te,_=>{S()||_(qe)})}l(Y);var ee=s(Y,2);let fe;var Me=r(ee);{var Qe=_=>{var G=br(),he=Ue(G),te=r(he),me=r(te,!0);l(te);var j=s(te,2);{var T=$e=>{var ae=or();c($e,ae)};y(j,$e=>{e(R)&&$e(T)})}var V=s(j,2);{var Ae=$e=>{var ae=cr();c($e,ae)};y(V,$e=>{e(z)&&$e(Ae)})}l(he);var Re=s(he,2),rt=r(Re,!0);l(Re);var J=s(Re,2),dt=r(J);{var Dt=$e=>{var ae=nt(),Ze=Ue(ae);{var Le=ze=>{var it=dr();_t(it,5,()=>(e(q),E(S()),E(N()),i(()=>ye(e(q),S(),N()))),kt,(tt,pt)=>{var ft=vr(),gt=r(ft),Ye=r(gt,!0);l(gt);var ct=s(gt,2),ht=r(ct);l(ct),l(ft),P(()=>{w(Ye,(e(pt),i(()=>e(pt).display))),w(ht,`(${e(pt),i(()=>e(pt).source)??""})`)}),c(tt,ft)}),l(it),c(ze,it)},ut=ze=>{var it=nt(),tt=Ue(it);{var pt=ft=>{var gt=ur(),Ye=r(gt);l(gt),P(()=>w(Ye,`Modifier: ${e(q),i(()=>e(q).constant>=0?"+":"")??""}${e(q),i(()=>e(q).constant)??""}`)),c(ft,gt)};y(tt,ft=>{e(q),i(()=>e(q).constant)&&ft(pt)},!0)}c(ze,it)};y(Ze,ze=>{E(N()),i(()=>N().length>0)?ze(Le):ze(ut,!1)})}c($e,ae)};y(dt,$e=>{e(q),E(N()),i(()=>e(q).constant||N().length>0)&&$e(Dt)})}l(J);var jt=s(J,2);{var u=$e=>{var ae=pr();c($e,ae)};y(jt,$e=>{e(z)&&$e(u)})}var H=s(jt,2);{var L=$e=>{var ae=hr(),Ze=r(ae);_t(Ze,1,()=>e(b),kt,(ze,it)=>{var tt=fr(),pt=r(tt,!0);l(tt),P(()=>w(pt,(e(it),i(()=>e(it).label)))),F("click",tt,()=>ke(e(it).notation,"damage")),c(ze,tt)});var Le=s(Ze,2);{var ut=ze=>{var it=gr();P(()=>{it.disabled=e(m)<=0,Ke(it,"title",e(m)<=0?"No Channel Divinity uses remaining":"Use Channel Divinity to add +10 to this attack roll")}),F("click",it,oe),c(ze,it)};y(Le,ze=>{e(h)&&ie()==="attack"&&!e(Ne)&&e(m)>0&&!e(z)&&ze(ut)})}l(ae),c($e,ae)};y(H,$e=>{e(b),e(h),E(ie()),e(Ne),e(m),i(()=>e(b).length>0||e(h)&&ie()==="attack"&&!e(Ne)&&e(m)>0)&&$e(L)})}P(()=>{w(me,re()?`${re()} - Result`:"Result"),w(rt,(e(q),i(()=>e(q).resultTotal)))}),c(_,G)};y(Me,_=>{e(q)&&_(Qe)})}l(ee),l(ge),l(v),P(()=>{Ie=mt(v,1,"modal-overlay svelte-1r90jgp",null,Ie,{hidden:!Z()}),fe=mt(ee,1,"roll-result svelte-1r90jgp",null,fe,{"has-result":e(q)})}),F("click",De,$),F("click",Fe,ce),F("click",ge,Ea(function(_){na.call(this,n,_)})),F("keydown",ge,function(_){na.call(this,n,_)}),F("click",v,ce),F("keydown",v,_=>_.key==="Escape"&&ce()),c(a,v),Cs(n,"getLastRollTotal",Xe);var Be=Et(W);return p(),Be}const xa="https://api.github.com/gists";async function yr(a,n,t){if(!n)throw new Error("GitHub token is required");const d=JSON.stringify(a,null,2),p=`${a.name||"character"}_dnd.json`,h={description:t||`D&D Character: ${a.name}`,public:!1,files:{[p]:{content:d}}},m=await fetch(xa,{method:"POST",headers:{Authorization:`token ${n}`,"Content-Type":"application/json"},body:JSON.stringify(h)});if(!m.ok)throw new Error(`Failed to create gist: ${m.statusText}`);return(await m.json()).id}async function kr(a,n,t){if(!n||!t)throw new Error("GitHub token and Gist ID are required");const d=JSON.stringify(a,null,2),h={files:{[`${a.name||"character"}_dnd.json`]:{content:d}}},m=await fetch(`${xa}/${t}`,{method:"PATCH",headers:{Authorization:`token ${n}`,"Content-Type":"application/json"},body:JSON.stringify(h)});if(!m.ok)throw new Error(`Failed to update gist: ${m.statusText}`)}async function Sr(a,n){if(!a)throw new Error("Gist ID is required");const t={"Content-Type":"application/json"};n&&(t.Authorization=`token ${n}`);const d=await fetch(`${xa}/${a}`,{method:"GET",headers:t});if(!d.ok)throw new Error(`Failed to load gist: ${d.statusText}`);const p=await d.json(),h=Object.values(p.files);if(h.length===0)throw new Error("No files found in gist");const D=h[0].content;try{const k=JSON.parse(D);return k.attacks&&Array.isArray(k.attacks)&&(k.attacks=k.attacks.map(S=>({...S,id:S.id||crypto.randomUUID()}))),k.classFeatures?(k.classFeatures.features||(k.classFeatures.features={}),k.classFeatures.spellSlots||(k.classFeatures.spellSlots=[]),k.classFeatures.preparedSpells===void 0&&(k.classFeatures.preparedSpells="")):k.classFeatures={features:{},spellSlots:[],preparedSpells:""},k}catch{throw new Error("Invalid character data in gist")}}function Ja(a){typeof window<"u"&&localStorage.setItem("dnd_gist_config",JSON.stringify(a))}function xr(){if(typeof window<"u"){const a=localStorage.getItem("dnd_gist_config");if(a)return JSON.parse(a)}return{}}async function $r(a,n=30){if(!a)throw new Error("GitHub token is required to list gists");const t=await fetch(`${xa}?per_page=${n}`,{method:"GET",headers:{Authorization:`token ${a}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error(`Failed to list gists: ${t.statusText}`);return await t.json()}var Cr=f('<div class="error-message svelte-1jb5ckg"> </div>'),Lr=f('<div class="toggle-container svelte-1jb5ckg"><button type="button" class="toggle-btn svelte-1jb5ckg"> </button></div>'),wr=f('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID (leave empty to create new)</label> <input type="text" id="gistId" placeholder="Optional: existing Gist ID to update" class="svelte-1jb5ckg"/></div>'),Dr=f('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),jr=f('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),Br=f('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Update (or leave unselected to create new)</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),Ar=f('<div class="info-message svelte-1jb5ckg">No gists found. A new one will be created.</div>'),Fr=f('<!> <div class="form-group svelte-1jb5ckg"><label for="description" class="svelte-1jb5ckg"> </label> <input type="text" id="description" placeholder="D&amp;D Character Sheet" class="svelte-1jb5ckg"/></div>',1),Mr=f('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID *</label> <input type="text" id="gistId" placeholder="Enter Gist ID (for public or your private gists)" required class="svelte-1jb5ckg"/></div>'),Rr=f('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),Pr=f('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),Ir=f('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Load</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),Tr=f('<div class="info-message svelte-1jb5ckg">No gists found. Enter a Gist ID manually or create a new one in Save mode.</div>'),Er=f('<div class="modal-overlay svelte-1jb5ckg" role="button" tabindex="-1"><div class="modal-content svelte-1jb5ckg" role="dialog" tabindex="0"><div class="modal-header svelte-1jb5ckg"><h2 class="svelte-1jb5ckg"> </h2> <button class="close-btn svelte-1jb5ckg">Ã—</button></div> <div class="modal-body svelte-1jb5ckg"><!> <div class="form-group svelte-1jb5ckg"><label for="token" class="svelte-1jb5ckg"> <a href="https://github.com/settings/tokens" target="_blank" rel="noopener" class="svelte-1jb5ckg">Get token</a></label> <input type="password" id="token" placeholder="ghp_xxxxxxxxxxxxx" class="svelte-1jb5ckg"/></div> <!> <!> <div class="modal-actions svelte-1jb5ckg"><button class="btn btn-primary svelte-1jb5ckg"><!></button> <button class="btn btn-secondary svelte-1jb5ckg">Cancel</button></div></div></div></div>');function Hr(a,n){Tt(n,!1);const t=()=>at(le,"$character",d),[d,p]=Wt(),h=sa();let m=yt(n,"mode",8,"save"),D=M(""),k=M(""),S=M(""),Z=M(!1),K=M(""),re=M(!1),ve=M(!1),N=M([]),ie=M(null);const _e=xr();_e.token&&o(D,_e.token),_e.gistId&&o(k,_e.gistId),pa(async()=>{e(D)&&!e(re)&&await X()});async function X(){if(e(D)){o(ve,!0),o(K,"");try{o(N,await $r(e(D))),e(k)&&o(ie,e(N).find($=>$.id===e(k))||null)}catch($){o(K,$.message||"Failed to load gists"),o(N,[])}finally{o(ve,!1)}}}function He($){o(ie,$),o(k,$.id)}function Ve(){o(re,!e(re)),o(K,""),!e(re)&&e(D)&&X()}async function q(){if(!e(D)){o(K,"GitHub token is required");return}const $=e(ie)?.id||e(k);o(Z,!0),o(K,"");try{if($)await kr(t(),e(D),$),o(k,$),Ot.add("Character updated in Gist successfully!","success");else{const oe=await yr(t(),e(D),e(S));o(k,oe),Ot.add(`Character saved to Gist! ID: ${oe}`,"success")}Ja({token:e(D),gistId:e(k)}),h("close")}catch(oe){o(K,oe.message||"Failed to save to Gist")}finally{o(Z,!1)}}async function Xe(){const $=e(ie)?.id||e(k);if(!$){o(K,"Please select a gist or enter a Gist ID");return}o(Z,!0),o(K,"");try{const oe=await Sr($,e(D)||void 0);le.set(oe),o(k,$),Ja({token:e(D),gistId:e(k)}),Ot.add("Character loaded from Gist successfully!","success"),h("close")}catch(oe){o(K,oe.message||"Failed to load from Gist")}finally{o(Z,!1)}}function ye(){h("close")}It();var U=Er(),se=r(U),ne=r(se),de=r(ne),we=r(de,!0);l(de);var x=s(de,2);l(ne);var ue=s(ne,2),b=r(ue);{var R=$=>{var oe=Cr(),ce=r(oe,!0);l(oe),P(()=>w(ce,e(K))),c($,oe)};y(b,$=>{e(K)&&$(R)})}var z=s(b,2),Ne=r(z),Je=r(Ne);ra(),l(Ne);var Pe=s(Ne,2);Ce(Pe),l(z);var g=s(z,2);{var C=$=>{var oe=Lr(),ce=r(oe),W=r(ce,!0);l(ce),l(oe),P(()=>{ce.disabled=e(Z),w(W,e(re)?"ðŸ“‹ Show My Gists":"âœï¸ Enter Gist ID Manually")}),F("click",ce,Ve),c($,oe)};y(g,$=>{(m()==="load"||m()==="save"&&e(D))&&$(C)})}var Q=s(g,2);{var pe=$=>{var oe=Fr(),ce=Ue(oe);{var W=De=>{var Fe=wr(),We=s(r(Fe),2);Ce(We),l(Fe),P(()=>We.disabled=e(Z)),Ee(We,()=>e(k),lt=>o(k,lt)),c(De,Fe)},v=De=>{var Fe=nt(),We=Ue(Fe);{var lt=I=>{var Y=Dr();c(I,Y)},je=I=>{var Y=nt(),xe=Ue(Y);{var Te=ee=>{var fe=Br(),Me=s(r(fe),2);_t(Me,5,()=>e(N),kt,(Qe,Be)=>{var _=jr();let G;var he=r(_),te=r(he),me=r(te,!0);l(te);var j=s(te,2),T=r(j,!0);l(j),l(he);var V=s(he,2),Ae=r(V),Re=r(Ae);l(Ae);var rt=s(Ae,2),J=r(rt);l(rt),l(V),l(_),P(dt=>{G=mt(_,1,"gist-item svelte-1jb5ckg",null,G,{selected:e(ie)?.id===e(Be).id}),_.disabled=e(Z),w(me,(e(Be),i(()=>e(Be).description||"Untitled"))),w(T,(e(Be),i(()=>e(Be).public?"ðŸŒ Public":"ðŸ”’ Private"))),w(Re,`ID: ${e(Be),i(()=>e(Be).id)??""}`),w(J,`Updated: ${dt??""}`)},[()=>(e(Be),i(()=>new Date(e(Be).updated_at).toLocaleDateString()))]),F("click",_,()=>He(e(Be))),c(Qe,_)}),l(Me),l(fe),c(ee,fe)},qe=ee=>{var fe=nt(),Me=Ue(fe);{var Qe=Be=>{var _=Ar();c(Be,_)};y(Me,Be=>{e(D)&&Be(Qe)},!0)}c(ee,fe)};y(xe,ee=>{e(N),i(()=>e(N).length>0)?ee(Te):ee(qe,!1)},!0)}c(I,Y)};y(We,I=>{e(ve)?I(lt):I(je,!1)},!0)}c(De,Fe)};y(ce,De=>{e(re)||!e(D)?De(W):De(v,!1)})}var Ie=s(ce,2),ge=r(Ie),be=r(ge);l(ge);var B=s(ge,2);Ce(B),l(Ie),P(()=>{w(be,`Description ${e(k)?"(optional)":""}`),B.disabled=e(Z)}),Ee(B,()=>e(S),De=>o(S,De)),c($,oe)},O=$=>{var oe=nt(),ce=Ue(oe);{var W=Ie=>{var ge=Mr(),be=s(r(ge),2);Ce(be),l(ge),P(()=>be.disabled=e(Z)),Ee(be,()=>e(k),B=>o(k,B)),c(Ie,ge)},v=Ie=>{var ge=nt(),be=Ue(ge);{var B=Fe=>{var We=Rr();c(Fe,We)},De=Fe=>{var We=nt(),lt=Ue(We);{var je=Y=>{var xe=Ir(),Te=s(r(xe),2);_t(Te,5,()=>e(N),kt,(qe,ee)=>{var fe=Pr();let Me;var Qe=r(fe),Be=r(Qe),_=r(Be,!0);l(Be);var G=s(Be,2),he=r(G,!0);l(G),l(Qe);var te=s(Qe,2),me=r(te),j=r(me);l(me);var T=s(me,2),V=r(T);l(T),l(te),l(fe),P(Ae=>{Me=mt(fe,1,"gist-item svelte-1jb5ckg",null,Me,{selected:e(ie)?.id===e(ee).id}),fe.disabled=e(Z),w(_,(e(ee),i(()=>e(ee).description||"Untitled"))),w(he,(e(ee),i(()=>e(ee).public?"ðŸŒ Public":"ðŸ”’ Private"))),w(j,`ID: ${e(ee),i(()=>e(ee).id)??""}`),w(V,`Updated: ${Ae??""}`)},[()=>(e(ee),i(()=>new Date(e(ee).updated_at).toLocaleDateString()))]),F("click",fe,()=>He(e(ee))),c(qe,fe)}),l(Te),l(xe),c(Y,xe)},I=Y=>{var xe=nt(),Te=Ue(xe);{var qe=ee=>{var fe=Tr();c(ee,fe)};y(Te,ee=>{e(D)&&ee(qe)},!0)}c(Y,xe)};y(lt,Y=>{e(N),i(()=>e(N).length>0)?Y(je):Y(I,!1)},!0)}c(Fe,We)};y(be,Fe=>{e(ve)?Fe(B):Fe(De,!1)},!0)}c(Ie,ge)};y(ce,Ie=>{e(re)||!e(D)?Ie(W):Ie(v,!1)},!0)}c($,oe)};y(Q,$=>{m()==="save"?$(pe):$(O,!1)})}var ke=s(Q,2),Ge=r(ke),st=r(Ge);{var Se=$=>{var oe=Mt();P(()=>w(oe,m()==="save"?"Saving...":"Loading...")),c($,oe)},Oe=$=>{var oe=Mt();P(()=>w(oe,m()==="save"?"Save":"Load")),c($,oe)};y(st,$=>{e(Z)?$(Se):$(Oe,!1)})}l(Ge);var A=s(Ge,2);l(ke),l(ue),l(se),l(U),P(()=>{w(we,m()==="save"?"Save to GitHub Gist":"Load from GitHub Gist"),w(Je,`GitHub Token ${m()==="load"?"(optional for public gists)":"(required)"} `),Pe.disabled=e(Z),Ge.disabled=e(Z),A.disabled=e(Z)}),F("click",x,ye),Ee(Pe,()=>e(D),$=>o(D,$)),F("blur",Pe,()=>{e(D)&&!e(re)&&X()}),F("click",Ge,function(...$){(m()==="save"?q:Xe)?.apply(this,$)}),F("click",A,ye),F("click",se,Ea(function($){na.call(this,n,$)})),F("keydown",se,function($){na.call(this,n,$)}),F("click",U,ye),F("keydown",U,$=>$.key==="Escape"&&ye()),c(a,U),Et(),p()}var Ur=f('<div class="loading svelte-1ngjemu">Loading D&D data...</div>'),Nr=f("<option> </option>"),Gr=f('<select class="level-filter svelte-1ngjemu"><option>All Levels</option><option>Cantrip</option><!></select>'),Or=f('<div class="no-results svelte-1ngjemu"> </div>'),qr=f('<div class="item-meta svelte-1ngjemu"> </div>'),Wr=f('<div class="item-meta svelte-1ngjemu"> </div>'),zr=f('<button><div class="item-name svelte-1ngjemu"> </div> <!></button>'),Kr=f('<p class="higher-levels"><strong>At Higher Levels:</strong> </p>'),Vr=f('<p class="cantrip-upgrade"><strong>Cantrip Upgrade:</strong> </p>'),Jr=f('<h3 class="svelte-1ngjemu"> </h3> <p class="spell-meta svelte-1ngjemu"><!> <!></p> <p class="spell-classes"><strong>Classes:</strong> </p> <div class="spell-stats svelte-1ngjemu"><div><strong>Casting Time:</strong> </div> <div><strong>Range:</strong> </div> <div><strong>Components:</strong> <!></div> <div><strong>Duration:</strong> <!> </div></div> <p class="description svelte-1ngjemu"> </p> <!> <!>',1),Qr=f('<p class="prerequisite svelte-1ngjemu"><strong>Prerequisite:</strong> </p>'),Yr=f('<h3 class="svelte-1ngjemu"> </h3> <!> <p class="description svelte-1ngjemu"> </p> <a target="_blank" rel="noopener" class="source-link svelte-1ngjemu">View Full Details â†’</a>',1),Xr=f('<div class="item-details svelte-1ngjemu"><!></div>'),Zr=f('<div class="controls svelte-1ngjemu"><div class="tabs svelte-1ngjemu"><button> </button> <button> </button></div> <div class="search-controls svelte-1ngjemu"><input type="text" placeholder="Search by name or description..." class="search-input svelte-1ngjemu"/> <!></div></div> <div class="content-container svelte-1ngjemu"><div class="items-list svelte-1ngjemu"><!></div> <!></div>',1),ei=f('<div class="modal-backdrop svelte-1ngjemu" role="presentation"><div class="modal svelte-1ngjemu" role="dialog" aria-modal="true" tabindex="-1"><div class="modal-header svelte-1ngjemu"><h2 class="svelte-1ngjemu">Browse D&D Spells & Feats</h2> <button class="close-btn svelte-1ngjemu" aria-label="Close">&times;</button></div> <div class="modal-body svelte-1ngjemu"><!></div> <div class="modal-footer svelte-1ngjemu"><button class="btn-secondary svelte-1ngjemu">Cancel</button> <button class="btn-primary svelte-1ngjemu">Add to Character Sheet</button></div></div></div>');function ti(a,n){Tt(n,!1);const t=M(),d=M(),p=M();let h=yt(n,"onClose",8),m=M("spell"),D=M(!0),k=M(""),S=M(null),Z=M([]),K=M([]),re=M(null);pa(async()=>{o(D,!0);try{o(Z,await ss()),o(K,await Ys())}catch(x){console.error("Failed to load data:",x)}finally{o(D,!1)}});function ve(x){o(re,x)}function N(x){const ue=x.match(/(\d+d\d+(?:\s*\+\s*\d+)?)/i);return ue?ue[1]:""}function ie(x){const ue=x.split(/\.( |$)/)[0].trim(),b=Array.from(x.matchAll(/\*\*(.*?)\*\*/g)).map(z=>z[1].replace(/\.$/,""));let R=ue;return b.length&&(R+=" | Effects: "+b.join(", ")),R}function _e(){if(e(re)){if(e(m)==="spell"){const x=e(re);le.update(ue=>{const R=[];x.range&&R.push(`Range: ${x.range}`),x.castingTime&&R.push(`Cast: ${x.castingTime}`),x.duration&&R.push(`Duration: ${x.duration}`),x.actionType==="Save"&&R.push("Saving throw spell"),x.components&&x.components.length>0&&R.push(`Components: ${x.components.join(", ")}`),x.material&&R.push(`Material: ${x.material}`);const z=R.join(" | "),Ne=ie(x.description),Je={id:crypto.randomUUID(),name:`${x.name}${x.concentration?" (C)":""}${x.ritual?" (R)":""}`,bonus:x.actionType==="Attack"?5:0,damage:N(x.description),damageType:`${x.school} (Lvl ${x.level})`,spellRef:x.name,infoNotes:z,generalNotes:Ne,castAtLevel:x.level};return ue.attacks=[...ue.attacks,Je],ue})}else if(e(m)==="feat"){const x=e(re);le.update(ue=>{const b=`${x.name}${x.prerequisite?` (Req: ${x.prerequisite})`:""}
${x.description}
`;return ue.features=ue.features?`${ue.features}
${b}`:b,ue})}o(re,null),h()()}}et(()=>(e(S),e(Z),e(k)),()=>{o(t,e(S)!==null?Xs(za(e(Z),e(k)),e(S)):za(e(Z),e(k)))}),et(()=>(e(K),e(k)),()=>{o(d,Zs(e(K),e(k)))}),et(()=>(e(m),e(t),e(d)),()=>{o(p,e(m)==="spell"?e(t):e(d))}),Jt(),It();var X=ei(),He=r(X),Ve=r(He),q=s(r(Ve),2);l(Ve);var Xe=s(Ve,2),ye=r(Xe);{var U=x=>{var ue=Ur();c(x,ue)},se=x=>{var ue=Zr(),b=Ue(ue),R=r(b),z=r(R);let Ne;var Je=r(z);l(z);var Pe=s(z,2);let g;var C=r(Pe);l(Pe),l(R);var Q=s(R,2),pe=r(Q);Ce(pe);var O=s(pe,2);{var ke=ce=>{var W=Gr();P(()=>{e(S),wt(()=>{})});var v=r(W);v.value=(v.__value=null)??"";var Ie=s(v);Ie.value=Ie.__value=0;var ge=s(Ie);_t(ge,0,()=>[1,2,3,4,5,6,7,8,9],kt,(be,B)=>{var De=Nr(),Fe=r(De);l(De);var We={};P(()=>{w(Fe,`Level ${B??""}`),We!==(We=B)&&(De.value=(De.__value=B)??"")}),c(be,De)}),l(W),Aa(W,()=>e(S),be=>o(S,be)),c(ce,W)};y(O,ce=>{e(m)==="spell"&&ce(ke)})}l(Q),l(b);var Ge=s(b,2),st=r(Ge),Se=r(st);{var Oe=ce=>{var W=Or(),v=r(W);l(W),P(()=>w(v,`No ${e(m)??""}s found`)),c(ce,W)},A=ce=>{var W=nt(),v=Ue(W);_t(v,1,()=>e(p),kt,(Ie,ge)=>{var be=zr();let B;var De=r(be),Fe=r(De,!0);l(De);var We=s(De,2);{var lt=I=>{const Y=ot(()=>e(ge));var xe=qr(),Te=r(xe);l(xe),P(()=>w(Te,`Level ${E(e(Y)),i(()=>e(Y).level)??""} â€¢ ${E(e(Y)),i(()=>e(Y).school)??""}`)),c(I,xe)},je=I=>{const Y=ot(()=>e(ge));var xe=nt(),Te=Ue(xe);{var qe=ee=>{var fe=Wr(),Me=r(fe,!0);l(fe),P(()=>w(Me,(E(e(Y)),i(()=>e(Y).prerequisite)))),c(ee,fe)};y(Te,ee=>{E(e(Y)),i(()=>e(Y).prerequisite)&&ee(qe)})}c(I,xe)};y(We,I=>{e(m)==="spell"?I(lt):I(je,!1)})}l(be),P(()=>{B=mt(be,1,"item-card svelte-1ngjemu",null,B,{selected:e(re)?.name===e(ge).name}),w(Fe,(e(ge),i(()=>e(ge).name)))}),F("click",be,()=>ve(e(ge))),c(Ie,be)}),c(ce,W)};y(Se,ce=>{e(p),i(()=>e(p).length===0)?ce(Oe):ce(A,!1)})}l(st);var $=s(st,2);{var oe=ce=>{var W=Xr(),v=r(W);{var Ie=be=>{const B=ot(()=>e(re));var De=Jr(),Fe=Ue(De),We=r(Fe,!0);l(Fe);var lt=s(Fe,2),je=r(lt);{var I=u=>{var H=Mt();P(()=>w(H,`${E(e(B)),i(()=>e(B).school)??""} cantrip`)),c(u,H)},Y=u=>{var H=Mt();P(()=>w(H,`Level ${E(e(B)),i(()=>e(B).level)??""} ${E(e(B)),i(()=>e(B).school)??""}`)),c(u,H)};y(je,u=>{E(e(B)),i(()=>e(B).level===0)?u(I):u(Y,!1)})}var xe=s(je,2);{var Te=u=>{var H=Mt("(ritual)");c(u,H)};y(xe,u=>{E(e(B)),i(()=>e(B).ritual)&&u(Te)})}l(lt);var qe=s(lt,2),ee=s(r(qe));l(qe);var fe=s(qe,2),Me=r(fe),Qe=s(r(Me));l(Me);var Be=s(Me,2),_=s(r(Be));l(Be);var G=s(Be,2),he=s(r(G)),te=s(he);{var me=u=>{var H=Mt();P(()=>w(H,`(${E(e(B)),i(()=>e(B).material)??""})`)),c(u,H)};y(te,u=>{E(e(B)),i(()=>e(B).material)&&u(me)})}l(G);var j=s(G,2),T=s(r(j),2);{var V=u=>{var H=Mt("Concentration,");c(u,H)};y(T,u=>{E(e(B)),i(()=>e(B).concentration)&&u(V)})}var Ae=s(T,1,!0);l(j),l(fe);var Re=s(fe,2),rt=r(Re,!0);l(Re);var J=s(Re,2);{var dt=u=>{var H=Kr(),L=s(r(H));l(H),P(()=>w(L,` ${E(e(B)),i(()=>e(B).higherLevelSlot)??""}`)),c(u,H)};y(J,u=>{E(e(B)),i(()=>e(B).higherLevelSlot)&&u(dt)})}var Dt=s(J,2);{var jt=u=>{var H=Vr(),L=s(r(H));l(H),P(()=>w(L,` ${E(e(B)),i(()=>e(B).cantripUpgrade)??""}`)),c(u,H)};y(Dt,u=>{E(e(B)),i(()=>e(B).cantripUpgrade)&&u(jt)})}P((u,H)=>{w(We,(E(e(B)),i(()=>e(B).name))),w(ee,` ${u??""}`),w(Qe,` ${E(e(B)),i(()=>e(B).castingTime||e(B).actionType)??""}`),w(_,` ${E(e(B)),i(()=>e(B).range)??""}`),w(he,` ${H??""}`),w(Ae,(E(e(B)),i(()=>e(B).duration))),w(rt,(E(e(B)),i(()=>e(B).description)))},[()=>(E(e(B)),i(()=>e(B).classes.join(", "))),()=>(E(e(B)),i(()=>e(B).components.join(", ").toUpperCase()))]),c(be,De)},ge=be=>{const B=ot(()=>e(re));var De=Yr(),Fe=Ue(De),We=r(Fe,!0);l(Fe);var lt=s(Fe,2);{var je=Te=>{var qe=Qr(),ee=s(r(qe));l(qe),P(()=>w(ee,` ${E(e(B)),i(()=>e(B).prerequisite)??""}`)),c(Te,qe)};y(lt,Te=>{E(e(B)),i(()=>e(B).prerequisite)&&Te(je)})}var I=s(lt,2),Y=r(I,!0);l(I);var xe=s(I,2);P(()=>{w(We,(E(e(B)),i(()=>e(B).name))),w(Y,(E(e(B)),i(()=>e(B).description))),Ke(xe,"href",(E(e(B)),i(()=>e(B).source)))}),c(be,De)};y(v,be=>{e(m)==="spell"?be(Ie):be(ge,!1)})}l(W),c(ce,W)};y($,ce=>{e(re)&&ce(oe)})}l(Ge),P(()=>{Ne=mt(z,1,"tab svelte-1ngjemu",null,Ne,{active:e(m)==="spell"}),w(Je,`ðŸ“œ Spells (${e(Z),i(()=>e(Z).length)??""})`),g=mt(Pe,1,"tab svelte-1ngjemu",null,g,{active:e(m)==="feat"}),w(C,`â­ Feats (${e(K),i(()=>e(K).length)??""})`)}),F("click",z,()=>{o(m,"spell"),o(re,null),o(k,"")}),F("click",Pe,()=>{o(m,"feat"),o(re,null),o(k,"")}),Ee(pe,()=>e(k),ce=>o(k,ce)),c(x,ue)};y(ye,x=>{e(D)?x(U):x(se,!1)})}l(Xe);var ne=s(Xe,2),de=r(ne),we=s(de,2);l(ne),l(He),l(X),P(()=>we.disabled=!e(re)),F("click",q,function(...x){h()?.apply(this,x)}),F("click",de,function(...x){h()?.apply(this,x)}),F("click",we,_e),F("click",He,Ea(function(x){na.call(this,n,x)})),F("keydown",He,function(x){na.call(this,n,x)}),F("click",X,function(...x){h()?.apply(this,x)}),F("keydown",X,x=>x.key==="Escape"&&h()()),c(a,X),Et()}var ai=f('<link rel="icon" type="image/png" href="favicon4.png"/> <meta name="viewport" content="width=device-width, initial-scale=1"/>',1),si=f('<span class="character-name svelte-1uha8ag"> </span>'),li=f("<span> </span>"),ri=f('<div class="spell-slots-header svelte-1uha8ag"></div>'),ii=f("<span> </span><br/>",1),ni=f("<span> </span>"),oi=f('<span class="effect-tooltip"><strong> </strong><br/> <br/> <!> <!></span>'),ci=f('<button class="effect-remove-btn svelte-1uha8ag">Ã—</button>'),vi=f('<span class="effect-badge svelte-1uha8ag" tabindex="0"> <!> <!></span>'),di=f(`<div class="active-effects-header svelte-1uha8ag"></div> <style>.effect-badge {
              position: relative;
            }
            .effect-tooltip {
              position: absolute;
              top: 120%;
              left: 50%;
              transform: translateX(-50%);
              background: #fff;
              color: #222;
              border: 1px solid #a5b4fc;
              border-radius: 6px;
              padding: 8px 12px;
              font-size: 0.95em;
              box-shadow: 0 2px 8px rgba(0, 0, 0, 0.12);
              z-index: 10;
              min-width: 180px;
              max-width: 260px;
              white-space: normal;
              pointer-events: none;
              opacity: 1;
              transition: opacity 0.15s;
            }</style>`,1),ui=f('<div class="rest-menu svelte-1uha8ag"><button class="rest-option svelte-1uha8ag">â˜• Short Rest</button> <button class="rest-option svelte-1uha8ag">ðŸ›ï¸ Long Rest</button></div>'),pi=f('<div class="container svelte-1uha8ag"><header class="svelte-1uha8ag"><div class="header-top svelte-1uha8ag"><div class="header-title svelte-1uha8ag"><div class="title-row svelte-1uha8ag"><h1 class="svelte-1uha8ag">D&D Character Sheet</h1> <!></div> <!> <!></div> <div class="header-right svelte-1uha8ag"><div class="header-controls svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">ðŸŽ²</span><span class="btn-text svelte-1uha8ag">Roll Dice</span></button> <div class="rest-button-container svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">ðŸ˜´</span><span class="btn-text svelte-1uha8ag">Rest</span></button> <!></div> <div class="mode-toggle"><button><span class="btn-icon svelte-1uha8ag"> </span><span class="btn-text svelte-1uha8ag"> </span></button></div></div> <div class="header-search svelte-1uha8ag"><input type="text" placeholder="ðŸ” Search..." class="search-input use-enabled svelte-1uha8ag"/></div></div></div> <div class="header-actions svelte-1uha8ag"><button class="btn btn-mode svelte-1uha8ag">ðŸ“š Browse Spells & Feats</button> <button class="btn btn-secondary">Save to Gist</button> <button class="btn btn-secondary">Load from Gist</button> <button class="btn btn-secondary">Export JSON</button> <button class="btn btn-secondary">Import JSON</button> <input type="file" accept=".json" style="display: none;"/></div></header> <main class="svelte-1uha8ag"><!> <!> <!> <!> <!> <!> <!></main></div> <!> <!> <!> <!>',1);function Si(a,n){Tt(n,!1);const t=()=>at(le,"$character",h),d=()=>at(ia,"$isEditMode",h),p=()=>at(Zt,"$searchFilter",h),[h,m]=Wt();function D(){const u=[],H=t().classFeatures.spellSlotsByLevel||{};for(let L=1;L<=9;L++){const $e=H[L];if($e&&$e.length>0){const ae=$e.length,Ze=$e.filter(Le=>Le).length;u.push({level:L,available:ae-Ze,total:ae})}}return u}let k=M(!1),S=M(!1),Z=M(!1),K=M("save"),re=M(void 0),ve=M(""),N=M(""),ie=M(""),_e=M(!1),X=M([]),He=M("other"),Ve=M(),q=!1,Xe=1,ye=M(!1),U=M(null);function se(u){o(U,u)}function ne(){o(U,null)}function de(u){o(U,e(U)===u?null:u)}function we(){const u=[];le.update(L=>{const $e=L.hitDice.current;L.hitDice.current=Math.min(L.hitDice.max,L.hitDice.current+Math.max(1,Math.floor(L.hitDice.max/2)));const ae=L.hitDice.current-$e;if(ae>0&&u.push(`${ae} hit ${ae===1?"die":"dice"}`),L.class){const Ze=oa(L.class,L.level,L.subclass);L.classFeatures.features||(L.classFeatures.features={}),Ze.forEach(Le=>{if(Le.resetOn==="short"){const ut=Le.name.replace(/\s+/g,"");if(Le.type==="uses"){const ze=typeof Le.maxUses=="function"?Le.maxUses(L.level):Le.maxUses;L.classFeatures.features[ut]=Array(ze).fill(!1),u.push(Le.name)}else if(Le.type==="pool"){const ze=typeof Le.maxPool=="function"?Le.maxPool(L.level):Le.maxPool;ze!==void 0&&(L.classFeatures.features[ut]=ze,u.push(Le.name))}}})}return L}),o(ye,!1);const H=u.length>0?`Short rest taken! Restored: ${u.join(", ")}`:"Short rest taken!";Ot.add(H,"success")}function x(){const u=[];le.update(L=>{const $e=L.maxHP-L.currentHP;$e>0&&u.push(`${$e} HP`),L.currentHP=L.maxHP,L.tempHP=0;const ae=L.hitDice.max-L.hitDice.current;ae>0&&u.push(`${ae} hit ${ae===1?"die":"dice"}`),L.hitDice.current=L.hitDice.max;let Ze=0;if(L.classFeatures.spellSlotsByLevel&&Object.keys(L.classFeatures.spellSlotsByLevel).forEach(Le=>{const ut=L.classFeatures.spellSlotsByLevel[parseInt(Le)];if(ut){const ze=ut.filter(it=>it).length;Ze+=ze,L.classFeatures.spellSlotsByLevel[parseInt(Le)]=Array(ut.length).fill(!1)}}),Ze>0&&u.push(`${Ze} spell ${Ze===1?"slot":"slots"}`),L.class){const Le=oa(L.class,L.level,L.subclass);L.classFeatures.features||(L.classFeatures.features={});let ut=!1;Le.forEach(ze=>{const it=ze.name.replace(/\s+/g,"");if(!(ze.type==="info"||ze.type==="channelDivinity")){if(ze.type==="uses"){const tt=typeof ze.maxUses=="function"?ze.maxUses(L.level):ze.maxUses;L.classFeatures.features[it]=Array(tt).fill(!1),ut=!0}else if(ze.type==="pool"){const tt=typeof ze.maxPool=="function"?ze.maxPool(L.level):ze.maxPool;tt!==void 0&&(L.classFeatures.features[it]=tt,ut=!0)}}}),ut&&u.push("all class features")}return L}),o(ye,!1);const H=u.length>0?`Long rest taken! Restored: ${u.join(", ")}`:"Long rest taken! Fully rested.";Ot.add(H,"success")}function ue(u){o(ve,""),o(N,""),o(ie,""),o(_e,!1),o(X,[]),o(He,"other"),q=!1,typeof u=="string"?o(ve,u):(o(ve,u.notation),o(N,u.damageNotation||""),o(ie,u.attackName||""),o(_e,!!u.applyHalfDamage),o(X,u.bonusBreakdown||[]),o(He,u.rollType||"other")),o(k,!0)}function b(u){const{notation:H,count:L,bonusBreakdown:$e}=u.detail;o(ve,""),q=!0,Xe=L||1,setTimeout(()=>{o(ve,H),o(N,""),o(ie,"Hit Die"),o(X,$e||[]),o(He,"other")},0),o(k,!0)}function R(){if(o(k,!1),q&&e(Ve)){const u=e(Ve).getLastRollTotal();if(u!==null){const H=Math.max(1,u);le.update(L=>(L.hitDice.current=Math.max(0,L.hitDice.current-Xe),L.currentHP=Math.min(L.maxHP,L.currentHP+H),L))}q=!1}}function z(){ia.update(u=>!u)}function Ne(u){u.target.closest(".rest-button-container")||o(ye,!1)}pa(()=>{const u=ia.subscribe(H=>{H?document.body.classList.remove("use-mode"):document.body.classList.add("use-mode")});return document.addEventListener("click",Ne),()=>{u(),document.removeEventListener("click",Ne)}});function Je(){ms(t())}function Pe(){e(re)?.click()}async function g(u){const L=u.target.files?.[0];if(L)try{const $e=await _s(L);le.set($e),alert("Character imported successfully!")}catch{alert("Failed to import character file")}}It();var C=pi();hs("1uha8ag",u=>{var H=ai();ra(2),Xa(()=>{fs.title="D&D Character Sheet"}),c(u,H)});var Q=Ue(C),pe=r(Q),O=r(pe),ke=r(O),Ge=r(ke),st=s(r(Ge),2);{var Se=u=>{var H=si(),L=r(H);l(H),P(()=>w(L,`${t().name??""} (${t().level??""})`)),c(u,H)};y(st,u=>{t().name&&u(Se)})}l(Ge);var Oe=s(Ge,2);{var A=u=>{var H=ri();_t(H,5,D,kt,(L,$e)=>{var ae=li();let Ze;var Le=r(ae);l(ae),P(()=>{Ze=mt(ae,1,"slot-badge svelte-1uha8ag",null,Ze,{depleted:e($e).available===0}),w(Le,`Lv${e($e).level??""}: ${e($e).available??""}/${e($e).total??""}`)}),c(L,ae)}),l(H),c(u,H)};y(Oe,u=>{D().length>0&&u(A)})}var $=s(Oe,2);{var oe=u=>{var H=di(),L=Ue(H);_t(L,5,()=>t().activeStates,kt,($e,ae,Ze)=>{var Le=vi(),ut=r(Le),ze=s(ut);{var it=ft=>{var gt=oi(),Ye=r(gt),ct=r(Ye,!0);l(Ye);var ht=s(Ye,2),xt=s(ht,3);{var Ht=$t=>{var Ct=ii(),Nt=Ue(Ct),vt=r(Nt);l(Nt),ra(),P(()=>w(vt,`Attack Bonus: ${typeof e(ae).attackBonus=="number"&&e(ae).attackBonus>0?"+":""}${e(ae).attackBonus??""}`)),c($t,Ct)};y(xt,$t=>{e(ae).attackBonus&&$t(Ht)})}var Ut=s(xt,2);{var At=$t=>{var Ct=ni(),Nt=r(Ct);l(Ct),P(()=>w(Nt,`Damage Bonus: ${typeof e(ae).damageBonus=="number"&&e(ae).damageBonus>0?"+":""}${e(ae).damageBonus??""}`)),c($t,Ct)};y(Ut,$t=>{e(ae).damageBonus&&$t(At)})}l(gt),P(()=>{w(ct,e(ae).name),w(ht,` ${e(ae).description??""}`)}),c(ft,gt)};y(ze,ft=>{e(U)===Ze&&ft(it)})}var tt=s(ze,2);{var pt=ft=>{var gt=ci();P(()=>Ke(gt,"title",`End ${e(ae).name??""}`)),F("click",gt,()=>{le.update(Ye=>{if(Ye.activeStates){const ct=Ye.activeStates[Ze];ct?.hpBonus&&ct.target!=="other"&&(Ye.maxHP-=ct.hpBonus,Ye.currentHP=Math.max(1,Math.min(Ye.currentHP-ct.hpBonus,Ye.maxHP))),Ye.activeStates=Ye.activeStates.filter((ht,xt)=>xt!==Ze)}return Ye})}),c(ft,gt)};y(tt,ft=>{d()||ft(pt)})}l(Le),P(()=>{Ke(Le,"aria-label",e(ae).name),w(ut,`âœ¨ ${e(ae).name??""} `)}),F("mouseenter",Le,()=>se(Ze)),F("mouseleave",Le,ne),F("focus",Le,()=>se(Ze)),F("blur",Le,ne),F("click",Le,()=>de(Ze)),c($e,Le)}),l(L),ra(2),c(u,H)};y($,u=>{t().activeStates&&t().activeStates.length>0&&u(oe)})}l(ke);var ce=s(ke,2),W=r(ce),v=r(W),Ie=s(v,2),ge=r(Ie),be=s(ge,2);{var B=u=>{var H=ui(),L=r(H),$e=s(L,2);l(H),F("click",L,we),F("click",$e,x),c(u,H)};y(be,u=>{e(ye)&&u(B)})}l(Ie);var De=s(Ie,2),Fe=r(De);let We;var lt=r(Fe),je=r(lt,!0);l(lt);var I=s(lt),Y=r(I,!0);l(I),l(Fe),l(De),l(W);var xe=s(W,2),Te=r(xe);Ce(Te),l(xe),l(ce),l(O);var qe=s(O,2),ee=r(qe),fe=s(ee,2),Me=s(fe,2),Qe=s(Me,2),Be=s(Qe,2),_=s(Be,2);ja(_,u=>o(re,u),()=>e(re)),l(qe),l(pe);var G=s(pe,2),he=r(G);Ps(he,{});var te=s(he,2);Hs(te,{$$events:{roll:u=>ue(u.detail)}});var me=s(te,2);Qs(me,{$$events:{roll:u=>ue(u.detail)}});var j=s(me,2);zs(j,{$$events:{rollHitDice:b}});var T=s(j,2);El(T,{$$events:{roll:u=>ue(u.detail)}});var V=s(T,2);tr(V,{});var Ae=s(V,2);lr(Ae,{}),l(G),l(Q);var Re=s(Q,2);ja(_r(Re,{get notation(){return e(ve)},get damageNotation(){return e(N)},get attackName(){return e(ie)},get applyHalfDamage(){return e(_e)},get bonusBreakdown(){return e(X)},get rollType(){return e(He)},get visible(){return e(k)},$$events:{close:R},$$legacy:!0}),u=>o(Ve,u),()=>e(Ve));var rt=s(Re,2);{var J=u=>{Hr(u,{get mode(){return e(K)},$$events:{close:()=>o(S,!1)}})};y(rt,u=>{e(S)&&u(J)})}var dt=s(rt,2);{var Dt=u=>{ti(u,{onClose:()=>o(Z,!1)})};y(dt,u=>{e(Z)&&u(Dt)})}var jt=s(dt,2);bs(jt,{}),P(()=>{We=mt(Fe,1,"btn btn-mode svelte-1uha8ag",null,We,{"use-mode":!d()}),w(je,d()?"ðŸ“":"ðŸŽ²"),w(Y,d()?"Edit Mode":"Use Mode")}),F("click",v,()=>{o(X,[]),o(k,!0)}),F("click",ge,()=>o(ye,!e(ye))),F("click",Fe,z),Ee(Te,p,u=>ys(Zt,u)),F("click",ee,()=>o(Z,!0)),F("click",fe,()=>{o(K,"save"),o(S,!0)}),F("click",Me,()=>{o(K,"load"),o(S,!0)}),F("click",Qe,Je),F("click",Be,Pe),F("change",_,g),c(a,C),Et(),m()}export{Si as component};
