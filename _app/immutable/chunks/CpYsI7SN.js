import{Q as q,X as ue,a1 as P,T as F,av as de,Y as Ce,f as I,m as Ae,_ as Ie,$ as Re,a0 as se,a2 as U,U as H,ag as pe,aJ as Ne,an as re,K as Me,R as X,W as Oe,a4 as Le,ae as ie,aH as ve,i as He,aL as me,M as ge,O as Pe,aM as he,aN as Ue,aO as G,aD as Q,aP as De,aQ as $e,aG as Be,N as Je,aR as ye,q as _e,aS as qe,aT as We,j as Ge,Z as Ye,aU as ze,az as Ke,e as Ve,d as Xe,aV as Qe,au as Se,aW as je,a3 as O,aX as M,aY as Ze,C as et,G as tt,H as Y,J as $,I as B,F as at}from"./DyJ43TGI.js";import{b as st,f as be,a as L,s as rt,e as it,t as z}from"./BESELRjb.js";import{i as nt}from"./JMgyEzd3.js";import{s as lt,i as K,a as ot}from"./CCL4udNy.js";function Ht(e,t){return t}function ct(e,t,s){for(var a=[],n=t.length,i=0;i<n;i++)De(t[i].e,a,!0);$e(a,()=>{var r=a.length===0&&s!==null;if(r){var l=s,o=l.parentNode;Be(o),o.append(l),e.items.clear(),E(e,t[0].prev,t[n-1].next)}for(var f=0;f<n;f++){var u=t[f];r||(e.items.delete(u.k),E(e,u.prev,u.next)),Je(u.e,!r)}e.first===t[0]&&(e.first=t[0].prev)})}function ft(e,t,s,a,n,i=null){var r=e,l=new Map,o=null,f=(t&ye)!==0,u=(t&he)!==0,_=(t&me)!==0;if(f){var v=e;r=F?P(de(v)):v.appendChild(q())}F&&Ce();var p=null,h=Ae(()=>{var g=s();return He(g)?g:g==null?[]:ve(g)}),d,c=!0;function m(){ut(y,d,r,t,a),p!==null&&(d.length===0?(p.fragment?(r.before(p.fragment),p.fragment=null):ge(p.effect),S.first=p.effect):Pe(p.effect,()=>{p=null}))}var S=ue(()=>{d=I(h);var g=d.length;let x=!1;if(F){var C=Ie(r)===Re;C!==(g===0)&&(r=se(),P(r),U(!1),x=!0)}for(var b=new Set,T=Me,w=null,ee=Oe(),R=0;R<g;R+=1){F&&H.nodeType===pe&&H.data===Ne&&(r=H,x=!0,U(!1));var W=d[R],D=a(W,R),k=c?null:l.get(D);k?(u&&re(k.v,W),_?re(k.i,R):k.i=R,ee&&T.skipped_effects.delete(k.e)):(k=dt(c?r:null,w,W,D,R,n,t,s),c&&(k.o=!0,w===null?o=k:w.next=k,w=k),l.set(D,k)),b.add(D)}if(g===0&&i&&!p)if(c)p={fragment:null,effect:X(()=>i(r))};else{var te=document.createDocumentFragment(),ae=q();te.append(ae),p={fragment:te,effect:X(()=>i(ae))}}if(F&&g>0&&P(se()),!c)if(ee){for(const[Ee,xe]of l)b.has(Ee)||T.skipped_effects.add(xe.e);T.oncommit(m),T.ondiscard(()=>{})}else m();x&&U(!0),I(h)}),y={effect:S,items:l,first:o};c=!1,F&&(r=H)}function ut(e,t,s,a,n){var i=(a&qe)!==0,r=t.length,l=e.items,o=e.first,f,u=null,_,v=[],p=[],h,d,c,m;if(i)for(m=0;m<r;m+=1)h=t[m],d=n(h,m),c=l.get(d),c.a?.measure(),(_??=new Set).add(c);for(m=0;m<r;m+=1){if(h=t[m],d=n(h,m),c=l.get(d),e.first??=c,!c.o){c.o=!0;var S=u?u.next:o;E(e,u,c),E(e,c,S),V(c,S,s),u=c,v=[],p=[],o=u.next;continue}if((c.e.f&G)!==0&&(ge(c.e),i&&(c.a?.unfix(),(_??=new Set).delete(c))),c!==o){if(f!==void 0&&f.has(c)){if(v.length<p.length){var y=p[0],g;u=y.prev;var x=v[0],C=v[v.length-1];for(g=0;g<v.length;g+=1)V(v[g],y,s);for(g=0;g<p.length;g+=1)f.delete(p[g]);E(e,x.prev,C.next),E(e,u,x),E(e,C,y),o=y,u=C,m-=1,v=[],p=[]}else f.delete(c),V(c,o,s),E(e,c.prev,c.next),E(e,c,u===null?e.first:u.next),E(e,u,c),u=c;continue}for(v=[],p=[];o!==null&&o.k!==d;)(o.e.f&G)===0&&(f??=new Set).add(o),p.push(o),o=o.next;if(o===null)continue;c=o}v.push(c),u=c,o=c.next}if(o!==null||f!==void 0){for(var b=f===void 0?[]:ve(f);o!==null;)(o.e.f&G)===0&&b.push(o),o=o.next;var T=b.length;if(T>0){var w=(a&ye)!==0&&r===0?s:null;if(i){for(m=0;m<T;m+=1)b[m].a?.measure();for(m=0;m<T;m+=1)b[m].a?.fix()}ct(e,b,w)}}i&&_e(()=>{if(_!==void 0)for(c of _)c.a?.apply()})}function dt(e,t,s,a,n,i,r,l){var o=(r&he)!==0,f=(r&Ue)===0,u=o?f?Le(s,!1,!1):ie(s):s,_=(r&me)===0?n:ie(n),v={i:_,v:u,k:a,a:null,e:null,o:!1,prev:t,next:null};try{if(e===null){var p=document.createDocumentFragment();p.append(e=q())}return v.e=X(()=>i(e,u,_,l)),t!==null&&(t.next=v),v}finally{}}function V(e,t,s){for(var a=e.next?e.next.e.nodes_start:s,n=t?t.e.nodes_start:s,i=e.e.nodes_start;i!==null&&i!==a;){var r=Q(i);n.before(i),i=r}}function E(e,t,s){t===null?(e.first=s,e.effect.first=s&&s.e):(t.e.next&&(t.e.next.prev=null),t.next=s,t.e.next=s&&s.e),s===null?e.effect.last=t&&t.e:(s.e.prev&&(s.e.prev.next=null),s.prev=t,s.e.prev=t&&t.e)}function Pt(e,t){let s=null,a=F;var n;if(F){s=H;for(var i=de(document.head);i!==null&&(i.nodeType!==pe||i.data!==e);)i=Q(i);if(i===null)U(!1);else{var r=Q(i);i.remove(),P(r)}}F||(n=document.head.appendChild(q()));try{ue(()=>t(n),We)}finally{a&&(U(!0),P(s))}}function Te(e){var t,s,a="";if(typeof e=="string"||typeof e=="number")a+=e;else if(typeof e=="object")if(Array.isArray(e)){var n=e.length;for(t=0;t<n;t++)e[t]&&(s=Te(e[t]))&&(a&&(a+=" "),a+=s)}else for(s in e)e[s]&&(a&&(a+=" "),a+=s);return a}function pt(){for(var e,t,s=0,a="",n=arguments.length;s<n;s++)(e=arguments[s])&&(t=Te(e))&&(a&&(a+=" "),a+=t);return a}function Ut(e){return typeof e=="object"?pt(e):e??""}const ne=[...` 	
\r\f \v\uFEFF`];function vt(e,t,s){var a=e==null?"":""+e;if(t&&(a=a?a+" "+t:t),s){for(var n in s)if(s[n])a=a?a+" "+n:n;else if(a.length)for(var i=n.length,r=0;(r=a.indexOf(n,r))>=0;){var l=r+i;(r===0||ne.includes(a[r-1]))&&(l===a.length||ne.includes(a[l]))?a=(r===0?"":a.substring(0,r))+a.substring(l+1):r=l}}return a===""?null:a}function Dt(e,t){return e==null?null:String(e)}function mt(e,t,s,a,n,i){var r=e.__className;if(F||r!==s||r===void 0){var l=vt(s,a,i);(!F||l!==e.getAttribute("class"))&&(l==null?e.removeAttribute("class"):e.className=l),e.__className=s}else if(i&&n!==i)for(var o in i){var f=!!i[o];(n==null||f!==!!n[o])&&e.classList.toggle(o,f)}return i}const gt=()=>performance.now(),A={tick:e=>requestAnimationFrame(e),now:()=>gt(),tasks:new Set};function we(){const e=A.now();A.tasks.forEach(t=>{t.c(e)||(A.tasks.delete(t),t.f())}),A.tasks.size!==0&&A.tick(we)}function ht(e){let t;return A.tasks.size===0&&A.tick(we),{promise:new Promise(s=>{A.tasks.add(t={c:e,f:s})}),abort(){A.tasks.delete(t)}}}function J(e,t){Se(()=>{e.dispatchEvent(new CustomEvent(t))})}function yt(e){if(e==="float")return"cssFloat";if(e==="offset")return"cssOffset";if(e.startsWith("--"))return e;const t=e.split("-");return t.length===1?t[0]:t[0]+t.slice(1).map(s=>s[0].toUpperCase()+s.slice(1)).join("")}function le(e){const t={},s=e.split(";");for(const a of s){const[n,i]=a.split(":");if(!n||i===void 0)break;const r=yt(n.trim());t[r]=i.trim()}return t}const _t=e=>e;function St(e,t,s,a){var n=(e&Qe)!==0,i="both",r,l=t.inert,o=t.style.overflow,f,u;function _(){return Se(()=>r??=s()(t,a?.()??{},{direction:i}))}var v={is_global:n,in(){t.inert=l,J(t,"introstart"),f=j(t,_(),u,1,()=>{J(t,"introend"),f?.abort(),f=r=void 0,t.style.overflow=o})},out(c){t.inert=!0,J(t,"outrostart"),u=j(t,_(),f,0,()=>{J(t,"outroend"),c?.()})},stop:()=>{f?.abort(),u?.abort()}},p=Ge;if((p.transitions??=[]).push(v),st){var h=n;if(!h){for(var d=p.parent;d&&(d.f&Ye)!==0;)for(;(d=d.parent)&&(d.f&ze)===0;);h=!d||(d.f&Ke)!==0}h&&Ve(()=>{Xe(()=>v.in())})}}function j(e,t,s,a,n){var i=a===1;if(je(t)){var r,l=!1;return _e(()=>{if(!l){var c=t({direction:i?"in":"out"});r=j(e,c,s,a,n)}}),{abort:()=>{l=!0,r?.abort()},deactivate:()=>r.deactivate(),reset:()=>r.reset(),t:()=>r.t()}}if(s?.deactivate(),!t?.duration)return n(),{abort:O,deactivate:O,reset:O,t:()=>a};const{delay:o=0,css:f,tick:u,easing:_=_t}=t;var v=[];if(i&&s===void 0&&(u&&u(0,1),f)){var p=le(f(0,1));v.push(p,p)}var h=()=>1-a,d=e.animate(v,{duration:o,fill:"forwards"});return d.onfinish=()=>{d.cancel();var c=s?.t()??1-a;s?.abort();var m=a-c,S=t.duration*Math.abs(m),y=[];if(S>0){var g=!1;if(f)for(var x=Math.ceil(S/16.666666666666668),C=0;C<=x;C+=1){var b=c+m*_(C/x),T=le(f(b,1-b));y.push(T),g||=T.overflow==="hidden"}g&&(e.style.overflow="hidden"),h=()=>{var w=d.currentTime;return c+m*_(w/S)},u&&ht(()=>{if(d.playState!=="running")return!1;var w=h();return u(w,1-w),!0})}d=e.animate(y,{duration:S,fill:"forwards"}),d.onfinish=()=>{h=()=>a,u?.(a,1-a),n()}},{abort:()=>{d&&(d.cancel(),d.effect=null,d.onfinish=O)},deactivate:()=>{n=O},reset:()=>{a===0&&u?.(1,0)},t:()=>h()}}const bt={githyanki:{name:"Githyanki",traits:[{name:"Astral Knowledge",description:"Whenever you finish a long rest, you gain proficiency in one skill of your choice and with one weapon or tool of your choice, selected from the Player’s Handbook, as you momentarily project your consciousness into the Astral Plane. These proficiencies last until the end of your next long rest."},{name:"Psychic Resilience",description:"You have resistance to psychic damage.",resistances:["psychic"]},{name:"Githyanki Psionics",description:"You know the Mage Hand cantrip, and the hand is invisible when you cast the cantrip with this trait. When you reach 3rd level, you can cast the Jump spell once with this trait, and you regain the ability to do so when you finish a long rest. When you reach 5th level, you can cast the Misty Step spell once with this trait, and you regain the ability to do so when you finish a long rest. Intelligence is your spellcasting ability for these spells. When you cast them with this trait, they don't require components.",spells:[{name:"Mage Hand",level:0,minCharacterLevel:1,notes:"The hand is invisible when cast with this trait"},{name:"Jump",level:1,minCharacterLevel:3,usesPerRest:1,restType:"long"},{name:"Misty Step",level:2,minCharacterLevel:5,usesPerRest:1,restType:"long"}],spellcastingAbility:"intelligence",componentsRequired:!1}]}};function ke(e){const t=e.toLowerCase().trim();return bt[t]||null}function Fe(e,t){const s=ke(e);if(!s)return[];const a=[];return s.traits.forEach(n=>{n.spells&&n.spells.forEach(i=>{t>=i.minCharacterLevel&&a.push(i)})}),a}function Tt(){const{subscribe:e,update:t}=M([]);let s=0;return{subscribe:e,add:(a,n="info",i=3e3)=>{const r=s++,l={id:r,message:a,type:n,duration:i};t(o=>[...o,l]),i>0&&setTimeout(()=>{t(o=>o.filter(f=>f.id!==r))},i)},remove:a=>{t(n=>n.filter(i=>i.id!==a))},clear:()=>{t(()=>[])}}}const oe=Tt();function wt(){const e=()=>{{const l=localStorage.getItem("dnd_roll_history");if(l)try{return JSON.parse(l)}catch(o){console.error("Failed to parse roll history from localStorage:",o)}}return[]},{subscribe:t,update:s,set:a}=M(e());let n=0;const i=e();i.length>0&&(n=Math.max(...i.map(l=>l.id))+1);const r=l=>{localStorage.setItem("dnd_roll_history",JSON.stringify(l))};return{subscribe:t,addRoll:(l,o,f,u)=>{const v={id:n++,timestamp:Date.now(),purpose:l,notation:o,result:f,breakdown:u};s(p=>{const h=[v,...p].slice(0,50);return r(h),h})},clear:()=>{a([]),r([])},import:l=>{l.length>0&&(n=Math.max(...l.map(o=>o.id))+1),a(l),r(l)},export:()=>{let l=[];return t(f=>{l=f})(),l}}}const $t=wt(),Z={name:"",class:"",subclass:"",level:1,race:"",background:"",alignment:"",armorClass:10,initiative:0,speed:"30 ft",currentHP:0,maxHP:0,tempHP:0,hitDice:{current:3,max:3},abilities:{strength:10,dexterity:10,constitution:10,intelligence:10,wisdom:10,charisma:10},proficiencyBonus:2,saveProficiencies:{strength:!1,dexterity:!1,constitution:!1,intelligence:!1,wisdom:!1,charisma:!1},skillProficiencies:{acrobatics:!1,animalHandling:!1,arcana:!1,athletics:!1,deception:!1,history:!1,insight:!1,intimidation:!1,investigation:!1,medicine:!1,nature:!1,perception:!1,performance:!1,persuasion:!1,religion:!1,sleightOfHand:!1,stealth:!1,survival:!1},attacks:[],features:"",equipment:"",notes:"",classFeatures:{features:{},spellSlots:[],spellSlotsByLevel:{},preparedSpells:""},racialTraits:{uses:{}}};function kt(){try{const e=localStorage.getItem("dndCharacter");if(e){const t={...Z,...JSON.parse(e)};return!t.attacks||!Array.isArray(t.attacks)?t.attacks=[]:t.attacks=t.attacks.map(s=>({...s,id:s.id||crypto.randomUUID()})),t.classFeatures?(t.classFeatures.features||(t.classFeatures.features={}),t.classFeatures.spellSlots||(t.classFeatures.spellSlots=[]),t.classFeatures.spellSlotsByLevel||(t.classFeatures.spellSlotsByLevel={}),t.classFeatures.preparedSpells===void 0&&(t.classFeatures.preparedSpells="")):t.classFeatures={features:{},spellSlots:[],spellSlotsByLevel:{},preparedSpells:""},t.racialTraits||(t.racialTraits={uses:{}}),t}}catch(e){console.error("Failed to load character from storage:",e)}return Z}const N=M(kt());N.subscribe(e=>{try{localStorage.setItem("dndCharacter",JSON.stringify(e))}catch(t){console.error("Failed to save character to storage:",t)}});const ce=M(!0);{const e=localStorage.getItem("dndMode");ce.set(e==="edit"),ce.subscribe(t=>{localStorage.setItem("dndMode",t?"edit":"use")})}const Bt=Ze(N,e=>{const t=s=>Math.floor((s-10)/2);return{strength:t(e.abilities.strength),dexterity:t(e.abilities.dexterity),constitution:t(e.abilities.constitution),intelligence:t(e.abilities.intelligence),wisdom:t(e.abilities.wisdom),charisma:t(e.abilities.charisma)}});function Ft(e){return Math.ceil(e/4)+1}function Jt(){N.update(e=>(e.proficiencyBonus=Ft(e.level),e))}function qt(e){const t=JSON.stringify(e,null,2),s="data:application/json;charset=utf-8,"+encodeURIComponent(t),a=`${e.name||"character"}_${new Date().toISOString().split("T")[0]}.json`,n=document.createElement("a");n.setAttribute("href",s),n.setAttribute("download",a),n.click()}function Wt(e){return new Promise((t,s)=>{const a=new FileReader;a.onload=n=>{try{const i=JSON.parse(n.target?.result),r={...Z,...i};r.attacks&&Array.isArray(r.attacks)&&(r.attacks=r.attacks.map(l=>({...l,id:l.id||crypto.randomUUID()}))),r.classFeatures?(r.classFeatures.features||(r.classFeatures.features={}),r.classFeatures.spellSlots||(r.classFeatures.spellSlots=[]),r.classFeatures.spellSlotsByLevel||(r.classFeatures.spellSlotsByLevel={}),r.classFeatures.preparedSpells===void 0&&(r.classFeatures.preparedSpells="")):r.classFeatures={features:{},spellSlots:[],spellSlotsByLevel:{},preparedSpells:""},r.racialTraits||(r.racialTraits={uses:{}}),t(r)}catch{s(new Error("Invalid character file"))}},a.onerror=()=>s(new Error("Failed to read file")),a.readAsText(e)})}function Gt(){N.update(e=>(e.racialTraits||(e.racialTraits={uses:{}}),e.racialTraits||(e.racialTraits={uses:{}}),e.racialTraits.uses||(e.racialTraits.uses={}),Fe(e.race,e.level).forEach(s=>{if(s.usesPerRest!==void 0&&s.restType){const a=s.name;e.racialTraits.uses[a]?e.racialTraits.uses[a].maxUses=s.usesPerRest:e.racialTraits.uses[a]={currentUses:s.usesPerRest,maxUses:s.usesPerRest,restType:s.restType}}}),e))}function Yt(e){N.update(t=>(t.racialTraits&&Object.keys(t.racialTraits.uses).forEach(s=>{const a=t.racialTraits.uses[s];(a.restType===e||e==="long"&&a.restType==="short")&&(a.currentUses=a.maxUses)}),t))}function zt(e){N.update(t=>{if(!t.racialTraits||!t.racialTraits.uses[e])return t;const s=t.racialTraits.uses[e];return s.currentUses>0&&(s.currentUses-=1),t})}function Kt(){N.update(e=>{if(!e.race)return e;const t=ke(e.race);if(!t)return e;const s=Fe(e.race,e.level);return e.attacks||(e.attacks=[]),e.attacks=e.attacks.filter(a=>a.source!=="racial"?!0:s.some(n=>n.name===a.name)),s.forEach(a=>{if(!e.attacks.find(i=>i.source==="racial"&&i.name===a.name)){let i="";for(const l of t.traits)if(l.spells&&l.spells.some(o=>o.name===a.name)){i=l.name;break}const r={id:`racial-${a.name.toLowerCase().replace(/\s+/g,"-")}-${Date.now()}`,name:a.name,bonus:0,damage:"",damageType:"",spellRef:a.name,source:"racial",racialTraitName:i,infoNotes:a.notes||"",notes:a.notes||""};e.attacks.push(r)}}),e})}const Vt=M("");function Et(){try{const e=localStorage.getItem("dndCollapsedStates");if(e){const t=JSON.parse(e);return{characterInfo:t.characterInfo??!1,combatStats:t.combatStats??!1,abilityScores:t.abilityScores??!1,skills:t.skills??!1,attacks:t.attacks??!1,classFeatures:t.classFeatures??!1,notes:t.notes??!1,damageInput:t.damageInput??!1}}}catch(e){console.error("Failed to load collapsed states:",e)}return{characterInfo:!1,combatStats:!1,abilityScores:!1,skills:!1,attacks:!1,classFeatures:!1,notes:!1,damageInput:!1}}const xt=M(Et());xt.subscribe(e=>{try{localStorage.setItem("dndCollapsedStates",JSON.stringify(e))}catch(t){console.error("Failed to save collapsed states:",t)}});function Ct(e){const t=e-1;return t*t*t+1}function fe(e){const t=typeof e=="string"&&e.match(/^\s*(-?[\d.]+)([^\s]*)\s*$/);return t?[parseFloat(t[1]),t[2]||"px"]:[e,"px"]}function At(e,{delay:t=0,duration:s=400,easing:a=Ct,x:n=0,y:i=0,opacity:r=0}={}){const l=getComputedStyle(e),o=+l.opacity,f=l.transform==="none"?"":l.transform,u=o*(1-r),[_,v]=fe(n),[p,h]=fe(i);return{delay:t,duration:s,easing:a,css:(d,c)=>`
			transform: ${f} translate(${(1-d)*_}${v}, ${(1-d)*p}${h});
			opacity: ${o-u*c}`}}var It=be('<div><span class="toast-icon svelte-1cpok13"><!> <!> <!></span> <span class="toast-message svelte-1cpok13"> </span> <button class="toast-close svelte-1cpok13" aria-label="Close notification">×</button></div>'),Rt=be('<div class="toast-container svelte-1cpok13"></div>');function Xt(e,t){et(t,!1);const s=()=>ot(oe,"$toasts",a),[a,n]=lt();nt();var i=Rt();ft(i,5,s,r=>r.id,(r,l)=>{var o=It(),f=Y(o),u=Y(f);{var _=y=>{var g=z("✓");L(y,g)};K(u,y=>{I(l).type==="success"&&y(_)})}var v=$(u,2);{var p=y=>{var g=z("✕");L(y,g)};K(v,y=>{I(l).type==="error"&&y(p)})}var h=$(v,2);{var d=y=>{var g=z("ℹ");L(y,g)};K(h,y=>{I(l).type==="info"&&y(d)})}B(f);var c=$(f,2),m=Y(c,!0);B(c);var S=$(c,2);B(o),at(()=>{mt(o,1,`toast toast-${I(l).type??""}`,"svelte-1cpok13"),rt(m,I(l).message)}),it("click",S,()=>oe.remove(I(l).id)),St(3,o,()=>At,()=>({y:-50,duration:300})),L(r,o)}),B(i),L(e,i),tt(),n()}export{Xt as T,N as a,mt as b,xt as c,Bt as d,ft as e,ce as f,ke as g,Pt as h,Ht as i,Ut as j,oe as k,zt as l,Gt as m,Kt as n,qt as o,Wt as p,Yt as q,$t as r,Vt as s,Dt as t,Jt as u,Fe as v};
