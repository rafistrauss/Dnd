import{d as gs,g as Is,f as d,e as P,a as n,s as x,c as ot,t as jt}from"../chunks/BESELRjb.js";import{i as Gt}from"../chunks/JMgyEzd3.js";import{c as ba,o as Sa,a as Es,b as Hs}from"../chunks/CtPH092J.js";import{F as $,T as ua,Y as rs,j as Ns,aZ as Os,U as ms,ag as Gs,aD as qs,aK as Ws,aE as zs,a1 as Js,av as Na,a7 as vs,i as Ds,a_ as Ks,a$ as Ls,b0 as Va,K as _a,e as js,b1 as As,b2 as Vs,b3 as Ys,b4 as Qs,q as ns,b5 as Xs,b6 as Zs,ab as el,d as i,r as ds,g as tl,C as qt,G as Wt,H as l,I as a,J as s,b7 as et,b8 as aa,s as o,a4 as D,f as e,m as xt,E as Be,b9 as Ot,ao as Yt,A as B,ba as pa,bb as xa,bc as al}from"../chunks/DyJ43TGI.js";import{t as sl,c as De,a as Qt,e as kt,i as $t,u as Ts,s as ma,b as At,d as Fa,f as ya,g as ll,j as It,h as il,T as rl,k as nl,l as ol}from"../chunks/DVhE65zf.js";import{i as g,s as sa,a as pt,b as Mt,d as ja,e as cl}from"../chunks/CCL4udNy.js";import{p as vt,b as Ba}from"../chunks/iXw84bXb.js";import{b as Aa,r as vl}from"../chunks/BN_sazak.js";function dl(r,c,t=!1,v=!1,u=!1){var f=r,m="";$(()=>{var R=Ns;if(m===(m=c()??"")){ua&&rs();return}if(R.nodes_start!==null&&(Os(R.nodes_start,R.nodes_end),R.nodes_start=R.nodes_end=null),m!==""){if(ua){ms.data;for(var y=rs(),k=y;y!==null&&(y.nodeType!==Gs||y.data!=="");)k=y,y=qs(y);if(y===null)throw Ws(),zs;gs(ms,k),f=Js(y);return}var se=m+"";t?se=`<svg>${se}</svg>`:v&&(se=`<math>${se}</math>`);var E=Is(se);if((t||v)&&(E=Na(E)),gs(Na(E),E.lastChild),t||v)for(;Na(E);)f.before(Na(E));else f.before(E)}})}function ul(r,c,t,v,u){ua&&rs();var f=c.$$slots?.[t],m=!1;f===!0&&(f=c[t],m=!0),f===void 0?u!==null&&u(r):f(r,m?()=>v:v)}function fl(r,c,t,v){var u=r.__style;if(ua||u!==c){var f=sl(c);(!ua||f!==r.getAttribute("style"))&&(f==null?r.removeAttribute("style"):r.style.cssText=f),r.__style=c}return v}function Pa(r,c,t=!1){if(r.multiple){if(c==null)return;if(!Ds(c))return Ks();for(var v of r.options)v.selected=c.includes(Ra(v));return}for(v of r.options){var u=Ra(v);if(Ls(u,c)){v.selected=!0;return}}(!t||c!==void 0)&&(r.selectedIndex=-1)}function Ja(r){var c=new MutationObserver(()=>{Pa(r,r.__value)});c.observe(r,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),vs(()=>{c.disconnect()})}function Ma(r,c,t=c){var v=new WeakSet,u=!0;Va(r,"change",f=>{var m=f?"[selected]":":checked",R;if(r.multiple)R=[].map.call(r.querySelectorAll(m),Ra);else{var y=r.querySelector(m)??r.querySelector("option:not([disabled])");R=y&&Ra(y)}t(R),_a!==null&&v.add(_a)}),js(()=>{var f=c();if(r===document.activeElement){var m=As??_a;if(v.has(m))return}if(Pa(r,f,u),u&&f===void 0){var R=r.querySelector(":checked");R!==null&&(f=Ra(R),t(f))}r.__value=f,u=!1}),Ja(r)}function Ra(r){return"__value"in r?r.__value:r.value}const pl=Symbol("is custom element"),gl=Symbol("is html");function Fe(r){if(ua){var c=!1,t=()=>{if(!c){if(c=!0,r.hasAttribute("value")){var v=r.value;rt(r,"value",null),r.value=v}if(r.hasAttribute("checked")){var u=r.checked;rt(r,"checked",null),r.checked=u}}};r.__on_r=t,ns(t),Xs()}}function ka(r,c){var t=us(r);t.value===(t.value=c??void 0)||r.value===c&&(c!==0||r.nodeName!=="PROGRESS")||(r.value=c??"")}function Rs(r,c){var t=us(r);t.checked!==(t.checked=c??void 0)&&(r.checked=c)}function rt(r,c,t,v){var u=us(r);ua&&(u[c]=r.getAttribute(c),c==="src"||c==="srcset"||c==="href"&&r.nodeName==="LINK")||u[c]!==(u[c]=t)&&(c==="loading"&&(r[Vs]=t),t==null?r.removeAttribute(c):typeof t!="string"&&ml(r).includes(c)?r[c]=t:r.setAttribute(c,t))}function us(r){return r.__attributes??={[pl]:r.nodeName.includes("-"),[gl]:r.namespaceURI===Ys}}var bs=new Map;function ml(r){var c=r.getAttribute("is")||r.nodeName,t=bs.get(c);if(t)return t;bs.set(c,t=[]);for(var v,u=r,f=Element.prototype;f!==u;){v=Zs(u);for(var m in v)v[m].set&&t.push(m);u=Qs(u)}return t}function Qe(r,c,t=c){var v=new WeakSet;Va(r,"input",async u=>{var f=u?r.defaultValue:r.value;if(f=ts(r)?as(f):f,t(f),_a!==null&&v.add(_a),await el(),f!==(f=c())){var m=r.selectionStart,R=r.selectionEnd,y=r.value.length;if(r.value=f??"",R!==null){var k=r.value.length;m===R&&R===y&&k>y?(r.selectionStart=k,r.selectionEnd=k):(r.selectionStart=m,r.selectionEnd=Math.min(R,k))}}}),(ua&&r.defaultValue!==r.value||i(c)==null&&r.value)&&(t(ts(r)?as(r.value):r.value),_a!==null&&v.add(_a)),ds(()=>{var u=c();if(r===document.activeElement){var f=As??_a;if(v.has(f))return}ts(r)&&u===as(r.value)||r.type==="date"&&!u&&!r.value||u!==r.value&&(r.value=u??"")})}const es=new Set;function Ka(r,c,t,v,u=v){var f=t.getAttribute("type")==="checkbox",m=r;let R=!1;if(c!==null)for(var y of c)m=m[y]??=[];m.push(t),Va(t,"change",()=>{var k=t.__value;f&&(k=hs(m,k,t.checked)),u(k)},()=>u(f?[]:null)),ds(()=>{var k=v();if(ua&&t.defaultChecked!==t.checked){R=!0;return}f?(k=k||[],t.checked=k.includes(t.__value)):t.checked=Ls(t.__value,k)}),vs(()=>{var k=m.indexOf(t);k!==-1&&m.splice(k,1)}),es.has(m)||(es.add(m),ns(()=>{m.sort((k,se)=>k.compareDocumentPosition(se)===4?-1:1),es.delete(m)})),ns(()=>{if(R){var k;if(f)k=hs(m,k,t.checked);else{var se=m.find(E=>E.checked);k=se?.__value}u(k)}})}function ga(r,c,t=c){Va(r,"change",v=>{var u=v?r.defaultChecked:r.checked;t(u)}),(ua&&r.defaultChecked!==r.checked||i(c)==null)&&t(r.checked),ds(()=>{var v=c();r.checked=!!v})}function hs(r,c,t){for(var v=new Set,u=0;u<r.length;u+=1)r[u].checked&&v.add(r[u].__value);return t||v.delete(c),Array.from(v)}function ts(r){var c=r.type;return c==="number"||c==="range"}function as(r){return r===""?null:+r}function bl(r,c,t){var v=tl(r,c);v&&v.set&&(r[c]=t,vs(()=>{r[c]=null}))}function fs(r){return function(...c){var t=c[0];return t.stopPropagation(),r?.apply(this,c)}}function $a(r,c){var t=r.$$events?.[c.type],v=Ds(t)?t.slice():t==null?[]:[t];for(var u of v)u.call(this,c)}const hl="";function Bs(...r){return Aa+hl+vl(r[0],r[1])}const os={paladin:{name:"Paladin",hitDice:"d10",spellcaster:!0,spellcastingAbility:"charisma",spellSlotsByLevel:{1:0,2:2,3:3,4:3,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Divine Sense",type:"uses",maxUses:(r,c=1)=>1+Math.max(1,c),resetOn:"long",description:"Detect celestials, fiends, and undead within 60 feet",minLevel:1},{name:"Lay on Hands",type:"pool",maxPool:r=>r*5,resetOn:"long",description:"Heal wounds or cure disease",minLevel:1},{name:"Divine Smite",type:"spellSlot",description:"Expend spell slot to deal extra radiant damage",minLevel:2,rollable:!0},{name:"Channel Divinity",type:"pool",maxPool:r=>r>=18?3:r>=6?2:1,resetOn:"short",description:"Sacred Weapon or Turn Undead",minLevel:3}]},fighter:{name:"Fighter",hitDice:"d10",spellcaster:!1,features:[{name:"Second Wind",type:"uses",maxUses:1,resetOn:"short",description:"Regain 1d10 + fighter level HP as bonus action",minLevel:1,rollable:!0,rollFormula:r=>`1d10+${r}`},{name:"Action Surge",type:"uses",maxUses:r=>r>=17?2:1,resetOn:"short",description:"Take one additional action on your turn",minLevel:2},{name:"Indomitable",type:"uses",maxUses:r=>r>=17?3:r>=13?2:1,resetOn:"long",description:"Reroll a failed saving throw",minLevel:9}],subclasses:{champion:{name:"Champion",features:[{name:"Improved Critical",type:"info",description:"Critical hit on 19-20",minLevel:3},{name:"Remarkable Athlete",type:"info",description:"Add half proficiency to STR/DEX/CON checks, increase long jump distance",minLevel:7},{name:"Additional Fighting Style",type:"info",description:"Choose a second fighting style",minLevel:10},{name:"Superior Critical",type:"info",description:"Critical hit on 18-20",minLevel:15},{name:"Survivor",type:"info",description:"Regain 5 + CON mod HP at start of turn if below half HP",minLevel:18}]},battlemaster:{name:"Battle Master",features:[{name:"Combat Superiority",type:"uses",maxUses:r=>r>=15?6:r>=7?5:4,resetOn:"short",description:r=>`Use superiority dice (${r>=18?"d12":r>=10?"d10":"d8"}) for maneuvers`,minLevel:3},{name:"Know Your Enemy",type:"info",description:"Learn capabilities of creatures you observe",minLevel:7},{name:"Improved Combat Superiority",type:"info",description:"Superiority dice become d10",minLevel:10},{name:"Relentless",type:"info",description:"Regain 1 superiority die if you have none at start of turn",minLevel:15}]}}},rogue:{name:"Rogue",hitDice:"d8",spellcaster:!1,features:[{name:"Sneak Attack",type:"info",description:r=>`Deal ${Math.ceil(r/2)}d6 extra damage once per turn with advantage or ally nearby`,minLevel:1,rollable:!0,rollFormula:r=>`${Math.ceil(r/2)}d6`},{name:"Cunning Action",type:"info",description:"Dash, Disengage, or Hide as a bonus action",minLevel:2},{name:"Uncanny Dodge",type:"info",description:"Use reaction to halve damage from an attack",minLevel:5},{name:"Evasion",type:"info",description:"Take no damage on successful Dex save (half on fail)",minLevel:7}]},wizard:{name:"Wizard",hitDice:"d6",spellcaster:!0,spellcastingAbility:"intelligence",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Arcane Recovery",type:"uses",maxUses:1,resetOn:"long",description:r=>`Recover spell slots totaling up to ${Math.ceil(r/2)} levels during short rest`,minLevel:1},{name:"Spell Mastery",type:"info",description:"Cast one 1st-level and one 2nd-level spell at will",minLevel:18}]},cleric:{name:"Cleric",hitDice:"d8",spellcaster:!0,spellcastingAbility:"wisdom",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Channel Divinity",type:"pool",maxPool:r=>r>=18?3:r>=6?2:1,resetOn:"short",description:"Turn Undead or domain-specific ability",minLevel:2},{name:"Destroy Undead",type:"info",description:r=>`Channel Divinity destroys undead of CR ${r>=17?4:r>=14?3:r>=11?2:r>=8?1:.5} or lower`,minLevel:5},{name:"Divine Intervention",type:"uses",maxUses:1,resetOn:"long",description:r=>`${r}% chance to succeed, implore deity for aid`,minLevel:10}],subclasses:{war:{name:"War Domain",features:[{name:"War Priest",type:"uses",maxUses:(r,c=1)=>Math.max(1,c),resetOn:"long",description:"Make one weapon attack as a bonus action",minLevel:1},{name:"Guided Strike",type:"channelDivinity",description:"Use your Channel Divinity to gain +10 to an attack roll. Make this choice after you see the roll, but before the DM says whether the attack hits or misses.",minLevel:2,resetOn:"short"},{name:"War God's Blessing",type:"channelDivinity",description:"Use reaction to grant +10 to an ally's attack roll within 30 feet. Consumes one use of Channel Divinity.",minLevel:6,resetOn:"short"},{name:"Divine Strike",type:"info",description:r=>`Deal extra ${r>=14?"2d8":"1d8"} weapon damage once per turn`,minLevel:8,rollable:!0,rollFormula:r=>r>=14?"2d8":"1d8"},{name:"Avatar of Battle",type:"info",description:"Gain resistance to nonmagical weapon damage",minLevel:17}]},life:{name:"Life Domain",features:[{name:"Disciple of Life",type:"info",description:"Healing spells restore additional 2 + spell level HP",minLevel:1},{name:"Preserve Life",type:"pool",maxPool:r=>r*5,resetOn:"short",description:"Restore HP to creatures within 30 feet",minLevel:2},{name:"Blessed Healer",type:"info",description:"Regain 2 + spell level HP when you cast healing spell",minLevel:6},{name:"Divine Strike",type:"info",description:r=>`Deal extra ${r>=14?"2d8":"1d8"} radiant damage once per turn`,minLevel:8,rollable:!0,rollFormula:r=>r>=14?"2d8":"1d8"},{name:"Supreme Healing",type:"info",description:"Maximize healing dice instead of rolling",minLevel:17}]}}},barbarian:{name:"Barbarian",hitDice:"d12",spellcaster:!1,features:[{name:"Rage",type:"uses",maxUses:r=>r>=20?1/0:r>=17?6:r>=12?5:r>=6?4:r>=3?3:2,resetOn:"long",description:r=>`+${r>=16?4:r>=9?3:2} damage, resistance to physical damage`,minLevel:1},{name:"Reckless Attack",type:"info",description:"Gain advantage on melee attacks, enemies get advantage on you",minLevel:2},{name:"Danger Sense",type:"info",description:"Advantage on Dex saves against effects you can see",minLevel:2}],subclasses:{berserker:{name:"Path of the Berserker",features:[{name:"Frenzy",type:"info",description:"While raging, make melee attack as bonus action (gain 1 exhaustion after rage)",minLevel:3},{name:"Mindless Rage",type:"info",description:"Cannot be charmed or frightened while raging",minLevel:6},{name:"Intimidating Presence",type:"info",description:"Use action to frighten creature within 30 feet",minLevel:10},{name:"Retaliation",type:"info",description:"When damaged by creature within 5 feet, make melee attack as reaction",minLevel:14}]}}}};function na(r){const c=r.toLowerCase();return os[c]||null}function Ca(r,c,t){const v=na(r);if(!v)return[];const u=v.features.filter(f=>!f.minLevel||f.minLevel<=c);if(t&&v.subclasses&&v.subclasses[t]){const f=v.subclasses[t].features.filter(m=>!m.minLevel||m.minLevel<=c);return[...u,...f]}return u}function _s(r){const c=na(r);return!c||!c.subclasses?[]:Object.keys(c.subclasses).map(t=>({id:t,name:c.subclasses[t].name}))}function ys(r,c){const t=na(r);return!t||!t.spellcaster||!t.spellSlotsByLevel?0:t.spellSlotsByLevel[c]||0}function xs(r,c,t){const v=na(r);return!v||!v.spellcaster?0:Math.max(1,t+c)}function _l(r,c,t){const v=na(r);return!v||!v.spellcaster?null:8+c+t}function yl(){return Object.keys(os).map(r=>({id:r,name:os[r].name}))}const xl={githyanki:{name:"Githyanki",traits:[{name:"Githyanki Psionics",description:"You know the Mage Hand cantrip, and the hand is invisible when you cast the cantrip with this trait. When you reach 3rd level, you can cast the Jump spell once with this trait, and you regain the ability to do so when you finish a long rest. When you reach 5th level, you can cast the Misty Step spell once with this trait, and you regain the ability to do so when you finish a long rest. Intelligence is your spellcasting ability for these spells. When you cast them with this trait, they don't require components.",castingAbility:"intelligence",requiresComponents:!1,usesPerRest:1,restType:"long",currentUses:1,spells:[{spellName:"Mage Hand",minLevel:1,usesPerRest:"at-will",specialNotes:"The hand is invisible",consumesTraitUse:!1},{spellName:"Jump",minLevel:3,specialNotes:"Shares use with Misty Step",consumesTraitUse:!0},{spellName:"Misty Step",minLevel:5,specialNotes:"Shares use with Jump",consumesTraitUse:!0}]}]}};function Sl(r){if(!r)return null;const c=r.toLowerCase().trim();return xl[c]||null}function Ss(r,c){const t=Sl(r);return t?t.traits.map(v=>({...v,spells:v.spells.filter(u=>c>=u.minLevel)})):[]}function ss(r){return console.log("initializeRacialTraitUses called with:",r),r.map(c=>({...c,currentUses:c.usesPerRest!==void 0?c.usesPerRest:c.currentUses??0,spells:c.spells.map(t=>({...t,currentUses:t.usesPerRest==="at-will"||t.consumesTraitUse?void 0:t.usesPerRest!==void 0?t.usesPerRest:t.currentUses??0}))}))}function ws(r,c){console.log("resetRacialTraitUses called with:",{traits:r,restType:c});const t=r.map(v=>{let u={...v};return console.log("Processing trait:",v.name,"usesPerRest:",v.usesPerRest,"restType:",v.restType),v.usesPerRest!==void 0&&v.restType&&(v.restType===c||c==="long"&&v.restType==="short")&&(u.currentUses=v.usesPerRest,console.log("Reset trait uses to:",v.usesPerRest)),u.spells=v.spells.map(f=>f.usesPerRest==="at-will"||f.consumesTraitUse?f:f.restType===c||c==="long"&&f.restType==="short"?{...f,currentUses:f.usesPerRest}:f),u});return console.log("resetRacialTraitUses result:",t),t}var wl=d('<div class="section-header svelte-ls99y2" role="button" tabindex="0"><h2 class="svelte-ls99y2"> </h2> <span class="collapse-btn svelte-ls99y2"> </span></div>');function ha(r,c){qt(c,!1);let t=vt(c,"title",8),v=vt(c,"collapsed",8),u=vt(c,"ariaLabel",8,""),f=vt(c,"onToggle",8);Gt();var m=wl(),R=l(m),y=l(R,!0);a(R);var k=s(R,2),se=l(k,!0);a(k),a(m),$(()=>{rt(m,"aria-expanded",!v()),rt(m,"aria-label",u()),x(y,t()),x(se,v()?"‚ñº":"‚ñ≤")}),P("click",m,function(...E){f()?.apply(this,E)}),P("keydown",m,E=>{(E.key==="Enter"||E.key===" ")&&f()()}),n(r,m),Wt()}var kl=d("<option> </option>"),$l=d("<option> </option>"),Cl=d('<div class="form-group svelte-172i2fj"><label for="characterSubclass" class="svelte-172i2fj">Subclass</label> <select id="characterSubclass" class="svelte-172i2fj"><option>Select Subclass</option><!></select></div>'),Dl=d('<div class="info-grid svelte-172i2fj"><div class="form-group svelte-172i2fj"><label for="characterName" class="svelte-172i2fj">Character Name</label> <input type="text" id="characterName" placeholder="Enter name" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterClass" class="svelte-172i2fj">Class</label> <select id="characterClass" class="svelte-172i2fj"><option>Select Class</option><!></select></div> <!> <div class="form-group svelte-172i2fj"><label for="characterLevel" class="svelte-172i2fj">Level</label> <input type="number" id="characterLevel" min="1" max="20" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterRace" class="svelte-172i2fj">Race</label> <input type="text" id="characterRace" placeholder="e.g., Human" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterBackground" class="svelte-172i2fj">Background</label> <input type="text" id="characterBackground" placeholder="e.g., Soldier" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterAlignment" class="svelte-172i2fj">Alignment</label> <input type="text" id="characterAlignment" placeholder="e.g., Lawful Good" class="svelte-172i2fj"/></div></div>'),Ll=d('<section class="character-info svelte-172i2fj"><!> <!></section>');function jl(r,c){qt(c,!1);const t=()=>pt(De,"$character",u),v=()=>pt(Qt,"$collapsedStates",u),[u,f]=sa(),m=D(),R=yl();function y(ue){const H=ue.target;De.update(z=>(z.class=H.value,z.subclass="",z))}function k(ue){const H=ue.target;De.update(z=>(z.subclass=H.value,z))}function se(ue){const H=ue.target;De.update(z=>(z.level=parseInt(H.value)||1,z)),Ts()}et(()=>(t(),_s),()=>{o(m,t().class?_s(t().class):[])}),aa(),Gt();var E=Ll(),L=l(E);{let ue=xt(()=>(v(),i(()=>v().characterInfo?"Expand":"Collapse")));ha(L,{title:"Character Info",get collapsed(){return v(),i(()=>v().characterInfo)},get ariaLabel(){return e(ue)},onToggle:()=>Qt.update(H=>({...H,characterInfo:!H.characterInfo}))})}var oe=s(L,2);{var be=ue=>{var H=Dl(),z=l(H),Te=s(l(z),2);Fe(Te),a(z);var Ne=s(z,2),Xe=s(l(Ne),2),ce=l(Xe);ce.value=ce.__value="";var Ge=s(ce);kt(Ge,1,()=>R,$t,(Ee,he)=>{var Le=kl(),Oe=l(Le,!0);a(Le);var Ke={};$(()=>{x(Oe,(e(he),i(()=>e(he).name))),Ke!==(Ke=(e(he),i(()=>e(he).id)))&&(Le.value=(Le.__value=(e(he),i(()=>e(he).id)))??"")}),n(Ee,Le)}),a(Xe);var O;Ja(Xe),a(Ne);var J=s(Ne,2);{var ee=Ee=>{var he=Cl(),Le=s(l(he),2),Oe=l(Le);Oe.value=Oe.__value="";var Ke=s(Oe);kt(Ke,1,()=>e(m),$t,(gt,dt)=>{var at=$l(),j=l(at,!0);a(at);var N={};$(()=>{x(j,(e(dt),i(()=>e(dt).name))),N!==(N=(e(dt),i(()=>e(dt).id)))&&(at.value=(at.__value=(e(dt),i(()=>e(dt).id)))??"")}),n(gt,at)}),a(Le);var nt;Ja(Le),a(he),$(()=>{nt!==(nt=(t(),i(()=>t().subclass)))&&(Le.value=(Le.__value=(t(),i(()=>t().subclass)))??"",Pa(Le,(t(),i(()=>t().subclass))))}),P("change",Le,k),n(Ee,he)};g(J,Ee=>{e(m),i(()=>e(m).length>0)&&Ee(ee)})}var C=s(J,2),T=s(l(C),2);Fe(T),a(C);var S=s(C,2),K=s(l(S),2);Fe(K),a(S);var b=s(S,2),w=s(l(b),2);Fe(w),a(b);var pe=s(b,2),qe=s(l(pe),2);Fe(qe),a(pe),a(H),$(()=>{O!==(O=(t(),i(()=>t().class)))&&(Xe.value=(Xe.__value=(t(),i(()=>t().class)))??"",Pa(Xe,(t(),i(()=>t().class)))),ka(T,(t(),i(()=>t().level)))}),Qe(Te,()=>t().name,Ee=>Mt(De,i(t).name=Ee,i(t))),P("change",Xe,y),P("change",T,se),Qe(K,()=>t().race,Ee=>Mt(De,i(t).race=Ee,i(t))),Qe(w,()=>t().background,Ee=>Mt(De,i(t).background=Ee,i(t))),Qe(qe,()=>t().alignment,Ee=>Mt(De,i(t).alignment=Ee,i(t))),n(ue,H)};g(oe,ue=>{v(),i(()=>!v().characterInfo)&&ue(be)})}a(E),n(r,E),Wt(),f()}var Al=d('<div class="ability-card svelte-bbv1xt"><h3 class="svelte-bbv1xt"> </h3> <input type="number" class="ability-score svelte-bbv1xt" min="1" max="30"/> <div class="ability-modifier svelte-bbv1xt"> </div> <div class="roll-buttons svelte-bbv1xt"><button class="roll-btn svelte-bbv1xt">Check</button> <button class="roll-btn svelte-bbv1xt">Save</button></div> <div class="save-proficiency svelte-bbv1xt"><input type="checkbox" class="svelte-bbv1xt"/> <label class="svelte-bbv1xt">Save Prof.</label></div></div>'),Tl=d('<div class="proficiency-bonus svelte-bbv1xt"><label for="profBonus">Proficiency Bonus</label> <input type="number" id="profBonus" class="prof-input svelte-bbv1xt"/></div> <div class="abilities-grid svelte-bbv1xt"></div>',1),Rl=d("<section><!> <!></section>");function Bl(r,c){qt(c,!1);const t=()=>pt(Fa,"$abilityModifiers",R),v=()=>pt(De,"$character",R),u=()=>pt(ma,"$searchFilter",R),f=()=>pt(Qt,"$collapsedStates",R),m=()=>pt(ya,"$isEditMode",R),[R,y]=sa(),k=D(),se=D(),E=ba(),L=[{key:"strength",label:"Strength"},{key:"dexterity",label:"Dexterity"},{key:"constitution",label:"Constitution"},{key:"intelligence",label:"Intelligence"},{key:"wisdom",label:"Wisdom"},{key:"charisma",label:"Charisma"}];function oe(){Ts()}function be(ce){const Ge=t()[ce],O=`1d20${Ge>=0?"+":""}${Ge}`,J=[];J.push({value:"1d20",source:"base die"}),Ge!==0&&J.push({value:Ge,source:ce}),E("roll",{notation:O,rollType:"check",bonusBreakdown:J})}function ue(ce){const Ge=t()[ce],O=v().saveProficiencies[ce]?v().proficiencyBonus:0,J=Ge+O,ee=`1d20${J>=0?"+":""}${J}`,C=[];C.push({value:"1d20",source:"base die"}),Ge!==0&&C.push({value:Ge,source:ce}),O!==0&&C.push({value:O,source:"proficiency"}),E("roll",{notation:ee,rollType:"save",bonusBreakdown:C})}et(()=>u(),()=>{o(k,L.filter(({label:ce})=>u()?ce.toLowerCase().includes(u().toLowerCase()):!0))}),et(()=>(e(k),u()),()=>{o(se,e(k).length>0||!u()||u().toLowerCase().includes("proficiency"))}),aa(),Gt();var H=Rl();let z;var Te=l(H);ha(Te,{title:"Ability Scores",get collapsed(){return f(),i(()=>f().abilityScores)},ariaLabel:"Toggle Ability Scores Section",onToggle:()=>Qt.update(ce=>({...ce,abilityScores:!ce.abilityScores}))});var Ne=s(Te,2);{var Xe=ce=>{var Ge=Tl(),O=Be(Ge),J=s(l(O),2);Fe(J),a(O);var ee=s(O,2);kt(ee,5,()=>e(k),$t,(C,T)=>{let S=()=>e(T).key,K=()=>e(T).label;var b=Al(),w=l(b),pe=l(w,!0);a(w);var qe=s(w,2);Fe(qe);var Ee=s(qe,2),he=l(Ee);a(Ee);var Le=s(Ee,2),Oe=l(Le),Ke=s(Oe,2);a(Le);var nt=s(Le,2),gt=l(nt);Fe(gt);var dt=s(gt,2);a(nt),a(b),$(at=>{x(pe,at),x(he,`${t(),S(),i(()=>t()[S()]>=0?"+":"")??""}${t(),S(),i(()=>t()[S()])??""}`),gt.disabled=!m(),rt(gt,"id",`${S()}-save`),rt(dt,"for",`${S()}-save`)},[()=>(K(),i(()=>K().substring(0,3).toUpperCase()))]),Qe(qe,()=>v().abilities[S()],at=>Mt(De,i(v).abilities[S()]=at,i(v))),P("change",qe,oe),P("click",Oe,()=>be(S())),P("click",Ke,()=>ue(S())),ga(gt,()=>v().saveProficiencies[S()],at=>Mt(De,i(v).saveProficiencies[S()]=at,i(v))),n(C,b)}),a(ee),Qe(J,()=>v().proficiencyBonus,C=>Mt(De,i(v).proficiencyBonus=C,i(v))),n(ce,Ge)};g(Ne,ce=>{f(),i(()=>!f().abilityScores)&&ce(Xe)})}a(H),$(()=>z=At(H,1,"ability-scores svelte-bbv1xt",null,z,{hidden:!e(se)})),n(r,H),Wt(),y()}const Ps=[{name:"Unarmored",type:"none",baseAC:10},{name:"Padded",type:"light",baseAC:11},{name:"Leather",type:"light",baseAC:11},{name:"Studded Leather",type:"light",baseAC:12},{name:"Hide",type:"medium",baseAC:12,maxDexBonus:2},{name:"Chain Shirt",type:"medium",baseAC:13,maxDexBonus:2},{name:"Scale Mail",type:"medium",baseAC:14,maxDexBonus:2},{name:"Breastplate",type:"medium",baseAC:14,maxDexBonus:2},{name:"Half Plate",type:"medium",baseAC:15,maxDexBonus:2},{name:"Ring Mail",type:"heavy",baseAC:14,maxDexBonus:0},{name:"Chain Mail",type:"heavy",baseAC:16,maxDexBonus:0},{name:"Splint",type:"heavy",baseAC:17,maxDexBonus:0},{name:"Plate",type:"heavy",baseAC:18,maxDexBonus:0}];function Ms(r){return Ps.find(c=>c.name===r)}function Pl(r,c,t){if(!r)return 10+c+(t?2:0);const v=Ms(r);if(!v)return 10+c+(t?2:0);let u=v.baseAC;return v.maxDexBonus===void 0?u+=c:v.maxDexBonus>0&&(u+=Math.min(c,v.maxDexBonus)),t&&(u+=2),u}function Ia(r){return Math.floor((r-10)/2)}function Ua(r,c){if(!r.class)return null;const t=na(r.class);if(!t||!t.spellcaster||!t.spellcastingAbility)return null;const v=Ia(c[t.spellcastingAbility]);return 8+r.proficiencyBonus+v}function ls(r,c){if(!r.class)return 0;const t=na(r.class);return!t||!t.spellcaster||!t.spellcastingAbility?0:Ia(c[t.spellcastingAbility])}function Ml(r,c){const t=[],v=Ia(c.dexterity),u=r.armorName?Ms(r.armorName):void 0;if(u){if(u.type==="none")t.push("Unarmored"),t.push("Base: 10"),t.push(`Dexterity: ${v>=0?"+":""}${v}`);else if(u.type==="light")t.push(`${u.name}: ${u.baseAC}`),t.push(`Dexterity: ${v>=0?"+":""}${v}`);else if(u.type==="medium"){const f=Math.min(2,v);t.push(`${u.name}: ${u.baseAC}`),t.push(`Dexterity: ${f>=0?"+":""}${f} (max +2)`)}else u.type==="heavy"&&(t.push(`${u.name}: ${u.baseAC}`),t.push("Dexterity: +0 (heavy armor)"));r.shieldEquipped&&t.push("Shield: +2")}else{t.push("Base: 10"),v!==0&&t.push(`Dexterity: ${v>=0?"+":""}${v}`);const f=10+v,m=r.armorClass-f;m!==0&&t.push(`Other: ${m>=0?"+":""}${m}`)}return r.activeStates&&r.activeStates.length>0&&r.activeStates.forEach(f=>{typeof f.acBonus=="number"&&f.acBonus!==0&&(!f.target||f.target==="self")&&t.push(`${f.name}: ${f.acBonus>=0?"+":""}${f.acBonus}`)}),t.join(`
`)}function Ul(r,c){const t=[],v=Ia(c.dexterity);t.push(`Dexterity: ${v>=0?"+":""}${v}`);const u=r.initiative-v;return u!==0&&t.push(`Other Bonuses: ${u>=0?"+":""}${u}`),t.join(`
`)}function Fl(r,c){if(!r.class)return"";const t=na(r.class);if(!t||!t.spellcaster||!t.spellcastingAbility)return"";const v=[],u=Ia(c[t.spellcastingAbility]),f=t.spellcastingAbility.charAt(0).toUpperCase()+t.spellcastingAbility.slice(1);return v.push("Base: 8"),v.push(`Proficiency: +${r.proficiencyBonus}`),v.push(`${f}: ${u>=0?"+":""}${u}`),v.join(`
`)}function Il(r,c,t){const v=[];let u=r;const f=c.toLowerCase().trim();if(t.activeStates){for(const m of t.activeStates)if(m.immunities&&m.immunities.length>0&&m.immunities.some(y=>y.toLowerCase().trim()===f))return v.push(`Immune to ${c} (${m.name})`),{finalDamage:0,adjustments:v}}if(t.activeStates){for(const m of t.activeStates)if(m.resistances&&m.resistances.length>0&&m.resistances.some(y=>y.toLowerCase().trim()===f)){const y=Math.floor(u/2);v.push(`Resistant to ${c} (${m.name}): ${u} ‚Üí ${y}`),u=y;break}}return v.length===0&&v.push(`No adjustments for ${c}`),{finalDamage:u,adjustments:v}}function El(r,c){const t={...r};if(t.tempHP>0){if(c<=t.tempHP)return t.tempHP-=c,t;c-=t.tempHP,t.tempHP=0}return t.currentHP=Math.max(0,t.currentHP-c),t}var Hl=d('<button class="info-icon svelte-1o8ci7b" type="button">‚ÑπÔ∏è</button>'),Nl=d('<button class="info-icon svelte-1o8ci7b" type="button">‚ÑπÔ∏è</button>'),Ol=d("<div><!></div>"),Gl=d('<div class="tooltip-wrapper svelte-1o8ci7b"><!> <!></div>');function is(r,c){qt(c,!1);let t=vt(c,"tooltipContent",8),v=vt(c,"ariaLabel",8,"Show information"),u=D(!1),f=D(),m=D(!1),R=D(null),y=D(!1),k=D(!1),se=D("");const E=Math.random().toString(36).slice(2);function L(){window.dispatchEvent(new CustomEvent("tooltip-open",{detail:E}))}function oe(C){C.detail!==E&&(o(u,!1),o(y,!1))}function be(){o(m,window.matchMedia("(pointer: coarse)").matches||"ontouchstart"in window)}function ue(){if(!e(R)||!e(f))return;const C=e(f).getBoundingClientRect(),T=e(R).getBoundingClientRect();let S=C.bottom+5,K=C.left;o(y,!1),K+T.width>window.innerWidth-8&&(K=C.right-T.width,o(y,!0),K<8&&(K=8)),K<8&&(K=8),S+T.height>window.innerHeight-8&&(S=C.top-T.height-5),o(se,`position:fixed;top:${S}px;left:${K}px;z-index:1000;`),o(k,!0)}function H(){L(),o(u,!1),o(k,!1),requestAnimationFrame(()=>{o(u,!0),o(k,!1),setTimeout(ue,0)})}function z(){o(u,!1),o(y,!1)}function Te(C){C.stopPropagation(),e(u)?(o(u,!1),o(y,!1),o(k,!1)):(L(),o(u,!1),o(k,!1),requestAnimationFrame(()=>{o(u,!0),o(k,!1),setTimeout(ue,0)}))}function Ne(C){e(f)&&!e(f).contains(C.target)&&(o(u,!1),o(y,!1))}Sa(()=>{be(),document.addEventListener("click",Ne),window.addEventListener("tooltip-open",oe)}),Es(()=>{document.removeEventListener("click",Ne),window.removeEventListener("tooltip-open",oe)}),Gt();var Xe=Gl(),ce=l(Xe);{var Ge=C=>{var T=Hl();$(()=>rt(T,"aria-label",v())),P("click",T,Te),n(C,T)},O=C=>{var T=Nl();$(()=>rt(T,"aria-label",v())),P("mouseenter",T,H),P("mouseleave",T,z),n(C,T)};g(ce,C=>{e(m)?C(Ge):C(O,!1)})}var J=s(ce,2);{var ee=C=>{var T=Ol(),S=l(T);ul(S,c,"content",{},K=>{var b=ot(),w=Be(b);dl(w,t),n(K,b)}),a(T),Ba(T,K=>o(R,K),()=>e(R)),$(()=>{At(T,1,`tooltip-popup ${e(y)?"right-align":""}`,"svelte-1o8ci7b"),fl(T,e(k)?e(se)+"opacity:1;pointer-events:auto;":"opacity:0;pointer-events:none;position:fixed;top:0;left:0;z-index:1000;")}),n(C,T)};g(J,C=>{e(u)&&C(ee)})}a(Xe),Ba(Xe,C=>o(f,C),()=>e(f)),n(r,Xe),Wt()}var ql=d("<option> </option>"),Wl=d('<div class="armor-config svelte-1r5hyyb"><h4 class="svelte-1r5hyyb">Armor Configuration</h4> <div class="armor-controls svelte-1r5hyyb"><div class="armor-field svelte-1r5hyyb"><label for="armorName" class="svelte-1r5hyyb">Armor</label> <select id="armorName" class="armor-select svelte-1r5hyyb"><option>None (Unarmored)</option><!></select></div> <div class="armor-field svelte-1r5hyyb"><label class="shield-label svelte-1r5hyyb"><input type="checkbox" class="shield-checkbox svelte-1r5hyyb"/> Shield Equipped (+2 AC)</label></div></div></div>'),zl=d('<div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="spellSaveDC" class="svelte-1r5hyyb">Spell Save DC</label> <!></div> <input type="number" id="spellSaveDC" class="stat-input svelte-1r5hyyb" readonly=""/></div>'),Jl=d('<span class="hit-dice-type"> </span>'),Kl=d('<!> <div class="stats-grid svelte-1r5hyyb"><div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="armorClass" class="svelte-1r5hyyb">Armor Class</label> <!></div> <input type="text" id="armorClass" readonly=""/></div> <div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="initiative" class="svelte-1r5hyyb">Initiative</label> <!></div> <input type="text" id="initiative" class="stat-input svelte-1r5hyyb" readonly=""/></div> <div class="stat-box svelte-1r5hyyb"><label for="speed" class="svelte-1r5hyyb">Speed</label> <input type="text" id="speed" class="stat-input svelte-1r5hyyb"/></div> <!></div> <div class="hp-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Points</h3> <div><div class="hp-inputs svelte-1r5hyyb"><input type="number" class="hp-current svelte-1r5hyyb" min="0"/> <span class="hp-separator svelte-1r5hyyb">/</span> <input type="number" class="hp-max svelte-1r5hyyb" min="0"/></div> <div class="hp-controls svelte-1r5hyyb"><button class="hp-btn svelte-1r5hyyb">‚àí</button> <button class="hp-btn svelte-1r5hyyb">+</button> <button class="hp-btn svelte-1r5hyyb">‚àí5</button> <button class="hp-btn svelte-1r5hyyb">+5</button></div></div> <div class="temp-hp svelte-1r5hyyb"><label for="tempHP" class="svelte-1r5hyyb">Temp HP</label> <input type="number" id="tempHP" min="0" class="svelte-1r5hyyb"/></div></div> <div class="hit-dice-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Dice</h3> <div class="hit-dice-display svelte-1r5hyyb"><input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <span>/</span> <input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <!></div> <div class="hit-dice-controls svelte-1r5hyyb"><label for="hitDiceCount" class="svelte-1r5hyyb">Roll</label> <div class="hit-dice-count-controls svelte-1r5hyyb"><button class="hit-dice-btn svelte-1r5hyyb">‚àí</button> <input type="number" id="hitDiceCount" class="hit-dice-count-input svelte-1r5hyyb" min="1"/> <button class="hit-dice-btn svelte-1r5hyyb">+</button></div> <button class="btn btn-primary roll-hit-dice use-enabled svelte-1r5hyyb">üé≤ Roll</button></div></div>',1),Vl=d("<section><!> <!></section>");function Yl(r,c){qt(c,!1);const t=()=>pt(De,"$character",R),v=()=>pt(Fa,"$abilityModifiers",R),u=()=>pt(ma,"$searchFilter",R),f=()=>pt(Qt,"$collapsedStates",R),m=()=>pt(ya,"$isEditMode",R),[R,y]=sa(),k=D(),se=D(),E=D(),L=D(),oe=D(),be=D(),ue=D(),H=ba();let z=D(1);function Te(C){De.update(T=>(T.currentHP=Math.max(0,Math.min(T.maxHP,T.currentHP+C)),T))}function Ne(C){const T=e(z)+C,S=t().hitDice.current;o(z,Math.max(1,Math.min(S,T)))}function Xe(C=1){if(t().hitDice.current<=0){alert("No hit dice remaining!");return}if(!t().class){alert("Please select a class first!");return}const T=na(t().class);if(!T){alert("Invalid class configuration!");return}const S=Math.min(C,t().hitDice.current),K=T.hitDice,b=v().constitution,w=b*S,pe=w>=0?`+${w}`:`${w}`,qe=`${S}${K}${pe}`,Ee=[];if(Ee.push({value:`${S}${K}`,source:"hit dice"}),b!==0)for(let he=0;he<S;he++)Ee.push({value:b,source:"constitution"});H("rollHitDice",{notation:qe,hitDie:K,count:S,bonusBreakdown:Ee})}et(()=>(t(),v(),De),()=>{if(t().armorName!==void 0||t().shieldEquipped!==void 0){const C=v().dexterity,T=Pl(t().armorName,C,t().shieldEquipped||!1);t().armorClass!==T&&De.update(S=>({...S,armorClass:T}))}}),et(()=>(v(),t(),De),()=>{const C=v().dexterity;t().initiative!==C&&De.update(T=>({...T,initiative:C}))}),et(()=>t(),()=>{o(k,Ua(t(),t().abilities))}),et(()=>t(),()=>{o(se,Ml(t(),t().abilities))}),et(()=>t(),()=>{o(E,Ul(t(),t().abilities))}),et(()=>t(),()=>{o(L,Fl(t(),t().abilities))}),et(()=>(t(),e(z)),()=>{const C=t().hitDice.current;C>0&&e(z)>C&&o(z,C)}),et(()=>t(),()=>{o(oe,t().activeStates&&t().activeStates.length>0?t().activeStates.reduce((C,T)=>C+(T.acBonus||0),0):0)}),et(()=>t(),()=>{o(be,t().activeStates&&t().activeStates.length>0?t().activeStates.some(C=>C.name==="Aid"&&C.target==="self"):!1)}),et(()=>u(),()=>{o(ue,!u()||"armor class".includes(u().toLowerCase())||"initiative".includes(u().toLowerCase())||"speed".includes(u().toLowerCase())||"hit points".includes(u().toLowerCase())||"hp".includes(u().toLowerCase())||"hit dice".includes(u().toLowerCase())||"spell save".includes(u().toLowerCase())||"combat".includes(u().toLowerCase()))}),aa(),Gt();var ce=Vl();let Ge;var O=l(ce);{let C=xt(()=>(f(),i(()=>f().combatStats?"Expand":"Collapse")));ha(O,{title:"Combat Stats",get collapsed(){return f(),i(()=>f().combatStats)},get ariaLabel(){return e(C)},onToggle:()=>Qt.update(T=>({...T,combatStats:!T.combatStats}))})}var J=s(O,2);{var ee=C=>{var T=Kl(),S=Be(T);{var K=W=>{var ve=Wl(),de=s(l(ve),2),ie=l(de),ye=s(l(ie),2);$(()=>{t(),Ot(()=>{})});var Ie=l(ye);Ie.value=(Ie.__value=void 0)??"";var He=s(Ie);kt(He,1,()=>Ps,$t,(Y,q)=>{var xe=ot(),Ze=Be(xe);{var it=Ve=>{var ze=ql(),Ce=l(ze);a(ze);var ae={};$(()=>{x(Ce,`${e(q),i(()=>e(q).name)??""} (AC ${e(q),i(()=>e(q).baseAC)??""})`),ae!==(ae=(e(q),i(()=>e(q).name)))&&(ze.value=(ze.__value=(e(q),i(()=>e(q).name)))??"")}),n(Ve,ze)};g(Ze,Ve=>{e(q),i(()=>e(q).name!=="Unarmored")&&Ve(it)})}n(Y,xe)}),a(ye),a(ie);var X=s(ie,2),_=l(X),Z=l(_);Fe(Z),Yt(),a(_),a(X),a(de),a(ve),Ma(ye,()=>t().armorName,Y=>Mt(De,i(t).armorName=Y,i(t))),ga(Z,()=>t().shieldEquipped,Y=>Mt(De,i(t).shieldEquipped=Y,i(t))),n(W,ve)};g(S,W=>{m()&&W(K)})}var b=s(S,2),w=l(b),pe=l(w),qe=s(l(pe),2);is(qe,{get tooltipContent(){return e(se)},ariaLabel:"Show AC breakdown"}),a(pe);var Ee=s(pe,2);Fe(Ee),a(w);var he=s(w,2),Le=l(he),Oe=s(l(Le),2);is(Oe,{get tooltipContent(){return e(E)},ariaLabel:"Show Initiative breakdown"}),a(Le);var Ke=s(Le,2);Fe(Ke),a(he);var nt=s(he,2),gt=s(l(nt),2);Fe(gt),a(nt);var dt=s(nt,2);{var at=W=>{var ve=zl(),de=l(ve),ie=s(l(de),2);is(ie,{get tooltipContent(){return e(L)},ariaLabel:"Show Spell Save DC breakdown"}),a(de);var ye=s(de,2);Fe(ye),a(ve),$(()=>ka(ye,e(k))),n(W,ve)};g(dt,W=>{e(k)!==null&&W(at)})}a(b);var j=s(b,2),N=s(l(j),2);let $e;var Q=l(N),A=l(Q);Fe(A);var te=s(A,4);Fe(te),a(Q);var we=s(Q,2),je=l(we),ge=s(je,2),Re=s(ge,2),fe=s(Re,2);a(we),a(N);var V=s(N,2),M=s(l(V),2);Fe(M),a(V),a(j);var We=s(j,2),Pe=s(l(We),2),Ye=l(Pe);Fe(Ye);var Ue=s(Ye,4);Fe(Ue);var p=s(Ue,2);{var I=W=>{const ve=xt(()=>(B(na),t(),i(()=>na(t().class))));var de=ot(),ie=Be(de);{var ye=Ie=>{const He=xt(()=>(v(),i(()=>v().constitution)));var X=Jl(),_=l(X);a(X),$(()=>x(_,`(${B(e(ve)),i(()=>e(ve).hitDice)??""}${(e(He)>=0?`+${e(He)}`:e(He))??""})`)),n(Ie,X)};g(ie,Ie=>{e(ve)&&Ie(ye)})}n(W,de)};g(p,W=>{t(),i(()=>t().class)&&W(I)})}a(Pe);var G=s(Pe,2),F=s(l(G),2),_e=l(F),Ae=s(_e,2);Fe(Ae);var ne=s(Ae,2);a(F);var le=s(F,2);a(G),a(We),$(()=>{ka(Ee,(e(oe),t(),i(()=>e(oe)!==0?`${t().armorClass} ‚Üí ${t().armorClass+e(oe)}`:`${t().armorClass}`))),At(Ee,1,ll(e(oe)!==0?"stat-input ac-enhanced":"stat-input"),"svelte-1r5hyyb"),ka(Ke,(t(),i(()=>t().initiative))),$e=At(N,1,"hp-display svelte-1r5hyyb",null,$e,{"aid-active":e(be)}),rt(A,"max",(t(),i(()=>t().maxHP))),rt(Ye,"max",(t(),i(()=>t().hitDice.max))),_e.disabled=e(z)<=1,rt(Ae,"max",(t(),i(()=>t().hitDice.current))),ne.disabled=(e(z),t(),i(()=>e(z)>=t().hitDice.current)),le.disabled=(t(),i(()=>t().hitDice.current<=0||!t().class))}),Qe(gt,()=>t().speed,W=>Mt(De,i(t).speed=W,i(t))),Qe(A,()=>t().currentHP,W=>Mt(De,i(t).currentHP=W,i(t))),Qe(te,()=>t().maxHP,W=>Mt(De,i(t).maxHP=W,i(t))),P("click",je,()=>Te(-1)),P("click",ge,()=>Te(1)),P("click",Re,()=>Te(-5)),P("click",fe,()=>Te(5)),Qe(M,()=>t().tempHP,W=>Mt(De,i(t).tempHP=W,i(t))),Qe(Ye,()=>t().hitDice.current,W=>Mt(De,i(t).hitDice.current=W,i(t))),Qe(Ue,()=>t().hitDice.max,W=>Mt(De,i(t).hitDice.max=W,i(t))),P("click",_e,()=>Ne(-1)),Qe(Ae,()=>e(z),W=>o(z,W)),P("input",Ae,W=>{const ve=W.target,de=parseInt(ve.value);de>t().hitDice.current&&o(z,t().hitDice.current),de<1&&o(z,1)}),P("click",ne,()=>Ne(1)),P("click",le,()=>Xe(e(z))),n(C,T)};g(J,C=>{f(),i(()=>!f().combatStats)&&C(ee)})}a(ce),$(()=>Ge=At(ce,1,"combat-stats svelte-1r5hyyb",null,Ge,{hidden:!e(ue)})),n(r,ce),Wt(),y()}const Oa={acrobatics:"dexterity",animalHandling:"wisdom",arcana:"intelligence",athletics:"strength",deception:"charisma",history:"intelligence",insight:"wisdom",intimidation:"charisma",investigation:"intelligence",medicine:"wisdom",nature:"intelligence",perception:"wisdom",performance:"charisma",persuasion:"charisma",religion:"intelligence",sleightOfHand:"dexterity",stealth:"dexterity",survival:"wisdom"};var Ql=d('<div class="skill-row svelte-1f1pl16"><input type="checkbox" class="svelte-1f1pl16"/> <label class="svelte-1f1pl16"> <span class="ability-tag svelte-1f1pl16"> </span></label> <span class="skill-modifier svelte-1f1pl16"> </span> <button class="roll-btn svelte-1f1pl16">Roll</button></div>'),Xl=d('<div class="skills-grid svelte-1f1pl16"></div>'),Zl=d("<section><!> <!></section>");function ei(r,c){qt(c,!1);const t=()=>pt(De,"$character",R),v=()=>pt(Fa,"$abilityModifiers",R),u=()=>pt(ma,"$searchFilter",R),f=()=>pt(Qt,"$collapsedStates",R),m=()=>pt(ya,"$isEditMode",R),[R,y]=sa(),k=D(),se=D(),E=D(),L=D(),oe=D(),be=D(),ue=ba(),H=[{key:"acrobatics",label:"Acrobatics"},{key:"animalHandling",label:"Animal Handling"},{key:"arcana",label:"Arcana"},{key:"athletics",label:"Athletics"},{key:"deception",label:"Deception"},{key:"history",label:"History"},{key:"insight",label:"Insight"},{key:"intimidation",label:"Intimidation"},{key:"investigation",label:"Investigation"},{key:"medicine",label:"Medicine"},{key:"nature",label:"Nature"},{key:"perception",label:"Perception"},{key:"performance",label:"Performance"},{key:"persuasion",label:"Persuasion"},{key:"religion",label:"Religion"},{key:"sleightOfHand",label:"Sleight of Hand"},{key:"stealth",label:"Stealth"},{key:"survival",label:"Survival"}];function z(O){const J=Oa[O],ee=v()[J],C=t().skillProficiencies[O]?t().proficiencyBonus:0,T=e(k)[O],S=`1d20${T>=0?"+":""}${T}`,K=[];K.push({value:"1d20",source:"base die"}),ee!==0&&K.push({value:ee,source:J}),C!==0&&K.push({value:C,source:"proficiency"}),ue("roll",{notation:S,rollType:"check",bonusBreakdown:K})}et(()=>{},()=>{o(k,{})}),et(()=>t(),()=>{o(se,t().skillProficiencies)}),et(()=>t(),()=>{o(E,t().proficiencyBonus)}),et(()=>v(),()=>{o(L,v())}),et(()=>(e(L),e(se),e(E)),()=>{for(const{key:O}of H){const J=Oa[O],ee=e(L)[J],C=e(se)[O]?e(E):0;pa(k,e(k)[O]=ee+C)}}),et(()=>u(),()=>{o(oe,H.filter(({label:O})=>u()?O.toLowerCase().includes(u().toLowerCase()):!0))}),et(()=>e(oe),()=>{o(be,e(oe).length>0)}),aa(),Gt();var Te=Zl();let Ne;var Xe=l(Te);{let O=xt(()=>(f(),i(()=>f().skills?"Expand":"Collapse")));ha(Xe,{title:"Skills",get collapsed(){return f(),i(()=>f().skills)},get ariaLabel(){return e(O)},onToggle:()=>Qt.update(J=>({...J,skills:!J.skills}))})}var ce=s(Xe,2);{var Ge=O=>{var J=Xl();kt(J,5,()=>e(oe),$t,(ee,C)=>{let T=()=>e(C).key,S=()=>e(C).label;var K=Ql(),b=l(K);Fe(b);var w=s(b,2),pe=l(w),qe=s(pe),Ee=l(qe);a(qe),a(w);var he=s(w,2),Le=l(he);a(he);var Oe=s(he,2);a(K),$(Ke=>{Rs(b,(e(se),T(),i(()=>e(se)[T()]))),b.disabled=!m(),rt(b,"id",T()),rt(w,"for",T()),x(pe,`${S()??""} `),x(Ee,`(${Ke??""})`),x(Le,`${e(k),T(),i(()=>e(k)[T()]>=0?"+":"")??""}${e(k),T(),i(()=>e(k)[T()])??""}`)},[()=>(B(Oa),T(),i(()=>Oa[T()].substring(0,3).toUpperCase()))]),P("change",b,Ke=>{console.log("Skill proficiency changed:",T(),Ke.target.checked),De.update(nt=>({...nt,skillProficiencies:{...nt.skillProficiencies,[T()]:Ke.target.checked}}))}),P("click",Oe,()=>z(T())),n(ee,K)}),a(J),n(O,J)};g(ce,O=>{f(),i(()=>!f().skills)&&O(Ge)})}a(Te),$(()=>Ne=At(Te,1,"skills svelte-1f1pl16",null,Ne,{hidden:!e(be)})),n(r,Te),Wt(),y()}var ti=d('<p class="empty-message svelte-1123ljy">No attacks or spells to reorder.</p>'),ai=d('<li class="reorder-item svelte-1123ljy"><span class="attack-name svelte-1123ljy"> </span> <div class="reorder-buttons svelte-1123ljy"><button class="btn-move svelte-1123ljy" aria-label="Move up">‚ñ≤</button> <button class="btn-move svelte-1123ljy" aria-label="Move down">‚ñº</button></div></li>'),si=d('<ul class="reorder-list svelte-1123ljy"></ul>'),li=d('<div class="modal-backdrop svelte-1123ljy" role="presentation"><div class="modal-content svelte-1123ljy" role="dialog" aria-modal="true" aria-labelledby="modal-title"><div class="modal-header svelte-1123ljy"><h3 id="modal-title" class="svelte-1123ljy">Reorder Attacks & Spells</h3> <button class="btn-close svelte-1123ljy" aria-label="Close">√ó</button></div> <div class="modal-body svelte-1123ljy"><!></div> <div class="modal-footer svelte-1123ljy"><button class="btn btn-secondary svelte-1123ljy">Cancel</button> <button class="btn btn-primary svelte-1123ljy">Save Order</button></div></div></div>');function ii(r,c){qt(c,!1);let t=vt(c,"show",8,!1),v=vt(c,"attacks",24,()=>[]),u=vt(c,"onSave",8),f=vt(c,"onCancel",8),m=D([]);function R(H,z){const Te=e(m)[H];pa(m,e(m)[H]=e(m)[z]),pa(m,e(m)[z]=Te),o(m,[...e(m)])}function y(H){H>0&&R(H,H-1)}function k(H){H<e(m).length-1&&R(H,H+1)}function se(){u()(e(m))}function E(){f()()}function L(H){H.target===H.currentTarget&&E()}et(()=>(B(t()),B(v())),()=>{t()&&o(m,[...v()])}),aa(),Gt();var oe=ot(),be=Be(oe);{var ue=H=>{var z=li(),Te=l(z),Ne=l(Te),Xe=s(l(Ne),2);a(Ne);var ce=s(Ne,2),Ge=l(ce);{var O=S=>{var K=ti();n(S,K)},J=S=>{var K=si();kt(K,7,()=>e(m),b=>b.id,(b,w,pe)=>{var qe=ai(),Ee=l(qe),he=l(Ee,!0);a(Ee);var Le=s(Ee,2),Oe=l(Le),Ke=s(Oe,2);a(Le),a(qe),$(()=>{x(he,(e(w),i(()=>e(w).name||"(Unnamed attack or spell)"))),Oe.disabled=e(pe)===0,Ke.disabled=(B(e(pe)),e(m),i(()=>e(pe)===e(m).length-1))}),P("click",Oe,()=>y(e(pe))),P("click",Ke,()=>k(e(pe))),n(b,qe)}),a(K),n(S,K)};g(Ge,S=>{e(m),i(()=>e(m).length===0)?S(O):S(J,!1)})}a(ce);var ee=s(ce,2),C=l(ee),T=s(C,2);a(ee),a(Te),a(z),P("click",Xe,E),P("click",C,E),P("click",T,se),P("click",z,L),n(H,z)};g(be,H=>{t()&&H(ue)})}n(r,oe),Wt()}let Ga=null,qa=null;async function ps(){if(Ga)return Ga;try{return Ga=await(await fetch(Bs("/data/spells.json"))).json(),Ga||[]}catch(r){return console.error("Failed to load spells:",r),[]}}async function ri(){if(qa)return qa;try{return qa=await(await fetch(Bs("/data/feats.json"))).json(),qa||[]}catch(r){return console.error("Failed to load feats:",r),[]}}function ks(r,c){if(!c.trim())return r;const t=c.toLowerCase();return r.filter(v=>v.name.toLowerCase().includes(t)||v.school.toLowerCase().includes(t)||v.classes.some(u=>u.toLowerCase().includes(t))||v.description.toLowerCase().includes(t))}function ni(r,c){return c===null?r:r.filter(t=>t.level===c)}function oi(r,c){if(!c.trim())return r;const t=c.toLowerCase();return r.filter(v=>v.name.toLowerCase().includes(t)||v.description.toLowerCase().includes(t))}function Ta(r){const c=r.description,t=/\b(Strength|Dexterity|Constitution|Intelligence|Wisdom|Charisma)\s+saving\s+throw/i,v=c.match(t);if(!v)return null;const u=v[1].toLowerCase(),m=/half\s+(?:as\s+much\s+)?damage\s+on\s+a\s+successful(?:\s+save)?/i.test(c),y=/saving\s+throw\s+or\s+take.*?damage/i.test(c)&&!m;return{ability:u,halfDamageOnSave:m,noDamageOnSave:y}}function ci(r){const c=r.description;return/(plus|add)\s+your\s+spellcasting\s+(ability\s+)?modifier/i.test(c)}function Wa(r){const c=r.description.toLowerCase();return c.includes("ranged spell attack")||c.includes("melee spell attack")}function cs(r){const c=r.description.toLowerCase();if(["Divine Favor","Bless","Aid","Command"].includes(r.name))return!0;const u=["takes","take","deals","deal","damage equal to","force damage","fire damage","cold damage","lightning damage","thunder damage","acid damage","poison damage","necrotic damage","radiant damage","psychic damage","regain","regains","hit point"].some(R=>c.includes(R));return["bonus to attack","bonus to damage","bonus to ac","gains a +","gain a +","+1 bonus","+2 bonus","+3 bonus","advantage on","becomes a magic weapon"].some(R=>c.includes(R))&&!u}function vi(r){const c=r.description;let t=0,v=0,u=0,f="";const m=c.match(/\+(\d+)\s+bonus\s+to\s+attack\s+rolls\s+and\s+damage\s+rolls/i);if(m){const y=parseInt(m[1]);t=y,v=y,f=`+${y} to attack and damage rolls`}if(r.name==="Bless"&&(f="Add 1d4 to attack rolls and saves",t="1d4"),r.name==="Aid")return f="+5 HP (max and current) for 8 hours",{attackBonus:0,damageBonus:0,acBonus:0,hpBonus:5,description:f,name:r.name};r.name==="Divine Favor"&&(f="Your weapon attacks deal an extra 1d4 radiant damage on a hit.",v="1d4");const R=c.match(/\+(\d+)\s+bonus\s+to\s+AC/i);return R&&(u=parseInt(R[1]),f=`+${u} to AC`),r.name==="Haste"&&(f="+2 AC, doubled speed, extra action",u=2),f||t!==0||v!==0||u!==0?{attackBonus:t,damageBonus:v,acBonus:u,description:f||r.description.substring(0,100),name:r.name}:null}function za(r){const c=r.description,t=/takes?\s+(\d+d\d+)\s+\w+\s+damage[^.]*\.\s*If\s+the\s+target\s+is\s+missing.*?instead\s+takes?\s+(\d+d\d+)/is,v=c.match(t);return v?{baseDamage:v[1],alternateDamage:v[2]}:null}var di=d('<button class="btn btn-secondary">Reorder</button>'),ui=d('<div class="edit-buttons svelte-14o91c5"><button class="btn btn-secondary">Add Attack</button> <!></div>'),fi=d('<input type="text" placeholder="Attack name" class="attack-name svelte-14o91c5"/>'),pi=d('<h4 class="attack-name-display svelte-14o91c5"> </h4>'),gi=d('<button class="btn-remove svelte-14o91c5">√ó</button>'),mi=d('<div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Bonus</label> <input type="number" class="attack-bonus svelte-14o91c5"/></div>'),bi=d('<div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Damage</label> <input type="text" placeholder="e.g., 2d6+3" class="attack-damage svelte-14o91c5"/></div>'),hi=d('<div class="spell-info-loading svelte-14o91c5">Loading spell info...</div>'),_i=d('<li class="svelte-14o91c5"><strong>At Higher Levels:</strong> </li>'),yi=d('<ul class="svelte-14o91c5"><li class="svelte-14o91c5"><strong>Level:</strong> </li> <li class="svelte-14o91c5"><strong>Casting Time:</strong> </li> <li class="svelte-14o91c5"><strong>Range:</strong> </li> <li class="svelte-14o91c5"><strong>Components:</strong> <!></li> <li class="svelte-14o91c5"><strong>Duration:</strong> <!> </li> <li class="svelte-14o91c5"><strong>Description:</strong> </li> <!></ul>'),xi=d('<span class="scaled-damage svelte-14o91c5" style="margin-left: 8px;"> </span>'),Si=d('<span class="scaled-damage svelte-14o91c5">(Half damage)</span>'),wi=d('<span class="scaled-damage svelte-14o91c5">(No damage)</span>'),ki=d('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> <!> <!></label></div>'),$i=d('<span class="scaled-damage svelte-14o91c5"> </span>'),Ci=d('<span class="scaled-damage svelte-14o91c5"> </span>'),Di=d('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> Target is missing HP <!></label></div>'),Li=d("<option> </option>"),ji=d('<span class="scaled-damage svelte-14o91c5"><!> </span>'),Ai=d('<span class="scaled-damage svelte-14o91c5"> </span>'),Ti=d('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> Target is Fiend or Undead <!></label></div>'),Ri=d('<div class="spell-level-selector svelte-14o91c5"><label class="svelte-14o91c5">Cast at Level:</label> <select class="spell-level-select use-enabled svelte-14o91c5"></select> <!></div> <!>',1),Bi=d('<div class="spell-level-selector svelte-14o91c5"><span style="color: #dc3545; font-weight: bold;">No spell slots available!</span></div>'),Pi=d('<div class="spell-info svelte-14o91c5"><div class="spell-info-header svelte-14o91c5" role="button" tabindex="0"><h4 class="svelte-14o91c5">Spell Info</h4> <button class="collapse-btn-small svelte-14o91c5"> </button></div> <!></div> <!> <!> <!>',1),Mi=d('<div class="spell-info-missing svelte-14o91c5">Spell info not found.</div>'),Ui=d('<div class="attack-notes svelte-14o91c5"><label class="svelte-14o91c5">Notes</label> <textarea placeholder="e.g., DC 15 Dex save, Range 120 ft, Concentration" class="notes-input svelte-14o91c5" rows="2"></textarea></div>'),Fi=d('<button class="btn btn-primary">Roll Attack</button>'),Ii=d('<div class="buff-target-selection svelte-14o91c5"><div class="target-options svelte-14o91c5"><label class="target-option svelte-14o91c5"><input type="radio" class="svelte-14o91c5"/> Self</label> <label class="target-option svelte-14o91c5"><input type="radio" class="svelte-14o91c5"/> Other</label></div> <button class="btn btn-info"> </button></div>'),Ei=d('<button class="btn btn-info">Cast Spell</button>'),Hi=d("<button><!></button>"),Ni=d('<button class="btn btn-info">Cast Spell</button>'),Oi=d('<button class="btn btn-secondary">Roll Damage</button>'),Gi=d('<button class="btn btn-primary">Roll Attack</button> <!>',1),qi=d('<div class="attack-card svelte-14o91c5"><div class="attack-header svelte-14o91c5"><!> <!></div> <div class="attack-details svelte-14o91c5"><!> <!> <div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Type</label> <input type="text" placeholder="e.g., slashing" class="attack-type svelte-14o91c5"/></div></div> <!> <!> <div class="attack-actions svelte-14o91c5"><!></div></div>'),Wi=d('<p class="no-attacks svelte-14o91c5">No attacks added yet. Click "Add Attack" to create one.</p>'),zi=d('<p class="no-attacks svelte-14o91c5">No attacks match your search.</p>'),Ji=d('<span class="ability-uses svelte-14o91c5"> <!></span>'),Ki=d('<span class="ability-reaction svelte-14o91c5">‚ö° Reaction</span>'),Vi=d('<button class="btn btn-ability svelte-14o91c5">Use Ability</button>'),Yi=d('<div class="ability-card svelte-14o91c5"><div class="ability-header svelte-14o91c5"><h4 class="ability-name svelte-14o91c5"> </h4> <span class="ability-source svelte-14o91c5"> </span></div> <p class="ability-description svelte-14o91c5"> </p> <div class="ability-footer svelte-14o91c5"><!> <!> <!></div></div>'),Qi=d('<div class="condition-abilities-section svelte-14o91c5"><h3 class="abilities-header svelte-14o91c5">Condition Abilities</h3> <p class="section-description svelte-14o91c5">Special actions granted by active conditions (e.g., Flicker of Deceit)</p> <div class="abilities-list svelte-14o91c5"></div></div>'),Xi=d('<button class="btn-remove svelte-14o91c5">√ó</button>'),Zi=d('<div class="state-card svelte-14o91c5"><div class="state-header svelte-14o91c5"><input type="text" placeholder="Effect name (e.g., Magic Weapon)" class="state-name svelte-14o91c5"/> <!></div> <div class="state-details svelte-14o91c5"><div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Attack Bonus</label> <input type="number" class="state-bonus svelte-14o91c5"/></div> <div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Damage Bonus</label> <input type="text" class="state-bonus svelte-14o91c5"/></div> <div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Target</label> <select class="state-bonus svelte-14o91c5"><option>Self</option><option>Other</option></select></div></div> <div class="state-description svelte-14o91c5"><label class="svelte-14o91c5">Description</label> <input type="text" placeholder="e.g., +1 to attack and damage rolls (Magic Weapon)" class="state-desc-input svelte-14o91c5"/></div></div>'),er=d('<div class="states-list svelte-14o91c5"></div>'),tr=d('<p class="no-states svelte-14o91c5">No active effects. Add spell effects that modify your attacks.</p>'),ar=d('<!> <div class="attacks-list svelte-14o91c5"><!> <!></div> <!> <div class="active-states-section svelte-14o91c5"><h3 class="svelte-14o91c5">Active Spell Effects</h3> <p class="section-description svelte-14o91c5">Effects that modify attack and damage rolls (e.g., Magic Weapon, Bless)</p> <button class="btn btn-secondary">Add Effect</button> <!></div>',1),sr=d("<section><!> <!></section> <!>",1);function lr(r,c){qt(c,!1);const t=()=>pt(De,"$character",m),v=()=>pt(ma,"$searchFilter",m),u=()=>pt(Qt,"$collapsedStates",m),f=()=>pt(ya,"$isEditMode",m),[m,R]=sa(),y=D(),k=D(),se=D(),E=[];function L(j,N){De.update($e=>{if(!$e.activeStates)return $e;const Q=$e.activeStates.findIndex(je=>je.name===j);if(Q===-1)return $e;const A=$e.activeStates[Q];if(!A.abilities)return $e;const te=A.abilities.findIndex(je=>je.name===N);if(te===-1)return $e;const we=A.abilities[te];return we.currentUses!==void 0&&we.currentUses>0&&(we.currentUses-=1,we.usesPerRest!==void 0?It.add(`Used ${N} (${we.currentUses}/${we.usesPerRest} remaining)`,"info"):It.add(`Used ${N}`,"info")),$e})}const oe=ba();let be=D({}),ue=D({}),H=D(!1);function z(j){pa(be,e(be)[j]=!e(be)[j]),o(be,{...e(be)})}function Te(j){return j.description.toLowerCase().includes("regain")&&(j.description.toLowerCase().includes("hit point")||j.description.toLowerCase().includes("hp"))}function Ne(j){return["Shield of Faith","Bless","Aid","Magic Weapon"].includes(j)}function Xe(){De.update(j=>(j.attacks=[...j.attacks,{id:crypto.randomUUID(),name:"",bonus:0,damage:"",damageType:"",notes:""}],j))}function ce(j){De.update(N=>(N.attacks=N.attacks.filter($e=>$e.id!==j),N))}function Ge(){o(H,!0)}function O(){o(H,!1)}function J(j){De.update(N=>(N.attacks=j,N)),o(H,!1),It.add("Attack order updated successfully!","success")}function ee(j){let N=j.damage,$e=!1,Q=!1;if(j.spellRef){const ge=K(j.spellRef);if(ge&&(Q=Wa(ge),ge.level>0)){const Re=j.castAtLevel||ge.level;if(!b(Re)){It.add(`No level ${Re} spell slots available!`,"error");return}const V=Ta(ge);V&&j.targetSucceededSave&&V.noDamageOnSave?N="0":($e=V?.halfDamageOnSave&&j.targetSucceededSave||!1,N=w(j,ge))}}else if(t().activeStates&&t().activeStates.length>0){let ge=0,Re=[];for(const fe of t().activeStates)fe.target!=="other"&&(typeof fe.damageBonus=="string"?Re.push(fe.damageBonus):typeof fe.damageBonus=="number"&&(ge+=fe.damageBonus));if((ge!==0||Re.length>0)&&N){const fe=N.match(/(\d+d\d+)([+-]\d+)?/);if(fe){const[,V,M]=fe,Pe=(M?parseInt(M):0)+ge;let Ye=`${V}`;Pe!==0&&(Ye+=`${Pe>=0?"+":""}${Pe}`),Re.length>0&&(Ye+=" + "+Re.join(" + ")),N=Ye}}}const A=[];let te=0;if(Q){const ge=ls(t(),t().abilities),Re=t().proficiencyBonus||0;A.push({value:Re,source:"proficiency"}),A.push({value:ge,source:"spellcasting"}),te=Re+ge}else j.bonus!==0&&A.push({value:j.bonus,source:"base"}),te=j.bonus;let we=[];if(t().activeStates)for(const ge of t().activeStates)ge.target!=="other"&&(typeof ge.attackBonus=="number"&&ge.attackBonus!==0?(A.push({value:ge.attackBonus,source:ge.name.toLowerCase()}),te+=ge.attackBonus):typeof ge.attackBonus=="string"&&ge.attackBonus&&(we.push(ge.attackBonus),A.push({value:ge.attackBonus,source:ge.name.toLowerCase()})));let je=`1d20${te>=0?"+":""}${te}`;we.length>0&&(je+="+"+we.join("+")),oe("roll",{notation:je,damageNotation:N,attackName:j.name,applyHalfDamage:$e,bonusBreakdown:A,rollType:"attack"})}function C(j){if(!j.damage){It.add(`${j.name}: No damage specified`,"error");return}let N=j.damage,$e=!1;const Q=[];let A=j.damageType||"";if(j.spellRef){const te=K(j.spellRef);if(te){const we=Te(te);if(we){const je=ls(t(),t().abilities),ge=N.match(/^(\d+d\d+)/);ge&&(N=ge[1],je>0&&(N+=`+${je}`,Q.push({value:je,source:"spellcasting"}))),A="Healing"}if(te.level>0){const je=j.castAtLevel||te.level;if(!b(je)){It.add(`No level ${je} spell slots available!`,"error");return}const Re=Ta(te);Re&&j.targetSucceededSave&&Re.noDamageOnSave?N="0":($e=Re?.halfDamageOnSave&&j.targetSucceededSave||!1,we||(N=w(j,te))),te.damageType&&!we&&(A=te.damageType)}}}else{const te=N.match(/(\d+d\d+)([+-]\d+)?/);if(te){const[,we,je]=te,ge=je?parseInt(je):0;if(ge!==0&&Q.push({value:ge,source:"base"}),t().activeStates&&t().activeStates.length>0){let Re=0,fe=[];for(const V of t().activeStates)V.target!=="other"&&(typeof V.damageBonus=="string"?fe.push(V.damageBonus):typeof V.damageBonus=="number"&&V.damageBonus!==0&&(Q.push({value:V.damageBonus,source:V.name.toLowerCase()}),Re+=V.damageBonus));if(Re!==0||fe.length>0){const V=ge+Re;let M=`${we}`;V!==0&&(M+=`${V>=0?"+":""}${V}`),fe.length>0&&(M+=" + "+fe.join(" + ")),N=M}}}}oe("roll",{notation:N,attackName:j.name,applyHalfDamage:$e,bonusBreakdown:Q,damageType:A})}let T=D([]),S=D(!1);Sa(async()=>{o(T,await ps()),o(S,!0)});function K(j){return e(T).find(N=>N.name===j)}function b(j){t().classFeatures.spellSlotsByLevel||Mt(De,i(t).classFeatures.spellSlotsByLevel={},i(t)),t().classFeatures.spellSlotsByLevel[j]||Mt(De,i(t).classFeatures.spellSlotsByLevel[j]=Array(2).fill(!1),i(t));const $e=t().classFeatures.spellSlotsByLevel[j].findIndex(Q=>!Q);return $e===-1?!1:(De.update(Q=>(Q.classFeatures.spellSlotsByLevel||(Q.classFeatures.spellSlotsByLevel={}),Q.classFeatures.spellSlotsByLevel[j]||(Q.classFeatures.spellSlotsByLevel[j]=Array(2).fill(!1)),Q.classFeatures.spellSlotsByLevel[j][$e]=!0,Q)),!0)}function w(j,N){let $e=j.damage,Q=0,A=0;const te=za(N);if(te&&j.targetIsDamaged&&($e=te.alternateDamage),ci(N)&&(A+=ls(t(),t().abilities)),t().activeStates)for(const Pe of t().activeStates)Pe.target!=="other"&&typeof Pe.damageBonus=="number"&&(A+=Pe.damageBonus);if(N.higherLevelSlot&&j.castAtLevel){const Pe=N.level,Ue=(j.castAtLevel||Pe)-Pe;if(Ue>0){const p=N.higherLevelSlot.match(/(\d+)d(\d+)\s+for\s+each.*?level\s+above/i);if(p){const[,I]=p;Q+=Ue*parseInt(I)}}}if(j.targetIsFiendOrUndead&&N.description.includes("Fiend or an Undead")){const Pe=N.description.match(/increases by (\d+)d(\d+) if.*?Fiend or.*?Undead/i);if(Pe){const[,Ye]=Pe;Q+=parseInt(Ye)}}const we=$e.match(/(\d+)d(\d+)([+-]\d+)?/);if(!we)return A!==0?A>=0?`${A}`:`${A}`:$e||"0";const[,je,ge,Re]=we,fe=parseInt(je)+Q,M=(Re?parseInt(Re):0)+A;let We=`${fe}d${ge}`;return M!==0&&(We+=M>=0?`+${M}`:`${M}`),We}function pe(j){const N=[];for(let Q=j.level;Q<=9;Q++){const A=t().classFeatures.spellSlotsByLevel?.[Q];A&&A.length>0&&N.push(Q)}return N}function qe(){De.update(j=>(j.activeStates||(j.activeStates=[]),j.activeStates=[...j.activeStates,{name:"",attackBonus:0,damageBonus:0,description:"",target:"self"}],j))}function Ee(j){De.update(N=>{if(N.activeStates){const $e=N.activeStates[j];$e?.hpBonus&&$e.target!=="other"&&(N.maxHP-=$e.hpBonus,N.currentHP=Math.max(1,Math.min(N.currentHP-$e.hpBonus,N.maxHP))),N.activeStates=N.activeStates.filter((Q,A)=>A!==j)}return N})}function he(j,N="self"){const $e=K(j.spellRef);if(!$e){It.add("Spell not found","error");return}const Q=j.castAtLevel||$e.level;if(Q>0&&!b(Q)){It.add(`No level ${Q} spell slots available!`,"error");return}const A=vi($e);if(!A){It.add(`${$e.name} cast! Check spell description for effects.`,"info");return}let te=A.hpBonus||0,we=A.description;$e.name==="Aid"&&Q>$e.level&&(te=5+(Q-$e.level)*5,we=`+${te} HP (max and current) for 8 hours`);const ge=["Shield of Faith","Bless","Aid","Magic Weapon"].includes($e.name);De.update(fe=>{fe.activeStates||(fe.activeStates=[]);const V=fe.activeStates.find(M=>M.name===$e.name);return V&&V.hpBonus&&V.target!=="other"&&(fe.maxHP-=V.hpBonus,fe.currentHP=Math.max(1,Math.min(fe.currentHP-V.hpBonus,fe.maxHP))),fe.activeStates=fe.activeStates.filter(M=>M.name!==$e.name),te>0&&N==="self"&&(fe.maxHP+=te,fe.currentHP+=te),fe.activeStates=[...fe.activeStates,{name:$e.name,attackBonus:A.attackBonus,damageBonus:A.damageBonus,acBonus:A.acBonus,description:we,target:N,hpBonus:te}],fe});const Re=N==="self"?" on self":" on other";It.add(`${$e.name} cast${ge?Re:""}! Effect added to Active Spell Effects.`,"success")}et(()=>t(),()=>{o(y,t().activeStates?t().activeStates.filter(j=>j.abilities&&j.abilities.length>0).flatMap(j=>j.abilities.map(N=>({...N,conditionName:j.name}))):[])}),et(()=>(t(),e(be),e(ue)),()=>{if(t()&&t().attacks)for(const j of t().attacks)j.spellRef&&e(be)[j.id]===void 0&&pa(be,e(be)[j.id]=!0),j.spellRef&&e(ue)[j.id]===void 0&&pa(ue,e(ue)[j.id]="self")}),et(()=>(t(),v()),()=>{o(k,t().attacks.filter(j=>{if(!v())return!0;const N=v().toLowerCase();return j.name.toLowerCase().includes(N)||j.damageType.toLowerCase().includes(N)}).sort((j,N)=>!j.spellRef&&N.spellRef?-1:j.spellRef&&!N.spellRef?1:0))}),et(()=>(v(),e(k)),()=>{o(se,!v()||e(k).length>0||"attack".includes(v().toLowerCase())||"spell".includes(v().toLowerCase()))}),aa(),Gt();var Le=sr(),Oe=Be(Le);let Ke;var nt=l(Oe);{let j=xt(()=>(u(),i(()=>u().attacks?"Expand":"Collapse")));ha(nt,{title:"Attacks & Spells",get collapsed(){return u(),i(()=>u().attacks)},get ariaLabel(){return e(j)},onToggle:()=>Qt.update(N=>({...N,attacks:!N.attacks}))})}var gt=s(nt,2);{var dt=j=>{var N=ar(),$e=Be(N);{var Q=Ue=>{var p=ui(),I=l(p),G=s(I,2);{var F=_e=>{var Ae=di();P("click",Ae,Ge),n(_e,Ae)};g(G,_e=>{t(),i(()=>t().attacks.length>0)&&_e(F)})}a(p),P("click",I,Xe),n(Ue,p)};g($e,Ue=>{f()&&Ue(Q)})}var A=s($e,2),te=l(A);kt(te,1,()=>e(k),Ue=>Ue.id,(Ue,p,I)=>{var G=qi(),F=l(G),_e=l(F);{var Ae=Ce=>{var ae=fi();Fe(ae),Qe(ae,()=>e(p).name,Je=>(e(p).name=Je,Ot(()=>(e(k),t(),v())))),n(Ce,ae)},ne=Ce=>{var ae=pi(),Je=l(ae,!0);a(ae),$(()=>x(Je,(e(p),i(()=>e(p).name||"(Unnamed Attack)")))),n(Ce,ae)};g(_e,Ce=>{f()?Ce(Ae):Ce(ne,!1)})}var le=s(_e,2);{var W=Ce=>{var ae=gi();P("click",ae,()=>ce(e(p).id)),n(Ce,ae)};g(le,Ce=>{f()&&Ce(W)})}a(F);var ve=s(F,2),de=l(ve);{var ie=Ce=>{var ae=mi(),Je=l(ae),mt=s(Je,2);Fe(mt),a(ae),$(()=>{rt(Je,"for",`attack-bonus-${e(p),i(()=>e(p).id)??""}`),rt(mt,"id",`attack-bonus-${e(p),i(()=>e(p).id)??""}`)}),Qe(mt,()=>e(p).bonus,st=>(e(p).bonus=st,Ot(()=>(e(k),t(),v())))),n(Ce,ae)};g(de,Ce=>{e(p),i(()=>e(p).bonus!==0&&e(p).bonus!==void 0)&&Ce(ie)})}var ye=s(de,2);{var Ie=Ce=>{var ae=bi(),Je=l(ae),mt=s(Je,2);Fe(mt),a(ae),$(()=>{rt(Je,"for",`attack-damage-${e(p),i(()=>e(p).id)??""}`),rt(mt,"id",`attack-damage-${e(p),i(()=>e(p).id)??""}`)}),Qe(mt,()=>e(p).damage,st=>(e(p).damage=st,Ot(()=>(e(k),t(),v())))),n(Ce,ae)};g(ye,Ce=>{e(p),i(()=>e(p).damage&&e(p).damage.trim()!=="")&&Ce(Ie)})}var He=s(ye,2),X=l(He),_=s(X,2);Fe(_),a(He),a(ve);var Z=s(ve,2);{var Y=Ce=>{var ae=ot(),Je=Be(ae);{var mt=ct=>{var me=hi();n(ct,me)},st=ct=>{const me=xt(()=>(e(p),i(()=>K(e(p).spellRef))));var Dt=ot(),zt=Be(Dt);{var Et=ke=>{const U=xt(()=>(B(Ta),B(e(me)),i(()=>Ta(e(me))))),ut=xt(()=>(B(za),B(e(me)),i(()=>za(e(me)))));var Se=Pi(),Me=Be(Se),re=l(Me),tt=s(l(re),2),lt=l(tt,!0);a(tt),a(re);var ht=s(re,2);{var ft=Tt=>{var Ft=yi(),Ht=l(Ft),la=s(l(Ht));a(Ht);var ia=s(Ht,2),va=s(l(ia));a(ia);var Xt=s(ia,2),Nt=s(l(Xt));a(Xt);var Kt=s(Xt,2),ea=s(l(Kt)),Lt=s(ea);{var ta=Pt=>{var Vt=jt();$(()=>x(Vt,`(${B(e(me)),i(()=>e(me).material)??""})`)),n(Pt,Vt)};g(Lt,Pt=>{B(e(me)),i(()=>e(me).material)&&Pt(ta)})}a(Kt);var ca=s(Kt,2),da=s(l(ca),2);{var _t=Pt=>{var Vt=jt("Concentration,");n(Pt,Vt)};g(da,Pt=>{B(e(me)),i(()=>e(me).concentration)&&Pt(_t)})}var bt=s(da,1,!0);a(ca);var St=s(ca,2),Ct=s(l(St));a(St);var wt=s(St,2);{var oa=Pt=>{var Vt=_i(),ra=s(l(Vt));a(Vt),$(()=>x(ra,` ${B(e(me)),i(()=>e(me).higherLevelSlot)??""}`)),n(Pt,Vt)};g(wt,Pt=>{B(e(me)),i(()=>e(me).higherLevelSlot)&&Pt(oa)})}a(Ft),$(Pt=>{x(la,` ${B(e(me)),i(()=>e(me).level)??""}`),x(va,` ${B(e(me)),i(()=>e(me).castingTime||e(me).actionType)??""}`),x(Nt,` ${B(e(me)),i(()=>e(me).range)??""}`),x(ea,` ${Pt??""}`),x(bt,(B(e(me)),i(()=>e(me).duration))),x(Ct,` ${B(e(me)),i(()=>e(me).description)??""}`)},[()=>(B(e(me)),i(()=>e(me).components.join(", ")))]),n(Tt,Ft)};g(ht,Tt=>{e(be),e(p),i(()=>!e(be)[e(p).id])&&Tt(ft)})}a(Me);var yt=s(Me,2);{var Bt=Tt=>{var Ft=ki(),Ht=l(Ft),la=l(Ht);Fe(la);var ia=s(la),va=s(ia);{var Xt=Lt=>{var ta=xi(),ca=l(ta);a(ta),$(da=>x(ca,`(Spell Save DC: ${da??""})`),[()=>(B(Ua),t(),i(()=>Ua(t(),t().abilities)))]),n(Lt,ta)};g(va,Lt=>{t(),i(()=>t().class)&&Lt(Xt)})}var Nt=s(va,2);{var Kt=Lt=>{var ta=Si();n(Lt,ta)},ea=Lt=>{var ta=ot(),ca=Be(ta);{var da=_t=>{var bt=wi();n(_t,bt)};g(ca,_t=>{e(p),B(e(U)),i(()=>e(p).targetSucceededSave&&e(U).noDamageOnSave)&&_t(da)},!0)}n(Lt,ta)};g(Nt,Lt=>{e(p),B(e(U)),i(()=>e(p).targetSucceededSave&&e(U).halfDamageOnSave)?Lt(Kt):Lt(ea,!1)})}a(Ht),a(Ft),$(Lt=>x(ia,` Target succeeded on ${Lt??""} save `),[()=>(B(e(U)),i(()=>e(U).ability.charAt(0).toUpperCase()+e(U).ability.slice(1)))]),ga(la,()=>e(p).targetSucceededSave,Lt=>(e(p).targetSucceededSave=Lt,Ot(()=>(e(k),t(),v())))),n(Tt,Ft)};g(yt,Tt=>{e(U)&&Tt(Bt)})}var Jt=s(yt,2);{var Rt=Tt=>{var Ft=Di(),Ht=l(Ft),la=l(Ht);Fe(la);var ia=s(la,2);{var va=Nt=>{const Kt=xt(()=>(e(p),B(e(me)),i(()=>w(e(p),e(me)))));var ea=$i(),Lt=l(ea);a(ea),$(()=>x(Lt,`(${B(e(ut)),i(()=>e(ut).alternateDamage)??""}, total: ${e(Kt)??""})`)),n(Nt,ea)},Xt=Nt=>{var Kt=Ci(),ea=l(Kt);a(Kt),$(()=>x(ea,`(${B(e(ut)),i(()=>e(ut).baseDamage)??""})`)),n(Nt,Kt)};g(ia,Nt=>{e(p),i(()=>e(p).targetIsDamaged)?Nt(va):Nt(Xt,!1)})}a(Ht),a(Ft),ga(la,()=>e(p).targetIsDamaged,Nt=>(e(p).targetIsDamaged=Nt,Ot(()=>(e(k),t(),v())))),n(Tt,Ft)};g(Jt,Tt=>{e(ut)&&Tt(Rt)})}var Ut=s(Jt,2);{var Zt=Tt=>{const Ft=xt(()=>(B(e(me)),i(()=>pe(e(me)))));var Ht=ot(),la=Be(Ht);{var ia=Xt=>{var Nt=Ri(),Kt=Be(Nt),ea=l(Kt),Lt=s(ea,2);$(()=>{e(p),Ot(()=>{e(Ft)})}),kt(Lt,5,()=>e(Ft),$t,(bt,St)=>{var Ct=Li(),wt=l(Ct);a(Ct);var oa={};$(()=>{x(wt,`Level ${e(St)??""}`),oa!==(oa=e(St))&&(Ct.value=(Ct.__value=e(St))??"")}),n(bt,Ct)}),a(Lt);var ta=s(Lt,2);{var ca=bt=>{const St=xt(()=>(e(p),B(e(me)),i(()=>w(e(p),e(me)))));var Ct=ji(),wt=l(Ct);{var oa=ra=>{var fa=jt("Healing");n(ra,fa)},Pt=ra=>{var fa=jt("Damage");n(ra,fa)};g(wt,ra=>{B(e(me)),i(()=>Te(e(me)))?ra(oa):ra(Pt,!1)})}var Vt=s(wt);a(Ct),$(()=>x(Vt,` ${e(St)??""}`)),n(bt,Ct)};g(ta,bt=>{e(p),B(e(me)),i(()=>e(p).castAtLevel&&e(p).castAtLevel>e(me).level)&&bt(ca)})}a(Kt);var da=s(Kt,2);{var _t=bt=>{var St=Ti(),Ct=l(St),wt=l(Ct);Fe(wt);var oa=s(wt,2);{var Pt=Vt=>{const ra=xt(()=>(e(p),B(e(me)),i(()=>w(e(p),e(me)))));var fa=Ai(),Qa=l(fa);a(fa),$(()=>x(Qa,`(+1d8, total: ${e(ra)??""})`)),n(Vt,fa)};g(oa,Vt=>{e(p),i(()=>e(p).targetIsFiendOrUndead)&&Vt(Pt)})}a(Ct),a(St),ga(wt,()=>e(p).targetIsFiendOrUndead,Vt=>(e(p).targetIsFiendOrUndead=Vt,Ot(()=>(e(k),t(),v())))),n(bt,St)};g(da,bt=>{B(e(me)),i(()=>e(me).description.includes("Fiend or an Undead"))&&bt(_t)})}$(()=>{rt(ea,"for",`castLevel-${e(p),i(()=>e(p).id)??""}`),rt(Lt,"id",`castLevel-${e(p),i(()=>e(p).id)??""}`)}),Ma(Lt,()=>e(p).castAtLevel,bt=>(e(p).castAtLevel=bt,Ot(()=>(e(k),t(),v())))),n(Xt,Nt)},va=Xt=>{var Nt=Bi();n(Xt,Nt)};g(la,Xt=>{B(e(Ft)),i(()=>e(Ft).length>0)?Xt(ia):Xt(va,!1)})}n(Tt,Ht)};g(Ut,Tt=>{B(e(me)),i(()=>e(me).higherLevelSlot&&e(me).level>0)&&Tt(Zt)})}$(()=>{rt(tt,"aria-label",(e(be),e(p),i(()=>e(be)[e(p).id]?"Expand":"Collapse"))),x(lt,(e(be),e(p),i(()=>e(be)[e(p).id]?"‚ñº":"‚ñ≤")))}),P("click",re,()=>z(e(p).id)),P("keydown",re,Tt=>Tt.key==="Enter"&&z(e(p).id)),n(ke,Se)},h=ke=>{var U=Mi();n(ke,U)};g(zt,ke=>{e(me)?ke(Et):ke(h,!1)})}n(ct,Dt)};g(Je,ct=>{e(T),i(()=>e(T).length===0)?ct(mt):ct(st,!1)})}n(Ce,ae)};g(Z,Ce=>{e(p),i(()=>e(p).spellRef)&&Ce(Y)})}var q=s(Z,2);{var xe=Ce=>{var ae=ot(),Je=Be(ae);{var mt=st=>{var ct=Ui(),me=l(ct),Dt=s(me,2);xa(Dt),a(ct),$(()=>{rt(me,"for",`attack-notes-${e(p),i(()=>e(p).id)??""}`),rt(Dt,"id",`attack-notes-${e(p),i(()=>e(p).id)??""}`)}),Qe(Dt,()=>e(p).notes,zt=>(e(p).notes=zt,Ot(()=>(e(k),t(),v())))),n(st,ct)};g(Je,st=>{e(p),i(()=>e(p).notes&&e(p).notes.trim()!=="")&&st(mt)})}n(Ce,ae)};g(q,Ce=>{e(p),i(()=>!e(p).spellRef)&&Ce(xe)})}var Ze=s(q,2),it=l(Ze);{var Ve=Ce=>{const ae=xt(()=>(e(p),i(()=>K(e(p).spellRef))));var Je=ot(),mt=Be(Je);{var st=ct=>{var me=ot(),Dt=Be(me);{var zt=h=>{var ke=Fi();P("click",ke,()=>ee(e(p))),n(h,ke)},Et=h=>{var ke=ot(),U=Be(ke);{var ut=Me=>{var re=ot(),tt=Be(re);{var lt=ft=>{var yt=Ii(),Bt=l(yt),Jt=l(Bt),Rt=l(Jt);Fe(Rt),Rt.value=Rt.__value="self",Yt(),a(Jt);var Ut=s(Jt,2),Zt=l(Ut);Fe(Zt),Zt.value=Zt.__value="other",Yt(),a(Ut),a(Bt);var Tt=s(Bt,2),Ft=l(Tt);a(Tt),a(yt),$(()=>{rt(Rt,"name",`target-${e(p),i(()=>e(p).id)??""}`),rt(Zt,"name",`target-${e(p),i(()=>e(p).id)??""}`),x(Ft,`Cast ${B(e(ae)),i(()=>e(ae).name)??""}`)}),Ka(E,[I],Rt,()=>e(ue)[e(p).id],Ht=>pa(ue,e(ue)[e(p).id]=Ht)),Ka(E,[I],Zt,()=>e(ue)[e(p).id],Ht=>pa(ue,e(ue)[e(p).id]=Ht)),P("click",Tt,()=>he(e(p),e(ue)[e(p).id])),n(ft,yt)},ht=ft=>{var yt=Ei();P("click",yt,()=>he(e(p),"self")),n(ft,yt)};g(tt,ft=>{B(e(ae)),i(()=>Ne(e(ae).name))?ft(lt):ft(ht,!1)})}n(Me,re)},Se=Me=>{var re=ot(),tt=Be(re);{var lt=ft=>{var yt=Hi(),Bt=l(yt);{var Jt=Ut=>{var Zt=jt("Roll Healing");n(Ut,Zt)},Rt=Ut=>{var Zt=jt("Roll Damage");n(Ut,Zt)};g(Bt,Ut=>{B(e(ae)),i(()=>Te(e(ae)))?Ut(Jt):Ut(Rt,!1)})}a(yt),$(Ut=>At(yt,1,`btn ${Ut??""}`),[()=>(B(e(ae)),i(()=>Te(e(ae))?"btn-success":"btn-secondary"))]),P("click",yt,()=>C(e(p))),n(ft,yt)},ht=ft=>{var yt=Ni();P("click",yt,()=>he(e(p),"self")),n(ft,yt)};g(tt,ft=>{e(p),i(()=>e(p).damage&&e(p).damage.trim()!=="")?ft(lt):ft(ht,!1)})}n(Me,re)};g(U,Me=>{B(cs),B(e(ae)),i(()=>cs(e(ae)))?Me(ut):Me(Se,!1)},!0)}n(h,ke)};g(Dt,h=>{B(Wa),B(e(ae)),i(()=>Wa(e(ae)))?h(zt):h(Et,!1)})}n(ct,me)};g(mt,ct=>{e(ae)&&ct(st)})}n(Ce,Je)},ze=Ce=>{var ae=ot(),Je=Be(ae);{var mt=st=>{var ct=Gi(),me=Be(ct),Dt=s(me,2);{var zt=Et=>{var h=Oi();P("click",h,()=>C(e(p))),n(Et,h)};g(Dt,Et=>{e(p),i(()=>e(p).damage&&e(p).damage.trim()!=="")&&Et(zt)})}P("click",me,()=>ee(e(p))),n(st,ct)};g(Je,st=>{e(p),i(()=>!e(p).spellRef)&&st(mt)},!0)}n(Ce,ae)};g(it,Ce=>{e(p),e(S),i(()=>e(p).spellRef&&e(S))?Ce(Ve):Ce(ze,!1)})}a(Ze),a(G),$(()=>{rt(X,"for",`attack-type-${e(p),i(()=>e(p).id)??""}`),rt(_,"id",`attack-type-${e(p),i(()=>e(p).id)??""}`)}),Qe(_,()=>e(p).damageType,Ce=>(e(p).damageType=Ce,Ot(()=>(e(k),t(),v())))),n(Ue,G)});var we=s(te,2);{var je=Ue=>{var p=Wi();n(Ue,p)},ge=Ue=>{var p=ot(),I=Be(p);{var G=F=>{var _e=zi();n(F,_e)};g(I,F=>{e(k),i(()=>e(k).length===0)&&F(G)},!0)}n(Ue,p)};g(we,Ue=>{t(),i(()=>t().attacks.length===0)?Ue(je):Ue(ge,!1)})}a(A);var Re=s(A,2);{var fe=Ue=>{var p=Qi(),I=s(l(p),4);kt(I,5,()=>e(y),$t,(G,F)=>{var _e=Yi(),Ae=l(_e),ne=l(Ae),le=l(ne,!0);a(ne);var W=s(ne,2),ve=l(W);a(W),a(Ae);var de=s(Ae,2),ie=l(de,!0);a(de);var ye=s(de,2),Ie=l(ye);{var He=q=>{var xe=Ji(),Ze=l(xe),it=s(Ze);{var Ve=ze=>{var Ce=jt();$(()=>x(Ce,`per ${e(F),i(()=>e(F).restType)??""} rest`)),n(ze,Ce)};g(it,ze=>{e(F),i(()=>e(F).restType)&&ze(Ve)})}a(xe),$(()=>x(Ze,`${e(F),i(()=>e(F).currentUses??e(F).usesPerRest)??""}/${e(F),i(()=>e(F).usesPerRest)??""} uses `)),n(q,xe)};g(Ie,q=>{e(F),i(()=>e(F).usesPerRest)&&q(He)})}var X=s(Ie,2);{var _=q=>{var xe=Ki();n(q,xe)};g(X,q=>{e(F),i(()=>e(F).requiresReaction)&&q(_)})}var Z=s(X,2);{var Y=q=>{var xe=Vi();$(()=>xe.disabled=(e(F),i(()=>e(F).currentUses===void 0||e(F).currentUses===0))),P("click",xe,()=>L(e(F).conditionName,e(F).name)),n(q,xe)};g(Z,q=>{f(),e(F),i(()=>!f()&&e(F).usesPerRest)&&q(Y)})}a(ye),a(_e),$(()=>{x(le,(e(F),i(()=>e(F).name))),x(ve,`(${e(F),i(()=>e(F).conditionName)??""})`),x(ie,(e(F),i(()=>e(F).description)))}),n(G,_e)}),a(I),a(p),n(Ue,p)};g(Re,Ue=>{e(y),i(()=>e(y).length>0)&&Ue(fe)})}var V=s(Re,2),M=s(l(V),4),We=s(M,2);{var Pe=Ue=>{var p=er();kt(p,5,()=>(t(),i(()=>t().activeStates)),$t,(I,G,F)=>{var _e=Zi(),Ae=l(_e),ne=l(Ae);Fe(ne);var le=s(ne,2);{var W=ze=>{var Ce=Xi();P("click",Ce,()=>Ee(F)),n(ze,Ce)};g(le,ze=>{f()&&ze(W)})}a(Ae);var ve=s(Ae,2),de=l(ve),ie=l(de);rt(ie,"for",`state-attack-bonus-${F}`);var ye=s(ie,2);Fe(ye),rt(ye,"id",`state-attack-bonus-${F}`),a(de);var Ie=s(de,2),He=l(Ie);rt(He,"for",`state-damage-bonus-${F}`);var X=s(He,2);Fe(X),rt(X,"id",`state-damage-bonus-${F}`),a(Ie);var _=s(Ie,2),Z=l(_);rt(Z,"for",`state-target-${F}`);var Y=s(Z,2);$(()=>{e(G),Ot(()=>{})}),rt(Y,"id",`state-target-${F}`);var q=l(Y);q.value=q.__value="self";var xe=s(q);xe.value=xe.__value="other",a(Y),a(_),a(ve);var Ze=s(ve,2),it=l(Ze);rt(it,"for",`state-desc-${F}`);var Ve=s(it,2);Fe(Ve),rt(Ve,"id",`state-desc-${F}`),a(Ze),a(_e),Qe(ne,()=>e(G).name,ze=>(e(G).name=ze,Ot(()=>t()),ja(m,"$character"))),Qe(ye,()=>e(G).attackBonus,ze=>(e(G).attackBonus=ze,Ot(()=>t()),ja(m,"$character"))),Qe(X,()=>e(G).damageBonus,ze=>(e(G).damageBonus=ze,Ot(()=>t()),ja(m,"$character"))),Ma(Y,()=>e(G).target,ze=>(e(G).target=ze,Ot(()=>t()),ja(m,"$character"))),Qe(Ve,()=>e(G).description,ze=>(e(G).description=ze,Ot(()=>t()),ja(m,"$character"))),n(I,_e)}),a(p),n(Ue,p)},Ye=Ue=>{var p=tr();n(Ue,p)};g(We,Ue=>{t(),i(()=>t().activeStates&&t().activeStates.length>0)?Ue(Pe):Ue(Ye,!1)})}a(V),P("click",M,qe),n(j,N)};g(gt,j=>{u(),i(()=>!u().attacks)&&j(dt)})}a(Oe);var at=s(Oe,2);ii(at,{get show(){return e(H)},get attacks(){return t(),i(()=>t().attacks)},onSave:J,onCancel:O}),$(()=>Ke=At(Oe,1,"attacks svelte-14o91c5",null,Ke,{hidden:!e(se)})),n(r,Le),Wt(),R()}var ir=d('<span class="slot-checkbox-x svelte-serp1j">&#8212;</span>'),rr=d('<label><input type="checkbox" class="slot-checkbox-input svelte-serp1j"/> <span><!></span></label>');function $s(r,c){qt(c,!1);const t=()=>pt(ya,"$isEditMode",v),[v,u]=sa();let f=vt(c,"checked",8,!1),m=vt(c,"disabled",8,!1),R=vt(c,"className",8,""),y=vt(c,"index",8,void 0),k=vt(c,"ariaLabel",8,void 0);const se=ba();function E(z){se("change",{checked:z.currentTarget.checked,index:y()})}Gt();var L=rr(),oe=l(L);Fe(oe);var be=s(oe,2),ue=l(be);{var H=z=>{var Te=ir();n(z,Te)};g(ue,z=>{f()&&z(H)})}a(be),a(L),$(()=>{At(L,1,"slot-checkbox-label "+R()+(t()?"":" not-editable"),"svelte-serp1j"),Rs(oe,f()),oe.disabled=m()||!t(),rt(oe,"aria-label",k()),rt(oe,"tabindex",t()?0:-1),At(be,1,`slot-checkbox-custom ${f()?"used":""} ${t()?"":"readonly"}`,"svelte-serp1j")}),P("change",oe,E),n(r,L),Wt(),u()}var nr=d('<p class="no-features svelte-1kpvv0n">Select a class to see available features</p>'),or=d('<p class="no-features svelte-1kpvv0n">No class features available at this level</p>'),cr=d('<div class="spell-slots svelte-1kpvv0n"><label class="svelte-1kpvv0n"> </label> <div class="slots-tracker svelte-1kpvv0n"></div></div>'),vr=d('<div class="all-spell-slots"></div>'),dr=d('<div class="feature-box spellcasting svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"> </h3> <div class="spell-stats svelte-1kpvv0n"><div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Spell Save DC</label> <div class="spell-value svelte-1kpvv0n"> </div></div> <div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <div class="spell-value svelte-1kpvv0n"> </div></div></div> <!> <div class="prepared-spells svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <textarea placeholder="List your prepared spells..." class="svelte-1kpvv0n"></textarea></div></div>'),ur=d('<p class="unlimited svelte-1kpvv0n">Unlimited Uses</p>'),fr=d('<div class="slots-tracker svelte-1kpvv0n"></div> <div class="uses-actions-row"><button class="btn btn-primary use-enabled"> </button></div> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div>',1),pr=d('<div class="uses-tracker svelte-1kpvv0n"><!></div>'),gr=d('<div class="pool-tracker svelte-1kpvv0n"><input type="number" min="0" class="pool-input svelte-1kpvv0n"/> <span> </span> <button class="btn-small svelte-1kpvv0n"> </button></div>'),mr=d('<p class="no-uses svelte-1kpvv0n">No Channel Divinity uses remaining</p>'),br=d('<div class="channel-divinity-option svelte-1kpvv0n"><button class="btn btn-primary use-enabled svelte-1kpvv0n">Use Channel Divinity</button> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div> <!></div>'),hr=d('<div class="feature-box svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"><!> </h3> <p class="feature-description svelte-1kpvv0n"> </p> <!></div>'),_r=d('<div class="features-grid svelte-1kpvv0n"><!> <!></div>'),yr=d("<section><!> <!></section>");function xr(r,c){qt(c,!1);const t=()=>pt(De,"$character",m),v=()=>pt(Fa,"$abilityModifiers",m),u=()=>pt(ma,"$searchFilter",m),f=()=>pt(Qt,"$collapsedStates",m),[m,R]=sa(),y=D(),k=D(),se=D(),E=D(),L=D(),oe=D(),be=D();let ue=D(0),H=D(0);function z(b,w){De.update(pe=>(pe.classFeatures.features[b]=w,pe))}function Te(){De.update(b=>(b.classFeatures.spellSlotsByLevel||(b.classFeatures.spellSlotsByLevel={}),e(E).forEach(({level:w,slots:pe})=>{b.classFeatures.spellSlotsByLevel[w]||(b.classFeatures.spellSlotsByLevel[w]=Array(pe).fill(!1))}),b))}function Ne(b){if(typeof b.maxUses=="function"){if((b.name==="Divine Sense"||b.name==="War Priest")&&e(y)?.spellcastingAbility){const w=v()[e(y).spellcastingAbility];return b.maxUses(t().level,w)}return b.maxUses(t().level)}return b.maxUses||0}function Xe(b,w){De.update(pe=>((!pe.classFeatures.features[b]||!Array.isArray(pe.classFeatures.features[b])||pe.classFeatures.features[b].length!==w)&&(pe.classFeatures.features[b]=Array(w).fill(!1)),pe))}Hs(()=>{e(oe)&&t()&&t().classFeatures&&t().classFeatures.features&&e(oe).forEach(b=>{if(b.type==="uses"){const w=b.name.replace(/\s+/g,""),pe=Ne(b),qe=t().classFeatures.features[w];(!Array.isArray(qe)||qe.length!==pe)&&Xe(w,pe)}})});function ce(b){return typeof b.maxPool=="function"?b.maxPool(t().level):b.maxPool||0}function Ge(b){return typeof b.description=="function"?b.description(t().level):b.description}function O(){const b="ChannelDivinity";De.update(w=>{const pe=w.classFeatures.features[b];return typeof pe=="number"&&pe>0&&(w.classFeatures.features[b]=pe-1),w})}function J(){Qt.update(b=>({...b,classFeatures:!b.classFeatures}))}et(()=>(t(),na),()=>{o(y,t().class?na(t().class):null)}),et(()=>(t(),Ca),()=>{o(k,t().class?Ca(t().class,t().level,t().subclass):[])}),et(()=>(t(),ys),()=>{o(se,t().class?ys(t().class,t().level):0)}),et(()=>(e(y),t()),()=>{o(E,(()=>{if(!e(y)?.spellcaster)return[];const b=t().level,w=[];return b>=1&&w.push({level:1,slots:Math.min(4,2+Math.floor(b/3))}),b>=3&&w.push({level:2,slots:Math.min(3,2+Math.floor((b-3)/4))}),b>=5&&w.push({level:3,slots:Math.min(3,2+Math.floor((b-5)/5))}),b>=7&&w.push({level:4,slots:Math.min(3,1+Math.floor((b-7)/6))}),b>=9&&w.push({level:5,slots:Math.min(2,1+Math.floor((b-9)/8))}),b>=11&&w.push({level:6,slots:1}),b>=13&&w.push({level:7,slots:1}),b>=15&&w.push({level:8,slots:1}),b>=17&&w.push({level:9,slots:1}),w})())}),et(()=>(e(y),v(),t(),xs),()=>{if(e(y)?.spellcaster&&e(y).spellcastingAbility){const b=v()[e(y).spellcastingAbility];o(ue,_l(t().class,b,t().proficiencyBonus)||0),o(H,xs(t().class,t().level,b))}}),et(()=>(t(),e(y),e(E)),()=>{t().class&&e(y)?.spellcaster&&e(E).length>0&&Te()}),et(()=>t(),()=>{o(L,(()=>{const w=t().classFeatures.features["ChannelDivinity"];return typeof w=="number"?w:0})())}),et(()=>(e(k),u()),()=>{o(oe,e(k).filter(b=>{if(!u())return!0;const w=u().toLowerCase();return b.name.toLowerCase().includes(w)||Ge(b).toLowerCase().includes(w)}))}),et(()=>(u(),t(),e(oe)),()=>{o(be,!u()||t().class||"class features".includes(u().toLowerCase())||"spellcasting".includes(u().toLowerCase())||e(oe).length>0)}),aa(),Gt();var ee=yr();let C;var T=l(ee);{let b=xt(()=>(f(),i(()=>f().classFeatures?"Expand":"Collapse")));ha(T,{title:"Class Features",get collapsed(){return f(),i(()=>f().classFeatures)},get ariaLabel(){return e(b)},onToggle:J})}var S=s(T,2);{var K=b=>{var w=ot(),pe=Be(w);{var qe=he=>{var Le=nr();n(he,Le)},Ee=he=>{var Le=ot(),Oe=Be(Le);{var Ke=gt=>{var dt=or();n(gt,dt)},nt=gt=>{var dt=_r(),at=l(dt);{var j=$e=>{var Q=dr(),A=l(Q),te=l(A);a(A);var we=s(A,2),je=l(we),ge=s(l(je),2),Re=l(ge,!0);a(ge),a(je);var fe=s(je,2),V=s(l(fe),2),M=l(V,!0);a(V),a(fe),a(we);var We=s(we,2);{var Pe=p=>{var I=vr();kt(I,5,()=>e(E),$t,(G,F)=>{let _e=()=>e(F).level,Ae=()=>e(F).slots;const ne=xt(()=>(t(),_e(),Ae(),i(()=>t().classFeatures.spellSlotsByLevel?.[_e()]||Array(Ae()).fill(!1))));var le=cr(),W=l(le),ve=l(W);a(W);var de=s(W,2);kt(de,5,()=>e(ne),$t,(ie,ye,Ie)=>{{let He=xt(()=>(B(e(ne)),i(()=>e(ne)[Ie]||!1)));$s(ie,{get checked(){return e(He)},$$events:{change:X=>{De.update(_=>(_.classFeatures.spellSlotsByLevel||(_.classFeatures.spellSlotsByLevel={}),_.classFeatures.spellSlotsByLevel[_e()]||(_.classFeatures.spellSlotsByLevel[_e()]=Array(Ae()).fill(!1)),_.classFeatures.spellSlotsByLevel[_e()][Ie]=X.detail.checked,_))}}})}}),a(de),a(le),$(()=>x(ve,`${_e()===1?"1st":_e()===2?"2nd":_e()===3?"3rd":`${_e()}th`} Level Spell Slots`)),n(G,le)}),a(I),n(p,I)};g(We,p=>{e(E),i(()=>e(E).length>0)&&p(Pe)})}var Ye=s(We,2),Ue=s(l(Ye),2);xa(Ue),a(Ye),a(Q),$(p=>{x(te,`Spellcasting (${p??""})`),x(Re,e(ue)),x(M,e(H))},[()=>(e(y),i(()=>e(y).spellcastingAbility?.toUpperCase()))]),Qe(Ue,()=>t().classFeatures.preparedSpells,p=>Mt(De,i(t).classFeatures.preparedSpells=p,i(t))),n($e,Q)};g(at,$e=>{e(y),i(()=>e(y)?.spellcaster)&&$e(j)})}var N=s(at,2);kt(N,1,()=>e(oe),$t,($e,Q)=>{const A=xt(()=>(e(Q),i(()=>e(Q).name.replace(/\s+/g,"")))),te=xt(()=>(t(),B(e(A)),i(()=>t().classFeatures.features[e(A)]))),we=xt(()=>typeof e(te)=="number");var je=hr(),ge=l(je),Re=l(ge);{var fe=p=>{var I=jt("Channel Divinity:");n(p,I)};g(Re,p=>{e(Q),i(()=>e(Q).type==="channelDivinity")&&p(fe)})}var V=s(Re);a(ge);var M=s(ge,2),We=l(M,!0);a(M);var Pe=s(M,2);{var Ye=p=>{const I=xt(()=>(e(Q),i(()=>Ne(e(Q))))),G=xt(()=>(B(e(te)),B(e(I)),i(()=>Array.isArray(e(te))?e(te):Array(e(I)).fill(!1))));var F=pr(),_e=l(F);{var Ae=le=>{var W=ur();n(le,W)},ne=le=>{var W=fr(),ve=Be(W);kt(ve,5,()=>e(G),$t,(_,Z,Y)=>{$s(_,{get checked(){return e(Z)},index:Y,$$events:{change:q=>{De.update(xe=>(xe.classFeatures.features[e(A)]||(xe.classFeatures.features[e(A)]=Array(e(I)).fill(!1)),xe.classFeatures.features[e(A)][Y]=q.detail.checked,xe))}}})}),a(ve);var de=s(ve,2),ie=l(de),ye=l(ie);a(ie),a(de);var Ie=s(de,2),He=l(Ie),X=l(He);a(He),a(Ie),$(_=>{ie.disabled=_,x(ye,`Use ${e(Q),i(()=>e(Q).name)??""}`),x(X,`Resets on ${e(Q),i(()=>e(Q).resetOn==="short"?"Short Rest":"Long Rest")??""}`)},[()=>(B(e(G)),i(()=>e(G).filter(_=>!_).length<=0))]),P("click",ie,()=>{De.update(_=>{_.classFeatures.features[e(A)]||(_.classFeatures.features[e(A)]=Array(e(I)).fill(!1));const Z=_.classFeatures.features[e(A)],Y=Z.findIndex(q=>!q);return Y!==-1&&(Z[Y]=!0),_})}),n(le,W)};g(_e,le=>{e(I)===1/0?le(Ae):le(ne,!1)})}a(F),n(p,F)},Ue=p=>{var I=ot(),G=Be(I);{var F=Ae=>{const ne=xt(()=>(e(Q),i(()=>ce(e(Q)))));var le=gr(),W=l(le);Fe(W);var ve=s(W,2),de=l(ve);a(ve);var ie=s(ve,2),ye=l(ie,!0);a(ie),a(le),$(()=>{ka(W,e(we)&&e(te)!==void 0?e(te):e(ne)),rt(W,"max",e(ne)),x(de,`/ ${e(ne)??""}`),x(ye,(e(Q),i(()=>e(Q).resetOn==="short"?"Short Rest":"Long Rest")))}),P("input",W,Ie=>{De.update(He=>(He.classFeatures.features[e(A)]=parseInt(Ie.currentTarget.value)||0,He))}),P("click",ie,()=>z(e(A),e(ne))),n(Ae,le)},_e=Ae=>{var ne=ot(),le=Be(ne);{var W=ve=>{var de=br(),ie=l(de),ye=s(ie,2),Ie=l(ye),He=l(Ie);a(Ie),a(ye);var X=s(ye,2);{var _=Z=>{var Y=mr();n(Z,Y)};g(X,Z=>{e(L)<=0&&Z(_)})}a(de),$(()=>{ie.disabled=e(L)<=0,x(He,`Resets on ${e(Q),i(()=>e(Q).resetOn==="short"?"Short Rest":"Long Rest")??""}`)}),P("click",ie,O),n(ve,de)};g(le,ve=>{e(Q),i(()=>e(Q).type==="channelDivinity")&&ve(W)},!0)}n(Ae,ne)};g(G,Ae=>{e(Q),i(()=>e(Q).type==="pool")?Ae(F):Ae(_e,!1)},!0)}n(p,I)};g(Pe,p=>{e(Q),i(()=>e(Q).type==="uses")?p(Ye):p(Ue,!1)})}a(je),$(p=>{x(V,` ${e(Q),i(()=>e(Q).name)??""}`),x(We,p)},[()=>(e(Q),i(()=>Ge(e(Q))))]),n($e,je)}),a(dt),n(gt,dt)};g(Oe,gt=>{e(k),i(()=>e(k).length===0)?gt(Ke):gt(nt,!1)},!0)}n(he,Le)};g(pe,he=>{t(),i(()=>!t().class)?he(qe):he(Ee,!1)})}n(b,w)};g(S,b=>{f(),i(()=>!f().classFeatures)&&b(K)})}a(ee),$(()=>C=At(ee,1,"class-features svelte-1kpvv0n",null,C,{hidden:!e(be)})),n(r,ee),Wt(),R()}var Sr=d('<span class="special-note-badge svelte-1ligci4">‚ú®</span>'),wr=d('<li class="svelte-1ligci4"><strong>Components:</strong> <!></li>'),kr=d('<li class="svelte-1ligci4"><strong>At Higher Levels:</strong> </li>'),$r=d('<ul class="svelte-1ligci4"><li class="svelte-1ligci4"><strong>Level:</strong> </li> <li class="svelte-1ligci4"><strong>Casting Time:</strong> </li> <li class="svelte-1ligci4"><strong>Range:</strong> </li> <!> <li class="svelte-1ligci4"><strong>Duration:</strong> <!> </li> <li class="svelte-1ligci4"><strong>Description:</strong> </li> <!></ul>'),Cr=d('<div class="special-notes-display svelte-1ligci4"><em> </em></div>'),Dr=d('<span class="scaled-damage svelte-1ligci4" style="margin-left: 8px;"> </span>'),Lr=d('<span class="scaled-damage svelte-1ligci4">(Half damage)</span>'),jr=d('<span class="scaled-damage svelte-1ligci4">(No damage)</span>'),Ar=d('<div class="target-condition svelte-1ligci4"><label class="svelte-1ligci4"><input type="checkbox" class="use-enabled svelte-1ligci4"/> <!> <!></label></div>'),Tr=d('<span class="scaled-damage svelte-1ligci4"> </span>'),Rr=d('<span class="scaled-damage svelte-1ligci4"> </span>'),Br=d('<div class="target-condition svelte-1ligci4"><label class="svelte-1ligci4"><input type="checkbox" class="use-enabled svelte-1ligci4"/> Target is missing HP <!></label></div>'),Pr=d("<option> </option>"),Mr=d('<span class="scaled-damage svelte-1ligci4">(+1d8 extra damage)</span>'),Ur=d('<div class="target-condition svelte-1ligci4"><label class="svelte-1ligci4"><input type="checkbox" class="use-enabled svelte-1ligci4"/> Target is Fiend or Undead <!></label></div>'),Fr=d('<div class="spell-level-selector svelte-1ligci4"><label for="castLevel" class="svelte-1ligci4">Cast at Level:</label> <select id="castLevel" class="spell-level-select use-enabled svelte-1ligci4"></select></div> <!>',1),Ir=d('<div class="spell-level-selector svelte-1ligci4"><span style="color: #dc3545; font-weight: bold;">No spell slots available!</span></div>'),Er=d('<button class="btn btn-primary use-enabled">Roll Attack</button>'),Hr=d('<div class="buff-target-selection svelte-1ligci4"><div class="target-options svelte-1ligci4"><label class="target-option svelte-1ligci4"><input type="radio" name="target-spell" class="svelte-1ligci4"/> Self</label> <label class="target-option svelte-1ligci4"><input type="radio" name="target-spell" class="svelte-1ligci4"/> Other</label></div> <button> </button></div>'),Nr=d("<button> </button>"),Or=d("<button><!></button>"),Gr=d('<div class="spell-card svelte-1ligci4"><div class="spell-header svelte-1ligci4"><h3 class="spell-name-header svelte-1ligci4"> </h3> <!></div> <div class="spell-type svelte-1ligci4"><input type="text" readonly="" class="type-display svelte-1ligci4"/></div> <div class="spell-info svelte-1ligci4"><div class="spell-info-header svelte-1ligci4" role="button" tabindex="0"><h4 class="svelte-1ligci4">Spell Info</h4> <button class="collapse-btn-small svelte-1ligci4"> </button></div> <!></div> <!> <!> <!> <!> <div class="spell-actions svelte-1ligci4"><!></div></div>');function qr(r,c){qt(c,!1);const t=()=>pt(De,"$character",v),[v,u]=sa(),f=D(),m=D(),R=D(),y=D(),k=D(),se=D(),E=[];let L=vt(c,"spell",8),oe=vt(c,"spellName",8),be=vt(c,"specialNotes",8,void 0),ue=vt(c,"castAtLevel",8,void 0),H=vt(c,"targetSucceededSave",12,!1),z=vt(c,"targetIsDamaged",12,!1),Te=vt(c,"targetIsFiendOrUndead",12,!1),Ne=vt(c,"spellTarget",12,"self"),Xe=vt(c,"availableLevels",24,()=>[]),ce=vt(c,"showLevelSelector",8,!0),Ge=vt(c,"hideComponents",8,!1);vt(c,"isEditMode",8,!1);let O=vt(c,"showTargetOptions",8,!0),J=vt(c,"forceUtilityMode",8,!1),ee=vt(c,"disabled",8,!1);const C=ba();let T=D(!0);function S(){o(T,!e(T))}function K(I){const G=I.target;C("castLevelChange",{level:parseInt(G.value)})}function b(){C("rollAttack")}function w(){C("rollDamage")}function pe(){console.log("SpellCard: handleCastSpell called, dispatching event"),C("castSpell",{target:Ne()})}function qe(I){return I.description.toLowerCase().includes("regain")&&(I.description.toLowerCase().includes("hit point")||I.description.toLowerCase().includes("hp"))}function Ee(I){return["Shield of Faith","Bless","Aid","Magic Weapon"].includes(I)}et(()=>B(L()),()=>{o(f,Ta(L()))}),et(()=>B(L()),()=>{o(m,za(L()))}),et(()=>B(L()),()=>{o(R,Wa(L()))}),et(()=>B(L()),()=>{o(y,cs(L()))}),et(()=>B(L()),()=>{o(k,qe(L()))}),et(()=>B(L()),()=>{o(se,Ee(L().name))}),aa(),Gt();var he=Gr(),Le=l(he),Oe=l(Le),Ke=l(Oe,!0);a(Oe);var nt=s(Oe,2);{var gt=I=>{var G=Sr();$(()=>rt(G,"title",be())),n(I,G)};g(nt,I=>{be()&&I(gt)})}a(Le);var dt=s(Le,2),at=l(dt);Fe(at),a(dt);var j=s(dt,2),N=l(j),$e=s(l(N),2),Q=l($e,!0);a($e),a(N);var A=s(N,2);{var te=I=>{var G=$r(),F=l(G),_e=s(l(F));a(F);var Ae=s(F,2),ne=s(l(Ae));a(Ae);var le=s(Ae,2),W=s(l(le));a(le);var ve=s(le,2);{var de=q=>{var xe=wr(),Ze=s(l(xe)),it=s(Ze);{var Ve=ze=>{var Ce=jt();$(()=>x(Ce,`(${B(L()),i(()=>L().material)??""})`)),n(ze,Ce)};g(it,ze=>{B(L()),i(()=>L().material)&&ze(Ve)})}a(xe),$(ze=>x(Ze,` ${ze??""}`),[()=>(B(L()),i(()=>L().components.join(", ")))]),n(q,xe)};g(ve,q=>{Ge()||q(de)})}var ie=s(ve,2),ye=s(l(ie),2);{var Ie=q=>{var xe=jt("Concentration,");n(q,xe)};g(ye,q=>{B(L()),i(()=>L().concentration)&&q(Ie)})}var He=s(ye,1,!0);a(ie);var X=s(ie,2),_=s(l(X));a(X);var Z=s(X,2);{var Y=q=>{var xe=kr(),Ze=s(l(xe));a(xe),$(()=>x(Ze,` ${B(L()),i(()=>L().higherLevelSlot)??""}`)),n(q,xe)};g(Z,q=>{B(L()),i(()=>L().higherLevelSlot)&&q(Y)})}a(G),$(()=>{x(_e,` ${B(L()),i(()=>L().level)??""}`),x(ne,` ${B(L()),i(()=>L().castingTime||L().actionType)??""}`),x(W,` ${B(L()),i(()=>L().range)??""}`),x(He,(B(L()),i(()=>L().duration))),x(_,` ${B(L()),i(()=>L().description)??""}`)}),n(I,G)};g(A,I=>{e(T)||I(te)})}a(j);var we=s(j,2);{var je=I=>{var G=Cr(),F=l(G),_e=l(F,!0);a(F),a(G),$(()=>x(_e,be())),n(I,G)};g(we,I=>{be()&&I(je)})}var ge=s(we,2);{var Re=I=>{var G=Ar(),F=l(G),_e=l(F);Fe(_e);var Ae=s(_e),ne=s(Ae);{var le=ie=>{var ye=Dr(),Ie=l(ye);a(ye),$(He=>x(Ie,`(Spell Save DC: ${He??""})`),[()=>(B(Ua),t(),i(()=>Ua(t(),t().abilities)))]),n(ie,ye)};g(ne,ie=>{t(),i(()=>t().class)&&ie(le)})}var W=s(ne,2);{var ve=ie=>{var ye=Lr();n(ie,ye)},de=ie=>{var ye=ot(),Ie=Be(ye);{var He=X=>{var _=jr();n(X,_)};g(Ie,X=>{B(H()),e(f),i(()=>H()&&e(f).noDamageOnSave)&&X(He)},!0)}n(ie,ye)};g(W,ie=>{B(H()),e(f),i(()=>H()&&e(f).halfDamageOnSave)?ie(ve):ie(de,!1)})}a(F),a(G),$(ie=>x(Ae,` Target succeeded on ${ie??""} save `),[()=>(e(f),i(()=>e(f).ability.charAt(0).toUpperCase()+e(f).ability.slice(1)))]),ga(_e,H),n(I,G)};g(ge,I=>{e(f)&&I(Re)})}var fe=s(ge,2);{var V=I=>{var G=Br(),F=l(G),_e=l(F);Fe(_e);var Ae=s(_e,2);{var ne=W=>{var ve=Tr(),de=l(ve);a(ve),$(()=>x(de,`(${e(m),i(()=>e(m).alternateDamage)??""}, scaled with higher levels)`)),n(W,ve)},le=W=>{var ve=Rr(),de=l(ve);a(ve),$(()=>x(de,`(${e(m),i(()=>e(m).baseDamage)??""})`)),n(W,ve)};g(Ae,W=>{z()?W(ne):W(le,!1)})}a(F),a(G),ga(_e,z),n(I,G)};g(fe,I=>{e(m)&&I(V)})}var M=s(fe,2);{var We=I=>{var G=ot(),F=Be(G);{var _e=ne=>{var le=Fr(),W=Be(le),ve=s(l(W),2);kt(ve,5,Xe,$t,(Ie,He)=>{var X=Pr(),_=l(X);a(X);var Z={};$(()=>{x(_,`Level ${e(He)??""}`),Z!==(Z=e(He))&&(X.value=(X.__value=e(He))??"")}),n(Ie,X)}),a(ve);var de;Ja(ve),a(W);var ie=s(W,2);{var ye=Ie=>{var He=Ur(),X=l(He),_=l(X);Fe(_);var Z=s(_,2);{var Y=q=>{var xe=Mr();n(q,xe)};g(Z,q=>{Te()&&q(Y)})}a(X),a(He),ga(_,Te),n(Ie,He)};g(ie,Ie=>{B(L()),i(()=>L().description.includes("Fiend or an Undead"))&&Ie(ye)})}$(()=>{de!==(de=(B(ue()),B(L()),i(()=>ue()||L().level)))&&(ve.value=(ve.__value=(B(ue()),B(L()),i(()=>ue()||L().level)))??"",Pa(ve,(B(ue()),B(L()),i(()=>ue()||L().level))))}),P("change",ve,K),n(ne,le)},Ae=ne=>{var le=Ir();n(ne,le)};g(F,ne=>{B(Xe()),i(()=>Xe().length>0)?ne(_e):ne(Ae,!1)})}n(I,G)};g(M,I=>{B(L()),B(ce()),i(()=>L().higherLevelSlot&&L().level>0&&ce())&&I(We)})}var Pe=s(M,2),Ye=l(Pe);{var Ue=I=>{var G=Er();P("click",G,b),n(I,G)},p=I=>{var G=ot(),F=Be(G);{var _e=ne=>{var le=ot(),W=Be(le);{var ve=ie=>{var ye=Hr(),Ie=l(ye),He=l(Ie),X=l(He);Fe(X),X.value=X.__value="self",Yt(),a(He);var _=s(He,2),Z=l(_);Fe(Z),Z.value=Z.__value="other",Yt(),a(_),a(Ie);var Y=s(Ie,2);let q;var xe=l(Y);a(Y),a(ye),$(()=>{q=At(Y,1,"btn btn-info use-enabled svelte-1ligci4",null,q,{"disabled-button":ee()}),Y.disabled=ee(),x(xe,`Cast ${B(L()),i(()=>L().name)??""}`)}),Ka(E,[],X,Ne,Ne),Ka(E,[],Z,Ne,Ne),P("click",Y,pe),n(ie,ye)},de=ie=>{var ye=Nr();let Ie;var He=l(ye);a(ye),$(()=>{Ie=At(ye,1,"btn btn-info use-enabled svelte-1ligci4",null,Ie,{"disabled-button":ee()}),ye.disabled=ee(),x(He,`Cast ${B(L()),i(()=>L().name)??""}`)}),P("click",ye,pe),n(ie,ye)};g(W,ie=>{e(se)&&O()&&!J()?ie(ve):ie(de,!1)})}n(ne,le)},Ae=ne=>{var le=Or(),W=l(le);{var ve=ie=>{var ye=jt("Roll Healing");n(ie,ye)},de=ie=>{var ye=jt("Roll Damage");n(ie,ye)};g(W,ie=>{e(k)?ie(ve):ie(de,!1)})}a(le),$(()=>At(le,1,`btn ${e(k)?"btn-success":"btn-secondary"} use-enabled`)),P("click",le,w),n(ne,le)};g(F,ne=>{e(y)||J()?ne(_e):ne(Ae,!1)},!0)}n(I,G)};g(Ye,I=>{e(R)?I(Ue):I(p,!1)})}a(Pe),a(he),$(()=>{x(Ke,oe()),ka(at,`${B(L()),i(()=>L().school)??""} (Lvl ${B(L()),i(()=>L().level)??""})`),rt($e,"aria-label",e(T)?"Expand":"Collapse"),x(Q,e(T)?"‚ñº":"‚ñ≤")}),P("click",N,S),P("keydown",N,I=>I.key==="Enter"&&S()),n(r,he),Wt(),u()}var Wr=d('<div class="shared-uses svelte-19b5nmj"><span class="uses-label svelte-19b5nmj">Shared Uses:</span> <span class="uses-count svelte-19b5nmj"> </span> <span class="rest-type svelte-19b5nmj"> </span> <button class="reset-button svelte-19b5nmj" title="Reset uses">‚Üª</button></div>'),zr=d('<div><!> <div class="usage-info svelte-19b5nmj"><span class="uses-display svelte-19b5nmj"> </span></div></div>'),Jr=d('<div class="spell-missing svelte-19b5nmj"> </div>'),Kr=d('<div class="spell-loading svelte-19b5nmj"> </div>'),Vr=d('<div class="racial-trait svelte-19b5nmj"><div class="trait-header svelte-19b5nmj"><h3 class="trait-name svelte-19b5nmj"> </h3> <div class="trait-stats svelte-19b5nmj"><span class="stat svelte-19b5nmj" title="Spell Attack Bonus"> </span> <span class="stat svelte-19b5nmj" title="Spell Save DC"> </span> <span class="stat ability-indicator svelte-19b5nmj" title="Spellcasting Ability"> </span></div></div> <p class="trait-description svelte-19b5nmj"> </p> <!> <div class="spells-list svelte-19b5nmj"></div></div>'),Yr=d('<div class="traits-container svelte-19b5nmj"></div>'),Qr=d('<section class="racial-traits svelte-19b5nmj"><!> <!></section>');function Xr(r,c){qt(c,!1);const t=()=>pt(De,"$character",f),v=()=>pt(Fa,"$abilityModifiers",f),u=()=>pt(Qt,"$collapsedStates",f),[f,m]=sa(),R=D();let y=[],k=D(!1);Sa(async()=>{y=await ps(),o(k,!0),console.log("Racial Traits: Loaded",y.length,"spells"),console.log("Looking for: Mage Hand, Jump, Misty Step"),console.log("Mage Hand found?",y.find(O=>O.name.toLowerCase()==="mage hand")),console.log("Jump found?",y.find(O=>O.name.toLowerCase()==="jump")),console.log("Misty Step found?",y.find(O=>O.name.toLowerCase()==="misty step"))});function se(O){const J=y.find(ee=>ee.name.toLowerCase()===O.toLowerCase());return J||console.log("Spell not found:",O,"Available spells:",y.length),J}function E(O){return v()[O.castingAbility]||0}function L(O){return E(O)+t().proficiencyBonus}function oe(O){return 8+E(O)+t().proficiencyBonus}function be(O,J){return J.usesPerRest==="at-will"?!0:J.consumesTraitUse?(O.currentUses??0)>0:(J.currentUses??0)>0}function ue(O,J){console.log("useSpell called",{traitIndex:O,spellIndex:J}),De.update(ee=>{if(console.log("Character update function called",ee.racialTraits),!ee.racialTraits)return ee;const C=ee.racialTraits[O],T=C.spells[J];if(console.log("Trait:",C,"Spell:",T),T.usesPerRest==="at-will")return console.log("At-will spell, not consuming uses"),ee;const S=[...ee.racialTraits];if(T.consumesTraitUse&&C.currentUses!==void 0)console.log("Spell consumes trait use. Current uses:",C.currentUses),C.currentUses>0&&(S[O]={...C,currentUses:C.currentUses-1},console.log("Decremented trait uses to:",C.currentUses-1));else if(T.currentUses!==void 0&&T.currentUses>0){console.log("Spell has separate uses. Current:",T.currentUses);const K=[...C.spells];K[J]={...T,currentUses:T.currentUses-1},S[O]={...C,spells:K},console.log("Decremented spell uses to:",T.currentUses-1)}return{...ee,racialTraits:S}})}function H(O){De.update(J=>{if(!J.racialTraits)return J;const ee=J.racialTraits[O];return ee.usesPerRest!==void 0&&(J.racialTraits[O]={...ee,currentUses:ee.usesPerRest}),ee.spells.forEach((C,T)=>{C.usesPerRest!=="at-will"&&!C.consumesTraitUse&&typeof C.usesPerRest=="number"&&(J.racialTraits[O].spells[T]={...C,currentUses:C.usesPerRest})}),J})}function z(O,J){if(J.usesPerRest==="at-will")return"At will";if(J.consumesTraitUse){const ee=O.currentUses??0,C=O.usesPerRest??0;return`${ee}/${C} uses`}return typeof J.usesPerRest=="number"?`${J.currentUses??0}/${J.usesPerRest} uses`:""}function Te(O,J){if(J.usesPerRest==="at-will")return"";const ee=J.consumesTraitUse?O.restType:J.restType;return ee?` (${ee} rest)`:""}function Ne(O,J){console.log("handleCastSpell called",O,J);const ee=t().racialTraits?.[O];if(!ee)return;const C=ee.spells[J],T=y.find(S=>S.name.toLowerCase()===C.spellName.toLowerCase());T&&It.add(`Cast ${T.name}`,"success"),ue(O,J)}et(()=>t(),()=>{o(R,t().racialTraits||[])}),aa(),Gt();var Xe=ot(),ce=Be(Xe);{var Ge=O=>{var J=Qr(),ee=l(J);{let S=xt(()=>(u(),i(()=>u().racialTraits?"Expand":"Collapse")));ha(ee,{title:"Racial Traits",get collapsed(){return u(),i(()=>u().racialTraits)},get ariaLabel(){return e(S)},onToggle:()=>Qt.update(K=>({...K,racialTraits:!K.racialTraits}))})}var C=s(ee,2);{var T=S=>{var K=Yr();kt(K,5,()=>e(R),$t,(b,w,pe)=>{var qe=ot(),Ee=Be(qe);{var he=Le=>{var Oe=Vr(),Ke=l(Oe),nt=l(Ke),gt=l(nt,!0);a(nt);var dt=s(nt,2),at=l(dt),j=l(at);a(at);var N=s(at,2),$e=l(N);a(N);var Q=s(N,2),A=l(Q,!0);a(Q),a(dt),a(Ke);var te=s(Ke,2),we=l(te,!0);a(te);var je=s(te,2);{var ge=fe=>{var V=Wr(),M=s(l(V),2),We=l(M);a(M);var Pe=s(M,2),Ye=l(Pe);a(Pe);var Ue=s(Pe,2);a(V),$(()=>{x(We,`${e(w),i(()=>e(w).currentUses??0)??""}/${e(w),i(()=>e(w).usesPerRest)??""}`),x(Ye,`(${e(w),i(()=>e(w).restType)??""} rest)`),Ue.disabled=(e(w),i(()=>e(w).currentUses===e(w).usesPerRest))}),P("click",Ue,()=>H(pe)),n(fe,V)};g(je,fe=>{e(w),i(()=>e(w).usesPerRest)&&fe(ge)})}var Re=s(je,2);kt(Re,5,()=>(e(w),i(()=>e(w).spells)),$t,(fe,V,M)=>{var We=ot(),Pe=Be(We);{var Ye=p=>{const I=xt(()=>(e(V),i(()=>se(e(V).spellName)))),G=xt(()=>(e(w),e(V),i(()=>be(e(w),e(V)))));var F=ot(),_e=Be(F);{var Ae=le=>{var W=zr();let ve;var de=l(W);{let He=xt(()=>(e(w),i(()=>!e(w).requiresComponents))),X=xt(()=>!e(G));qr(de,{get spell(){return e(I)},get spellName(){return e(V),i(()=>e(V).spellName)},get specialNotes(){return e(V),i(()=>e(V).specialNotes)},get hideComponents(){return e(He)},showLevelSelector:!1,showTargetOptions:!1,forceUtilityMode:!0,get disabled(){return e(X)},availableLevels:[],$$events:{castSpell:()=>e(G)&&Ne(pe,M)}})}var ie=s(de,2),ye=l(ie),Ie=l(ye);a(ye),a(ie),a(W),$((He,X)=>{ve=At(W,1,"spell-wrapper svelte-19b5nmj",null,ve,{unavailable:!e(G)}),x(Ie,`${He??""}${X??""}`)},[()=>(e(w),e(V),i(()=>z(e(w),e(V)))),()=>(e(w),e(V),i(()=>Te(e(w),e(V))))]),n(le,W)},ne=le=>{var W=Jr(),ve=l(W);a(W),$(()=>x(ve,`Spell "${e(V),i(()=>e(V).spellName)??""}" not found`)),n(le,W)};g(_e,le=>{e(I)?le(Ae):le(ne,!1)})}n(p,F)},Ue=p=>{var I=Kr(),G=l(I);a(I),$(()=>x(G,`Loading ${e(V),i(()=>e(V).spellName)??""}...`)),n(p,I)};g(Pe,p=>{e(k)?p(Ye):p(Ue,!1)})}n(fe,We)}),a(Re),a(Oe),$((fe,V,M)=>{x(gt,(e(w),i(()=>e(w).name))),x(j,`Attack: +${fe??""}`),x($e,`DC: ${V??""}`),x(A,M),x(we,(e(w),i(()=>e(w).description)))},[()=>(e(w),i(()=>L(e(w)))),()=>(e(w),i(()=>oe(e(w)))),()=>(e(w),i(()=>e(w).castingAbility.charAt(0).toUpperCase()+e(w).castingAbility.slice(1,3).toUpperCase()))]),n(Le,Oe)};g(Ee,Le=>{e(w),i(()=>e(w).spells.length>0)&&Le(he)})}n(b,qe)}),a(K),n(S,K)};g(C,S=>{u(),i(()=>!u().racialTraits)&&S(T)})}a(J),n(O,J)};g(ce,O=>{e(R),i(()=>e(R).length>0)&&O(Ge)})}n(r,Xe),Wt(),m()}var Zr=d('<textarea placeholder="Enter features, traits, and special abilities..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Equipment</h3> <textarea placeholder="List your equipment and inventory..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Notes</h3> <textarea placeholder="Additional notes..." class="svelte-wttn0l"></textarea>',1),en=d("<section><!> <!></section>");function tn(r,c){qt(c,!1);const t=()=>pt(ma,"$searchFilter",f),v=()=>pt(De,"$character",f),u=()=>pt(Qt,"$collapsedStates",f),[f,m]=sa(),R=D();function y(){Qt.update(be=>({...be,notes:!be.notes}))}et(()=>(t(),v()),()=>{o(R,!t()||"features".includes(t().toLowerCase())||"traits".includes(t().toLowerCase())||"equipment".includes(t().toLowerCase())||"notes".includes(t().toLowerCase())||v().features.toLowerCase().includes(t().toLowerCase())||v().equipment.toLowerCase().includes(t().toLowerCase())||v().notes.toLowerCase().includes(t().toLowerCase()))}),aa(),Gt();var k=en();let se;var E=l(k);{let be=xt(()=>(u(),i(()=>u().notes?"Expand":"Collapse")));ha(E,{title:"Features & Traits",get collapsed(){return u(),i(()=>u().notes)},get ariaLabel(){return e(be)},onToggle:y})}var L=s(E,2);{var oe=be=>{var ue=Zr(),H=Be(ue);xa(H);var z=s(H,4);xa(z);var Te=s(z,4);xa(Te),Qe(H,()=>v().features,Ne=>Mt(De,i(v).features=Ne,i(v))),Qe(z,()=>v().equipment,Ne=>Mt(De,i(v).equipment=Ne,i(v))),Qe(Te,()=>v().notes,Ne=>Mt(De,i(v).notes=Ne,i(v))),n(be,ue)};g(L,be=>{u(),i(()=>!u().notes)&&be(oe)})}a(k),$(()=>se=At(k,1,"notes svelte-wttn0l",null,se,{hidden:!e(R)})),n(r,k),Wt(),m()}var an=d(" <!> <!> <!> <!> <!>",1),sn=d('<div class="color-picker-section svelte-1r90jgp"><h3 class="svelte-1r90jgp">Dice Colors</h3> <div class="color-inputs svelte-1r90jgp"><div class="color-input-group svelte-1r90jgp"><label for="dice-color" class="svelte-1r90jgp">Dice Color</label> <input type="color" id="dice-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="label-color" class="svelte-1r90jgp">Label Color</label> <input type="color" id="label-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="desk-color" class="svelte-1r90jgp">Background Color</label> <input type="color" id="desk-color" class="svelte-1r90jgp"/></div></div></div>'),ln=d('<div class="loading svelte-1r90jgp"><p class="svelte-1r90jgp">Loading 3D dice...</p></div>'),rn=d('<div class="custom-dice-selector svelte-1r90jgp"><h3 class="svelte-1r90jgp">Choose Dice to Roll</h3> <div class="dice-inputs svelte-1r90jgp"><div class="dice-input-group svelte-1r90jgp"><label for="d4" class="svelte-1r90jgp">d4</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d4" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d6" class="svelte-1r90jgp">d6</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d6" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d8" class="svelte-1r90jgp">d8</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d8" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d10" class="svelte-1r90jgp">d10</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d10" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d12" class="svelte-1r90jgp">d12</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d12" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d20" class="svelte-1r90jgp">d20</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d20" min="0" max="10"/></div></div> <div class="dice-controls svelte-1r90jgp"><button class="btn btn-primary use-enabled svelte-1r90jgp"> </button> <button class="btn btn-secondary use-enabled svelte-1r90jgp">Reset</button></div></div>'),nn=d('<h3 class="svelte-1r90jgp"> </h3>'),on=d('<h3 class="svelte-1r90jgp"> </h3>'),cn=d('<h3 class="svelte-1r90jgp"> </h3>'),vn=d('<h3 class="svelte-1r90jgp"> </h3>'),dn=d('<span class="crit-badge svelte-1r90jgp">CRITICAL HIT!</span>'),un=d('<span class="crit-badge crit-fail svelte-1r90jgp">CRITICAL MISS!</span>'),fn=d('<div class="bonus-item svelte-1r90jgp"><span class="bonus-value svelte-1r90jgp"> </span> <span class="bonus-source svelte-1r90jgp"> </span></div>'),pn=d('<div class="bonus-breakdown svelte-1r90jgp"></div>'),gn=d('<p class="modifier-text svelte-1r90jgp"> </p>'),mn=d('<div class="svelte-1r90jgp"><em class="svelte-1r90jgp">No damage is dealt on a critical miss.</em></div>'),bn=d('<button class="btn btn-follow-up svelte-1r90jgp"> </button>'),hn=d('<button class="btn btn-guided-strike svelte-1r90jgp">‚ö° Use Guided Strike (+10)</button>'),_n=d('<div class="follow-up-actions svelte-1r90jgp"><!> <!></div>'),yn=d('<div class="result-header svelte-1r90jgp"><!> <!> <!></div> <div class="result-total svelte-1r90jgp"> </div> <div class="result-details svelte-1r90jgp"><!></div> <!> <!>',1),xn=d('<div role="button" tabindex="-1"><div class="modal-content svelte-1r90jgp" role="dialog" tabindex="0"><div class="modal-header svelte-1r90jgp"><h2 class="svelte-1r90jgp"><!></h2> <div class="header-buttons svelte-1r90jgp"><button class="color-btn svelte-1r90jgp" title="Customize dice colors">üé®</button> <button class="close-btn svelte-1r90jgp">√ó</button></div></div> <!> <!> <div class="dice-main-area svelte-1r90jgp"><div class="dice-container svelte-1r90jgp"></div> <!></div> <div><!></div></div></div>');function Sn(r,c){qt(c,!1);const t=()=>pt(De,"$character",v),[v,u]=sa(),f=D(),m=D(),R=D(),y=ba();let k=vt(c,"notation",12,""),se=vt(c,"visible",8,!1),E=vt(c,"damageNotation",12,""),L=vt(c,"damageType",8,""),oe=vt(c,"attackName",12,""),be=vt(c,"applyHalfDamage",8,!1),ue=vt(c,"bonusBreakdown",28,()=>[]),H=vt(c,"rollType",12,"other"),z=null,Te=D(void 0),Ne=D(!1),Xe=D(""),ce=D(null);function Ge(){return e(ce)?.resultTotal??null}function O(_,Z,Y){const q=[];if(!_||!_.result)return q;const xe=Z.match(/([+-]?\d*d\d+|[+-]?\d+)/g)||[];let Ze=0;const it=new Set;for(const Ve of xe){const ze=Ve.trim();if(!ze)continue;const Ce=ze.match(/([+-]?)(\d*)d(\d+)/);if(Ce){const ae=parseInt(Ce[2]||"1"),Je=`${ae}d${Ce[3]}`,mt=Y.findIndex((me,Dt)=>!it.has(Dt)&&typeof me.value=="string"&&me.value===Je),st=[];for(let me=0;me<ae&&Ze<_.result.length;me++)st.push(_.result[Ze++]);const ct=mt>=0?Y[mt].source:"base die";mt>=0&&it.add(mt);for(const me of st)q.push({display:`${me}`,source:ct})}}for(let Ve=0;Ve<Y.length;Ve++)if(!it.has(Ve)&&typeof Y[Ve].value=="number"){const ze=Y[Ve].value;q.push({display:ze>=0?`+${ze}`:`${ze}`,source:Y[Ve].source})}return q}let J=D(0),ee=D(0),C=D(0),T=D(0),S=D(0),K=D(0),b=D(0),w=D([]),pe=D(!1),qe=D(!1),Ee=D(!1),he=D("#051e0a"),Le=D("#ffffff"),Oe=D("#3a2004"),Ke=D(!1);function nt(_){return _.length===9&&_.startsWith("#")?_.substring(0,7):_}function gt(_,Z="ff"){return _.length===7&&_.startsWith("#")?_+Z:_}function dt(){if(window.DICE&&e(Te))try{z&&e(Te)&&pa(Te,e(Te).innerHTML="");const _=e(Te).clientWidth||500,Z=e(Te).clientHeight||300;z=new window.DICE.dice_box(e(Te),{w:_,h:Z}),o(Ne,!0)}catch(_){console.error("Error initializing dice box:",_)}}Sa(()=>{const _=q=>new Promise((xe,Ze)=>{if(document.querySelector(`script[src="${q}"]`)){xe(null);return}const Ve=document.createElement("script");Ve.src=q,Ve.onload=()=>{xe(null)},Ve.onerror=()=>{console.error(`Failed to load: ${q}`),Ze(new Error(`Failed to load ${q}`))},document.head.appendChild(Ve)});setTimeout(()=>{_(`${Aa}/libs/three.min.js`).then(()=>_(`${Aa}/libs/cannon.min.js`)).then(()=>_(`${Aa}/libs/teal.js`)).then(()=>_(`${Aa}/dice.js`)).then(()=>{if(window.DICE){const q=window.DICE.getColors();o(he,nt(q.dice_color)),o(Le,nt(q.label_color)),o(Oe,nt(q.desk_color))}dt()}).catch(q=>{console.error("Failed to load dice libraries:",q)})},100);const Z=()=>{e(Ne)&&dt()},Y=q=>{se()&&q.key==="Escape"&&je()};return window.addEventListener("resize",Z),window.addEventListener("keydown",Y),()=>{window.removeEventListener("resize",Z),window.removeEventListener("keydown",Y)}});function at(_,Z="other"){if(!z||!e(Ne))return;o(ce,null),o(w,[]),o(pe,!1),o(qe,!1),Z==="damage"&&ue([]),H(Z),o(Ee,!1),z.diceToRoll=_;const Y=xe=>null,q=xe=>{let Ze=xe.resultTotal,it=xe.resultString;if(be()&&(Ze=Math.floor(Ze/2),it=it+" (halved)"),o(ce,{...xe,resultTotal:Ze,resultString:it}),console.log("Final roll result:",e(ce)),console.log({type:Z}),Z==="attack"&&xe.result&&xe.result.length>0){const Ve=xe.result[0];o(pe,Ve===20),o(qe,Ve===1)}if(o(w,[]),console.log("Setting up follow-up actions. Type:",Z,"damageNotation:",E(),"isCriticalSuccess:",e(pe),"isCriticalFail:",e(qe)),Z==="attack"&&E())if(e(pe)){const Ve=$e(E());e(w).push({label:`Roll Critical Damage (${Ve})`,notation:Ve})}else e(qe)||e(w).push({label:`Roll Damage (${E()})`,notation:E()})};z.start_throw(Y,q)}function j(){const _=[];e(J)>0&&_.push(`${e(J)}d4`),e(ee)>0&&_.push(`${e(ee)}d6`),e(C)>0&&_.push(`${e(C)}d8`),e(T)>0&&_.push(`${e(T)}d10`),e(S)>0&&_.push(`${e(S)}d12`),e(K)>0&&_.push(`${e(K)}d20`);let Z=_.join("+")||"1d20";return e(b)!==0&&(Z+=e(b)>=0?`+${e(b)}`:`${e(b)}`),Z}function N(){const _=j();at(_)}function $e(_){return _.replace(/(\d+)d(\d+)/g,(Z,Y,q)=>`${parseInt(Y)*2}d${q}`)}function Q(){o(J,0),o(ee,0),o(C,0),o(T,0),o(S,0),o(K,0),o(b,0),o(ce,null),o(w,[]),o(pe,!1),o(qe,!1),H("other"),o(Ee,!1)}function A(){window.DICE&&(window.DICE.setColors({dice_color:gt(e(he),"ff"),label_color:gt(e(Le),"ff"),desk_color:e(Oe)}),z&&(z.updateDeskColor(e(Oe)),z.updateDiceColors()))}function te(){o(Ke,!e(Ke))}function we(){!e(ce)||e(m)<=0||e(Ee)||(o(ce,{...e(ce),resultTotal:e(ce).resultTotal+10,resultString:e(ce).resultString+" + 10 (Guided Strike)"}),De.update(_=>{const Z="ChannelDivinity",Y=_.classFeatures.features[Z];return typeof Y=="number"&&Y>0&&(_.classFeatures.features[Z]=Y-1),_}),o(Ee,!0))}function je(){y("close"),k(""),E(""),oe(""),o(Xe,""),o(ce,null),o(Ee,!1),o(pe,!1),o(qe,!1),Q()}et(()=>(t(),Ca),()=>{o(f,t().class?Ca(t().class,t().level,t().subclass).some(Z=>Z.name==="Guided Strike"):!1)}),et(()=>t(),()=>{o(m,(()=>{const Z=t().classFeatures.features["ChannelDivinity"];return typeof Z=="number"?Z:0})())}),et(()=>(e(J),e(ee),e(C),e(T),e(S),e(K),e(b)),()=>{o(R,(()=>{const _=[];e(J)>0&&_.push(`${e(J)}d4`),e(ee)>0&&_.push(`${e(ee)}d6`),e(C)>0&&_.push(`${e(C)}d8`),e(T)>0&&_.push(`${e(T)}d10`),e(S)>0&&_.push(`${e(S)}d12`),e(K)>0&&_.push(`${e(K)}d20`);let Z=_.join("+")||"1d20";return e(b)!==0&&(Z+=e(b)>=0?`+${e(b)}`:`${e(b)}`),Z})())}),et(()=>(B(k()),e(Ne),B(se()),e(Xe),B(E()),B(oe()),B(H())),()=>{k()&&e(Ne)&&se()&&k()!==e(Xe)&&(o(Xe,k()),o(ce,null),o(w,[]),o(pe,!1),o(qe,!1),o(Ee,!1),console.log("Auto-roll triggered. notation:",k(),"damageNotation:",E(),"attackName:",oe(),"rollType:",H()),setTimeout(()=>at(k(),H()),200))}),aa();var ge={getLastRollTotal:Ge};Gt();var Re=xn();let fe;var V=l(Re),M=l(V),We=l(M),Pe=l(We);{var Ye=_=>{var Z=an(),Y=Be(Z),q=s(Y);{var xe=st=>{var ct=jt("- Attack Roll");n(st,ct)};g(q,st=>{H()==="attack"&&st(xe)})}var Ze=s(q,2);{var it=st=>{var ct=jt("- Damage Roll");n(st,ct)};g(Ze,st=>{H()==="damage"&&st(it)})}var Ve=s(Ze,2);{var ze=st=>{var ct=jt("- Healing Roll");n(st,ct)};g(Ve,st=>{H()==="healing"&&st(ze)})}var Ce=s(Ve,2);{var ae=st=>{var ct=jt("- Ability Check");n(st,ct)};g(Ce,st=>{H()==="check"&&st(ae)})}var Je=s(Ce,2);{var mt=st=>{var ct=jt("- Saving Throw");n(st,ct)};g(Je,st=>{H()==="save"&&st(mt)})}$(()=>x(Y,`${oe()??""} `)),n(_,Z)},Ue=_=>{var Z=jt("Dice Roller");n(_,Z)};g(Pe,_=>{oe()?_(Ye):_(Ue,!1)})}a(We);var p=s(We,2),I=l(p),G=s(I,2);a(p),a(M);var F=s(M,2);{var _e=_=>{var Z=sn(),Y=s(l(Z),2),q=l(Y),xe=s(l(q),2);Fe(xe),a(q);var Ze=s(q,2),it=s(l(Ze),2);Fe(it),a(Ze);var Ve=s(Ze,2),ze=s(l(Ve),2);Fe(ze),a(Ve),a(Y),a(Z),Qe(xe,()=>e(he),Ce=>o(he,Ce)),P("change",xe,A),Qe(it,()=>e(Le),Ce=>o(Le,Ce)),P("change",it,A),Qe(ze,()=>e(Oe),Ce=>o(Oe,Ce)),P("change",ze,A),n(_,Z)};g(F,_=>{e(Ke)&&_(_e)})}var Ae=s(F,2);{var ne=_=>{var Z=ln();n(_,Z)};g(Ae,_=>{e(Ne)||_(ne)})}var le=s(Ae,2),W=l(le);Ba(W,_=>o(Te,_),()=>e(Te));var ve=s(W,2);{var de=_=>{var Z=rn(),Y=s(l(Z),2),q=l(Y),xe=s(l(q),2);Fe(xe),a(q);var Ze=s(q,2),it=s(l(Ze),2);Fe(it),a(Ze);var Ve=s(Ze,2),ze=s(l(Ve),2);Fe(ze),a(Ve);var Ce=s(Ve,2),ae=s(l(Ce),2);Fe(ae),a(Ce);var Je=s(Ce,2),mt=s(l(Je),2);Fe(mt),a(Je);var st=s(Je,2),ct=s(l(st),2);Fe(ct),a(st),a(Y);var me=s(Y,2),Dt=l(me),zt=l(Dt);a(Dt);var Et=s(Dt,2);a(me),a(Z),$(()=>{Dt.disabled=!e(Ne),x(zt,`Roll ${e(R)??""}`)}),Qe(xe,()=>e(J),h=>o(J,h)),Qe(it,()=>e(ee),h=>o(ee,h)),Qe(ze,()=>e(C),h=>o(C,h)),Qe(ae,()=>e(T),h=>o(T,h)),Qe(mt,()=>e(S),h=>o(S,h)),Qe(ct,()=>e(K),h=>o(K,h)),P("click",Dt,N),P("click",Et,Q),n(_,Z)};g(ve,_=>{k()||_(de)})}a(le);var ie=s(le,2);let ye;var Ie=l(ie);{var He=_=>{var Z=yn(),Y=Be(Z),q=l(Y);{var xe=h=>{var ke=nn(),U=l(ke,!0);a(ke),$(()=>x(U,oe()?`${oe()} - Healing`:"Healing")),n(h,ke)},Ze=h=>{var ke=ot(),U=Be(ke);{var ut=Me=>{var re=on(),tt=l(re,!0);a(re),$(()=>x(tt,oe()?`${oe()} - ${L()} Damage`:`${L()} Damage`)),n(Me,re)},Se=Me=>{var re=ot(),tt=Be(re);{var lt=ft=>{var yt=cn(),Bt=l(yt,!0);a(yt),$(()=>x(Bt,oe()?`${oe()} - Damage`:"Damage")),n(ft,yt)},ht=ft=>{var yt=vn(),Bt=l(yt,!0);a(yt),$(()=>x(Bt,oe()?`${oe()} - Result`:"Result")),n(ft,yt)};g(tt,ft=>{H()==="damage"?ft(lt):ft(ht,!1)},!0)}n(Me,re)};g(U,Me=>{H()==="damage"&&L()?Me(ut):Me(Se,!1)},!0)}n(h,ke)};g(q,h=>{H()==="damage"&&L()==="Healing"?h(xe):h(Ze,!1)})}var it=s(q,2);{var Ve=h=>{var ke=dn();n(h,ke)};g(it,h=>{e(pe)&&h(Ve)})}var ze=s(it,2);{var Ce=h=>{var ke=un();n(h,ke)};g(ze,h=>{e(qe)&&h(Ce)})}a(Y);var ae=s(Y,2),Je=l(ae,!0);a(ae);var mt=s(ae,2),st=l(mt);{var ct=h=>{var ke=ot(),U=Be(ke);{var ut=Me=>{var re=pn();kt(re,5,()=>(e(ce),B(k()),B(ue()),i(()=>O(e(ce),k(),ue()))),$t,(tt,lt)=>{var ht=fn(),ft=l(ht),yt=l(ft,!0);a(ft);var Bt=s(ft,2),Jt=l(Bt);a(Bt),a(ht),$(()=>{x(yt,(e(lt),i(()=>e(lt).display))),x(Jt,`(${e(lt),i(()=>e(lt).source)??""})`)}),n(tt,ht)}),a(re),n(Me,re)},Se=Me=>{var re=ot(),tt=Be(re);{var lt=ht=>{var ft=gn(),yt=l(ft);a(ft),$(()=>x(yt,`Modifier: ${e(ce),i(()=>e(ce).constant>=0?"+":"")??""}${e(ce),i(()=>e(ce).constant)??""}`)),n(ht,ft)};g(tt,ht=>{e(ce),i(()=>e(ce).constant)&&ht(lt)},!0)}n(Me,re)};g(U,Me=>{B(ue()),i(()=>ue().length>0)?Me(ut):Me(Se,!1)})}n(h,ke)};g(st,h=>{e(ce),B(ue()),i(()=>e(ce).constant||ue().length>0)&&h(ct)})}a(mt);var me=s(mt,2);{var Dt=h=>{var ke=mn();n(h,ke)};g(me,h=>{e(qe)&&h(Dt)})}var zt=s(me,2);{var Et=h=>{var ke=_n(),U=l(ke);kt(U,1,()=>e(w),$t,(Me,re)=>{var tt=bn(),lt=l(tt,!0);a(tt),$(()=>x(lt,(e(re),i(()=>e(re).label)))),P("click",tt,()=>at(e(re).notation,"damage")),n(Me,tt)});var ut=s(U,2);{var Se=Me=>{var re=hn();$(()=>{re.disabled=e(m)<=0,rt(re,"title",e(m)<=0?"No Channel Divinity uses remaining":"Use Channel Divinity to add +10 to this attack roll")}),P("click",re,we),n(Me,re)};g(ut,Me=>{e(f)&&H()==="attack"&&!e(Ee)&&e(m)>0&&!e(qe)&&Me(Se)})}a(ke),n(h,ke)};g(zt,h=>{e(w),e(f),B(H()),e(Ee),e(m),i(()=>e(w).length>0||e(f)&&H()==="attack"&&!e(Ee)&&e(m)>0)&&h(Et)})}$(()=>x(Je,(e(ce),i(()=>e(ce).resultTotal)))),n(_,Z)};g(Ie,_=>{e(ce)&&_(He)})}a(ie),a(V),a(Re),$(()=>{fe=At(Re,1,"modal-overlay svelte-1r90jgp",null,fe,{hidden:!se()}),ye=At(ie,1,"roll-result svelte-1r90jgp",null,ye,{"has-result":e(ce)})}),P("click",I,te),P("click",G,je),P("click",V,fs(function(_){$a.call(this,c,_)})),P("keydown",V,function(_){$a.call(this,c,_)}),P("click",Re,je),P("keydown",Re,_=>_.key==="Escape"&&je()),n(r,Re),bl(c,"getLastRollTotal",Ge);var X=Wt(ge);return u(),X}const Ya="https://api.github.com/gists";async function wn(r,c,t){if(!c)throw new Error("GitHub token is required");const v=JSON.stringify(r,null,2),u=`${r.name||"character"}_dnd.json`,f={description:t||`D&D Character: ${r.name}`,public:!1,files:{[u]:{content:v}}},m=await fetch(Ya,{method:"POST",headers:{Authorization:`token ${c}`,"Content-Type":"application/json"},body:JSON.stringify(f)});if(!m.ok)throw new Error(`Failed to create gist: ${m.statusText}`);return(await m.json()).id}async function kn(r,c,t){if(!c||!t)throw new Error("GitHub token and Gist ID are required");const v=JSON.stringify(r,null,2),f={files:{[`${r.name||"character"}_dnd.json`]:{content:v}}},m=await fetch(`${Ya}/${t}`,{method:"PATCH",headers:{Authorization:`token ${c}`,"Content-Type":"application/json"},body:JSON.stringify(f)});if(!m.ok)throw new Error(`Failed to update gist: ${m.statusText}`)}async function $n(r,c){if(!r)throw new Error("Gist ID is required");const t={"Content-Type":"application/json"};c&&(t.Authorization=`token ${c}`);const v=await fetch(`${Ya}/${r}`,{method:"GET",headers:t});if(!v.ok)throw new Error(`Failed to load gist: ${v.statusText}`);const u=await v.json(),f=Object.values(u.files);if(f.length===0)throw new Error("No files found in gist");const R=f[0].content;try{const y=JSON.parse(R);return y.attacks&&Array.isArray(y.attacks)&&(y.attacks=y.attacks.map(k=>({...k,id:k.id||crypto.randomUUID()}))),y.classFeatures?(y.classFeatures.features||(y.classFeatures.features={}),y.classFeatures.spellSlots||(y.classFeatures.spellSlots=[]),y.classFeatures.preparedSpells===void 0&&(y.classFeatures.preparedSpells="")):y.classFeatures={features:{},spellSlots:[],preparedSpells:""},y}catch{throw new Error("Invalid character data in gist")}}function Cs(r){typeof window<"u"&&localStorage.setItem("dnd_gist_config",JSON.stringify(r))}function Cn(){if(typeof window<"u"){const r=localStorage.getItem("dnd_gist_config");if(r)return JSON.parse(r)}return{}}async function Dn(r,c=30){if(!r)throw new Error("GitHub token is required to list gists");const t=await fetch(`${Ya}?per_page=${c}`,{method:"GET",headers:{Authorization:`token ${r}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error(`Failed to list gists: ${t.statusText}`);return await t.json()}var Ln=d('<div class="error-message svelte-1jb5ckg"> </div>'),jn=d('<div class="toggle-container svelte-1jb5ckg"><button type="button" class="toggle-btn svelte-1jb5ckg"> </button></div>'),An=d('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID (leave empty to create new)</label> <input type="text" id="gistId" placeholder="Optional: existing Gist ID to update" class="svelte-1jb5ckg"/></div>'),Tn=d('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),Rn=d('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),Bn=d('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Update (or leave unselected to create new)</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),Pn=d('<div class="info-message svelte-1jb5ckg">No gists found. A new one will be created.</div>'),Mn=d('<!> <div class="form-group svelte-1jb5ckg"><label for="description" class="svelte-1jb5ckg"> </label> <input type="text" id="description" placeholder="D&amp;D Character Sheet" class="svelte-1jb5ckg"/></div>',1),Un=d('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID *</label> <input type="text" id="gistId" placeholder="Enter Gist ID (for public or your private gists)" required class="svelte-1jb5ckg"/></div>'),Fn=d('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),In=d('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),En=d('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Load</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),Hn=d('<div class="info-message svelte-1jb5ckg">No gists found. Enter a Gist ID manually or create a new one in Save mode.</div>'),Nn=d('<div class="modal-overlay svelte-1jb5ckg" role="button" tabindex="-1"><div class="modal-content svelte-1jb5ckg" role="dialog" tabindex="0"><div class="modal-header svelte-1jb5ckg"><h2 class="svelte-1jb5ckg"> </h2> <button class="close-btn svelte-1jb5ckg">√ó</button></div> <div class="modal-body svelte-1jb5ckg"><!> <div class="form-group svelte-1jb5ckg"><label for="token" class="svelte-1jb5ckg"> <a href="https://github.com/settings/tokens" target="_blank" rel="noopener" class="svelte-1jb5ckg">Get token</a></label> <input type="password" id="token" placeholder="ghp_xxxxxxxxxxxxx" class="svelte-1jb5ckg"/></div> <!> <!> <div class="modal-actions svelte-1jb5ckg"><button class="btn btn-primary svelte-1jb5ckg"><!></button> <button class="btn btn-secondary svelte-1jb5ckg">Cancel</button></div></div></div></div>');function On(r,c){qt(c,!1);const t=()=>pt(De,"$character",v),[v,u]=sa(),f=ba();let m=vt(c,"mode",8,"save"),R=D(""),y=D(""),k=D(""),se=D(!1),E=D(""),L=D(!1),oe=D(!1),be=D([]),ue=D(null);const H=Cn();H.token&&o(R,H.token),H.gistId&&o(y,H.gistId),Sa(async()=>{e(R)&&!e(L)&&await z()});async function z(){if(e(R)){o(oe,!0),o(E,"");try{o(be,await Dn(e(R))),e(y)&&o(ue,e(be).find(A=>A.id===e(y))||null)}catch(A){o(E,A.message||"Failed to load gists"),o(be,[])}finally{o(oe,!1)}}}function Te(A){o(ue,A),o(y,A.id)}function Ne(){o(L,!e(L)),o(E,""),!e(L)&&e(R)&&z()}async function Xe(){if(!e(R)){o(E,"GitHub token is required");return}const A=e(ue)?.id||e(y);o(se,!0),o(E,"");try{if(A)await kn(t(),e(R),A),o(y,A),It.add("Character updated in Gist successfully!","success");else{const te=await wn(t(),e(R),e(k));o(y,te),It.add(`Character saved to Gist! ID: ${te}`,"success")}Cs({token:e(R),gistId:e(y)}),f("close")}catch(te){o(E,te.message||"Failed to save to Gist")}finally{o(se,!1)}}async function ce(){const A=e(ue)?.id||e(y);if(!A){o(E,"Please select a gist or enter a Gist ID");return}o(se,!0),o(E,"");try{const te=await $n(A,e(R)||void 0);De.set(te),o(y,A),Cs({token:e(R),gistId:e(y)}),It.add("Character loaded from Gist successfully!","success"),f("close")}catch(te){o(E,te.message||"Failed to load from Gist")}finally{o(se,!1)}}function Ge(){f("close")}Gt();var O=Nn(),J=l(O),ee=l(J),C=l(ee),T=l(C,!0);a(C);var S=s(C,2);a(ee);var K=s(ee,2),b=l(K);{var w=A=>{var te=Ln(),we=l(te,!0);a(te),$(()=>x(we,e(E))),n(A,te)};g(b,A=>{e(E)&&A(w)})}var pe=s(b,2),qe=l(pe),Ee=l(qe);Yt(),a(qe);var he=s(qe,2);Fe(he),a(pe);var Le=s(pe,2);{var Oe=A=>{var te=jn(),we=l(te),je=l(we,!0);a(we),a(te),$(()=>{we.disabled=e(se),x(je,e(L)?"üìã Show My Gists":"‚úèÔ∏è Enter Gist ID Manually")}),P("click",we,Ne),n(A,te)};g(Le,A=>{(m()==="load"||m()==="save"&&e(R))&&A(Oe)})}var Ke=s(Le,2);{var nt=A=>{var te=Mn(),we=Be(te);{var je=We=>{var Pe=An(),Ye=s(l(Pe),2);Fe(Ye),a(Pe),$(()=>Ye.disabled=e(se)),Qe(Ye,()=>e(y),Ue=>o(y,Ue)),n(We,Pe)},ge=We=>{var Pe=ot(),Ye=Be(Pe);{var Ue=I=>{var G=Tn();n(I,G)},p=I=>{var G=ot(),F=Be(G);{var _e=ne=>{var le=Bn(),W=s(l(le),2);kt(W,5,()=>e(be),$t,(ve,de)=>{var ie=Rn();let ye;var Ie=l(ie),He=l(Ie),X=l(He,!0);a(He);var _=s(He,2),Z=l(_,!0);a(_),a(Ie);var Y=s(Ie,2),q=l(Y),xe=l(q);a(q);var Ze=s(q,2),it=l(Ze);a(Ze),a(Y),a(ie),$(Ve=>{ye=At(ie,1,"gist-item svelte-1jb5ckg",null,ye,{selected:e(ue)?.id===e(de).id}),ie.disabled=e(se),x(X,(e(de),i(()=>e(de).description||"Untitled"))),x(Z,(e(de),i(()=>e(de).public?"üåê Public":"üîí Private"))),x(xe,`ID: ${e(de),i(()=>e(de).id)??""}`),x(it,`Updated: ${Ve??""}`)},[()=>(e(de),i(()=>new Date(e(de).updated_at).toLocaleDateString()))]),P("click",ie,()=>Te(e(de))),n(ve,ie)}),a(W),a(le),n(ne,le)},Ae=ne=>{var le=ot(),W=Be(le);{var ve=de=>{var ie=Pn();n(de,ie)};g(W,de=>{e(R)&&de(ve)},!0)}n(ne,le)};g(F,ne=>{e(be),i(()=>e(be).length>0)?ne(_e):ne(Ae,!1)},!0)}n(I,G)};g(Ye,I=>{e(oe)?I(Ue):I(p,!1)},!0)}n(We,Pe)};g(we,We=>{e(L)||!e(R)?We(je):We(ge,!1)})}var Re=s(we,2),fe=l(Re),V=l(fe);a(fe);var M=s(fe,2);Fe(M),a(Re),$(()=>{x(V,`Description ${e(y)?"(optional)":""}`),M.disabled=e(se)}),Qe(M,()=>e(k),We=>o(k,We)),n(A,te)},gt=A=>{var te=ot(),we=Be(te);{var je=Re=>{var fe=Un(),V=s(l(fe),2);Fe(V),a(fe),$(()=>V.disabled=e(se)),Qe(V,()=>e(y),M=>o(y,M)),n(Re,fe)},ge=Re=>{var fe=ot(),V=Be(fe);{var M=Pe=>{var Ye=Fn();n(Pe,Ye)},We=Pe=>{var Ye=ot(),Ue=Be(Ye);{var p=G=>{var F=En(),_e=s(l(F),2);kt(_e,5,()=>e(be),$t,(Ae,ne)=>{var le=In();let W;var ve=l(le),de=l(ve),ie=l(de,!0);a(de);var ye=s(de,2),Ie=l(ye,!0);a(ye),a(ve);var He=s(ve,2),X=l(He),_=l(X);a(X);var Z=s(X,2),Y=l(Z);a(Z),a(He),a(le),$(q=>{W=At(le,1,"gist-item svelte-1jb5ckg",null,W,{selected:e(ue)?.id===e(ne).id}),le.disabled=e(se),x(ie,(e(ne),i(()=>e(ne).description||"Untitled"))),x(Ie,(e(ne),i(()=>e(ne).public?"üåê Public":"üîí Private"))),x(_,`ID: ${e(ne),i(()=>e(ne).id)??""}`),x(Y,`Updated: ${q??""}`)},[()=>(e(ne),i(()=>new Date(e(ne).updated_at).toLocaleDateString()))]),P("click",le,()=>Te(e(ne))),n(Ae,le)}),a(_e),a(F),n(G,F)},I=G=>{var F=ot(),_e=Be(F);{var Ae=ne=>{var le=Hn();n(ne,le)};g(_e,ne=>{e(R)&&ne(Ae)},!0)}n(G,F)};g(Ue,G=>{e(be),i(()=>e(be).length>0)?G(p):G(I,!1)},!0)}n(Pe,Ye)};g(V,Pe=>{e(oe)?Pe(M):Pe(We,!1)},!0)}n(Re,fe)};g(we,Re=>{e(L)||!e(R)?Re(je):Re(ge,!1)},!0)}n(A,te)};g(Ke,A=>{m()==="save"?A(nt):A(gt,!1)})}var dt=s(Ke,2),at=l(dt),j=l(at);{var N=A=>{var te=jt();$(()=>x(te,m()==="save"?"Saving...":"Loading...")),n(A,te)},$e=A=>{var te=jt();$(()=>x(te,m()==="save"?"Save":"Load")),n(A,te)};g(j,A=>{e(se)?A(N):A($e,!1)})}a(at);var Q=s(at,2);a(dt),a(K),a(J),a(O),$(()=>{x(T,m()==="save"?"Save to GitHub Gist":"Load from GitHub Gist"),x(Ee,`GitHub Token ${m()==="load"?"(optional for public gists)":"(required)"} `),he.disabled=e(se),at.disabled=e(se),Q.disabled=e(se)}),P("click",S,Ge),Qe(he,()=>e(R),A=>o(R,A)),P("blur",he,()=>{e(R)&&!e(L)&&z()}),P("click",at,function(...A){(m()==="save"?Xe:ce)?.apply(this,A)}),P("click",Q,Ge),P("click",J,fs(function(A){$a.call(this,c,A)})),P("keydown",J,function(A){$a.call(this,c,A)}),P("click",O,Ge),P("keydown",O,A=>A.key==="Escape"&&Ge()),n(r,O),Wt(),u()}var Gn=d('<div class="loading svelte-1ngjemu">Loading D&D data...</div>'),qn=d("<option> </option>"),Wn=d('<select class="level-filter svelte-1ngjemu"><option>All Levels</option><option>Cantrip</option><!></select>'),zn=d('<div class="no-results svelte-1ngjemu"> </div>'),Jn=d('<div class="item-meta svelte-1ngjemu"> </div>'),Kn=d('<div class="item-meta svelte-1ngjemu"> </div>'),Vn=d('<button><div class="item-name svelte-1ngjemu"> </div> <!></button>'),Yn=d('<p class="higher-levels"><strong>At Higher Levels:</strong> </p>'),Qn=d('<p class="cantrip-upgrade"><strong>Cantrip Upgrade:</strong> </p>'),Xn=d('<h3 class="svelte-1ngjemu"> </h3> <p class="spell-meta svelte-1ngjemu"><!> <!></p> <p class="spell-classes"><strong>Classes:</strong> </p> <div class="spell-stats svelte-1ngjemu"><div><strong>Casting Time:</strong> </div> <div><strong>Range:</strong> </div> <div><strong>Components:</strong> <!></div> <div><strong>Duration:</strong> <!> </div></div> <p class="description svelte-1ngjemu"> </p> <!> <!>',1),Zn=d('<p class="prerequisite svelte-1ngjemu"><strong>Prerequisite:</strong> </p>'),eo=d('<h3 class="svelte-1ngjemu"> </h3> <!> <p class="description svelte-1ngjemu"> </p> <a target="_blank" rel="noopener" class="source-link svelte-1ngjemu">View Full Details ‚Üí</a>',1),to=d('<div class="item-details svelte-1ngjemu"><!></div>'),ao=d('<div class="controls svelte-1ngjemu"><div class="tabs svelte-1ngjemu"><button> </button> <button> </button></div> <div class="search-controls svelte-1ngjemu"><input type="text" placeholder="Search by name or description..." class="search-input svelte-1ngjemu"/> <!></div></div> <div class="content-container svelte-1ngjemu"><div class="items-list svelte-1ngjemu"><!></div> <!></div>',1),so=d('<div class="modal-backdrop svelte-1ngjemu" role="presentation"><div class="modal svelte-1ngjemu" role="dialog" aria-modal="true" tabindex="-1"><div class="modal-header svelte-1ngjemu"><h2 class="svelte-1ngjemu">Browse D&D Spells & Feats</h2> <button class="close-btn svelte-1ngjemu" aria-label="Close">&times;</button></div> <div class="modal-body svelte-1ngjemu"><!></div> <div class="modal-footer svelte-1ngjemu"><button class="btn-secondary svelte-1ngjemu">Cancel</button> <button class="btn-primary svelte-1ngjemu">Add to Character Sheet</button></div></div></div>');function lo(r,c){qt(c,!1);const t=D(),v=D(),u=D();let f=vt(c,"onClose",8),m=D("spell"),R=D(!0),y=D(""),k=D(null),se=D([]),E=D([]),L=D(null);Sa(async()=>{o(R,!0);try{o(se,await ps()),o(E,await ri())}catch(S){console.error("Failed to load data:",S)}finally{o(R,!1)}});function oe(S){o(L,S)}function be(S){const K=S.match(/(\d+d\d+(?:\s*\+\s*\d+)?)/i);return K?K[1]:""}function ue(S){const K=S.split(/\.( |$)/)[0].trim(),b=Array.from(S.matchAll(/\*\*(.*?)\*\*/g)).map(pe=>pe[1].replace(/\.$/,""));let w=K;return b.length&&(w+=" | Effects: "+b.join(", ")),w}function H(){if(e(L)){if(e(m)==="spell"){const S=e(L);De.update(K=>{const w=[];S.range&&w.push(`Range: ${S.range}`),S.castingTime&&w.push(`Cast: ${S.castingTime}`),S.duration&&w.push(`Duration: ${S.duration}`),S.actionType==="Save"&&w.push("Saving throw spell"),S.components&&S.components.length>0&&w.push(`Components: ${S.components.join(", ")}`),S.material&&w.push(`Material: ${S.material}`);const pe=w.join(" | "),qe=ue(S.description),Ee={id:crypto.randomUUID(),name:`${S.name}${S.concentration?" (C)":""}${S.ritual?" (R)":""}`,bonus:S.actionType==="Attack"?5:0,damage:be(S.description),damageType:`${S.school} (Lvl ${S.level})`,spellRef:S.name,infoNotes:pe,generalNotes:qe,castAtLevel:S.level};return K.attacks=[...K.attacks,Ee],K})}else if(e(m)==="feat"){const S=e(L);De.update(K=>{const b=`${S.name}${S.prerequisite?` (Req: ${S.prerequisite})`:""}
${S.description}
`;return K.features=K.features?`${K.features}
${b}`:b,K})}o(L,null),f()()}}et(()=>(e(k),e(se),e(y)),()=>{o(t,e(k)!==null?ni(ks(e(se),e(y)),e(k)):ks(e(se),e(y)))}),et(()=>(e(E),e(y)),()=>{o(v,oi(e(E),e(y)))}),et(()=>(e(m),e(t),e(v)),()=>{o(u,e(m)==="spell"?e(t):e(v))}),aa(),Gt();var z=so(),Te=l(z),Ne=l(Te),Xe=s(l(Ne),2);a(Ne);var ce=s(Ne,2),Ge=l(ce);{var O=S=>{var K=Gn();n(S,K)},J=S=>{var K=ao(),b=Be(K),w=l(b),pe=l(w);let qe;var Ee=l(pe);a(pe);var he=s(pe,2);let Le;var Oe=l(he);a(he),a(w);var Ke=s(w,2),nt=l(Ke);Fe(nt);var gt=s(nt,2);{var dt=we=>{var je=Wn();$(()=>{e(k),Ot(()=>{})});var ge=l(je);ge.value=(ge.__value=null)??"";var Re=s(ge);Re.value=Re.__value=0;var fe=s(Re);kt(fe,0,()=>[1,2,3,4,5,6,7,8,9],$t,(V,M)=>{var We=qn(),Pe=l(We);a(We);var Ye={};$(()=>{x(Pe,`Level ${M??""}`),Ye!==(Ye=M)&&(We.value=(We.__value=M)??"")}),n(V,We)}),a(je),Ma(je,()=>e(k),V=>o(k,V)),n(we,je)};g(gt,we=>{e(m)==="spell"&&we(dt)})}a(Ke),a(b);var at=s(b,2),j=l(at),N=l(j);{var $e=we=>{var je=zn(),ge=l(je);a(je),$(()=>x(ge,`No ${e(m)??""}s found`)),n(we,je)},Q=we=>{var je=ot(),ge=Be(je);kt(ge,1,()=>e(u),$t,(Re,fe)=>{var V=Vn();let M;var We=l(V),Pe=l(We,!0);a(We);var Ye=s(We,2);{var Ue=I=>{const G=xt(()=>e(fe));var F=Jn(),_e=l(F);a(F),$(()=>x(_e,`Level ${B(e(G)),i(()=>e(G).level)??""} ‚Ä¢ ${B(e(G)),i(()=>e(G).school)??""}`)),n(I,F)},p=I=>{const G=xt(()=>e(fe));var F=ot(),_e=Be(F);{var Ae=ne=>{var le=Kn(),W=l(le,!0);a(le),$(()=>x(W,(B(e(G)),i(()=>e(G).prerequisite)))),n(ne,le)};g(_e,ne=>{B(e(G)),i(()=>e(G).prerequisite)&&ne(Ae)})}n(I,F)};g(Ye,I=>{e(m)==="spell"?I(Ue):I(p,!1)})}a(V),$(()=>{M=At(V,1,"item-card svelte-1ngjemu",null,M,{selected:e(L)?.name===e(fe).name}),x(Pe,(e(fe),i(()=>e(fe).name)))}),P("click",V,()=>oe(e(fe))),n(Re,V)}),n(we,je)};g(N,we=>{e(u),i(()=>e(u).length===0)?we($e):we(Q,!1)})}a(j);var A=s(j,2);{var te=we=>{var je=to(),ge=l(je);{var Re=V=>{const M=xt(()=>e(L));var We=Xn(),Pe=Be(We),Ye=l(Pe,!0);a(Pe);var Ue=s(Pe,2),p=l(Ue);{var I=ae=>{var Je=jt();$(()=>x(Je,`${B(e(M)),i(()=>e(M).school)??""} cantrip`)),n(ae,Je)},G=ae=>{var Je=jt();$(()=>x(Je,`Level ${B(e(M)),i(()=>e(M).level)??""} ${B(e(M)),i(()=>e(M).school)??""}`)),n(ae,Je)};g(p,ae=>{B(e(M)),i(()=>e(M).level===0)?ae(I):ae(G,!1)})}var F=s(p,2);{var _e=ae=>{var Je=jt("(ritual)");n(ae,Je)};g(F,ae=>{B(e(M)),i(()=>e(M).ritual)&&ae(_e)})}a(Ue);var Ae=s(Ue,2),ne=s(l(Ae));a(Ae);var le=s(Ae,2),W=l(le),ve=s(l(W));a(W);var de=s(W,2),ie=s(l(de));a(de);var ye=s(de,2),Ie=s(l(ye)),He=s(Ie);{var X=ae=>{var Je=jt();$(()=>x(Je,`(${B(e(M)),i(()=>e(M).material)??""})`)),n(ae,Je)};g(He,ae=>{B(e(M)),i(()=>e(M).material)&&ae(X)})}a(ye);var _=s(ye,2),Z=s(l(_),2);{var Y=ae=>{var Je=jt("Concentration,");n(ae,Je)};g(Z,ae=>{B(e(M)),i(()=>e(M).concentration)&&ae(Y)})}var q=s(Z,1,!0);a(_),a(le);var xe=s(le,2),Ze=l(xe,!0);a(xe);var it=s(xe,2);{var Ve=ae=>{var Je=Yn(),mt=s(l(Je));a(Je),$(()=>x(mt,` ${B(e(M)),i(()=>e(M).higherLevelSlot)??""}`)),n(ae,Je)};g(it,ae=>{B(e(M)),i(()=>e(M).higherLevelSlot)&&ae(Ve)})}var ze=s(it,2);{var Ce=ae=>{var Je=Qn(),mt=s(l(Je));a(Je),$(()=>x(mt,` ${B(e(M)),i(()=>e(M).cantripUpgrade)??""}`)),n(ae,Je)};g(ze,ae=>{B(e(M)),i(()=>e(M).cantripUpgrade)&&ae(Ce)})}$((ae,Je)=>{x(Ye,(B(e(M)),i(()=>e(M).name))),x(ne,` ${ae??""}`),x(ve,` ${B(e(M)),i(()=>e(M).castingTime||e(M).actionType)??""}`),x(ie,` ${B(e(M)),i(()=>e(M).range)??""}`),x(Ie,` ${Je??""}`),x(q,(B(e(M)),i(()=>e(M).duration))),x(Ze,(B(e(M)),i(()=>e(M).description)))},[()=>(B(e(M)),i(()=>e(M).classes.join(", "))),()=>(B(e(M)),i(()=>e(M).components.join(", ").toUpperCase()))]),n(V,We)},fe=V=>{const M=xt(()=>e(L));var We=eo(),Pe=Be(We),Ye=l(Pe,!0);a(Pe);var Ue=s(Pe,2);{var p=_e=>{var Ae=Zn(),ne=s(l(Ae));a(Ae),$(()=>x(ne,` ${B(e(M)),i(()=>e(M).prerequisite)??""}`)),n(_e,Ae)};g(Ue,_e=>{B(e(M)),i(()=>e(M).prerequisite)&&_e(p)})}var I=s(Ue,2),G=l(I,!0);a(I);var F=s(I,2);$(()=>{x(Ye,(B(e(M)),i(()=>e(M).name))),x(G,(B(e(M)),i(()=>e(M).description))),rt(F,"href",(B(e(M)),i(()=>e(M).source)))}),n(V,We)};g(ge,V=>{e(m)==="spell"?V(Re):V(fe,!1)})}a(je),n(we,je)};g(A,we=>{e(L)&&we(te)})}a(at),$(()=>{qe=At(pe,1,"tab svelte-1ngjemu",null,qe,{active:e(m)==="spell"}),x(Ee,`üìú Spells (${e(se),i(()=>e(se).length)??""})`),Le=At(he,1,"tab svelte-1ngjemu",null,Le,{active:e(m)==="feat"}),x(Oe,`‚≠ê Feats (${e(E),i(()=>e(E).length)??""})`)}),P("click",pe,()=>{o(m,"spell"),o(L,null),o(y,"")}),P("click",he,()=>{o(m,"feat"),o(L,null),o(y,"")}),Qe(nt,()=>e(y),we=>o(y,we)),n(S,K)};g(Ge,S=>{e(R)?S(O):S(J,!1)})}a(ce);var ee=s(ce,2),C=l(ee),T=s(C,2);a(ee),a(Te),a(z),$(()=>T.disabled=!e(L)),P("click",Xe,function(...S){f()?.apply(this,S)}),P("click",C,function(...S){f()?.apply(this,S)}),P("click",T,H),P("click",Te,fs(function(S){$a.call(this,c,S)})),P("keydown",Te,function(S){$a.call(this,c,S)}),P("click",z,function(...S){f()?.apply(this,S)}),P("keydown",z,S=>S.key==="Escape"&&f()()),n(r,z),Wt()}var io=d('<span class="resistance-tag svelte-gdwwx1"> <button type="button" class="tag-remove svelte-gdwwx1">√ó</button></span>'),ro=d('<div class="resistance-list svelte-gdwwx1"></div>'),no=d('<p class="ability-meta svelte-gdwwx1"> <!></p>'),oo=d('<p class="ability-meta svelte-gdwwx1">Requires Reaction</p>'),co=d('<div class="ability-card svelte-gdwwx1"><div class="ability-header svelte-gdwwx1"><strong class="svelte-gdwwx1"> </strong> <button type="button" class="ability-remove svelte-gdwwx1">√ó</button></div> <p class="ability-description svelte-gdwwx1"> </p> <!></div>'),vo=d('<div class="abilities-list svelte-gdwwx1"></div>'),uo=d(`<div class="modal-backdrop svelte-gdwwx1" role="presentation"><div class="modal-content svelte-gdwwx1" role="dialog" aria-modal="true" aria-labelledby="modal-title"><div class="modal-header svelte-gdwwx1"><h3 id="modal-title" class="svelte-gdwwx1">Add Custom Condition</h3> <button class="btn-close svelte-gdwwx1" aria-label="Close">√ó</button></div> <div class="modal-body svelte-gdwwx1"><div class="form-group svelte-gdwwx1"><label for="conditionName" class="svelte-gdwwx1">Condition Name*</label> <input type="text" id="conditionName" placeholder="e.g., Cazna's Mark" class="svelte-gdwwx1"/></div> <div class="form-group svelte-gdwwx1"><label for="description" class="svelte-gdwwx1">Description</label> <textarea id="description" placeholder="Describe the condition..." rows="3" class="svelte-gdwwx1"></textarea></div> <div class="form-row svelte-gdwwx1"><div class="form-group svelte-gdwwx1"><label for="attackBonus" class="svelte-gdwwx1">Attack Bonus</label> <input type="text" id="attackBonus" placeholder="0 or 1d4" class="svelte-gdwwx1"/></div> <div class="form-group svelte-gdwwx1"><label for="damageBonus" class="svelte-gdwwx1">Damage Bonus</label> <input type="text" id="damageBonus" placeholder="0 or 1d6" class="svelte-gdwwx1"/></div> <div class="form-group svelte-gdwwx1"><label for="acBonus" class="svelte-gdwwx1">AC Bonus</label> <input type="number" id="acBonus" placeholder="0" class="svelte-gdwwx1"/></div></div> <div class="form-group svelte-gdwwx1"><label for="darkvision" class="svelte-gdwwx1">Darkvision (feet)</label> <input type="number" id="darkvision" placeholder="0" min="0" step="30" class="svelte-gdwwx1"/> <small class="help-text svelte-gdwwx1">Grant or extend darkvision (e.g., 60 for 60 feet)</small></div> <div class="form-group svelte-gdwwx1"><label class="svelte-gdwwx1">Damage Resistances</label> <div class="resistance-input-group svelte-gdwwx1"><input type="text" placeholder="e.g., cold, fire, poison" class="svelte-gdwwx1"/> <button type="button" class="btn-add svelte-gdwwx1">Add</button></div> <!></div> <div class="form-group svelte-gdwwx1"><label class="svelte-gdwwx1">Special Abilities</label> <div class="ability-form svelte-gdwwx1"><input type="text" placeholder="Ability name (e.g., Flicker of Deceit)" class="ability-name-input svelte-gdwwx1"/> <textarea placeholder="Ability description..." rows="2" class="ability-desc-input svelte-gdwwx1"></textarea> <div class="ability-options svelte-gdwwx1"><div class="ability-option svelte-gdwwx1"><label for="abilityUses" class="svelte-gdwwx1">Uses per rest</label> <input type="number" id="abilityUses" min="0" class="svelte-gdwwx1"/></div> <div class="ability-option svelte-gdwwx1"><label for="restType" class="svelte-gdwwx1">Rest type</label> <select id="restType" class="svelte-gdwwx1"><option>Short</option><option>Long</option></select></div> <div class="ability-option svelte-gdwwx1"><label class="svelte-gdwwx1"><input type="checkbox" class="svelte-gdwwx1"/> Requires Reaction</label></div></div> <button type="button" class="btn-add svelte-gdwwx1">Add Ability</button></div> <!></div></div> <div class="modal-footer svelte-gdwwx1"><button class="btn btn-secondary svelte-gdwwx1">Cancel</button> <button class="btn btn-primary svelte-gdwwx1">Add Condition</button></div></div></div>`);function fo(r,c){qt(c,!1);let t=vt(c,"show",8,!1),v=vt(c,"onSave",8),u=vt(c,"onCancel",8),f=D(""),m=D(""),R=D(0),y=D(0),k=D(0),se=D(0),E=D([]),L=D(""),oe=D([]),be=D(""),ue=D(""),H=D(0),z=D("short"),Te=D(!1);function Ne(){o(f,""),o(m,""),o(R,0),o(y,0),o(k,0),o(se,0),o(E,[]),o(L,""),o(oe,[]),o(be,""),o(ue,""),o(H,0),o(z,"short"),o(Te,!1)}function Xe(){e(L).trim()&&(o(E,[...e(E),e(L).trim()]),o(L,""))}function ce(b){o(E,e(E).filter((w,pe)=>pe!==b))}function Ge(){if(e(be).trim()&&e(ue).trim()){const b={name:e(be).trim(),description:e(ue).trim(),requiresReaction:e(Te)};e(H)>0&&(b.usesPerRest=e(H),b.currentUses=e(H),b.restType=e(z)),o(oe,[...e(oe),b]),o(be,""),o(ue,""),o(H,0),o(z,"short"),o(Te,!1)}}function O(b){o(oe,e(oe).filter((w,pe)=>pe!==b))}function J(){if(!e(f).trim()){alert("Please enter a condition name");return}const b={name:e(f).trim(),description:e(m).trim()||"Custom condition",attackBonus:e(R)||0,damageBonus:e(y)||0,target:"self"};e(k)!==0&&(b.acBonus=e(k)),e(se)>0&&(b.darkvision=e(se)),e(E).length>0&&(b.resistances=e(E)),e(oe).length>0&&(b.abilities=e(oe)),v()(b),Ne()}function ee(){Ne(),u()()}function C(b){b.target===b.currentTarget&&ee()}Gt();var T=ot(),S=Be(T);{var K=b=>{var w=uo(),pe=l(w),qe=l(pe),Ee=s(l(qe),2);a(qe);var he=s(qe,2),Le=l(he),Oe=s(l(Le),2);Fe(Oe),a(Le);var Ke=s(Le,2),nt=s(l(Ke),2);xa(nt),a(Ke);var gt=s(Ke,2),dt=l(gt),at=s(l(dt),2);Fe(at),a(dt);var j=s(dt,2),N=s(l(j),2);Fe(N),a(j);var $e=s(j,2),Q=s(l($e),2);Fe(Q),a($e),a(gt);var A=s(gt,2),te=s(l(A),2);Fe(te),Yt(2),a(A);var we=s(A,2),je=s(l(we),2),ge=l(je);Fe(ge);var Re=s(ge,2);a(je);var fe=s(je,2);{var V=X=>{var _=ro();kt(_,5,()=>e(E),$t,(Z,Y,q)=>{var xe=io(),Ze=l(xe),it=s(Ze);a(xe),$(()=>{x(Ze,`${e(Y)??""} `),rt(it,"aria-label",`Remove ${e(Y)??""}`)}),P("click",it,()=>ce(q)),n(Z,xe)}),a(_),n(X,_)};g(fe,X=>{e(E),i(()=>e(E).length>0)&&X(V)})}a(we);var M=s(we,2),We=s(l(M),2),Pe=l(We);Fe(Pe);var Ye=s(Pe,2);xa(Ye);var Ue=s(Ye,2),p=l(Ue),I=s(l(p),2);Fe(I),a(p);var G=s(p,2),F=s(l(G),2);$(()=>{e(z),Ot(()=>{})});var _e=l(F);_e.value=_e.__value="short";var Ae=s(_e);Ae.value=Ae.__value="long",a(F),a(G);var ne=s(G,2),le=l(ne),W=l(le);Fe(W),Yt(),a(le),a(ne),a(Ue);var ve=s(Ue,2);a(We);var de=s(We,2);{var ie=X=>{var _=vo();kt(_,5,()=>e(oe),$t,(Z,Y,q)=>{var xe=co(),Ze=l(xe),it=l(Ze),Ve=l(it,!0);a(it);var ze=s(it,2);a(Ze);var Ce=s(Ze,2),ae=l(Ce,!0);a(Ce);var Je=s(Ce,2);{var mt=ct=>{var me=no(),Dt=l(me),zt=s(Dt);{var Et=h=>{var ke=jt("‚Ä¢ Requires Reaction");n(h,ke)};g(zt,h=>{e(Y),i(()=>e(Y).requiresReaction)&&h(Et)})}a(me),$(()=>x(Dt,`${e(Y),i(()=>e(Y).usesPerRest)??""} use${e(Y),i(()=>e(Y).usesPerRest>1?"s":"")??""} per ${e(Y),i(()=>e(Y).restType)??""}
                      rest `)),n(ct,me)},st=ct=>{var me=ot(),Dt=Be(me);{var zt=Et=>{var h=oo();n(Et,h)};g(Dt,Et=>{e(Y),i(()=>e(Y).requiresReaction)&&Et(zt)},!0)}n(ct,me)};g(Je,ct=>{e(Y),i(()=>e(Y).usesPerRest)?ct(mt):ct(st,!1)})}a(xe),$(()=>{x(Ve,(e(Y),i(()=>e(Y).name))),rt(ze,"aria-label",`Remove ${e(Y),i(()=>e(Y).name)??""}`),x(ae,(e(Y),i(()=>e(Y).description)))}),P("click",ze,()=>O(q)),n(Z,xe)}),a(_),n(X,_)};g(de,X=>{e(oe),i(()=>e(oe).length>0)&&X(ie)})}a(M),a(he);var ye=s(he,2),Ie=l(ye),He=s(Ie,2);a(ye),a(pe),a(w),P("click",Ee,ee),Qe(Oe,()=>e(f),X=>o(f,X)),Qe(nt,()=>e(m),X=>o(m,X)),Qe(at,()=>e(R),X=>o(R,X)),Qe(N,()=>e(y),X=>o(y,X)),Qe(Q,()=>e(k),X=>o(k,X)),Qe(te,()=>e(se),X=>o(se,X)),Qe(ge,()=>e(L),X=>o(L,X)),P("keydown",ge,X=>X.key==="Enter"&&Xe()),P("click",Re,Xe),Qe(Pe,()=>e(be),X=>o(be,X)),Qe(Ye,()=>e(ue),X=>o(ue,X)),Qe(I,()=>e(H),X=>o(H,X)),Ma(F,()=>e(z),X=>o(z,X)),ga(W,()=>e(Te),X=>o(Te,X)),P("click",ve,Ge),P("click",Ie,ee),P("click",He,J),P("click",w,C),n(b,w)};g(S,b=>{t()&&b(K)})}n(r,T),Wt()}var po=d("<option></option>"),go=d("<button> </button>"),mo=d('<button class="btn btn-primary calculate-btn use-enabled svelte-uvfntf">Calculate Damage</button>'),bo=d('<div class="adjustment-msg svelte-uvfntf"> </div>'),ho=d('<div class="calculation-result svelte-uvfntf"><div class="result-header svelte-uvfntf"><h4 class="svelte-uvfntf">Damage Calculation</h4></div> <div class="result-content svelte-uvfntf"><div class="damage-breakdown svelte-uvfntf"><div class="damage-row svelte-uvfntf"><span class="label svelte-uvfntf">Original Damage:</span> <span class="value svelte-uvfntf"> </span></div> <div class="adjustments svelte-uvfntf"></div> <div class="damage-row final svelte-uvfntf"><span class="label svelte-uvfntf">Final Damage:</span> <span class="value damage-value svelte-uvfntf"> </span></div></div></div> <div class="result-actions svelte-uvfntf"><button class="btn btn-primary apply-btn use-enabled svelte-uvfntf">Apply Damage</button> <button class="btn btn-secondary cancel-btn use-enabled svelte-uvfntf">Cancel</button></div></div>'),_o=d('<div class="damage-form svelte-uvfntf"><div class="input-group svelte-uvfntf"><div class="input-field svelte-uvfntf"><label for="damageAmount" class="svelte-uvfntf">Damage Amount</label> <input type="number" id="damageAmount" min="0" placeholder="0" class="damage-input-field use-enabled svelte-uvfntf"/></div> <div class="input-field svelte-uvfntf"><label for="damageType" class="svelte-uvfntf">Damage Type</label> <input type="text" id="damageType" list="damageTypes" placeholder="e.g., fire, cold" class="damage-input-field use-enabled svelte-uvfntf"/> <datalist id="damageTypes"></datalist></div></div> <div class="quick-types svelte-uvfntf"><span class="quick-types-label svelte-uvfntf">Quick Select:</span> <!></div> <!></div>'),yo=d("<section><!> <!></section>");function xo(r,c){qt(c,!1);const t=()=>pt(De,"$character",f),v=()=>pt(ma,"$searchFilter",f),u=()=>pt(Qt,"$collapsedStates",f),[f,m]=sa(),R=D();ba();let y=D(0),k=D(""),se=D(!1),E=D(0),L=D([]);const oe=["slashing","piercing","bludgeoning","fire","cold","lightning","thunder","acid","poison","necrotic","radiant","psychic","force"];function be(){if(e(y)<0){It.add("Damage amount cannot be negative","error");return}if(!e(k).trim()){It.add("Please enter or select a damage type","error");return}const Ge=Il(e(y),e(k),t());o(E,Ge.finalDamage),o(L,Ge.adjustments),o(se,!0)}function ue(){De.update(Ge=>El(Ge,e(E))),It.add(`Applied ${e(E)} damage to character (${e(k)})`,"info"),o(y,0),o(k,""),o(se,!1),o(E,0),o(L,[])}function H(){o(se,!1),o(E,0),o(L,[])}et(()=>v(),()=>{o(R,!v()||"damage".includes(v().toLowerCase())||"resistance".includes(v().toLowerCase())||"immune".includes(v().toLowerCase()))}),aa(),Gt();var z=yo();let Te;var Ne=l(z);{let Ge=xt(()=>(u(),i(()=>u().damageInput?"Expand":"Collapse")));ha(Ne,{title:"Apply Damage",get collapsed(){return u(),i(()=>u().damageInput)},get ariaLabel(){return e(Ge)},onToggle:()=>Qt.update(O=>({...O,damageInput:!O.damageInput}))})}var Xe=s(Ne,2);{var ce=Ge=>{var O=_o(),J=l(O),ee=l(J),C=s(l(ee),2);Fe(C),a(ee);var T=s(ee,2),S=s(l(T),2);Fe(S);var K=s(S,2);kt(K,5,()=>oe,$t,(he,Le)=>{var Oe=po(),Ke={};$(()=>{Ke!==(Ke=e(Le))&&(Oe.value=(Oe.__value=e(Le))??"")}),n(he,Oe)}),a(K),a(T),a(J);var b=s(J,2),w=s(l(b),2);kt(w,1,()=>oe,$t,(he,Le)=>{var Oe=go();let Ke;var nt=l(Oe,!0);a(Oe),$(()=>{Ke=At(Oe,1,"quick-type-btn use-enabled svelte-uvfntf",null,Ke,{active:e(k)===e(Le)}),x(nt,e(Le))}),P("click",Oe,()=>o(k,e(Le))),n(he,Oe)}),a(b);var pe=s(b,2);{var qe=he=>{var Le=mo();P("click",Le,be),n(he,Le)},Ee=he=>{var Le=ho(),Oe=s(l(Le),2),Ke=l(Oe),nt=l(Ke),gt=s(l(nt),2),dt=l(gt);a(gt),a(nt);var at=s(nt,2);kt(at,5,()=>e(L),$t,(we,je)=>{var ge=bo(),Re=l(ge,!0);a(ge),$(()=>x(Re,e(je))),n(we,ge)}),a(at);var j=s(at,2),N=s(l(j),2),$e=l(N,!0);a(N),a(j),a(Ke),a(Oe);var Q=s(Oe,2),A=l(Q),te=s(A,2);a(Q),a(Le),$(()=>{x(dt,`${e(y)??""} ${e(k)??""}`),x($e,e(E))}),P("click",A,ue),P("click",te,H),n(he,Le)};g(pe,he=>{e(se)?he(Ee,!1):he(qe)})}a(O),Qe(C,()=>e(y),he=>o(y,he)),Qe(S,()=>e(k),he=>o(k,he)),n(Ge,O)};g(Xe,Ge=>{u(),i(()=>!u().damageInput)&&Ge(ce)})}a(z),$(()=>Te=At(z,1,"damage-input svelte-uvfntf",null,Te,{hidden:!e(R)})),n(r,z),Wt(),m()}var So=d('<link rel="icon" type="image/png" href="favicon4.png"/> <meta name="viewport" content="width=device-width, initial-scale=1"/>',1),wo=d('<span class="character-name svelte-1uha8ag"> </span>'),ko=d("<span> </span>"),$o=d('<div class="spell-slots-header svelte-1uha8ag"></div>'),Co=d("<span> </span><br/>",1),Do=d("<span> </span><br/>",1),Lo=d("<span> </span><br/>",1),jo=d("<span> </span><br/>",1),Ao=d("<span> </span><br/>",1),To=d("<span> </span><br/>",1),Ro=d("<br/><em> <!>)</em>",1),Bo=d("<br/><em>(requires reaction)</em>",1),Po=d('<div class="ability-detail"><strong> </strong> <!></div>'),Mo=d('<div class="abilities-section"><strong>Abilities:</strong><br/> <!></div>'),Uo=d('<span class="effect-tooltip"><strong> </strong><br/> <br/> <!> <!> <!> <!> <!> <!> <!></span>'),Fo=d('<button class="effect-remove-btn svelte-1uha8ag">√ó</button>'),Io=d('<span class="effect-badge svelte-1uha8ag" tabindex="0"> <!> <!></span>'),Eo=d(`<div class="active-effects-header svelte-1uha8ag"></div> <style>.effect-badge {
              position: relative;
            }
            .effect-tooltip {
              position: absolute;
              top: 120%;
              left: 50%;
              transform: translateX(-50%);
              background: #fff;
              color: #222;
              border: 1px solid #a5b4fc;
              border-radius: 6px;
              padding: 8px 12px;
              font-size: 0.95em;
              box-shadow: 0 2px 8px rgba(0, 0, 0, 0.12);
              z-index: 10;
              min-width: 180px;
              max-width: 300px;
              white-space: normal;
              pointer-events: none;
              opacity: 1;
              transition: opacity 0.15s;
            }

            .abilities-section {
              margin-top: 8px;
              padding-top: 8px;
              border-top: 1px solid #e5e7eb;
            }

            .ability-detail {
              margin-top: 6px;
              padding: 4px;
              background: #f9fafb;
              border-radius: 4px;
              font-size: 0.9em;
            }

            .ability-detail strong {
              color: #6366f1;
            }

            .ability-detail em {
              font-size: 0.85em;
              color: #6b7280;
            }</style>`,1),Ho=d('<div class="rest-menu svelte-1uha8ag"><button class="rest-option svelte-1uha8ag">‚òï Short Rest</button> <button class="rest-option svelte-1uha8ag">üõèÔ∏è Long Rest</button></div>'),No=d('<div class="container svelte-1uha8ag"><header class="svelte-1uha8ag"><div class="header-top svelte-1uha8ag"><div class="header-title svelte-1uha8ag"><div class="title-row svelte-1uha8ag"><h1 class="svelte-1uha8ag">D&D Character Sheet</h1> <!></div> <!> <!></div> <div class="header-right svelte-1uha8ag"><div class="header-controls svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">üé≤</span><span class="btn-text svelte-1uha8ag">Roll Dice</span></button> <div class="rest-button-container svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">üò¥</span><span class="btn-text svelte-1uha8ag">Rest</span></button> <!></div> <button class="btn btn-secondary use-enabled" title="Add custom condition with effects"><span class="btn-icon svelte-1uha8ag">‚ú®</span><span class="btn-text svelte-1uha8ag">Add Condition</span></button> <div class="mode-toggle"><button><span class="btn-icon svelte-1uha8ag"> </span><span class="btn-text svelte-1uha8ag"> </span></button></div></div> <div class="header-search svelte-1uha8ag"><input type="text" placeholder="üîç Search..." class="search-input use-enabled svelte-1uha8ag"/></div></div></div> <div class="header-actions svelte-1uha8ag"><button class="btn btn-mode svelte-1uha8ag">üìö Browse Spells & Feats</button> <button class="btn btn-secondary">Save to Gist</button> <button class="btn btn-secondary">Load from Gist</button> <button class="btn btn-secondary">Export JSON</button> <button class="btn btn-secondary">Import JSON</button> <input type="file" accept=".json" style="display: none;"/></div></header> <main class="svelte-1uha8ag"><!> <!> <!> <!> <!> <!> <!> <!> <!></main></div> <!> <!> <!> <!> <!>',1);function Yo(r,c){qt(c,!1);const t=()=>pt(De,"$character",f),v=()=>pt(ya,"$isEditMode",f),u=()=>pt(ma,"$searchFilter",f),[f,m]=sa();let R=D(""),y=D(0);function k(){const h=[],ke=t().classFeatures.spellSlotsByLevel||{};for(let U=1;U<=9;U++){const ut=ke[U];if(ut&&ut.length>0){const Se=ut.length,Me=ut.filter(re=>re).length;h.push({level:U,available:Se-Me,total:Se})}}return h}let se=D(!1),E=D(!1),L=D(!1),oe=D(!1),be=D("save"),ue=D(void 0),H=D(""),z=D(""),Te=D(""),Ne=D(!1),Xe=D([]),ce=D("other"),Ge=D(),O=!1,J=1,ee=D(!1),C=D(null);function T(h){o(C,h)}function S(){o(C,null)}function K(h){o(C,e(C)===h?null:h)}function b(h){De.update(ke=>(ke.activeStates||(ke.activeStates=[]),ke.activeStates=[...ke.activeStates,h],ke)),o(oe,!1),It.add(`Added condition: ${h.name}`,"success")}function w(){o(oe,!1)}function pe(){const h=[];De.update(U=>{const ut=U.hitDice.current;U.hitDice.current=Math.min(U.hitDice.max,U.hitDice.current+Math.max(1,Math.floor(U.hitDice.max/2)));const Se=U.hitDice.current-ut;if(Se>0&&h.push(`${Se} hit ${Se===1?"die":"dice"}`),U.class){const Me=Ca(U.class,U.level,U.subclass);U.classFeatures.features||(U.classFeatures.features={}),Me.forEach(re=>{if(re.resetOn==="short"){const tt=re.name.replace(/\s+/g,"");if(re.type==="uses"){const lt=typeof re.maxUses=="function"?re.maxUses(U.level):re.maxUses;U.classFeatures.features[tt]=Array(lt).fill(!1),h.push(re.name)}else if(re.type==="pool"){const lt=typeof re.maxPool=="function"?re.maxPool(U.level):re.maxPool;lt!==void 0&&(U.classFeatures.features[tt]=lt,h.push(re.name))}}})}if(U.activeStates&&U.activeStates.forEach(Me=>{Me.abilities&&Me.abilities.forEach(re=>{if(re.restType==="short"&&re.usesPerRest){const tt=re.usesPerRest-(re.currentUses||0)>0;re.currentUses=re.usesPerRest,tt&&h.push(`${Me.name}: ${re.name}`)}})}),U.racialTraits&&U.racialTraits.length>0){const Me=JSON.stringify(U.racialTraits);U.racialTraits=ws(U.racialTraits,"short");const re=JSON.stringify(U.racialTraits);Me!==re&&h.push("racial trait uses")}return U}),o(ee,!1);const ke=h.length>0?`Short rest taken! Restored: ${h.join(", ")}`:"Short rest taken!";It.add(ke,"success")}function qe(){const h=[];De.update(U=>{const ut=U.maxHP-U.currentHP;ut>0&&h.push(`${ut} HP`),U.currentHP=U.maxHP,U.tempHP=0;const Se=U.hitDice.max-U.hitDice.current;Se>0&&h.push(`${Se} hit ${Se===1?"die":"dice"}`),U.hitDice.current=U.hitDice.max;let Me=0;if(U.classFeatures.spellSlotsByLevel&&Object.keys(U.classFeatures.spellSlotsByLevel).forEach(re=>{const tt=U.classFeatures.spellSlotsByLevel[parseInt(re)];if(tt){const lt=tt.filter(ht=>ht).length;Me+=lt,U.classFeatures.spellSlotsByLevel[parseInt(re)]=Array(tt.length).fill(!1)}}),Me>0&&h.push(`${Me} spell ${Me===1?"slot":"slots"}`),U.class){const re=Ca(U.class,U.level,U.subclass);U.classFeatures.features||(U.classFeatures.features={});let tt=!1;re.forEach(lt=>{const ht=lt.name.replace(/\s+/g,"");if(!(lt.type==="info"||lt.type==="channelDivinity")){if(lt.type==="uses"){const ft=typeof lt.maxUses=="function"?lt.maxUses(U.level):lt.maxUses;U.classFeatures.features[ht]=Array(ft).fill(!1),tt=!0}else if(lt.type==="pool"){const ft=typeof lt.maxPool=="function"?lt.maxPool(U.level):lt.maxPool;ft!==void 0&&(U.classFeatures.features[ht]=ft,tt=!0)}}}),tt&&h.push("all class features")}if(U.activeStates){let re=!1;U.activeStates.forEach(tt=>{tt.abilities&&tt.abilities.forEach(lt=>{if(lt.usesPerRest){const ht=(lt.currentUses||0)<lt.usesPerRest;lt.currentUses=lt.usesPerRest,ht&&(re=!0)}})}),re&&h.push("condition abilities")}if(U.racialTraits&&U.racialTraits.length>0){const re=JSON.stringify(U.racialTraits);console.log("Before reset racial traits:",U.racialTraits),U.racialTraits=ws(U.racialTraits,"long"),console.log("After reset racial traits:",U.racialTraits);const tt=JSON.stringify(U.racialTraits);re!==tt&&h.push("racial trait uses")}return U}),o(ee,!1);const ke=h.length>0?`Long rest taken! Restored: ${h.join(", ")}`:"Long rest taken! Fully rested.";It.add(ke,"success")}function Ee(h){o(H,""),o(z,""),o(Te,""),o(Ne,!1),o(Xe,[]),o(ce,"other"),O=!1,typeof h=="string"?o(H,h):(o(H,h.notation),o(z,h.damageNotation||""),o(Te,h.attackName||""),o(Ne,!!h.applyHalfDamage),o(Xe,h.bonusBreakdown||[]),o(ce,h.rollType||"other")),o(se,!0)}function he(h){const{notation:ke,count:U,bonusBreakdown:ut}=h.detail;o(H,""),O=!0,J=U||1,setTimeout(()=>{o(H,ke),o(z,""),o(Te,"Hit Die"),o(Xe,ut||[]),o(ce,"other")},0),o(se,!0)}function Le(){if(o(se,!1),O&&e(Ge)){const h=e(Ge).getLastRollTotal();if(h!==null){const ke=Math.max(1,h);De.update(U=>(U.hitDice.current=Math.max(0,U.hitDice.current-J),U.currentHP=Math.min(U.maxHP,U.currentHP+ke),U))}O=!1}}function Oe(){ya.update(h=>!h)}function Ke(h){h.target.closest(".rest-button-container")||o(ee,!1)}Sa(()=>{if(t().race&&t().level&&(!t().racialTraits||t().racialTraits.length===0)){const ke=Ss(t().race,t().level);ke.length>0&&De.update(U=>(U.racialTraits=ss(ke),console.log("Initialized racial traits on mount:",U.racialTraits),U))}const h=ya.subscribe(ke=>{ke?document.body.classList.remove("use-mode"):document.body.classList.add("use-mode")});return document.addEventListener("click",Ke),()=>{h(),document.removeEventListener("click",Ke)}});function nt(){nl(t())}function gt(){e(ue)?.click()}async function dt(h){const U=h.target.files?.[0];if(U)try{const ut=await ol(U);De.set(ut),alert("Character imported successfully!")}catch{alert("Failed to import character file")}}et(()=>(t(),e(R),e(y),ss),()=>{if((t().race!==e(R)||t().level!==e(y))&&(e(R)!==""||e(y),o(R,t().race),o(y,t().level),t().race&&t().level)){const h=Ss(t().race,t().level),ke=(t().racialTraits||[]).map(Me=>Me.name).sort().join(","),U=h.map(Me=>Me.name).sort().join(","),ut=(t().racialTraits||[]).reduce((Me,re)=>Me+re.spells.length,0),Se=h.reduce((Me,re)=>Me+re.spells.length,0);(!t().racialTraits||ke!==U||ut!==Se)&&De.update(Me=>{if(h.length>0){const re=h.map(tt=>{const lt=(Me.racialTraits||[]).find(ht=>ht.name===tt.name);return lt?{...tt,currentUses:lt.currentUses??tt.usesPerRest,spells:tt.spells.map(ht=>{const ft=lt.spells.find(yt=>yt.spellName===ht.spellName);return ft&&ft.currentUses!==void 0?{...ht,currentUses:ft.currentUses}:{...ht,currentUses:ht.usesPerRest==="at-will"?void 0:ht.usesPerRest||void 0}})}:{...tt,currentUses:tt.usesPerRest,spells:tt.spells.map(ht=>({...ht,currentUses:ht.usesPerRest==="at-will"?void 0:ht.usesPerRest||void 0}))}});Me.racialTraits=ss(re)}else Me.racialTraits=[];return Me})}}),aa(),Gt();var at=No();il("1uha8ag",h=>{var ke=So();Yt(2),js(()=>{al.title="D&D Character Sheet"}),n(h,ke)});var j=Be(at),N=l(j),$e=l(N),Q=l($e),A=l(Q),te=s(l(A),2);{var we=h=>{var ke=wo(),U=l(ke);a(ke),$(()=>x(U,`${t(),i(()=>t().name)??""} (${t(),i(()=>t().level)??""})`)),n(h,ke)};g(te,h=>{t(),i(()=>t().name)&&h(we)})}a(A);var je=s(A,2);{var ge=h=>{var ke=$o();kt(ke,5,()=>i(k),$t,(U,ut)=>{var Se=ko();let Me;var re=l(Se);a(Se),$(()=>{Me=At(Se,1,"slot-badge svelte-1uha8ag",null,Me,{depleted:e(ut).available===0}),x(re,`Lv${e(ut),i(()=>e(ut).level)??""}: ${e(ut),i(()=>e(ut).available)??""}/${e(ut),i(()=>e(ut).total)??""}`)}),n(U,Se)}),a(ke),n(h,ke)};g(je,h=>{i(()=>k().length>0)&&h(ge)})}var Re=s(je,2);{var fe=h=>{var ke=Eo(),U=Be(ke);kt(U,5,()=>(t(),i(()=>t().activeStates)),$t,(ut,Se,Me)=>{var re=Io(),tt=l(re),lt=s(tt);{var ht=Bt=>{var Jt=Uo(),Rt=l(Jt),Ut=l(Rt,!0);a(Rt);var Zt=s(Rt,2),Tt=s(Zt,3);{var Ft=_t=>{var bt=Co(),St=Be(bt),Ct=l(St);a(St),Yt(),$(()=>x(Ct,`Attack Bonus: ${e(Se),i(()=>typeof e(Se).attackBonus=="number"&&e(Se).attackBonus>0?"+":"")??""}${e(Se),i(()=>e(Se).attackBonus)??""}`)),n(_t,bt)};g(Tt,_t=>{e(Se),i(()=>e(Se).attackBonus)&&_t(Ft)})}var Ht=s(Tt,2);{var la=_t=>{var bt=Do(),St=Be(bt),Ct=l(St);a(St),Yt(),$(()=>x(Ct,`Damage Bonus: ${e(Se),i(()=>typeof e(Se).damageBonus=="number"&&e(Se).damageBonus>0?"+":"")??""}${e(Se),i(()=>e(Se).damageBonus)??""}`)),n(_t,bt)};g(Ht,_t=>{e(Se),i(()=>e(Se).damageBonus)&&_t(la)})}var ia=s(Ht,2);{var va=_t=>{var bt=Lo(),St=Be(bt),Ct=l(St);a(St),Yt(),$(()=>x(Ct,`AC Bonus: ${e(Se),i(()=>e(Se).acBonus>0?"+":"")??""}${e(Se),i(()=>e(Se).acBonus)??""}`)),n(_t,bt)};g(ia,_t=>{e(Se),i(()=>e(Se).acBonus)&&_t(va)})}var Xt=s(ia,2);{var Nt=_t=>{var bt=jo(),St=Be(bt),Ct=l(St);a(St),Yt(),$(()=>x(Ct,`Darkvision: ${e(Se),i(()=>e(Se).darkvision)??""} feet`)),n(_t,bt)};g(Xt,_t=>{e(Se),i(()=>e(Se).darkvision)&&_t(Nt)})}var Kt=s(Xt,2);{var ea=_t=>{var bt=Ao(),St=Be(bt),Ct=l(St);a(St),Yt(),$(wt=>x(Ct,`Resistances: ${wt??""}`),[()=>(e(Se),i(()=>e(Se).resistances.join(", ")))]),n(_t,bt)};g(Kt,_t=>{e(Se),i(()=>e(Se).resistances&&e(Se).resistances.length>0)&&_t(ea)})}var Lt=s(Kt,2);{var ta=_t=>{var bt=To(),St=Be(bt),Ct=l(St);a(St),Yt(),$(wt=>x(Ct,`Immunities: ${wt??""}`),[()=>(e(Se),i(()=>e(Se).immunities.join(", ")))]),n(_t,bt)};g(Lt,_t=>{e(Se),i(()=>e(Se).immunities&&e(Se).immunities.length>0)&&_t(ta)})}var ca=s(Lt,2);{var da=_t=>{var bt=Mo(),St=s(l(bt),3);kt(St,1,()=>(e(Se),i(()=>e(Se).abilities)),$t,(Ct,wt)=>{var oa=Po(),Pt=l(oa),Vt=l(Pt);a(Pt);var ra=s(Pt),fa=s(ra);{var Qa=wa=>{var Da=Ro(),Ea=s(Be(Da)),Ha=l(Ea),La=s(Ha);{var Xa=Za=>{var Fs=jt(", requires reaction");n(Za,Fs)};g(La,Za=>{e(wt),i(()=>e(wt).requiresReaction)&&Za(Xa)})}Yt(),a(Ea),$(()=>x(Ha,`(${e(wt),i(()=>e(wt).currentUses||0)??""}/${e(wt),i(()=>e(wt).usesPerRest)??""} uses per ${e(wt),i(()=>e(wt).restType)??""}
                                rest`)),n(wa,Da)},Us=wa=>{var Da=ot(),Ea=Be(Da);{var Ha=La=>{var Xa=Bo();Yt(),n(La,Xa)};g(Ea,La=>{e(wt),i(()=>e(wt).requiresReaction)&&La(Ha)},!0)}n(wa,Da)};g(fa,wa=>{e(wt),i(()=>e(wt).usesPerRest)?wa(Qa):wa(Us,!1)})}a(oa),$(()=>{x(Vt,`${e(wt),i(()=>e(wt).name)??""}:`),x(ra,` ${e(wt),i(()=>e(wt).description)??""} `)}),n(Ct,oa)}),a(bt),n(_t,bt)};g(ca,_t=>{e(Se),i(()=>e(Se).abilities&&e(Se).abilities.length>0)&&_t(da)})}a(Jt),$(()=>{x(Ut,(e(Se),i(()=>e(Se).name))),x(Zt,` ${e(Se),i(()=>e(Se).description)??""}`)}),n(Bt,Jt)};g(lt,Bt=>{e(C)===Me&&Bt(ht)})}var ft=s(lt,2);{var yt=Bt=>{var Jt=Fo();$(()=>rt(Jt,"title",`End ${e(Se),i(()=>e(Se).name)??""}`)),P("click",Jt,()=>{De.update(Rt=>{if(Rt.activeStates){const Ut=Rt.activeStates[Me];Ut?.hpBonus&&Ut.target!=="other"&&(Rt.maxHP-=Ut.hpBonus,Rt.currentHP=Math.max(1,Math.min(Rt.currentHP-Ut.hpBonus,Rt.maxHP))),Rt.activeStates=Rt.activeStates.filter((Zt,Tt)=>Tt!==Me)}return Rt})}),n(Bt,Jt)};g(ft,Bt=>{v()||Bt(yt)})}a(re),$(()=>{rt(re,"aria-label",(e(Se),i(()=>e(Se).name))),x(tt,`‚ú® ${e(Se),i(()=>e(Se).name)??""} `)}),P("mouseenter",re,()=>T(Me)),P("mouseleave",re,S),P("focus",re,()=>T(Me)),P("blur",re,S),P("click",re,()=>K(Me)),n(ut,re)}),a(U),Yt(2),n(h,ke)};g(Re,h=>{t(),i(()=>t().activeStates&&t().activeStates.length>0)&&h(fe)})}a(Q);var V=s(Q,2),M=l(V),We=l(M),Pe=s(We,2),Ye=l(Pe),Ue=s(Ye,2);{var p=h=>{var ke=Ho(),U=l(ke),ut=s(U,2);a(ke),P("click",U,pe),P("click",ut,qe),n(h,ke)};g(Ue,h=>{e(ee)&&h(p)})}a(Pe);var I=s(Pe,2),G=s(I,2),F=l(G);let _e;var Ae=l(F),ne=l(Ae,!0);a(Ae);var le=s(Ae),W=l(le,!0);a(le),a(F),a(G),a(M);var ve=s(M,2),de=l(ve);Fe(de),a(ve),a(V),a($e);var ie=s($e,2),ye=l(ie),Ie=s(ye,2),He=s(Ie,2),X=s(He,2),_=s(X,2),Z=s(_,2);Ba(Z,h=>o(ue,h),()=>e(ue)),a(ie),a(N);var Y=s(N,2),q=l(Y);jl(q,{});var xe=s(q,2);Bl(xe,{$$events:{roll:h=>Ee(h.detail)}});var Ze=s(xe,2);ei(Ze,{$$events:{roll:h=>Ee(h.detail)}});var it=s(Ze,2);Yl(it,{$$events:{rollHitDice:he}});var Ve=s(it,2);xo(Ve,{});var ze=s(Ve,2);lr(ze,{$$events:{roll:h=>Ee(h.detail)}});var Ce=s(ze,2);xr(Ce,{});var ae=s(Ce,2);Xr(ae,{});var Je=s(ae,2);tn(Je,{}),a(Y),a(j);var mt=s(j,2);Ba(Sn(mt,{get notation(){return e(H)},get damageNotation(){return e(z)},get attackName(){return e(Te)},get applyHalfDamage(){return e(Ne)},get bonusBreakdown(){return e(Xe)},get rollType(){return e(ce)},get visible(){return e(se)},$$events:{close:Le},$$legacy:!0}),h=>o(Ge,h),()=>e(Ge));var st=s(mt,2);{var ct=h=>{On(h,{get mode(){return e(be)},$$events:{close:()=>o(E,!1)}})};g(st,h=>{e(E)&&h(ct)})}var me=s(st,2);{var Dt=h=>{lo(h,{onClose:()=>o(L,!1)})};g(me,h=>{e(L)&&h(Dt)})}var zt=s(me,2);fo(zt,{get show(){return e(oe)},onSave:b,onCancel:w});var Et=s(zt,2);rl(Et,{}),$(()=>{_e=At(F,1,"btn btn-mode svelte-1uha8ag",null,_e,{"use-mode":!v()}),x(ne,v()?"üìù":"üé≤"),x(W,v()?"Edit Mode":"Use Mode")}),P("click",We,()=>{o(Xe,[]),o(se,!0)}),P("click",Ye,()=>o(ee,!e(ee))),P("click",I,()=>o(oe,!0)),P("click",F,Oe),Qe(de,u,h=>cl(ma,h)),P("click",ye,()=>o(L,!0)),P("click",Ie,()=>{o(be,"save"),o(E,!0)}),P("click",He,()=>{o(be,"load"),o(E,!0)}),P("click",X,nt),P("click",_,gt),P("change",Z,dt),n(r,at),Wt(),m()}export{Yo as component};
