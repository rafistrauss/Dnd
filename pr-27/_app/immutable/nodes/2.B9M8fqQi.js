import{d as gs,g as Ns,f as u,e as R,a as o,s as k,c as bt,t as Pt}from"../chunks/BESELRjb.js";import{i as zt}from"../chunks/JMgyEzd3.js";import{c as $a,o as wa,a as Os,b as Gs}from"../chunks/CtPH092J.js";import{F as L,T as ha,Y as ns,j as qs,aZ as zs,U as bs,ag as Ws,aD as Ks,aK as Vs,aE as Js,a1 as Ys,av as Oa,a7 as us,i as As,a_ as Qs,a$ as Rs,b0 as Ya,K as ya,e as Bs,b1 as Ts,b2 as Xs,b3 as Zs,b4 as el,q as os,b5 as tl,b6 as al,ab as sl,d as r,r as fs,g as ll,C as Wt,G as Kt,H as l,I as s,J as a,b7 as Je,b8 as pa,s as n,a4 as D,f as e,m as Ct,E as we,b9 as qt,ao as ta,A as O,ba,bb as ja,bc as il}from"../chunks/DyJ43TGI.js";import{t as rl,c as aa,a as de,e as xt,i as jt,u as Ms,s as _a,b as Mt,d as Qa,f as xa,g as Va,j as nl,k as Ot,l as ol,m as hs,n as es,h as cl,T as vl,o as dl,p as ul,r as _s,q as ys}from"../chunks/DXf4DosC.js";import{i as g,s as ca,a as ut,b as Nt,d as Fa,e as fl}from"../chunks/CCL4udNy.js";import{p as At,b as Ua}from"../chunks/iXw84bXb.js";import{b as Pa,r as pl}from"../chunks/CbbHiVLz.js";function ml(i,c,t=!1,v=!1,f=!1){var p=i,m="";L(()=>{var w=qs;if(m===(m=c()??"")){ha&&ns();return}if(w.nodes_start!==null&&(zs(w.nodes_start,w.nodes_end),w.nodes_start=w.nodes_end=null),m!==""){if(ha){bs.data;for(var y=ns(),b=y;y!==null&&(y.nodeType!==Ws||y.data!=="");)b=y,y=Ks(y);if(y===null)throw Vs(),Js;gs(bs,b),p=Ys(y);return}var W=m+"";t?W=`<svg>${W}</svg>`:v&&(W=`<math>${W}</math>`);var I=Ns(W);if((t||v)&&(I=Oa(I)),gs(Oa(I),I.lastChild),t||v)for(;Oa(I);)p.before(Oa(I));else p.before(I)}})}function gl(i,c,t,v,f){ha&&ns();var p=c.$$slots?.[t],m=!1;p===!0&&(p=c[t],m=!0),p===void 0?f!==null&&f(i):p(i,m?()=>v:v)}function bl(i,c,t,v){var f=i.__style;if(ha||f!==c){var p=rl(c);(!ha||p!==i.getAttribute("style"))&&(p==null?i.removeAttribute("style"):i.style.cssText=p),i.__style=c}return v}function Ja(i,c,t=!1){if(i.multiple){if(c==null)return;if(!As(c))return Qs();for(var v of i.options)v.selected=c.includes(Ia(v));return}for(v of i.options){var f=Ia(v);if(Rs(f,c)){v.selected=!0;return}}(!t||c!==void 0)&&(i.selectedIndex=-1)}function cs(i){var c=new MutationObserver(()=>{Ja(i,i.__value)});c.observe(i,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),us(()=>{c.disconnect()})}function Ha(i,c,t=c){var v=new WeakSet,f=!0;Ya(i,"change",p=>{var m=p?"[selected]":":checked",w;if(i.multiple)w=[].map.call(i.querySelectorAll(m),Ia);else{var y=i.querySelector(m)??i.querySelector("option:not([disabled])");w=y&&Ia(y)}t(w),ya!==null&&v.add(ya)}),Bs(()=>{var p=c();if(i===document.activeElement){var m=Ts??ya;if(v.has(m))return}if(Ja(i,p,f),f&&p===void 0){var w=i.querySelector(":checked");w!==null&&(p=Ia(w),t(p))}i.__value=p,f=!1}),cs(i)}function Ia(i){return"__value"in i?i.__value:i.value}const hl=Symbol("is custom element"),_l=Symbol("is html");function Ce(i){if(ha){var c=!1,t=()=>{if(!c){if(c=!0,i.hasAttribute("value")){var v=i.value;et(i,"value",null),i.value=v}if(i.hasAttribute("checked")){var f=i.checked;et(i,"checked",null),i.checked=f}}};i.__on_r=t,os(t),tl()}}function Ea(i,c){var t=ps(i);t.value===(t.value=c??void 0)||i.value===c&&(c!==0||i.nodeName!=="PROGRESS")||(i.value=c??"")}function Fs(i,c){var t=ps(i);t.checked!==(t.checked=c??void 0)&&(i.checked=c)}function et(i,c,t,v){var f=ps(i);ha&&(f[c]=i.getAttribute(c),c==="src"||c==="srcset"||c==="href"&&i.nodeName==="LINK")||f[c]!==(f[c]=t)&&(c==="loading"&&(i[Xs]=t),t==null?i.removeAttribute(c):typeof t!="string"&&yl(i).includes(c)?i[c]=t:i.setAttribute(c,t))}function ps(i){return i.__attributes??={[hl]:i.nodeName.includes("-"),[_l]:i.namespaceURI===Zs}}var xs=new Map;function yl(i){var c=i.getAttribute("is")||i.nodeName,t=xs.get(c);if(t)return t;xs.set(c,t=[]);for(var v,f=i,p=Element.prototype;p!==f;){v=al(f);for(var m in v)v[m].set&&t.push(m);f=el(f)}return t}function He(i,c,t=c){var v=new WeakSet;Ya(i,"input",async f=>{var p=f?i.defaultValue:i.value;if(p=as(i)?ss(p):p,t(p),ya!==null&&v.add(ya),await sl(),p!==(p=c())){var m=i.selectionStart,w=i.selectionEnd,y=i.value.length;if(i.value=p??"",w!==null){var b=i.value.length;m===w&&w===y&&b>y?(i.selectionStart=b,i.selectionEnd=b):(i.selectionStart=m,i.selectionEnd=Math.min(w,b))}}}),(ha&&i.defaultValue!==i.value||r(c)==null&&i.value)&&(t(as(i)?ss(i.value):i.value),ya!==null&&v.add(ya)),fs(()=>{var f=c();if(i===document.activeElement){var p=Ts??ya;if(v.has(p))return}as(i)&&f===ss(i.value)||i.type==="date"&&!f&&!i.value||f!==i.value&&(i.value=f??"")})}const ts=new Set;function $s(i,c,t,v,f=v){var p=t.getAttribute("type")==="checkbox",m=i;let w=!1;if(c!==null)for(var y of c)m=m[y]??=[];m.push(t),Ya(t,"change",()=>{var b=t.__value;p&&(b=ws(m,b,t.checked)),f(b)},()=>f(p?[]:null)),fs(()=>{var b=v();if(ha&&t.defaultChecked!==t.checked){w=!0;return}p?(b=b||[],t.checked=b.includes(t.__value)):t.checked=Rs(t.__value,b)}),us(()=>{var b=m.indexOf(t);b!==-1&&m.splice(b,1)}),ts.has(m)||(ts.add(m),os(()=>{m.sort((b,W)=>b.compareDocumentPosition(W)===4?-1:1),ts.delete(m)})),os(()=>{if(w){var b;if(p)b=ws(m,b,t.checked);else{var W=m.find(I=>I.checked);b=W?.__value}f(b)}})}function La(i,c,t=c){Ya(i,"change",v=>{var f=v?i.defaultChecked:i.checked;t(f)}),(ha&&i.defaultChecked!==i.checked||r(c)==null)&&t(i.checked),fs(()=>{var v=c();i.checked=!!v})}function ws(i,c,t){for(var v=new Set,f=0;f<i.length;f+=1)i[f].checked&&v.add(i[f].__value);return t||v.delete(c),Array.from(v)}function as(i){var c=i.type;return c==="number"||c==="range"}function ss(i){return i===""?null:+i}function xl(i,c,t){var v=ll(i,c);v&&v.set&&(i[c]=t,us(()=>{i[c]=null}))}function ms(i){return function(...c){var t=c[0];return t.stopPropagation(),i?.apply(this,c)}}function Aa(i,c){var t=i.$$events?.[c.type],v=As(t)?t.slice():t==null?[]:[t];for(var f of v)f.call(this,c)}const $l="";function Ps(...i){return Pa+$l+pl(i[0],i[1])}const vs={paladin:{name:"Paladin",hitDice:"d10",spellcaster:!0,spellcastingAbility:"charisma",spellSlotsByLevel:{1:0,2:2,3:3,4:3,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Divine Sense",type:"uses",maxUses:(i,c=1)=>1+Math.max(1,c),resetOn:"long",description:"Detect celestials, fiends, and undead within 60 feet",minLevel:1},{name:"Lay on Hands",type:"pool",maxPool:i=>i*5,resetOn:"long",description:"Heal wounds or cure disease",minLevel:1},{name:"Divine Smite",type:"spellSlot",description:"Expend spell slot to deal extra radiant damage",minLevel:2,rollable:!0},{name:"Channel Divinity",type:"pool",maxPool:i=>i>=18?3:i>=6?2:1,resetOn:"short",description:"Sacred Weapon or Turn Undead",minLevel:3}]},fighter:{name:"Fighter",hitDice:"d10",spellcaster:!1,features:[{name:"Second Wind",type:"uses",maxUses:1,resetOn:"short",description:"Regain 1d10 + fighter level HP as bonus action",minLevel:1,rollable:!0,rollFormula:i=>`1d10+${i}`},{name:"Action Surge",type:"uses",maxUses:i=>i>=17?2:1,resetOn:"short",description:"Take one additional action on your turn",minLevel:2},{name:"Indomitable",type:"uses",maxUses:i=>i>=17?3:i>=13?2:1,resetOn:"long",description:"Reroll a failed saving throw",minLevel:9}],subclasses:{champion:{name:"Champion",features:[{name:"Improved Critical",type:"info",description:"Critical hit on 19-20",minLevel:3},{name:"Remarkable Athlete",type:"info",description:"Add half proficiency to STR/DEX/CON checks, increase long jump distance",minLevel:7},{name:"Additional Fighting Style",type:"info",description:"Choose a second fighting style",minLevel:10},{name:"Superior Critical",type:"info",description:"Critical hit on 18-20",minLevel:15},{name:"Survivor",type:"info",description:"Regain 5 + CON mod HP at start of turn if below half HP",minLevel:18}]},battlemaster:{name:"Battle Master",features:[{name:"Combat Superiority",type:"uses",maxUses:i=>i>=15?6:i>=7?5:4,resetOn:"short",description:i=>`Use superiority dice (${i>=18?"d12":i>=10?"d10":"d8"}) for maneuvers`,minLevel:3},{name:"Know Your Enemy",type:"info",description:"Learn capabilities of creatures you observe",minLevel:7},{name:"Improved Combat Superiority",type:"info",description:"Superiority dice become d10",minLevel:10},{name:"Relentless",type:"info",description:"Regain 1 superiority die if you have none at start of turn",minLevel:15}]}}},rogue:{name:"Rogue",hitDice:"d8",spellcaster:!1,features:[{name:"Sneak Attack",type:"info",description:i=>`Deal ${Math.ceil(i/2)}d6 extra damage once per turn with advantage or ally nearby`,minLevel:1,rollable:!0,rollFormula:i=>`${Math.ceil(i/2)}d6`},{name:"Cunning Action",type:"info",description:"Dash, Disengage, or Hide as a bonus action",minLevel:2},{name:"Uncanny Dodge",type:"info",description:"Use reaction to halve damage from an attack",minLevel:5},{name:"Evasion",type:"info",description:"Take no damage on successful Dex save (half on fail)",minLevel:7}]},wizard:{name:"Wizard",hitDice:"d6",spellcaster:!0,spellcastingAbility:"intelligence",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Arcane Recovery",type:"uses",maxUses:1,resetOn:"long",description:i=>`Recover spell slots totaling up to ${Math.ceil(i/2)} levels during short rest`,minLevel:1},{name:"Spell Mastery",type:"info",description:"Cast one 1st-level and one 2nd-level spell at will",minLevel:18}]},cleric:{name:"Cleric",hitDice:"d8",spellcaster:!0,spellcastingAbility:"wisdom",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Channel Divinity",type:"pool",maxPool:i=>i>=18?3:i>=6?2:1,resetOn:"short",description:"Turn Undead or domain-specific ability",minLevel:2},{name:"Destroy Undead",type:"info",description:i=>`Channel Divinity destroys undead of CR ${i>=17?4:i>=14?3:i>=11?2:i>=8?1:.5} or lower`,minLevel:5},{name:"Divine Intervention",type:"uses",maxUses:1,resetOn:"long",description:i=>`${i}% chance to succeed, implore deity for aid`,minLevel:10}],subclasses:{war:{name:"War Domain",features:[{name:"War Priest",type:"uses",maxUses:(i,c=1)=>Math.max(1,c),resetOn:"long",description:"Make one weapon attack as a bonus action",minLevel:1},{name:"Guided Strike",type:"channelDivinity",description:"Use your Channel Divinity to gain +10 to an attack roll. Make this choice after you see the roll, but before the DM says whether the attack hits or misses.",minLevel:2,resetOn:"short"},{name:"War God's Blessing",type:"channelDivinity",description:"Use reaction to grant +10 to an ally's attack roll within 30 feet. Consumes one use of Channel Divinity.",minLevel:6,resetOn:"short"},{name:"Divine Strike",type:"info",description:i=>`Deal extra ${i>=14?"2d8":"1d8"} weapon damage once per turn`,minLevel:8,rollable:!0,rollFormula:i=>i>=14?"2d8":"1d8"},{name:"Avatar of Battle",type:"info",description:"Gain resistance to nonmagical weapon damage",minLevel:17}]},life:{name:"Life Domain",features:[{name:"Disciple of Life",type:"info",description:"Healing spells restore additional 2 + spell level HP",minLevel:1},{name:"Preserve Life",type:"pool",maxPool:i=>i*5,resetOn:"short",description:"Restore HP to creatures within 30 feet",minLevel:2},{name:"Blessed Healer",type:"info",description:"Regain 2 + spell level HP when you cast healing spell",minLevel:6},{name:"Divine Strike",type:"info",description:i=>`Deal extra ${i>=14?"2d8":"1d8"} radiant damage once per turn`,minLevel:8,rollable:!0,rollFormula:i=>i>=14?"2d8":"1d8"},{name:"Supreme Healing",type:"info",description:"Maximize healing dice instead of rolling",minLevel:17}]}}},barbarian:{name:"Barbarian",hitDice:"d12",spellcaster:!1,features:[{name:"Rage",type:"uses",maxUses:i=>i>=20?1/0:i>=17?6:i>=12?5:i>=6?4:i>=3?3:2,resetOn:"long",description:i=>`+${i>=16?4:i>=9?3:2} damage, resistance to physical damage`,minLevel:1},{name:"Reckless Attack",type:"info",description:"Gain advantage on melee attacks, enemies get advantage on you",minLevel:2},{name:"Danger Sense",type:"info",description:"Advantage on Dex saves against effects you can see",minLevel:2}],subclasses:{berserker:{name:"Path of the Berserker",features:[{name:"Frenzy",type:"info",description:"While raging, make melee attack as bonus action (gain 1 exhaustion after rage)",minLevel:3},{name:"Mindless Rage",type:"info",description:"Cannot be charmed or frightened while raging",minLevel:6},{name:"Intimidating Presence",type:"info",description:"Use action to frighten creature within 30 feet",minLevel:10},{name:"Retaliation",type:"info",description:"When damaged by creature within 5 feet, make melee attack as reaction",minLevel:14}]}}}};function oa(i){const c=i.toLowerCase();return vs[c]||null}function Ra(i,c,t){const v=oa(i);if(!v)return[];const f=v.features.filter(p=>!p.minLevel||p.minLevel<=c);if(t&&v.subclasses&&v.subclasses[t]){const p=v.subclasses[t].features.filter(m=>!m.minLevel||m.minLevel<=c);return[...f,...p]}return f}function Ss(i){const c=oa(i);return!c||!c.subclasses?[]:Object.keys(c.subclasses).map(t=>({id:t,name:c.subclasses[t].name}))}function ks(i,c){const t=oa(i);return!t||!t.spellcaster||!t.spellSlotsByLevel?0:t.spellSlotsByLevel[c]||0}function Cs(i,c,t){const v=oa(i);return!v||!v.spellcaster?0:Math.max(1,t+c)}function wl(i,c,t){const v=oa(i);return!v||!v.spellcaster?null:8+c+t}function Sl(){return Object.keys(vs).map(i=>({id:i,name:vs[i].name}))}var kl=u('<div class="section-header svelte-ls99y2" role="button" tabindex="0"><h2 class="svelte-ls99y2"> </h2> <span class="collapse-btn svelte-ls99y2"> </span></div>');function Sa(i,c){Wt(c,!1);let t=At(c,"title",8),v=At(c,"collapsed",8),f=At(c,"ariaLabel",8,""),p=At(c,"onToggle",8);zt();var m=kl(),w=l(m),y=l(w,!0);s(w);var b=a(w,2),W=l(b,!0);s(b),s(m),L(()=>{et(m,"aria-expanded",!v()),et(m,"aria-label",f()),k(y,t()),k(W,v()?"‚ñº":"‚ñ≤")}),R("click",m,function(...I){p()?.apply(this,I)}),R("keydown",m,I=>{(I.key==="Enter"||I.key===" ")&&p()()}),o(i,m),Kt()}var Cl=u("<option> </option>"),Dl=u("<option> </option>"),Ll=u('<div class="form-group svelte-172i2fj"><label for="characterSubclass" class="svelte-172i2fj">Subclass</label> <select id="characterSubclass" class="svelte-172i2fj"><option>Select Subclass</option><!></select></div>'),jl=u('<div class="info-grid svelte-172i2fj"><div class="form-group svelte-172i2fj"><label for="characterName" class="svelte-172i2fj">Character Name</label> <input type="text" id="characterName" placeholder="Enter name" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterClass" class="svelte-172i2fj">Class</label> <select id="characterClass" class="svelte-172i2fj"><option>Select Class</option><!></select></div> <!> <div class="form-group svelte-172i2fj"><label for="characterLevel" class="svelte-172i2fj">Level</label> <input type="number" id="characterLevel" min="1" max="20" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterRace" class="svelte-172i2fj">Race</label> <input type="text" id="characterRace" placeholder="e.g., Human" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterBackground" class="svelte-172i2fj">Background</label> <input type="text" id="characterBackground" placeholder="e.g., Soldier" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterAlignment" class="svelte-172i2fj">Alignment</label> <input type="text" id="characterAlignment" placeholder="e.g., Lawful Good" class="svelte-172i2fj"/></div></div>'),Al=u('<section class="character-info svelte-172i2fj"><!> <!></section>');function Rl(i,c){Wt(c,!1);const t=()=>ut(de,"$character",f),v=()=>ut(aa,"$collapsedStates",f),[f,p]=ca(),m=D(),w=Sl();function y(E){const j=E.target;de.update(B=>(B.class=j.value,B.subclass="",B))}function b(E){const j=E.target;de.update(B=>(B.subclass=j.value,B))}function W(E){const j=E.target;de.update(B=>(B.level=parseInt(j.value)||1,B)),Ms()}Je(()=>(t(),Ss),()=>{n(m,t().class?Ss(t().class):[])}),pa(),zt();var I=Al(),Z=l(I);{let E=Ct(()=>(v(),r(()=>v().characterInfo?"Expand":"Collapse")));Sa(Z,{title:"Character Info",get collapsed(){return v(),r(()=>v().characterInfo)},get ariaLabel(){return e(E)},onToggle:()=>aa.update(j=>({...j,characterInfo:!j.characterInfo}))})}var ee=a(Z,2);{var V=E=>{var j=jl(),B=l(j),F=a(l(B),2);Ce(F),s(B);var pe=a(B,2),Ee=a(l(pe),2),N=l(Ee);N.value=N.__value="";var Ie=a(N);xt(Ie,1,()=>w,jt,(ve,he)=>{var ge=Cl(),Ge=l(ge,!0);s(ge);var Ye={};L(()=>{k(Ge,(e(he),r(()=>e(he).name))),Ye!==(Ye=(e(he),r(()=>e(he).id)))&&(ge.value=(ge.__value=(e(he),r(()=>e(he).id)))??"")}),o(ve,ge)}),s(Ee);var me;cs(Ee),s(pe);var be=a(pe,2);{var je=ve=>{var he=Ll(),ge=a(l(he),2),Ge=l(ge);Ge.value=Ge.__value="";var Ye=a(Ge);xt(Ye,1,()=>e(m),jt,(ft,it)=>{var Ve=Dl(),$t=l(Ve,!0);s(Ve);var Dt={};L(()=>{k($t,(e(it),r(()=>e(it).name))),Dt!==(Dt=(e(it),r(()=>e(it).id)))&&(Ve.value=(Ve.__value=(e(it),r(()=>e(it).id)))??"")}),o(ft,Ve)}),s(ge);var ct;cs(ge),s(he),L(()=>{ct!==(ct=(t(),r(()=>t().subclass)))&&(ge.value=(ge.__value=(t(),r(()=>t().subclass)))??"",Ja(ge,(t(),r(()=>t().subclass))))}),R("change",ge,b),o(ve,he)};g(be,ve=>{e(m),r(()=>e(m).length>0)&&ve(je)})}var T=a(be,2),U=a(l(T),2);Ce(U),s(T);var $=a(T,2),X=a(l($),2);Ce(X),s($);var h=a($,2),P=a(l(h),2);Ce(P),s(h);var Y=a(h,2),ce=a(l(Y),2);Ce(ce),s(Y),s(j),L(()=>{me!==(me=(t(),r(()=>t().class)))&&(Ee.value=(Ee.__value=(t(),r(()=>t().class)))??"",Ja(Ee,(t(),r(()=>t().class)))),Ea(U,(t(),r(()=>t().level)))}),He(F,()=>t().name,ve=>Nt(de,r(t).name=ve,r(t))),R("change",Ee,y),R("change",U,W),He(X,()=>t().race,ve=>Nt(de,r(t).race=ve,r(t))),He(P,()=>t().background,ve=>Nt(de,r(t).background=ve,r(t))),He(ce,()=>t().alignment,ve=>Nt(de,r(t).alignment=ve,r(t))),o(E,j)};g(ee,E=>{v(),r(()=>!v().characterInfo)&&E(V)})}s(I),o(i,I),Kt(),p()}var Bl=u('<div class="ability-card svelte-bbv1xt"><h3 class="svelte-bbv1xt"> </h3> <input type="number" class="ability-score svelte-bbv1xt" min="1" max="30"/> <div class="ability-modifier svelte-bbv1xt"> </div> <div class="roll-buttons svelte-bbv1xt"><button class="roll-btn svelte-bbv1xt">Check</button> <button class="roll-btn svelte-bbv1xt">Save</button></div> <div class="save-proficiency svelte-bbv1xt"><input type="checkbox" class="svelte-bbv1xt"/> <label class="svelte-bbv1xt">Save Prof.</label></div></div>'),Tl=u('<div class="proficiency-bonus svelte-bbv1xt"><label for="profBonus">Proficiency Bonus</label> <input type="number" id="profBonus" class="prof-input svelte-bbv1xt"/></div> <div class="abilities-grid svelte-bbv1xt"></div>',1),Ml=u("<section><!> <!></section>");function Fl(i,c){Wt(c,!1);const t=()=>ut(Qa,"$abilityModifiers",w),v=()=>ut(de,"$character",w),f=()=>ut(_a,"$searchFilter",w),p=()=>ut(aa,"$collapsedStates",w),m=()=>ut(xa,"$isEditMode",w),[w,y]=ca(),b=D(),W=D(),I=$a(),Z=[{key:"strength",label:"Strength"},{key:"dexterity",label:"Dexterity"},{key:"constitution",label:"Constitution"},{key:"intelligence",label:"Intelligence"},{key:"wisdom",label:"Wisdom"},{key:"charisma",label:"Charisma"}];function ee(){Ms()}function V(N){const Ie=t()[N],me=`1d20${Ie>=0?"+":""}${Ie}`,be=[];be.push({value:"1d20",source:"base die"}),Ie!==0&&be.push({value:Ie,source:N}),I("roll",{notation:me,rollType:"check",bonusBreakdown:be})}function E(N){const Ie=t()[N],me=v().saveProficiencies[N]?v().proficiencyBonus:0,be=Ie+me,je=`1d20${be>=0?"+":""}${be}`,T=[];T.push({value:"1d20",source:"base die"}),Ie!==0&&T.push({value:Ie,source:N}),me!==0&&T.push({value:me,source:"proficiency"}),I("roll",{notation:je,rollType:"save",bonusBreakdown:T})}Je(()=>f(),()=>{n(b,Z.filter(({label:N})=>f()?N.toLowerCase().includes(f().toLowerCase()):!0))}),Je(()=>(e(b),f()),()=>{n(W,e(b).length>0||!f()||f().toLowerCase().includes("proficiency"))}),pa(),zt();var j=Ml();let B;var F=l(j);Sa(F,{title:"Ability Scores",get collapsed(){return p(),r(()=>p().abilityScores)},ariaLabel:"Toggle Ability Scores Section",onToggle:()=>aa.update(N=>({...N,abilityScores:!N.abilityScores}))});var pe=a(F,2);{var Ee=N=>{var Ie=Tl(),me=we(Ie),be=a(l(me),2);Ce(be),s(me);var je=a(me,2);xt(je,5,()=>e(b),jt,(T,U)=>{let $=()=>e(U).key,X=()=>e(U).label;var h=Bl(),P=l(h),Y=l(P,!0);s(P);var ce=a(P,2);Ce(ce);var ve=a(ce,2),he=l(ve);s(ve);var ge=a(ve,2),Ge=l(ge),Ye=a(Ge,2);s(ge);var ct=a(ge,2),ft=l(ct);Ce(ft);var it=a(ft,2);s(ct),s(h),L(Ve=>{k(Y,Ve),k(he,`${t(),$(),r(()=>t()[$()]>=0?"+":"")??""}${t(),$(),r(()=>t()[$()])??""}`),ft.disabled=!m(),et(ft,"id",`${$()}-save`),et(it,"for",`${$()}-save`)},[()=>(X(),r(()=>X().substring(0,3).toUpperCase()))]),He(ce,()=>v().abilities[$()],Ve=>Nt(de,r(v).abilities[$()]=Ve,r(v))),R("change",ce,ee),R("click",Ge,()=>V($())),R("click",Ye,()=>E($())),La(ft,()=>v().saveProficiencies[$()],Ve=>Nt(de,r(v).saveProficiencies[$()]=Ve,r(v))),o(T,h)}),s(je),He(be,()=>v().proficiencyBonus,T=>Nt(de,r(v).proficiencyBonus=T,r(v))),o(N,Ie)};g(pe,N=>{p(),r(()=>!p().abilityScores)&&N(Ee)})}s(j),L(()=>B=Mt(j,1,"ability-scores svelte-bbv1xt",null,B,{hidden:!e(W)})),o(i,j),Kt(),y()}const Is=[{name:"Unarmored",type:"none",baseAC:10},{name:"Padded",type:"light",baseAC:11},{name:"Leather",type:"light",baseAC:11},{name:"Studded Leather",type:"light",baseAC:12},{name:"Hide",type:"medium",baseAC:12,maxDexBonus:2},{name:"Chain Shirt",type:"medium",baseAC:13,maxDexBonus:2},{name:"Scale Mail",type:"medium",baseAC:14,maxDexBonus:2},{name:"Breastplate",type:"medium",baseAC:14,maxDexBonus:2},{name:"Half Plate",type:"medium",baseAC:15,maxDexBonus:2},{name:"Ring Mail",type:"heavy",baseAC:14,maxDexBonus:0},{name:"Chain Mail",type:"heavy",baseAC:16,maxDexBonus:0},{name:"Splint",type:"heavy",baseAC:17,maxDexBonus:0},{name:"Plate",type:"heavy",baseAC:18,maxDexBonus:0}];function Es(i){return Is.find(c=>c.name===i)}function Pl(i,c,t){if(!i)return 10+c+(t?2:0);const v=Es(i);if(!v)return 10+c+(t?2:0);let f=v.baseAC;return v.maxDexBonus===void 0?f+=c:v.maxDexBonus>0&&(f+=Math.min(c,v.maxDexBonus)),t&&(f+=2),f}function Na(i){return Math.floor((i-10)/2)}function ds(i,c){if(!i.class)return null;const t=oa(i.class);if(!t||!t.spellcaster||!t.spellcastingAbility)return null;const v=Na(c[t.spellcastingAbility]);return 8+i.proficiencyBonus+v}function ls(i,c){if(!i.class)return 0;const t=oa(i.class);return!t||!t.spellcaster||!t.spellcastingAbility?0:Na(c[t.spellcastingAbility])}function Il(i,c){const t=[],v=Na(c.dexterity),f=i.armorName?Es(i.armorName):void 0;if(f){if(f.type==="none")t.push("Unarmored"),t.push("Base: 10"),t.push(`Dexterity: ${v>=0?"+":""}${v}`);else if(f.type==="light")t.push(`${f.name}: ${f.baseAC}`),t.push(`Dexterity: ${v>=0?"+":""}${v}`);else if(f.type==="medium"){const p=Math.min(2,v);t.push(`${f.name}: ${f.baseAC}`),t.push(`Dexterity: ${p>=0?"+":""}${p} (max +2)`)}else f.type==="heavy"&&(t.push(`${f.name}: ${f.baseAC}`),t.push("Dexterity: +0 (heavy armor)"));i.shieldEquipped&&t.push("Shield: +2")}else{t.push("Base: 10"),v!==0&&t.push(`Dexterity: ${v>=0?"+":""}${v}`);const p=10+v,m=i.armorClass-p;m!==0&&t.push(`Other: ${m>=0?"+":""}${m}`)}return i.activeStates&&i.activeStates.length>0&&i.activeStates.forEach(p=>{typeof p.acBonus=="number"&&p.acBonus!==0&&(!p.target||p.target==="self")&&t.push(`${p.name}: ${p.acBonus>=0?"+":""}${p.acBonus}`)}),t.join(`
`)}function El(i,c){const t=[],v=Na(c.dexterity);t.push(`Dexterity: ${v>=0?"+":""}${v}`);const f=i.initiative-v;return f!==0&&t.push(`Other Bonuses: ${f>=0?"+":""}${f}`),t.join(`
`)}function Ul(i,c){if(!i.class)return"";const t=oa(i.class);if(!t||!t.spellcaster||!t.spellcastingAbility)return"";const v=[],f=Na(c[t.spellcastingAbility]),p=t.spellcastingAbility.charAt(0).toUpperCase()+t.spellcastingAbility.slice(1);return v.push("Base: 8"),v.push(`Proficiency: +${i.proficiencyBonus}`),v.push(`${p}: ${f>=0?"+":""}${f}`),v.join(`
`)}function Hl(i,c,t){const v=[];let f=i;const p=c.toLowerCase().trim();if(t.activeStates){for(const w of t.activeStates)if(w.immunities&&w.immunities.length>0&&w.immunities.some(b=>b.toLowerCase().trim()===p))return v.push(`Immune to ${c} (${w.name})`),{finalDamage:0,adjustments:v}}let m=!1;if(t.activeStates){for(const w of t.activeStates)if(w.resistances&&w.resistances.length>0&&w.resistances.some(b=>b.toLowerCase().trim()===p)){const b=Math.floor(f/2);v.push(`Resistant to ${c} (${w.name}): ${f} ‚Üí ${b}`),f=b,m=!0;break}}if(!m&&t.race){const w=Va(t.race);if(w){for(const y of w.traits)if(y.resistances&&y.resistances.some(b=>b.toLowerCase().trim()===p)){const b=Math.floor(f/2);v.push(`Resistant to ${c} (racial trait): ${f} ‚Üí ${b}`),f=b,m=!0;break}}}return v.length===0&&v.push(`No adjustments for ${c}`),{finalDamage:f,adjustments:v}}function Nl(i,c){const t={...i};if(t.tempHP>0){if(c<=t.tempHP)return t.tempHP-=c,t;c-=t.tempHP,t.tempHP=0}return t.currentHP=Math.max(0,t.currentHP-c),t}var Ol=u('<button class="info-icon svelte-1o8ci7b" type="button">‚ÑπÔ∏è</button>'),Gl=u('<button class="info-icon svelte-1o8ci7b" type="button">‚ÑπÔ∏è</button>'),ql=u("<div><!></div>"),zl=u('<div class="tooltip-wrapper svelte-1o8ci7b"><!> <!></div>');function is(i,c){Wt(c,!1);let t=At(c,"tooltipContent",8),v=At(c,"ariaLabel",8,"Show information"),f=D(!1),p=D(),m=D(!1),w=D(null),y=D(!1),b=D(!1),W=D("");const I=Math.random().toString(36).slice(2);function Z(){window.dispatchEvent(new CustomEvent("tooltip-open",{detail:I}))}function ee(T){T.detail!==I&&(n(f,!1),n(y,!1))}function V(){n(m,window.matchMedia("(pointer: coarse)").matches||"ontouchstart"in window)}function E(){if(!e(w)||!e(p))return;const T=e(p).getBoundingClientRect(),U=e(w).getBoundingClientRect();let $=T.bottom+5,X=T.left;n(y,!1),X+U.width>window.innerWidth-8&&(X=T.right-U.width,n(y,!0),X<8&&(X=8)),X<8&&(X=8),$+U.height>window.innerHeight-8&&($=T.top-U.height-5),n(W,`position:fixed;top:${$}px;left:${X}px;z-index:1000;`),n(b,!0)}function j(){Z(),n(f,!1),n(b,!1),requestAnimationFrame(()=>{n(f,!0),n(b,!1),setTimeout(E,0)})}function B(){n(f,!1),n(y,!1)}function F(T){T.stopPropagation(),e(f)?(n(f,!1),n(y,!1),n(b,!1)):(Z(),n(f,!1),n(b,!1),requestAnimationFrame(()=>{n(f,!0),n(b,!1),setTimeout(E,0)}))}function pe(T){e(p)&&!e(p).contains(T.target)&&(n(f,!1),n(y,!1))}wa(()=>{V(),document.addEventListener("click",pe),window.addEventListener("tooltip-open",ee)}),Os(()=>{document.removeEventListener("click",pe),window.removeEventListener("tooltip-open",ee)}),zt();var Ee=zl(),N=l(Ee);{var Ie=T=>{var U=Ol();L(()=>et(U,"aria-label",v())),R("click",U,F),o(T,U)},me=T=>{var U=Gl();L(()=>et(U,"aria-label",v())),R("mouseenter",U,j),R("mouseleave",U,B),o(T,U)};g(N,T=>{e(m)?T(Ie):T(me,!1)})}var be=a(N,2);{var je=T=>{var U=ql(),$=l(U);gl($,c,"content",{},X=>{var h=bt(),P=we(h);ml(P,t),o(X,h)}),s(U),Ua(U,X=>n(w,X),()=>e(w)),L(()=>{Mt(U,1,`tooltip-popup ${e(y)?"right-align":""}`,"svelte-1o8ci7b"),bl(U,e(b)?e(W)+"opacity:1;pointer-events:auto;":"opacity:0;pointer-events:none;position:fixed;top:0;left:0;z-index:1000;")}),o(T,U)};g(be,T=>{e(f)&&T(je)})}s(Ee),Ua(Ee,T=>n(p,T),()=>e(p)),o(i,Ee),Kt()}var Wl=u("<option> </option>"),Kl=u('<div class="armor-config svelte-1r5hyyb"><h4 class="svelte-1r5hyyb">Armor Configuration</h4> <div class="armor-controls svelte-1r5hyyb"><div class="armor-field svelte-1r5hyyb"><label for="armorName" class="svelte-1r5hyyb">Armor</label> <select id="armorName" class="armor-select svelte-1r5hyyb"><option>None (Unarmored)</option><!></select></div> <div class="armor-field svelte-1r5hyyb"><label class="shield-label svelte-1r5hyyb"><input type="checkbox" class="shield-checkbox svelte-1r5hyyb"/> Shield Equipped (+2 AC)</label></div></div></div>'),Vl=u('<div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="spellSaveDC" class="svelte-1r5hyyb">Spell Save DC</label> <!></div> <input type="number" id="spellSaveDC" class="stat-input svelte-1r5hyyb" readonly=""/></div>'),Jl=u('<span class="hit-dice-type"> </span>'),Yl=u('<!> <div class="stats-grid svelte-1r5hyyb"><div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="armorClass" class="svelte-1r5hyyb">Armor Class</label> <!></div> <input type="text" id="armorClass" readonly=""/></div> <div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="initiative" class="svelte-1r5hyyb">Initiative</label> <!></div> <input type="text" id="initiative" class="stat-input svelte-1r5hyyb" readonly=""/></div> <div class="stat-box svelte-1r5hyyb"><label for="speed" class="svelte-1r5hyyb">Speed</label> <input type="text" id="speed" class="stat-input svelte-1r5hyyb"/></div> <!></div> <div class="hp-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Points</h3> <div><div class="hp-inputs svelte-1r5hyyb"><input type="number" class="hp-current svelte-1r5hyyb" min="0"/> <span class="hp-separator svelte-1r5hyyb">/</span> <input type="number" class="hp-max svelte-1r5hyyb" min="0"/></div> <div class="hp-controls svelte-1r5hyyb"><button class="hp-btn svelte-1r5hyyb">‚àí</button> <button class="hp-btn svelte-1r5hyyb">+</button> <button class="hp-btn svelte-1r5hyyb">‚àí5</button> <button class="hp-btn svelte-1r5hyyb">+5</button></div></div> <div class="temp-hp svelte-1r5hyyb"><label for="tempHP" class="svelte-1r5hyyb">Temp HP</label> <input type="number" id="tempHP" min="0" class="svelte-1r5hyyb"/></div></div> <div class="hit-dice-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Dice</h3> <div class="hit-dice-display svelte-1r5hyyb"><input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <span>/</span> <input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <!></div> <div class="hit-dice-controls svelte-1r5hyyb"><label for="hitDiceCount" class="svelte-1r5hyyb">Roll</label> <div class="hit-dice-count-controls svelte-1r5hyyb"><button class="hit-dice-btn svelte-1r5hyyb">‚àí</button> <input type="number" id="hitDiceCount" class="hit-dice-count-input svelte-1r5hyyb" min="1"/> <button class="hit-dice-btn svelte-1r5hyyb">+</button></div> <button class="btn btn-primary roll-hit-dice use-enabled svelte-1r5hyyb">üé≤ Roll</button></div></div>',1),Ql=u("<section><!> <!></section>");function Xl(i,c){Wt(c,!1);const t=()=>ut(de,"$character",w),v=()=>ut(Qa,"$abilityModifiers",w),f=()=>ut(_a,"$searchFilter",w),p=()=>ut(aa,"$collapsedStates",w),m=()=>ut(xa,"$isEditMode",w),[w,y]=ca(),b=D(),W=D(),I=D(),Z=D(),ee=D(),V=D(),E=D(),j=$a();let B=D(1);function F(T){de.update(U=>(U.currentHP=Math.max(0,Math.min(U.maxHP,U.currentHP+T)),U))}function pe(T){const U=e(B)+T,$=t().hitDice.current;n(B,Math.max(1,Math.min($,U)))}function Ee(T=1){if(t().hitDice.current<=0){alert("No hit dice remaining!");return}if(!t().class){alert("Please select a class first!");return}const U=oa(t().class);if(!U){alert("Invalid class configuration!");return}const $=Math.min(T,t().hitDice.current),X=U.hitDice,h=v().constitution,P=h*$,Y=P>=0?`+${P}`:`${P}`,ce=`${$}${X}${Y}`,ve=[];if(ve.push({value:`${$}${X}`,source:"hit dice"}),h!==0)for(let he=0;he<$;he++)ve.push({value:h,source:"constitution"});j("rollHitDice",{notation:ce,hitDie:X,count:$,bonusBreakdown:ve})}Je(()=>(t(),v(),de),()=>{if(t().armorName!==void 0||t().shieldEquipped!==void 0){const T=v().dexterity,U=Pl(t().armorName,T,t().shieldEquipped||!1);t().armorClass!==U&&de.update($=>({...$,armorClass:U}))}}),Je(()=>(v(),t(),de),()=>{const T=v().dexterity;t().initiative!==T&&de.update(U=>({...U,initiative:T}))}),Je(()=>t(),()=>{n(b,ds(t(),t().abilities))}),Je(()=>t(),()=>{n(W,Il(t(),t().abilities))}),Je(()=>t(),()=>{n(I,El(t(),t().abilities))}),Je(()=>t(),()=>{n(Z,Ul(t(),t().abilities))}),Je(()=>(t(),e(B)),()=>{const T=t().hitDice.current;T>0&&e(B)>T&&n(B,T)}),Je(()=>t(),()=>{n(ee,t().activeStates&&t().activeStates.length>0?t().activeStates.reduce((T,U)=>T+(U.acBonus||0),0):0)}),Je(()=>t(),()=>{n(V,t().activeStates&&t().activeStates.length>0?t().activeStates.some(T=>T.name==="Aid"&&T.target==="self"):!1)}),Je(()=>f(),()=>{n(E,!f()||"armor class".includes(f().toLowerCase())||"initiative".includes(f().toLowerCase())||"speed".includes(f().toLowerCase())||"hit points".includes(f().toLowerCase())||"hp".includes(f().toLowerCase())||"hit dice".includes(f().toLowerCase())||"spell save".includes(f().toLowerCase())||"combat".includes(f().toLowerCase()))}),pa(),zt();var N=Ql();let Ie;var me=l(N);{let T=Ct(()=>(p(),r(()=>p().combatStats?"Expand":"Collapse")));Sa(me,{title:"Combat Stats",get collapsed(){return p(),r(()=>p().combatStats)},get ariaLabel(){return e(T)},onToggle:()=>aa.update(U=>({...U,combatStats:!U.combatStats}))})}var be=a(me,2);{var je=T=>{var U=Yl(),$=we(U);{var X=le=>{var Be=Kl(),ke=a(l(Be),2),ze=l(ke),Ne=a(l(ze),2);L(()=>{t(),qt(()=>{})});var Xe=l(Ne);Xe.value=(Xe.__value=void 0)??"";var nt=a(Xe);xt(nt,1,()=>Is,jt,(J,ie)=>{var Te=bt(),Oe=we(Te);{var Me=Ae=>{var ot=Wl(),pt=l(ot);s(ot);var Fe={};L(()=>{k(pt,`${e(ie),r(()=>e(ie).name)??""} (AC ${e(ie),r(()=>e(ie).baseAC)??""})`),Fe!==(Fe=(e(ie),r(()=>e(ie).name)))&&(ot.value=(ot.__value=(e(ie),r(()=>e(ie).name)))??"")}),o(Ae,ot)};g(Oe,Ae=>{e(ie),r(()=>e(ie).name!=="Unarmored")&&Ae(Me)})}o(J,Te)}),s(Ne),s(ze);var oe=a(ze,2),A=l(oe),z=l(A);Ce(z),ta(),s(A),s(oe),s(ke),s(Be),Ha(Ne,()=>t().armorName,J=>Nt(de,r(t).armorName=J,r(t))),La(z,()=>t().shieldEquipped,J=>Nt(de,r(t).shieldEquipped=J,r(t))),o(le,Be)};g($,le=>{m()&&le(X)})}var h=a($,2),P=l(h),Y=l(P),ce=a(l(Y),2);is(ce,{get tooltipContent(){return e(W)},ariaLabel:"Show AC breakdown"}),s(Y);var ve=a(Y,2);Ce(ve),s(P);var he=a(P,2),ge=l(he),Ge=a(l(ge),2);is(Ge,{get tooltipContent(){return e(I)},ariaLabel:"Show Initiative breakdown"}),s(ge);var Ye=a(ge,2);Ce(Ye),s(he);var ct=a(he,2),ft=a(l(ct),2);Ce(ft),s(ct);var it=a(ct,2);{var Ve=le=>{var Be=Vl(),ke=l(Be),ze=a(l(ke),2);is(ze,{get tooltipContent(){return e(Z)},ariaLabel:"Show Spell Save DC breakdown"}),s(ke);var Ne=a(ke,2);Ce(Ne),s(Be),L(()=>Ea(Ne,e(b))),o(le,Be)};g(it,le=>{e(b)!==null&&le(Ve)})}s(h);var $t=a(h,2),Dt=a(l($t),2);let S;var K=l(Dt),_=l(K);Ce(_);var G=a(_,4);Ce(G),s(K);var Q=a(K,2),re=l(Q),Le=a(re,2),Se=a(Le,2),Re=a(Se,2);s(Q),s(Dt);var se=a(Dt,2),C=a(l(se),2);Ce(C),s(se),s($t);var te=a($t,2),De=a(l(te),2),qe=l(De);Ce(qe);var Qe=a(qe,4);Ce(Qe);var mt=a(Qe,2);{var ye=le=>{const Be=Ct(()=>(O(oa),t(),r(()=>oa(t().class))));var ke=bt(),ze=we(ke);{var Ne=Xe=>{const nt=Ct(()=>(v(),r(()=>v().constitution)));var oe=Jl(),A=l(oe);s(oe),L(()=>k(A,`(${O(e(Be)),r(()=>e(Be).hitDice)??""}${(e(nt)>=0?`+${e(nt)}`:e(nt))??""})`)),o(Xe,oe)};g(ze,Xe=>{e(Be)&&Xe(Ne)})}o(le,ke)};g(mt,le=>{t(),r(()=>t().class)&&le(ye)})}s(De);var ae=a(De,2),d=a(l(ae),2),Ke=l(d),xe=a(Ke,2);Ce(xe);var q=a(xe,2);s(d);var _e=a(d,2);s(ae),s(te),L(()=>{Ea(ve,(e(ee),t(),r(()=>e(ee)!==0?`${t().armorClass} ‚Üí ${t().armorClass+e(ee)}`:`${t().armorClass}`))),Mt(ve,1,nl(e(ee)!==0?"stat-input ac-enhanced":"stat-input"),"svelte-1r5hyyb"),Ea(Ye,(t(),r(()=>t().initiative))),S=Mt(Dt,1,"hp-display svelte-1r5hyyb",null,S,{"aid-active":e(V)}),et(_,"max",(t(),r(()=>t().maxHP))),et(qe,"max",(t(),r(()=>t().hitDice.max))),Ke.disabled=e(B)<=1,et(xe,"max",(t(),r(()=>t().hitDice.current))),q.disabled=(e(B),t(),r(()=>e(B)>=t().hitDice.current)),_e.disabled=(t(),r(()=>t().hitDice.current<=0||!t().class))}),He(ft,()=>t().speed,le=>Nt(de,r(t).speed=le,r(t))),He(_,()=>t().currentHP,le=>Nt(de,r(t).currentHP=le,r(t))),He(G,()=>t().maxHP,le=>Nt(de,r(t).maxHP=le,r(t))),R("click",re,()=>F(-1)),R("click",Le,()=>F(1)),R("click",Se,()=>F(-5)),R("click",Re,()=>F(5)),He(C,()=>t().tempHP,le=>Nt(de,r(t).tempHP=le,r(t))),He(qe,()=>t().hitDice.current,le=>Nt(de,r(t).hitDice.current=le,r(t))),He(Qe,()=>t().hitDice.max,le=>Nt(de,r(t).hitDice.max=le,r(t))),R("click",Ke,()=>pe(-1)),He(xe,()=>e(B),le=>n(B,le)),R("input",xe,le=>{const Be=le.target,ke=parseInt(Be.value);ke>t().hitDice.current&&n(B,t().hitDice.current),ke<1&&n(B,1)}),R("click",q,()=>pe(1)),R("click",_e,()=>Ee(e(B))),o(T,U)};g(be,T=>{p(),r(()=>!p().combatStats)&&T(je)})}s(N),L(()=>Ie=Mt(N,1,"combat-stats svelte-1r5hyyb",null,Ie,{hidden:!e(E)})),o(i,N),Kt(),y()}const Ga={acrobatics:"dexterity",animalHandling:"wisdom",arcana:"intelligence",athletics:"strength",deception:"charisma",history:"intelligence",insight:"wisdom",intimidation:"charisma",investigation:"intelligence",medicine:"wisdom",nature:"intelligence",perception:"wisdom",performance:"charisma",persuasion:"charisma",religion:"intelligence",sleightOfHand:"dexterity",stealth:"dexterity",survival:"wisdom"};var Zl=u('<div class="skill-row svelte-1f1pl16"><input type="checkbox" class="svelte-1f1pl16"/> <label class="svelte-1f1pl16"> <span class="ability-tag svelte-1f1pl16"> </span></label> <span class="skill-modifier svelte-1f1pl16"> </span> <button class="roll-btn svelte-1f1pl16">Roll</button></div>'),ei=u('<div class="skills-grid svelte-1f1pl16"></div>'),ti=u("<section><!> <!></section>");function ai(i,c){Wt(c,!1);const t=()=>ut(de,"$character",w),v=()=>ut(Qa,"$abilityModifiers",w),f=()=>ut(_a,"$searchFilter",w),p=()=>ut(aa,"$collapsedStates",w),m=()=>ut(xa,"$isEditMode",w),[w,y]=ca(),b=D(),W=D(),I=D(),Z=D(),ee=D(),V=D(),E=$a(),j=[{key:"acrobatics",label:"Acrobatics"},{key:"animalHandling",label:"Animal Handling"},{key:"arcana",label:"Arcana"},{key:"athletics",label:"Athletics"},{key:"deception",label:"Deception"},{key:"history",label:"History"},{key:"insight",label:"Insight"},{key:"intimidation",label:"Intimidation"},{key:"investigation",label:"Investigation"},{key:"medicine",label:"Medicine"},{key:"nature",label:"Nature"},{key:"perception",label:"Perception"},{key:"performance",label:"Performance"},{key:"persuasion",label:"Persuasion"},{key:"religion",label:"Religion"},{key:"sleightOfHand",label:"Sleight of Hand"},{key:"stealth",label:"Stealth"},{key:"survival",label:"Survival"}];function B(me){const be=Ga[me],je=v()[be],T=t().skillProficiencies[me]?t().proficiencyBonus:0,U=e(b)[me],$=`1d20${U>=0?"+":""}${U}`,X=[];X.push({value:"1d20",source:"base die"}),je!==0&&X.push({value:je,source:be}),T!==0&&X.push({value:T,source:"proficiency"}),E("roll",{notation:$,rollType:"check",bonusBreakdown:X})}Je(()=>{},()=>{n(b,{})}),Je(()=>t(),()=>{n(W,t().skillProficiencies)}),Je(()=>t(),()=>{n(I,t().proficiencyBonus)}),Je(()=>v(),()=>{n(Z,v())}),Je(()=>(e(Z),e(W),e(I)),()=>{for(const{key:me}of j){const be=Ga[me],je=e(Z)[be],T=e(W)[me]?e(I):0;ba(b,e(b)[me]=je+T)}}),Je(()=>f(),()=>{n(ee,j.filter(({label:me})=>f()?me.toLowerCase().includes(f().toLowerCase()):!0))}),Je(()=>e(ee),()=>{n(V,e(ee).length>0)}),pa(),zt();var F=ti();let pe;var Ee=l(F);{let me=Ct(()=>(p(),r(()=>p().skills?"Expand":"Collapse")));Sa(Ee,{title:"Skills",get collapsed(){return p(),r(()=>p().skills)},get ariaLabel(){return e(me)},onToggle:()=>aa.update(be=>({...be,skills:!be.skills}))})}var N=a(Ee,2);{var Ie=me=>{var be=ei();xt(be,5,()=>e(ee),jt,(je,T)=>{let U=()=>e(T).key,$=()=>e(T).label;var X=Zl(),h=l(X);Ce(h);var P=a(h,2),Y=l(P),ce=a(Y),ve=l(ce);s(ce),s(P);var he=a(P,2),ge=l(he);s(he);var Ge=a(he,2);s(X),L(Ye=>{Fs(h,(e(W),U(),r(()=>e(W)[U()]))),h.disabled=!m(),et(h,"id",U()),et(P,"for",U()),k(Y,`${$()??""} `),k(ve,`(${Ye??""})`),k(ge,`${e(b),U(),r(()=>e(b)[U()]>=0?"+":"")??""}${e(b),U(),r(()=>e(b)[U()])??""}`)},[()=>(O(Ga),U(),r(()=>Ga[U()].substring(0,3).toUpperCase()))]),R("change",h,Ye=>{console.log("Skill proficiency changed:",U(),Ye.target.checked),de.update(ct=>({...ct,skillProficiencies:{...ct.skillProficiencies,[U()]:Ye.target.checked}}))}),R("click",Ge,()=>B(U())),o(je,X)}),s(be),o(me,be)};g(N,me=>{p(),r(()=>!p().skills)&&me(Ie)})}s(F),L(()=>pe=Mt(F,1,"skills svelte-1f1pl16",null,pe,{hidden:!e(V)})),o(i,F),Kt(),y()}var si=u('<p class="empty-message svelte-1123ljy">No attacks or spells to reorder.</p>'),li=u('<li class="reorder-item svelte-1123ljy"><span class="attack-name svelte-1123ljy"> </span> <div class="reorder-buttons svelte-1123ljy"><button class="btn-move svelte-1123ljy" aria-label="Move up">‚ñ≤</button> <button class="btn-move svelte-1123ljy" aria-label="Move down">‚ñº</button></div></li>'),ii=u('<ul class="reorder-list svelte-1123ljy"></ul>'),ri=u('<div class="modal-backdrop svelte-1123ljy" role="presentation"><div class="modal-content svelte-1123ljy" role="dialog" aria-modal="true" aria-labelledby="modal-title"><div class="modal-header svelte-1123ljy"><h3 id="modal-title" class="svelte-1123ljy">Reorder Attacks & Spells</h3> <button class="btn-close svelte-1123ljy" aria-label="Close">√ó</button></div> <div class="modal-body svelte-1123ljy"><!></div> <div class="modal-footer svelte-1123ljy"><button class="btn btn-secondary svelte-1123ljy">Cancel</button> <button class="btn btn-primary svelte-1123ljy">Save Order</button></div></div></div>');function ni(i,c){Wt(c,!1);let t=At(c,"show",8,!1),v=At(c,"attacks",24,()=>[]),f=At(c,"onSave",8),p=At(c,"onCancel",8),m=D([]);function w(j,B){const F=e(m)[j];ba(m,e(m)[j]=e(m)[B]),ba(m,e(m)[B]=F),n(m,[...e(m)])}function y(j){j>0&&w(j,j-1)}function b(j){j<e(m).length-1&&w(j,j+1)}function W(){f()(e(m))}function I(){p()()}function Z(j){j.target===j.currentTarget&&I()}Je(()=>(O(t()),O(v())),()=>{t()&&n(m,[...v()])}),pa(),zt();var ee=bt(),V=we(ee);{var E=j=>{var B=ri(),F=l(B),pe=l(F),Ee=a(l(pe),2);s(pe);var N=a(pe,2),Ie=l(N);{var me=$=>{var X=si();o($,X)},be=$=>{var X=ii();xt(X,7,()=>e(m),h=>h.id,(h,P,Y)=>{var ce=li(),ve=l(ce),he=l(ve,!0);s(ve);var ge=a(ve,2),Ge=l(ge),Ye=a(Ge,2);s(ge),s(ce),L(()=>{k(he,(e(P),r(()=>e(P).name||"(Unnamed attack or spell)"))),Ge.disabled=e(Y)===0,Ye.disabled=(O(e(Y)),e(m),r(()=>e(Y)===e(m).length-1))}),R("click",Ge,()=>y(e(Y))),R("click",Ye,()=>b(e(Y))),o(h,ce)}),s(X),o($,X)};g(Ie,$=>{e(m),r(()=>e(m).length===0)?$(me):$(be,!1)})}s(N);var je=a(N,2),T=l(je),U=a(T,2);s(je),s(F),s(B),R("click",Ee,I),R("click",T,I),R("click",U,W),R("click",B,Z),o(j,B)};g(V,j=>{t()&&j(E)})}o(i,ee),Kt()}let qa=null,za=null;async function Us(){if(qa)return qa;try{return qa=await(await fetch(Ps("/data/spells.json"))).json(),qa||[]}catch(i){return console.error("Failed to load spells:",i),[]}}async function oi(){if(za)return za;try{return za=await(await fetch(Ps("/data/feats.json"))).json(),za||[]}catch(i){return console.error("Failed to load feats:",i),[]}}function Ds(i,c){if(!c.trim())return i;const t=c.toLowerCase();return i.filter(v=>v.name.toLowerCase().includes(t)||v.school.toLowerCase().includes(t)||v.classes.some(f=>f.toLowerCase().includes(t))||v.description.toLowerCase().includes(t))}function ci(i,c){return c===null?i:i.filter(t=>t.level===c)}function vi(i,c){if(!c.trim())return i;const t=c.toLowerCase();return i.filter(v=>v.name.toLowerCase().includes(t)||v.description.toLowerCase().includes(t))}function Wa(i){const c=i.description,t=/\b(Strength|Dexterity|Constitution|Intelligence|Wisdom|Charisma)\s+saving\s+throw/i,v=c.match(t);if(!v)return null;const f=v[1].toLowerCase(),m=/half\s+(?:as\s+much\s+)?damage\s+on\s+a\s+successful(?:\s+save)?/i.test(c),y=/saving\s+throw\s+or\s+take.*?damage/i.test(c)&&!m;return{ability:f,halfDamageOnSave:m,noDamageOnSave:y}}function di(i){const c=i.description;return/(plus|add)\s+your\s+spellcasting\s+(ability\s+)?modifier/i.test(c)}function Da(i){const c=i.description.toLowerCase();return c.includes("ranged spell attack")||c.includes("melee spell attack")}function Ka(i){const c=i.description.toLowerCase();if(["Divine Favor","Bless","Aid","Command"].includes(i.name))return!0;const f=["takes","take","deals","deal","damage equal to","force damage","fire damage","cold damage","lightning damage","thunder damage","acid damage","poison damage","necrotic damage","radiant damage","psychic damage","regain","regains","hit point"].some(w=>c.includes(w));return["bonus to attack","bonus to damage","bonus to ac","gains a +","gain a +","+1 bonus","+2 bonus","+3 bonus","advantage on","becomes a magic weapon"].some(w=>c.includes(w))&&!f}function ui(i){const c=i.description;let t=0,v=0,f=0,p="";const m=c.match(/\+(\d+)\s+bonus\s+to\s+attack\s+rolls\s+and\s+damage\s+rolls/i);if(m){const y=parseInt(m[1]);t=y,v=y,p=`+${y} to attack and damage rolls`}if(i.name==="Bless"&&(p="Add 1d4 to attack rolls and saves",t="1d4"),i.name==="Aid")return p="+5 HP (max and current) for 8 hours",{attackBonus:0,damageBonus:0,acBonus:0,hpBonus:5,description:p,name:i.name};i.name==="Divine Favor"&&(p="Your weapon attacks deal an extra 1d4 radiant damage on a hit.",v="1d4");const w=c.match(/\+(\d+)\s+bonus\s+to\s+AC/i);return w&&(f=parseInt(w[1]),p=`+${f} to AC`),i.name==="Haste"&&(p="+2 AC, doubled speed, extra action",f=2),p||t!==0||v!==0||f!==0?{attackBonus:t,damageBonus:v,acBonus:f,description:p||i.description.substring(0,100),name:i.name}:null}function rs(i){const c=i.description,t=/takes?\s+(\d+d\d+)\s+\w+\s+damage[^.]*\.\s*If\s+the\s+target\s+is\s+missing.*?instead\s+takes?\s+(\d+d\d+)/is,v=c.match(t);return v?{baseDamage:v[1],alternateDamage:v[2]}:null}var fi=u('<button class="btn btn-secondary">Reorder</button>'),pi=u('<div class="edit-buttons svelte-14o91c5"><button class="btn btn-secondary">Add Attack</button> <!></div>'),mi=u('<input type="text" placeholder="Attack name" class="attack-name svelte-14o91c5"/>'),gi=u('<h4 class="attack-name-display svelte-14o91c5"> </h4>'),bi=u('<button class="btn-remove svelte-14o91c5">√ó</button>'),hi=u('<div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Bonus</label> <input type="number" class="attack-bonus svelte-14o91c5"/></div>'),_i=u('<div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Damage</label> <input type="text" placeholder="e.g., 2d6+3" class="attack-damage svelte-14o91c5"/></div>'),yi=u('<div class="spell-info-loading svelte-14o91c5">Loading spell info...</div>'),xi=u('<li class="svelte-14o91c5"><strong>At Higher Levels:</strong> </li>'),$i=u('<li style="color: #007bff;" class="svelte-14o91c5"><strong>Special:</strong> Mage Hand is invisible when cast via Githyanki Psionics.</li>'),wi=u('<li style="color: #007bff;" class="svelte-14o91c5"><strong>Cast via:</strong> </li>'),Si=u("<!> <!>",1),ki=u('<ul class="svelte-14o91c5"><li class="svelte-14o91c5"><strong>Level:</strong> </li> <li class="svelte-14o91c5"><strong>Casting Time:</strong> </li> <li class="svelte-14o91c5"><strong>Range:</strong> </li> <li class="svelte-14o91c5"><strong>Components:</strong> <!></li> <li class="svelte-14o91c5"><strong>Duration:</strong> <!> </li> <li class="svelte-14o91c5"><strong>Description:</strong> </li> <!> <!></ul>'),Ci=u('<span class="scaled-damage svelte-14o91c5" style="margin-left: 8px;"> </span>'),Di=u('<span class="scaled-damage svelte-14o91c5">(Half damage)</span>'),Li=u('<span class="scaled-damage svelte-14o91c5">(No damage)</span>'),ji=u('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> <!> <!></label></div>'),Ai=u('<span class="scaled-damage svelte-14o91c5"> </span>'),Ri=u('<span class="scaled-damage svelte-14o91c5"> </span>'),Bi=u('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> Target is missing HP <!></label></div>'),Ti=u("<option> </option>"),Mi=u('<span class="scaled-damage svelte-14o91c5"><!> </span>'),Fi=u('<span class="scaled-damage svelte-14o91c5"> </span>'),Pi=u('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> Target is Fiend or Undead <!></label></div>'),Ii=u('<div class="spell-level-selector svelte-14o91c5"><label class="svelte-14o91c5">Cast at Level:</label> <select class="spell-level-select use-enabled svelte-14o91c5"></select> <!></div> <!>',1),Ei=u('<div class="spell-info svelte-14o91c5"><div class="spell-info-header svelte-14o91c5" role="button" tabindex="0"><h4 class="svelte-14o91c5">Spell Info</h4> <button class="collapse-btn-small svelte-14o91c5"> </button></div> <!></div> <!> <!> <!>',1),Ui=u('<div class="spell-info-missing svelte-14o91c5">Spell info not found.</div>'),Hi=u('<div class="attack-notes svelte-14o91c5"><label class="svelte-14o91c5">Notes</label> <textarea placeholder="e.g., DC 15 Dex save, Range 120 ft, Concentration" class="notes-input svelte-14o91c5" rows="2"></textarea></div>'),Ni=u('<div style="margin-bottom: 0.5em;"><label style="font-size:0.95em;"><input type="checkbox" class="svelte-14o91c5"/> Use Racial Trait <span style="color:#007bff; font-size:0.95em; margin-left:0.5em;"> </span></label></div>'),Oi=u('<button class="btn btn-primary">Roll Attack (Spell Slot)</button>'),Gi=u('<button class="btn btn-primary" disabled>No spell slots available</button>'),qi=u('<button class="btn btn-primary">Roll Attack (Racial Trait)</button>'),zi=u('<button class="btn btn-primary" disabled>No racial uses left</button>'),Wi=u('<div class="buff-target-selection svelte-14o91c5"><div class="target-options svelte-14o91c5"><label class="target-option svelte-14o91c5"><input type="radio" class="svelte-14o91c5"/> Self</label> <label class="target-option svelte-14o91c5"><input type="radio" class="svelte-14o91c5"/> Other</label></div> <button class="btn btn-info"> </button></div>'),Ki=u('<button class="btn btn-info">Cast Spell</button>'),Vi=u("<button><!></button>"),Ji=u('<button class="btn btn-info">Cast Spell</button>'),Yi=u("<!> <!> <!> <!>",1),Qi=u('<button class="btn btn-secondary">Roll Damage</button>'),Xi=u('<button class="btn btn-primary">Roll Attack</button> <!>',1),Zi=u('<div class="attack-card svelte-14o91c5"><div class="attack-header svelte-14o91c5"><!> <!></div> <div class="attack-details svelte-14o91c5"><!> <!> <div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Type</label> <input type="text" placeholder="e.g., slashing" class="attack-type svelte-14o91c5"/></div></div> <!> <!> <div class="attack-actions svelte-14o91c5"><!> <!></div></div>'),er=u('<p class="no-attacks svelte-14o91c5">No attacks added yet. Click "Add Attack" to create one.</p>'),tr=u('<p class="no-attacks svelte-14o91c5">No attacks match your search.</p>'),ar=u('<span class="ability-uses svelte-14o91c5"> <!></span>'),sr=u('<span class="ability-reaction svelte-14o91c5">‚ö° Reaction</span>'),lr=u('<button class="btn btn-ability svelte-14o91c5">Use Ability</button>'),ir=u('<div class="ability-card svelte-14o91c5"><div class="ability-header svelte-14o91c5"><h4 class="ability-name svelte-14o91c5"> </h4> <span class="ability-source svelte-14o91c5"> </span></div> <p class="ability-description svelte-14o91c5"> </p> <div class="ability-footer svelte-14o91c5"><!> <!> <!></div></div>'),rr=u('<div class="condition-abilities-section svelte-14o91c5"><h3 class="abilities-header svelte-14o91c5">Condition Abilities</h3> <p class="section-description svelte-14o91c5">Special actions granted by active conditions (e.g., Flicker of Deceit)</p> <div class="abilities-list svelte-14o91c5"></div></div>'),nr=u('<button class="btn-remove svelte-14o91c5">√ó</button>'),or=u('<div class="state-card svelte-14o91c5"><div class="state-header svelte-14o91c5"><input type="text" placeholder="Effect name (e.g., Magic Weapon)" class="state-name svelte-14o91c5"/> <!></div> <div class="state-details svelte-14o91c5"><div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Attack Bonus</label> <input type="number" class="state-bonus svelte-14o91c5"/></div> <div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Damage Bonus</label> <input type="text" class="state-bonus svelte-14o91c5"/></div> <div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Target</label> <select class="state-bonus svelte-14o91c5"><option>Self</option><option>Other</option></select></div></div> <div class="state-description svelte-14o91c5"><label class="svelte-14o91c5">Description</label> <input type="text" placeholder="e.g., +1 to attack and damage rolls (Magic Weapon)" class="state-desc-input svelte-14o91c5"/></div></div>'),cr=u('<div class="states-list svelte-14o91c5"></div>'),vr=u('<p class="no-states svelte-14o91c5">No active effects. Add spell effects that modify your attacks.</p>'),dr=u('<!> <div class="attacks-list svelte-14o91c5"><!> <!> <!></div> <!> <div class="active-states-section svelte-14o91c5"><h3 class="svelte-14o91c5">Active Spell Effects</h3> <p class="section-description svelte-14o91c5">Effects that modify attack and damage rolls (e.g., Magic Weapon, Bless)</p> <button class="btn btn-secondary">Add Effect</button> <!></div>',1),ur=u("<section><!> <!></section> <!>",1);function fr(i,c){Wt(c,!1);const t=()=>ut(de,"$character",m),v=()=>ut(_a,"$searchFilter",m),f=()=>ut(aa,"$collapsedStates",m),p=()=>ut(xa,"$isEditMode",m),[m,w]=ca(),y=D(),b=D(),W=D(),I=[];let Z=D({});function ee(S,K){de.update(_=>{if(!_.activeStates)return _;const G=_.activeStates.findIndex(Se=>Se.name===S);if(G===-1)return _;const Q=_.activeStates[G];if(!Q.abilities)return _;const re=Q.abilities.findIndex(Se=>Se.name===K);if(re===-1)return _;const Le=Q.abilities[re];return Le.currentUses!==void 0&&Le.currentUses>0&&(Le.currentUses-=1,Le.usesPerRest!==void 0?Ot.add(`Used ${K} (${Le.currentUses}/${Le.usesPerRest} remaining)`,"info"):Ot.add(`Used ${K}`,"info")),_})}const V=$a();let E=D({}),j=D({}),B=D(!1);function F(S){ba(E,e(E)[S]=!e(E)[S]),n(E,{...e(E)})}function pe(S){return S.description.toLowerCase().includes("regain")&&(S.description.toLowerCase().includes("hit point")||S.description.toLowerCase().includes("hp"))}function Ee(S){return["Shield of Faith","Bless","Aid","Magic Weapon"].includes(S)}function N(){de.update(S=>(S.attacks=[...S.attacks,{id:crypto.randomUUID(),name:"",bonus:0,damage:"",damageType:"",notes:""}],S))}function Ie(S){de.update(K=>(K.attacks=K.attacks.filter(_=>_.id!==S),K))}function me(){n(B,!0)}function be(){n(B,!1)}function je(S){de.update(K=>(K.attacks=S,K)),n(B,!1),Ot.add("Attack order updated successfully!","success")}function T(S,K){let _=S.damage,G=!1,Q=!1;if(S.spellRef){const se=h(S.spellRef);if(se&&(Q=Da(se),se.level>0)){const C=S.castAtLevel||se.level;let te=!1;if(K||S.source==="racial"){if(te=Y(S.name),!te){Ot.add(`No uses of ${S.name} remaining!`,"error");return}}else if(te=P(C),!te){Ot.add(`No level ${C} spell slots available!`,"error");return}const qe=Wa(se);qe&&S.targetSucceededSave&&qe.noDamageOnSave?_="0":(G=qe?.halfDamageOnSave&&S.targetSucceededSave||!1,_=ce(S,se))}}else if(t().activeStates&&t().activeStates.length>0){let se=0,C=[];for(const te of t().activeStates)te.target!=="other"&&(typeof te.damageBonus=="string"?C.push(te.damageBonus):typeof te.damageBonus=="number"&&(se+=te.damageBonus));if((se!==0||C.length>0)&&_){const te=_.match(/(\d+d\d+)([+-]\d+)?/);if(te){const[,De,qe]=te,mt=(qe?parseInt(qe):0)+se;let ye=`${De}`;mt!==0&&(ye+=`${mt>=0?"+":""}${mt}`),C.length>0&&(ye+=" + "+C.join(" + ")),_=ye}}}const re=[];let Le=0;if(Q){const se=ls(t(),t().abilities),C=t().proficiencyBonus||0;re.push({value:C,source:"proficiency"}),re.push({value:se,source:"spellcasting"}),Le=C+se}else S.bonus!==0&&re.push({value:S.bonus,source:"base"}),Le=S.bonus;let Se=[];if(t().activeStates)for(const se of t().activeStates)se.target!=="other"&&(typeof se.attackBonus=="number"&&se.attackBonus!==0?(re.push({value:se.attackBonus,source:se.name.toLowerCase()}),Le+=se.attackBonus):typeof se.attackBonus=="string"&&se.attackBonus&&Se.push(se.attackBonus));let Re=`1d20${Le>=0?"+":""}${Le}`;Se.length>0&&(Re+="+"+Se.join("+")),V("roll",{notation:Re,damageNotation:_,attackName:S.name,applyHalfDamage:G,bonusBreakdown:re,rollType:"attack"})}function U(S){if(!S.damage){Ot.add(`${S.name}: No damage specified`,"error");return}let K=S.damage,_=!1;const G=[];let Q=S.damageType||"";if(S.spellRef){const re=h(S.spellRef);if(re){const Le=pe(re);if(Le){const Se=ls(t(),t().abilities),Re=K.match(/^(\d+d\d+)/);Re&&(K=Re[1],Se>0&&(K+=`+${Se}`,G.push({value:Se,source:"spellcasting"}))),Q="Healing"}if(re.level>0){const Se=S.castAtLevel||re.level;let Re=!1;if(S.source==="racial"){if(Re=Y(S.name),!Re){Ot.add(`No uses of ${S.name} remaining!`,"error");return}}else if(Re=P(Se),!Re){Ot.add(`No level ${Se} spell slots available!`,"error");return}const se=Wa(re);se&&S.targetSucceededSave&&se.noDamageOnSave?K="0":(_=se?.halfDamageOnSave&&S.targetSucceededSave||!1,Le||(K=ce(S,re)))}}}else{const re=K.match(/(\d+d\d+)([+-]\d+)?/);if(re){const[,Le,Se]=re,Re=Se?parseInt(Se):0;if(Re!==0&&G.push({value:Re,source:"base"}),t().activeStates&&t().activeStates.length>0){let se=0,C=[];for(const te of t().activeStates)te.target!=="other"&&(typeof te.damageBonus=="string"?C.push(te.damageBonus):typeof te.damageBonus=="number"&&te.damageBonus!==0&&(G.push({value:te.damageBonus,source:te.name.toLowerCase()}),se+=te.damageBonus));if(se!==0||C.length>0){const te=Re+se;let De=`${Le}`;te!==0&&(De+=`${te>=0?"+":""}${te}`),C.length>0&&(De+=" + "+C.join(" + ")),K=De}}}}V("roll",{notation:K,attackName:S.name,applyHalfDamage:_,bonusBreakdown:G,damageType:Q})}let $=D([]),X=D(!1);wa(async()=>{n($,await Us()),n(X,!0)});function h(S){return e($).find(K=>K.name===S)}function P(S){t().classFeatures.spellSlotsByLevel||Nt(de,r(t).classFeatures.spellSlotsByLevel={},r(t)),t().classFeatures.spellSlotsByLevel[S]||Nt(de,r(t).classFeatures.spellSlotsByLevel[S]=Array(2).fill(!1),r(t));const _=t().classFeatures.spellSlotsByLevel[S].findIndex(G=>!G);return _===-1?!1:(de.update(G=>(G.classFeatures.spellSlotsByLevel||(G.classFeatures.spellSlotsByLevel={}),G.classFeatures.spellSlotsByLevel[S]||(G.classFeatures.spellSlotsByLevel[S]=Array(2).fill(!1)),G.classFeatures.spellSlotsByLevel[S][_]=!0,G)),!0)}function Y(S){return!t().racialTraits||!t().racialTraits.uses[S]?!0:t().racialTraits.uses[S].currentUses<=0?!1:(ol(S),!0)}function ce(S,K){let _=S.damage,G=0,Q=0;const re=rs(K);if(re&&S.targetIsDamaged&&(_=re.alternateDamage),di(K)&&(Q+=ls(t(),t().abilities)),t().activeStates)for(const Qe of t().activeStates)Qe.target!=="other"&&typeof Qe.damageBonus=="number"&&(Q+=Qe.damageBonus);if(K.higherLevelSlot&&S.castAtLevel){const Qe=K.level,ye=(S.castAtLevel||Qe)-Qe;if(ye>0){const ae=K.higherLevelSlot.match(/(\d+)d(\d+)\s+for\s+each.*?level\s+above/i);if(ae){const[,d]=ae;G+=ye*parseInt(d)}}}if(S.targetIsFiendOrUndead&&K.description.includes("Fiend or an Undead")){const Qe=K.description.match(/increases by (\d+)d(\d+) if.*?Fiend or.*?Undead/i);if(Qe){const[,mt]=Qe;G+=parseInt(mt)}}const Le=_.match(/(\d+)d(\d+)([+-]\d+)?/);if(!Le)return Q!==0?Q>=0?`${Q}`:`${Q}`:_||"0";const[,Se,Re,se]=Le,C=parseInt(Se)+G,De=(se?parseInt(se):0)+Q;let qe=`${C}d${Re}`;return De!==0&&(qe+=De>=0?`+${De}`:`${De}`),qe}function ve(S){const K=[];for(let G=S.level;G<=9;G++){const Q=t().classFeatures.spellSlotsByLevel?.[G];Q&&Q.length>0&&K.push(G)}return K}function he(){de.update(S=>(S.activeStates||(S.activeStates=[]),S.activeStates=[...S.activeStates,{name:"",attackBonus:0,damageBonus:0,description:"",target:"self"}],S))}function ge(S){de.update(K=>{if(K.activeStates){const _=K.activeStates[S];_?.hpBonus&&_.target!=="other"&&(K.maxHP-=_.hpBonus,K.currentHP=Math.max(1,Math.min(K.currentHP-_.hpBonus,K.maxHP))),K.activeStates=K.activeStates.filter((G,Q)=>Q!==S)}return K})}function Ge(S,K="self"){const _=h(S.spellRef);if(!_){Ot.add("Spell not found","error");return}const G=S.castAtLevel||_.level;if(G>0){let C=!1;if(S.source==="racial"){if(C=Y(S.name),!C){Ot.add(`No uses of ${S.name} remaining!`,"error");return}}else if(C=P(G),!C){Ot.add(`No level ${G} spell slots available!`,"error");return}}const Q=ui(_);if(!Q){Ot.add(`${_.name} cast! Check spell description for effects.`,"info");return}let re=Q.hpBonus||0,Le=Q.description;_.name==="Aid"&&G>_.level&&(re=5+(G-_.level)*5,Le=`+${re} HP (max and current) for 8 hours`);const Re=["Shield of Faith","Bless","Aid","Magic Weapon"].includes(_.name);de.update(C=>{C.activeStates||(C.activeStates=[]);const te=C.activeStates.find(De=>De.name===_.name);return te&&te.hpBonus&&te.target!=="other"&&(C.maxHP-=te.hpBonus,C.currentHP=Math.max(1,Math.min(C.currentHP-te.hpBonus,C.maxHP))),C.activeStates=C.activeStates.filter(De=>De.name!==_.name),re>0&&K==="self"&&(C.maxHP+=re,C.currentHP+=re),C.activeStates=[...C.activeStates,{name:_.name,attackBonus:Q.attackBonus,damageBonus:Q.damageBonus,acBonus:Q.acBonus,description:Le,target:K,hpBonus:re}],C});const se=K==="self"?" on self":" on other";Ot.add(`${_.name} cast${Re?se:""}! Effect added to Active Spell Effects.`,"success")}Je(()=>t(),()=>{n(y,t().activeStates?t().activeStates.filter(S=>S.abilities&&S.abilities.length>0).flatMap(S=>S.abilities.map(K=>({...K,conditionName:S.name}))):[])}),Je(()=>(t(),e(E),e(j)),()=>{if(t()&&t().attacks)for(const S of t().attacks)S.spellRef&&e(E)[S.id]===void 0&&ba(E,e(E)[S.id]=!0),S.spellRef&&e(j)[S.id]===void 0&&ba(j,e(j)[S.id]="self")}),Je(()=>(t(),v()),()=>{n(b,t().attacks.filter(S=>{if(!v())return!0;const K=v().toLowerCase();return S.name.toLowerCase().includes(K)||S.damageType.toLowerCase().includes(K)}).sort((S,K)=>!S.spellRef&&K.spellRef?-1:S.spellRef&&!K.spellRef?1:0))}),Je(()=>(v(),e(b)),()=>{n(W,!v()||e(b).length>0||"attack".includes(v().toLowerCase())||"spell".includes(v().toLowerCase()))}),pa(),zt();var Ye=ur(),ct=we(Ye);let ft;var it=l(ct);{let S=Ct(()=>(f(),r(()=>f().attacks?"Expand":"Collapse")));Sa(it,{title:"Attacks & Spells",get collapsed(){return f(),r(()=>f().attacks)},get ariaLabel(){return e(S)},onToggle:()=>aa.update(K=>({...K,attacks:!K.attacks}))})}var Ve=a(it,2);{var $t=S=>{var K=dr(),_=we(K);{var G=ae=>{var d=pi(),Ke=l(d),xe=a(Ke,2);{var q=_e=>{var le=fi();R("click",le,me),o(_e,le)};g(xe,_e=>{t(),r(()=>t().attacks.length>0)&&_e(q)})}s(d),R("click",Ke,N),o(ae,d)};g(_,ae=>{p()&&ae(G)})}var Q=a(_,2),re=l(Q);xt(re,1,()=>e(b),ae=>ae.id,(ae,d,Ke)=>{var xe=Zi(),q=l(xe),_e=l(q);{var le=ue=>{var ne=mi();Ce(ne),He(ne,()=>e(d).name,Ze=>(e(d).name=Ze,qt(()=>(e(b),t(),v())))),o(ue,ne)},Be=ue=>{var ne=gi(),Ze=l(ne,!0);s(ne),L(()=>k(Ze,(e(d),r(()=>e(d).name||"(Unnamed Attack)")))),o(ue,ne)};g(_e,ue=>{p()?ue(le):ue(Be,!1)})}var ke=a(_e,2);{var ze=ue=>{var ne=bi();R("click",ne,()=>Ie(e(d).id)),o(ue,ne)};g(ke,ue=>{p()&&ue(ze)})}s(q);var Ne=a(q,2),Xe=l(Ne);{var nt=ue=>{var ne=hi(),Ze=l(ne),ht=a(Ze,2);Ce(ht),s(ne),L(()=>{et(Ze,"for",`attack-bonus-${e(d),r(()=>e(d).id)??""}`),et(ht,"id",`attack-bonus-${e(d),r(()=>e(d).id)??""}`)}),He(ht,()=>e(d).bonus,M=>(e(d).bonus=M,qt(()=>(e(b),t(),v())))),o(ue,ne)};g(Xe,ue=>{e(d),r(()=>e(d).bonus!==0&&e(d).bonus!==void 0)&&ue(nt)})}var oe=a(Xe,2);{var A=ue=>{var ne=_i(),Ze=l(ne),ht=a(Ze,2);Ce(ht),s(ne),L(()=>{et(Ze,"for",`attack-damage-${e(d),r(()=>e(d).id)??""}`),et(ht,"id",`attack-damage-${e(d),r(()=>e(d).id)??""}`)}),He(ht,()=>e(d).damage,M=>(e(d).damage=M,qt(()=>(e(b),t(),v())))),o(ue,ne)};g(oe,ue=>{e(d),r(()=>e(d).damage&&e(d).damage.trim()!=="")&&ue(A)})}var z=a(oe,2),J=l(z),ie=a(J,2);Ce(ie),s(z),s(Ne);var Te=a(Ne,2);{var Oe=ue=>{var ne=bt(),Ze=we(ne);{var ht=$e=>{var x=yi();o($e,x)},M=$e=>{const x=Ct(()=>(e(d),r(()=>h(e(d).spellRef))));var Ue=bt(),H=we(Ue);{var Bt=tt=>{const fe=Ct(()=>(O(Wa),O(e(x)),r(()=>Wa(e(x))))),vt=Ct(()=>(O(rs),O(e(x)),r(()=>rs(e(x)))));var at=Ei(),Ft=we(at),We=l(Ft),gt=a(l(We),2),yt=l(gt,!0);s(gt),s(We);var Ut=a(We,2);{var ia=st=>{var It=ki(),Yt=l(It),Qt=a(l(Yt));s(Yt);var na=a(Yt,2),va=a(l(na));s(na);var da=a(na,2),Vt=a(l(da));s(da);var lt=a(da,2),dt=a(l(lt)),rt=a(dt);{var Tt=kt=>{var Jt=Pt();L(()=>k(Jt,`(${O(e(x)),r(()=>e(x).material)??""})`)),o(kt,Jt)};g(rt,kt=>{O(e(x)),r(()=>e(x).material)&&kt(Tt)})}s(lt);var Et=a(lt,2),ua=a(l(Et),2);{var Ht=kt=>{var Jt=Pt("Concentration,");o(kt,Jt)};g(ua,kt=>{O(e(x)),r(()=>e(x).concentration)&&kt(Ht)})}var la=a(ua,1,!0);s(Et);var Gt=a(Et,2),fa=a(l(Gt));s(Gt);var ma=a(Gt,2);{var ka=kt=>{var Jt=xi(),ga=a(l(Jt));s(Jt),L(()=>k(ga,` ${O(e(x)),r(()=>e(x).higherLevelSlot)??""}`)),o(kt,Jt)};g(ma,kt=>{O(e(x)),r(()=>e(x).higherLevelSlot)&&kt(ka)})}var Zt=a(ma,2);{var ea=kt=>{var Jt=Si(),ga=we(Jt);{var Ba=Ca=>{var Ma=$i();o(Ca,Ma)};g(ga,Ca=>{e(d),O(e(x)),r(()=>e(d).racialTraitName==="Githyanki Psionics"&&e(x).name==="Mage Hand")&&Ca(Ba)})}var Ta=a(ga,2);{var Za=Ca=>{var Ma=wi(),Hs=a(l(Ma));s(Ma),L(()=>k(Hs,` ${e(d),r(()=>e(d).racialTraitName)??""}`)),o(Ca,Ma)};g(Ta,Ca=>{e(d),r(()=>e(d).racialTraitName)&&Ca(Za)})}o(kt,Jt)};g(Zt,kt=>{e(d),r(()=>e(d).source==="racial")&&kt(ea)})}s(It),L(kt=>{k(Qt,` ${O(e(x)),r(()=>e(x).level)??""}`),k(va,` ${O(e(x)),r(()=>e(x).castingTime||e(x).actionType)??""}`),k(Vt,` ${O(e(x)),r(()=>e(x).range)??""}`),k(dt,` ${kt??""}`),k(la,(O(e(x)),r(()=>e(x).duration))),k(fa,` ${O(e(x)),r(()=>e(x).description)??""}`)},[()=>(O(e(x)),r(()=>e(x).components.join(", ")))]),o(st,It)};g(Ut,st=>{e(E),e(d),r(()=>!e(E)[e(d).id])&&st(ia)})}s(Ft);var St=a(Ft,2);{var Rt=st=>{var It=ji(),Yt=l(It),Qt=l(Yt);Ce(Qt);var na=a(Qt),va=a(na);{var da=rt=>{var Tt=Ci(),Et=l(Tt);s(Tt),L(ua=>k(Et,`(Spell Save DC: ${ua??""})`),[()=>(O(ds),t(),r(()=>ds(t(),t().abilities)))]),o(rt,Tt)};g(va,rt=>{t(),r(()=>t().class)&&rt(da)})}var Vt=a(va,2);{var lt=rt=>{var Tt=Di();o(rt,Tt)},dt=rt=>{var Tt=bt(),Et=we(Tt);{var ua=Ht=>{var la=Li();o(Ht,la)};g(Et,Ht=>{e(d),O(e(fe)),r(()=>e(d).targetSucceededSave&&e(fe).noDamageOnSave)&&Ht(ua)},!0)}o(rt,Tt)};g(Vt,rt=>{e(d),O(e(fe)),r(()=>e(d).targetSucceededSave&&e(fe).halfDamageOnSave)?rt(lt):rt(dt,!1)})}s(Yt),s(It),L(rt=>k(na,` Target succeeded on ${rt??""} save `),[()=>(O(e(fe)),r(()=>e(fe).ability.charAt(0).toUpperCase()+e(fe).ability.slice(1)))]),La(Qt,()=>e(d).targetSucceededSave,rt=>(e(d).targetSucceededSave=rt,qt(()=>(e(b),t(),v())))),o(st,It)};g(St,st=>{e(fe)&&st(Rt)})}var sa=a(St,2);{var ra=st=>{var It=Bi(),Yt=l(It),Qt=l(Yt);Ce(Qt);var na=a(Qt,2);{var va=Vt=>{const lt=Ct(()=>(e(d),O(e(x)),r(()=>ce(e(d),e(x)))));var dt=Ai(),rt=l(dt);s(dt),L(()=>k(rt,`(${O(e(vt)),r(()=>e(vt).alternateDamage)??""}, total: ${e(lt)??""})`)),o(Vt,dt)},da=Vt=>{var lt=Ri(),dt=l(lt);s(lt),L(()=>k(dt,`(${O(e(vt)),r(()=>e(vt).baseDamage)??""})`)),o(Vt,lt)};g(na,Vt=>{e(d),r(()=>e(d).targetIsDamaged)?Vt(va):Vt(da,!1)})}s(Yt),s(It),La(Qt,()=>e(d).targetIsDamaged,Vt=>(e(d).targetIsDamaged=Vt,qt(()=>(e(b),t(),v())))),o(st,It)};g(sa,st=>{e(vt)&&st(ra)})}var Xt=a(sa,2);{var Lt=st=>{const It=Ct(()=>(O(e(x)),r(()=>ve(e(x)))));var Yt=bt(),Qt=we(Yt);{var na=va=>{var da=Ii(),Vt=we(da),lt=l(Vt),dt=a(lt,2);L(()=>{e(d),qt(()=>{e(It)})}),xt(dt,5,()=>e(It),jt,(Ht,la)=>{var Gt=Ti(),fa=l(Gt);s(Gt);var ma={};L(()=>{k(fa,`Level ${e(la)??""}`),ma!==(ma=e(la))&&(Gt.value=(Gt.__value=e(la))??"")}),o(Ht,Gt)}),s(dt);var rt=a(dt,2);{var Tt=Ht=>{const la=Ct(()=>(e(d),O(e(x)),r(()=>ce(e(d),e(x)))));var Gt=Mi(),fa=l(Gt);{var ma=ea=>{var kt=Pt("Healing");o(ea,kt)},ka=ea=>{var kt=Pt("Damage");o(ea,kt)};g(fa,ea=>{O(e(x)),r(()=>pe(e(x)))?ea(ma):ea(ka,!1)})}var Zt=a(fa);s(Gt),L(()=>k(Zt,` ${e(la)??""}`)),o(Ht,Gt)};g(rt,Ht=>{e(d),O(e(x)),r(()=>e(d).castAtLevel&&e(d).castAtLevel>e(x).level)&&Ht(Tt)})}s(Vt);var Et=a(Vt,2);{var ua=Ht=>{var la=Pi(),Gt=l(la),fa=l(Gt);Ce(fa);var ma=a(fa,2);{var ka=Zt=>{const ea=Ct(()=>(e(d),O(e(x)),r(()=>ce(e(d),e(x)))));var kt=Fi(),Jt=l(kt);s(kt),L(()=>k(Jt,`(+1d8, total: ${e(ea)??""})`)),o(Zt,kt)};g(ma,Zt=>{e(d),r(()=>e(d).targetIsFiendOrUndead)&&Zt(ka)})}s(Gt),s(la),La(fa,()=>e(d).targetIsFiendOrUndead,Zt=>(e(d).targetIsFiendOrUndead=Zt,qt(()=>(e(b),t(),v())))),o(Ht,la)};g(Et,Ht=>{O(e(x)),r(()=>e(x).description.includes("Fiend or an Undead"))&&Ht(ua)})}L(()=>{et(lt,"for",`castLevel-${e(d),r(()=>e(d).id)??""}`),et(dt,"id",`castLevel-${e(d),r(()=>e(d).id)??""}`)}),Ha(dt,()=>e(d).castAtLevel,Ht=>(e(d).castAtLevel=Ht,qt(()=>(e(b),t(),v())))),o(va,da)};g(Qt,va=>{O(e(It)),e(Z),e(d),r(()=>e(It).length>0&&!e(Z)[e(d).id])&&va(na)})}o(st,Yt)};g(Xt,st=>{O(e(x)),r(()=>e(x).higherLevelSlot&&e(x).level>0)&&st(Lt)})}L(()=>{et(gt,"aria-label",(e(E),e(d),r(()=>e(E)[e(d).id]?"Expand":"Collapse"))),k(yt,(e(E),e(d),r(()=>e(E)[e(d).id]?"‚ñº":"‚ñ≤")))}),R("click",We,()=>F(e(d).id)),R("keydown",We,st=>st.key==="Enter"&&F(e(d).id)),o(tt,at)},_t=tt=>{var fe=Ui();o(tt,fe)};g(H,tt=>{e(x)?tt(Bt):tt(_t,!1)})}o($e,Ue)};g(Ze,$e=>{e($),r(()=>e($).length===0)?$e(ht):$e(M,!1)})}o(ue,ne)};g(Te,ue=>{e(d),r(()=>e(d).spellRef)&&ue(Oe)})}var Me=a(Te,2);{var Ae=ue=>{var ne=bt(),Ze=we(ne);{var ht=M=>{var $e=Hi(),x=l($e),Ue=a(x,2);ja(Ue),s($e),L(()=>{et(x,"for",`attack-notes-${e(d),r(()=>e(d).id)??""}`),et(Ue,"id",`attack-notes-${e(d),r(()=>e(d).id)??""}`)}),He(Ue,()=>e(d).notes,H=>(e(d).notes=H,qt(()=>(e(b),t(),v())))),o(M,$e)};g(Ze,M=>{e(d),r(()=>e(d).notes&&e(d).notes.trim()!=="")&&M(ht)})}o(ue,ne)};g(Me,ue=>{e(d),r(()=>!e(d).spellRef)&&ue(Ae)})}var ot=a(Me,2),pt=l(ot);{var Fe=ue=>{const ne=Ct(()=>(e(d),r(()=>h(e(d).spellRef))));var Ze=bt(),ht=we(Ze);{var M=$e=>{const x=Ct(()=>(t(),e(d),r(()=>t().racialTraits&&t().racialTraits.uses[e(d).name])));var Ue=Yi(),H=we(Ue);{var Bt=We=>{var gt=Ni(),yt=l(gt),Ut=l(yt);Ce(Ut);var ia=a(Ut,2),St=l(ia);s(ia),s(yt),s(gt),L(()=>k(St,`(${O(e(x)),r(()=>e(x).currentUses)??""}/${O(e(x)),r(()=>e(x).maxUses)??""} uses left)`)),La(Ut,()=>e(Z)[e(d).id],Rt=>ba(Z,e(Z)[e(d).id]=Rt)),R("change",Ut,()=>{n(Z,{...e(Z)})}),o(We,gt)};g(H,We=>{e(d),O(e(x)),r(()=>e(d).source==="racial"&&e(x))&&We(Bt)})}var _t=a(H,2);{var tt=We=>{var gt=bt(),yt=we(gt);{var Ut=St=>{var Rt=bt(),sa=we(Rt);{var ra=Lt=>{var st=Oi();R("click",st,()=>T(e(d),!1)),o(Lt,st)},Xt=Lt=>{var st=Gi();o(Lt,st)};g(sa,Lt=>{t(),O(e(ne)),r(()=>t().classFeatures&&t().classFeatures.spellSlotsByLevel&&t().classFeatures.spellSlotsByLevel[e(ne).level]?.some(st=>!st))?Lt(ra):Lt(Xt,!1)})}o(St,Rt)},ia=St=>{var Rt=bt(),sa=we(Rt);{var ra=Lt=>{var st=qi();R("click",st,()=>T(e(d),!0)),o(Lt,st)},Xt=Lt=>{var st=zi();o(Lt,st)};g(sa,Lt=>{O(e(x)),r(()=>e(x)&&e(x).currentUses>0)?Lt(ra):Lt(Xt,!1)})}o(St,Rt)};g(yt,St=>{e(Z),e(d),r(()=>!e(Z)[e(d).id])?St(Ut):St(ia,!1)})}o(We,gt)};g(_t,We=>{O(Da),O(e(ne)),r(()=>Da(e(ne)))&&We(tt)})}var fe=a(_t,2);{var vt=We=>{var gt=bt(),yt=we(gt);{var Ut=St=>{var Rt=Wi(),sa=l(Rt),ra=l(sa),Xt=l(ra);Ce(Xt),Xt.value=Xt.__value="self",ta(),s(ra);var Lt=a(ra,2),st=l(Lt);Ce(st),st.value=st.__value="other",ta(),s(Lt),s(sa);var It=a(sa,2),Yt=l(It);s(It),s(Rt),L(()=>{et(Xt,"name",`target-${e(d),r(()=>e(d).id)??""}`),et(st,"name",`target-${e(d),r(()=>e(d).id)??""}`),k(Yt,`Cast ${O(e(ne)),r(()=>e(ne).name)??""}`)}),$s(I,[Ke],Xt,()=>e(j)[e(d).id],Qt=>ba(j,e(j)[e(d).id]=Qt)),$s(I,[Ke],st,()=>e(j)[e(d).id],Qt=>ba(j,e(j)[e(d).id]=Qt)),R("click",It,()=>Ge(e(d),e(j)[e(d).id])),o(St,Rt)},ia=St=>{var Rt=Ki();R("click",Rt,()=>Ge(e(d),"self")),o(St,Rt)};g(yt,St=>{O(e(ne)),r(()=>Ee(e(ne).name))?St(Ut):St(ia,!1)})}o(We,gt)};g(fe,We=>{O(Da),O(e(ne)),O(Ka),r(()=>!Da(e(ne))&&Ka(e(ne)))&&We(vt)})}var at=a(fe,2);{var Ft=We=>{var gt=bt(),yt=we(gt);{var Ut=St=>{var Rt=Vi(),sa=l(Rt);{var ra=Lt=>{var st=Pt("Roll Healing");o(Lt,st)},Xt=Lt=>{var st=Pt("Roll Damage");o(Lt,st)};g(sa,Lt=>{O(e(ne)),r(()=>pe(e(ne)))?Lt(ra):Lt(Xt,!1)})}s(Rt),L(Lt=>Mt(Rt,1,`btn ${Lt??""}`),[()=>(O(e(ne)),r(()=>pe(e(ne))?"btn-success":"btn-secondary"))]),R("click",Rt,()=>U(e(d))),o(St,Rt)},ia=St=>{var Rt=Ji();R("click",Rt,()=>Ge(e(d),"self")),o(St,Rt)};g(yt,St=>{e(d),r(()=>e(d).damage&&e(d).damage.trim()!=="")?St(Ut):St(ia,!1)})}o(We,gt)};g(at,We=>{O(Da),O(e(ne)),O(Ka),r(()=>!Da(e(ne))&&!Ka(e(ne)))&&We(Ft)})}o($e,Ue)};g(ht,$e=>{e(ne)&&$e(M)})}o(ue,Ze)};g(pt,ue=>{e(d),e(X),r(()=>e(d).spellRef&&e(X))&&ue(Fe)})}var Pe=a(pt,2);{var wt=ue=>{var ne=Xi(),Ze=we(ne),ht=a(Ze,2);{var M=$e=>{var x=Qi();R("click",x,()=>U(e(d))),o($e,x)};g(ht,$e=>{e(d),r(()=>e(d).damage&&e(d).damage.trim()!=="")&&$e(M)})}R("click",Ze,()=>T(e(d))),o(ue,ne)};g(Pe,ue=>{e(d),r(()=>!e(d).spellRef)&&ue(wt)})}s(ot),s(xe),L(()=>{et(J,"for",`attack-type-${e(d),r(()=>e(d).id)??""}`),et(ie,"id",`attack-type-${e(d),r(()=>e(d).id)??""}`)}),He(ie,()=>e(d).damageType,ue=>(e(d).damageType=ue,qt(()=>(e(b),t(),v())))),o(ae,xe)});var Le=a(re,2);{var Se=ae=>{var d=er();o(ae,d)};g(Le,ae=>{t(),r(()=>t().attacks.length===0)&&ae(Se)})}var Re=a(Le,2);{var se=ae=>{var d=tr();o(ae,d)};g(Re,ae=>{e(b),t(),r(()=>e(b).length===0&&t().attacks.length>0)&&ae(se)})}s(Q);var C=a(Q,2);{var te=ae=>{var d=rr(),Ke=a(l(d),4);xt(Ke,5,()=>e(y),jt,(xe,q)=>{var _e=ir(),le=l(_e),Be=l(le),ke=l(Be,!0);s(Be);var ze=a(Be,2),Ne=l(ze);s(ze),s(le);var Xe=a(le,2),nt=l(Xe,!0);s(Xe);var oe=a(Xe,2),A=l(oe);{var z=Me=>{var Ae=ar(),ot=l(Ae),pt=a(ot);{var Fe=Pe=>{var wt=Pt();L(()=>k(wt,`per ${e(q),r(()=>e(q).restType)??""} rest`)),o(Pe,wt)};g(pt,Pe=>{e(q),r(()=>e(q).restType)&&Pe(Fe)})}s(Ae),L(()=>k(ot,`${e(q),r(()=>e(q).currentUses??e(q).usesPerRest)??""}/${e(q),r(()=>e(q).usesPerRest)??""} uses `)),o(Me,Ae)};g(A,Me=>{e(q),r(()=>e(q).usesPerRest)&&Me(z)})}var J=a(A,2);{var ie=Me=>{var Ae=sr();o(Me,Ae)};g(J,Me=>{e(q),r(()=>e(q).requiresReaction)&&Me(ie)})}var Te=a(J,2);{var Oe=Me=>{var Ae=lr();L(()=>Ae.disabled=(e(q),r(()=>e(q).currentUses===void 0||e(q).currentUses===0))),R("click",Ae,()=>ee(e(q).conditionName,e(q).name)),o(Me,Ae)};g(Te,Me=>{p(),e(q),r(()=>!p()&&e(q).usesPerRest)&&Me(Oe)})}s(oe),s(_e),L(()=>{k(ke,(e(q),r(()=>e(q).name))),k(Ne,`(${e(q),r(()=>e(q).conditionName)??""})`),k(nt,(e(q),r(()=>e(q).description)))}),o(xe,_e)}),s(Ke),s(d),o(ae,d)};g(C,ae=>{e(y),r(()=>e(y).length>0)&&ae(te)})}var De=a(C,2),qe=a(l(De),4),Qe=a(qe,2);{var mt=ae=>{var d=cr();xt(d,5,()=>(t(),r(()=>t().activeStates)),jt,(Ke,xe,q)=>{var _e=or(),le=l(_e),Be=l(le);Ce(Be);var ke=a(Be,2);{var ze=Pe=>{var wt=nr();R("click",wt,()=>ge(q)),o(Pe,wt)};g(ke,Pe=>{p()&&Pe(ze)})}s(le);var Ne=a(le,2),Xe=l(Ne),nt=l(Xe);et(nt,"for",`state-attack-bonus-${q}`);var oe=a(nt,2);Ce(oe),et(oe,"id",`state-attack-bonus-${q}`),s(Xe);var A=a(Xe,2),z=l(A);et(z,"for",`state-damage-bonus-${q}`);var J=a(z,2);Ce(J),et(J,"id",`state-damage-bonus-${q}`),s(A);var ie=a(A,2),Te=l(ie);et(Te,"for",`state-target-${q}`);var Oe=a(Te,2);L(()=>{e(xe),qt(()=>{})}),et(Oe,"id",`state-target-${q}`);var Me=l(Oe);Me.value=Me.__value="self";var Ae=a(Me);Ae.value=Ae.__value="other",s(Oe),s(ie),s(Ne);var ot=a(Ne,2),pt=l(ot);et(pt,"for",`state-desc-${q}`);var Fe=a(pt,2);Ce(Fe),et(Fe,"id",`state-desc-${q}`),s(ot),s(_e),He(Be,()=>e(xe).name,Pe=>(e(xe).name=Pe,qt(()=>t()),Fa(m,"$character"))),He(oe,()=>e(xe).attackBonus,Pe=>(e(xe).attackBonus=Pe,qt(()=>t()),Fa(m,"$character"))),He(J,()=>e(xe).damageBonus,Pe=>(e(xe).damageBonus=Pe,qt(()=>t()),Fa(m,"$character"))),Ha(Oe,()=>e(xe).target,Pe=>(e(xe).target=Pe,qt(()=>t()),Fa(m,"$character"))),He(Fe,()=>e(xe).description,Pe=>(e(xe).description=Pe,qt(()=>t()),Fa(m,"$character"))),o(Ke,_e)}),s(d),o(ae,d)},ye=ae=>{var d=vr();o(ae,d)};g(Qe,ae=>{t(),r(()=>t().activeStates&&t().activeStates.length>0)?ae(mt):ae(ye,!1)})}s(De),R("click",qe,he),o(S,K)};g(Ve,S=>{f(),r(()=>!f().attacks)&&S($t)})}s(ct);var Dt=a(ct,2);ni(Dt,{get show(){return e(B)},get attacks(){return t(),r(()=>t().attacks)},onSave:je,onCancel:be}),L(()=>ft=Mt(ct,1,"attacks svelte-14o91c5",null,ft,{hidden:!e(W)})),o(i,Ye),Kt(),w()}var pr=u('<span class="slot-checkbox-x svelte-serp1j">&#8212;</span>'),mr=u('<label><input type="checkbox" class="slot-checkbox-input svelte-serp1j"/> <span><!></span></label>');function Ls(i,c){Wt(c,!1);const t=()=>ut(xa,"$isEditMode",v),[v,f]=ca();let p=At(c,"checked",8,!1),m=At(c,"disabled",8,!1),w=At(c,"className",8,""),y=At(c,"index",8,void 0),b=At(c,"ariaLabel",8,void 0);const W=$a();function I(B){W("change",{checked:B.currentTarget.checked,index:y()})}zt();var Z=mr(),ee=l(Z);Ce(ee);var V=a(ee,2),E=l(V);{var j=B=>{var F=pr();o(B,F)};g(E,B=>{p()&&B(j)})}s(V),s(Z),L(()=>{Mt(Z,1,"slot-checkbox-label "+w()+(t()?"":" not-editable"),"svelte-serp1j"),Fs(ee,p()),ee.disabled=m()||!t(),et(ee,"aria-label",b()),et(ee,"tabindex",t()?0:-1),Mt(V,1,`slot-checkbox-custom ${p()?"used":""} ${t()?"":"readonly"}`,"svelte-serp1j")}),R("change",ee,I),o(i,Z),Kt(),f()}var gr=u('<span style="color:#007bff; margin-left:0.5em;"> </span>'),br=u("<li><strong> </strong> <!></li>"),hr=u('<div class="racial-traits"><h4>Racial Traits</h4> <ul></ul></div>'),_r=u("<li> </li>"),yr=u('<div class="racial-resistances"><h4>Racial Resistances</h4> <ul></ul></div>'),xr=u("<!> <!>",1);function $r(i,c){Wt(c,!1);const t=()=>ut(de,"$character",v),[v,f]=ca(),p=D(),m=D();let w=D(),y=D();wa(()=>{t().race&&t().level&&(hs(),es(),n(w,t().race),n(y,t().level))}),Je(()=>(t(),e(w),e(y),es),()=>{t().race&&t().level&&(t().race!==e(w)||t().level!==e(y))&&(hs(),es(),n(w,t().race),n(y,t().level))}),Je(()=>(t(),Va),()=>{n(p,(()=>{const V=t().activeStates?t().activeStates.filter(B=>B.name&&B.name.toLowerCase().includes("racial")).flatMap(B=>B.resistances||[]):[],E=Va(t().race||""),j=E?E.traits.flatMap(B=>B.resistances||[]):[];return Array.from(new Set([...V,...j]))})())}),Je(()=>t(),()=>{n(m,(()=>{const V=Va(t().race||"");return V?V.traits:[]})())}),pa(),zt();var b=xr(),W=we(b);{var I=V=>{var E=hr(),j=a(l(E),2);xt(j,5,()=>e(m),jt,(B,F)=>{var pe=br(),Ee=l(pe),N=l(Ee);s(Ee);var Ie=a(Ee),me=a(Ie);{var be=je=>{var T=gr(),U=l(T);s(T),L($=>k(U,`(Resistances: ${$??""})`),[()=>(e(F),r(()=>e(F).resistances.map($=>$.charAt(0).toUpperCase()+$.slice(1)).join(", ")))]),o(je,T)};g(me,je=>{e(F),r(()=>e(F).resistances&&e(F).resistances.length>0)&&je(be)})}s(pe),L(()=>{k(N,`${e(F),r(()=>e(F).name)??""}:`),k(Ie,` ${e(F),r(()=>e(F).description)??""} `)}),o(B,pe)}),s(j),s(E),o(V,E)};g(W,V=>{e(m),r(()=>e(m).length>0)&&V(I)})}var Z=a(W,2);{var ee=V=>{var E=yr(),j=a(l(E),2);xt(j,5,()=>e(p),jt,(B,F)=>{var pe=_r(),Ee=l(pe,!0);s(pe),L(N=>k(Ee,N),[()=>(e(F),r(()=>e(F).charAt(0).toUpperCase()+e(F).slice(1)))]),o(B,pe)}),s(j),s(E),o(V,E)};g(Z,V=>{e(p),r(()=>e(p).length>0)&&V(ee)})}o(i,b),Kt(),f()}var wr=u('<p class="no-features svelte-1kpvv0n">Select a class to see available features</p>'),Sr=u('<p class="no-features svelte-1kpvv0n">No class features available at this level</p>'),kr=u('<div class="spell-slots svelte-1kpvv0n"><label class="svelte-1kpvv0n"> </label> <div class="slots-tracker svelte-1kpvv0n"></div></div>'),Cr=u('<div class="all-spell-slots"></div>'),Dr=u('<div class="feature-box spellcasting svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"> </h3> <div class="spell-stats svelte-1kpvv0n"><div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Spell Save DC</label> <div class="spell-value svelte-1kpvv0n"> </div></div> <div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <div class="spell-value svelte-1kpvv0n"> </div></div></div> <!> <div class="prepared-spells svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <textarea placeholder="List your prepared spells..." class="svelte-1kpvv0n"></textarea></div></div>'),Lr=u('<p class="unlimited svelte-1kpvv0n">Unlimited Uses</p>'),jr=u('<div class="slots-tracker svelte-1kpvv0n"></div> <div class="uses-actions-row"><button class="btn btn-primary use-enabled"> </button></div> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div>',1),Ar=u('<div class="uses-tracker svelte-1kpvv0n"><!></div>'),Rr=u('<div class="pool-tracker svelte-1kpvv0n"><input type="number" min="0" class="pool-input svelte-1kpvv0n"/> <span> </span> <button class="btn-small svelte-1kpvv0n"> </button></div>'),Br=u('<p class="no-uses svelte-1kpvv0n">No Channel Divinity uses remaining</p>'),Tr=u('<div class="channel-divinity-option svelte-1kpvv0n"><button class="btn btn-primary use-enabled svelte-1kpvv0n">Use Channel Divinity</button> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div> <!></div>'),Mr=u('<div class="feature-box svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"><!> </h3> <p class="feature-description svelte-1kpvv0n"> </p> <!></div>'),Fr=u('<div class="features-grid svelte-1kpvv0n"><!> <!></div>'),Pr=u("<!> <!>",1),Ir=u("<section><!> <!></section>");function Er(i,c){Wt(c,!1);const t=()=>ut(de,"$character",m),v=()=>ut(Qa,"$abilityModifiers",m),f=()=>ut(_a,"$searchFilter",m),p=()=>ut(aa,"$collapsedStates",m),[m,w]=ca(),y=D(),b=D(),W=D(),I=D(),Z=D(),ee=D(),V=D();let E=D(0),j=D(0);function B(h,P){de.update(Y=>(Y.classFeatures.features[h]=P,Y))}function F(){de.update(h=>(h.classFeatures.spellSlotsByLevel||(h.classFeatures.spellSlotsByLevel={}),e(I).forEach(({level:P,slots:Y})=>{h.classFeatures.spellSlotsByLevel[P]||(h.classFeatures.spellSlotsByLevel[P]=Array(Y).fill(!1))}),h))}function pe(h){if(typeof h.maxUses=="function"){if((h.name==="Divine Sense"||h.name==="War Priest")&&e(y)?.spellcastingAbility){const P=v()[e(y).spellcastingAbility];return h.maxUses(t().level,P)}return h.maxUses(t().level)}return h.maxUses||0}function Ee(h,P){de.update(Y=>((!Y.classFeatures.features[h]||!Array.isArray(Y.classFeatures.features[h])||Y.classFeatures.features[h].length!==P)&&(Y.classFeatures.features[h]=Array(P).fill(!1)),Y))}Gs(()=>{e(ee)&&t()&&t().classFeatures&&t().classFeatures.features&&e(ee).forEach(h=>{if(h.type==="uses"){const P=h.name.replace(/\s+/g,""),Y=pe(h),ce=t().classFeatures.features[P];(!Array.isArray(ce)||ce.length!==Y)&&Ee(P,Y)}})});function N(h){return typeof h.maxPool=="function"?h.maxPool(t().level):h.maxPool||0}function Ie(h){return typeof h.description=="function"?h.description(t().level):h.description}function me(){const h="ChannelDivinity";de.update(P=>{const Y=P.classFeatures.features[h];return typeof Y=="number"&&Y>0&&(P.classFeatures.features[h]=Y-1),P})}function be(){aa.update(h=>({...h,classFeatures:!h.classFeatures}))}Je(()=>(t(),oa),()=>{n(y,t().class?oa(t().class):null)}),Je(()=>(t(),Ra),()=>{n(b,t().class?Ra(t().class,t().level,t().subclass):[])}),Je(()=>(t(),ks),()=>{n(W,t().class?ks(t().class,t().level):0)}),Je(()=>(e(y),t()),()=>{n(I,(()=>{if(!e(y)?.spellcaster)return[];const h=t().level,P=[];return h>=1&&P.push({level:1,slots:Math.min(4,2+Math.floor(h/3))}),h>=3&&P.push({level:2,slots:Math.min(3,2+Math.floor((h-3)/4))}),h>=5&&P.push({level:3,slots:Math.min(3,2+Math.floor((h-5)/5))}),h>=7&&P.push({level:4,slots:Math.min(3,1+Math.floor((h-7)/6))}),h>=9&&P.push({level:5,slots:Math.min(2,1+Math.floor((h-9)/8))}),h>=11&&P.push({level:6,slots:1}),h>=13&&P.push({level:7,slots:1}),h>=15&&P.push({level:8,slots:1}),h>=17&&P.push({level:9,slots:1}),P})())}),Je(()=>(e(y),v(),t(),Cs),()=>{if(e(y)?.spellcaster&&e(y).spellcastingAbility){const h=v()[e(y).spellcastingAbility];n(E,wl(t().class,h,t().proficiencyBonus)||0),n(j,Cs(t().class,t().level,h))}}),Je(()=>(t(),e(y),e(I)),()=>{t().class&&e(y)?.spellcaster&&e(I).length>0&&F()}),Je(()=>t(),()=>{n(Z,(()=>{const P=t().classFeatures.features["ChannelDivinity"];return typeof P=="number"?P:0})())}),Je(()=>(e(b),f()),()=>{n(ee,e(b).filter(h=>{if(!f())return!0;const P=f().toLowerCase();return h.name.toLowerCase().includes(P)||Ie(h).toLowerCase().includes(P)}))}),Je(()=>(f(),t(),e(ee)),()=>{n(V,!f()||t().class||"class features".includes(f().toLowerCase())||"spellcasting".includes(f().toLowerCase())||e(ee).length>0)}),pa(),zt();var je=Ir();let T;var U=l(je);{let h=Ct(()=>(p(),r(()=>p().classFeatures?"Expand":"Collapse")));Sa(U,{title:"Class Features",get collapsed(){return p(),r(()=>p().classFeatures)},get ariaLabel(){return e(h)},onToggle:be})}var $=a(U,2);{var X=h=>{var P=Pr(),Y=we(P);$r(Y,{});var ce=a(Y,2);{var ve=ge=>{var Ge=wr();o(ge,Ge)},he=ge=>{var Ge=bt(),Ye=we(Ge);{var ct=it=>{var Ve=Sr();o(it,Ve)},ft=it=>{var Ve=Fr(),$t=l(Ve);{var Dt=K=>{var _=Dr(),G=l(_),Q=l(G);s(G);var re=a(G,2),Le=l(re),Se=a(l(Le),2),Re=l(Se,!0);s(Se),s(Le);var se=a(Le,2),C=a(l(se),2),te=l(C,!0);s(C),s(se),s(re);var De=a(re,2);{var qe=ye=>{var ae=Cr();xt(ae,5,()=>e(I),jt,(d,Ke)=>{let xe=()=>e(Ke).level,q=()=>e(Ke).slots;const _e=Ct(()=>(t(),xe(),q(),r(()=>t().classFeatures.spellSlotsByLevel?.[xe()]||Array(q()).fill(!1))));var le=kr(),Be=l(le),ke=l(Be);s(Be);var ze=a(Be,2);xt(ze,5,()=>e(_e),jt,(Ne,Xe,nt)=>{{let oe=Ct(()=>(O(e(_e)),r(()=>e(_e)[nt]||!1)));Ls(Ne,{get checked(){return e(oe)},$$events:{change:A=>{de.update(z=>(z.classFeatures.spellSlotsByLevel||(z.classFeatures.spellSlotsByLevel={}),z.classFeatures.spellSlotsByLevel[xe()]||(z.classFeatures.spellSlotsByLevel[xe()]=Array(q()).fill(!1)),z.classFeatures.spellSlotsByLevel[xe()][nt]=A.detail.checked,z))}}})}}),s(ze),s(le),L(()=>k(ke,`${xe()===1?"1st":xe()===2?"2nd":xe()===3?"3rd":`${xe()}th`} Level Spell Slots`)),o(d,le)}),s(ae),o(ye,ae)};g(De,ye=>{e(I),r(()=>e(I).length>0)&&ye(qe)})}var Qe=a(De,2),mt=a(l(Qe),2);ja(mt),s(Qe),s(_),L(ye=>{k(Q,`Spellcasting (${ye??""})`),k(Re,e(E)),k(te,e(j))},[()=>(e(y),r(()=>e(y).spellcastingAbility?.toUpperCase()))]),He(mt,()=>t().classFeatures.preparedSpells,ye=>Nt(de,r(t).classFeatures.preparedSpells=ye,r(t))),o(K,_)};g($t,K=>{e(y),r(()=>e(y)?.spellcaster)&&K(Dt)})}var S=a($t,2);xt(S,1,()=>e(ee),jt,(K,_)=>{const G=Ct(()=>(e(_),r(()=>e(_).name.replace(/\s+/g,"")))),Q=Ct(()=>(t(),O(e(G)),r(()=>t().classFeatures.features[e(G)]))),re=Ct(()=>typeof e(Q)=="number");var Le=Mr(),Se=l(Le),Re=l(Se);{var se=ye=>{var ae=Pt("Channel Divinity:");o(ye,ae)};g(Re,ye=>{e(_),r(()=>e(_).type==="channelDivinity")&&ye(se)})}var C=a(Re);s(Se);var te=a(Se,2),De=l(te,!0);s(te);var qe=a(te,2);{var Qe=ye=>{const ae=Ct(()=>(e(_),r(()=>pe(e(_))))),d=Ct(()=>(O(e(Q)),O(e(ae)),r(()=>Array.isArray(e(Q))?e(Q):Array(e(ae)).fill(!1))));var Ke=Ar(),xe=l(Ke);{var q=le=>{var Be=Lr();o(le,Be)},_e=le=>{var Be=jr(),ke=we(Be);xt(ke,5,()=>e(d),jt,(z,J,ie)=>{Ls(z,{get checked(){return e(J)},index:ie,$$events:{change:Te=>{de.update(Oe=>(Oe.classFeatures.features[e(G)]||(Oe.classFeatures.features[e(G)]=Array(e(ae)).fill(!1)),Oe.classFeatures.features[e(G)][ie]=Te.detail.checked,Oe))}}})}),s(ke);var ze=a(ke,2),Ne=l(ze),Xe=l(Ne);s(Ne),s(ze);var nt=a(ze,2),oe=l(nt),A=l(oe);s(oe),s(nt),L(z=>{Ne.disabled=z,k(Xe,`Use ${e(_),r(()=>e(_).name)??""}`),k(A,`Resets on ${e(_),r(()=>e(_).resetOn==="short"?"Short Rest":"Long Rest")??""}`)},[()=>(O(e(d)),r(()=>e(d).filter(z=>!z).length<=0))]),R("click",Ne,()=>{de.update(z=>{z.classFeatures.features[e(G)]||(z.classFeatures.features[e(G)]=Array(e(ae)).fill(!1));const J=z.classFeatures.features[e(G)],ie=J.findIndex(Te=>!Te);return ie!==-1&&(J[ie]=!0),z})}),o(le,Be)};g(xe,le=>{e(ae)===1/0?le(q):le(_e,!1)})}s(Ke),o(ye,Ke)},mt=ye=>{var ae=bt(),d=we(ae);{var Ke=q=>{const _e=Ct(()=>(e(_),r(()=>N(e(_)))));var le=Rr(),Be=l(le);Ce(Be);var ke=a(Be,2),ze=l(ke);s(ke);var Ne=a(ke,2),Xe=l(Ne,!0);s(Ne),s(le),L(()=>{Ea(Be,e(re)&&e(Q)!==void 0?e(Q):e(_e)),et(Be,"max",e(_e)),k(ze,`/ ${e(_e)??""}`),k(Xe,(e(_),r(()=>e(_).resetOn==="short"?"Short Rest":"Long Rest")))}),R("input",Be,nt=>{de.update(oe=>(oe.classFeatures.features[e(G)]=parseInt(nt.currentTarget.value)||0,oe))}),R("click",Ne,()=>B(e(G),e(_e))),o(q,le)},xe=q=>{var _e=bt(),le=we(_e);{var Be=ke=>{var ze=Tr(),Ne=l(ze),Xe=a(Ne,2),nt=l(Xe),oe=l(nt);s(nt),s(Xe);var A=a(Xe,2);{var z=J=>{var ie=Br();o(J,ie)};g(A,J=>{e(Z)<=0&&J(z)})}s(ze),L(()=>{Ne.disabled=e(Z)<=0,k(oe,`Resets on ${e(_),r(()=>e(_).resetOn==="short"?"Short Rest":"Long Rest")??""}`)}),R("click",Ne,me),o(ke,ze)};g(le,ke=>{e(_),r(()=>e(_).type==="channelDivinity")&&ke(Be)},!0)}o(q,_e)};g(d,q=>{e(_),r(()=>e(_).type==="pool")?q(Ke):q(xe,!1)},!0)}o(ye,ae)};g(qe,ye=>{e(_),r(()=>e(_).type==="uses")?ye(Qe):ye(mt,!1)})}s(Le),L(ye=>{k(C,` ${e(_),r(()=>e(_).name)??""}`),k(De,ye)},[()=>(e(_),r(()=>Ie(e(_))))]),o(K,Le)}),s(Ve),o(it,Ve)};g(Ye,it=>{e(b),r(()=>e(b).length===0)?it(ct):it(ft,!1)},!0)}o(ge,Ge)};g(ce,ge=>{t(),r(()=>!t().class)?ge(ve):ge(he,!1)})}o(h,P)};g($,h=>{p(),r(()=>!p().classFeatures)&&h(X)})}s(je),L(()=>T=Mt(je,1,"class-features svelte-1kpvv0n",null,T,{hidden:!e(V)})),o(i,je),Kt(),w()}var Ur=u('<textarea placeholder="Enter features, traits, and special abilities..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Equipment</h3> <textarea placeholder="List your equipment and inventory..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Notes</h3> <textarea placeholder="Additional notes..." class="svelte-wttn0l"></textarea>',1),Hr=u("<section><!> <!></section>");function Nr(i,c){Wt(c,!1);const t=()=>ut(_a,"$searchFilter",p),v=()=>ut(de,"$character",p),f=()=>ut(aa,"$collapsedStates",p),[p,m]=ca(),w=D();function y(){aa.update(V=>({...V,notes:!V.notes}))}Je(()=>(t(),v()),()=>{n(w,!t()||"features".includes(t().toLowerCase())||"traits".includes(t().toLowerCase())||"equipment".includes(t().toLowerCase())||"notes".includes(t().toLowerCase())||v().features.toLowerCase().includes(t().toLowerCase())||v().equipment.toLowerCase().includes(t().toLowerCase())||v().notes.toLowerCase().includes(t().toLowerCase()))}),pa(),zt();var b=Hr();let W;var I=l(b);{let V=Ct(()=>(f(),r(()=>f().notes?"Expand":"Collapse")));Sa(I,{title:"Features & Traits",get collapsed(){return f(),r(()=>f().notes)},get ariaLabel(){return e(V)},onToggle:y})}var Z=a(I,2);{var ee=V=>{var E=Ur(),j=we(E);ja(j);var B=a(j,4);ja(B);var F=a(B,4);ja(F),He(j,()=>v().features,pe=>Nt(de,r(v).features=pe,r(v))),He(B,()=>v().equipment,pe=>Nt(de,r(v).equipment=pe,r(v))),He(F,()=>v().notes,pe=>Nt(de,r(v).notes=pe,r(v))),o(V,E)};g(Z,V=>{f(),r(()=>!f().notes)&&V(ee)})}s(b),L(()=>W=Mt(b,1,"notes svelte-wttn0l",null,W,{hidden:!e(w)})),o(i,b),Kt(),m()}var Or=u(" <!> <!> <!> <!> <!>",1),Gr=u('<div class="color-picker-section svelte-1r90jgp"><h3 class="svelte-1r90jgp">Dice Colors</h3> <div class="color-inputs svelte-1r90jgp"><div class="color-input-group svelte-1r90jgp"><label for="dice-color" class="svelte-1r90jgp">Dice Color</label> <input type="color" id="dice-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="label-color" class="svelte-1r90jgp">Label Color</label> <input type="color" id="label-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="desk-color" class="svelte-1r90jgp">Background Color</label> <input type="color" id="desk-color" class="svelte-1r90jgp"/></div></div></div>'),qr=u('<div class="loading svelte-1r90jgp"><p class="svelte-1r90jgp">Loading 3D dice...</p></div>'),zr=u('<div class="custom-dice-selector svelte-1r90jgp"><h3 class="svelte-1r90jgp">Choose Dice to Roll</h3> <div class="dice-inputs svelte-1r90jgp"><div class="dice-input-group svelte-1r90jgp"><label for="d4" class="svelte-1r90jgp">d4</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d4" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d6" class="svelte-1r90jgp">d6</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d6" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d8" class="svelte-1r90jgp">d8</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d8" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d10" class="svelte-1r90jgp">d10</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d10" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d12" class="svelte-1r90jgp">d12</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d12" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d20" class="svelte-1r90jgp">d20</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d20" min="0" max="10"/></div></div> <div class="dice-controls svelte-1r90jgp"><button class="btn btn-primary use-enabled svelte-1r90jgp"> </button> <button class="btn btn-secondary use-enabled svelte-1r90jgp">Reset</button></div></div>'),Wr=u('<h3 class="svelte-1r90jgp"> </h3>'),Kr=u('<h3 class="svelte-1r90jgp"> </h3>'),Vr=u('<h3 class="svelte-1r90jgp"> </h3>'),Jr=u('<h3 class="svelte-1r90jgp"> </h3>'),Yr=u('<span class="crit-badge svelte-1r90jgp">CRITICAL HIT!</span>'),Qr=u('<span class="crit-badge crit-fail svelte-1r90jgp">CRITICAL MISS!</span>'),Xr=u('<div class="bonus-item svelte-1r90jgp"><span class="bonus-value svelte-1r90jgp"> </span> <span class="bonus-source svelte-1r90jgp"> </span></div>'),Zr=u('<div class="bonus-breakdown svelte-1r90jgp"></div>'),en=u('<p class="modifier-text svelte-1r90jgp"> </p>'),tn=u('<div class="svelte-1r90jgp"><em class="svelte-1r90jgp">No damage is dealt on a critical miss.</em></div>'),an=u('<button class="btn btn-follow-up svelte-1r90jgp"> </button>'),sn=u('<button class="btn btn-guided-strike svelte-1r90jgp">‚ö° Use Guided Strike (+10)</button>'),ln=u('<div class="follow-up-actions svelte-1r90jgp"><!> <!></div>'),rn=u('<div class="result-header svelte-1r90jgp"><!> <!> <!></div> <div class="result-total svelte-1r90jgp"> </div> <div class="result-details svelte-1r90jgp"><!></div> <!> <!>',1),nn=u('<div role="button" tabindex="-1"><div class="modal-content svelte-1r90jgp" role="dialog" tabindex="0"><div class="modal-header svelte-1r90jgp"><h2 class="svelte-1r90jgp"><!></h2> <div class="header-buttons svelte-1r90jgp"><button class="color-btn svelte-1r90jgp" title="Customize dice colors">üé®</button> <button class="close-btn svelte-1r90jgp">√ó</button></div></div> <!> <!> <div class="dice-main-area svelte-1r90jgp"><div class="dice-container svelte-1r90jgp"></div> <!></div> <div><!></div></div></div>');function on(i,c){Wt(c,!1);const t=()=>ut(de,"$character",v),[v,f]=ca(),p=D(),m=D(),w=D(),y=$a();let b=At(c,"notation",12,""),W=At(c,"visible",8,!1),I=At(c,"damageNotation",12,""),Z=At(c,"damageType",8,""),ee=At(c,"attackName",12,""),V=At(c,"applyHalfDamage",8,!1),E=At(c,"bonusBreakdown",28,()=>[]),j=At(c,"rollType",12,"other"),B=null,F=D(void 0),pe=D(!1),Ee=D(""),N=D(null);function Ie(){return e(N)?.resultTotal??null}function me(A,z,J){const ie=[];if(!A||!A.result)return ie;const Te=z.match(/([+-]?\d*d\d+|[+-]?\d+)/g)||[];let Oe=0;const Me=new Set;for(const Ae of Te){const ot=Ae.trim();if(!ot)continue;const pt=ot.match(/([+-]?)(\d*)d(\d+)/);if(pt){const Fe=parseInt(pt[2]||"1"),Pe=`${Fe}d${pt[3]}`,wt=J.findIndex((Ze,ht)=>!Me.has(ht)&&typeof Ze.value=="string"&&Ze.value===Pe),ue=[];for(let Ze=0;Ze<Fe&&Oe<A.result.length;Ze++)ue.push(A.result[Oe++]);const ne=wt>=0?J[wt].source:"base die";wt>=0&&Me.add(wt);for(const Ze of ue)ie.push({display:`${Ze}`,source:ne})}}for(let Ae=0;Ae<J.length;Ae++)if(!Me.has(Ae)&&typeof J[Ae].value=="number"){const ot=J[Ae].value;ie.push({display:ot>=0?`+${ot}`:`${ot}`,source:J[Ae].source})}return ie}let be=D(0),je=D(0),T=D(0),U=D(0),$=D(0),X=D(0),h=D(0),P=D([]),Y=D(!1),ce=D(!1),ve=D(!1),he=D("#051e0a"),ge=D("#ffffff"),Ge=D("#3a2004"),Ye=D(!1);function ct(A){return A.length===9&&A.startsWith("#")?A.substring(0,7):A}function ft(A,z="ff"){return A.length===7&&A.startsWith("#")?A+z:A}function it(){if(window.DICE&&e(F))try{B&&e(F)&&ba(F,e(F).innerHTML="");const A=e(F).clientWidth||500,z=e(F).clientHeight||300;B=new window.DICE.dice_box(e(F),{w:A,h:z}),n(pe,!0)}catch(A){console.error("Error initializing dice box:",A)}}wa(()=>{const A=ie=>new Promise((Te,Oe)=>{if(document.querySelector(`script[src="${ie}"]`)){Te(null);return}const Ae=document.createElement("script");Ae.src=ie,Ae.onload=()=>{Te(null)},Ae.onerror=()=>{console.error(`Failed to load: ${ie}`),Oe(new Error(`Failed to load ${ie}`))},document.head.appendChild(Ae)});setTimeout(()=>{A(`${Pa}/libs/three.min.js`).then(()=>A(`${Pa}/libs/cannon.min.js`)).then(()=>A(`${Pa}/libs/teal.js`)).then(()=>A(`${Pa}/dice.js`)).then(()=>{if(window.DICE){const ie=window.DICE.getColors();n(he,ct(ie.dice_color)),n(ge,ct(ie.label_color)),n(Ge,ct(ie.desk_color))}it()}).catch(ie=>{console.error("Failed to load dice libraries:",ie)})},100);const z=()=>{e(pe)&&it()},J=ie=>{W()&&ie.key==="Escape"&&re()};return window.addEventListener("resize",z),window.addEventListener("keydown",J),()=>{window.removeEventListener("resize",z),window.removeEventListener("keydown",J)}});function Ve(A,z="other"){if(!B||!e(pe))return;n(N,null),n(P,[]),n(Y,!1),n(ce,!1),z==="damage"&&E([]),j(z),n(ve,!1),B.diceToRoll=A;const J=Te=>null,ie=Te=>{let Oe=Te.resultTotal,Me=Te.resultString;if(V()&&(Oe=Math.floor(Oe/2),Me=Me+" (halved)"),n(N,{...Te,resultTotal:Oe,resultString:Me}),console.log("Final roll result:",e(N)),console.log({type:z}),z==="attack"&&Te.result&&Te.result.length>0){const Ae=Te.result[0];n(Y,Ae===20),n(ce,Ae===1)}if(n(P,[]),console.log("Setting up follow-up actions. Type:",z,"damageNotation:",I(),"isCriticalSuccess:",e(Y),"isCriticalFail:",e(ce)),z==="attack"&&I())if(e(Y)){const Ae=S(I());e(P).push({label:`Roll Critical Damage (${Ae})`,notation:Ae})}else e(ce)||e(P).push({label:`Roll Damage (${I()})`,notation:I()})};B.start_throw(J,ie)}function $t(){const A=[];e(be)>0&&A.push(`${e(be)}d4`),e(je)>0&&A.push(`${e(je)}d6`),e(T)>0&&A.push(`${e(T)}d8`),e(U)>0&&A.push(`${e(U)}d10`),e($)>0&&A.push(`${e($)}d12`),e(X)>0&&A.push(`${e(X)}d20`);let z=A.join("+")||"1d20";return e(h)!==0&&(z+=e(h)>=0?`+${e(h)}`:`${e(h)}`),z}function Dt(){const A=$t();Ve(A)}function S(A){return A.replace(/(\d+)d(\d+)/g,(z,J,ie)=>`${parseInt(J)*2}d${ie}`)}function K(){n(be,0),n(je,0),n(T,0),n(U,0),n($,0),n(X,0),n(h,0),n(N,null),n(P,[]),n(Y,!1),n(ce,!1),j("other"),n(ve,!1)}function _(){window.DICE&&(window.DICE.setColors({dice_color:ft(e(he),"ff"),label_color:ft(e(ge),"ff"),desk_color:e(Ge)}),B&&(B.updateDeskColor(e(Ge)),B.updateDiceColors()))}function G(){n(Ye,!e(Ye))}function Q(){!e(N)||e(m)<=0||e(ve)||(n(N,{...e(N),resultTotal:e(N).resultTotal+10,resultString:e(N).resultString+" + 10 (Guided Strike)"}),de.update(A=>{const z="ChannelDivinity",J=A.classFeatures.features[z];return typeof J=="number"&&J>0&&(A.classFeatures.features[z]=J-1),A}),n(ve,!0))}function re(){y("close"),b(""),I(""),ee(""),n(Ee,""),n(N,null),n(ve,!1),n(Y,!1),n(ce,!1),K()}Je(()=>(t(),Ra),()=>{n(p,t().class?Ra(t().class,t().level,t().subclass).some(z=>z.name==="Guided Strike"):!1)}),Je(()=>t(),()=>{n(m,(()=>{const z=t().classFeatures.features["ChannelDivinity"];return typeof z=="number"?z:0})())}),Je(()=>(e(be),e(je),e(T),e(U),e($),e(X),e(h)),()=>{n(w,(()=>{const A=[];e(be)>0&&A.push(`${e(be)}d4`),e(je)>0&&A.push(`${e(je)}d6`),e(T)>0&&A.push(`${e(T)}d8`),e(U)>0&&A.push(`${e(U)}d10`),e($)>0&&A.push(`${e($)}d12`),e(X)>0&&A.push(`${e(X)}d20`);let z=A.join("+")||"1d20";return e(h)!==0&&(z+=e(h)>=0?`+${e(h)}`:`${e(h)}`),z})())}),Je(()=>(O(b()),e(pe),O(W()),e(Ee),O(I()),O(ee()),O(j())),()=>{b()&&e(pe)&&W()&&b()!==e(Ee)&&(n(Ee,b()),n(N,null),n(P,[]),n(Y,!1),n(ce,!1),n(ve,!1),console.log("Auto-roll triggered. notation:",b(),"damageNotation:",I(),"attackName:",ee(),"rollType:",j()),setTimeout(()=>Ve(b(),j()),200))}),pa();var Le={getLastRollTotal:Ie};zt();var Se=nn();let Re;var se=l(Se),C=l(se),te=l(C),De=l(te);{var qe=A=>{var z=Or(),J=we(z),ie=a(J);{var Te=ue=>{var ne=Pt("- Attack Roll");o(ue,ne)};g(ie,ue=>{j()==="attack"&&ue(Te)})}var Oe=a(ie,2);{var Me=ue=>{var ne=Pt("- Damage Roll");o(ue,ne)};g(Oe,ue=>{j()==="damage"&&ue(Me)})}var Ae=a(Oe,2);{var ot=ue=>{var ne=Pt("- Healing Roll");o(ue,ne)};g(Ae,ue=>{j()==="healing"&&ue(ot)})}var pt=a(Ae,2);{var Fe=ue=>{var ne=Pt("- Ability Check");o(ue,ne)};g(pt,ue=>{j()==="check"&&ue(Fe)})}var Pe=a(pt,2);{var wt=ue=>{var ne=Pt("- Saving Throw");o(ue,ne)};g(Pe,ue=>{j()==="save"&&ue(wt)})}L(()=>k(J,`${ee()??""} `)),o(A,z)},Qe=A=>{var z=Pt("Dice Roller");o(A,z)};g(De,A=>{ee()?A(qe):A(Qe,!1)})}s(te);var mt=a(te,2),ye=l(mt),ae=a(ye,2);s(mt),s(C);var d=a(C,2);{var Ke=A=>{var z=Gr(),J=a(l(z),2),ie=l(J),Te=a(l(ie),2);Ce(Te),s(ie);var Oe=a(ie,2),Me=a(l(Oe),2);Ce(Me),s(Oe);var Ae=a(Oe,2),ot=a(l(Ae),2);Ce(ot),s(Ae),s(J),s(z),He(Te,()=>e(he),pt=>n(he,pt)),R("change",Te,_),He(Me,()=>e(ge),pt=>n(ge,pt)),R("change",Me,_),He(ot,()=>e(Ge),pt=>n(Ge,pt)),R("change",ot,_),o(A,z)};g(d,A=>{e(Ye)&&A(Ke)})}var xe=a(d,2);{var q=A=>{var z=qr();o(A,z)};g(xe,A=>{e(pe)||A(q)})}var _e=a(xe,2),le=l(_e);Ua(le,A=>n(F,A),()=>e(F));var Be=a(le,2);{var ke=A=>{var z=zr(),J=a(l(z),2),ie=l(J),Te=a(l(ie),2);Ce(Te),s(ie);var Oe=a(ie,2),Me=a(l(Oe),2);Ce(Me),s(Oe);var Ae=a(Oe,2),ot=a(l(Ae),2);Ce(ot),s(Ae);var pt=a(Ae,2),Fe=a(l(pt),2);Ce(Fe),s(pt);var Pe=a(pt,2),wt=a(l(Pe),2);Ce(wt),s(Pe);var ue=a(Pe,2),ne=a(l(ue),2);Ce(ne),s(ue),s(J);var Ze=a(J,2),ht=l(Ze),M=l(ht);s(ht);var $e=a(ht,2);s(Ze),s(z),L(()=>{ht.disabled=!e(pe),k(M,`Roll ${e(w)??""}`)}),He(Te,()=>e(be),x=>n(be,x)),He(Me,()=>e(je),x=>n(je,x)),He(ot,()=>e(T),x=>n(T,x)),He(Fe,()=>e(U),x=>n(U,x)),He(wt,()=>e($),x=>n($,x)),He(ne,()=>e(X),x=>n(X,x)),R("click",ht,Dt),R("click",$e,K),o(A,z)};g(Be,A=>{b()||A(ke)})}s(_e);var ze=a(_e,2);let Ne;var Xe=l(ze);{var nt=A=>{var z=rn(),J=we(z),ie=l(J);{var Te=x=>{var Ue=Wr(),H=l(Ue,!0);s(Ue),L(()=>k(H,ee()?`${ee()} - Healing`:"Healing")),o(x,Ue)},Oe=x=>{var Ue=bt(),H=we(Ue);{var Bt=tt=>{var fe=Kr(),vt=l(fe,!0);s(fe),L(()=>k(vt,ee()?`${ee()} - ${Z()} Damage`:`${Z()} Damage`)),o(tt,fe)},_t=tt=>{var fe=bt(),vt=we(fe);{var at=We=>{var gt=Vr(),yt=l(gt,!0);s(gt),L(()=>k(yt,ee()?`${ee()} - Damage`:"Damage")),o(We,gt)},Ft=We=>{var gt=Jr(),yt=l(gt,!0);s(gt),L(()=>k(yt,ee()?`${ee()} - Result`:"Result")),o(We,gt)};g(vt,We=>{j()==="damage"?We(at):We(Ft,!1)},!0)}o(tt,fe)};g(H,tt=>{j()==="damage"&&Z()?tt(Bt):tt(_t,!1)},!0)}o(x,Ue)};g(ie,x=>{j()==="damage"&&Z()==="Healing"?x(Te):x(Oe,!1)})}var Me=a(ie,2);{var Ae=x=>{var Ue=Yr();o(x,Ue)};g(Me,x=>{e(Y)&&x(Ae)})}var ot=a(Me,2);{var pt=x=>{var Ue=Qr();o(x,Ue)};g(ot,x=>{e(ce)&&x(pt)})}s(J);var Fe=a(J,2),Pe=l(Fe,!0);s(Fe);var wt=a(Fe,2),ue=l(wt);{var ne=x=>{var Ue=bt(),H=we(Ue);{var Bt=tt=>{var fe=Zr();xt(fe,5,()=>(e(N),O(b()),O(E()),r(()=>me(e(N),b(),E()))),jt,(vt,at)=>{var Ft=Xr(),We=l(Ft),gt=l(We,!0);s(We);var yt=a(We,2),Ut=l(yt);s(yt),s(Ft),L(()=>{k(gt,(e(at),r(()=>e(at).display))),k(Ut,`(${e(at),r(()=>e(at).source)??""})`)}),o(vt,Ft)}),s(fe),o(tt,fe)},_t=tt=>{var fe=bt(),vt=we(fe);{var at=Ft=>{var We=en(),gt=l(We);s(We),L(()=>k(gt,`Modifier: ${e(N),r(()=>e(N).constant>=0?"+":"")??""}${e(N),r(()=>e(N).constant)??""}`)),o(Ft,We)};g(vt,Ft=>{e(N),r(()=>e(N).constant)&&Ft(at)},!0)}o(tt,fe)};g(H,tt=>{O(E()),r(()=>E().length>0)?tt(Bt):tt(_t,!1)})}o(x,Ue)};g(ue,x=>{e(N),O(E()),r(()=>e(N).constant||E().length>0)&&x(ne)})}s(wt);var Ze=a(wt,2);{var ht=x=>{var Ue=tn();o(x,Ue)};g(Ze,x=>{e(ce)&&x(ht)})}var M=a(Ze,2);{var $e=x=>{var Ue=ln(),H=l(Ue);xt(H,1,()=>e(P),jt,(tt,fe)=>{var vt=an(),at=l(vt,!0);s(vt),L(()=>k(at,(e(fe),r(()=>e(fe).label)))),R("click",vt,()=>Ve(e(fe).notation,"damage")),o(tt,vt)});var Bt=a(H,2);{var _t=tt=>{var fe=sn();L(()=>{fe.disabled=e(m)<=0,et(fe,"title",e(m)<=0?"No Channel Divinity uses remaining":"Use Channel Divinity to add +10 to this attack roll")}),R("click",fe,Q),o(tt,fe)};g(Bt,tt=>{e(p)&&j()==="attack"&&!e(ve)&&e(m)>0&&!e(ce)&&tt(_t)})}s(Ue),o(x,Ue)};g(M,x=>{e(P),e(p),O(j()),e(ve),e(m),r(()=>e(P).length>0||e(p)&&j()==="attack"&&!e(ve)&&e(m)>0)&&x($e)})}L(()=>k(Pe,(e(N),r(()=>e(N).resultTotal)))),o(A,z)};g(Xe,A=>{e(N)&&A(nt)})}s(ze),s(se),s(Se),L(()=>{Re=Mt(Se,1,"modal-overlay svelte-1r90jgp",null,Re,{hidden:!W()}),Ne=Mt(ze,1,"roll-result svelte-1r90jgp",null,Ne,{"has-result":e(N)})}),R("click",ye,G),R("click",ae,re),R("click",se,ms(function(A){Aa.call(this,c,A)})),R("keydown",se,function(A){Aa.call(this,c,A)}),R("click",Se,re),R("keydown",Se,A=>A.key==="Escape"&&re()),o(i,Se),xl(c,"getLastRollTotal",Ie);var oe=Kt(Le);return f(),oe}const Xa="https://api.github.com/gists";async function cn(i,c,t){if(!c)throw new Error("GitHub token is required");const v=JSON.stringify(i,null,2),f=`${i.name||"character"}_dnd.json`,p={description:t||`D&D Character: ${i.name}`,public:!1,files:{[f]:{content:v}}},m=await fetch(Xa,{method:"POST",headers:{Authorization:`token ${c}`,"Content-Type":"application/json"},body:JSON.stringify(p)});if(!m.ok)throw new Error(`Failed to create gist: ${m.statusText}`);return(await m.json()).id}async function vn(i,c,t){if(!c||!t)throw new Error("GitHub token and Gist ID are required");const v=JSON.stringify(i,null,2),p={files:{[`${i.name||"character"}_dnd.json`]:{content:v}}},m=await fetch(`${Xa}/${t}`,{method:"PATCH",headers:{Authorization:`token ${c}`,"Content-Type":"application/json"},body:JSON.stringify(p)});if(!m.ok)throw new Error(`Failed to update gist: ${m.statusText}`)}async function dn(i,c){if(!i)throw new Error("Gist ID is required");const t={"Content-Type":"application/json"};c&&(t.Authorization=`token ${c}`);const v=await fetch(`${Xa}/${i}`,{method:"GET",headers:t});if(!v.ok)throw new Error(`Failed to load gist: ${v.statusText}`);const f=await v.json(),p=Object.values(f.files);if(p.length===0)throw new Error("No files found in gist");const w=p[0].content;try{const y=JSON.parse(w);return y.attacks&&Array.isArray(y.attacks)&&(y.attacks=y.attacks.map(b=>({...b,id:b.id||crypto.randomUUID()}))),y.classFeatures?(y.classFeatures.features||(y.classFeatures.features={}),y.classFeatures.spellSlots||(y.classFeatures.spellSlots=[]),y.classFeatures.preparedSpells===void 0&&(y.classFeatures.preparedSpells="")):y.classFeatures={features:{},spellSlots:[],preparedSpells:""},y}catch{throw new Error("Invalid character data in gist")}}function js(i){typeof window<"u"&&localStorage.setItem("dnd_gist_config",JSON.stringify(i))}function un(){if(typeof window<"u"){const i=localStorage.getItem("dnd_gist_config");if(i)return JSON.parse(i)}return{}}async function fn(i,c=30){if(!i)throw new Error("GitHub token is required to list gists");const t=await fetch(`${Xa}?per_page=${c}`,{method:"GET",headers:{Authorization:`token ${i}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error(`Failed to list gists: ${t.statusText}`);return await t.json()}var pn=u('<div class="error-message svelte-1jb5ckg"> </div>'),mn=u('<div class="toggle-container svelte-1jb5ckg"><button type="button" class="toggle-btn svelte-1jb5ckg"> </button></div>'),gn=u('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID (leave empty to create new)</label> <input type="text" id="gistId" placeholder="Optional: existing Gist ID to update" class="svelte-1jb5ckg"/></div>'),bn=u('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),hn=u('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),_n=u('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Update (or leave unselected to create new)</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),yn=u('<div class="info-message svelte-1jb5ckg">No gists found. A new one will be created.</div>'),xn=u('<!> <div class="form-group svelte-1jb5ckg"><label for="description" class="svelte-1jb5ckg"> </label> <input type="text" id="description" placeholder="D&amp;D Character Sheet" class="svelte-1jb5ckg"/></div>',1),$n=u('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID *</label> <input type="text" id="gistId" placeholder="Enter Gist ID (for public or your private gists)" required class="svelte-1jb5ckg"/></div>'),wn=u('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),Sn=u('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),kn=u('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Load</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),Cn=u('<div class="info-message svelte-1jb5ckg">No gists found. Enter a Gist ID manually or create a new one in Save mode.</div>'),Dn=u('<div class="modal-overlay svelte-1jb5ckg" role="button" tabindex="-1"><div class="modal-content svelte-1jb5ckg" role="dialog" tabindex="0"><div class="modal-header svelte-1jb5ckg"><h2 class="svelte-1jb5ckg"> </h2> <button class="close-btn svelte-1jb5ckg">√ó</button></div> <div class="modal-body svelte-1jb5ckg"><!> <div class="form-group svelte-1jb5ckg"><label for="token" class="svelte-1jb5ckg"> <a href="https://github.com/settings/tokens" target="_blank" rel="noopener" class="svelte-1jb5ckg">Get token</a></label> <input type="password" id="token" placeholder="ghp_xxxxxxxxxxxxx" class="svelte-1jb5ckg"/></div> <!> <!> <div class="modal-actions svelte-1jb5ckg"><button class="btn btn-primary svelte-1jb5ckg"><!></button> <button class="btn btn-secondary svelte-1jb5ckg">Cancel</button></div></div></div></div>');function Ln(i,c){Wt(c,!1);const t=()=>ut(de,"$character",v),[v,f]=ca(),p=$a();let m=At(c,"mode",8,"save"),w=D(""),y=D(""),b=D(""),W=D(!1),I=D(""),Z=D(!1),ee=D(!1),V=D([]),E=D(null);const j=un();j.token&&n(w,j.token),j.gistId&&n(y,j.gistId),wa(async()=>{e(w)&&!e(Z)&&await B()});async function B(){if(e(w)){n(ee,!0),n(I,"");try{n(V,await fn(e(w))),e(y)&&n(E,e(V).find(_=>_.id===e(y))||null)}catch(_){n(I,_.message||"Failed to load gists"),n(V,[])}finally{n(ee,!1)}}}function F(_){n(E,_),n(y,_.id)}function pe(){n(Z,!e(Z)),n(I,""),!e(Z)&&e(w)&&B()}async function Ee(){if(!e(w)){n(I,"GitHub token is required");return}const _=e(E)?.id||e(y);n(W,!0),n(I,"");try{if(_)await vn(t(),e(w),_),n(y,_),Ot.add("Character updated in Gist successfully!","success");else{const G=await cn(t(),e(w),e(b));n(y,G),Ot.add(`Character saved to Gist! ID: ${G}`,"success")}js({token:e(w),gistId:e(y)}),p("close")}catch(G){n(I,G.message||"Failed to save to Gist")}finally{n(W,!1)}}async function N(){const _=e(E)?.id||e(y);if(!_){n(I,"Please select a gist or enter a Gist ID");return}n(W,!0),n(I,"");try{const G=await dn(_,e(w)||void 0);de.set(G),n(y,_),js({token:e(w),gistId:e(y)}),Ot.add("Character loaded from Gist successfully!","success"),p("close")}catch(G){n(I,G.message||"Failed to load from Gist")}finally{n(W,!1)}}function Ie(){p("close")}zt();var me=Dn(),be=l(me),je=l(be),T=l(je),U=l(T,!0);s(T);var $=a(T,2);s(je);var X=a(je,2),h=l(X);{var P=_=>{var G=pn(),Q=l(G,!0);s(G),L(()=>k(Q,e(I))),o(_,G)};g(h,_=>{e(I)&&_(P)})}var Y=a(h,2),ce=l(Y),ve=l(ce);ta(),s(ce);var he=a(ce,2);Ce(he),s(Y);var ge=a(Y,2);{var Ge=_=>{var G=mn(),Q=l(G),re=l(Q,!0);s(Q),s(G),L(()=>{Q.disabled=e(W),k(re,e(Z)?"üìã Show My Gists":"‚úèÔ∏è Enter Gist ID Manually")}),R("click",Q,pe),o(_,G)};g(ge,_=>{(m()==="load"||m()==="save"&&e(w))&&_(Ge)})}var Ye=a(ge,2);{var ct=_=>{var G=xn(),Q=we(G);{var re=te=>{var De=gn(),qe=a(l(De),2);Ce(qe),s(De),L(()=>qe.disabled=e(W)),He(qe,()=>e(y),Qe=>n(y,Qe)),o(te,De)},Le=te=>{var De=bt(),qe=we(De);{var Qe=ye=>{var ae=bn();o(ye,ae)},mt=ye=>{var ae=bt(),d=we(ae);{var Ke=q=>{var _e=_n(),le=a(l(_e),2);xt(le,5,()=>e(V),jt,(Be,ke)=>{var ze=hn();let Ne;var Xe=l(ze),nt=l(Xe),oe=l(nt,!0);s(nt);var A=a(nt,2),z=l(A,!0);s(A),s(Xe);var J=a(Xe,2),ie=l(J),Te=l(ie);s(ie);var Oe=a(ie,2),Me=l(Oe);s(Oe),s(J),s(ze),L(Ae=>{Ne=Mt(ze,1,"gist-item svelte-1jb5ckg",null,Ne,{selected:e(E)?.id===e(ke).id}),ze.disabled=e(W),k(oe,(e(ke),r(()=>e(ke).description||"Untitled"))),k(z,(e(ke),r(()=>e(ke).public?"üåê Public":"üîí Private"))),k(Te,`ID: ${e(ke),r(()=>e(ke).id)??""}`),k(Me,`Updated: ${Ae??""}`)},[()=>(e(ke),r(()=>new Date(e(ke).updated_at).toLocaleDateString()))]),R("click",ze,()=>F(e(ke))),o(Be,ze)}),s(le),s(_e),o(q,_e)},xe=q=>{var _e=bt(),le=we(_e);{var Be=ke=>{var ze=yn();o(ke,ze)};g(le,ke=>{e(w)&&ke(Be)},!0)}o(q,_e)};g(d,q=>{e(V),r(()=>e(V).length>0)?q(Ke):q(xe,!1)},!0)}o(ye,ae)};g(qe,ye=>{e(ee)?ye(Qe):ye(mt,!1)},!0)}o(te,De)};g(Q,te=>{e(Z)||!e(w)?te(re):te(Le,!1)})}var Se=a(Q,2),Re=l(Se),se=l(Re);s(Re);var C=a(Re,2);Ce(C),s(Se),L(()=>{k(se,`Description ${e(y)?"(optional)":""}`),C.disabled=e(W)}),He(C,()=>e(b),te=>n(b,te)),o(_,G)},ft=_=>{var G=bt(),Q=we(G);{var re=Se=>{var Re=$n(),se=a(l(Re),2);Ce(se),s(Re),L(()=>se.disabled=e(W)),He(se,()=>e(y),C=>n(y,C)),o(Se,Re)},Le=Se=>{var Re=bt(),se=we(Re);{var C=De=>{var qe=wn();o(De,qe)},te=De=>{var qe=bt(),Qe=we(qe);{var mt=ae=>{var d=kn(),Ke=a(l(d),2);xt(Ke,5,()=>e(V),jt,(xe,q)=>{var _e=Sn();let le;var Be=l(_e),ke=l(Be),ze=l(ke,!0);s(ke);var Ne=a(ke,2),Xe=l(Ne,!0);s(Ne),s(Be);var nt=a(Be,2),oe=l(nt),A=l(oe);s(oe);var z=a(oe,2),J=l(z);s(z),s(nt),s(_e),L(ie=>{le=Mt(_e,1,"gist-item svelte-1jb5ckg",null,le,{selected:e(E)?.id===e(q).id}),_e.disabled=e(W),k(ze,(e(q),r(()=>e(q).description||"Untitled"))),k(Xe,(e(q),r(()=>e(q).public?"üåê Public":"üîí Private"))),k(A,`ID: ${e(q),r(()=>e(q).id)??""}`),k(J,`Updated: ${ie??""}`)},[()=>(e(q),r(()=>new Date(e(q).updated_at).toLocaleDateString()))]),R("click",_e,()=>F(e(q))),o(xe,_e)}),s(Ke),s(d),o(ae,d)},ye=ae=>{var d=bt(),Ke=we(d);{var xe=q=>{var _e=Cn();o(q,_e)};g(Ke,q=>{e(w)&&q(xe)},!0)}o(ae,d)};g(Qe,ae=>{e(V),r(()=>e(V).length>0)?ae(mt):ae(ye,!1)},!0)}o(De,qe)};g(se,De=>{e(ee)?De(C):De(te,!1)},!0)}o(Se,Re)};g(Q,Se=>{e(Z)||!e(w)?Se(re):Se(Le,!1)},!0)}o(_,G)};g(Ye,_=>{m()==="save"?_(ct):_(ft,!1)})}var it=a(Ye,2),Ve=l(it),$t=l(Ve);{var Dt=_=>{var G=Pt();L(()=>k(G,m()==="save"?"Saving...":"Loading...")),o(_,G)},S=_=>{var G=Pt();L(()=>k(G,m()==="save"?"Save":"Load")),o(_,G)};g($t,_=>{e(W)?_(Dt):_(S,!1)})}s(Ve);var K=a(Ve,2);s(it),s(X),s(be),s(me),L(()=>{k(U,m()==="save"?"Save to GitHub Gist":"Load from GitHub Gist"),k(ve,`GitHub Token ${m()==="load"?"(optional for public gists)":"(required)"} `),he.disabled=e(W),Ve.disabled=e(W),K.disabled=e(W)}),R("click",$,Ie),He(he,()=>e(w),_=>n(w,_)),R("blur",he,()=>{e(w)&&!e(Z)&&B()}),R("click",Ve,function(..._){(m()==="save"?Ee:N)?.apply(this,_)}),R("click",K,Ie),R("click",be,ms(function(_){Aa.call(this,c,_)})),R("keydown",be,function(_){Aa.call(this,c,_)}),R("click",me,Ie),R("keydown",me,_=>_.key==="Escape"&&Ie()),o(i,me),Kt(),f()}var jn=u('<div class="loading svelte-1ngjemu">Loading D&D data...</div>'),An=u("<option> </option>"),Rn=u('<select class="level-filter svelte-1ngjemu"><option>All Levels</option><option>Cantrip</option><!></select>'),Bn=u('<div class="no-results svelte-1ngjemu"> </div>'),Tn=u('<div class="item-meta svelte-1ngjemu"> </div>'),Mn=u('<div class="item-meta svelte-1ngjemu"> </div>'),Fn=u('<button><div class="item-name svelte-1ngjemu"> </div> <!></button>'),Pn=u('<p class="higher-levels"><strong>At Higher Levels:</strong> </p>'),In=u('<p class="cantrip-upgrade"><strong>Cantrip Upgrade:</strong> </p>'),En=u('<h3 class="svelte-1ngjemu"> </h3> <p class="spell-meta svelte-1ngjemu"><!> <!></p> <p class="spell-classes"><strong>Classes:</strong> </p> <div class="spell-stats svelte-1ngjemu"><div><strong>Casting Time:</strong> </div> <div><strong>Range:</strong> </div> <div><strong>Components:</strong> <!></div> <div><strong>Duration:</strong> <!> </div></div> <p class="description svelte-1ngjemu"> </p> <!> <!>',1),Un=u('<p class="prerequisite svelte-1ngjemu"><strong>Prerequisite:</strong> </p>'),Hn=u('<h3 class="svelte-1ngjemu"> </h3> <!> <p class="description svelte-1ngjemu"> </p> <a target="_blank" rel="noopener" class="source-link svelte-1ngjemu">View Full Details ‚Üí</a>',1),Nn=u('<div class="item-details svelte-1ngjemu"><!></div>'),On=u('<div class="controls svelte-1ngjemu"><div class="tabs svelte-1ngjemu"><button> </button> <button> </button></div> <div class="search-controls svelte-1ngjemu"><input type="text" placeholder="Search by name or description..." class="search-input svelte-1ngjemu"/> <!></div></div> <div class="content-container svelte-1ngjemu"><div class="items-list svelte-1ngjemu"><!></div> <!></div>',1),Gn=u('<div class="modal-backdrop svelte-1ngjemu" role="presentation"><div class="modal svelte-1ngjemu" role="dialog" aria-modal="true" tabindex="-1"><div class="modal-header svelte-1ngjemu"><h2 class="svelte-1ngjemu">Browse D&D Spells & Feats</h2> <button class="close-btn svelte-1ngjemu" aria-label="Close">&times;</button></div> <div class="modal-body svelte-1ngjemu"><!></div> <div class="modal-footer svelte-1ngjemu"><button class="btn-secondary svelte-1ngjemu">Cancel</button> <button class="btn-primary svelte-1ngjemu">Add to Character Sheet</button></div></div></div>');function qn(i,c){Wt(c,!1);const t=D(),v=D(),f=D();let p=At(c,"onClose",8),m=D("spell"),w=D(!0),y=D(""),b=D(null),W=D([]),I=D([]),Z=D(null);wa(async()=>{n(w,!0);try{n(W,await Us()),n(I,await oi())}catch($){console.error("Failed to load data:",$)}finally{n(w,!1)}});function ee($){n(Z,$)}function V($){const X=$.match(/(\d+d\d+(?:\s*\+\s*\d+)?)/i);return X?X[1]:""}function E($){const X=$.split(/\.( |$)/)[0].trim(),h=Array.from($.matchAll(/\*\*(.*?)\*\*/g)).map(Y=>Y[1].replace(/\.$/,""));let P=X;return h.length&&(P+=" | Effects: "+h.join(", ")),P}function j(){if(e(Z)){if(e(m)==="spell"){const $=e(Z);de.update(X=>{const P=[];$.range&&P.push(`Range: ${$.range}`),$.castingTime&&P.push(`Cast: ${$.castingTime}`),$.duration&&P.push(`Duration: ${$.duration}`),$.actionType==="Save"&&P.push("Saving throw spell"),$.components&&$.components.length>0&&P.push(`Components: ${$.components.join(", ")}`),$.material&&P.push(`Material: ${$.material}`);const Y=P.join(" | "),ce=E($.description),ve={id:crypto.randomUUID(),name:`${$.name}${$.concentration?" (C)":""}${$.ritual?" (R)":""}`,bonus:$.actionType==="Attack"?5:0,damage:V($.description),damageType:`${$.school} (Lvl ${$.level})`,spellRef:$.name,infoNotes:Y,generalNotes:ce,castAtLevel:$.level};return X.attacks=[...X.attacks,ve],X})}else if(e(m)==="feat"){const $=e(Z);de.update(X=>{const h=`${$.name}${$.prerequisite?` (Req: ${$.prerequisite})`:""}
${$.description}
`;return X.features=X.features?`${X.features}
${h}`:h,X})}n(Z,null),p()()}}Je(()=>(e(b),e(W),e(y)),()=>{n(t,e(b)!==null?ci(Ds(e(W),e(y)),e(b)):Ds(e(W),e(y)))}),Je(()=>(e(I),e(y)),()=>{n(v,vi(e(I),e(y)))}),Je(()=>(e(m),e(t),e(v)),()=>{n(f,e(m)==="spell"?e(t):e(v))}),pa(),zt();var B=Gn(),F=l(B),pe=l(F),Ee=a(l(pe),2);s(pe);var N=a(pe,2),Ie=l(N);{var me=$=>{var X=jn();o($,X)},be=$=>{var X=On(),h=we(X),P=l(h),Y=l(P);let ce;var ve=l(Y);s(Y);var he=a(Y,2);let ge;var Ge=l(he);s(he),s(P);var Ye=a(P,2),ct=l(Ye);Ce(ct);var ft=a(ct,2);{var it=Q=>{var re=Rn();L(()=>{e(b),qt(()=>{})});var Le=l(re);Le.value=(Le.__value=null)??"";var Se=a(Le);Se.value=Se.__value=0;var Re=a(Se);xt(Re,0,()=>[1,2,3,4,5,6,7,8,9],jt,(se,C)=>{var te=An(),De=l(te);s(te);var qe={};L(()=>{k(De,`Level ${C??""}`),qe!==(qe=C)&&(te.value=(te.__value=C)??"")}),o(se,te)}),s(re),Ha(re,()=>e(b),se=>n(b,se)),o(Q,re)};g(ft,Q=>{e(m)==="spell"&&Q(it)})}s(Ye),s(h);var Ve=a(h,2),$t=l(Ve),Dt=l($t);{var S=Q=>{var re=Bn(),Le=l(re);s(re),L(()=>k(Le,`No ${e(m)??""}s found`)),o(Q,re)},K=Q=>{var re=bt(),Le=we(re);xt(Le,1,()=>e(f),jt,(Se,Re)=>{var se=Fn();let C;var te=l(se),De=l(te,!0);s(te);var qe=a(te,2);{var Qe=ye=>{const ae=Ct(()=>e(Re));var d=Tn(),Ke=l(d);s(d),L(()=>k(Ke,`Level ${O(e(ae)),r(()=>e(ae).level)??""} ‚Ä¢ ${O(e(ae)),r(()=>e(ae).school)??""}`)),o(ye,d)},mt=ye=>{const ae=Ct(()=>e(Re));var d=bt(),Ke=we(d);{var xe=q=>{var _e=Mn(),le=l(_e,!0);s(_e),L(()=>k(le,(O(e(ae)),r(()=>e(ae).prerequisite)))),o(q,_e)};g(Ke,q=>{O(e(ae)),r(()=>e(ae).prerequisite)&&q(xe)})}o(ye,d)};g(qe,ye=>{e(m)==="spell"?ye(Qe):ye(mt,!1)})}s(se),L(()=>{C=Mt(se,1,"item-card svelte-1ngjemu",null,C,{selected:e(Z)?.name===e(Re).name}),k(De,(e(Re),r(()=>e(Re).name)))}),R("click",se,()=>ee(e(Re))),o(Se,se)}),o(Q,re)};g(Dt,Q=>{e(f),r(()=>e(f).length===0)?Q(S):Q(K,!1)})}s($t);var _=a($t,2);{var G=Q=>{var re=Nn(),Le=l(re);{var Se=se=>{const C=Ct(()=>e(Z));var te=En(),De=we(te),qe=l(De,!0);s(De);var Qe=a(De,2),mt=l(Qe);{var ye=Fe=>{var Pe=Pt();L(()=>k(Pe,`${O(e(C)),r(()=>e(C).school)??""} cantrip`)),o(Fe,Pe)},ae=Fe=>{var Pe=Pt();L(()=>k(Pe,`Level ${O(e(C)),r(()=>e(C).level)??""} ${O(e(C)),r(()=>e(C).school)??""}`)),o(Fe,Pe)};g(mt,Fe=>{O(e(C)),r(()=>e(C).level===0)?Fe(ye):Fe(ae,!1)})}var d=a(mt,2);{var Ke=Fe=>{var Pe=Pt("(ritual)");o(Fe,Pe)};g(d,Fe=>{O(e(C)),r(()=>e(C).ritual)&&Fe(Ke)})}s(Qe);var xe=a(Qe,2),q=a(l(xe));s(xe);var _e=a(xe,2),le=l(_e),Be=a(l(le));s(le);var ke=a(le,2),ze=a(l(ke));s(ke);var Ne=a(ke,2),Xe=a(l(Ne)),nt=a(Xe);{var oe=Fe=>{var Pe=Pt();L(()=>k(Pe,`(${O(e(C)),r(()=>e(C).material)??""})`)),o(Fe,Pe)};g(nt,Fe=>{O(e(C)),r(()=>e(C).material)&&Fe(oe)})}s(Ne);var A=a(Ne,2),z=a(l(A),2);{var J=Fe=>{var Pe=Pt("Concentration,");o(Fe,Pe)};g(z,Fe=>{O(e(C)),r(()=>e(C).concentration)&&Fe(J)})}var ie=a(z,1,!0);s(A),s(_e);var Te=a(_e,2),Oe=l(Te,!0);s(Te);var Me=a(Te,2);{var Ae=Fe=>{var Pe=Pn(),wt=a(l(Pe));s(Pe),L(()=>k(wt,` ${O(e(C)),r(()=>e(C).higherLevelSlot)??""}`)),o(Fe,Pe)};g(Me,Fe=>{O(e(C)),r(()=>e(C).higherLevelSlot)&&Fe(Ae)})}var ot=a(Me,2);{var pt=Fe=>{var Pe=In(),wt=a(l(Pe));s(Pe),L(()=>k(wt,` ${O(e(C)),r(()=>e(C).cantripUpgrade)??""}`)),o(Fe,Pe)};g(ot,Fe=>{O(e(C)),r(()=>e(C).cantripUpgrade)&&Fe(pt)})}L((Fe,Pe)=>{k(qe,(O(e(C)),r(()=>e(C).name))),k(q,` ${Fe??""}`),k(Be,` ${O(e(C)),r(()=>e(C).castingTime||e(C).actionType)??""}`),k(ze,` ${O(e(C)),r(()=>e(C).range)??""}`),k(Xe,` ${Pe??""}`),k(ie,(O(e(C)),r(()=>e(C).duration))),k(Oe,(O(e(C)),r(()=>e(C).description)))},[()=>(O(e(C)),r(()=>e(C).classes.join(", "))),()=>(O(e(C)),r(()=>e(C).components.join(", ").toUpperCase()))]),o(se,te)},Re=se=>{const C=Ct(()=>e(Z));var te=Hn(),De=we(te),qe=l(De,!0);s(De);var Qe=a(De,2);{var mt=Ke=>{var xe=Un(),q=a(l(xe));s(xe),L(()=>k(q,` ${O(e(C)),r(()=>e(C).prerequisite)??""}`)),o(Ke,xe)};g(Qe,Ke=>{O(e(C)),r(()=>e(C).prerequisite)&&Ke(mt)})}var ye=a(Qe,2),ae=l(ye,!0);s(ye);var d=a(ye,2);L(()=>{k(qe,(O(e(C)),r(()=>e(C).name))),k(ae,(O(e(C)),r(()=>e(C).description))),et(d,"href",(O(e(C)),r(()=>e(C).source)))}),o(se,te)};g(Le,se=>{e(m)==="spell"?se(Se):se(Re,!1)})}s(re),o(Q,re)};g(_,Q=>{e(Z)&&Q(G)})}s(Ve),L(()=>{ce=Mt(Y,1,"tab svelte-1ngjemu",null,ce,{active:e(m)==="spell"}),k(ve,`üìú Spells (${e(W),r(()=>e(W).length)??""})`),ge=Mt(he,1,"tab svelte-1ngjemu",null,ge,{active:e(m)==="feat"}),k(Ge,`‚≠ê Feats (${e(I),r(()=>e(I).length)??""})`)}),R("click",Y,()=>{n(m,"spell"),n(Z,null),n(y,"")}),R("click",he,()=>{n(m,"feat"),n(Z,null),n(y,"")}),He(ct,()=>e(y),Q=>n(y,Q)),o($,X)};g(Ie,$=>{e(w)?$(me):$(be,!1)})}s(N);var je=a(N,2),T=l(je),U=a(T,2);s(je),s(F),s(B),L(()=>U.disabled=!e(Z)),R("click",Ee,function(...$){p()?.apply(this,$)}),R("click",T,function(...$){p()?.apply(this,$)}),R("click",U,j),R("click",F,ms(function($){Aa.call(this,c,$)})),R("keydown",F,function($){Aa.call(this,c,$)}),R("click",B,function(...$){p()?.apply(this,$)}),R("keydown",B,$=>$.key==="Escape"&&p()()),o(i,B),Kt()}var zn=u('<span class="resistance-tag svelte-gdwwx1"> <button type="button" class="tag-remove svelte-gdwwx1">√ó</button></span>'),Wn=u('<div class="resistance-list svelte-gdwwx1"></div>'),Kn=u('<p class="ability-meta svelte-gdwwx1"> <!></p>'),Vn=u('<p class="ability-meta svelte-gdwwx1">Requires Reaction</p>'),Jn=u('<div class="ability-card svelte-gdwwx1"><div class="ability-header svelte-gdwwx1"><strong class="svelte-gdwwx1"> </strong> <button type="button" class="ability-remove svelte-gdwwx1">√ó</button></div> <p class="ability-description svelte-gdwwx1"> </p> <!></div>'),Yn=u('<div class="abilities-list svelte-gdwwx1"></div>'),Qn=u(`<div class="modal-backdrop svelte-gdwwx1" role="presentation"><div class="modal-content svelte-gdwwx1" role="dialog" aria-modal="true" aria-labelledby="modal-title"><div class="modal-header svelte-gdwwx1"><h3 id="modal-title" class="svelte-gdwwx1">Add Custom Condition</h3> <button class="btn-close svelte-gdwwx1" aria-label="Close">√ó</button></div> <div class="modal-body svelte-gdwwx1"><div class="form-group svelte-gdwwx1"><label for="conditionName" class="svelte-gdwwx1">Condition Name*</label> <input type="text" id="conditionName" placeholder="e.g., Cazna's Mark" class="svelte-gdwwx1"/></div> <div class="form-group svelte-gdwwx1"><label for="description" class="svelte-gdwwx1">Description</label> <textarea id="description" placeholder="Describe the condition..." rows="3" class="svelte-gdwwx1"></textarea></div> <div class="form-row svelte-gdwwx1"><div class="form-group svelte-gdwwx1"><label for="attackBonus" class="svelte-gdwwx1">Attack Bonus</label> <input type="text" id="attackBonus" placeholder="0 or 1d4" class="svelte-gdwwx1"/></div> <div class="form-group svelte-gdwwx1"><label for="damageBonus" class="svelte-gdwwx1">Damage Bonus</label> <input type="text" id="damageBonus" placeholder="0 or 1d6" class="svelte-gdwwx1"/></div> <div class="form-group svelte-gdwwx1"><label for="acBonus" class="svelte-gdwwx1">AC Bonus</label> <input type="number" id="acBonus" placeholder="0" class="svelte-gdwwx1"/></div></div> <div class="form-group svelte-gdwwx1"><label for="darkvision" class="svelte-gdwwx1">Darkvision (feet)</label> <input type="number" id="darkvision" placeholder="0" min="0" step="30" class="svelte-gdwwx1"/> <small class="help-text svelte-gdwwx1">Grant or extend darkvision (e.g., 60 for 60 feet)</small></div> <div class="form-group svelte-gdwwx1"><label class="svelte-gdwwx1">Damage Resistances</label> <div class="resistance-input-group svelte-gdwwx1"><input type="text" placeholder="e.g., cold, fire, poison" class="svelte-gdwwx1"/> <button type="button" class="btn-add svelte-gdwwx1">Add</button></div> <!></div> <div class="form-group svelte-gdwwx1"><label class="svelte-gdwwx1">Special Abilities</label> <div class="ability-form svelte-gdwwx1"><input type="text" placeholder="Ability name (e.g., Flicker of Deceit)" class="ability-name-input svelte-gdwwx1"/> <textarea placeholder="Ability description..." rows="2" class="ability-desc-input svelte-gdwwx1"></textarea> <div class="ability-options svelte-gdwwx1"><div class="ability-option svelte-gdwwx1"><label for="abilityUses" class="svelte-gdwwx1">Uses per rest</label> <input type="number" id="abilityUses" min="0" class="svelte-gdwwx1"/></div> <div class="ability-option svelte-gdwwx1"><label for="restType" class="svelte-gdwwx1">Rest type</label> <select id="restType" class="svelte-gdwwx1"><option>Short</option><option>Long</option></select></div> <div class="ability-option svelte-gdwwx1"><label class="svelte-gdwwx1"><input type="checkbox" class="svelte-gdwwx1"/> Requires Reaction</label></div></div> <button type="button" class="btn-add svelte-gdwwx1">Add Ability</button></div> <!></div></div> <div class="modal-footer svelte-gdwwx1"><button class="btn btn-secondary svelte-gdwwx1">Cancel</button> <button class="btn btn-primary svelte-gdwwx1">Add Condition</button></div></div></div>`);function Xn(i,c){Wt(c,!1);let t=At(c,"show",8,!1),v=At(c,"onSave",8),f=At(c,"onCancel",8),p=D(""),m=D(""),w=D(0),y=D(0),b=D(0),W=D(0),I=D([]),Z=D(""),ee=D([]),V=D(""),E=D(""),j=D(0),B=D("short"),F=D(!1);function pe(){n(p,""),n(m,""),n(w,0),n(y,0),n(b,0),n(W,0),n(I,[]),n(Z,""),n(ee,[]),n(V,""),n(E,""),n(j,0),n(B,"short"),n(F,!1)}function Ee(){e(Z).trim()&&(n(I,[...e(I),e(Z).trim()]),n(Z,""))}function N(h){n(I,e(I).filter((P,Y)=>Y!==h))}function Ie(){if(e(V).trim()&&e(E).trim()){const h={name:e(V).trim(),description:e(E).trim(),requiresReaction:e(F)};e(j)>0&&(h.usesPerRest=e(j),h.currentUses=e(j),h.restType=e(B)),n(ee,[...e(ee),h]),n(V,""),n(E,""),n(j,0),n(B,"short"),n(F,!1)}}function me(h){n(ee,e(ee).filter((P,Y)=>Y!==h))}function be(){if(!e(p).trim()){alert("Please enter a condition name");return}const h={name:e(p).trim(),description:e(m).trim()||"Custom condition",attackBonus:e(w)||0,damageBonus:e(y)||0,target:"self"};e(b)!==0&&(h.acBonus=e(b)),e(W)>0&&(h.darkvision=e(W)),e(I).length>0&&(h.resistances=e(I)),e(ee).length>0&&(h.abilities=e(ee)),v()(h),pe()}function je(){pe(),f()()}function T(h){h.target===h.currentTarget&&je()}zt();var U=bt(),$=we(U);{var X=h=>{var P=Qn(),Y=l(P),ce=l(Y),ve=a(l(ce),2);s(ce);var he=a(ce,2),ge=l(he),Ge=a(l(ge),2);Ce(Ge),s(ge);var Ye=a(ge,2),ct=a(l(Ye),2);ja(ct),s(Ye);var ft=a(Ye,2),it=l(ft),Ve=a(l(it),2);Ce(Ve),s(it);var $t=a(it,2),Dt=a(l($t),2);Ce(Dt),s($t);var S=a($t,2),K=a(l(S),2);Ce(K),s(S),s(ft);var _=a(ft,2),G=a(l(_),2);Ce(G),ta(2),s(_);var Q=a(_,2),re=a(l(Q),2),Le=l(re);Ce(Le);var Se=a(Le,2);s(re);var Re=a(re,2);{var se=oe=>{var A=Wn();xt(A,5,()=>e(I),jt,(z,J,ie)=>{var Te=zn(),Oe=l(Te),Me=a(Oe);s(Te),L(()=>{k(Oe,`${e(J)??""} `),et(Me,"aria-label",`Remove ${e(J)??""}`)}),R("click",Me,()=>N(ie)),o(z,Te)}),s(A),o(oe,A)};g(Re,oe=>{e(I),r(()=>e(I).length>0)&&oe(se)})}s(Q);var C=a(Q,2),te=a(l(C),2),De=l(te);Ce(De);var qe=a(De,2);ja(qe);var Qe=a(qe,2),mt=l(Qe),ye=a(l(mt),2);Ce(ye),s(mt);var ae=a(mt,2),d=a(l(ae),2);L(()=>{e(B),qt(()=>{})});var Ke=l(d);Ke.value=Ke.__value="short";var xe=a(Ke);xe.value=xe.__value="long",s(d),s(ae);var q=a(ae,2),_e=l(q),le=l(_e);Ce(le),ta(),s(_e),s(q),s(Qe);var Be=a(Qe,2);s(te);var ke=a(te,2);{var ze=oe=>{var A=Yn();xt(A,5,()=>e(ee),jt,(z,J,ie)=>{var Te=Jn(),Oe=l(Te),Me=l(Oe),Ae=l(Me,!0);s(Me);var ot=a(Me,2);s(Oe);var pt=a(Oe,2),Fe=l(pt,!0);s(pt);var Pe=a(pt,2);{var wt=ne=>{var Ze=Kn(),ht=l(Ze),M=a(ht);{var $e=x=>{var Ue=Pt("‚Ä¢ Requires Reaction");o(x,Ue)};g(M,x=>{e(J),r(()=>e(J).requiresReaction)&&x($e)})}s(Ze),L(()=>k(ht,`${e(J),r(()=>e(J).usesPerRest)??""} use${e(J),r(()=>e(J).usesPerRest>1?"s":"")??""} per ${e(J),r(()=>e(J).restType)??""}
                      rest `)),o(ne,Ze)},ue=ne=>{var Ze=bt(),ht=we(Ze);{var M=$e=>{var x=Vn();o($e,x)};g(ht,$e=>{e(J),r(()=>e(J).requiresReaction)&&$e(M)},!0)}o(ne,Ze)};g(Pe,ne=>{e(J),r(()=>e(J).usesPerRest)?ne(wt):ne(ue,!1)})}s(Te),L(()=>{k(Ae,(e(J),r(()=>e(J).name))),et(ot,"aria-label",`Remove ${e(J),r(()=>e(J).name)??""}`),k(Fe,(e(J),r(()=>e(J).description)))}),R("click",ot,()=>me(ie)),o(z,Te)}),s(A),o(oe,A)};g(ke,oe=>{e(ee),r(()=>e(ee).length>0)&&oe(ze)})}s(C),s(he);var Ne=a(he,2),Xe=l(Ne),nt=a(Xe,2);s(Ne),s(Y),s(P),R("click",ve,je),He(Ge,()=>e(p),oe=>n(p,oe)),He(ct,()=>e(m),oe=>n(m,oe)),He(Ve,()=>e(w),oe=>n(w,oe)),He(Dt,()=>e(y),oe=>n(y,oe)),He(K,()=>e(b),oe=>n(b,oe)),He(G,()=>e(W),oe=>n(W,oe)),He(Le,()=>e(Z),oe=>n(Z,oe)),R("keydown",Le,oe=>oe.key==="Enter"&&Ee()),R("click",Se,Ee),He(De,()=>e(V),oe=>n(V,oe)),He(qe,()=>e(E),oe=>n(E,oe)),He(ye,()=>e(j),oe=>n(j,oe)),Ha(d,()=>e(B),oe=>n(B,oe)),La(le,()=>e(F),oe=>n(F,oe)),R("click",Be,Ie),R("click",Xe,je),R("click",nt,be),R("click",P,T),o(h,P)};g($,h=>{t()&&h(X)})}o(i,U),Kt()}var Zn=u("<option></option>"),eo=u("<button> </button>"),to=u('<div class="adjustment-msg svelte-uvfntf"> </div>'),ao=u('<div class="calculation-result svelte-uvfntf"><div class="result-header svelte-uvfntf"><h4 class="svelte-uvfntf">Damage Calculation</h4></div> <div class="result-content svelte-uvfntf"><div class="damage-breakdown svelte-uvfntf"><div class="damage-row svelte-uvfntf"><span class="label svelte-uvfntf">Original Damage:</span> <span class="value svelte-uvfntf"> </span></div> <div class="adjustments svelte-uvfntf"></div> <div class="damage-row final svelte-uvfntf"><span class="label svelte-uvfntf">Final Damage:</span> <span class="value damage-value svelte-uvfntf"> </span></div></div></div> <div class="result-actions svelte-uvfntf"><button class="btn btn-primary apply-btn use-enabled svelte-uvfntf">Apply Damage</button> <button class="btn btn-secondary cancel-btn use-enabled svelte-uvfntf">Cancel</button></div></div>'),so=u('<div class="damage-form svelte-uvfntf"><div class="input-group svelte-uvfntf"><div class="input-field svelte-uvfntf"><label for="damageAmount" class="svelte-uvfntf">Damage Amount</label> <input type="number" id="damageAmount" min="0" placeholder="0" class="damage-input-field use-enabled svelte-uvfntf"/></div> <div class="input-field svelte-uvfntf"><label for="damageType" class="svelte-uvfntf">Damage Type</label> <input type="text" id="damageType" list="damageTypes" placeholder="e.g., fire, cold" class="damage-input-field use-enabled svelte-uvfntf"/> <datalist id="damageTypes"></datalist></div></div> <div class="quick-types svelte-uvfntf"><span class="quick-types-label svelte-uvfntf">Quick Select:</span> <!></div> <!></div>'),lo=u("<section><!> <!></section>");function io(i,c){Wt(c,!1);const t=()=>ut(de,"$character",p),v=()=>ut(_a,"$searchFilter",p),f=()=>ut(aa,"$collapsedStates",p),[p,m]=ca(),w=D();$a();let y=D(0),b=D(""),W=D(0),I=D([]);const Z=["slashing","piercing","bludgeoning","fire","cold","lightning","thunder","acid","poison","necrotic","radiant","psychic","force"],ee={slashing:"üó°Ô∏è",piercing:"üèπ",bludgeoning:"üî®",fire:"üî•",cold:"‚ùÑÔ∏è",lightning:"‚ö°",thunder:"üí•",acid:"üß™",poison:"‚ò†Ô∏è",necrotic:"üíÄ",radiant:"‚ú®",psychic:"üß†",force:"üå™Ô∏è"};function V(){de.update(N=>Nl(N,e(W))),Ot.add(`Applied ${e(W)} damage to character (${e(b)})`,"info"),n(y,0),n(b,""),n(W,0),n(I,[])}function E(){n(y,0),n(b,""),n(W,0),n(I,[])}Je(()=>(e(y),e(b),t()),()=>{if(e(y)>=0&&e(b).trim()){const N=Hl(e(y),e(b),t());n(W,N.finalDamage),n(I,N.adjustments)}else n(W,0),n(I,[])}),Je(()=>v(),()=>{n(w,!v()||"damage".includes(v().toLowerCase())||"resistance".includes(v().toLowerCase())||"immune".includes(v().toLowerCase()))}),pa(),zt();var j=lo();let B;var F=l(j);{let N=Ct(()=>(f(),r(()=>f().damageInput?"Expand":"Collapse")));Sa(F,{title:"Apply Damage",get collapsed(){return f(),r(()=>f().damageInput)},get ariaLabel(){return e(N)},onToggle:()=>aa.update(Ie=>({...Ie,damageInput:!Ie.damageInput}))})}var pe=a(F,2);{var Ee=N=>{var Ie=so(),me=l(Ie),be=l(me),je=a(l(be),2);Ce(je),s(be);var T=a(be,2),U=a(l(T),2);Ce(U);var $=a(U,2);xt($,5,()=>Z,jt,(ce,ve)=>{var he=Zn(),ge={};L(()=>{ge!==(ge=e(ve))&&(he.value=(he.__value=e(ve))??"")}),o(ce,he)}),s($),s(T),s(me);var X=a(me,2),h=a(l(X),2);xt(h,1,()=>Z,jt,(ce,ve)=>{var he=eo();let ge;var Ge=l(he);s(he),L(()=>{ge=Mt(he,1,"quick-type-btn use-enabled svelte-uvfntf",null,ge,{active:e(b)===e(ve)}),k(Ge,`${e(ve),r(()=>ee[e(ve)])??""} ${e(ve)??""}`)}),R("click",he,()=>n(b,e(ve))),o(ce,he)}),s(X);var P=a(X,2);{var Y=ce=>{var ve=ao(),he=a(l(ve),2),ge=l(he),Ge=l(ge),Ye=a(l(Ge),2),ct=l(Ye);s(Ye),s(Ge);var ft=a(Ge,2);xt(ft,5,()=>e(I),jt,(_,G)=>{var Q=to(),re=l(Q,!0);s(Q),L(()=>k(re,e(G))),o(_,Q)}),s(ft);var it=a(ft,2),Ve=a(l(it),2),$t=l(Ve,!0);s(Ve),s(it),s(ge),s(he);var Dt=a(he,2),S=l(Dt),K=a(S,2);s(Dt),s(ve),L(()=>{k(ct,`${e(y)??""} ${e(b),r(()=>ee[e(b)]||"")??""} ${e(b)??""}`),k($t,e(W))}),R("click",S,V),R("click",K,E),o(ce,ve)};g(P,ce=>{e(y),e(b),r(()=>e(y)>=0&&e(b).trim())&&ce(Y)})}s(Ie),He(je,()=>e(y),ce=>n(y,ce)),He(U,()=>e(b),ce=>n(b,ce)),o(N,Ie)};g(pe,N=>{f(),r(()=>!f().damageInput)&&N(Ee)})}s(j),L(()=>B=Mt(j,1,"damage-input svelte-uvfntf",null,B,{hidden:!e(w)})),o(i,j),Kt(),m()}var ro=u('<button class="console-toggle svelte-x96uf"> </button>'),no=u('<div class="no-logs svelte-x96uf">No console messages yet</div>'),oo=u('<div><span class="log-timestamp svelte-x96uf"> </span> <span class="log-type svelte-x96uf"> </span> <span class="log-message svelte-x96uf"> </span></div>'),co=u('<div class="console-content svelte-x96uf"><!></div>'),vo=u('<div><div class="console-header svelte-x96uf"><span class="console-title svelte-x96uf"> </span> <div class="console-controls svelte-x96uf"><button class="control-btn svelte-x96uf"> </button> <button class="control-btn svelte-x96uf">üóëÔ∏è</button> <button class="control-btn svelte-x96uf">‚úï</button></div></div> <!></div>'),uo=u('<div class="console-viewer svelte-x96uf"><!> <!></div>');function fo(i,c){Wt(c,!1);let t=D([]),v=D(!1),f=D(!1);wa(()=>{const V=console.log;console.log=function(...F){p("log",F),V.apply(console,F)};const E=console.error;console.error=function(...F){p("error",F),E.apply(console,F)};const j=console.warn;console.warn=function(...F){p("warn",F),j.apply(console,F)};const B=console.info;return console.info=function(...F){p("info",F),B.apply(console,F)},window.addEventListener("error",F=>{p("error",[`Uncaught Error: ${F.message} at ${F.filename}:${F.lineno}:${F.colno}`])}),window.addEventListener("unhandledrejection",F=>{p("error",[`Unhandled Promise Rejection: ${F.reason}`])}),()=>{console.log=V,console.error=E,console.warn=j,console.info=B}});function p(V,E){const j=E.map(F=>{if(typeof F=="object")try{return JSON.stringify(F,null,2)}catch{return String(F)}return String(F)}).join(" "),B=new Date().toLocaleTimeString();n(t,[...e(t),{type:V,message:j,timestamp:B}]),e(t).length>100&&n(t,e(t).slice(-100))}function m(){n(t,[])}function w(){n(v,!e(v))}function y(){n(f,!e(f))}zt();var b=uo(),W=l(b);{var I=V=>{var E=ro(),j=l(E);s(E),L(()=>k(j,`üêõ Console (${e(t).length??""})`)),R("click",E,w),o(V,E)};g(W,V=>{e(v)||V(I)})}var Z=a(W,2);{var ee=V=>{var E=vo();let j;var B=l(E),F=l(B),pe=l(F);s(F);var Ee=a(F,2),N=l(Ee),Ie=l(N,!0);s(N);var me=a(N,2),be=a(me,2);s(Ee),s(B);var je=a(B,2);{var T=U=>{var $=co(),X=l($);{var h=Y=>{var ce=no();o(Y,ce)},P=Y=>{var ce=bt(),ve=we(ce);xt(ve,1,()=>e(t),jt,(he,ge)=>{var Ge=oo(),Ye=l(Ge),ct=l(Ye,!0);s(Ye);var ft=a(Ye,2),it=l(ft);s(ft);var Ve=a(ft,2),$t=l(Ve,!0);s(Ve),s(Ge),L(Dt=>{Mt(Ge,1,`log-entry ${e(ge).type??""}`,"svelte-x96uf"),k(ct,e(ge).timestamp),k(it,`[${Dt??""}]`),k($t,e(ge).message)},[()=>e(ge).type.toUpperCase()]),o(he,Ge)}),o(Y,ce)};g(X,Y=>{e(t).length===0?Y(h):Y(P,!1)})}s($),o(U,$)};g(je,U=>{e(f)||U(T)})}s(E),L(()=>{j=Mt(E,1,"console-panel svelte-x96uf",null,j,{minimized:e(f)}),k(pe,`üêõ Console Logs (${e(t).length??""})`),k(Ie,e(f)?"‚ñ≤":"‚ñº")}),R("click",N,y),R("click",me,m),R("click",be,w),o(V,E)};g(Z,V=>{e(v)&&V(ee)})}s(b),o(i,b),Kt()}var po=u('<link rel="icon" type="image/png" href="favicon4.png"/> <meta name="viewport" content="width=device-width, initial-scale=1"/>',1),mo=u('<span class="character-name svelte-1uha8ag"> </span>'),go=u("<span> </span>"),bo=u('<div class="spell-slots-header svelte-1uha8ag"></div>'),ho=u("<span> </span><br/>",1),_o=u("<span> </span><br/>",1),yo=u("<span> </span><br/>",1),xo=u("<span> </span><br/>",1),$o=u("<span> </span><br/>",1),wo=u("<span> </span><br/>",1),So=u("<br/><em> <!>)</em>",1),ko=u("<br/><em>(requires reaction)</em>",1),Co=u('<div class="ability-detail"><strong> </strong> <!></div>'),Do=u('<div class="abilities-section"><strong>Abilities:</strong><br/> <!></div>'),Lo=u('<span class="effect-tooltip"><strong> </strong><br/> <br/> <!> <!> <!> <!> <!> <!> <!></span>'),jo=u('<button class="effect-remove-btn svelte-1uha8ag">√ó</button>'),Ao=u('<span class="effect-badge svelte-1uha8ag" tabindex="0"> <!> <!></span>'),Ro=u(`<div class="active-effects-header svelte-1uha8ag"></div> <style>.effect-badge {
              position: relative;
            }
            .effect-tooltip {
              position: absolute;
              top: 120%;
              left: 50%;
              transform: translateX(-50%);
              background: #fff;
              color: #222;
              border: 1px solid #a5b4fc;
              border-radius: 6px;
              padding: 8px 12px;
              font-size: 0.95em;
              box-shadow: 0 2px 8px rgba(0, 0, 0, 0.12);
              z-index: 10;
              min-width: 180px;
              max-width: 300px;
              white-space: normal;
              pointer-events: none;
              opacity: 1;
              transition: opacity 0.15s;
            }

            .abilities-section {
              margin-top: 8px;
              padding-top: 8px;
              border-top: 1px solid #e5e7eb;
            }

            .ability-detail {
              margin-top: 6px;
              padding: 4px;
              background: #f9fafb;
              border-radius: 4px;
              font-size: 0.9em;
            }

            .ability-detail strong {
              color: #6366f1;
            }

            .ability-detail em {
              font-size: 0.85em;
              color: #6b7280;
            }</style>`,1),Bo=u('<div class="rest-menu svelte-1uha8ag"><button class="rest-option svelte-1uha8ag">‚òï Short Rest</button> <button class="rest-option svelte-1uha8ag">üõèÔ∏è Long Rest</button></div>'),To=u('<div class="container svelte-1uha8ag"><header class="svelte-1uha8ag"><div class="header-top svelte-1uha8ag"><div class="header-title svelte-1uha8ag"><div class="title-row svelte-1uha8ag"><h1 class="svelte-1uha8ag">D&D Character Sheet</h1> <!></div> <!> <!></div> <div class="header-right svelte-1uha8ag"><div class="header-controls svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">üé≤</span><span class="btn-text svelte-1uha8ag">Roll Dice</span></button> <div class="rest-button-container svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">üò¥</span><span class="btn-text svelte-1uha8ag">Rest</span></button> <!></div> <button class="btn btn-secondary use-enabled" title="Add custom condition with effects"><span class="btn-icon svelte-1uha8ag">‚ú®</span><span class="btn-text svelte-1uha8ag">Add Condition</span></button> <div class="mode-toggle"><button><span class="btn-icon svelte-1uha8ag"> </span><span class="btn-text svelte-1uha8ag"> </span></button></div></div> <div class="header-search svelte-1uha8ag"><input type="text" placeholder="üîç Search..." class="search-input use-enabled svelte-1uha8ag"/></div></div></div> <div class="header-actions svelte-1uha8ag"><button class="btn btn-mode svelte-1uha8ag">üìö Browse Spells & Feats</button> <button class="btn btn-secondary">Save to Gist</button> <button class="btn btn-secondary">Load from Gist</button> <button class="btn btn-secondary">Export JSON</button> <button class="btn btn-secondary">Import JSON</button> <input type="file" accept=".json" style="display: none;"/></div></header> <main class="svelte-1uha8ag"><!> <!> <!> <!> <!> <!> <!> <!></main></div> <!> <!> <!> <!> <!> <!>',1);function Oo(i,c){Wt(c,!1);const t=()=>ut(de,"$character",p),v=()=>ut(xa,"$isEditMode",p),f=()=>ut(_a,"$searchFilter",p),[p,m]=ca();function w(){const M=[],$e=t().classFeatures.spellSlotsByLevel||{};for(let x=1;x<=9;x++){const Ue=$e[x];if(Ue&&Ue.length>0){const H=Ue.length,Bt=Ue.filter(_t=>_t).length;M.push({level:x,available:H-Bt,total:H})}}return M}let y=D(!1),b=D(!1),W=D(!1),I=D(!1),Z=D("save"),ee=D(void 0),V=D(""),E=D(""),j=D(""),B=D(!1),F=D([]),pe=D("other"),Ee=D(),N=!1,Ie=1,me=D(!1),be=D(null);function je(M){n(be,M)}function T(){n(be,null)}function U(M){n(be,e(be)===M?null:M)}function $(M){de.update($e=>($e.activeStates||($e.activeStates=[]),$e.activeStates=[...$e.activeStates,M],$e)),n(I,!1),Ot.add(`Added condition: ${M.name}`,"success")}function X(){n(I,!1)}function h(){const M=[];de.update(H=>{const Bt=H.hitDice.current;H.hitDice.current=Math.min(H.hitDice.max,H.hitDice.current+Math.max(1,Math.floor(H.hitDice.max/2)));const _t=H.hitDice.current-Bt;if(_t>0&&M.push(`${_t} hit ${_t===1?"die":"dice"}`),H.class){const tt=Ra(H.class,H.level,H.subclass);H.classFeatures.features||(H.classFeatures.features={}),tt.forEach(fe=>{if(fe.resetOn==="short"){const vt=fe.name.replace(/\s+/g,"");if(fe.type==="uses"){const at=typeof fe.maxUses=="function"?fe.maxUses(H.level):fe.maxUses;H.classFeatures.features[vt]=Array(at).fill(!1),M.push(fe.name)}else if(fe.type==="pool"){const at=typeof fe.maxPool=="function"?fe.maxPool(H.level):fe.maxPool;at!==void 0&&(H.classFeatures.features[vt]=at,M.push(fe.name))}}})}return H.activeStates&&H.activeStates.forEach(tt=>{tt.abilities&&tt.abilities.forEach(fe=>{if(fe.restType==="short"&&fe.usesPerRest){const vt=fe.usesPerRest-(fe.currentUses||0)>0;fe.currentUses=fe.usesPerRest,vt&&M.push(`${tt.name}: ${fe.name}`)}})}),H}),_s("short"),ys(t().race,t().level).some(H=>H.restType==="short"&&H.usesPerRest)&&M.push("racial traits"),n(me,!1);const Ue=M.length>0?`Short rest taken! Restored: ${M.join(", ")}`:"Short rest taken!";Ot.add(Ue,"success")}function P(){const M=[];de.update(H=>{const Bt=H.maxHP-H.currentHP;Bt>0&&M.push(`${Bt} HP`),H.currentHP=H.maxHP,H.tempHP=0;const _t=H.hitDice.max-H.hitDice.current;_t>0&&M.push(`${_t} hit ${_t===1?"die":"dice"}`),H.hitDice.current=H.hitDice.max;let tt=0;if(H.classFeatures.spellSlotsByLevel&&Object.keys(H.classFeatures.spellSlotsByLevel).forEach(fe=>{const vt=H.classFeatures.spellSlotsByLevel[parseInt(fe)];if(vt){const at=vt.filter(Ft=>Ft).length;tt+=at,H.classFeatures.spellSlotsByLevel[parseInt(fe)]=Array(vt.length).fill(!1)}}),tt>0&&M.push(`${tt} spell ${tt===1?"slot":"slots"}`),H.class){const fe=Ra(H.class,H.level,H.subclass);H.classFeatures.features||(H.classFeatures.features={});let vt=!1;fe.forEach(at=>{const Ft=at.name.replace(/\s+/g,"");if(!(at.type==="info"||at.type==="channelDivinity")){if(at.type==="uses"){const We=typeof at.maxUses=="function"?at.maxUses(H.level):at.maxUses;H.classFeatures.features[Ft]=Array(We).fill(!1),vt=!0}else if(at.type==="pool"){const We=typeof at.maxPool=="function"?at.maxPool(H.level):at.maxPool;We!==void 0&&(H.classFeatures.features[Ft]=We,vt=!0)}}}),vt&&M.push("all class features")}if(H.activeStates){let fe=!1;H.activeStates.forEach(vt=>{vt.abilities&&vt.abilities.forEach(at=>{if(at.usesPerRest){const Ft=(at.currentUses||0)<at.usesPerRest;at.currentUses=at.usesPerRest,Ft&&(fe=!0)}})}),fe&&M.push("condition abilities")}return H}),_s("long"),ys(t().race,t().level).some(H=>H.usesPerRest)&&M.push("racial traits"),n(me,!1);const Ue=M.length>0?`Long rest taken! Restored: ${M.join(", ")}`:"Long rest taken! Fully rested.";Ot.add(Ue,"success")}function Y(M){n(V,""),n(E,""),n(j,""),n(B,!1),n(F,[]),n(pe,"other"),N=!1,typeof M=="string"?n(V,M):(n(V,M.notation),n(E,M.damageNotation||""),n(j,M.attackName||""),n(B,!!M.applyHalfDamage),n(F,M.bonusBreakdown||[]),n(pe,M.rollType||"other")),n(y,!0)}function ce(M){const{notation:$e,count:x,bonusBreakdown:Ue}=M.detail;n(V,""),N=!0,Ie=x||1,setTimeout(()=>{n(V,$e),n(E,""),n(j,"Hit Die"),n(F,Ue||[]),n(pe,"other")},0),n(y,!0)}function ve(){if(n(y,!1),N&&e(Ee)){const M=e(Ee).getLastRollTotal();if(M!==null){const $e=Math.max(1,M);de.update(x=>(x.hitDice.current=Math.max(0,x.hitDice.current-Ie),x.currentHP=Math.min(x.maxHP,x.currentHP+$e),x))}N=!1}}function he(){xa.update(M=>!M)}function ge(M){M.target.closest(".rest-button-container")||n(me,!1)}wa(()=>{const M=xa.subscribe($e=>{$e?document.body.classList.remove("use-mode"):document.body.classList.add("use-mode")});return document.addEventListener("click",ge),()=>{M(),document.removeEventListener("click",ge)}});function Ge(){dl(t())}function Ye(){e(ee)?.click()}async function ct(M){const x=M.target.files?.[0];if(x)try{const Ue=await ul(x);de.set(Ue),alert("Character imported successfully!")}catch{alert("Failed to import character file")}}zt();var ft=To();cl("1uha8ag",M=>{var $e=po();ta(2),Bs(()=>{il.title="D&D Character Sheet"}),o(M,$e)});var it=we(ft),Ve=l(it),$t=l(Ve),Dt=l($t),S=l(Dt),K=a(l(S),2);{var _=M=>{var $e=mo(),x=l($e);s($e),L(()=>k(x,`${t().name??""} (${t().level??""})`)),o(M,$e)};g(K,M=>{t().name&&M(_)})}s(S);var G=a(S,2);{var Q=M=>{var $e=bo();xt($e,5,w,jt,(x,Ue)=>{var H=go();let Bt;var _t=l(H);s(H),L(()=>{Bt=Mt(H,1,"slot-badge svelte-1uha8ag",null,Bt,{depleted:e(Ue).available===0}),k(_t,`Lv${e(Ue).level??""}: ${e(Ue).available??""}/${e(Ue).total??""}`)}),o(x,H)}),s($e),o(M,$e)};g(G,M=>{w().length>0&&M(Q)})}var re=a(G,2);{var Le=M=>{var $e=Ro(),x=we($e);xt(x,5,()=>t().activeStates,jt,(Ue,H,Bt)=>{var _t=Ao(),tt=l(_t),fe=a(tt);{var vt=We=>{var gt=Lo(),yt=l(gt),Ut=l(yt,!0);s(yt);var ia=a(yt,2),St=a(ia,3);{var Rt=lt=>{var dt=ho(),rt=we(dt),Tt=l(rt);s(rt),ta(),L(()=>k(Tt,`Attack Bonus: ${typeof e(H).attackBonus=="number"&&e(H).attackBonus>0?"+":""}${e(H).attackBonus??""}`)),o(lt,dt)};g(St,lt=>{e(H).attackBonus&&lt(Rt)})}var sa=a(St,2);{var ra=lt=>{var dt=_o(),rt=we(dt),Tt=l(rt);s(rt),ta(),L(()=>k(Tt,`Damage Bonus: ${typeof e(H).damageBonus=="number"&&e(H).damageBonus>0?"+":""}${e(H).damageBonus??""}`)),o(lt,dt)};g(sa,lt=>{e(H).damageBonus&&lt(ra)})}var Xt=a(sa,2);{var Lt=lt=>{var dt=yo(),rt=we(dt),Tt=l(rt);s(rt),ta(),L(()=>k(Tt,`AC Bonus: ${e(H).acBonus>0?"+":""}${e(H).acBonus??""}`)),o(lt,dt)};g(Xt,lt=>{e(H).acBonus&&lt(Lt)})}var st=a(Xt,2);{var It=lt=>{var dt=xo(),rt=we(dt),Tt=l(rt);s(rt),ta(),L(()=>k(Tt,`Darkvision: ${e(H).darkvision??""} feet`)),o(lt,dt)};g(st,lt=>{e(H).darkvision&&lt(It)})}var Yt=a(st,2);{var Qt=lt=>{var dt=$o(),rt=we(dt),Tt=l(rt);s(rt),ta(),L(Et=>k(Tt,`Resistances: ${Et??""}`),[()=>e(H).resistances.join(", ")]),o(lt,dt)};g(Yt,lt=>{e(H).resistances&&e(H).resistances.length>0&&lt(Qt)})}var na=a(Yt,2);{var va=lt=>{var dt=wo(),rt=we(dt),Tt=l(rt);s(rt),ta(),L(Et=>k(Tt,`Immunities: ${Et??""}`),[()=>e(H).immunities.join(", ")]),o(lt,dt)};g(na,lt=>{e(H).immunities&&e(H).immunities.length>0&&lt(va)})}var da=a(na,2);{var Vt=lt=>{var dt=Do(),rt=a(l(dt),3);xt(rt,1,()=>e(H).abilities,jt,(Tt,Et)=>{var ua=Co(),Ht=l(ua),la=l(Ht);s(Ht);var Gt=a(Ht),fa=a(Gt);{var ma=Zt=>{var ea=So(),kt=a(we(ea)),Jt=l(kt),ga=a(Jt);{var Ba=Ta=>{var Za=Pt(", requires reaction");o(Ta,Za)};g(ga,Ta=>{e(Et).requiresReaction&&Ta(Ba)})}ta(),s(kt),L(()=>k(Jt,`(${(e(Et).currentUses||0)??""}/${e(Et).usesPerRest??""} uses per ${e(Et).restType??""}
                                rest`)),o(Zt,ea)},ka=Zt=>{var ea=bt(),kt=we(ea);{var Jt=ga=>{var Ba=ko();ta(),o(ga,Ba)};g(kt,ga=>{e(Et).requiresReaction&&ga(Jt)},!0)}o(Zt,ea)};g(fa,Zt=>{e(Et).usesPerRest?Zt(ma):Zt(ka,!1)})}s(ua),L(()=>{k(la,`${e(Et).name??""}:`),k(Gt,` ${e(Et).description??""} `)}),o(Tt,ua)}),s(dt),o(lt,dt)};g(da,lt=>{e(H).abilities&&e(H).abilities.length>0&&lt(Vt)})}s(gt),L(()=>{k(Ut,e(H).name),k(ia,` ${e(H).description??""}`)}),o(We,gt)};g(fe,We=>{e(be)===Bt&&We(vt)})}var at=a(fe,2);{var Ft=We=>{var gt=jo();L(()=>et(gt,"title",`End ${e(H).name??""}`)),R("click",gt,()=>{de.update(yt=>{if(yt.activeStates){const Ut=yt.activeStates[Bt];Ut?.hpBonus&&Ut.target!=="other"&&(yt.maxHP-=Ut.hpBonus,yt.currentHP=Math.max(1,Math.min(yt.currentHP-Ut.hpBonus,yt.maxHP))),yt.activeStates=yt.activeStates.filter((ia,St)=>St!==Bt)}return yt})}),o(We,gt)};g(at,We=>{v()||We(Ft)})}s(_t),L(()=>{et(_t,"aria-label",e(H).name),k(tt,`‚ú® ${e(H).name??""} `)}),R("mouseenter",_t,()=>je(Bt)),R("mouseleave",_t,T),R("focus",_t,()=>je(Bt)),R("blur",_t,T),R("click",_t,()=>U(Bt)),o(Ue,_t)}),s(x),ta(2),o(M,$e)};g(re,M=>{t().activeStates&&t().activeStates.length>0&&M(Le)})}s(Dt);var Se=a(Dt,2),Re=l(Se),se=l(Re),C=a(se,2),te=l(C),De=a(te,2);{var qe=M=>{var $e=Bo(),x=l($e),Ue=a(x,2);s($e),R("click",x,h),R("click",Ue,P),o(M,$e)};g(De,M=>{e(me)&&M(qe)})}s(C);var Qe=a(C,2),mt=a(Qe,2),ye=l(mt);let ae;var d=l(ye),Ke=l(d,!0);s(d);var xe=a(d),q=l(xe,!0);s(xe),s(ye),s(mt),s(Re);var _e=a(Re,2),le=l(_e);Ce(le),s(_e),s(Se),s($t);var Be=a($t,2),ke=l(Be),ze=a(ke,2),Ne=a(ze,2),Xe=a(Ne,2),nt=a(Xe,2),oe=a(nt,2);Ua(oe,M=>n(ee,M),()=>e(ee)),s(Be),s(Ve);var A=a(Ve,2),z=l(A);Rl(z,{});var J=a(z,2);Fl(J,{$$events:{roll:M=>Y(M.detail)}});var ie=a(J,2);ai(ie,{$$events:{roll:M=>Y(M.detail)}});var Te=a(ie,2);Xl(Te,{$$events:{rollHitDice:ce}});var Oe=a(Te,2);io(Oe,{});var Me=a(Oe,2);fr(Me,{$$events:{roll:M=>Y(M.detail)}});var Ae=a(Me,2);Er(Ae,{});var ot=a(Ae,2);Nr(ot,{}),s(A),s(it);var pt=a(it,2);Ua(on(pt,{get notation(){return e(V)},get damageNotation(){return e(E)},get attackName(){return e(j)},get applyHalfDamage(){return e(B)},get bonusBreakdown(){return e(F)},get rollType(){return e(pe)},get visible(){return e(y)},$$events:{close:ve},$$legacy:!0}),M=>n(Ee,M),()=>e(Ee));var Fe=a(pt,2);{var Pe=M=>{Ln(M,{get mode(){return e(Z)},$$events:{close:()=>n(b,!1)}})};g(Fe,M=>{e(b)&&M(Pe)})}var wt=a(Fe,2);{var ue=M=>{qn(M,{onClose:()=>n(W,!1)})};g(wt,M=>{e(W)&&M(ue)})}var ne=a(wt,2);Xn(ne,{get show(){return e(I)},onSave:$,onCancel:X});var Ze=a(ne,2);vl(Ze,{});var ht=a(Ze,2);fo(ht,{}),L(()=>{ae=Mt(ye,1,"btn btn-mode svelte-1uha8ag",null,ae,{"use-mode":!v()}),k(Ke,v()?"üìù":"üé≤"),k(q,v()?"Edit Mode":"Use Mode")}),R("click",se,()=>{n(F,[]),n(y,!0)}),R("click",te,()=>n(me,!e(me))),R("click",Qe,()=>n(I,!0)),R("click",ye,he),He(le,f,M=>fl(_a,M)),R("click",ke,()=>n(W,!0)),R("click",ze,()=>{n(Z,"save"),n(b,!0)}),R("click",Ne,()=>{n(Z,"load"),n(b,!0)}),R("click",Xe,Ge),R("click",nt,Ye),R("change",oe,ct),o(i,ft),Kt(),m()}export{Oo as component};
