import{d as ds,g as Is,f as d,e as j,a as o,s as $,c as bt,t as Mt}from"../chunks/BESELRjb.js";import{i as Ot}from"../chunks/JMgyEzd3.js";import{c as _a,o as $a,a as Es,b as Us}from"../chunks/CtPH092J.js";import{F as S,T as ua,Y as ts,j as Hs,aZ as Ns,U as us,ag as Os,aD as Gs,aK as qs,aE as zs,a1 as Ws,av as Ia,a7 as rs,i as Cs,a_ as Ks,a$ as Ds,b0 as Ga,K as ha,e as Ls,b1 as js,b2 as Vs,b3 as Js,b4 as Ys,q as as,b5 as Qs,b6 as Xs,ab as Zs,d as i,r as os,g as el,C as Gt,G as qt,H as l,I as s,J as a,b7 as et,b8 as ca,s as r,a4 as C,f as e,m as _t,E as Re,b9 as Ht,ao as Qt,A as X,ba as pa,bb as xa,bc as tl}from"../chunks/DyJ43TGI.js";import{t as al,c as Xt,a as be,e as yt,i as kt,u as As,s as ga,b as Bt,d as qa,f as ma,g as sl,j as Nt,k as fs,l as ps,m as ss,n as ll,h as nl,T as il,o as rl,p as ol,r as ms}from"../chunks/t82uA2lk.js";import{i as g,s as ra,a as dt,b as Ft,d as La,e as cl}from"../chunks/CCL4udNy.js";import{p as Ct,b as Ra}from"../chunks/iXw84bXb.js";import{b as ja,r as vl}from"../chunks/BsC1LcYs.js";function dl(n,c,t=!1,v=!1,u=!1){var f=n,p="";S(()=>{var D=Hs;if(p===(p=c()??"")){ua&&ts();return}if(D.nodes_start!==null&&(Ns(D.nodes_start,D.nodes_end),D.nodes_start=D.nodes_end=null),p!==""){if(ua){us.data;for(var _=ts(),h=_;_!==null&&(_.nodeType!==Os||_.data!=="");)h=_,_=Gs(_);if(_===null)throw qs(),zs;ds(us,h),f=Ws(_);return}var K=p+"";t?K=`<svg>${K}</svg>`:v&&(K=`<math>${K}</math>`);var F=Is(K);if((t||v)&&(F=Ia(F)),ds(Ia(F),F.lastChild),t||v)for(;Ia(F);)f.before(Ia(F));else f.before(F)}})}function ul(n,c,t,v,u){ua&&ts();var f=c.$$slots?.[t],p=!1;f===!0&&(f=c[t],p=!0),f===void 0?u!==null&&u(n):f(n,p?()=>v:v)}function fl(n,c,t,v){var u=n.__style;if(ua||u!==c){var f=al(c);(!ua||f!==n.getAttribute("style"))&&(f==null?n.removeAttribute("style"):n.style.cssText=f),n.__style=c}return v}function Oa(n,c,t=!1){if(n.multiple){if(c==null)return;if(!Cs(c))return Ks();for(var v of n.options)v.selected=c.includes(Aa(v));return}for(v of n.options){var u=Aa(v);if(Ds(u,c)){v.selected=!0;return}}(!t||c!==void 0)&&(n.selectedIndex=-1)}function ls(n){var c=new MutationObserver(()=>{Oa(n,n.__value)});c.observe(n,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),rs(()=>{c.disconnect()})}function Ta(n,c,t=c){var v=new WeakSet,u=!0;Ga(n,"change",f=>{var p=f?"[selected]":":checked",D;if(n.multiple)D=[].map.call(n.querySelectorAll(p),Aa);else{var _=n.querySelector(p)??n.querySelector("option:not([disabled])");D=_&&Aa(_)}t(D),ha!==null&&v.add(ha)}),Ls(()=>{var f=c();if(n===document.activeElement){var p=js??ha;if(v.has(p))return}if(Oa(n,f,u),u&&f===void 0){var D=n.querySelector(":checked");D!==null&&(f=Aa(D),t(f))}n.__value=f,u=!1}),ls(n)}function Aa(n){return"__value"in n?n.__value:n.value}const pl=Symbol("is custom element"),ml=Symbol("is html");function Te(n){if(ua){var c=!1,t=()=>{if(!c){if(c=!0,n.hasAttribute("value")){var v=n.value;lt(n,"value",null),n.value=v}if(n.hasAttribute("checked")){var u=n.checked;lt(n,"checked",null),n.checked=u}}};n.__on_r=t,as(t),Qs()}}function Ba(n,c){var t=cs(n);t.value===(t.value=c??void 0)||n.value===c&&(c!==0||n.nodeName!=="PROGRESS")||(n.value=c??"")}function Bs(n,c){var t=cs(n);t.checked!==(t.checked=c??void 0)&&(n.checked=c)}function lt(n,c,t,v){var u=cs(n);ua&&(u[c]=n.getAttribute(c),c==="src"||c==="srcset"||c==="href"&&n.nodeName==="LINK")||u[c]!==(u[c]=t)&&(c==="loading"&&(n[Vs]=t),t==null?n.removeAttribute(c):typeof t!="string"&&gl(n).includes(c)?n[c]=t:n.setAttribute(c,t))}function cs(n){return n.__attributes??={[pl]:n.nodeName.includes("-"),[ml]:n.namespaceURI===Js}}var gs=new Map;function gl(n){var c=n.getAttribute("is")||n.nodeName,t=gs.get(c);if(t)return t;gs.set(c,t=[]);for(var v,u=n,f=Element.prototype;f!==u;){v=Xs(u);for(var p in v)v[p].set&&t.push(p);u=Ys(u)}return t}function Ge(n,c,t=c){var v=new WeakSet;Ga(n,"input",async u=>{var f=u?n.defaultValue:n.value;if(f=Ja(n)?Ya(f):f,t(f),ha!==null&&v.add(ha),await Zs(),f!==(f=c())){var p=n.selectionStart,D=n.selectionEnd,_=n.value.length;if(n.value=f??"",D!==null){var h=n.value.length;p===D&&D===_&&h>_?(n.selectionStart=h,n.selectionEnd=h):(n.selectionStart=p,n.selectionEnd=Math.min(D,h))}}}),(ua&&n.defaultValue!==n.value||i(c)==null&&n.value)&&(t(Ja(n)?Ya(n.value):n.value),ha!==null&&v.add(ha)),os(()=>{var u=c();if(n===document.activeElement){var f=js??ha;if(v.has(f))return}Ja(n)&&u===Ya(n.value)||n.type==="date"&&!u&&!n.value||u!==n.value&&(n.value=u??"")})}const Va=new Set;function bs(n,c,t,v,u=v){var f=t.getAttribute("type")==="checkbox",p=n;let D=!1;if(c!==null)for(var _ of c)p=p[_]??=[];p.push(t),Ga(t,"change",()=>{var h=t.__value;f&&(h=hs(p,h,t.checked)),u(h)},()=>u(f?[]:null)),os(()=>{var h=v();if(ua&&t.defaultChecked!==t.checked){D=!0;return}f?(h=h||[],t.checked=h.includes(t.__value)):t.checked=Ds(t.__value,h)}),rs(()=>{var h=p.indexOf(t);h!==-1&&p.splice(h,1)}),Va.has(p)||(Va.add(p),as(()=>{p.sort((h,K)=>h.compareDocumentPosition(K)===4?-1:1),Va.delete(p)})),as(()=>{if(D){var h;if(f)h=hs(p,h,t.checked);else{var K=p.find(F=>F.checked);h=K?.__value}u(h)}})}function wa(n,c,t=c){Ga(n,"change",v=>{var u=v?n.defaultChecked:n.checked;t(u)}),(ua&&n.defaultChecked!==n.checked||i(c)==null)&&t(n.checked),os(()=>{var v=c();n.checked=!!v})}function hs(n,c,t){for(var v=new Set,u=0;u<n.length;u+=1)n[u].checked&&v.add(n[u].__value);return t||v.delete(c),Array.from(v)}function Ja(n){var c=n.type;return c==="number"||c==="range"}function Ya(n){return n===""?null:+n}function bl(n,c,t){var v=el(n,c);v&&v.set&&(n[c]=t,rs(()=>{n[c]=null}))}function vs(n){return function(...c){var t=c[0];return t.stopPropagation(),n?.apply(this,c)}}function ka(n,c){var t=n.$$events?.[c.type],v=Cs(t)?t.slice():t==null?[]:[t];for(var u of v)u.call(this,c)}const hl="";function Rs(...n){return ja+hl+vl(n[0],n[1])}const ns={paladin:{name:"Paladin",hitDice:"d10",spellcaster:!0,spellcastingAbility:"charisma",spellSlotsByLevel:{1:0,2:2,3:3,4:3,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Divine Sense",type:"uses",maxUses:(n,c=1)=>1+Math.max(1,c),resetOn:"long",description:"Detect celestials, fiends, and undead within 60 feet",minLevel:1},{name:"Lay on Hands",type:"pool",maxPool:n=>n*5,resetOn:"long",description:"Heal wounds or cure disease",minLevel:1},{name:"Divine Smite",type:"spellSlot",description:"Expend spell slot to deal extra radiant damage",minLevel:2,rollable:!0},{name:"Channel Divinity",type:"pool",maxPool:n=>n>=18?3:n>=6?2:1,resetOn:"short",description:"Sacred Weapon or Turn Undead",minLevel:3}]},fighter:{name:"Fighter",hitDice:"d10",spellcaster:!1,features:[{name:"Second Wind",type:"uses",maxUses:1,resetOn:"short",description:"Regain 1d10 + fighter level HP as bonus action",minLevel:1,rollable:!0,rollFormula:n=>`1d10+${n}`},{name:"Action Surge",type:"uses",maxUses:n=>n>=17?2:1,resetOn:"short",description:"Take one additional action on your turn",minLevel:2},{name:"Indomitable",type:"uses",maxUses:n=>n>=17?3:n>=13?2:1,resetOn:"long",description:"Reroll a failed saving throw",minLevel:9}],subclasses:{champion:{name:"Champion",features:[{name:"Improved Critical",type:"info",description:"Critical hit on 19-20",minLevel:3},{name:"Remarkable Athlete",type:"info",description:"Add half proficiency to STR/DEX/CON checks, increase long jump distance",minLevel:7},{name:"Additional Fighting Style",type:"info",description:"Choose a second fighting style",minLevel:10},{name:"Superior Critical",type:"info",description:"Critical hit on 18-20",minLevel:15},{name:"Survivor",type:"info",description:"Regain 5 + CON mod HP at start of turn if below half HP",minLevel:18}]},battlemaster:{name:"Battle Master",features:[{name:"Combat Superiority",type:"uses",maxUses:n=>n>=15?6:n>=7?5:4,resetOn:"short",description:n=>`Use superiority dice (${n>=18?"d12":n>=10?"d10":"d8"}) for maneuvers`,minLevel:3},{name:"Know Your Enemy",type:"info",description:"Learn capabilities of creatures you observe",minLevel:7},{name:"Improved Combat Superiority",type:"info",description:"Superiority dice become d10",minLevel:10},{name:"Relentless",type:"info",description:"Regain 1 superiority die if you have none at start of turn",minLevel:15}]}}},rogue:{name:"Rogue",hitDice:"d8",spellcaster:!1,features:[{name:"Sneak Attack",type:"info",description:n=>`Deal ${Math.ceil(n/2)}d6 extra damage once per turn with advantage or ally nearby`,minLevel:1,rollable:!0,rollFormula:n=>`${Math.ceil(n/2)}d6`},{name:"Cunning Action",type:"info",description:"Dash, Disengage, or Hide as a bonus action",minLevel:2},{name:"Uncanny Dodge",type:"info",description:"Use reaction to halve damage from an attack",minLevel:5},{name:"Evasion",type:"info",description:"Take no damage on successful Dex save (half on fail)",minLevel:7}]},wizard:{name:"Wizard",hitDice:"d6",spellcaster:!0,spellcastingAbility:"intelligence",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Arcane Recovery",type:"uses",maxUses:1,resetOn:"long",description:n=>`Recover spell slots totaling up to ${Math.ceil(n/2)} levels during short rest`,minLevel:1},{name:"Spell Mastery",type:"info",description:"Cast one 1st-level and one 2nd-level spell at will",minLevel:18}]},cleric:{name:"Cleric",hitDice:"d8",spellcaster:!0,spellcastingAbility:"wisdom",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Channel Divinity",type:"pool",maxPool:n=>n>=18?3:n>=6?2:1,resetOn:"short",description:"Turn Undead or domain-specific ability",minLevel:2},{name:"Destroy Undead",type:"info",description:n=>`Channel Divinity destroys undead of CR ${n>=17?4:n>=14?3:n>=11?2:n>=8?1:.5} or lower`,minLevel:5},{name:"Divine Intervention",type:"uses",maxUses:1,resetOn:"long",description:n=>`${n}% chance to succeed, implore deity for aid`,minLevel:10}],subclasses:{war:{name:"War Domain",features:[{name:"War Priest",type:"uses",maxUses:(n,c=1)=>Math.max(1,c),resetOn:"long",description:"Make one weapon attack as a bonus action",minLevel:1},{name:"Guided Strike",type:"channelDivinity",description:"Use your Channel Divinity to gain +10 to an attack roll. Make this choice after you see the roll, but before the DM says whether the attack hits or misses.",minLevel:2,resetOn:"short"},{name:"War God's Blessing",type:"channelDivinity",description:"Use reaction to grant +10 to an ally's attack roll within 30 feet. Consumes one use of Channel Divinity.",minLevel:6,resetOn:"short"},{name:"Divine Strike",type:"info",description:n=>`Deal extra ${n>=14?"2d8":"1d8"} weapon damage once per turn`,minLevel:8,rollable:!0,rollFormula:n=>n>=14?"2d8":"1d8"},{name:"Avatar of Battle",type:"info",description:"Gain resistance to nonmagical weapon damage",minLevel:17}]},life:{name:"Life Domain",features:[{name:"Disciple of Life",type:"info",description:"Healing spells restore additional 2 + spell level HP",minLevel:1},{name:"Preserve Life",type:"pool",maxPool:n=>n*5,resetOn:"short",description:"Restore HP to creatures within 30 feet",minLevel:2},{name:"Blessed Healer",type:"info",description:"Regain 2 + spell level HP when you cast healing spell",minLevel:6},{name:"Divine Strike",type:"info",description:n=>`Deal extra ${n>=14?"2d8":"1d8"} radiant damage once per turn`,minLevel:8,rollable:!0,rollFormula:n=>n>=14?"2d8":"1d8"},{name:"Supreme Healing",type:"info",description:"Maximize healing dice instead of rolling",minLevel:17}]}}},barbarian:{name:"Barbarian",hitDice:"d12",spellcaster:!1,features:[{name:"Rage",type:"uses",maxUses:n=>n>=20?1/0:n>=17?6:n>=12?5:n>=6?4:n>=3?3:2,resetOn:"long",description:n=>`+${n>=16?4:n>=9?3:2} damage, resistance to physical damage`,minLevel:1},{name:"Reckless Attack",type:"info",description:"Gain advantage on melee attacks, enemies get advantage on you",minLevel:2},{name:"Danger Sense",type:"info",description:"Advantage on Dex saves against effects you can see",minLevel:2}],subclasses:{berserker:{name:"Path of the Berserker",features:[{name:"Frenzy",type:"info",description:"While raging, make melee attack as bonus action (gain 1 exhaustion after rage)",minLevel:3},{name:"Mindless Rage",type:"info",description:"Cannot be charmed or frightened while raging",minLevel:6},{name:"Intimidating Presence",type:"info",description:"Use action to frighten creature within 30 feet",minLevel:10},{name:"Retaliation",type:"info",description:"When damaged by creature within 5 feet, make melee attack as reaction",minLevel:14}]}}}};function ia(n){const c=n.toLowerCase();return ns[c]||null}function Sa(n,c,t){const v=ia(n);if(!v)return[];const u=v.features.filter(f=>!f.minLevel||f.minLevel<=c);if(t&&v.subclasses&&v.subclasses[t]){const f=v.subclasses[t].features.filter(p=>!p.minLevel||p.minLevel<=c);return[...u,...f]}return u}function _s(n){const c=ia(n);return!c||!c.subclasses?[]:Object.keys(c.subclasses).map(t=>({id:t,name:c.subclasses[t].name}))}function ys(n,c){const t=ia(n);return!t||!t.spellcaster||!t.spellSlotsByLevel?0:t.spellSlotsByLevel[c]||0}function xs(n,c,t){const v=ia(n);return!v||!v.spellcaster?0:Math.max(1,t+c)}function _l(n,c,t){const v=ia(n);return!v||!v.spellcaster?null:8+c+t}function yl(){return Object.keys(ns).map(n=>({id:n,name:ns[n].name}))}var xl=d('<div class="section-header svelte-ls99y2" role="button" tabindex="0"><h2 class="svelte-ls99y2"> </h2> <span class="collapse-btn svelte-ls99y2"> </span></div>');function ya(n,c){Gt(c,!1);let t=Ct(c,"title",8),v=Ct(c,"collapsed",8),u=Ct(c,"ariaLabel",8,""),f=Ct(c,"onToggle",8);Ot();var p=xl(),D=l(p),_=l(D,!0);s(D);var h=a(D,2),K=l(h,!0);s(h),s(p),S(()=>{lt(p,"aria-expanded",!v()),lt(p,"aria-label",u()),$(_,t()),$(K,v()?"‚ñº":"‚ñ≤")}),j("click",p,function(...F){f()?.apply(this,F)}),j("keydown",p,F=>{(F.key==="Enter"||F.key===" ")&&f()()}),o(n,p),qt()}var $l=d("<option> </option>"),wl=d("<option> </option>"),kl=d('<div class="form-group svelte-172i2fj"><label for="characterSubclass" class="svelte-172i2fj">Subclass</label> <select id="characterSubclass" class="svelte-172i2fj"><option>Select Subclass</option><!></select></div>'),Sl=d('<div class="info-grid svelte-172i2fj"><div class="form-group svelte-172i2fj"><label for="characterName" class="svelte-172i2fj">Character Name</label> <input type="text" id="characterName" placeholder="Enter name" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterClass" class="svelte-172i2fj">Class</label> <select id="characterClass" class="svelte-172i2fj"><option>Select Class</option><!></select></div> <!> <div class="form-group svelte-172i2fj"><label for="characterLevel" class="svelte-172i2fj">Level</label> <input type="number" id="characterLevel" min="1" max="20" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterRace" class="svelte-172i2fj">Race</label> <input type="text" id="characterRace" placeholder="e.g., Human" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterBackground" class="svelte-172i2fj">Background</label> <input type="text" id="characterBackground" placeholder="e.g., Soldier" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterAlignment" class="svelte-172i2fj">Alignment</label> <input type="text" id="characterAlignment" placeholder="e.g., Lawful Good" class="svelte-172i2fj"/></div></div>'),Cl=d('<section class="character-info svelte-172i2fj"><!> <!></section>');function Dl(n,c){Gt(c,!1);const t=()=>dt(be,"$character",u),v=()=>dt(Xt,"$collapsedStates",u),[u,f]=ra(),p=C(),D=yl();function _(q){const T=q.target;be.update(I=>(I.class=T.value,I.subclass="",I))}function h(q){const T=q.target;be.update(I=>(I.subclass=T.value,I))}function K(q){const T=q.target;be.update(I=>(I.level=parseInt(T.value)||1,I)),As()}et(()=>(t(),_s),()=>{r(p,t().class?_s(t().class):[])}),ca(),Ot();var F=Cl(),re=l(F);{let q=_t(()=>(v(),i(()=>v().characterInfo?"Expand":"Collapse")));ya(re,{title:"Character Info",get collapsed(){return v(),i(()=>v().characterInfo)},get ariaLabel(){return e(q)},onToggle:()=>Xt.update(T=>({...T,characterInfo:!T.characterInfo}))})}var te=a(re,2);{var z=q=>{var T=Sl(),I=l(T),M=a(l(I),2);Te(M),s(I);var xe=a(I,2),Qe=a(l(xe),2),Z=l(Qe);Z.value=Z.__value="";var he=a(Z);yt(he,1,()=>D,kt,(ae,de)=>{var ne=$l(),Ce=l(ne,!0);s(ne);var Oe={};S(()=>{$(Ce,(e(de),i(()=>e(de).name))),Oe!==(Oe=(e(de),i(()=>e(de).id)))&&(ne.value=(ne.__value=(e(de),i(()=>e(de).id)))??"")}),o(ae,ne)}),s(Qe);var fe;ls(Qe),s(xe);var _e=a(xe,2);{var Fe=ae=>{var de=kl(),ne=a(l(de),2),Ce=l(ne);Ce.value=Ce.__value="";var Oe=a(Ce);yt(Oe,1,()=>e(p),kt,(mt,ct)=>{var Ve=wl(),k=l(Ve,!0);s(Ve);var H={};S(()=>{$(k,(e(ct),i(()=>e(ct).name))),H!==(H=(e(ct),i(()=>e(ct).id)))&&(Ve.value=(Ve.__value=(e(ct),i(()=>e(ct).id)))??"")}),o(mt,Ve)}),s(ne);var nt;ls(ne),s(de),S(()=>{nt!==(nt=(t(),i(()=>t().subclass)))&&(ne.value=(ne.__value=(t(),i(()=>t().subclass)))??"",Oa(ne,(t(),i(()=>t().subclass))))}),j("change",ne,h),o(ae,de)};g(_e,ae=>{e(p),i(()=>e(p).length>0)&&ae(Fe)})}var B=a(_e,2),P=a(l(B),2);Te(P),s(B);var x=a(B,2),V=a(l(x),2);Te(V),s(x);var b=a(x,2),A=a(l(b),2);Te(A),s(b);var J=a(b,2),Me=a(l(J),2);Te(Me),s(J),s(T),S(()=>{fe!==(fe=(t(),i(()=>t().class)))&&(Qe.value=(Qe.__value=(t(),i(()=>t().class)))??"",Oa(Qe,(t(),i(()=>t().class)))),Ba(P,(t(),i(()=>t().level)))}),Ge(M,()=>t().name,ae=>Ft(be,i(t).name=ae,i(t))),j("change",Qe,_),j("change",P,K),Ge(V,()=>t().race,ae=>Ft(be,i(t).race=ae,i(t))),Ge(A,()=>t().background,ae=>Ft(be,i(t).background=ae,i(t))),Ge(Me,()=>t().alignment,ae=>Ft(be,i(t).alignment=ae,i(t))),o(q,T)};g(te,q=>{v(),i(()=>!v().characterInfo)&&q(z)})}s(F),o(n,F),qt(),f()}var Ll=d('<div class="ability-card svelte-bbv1xt"><h3 class="svelte-bbv1xt"> </h3> <input type="number" class="ability-score svelte-bbv1xt" min="1" max="30"/> <div class="ability-modifier svelte-bbv1xt"> </div> <div class="roll-buttons svelte-bbv1xt"><button class="roll-btn svelte-bbv1xt">Check</button> <button class="roll-btn svelte-bbv1xt">Save</button></div> <div class="save-proficiency svelte-bbv1xt"><input type="checkbox" class="svelte-bbv1xt"/> <label class="svelte-bbv1xt">Save Prof.</label></div></div>'),jl=d('<div class="proficiency-bonus svelte-bbv1xt"><label for="profBonus">Proficiency Bonus</label> <input type="number" id="profBonus" class="prof-input svelte-bbv1xt"/></div> <div class="abilities-grid svelte-bbv1xt"></div>',1),Al=d("<section><!> <!></section>");function Bl(n,c){Gt(c,!1);const t=()=>dt(qa,"$abilityModifiers",D),v=()=>dt(be,"$character",D),u=()=>dt(ga,"$searchFilter",D),f=()=>dt(Xt,"$collapsedStates",D),p=()=>dt(ma,"$isEditMode",D),[D,_]=ra(),h=C(),K=C(),F=_a(),re=[{key:"strength",label:"Strength"},{key:"dexterity",label:"Dexterity"},{key:"constitution",label:"Constitution"},{key:"intelligence",label:"Intelligence"},{key:"wisdom",label:"Wisdom"},{key:"charisma",label:"Charisma"}];function te(){As()}function z(Z){const he=t()[Z],fe=`1d20${he>=0?"+":""}${he}`,_e=[];_e.push({value:"1d20",source:"base die"}),he!==0&&_e.push({value:he,source:Z}),F("roll",{notation:fe,rollType:"check",bonusBreakdown:_e})}function q(Z){const he=t()[Z],fe=v().saveProficiencies[Z]?v().proficiencyBonus:0,_e=he+fe,Fe=`1d20${_e>=0?"+":""}${_e}`,B=[];B.push({value:"1d20",source:"base die"}),he!==0&&B.push({value:he,source:Z}),fe!==0&&B.push({value:fe,source:"proficiency"}),F("roll",{notation:Fe,rollType:"save",bonusBreakdown:B})}et(()=>u(),()=>{r(h,re.filter(({label:Z})=>u()?Z.toLowerCase().includes(u().toLowerCase()):!0))}),et(()=>(e(h),u()),()=>{r(K,e(h).length>0||!u()||u().toLowerCase().includes("proficiency"))}),ca(),Ot();var T=Al();let I;var M=l(T);ya(M,{title:"Ability Scores",get collapsed(){return f(),i(()=>f().abilityScores)},ariaLabel:"Toggle Ability Scores Section",onToggle:()=>Xt.update(Z=>({...Z,abilityScores:!Z.abilityScores}))});var xe=a(M,2);{var Qe=Z=>{var he=jl(),fe=Re(he),_e=a(l(fe),2);Te(_e),s(fe);var Fe=a(fe,2);yt(Fe,5,()=>e(h),kt,(B,P)=>{let x=()=>e(P).key,V=()=>e(P).label;var b=Ll(),A=l(b),J=l(A,!0);s(A);var Me=a(A,2);Te(Me);var ae=a(Me,2),de=l(ae);s(ae);var ne=a(ae,2),Ce=l(ne),Oe=a(Ce,2);s(ne);var nt=a(ne,2),mt=l(nt);Te(mt);var ct=a(mt,2);s(nt),s(b),S(Ve=>{$(J,Ve),$(de,`${t(),x(),i(()=>t()[x()]>=0?"+":"")??""}${t(),x(),i(()=>t()[x()])??""}`),mt.disabled=!p(),lt(mt,"id",`${x()}-save`),lt(ct,"for",`${x()}-save`)},[()=>(V(),i(()=>V().substring(0,3).toUpperCase()))]),Ge(Me,()=>v().abilities[x()],Ve=>Ft(be,i(v).abilities[x()]=Ve,i(v))),j("change",Me,te),j("click",Ce,()=>z(x())),j("click",Oe,()=>q(x())),wa(mt,()=>v().saveProficiencies[x()],Ve=>Ft(be,i(v).saveProficiencies[x()]=Ve,i(v))),o(B,b)}),s(Fe),Ge(_e,()=>v().proficiencyBonus,B=>Ft(be,i(v).proficiencyBonus=B,i(v))),o(Z,he)};g(xe,Z=>{f(),i(()=>!f().abilityScores)&&Z(Qe)})}s(T),S(()=>I=Bt(T,1,"ability-scores svelte-bbv1xt",null,I,{hidden:!e(K)})),o(n,T),qt(),_()}const Ts=[{name:"Unarmored",type:"none",baseAC:10},{name:"Padded",type:"light",baseAC:11},{name:"Leather",type:"light",baseAC:11},{name:"Studded Leather",type:"light",baseAC:12},{name:"Hide",type:"medium",baseAC:12,maxDexBonus:2},{name:"Chain Shirt",type:"medium",baseAC:13,maxDexBonus:2},{name:"Scale Mail",type:"medium",baseAC:14,maxDexBonus:2},{name:"Breastplate",type:"medium",baseAC:14,maxDexBonus:2},{name:"Half Plate",type:"medium",baseAC:15,maxDexBonus:2},{name:"Ring Mail",type:"heavy",baseAC:14,maxDexBonus:0},{name:"Chain Mail",type:"heavy",baseAC:16,maxDexBonus:0},{name:"Splint",type:"heavy",baseAC:17,maxDexBonus:0},{name:"Plate",type:"heavy",baseAC:18,maxDexBonus:0}];function Ms(n){return Ts.find(c=>c.name===n)}function Rl(n,c,t){if(!n)return 10+c+(t?2:0);const v=Ms(n);if(!v)return 10+c+(t?2:0);let u=v.baseAC;return v.maxDexBonus===void 0?u+=c:v.maxDexBonus>0&&(u+=Math.min(c,v.maxDexBonus)),t&&(u+=2),u}function Ma(n){return Math.floor((n-10)/2)}function is(n,c){if(!n.class)return null;const t=ia(n.class);if(!t||!t.spellcaster||!t.spellcastingAbility)return null;const v=Ma(c[t.spellcastingAbility]);return 8+n.proficiencyBonus+v}function Qa(n,c){if(!n.class)return 0;const t=ia(n.class);return!t||!t.spellcaster||!t.spellcastingAbility?0:Ma(c[t.spellcastingAbility])}function Tl(n,c){const t=[],v=Ma(c.dexterity),u=n.armorName?Ms(n.armorName):void 0;if(u){if(u.type==="none")t.push("Unarmored"),t.push("Base: 10"),t.push(`Dexterity: ${v>=0?"+":""}${v}`);else if(u.type==="light")t.push(`${u.name}: ${u.baseAC}`),t.push(`Dexterity: ${v>=0?"+":""}${v}`);else if(u.type==="medium"){const f=Math.min(2,v);t.push(`${u.name}: ${u.baseAC}`),t.push(`Dexterity: ${f>=0?"+":""}${f} (max +2)`)}else u.type==="heavy"&&(t.push(`${u.name}: ${u.baseAC}`),t.push("Dexterity: +0 (heavy armor)"));n.shieldEquipped&&t.push("Shield: +2")}else{t.push("Base: 10"),v!==0&&t.push(`Dexterity: ${v>=0?"+":""}${v}`);const f=10+v,p=n.armorClass-f;p!==0&&t.push(`Other: ${p>=0?"+":""}${p}`)}return n.activeStates&&n.activeStates.length>0&&n.activeStates.forEach(f=>{typeof f.acBonus=="number"&&f.acBonus!==0&&(!f.target||f.target==="self")&&t.push(`${f.name}: ${f.acBonus>=0?"+":""}${f.acBonus}`)}),t.join(`
`)}function Ml(n,c){const t=[],v=Ma(c.dexterity);t.push(`Dexterity: ${v>=0?"+":""}${v}`);const u=n.initiative-v;return u!==0&&t.push(`Other Bonuses: ${u>=0?"+":""}${u}`),t.join(`
`)}function Fl(n,c){if(!n.class)return"";const t=ia(n.class);if(!t||!t.spellcaster||!t.spellcastingAbility)return"";const v=[],u=Ma(c[t.spellcastingAbility]),f=t.spellcastingAbility.charAt(0).toUpperCase()+t.spellcastingAbility.slice(1);return v.push("Base: 8"),v.push(`Proficiency: +${n.proficiencyBonus}`),v.push(`${f}: ${u>=0?"+":""}${u}`),v.join(`
`)}function Pl(n,c,t){const v=[];let u=n;const f=c.toLowerCase().trim();if(t.activeStates){for(const p of t.activeStates)if(p.immunities&&p.immunities.length>0&&p.immunities.some(_=>_.toLowerCase().trim()===f))return v.push(`Immune to ${c} (${p.name})`),{finalDamage:0,adjustments:v}}if(t.activeStates){for(const p of t.activeStates)if(p.resistances&&p.resistances.length>0&&p.resistances.some(_=>_.toLowerCase().trim()===f)){const _=Math.floor(u/2);v.push(`Resistant to ${c} (${p.name}): ${u} ‚Üí ${_}`),u=_;break}}return v.length===0&&v.push(`No adjustments for ${c}`),{finalDamage:u,adjustments:v}}function Il(n,c){const t={...n};if(t.tempHP>0){if(c<=t.tempHP)return t.tempHP-=c,t;c-=t.tempHP,t.tempHP=0}return t.currentHP=Math.max(0,t.currentHP-c),t}var El=d('<button class="info-icon svelte-1o8ci7b" type="button">‚ÑπÔ∏è</button>'),Ul=d('<button class="info-icon svelte-1o8ci7b" type="button">‚ÑπÔ∏è</button>'),Hl=d("<div><!></div>"),Nl=d('<div class="tooltip-wrapper svelte-1o8ci7b"><!> <!></div>');function Xa(n,c){Gt(c,!1);let t=Ct(c,"tooltipContent",8),v=Ct(c,"ariaLabel",8,"Show information"),u=C(!1),f=C(),p=C(!1),D=C(null),_=C(!1),h=C(!1),K=C("");const F=Math.random().toString(36).slice(2);function re(){window.dispatchEvent(new CustomEvent("tooltip-open",{detail:F}))}function te(B){B.detail!==F&&(r(u,!1),r(_,!1))}function z(){r(p,window.matchMedia("(pointer: coarse)").matches||"ontouchstart"in window)}function q(){if(!e(D)||!e(f))return;const B=e(f).getBoundingClientRect(),P=e(D).getBoundingClientRect();let x=B.bottom+5,V=B.left;r(_,!1),V+P.width>window.innerWidth-8&&(V=B.right-P.width,r(_,!0),V<8&&(V=8)),V<8&&(V=8),x+P.height>window.innerHeight-8&&(x=B.top-P.height-5),r(K,`position:fixed;top:${x}px;left:${V}px;z-index:1000;`),r(h,!0)}function T(){re(),r(u,!1),r(h,!1),requestAnimationFrame(()=>{r(u,!0),r(h,!1),setTimeout(q,0)})}function I(){r(u,!1),r(_,!1)}function M(B){B.stopPropagation(),e(u)?(r(u,!1),r(_,!1),r(h,!1)):(re(),r(u,!1),r(h,!1),requestAnimationFrame(()=>{r(u,!0),r(h,!1),setTimeout(q,0)}))}function xe(B){e(f)&&!e(f).contains(B.target)&&(r(u,!1),r(_,!1))}$a(()=>{z(),document.addEventListener("click",xe),window.addEventListener("tooltip-open",te)}),Es(()=>{document.removeEventListener("click",xe),window.removeEventListener("tooltip-open",te)}),Ot();var Qe=Nl(),Z=l(Qe);{var he=B=>{var P=El();S(()=>lt(P,"aria-label",v())),j("click",P,M),o(B,P)},fe=B=>{var P=Ul();S(()=>lt(P,"aria-label",v())),j("mouseenter",P,T),j("mouseleave",P,I),o(B,P)};g(Z,B=>{e(p)?B(he):B(fe,!1)})}var _e=a(Z,2);{var Fe=B=>{var P=Hl(),x=l(P);ul(x,c,"content",{},V=>{var b=bt(),A=Re(b);dl(A,t),o(V,b)}),s(P),Ra(P,V=>r(D,V),()=>e(D)),S(()=>{Bt(P,1,`tooltip-popup ${e(_)?"right-align":""}`,"svelte-1o8ci7b"),fl(P,e(h)?e(K)+"opacity:1;pointer-events:auto;":"opacity:0;pointer-events:none;position:fixed;top:0;left:0;z-index:1000;")}),o(B,P)};g(_e,B=>{e(u)&&B(Fe)})}s(Qe),Ra(Qe,B=>r(f,B),()=>e(f)),o(n,Qe),qt()}var Ol=d("<option> </option>"),Gl=d('<div class="armor-config svelte-1r5hyyb"><h4 class="svelte-1r5hyyb">Armor Configuration</h4> <div class="armor-controls svelte-1r5hyyb"><div class="armor-field svelte-1r5hyyb"><label for="armorName" class="svelte-1r5hyyb">Armor</label> <select id="armorName" class="armor-select svelte-1r5hyyb"><option>None (Unarmored)</option><!></select></div> <div class="armor-field svelte-1r5hyyb"><label class="shield-label svelte-1r5hyyb"><input type="checkbox" class="shield-checkbox svelte-1r5hyyb"/> Shield Equipped (+2 AC)</label></div></div></div>'),ql=d('<div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="spellSaveDC" class="svelte-1r5hyyb">Spell Save DC</label> <!></div> <input type="number" id="spellSaveDC" class="stat-input svelte-1r5hyyb" readonly=""/></div>'),zl=d('<span class="hit-dice-type"> </span>'),Wl=d('<!> <div class="stats-grid svelte-1r5hyyb"><div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="armorClass" class="svelte-1r5hyyb">Armor Class</label> <!></div> <input type="text" id="armorClass" readonly=""/></div> <div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="initiative" class="svelte-1r5hyyb">Initiative</label> <!></div> <input type="text" id="initiative" class="stat-input svelte-1r5hyyb" readonly=""/></div> <div class="stat-box svelte-1r5hyyb"><label for="speed" class="svelte-1r5hyyb">Speed</label> <input type="text" id="speed" class="stat-input svelte-1r5hyyb"/></div> <!></div> <div class="hp-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Points</h3> <div><div class="hp-inputs svelte-1r5hyyb"><input type="number" class="hp-current svelte-1r5hyyb" min="0"/> <span class="hp-separator svelte-1r5hyyb">/</span> <input type="number" class="hp-max svelte-1r5hyyb" min="0"/></div> <div class="hp-controls svelte-1r5hyyb"><button class="hp-btn svelte-1r5hyyb">‚àí</button> <button class="hp-btn svelte-1r5hyyb">+</button> <button class="hp-btn svelte-1r5hyyb">‚àí5</button> <button class="hp-btn svelte-1r5hyyb">+5</button></div></div> <div class="temp-hp svelte-1r5hyyb"><label for="tempHP" class="svelte-1r5hyyb">Temp HP</label> <input type="number" id="tempHP" min="0" class="svelte-1r5hyyb"/></div></div> <div class="hit-dice-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Dice</h3> <div class="hit-dice-display svelte-1r5hyyb"><input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <span>/</span> <input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <!></div> <div class="hit-dice-controls svelte-1r5hyyb"><label for="hitDiceCount" class="svelte-1r5hyyb">Roll</label> <div class="hit-dice-count-controls svelte-1r5hyyb"><button class="hit-dice-btn svelte-1r5hyyb">‚àí</button> <input type="number" id="hitDiceCount" class="hit-dice-count-input svelte-1r5hyyb" min="1"/> <button class="hit-dice-btn svelte-1r5hyyb">+</button></div> <button class="btn btn-primary roll-hit-dice use-enabled svelte-1r5hyyb">üé≤ Roll</button></div></div>',1),Kl=d("<section><!> <!></section>");function Vl(n,c){Gt(c,!1);const t=()=>dt(be,"$character",D),v=()=>dt(qa,"$abilityModifiers",D),u=()=>dt(ga,"$searchFilter",D),f=()=>dt(Xt,"$collapsedStates",D),p=()=>dt(ma,"$isEditMode",D),[D,_]=ra(),h=C(),K=C(),F=C(),re=C(),te=C(),z=C(),q=C(),T=_a();let I=C(1);function M(B){be.update(P=>(P.currentHP=Math.max(0,Math.min(P.maxHP,P.currentHP+B)),P))}function xe(B){const P=e(I)+B,x=t().hitDice.current;r(I,Math.max(1,Math.min(x,P)))}function Qe(B=1){if(t().hitDice.current<=0){alert("No hit dice remaining!");return}if(!t().class){alert("Please select a class first!");return}const P=ia(t().class);if(!P){alert("Invalid class configuration!");return}const x=Math.min(B,t().hitDice.current),V=P.hitDice,b=v().constitution,A=b*x,J=A>=0?`+${A}`:`${A}`,Me=`${x}${V}${J}`,ae=[];if(ae.push({value:`${x}${V}`,source:"hit dice"}),b!==0)for(let de=0;de<x;de++)ae.push({value:b,source:"constitution"});T("rollHitDice",{notation:Me,hitDie:V,count:x,bonusBreakdown:ae})}et(()=>(t(),v(),be),()=>{if(t().armorName!==void 0||t().shieldEquipped!==void 0){const B=v().dexterity,P=Rl(t().armorName,B,t().shieldEquipped||!1);t().armorClass!==P&&be.update(x=>({...x,armorClass:P}))}}),et(()=>(v(),t(),be),()=>{const B=v().dexterity;t().initiative!==B&&be.update(P=>({...P,initiative:B}))}),et(()=>t(),()=>{r(h,is(t(),t().abilities))}),et(()=>t(),()=>{r(K,Tl(t(),t().abilities))}),et(()=>t(),()=>{r(F,Ml(t(),t().abilities))}),et(()=>t(),()=>{r(re,Fl(t(),t().abilities))}),et(()=>(t(),e(I)),()=>{const B=t().hitDice.current;B>0&&e(I)>B&&r(I,B)}),et(()=>t(),()=>{r(te,t().activeStates&&t().activeStates.length>0?t().activeStates.reduce((B,P)=>B+(P.acBonus||0),0):0)}),et(()=>t(),()=>{r(z,t().activeStates&&t().activeStates.length>0?t().activeStates.some(B=>B.name==="Aid"&&B.target==="self"):!1)}),et(()=>u(),()=>{r(q,!u()||"armor class".includes(u().toLowerCase())||"initiative".includes(u().toLowerCase())||"speed".includes(u().toLowerCase())||"hit points".includes(u().toLowerCase())||"hp".includes(u().toLowerCase())||"hit dice".includes(u().toLowerCase())||"spell save".includes(u().toLowerCase())||"combat".includes(u().toLowerCase()))}),ca(),Ot();var Z=Kl();let he;var fe=l(Z);{let B=_t(()=>(f(),i(()=>f().combatStats?"Expand":"Collapse")));ya(fe,{title:"Combat Stats",get collapsed(){return f(),i(()=>f().combatStats)},get ariaLabel(){return e(B)},onToggle:()=>Xt.update(P=>({...P,combatStats:!P.combatStats}))})}var _e=a(fe,2);{var Fe=B=>{var P=Wl(),x=Re(P);{var V=ve=>{var Ee=Gl(),we=a(l(Ee),2),Xe=l(we),qe=a(l(Xe),2);S(()=>{t(),Ht(()=>{})});var ot=l(qe);ot.value=(ot.__value=void 0)??"";var vt=a(ot);yt(vt,1,()=>Ts,kt,(Q,Y)=>{var je=bt(),ze=Re(je);{var tt=We=>{var Ye=Ol(),me=l(Ye);s(Ye);var W={};S(()=>{$(me,`${e(Y),i(()=>e(Y).name)??""} (AC ${e(Y),i(()=>e(Y).baseAC)??""})`),W!==(W=(e(Y),i(()=>e(Y).name)))&&(Ye.value=(Ye.__value=(e(Y),i(()=>e(Y).name)))??"")}),o(We,Ye)};g(ze,We=>{e(Y),i(()=>e(Y).name!=="Unarmored")&&We(tt)})}o(Q,je)}),s(qe),s(Xe);var ue=a(Xe,2),L=l(ue),O=l(L);Te(O),Qt(),s(L),s(ue),s(we),s(Ee),Ta(qe,()=>t().armorName,Q=>Ft(be,i(t).armorName=Q,i(t))),wa(O,()=>t().shieldEquipped,Q=>Ft(be,i(t).shieldEquipped=Q,i(t))),o(ve,Ee)};g(x,ve=>{p()&&ve(V)})}var b=a(x,2),A=l(b),J=l(A),Me=a(l(J),2);Xa(Me,{get tooltipContent(){return e(K)},ariaLabel:"Show AC breakdown"}),s(J);var ae=a(J,2);Te(ae),s(A);var de=a(A,2),ne=l(de),Ce=a(l(ne),2);Xa(Ce,{get tooltipContent(){return e(F)},ariaLabel:"Show Initiative breakdown"}),s(ne);var Oe=a(ne,2);Te(Oe),s(de);var nt=a(de,2),mt=a(l(nt),2);Te(mt),s(nt);var ct=a(nt,2);{var Ve=ve=>{var Ee=ql(),we=l(Ee),Xe=a(l(we),2);Xa(Xe,{get tooltipContent(){return e(re)},ariaLabel:"Show Spell Save DC breakdown"}),s(we);var qe=a(we,2);Te(qe),s(Ee),S(()=>Ba(qe,e(h))),o(ve,Ee)};g(ct,ve=>{e(h)!==null&&ve(Ve)})}s(b);var k=a(b,2),H=a(l(k),2);let $e;var Se=l(H),y=l(Se);Te(y);var N=a(y,4);Te(N),s(Se);var ie=a(Se,2),ye=l(ie),le=a(ye,2),ge=a(le,2),ce=a(ge,2);s(ie),s(H);var U=a(H,2),w=a(l(U),2);Te(w),s(U),s(k);var Ae=a(k,2),De=a(l(Ae),2),Je=l(De);Te(Je);var Le=a(Je,4);Te(Le);var m=a(Le,2);{var pe=ve=>{const Ee=_t(()=>(X(ia),t(),i(()=>ia(t().class))));var we=bt(),Xe=Re(we);{var qe=ot=>{const vt=_t(()=>(v(),i(()=>v().constitution)));var ue=zl(),L=l(ue);s(ue),S(()=>$(L,`(${X(e(Ee)),i(()=>e(Ee).hitDice)??""}${(e(vt)>=0?`+${e(vt)}`:e(vt))??""})`)),o(ot,ue)};g(Xe,ot=>{e(Ee)&&ot(qe)})}o(ve,we)};g(m,ve=>{t(),i(()=>t().class)&&ve(pe)})}s(De);var oe=a(De,2),G=a(l(oe),2),Pe=l(G),Ie=a(Pe,2);Te(Ie);var Be=a(Ie,2);s(G);var Ue=a(G,2);s(oe),s(Ae),S(()=>{Ba(ae,(e(te),t(),i(()=>e(te)!==0?`${t().armorClass} ‚Üí ${t().armorClass+e(te)}`:`${t().armorClass}`))),Bt(ae,1,sl(e(te)!==0?"stat-input ac-enhanced":"stat-input"),"svelte-1r5hyyb"),Ba(Oe,(t(),i(()=>t().initiative))),$e=Bt(H,1,"hp-display svelte-1r5hyyb",null,$e,{"aid-active":e(z)}),lt(y,"max",(t(),i(()=>t().maxHP))),lt(Je,"max",(t(),i(()=>t().hitDice.max))),Pe.disabled=e(I)<=1,lt(Ie,"max",(t(),i(()=>t().hitDice.current))),Be.disabled=(e(I),t(),i(()=>e(I)>=t().hitDice.current)),Ue.disabled=(t(),i(()=>t().hitDice.current<=0||!t().class))}),Ge(mt,()=>t().speed,ve=>Ft(be,i(t).speed=ve,i(t))),Ge(y,()=>t().currentHP,ve=>Ft(be,i(t).currentHP=ve,i(t))),Ge(N,()=>t().maxHP,ve=>Ft(be,i(t).maxHP=ve,i(t))),j("click",ye,()=>M(-1)),j("click",le,()=>M(1)),j("click",ge,()=>M(-5)),j("click",ce,()=>M(5)),Ge(w,()=>t().tempHP,ve=>Ft(be,i(t).tempHP=ve,i(t))),Ge(Je,()=>t().hitDice.current,ve=>Ft(be,i(t).hitDice.current=ve,i(t))),Ge(Le,()=>t().hitDice.max,ve=>Ft(be,i(t).hitDice.max=ve,i(t))),j("click",Pe,()=>xe(-1)),Ge(Ie,()=>e(I),ve=>r(I,ve)),j("input",Ie,ve=>{const Ee=ve.target,we=parseInt(Ee.value);we>t().hitDice.current&&r(I,t().hitDice.current),we<1&&r(I,1)}),j("click",Be,()=>xe(1)),j("click",Ue,()=>Qe(e(I))),o(B,P)};g(_e,B=>{f(),i(()=>!f().combatStats)&&B(Fe)})}s(Z),S(()=>he=Bt(Z,1,"combat-stats svelte-1r5hyyb",null,he,{hidden:!e(q)})),o(n,Z),qt(),_()}const Ea={acrobatics:"dexterity",animalHandling:"wisdom",arcana:"intelligence",athletics:"strength",deception:"charisma",history:"intelligence",insight:"wisdom",intimidation:"charisma",investigation:"intelligence",medicine:"wisdom",nature:"intelligence",perception:"wisdom",performance:"charisma",persuasion:"charisma",religion:"intelligence",sleightOfHand:"dexterity",stealth:"dexterity",survival:"wisdom"};var Jl=d('<div class="skill-row svelte-1f1pl16"><input type="checkbox" class="svelte-1f1pl16"/> <label class="svelte-1f1pl16"> <span class="ability-tag svelte-1f1pl16"> </span></label> <span class="skill-modifier svelte-1f1pl16"> </span> <button class="roll-btn svelte-1f1pl16">Roll</button></div>'),Yl=d('<div class="skills-grid svelte-1f1pl16"></div>'),Ql=d("<section><!> <!></section>");function Xl(n,c){Gt(c,!1);const t=()=>dt(be,"$character",D),v=()=>dt(qa,"$abilityModifiers",D),u=()=>dt(ga,"$searchFilter",D),f=()=>dt(Xt,"$collapsedStates",D),p=()=>dt(ma,"$isEditMode",D),[D,_]=ra(),h=C(),K=C(),F=C(),re=C(),te=C(),z=C(),q=_a(),T=[{key:"acrobatics",label:"Acrobatics"},{key:"animalHandling",label:"Animal Handling"},{key:"arcana",label:"Arcana"},{key:"athletics",label:"Athletics"},{key:"deception",label:"Deception"},{key:"history",label:"History"},{key:"insight",label:"Insight"},{key:"intimidation",label:"Intimidation"},{key:"investigation",label:"Investigation"},{key:"medicine",label:"Medicine"},{key:"nature",label:"Nature"},{key:"perception",label:"Perception"},{key:"performance",label:"Performance"},{key:"persuasion",label:"Persuasion"},{key:"religion",label:"Religion"},{key:"sleightOfHand",label:"Sleight of Hand"},{key:"stealth",label:"Stealth"},{key:"survival",label:"Survival"}];function I(fe){const _e=Ea[fe],Fe=v()[_e],B=t().skillProficiencies[fe]?t().proficiencyBonus:0,P=e(h)[fe],x=`1d20${P>=0?"+":""}${P}`,V=[];V.push({value:"1d20",source:"base die"}),Fe!==0&&V.push({value:Fe,source:_e}),B!==0&&V.push({value:B,source:"proficiency"}),q("roll",{notation:x,rollType:"check",bonusBreakdown:V})}et(()=>{},()=>{r(h,{})}),et(()=>t(),()=>{r(K,t().skillProficiencies)}),et(()=>t(),()=>{r(F,t().proficiencyBonus)}),et(()=>v(),()=>{r(re,v())}),et(()=>(e(re),e(K),e(F)),()=>{for(const{key:fe}of T){const _e=Ea[fe],Fe=e(re)[_e],B=e(K)[fe]?e(F):0;pa(h,e(h)[fe]=Fe+B)}}),et(()=>u(),()=>{r(te,T.filter(({label:fe})=>u()?fe.toLowerCase().includes(u().toLowerCase()):!0))}),et(()=>e(te),()=>{r(z,e(te).length>0)}),ca(),Ot();var M=Ql();let xe;var Qe=l(M);{let fe=_t(()=>(f(),i(()=>f().skills?"Expand":"Collapse")));ya(Qe,{title:"Skills",get collapsed(){return f(),i(()=>f().skills)},get ariaLabel(){return e(fe)},onToggle:()=>Xt.update(_e=>({..._e,skills:!_e.skills}))})}var Z=a(Qe,2);{var he=fe=>{var _e=Yl();yt(_e,5,()=>e(te),kt,(Fe,B)=>{let P=()=>e(B).key,x=()=>e(B).label;var V=Jl(),b=l(V);Te(b);var A=a(b,2),J=l(A),Me=a(J),ae=l(Me);s(Me),s(A);var de=a(A,2),ne=l(de);s(de);var Ce=a(de,2);s(V),S(Oe=>{Bs(b,(e(K),P(),i(()=>e(K)[P()]))),b.disabled=!p(),lt(b,"id",P()),lt(A,"for",P()),$(J,`${x()??""} `),$(ae,`(${Oe??""})`),$(ne,`${e(h),P(),i(()=>e(h)[P()]>=0?"+":"")??""}${e(h),P(),i(()=>e(h)[P()])??""}`)},[()=>(X(Ea),P(),i(()=>Ea[P()].substring(0,3).toUpperCase()))]),j("change",b,Oe=>{console.log("Skill proficiency changed:",P(),Oe.target.checked),be.update(nt=>({...nt,skillProficiencies:{...nt.skillProficiencies,[P()]:Oe.target.checked}}))}),j("click",Ce,()=>I(P())),o(Fe,V)}),s(_e),o(fe,_e)};g(Z,fe=>{f(),i(()=>!f().skills)&&fe(he)})}s(M),S(()=>xe=Bt(M,1,"skills svelte-1f1pl16",null,xe,{hidden:!e(z)})),o(n,M),qt(),_()}var Zl=d('<p class="empty-message svelte-1123ljy">No attacks or spells to reorder.</p>'),en=d('<li class="reorder-item svelte-1123ljy"><span class="attack-name svelte-1123ljy"> </span> <div class="reorder-buttons svelte-1123ljy"><button class="btn-move svelte-1123ljy" aria-label="Move up">‚ñ≤</button> <button class="btn-move svelte-1123ljy" aria-label="Move down">‚ñº</button></div></li>'),tn=d('<ul class="reorder-list svelte-1123ljy"></ul>'),an=d('<div class="modal-backdrop svelte-1123ljy" role="presentation"><div class="modal-content svelte-1123ljy" role="dialog" aria-modal="true" aria-labelledby="modal-title"><div class="modal-header svelte-1123ljy"><h3 id="modal-title" class="svelte-1123ljy">Reorder Attacks & Spells</h3> <button class="btn-close svelte-1123ljy" aria-label="Close">√ó</button></div> <div class="modal-body svelte-1123ljy"><!></div> <div class="modal-footer svelte-1123ljy"><button class="btn btn-secondary svelte-1123ljy">Cancel</button> <button class="btn btn-primary svelte-1123ljy">Save Order</button></div></div></div>');function sn(n,c){Gt(c,!1);let t=Ct(c,"show",8,!1),v=Ct(c,"attacks",24,()=>[]),u=Ct(c,"onSave",8),f=Ct(c,"onCancel",8),p=C([]);function D(T,I){const M=e(p)[T];pa(p,e(p)[T]=e(p)[I]),pa(p,e(p)[I]=M),r(p,[...e(p)])}function _(T){T>0&&D(T,T-1)}function h(T){T<e(p).length-1&&D(T,T+1)}function K(){u()(e(p))}function F(){f()()}function re(T){T.target===T.currentTarget&&F()}et(()=>(X(t()),X(v())),()=>{t()&&r(p,[...v()])}),ca(),Ot();var te=bt(),z=Re(te);{var q=T=>{var I=an(),M=l(I),xe=l(M),Qe=a(l(xe),2);s(xe);var Z=a(xe,2),he=l(Z);{var fe=x=>{var V=Zl();o(x,V)},_e=x=>{var V=tn();yt(V,7,()=>e(p),b=>b.id,(b,A,J)=>{var Me=en(),ae=l(Me),de=l(ae,!0);s(ae);var ne=a(ae,2),Ce=l(ne),Oe=a(Ce,2);s(ne),s(Me),S(()=>{$(de,(e(A),i(()=>e(A).name||"(Unnamed attack or spell)"))),Ce.disabled=e(J)===0,Oe.disabled=(X(e(J)),e(p),i(()=>e(J)===e(p).length-1))}),j("click",Ce,()=>_(e(J))),j("click",Oe,()=>h(e(J))),o(b,Me)}),s(V),o(x,V)};g(he,x=>{e(p),i(()=>e(p).length===0)?x(fe):x(_e,!1)})}s(Z);var Fe=a(Z,2),B=l(Fe),P=a(B,2);s(Fe),s(M),s(I),j("click",Qe,F),j("click",B,F),j("click",P,K),j("click",I,re),o(T,I)};g(z,T=>{t()&&T(q)})}o(n,te),qt()}let Ua=null,Ha=null;async function Fs(){if(Ua)return Ua;try{return Ua=await(await fetch(Rs("/data/spells.json"))).json(),Ua||[]}catch(n){return console.error("Failed to load spells:",n),[]}}async function ln(){if(Ha)return Ha;try{return Ha=await(await fetch(Rs("/data/feats.json"))).json(),Ha||[]}catch(n){return console.error("Failed to load feats:",n),[]}}function $s(n,c){if(!c.trim())return n;const t=c.toLowerCase();return n.filter(v=>v.name.toLowerCase().includes(t)||v.school.toLowerCase().includes(t)||v.classes.some(u=>u.toLowerCase().includes(t))||v.description.toLowerCase().includes(t))}function nn(n,c){return c===null?n:n.filter(t=>t.level===c)}function rn(n,c){if(!c.trim())return n;const t=c.toLowerCase();return n.filter(v=>v.name.toLowerCase().includes(t)||v.description.toLowerCase().includes(t))}function Na(n){const c=n.description,t=/\b(Strength|Dexterity|Constitution|Intelligence|Wisdom|Charisma)\s+saving\s+throw/i,v=c.match(t);if(!v)return null;const u=v[1].toLowerCase(),p=/half\s+(?:as\s+much\s+)?damage\s+on\s+a\s+successful(?:\s+save)?/i.test(c),_=/saving\s+throw\s+or\s+take.*?damage/i.test(c)&&!p;return{ability:u,halfDamageOnSave:p,noDamageOnSave:_}}function on(n){const c=n.description;return/(plus|add)\s+your\s+spellcasting\s+(ability\s+)?modifier/i.test(c)}function Za(n){const c=n.description.toLowerCase();return c.includes("ranged spell attack")||c.includes("melee spell attack")}function ws(n){const c=n.description.toLowerCase();if(["Divine Favor","Bless","Aid","Command"].includes(n.name))return!0;const u=["takes","take","deals","deal","damage equal to","force damage","fire damage","cold damage","lightning damage","thunder damage","acid damage","poison damage","necrotic damage","radiant damage","psychic damage","regain","regains","hit point"].some(D=>c.includes(D));return["bonus to attack","bonus to damage","bonus to ac","gains a +","gain a +","+1 bonus","+2 bonus","+3 bonus","advantage on","becomes a magic weapon"].some(D=>c.includes(D))&&!u}function cn(n){const c=n.description;let t=0,v=0,u=0,f="";const p=c.match(/\+(\d+)\s+bonus\s+to\s+attack\s+rolls\s+and\s+damage\s+rolls/i);if(p){const _=parseInt(p[1]);t=_,v=_,f=`+${_} to attack and damage rolls`}if(n.name==="Bless"&&(f="Add 1d4 to attack rolls and saves",t="1d4"),n.name==="Aid")return f="+5 HP (max and current) for 8 hours",{attackBonus:0,damageBonus:0,acBonus:0,hpBonus:5,description:f,name:n.name};n.name==="Divine Favor"&&(f="Your weapon attacks deal an extra 1d4 radiant damage on a hit.",v="1d4");const D=c.match(/\+(\d+)\s+bonus\s+to\s+AC/i);return D&&(u=parseInt(D[1]),f=`+${u} to AC`),n.name==="Haste"&&(f="+2 AC, doubled speed, extra action",u=2),f||t!==0||v!==0||u!==0?{attackBonus:t,damageBonus:v,acBonus:u,description:f||n.description.substring(0,100),name:n.name}:null}function es(n){const c=n.description,t=/takes?\s+(\d+d\d+)\s+\w+\s+damage[^.]*\.\s*If\s+the\s+target\s+is\s+missing.*?instead\s+takes?\s+(\d+d\d+)/is,v=c.match(t);return v?{baseDamage:v[1],alternateDamage:v[2]}:null}var vn=d('<button class="btn btn-secondary">Reorder</button>'),dn=d('<div class="edit-buttons svelte-14o91c5"><button class="btn btn-secondary">Add Attack</button> <!></div>'),un=d('<input type="text" placeholder="Attack name" class="attack-name svelte-14o91c5"/>'),fn=d('<h4 class="attack-name-display svelte-14o91c5"> </h4>'),pn=d('<button class="btn-remove svelte-14o91c5">√ó</button>'),mn=d('<div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Bonus</label> <input type="number" class="attack-bonus svelte-14o91c5"/></div>'),gn=d('<div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Damage</label> <input type="text" placeholder="e.g., 2d6+3" class="attack-damage svelte-14o91c5"/></div>'),bn=d('<div class="spell-info-loading svelte-14o91c5">Loading spell info...</div>'),hn=d('<li class="svelte-14o91c5"><strong>At Higher Levels:</strong> </li>'),_n=d('<ul class="svelte-14o91c5"><li class="svelte-14o91c5"><strong>Level:</strong> </li> <li class="svelte-14o91c5"><strong>Casting Time:</strong> </li> <li class="svelte-14o91c5"><strong>Range:</strong> </li> <li class="svelte-14o91c5"><strong>Components:</strong> <!></li> <li class="svelte-14o91c5"><strong>Duration:</strong> <!> </li> <li class="svelte-14o91c5"><strong>Description:</strong> </li> <!></ul>'),yn=d('<span class="scaled-damage svelte-14o91c5" style="margin-left: 8px;"> </span>'),xn=d('<span class="scaled-damage svelte-14o91c5">(Half damage)</span>'),$n=d('<span class="scaled-damage svelte-14o91c5">(No damage)</span>'),wn=d('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> <!> <!></label></div>'),kn=d('<span class="scaled-damage svelte-14o91c5"> </span>'),Sn=d('<span class="scaled-damage svelte-14o91c5"> </span>'),Cn=d('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> Target is missing HP <!></label></div>'),Dn=d("<option> </option>"),Ln=d('<span class="scaled-damage svelte-14o91c5"><!> </span>'),jn=d('<span class="scaled-damage svelte-14o91c5"> </span>'),An=d('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> Target is Fiend or Undead <!></label></div>'),Bn=d('<div class="spell-level-selector svelte-14o91c5"><label class="svelte-14o91c5">Cast at Level:</label> <select class="spell-level-select use-enabled svelte-14o91c5"></select> <!></div> <!>',1),Rn=d('<div class="spell-level-selector svelte-14o91c5"><span style="color: #dc3545; font-weight: bold;">No spell slots available!</span></div>'),Tn=d('<div class="spell-info svelte-14o91c5"><div class="spell-info-header svelte-14o91c5" role="button" tabindex="0"><h4 class="svelte-14o91c5">Spell Info</h4> <button class="collapse-btn-small svelte-14o91c5"> </button></div> <!></div> <!> <!> <!>',1),Mn=d('<div class="spell-info-missing svelte-14o91c5">Spell info not found.</div>'),Fn=d('<div class="attack-notes svelte-14o91c5"><label class="svelte-14o91c5">Notes</label> <textarea placeholder="e.g., DC 15 Dex save, Range 120 ft, Concentration" class="notes-input svelte-14o91c5" rows="2"></textarea></div>'),Pn=d('<button class="btn btn-primary">Roll Attack</button>'),In=d('<div class="buff-target-selection svelte-14o91c5"><div class="target-options svelte-14o91c5"><label class="target-option svelte-14o91c5"><input type="radio" class="svelte-14o91c5"/> Self</label> <label class="target-option svelte-14o91c5"><input type="radio" class="svelte-14o91c5"/> Other</label></div> <button class="btn btn-info"> </button></div>'),En=d('<button class="btn btn-info">Cast Spell</button>'),Un=d("<button><!></button>"),Hn=d('<button class="btn btn-info">Cast Spell</button>'),Nn=d('<button class="btn btn-secondary">Roll Damage</button>'),On=d('<button class="btn btn-primary">Roll Attack</button> <!>',1),Gn=d('<div class="attack-card svelte-14o91c5"><div class="attack-header svelte-14o91c5"><!> <!></div> <div class="attack-details svelte-14o91c5"><!> <!> <div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Type</label> <input type="text" placeholder="e.g., slashing" class="attack-type svelte-14o91c5"/></div></div> <!> <!> <div class="attack-actions svelte-14o91c5"><!></div></div>'),qn=d('<p class="no-attacks svelte-14o91c5">No attacks added yet. Click "Add Attack" to create one.</p>'),zn=d('<p class="no-attacks svelte-14o91c5">No attacks match your search.</p>'),Wn=d('<span class="ability-uses svelte-14o91c5"> <!></span>'),Kn=d('<span class="ability-reaction svelte-14o91c5">‚ö° Reaction</span>'),Vn=d('<button class="btn btn-ability svelte-14o91c5">Use Ability</button>'),Jn=d('<div class="ability-card svelte-14o91c5"><div class="ability-header svelte-14o91c5"><h4 class="ability-name svelte-14o91c5"> </h4> <span class="ability-source svelte-14o91c5"> </span></div> <p class="ability-description svelte-14o91c5"> </p> <div class="ability-footer svelte-14o91c5"><!> <!> <!></div></div>'),Yn=d('<div class="condition-abilities-section svelte-14o91c5"><h3 class="abilities-header svelte-14o91c5">Condition Abilities</h3> <p class="section-description svelte-14o91c5">Special actions granted by active conditions (e.g., Flicker of Deceit)</p> <div class="abilities-list svelte-14o91c5"></div></div>'),Qn=d('<button class="btn-remove svelte-14o91c5">√ó</button>'),Xn=d('<div class="state-card svelte-14o91c5"><div class="state-header svelte-14o91c5"><input type="text" placeholder="Effect name (e.g., Magic Weapon)" class="state-name svelte-14o91c5"/> <!></div> <div class="state-details svelte-14o91c5"><div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Attack Bonus</label> <input type="number" class="state-bonus svelte-14o91c5"/></div> <div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Damage Bonus</label> <input type="text" class="state-bonus svelte-14o91c5"/></div> <div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Target</label> <select class="state-bonus svelte-14o91c5"><option>Self</option><option>Other</option></select></div></div> <div class="state-description svelte-14o91c5"><label class="svelte-14o91c5">Description</label> <input type="text" placeholder="e.g., +1 to attack and damage rolls (Magic Weapon)" class="state-desc-input svelte-14o91c5"/></div></div>'),Zn=d('<div class="states-list svelte-14o91c5"></div>'),ei=d('<p class="no-states svelte-14o91c5">No active effects. Add spell effects that modify your attacks.</p>'),ti=d('<!> <div class="attacks-list svelte-14o91c5"><!> <!></div> <!> <div class="active-states-section svelte-14o91c5"><h3 class="svelte-14o91c5">Active Spell Effects</h3> <p class="section-description svelte-14o91c5">Effects that modify attack and damage rolls (e.g., Magic Weapon, Bless)</p> <button class="btn btn-secondary">Add Effect</button> <!></div>',1),ai=d("<section><!> <!></section> <!>",1);function si(n,c){Gt(c,!1);const t=()=>dt(be,"$character",p),v=()=>dt(ga,"$searchFilter",p),u=()=>dt(Xt,"$collapsedStates",p),f=()=>dt(ma,"$isEditMode",p),[p,D]=ra(),_=C(),h=C(),K=C(),F=[];function re(k,H){be.update($e=>{if(!$e.activeStates)return $e;const Se=$e.activeStates.findIndex(ye=>ye.name===k);if(Se===-1)return $e;const y=$e.activeStates[Se];if(!y.abilities)return $e;const N=y.abilities.findIndex(ye=>ye.name===H);if(N===-1)return $e;const ie=y.abilities[N];return ie.currentUses!==void 0&&ie.currentUses>0&&(ie.currentUses-=1,ie.usesPerRest!==void 0?Nt.add(`Used ${H} (${ie.currentUses}/${ie.usesPerRest} remaining)`,"info"):Nt.add(`Used ${H}`,"info")),$e})}const te=_a();let z=C({}),q=C({}),T=C(!1);function I(k){pa(z,e(z)[k]=!e(z)[k]),r(z,{...e(z)})}function M(k){return k.description.toLowerCase().includes("regain")&&(k.description.toLowerCase().includes("hit point")||k.description.toLowerCase().includes("hp"))}function xe(k){return["Shield of Faith","Bless","Aid","Magic Weapon"].includes(k)}function Qe(){be.update(k=>(k.attacks=[...k.attacks,{id:crypto.randomUUID(),name:"",bonus:0,damage:"",damageType:"",notes:""}],k))}function Z(k){be.update(H=>(H.attacks=H.attacks.filter($e=>$e.id!==k),H))}function he(){r(T,!0)}function fe(){r(T,!1)}function _e(k){be.update(H=>(H.attacks=k,H)),r(T,!1),Nt.add("Attack order updated successfully!","success")}function Fe(k){let H=k.damage,$e=!1,Se=!1;if(k.spellRef){const le=V(k.spellRef);if(le&&(Se=Za(le),le.level>0)){const ge=k.castAtLevel||le.level;if(!b(ge)){Nt.add(`No level ${ge} spell slots available!`,"error");return}const U=Na(le);U&&k.targetSucceededSave&&U.noDamageOnSave?H="0":($e=U?.halfDamageOnSave&&k.targetSucceededSave||!1,H=A(k,le))}}else if(t().activeStates&&t().activeStates.length>0){let le=0,ge=[];for(const ce of t().activeStates)ce.target!=="other"&&(typeof ce.damageBonus=="string"?ge.push(ce.damageBonus):typeof ce.damageBonus=="number"&&(le+=ce.damageBonus));if((le!==0||ge.length>0)&&H){const ce=H.match(/(\d+d\d+)([+-]\d+)?/);if(ce){const[,U,w]=ce,De=(w?parseInt(w):0)+le;let Je=`${U}`;De!==0&&(Je+=`${De>=0?"+":""}${De}`),ge.length>0&&(Je+=" + "+ge.join(" + ")),H=Je}}}const y=[];let N=0;if(Se){const le=Qa(t(),t().abilities),ge=t().proficiencyBonus||0;y.push({value:ge,source:"proficiency"}),y.push({value:le,source:"spellcasting"}),N=ge+le}else k.bonus!==0&&y.push({value:k.bonus,source:"base"}),N=k.bonus;let ie=[];if(t().activeStates)for(const le of t().activeStates)le.target!=="other"&&(typeof le.attackBonus=="number"&&le.attackBonus!==0?(y.push({value:le.attackBonus,source:le.name.toLowerCase()}),N+=le.attackBonus):typeof le.attackBonus=="string"&&le.attackBonus&&(ie.push(le.attackBonus),y.push({value:le.attackBonus,source:le.name.toLowerCase()})));let ye=`1d20${N>=0?"+":""}${N}`;ie.length>0&&(ye+="+"+ie.join("+")),te("roll",{notation:ye,damageNotation:H,attackName:k.name,applyHalfDamage:$e,bonusBreakdown:y,rollType:"attack"})}function B(k){if(!k.damage){Nt.add(`${k.name}: No damage specified`,"error");return}let H=k.damage,$e=!1;const Se=[];let y=k.damageType||"";if(k.spellRef){const N=V(k.spellRef);if(N){const ie=M(N);if(ie){const ye=Qa(t(),t().abilities),le=H.match(/^(\d+d\d+)/);le&&(H=le[1],ye>0&&(H+=`+${ye}`,Se.push({value:ye,source:"spellcasting"}))),y="Healing"}if(N.level>0){const ye=k.castAtLevel||N.level;if(!b(ye)){Nt.add(`No level ${ye} spell slots available!`,"error");return}const ge=Na(N);ge&&k.targetSucceededSave&&ge.noDamageOnSave?H="0":($e=ge?.halfDamageOnSave&&k.targetSucceededSave||!1,ie||(H=A(k,N))),N.damageType&&!ie&&(y=N.damageType)}}}else{const N=H.match(/(\d+d\d+)([+-]\d+)?/);if(N){const[,ie,ye]=N,le=ye?parseInt(ye):0;if(le!==0&&Se.push({value:le,source:"base"}),t().activeStates&&t().activeStates.length>0){let ge=0,ce=[];for(const U of t().activeStates)U.target!=="other"&&(typeof U.damageBonus=="string"?ce.push(U.damageBonus):typeof U.damageBonus=="number"&&U.damageBonus!==0&&(Se.push({value:U.damageBonus,source:U.name.toLowerCase()}),ge+=U.damageBonus));if(ge!==0||ce.length>0){const U=le+ge;let w=`${ie}`;U!==0&&(w+=`${U>=0?"+":""}${U}`),ce.length>0&&(w+=" + "+ce.join(" + ")),H=w}}}}te("roll",{notation:H,attackName:k.name,applyHalfDamage:$e,bonusBreakdown:Se,damageType:y})}let P=C([]),x=C(!1);$a(async()=>{r(P,await Fs()),r(x,!0)});function V(k){return e(P).find(H=>H.name===k)}function b(k){t().classFeatures.spellSlotsByLevel||Ft(be,i(t).classFeatures.spellSlotsByLevel={},i(t)),t().classFeatures.spellSlotsByLevel[k]||Ft(be,i(t).classFeatures.spellSlotsByLevel[k]=Array(2).fill(!1),i(t));const $e=t().classFeatures.spellSlotsByLevel[k].findIndex(Se=>!Se);return $e===-1?!1:(be.update(Se=>(Se.classFeatures.spellSlotsByLevel||(Se.classFeatures.spellSlotsByLevel={}),Se.classFeatures.spellSlotsByLevel[k]||(Se.classFeatures.spellSlotsByLevel[k]=Array(2).fill(!1)),Se.classFeatures.spellSlotsByLevel[k][$e]=!0,Se)),!0)}function A(k,H){let $e=k.damage,Se=0,y=0;const N=es(H);if(N&&k.targetIsDamaged&&($e=N.alternateDamage),on(H)&&(y+=Qa(t(),t().abilities)),t().activeStates)for(const De of t().activeStates)De.target!=="other"&&typeof De.damageBonus=="number"&&(y+=De.damageBonus);if(H.higherLevelSlot&&k.castAtLevel){const De=H.level,Le=(k.castAtLevel||De)-De;if(Le>0){const m=H.higherLevelSlot.match(/(\d+)d(\d+)\s+for\s+each.*?level\s+above/i);if(m){const[,pe]=m;Se+=Le*parseInt(pe)}}}if(k.targetIsFiendOrUndead&&H.description.includes("Fiend or an Undead")){const De=H.description.match(/increases by (\d+)d(\d+) if.*?Fiend or.*?Undead/i);if(De){const[,Je]=De;Se+=parseInt(Je)}}const ie=$e.match(/(\d+)d(\d+)([+-]\d+)?/);if(!ie)return y!==0?y>=0?`${y}`:`${y}`:$e||"0";const[,ye,le,ge]=ie,ce=parseInt(ye)+Se,w=(ge?parseInt(ge):0)+y;let Ae=`${ce}d${le}`;return w!==0&&(Ae+=w>=0?`+${w}`:`${w}`),Ae}function J(k){const H=[];for(let Se=k.level;Se<=9;Se++){const y=t().classFeatures.spellSlotsByLevel?.[Se];y&&y.length>0&&H.push(Se)}return H}function Me(){be.update(k=>(k.activeStates||(k.activeStates=[]),k.activeStates=[...k.activeStates,{name:"",attackBonus:0,damageBonus:0,description:"",target:"self"}],k))}function ae(k){be.update(H=>{if(H.activeStates){const $e=H.activeStates[k];$e?.hpBonus&&$e.target!=="other"&&(H.maxHP-=$e.hpBonus,H.currentHP=Math.max(1,Math.min(H.currentHP-$e.hpBonus,H.maxHP))),H.activeStates=H.activeStates.filter((Se,y)=>y!==k)}return H})}function de(k,H="self"){const $e=V(k.spellRef);if(!$e){Nt.add("Spell not found","error");return}const Se=k.castAtLevel||$e.level;if(Se>0&&!b(Se)){Nt.add(`No level ${Se} spell slots available!`,"error");return}const y=cn($e);if(!y){Nt.add(`${$e.name} cast! Check spell description for effects.`,"info");return}let N=y.hpBonus||0,ie=y.description;$e.name==="Aid"&&Se>$e.level&&(N=5+(Se-$e.level)*5,ie=`+${N} HP (max and current) for 8 hours`);const le=["Shield of Faith","Bless","Aid","Magic Weapon"].includes($e.name);be.update(ce=>{ce.activeStates||(ce.activeStates=[]);const U=ce.activeStates.find(w=>w.name===$e.name);return U&&U.hpBonus&&U.target!=="other"&&(ce.maxHP-=U.hpBonus,ce.currentHP=Math.max(1,Math.min(ce.currentHP-U.hpBonus,ce.maxHP))),ce.activeStates=ce.activeStates.filter(w=>w.name!==$e.name),N>0&&H==="self"&&(ce.maxHP+=N,ce.currentHP+=N),ce.activeStates=[...ce.activeStates,{name:$e.name,attackBonus:y.attackBonus,damageBonus:y.damageBonus,acBonus:y.acBonus,description:ie,target:H,hpBonus:N}],ce});const ge=H==="self"?" on self":" on other";Nt.add(`${$e.name} cast${le?ge:""}! Effect added to Active Spell Effects.`,"success")}et(()=>t(),()=>{r(_,t().activeStates?t().activeStates.filter(k=>k.abilities&&k.abilities.length>0).flatMap(k=>k.abilities.map(H=>({...H,conditionName:k.name}))):[])}),et(()=>(t(),e(z),e(q)),()=>{if(t()&&t().attacks)for(const k of t().attacks)k.spellRef&&e(z)[k.id]===void 0&&pa(z,e(z)[k.id]=!0),k.spellRef&&e(q)[k.id]===void 0&&pa(q,e(q)[k.id]="self")}),et(()=>(t(),v()),()=>{r(h,t().attacks.filter(k=>{if(!v())return!0;const H=v().toLowerCase();return k.name.toLowerCase().includes(H)||k.damageType.toLowerCase().includes(H)}).sort((k,H)=>!k.spellRef&&H.spellRef?-1:k.spellRef&&!H.spellRef?1:0))}),et(()=>(v(),e(h)),()=>{r(K,!v()||e(h).length>0||"attack".includes(v().toLowerCase())||"spell".includes(v().toLowerCase()))}),ca(),Ot();var ne=ai(),Ce=Re(ne);let Oe;var nt=l(Ce);{let k=_t(()=>(u(),i(()=>u().attacks?"Expand":"Collapse")));ya(nt,{title:"Attacks & Spells",get collapsed(){return u(),i(()=>u().attacks)},get ariaLabel(){return e(k)},onToggle:()=>Xt.update(H=>({...H,attacks:!H.attacks}))})}var mt=a(nt,2);{var ct=k=>{var H=ti(),$e=Re(H);{var Se=Le=>{var m=dn(),pe=l(m),oe=a(pe,2);{var G=Pe=>{var Ie=vn();j("click",Ie,he),o(Pe,Ie)};g(oe,Pe=>{t(),i(()=>t().attacks.length>0)&&Pe(G)})}s(m),j("click",pe,Qe),o(Le,m)};g($e,Le=>{f()&&Le(Se)})}var y=a($e,2),N=l(y);yt(N,1,()=>e(h),Le=>Le.id,(Le,m,pe)=>{var oe=Gn(),G=l(oe),Pe=l(G);{var Ie=me=>{var W=un();Te(W),Ge(W,()=>e(m).name,Ne=>(e(m).name=Ne,Ht(()=>(e(h),t(),v())))),o(me,W)},Be=me=>{var W=fn(),Ne=l(W,!0);s(W),S(()=>$(Ne,(e(m),i(()=>e(m).name||"(Unnamed Attack)")))),o(me,W)};g(Pe,me=>{f()?me(Ie):me(Be,!1)})}var Ue=a(Pe,2);{var ve=me=>{var W=pn();j("click",W,()=>Z(e(m).id)),o(me,W)};g(Ue,me=>{f()&&me(ve)})}s(G);var Ee=a(G,2),we=l(Ee);{var Xe=me=>{var W=mn(),Ne=l(W),ut=a(Ne,2);Te(ut),s(W),S(()=>{lt(Ne,"for",`attack-bonus-${e(m),i(()=>e(m).id)??""}`),lt(ut,"id",`attack-bonus-${e(m),i(()=>e(m).id)??""}`)}),Ge(ut,()=>e(m).bonus,Ze=>(e(m).bonus=Ze,Ht(()=>(e(h),t(),v())))),o(me,W)};g(we,me=>{e(m),i(()=>e(m).bonus!==0&&e(m).bonus!==void 0)&&me(Xe)})}var qe=a(we,2);{var ot=me=>{var W=gn(),Ne=l(W),ut=a(Ne,2);Te(ut),s(W),S(()=>{lt(Ne,"for",`attack-damage-${e(m),i(()=>e(m).id)??""}`),lt(ut,"id",`attack-damage-${e(m),i(()=>e(m).id)??""}`)}),Ge(ut,()=>e(m).damage,Ze=>(e(m).damage=Ze,Ht(()=>(e(h),t(),v())))),o(me,W)};g(qe,me=>{e(m),i(()=>e(m).damage&&e(m).damage.trim()!=="")&&me(ot)})}var vt=a(qe,2),ue=l(vt),L=a(ue,2);Te(L),s(vt),s(Ee);var O=a(Ee,2);{var Q=me=>{var W=bt(),Ne=Re(W);{var ut=at=>{var se=bn();o(at,se)},Ze=at=>{const se=_t(()=>(e(m),i(()=>V(e(m).spellRef))));var Dt=bt(),E=Re(Dt);{var Ke=He=>{const R=_t(()=>(X(Na),X(e(se)),i(()=>Na(e(se))))),xt=_t(()=>(X(es),X(e(se)),i(()=>es(e(se)))));var ht=Tn(),st=Re(ht),ke=l(st),ft=a(l(ke),2),it=l(ft,!0);s(ft),s(ke);var Rt=a(ke,2);{var rt=Tt=>{var Pt=_n(),Et=l(Pt),la=a(l(Et));s(Et);var na=a(Et,2),va=a(l(na));s(na);var Yt=a(na,2),Ut=a(l(Yt));s(Yt);var Wt=a(Yt,2),Zt=a(l(Wt)),jt=a(Zt);{var ea=It=>{var Vt=Mt();S(()=>$(Vt,`(${X(e(se)),i(()=>e(se).material)??""})`)),o(It,Vt)};g(jt,It=>{X(e(se)),i(()=>e(se).material)&&It(ea)})}s(Wt);var gt=a(Wt,2),$t=a(l(gt),2);{var Lt=It=>{var Vt=Mt("Concentration,");o(It,Vt)};g($t,It=>{X(e(se)),i(()=>e(se).concentration)&&It(Lt)})}var wt=a($t,1,!0);s(gt);var At=a(gt,2),Kt=a(l(At));s(At);var ta=a(At,2);{var da=It=>{var Vt=hn(),oa=a(l(Vt));s(Vt),S(()=>$(oa,` ${X(e(se)),i(()=>e(se).higherLevelSlot)??""}`)),o(It,Vt)};g(ta,It=>{X(e(se)),i(()=>e(se).higherLevelSlot)&&It(da)})}s(Pt),S(It=>{$(la,` ${X(e(se)),i(()=>e(se).level)??""}`),$(va,` ${X(e(se)),i(()=>e(se).castingTime||e(se).actionType)??""}`),$(Ut,` ${X(e(se)),i(()=>e(se).range)??""}`),$(Zt,` ${It??""}`),$(wt,(X(e(se)),i(()=>e(se).duration))),$(Kt,` ${X(e(se)),i(()=>e(se).description)??""}`)},[()=>(X(e(se)),i(()=>e(se).components.join(", ")))]),o(Tt,Pt)};g(Rt,Tt=>{e(z),e(m),i(()=>!e(z)[e(m).id])&&Tt(rt)})}s(st);var pt=a(st,2);{var St=Tt=>{var Pt=wn(),Et=l(Pt),la=l(Et);Te(la);var na=a(la),va=a(na);{var Yt=jt=>{var ea=yn(),gt=l(ea);s(ea),S($t=>$(gt,`(Spell Save DC: ${$t??""})`),[()=>(X(is),t(),i(()=>is(t(),t().abilities)))]),o(jt,ea)};g(va,jt=>{t(),i(()=>t().class)&&jt(Yt)})}var Ut=a(va,2);{var Wt=jt=>{var ea=xn();o(jt,ea)},Zt=jt=>{var ea=bt(),gt=Re(ea);{var $t=Lt=>{var wt=$n();o(Lt,wt)};g(gt,Lt=>{e(m),X(e(R)),i(()=>e(m).targetSucceededSave&&e(R).noDamageOnSave)&&Lt($t)},!0)}o(jt,ea)};g(Ut,jt=>{e(m),X(e(R)),i(()=>e(m).targetSucceededSave&&e(R).halfDamageOnSave)?jt(Wt):jt(Zt,!1)})}s(Et),s(Pt),S(jt=>$(na,` Target succeeded on ${jt??""} save `),[()=>(X(e(R)),i(()=>e(R).ability.charAt(0).toUpperCase()+e(R).ability.slice(1)))]),wa(la,()=>e(m).targetSucceededSave,jt=>(e(m).targetSucceededSave=jt,Ht(()=>(e(h),t(),v())))),o(Tt,Pt)};g(pt,Tt=>{e(R)&&Tt(St)})}var Jt=a(pt,2);{var aa=Tt=>{var Pt=Cn(),Et=l(Pt),la=l(Et);Te(la);var na=a(la,2);{var va=Ut=>{const Wt=_t(()=>(e(m),X(e(se)),i(()=>A(e(m),e(se)))));var Zt=kn(),jt=l(Zt);s(Zt),S(()=>$(jt,`(${X(e(xt)),i(()=>e(xt).alternateDamage)??""}, total: ${e(Wt)??""})`)),o(Ut,Zt)},Yt=Ut=>{var Wt=Sn(),Zt=l(Wt);s(Wt),S(()=>$(Zt,`(${X(e(xt)),i(()=>e(xt).baseDamage)??""})`)),o(Ut,Wt)};g(na,Ut=>{e(m),i(()=>e(m).targetIsDamaged)?Ut(va):Ut(Yt,!1)})}s(Et),s(Pt),wa(la,()=>e(m).targetIsDamaged,Ut=>(e(m).targetIsDamaged=Ut,Ht(()=>(e(h),t(),v())))),o(Tt,Pt)};g(Jt,Tt=>{e(xt)&&Tt(aa)})}var zt=a(Jt,2);{var sa=Tt=>{const Pt=_t(()=>(X(e(se)),i(()=>J(e(se)))));var Et=bt(),la=Re(Et);{var na=Yt=>{var Ut=Bn(),Wt=Re(Ut),Zt=l(Wt),jt=a(Zt,2);S(()=>{e(m),Ht(()=>{e(Pt)})}),yt(jt,5,()=>e(Pt),kt,(wt,At)=>{var Kt=Dn(),ta=l(Kt);s(Kt);var da={};S(()=>{$(ta,`Level ${e(At)??""}`),da!==(da=e(At))&&(Kt.value=(Kt.__value=e(At))??"")}),o(wt,Kt)}),s(jt);var ea=a(jt,2);{var gt=wt=>{const At=_t(()=>(e(m),X(e(se)),i(()=>A(e(m),e(se)))));var Kt=Ln(),ta=l(Kt);{var da=oa=>{var fa=Mt("Healing");o(oa,fa)},It=oa=>{var fa=Mt("Damage");o(oa,fa)};g(ta,oa=>{X(e(se)),i(()=>M(e(se)))?oa(da):oa(It,!1)})}var Vt=a(ta);s(Kt),S(()=>$(Vt,` ${e(At)??""}`)),o(wt,Kt)};g(ea,wt=>{e(m),X(e(se)),i(()=>e(m).castAtLevel&&e(m).castAtLevel>e(se).level)&&wt(gt)})}s(Wt);var $t=a(Wt,2);{var Lt=wt=>{var At=An(),Kt=l(At),ta=l(Kt);Te(ta);var da=a(ta,2);{var It=Vt=>{const oa=_t(()=>(e(m),X(e(se)),i(()=>A(e(m),e(se)))));var fa=jn(),ba=l(fa);s(fa),S(()=>$(ba,`(+1d8, total: ${e(oa)??""})`)),o(Vt,fa)};g(da,Vt=>{e(m),i(()=>e(m).targetIsFiendOrUndead)&&Vt(It)})}s(Kt),s(At),wa(ta,()=>e(m).targetIsFiendOrUndead,Vt=>(e(m).targetIsFiendOrUndead=Vt,Ht(()=>(e(h),t(),v())))),o(wt,At)};g($t,wt=>{X(e(se)),i(()=>e(se).description.includes("Fiend or an Undead"))&&wt(Lt)})}S(()=>{lt(Zt,"for",`castLevel-${e(m),i(()=>e(m).id)??""}`),lt(jt,"id",`castLevel-${e(m),i(()=>e(m).id)??""}`)}),Ta(jt,()=>e(m).castAtLevel,wt=>(e(m).castAtLevel=wt,Ht(()=>(e(h),t(),v())))),o(Yt,Ut)},va=Yt=>{var Ut=Rn();o(Yt,Ut)};g(la,Yt=>{X(e(Pt)),i(()=>e(Pt).length>0)?Yt(na):Yt(va,!1)})}o(Tt,Et)};g(zt,Tt=>{X(e(se)),i(()=>e(se).higherLevelSlot&&e(se).level>0)&&Tt(sa)})}S(()=>{lt(ft,"aria-label",(e(z),e(m),i(()=>e(z)[e(m).id]?"Expand":"Collapse"))),$(it,(e(z),e(m),i(()=>e(z)[e(m).id]?"‚ñº":"‚ñ≤")))}),j("click",ke,()=>I(e(m).id)),j("keydown",ke,Tt=>Tt.key==="Enter"&&I(e(m).id)),o(He,ht)},ee=He=>{var R=Mn();o(He,R)};g(E,He=>{e(se)?He(Ke):He(ee,!1)})}o(at,Dt)};g(Ne,at=>{e(P),i(()=>e(P).length===0)?at(ut):at(Ze,!1)})}o(me,W)};g(O,me=>{e(m),i(()=>e(m).spellRef)&&me(Q)})}var Y=a(O,2);{var je=me=>{var W=bt(),Ne=Re(W);{var ut=Ze=>{var at=Fn(),se=l(at),Dt=a(se,2);xa(Dt),s(at),S(()=>{lt(se,"for",`attack-notes-${e(m),i(()=>e(m).id)??""}`),lt(Dt,"id",`attack-notes-${e(m),i(()=>e(m).id)??""}`)}),Ge(Dt,()=>e(m).notes,E=>(e(m).notes=E,Ht(()=>(e(h),t(),v())))),o(Ze,at)};g(Ne,Ze=>{e(m),i(()=>e(m).notes&&e(m).notes.trim()!=="")&&Ze(ut)})}o(me,W)};g(Y,me=>{e(m),i(()=>!e(m).spellRef)&&me(je)})}var ze=a(Y,2),tt=l(ze);{var We=me=>{const W=_t(()=>(e(m),i(()=>V(e(m).spellRef))));var Ne=bt(),ut=Re(Ne);{var Ze=at=>{var se=bt(),Dt=Re(se);{var E=ee=>{var He=Pn();j("click",He,()=>Fe(e(m))),o(ee,He)},Ke=ee=>{var He=bt(),R=Re(He);{var xt=st=>{var ke=bt(),ft=Re(ke);{var it=rt=>{var pt=In(),St=l(pt),Jt=l(St),aa=l(Jt);Te(aa),aa.value=aa.__value="self",Qt(),s(Jt);var zt=a(Jt,2),sa=l(zt);Te(sa),sa.value=sa.__value="other",Qt(),s(zt),s(St);var Tt=a(St,2),Pt=l(Tt);s(Tt),s(pt),S(()=>{lt(aa,"name",`target-${e(m),i(()=>e(m).id)??""}`),lt(sa,"name",`target-${e(m),i(()=>e(m).id)??""}`),$(Pt,`Cast ${X(e(W)),i(()=>e(W).name)??""}`)}),bs(F,[pe],aa,()=>e(q)[e(m).id],Et=>pa(q,e(q)[e(m).id]=Et)),bs(F,[pe],sa,()=>e(q)[e(m).id],Et=>pa(q,e(q)[e(m).id]=Et)),j("click",Tt,()=>de(e(m),e(q)[e(m).id])),o(rt,pt)},Rt=rt=>{var pt=En();j("click",pt,()=>de(e(m),"self")),o(rt,pt)};g(ft,rt=>{X(e(W)),i(()=>xe(e(W).name))?rt(it):rt(Rt,!1)})}o(st,ke)},ht=st=>{var ke=bt(),ft=Re(ke);{var it=rt=>{var pt=Un(),St=l(pt);{var Jt=zt=>{var sa=Mt("Roll Healing");o(zt,sa)},aa=zt=>{var sa=Mt("Roll Damage");o(zt,sa)};g(St,zt=>{X(e(W)),i(()=>M(e(W)))?zt(Jt):zt(aa,!1)})}s(pt),S(zt=>Bt(pt,1,`btn ${zt??""}`),[()=>(X(e(W)),i(()=>M(e(W))?"btn-success":"btn-secondary"))]),j("click",pt,()=>B(e(m))),o(rt,pt)},Rt=rt=>{var pt=Hn();j("click",pt,()=>de(e(m),"self")),o(rt,pt)};g(ft,rt=>{e(m),i(()=>e(m).damage&&e(m).damage.trim()!=="")?rt(it):rt(Rt,!1)})}o(st,ke)};g(R,st=>{X(ws),X(e(W)),i(()=>ws(e(W)))?st(xt):st(ht,!1)},!0)}o(ee,He)};g(Dt,ee=>{X(Za),X(e(W)),i(()=>Za(e(W)))?ee(E):ee(Ke,!1)})}o(at,se)};g(ut,at=>{e(W)&&at(Ze)})}o(me,Ne)},Ye=me=>{var W=bt(),Ne=Re(W);{var ut=Ze=>{var at=On(),se=Re(at),Dt=a(se,2);{var E=Ke=>{var ee=Nn();j("click",ee,()=>B(e(m))),o(Ke,ee)};g(Dt,Ke=>{e(m),i(()=>e(m).damage&&e(m).damage.trim()!=="")&&Ke(E)})}j("click",se,()=>Fe(e(m))),o(Ze,at)};g(Ne,Ze=>{e(m),i(()=>!e(m).spellRef)&&Ze(ut)},!0)}o(me,W)};g(tt,me=>{e(m),e(x),i(()=>e(m).spellRef&&e(x))?me(We):me(Ye,!1)})}s(ze),s(oe),S(()=>{lt(ue,"for",`attack-type-${e(m),i(()=>e(m).id)??""}`),lt(L,"id",`attack-type-${e(m),i(()=>e(m).id)??""}`)}),Ge(L,()=>e(m).damageType,me=>(e(m).damageType=me,Ht(()=>(e(h),t(),v())))),o(Le,oe)});var ie=a(N,2);{var ye=Le=>{var m=qn();o(Le,m)},le=Le=>{var m=bt(),pe=Re(m);{var oe=G=>{var Pe=zn();o(G,Pe)};g(pe,G=>{e(h),i(()=>e(h).length===0)&&G(oe)},!0)}o(Le,m)};g(ie,Le=>{t(),i(()=>t().attacks.length===0)?Le(ye):Le(le,!1)})}s(y);var ge=a(y,2);{var ce=Le=>{var m=Yn(),pe=a(l(m),4);yt(pe,5,()=>e(_),kt,(oe,G)=>{var Pe=Jn(),Ie=l(Pe),Be=l(Ie),Ue=l(Be,!0);s(Be);var ve=a(Be,2),Ee=l(ve);s(ve),s(Ie);var we=a(Ie,2),Xe=l(we,!0);s(we);var qe=a(we,2),ot=l(qe);{var vt=Y=>{var je=Wn(),ze=l(je),tt=a(ze);{var We=Ye=>{var me=Mt();S(()=>$(me,`per ${e(G),i(()=>e(G).restType)??""} rest`)),o(Ye,me)};g(tt,Ye=>{e(G),i(()=>e(G).restType)&&Ye(We)})}s(je),S(()=>$(ze,`${e(G),i(()=>e(G).currentUses??e(G).usesPerRest)??""}/${e(G),i(()=>e(G).usesPerRest)??""} uses `)),o(Y,je)};g(ot,Y=>{e(G),i(()=>e(G).usesPerRest)&&Y(vt)})}var ue=a(ot,2);{var L=Y=>{var je=Kn();o(Y,je)};g(ue,Y=>{e(G),i(()=>e(G).requiresReaction)&&Y(L)})}var O=a(ue,2);{var Q=Y=>{var je=Vn();S(()=>je.disabled=(e(G),i(()=>e(G).currentUses===void 0||e(G).currentUses===0))),j("click",je,()=>re(e(G).conditionName,e(G).name)),o(Y,je)};g(O,Y=>{f(),e(G),i(()=>!f()&&e(G).usesPerRest)&&Y(Q)})}s(qe),s(Pe),S(()=>{$(Ue,(e(G),i(()=>e(G).name))),$(Ee,`(${e(G),i(()=>e(G).conditionName)??""})`),$(Xe,(e(G),i(()=>e(G).description)))}),o(oe,Pe)}),s(pe),s(m),o(Le,m)};g(ge,Le=>{e(_),i(()=>e(_).length>0)&&Le(ce)})}var U=a(ge,2),w=a(l(U),4),Ae=a(w,2);{var De=Le=>{var m=Zn();yt(m,5,()=>(t(),i(()=>t().activeStates)),kt,(pe,oe,G)=>{var Pe=Xn(),Ie=l(Pe),Be=l(Ie);Te(Be);var Ue=a(Be,2);{var ve=Ye=>{var me=Qn();j("click",me,()=>ae(G)),o(Ye,me)};g(Ue,Ye=>{f()&&Ye(ve)})}s(Ie);var Ee=a(Ie,2),we=l(Ee),Xe=l(we);lt(Xe,"for",`state-attack-bonus-${G}`);var qe=a(Xe,2);Te(qe),lt(qe,"id",`state-attack-bonus-${G}`),s(we);var ot=a(we,2),vt=l(ot);lt(vt,"for",`state-damage-bonus-${G}`);var ue=a(vt,2);Te(ue),lt(ue,"id",`state-damage-bonus-${G}`),s(ot);var L=a(ot,2),O=l(L);lt(O,"for",`state-target-${G}`);var Q=a(O,2);S(()=>{e(oe),Ht(()=>{})}),lt(Q,"id",`state-target-${G}`);var Y=l(Q);Y.value=Y.__value="self";var je=a(Y);je.value=je.__value="other",s(Q),s(L),s(Ee);var ze=a(Ee,2),tt=l(ze);lt(tt,"for",`state-desc-${G}`);var We=a(tt,2);Te(We),lt(We,"id",`state-desc-${G}`),s(ze),s(Pe),Ge(Be,()=>e(oe).name,Ye=>(e(oe).name=Ye,Ht(()=>t()),La(p,"$character"))),Ge(qe,()=>e(oe).attackBonus,Ye=>(e(oe).attackBonus=Ye,Ht(()=>t()),La(p,"$character"))),Ge(ue,()=>e(oe).damageBonus,Ye=>(e(oe).damageBonus=Ye,Ht(()=>t()),La(p,"$character"))),Ta(Q,()=>e(oe).target,Ye=>(e(oe).target=Ye,Ht(()=>t()),La(p,"$character"))),Ge(We,()=>e(oe).description,Ye=>(e(oe).description=Ye,Ht(()=>t()),La(p,"$character"))),o(pe,Pe)}),s(m),o(Le,m)},Je=Le=>{var m=ei();o(Le,m)};g(Ae,Le=>{t(),i(()=>t().activeStates&&t().activeStates.length>0)?Le(De):Le(Je,!1)})}s(U),j("click",w,Me),o(k,H)};g(mt,k=>{u(),i(()=>!u().attacks)&&k(ct)})}s(Ce);var Ve=a(Ce,2);sn(Ve,{get show(){return e(T)},get attacks(){return t(),i(()=>t().attacks)},onSave:_e,onCancel:fe}),S(()=>Oe=Bt(Ce,1,"attacks svelte-14o91c5",null,Oe,{hidden:!e(K)})),o(n,ne),qt(),D()}var li=d('<span class="slot-checkbox-x svelte-serp1j">&#8212;</span>'),ni=d('<label><input type="checkbox" class="slot-checkbox-input svelte-serp1j"/> <span><!></span></label>');function ks(n,c){Gt(c,!1);const t=()=>dt(ma,"$isEditMode",v),[v,u]=ra();let f=Ct(c,"checked",8,!1),p=Ct(c,"disabled",8,!1),D=Ct(c,"className",8,""),_=Ct(c,"index",8,void 0),h=Ct(c,"ariaLabel",8,void 0);const K=_a();function F(I){K("change",{checked:I.currentTarget.checked,index:_()})}Ot();var re=ni(),te=l(re);Te(te);var z=a(te,2),q=l(z);{var T=I=>{var M=li();o(I,M)};g(q,I=>{f()&&I(T)})}s(z),s(re),S(()=>{Bt(re,1,"slot-checkbox-label "+D()+(t()?"":" not-editable"),"svelte-serp1j"),Bs(te,f()),te.disabled=p()||!t(),lt(te,"aria-label",h()),lt(te,"tabindex",t()?0:-1),Bt(z,1,`slot-checkbox-custom ${f()?"used":""} ${t()?"":"readonly"}`,"svelte-serp1j")}),j("change",te,F),o(n,re),qt(),u()}var ii=d('<span class="spell-type cantrip svelte-19b5nmj">Cantrip</span>'),ri=d('<span class="spell-type svelte-19b5nmj"> </span>'),oi=d('<span class="spell-notes svelte-19b5nmj"> </span>'),ci=d('<button class="btn btn-sm btn-primary use-enabled svelte-19b5nmj">Use</button>'),vi=d('<div class="spell-uses svelte-19b5nmj"><span> </span> <!></div>'),di=d('<div class="spell-uses svelte-19b5nmj"><span class="uses-count unlimited svelte-19b5nmj">At will</span></div>'),ui=d('<span class="rest-type svelte-19b5nmj"> </span>'),fi=d('<span class="spellcasting-ability svelte-19b5nmj"> </span>'),pi=d('<span class="no-components svelte-19b5nmj">No components required</span>'),mi=d('<div class="racial-spell-item svelte-19b5nmj"><div class="spell-info svelte-19b5nmj"><span class="spell-name svelte-19b5nmj"> </span> <!> <!></div> <!> <div class="spell-meta svelte-19b5nmj"><!> <!> <!></div></div>'),gi=d('<div class="racial-spells svelte-19b5nmj"><h5 class="svelte-19b5nmj">Spells:</h5> <div class="racial-spells-list svelte-19b5nmj"></div></div>'),bi=d('<div class="feature-box racial-trait svelte-19b5nmj"><h4 class="svelte-19b5nmj"> </h4> <p class="feature-description svelte-19b5nmj"> </p> <!></div>'),hi=d('<div class="racial-traits-section svelte-19b5nmj"><h3 class="racial-traits-title svelte-19b5nmj">Racial Traits</h3> <!></div>');function _i(n,c){Gt(c,!1);const t=()=>dt(be,"$character",u),v=()=>dt(ma,"$isEditMode",u),[u,f]=ra(),p=C(),D=C(),_=C();let h=C(),K=C();function F(M){ll(M)}function re(M){if(!t().racialTraits)return 0;const xe=t().racialTraits.uses[M];return xe?xe.currentUses:0}function te(M){if(!t().racialTraits)return 0;const xe=t().racialTraits.uses[M];return xe?xe.maxUses:0}function z(M){return M.usesPerRest!==void 0}et(()=>(t(),e(h),e(K),fs),()=>{t().race&&t().level&&(t().race!==e(h)||t().level!==e(K))&&(fs(),r(h,t().race),r(K,t().level))}),et(()=>(t(),ps),()=>{r(p,t().race?ps(t().race):null)}),et(()=>t(),()=>{r(D,ss(t().race,t().level))}),et(()=>(e(p),e(D)),()=>{r(_,e(p)&&e(p).traits&&e(p).traits.length>0&&e(D).length>0)}),ca(),Ot();var q=bt(),T=Re(q);{var I=M=>{var xe=hi(),Qe=a(l(xe),2);yt(Qe,1,()=>(e(p),i(()=>e(p).traits)),kt,(Z,he)=>{var fe=bi(),_e=l(fe),Fe=l(_e,!0);s(_e);var B=a(_e,2),P=l(B,!0);s(B);var x=a(B,2);{var V=b=>{var A=gi(),J=a(l(A),2);yt(J,5,()=>e(D),kt,(Me,ae)=>{var de=mi(),ne=l(de),Ce=l(ne),Oe=l(Ce,!0);s(Ce);var nt=a(Ce,2);{var mt=U=>{var w=ii();o(U,w)},ct=U=>{var w=ri(),Ae=l(w);s(w),S(()=>$(Ae,`Level ${e(ae),i(()=>e(ae).level)??""}`)),o(U,w)};g(nt,U=>{e(ae),i(()=>e(ae).level===0)?U(mt):U(ct,!1)})}var Ve=a(nt,2);{var k=U=>{var w=oi(),Ae=l(w);s(w),S(()=>$(Ae,`(${e(ae),i(()=>e(ae).notes)??""})`)),o(U,w)};g(Ve,U=>{e(ae),i(()=>e(ae).notes)&&U(k)})}s(ne);var H=a(ne,2);{var $e=U=>{const w=_t(()=>(e(ae),i(()=>re(e(ae).name)))),Ae=_t(()=>(e(ae),i(()=>te(e(ae).name))));var De=vi(),Je=l(De);let Le;var m=l(Je);s(Je);var pe=a(Je,2);{var oe=G=>{var Pe=ci();S(()=>{Pe.disabled=e(w)===0,lt(Pe,"aria-label",`Use ${e(ae),i(()=>e(ae).name)??""}`)}),j("click",Pe,()=>F(e(ae).name)),o(G,Pe)};g(pe,G=>{v()||G(oe)})}s(De),S(()=>{Le=Bt(Je,1,"uses-count svelte-19b5nmj",null,Le,{depleted:e(w)===0}),$(m,`${e(w)??""}/${e(Ae)??""} uses`)}),o(U,De)},Se=U=>{var w=di();o(U,w)};g(H,U=>{e(ae),i(()=>z(e(ae)))?U($e):U(Se,!1)})}var y=a(H,2),N=l(y);{var ie=U=>{var w=ui(),Ae=l(w);s(w),S(()=>$(Ae,`Recharges on ${e(ae),i(()=>e(ae).restType==="short"?"Short":"Long")??""} Rest`)),o(U,w)};g(N,U=>{e(ae),i(()=>e(ae).restType)&&U(ie)})}var ye=a(N,2);{var le=U=>{var w=fi(),Ae=l(w);s(w),S(De=>$(Ae,`Spellcasting: ${De??""}`),[()=>(e(he),i(()=>e(he).spellcastingAbility.toUpperCase()))]),o(U,w)};g(ye,U=>{e(he),i(()=>e(he).spellcastingAbility)&&U(le)})}var ge=a(ye,2);{var ce=U=>{var w=pi();o(U,w)};g(ge,U=>{e(he),i(()=>e(he).componentsRequired===!1)&&U(ce)})}s(y),s(de),S(()=>$(Oe,(e(ae),i(()=>e(ae).name)))),o(Me,de)}),s(J),s(A),o(b,A)};g(x,b=>{e(he),e(D),i(()=>e(he).spells&&e(D).length>0)&&b(V)})}s(fe),S(()=>{$(Fe,(e(he),i(()=>e(he).name))),$(P,(e(he),i(()=>e(he).description)))}),o(Z,fe)}),s(xe),o(M,xe)};g(T,M=>{e(_)&&e(p)&&M(I)})}o(n,q),qt(),f()}var yi=d('<p class="no-features svelte-1kpvv0n">Select a class to see available features</p>'),xi=d('<p class="no-features svelte-1kpvv0n">No class features available at this level</p>'),$i=d('<div class="spell-slots svelte-1kpvv0n"><label class="svelte-1kpvv0n"> </label> <div class="slots-tracker svelte-1kpvv0n"></div></div>'),wi=d('<div class="all-spell-slots"></div>'),ki=d('<div class="feature-box spellcasting svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"> </h3> <div class="spell-stats svelte-1kpvv0n"><div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Spell Save DC</label> <div class="spell-value svelte-1kpvv0n"> </div></div> <div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <div class="spell-value svelte-1kpvv0n"> </div></div></div> <!> <div class="prepared-spells svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <textarea placeholder="List your prepared spells..." class="svelte-1kpvv0n"></textarea></div></div>'),Si=d('<p class="unlimited svelte-1kpvv0n">Unlimited Uses</p>'),Ci=d('<div class="slots-tracker svelte-1kpvv0n"></div> <div class="uses-actions-row"><button class="btn btn-primary use-enabled"> </button></div> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div>',1),Di=d('<div class="uses-tracker svelte-1kpvv0n"><!></div>'),Li=d('<div class="pool-tracker svelte-1kpvv0n"><input type="number" min="0" class="pool-input svelte-1kpvv0n"/> <span> </span> <button class="btn-small svelte-1kpvv0n"> </button></div>'),ji=d('<p class="no-uses svelte-1kpvv0n">No Channel Divinity uses remaining</p>'),Ai=d('<div class="channel-divinity-option svelte-1kpvv0n"><button class="btn btn-primary use-enabled svelte-1kpvv0n">Use Channel Divinity</button> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div> <!></div>'),Bi=d('<div class="feature-box svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"><!> </h3> <p class="feature-description svelte-1kpvv0n"> </p> <!></div>'),Ri=d('<div class="features-grid svelte-1kpvv0n"><!> <!></div>'),Ti=d("<!> <!>",1),Mi=d("<section><!> <!></section>");function Fi(n,c){Gt(c,!1);const t=()=>dt(be,"$character",p),v=()=>dt(qa,"$abilityModifiers",p),u=()=>dt(ga,"$searchFilter",p),f=()=>dt(Xt,"$collapsedStates",p),[p,D]=ra(),_=C(),h=C(),K=C(),F=C(),re=C(),te=C(),z=C();let q=C(0),T=C(0);function I(b,A){be.update(J=>(J.classFeatures.features[b]=A,J))}function M(){be.update(b=>(b.classFeatures.spellSlotsByLevel||(b.classFeatures.spellSlotsByLevel={}),e(F).forEach(({level:A,slots:J})=>{b.classFeatures.spellSlotsByLevel[A]||(b.classFeatures.spellSlotsByLevel[A]=Array(J).fill(!1))}),b))}function xe(b){if(typeof b.maxUses=="function"){if((b.name==="Divine Sense"||b.name==="War Priest")&&e(_)?.spellcastingAbility){const A=v()[e(_).spellcastingAbility];return b.maxUses(t().level,A)}return b.maxUses(t().level)}return b.maxUses||0}function Qe(b,A){be.update(J=>((!J.classFeatures.features[b]||!Array.isArray(J.classFeatures.features[b])||J.classFeatures.features[b].length!==A)&&(J.classFeatures.features[b]=Array(A).fill(!1)),J))}Us(()=>{e(te)&&t()&&t().classFeatures&&t().classFeatures.features&&e(te).forEach(b=>{if(b.type==="uses"){const A=b.name.replace(/\s+/g,""),J=xe(b),Me=t().classFeatures.features[A];(!Array.isArray(Me)||Me.length!==J)&&Qe(A,J)}})});function Z(b){return typeof b.maxPool=="function"?b.maxPool(t().level):b.maxPool||0}function he(b){return typeof b.description=="function"?b.description(t().level):b.description}function fe(){const b="ChannelDivinity";be.update(A=>{const J=A.classFeatures.features[b];return typeof J=="number"&&J>0&&(A.classFeatures.features[b]=J-1),A})}function _e(){Xt.update(b=>({...b,classFeatures:!b.classFeatures}))}et(()=>(t(),ia),()=>{r(_,t().class?ia(t().class):null)}),et(()=>(t(),Sa),()=>{r(h,t().class?Sa(t().class,t().level,t().subclass):[])}),et(()=>(t(),ys),()=>{r(K,t().class?ys(t().class,t().level):0)}),et(()=>(e(_),t()),()=>{r(F,(()=>{if(!e(_)?.spellcaster)return[];const b=t().level,A=[];return b>=1&&A.push({level:1,slots:Math.min(4,2+Math.floor(b/3))}),b>=3&&A.push({level:2,slots:Math.min(3,2+Math.floor((b-3)/4))}),b>=5&&A.push({level:3,slots:Math.min(3,2+Math.floor((b-5)/5))}),b>=7&&A.push({level:4,slots:Math.min(3,1+Math.floor((b-7)/6))}),b>=9&&A.push({level:5,slots:Math.min(2,1+Math.floor((b-9)/8))}),b>=11&&A.push({level:6,slots:1}),b>=13&&A.push({level:7,slots:1}),b>=15&&A.push({level:8,slots:1}),b>=17&&A.push({level:9,slots:1}),A})())}),et(()=>(e(_),v(),t(),xs),()=>{if(e(_)?.spellcaster&&e(_).spellcastingAbility){const b=v()[e(_).spellcastingAbility];r(q,_l(t().class,b,t().proficiencyBonus)||0),r(T,xs(t().class,t().level,b))}}),et(()=>(t(),e(_),e(F)),()=>{t().class&&e(_)?.spellcaster&&e(F).length>0&&M()}),et(()=>t(),()=>{r(re,(()=>{const A=t().classFeatures.features["ChannelDivinity"];return typeof A=="number"?A:0})())}),et(()=>(e(h),u()),()=>{r(te,e(h).filter(b=>{if(!u())return!0;const A=u().toLowerCase();return b.name.toLowerCase().includes(A)||he(b).toLowerCase().includes(A)}))}),et(()=>(u(),t(),e(te)),()=>{r(z,!u()||t().class||"class features".includes(u().toLowerCase())||"spellcasting".includes(u().toLowerCase())||e(te).length>0)}),ca(),Ot();var Fe=Mi();let B;var P=l(Fe);{let b=_t(()=>(f(),i(()=>f().classFeatures?"Expand":"Collapse")));ya(P,{title:"Class Features",get collapsed(){return f(),i(()=>f().classFeatures)},get ariaLabel(){return e(b)},onToggle:_e})}var x=a(P,2);{var V=b=>{var A=Ti(),J=Re(A);_i(J,{});var Me=a(J,2);{var ae=ne=>{var Ce=yi();o(ne,Ce)},de=ne=>{var Ce=bt(),Oe=Re(Ce);{var nt=ct=>{var Ve=xi();o(ct,Ve)},mt=ct=>{var Ve=Ri(),k=l(Ve);{var H=Se=>{var y=ki(),N=l(y),ie=l(N);s(N);var ye=a(N,2),le=l(ye),ge=a(l(le),2),ce=l(ge,!0);s(ge),s(le);var U=a(le,2),w=a(l(U),2),Ae=l(w,!0);s(w),s(U),s(ye);var De=a(ye,2);{var Je=pe=>{var oe=wi();yt(oe,5,()=>e(F),kt,(G,Pe)=>{let Ie=()=>e(Pe).level,Be=()=>e(Pe).slots;const Ue=_t(()=>(t(),Ie(),Be(),i(()=>t().classFeatures.spellSlotsByLevel?.[Ie()]||Array(Be()).fill(!1))));var ve=$i(),Ee=l(ve),we=l(Ee);s(Ee);var Xe=a(Ee,2);yt(Xe,5,()=>e(Ue),kt,(qe,ot,vt)=>{{let ue=_t(()=>(X(e(Ue)),i(()=>e(Ue)[vt]||!1)));ks(qe,{get checked(){return e(ue)},$$events:{change:L=>{be.update(O=>(O.classFeatures.spellSlotsByLevel||(O.classFeatures.spellSlotsByLevel={}),O.classFeatures.spellSlotsByLevel[Ie()]||(O.classFeatures.spellSlotsByLevel[Ie()]=Array(Be()).fill(!1)),O.classFeatures.spellSlotsByLevel[Ie()][vt]=L.detail.checked,O))}}})}}),s(Xe),s(ve),S(()=>$(we,`${Ie()===1?"1st":Ie()===2?"2nd":Ie()===3?"3rd":`${Ie()}th`} Level Spell Slots`)),o(G,ve)}),s(oe),o(pe,oe)};g(De,pe=>{e(F),i(()=>e(F).length>0)&&pe(Je)})}var Le=a(De,2),m=a(l(Le),2);xa(m),s(Le),s(y),S(pe=>{$(ie,`Spellcasting (${pe??""})`),$(ce,e(q)),$(Ae,e(T))},[()=>(e(_),i(()=>e(_).spellcastingAbility?.toUpperCase()))]),Ge(m,()=>t().classFeatures.preparedSpells,pe=>Ft(be,i(t).classFeatures.preparedSpells=pe,i(t))),o(Se,y)};g(k,Se=>{e(_),i(()=>e(_)?.spellcaster)&&Se(H)})}var $e=a(k,2);yt($e,1,()=>e(te),kt,(Se,y)=>{const N=_t(()=>(e(y),i(()=>e(y).name.replace(/\s+/g,"")))),ie=_t(()=>(t(),X(e(N)),i(()=>t().classFeatures.features[e(N)]))),ye=_t(()=>typeof e(ie)=="number");var le=Bi(),ge=l(le),ce=l(ge);{var U=pe=>{var oe=Mt("Channel Divinity:");o(pe,oe)};g(ce,pe=>{e(y),i(()=>e(y).type==="channelDivinity")&&pe(U)})}var w=a(ce);s(ge);var Ae=a(ge,2),De=l(Ae,!0);s(Ae);var Je=a(Ae,2);{var Le=pe=>{const oe=_t(()=>(e(y),i(()=>xe(e(y))))),G=_t(()=>(X(e(ie)),X(e(oe)),i(()=>Array.isArray(e(ie))?e(ie):Array(e(oe)).fill(!1))));var Pe=Di(),Ie=l(Pe);{var Be=ve=>{var Ee=Si();o(ve,Ee)},Ue=ve=>{var Ee=Ci(),we=Re(Ee);yt(we,5,()=>e(G),kt,(O,Q,Y)=>{ks(O,{get checked(){return e(Q)},index:Y,$$events:{change:je=>{be.update(ze=>(ze.classFeatures.features[e(N)]||(ze.classFeatures.features[e(N)]=Array(e(oe)).fill(!1)),ze.classFeatures.features[e(N)][Y]=je.detail.checked,ze))}}})}),s(we);var Xe=a(we,2),qe=l(Xe),ot=l(qe);s(qe),s(Xe);var vt=a(Xe,2),ue=l(vt),L=l(ue);s(ue),s(vt),S(O=>{qe.disabled=O,$(ot,`Use ${e(y),i(()=>e(y).name)??""}`),$(L,`Resets on ${e(y),i(()=>e(y).resetOn==="short"?"Short Rest":"Long Rest")??""}`)},[()=>(X(e(G)),i(()=>e(G).filter(O=>!O).length<=0))]),j("click",qe,()=>{be.update(O=>{O.classFeatures.features[e(N)]||(O.classFeatures.features[e(N)]=Array(e(oe)).fill(!1));const Q=O.classFeatures.features[e(N)],Y=Q.findIndex(je=>!je);return Y!==-1&&(Q[Y]=!0),O})}),o(ve,Ee)};g(Ie,ve=>{e(oe)===1/0?ve(Be):ve(Ue,!1)})}s(Pe),o(pe,Pe)},m=pe=>{var oe=bt(),G=Re(oe);{var Pe=Be=>{const Ue=_t(()=>(e(y),i(()=>Z(e(y)))));var ve=Li(),Ee=l(ve);Te(Ee);var we=a(Ee,2),Xe=l(we);s(we);var qe=a(we,2),ot=l(qe,!0);s(qe),s(ve),S(()=>{Ba(Ee,e(ye)&&e(ie)!==void 0?e(ie):e(Ue)),lt(Ee,"max",e(Ue)),$(Xe,`/ ${e(Ue)??""}`),$(ot,(e(y),i(()=>e(y).resetOn==="short"?"Short Rest":"Long Rest")))}),j("input",Ee,vt=>{be.update(ue=>(ue.classFeatures.features[e(N)]=parseInt(vt.currentTarget.value)||0,ue))}),j("click",qe,()=>I(e(N),e(Ue))),o(Be,ve)},Ie=Be=>{var Ue=bt(),ve=Re(Ue);{var Ee=we=>{var Xe=Ai(),qe=l(Xe),ot=a(qe,2),vt=l(ot),ue=l(vt);s(vt),s(ot);var L=a(ot,2);{var O=Q=>{var Y=ji();o(Q,Y)};g(L,Q=>{e(re)<=0&&Q(O)})}s(Xe),S(()=>{qe.disabled=e(re)<=0,$(ue,`Resets on ${e(y),i(()=>e(y).resetOn==="short"?"Short Rest":"Long Rest")??""}`)}),j("click",qe,fe),o(we,Xe)};g(ve,we=>{e(y),i(()=>e(y).type==="channelDivinity")&&we(Ee)},!0)}o(Be,Ue)};g(G,Be=>{e(y),i(()=>e(y).type==="pool")?Be(Pe):Be(Ie,!1)},!0)}o(pe,oe)};g(Je,pe=>{e(y),i(()=>e(y).type==="uses")?pe(Le):pe(m,!1)})}s(le),S(pe=>{$(w,` ${e(y),i(()=>e(y).name)??""}`),$(De,pe)},[()=>(e(y),i(()=>he(e(y))))]),o(Se,le)}),s(Ve),o(ct,Ve)};g(Oe,ct=>{e(h),i(()=>e(h).length===0)?ct(nt):ct(mt,!1)},!0)}o(ne,Ce)};g(Me,ne=>{t(),i(()=>!t().class)?ne(ae):ne(de,!1)})}o(b,A)};g(x,b=>{f(),i(()=>!f().classFeatures)&&b(V)})}s(Fe),S(()=>B=Bt(Fe,1,"class-features svelte-1kpvv0n",null,B,{hidden:!e(z)})),o(n,Fe),qt(),D()}var Pi=d('<textarea placeholder="Enter features, traits, and special abilities..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Equipment</h3> <textarea placeholder="List your equipment and inventory..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Notes</h3> <textarea placeholder="Additional notes..." class="svelte-wttn0l"></textarea>',1),Ii=d("<section><!> <!></section>");function Ei(n,c){Gt(c,!1);const t=()=>dt(ga,"$searchFilter",f),v=()=>dt(be,"$character",f),u=()=>dt(Xt,"$collapsedStates",f),[f,p]=ra(),D=C();function _(){Xt.update(z=>({...z,notes:!z.notes}))}et(()=>(t(),v()),()=>{r(D,!t()||"features".includes(t().toLowerCase())||"traits".includes(t().toLowerCase())||"equipment".includes(t().toLowerCase())||"notes".includes(t().toLowerCase())||v().features.toLowerCase().includes(t().toLowerCase())||v().equipment.toLowerCase().includes(t().toLowerCase())||v().notes.toLowerCase().includes(t().toLowerCase()))}),ca(),Ot();var h=Ii();let K;var F=l(h);{let z=_t(()=>(u(),i(()=>u().notes?"Expand":"Collapse")));ya(F,{title:"Features & Traits",get collapsed(){return u(),i(()=>u().notes)},get ariaLabel(){return e(z)},onToggle:_})}var re=a(F,2);{var te=z=>{var q=Pi(),T=Re(q);xa(T);var I=a(T,4);xa(I);var M=a(I,4);xa(M),Ge(T,()=>v().features,xe=>Ft(be,i(v).features=xe,i(v))),Ge(I,()=>v().equipment,xe=>Ft(be,i(v).equipment=xe,i(v))),Ge(M,()=>v().notes,xe=>Ft(be,i(v).notes=xe,i(v))),o(z,q)};g(re,z=>{u(),i(()=>!u().notes)&&z(te)})}s(h),S(()=>K=Bt(h,1,"notes svelte-wttn0l",null,K,{hidden:!e(D)})),o(n,h),qt(),p()}var Ui=d(" <!> <!> <!> <!> <!>",1),Hi=d('<div class="color-picker-section svelte-1r90jgp"><h3 class="svelte-1r90jgp">Dice Colors</h3> <div class="color-inputs svelte-1r90jgp"><div class="color-input-group svelte-1r90jgp"><label for="dice-color" class="svelte-1r90jgp">Dice Color</label> <input type="color" id="dice-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="label-color" class="svelte-1r90jgp">Label Color</label> <input type="color" id="label-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="desk-color" class="svelte-1r90jgp">Background Color</label> <input type="color" id="desk-color" class="svelte-1r90jgp"/></div></div></div>'),Ni=d('<div class="loading svelte-1r90jgp"><p class="svelte-1r90jgp">Loading 3D dice...</p></div>'),Oi=d('<div class="custom-dice-selector svelte-1r90jgp"><h3 class="svelte-1r90jgp">Choose Dice to Roll</h3> <div class="dice-inputs svelte-1r90jgp"><div class="dice-input-group svelte-1r90jgp"><label for="d4" class="svelte-1r90jgp">d4</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d4" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d6" class="svelte-1r90jgp">d6</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d6" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d8" class="svelte-1r90jgp">d8</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d8" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d10" class="svelte-1r90jgp">d10</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d10" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d12" class="svelte-1r90jgp">d12</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d12" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d20" class="svelte-1r90jgp">d20</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d20" min="0" max="10"/></div></div> <div class="dice-controls svelte-1r90jgp"><button class="btn btn-primary use-enabled svelte-1r90jgp"> </button> <button class="btn btn-secondary use-enabled svelte-1r90jgp">Reset</button></div></div>'),Gi=d('<h3 class="svelte-1r90jgp"> </h3>'),qi=d('<h3 class="svelte-1r90jgp"> </h3>'),zi=d('<h3 class="svelte-1r90jgp"> </h3>'),Wi=d('<h3 class="svelte-1r90jgp"> </h3>'),Ki=d('<span class="crit-badge svelte-1r90jgp">CRITICAL HIT!</span>'),Vi=d('<span class="crit-badge crit-fail svelte-1r90jgp">CRITICAL MISS!</span>'),Ji=d('<div class="bonus-item svelte-1r90jgp"><span class="bonus-value svelte-1r90jgp"> </span> <span class="bonus-source svelte-1r90jgp"> </span></div>'),Yi=d('<div class="bonus-breakdown svelte-1r90jgp"></div>'),Qi=d('<p class="modifier-text svelte-1r90jgp"> </p>'),Xi=d('<div class="svelte-1r90jgp"><em class="svelte-1r90jgp">No damage is dealt on a critical miss.</em></div>'),Zi=d('<button class="btn btn-follow-up svelte-1r90jgp"> </button>'),er=d('<button class="btn btn-guided-strike svelte-1r90jgp">‚ö° Use Guided Strike (+10)</button>'),tr=d('<div class="follow-up-actions svelte-1r90jgp"><!> <!></div>'),ar=d('<div class="result-header svelte-1r90jgp"><!> <!> <!></div> <div class="result-total svelte-1r90jgp"> </div> <div class="result-details svelte-1r90jgp"><!></div> <!> <!>',1),sr=d('<div role="button" tabindex="-1"><div class="modal-content svelte-1r90jgp" role="dialog" tabindex="0"><div class="modal-header svelte-1r90jgp"><h2 class="svelte-1r90jgp"><!></h2> <div class="header-buttons svelte-1r90jgp"><button class="color-btn svelte-1r90jgp" title="Customize dice colors">üé®</button> <button class="close-btn svelte-1r90jgp">√ó</button></div></div> <!> <!> <div class="dice-main-area svelte-1r90jgp"><div class="dice-container svelte-1r90jgp"></div> <!></div> <div><!></div></div></div>');function lr(n,c){Gt(c,!1);const t=()=>dt(be,"$character",v),[v,u]=ra(),f=C(),p=C(),D=C(),_=_a();let h=Ct(c,"notation",12,""),K=Ct(c,"visible",8,!1),F=Ct(c,"damageNotation",12,""),re=Ct(c,"damageType",8,""),te=Ct(c,"attackName",12,""),z=Ct(c,"applyHalfDamage",8,!1),q=Ct(c,"bonusBreakdown",28,()=>[]),T=Ct(c,"rollType",12,"other"),I=null,M=C(void 0),xe=C(!1),Qe=C(""),Z=C(null);function he(){return e(Z)?.resultTotal??null}function fe(L,O,Q){const Y=[];if(!L||!L.result)return Y;const je=O.match(/([+-]?\d*d\d+|[+-]?\d+)/g)||[];let ze=0;const tt=new Set;for(const We of je){const Ye=We.trim();if(!Ye)continue;const me=Ye.match(/([+-]?)(\d*)d(\d+)/);if(me){const W=parseInt(me[2]||"1"),Ne=`${W}d${me[3]}`,ut=Q.findIndex((se,Dt)=>!tt.has(Dt)&&typeof se.value=="string"&&se.value===Ne),Ze=[];for(let se=0;se<W&&ze<L.result.length;se++)Ze.push(L.result[ze++]);const at=ut>=0?Q[ut].source:"base die";ut>=0&&tt.add(ut);for(const se of Ze)Y.push({display:`${se}`,source:at})}}for(let We=0;We<Q.length;We++)if(!tt.has(We)&&typeof Q[We].value=="number"){const Ye=Q[We].value;Y.push({display:Ye>=0?`+${Ye}`:`${Ye}`,source:Q[We].source})}return Y}let _e=C(0),Fe=C(0),B=C(0),P=C(0),x=C(0),V=C(0),b=C(0),A=C([]),J=C(!1),Me=C(!1),ae=C(!1),de=C("#051e0a"),ne=C("#ffffff"),Ce=C("#3a2004"),Oe=C(!1);function nt(L){return L.length===9&&L.startsWith("#")?L.substring(0,7):L}function mt(L,O="ff"){return L.length===7&&L.startsWith("#")?L+O:L}function ct(){if(window.DICE&&e(M))try{I&&e(M)&&pa(M,e(M).innerHTML="");const L=e(M).clientWidth||500,O=e(M).clientHeight||300;I=new window.DICE.dice_box(e(M),{w:L,h:O}),r(xe,!0)}catch(L){console.error("Error initializing dice box:",L)}}$a(()=>{const L=Y=>new Promise((je,ze)=>{if(document.querySelector(`script[src="${Y}"]`)){je(null);return}const We=document.createElement("script");We.src=Y,We.onload=()=>{je(null)},We.onerror=()=>{console.error(`Failed to load: ${Y}`),ze(new Error(`Failed to load ${Y}`))},document.head.appendChild(We)});setTimeout(()=>{L(`${ja}/libs/three.min.js`).then(()=>L(`${ja}/libs/cannon.min.js`)).then(()=>L(`${ja}/libs/teal.js`)).then(()=>L(`${ja}/dice.js`)).then(()=>{if(window.DICE){const Y=window.DICE.getColors();r(de,nt(Y.dice_color)),r(ne,nt(Y.label_color)),r(Ce,nt(Y.desk_color))}ct()}).catch(Y=>{console.error("Failed to load dice libraries:",Y)})},100);const O=()=>{e(xe)&&ct()},Q=Y=>{K()&&Y.key==="Escape"&&ye()};return window.addEventListener("resize",O),window.addEventListener("keydown",Q),()=>{window.removeEventListener("resize",O),window.removeEventListener("keydown",Q)}});function Ve(L,O="other"){if(!I||!e(xe))return;r(Z,null),r(A,[]),r(J,!1),r(Me,!1),O==="damage"&&q([]),T(O),r(ae,!1),I.diceToRoll=L;const Q=je=>null,Y=je=>{let ze=je.resultTotal,tt=je.resultString;if(z()&&(ze=Math.floor(ze/2),tt=tt+" (halved)"),r(Z,{...je,resultTotal:ze,resultString:tt}),console.log("Final roll result:",e(Z)),console.log({type:O}),O==="attack"&&je.result&&je.result.length>0){const We=je.result[0];r(J,We===20),r(Me,We===1)}if(r(A,[]),console.log("Setting up follow-up actions. Type:",O,"damageNotation:",F(),"isCriticalSuccess:",e(J),"isCriticalFail:",e(Me)),O==="attack"&&F())if(e(J)){const We=$e(F());e(A).push({label:`Roll Critical Damage (${We})`,notation:We})}else e(Me)||e(A).push({label:`Roll Damage (${F()})`,notation:F()})};I.start_throw(Q,Y)}function k(){const L=[];e(_e)>0&&L.push(`${e(_e)}d4`),e(Fe)>0&&L.push(`${e(Fe)}d6`),e(B)>0&&L.push(`${e(B)}d8`),e(P)>0&&L.push(`${e(P)}d10`),e(x)>0&&L.push(`${e(x)}d12`),e(V)>0&&L.push(`${e(V)}d20`);let O=L.join("+")||"1d20";return e(b)!==0&&(O+=e(b)>=0?`+${e(b)}`:`${e(b)}`),O}function H(){const L=k();Ve(L)}function $e(L){return L.replace(/(\d+)d(\d+)/g,(O,Q,Y)=>`${parseInt(Q)*2}d${Y}`)}function Se(){r(_e,0),r(Fe,0),r(B,0),r(P,0),r(x,0),r(V,0),r(b,0),r(Z,null),r(A,[]),r(J,!1),r(Me,!1),T("other"),r(ae,!1)}function y(){window.DICE&&(window.DICE.setColors({dice_color:mt(e(de),"ff"),label_color:mt(e(ne),"ff"),desk_color:e(Ce)}),I&&(I.updateDeskColor(e(Ce)),I.updateDiceColors()))}function N(){r(Oe,!e(Oe))}function ie(){!e(Z)||e(p)<=0||e(ae)||(r(Z,{...e(Z),resultTotal:e(Z).resultTotal+10,resultString:e(Z).resultString+" + 10 (Guided Strike)"}),be.update(L=>{const O="ChannelDivinity",Q=L.classFeatures.features[O];return typeof Q=="number"&&Q>0&&(L.classFeatures.features[O]=Q-1),L}),r(ae,!0))}function ye(){_("close"),h(""),F(""),te(""),r(Qe,""),r(Z,null),r(ae,!1),r(J,!1),r(Me,!1),Se()}et(()=>(t(),Sa),()=>{r(f,t().class?Sa(t().class,t().level,t().subclass).some(O=>O.name==="Guided Strike"):!1)}),et(()=>t(),()=>{r(p,(()=>{const O=t().classFeatures.features["ChannelDivinity"];return typeof O=="number"?O:0})())}),et(()=>(e(_e),e(Fe),e(B),e(P),e(x),e(V),e(b)),()=>{r(D,(()=>{const L=[];e(_e)>0&&L.push(`${e(_e)}d4`),e(Fe)>0&&L.push(`${e(Fe)}d6`),e(B)>0&&L.push(`${e(B)}d8`),e(P)>0&&L.push(`${e(P)}d10`),e(x)>0&&L.push(`${e(x)}d12`),e(V)>0&&L.push(`${e(V)}d20`);let O=L.join("+")||"1d20";return e(b)!==0&&(O+=e(b)>=0?`+${e(b)}`:`${e(b)}`),O})())}),et(()=>(X(h()),e(xe),X(K()),e(Qe),X(F()),X(te()),X(T())),()=>{h()&&e(xe)&&K()&&h()!==e(Qe)&&(r(Qe,h()),r(Z,null),r(A,[]),r(J,!1),r(Me,!1),r(ae,!1),console.log("Auto-roll triggered. notation:",h(),"damageNotation:",F(),"attackName:",te(),"rollType:",T()),setTimeout(()=>Ve(h(),T()),200))}),ca();var le={getLastRollTotal:he};Ot();var ge=sr();let ce;var U=l(ge),w=l(U),Ae=l(w),De=l(Ae);{var Je=L=>{var O=Ui(),Q=Re(O),Y=a(Q);{var je=Ze=>{var at=Mt("- Attack Roll");o(Ze,at)};g(Y,Ze=>{T()==="attack"&&Ze(je)})}var ze=a(Y,2);{var tt=Ze=>{var at=Mt("- Damage Roll");o(Ze,at)};g(ze,Ze=>{T()==="damage"&&Ze(tt)})}var We=a(ze,2);{var Ye=Ze=>{var at=Mt("- Healing Roll");o(Ze,at)};g(We,Ze=>{T()==="healing"&&Ze(Ye)})}var me=a(We,2);{var W=Ze=>{var at=Mt("- Ability Check");o(Ze,at)};g(me,Ze=>{T()==="check"&&Ze(W)})}var Ne=a(me,2);{var ut=Ze=>{var at=Mt("- Saving Throw");o(Ze,at)};g(Ne,Ze=>{T()==="save"&&Ze(ut)})}S(()=>$(Q,`${te()??""} `)),o(L,O)},Le=L=>{var O=Mt("Dice Roller");o(L,O)};g(De,L=>{te()?L(Je):L(Le,!1)})}s(Ae);var m=a(Ae,2),pe=l(m),oe=a(pe,2);s(m),s(w);var G=a(w,2);{var Pe=L=>{var O=Hi(),Q=a(l(O),2),Y=l(Q),je=a(l(Y),2);Te(je),s(Y);var ze=a(Y,2),tt=a(l(ze),2);Te(tt),s(ze);var We=a(ze,2),Ye=a(l(We),2);Te(Ye),s(We),s(Q),s(O),Ge(je,()=>e(de),me=>r(de,me)),j("change",je,y),Ge(tt,()=>e(ne),me=>r(ne,me)),j("change",tt,y),Ge(Ye,()=>e(Ce),me=>r(Ce,me)),j("change",Ye,y),o(L,O)};g(G,L=>{e(Oe)&&L(Pe)})}var Ie=a(G,2);{var Be=L=>{var O=Ni();o(L,O)};g(Ie,L=>{e(xe)||L(Be)})}var Ue=a(Ie,2),ve=l(Ue);Ra(ve,L=>r(M,L),()=>e(M));var Ee=a(ve,2);{var we=L=>{var O=Oi(),Q=a(l(O),2),Y=l(Q),je=a(l(Y),2);Te(je),s(Y);var ze=a(Y,2),tt=a(l(ze),2);Te(tt),s(ze);var We=a(ze,2),Ye=a(l(We),2);Te(Ye),s(We);var me=a(We,2),W=a(l(me),2);Te(W),s(me);var Ne=a(me,2),ut=a(l(Ne),2);Te(ut),s(Ne);var Ze=a(Ne,2),at=a(l(Ze),2);Te(at),s(Ze),s(Q);var se=a(Q,2),Dt=l(se),E=l(Dt);s(Dt);var Ke=a(Dt,2);s(se),s(O),S(()=>{Dt.disabled=!e(xe),$(E,`Roll ${e(D)??""}`)}),Ge(je,()=>e(_e),ee=>r(_e,ee)),Ge(tt,()=>e(Fe),ee=>r(Fe,ee)),Ge(Ye,()=>e(B),ee=>r(B,ee)),Ge(W,()=>e(P),ee=>r(P,ee)),Ge(ut,()=>e(x),ee=>r(x,ee)),Ge(at,()=>e(V),ee=>r(V,ee)),j("click",Dt,H),j("click",Ke,Se),o(L,O)};g(Ee,L=>{h()||L(we)})}s(Ue);var Xe=a(Ue,2);let qe;var ot=l(Xe);{var vt=L=>{var O=ar(),Q=Re(O),Y=l(Q);{var je=ee=>{var He=Gi(),R=l(He,!0);s(He),S(()=>$(R,te()?`${te()} - Healing`:"Healing")),o(ee,He)},ze=ee=>{var He=bt(),R=Re(He);{var xt=st=>{var ke=qi(),ft=l(ke,!0);s(ke),S(()=>$(ft,te()?`${te()} - ${re()} Damage`:`${re()} Damage`)),o(st,ke)},ht=st=>{var ke=bt(),ft=Re(ke);{var it=rt=>{var pt=zi(),St=l(pt,!0);s(pt),S(()=>$(St,te()?`${te()} - Damage`:"Damage")),o(rt,pt)},Rt=rt=>{var pt=Wi(),St=l(pt,!0);s(pt),S(()=>$(St,te()?`${te()} - Result`:"Result")),o(rt,pt)};g(ft,rt=>{T()==="damage"?rt(it):rt(Rt,!1)},!0)}o(st,ke)};g(R,st=>{T()==="damage"&&re()?st(xt):st(ht,!1)},!0)}o(ee,He)};g(Y,ee=>{T()==="damage"&&re()==="Healing"?ee(je):ee(ze,!1)})}var tt=a(Y,2);{var We=ee=>{var He=Ki();o(ee,He)};g(tt,ee=>{e(J)&&ee(We)})}var Ye=a(tt,2);{var me=ee=>{var He=Vi();o(ee,He)};g(Ye,ee=>{e(Me)&&ee(me)})}s(Q);var W=a(Q,2),Ne=l(W,!0);s(W);var ut=a(W,2),Ze=l(ut);{var at=ee=>{var He=bt(),R=Re(He);{var xt=st=>{var ke=Yi();yt(ke,5,()=>(e(Z),X(h()),X(q()),i(()=>fe(e(Z),h(),q()))),kt,(ft,it)=>{var Rt=Ji(),rt=l(Rt),pt=l(rt,!0);s(rt);var St=a(rt,2),Jt=l(St);s(St),s(Rt),S(()=>{$(pt,(e(it),i(()=>e(it).display))),$(Jt,`(${e(it),i(()=>e(it).source)??""})`)}),o(ft,Rt)}),s(ke),o(st,ke)},ht=st=>{var ke=bt(),ft=Re(ke);{var it=Rt=>{var rt=Qi(),pt=l(rt);s(rt),S(()=>$(pt,`Modifier: ${e(Z),i(()=>e(Z).constant>=0?"+":"")??""}${e(Z),i(()=>e(Z).constant)??""}`)),o(Rt,rt)};g(ft,Rt=>{e(Z),i(()=>e(Z).constant)&&Rt(it)},!0)}o(st,ke)};g(R,st=>{X(q()),i(()=>q().length>0)?st(xt):st(ht,!1)})}o(ee,He)};g(Ze,ee=>{e(Z),X(q()),i(()=>e(Z).constant||q().length>0)&&ee(at)})}s(ut);var se=a(ut,2);{var Dt=ee=>{var He=Xi();o(ee,He)};g(se,ee=>{e(Me)&&ee(Dt)})}var E=a(se,2);{var Ke=ee=>{var He=tr(),R=l(He);yt(R,1,()=>e(A),kt,(st,ke)=>{var ft=Zi(),it=l(ft,!0);s(ft),S(()=>$(it,(e(ke),i(()=>e(ke).label)))),j("click",ft,()=>Ve(e(ke).notation,"damage")),o(st,ft)});var xt=a(R,2);{var ht=st=>{var ke=er();S(()=>{ke.disabled=e(p)<=0,lt(ke,"title",e(p)<=0?"No Channel Divinity uses remaining":"Use Channel Divinity to add +10 to this attack roll")}),j("click",ke,ie),o(st,ke)};g(xt,st=>{e(f)&&T()==="attack"&&!e(ae)&&e(p)>0&&!e(Me)&&st(ht)})}s(He),o(ee,He)};g(E,ee=>{e(A),e(f),X(T()),e(ae),e(p),i(()=>e(A).length>0||e(f)&&T()==="attack"&&!e(ae)&&e(p)>0)&&ee(Ke)})}S(()=>$(Ne,(e(Z),i(()=>e(Z).resultTotal)))),o(L,O)};g(ot,L=>{e(Z)&&L(vt)})}s(Xe),s(U),s(ge),S(()=>{ce=Bt(ge,1,"modal-overlay svelte-1r90jgp",null,ce,{hidden:!K()}),qe=Bt(Xe,1,"roll-result svelte-1r90jgp",null,qe,{"has-result":e(Z)})}),j("click",pe,N),j("click",oe,ye),j("click",U,vs(function(L){ka.call(this,c,L)})),j("keydown",U,function(L){ka.call(this,c,L)}),j("click",ge,ye),j("keydown",ge,L=>L.key==="Escape"&&ye()),o(n,ge),bl(c,"getLastRollTotal",he);var ue=qt(le);return u(),ue}const za="https://api.github.com/gists";async function nr(n,c,t){if(!c)throw new Error("GitHub token is required");const v=JSON.stringify(n,null,2),u=`${n.name||"character"}_dnd.json`,f={description:t||`D&D Character: ${n.name}`,public:!1,files:{[u]:{content:v}}},p=await fetch(za,{method:"POST",headers:{Authorization:`token ${c}`,"Content-Type":"application/json"},body:JSON.stringify(f)});if(!p.ok)throw new Error(`Failed to create gist: ${p.statusText}`);return(await p.json()).id}async function ir(n,c,t){if(!c||!t)throw new Error("GitHub token and Gist ID are required");const v=JSON.stringify(n,null,2),f={files:{[`${n.name||"character"}_dnd.json`]:{content:v}}},p=await fetch(`${za}/${t}`,{method:"PATCH",headers:{Authorization:`token ${c}`,"Content-Type":"application/json"},body:JSON.stringify(f)});if(!p.ok)throw new Error(`Failed to update gist: ${p.statusText}`)}async function rr(n,c){if(!n)throw new Error("Gist ID is required");const t={"Content-Type":"application/json"};c&&(t.Authorization=`token ${c}`);const v=await fetch(`${za}/${n}`,{method:"GET",headers:t});if(!v.ok)throw new Error(`Failed to load gist: ${v.statusText}`);const u=await v.json(),f=Object.values(u.files);if(f.length===0)throw new Error("No files found in gist");const D=f[0].content;try{const _=JSON.parse(D);return _.attacks&&Array.isArray(_.attacks)&&(_.attacks=_.attacks.map(h=>({...h,id:h.id||crypto.randomUUID()}))),_.classFeatures?(_.classFeatures.features||(_.classFeatures.features={}),_.classFeatures.spellSlots||(_.classFeatures.spellSlots=[]),_.classFeatures.preparedSpells===void 0&&(_.classFeatures.preparedSpells="")):_.classFeatures={features:{},spellSlots:[],preparedSpells:""},_}catch{throw new Error("Invalid character data in gist")}}function Ss(n){typeof window<"u"&&localStorage.setItem("dnd_gist_config",JSON.stringify(n))}function or(){if(typeof window<"u"){const n=localStorage.getItem("dnd_gist_config");if(n)return JSON.parse(n)}return{}}async function cr(n,c=30){if(!n)throw new Error("GitHub token is required to list gists");const t=await fetch(`${za}?per_page=${c}`,{method:"GET",headers:{Authorization:`token ${n}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error(`Failed to list gists: ${t.statusText}`);return await t.json()}var vr=d('<div class="error-message svelte-1jb5ckg"> </div>'),dr=d('<div class="toggle-container svelte-1jb5ckg"><button type="button" class="toggle-btn svelte-1jb5ckg"> </button></div>'),ur=d('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID (leave empty to create new)</label> <input type="text" id="gistId" placeholder="Optional: existing Gist ID to update" class="svelte-1jb5ckg"/></div>'),fr=d('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),pr=d('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),mr=d('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Update (or leave unselected to create new)</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),gr=d('<div class="info-message svelte-1jb5ckg">No gists found. A new one will be created.</div>'),br=d('<!> <div class="form-group svelte-1jb5ckg"><label for="description" class="svelte-1jb5ckg"> </label> <input type="text" id="description" placeholder="D&amp;D Character Sheet" class="svelte-1jb5ckg"/></div>',1),hr=d('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID *</label> <input type="text" id="gistId" placeholder="Enter Gist ID (for public or your private gists)" required class="svelte-1jb5ckg"/></div>'),_r=d('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),yr=d('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),xr=d('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Load</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),$r=d('<div class="info-message svelte-1jb5ckg">No gists found. Enter a Gist ID manually or create a new one in Save mode.</div>'),wr=d('<div class="modal-overlay svelte-1jb5ckg" role="button" tabindex="-1"><div class="modal-content svelte-1jb5ckg" role="dialog" tabindex="0"><div class="modal-header svelte-1jb5ckg"><h2 class="svelte-1jb5ckg"> </h2> <button class="close-btn svelte-1jb5ckg">√ó</button></div> <div class="modal-body svelte-1jb5ckg"><!> <div class="form-group svelte-1jb5ckg"><label for="token" class="svelte-1jb5ckg"> <a href="https://github.com/settings/tokens" target="_blank" rel="noopener" class="svelte-1jb5ckg">Get token</a></label> <input type="password" id="token" placeholder="ghp_xxxxxxxxxxxxx" class="svelte-1jb5ckg"/></div> <!> <!> <div class="modal-actions svelte-1jb5ckg"><button class="btn btn-primary svelte-1jb5ckg"><!></button> <button class="btn btn-secondary svelte-1jb5ckg">Cancel</button></div></div></div></div>');function kr(n,c){Gt(c,!1);const t=()=>dt(be,"$character",v),[v,u]=ra(),f=_a();let p=Ct(c,"mode",8,"save"),D=C(""),_=C(""),h=C(""),K=C(!1),F=C(""),re=C(!1),te=C(!1),z=C([]),q=C(null);const T=or();T.token&&r(D,T.token),T.gistId&&r(_,T.gistId),$a(async()=>{e(D)&&!e(re)&&await I()});async function I(){if(e(D)){r(te,!0),r(F,"");try{r(z,await cr(e(D))),e(_)&&r(q,e(z).find(y=>y.id===e(_))||null)}catch(y){r(F,y.message||"Failed to load gists"),r(z,[])}finally{r(te,!1)}}}function M(y){r(q,y),r(_,y.id)}function xe(){r(re,!e(re)),r(F,""),!e(re)&&e(D)&&I()}async function Qe(){if(!e(D)){r(F,"GitHub token is required");return}const y=e(q)?.id||e(_);r(K,!0),r(F,"");try{if(y)await ir(t(),e(D),y),r(_,y),Nt.add("Character updated in Gist successfully!","success");else{const N=await nr(t(),e(D),e(h));r(_,N),Nt.add(`Character saved to Gist! ID: ${N}`,"success")}Ss({token:e(D),gistId:e(_)}),f("close")}catch(N){r(F,N.message||"Failed to save to Gist")}finally{r(K,!1)}}async function Z(){const y=e(q)?.id||e(_);if(!y){r(F,"Please select a gist or enter a Gist ID");return}r(K,!0),r(F,"");try{const N=await rr(y,e(D)||void 0);be.set(N),r(_,y),Ss({token:e(D),gistId:e(_)}),Nt.add("Character loaded from Gist successfully!","success"),f("close")}catch(N){r(F,N.message||"Failed to load from Gist")}finally{r(K,!1)}}function he(){f("close")}Ot();var fe=wr(),_e=l(fe),Fe=l(_e),B=l(Fe),P=l(B,!0);s(B);var x=a(B,2);s(Fe);var V=a(Fe,2),b=l(V);{var A=y=>{var N=vr(),ie=l(N,!0);s(N),S(()=>$(ie,e(F))),o(y,N)};g(b,y=>{e(F)&&y(A)})}var J=a(b,2),Me=l(J),ae=l(Me);Qt(),s(Me);var de=a(Me,2);Te(de),s(J);var ne=a(J,2);{var Ce=y=>{var N=dr(),ie=l(N),ye=l(ie,!0);s(ie),s(N),S(()=>{ie.disabled=e(K),$(ye,e(re)?"üìã Show My Gists":"‚úèÔ∏è Enter Gist ID Manually")}),j("click",ie,xe),o(y,N)};g(ne,y=>{(p()==="load"||p()==="save"&&e(D))&&y(Ce)})}var Oe=a(ne,2);{var nt=y=>{var N=br(),ie=Re(N);{var ye=Ae=>{var De=ur(),Je=a(l(De),2);Te(Je),s(De),S(()=>Je.disabled=e(K)),Ge(Je,()=>e(_),Le=>r(_,Le)),o(Ae,De)},le=Ae=>{var De=bt(),Je=Re(De);{var Le=pe=>{var oe=fr();o(pe,oe)},m=pe=>{var oe=bt(),G=Re(oe);{var Pe=Be=>{var Ue=mr(),ve=a(l(Ue),2);yt(ve,5,()=>e(z),kt,(Ee,we)=>{var Xe=pr();let qe;var ot=l(Xe),vt=l(ot),ue=l(vt,!0);s(vt);var L=a(vt,2),O=l(L,!0);s(L),s(ot);var Q=a(ot,2),Y=l(Q),je=l(Y);s(Y);var ze=a(Y,2),tt=l(ze);s(ze),s(Q),s(Xe),S(We=>{qe=Bt(Xe,1,"gist-item svelte-1jb5ckg",null,qe,{selected:e(q)?.id===e(we).id}),Xe.disabled=e(K),$(ue,(e(we),i(()=>e(we).description||"Untitled"))),$(O,(e(we),i(()=>e(we).public?"üåê Public":"üîí Private"))),$(je,`ID: ${e(we),i(()=>e(we).id)??""}`),$(tt,`Updated: ${We??""}`)},[()=>(e(we),i(()=>new Date(e(we).updated_at).toLocaleDateString()))]),j("click",Xe,()=>M(e(we))),o(Ee,Xe)}),s(ve),s(Ue),o(Be,Ue)},Ie=Be=>{var Ue=bt(),ve=Re(Ue);{var Ee=we=>{var Xe=gr();o(we,Xe)};g(ve,we=>{e(D)&&we(Ee)},!0)}o(Be,Ue)};g(G,Be=>{e(z),i(()=>e(z).length>0)?Be(Pe):Be(Ie,!1)},!0)}o(pe,oe)};g(Je,pe=>{e(te)?pe(Le):pe(m,!1)},!0)}o(Ae,De)};g(ie,Ae=>{e(re)||!e(D)?Ae(ye):Ae(le,!1)})}var ge=a(ie,2),ce=l(ge),U=l(ce);s(ce);var w=a(ce,2);Te(w),s(ge),S(()=>{$(U,`Description ${e(_)?"(optional)":""}`),w.disabled=e(K)}),Ge(w,()=>e(h),Ae=>r(h,Ae)),o(y,N)},mt=y=>{var N=bt(),ie=Re(N);{var ye=ge=>{var ce=hr(),U=a(l(ce),2);Te(U),s(ce),S(()=>U.disabled=e(K)),Ge(U,()=>e(_),w=>r(_,w)),o(ge,ce)},le=ge=>{var ce=bt(),U=Re(ce);{var w=De=>{var Je=_r();o(De,Je)},Ae=De=>{var Je=bt(),Le=Re(Je);{var m=oe=>{var G=xr(),Pe=a(l(G),2);yt(Pe,5,()=>e(z),kt,(Ie,Be)=>{var Ue=yr();let ve;var Ee=l(Ue),we=l(Ee),Xe=l(we,!0);s(we);var qe=a(we,2),ot=l(qe,!0);s(qe),s(Ee);var vt=a(Ee,2),ue=l(vt),L=l(ue);s(ue);var O=a(ue,2),Q=l(O);s(O),s(vt),s(Ue),S(Y=>{ve=Bt(Ue,1,"gist-item svelte-1jb5ckg",null,ve,{selected:e(q)?.id===e(Be).id}),Ue.disabled=e(K),$(Xe,(e(Be),i(()=>e(Be).description||"Untitled"))),$(ot,(e(Be),i(()=>e(Be).public?"üåê Public":"üîí Private"))),$(L,`ID: ${e(Be),i(()=>e(Be).id)??""}`),$(Q,`Updated: ${Y??""}`)},[()=>(e(Be),i(()=>new Date(e(Be).updated_at).toLocaleDateString()))]),j("click",Ue,()=>M(e(Be))),o(Ie,Ue)}),s(Pe),s(G),o(oe,G)},pe=oe=>{var G=bt(),Pe=Re(G);{var Ie=Be=>{var Ue=$r();o(Be,Ue)};g(Pe,Be=>{e(D)&&Be(Ie)},!0)}o(oe,G)};g(Le,oe=>{e(z),i(()=>e(z).length>0)?oe(m):oe(pe,!1)},!0)}o(De,Je)};g(U,De=>{e(te)?De(w):De(Ae,!1)},!0)}o(ge,ce)};g(ie,ge=>{e(re)||!e(D)?ge(ye):ge(le,!1)},!0)}o(y,N)};g(Oe,y=>{p()==="save"?y(nt):y(mt,!1)})}var ct=a(Oe,2),Ve=l(ct),k=l(Ve);{var H=y=>{var N=Mt();S(()=>$(N,p()==="save"?"Saving...":"Loading...")),o(y,N)},$e=y=>{var N=Mt();S(()=>$(N,p()==="save"?"Save":"Load")),o(y,N)};g(k,y=>{e(K)?y(H):y($e,!1)})}s(Ve);var Se=a(Ve,2);s(ct),s(V),s(_e),s(fe),S(()=>{$(P,p()==="save"?"Save to GitHub Gist":"Load from GitHub Gist"),$(ae,`GitHub Token ${p()==="load"?"(optional for public gists)":"(required)"} `),de.disabled=e(K),Ve.disabled=e(K),Se.disabled=e(K)}),j("click",x,he),Ge(de,()=>e(D),y=>r(D,y)),j("blur",de,()=>{e(D)&&!e(re)&&I()}),j("click",Ve,function(...y){(p()==="save"?Qe:Z)?.apply(this,y)}),j("click",Se,he),j("click",_e,vs(function(y){ka.call(this,c,y)})),j("keydown",_e,function(y){ka.call(this,c,y)}),j("click",fe,he),j("keydown",fe,y=>y.key==="Escape"&&he()),o(n,fe),qt(),u()}var Sr=d('<div class="loading svelte-1ngjemu">Loading D&D data...</div>'),Cr=d("<option> </option>"),Dr=d('<select class="level-filter svelte-1ngjemu"><option>All Levels</option><option>Cantrip</option><!></select>'),Lr=d('<div class="no-results svelte-1ngjemu"> </div>'),jr=d('<div class="item-meta svelte-1ngjemu"> </div>'),Ar=d('<div class="item-meta svelte-1ngjemu"> </div>'),Br=d('<button><div class="item-name svelte-1ngjemu"> </div> <!></button>'),Rr=d('<p class="higher-levels"><strong>At Higher Levels:</strong> </p>'),Tr=d('<p class="cantrip-upgrade"><strong>Cantrip Upgrade:</strong> </p>'),Mr=d('<h3 class="svelte-1ngjemu"> </h3> <p class="spell-meta svelte-1ngjemu"><!> <!></p> <p class="spell-classes"><strong>Classes:</strong> </p> <div class="spell-stats svelte-1ngjemu"><div><strong>Casting Time:</strong> </div> <div><strong>Range:</strong> </div> <div><strong>Components:</strong> <!></div> <div><strong>Duration:</strong> <!> </div></div> <p class="description svelte-1ngjemu"> </p> <!> <!>',1),Fr=d('<p class="prerequisite svelte-1ngjemu"><strong>Prerequisite:</strong> </p>'),Pr=d('<h3 class="svelte-1ngjemu"> </h3> <!> <p class="description svelte-1ngjemu"> </p> <a target="_blank" rel="noopener" class="source-link svelte-1ngjemu">View Full Details ‚Üí</a>',1),Ir=d('<div class="item-details svelte-1ngjemu"><!></div>'),Er=d('<div class="controls svelte-1ngjemu"><div class="tabs svelte-1ngjemu"><button> </button> <button> </button></div> <div class="search-controls svelte-1ngjemu"><input type="text" placeholder="Search by name or description..." class="search-input svelte-1ngjemu"/> <!></div></div> <div class="content-container svelte-1ngjemu"><div class="items-list svelte-1ngjemu"><!></div> <!></div>',1),Ur=d('<div class="modal-backdrop svelte-1ngjemu" role="presentation"><div class="modal svelte-1ngjemu" role="dialog" aria-modal="true" tabindex="-1"><div class="modal-header svelte-1ngjemu"><h2 class="svelte-1ngjemu">Browse D&D Spells & Feats</h2> <button class="close-btn svelte-1ngjemu" aria-label="Close">&times;</button></div> <div class="modal-body svelte-1ngjemu"><!></div> <div class="modal-footer svelte-1ngjemu"><button class="btn-secondary svelte-1ngjemu">Cancel</button> <button class="btn-primary svelte-1ngjemu">Add to Character Sheet</button></div></div></div>');function Hr(n,c){Gt(c,!1);const t=C(),v=C(),u=C();let f=Ct(c,"onClose",8),p=C("spell"),D=C(!0),_=C(""),h=C(null),K=C([]),F=C([]),re=C(null);$a(async()=>{r(D,!0);try{r(K,await Fs()),r(F,await ln())}catch(x){console.error("Failed to load data:",x)}finally{r(D,!1)}});function te(x){r(re,x)}function z(x){const V=x.match(/(\d+d\d+(?:\s*\+\s*\d+)?)/i);return V?V[1]:""}function q(x){const V=x.split(/\.( |$)/)[0].trim(),b=Array.from(x.matchAll(/\*\*(.*?)\*\*/g)).map(J=>J[1].replace(/\.$/,""));let A=V;return b.length&&(A+=" | Effects: "+b.join(", ")),A}function T(){if(e(re)){if(e(p)==="spell"){const x=e(re);be.update(V=>{const A=[];x.range&&A.push(`Range: ${x.range}`),x.castingTime&&A.push(`Cast: ${x.castingTime}`),x.duration&&A.push(`Duration: ${x.duration}`),x.actionType==="Save"&&A.push("Saving throw spell"),x.components&&x.components.length>0&&A.push(`Components: ${x.components.join(", ")}`),x.material&&A.push(`Material: ${x.material}`);const J=A.join(" | "),Me=q(x.description),ae={id:crypto.randomUUID(),name:`${x.name}${x.concentration?" (C)":""}${x.ritual?" (R)":""}`,bonus:x.actionType==="Attack"?5:0,damage:z(x.description),damageType:`${x.school} (Lvl ${x.level})`,spellRef:x.name,infoNotes:J,generalNotes:Me,castAtLevel:x.level};return V.attacks=[...V.attacks,ae],V})}else if(e(p)==="feat"){const x=e(re);be.update(V=>{const b=`${x.name}${x.prerequisite?` (Req: ${x.prerequisite})`:""}
${x.description}
`;return V.features=V.features?`${V.features}
${b}`:b,V})}r(re,null),f()()}}et(()=>(e(h),e(K),e(_)),()=>{r(t,e(h)!==null?nn($s(e(K),e(_)),e(h)):$s(e(K),e(_)))}),et(()=>(e(F),e(_)),()=>{r(v,rn(e(F),e(_)))}),et(()=>(e(p),e(t),e(v)),()=>{r(u,e(p)==="spell"?e(t):e(v))}),ca(),Ot();var I=Ur(),M=l(I),xe=l(M),Qe=a(l(xe),2);s(xe);var Z=a(xe,2),he=l(Z);{var fe=x=>{var V=Sr();o(x,V)},_e=x=>{var V=Er(),b=Re(V),A=l(b),J=l(A);let Me;var ae=l(J);s(J);var de=a(J,2);let ne;var Ce=l(de);s(de),s(A);var Oe=a(A,2),nt=l(Oe);Te(nt);var mt=a(nt,2);{var ct=ie=>{var ye=Dr();S(()=>{e(h),Ht(()=>{})});var le=l(ye);le.value=(le.__value=null)??"";var ge=a(le);ge.value=ge.__value=0;var ce=a(ge);yt(ce,0,()=>[1,2,3,4,5,6,7,8,9],kt,(U,w)=>{var Ae=Cr(),De=l(Ae);s(Ae);var Je={};S(()=>{$(De,`Level ${w??""}`),Je!==(Je=w)&&(Ae.value=(Ae.__value=w)??"")}),o(U,Ae)}),s(ye),Ta(ye,()=>e(h),U=>r(h,U)),o(ie,ye)};g(mt,ie=>{e(p)==="spell"&&ie(ct)})}s(Oe),s(b);var Ve=a(b,2),k=l(Ve),H=l(k);{var $e=ie=>{var ye=Lr(),le=l(ye);s(ye),S(()=>$(le,`No ${e(p)??""}s found`)),o(ie,ye)},Se=ie=>{var ye=bt(),le=Re(ye);yt(le,1,()=>e(u),kt,(ge,ce)=>{var U=Br();let w;var Ae=l(U),De=l(Ae,!0);s(Ae);var Je=a(Ae,2);{var Le=pe=>{const oe=_t(()=>e(ce));var G=jr(),Pe=l(G);s(G),S(()=>$(Pe,`Level ${X(e(oe)),i(()=>e(oe).level)??""} ‚Ä¢ ${X(e(oe)),i(()=>e(oe).school)??""}`)),o(pe,G)},m=pe=>{const oe=_t(()=>e(ce));var G=bt(),Pe=Re(G);{var Ie=Be=>{var Ue=Ar(),ve=l(Ue,!0);s(Ue),S(()=>$(ve,(X(e(oe)),i(()=>e(oe).prerequisite)))),o(Be,Ue)};g(Pe,Be=>{X(e(oe)),i(()=>e(oe).prerequisite)&&Be(Ie)})}o(pe,G)};g(Je,pe=>{e(p)==="spell"?pe(Le):pe(m,!1)})}s(U),S(()=>{w=Bt(U,1,"item-card svelte-1ngjemu",null,w,{selected:e(re)?.name===e(ce).name}),$(De,(e(ce),i(()=>e(ce).name)))}),j("click",U,()=>te(e(ce))),o(ge,U)}),o(ie,ye)};g(H,ie=>{e(u),i(()=>e(u).length===0)?ie($e):ie(Se,!1)})}s(k);var y=a(k,2);{var N=ie=>{var ye=Ir(),le=l(ye);{var ge=U=>{const w=_t(()=>e(re));var Ae=Mr(),De=Re(Ae),Je=l(De,!0);s(De);var Le=a(De,2),m=l(Le);{var pe=W=>{var Ne=Mt();S(()=>$(Ne,`${X(e(w)),i(()=>e(w).school)??""} cantrip`)),o(W,Ne)},oe=W=>{var Ne=Mt();S(()=>$(Ne,`Level ${X(e(w)),i(()=>e(w).level)??""} ${X(e(w)),i(()=>e(w).school)??""}`)),o(W,Ne)};g(m,W=>{X(e(w)),i(()=>e(w).level===0)?W(pe):W(oe,!1)})}var G=a(m,2);{var Pe=W=>{var Ne=Mt("(ritual)");o(W,Ne)};g(G,W=>{X(e(w)),i(()=>e(w).ritual)&&W(Pe)})}s(Le);var Ie=a(Le,2),Be=a(l(Ie));s(Ie);var Ue=a(Ie,2),ve=l(Ue),Ee=a(l(ve));s(ve);var we=a(ve,2),Xe=a(l(we));s(we);var qe=a(we,2),ot=a(l(qe)),vt=a(ot);{var ue=W=>{var Ne=Mt();S(()=>$(Ne,`(${X(e(w)),i(()=>e(w).material)??""})`)),o(W,Ne)};g(vt,W=>{X(e(w)),i(()=>e(w).material)&&W(ue)})}s(qe);var L=a(qe,2),O=a(l(L),2);{var Q=W=>{var Ne=Mt("Concentration,");o(W,Ne)};g(O,W=>{X(e(w)),i(()=>e(w).concentration)&&W(Q)})}var Y=a(O,1,!0);s(L),s(Ue);var je=a(Ue,2),ze=l(je,!0);s(je);var tt=a(je,2);{var We=W=>{var Ne=Rr(),ut=a(l(Ne));s(Ne),S(()=>$(ut,` ${X(e(w)),i(()=>e(w).higherLevelSlot)??""}`)),o(W,Ne)};g(tt,W=>{X(e(w)),i(()=>e(w).higherLevelSlot)&&W(We)})}var Ye=a(tt,2);{var me=W=>{var Ne=Tr(),ut=a(l(Ne));s(Ne),S(()=>$(ut,` ${X(e(w)),i(()=>e(w).cantripUpgrade)??""}`)),o(W,Ne)};g(Ye,W=>{X(e(w)),i(()=>e(w).cantripUpgrade)&&W(me)})}S((W,Ne)=>{$(Je,(X(e(w)),i(()=>e(w).name))),$(Be,` ${W??""}`),$(Ee,` ${X(e(w)),i(()=>e(w).castingTime||e(w).actionType)??""}`),$(Xe,` ${X(e(w)),i(()=>e(w).range)??""}`),$(ot,` ${Ne??""}`),$(Y,(X(e(w)),i(()=>e(w).duration))),$(ze,(X(e(w)),i(()=>e(w).description)))},[()=>(X(e(w)),i(()=>e(w).classes.join(", "))),()=>(X(e(w)),i(()=>e(w).components.join(", ").toUpperCase()))]),o(U,Ae)},ce=U=>{const w=_t(()=>e(re));var Ae=Pr(),De=Re(Ae),Je=l(De,!0);s(De);var Le=a(De,2);{var m=Pe=>{var Ie=Fr(),Be=a(l(Ie));s(Ie),S(()=>$(Be,` ${X(e(w)),i(()=>e(w).prerequisite)??""}`)),o(Pe,Ie)};g(Le,Pe=>{X(e(w)),i(()=>e(w).prerequisite)&&Pe(m)})}var pe=a(Le,2),oe=l(pe,!0);s(pe);var G=a(pe,2);S(()=>{$(Je,(X(e(w)),i(()=>e(w).name))),$(oe,(X(e(w)),i(()=>e(w).description))),lt(G,"href",(X(e(w)),i(()=>e(w).source)))}),o(U,Ae)};g(le,U=>{e(p)==="spell"?U(ge):U(ce,!1)})}s(ye),o(ie,ye)};g(y,ie=>{e(re)&&ie(N)})}s(Ve),S(()=>{Me=Bt(J,1,"tab svelte-1ngjemu",null,Me,{active:e(p)==="spell"}),$(ae,`üìú Spells (${e(K),i(()=>e(K).length)??""})`),ne=Bt(de,1,"tab svelte-1ngjemu",null,ne,{active:e(p)==="feat"}),$(Ce,`‚≠ê Feats (${e(F),i(()=>e(F).length)??""})`)}),j("click",J,()=>{r(p,"spell"),r(re,null),r(_,"")}),j("click",de,()=>{r(p,"feat"),r(re,null),r(_,"")}),Ge(nt,()=>e(_),ie=>r(_,ie)),o(x,V)};g(he,x=>{e(D)?x(fe):x(_e,!1)})}s(Z);var Fe=a(Z,2),B=l(Fe),P=a(B,2);s(Fe),s(M),s(I),S(()=>P.disabled=!e(re)),j("click",Qe,function(...x){f()?.apply(this,x)}),j("click",B,function(...x){f()?.apply(this,x)}),j("click",P,T),j("click",M,vs(function(x){ka.call(this,c,x)})),j("keydown",M,function(x){ka.call(this,c,x)}),j("click",I,function(...x){f()?.apply(this,x)}),j("keydown",I,x=>x.key==="Escape"&&f()()),o(n,I),qt()}var Nr=d('<span class="resistance-tag svelte-gdwwx1"> <button type="button" class="tag-remove svelte-gdwwx1">√ó</button></span>'),Or=d('<div class="resistance-list svelte-gdwwx1"></div>'),Gr=d('<p class="ability-meta svelte-gdwwx1"> <!></p>'),qr=d('<p class="ability-meta svelte-gdwwx1">Requires Reaction</p>'),zr=d('<div class="ability-card svelte-gdwwx1"><div class="ability-header svelte-gdwwx1"><strong class="svelte-gdwwx1"> </strong> <button type="button" class="ability-remove svelte-gdwwx1">√ó</button></div> <p class="ability-description svelte-gdwwx1"> </p> <!></div>'),Wr=d('<div class="abilities-list svelte-gdwwx1"></div>'),Kr=d(`<div class="modal-backdrop svelte-gdwwx1" role="presentation"><div class="modal-content svelte-gdwwx1" role="dialog" aria-modal="true" aria-labelledby="modal-title"><div class="modal-header svelte-gdwwx1"><h3 id="modal-title" class="svelte-gdwwx1">Add Custom Condition</h3> <button class="btn-close svelte-gdwwx1" aria-label="Close">√ó</button></div> <div class="modal-body svelte-gdwwx1"><div class="form-group svelte-gdwwx1"><label for="conditionName" class="svelte-gdwwx1">Condition Name*</label> <input type="text" id="conditionName" placeholder="e.g., Cazna's Mark" class="svelte-gdwwx1"/></div> <div class="form-group svelte-gdwwx1"><label for="description" class="svelte-gdwwx1">Description</label> <textarea id="description" placeholder="Describe the condition..." rows="3" class="svelte-gdwwx1"></textarea></div> <div class="form-row svelte-gdwwx1"><div class="form-group svelte-gdwwx1"><label for="attackBonus" class="svelte-gdwwx1">Attack Bonus</label> <input type="text" id="attackBonus" placeholder="0 or 1d4" class="svelte-gdwwx1"/></div> <div class="form-group svelte-gdwwx1"><label for="damageBonus" class="svelte-gdwwx1">Damage Bonus</label> <input type="text" id="damageBonus" placeholder="0 or 1d6" class="svelte-gdwwx1"/></div> <div class="form-group svelte-gdwwx1"><label for="acBonus" class="svelte-gdwwx1">AC Bonus</label> <input type="number" id="acBonus" placeholder="0" class="svelte-gdwwx1"/></div></div> <div class="form-group svelte-gdwwx1"><label for="darkvision" class="svelte-gdwwx1">Darkvision (feet)</label> <input type="number" id="darkvision" placeholder="0" min="0" step="30" class="svelte-gdwwx1"/> <small class="help-text svelte-gdwwx1">Grant or extend darkvision (e.g., 60 for 60 feet)</small></div> <div class="form-group svelte-gdwwx1"><label class="svelte-gdwwx1">Damage Resistances</label> <div class="resistance-input-group svelte-gdwwx1"><input type="text" placeholder="e.g., cold, fire, poison" class="svelte-gdwwx1"/> <button type="button" class="btn-add svelte-gdwwx1">Add</button></div> <!></div> <div class="form-group svelte-gdwwx1"><label class="svelte-gdwwx1">Special Abilities</label> <div class="ability-form svelte-gdwwx1"><input type="text" placeholder="Ability name (e.g., Flicker of Deceit)" class="ability-name-input svelte-gdwwx1"/> <textarea placeholder="Ability description..." rows="2" class="ability-desc-input svelte-gdwwx1"></textarea> <div class="ability-options svelte-gdwwx1"><div class="ability-option svelte-gdwwx1"><label for="abilityUses" class="svelte-gdwwx1">Uses per rest</label> <input type="number" id="abilityUses" min="0" class="svelte-gdwwx1"/></div> <div class="ability-option svelte-gdwwx1"><label for="restType" class="svelte-gdwwx1">Rest type</label> <select id="restType" class="svelte-gdwwx1"><option>Short</option><option>Long</option></select></div> <div class="ability-option svelte-gdwwx1"><label class="svelte-gdwwx1"><input type="checkbox" class="svelte-gdwwx1"/> Requires Reaction</label></div></div> <button type="button" class="btn-add svelte-gdwwx1">Add Ability</button></div> <!></div></div> <div class="modal-footer svelte-gdwwx1"><button class="btn btn-secondary svelte-gdwwx1">Cancel</button> <button class="btn btn-primary svelte-gdwwx1">Add Condition</button></div></div></div>`);function Vr(n,c){Gt(c,!1);let t=Ct(c,"show",8,!1),v=Ct(c,"onSave",8),u=Ct(c,"onCancel",8),f=C(""),p=C(""),D=C(0),_=C(0),h=C(0),K=C(0),F=C([]),re=C(""),te=C([]),z=C(""),q=C(""),T=C(0),I=C("short"),M=C(!1);function xe(){r(f,""),r(p,""),r(D,0),r(_,0),r(h,0),r(K,0),r(F,[]),r(re,""),r(te,[]),r(z,""),r(q,""),r(T,0),r(I,"short"),r(M,!1)}function Qe(){e(re).trim()&&(r(F,[...e(F),e(re).trim()]),r(re,""))}function Z(b){r(F,e(F).filter((A,J)=>J!==b))}function he(){if(e(z).trim()&&e(q).trim()){const b={name:e(z).trim(),description:e(q).trim(),requiresReaction:e(M)};e(T)>0&&(b.usesPerRest=e(T),b.currentUses=e(T),b.restType=e(I)),r(te,[...e(te),b]),r(z,""),r(q,""),r(T,0),r(I,"short"),r(M,!1)}}function fe(b){r(te,e(te).filter((A,J)=>J!==b))}function _e(){if(!e(f).trim()){alert("Please enter a condition name");return}const b={name:e(f).trim(),description:e(p).trim()||"Custom condition",attackBonus:e(D)||0,damageBonus:e(_)||0,target:"self"};e(h)!==0&&(b.acBonus=e(h)),e(K)>0&&(b.darkvision=e(K)),e(F).length>0&&(b.resistances=e(F)),e(te).length>0&&(b.abilities=e(te)),v()(b),xe()}function Fe(){xe(),u()()}function B(b){b.target===b.currentTarget&&Fe()}Ot();var P=bt(),x=Re(P);{var V=b=>{var A=Kr(),J=l(A),Me=l(J),ae=a(l(Me),2);s(Me);var de=a(Me,2),ne=l(de),Ce=a(l(ne),2);Te(Ce),s(ne);var Oe=a(ne,2),nt=a(l(Oe),2);xa(nt),s(Oe);var mt=a(Oe,2),ct=l(mt),Ve=a(l(ct),2);Te(Ve),s(ct);var k=a(ct,2),H=a(l(k),2);Te(H),s(k);var $e=a(k,2),Se=a(l($e),2);Te(Se),s($e),s(mt);var y=a(mt,2),N=a(l(y),2);Te(N),Qt(2),s(y);var ie=a(y,2),ye=a(l(ie),2),le=l(ye);Te(le);var ge=a(le,2);s(ye);var ce=a(ye,2);{var U=ue=>{var L=Or();yt(L,5,()=>e(F),kt,(O,Q,Y)=>{var je=Nr(),ze=l(je),tt=a(ze);s(je),S(()=>{$(ze,`${e(Q)??""} `),lt(tt,"aria-label",`Remove ${e(Q)??""}`)}),j("click",tt,()=>Z(Y)),o(O,je)}),s(L),o(ue,L)};g(ce,ue=>{e(F),i(()=>e(F).length>0)&&ue(U)})}s(ie);var w=a(ie,2),Ae=a(l(w),2),De=l(Ae);Te(De);var Je=a(De,2);xa(Je);var Le=a(Je,2),m=l(Le),pe=a(l(m),2);Te(pe),s(m);var oe=a(m,2),G=a(l(oe),2);S(()=>{e(I),Ht(()=>{})});var Pe=l(G);Pe.value=Pe.__value="short";var Ie=a(Pe);Ie.value=Ie.__value="long",s(G),s(oe);var Be=a(oe,2),Ue=l(Be),ve=l(Ue);Te(ve),Qt(),s(Ue),s(Be),s(Le);var Ee=a(Le,2);s(Ae);var we=a(Ae,2);{var Xe=ue=>{var L=Wr();yt(L,5,()=>e(te),kt,(O,Q,Y)=>{var je=zr(),ze=l(je),tt=l(ze),We=l(tt,!0);s(tt);var Ye=a(tt,2);s(ze);var me=a(ze,2),W=l(me,!0);s(me);var Ne=a(me,2);{var ut=at=>{var se=Gr(),Dt=l(se),E=a(Dt);{var Ke=ee=>{var He=Mt("‚Ä¢ Requires Reaction");o(ee,He)};g(E,ee=>{e(Q),i(()=>e(Q).requiresReaction)&&ee(Ke)})}s(se),S(()=>$(Dt,`${e(Q),i(()=>e(Q).usesPerRest)??""} use${e(Q),i(()=>e(Q).usesPerRest>1?"s":"")??""} per ${e(Q),i(()=>e(Q).restType)??""}
                      rest `)),o(at,se)},Ze=at=>{var se=bt(),Dt=Re(se);{var E=Ke=>{var ee=qr();o(Ke,ee)};g(Dt,Ke=>{e(Q),i(()=>e(Q).requiresReaction)&&Ke(E)},!0)}o(at,se)};g(Ne,at=>{e(Q),i(()=>e(Q).usesPerRest)?at(ut):at(Ze,!1)})}s(je),S(()=>{$(We,(e(Q),i(()=>e(Q).name))),lt(Ye,"aria-label",`Remove ${e(Q),i(()=>e(Q).name)??""}`),$(W,(e(Q),i(()=>e(Q).description)))}),j("click",Ye,()=>fe(Y)),o(O,je)}),s(L),o(ue,L)};g(we,ue=>{e(te),i(()=>e(te).length>0)&&ue(Xe)})}s(w),s(de);var qe=a(de,2),ot=l(qe),vt=a(ot,2);s(qe),s(J),s(A),j("click",ae,Fe),Ge(Ce,()=>e(f),ue=>r(f,ue)),Ge(nt,()=>e(p),ue=>r(p,ue)),Ge(Ve,()=>e(D),ue=>r(D,ue)),Ge(H,()=>e(_),ue=>r(_,ue)),Ge(Se,()=>e(h),ue=>r(h,ue)),Ge(N,()=>e(K),ue=>r(K,ue)),Ge(le,()=>e(re),ue=>r(re,ue)),j("keydown",le,ue=>ue.key==="Enter"&&Qe()),j("click",ge,Qe),Ge(De,()=>e(z),ue=>r(z,ue)),Ge(Je,()=>e(q),ue=>r(q,ue)),Ge(pe,()=>e(T),ue=>r(T,ue)),Ta(G,()=>e(I),ue=>r(I,ue)),wa(ve,()=>e(M),ue=>r(M,ue)),j("click",Ee,he),j("click",ot,Fe),j("click",vt,_e),j("click",A,B),o(b,A)};g(x,b=>{t()&&b(V)})}o(n,P),qt()}var Jr=d("<option></option>"),Yr=d("<button> </button>"),Qr=d('<button class="btn btn-primary calculate-btn use-enabled svelte-uvfntf">Calculate Damage</button>'),Xr=d('<div class="adjustment-msg svelte-uvfntf"> </div>'),Zr=d('<div class="calculation-result svelte-uvfntf"><div class="result-header svelte-uvfntf"><h4 class="svelte-uvfntf">Damage Calculation</h4></div> <div class="result-content svelte-uvfntf"><div class="damage-breakdown svelte-uvfntf"><div class="damage-row svelte-uvfntf"><span class="label svelte-uvfntf">Original Damage:</span> <span class="value svelte-uvfntf"> </span></div> <div class="adjustments svelte-uvfntf"></div> <div class="damage-row final svelte-uvfntf"><span class="label svelte-uvfntf">Final Damage:</span> <span class="value damage-value svelte-uvfntf"> </span></div></div></div> <div class="result-actions svelte-uvfntf"><button class="btn btn-primary apply-btn use-enabled svelte-uvfntf">Apply Damage</button> <button class="btn btn-secondary cancel-btn use-enabled svelte-uvfntf">Cancel</button></div></div>'),eo=d('<div class="damage-form svelte-uvfntf"><div class="input-group svelte-uvfntf"><div class="input-field svelte-uvfntf"><label for="damageAmount" class="svelte-uvfntf">Damage Amount</label> <input type="number" id="damageAmount" min="0" placeholder="0" class="damage-input-field use-enabled svelte-uvfntf"/></div> <div class="input-field svelte-uvfntf"><label for="damageType" class="svelte-uvfntf">Damage Type</label> <input type="text" id="damageType" list="damageTypes" placeholder="e.g., fire, cold" class="damage-input-field use-enabled svelte-uvfntf"/> <datalist id="damageTypes"></datalist></div></div> <div class="quick-types svelte-uvfntf"><span class="quick-types-label svelte-uvfntf">Quick Select:</span> <!></div> <!></div>'),to=d("<section><!> <!></section>");function ao(n,c){Gt(c,!1);const t=()=>dt(be,"$character",f),v=()=>dt(ga,"$searchFilter",f),u=()=>dt(Xt,"$collapsedStates",f),[f,p]=ra(),D=C();_a();let _=C(0),h=C(""),K=C(!1),F=C(0),re=C([]);const te=["slashing","piercing","bludgeoning","fire","cold","lightning","thunder","acid","poison","necrotic","radiant","psychic","force"];function z(){if(e(_)<0){Nt.add("Damage amount cannot be negative","error");return}if(!e(h).trim()){Nt.add("Please enter or select a damage type","error");return}const he=Pl(e(_),e(h),t());r(F,he.finalDamage),r(re,he.adjustments),r(K,!0)}function q(){be.update(he=>Il(he,e(F))),Nt.add(`Applied ${e(F)} damage to character (${e(h)})`,"info"),r(_,0),r(h,""),r(K,!1),r(F,0),r(re,[])}function T(){r(K,!1),r(F,0),r(re,[])}et(()=>v(),()=>{r(D,!v()||"damage".includes(v().toLowerCase())||"resistance".includes(v().toLowerCase())||"immune".includes(v().toLowerCase()))}),ca(),Ot();var I=to();let M;var xe=l(I);{let he=_t(()=>(u(),i(()=>u().damageInput?"Expand":"Collapse")));ya(xe,{title:"Apply Damage",get collapsed(){return u(),i(()=>u().damageInput)},get ariaLabel(){return e(he)},onToggle:()=>Xt.update(fe=>({...fe,damageInput:!fe.damageInput}))})}var Qe=a(xe,2);{var Z=he=>{var fe=eo(),_e=l(fe),Fe=l(_e),B=a(l(Fe),2);Te(B),s(Fe);var P=a(Fe,2),x=a(l(P),2);Te(x);var V=a(x,2);yt(V,5,()=>te,kt,(de,ne)=>{var Ce=Jr(),Oe={};S(()=>{Oe!==(Oe=e(ne))&&(Ce.value=(Ce.__value=e(ne))??"")}),o(de,Ce)}),s(V),s(P),s(_e);var b=a(_e,2),A=a(l(b),2);yt(A,1,()=>te,kt,(de,ne)=>{var Ce=Yr();let Oe;var nt=l(Ce,!0);s(Ce),S(()=>{Oe=Bt(Ce,1,"quick-type-btn use-enabled svelte-uvfntf",null,Oe,{active:e(h)===e(ne)}),$(nt,e(ne))}),j("click",Ce,()=>r(h,e(ne))),o(de,Ce)}),s(b);var J=a(b,2);{var Me=de=>{var ne=Qr();j("click",ne,z),o(de,ne)},ae=de=>{var ne=Zr(),Ce=a(l(ne),2),Oe=l(Ce),nt=l(Oe),mt=a(l(nt),2),ct=l(mt);s(mt),s(nt);var Ve=a(nt,2);yt(Ve,5,()=>e(re),kt,(ie,ye)=>{var le=Xr(),ge=l(le,!0);s(le),S(()=>$(ge,e(ye))),o(ie,le)}),s(Ve);var k=a(Ve,2),H=a(l(k),2),$e=l(H,!0);s(H),s(k),s(Oe),s(Ce);var Se=a(Ce,2),y=l(Se),N=a(y,2);s(Se),s(ne),S(()=>{$(ct,`${e(_)??""} ${e(h)??""}`),$($e,e(F))}),j("click",y,q),j("click",N,T),o(de,ne)};g(J,de=>{e(K)?de(ae,!1):de(Me)})}s(fe),Ge(B,()=>e(_),de=>r(_,de)),Ge(x,()=>e(h),de=>r(h,de)),o(he,fe)};g(Qe,he=>{u(),i(()=>!u().damageInput)&&he(Z)})}s(I),S(()=>M=Bt(I,1,"damage-input svelte-uvfntf",null,M,{hidden:!e(D)})),o(n,I),qt(),p()}var so=d('<button class="console-toggle svelte-x96uf"> </button>'),lo=d('<div class="no-logs svelte-x96uf">No console messages yet</div>'),no=d('<div><span class="log-timestamp svelte-x96uf"> </span> <span class="log-type svelte-x96uf"> </span> <span class="log-message svelte-x96uf"> </span></div>'),io=d('<div class="console-content svelte-x96uf"><!></div>'),ro=d('<div><div class="console-header svelte-x96uf"><span class="console-title svelte-x96uf"> </span> <div class="console-controls svelte-x96uf"><button class="control-btn svelte-x96uf"> </button> <button class="control-btn svelte-x96uf">üóëÔ∏è</button> <button class="control-btn svelte-x96uf">‚úï</button></div></div> <!></div>'),oo=d('<div class="console-viewer svelte-x96uf"><!> <!></div>');function co(n,c){Gt(c,!1);let t=C([]),v=C(!1),u=C(!1);$a(()=>{const z=console.log;console.log=function(...M){f("log",M),z.apply(console,M)};const q=console.error;console.error=function(...M){f("error",M),q.apply(console,M)};const T=console.warn;console.warn=function(...M){f("warn",M),T.apply(console,M)};const I=console.info;return console.info=function(...M){f("info",M),I.apply(console,M)},window.addEventListener("error",M=>{f("error",[`Uncaught Error: ${M.message} at ${M.filename}:${M.lineno}:${M.colno}`])}),window.addEventListener("unhandledrejection",M=>{f("error",[`Unhandled Promise Rejection: ${M.reason}`])}),()=>{console.log=z,console.error=q,console.warn=T,console.info=I}});function f(z,q){const T=q.map(M=>{if(typeof M=="object")try{return JSON.stringify(M,null,2)}catch{return String(M)}return String(M)}).join(" "),I=new Date().toLocaleTimeString();r(t,[...e(t),{type:z,message:T,timestamp:I}]),e(t).length>100&&r(t,e(t).slice(-100))}function p(){r(t,[])}function D(){r(v,!e(v))}function _(){r(u,!e(u))}Ot();var h=oo(),K=l(h);{var F=z=>{var q=so(),T=l(q);s(q),S(()=>$(T,`üêõ Console (${e(t).length??""})`)),j("click",q,D),o(z,q)};g(K,z=>{e(v)||z(F)})}var re=a(K,2);{var te=z=>{var q=ro();let T;var I=l(q),M=l(I),xe=l(M);s(M);var Qe=a(M,2),Z=l(Qe),he=l(Z,!0);s(Z);var fe=a(Z,2),_e=a(fe,2);s(Qe),s(I);var Fe=a(I,2);{var B=P=>{var x=io(),V=l(x);{var b=J=>{var Me=lo();o(J,Me)},A=J=>{var Me=bt(),ae=Re(Me);yt(ae,1,()=>e(t),kt,(de,ne)=>{var Ce=no(),Oe=l(Ce),nt=l(Oe,!0);s(Oe);var mt=a(Oe,2),ct=l(mt);s(mt);var Ve=a(mt,2),k=l(Ve,!0);s(Ve),s(Ce),S(H=>{Bt(Ce,1,`log-entry ${e(ne).type??""}`,"svelte-x96uf"),$(nt,e(ne).timestamp),$(ct,`[${H??""}]`),$(k,e(ne).message)},[()=>e(ne).type.toUpperCase()]),o(de,Ce)}),o(J,Me)};g(V,J=>{e(t).length===0?J(b):J(A,!1)})}s(x),o(P,x)};g(Fe,P=>{e(u)||P(B)})}s(q),S(()=>{T=Bt(q,1,"console-panel svelte-x96uf",null,T,{minimized:e(u)}),$(xe,`üêõ Console Logs (${e(t).length??""})`),$(he,e(u)?"‚ñ≤":"‚ñº")}),j("click",Z,_),j("click",fe,p),j("click",_e,D),o(z,q)};g(re,z=>{e(v)&&z(te)})}s(h),o(n,h),qt()}var vo=d('<link rel="icon" type="image/png" href="favicon4.png"/> <meta name="viewport" content="width=device-width, initial-scale=1"/>',1),uo=d('<span class="character-name svelte-1uha8ag"> </span>'),fo=d("<span> </span>"),po=d('<div class="spell-slots-header svelte-1uha8ag"></div>'),mo=d("<span> </span><br/>",1),go=d("<span> </span><br/>",1),bo=d("<span> </span><br/>",1),ho=d("<span> </span><br/>",1),_o=d("<span> </span><br/>",1),yo=d("<span> </span><br/>",1),xo=d("<br/><em> <!>)</em>",1),$o=d("<br/><em>(requires reaction)</em>",1),wo=d('<div class="ability-detail"><strong> </strong> <!></div>'),ko=d('<div class="abilities-section"><strong>Abilities:</strong><br/> <!></div>'),So=d('<span class="effect-tooltip"><strong> </strong><br/> <br/> <!> <!> <!> <!> <!> <!> <!></span>'),Co=d('<button class="effect-remove-btn svelte-1uha8ag">√ó</button>'),Do=d('<span class="effect-badge svelte-1uha8ag" tabindex="0"> <!> <!></span>'),Lo=d(`<div class="active-effects-header svelte-1uha8ag"></div> <style>.effect-badge {
              position: relative;
            }
            .effect-tooltip {
              position: absolute;
              top: 120%;
              left: 50%;
              transform: translateX(-50%);
              background: #fff;
              color: #222;
              border: 1px solid #a5b4fc;
              border-radius: 6px;
              padding: 8px 12px;
              font-size: 0.95em;
              box-shadow: 0 2px 8px rgba(0, 0, 0, 0.12);
              z-index: 10;
              min-width: 180px;
              max-width: 300px;
              white-space: normal;
              pointer-events: none;
              opacity: 1;
              transition: opacity 0.15s;
            }

            .abilities-section {
              margin-top: 8px;
              padding-top: 8px;
              border-top: 1px solid #e5e7eb;
            }

            .ability-detail {
              margin-top: 6px;
              padding: 4px;
              background: #f9fafb;
              border-radius: 4px;
              font-size: 0.9em;
            }

            .ability-detail strong {
              color: #6366f1;
            }

            .ability-detail em {
              font-size: 0.85em;
              color: #6b7280;
            }</style>`,1),jo=d('<div class="rest-menu svelte-1uha8ag"><button class="rest-option svelte-1uha8ag">‚òï Short Rest</button> <button class="rest-option svelte-1uha8ag">üõèÔ∏è Long Rest</button></div>'),Ao=d('<div class="container svelte-1uha8ag"><header class="svelte-1uha8ag"><div class="header-top svelte-1uha8ag"><div class="header-title svelte-1uha8ag"><div class="title-row svelte-1uha8ag"><h1 class="svelte-1uha8ag">D&D Character Sheet</h1> <!></div> <!> <!></div> <div class="header-right svelte-1uha8ag"><div class="header-controls svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">üé≤</span><span class="btn-text svelte-1uha8ag">Roll Dice</span></button> <div class="rest-button-container svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">üò¥</span><span class="btn-text svelte-1uha8ag">Rest</span></button> <!></div> <button class="btn btn-secondary use-enabled" title="Add custom condition with effects"><span class="btn-icon svelte-1uha8ag">‚ú®</span><span class="btn-text svelte-1uha8ag">Add Condition</span></button> <div class="mode-toggle"><button><span class="btn-icon svelte-1uha8ag"> </span><span class="btn-text svelte-1uha8ag"> </span></button></div></div> <div class="header-search svelte-1uha8ag"><input type="text" placeholder="üîç Search..." class="search-input use-enabled svelte-1uha8ag"/></div></div></div> <div class="header-actions svelte-1uha8ag"><button class="btn btn-mode svelte-1uha8ag">üìö Browse Spells & Feats</button> <button class="btn btn-secondary">Save to Gist</button> <button class="btn btn-secondary">Load from Gist</button> <button class="btn btn-secondary">Export JSON</button> <button class="btn btn-secondary">Import JSON</button> <input type="file" accept=".json" style="display: none;"/></div></header> <main class="svelte-1uha8ag"><!> <!> <!> <!> <!> <!> <!> <!></main></div> <!> <!> <!> <!> <!> <!>',1);function Uo(n,c){Gt(c,!1);const t=()=>dt(be,"$character",f),v=()=>dt(ma,"$isEditMode",f),u=()=>dt(ga,"$searchFilter",f),[f,p]=ra();function D(){const E=[],Ke=t().classFeatures.spellSlotsByLevel||{};for(let ee=1;ee<=9;ee++){const He=Ke[ee];if(He&&He.length>0){const R=He.length,xt=He.filter(ht=>ht).length;E.push({level:ee,available:R-xt,total:R})}}return E}let _=C(!1),h=C(!1),K=C(!1),F=C(!1),re=C("save"),te=C(void 0),z=C(""),q=C(""),T=C(""),I=C(!1),M=C([]),xe=C("other"),Qe=C(),Z=!1,he=1,fe=C(!1),_e=C(null);function Fe(E){r(_e,E)}function B(){r(_e,null)}function P(E){r(_e,e(_e)===E?null:E)}function x(E){be.update(Ke=>(Ke.activeStates||(Ke.activeStates=[]),Ke.activeStates=[...Ke.activeStates,E],Ke)),r(F,!1),Nt.add(`Added condition: ${E.name}`,"success")}function V(){r(F,!1)}function b(){const E=[];be.update(R=>{const xt=R.hitDice.current;R.hitDice.current=Math.min(R.hitDice.max,R.hitDice.current+Math.max(1,Math.floor(R.hitDice.max/2)));const ht=R.hitDice.current-xt;if(ht>0&&E.push(`${ht} hit ${ht===1?"die":"dice"}`),R.class){const st=Sa(R.class,R.level,R.subclass);R.classFeatures.features||(R.classFeatures.features={}),st.forEach(ke=>{if(ke.resetOn==="short"){const ft=ke.name.replace(/\s+/g,"");if(ke.type==="uses"){const it=typeof ke.maxUses=="function"?ke.maxUses(R.level):ke.maxUses;R.classFeatures.features[ft]=Array(it).fill(!1),E.push(ke.name)}else if(ke.type==="pool"){const it=typeof ke.maxPool=="function"?ke.maxPool(R.level):ke.maxPool;it!==void 0&&(R.classFeatures.features[ft]=it,E.push(ke.name))}}})}return R.activeStates&&R.activeStates.forEach(st=>{st.abilities&&st.abilities.forEach(ke=>{if(ke.restType==="short"&&ke.usesPerRest){const ft=ke.usesPerRest-(ke.currentUses||0)>0;ke.currentUses=ke.usesPerRest,ft&&E.push(`${st.name}: ${ke.name}`)}})}),R}),ms("short"),ss(t().race,t().level).some(R=>R.restType==="short"&&R.usesPerRest)&&E.push("racial traits"),r(fe,!1);const He=E.length>0?`Short rest taken! Restored: ${E.join(", ")}`:"Short rest taken!";Nt.add(He,"success")}function A(){const E=[];be.update(R=>{const xt=R.maxHP-R.currentHP;xt>0&&E.push(`${xt} HP`),R.currentHP=R.maxHP,R.tempHP=0;const ht=R.hitDice.max-R.hitDice.current;ht>0&&E.push(`${ht} hit ${ht===1?"die":"dice"}`),R.hitDice.current=R.hitDice.max;let st=0;if(R.classFeatures.spellSlotsByLevel&&Object.keys(R.classFeatures.spellSlotsByLevel).forEach(ke=>{const ft=R.classFeatures.spellSlotsByLevel[parseInt(ke)];if(ft){const it=ft.filter(Rt=>Rt).length;st+=it,R.classFeatures.spellSlotsByLevel[parseInt(ke)]=Array(ft.length).fill(!1)}}),st>0&&E.push(`${st} spell ${st===1?"slot":"slots"}`),R.class){const ke=Sa(R.class,R.level,R.subclass);R.classFeatures.features||(R.classFeatures.features={});let ft=!1;ke.forEach(it=>{const Rt=it.name.replace(/\s+/g,"");if(!(it.type==="info"||it.type==="channelDivinity")){if(it.type==="uses"){const rt=typeof it.maxUses=="function"?it.maxUses(R.level):it.maxUses;R.classFeatures.features[Rt]=Array(rt).fill(!1),ft=!0}else if(it.type==="pool"){const rt=typeof it.maxPool=="function"?it.maxPool(R.level):it.maxPool;rt!==void 0&&(R.classFeatures.features[Rt]=rt,ft=!0)}}}),ft&&E.push("all class features")}if(R.activeStates){let ke=!1;R.activeStates.forEach(ft=>{ft.abilities&&ft.abilities.forEach(it=>{if(it.usesPerRest){const Rt=(it.currentUses||0)<it.usesPerRest;it.currentUses=it.usesPerRest,Rt&&(ke=!0)}})}),ke&&E.push("condition abilities")}return R}),ms("long"),ss(t().race,t().level).some(R=>R.usesPerRest)&&E.push("racial traits"),r(fe,!1);const He=E.length>0?`Long rest taken! Restored: ${E.join(", ")}`:"Long rest taken! Fully rested.";Nt.add(He,"success")}function J(E){r(z,""),r(q,""),r(T,""),r(I,!1),r(M,[]),r(xe,"other"),Z=!1,typeof E=="string"?r(z,E):(r(z,E.notation),r(q,E.damageNotation||""),r(T,E.attackName||""),r(I,!!E.applyHalfDamage),r(M,E.bonusBreakdown||[]),r(xe,E.rollType||"other")),r(_,!0)}function Me(E){const{notation:Ke,count:ee,bonusBreakdown:He}=E.detail;r(z,""),Z=!0,he=ee||1,setTimeout(()=>{r(z,Ke),r(q,""),r(T,"Hit Die"),r(M,He||[]),r(xe,"other")},0),r(_,!0)}function ae(){if(r(_,!1),Z&&e(Qe)){const E=e(Qe).getLastRollTotal();if(E!==null){const Ke=Math.max(1,E);be.update(ee=>(ee.hitDice.current=Math.max(0,ee.hitDice.current-he),ee.currentHP=Math.min(ee.maxHP,ee.currentHP+Ke),ee))}Z=!1}}function de(){ma.update(E=>!E)}function ne(E){E.target.closest(".rest-button-container")||r(fe,!1)}$a(()=>{const E=ma.subscribe(Ke=>{Ke?document.body.classList.remove("use-mode"):document.body.classList.add("use-mode")});return document.addEventListener("click",ne),()=>{E(),document.removeEventListener("click",ne)}});function Ce(){rl(t())}function Oe(){e(te)?.click()}async function nt(E){const ee=E.target.files?.[0];if(ee)try{const He=await ol(ee);be.set(He),alert("Character imported successfully!")}catch{alert("Failed to import character file")}}Ot();var mt=Ao();nl("1uha8ag",E=>{var Ke=vo();Qt(2),Ls(()=>{tl.title="D&D Character Sheet"}),o(E,Ke)});var ct=Re(mt),Ve=l(ct),k=l(Ve),H=l(k),$e=l(H),Se=a(l($e),2);{var y=E=>{var Ke=uo(),ee=l(Ke);s(Ke),S(()=>$(ee,`${t().name??""} (${t().level??""})`)),o(E,Ke)};g(Se,E=>{t().name&&E(y)})}s($e);var N=a($e,2);{var ie=E=>{var Ke=po();yt(Ke,5,D,kt,(ee,He)=>{var R=fo();let xt;var ht=l(R);s(R),S(()=>{xt=Bt(R,1,"slot-badge svelte-1uha8ag",null,xt,{depleted:e(He).available===0}),$(ht,`Lv${e(He).level??""}: ${e(He).available??""}/${e(He).total??""}`)}),o(ee,R)}),s(Ke),o(E,Ke)};g(N,E=>{D().length>0&&E(ie)})}var ye=a(N,2);{var le=E=>{var Ke=Lo(),ee=Re(Ke);yt(ee,5,()=>t().activeStates,kt,(He,R,xt)=>{var ht=Do(),st=l(ht),ke=a(st);{var ft=rt=>{var pt=So(),St=l(pt),Jt=l(St,!0);s(St);var aa=a(St,2),zt=a(aa,3);{var sa=gt=>{var $t=mo(),Lt=Re($t),wt=l(Lt);s(Lt),Qt(),S(()=>$(wt,`Attack Bonus: ${typeof e(R).attackBonus=="number"&&e(R).attackBonus>0?"+":""}${e(R).attackBonus??""}`)),o(gt,$t)};g(zt,gt=>{e(R).attackBonus&&gt(sa)})}var Tt=a(zt,2);{var Pt=gt=>{var $t=go(),Lt=Re($t),wt=l(Lt);s(Lt),Qt(),S(()=>$(wt,`Damage Bonus: ${typeof e(R).damageBonus=="number"&&e(R).damageBonus>0?"+":""}${e(R).damageBonus??""}`)),o(gt,$t)};g(Tt,gt=>{e(R).damageBonus&&gt(Pt)})}var Et=a(Tt,2);{var la=gt=>{var $t=bo(),Lt=Re($t),wt=l(Lt);s(Lt),Qt(),S(()=>$(wt,`AC Bonus: ${e(R).acBonus>0?"+":""}${e(R).acBonus??""}`)),o(gt,$t)};g(Et,gt=>{e(R).acBonus&&gt(la)})}var na=a(Et,2);{var va=gt=>{var $t=ho(),Lt=Re($t),wt=l(Lt);s(Lt),Qt(),S(()=>$(wt,`Darkvision: ${e(R).darkvision??""} feet`)),o(gt,$t)};g(na,gt=>{e(R).darkvision&&gt(va)})}var Yt=a(na,2);{var Ut=gt=>{var $t=_o(),Lt=Re($t),wt=l(Lt);s(Lt),Qt(),S(At=>$(wt,`Resistances: ${At??""}`),[()=>e(R).resistances.join(", ")]),o(gt,$t)};g(Yt,gt=>{e(R).resistances&&e(R).resistances.length>0&&gt(Ut)})}var Wt=a(Yt,2);{var Zt=gt=>{var $t=yo(),Lt=Re($t),wt=l(Lt);s(Lt),Qt(),S(At=>$(wt,`Immunities: ${At??""}`),[()=>e(R).immunities.join(", ")]),o(gt,$t)};g(Wt,gt=>{e(R).immunities&&e(R).immunities.length>0&&gt(Zt)})}var jt=a(Wt,2);{var ea=gt=>{var $t=ko(),Lt=a(l($t),3);yt(Lt,1,()=>e(R).abilities,kt,(wt,At)=>{var Kt=wo(),ta=l(Kt),da=l(ta);s(ta);var It=a(ta),Vt=a(It);{var oa=ba=>{var Ca=xo(),Fa=a(Re(Ca)),Pa=l(Fa),Da=a(Pa);{var Wa=Ka=>{var Ps=Mt(", requires reaction");o(Ka,Ps)};g(Da,Ka=>{e(At).requiresReaction&&Ka(Wa)})}Qt(),s(Fa),S(()=>$(Pa,`(${(e(At).currentUses||0)??""}/${e(At).usesPerRest??""} uses per ${e(At).restType??""}
                                rest`)),o(ba,Ca)},fa=ba=>{var Ca=bt(),Fa=Re(Ca);{var Pa=Da=>{var Wa=$o();Qt(),o(Da,Wa)};g(Fa,Da=>{e(At).requiresReaction&&Da(Pa)},!0)}o(ba,Ca)};g(Vt,ba=>{e(At).usesPerRest?ba(oa):ba(fa,!1)})}s(Kt),S(()=>{$(da,`${e(At).name??""}:`),$(It,` ${e(At).description??""} `)}),o(wt,Kt)}),s($t),o(gt,$t)};g(jt,gt=>{e(R).abilities&&e(R).abilities.length>0&&gt(ea)})}s(pt),S(()=>{$(Jt,e(R).name),$(aa,` ${e(R).description??""}`)}),o(rt,pt)};g(ke,rt=>{e(_e)===xt&&rt(ft)})}var it=a(ke,2);{var Rt=rt=>{var pt=Co();S(()=>lt(pt,"title",`End ${e(R).name??""}`)),j("click",pt,()=>{be.update(St=>{if(St.activeStates){const Jt=St.activeStates[xt];Jt?.hpBonus&&Jt.target!=="other"&&(St.maxHP-=Jt.hpBonus,St.currentHP=Math.max(1,Math.min(St.currentHP-Jt.hpBonus,St.maxHP))),St.activeStates=St.activeStates.filter((aa,zt)=>zt!==xt)}return St})}),o(rt,pt)};g(it,rt=>{v()||rt(Rt)})}s(ht),S(()=>{lt(ht,"aria-label",e(R).name),$(st,`‚ú® ${e(R).name??""} `)}),j("mouseenter",ht,()=>Fe(xt)),j("mouseleave",ht,B),j("focus",ht,()=>Fe(xt)),j("blur",ht,B),j("click",ht,()=>P(xt)),o(He,ht)}),s(ee),Qt(2),o(E,Ke)};g(ye,E=>{t().activeStates&&t().activeStates.length>0&&E(le)})}s(H);var ge=a(H,2),ce=l(ge),U=l(ce),w=a(U,2),Ae=l(w),De=a(Ae,2);{var Je=E=>{var Ke=jo(),ee=l(Ke),He=a(ee,2);s(Ke),j("click",ee,b),j("click",He,A),o(E,Ke)};g(De,E=>{e(fe)&&E(Je)})}s(w);var Le=a(w,2),m=a(Le,2),pe=l(m);let oe;var G=l(pe),Pe=l(G,!0);s(G);var Ie=a(G),Be=l(Ie,!0);s(Ie),s(pe),s(m),s(ce);var Ue=a(ce,2),ve=l(Ue);Te(ve),s(Ue),s(ge),s(k);var Ee=a(k,2),we=l(Ee),Xe=a(we,2),qe=a(Xe,2),ot=a(qe,2),vt=a(ot,2),ue=a(vt,2);Ra(ue,E=>r(te,E),()=>e(te)),s(Ee),s(Ve);var L=a(Ve,2),O=l(L);Dl(O,{});var Q=a(O,2);Bl(Q,{$$events:{roll:E=>J(E.detail)}});var Y=a(Q,2);Xl(Y,{$$events:{roll:E=>J(E.detail)}});var je=a(Y,2);Vl(je,{$$events:{rollHitDice:Me}});var ze=a(je,2);ao(ze,{});var tt=a(ze,2);si(tt,{$$events:{roll:E=>J(E.detail)}});var We=a(tt,2);Fi(We,{});var Ye=a(We,2);Ei(Ye,{}),s(L),s(ct);var me=a(ct,2);Ra(lr(me,{get notation(){return e(z)},get damageNotation(){return e(q)},get attackName(){return e(T)},get applyHalfDamage(){return e(I)},get bonusBreakdown(){return e(M)},get rollType(){return e(xe)},get visible(){return e(_)},$$events:{close:ae},$$legacy:!0}),E=>r(Qe,E),()=>e(Qe));var W=a(me,2);{var Ne=E=>{kr(E,{get mode(){return e(re)},$$events:{close:()=>r(h,!1)}})};g(W,E=>{e(h)&&E(Ne)})}var ut=a(W,2);{var Ze=E=>{Hr(E,{onClose:()=>r(K,!1)})};g(ut,E=>{e(K)&&E(Ze)})}var at=a(ut,2);Vr(at,{get show(){return e(F)},onSave:x,onCancel:V});var se=a(at,2);il(se,{});var Dt=a(se,2);co(Dt,{}),S(()=>{oe=Bt(pe,1,"btn btn-mode svelte-1uha8ag",null,oe,{"use-mode":!v()}),$(Pe,v()?"üìù":"üé≤"),$(Be,v()?"Edit Mode":"Use Mode")}),j("click",U,()=>{r(M,[]),r(_,!0)}),j("click",Ae,()=>r(fe,!e(fe))),j("click",Le,()=>r(F,!0)),j("click",pe,de),Ge(ve,u,E=>cl(ga,E)),j("click",we,()=>r(K,!0)),j("click",Xe,()=>{r(re,"save"),r(h,!0)}),j("click",qe,()=>{r(re,"load"),r(h,!0)}),j("click",ot,Ce),j("click",vt,Oe),j("change",ue,nt),o(n,mt),qt(),p()}export{Uo as component};
