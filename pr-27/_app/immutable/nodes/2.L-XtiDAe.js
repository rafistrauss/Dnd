import{d as vs,g as Ps,f,e as D,a as o,s as $,c as gt,t as Tt}from"../chunks/BESELRjb.js";import{i as Nt}from"../chunks/JMgyEzd3.js";import{c as _a,o as $a,a as Is,b as Es}from"../chunks/CtPH092J.js";import{F as C,T as pa,Y as ts,j as Hs,aZ as Us,U as ds,ag as Ns,aD as Os,aK as Gs,aE as qs,a1 as zs,av as Ia,a7 as ns,i as Ss,a_ as Ws,a$ as Cs,b0 as Ga,K as ba,e as Ds,b1 as Ls,b2 as Ks,b3 as Vs,b4 as Js,q as as,b5 as Ys,b6 as Qs,ab as Xs,d as n,r as rs,g as Zs,C as Ot,G as Gt,H as l,I as s,J as a,b7 as Ze,b8 as da,s as r,a4 as k,f as e,m as $t,E as Se,b9 as Ut,ao as Qt,A as W,ba as ma,bb as wa,bc as el}from"../chunks/DyJ43TGI.js";import{t as tl,c as Xt,a as de,e as kt,i as Lt,u as js,s as ga,b as At,d as qa,f as ha,g as al,j as Mt,k as sl,l as ll,m as us,h as il,T as nl,n as rl,o as ol,r as fs,p as ps}from"../chunks/C1zjLAJO.js";import{i as b,s as na,a as pt,b as It,d as La,e as cl}from"../chunks/CCL4udNy.js";import{p as Dt,b as Ra}from"../chunks/iXw84bXb.js";import{b as ja,r as vl}from"../chunks/CxW9O1ry.js";function dl(i,c,t=!1,v=!1,u=!1){var p=i,m="";C(()=>{var L=Hs;if(m===(m=c()??"")){pa&&ts();return}if(L.nodes_start!==null&&(Us(L.nodes_start,L.nodes_end),L.nodes_start=L.nodes_end=null),m!==""){if(pa){ds.data;for(var h=ts(),_=h;h!==null&&(h.nodeType!==Ns||h.data!=="");)_=h,h=Os(h);if(h===null)throw Gs(),qs;vs(ds,_),p=zs(h);return}var Y=m+"";t?Y=`<svg>${Y}</svg>`:v&&(Y=`<math>${Y}</math>`);var F=Ps(Y);if((t||v)&&(F=Ia(F)),vs(Ia(F),F.lastChild),t||v)for(;Ia(F);)p.before(Ia(F));else p.before(F)}})}function ul(i,c,t,v,u){pa&&ts();var p=c.$$slots?.[t],m=!1;p===!0&&(p=c[t],m=!0),p===void 0?u!==null&&u(i):p(i,m?()=>v:v)}function fl(i,c,t,v){var u=i.__style;if(pa||u!==c){var p=tl(c);(!pa||p!==i.getAttribute("style"))&&(p==null?i.removeAttribute("style"):i.style.cssText=p),i.__style=c}return v}function Oa(i,c,t=!1){if(i.multiple){if(c==null)return;if(!Ss(c))return Ws();for(var v of i.options)v.selected=c.includes(Aa(v));return}for(v of i.options){var u=Aa(v);if(Cs(u,c)){v.selected=!0;return}}(!t||c!==void 0)&&(i.selectedIndex=-1)}function ss(i){var c=new MutationObserver(()=>{Oa(i,i.__value)});c.observe(i,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),ns(()=>{c.disconnect()})}function Ta(i,c,t=c){var v=new WeakSet,u=!0;Ga(i,"change",p=>{var m=p?"[selected]":":checked",L;if(i.multiple)L=[].map.call(i.querySelectorAll(m),Aa);else{var h=i.querySelector(m)??i.querySelector("option:not([disabled])");L=h&&Aa(h)}t(L),ba!==null&&v.add(ba)}),Ds(()=>{var p=c();if(i===document.activeElement){var m=Ls??ba;if(v.has(m))return}if(Oa(i,p,u),u&&p===void 0){var L=i.querySelector(":checked");L!==null&&(p=Aa(L),t(p))}i.__value=p,u=!1}),ss(i)}function Aa(i){return"__value"in i?i.__value:i.value}const pl=Symbol("is custom element"),ml=Symbol("is html");function Ce(i){if(pa){var c=!1,t=()=>{if(!c){if(c=!0,i.hasAttribute("value")){var v=i.value;tt(i,"value",null),i.value=v}if(i.hasAttribute("checked")){var u=i.checked;tt(i,"checked",null),i.checked=u}}};i.__on_r=t,as(t),Ys()}}function Ba(i,c){var t=os(i);t.value===(t.value=c??void 0)||i.value===c&&(c!==0||i.nodeName!=="PROGRESS")||(i.value=c??"")}function As(i,c){var t=os(i);t.checked!==(t.checked=c??void 0)&&(i.checked=c)}function tt(i,c,t,v){var u=os(i);pa&&(u[c]=i.getAttribute(c),c==="src"||c==="srcset"||c==="href"&&i.nodeName==="LINK")||u[c]!==(u[c]=t)&&(c==="loading"&&(i[Ks]=t),t==null?i.removeAttribute(c):typeof t!="string"&&gl(i).includes(c)?i[c]=t:i.setAttribute(c,t))}function os(i){return i.__attributes??={[pl]:i.nodeName.includes("-"),[ml]:i.namespaceURI===Vs}}var ms=new Map;function gl(i){var c=i.getAttribute("is")||i.nodeName,t=ms.get(c);if(t)return t;ms.set(c,t=[]);for(var v,u=i,p=Element.prototype;p!==u;){v=Qs(u);for(var m in v)v[m].set&&t.push(m);u=Js(u)}return t}function Ne(i,c,t=c){var v=new WeakSet;Ga(i,"input",async u=>{var p=u?i.defaultValue:i.value;if(p=Ja(i)?Ya(p):p,t(p),ba!==null&&v.add(ba),await Xs(),p!==(p=c())){var m=i.selectionStart,L=i.selectionEnd,h=i.value.length;if(i.value=p??"",L!==null){var _=i.value.length;m===L&&L===h&&_>h?(i.selectionStart=_,i.selectionEnd=_):(i.selectionStart=m,i.selectionEnd=Math.min(L,_))}}}),(pa&&i.defaultValue!==i.value||n(c)==null&&i.value)&&(t(Ja(i)?Ya(i.value):i.value),ba!==null&&v.add(ba)),rs(()=>{var u=c();if(i===document.activeElement){var p=Ls??ba;if(v.has(p))return}Ja(i)&&u===Ya(i.value)||i.type==="date"&&!u&&!i.value||u!==i.value&&(i.value=u??"")})}const Va=new Set;function gs(i,c,t,v,u=v){var p=t.getAttribute("type")==="checkbox",m=i;let L=!1;if(c!==null)for(var h of c)m=m[h]??=[];m.push(t),Ga(t,"change",()=>{var _=t.__value;p&&(_=bs(m,_,t.checked)),u(_)},()=>u(p?[]:null)),rs(()=>{var _=v();if(pa&&t.defaultChecked!==t.checked){L=!0;return}p?(_=_||[],t.checked=_.includes(t.__value)):t.checked=Cs(t.__value,_)}),ns(()=>{var _=m.indexOf(t);_!==-1&&m.splice(_,1)}),Va.has(m)||(Va.add(m),as(()=>{m.sort((_,Y)=>_.compareDocumentPosition(Y)===4?-1:1),Va.delete(m)})),as(()=>{if(L){var _;if(p)_=bs(m,_,t.checked);else{var Y=m.find(F=>F.checked);_=Y?.__value}u(_)}})}function ka(i,c,t=c){Ga(i,"change",v=>{var u=v?i.defaultChecked:i.checked;t(u)}),(pa&&i.defaultChecked!==i.checked||n(c)==null)&&t(i.checked),rs(()=>{var v=c();i.checked=!!v})}function bs(i,c,t){for(var v=new Set,u=0;u<i.length;u+=1)i[u].checked&&v.add(i[u].__value);return t||v.delete(c),Array.from(v)}function Ja(i){var c=i.type;return c==="number"||c==="range"}function Ya(i){return i===""?null:+i}function bl(i,c,t){var v=Zs(i,c);v&&v.set&&(i[c]=t,ns(()=>{i[c]=null}))}function cs(i){return function(...c){var t=c[0];return t.stopPropagation(),i?.apply(this,c)}}function Sa(i,c){var t=i.$$events?.[c.type],v=Ss(t)?t.slice():t==null?[]:[t];for(var u of v)u.call(this,c)}const hl="";function Bs(...i){return ja+hl+vl(i[0],i[1])}const ls={paladin:{name:"Paladin",hitDice:"d10",spellcaster:!0,spellcastingAbility:"charisma",spellSlotsByLevel:{1:0,2:2,3:3,4:3,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Divine Sense",type:"uses",maxUses:(i,c=1)=>1+Math.max(1,c),resetOn:"long",description:"Detect celestials, fiends, and undead within 60 feet",minLevel:1},{name:"Lay on Hands",type:"pool",maxPool:i=>i*5,resetOn:"long",description:"Heal wounds or cure disease",minLevel:1},{name:"Divine Smite",type:"spellSlot",description:"Expend spell slot to deal extra radiant damage",minLevel:2,rollable:!0},{name:"Channel Divinity",type:"pool",maxPool:i=>i>=18?3:i>=6?2:1,resetOn:"short",description:"Sacred Weapon or Turn Undead",minLevel:3}]},fighter:{name:"Fighter",hitDice:"d10",spellcaster:!1,features:[{name:"Second Wind",type:"uses",maxUses:1,resetOn:"short",description:"Regain 1d10 + fighter level HP as bonus action",minLevel:1,rollable:!0,rollFormula:i=>`1d10+${i}`},{name:"Action Surge",type:"uses",maxUses:i=>i>=17?2:1,resetOn:"short",description:"Take one additional action on your turn",minLevel:2},{name:"Indomitable",type:"uses",maxUses:i=>i>=17?3:i>=13?2:1,resetOn:"long",description:"Reroll a failed saving throw",minLevel:9}],subclasses:{champion:{name:"Champion",features:[{name:"Improved Critical",type:"info",description:"Critical hit on 19-20",minLevel:3},{name:"Remarkable Athlete",type:"info",description:"Add half proficiency to STR/DEX/CON checks, increase long jump distance",minLevel:7},{name:"Additional Fighting Style",type:"info",description:"Choose a second fighting style",minLevel:10},{name:"Superior Critical",type:"info",description:"Critical hit on 18-20",minLevel:15},{name:"Survivor",type:"info",description:"Regain 5 + CON mod HP at start of turn if below half HP",minLevel:18}]},battlemaster:{name:"Battle Master",features:[{name:"Combat Superiority",type:"uses",maxUses:i=>i>=15?6:i>=7?5:4,resetOn:"short",description:i=>`Use superiority dice (${i>=18?"d12":i>=10?"d10":"d8"}) for maneuvers`,minLevel:3},{name:"Know Your Enemy",type:"info",description:"Learn capabilities of creatures you observe",minLevel:7},{name:"Improved Combat Superiority",type:"info",description:"Superiority dice become d10",minLevel:10},{name:"Relentless",type:"info",description:"Regain 1 superiority die if you have none at start of turn",minLevel:15}]}}},rogue:{name:"Rogue",hitDice:"d8",spellcaster:!1,features:[{name:"Sneak Attack",type:"info",description:i=>`Deal ${Math.ceil(i/2)}d6 extra damage once per turn with advantage or ally nearby`,minLevel:1,rollable:!0,rollFormula:i=>`${Math.ceil(i/2)}d6`},{name:"Cunning Action",type:"info",description:"Dash, Disengage, or Hide as a bonus action",minLevel:2},{name:"Uncanny Dodge",type:"info",description:"Use reaction to halve damage from an attack",minLevel:5},{name:"Evasion",type:"info",description:"Take no damage on successful Dex save (half on fail)",minLevel:7}]},wizard:{name:"Wizard",hitDice:"d6",spellcaster:!0,spellcastingAbility:"intelligence",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Arcane Recovery",type:"uses",maxUses:1,resetOn:"long",description:i=>`Recover spell slots totaling up to ${Math.ceil(i/2)} levels during short rest`,minLevel:1},{name:"Spell Mastery",type:"info",description:"Cast one 1st-level and one 2nd-level spell at will",minLevel:18}]},cleric:{name:"Cleric",hitDice:"d8",spellcaster:!0,spellcastingAbility:"wisdom",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Channel Divinity",type:"pool",maxPool:i=>i>=18?3:i>=6?2:1,resetOn:"short",description:"Turn Undead or domain-specific ability",minLevel:2},{name:"Destroy Undead",type:"info",description:i=>`Channel Divinity destroys undead of CR ${i>=17?4:i>=14?3:i>=11?2:i>=8?1:.5} or lower`,minLevel:5},{name:"Divine Intervention",type:"uses",maxUses:1,resetOn:"long",description:i=>`${i}% chance to succeed, implore deity for aid`,minLevel:10}],subclasses:{war:{name:"War Domain",features:[{name:"War Priest",type:"uses",maxUses:(i,c=1)=>Math.max(1,c),resetOn:"long",description:"Make one weapon attack as a bonus action",minLevel:1},{name:"Guided Strike",type:"channelDivinity",description:"Use your Channel Divinity to gain +10 to an attack roll. Make this choice after you see the roll, but before the DM says whether the attack hits or misses.",minLevel:2,resetOn:"short"},{name:"War God's Blessing",type:"channelDivinity",description:"Use reaction to grant +10 to an ally's attack roll within 30 feet. Consumes one use of Channel Divinity.",minLevel:6,resetOn:"short"},{name:"Divine Strike",type:"info",description:i=>`Deal extra ${i>=14?"2d8":"1d8"} weapon damage once per turn`,minLevel:8,rollable:!0,rollFormula:i=>i>=14?"2d8":"1d8"},{name:"Avatar of Battle",type:"info",description:"Gain resistance to nonmagical weapon damage",minLevel:17}]},life:{name:"Life Domain",features:[{name:"Disciple of Life",type:"info",description:"Healing spells restore additional 2 + spell level HP",minLevel:1},{name:"Preserve Life",type:"pool",maxPool:i=>i*5,resetOn:"short",description:"Restore HP to creatures within 30 feet",minLevel:2},{name:"Blessed Healer",type:"info",description:"Regain 2 + spell level HP when you cast healing spell",minLevel:6},{name:"Divine Strike",type:"info",description:i=>`Deal extra ${i>=14?"2d8":"1d8"} radiant damage once per turn`,minLevel:8,rollable:!0,rollFormula:i=>i>=14?"2d8":"1d8"},{name:"Supreme Healing",type:"info",description:"Maximize healing dice instead of rolling",minLevel:17}]}}},barbarian:{name:"Barbarian",hitDice:"d12",spellcaster:!1,features:[{name:"Rage",type:"uses",maxUses:i=>i>=20?1/0:i>=17?6:i>=12?5:i>=6?4:i>=3?3:2,resetOn:"long",description:i=>`+${i>=16?4:i>=9?3:2} damage, resistance to physical damage`,minLevel:1},{name:"Reckless Attack",type:"info",description:"Gain advantage on melee attacks, enemies get advantage on you",minLevel:2},{name:"Danger Sense",type:"info",description:"Advantage on Dex saves against effects you can see",minLevel:2}],subclasses:{berserker:{name:"Path of the Berserker",features:[{name:"Frenzy",type:"info",description:"While raging, make melee attack as bonus action (gain 1 exhaustion after rage)",minLevel:3},{name:"Mindless Rage",type:"info",description:"Cannot be charmed or frightened while raging",minLevel:6},{name:"Intimidating Presence",type:"info",description:"Use action to frighten creature within 30 feet",minLevel:10},{name:"Retaliation",type:"info",description:"When damaged by creature within 5 feet, make melee attack as reaction",minLevel:14}]}}}};function ia(i){const c=i.toLowerCase();return ls[c]||null}function Ca(i,c,t){const v=ia(i);if(!v)return[];const u=v.features.filter(p=>!p.minLevel||p.minLevel<=c);if(t&&v.subclasses&&v.subclasses[t]){const p=v.subclasses[t].features.filter(m=>!m.minLevel||m.minLevel<=c);return[...u,...p]}return u}function hs(i){const c=ia(i);return!c||!c.subclasses?[]:Object.keys(c.subclasses).map(t=>({id:t,name:c.subclasses[t].name}))}function _s(i,c){const t=ia(i);return!t||!t.spellcaster||!t.spellSlotsByLevel?0:t.spellSlotsByLevel[c]||0}function ys(i,c,t){const v=ia(i);return!v||!v.spellcaster?0:Math.max(1,t+c)}function _l(i,c,t){const v=ia(i);return!v||!v.spellcaster?null:8+c+t}function yl(){return Object.keys(ls).map(i=>({id:i,name:ls[i].name}))}var xl=f('<div class="section-header svelte-ls99y2" role="button" tabindex="0"><h2 class="svelte-ls99y2"> </h2> <span class="collapse-btn svelte-ls99y2"> </span></div>');function ya(i,c){Ot(c,!1);let t=Dt(c,"title",8),v=Dt(c,"collapsed",8),u=Dt(c,"ariaLabel",8,""),p=Dt(c,"onToggle",8);Nt();var m=xl(),L=l(m),h=l(L,!0);s(L);var _=a(L,2),Y=l(_,!0);s(_),s(m),C(()=>{tt(m,"aria-expanded",!v()),tt(m,"aria-label",u()),$(h,t()),$(Y,v()?"‚ñº":"‚ñ≤")}),D("click",m,function(...F){p()?.apply(this,F)}),D("keydown",m,F=>{(F.key==="Enter"||F.key===" ")&&p()()}),o(i,m),Gt()}var wl=f("<option> </option>"),$l=f("<option> </option>"),kl=f('<div class="form-group svelte-172i2fj"><label for="characterSubclass" class="svelte-172i2fj">Subclass</label> <select id="characterSubclass" class="svelte-172i2fj"><option>Select Subclass</option><!></select></div>'),Sl=f('<div class="info-grid svelte-172i2fj"><div class="form-group svelte-172i2fj"><label for="characterName" class="svelte-172i2fj">Character Name</label> <input type="text" id="characterName" placeholder="Enter name" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterClass" class="svelte-172i2fj">Class</label> <select id="characterClass" class="svelte-172i2fj"><option>Select Class</option><!></select></div> <!> <div class="form-group svelte-172i2fj"><label for="characterLevel" class="svelte-172i2fj">Level</label> <input type="number" id="characterLevel" min="1" max="20" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterRace" class="svelte-172i2fj">Race</label> <input type="text" id="characterRace" placeholder="e.g., Human" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterBackground" class="svelte-172i2fj">Background</label> <input type="text" id="characterBackground" placeholder="e.g., Soldier" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterAlignment" class="svelte-172i2fj">Alignment</label> <input type="text" id="characterAlignment" placeholder="e.g., Lawful Good" class="svelte-172i2fj"/></div></div>'),Cl=f('<section class="character-info svelte-172i2fj"><!> <!></section>');function Dl(i,c){Ot(c,!1);const t=()=>pt(de,"$character",u),v=()=>pt(Xt,"$collapsedStates",u),[u,p]=na(),m=k(),L=yl();function h(G){const R=G.target;de.update(I=>(I.class=R.value,I.subclass="",I))}function _(G){const R=G.target;de.update(I=>(I.subclass=R.value,I))}function Y(G){const R=G.target;de.update(I=>(I.level=parseInt(R.value)||1,I)),js()}Ze(()=>(t(),hs),()=>{r(m,t().class?hs(t().class):[])}),da(),Nt();var F=Cl(),ie=l(F);{let G=$t(()=>(v(),n(()=>v().characterInfo?"Expand":"Collapse")));ya(ie,{title:"Character Info",get collapsed(){return v(),n(()=>v().characterInfo)},get ariaLabel(){return e(G)},onToggle:()=>Xt.update(R=>({...R,characterInfo:!R.characterInfo}))})}var te=a(ie,2);{var z=G=>{var R=Sl(),I=l(R),H=a(l(I),2);Ce(H),s(I);var Te=a(I,2),Je=a(l(Te),2),X=l(Je);X.value=X.__value="";var Pe=a(X);kt(Pe,1,()=>L,Lt,(Le,pe)=>{var ne=wl(),Be=l(ne,!0);s(ne);var He={};C(()=>{$(Be,(e(pe),n(()=>e(pe).name))),He!==(He=(e(pe),n(()=>e(pe).id)))&&(ne.value=(ne.__value=(e(pe),n(()=>e(pe).id)))??"")}),o(Le,ne)}),s(Je);var ue;ss(Je),s(Te);var xe=a(Te,2);{var Me=Le=>{var pe=kl(),ne=a(l(pe),2),Be=l(ne);Be.value=Be.__value="";var He=a(Be);kt(He,1,()=>e(m),Lt,(mt,vt)=>{var Ke=$l(),xt=l(Ke,!0);s(Ke);var y={};C(()=>{$(xt,(e(vt),n(()=>e(vt).name))),y!==(y=(e(vt),n(()=>e(vt).id)))&&(Ke.value=(Ke.__value=(e(vt),n(()=>e(vt).id)))??"")}),o(mt,Ke)}),s(ne);var ot;ss(ne),s(pe),C(()=>{ot!==(ot=(t(),n(()=>t().subclass)))&&(ne.value=(ne.__value=(t(),n(()=>t().subclass)))??"",Oa(ne,(t(),n(()=>t().subclass))))}),D("change",ne,_),o(Le,pe)};b(xe,Le=>{e(m),n(()=>e(m).length>0)&&Le(Me)})}var T=a(xe,2),P=a(l(T),2);Ce(P),s(T);var w=a(T,2),K=a(l(w),2);Ce(K),s(w);var g=a(w,2),M=a(l(g),2);Ce(M),s(g);var q=a(g,2),Ae=a(l(q),2);Ce(Ae),s(q),s(R),C(()=>{ue!==(ue=(t(),n(()=>t().class)))&&(Je.value=(Je.__value=(t(),n(()=>t().class)))??"",Oa(Je,(t(),n(()=>t().class)))),Ba(P,(t(),n(()=>t().level)))}),Ne(H,()=>t().name,Le=>It(de,n(t).name=Le,n(t))),D("change",Je,h),D("change",P,Y),Ne(K,()=>t().race,Le=>It(de,n(t).race=Le,n(t))),Ne(M,()=>t().background,Le=>It(de,n(t).background=Le,n(t))),Ne(Ae,()=>t().alignment,Le=>It(de,n(t).alignment=Le,n(t))),o(G,R)};b(te,G=>{v(),n(()=>!v().characterInfo)&&G(z)})}s(F),o(i,F),Gt(),p()}var Ll=f('<div class="ability-card svelte-bbv1xt"><h3 class="svelte-bbv1xt"> </h3> <input type="number" class="ability-score svelte-bbv1xt" min="1" max="30"/> <div class="ability-modifier svelte-bbv1xt"> </div> <div class="roll-buttons svelte-bbv1xt"><button class="roll-btn svelte-bbv1xt">Check</button> <button class="roll-btn svelte-bbv1xt">Save</button></div> <div class="save-proficiency svelte-bbv1xt"><input type="checkbox" class="svelte-bbv1xt"/> <label class="svelte-bbv1xt">Save Prof.</label></div></div>'),jl=f('<div class="proficiency-bonus svelte-bbv1xt"><label for="profBonus">Proficiency Bonus</label> <input type="number" id="profBonus" class="prof-input svelte-bbv1xt"/></div> <div class="abilities-grid svelte-bbv1xt"></div>',1),Al=f("<section><!> <!></section>");function Bl(i,c){Ot(c,!1);const t=()=>pt(qa,"$abilityModifiers",L),v=()=>pt(de,"$character",L),u=()=>pt(ga,"$searchFilter",L),p=()=>pt(Xt,"$collapsedStates",L),m=()=>pt(ha,"$isEditMode",L),[L,h]=na(),_=k(),Y=k(),F=_a(),ie=[{key:"strength",label:"Strength"},{key:"dexterity",label:"Dexterity"},{key:"constitution",label:"Constitution"},{key:"intelligence",label:"Intelligence"},{key:"wisdom",label:"Wisdom"},{key:"charisma",label:"Charisma"}];function te(){js()}function z(X){const Pe=t()[X],ue=`1d20${Pe>=0?"+":""}${Pe}`,xe=[];xe.push({value:"1d20",source:"base die"}),Pe!==0&&xe.push({value:Pe,source:X}),F("roll",{notation:ue,rollType:"check",bonusBreakdown:xe})}function G(X){const Pe=t()[X],ue=v().saveProficiencies[X]?v().proficiencyBonus:0,xe=Pe+ue,Me=`1d20${xe>=0?"+":""}${xe}`,T=[];T.push({value:"1d20",source:"base die"}),Pe!==0&&T.push({value:Pe,source:X}),ue!==0&&T.push({value:ue,source:"proficiency"}),F("roll",{notation:Me,rollType:"save",bonusBreakdown:T})}Ze(()=>u(),()=>{r(_,ie.filter(({label:X})=>u()?X.toLowerCase().includes(u().toLowerCase()):!0))}),Ze(()=>(e(_),u()),()=>{r(Y,e(_).length>0||!u()||u().toLowerCase().includes("proficiency"))}),da(),Nt();var R=Al();let I;var H=l(R);ya(H,{title:"Ability Scores",get collapsed(){return p(),n(()=>p().abilityScores)},ariaLabel:"Toggle Ability Scores Section",onToggle:()=>Xt.update(X=>({...X,abilityScores:!X.abilityScores}))});var Te=a(H,2);{var Je=X=>{var Pe=jl(),ue=Se(Pe),xe=a(l(ue),2);Ce(xe),s(ue);var Me=a(ue,2);kt(Me,5,()=>e(_),Lt,(T,P)=>{let w=()=>e(P).key,K=()=>e(P).label;var g=Ll(),M=l(g),q=l(M,!0);s(M);var Ae=a(M,2);Ce(Ae);var Le=a(Ae,2),pe=l(Le);s(Le);var ne=a(Le,2),Be=l(ne),He=a(Be,2);s(ne);var ot=a(ne,2),mt=l(ot);Ce(mt);var vt=a(mt,2);s(ot),s(g),C(Ke=>{$(q,Ke),$(pe,`${t(),w(),n(()=>t()[w()]>=0?"+":"")??""}${t(),w(),n(()=>t()[w()])??""}`),mt.disabled=!m(),tt(mt,"id",`${w()}-save`),tt(vt,"for",`${w()}-save`)},[()=>(K(),n(()=>K().substring(0,3).toUpperCase()))]),Ne(Ae,()=>v().abilities[w()],Ke=>It(de,n(v).abilities[w()]=Ke,n(v))),D("change",Ae,te),D("click",Be,()=>z(w())),D("click",He,()=>G(w())),ka(mt,()=>v().saveProficiencies[w()],Ke=>It(de,n(v).saveProficiencies[w()]=Ke,n(v))),o(T,g)}),s(Me),Ne(xe,()=>v().proficiencyBonus,T=>It(de,n(v).proficiencyBonus=T,n(v))),o(X,Pe)};b(Te,X=>{p(),n(()=>!p().abilityScores)&&X(Je)})}s(R),C(()=>I=At(R,1,"ability-scores svelte-bbv1xt",null,I,{hidden:!e(Y)})),o(i,R),Gt(),h()}const Rs=[{name:"Unarmored",type:"none",baseAC:10},{name:"Padded",type:"light",baseAC:11},{name:"Leather",type:"light",baseAC:11},{name:"Studded Leather",type:"light",baseAC:12},{name:"Hide",type:"medium",baseAC:12,maxDexBonus:2},{name:"Chain Shirt",type:"medium",baseAC:13,maxDexBonus:2},{name:"Scale Mail",type:"medium",baseAC:14,maxDexBonus:2},{name:"Breastplate",type:"medium",baseAC:14,maxDexBonus:2},{name:"Half Plate",type:"medium",baseAC:15,maxDexBonus:2},{name:"Ring Mail",type:"heavy",baseAC:14,maxDexBonus:0},{name:"Chain Mail",type:"heavy",baseAC:16,maxDexBonus:0},{name:"Splint",type:"heavy",baseAC:17,maxDexBonus:0},{name:"Plate",type:"heavy",baseAC:18,maxDexBonus:0}];function Ts(i){return Rs.find(c=>c.name===i)}function Rl(i,c,t){if(!i)return 10+c+(t?2:0);const v=Ts(i);if(!v)return 10+c+(t?2:0);let u=v.baseAC;return v.maxDexBonus===void 0?u+=c:v.maxDexBonus>0&&(u+=Math.min(c,v.maxDexBonus)),t&&(u+=2),u}function Ma(i){return Math.floor((i-10)/2)}function is(i,c){if(!i.class)return null;const t=ia(i.class);if(!t||!t.spellcaster||!t.spellcastingAbility)return null;const v=Ma(c[t.spellcastingAbility]);return 8+i.proficiencyBonus+v}function Qa(i,c){if(!i.class)return 0;const t=ia(i.class);return!t||!t.spellcaster||!t.spellcastingAbility?0:Ma(c[t.spellcastingAbility])}function Tl(i,c){const t=[],v=Ma(c.dexterity),u=i.armorName?Ts(i.armorName):void 0;if(u){if(u.type==="none")t.push("Unarmored"),t.push("Base: 10"),t.push(`Dexterity: ${v>=0?"+":""}${v}`);else if(u.type==="light")t.push(`${u.name}: ${u.baseAC}`),t.push(`Dexterity: ${v>=0?"+":""}${v}`);else if(u.type==="medium"){const p=Math.min(2,v);t.push(`${u.name}: ${u.baseAC}`),t.push(`Dexterity: ${p>=0?"+":""}${p} (max +2)`)}else u.type==="heavy"&&(t.push(`${u.name}: ${u.baseAC}`),t.push("Dexterity: +0 (heavy armor)"));i.shieldEquipped&&t.push("Shield: +2")}else{t.push("Base: 10"),v!==0&&t.push(`Dexterity: ${v>=0?"+":""}${v}`);const p=10+v,m=i.armorClass-p;m!==0&&t.push(`Other: ${m>=0?"+":""}${m}`)}return i.activeStates&&i.activeStates.length>0&&i.activeStates.forEach(p=>{typeof p.acBonus=="number"&&p.acBonus!==0&&(!p.target||p.target==="self")&&t.push(`${p.name}: ${p.acBonus>=0?"+":""}${p.acBonus}`)}),t.join(`
`)}function Ml(i,c){const t=[],v=Ma(c.dexterity);t.push(`Dexterity: ${v>=0?"+":""}${v}`);const u=i.initiative-v;return u!==0&&t.push(`Other Bonuses: ${u>=0?"+":""}${u}`),t.join(`
`)}function Fl(i,c){if(!i.class)return"";const t=ia(i.class);if(!t||!t.spellcaster||!t.spellcastingAbility)return"";const v=[],u=Ma(c[t.spellcastingAbility]),p=t.spellcastingAbility.charAt(0).toUpperCase()+t.spellcastingAbility.slice(1);return v.push("Base: 8"),v.push(`Proficiency: +${i.proficiencyBonus}`),v.push(`${p}: ${u>=0?"+":""}${u}`),v.join(`
`)}function Pl(i,c,t){const v=[];let u=i;const p=c.toLowerCase().trim();if(t.activeStates){for(const m of t.activeStates)if(m.immunities&&m.immunities.length>0&&m.immunities.some(h=>h.toLowerCase().trim()===p))return v.push(`Immune to ${c} (${m.name})`),{finalDamage:0,adjustments:v}}if(t.activeStates){for(const m of t.activeStates)if(m.resistances&&m.resistances.length>0&&m.resistances.some(h=>h.toLowerCase().trim()===p)){const h=Math.floor(u/2);v.push(`Resistant to ${c} (${m.name}): ${u} ‚Üí ${h}`),u=h;break}}return v.length===0&&v.push(`No adjustments for ${c}`),{finalDamage:u,adjustments:v}}function Il(i,c){const t={...i};if(t.tempHP>0){if(c<=t.tempHP)return t.tempHP-=c,t;c-=t.tempHP,t.tempHP=0}return t.currentHP=Math.max(0,t.currentHP-c),t}var El=f('<button class="info-icon svelte-1o8ci7b" type="button">‚ÑπÔ∏è</button>'),Hl=f('<button class="info-icon svelte-1o8ci7b" type="button">‚ÑπÔ∏è</button>'),Ul=f("<div><!></div>"),Nl=f('<div class="tooltip-wrapper svelte-1o8ci7b"><!> <!></div>');function Xa(i,c){Ot(c,!1);let t=Dt(c,"tooltipContent",8),v=Dt(c,"ariaLabel",8,"Show information"),u=k(!1),p=k(),m=k(!1),L=k(null),h=k(!1),_=k(!1),Y=k("");const F=Math.random().toString(36).slice(2);function ie(){window.dispatchEvent(new CustomEvent("tooltip-open",{detail:F}))}function te(T){T.detail!==F&&(r(u,!1),r(h,!1))}function z(){r(m,window.matchMedia("(pointer: coarse)").matches||"ontouchstart"in window)}function G(){if(!e(L)||!e(p))return;const T=e(p).getBoundingClientRect(),P=e(L).getBoundingClientRect();let w=T.bottom+5,K=T.left;r(h,!1),K+P.width>window.innerWidth-8&&(K=T.right-P.width,r(h,!0),K<8&&(K=8)),K<8&&(K=8),w+P.height>window.innerHeight-8&&(w=T.top-P.height-5),r(Y,`position:fixed;top:${w}px;left:${K}px;z-index:1000;`),r(_,!0)}function R(){ie(),r(u,!1),r(_,!1),requestAnimationFrame(()=>{r(u,!0),r(_,!1),setTimeout(G,0)})}function I(){r(u,!1),r(h,!1)}function H(T){T.stopPropagation(),e(u)?(r(u,!1),r(h,!1),r(_,!1)):(ie(),r(u,!1),r(_,!1),requestAnimationFrame(()=>{r(u,!0),r(_,!1),setTimeout(G,0)}))}function Te(T){e(p)&&!e(p).contains(T.target)&&(r(u,!1),r(h,!1))}$a(()=>{z(),document.addEventListener("click",Te),window.addEventListener("tooltip-open",te)}),Is(()=>{document.removeEventListener("click",Te),window.removeEventListener("tooltip-open",te)}),Nt();var Je=Nl(),X=l(Je);{var Pe=T=>{var P=El();C(()=>tt(P,"aria-label",v())),D("click",P,H),o(T,P)},ue=T=>{var P=Hl();C(()=>tt(P,"aria-label",v())),D("mouseenter",P,R),D("mouseleave",P,I),o(T,P)};b(X,T=>{e(m)?T(Pe):T(ue,!1)})}var xe=a(X,2);{var Me=T=>{var P=Ul(),w=l(P);ul(w,c,"content",{},K=>{var g=gt(),M=Se(g);dl(M,t),o(K,g)}),s(P),Ra(P,K=>r(L,K),()=>e(L)),C(()=>{At(P,1,`tooltip-popup ${e(h)?"right-align":""}`,"svelte-1o8ci7b"),fl(P,e(_)?e(Y)+"opacity:1;pointer-events:auto;":"opacity:0;pointer-events:none;position:fixed;top:0;left:0;z-index:1000;")}),o(T,P)};b(xe,T=>{e(u)&&T(Me)})}s(Je),Ra(Je,T=>r(p,T),()=>e(p)),o(i,Je),Gt()}var Ol=f("<option> </option>"),Gl=f('<div class="armor-config svelte-1r5hyyb"><h4 class="svelte-1r5hyyb">Armor Configuration</h4> <div class="armor-controls svelte-1r5hyyb"><div class="armor-field svelte-1r5hyyb"><label for="armorName" class="svelte-1r5hyyb">Armor</label> <select id="armorName" class="armor-select svelte-1r5hyyb"><option>None (Unarmored)</option><!></select></div> <div class="armor-field svelte-1r5hyyb"><label class="shield-label svelte-1r5hyyb"><input type="checkbox" class="shield-checkbox svelte-1r5hyyb"/> Shield Equipped (+2 AC)</label></div></div></div>'),ql=f('<div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="spellSaveDC" class="svelte-1r5hyyb">Spell Save DC</label> <!></div> <input type="number" id="spellSaveDC" class="stat-input svelte-1r5hyyb" readonly=""/></div>'),zl=f('<span class="hit-dice-type"> </span>'),Wl=f('<!> <div class="stats-grid svelte-1r5hyyb"><div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="armorClass" class="svelte-1r5hyyb">Armor Class</label> <!></div> <input type="text" id="armorClass" readonly=""/></div> <div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="initiative" class="svelte-1r5hyyb">Initiative</label> <!></div> <input type="text" id="initiative" class="stat-input svelte-1r5hyyb" readonly=""/></div> <div class="stat-box svelte-1r5hyyb"><label for="speed" class="svelte-1r5hyyb">Speed</label> <input type="text" id="speed" class="stat-input svelte-1r5hyyb"/></div> <!></div> <div class="hp-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Points</h3> <div><div class="hp-inputs svelte-1r5hyyb"><input type="number" class="hp-current svelte-1r5hyyb" min="0"/> <span class="hp-separator svelte-1r5hyyb">/</span> <input type="number" class="hp-max svelte-1r5hyyb" min="0"/></div> <div class="hp-controls svelte-1r5hyyb"><button class="hp-btn svelte-1r5hyyb">‚àí</button> <button class="hp-btn svelte-1r5hyyb">+</button> <button class="hp-btn svelte-1r5hyyb">‚àí5</button> <button class="hp-btn svelte-1r5hyyb">+5</button></div></div> <div class="temp-hp svelte-1r5hyyb"><label for="tempHP" class="svelte-1r5hyyb">Temp HP</label> <input type="number" id="tempHP" min="0" class="svelte-1r5hyyb"/></div></div> <div class="hit-dice-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Dice</h3> <div class="hit-dice-display svelte-1r5hyyb"><input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <span>/</span> <input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <!></div> <div class="hit-dice-controls svelte-1r5hyyb"><label for="hitDiceCount" class="svelte-1r5hyyb">Roll</label> <div class="hit-dice-count-controls svelte-1r5hyyb"><button class="hit-dice-btn svelte-1r5hyyb">‚àí</button> <input type="number" id="hitDiceCount" class="hit-dice-count-input svelte-1r5hyyb" min="1"/> <button class="hit-dice-btn svelte-1r5hyyb">+</button></div> <button class="btn btn-primary roll-hit-dice use-enabled svelte-1r5hyyb">üé≤ Roll</button></div></div>',1),Kl=f("<section><!> <!></section>");function Vl(i,c){Ot(c,!1);const t=()=>pt(de,"$character",L),v=()=>pt(qa,"$abilityModifiers",L),u=()=>pt(ga,"$searchFilter",L),p=()=>pt(Xt,"$collapsedStates",L),m=()=>pt(ha,"$isEditMode",L),[L,h]=na(),_=k(),Y=k(),F=k(),ie=k(),te=k(),z=k(),G=k(),R=_a();let I=k(1);function H(T){de.update(P=>(P.currentHP=Math.max(0,Math.min(P.maxHP,P.currentHP+T)),P))}function Te(T){const P=e(I)+T,w=t().hitDice.current;r(I,Math.max(1,Math.min(w,P)))}function Je(T=1){if(t().hitDice.current<=0){alert("No hit dice remaining!");return}if(!t().class){alert("Please select a class first!");return}const P=ia(t().class);if(!P){alert("Invalid class configuration!");return}const w=Math.min(T,t().hitDice.current),K=P.hitDice,g=v().constitution,M=g*w,q=M>=0?`+${M}`:`${M}`,Ae=`${w}${K}${q}`,Le=[];if(Le.push({value:`${w}${K}`,source:"hit dice"}),g!==0)for(let pe=0;pe<w;pe++)Le.push({value:g,source:"constitution"});R("rollHitDice",{notation:Ae,hitDie:K,count:w,bonusBreakdown:Le})}Ze(()=>(t(),v(),de),()=>{if(t().armorName!==void 0||t().shieldEquipped!==void 0){const T=v().dexterity,P=Rl(t().armorName,T,t().shieldEquipped||!1);t().armorClass!==P&&de.update(w=>({...w,armorClass:P}))}}),Ze(()=>(v(),t(),de),()=>{const T=v().dexterity;t().initiative!==T&&de.update(P=>({...P,initiative:T}))}),Ze(()=>t(),()=>{r(_,is(t(),t().abilities))}),Ze(()=>t(),()=>{r(Y,Tl(t(),t().abilities))}),Ze(()=>t(),()=>{r(F,Ml(t(),t().abilities))}),Ze(()=>t(),()=>{r(ie,Fl(t(),t().abilities))}),Ze(()=>(t(),e(I)),()=>{const T=t().hitDice.current;T>0&&e(I)>T&&r(I,T)}),Ze(()=>t(),()=>{r(te,t().activeStates&&t().activeStates.length>0?t().activeStates.reduce((T,P)=>T+(P.acBonus||0),0):0)}),Ze(()=>t(),()=>{r(z,t().activeStates&&t().activeStates.length>0?t().activeStates.some(T=>T.name==="Aid"&&T.target==="self"):!1)}),Ze(()=>u(),()=>{r(G,!u()||"armor class".includes(u().toLowerCase())||"initiative".includes(u().toLowerCase())||"speed".includes(u().toLowerCase())||"hit points".includes(u().toLowerCase())||"hp".includes(u().toLowerCase())||"hit dice".includes(u().toLowerCase())||"spell save".includes(u().toLowerCase())||"combat".includes(u().toLowerCase()))}),da(),Nt();var X=Kl();let Pe;var ue=l(X);{let T=$t(()=>(p(),n(()=>p().combatStats?"Expand":"Collapse")));ya(ue,{title:"Combat Stats",get collapsed(){return p(),n(()=>p().combatStats)},get ariaLabel(){return e(T)},onToggle:()=>Xt.update(P=>({...P,combatStats:!P.combatStats}))})}var xe=a(ue,2);{var Me=T=>{var P=Wl(),w=Se(P);{var K=re=>{var Ee=Gl(),be=a(l(Ee),2),Ue=l(be),ze=a(l(Ue),2);C(()=>{t(),Ut(()=>{})});var et=l(ze);et.value=(et.__value=void 0)??"";var it=a(et);kt(it,1,()=>Rs,Lt,(J,se)=>{var ge=gt(),Re=Se(ge);{var Qe=qe=>{var ut=Ol(),We=l(ut);s(ut);var O={};C(()=>{$(We,`${e(se),n(()=>e(se).name)??""} (AC ${e(se),n(()=>e(se).baseAC)??""})`),O!==(O=(e(se),n(()=>e(se).name)))&&(ut.value=(ut.__value=(e(se),n(()=>e(se).name)))??"")}),o(qe,ut)};b(Re,qe=>{e(se),n(()=>e(se).name!=="Unarmored")&&qe(Qe)})}o(J,ge)}),s(ze),s(Ue);var ve=a(Ue,2),S=l(ve),U=l(S);Ce(U),Qt(),s(S),s(ve),s(be),s(Ee),Ta(ze,()=>t().armorName,J=>It(de,n(t).armorName=J,n(t))),ka(U,()=>t().shieldEquipped,J=>It(de,n(t).shieldEquipped=J,n(t))),o(re,Ee)};b(w,re=>{m()&&re(K)})}var g=a(w,2),M=l(g),q=l(M),Ae=a(l(q),2);Xa(Ae,{get tooltipContent(){return e(Y)},ariaLabel:"Show AC breakdown"}),s(q);var Le=a(q,2);Ce(Le),s(M);var pe=a(M,2),ne=l(pe),Be=a(l(ne),2);Xa(Be,{get tooltipContent(){return e(F)},ariaLabel:"Show Initiative breakdown"}),s(ne);var He=a(ne,2);Ce(He),s(pe);var ot=a(pe,2),mt=a(l(ot),2);Ce(mt),s(ot);var vt=a(ot,2);{var Ke=re=>{var Ee=ql(),be=l(Ee),Ue=a(l(be),2);Xa(Ue,{get tooltipContent(){return e(ie)},ariaLabel:"Show Spell Save DC breakdown"}),s(be);var ze=a(be,2);Ce(ze),s(Ee),C(()=>Ba(ze,e(_))),o(re,Ee)};b(vt,re=>{e(_)!==null&&re(Ke)})}s(g);var xt=a(g,2),y=a(l(xt),2);let N;var ce=l(y),x=l(ce);Ce(x);var E=a(x,4);Ce(E),s(ce);var Z=a(ce,2),fe=l(Z),je=a(fe,2),Q=a(je,2),we=a(Q,2);s(Z),s(y);var V=a(y,2),j=a(l(V),2);Ce(j),s(V),s(xt);var he=a(xt,2),Ve=a(l(he),2),Oe=l(Ve);Ce(Oe);var lt=a(Oe,4);Ce(lt);var Fe=a(lt,2);{var d=re=>{const Ee=$t(()=>(W(ia),t(),n(()=>ia(t().class))));var be=gt(),Ue=Se(be);{var ze=et=>{const it=$t(()=>(v(),n(()=>v().constitution)));var ve=zl(),S=l(ve);s(ve),C(()=>$(S,`(${W(e(Ee)),n(()=>e(Ee).hitDice)??""}${(e(it)>=0?`+${e(it)}`:e(it))??""})`)),o(et,ve)};b(Ue,et=>{e(Ee)&&et(ze)})}o(re,be)};b(Fe,re=>{t(),n(()=>t().class)&&re(d)})}s(Ve);var me=a(Ve,2),$e=a(l(me),2),ee=l($e),ke=a(ee,2);Ce(ke);var _e=a(ke,2);s($e);var De=a($e,2);s(me),s(he),C(()=>{Ba(Le,(e(te),t(),n(()=>e(te)!==0?`${t().armorClass} ‚Üí ${t().armorClass+e(te)}`:`${t().armorClass}`))),At(Le,1,al(e(te)!==0?"stat-input ac-enhanced":"stat-input"),"svelte-1r5hyyb"),Ba(He,(t(),n(()=>t().initiative))),N=At(y,1,"hp-display svelte-1r5hyyb",null,N,{"aid-active":e(z)}),tt(x,"max",(t(),n(()=>t().maxHP))),tt(Oe,"max",(t(),n(()=>t().hitDice.max))),ee.disabled=e(I)<=1,tt(ke,"max",(t(),n(()=>t().hitDice.current))),_e.disabled=(e(I),t(),n(()=>e(I)>=t().hitDice.current)),De.disabled=(t(),n(()=>t().hitDice.current<=0||!t().class))}),Ne(mt,()=>t().speed,re=>It(de,n(t).speed=re,n(t))),Ne(x,()=>t().currentHP,re=>It(de,n(t).currentHP=re,n(t))),Ne(E,()=>t().maxHP,re=>It(de,n(t).maxHP=re,n(t))),D("click",fe,()=>H(-1)),D("click",je,()=>H(1)),D("click",Q,()=>H(-5)),D("click",we,()=>H(5)),Ne(j,()=>t().tempHP,re=>It(de,n(t).tempHP=re,n(t))),Ne(Oe,()=>t().hitDice.current,re=>It(de,n(t).hitDice.current=re,n(t))),Ne(lt,()=>t().hitDice.max,re=>It(de,n(t).hitDice.max=re,n(t))),D("click",ee,()=>Te(-1)),Ne(ke,()=>e(I),re=>r(I,re)),D("input",ke,re=>{const Ee=re.target,be=parseInt(Ee.value);be>t().hitDice.current&&r(I,t().hitDice.current),be<1&&r(I,1)}),D("click",_e,()=>Te(1)),D("click",De,()=>Je(e(I))),o(T,P)};b(xe,T=>{p(),n(()=>!p().combatStats)&&T(Me)})}s(X),C(()=>Pe=At(X,1,"combat-stats svelte-1r5hyyb",null,Pe,{hidden:!e(G)})),o(i,X),Gt(),h()}const Ea={acrobatics:"dexterity",animalHandling:"wisdom",arcana:"intelligence",athletics:"strength",deception:"charisma",history:"intelligence",insight:"wisdom",intimidation:"charisma",investigation:"intelligence",medicine:"wisdom",nature:"intelligence",perception:"wisdom",performance:"charisma",persuasion:"charisma",religion:"intelligence",sleightOfHand:"dexterity",stealth:"dexterity",survival:"wisdom"};var Jl=f('<div class="skill-row svelte-1f1pl16"><input type="checkbox" class="svelte-1f1pl16"/> <label class="svelte-1f1pl16"> <span class="ability-tag svelte-1f1pl16"> </span></label> <span class="skill-modifier svelte-1f1pl16"> </span> <button class="roll-btn svelte-1f1pl16">Roll</button></div>'),Yl=f('<div class="skills-grid svelte-1f1pl16"></div>'),Ql=f("<section><!> <!></section>");function Xl(i,c){Ot(c,!1);const t=()=>pt(de,"$character",L),v=()=>pt(qa,"$abilityModifiers",L),u=()=>pt(ga,"$searchFilter",L),p=()=>pt(Xt,"$collapsedStates",L),m=()=>pt(ha,"$isEditMode",L),[L,h]=na(),_=k(),Y=k(),F=k(),ie=k(),te=k(),z=k(),G=_a(),R=[{key:"acrobatics",label:"Acrobatics"},{key:"animalHandling",label:"Animal Handling"},{key:"arcana",label:"Arcana"},{key:"athletics",label:"Athletics"},{key:"deception",label:"Deception"},{key:"history",label:"History"},{key:"insight",label:"Insight"},{key:"intimidation",label:"Intimidation"},{key:"investigation",label:"Investigation"},{key:"medicine",label:"Medicine"},{key:"nature",label:"Nature"},{key:"perception",label:"Perception"},{key:"performance",label:"Performance"},{key:"persuasion",label:"Persuasion"},{key:"religion",label:"Religion"},{key:"sleightOfHand",label:"Sleight of Hand"},{key:"stealth",label:"Stealth"},{key:"survival",label:"Survival"}];function I(ue){const xe=Ea[ue],Me=v()[xe],T=t().skillProficiencies[ue]?t().proficiencyBonus:0,P=e(_)[ue],w=`1d20${P>=0?"+":""}${P}`,K=[];K.push({value:"1d20",source:"base die"}),Me!==0&&K.push({value:Me,source:xe}),T!==0&&K.push({value:T,source:"proficiency"}),G("roll",{notation:w,rollType:"check",bonusBreakdown:K})}Ze(()=>{},()=>{r(_,{})}),Ze(()=>t(),()=>{r(Y,t().skillProficiencies)}),Ze(()=>t(),()=>{r(F,t().proficiencyBonus)}),Ze(()=>v(),()=>{r(ie,v())}),Ze(()=>(e(ie),e(Y),e(F)),()=>{for(const{key:ue}of R){const xe=Ea[ue],Me=e(ie)[xe],T=e(Y)[ue]?e(F):0;ma(_,e(_)[ue]=Me+T)}}),Ze(()=>u(),()=>{r(te,R.filter(({label:ue})=>u()?ue.toLowerCase().includes(u().toLowerCase()):!0))}),Ze(()=>e(te),()=>{r(z,e(te).length>0)}),da(),Nt();var H=Ql();let Te;var Je=l(H);{let ue=$t(()=>(p(),n(()=>p().skills?"Expand":"Collapse")));ya(Je,{title:"Skills",get collapsed(){return p(),n(()=>p().skills)},get ariaLabel(){return e(ue)},onToggle:()=>Xt.update(xe=>({...xe,skills:!xe.skills}))})}var X=a(Je,2);{var Pe=ue=>{var xe=Yl();kt(xe,5,()=>e(te),Lt,(Me,T)=>{let P=()=>e(T).key,w=()=>e(T).label;var K=Jl(),g=l(K);Ce(g);var M=a(g,2),q=l(M),Ae=a(q),Le=l(Ae);s(Ae),s(M);var pe=a(M,2),ne=l(pe);s(pe);var Be=a(pe,2);s(K),C(He=>{As(g,(e(Y),P(),n(()=>e(Y)[P()]))),g.disabled=!m(),tt(g,"id",P()),tt(M,"for",P()),$(q,`${w()??""} `),$(Le,`(${He??""})`),$(ne,`${e(_),P(),n(()=>e(_)[P()]>=0?"+":"")??""}${e(_),P(),n(()=>e(_)[P()])??""}`)},[()=>(W(Ea),P(),n(()=>Ea[P()].substring(0,3).toUpperCase()))]),D("change",g,He=>{console.log("Skill proficiency changed:",P(),He.target.checked),de.update(ot=>({...ot,skillProficiencies:{...ot.skillProficiencies,[P()]:He.target.checked}}))}),D("click",Be,()=>I(P())),o(Me,K)}),s(xe),o(ue,xe)};b(X,ue=>{p(),n(()=>!p().skills)&&ue(Pe)})}s(H),C(()=>Te=At(H,1,"skills svelte-1f1pl16",null,Te,{hidden:!e(z)})),o(i,H),Gt(),h()}var Zl=f('<p class="empty-message svelte-1123ljy">No attacks or spells to reorder.</p>'),ei=f('<li class="reorder-item svelte-1123ljy"><span class="attack-name svelte-1123ljy"> </span> <div class="reorder-buttons svelte-1123ljy"><button class="btn-move svelte-1123ljy" aria-label="Move up">‚ñ≤</button> <button class="btn-move svelte-1123ljy" aria-label="Move down">‚ñº</button></div></li>'),ti=f('<ul class="reorder-list svelte-1123ljy"></ul>'),ai=f('<div class="modal-backdrop svelte-1123ljy" role="presentation"><div class="modal-content svelte-1123ljy" role="dialog" aria-modal="true" aria-labelledby="modal-title"><div class="modal-header svelte-1123ljy"><h3 id="modal-title" class="svelte-1123ljy">Reorder Attacks & Spells</h3> <button class="btn-close svelte-1123ljy" aria-label="Close">√ó</button></div> <div class="modal-body svelte-1123ljy"><!></div> <div class="modal-footer svelte-1123ljy"><button class="btn btn-secondary svelte-1123ljy">Cancel</button> <button class="btn btn-primary svelte-1123ljy">Save Order</button></div></div></div>');function si(i,c){Ot(c,!1);let t=Dt(c,"show",8,!1),v=Dt(c,"attacks",24,()=>[]),u=Dt(c,"onSave",8),p=Dt(c,"onCancel",8),m=k([]);function L(R,I){const H=e(m)[R];ma(m,e(m)[R]=e(m)[I]),ma(m,e(m)[I]=H),r(m,[...e(m)])}function h(R){R>0&&L(R,R-1)}function _(R){R<e(m).length-1&&L(R,R+1)}function Y(){u()(e(m))}function F(){p()()}function ie(R){R.target===R.currentTarget&&F()}Ze(()=>(W(t()),W(v())),()=>{t()&&r(m,[...v()])}),da(),Nt();var te=gt(),z=Se(te);{var G=R=>{var I=ai(),H=l(I),Te=l(H),Je=a(l(Te),2);s(Te);var X=a(Te,2),Pe=l(X);{var ue=w=>{var K=Zl();o(w,K)},xe=w=>{var K=ti();kt(K,7,()=>e(m),g=>g.id,(g,M,q)=>{var Ae=ei(),Le=l(Ae),pe=l(Le,!0);s(Le);var ne=a(Le,2),Be=l(ne),He=a(Be,2);s(ne),s(Ae),C(()=>{$(pe,(e(M),n(()=>e(M).name||"(Unnamed attack or spell)"))),Be.disabled=e(q)===0,He.disabled=(W(e(q)),e(m),n(()=>e(q)===e(m).length-1))}),D("click",Be,()=>h(e(q))),D("click",He,()=>_(e(q))),o(g,Ae)}),s(K),o(w,K)};b(Pe,w=>{e(m),n(()=>e(m).length===0)?w(ue):w(xe,!1)})}s(X);var Me=a(X,2),T=l(Me),P=a(T,2);s(Me),s(H),s(I),D("click",Je,F),D("click",T,F),D("click",P,Y),D("click",I,ie),o(R,I)};b(z,R=>{t()&&R(G)})}o(i,te),Gt()}let Ha=null,Ua=null;async function Ms(){if(Ha)return Ha;try{return Ha=await(await fetch(Bs("/data/spells.json"))).json(),Ha||[]}catch(i){return console.error("Failed to load spells:",i),[]}}async function li(){if(Ua)return Ua;try{return Ua=await(await fetch(Bs("/data/feats.json"))).json(),Ua||[]}catch(i){return console.error("Failed to load feats:",i),[]}}function xs(i,c){if(!c.trim())return i;const t=c.toLowerCase();return i.filter(v=>v.name.toLowerCase().includes(t)||v.school.toLowerCase().includes(t)||v.classes.some(u=>u.toLowerCase().includes(t))||v.description.toLowerCase().includes(t))}function ii(i,c){return c===null?i:i.filter(t=>t.level===c)}function ni(i,c){if(!c.trim())return i;const t=c.toLowerCase();return i.filter(v=>v.name.toLowerCase().includes(t)||v.description.toLowerCase().includes(t))}function Na(i){const c=i.description,t=/\b(Strength|Dexterity|Constitution|Intelligence|Wisdom|Charisma)\s+saving\s+throw/i,v=c.match(t);if(!v)return null;const u=v[1].toLowerCase(),m=/half\s+(?:as\s+much\s+)?damage\s+on\s+a\s+successful(?:\s+save)?/i.test(c),h=/saving\s+throw\s+or\s+take.*?damage/i.test(c)&&!m;return{ability:u,halfDamageOnSave:m,noDamageOnSave:h}}function ri(i){const c=i.description;return/(plus|add)\s+your\s+spellcasting\s+(ability\s+)?modifier/i.test(c)}function Za(i){const c=i.description.toLowerCase();return c.includes("ranged spell attack")||c.includes("melee spell attack")}function ws(i){const c=i.description.toLowerCase();if(["Divine Favor","Bless","Aid","Command"].includes(i.name))return!0;const u=["takes","take","deals","deal","damage equal to","force damage","fire damage","cold damage","lightning damage","thunder damage","acid damage","poison damage","necrotic damage","radiant damage","psychic damage","regain","regains","hit point"].some(L=>c.includes(L));return["bonus to attack","bonus to damage","bonus to ac","gains a +","gain a +","+1 bonus","+2 bonus","+3 bonus","advantage on","becomes a magic weapon"].some(L=>c.includes(L))&&!u}function oi(i){const c=i.description;let t=0,v=0,u=0,p="";const m=c.match(/\+(\d+)\s+bonus\s+to\s+attack\s+rolls\s+and\s+damage\s+rolls/i);if(m){const h=parseInt(m[1]);t=h,v=h,p=`+${h} to attack and damage rolls`}if(i.name==="Bless"&&(p="Add 1d4 to attack rolls and saves",t="1d4"),i.name==="Aid")return p="+5 HP (max and current) for 8 hours",{attackBonus:0,damageBonus:0,acBonus:0,hpBonus:5,description:p,name:i.name};i.name==="Divine Favor"&&(p="Your weapon attacks deal an extra 1d4 radiant damage on a hit.",v="1d4");const L=c.match(/\+(\d+)\s+bonus\s+to\s+AC/i);return L&&(u=parseInt(L[1]),p=`+${u} to AC`),i.name==="Haste"&&(p="+2 AC, doubled speed, extra action",u=2),p||t!==0||v!==0||u!==0?{attackBonus:t,damageBonus:v,acBonus:u,description:p||i.description.substring(0,100),name:i.name}:null}function es(i){const c=i.description,t=/takes?\s+(\d+d\d+)\s+\w+\s+damage[^.]*\.\s*If\s+the\s+target\s+is\s+missing.*?instead\s+takes?\s+(\d+d\d+)/is,v=c.match(t);return v?{baseDamage:v[1],alternateDamage:v[2]}:null}var ci=f('<button class="btn btn-secondary">Reorder</button>'),vi=f('<div class="edit-buttons svelte-14o91c5"><button class="btn btn-secondary">Add Attack</button> <!></div>'),di=f('<input type="text" placeholder="Attack name" class="attack-name svelte-14o91c5"/>'),ui=f('<h4 class="attack-name-display svelte-14o91c5"> </h4>'),fi=f('<button class="btn-remove svelte-14o91c5">√ó</button>'),pi=f('<div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Bonus</label> <input type="number" class="attack-bonus svelte-14o91c5"/></div>'),mi=f('<div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Damage</label> <input type="text" placeholder="e.g., 2d6+3" class="attack-damage svelte-14o91c5"/></div>'),gi=f('<div class="spell-info-loading svelte-14o91c5">Loading spell info...</div>'),bi=f('<li class="svelte-14o91c5"><strong>At Higher Levels:</strong> </li>'),hi=f('<ul class="svelte-14o91c5"><li class="svelte-14o91c5"><strong>Level:</strong> </li> <li class="svelte-14o91c5"><strong>Casting Time:</strong> </li> <li class="svelte-14o91c5"><strong>Range:</strong> </li> <li class="svelte-14o91c5"><strong>Components:</strong> <!></li> <li class="svelte-14o91c5"><strong>Duration:</strong> <!> </li> <li class="svelte-14o91c5"><strong>Description:</strong> </li> <!></ul>'),_i=f('<span class="scaled-damage svelte-14o91c5" style="margin-left: 8px;"> </span>'),yi=f('<span class="scaled-damage svelte-14o91c5">(Half damage)</span>'),xi=f('<span class="scaled-damage svelte-14o91c5">(No damage)</span>'),wi=f('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> <!> <!></label></div>'),$i=f('<span class="scaled-damage svelte-14o91c5"> </span>'),ki=f('<span class="scaled-damage svelte-14o91c5"> </span>'),Si=f('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> Target is missing HP <!></label></div>'),Ci=f("<option> </option>"),Di=f('<span class="scaled-damage svelte-14o91c5"><!> </span>'),Li=f('<span class="scaled-damage svelte-14o91c5"> </span>'),ji=f('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> Target is Fiend or Undead <!></label></div>'),Ai=f('<div class="spell-level-selector svelte-14o91c5"><label class="svelte-14o91c5">Cast at Level:</label> <select class="spell-level-select use-enabled svelte-14o91c5"></select> <!></div> <!>',1),Bi=f('<div class="spell-level-selector svelte-14o91c5"><span style="color: #dc3545; font-weight: bold;">No spell slots available!</span></div>'),Ri=f('<div class="spell-info svelte-14o91c5"><div class="spell-info-header svelte-14o91c5" role="button" tabindex="0"><h4 class="svelte-14o91c5">Spell Info</h4> <button class="collapse-btn-small svelte-14o91c5"> </button></div> <!></div> <!> <!> <!>',1),Ti=f('<div class="spell-info-missing svelte-14o91c5">Spell info not found.</div>'),Mi=f('<div class="attack-notes svelte-14o91c5"><label class="svelte-14o91c5">Notes</label> <textarea placeholder="e.g., DC 15 Dex save, Range 120 ft, Concentration" class="notes-input svelte-14o91c5" rows="2"></textarea></div>'),Fi=f('<button class="btn btn-primary">Roll Attack</button>'),Pi=f('<div class="buff-target-selection svelte-14o91c5"><div class="target-options svelte-14o91c5"><label class="target-option svelte-14o91c5"><input type="radio" class="svelte-14o91c5"/> Self</label> <label class="target-option svelte-14o91c5"><input type="radio" class="svelte-14o91c5"/> Other</label></div> <button class="btn btn-info"> </button></div>'),Ii=f('<button class="btn btn-info">Cast Spell</button>'),Ei=f("<button><!></button>"),Hi=f('<button class="btn btn-info">Cast Spell</button>'),Ui=f('<button class="btn btn-secondary">Roll Damage</button>'),Ni=f('<button class="btn btn-primary">Roll Attack</button> <!>',1),Oi=f('<div class="attack-card svelte-14o91c5"><div class="attack-header svelte-14o91c5"><!> <!></div> <div class="attack-details svelte-14o91c5"><!> <!> <div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Type</label> <input type="text" placeholder="e.g., slashing" class="attack-type svelte-14o91c5"/></div></div> <!> <!> <div class="attack-actions svelte-14o91c5"><!></div></div>'),Gi=f('<p class="no-attacks svelte-14o91c5">No attacks added yet. Click "Add Attack" to create one.</p>'),qi=f('<p class="no-attacks svelte-14o91c5">No attacks match your search.</p>'),zi=f('<span class="ability-uses svelte-14o91c5"> <!></span>'),Wi=f('<span class="ability-reaction svelte-14o91c5">‚ö° Reaction</span>'),Ki=f('<button class="btn btn-ability svelte-14o91c5">Use Ability</button>'),Vi=f('<div class="ability-card svelte-14o91c5"><div class="ability-header svelte-14o91c5"><h4 class="ability-name svelte-14o91c5"> </h4> <span class="ability-source svelte-14o91c5"> </span></div> <p class="ability-description svelte-14o91c5"> </p> <div class="ability-footer svelte-14o91c5"><!> <!> <!></div></div>'),Ji=f('<div class="condition-abilities-section svelte-14o91c5"><h3 class="abilities-header svelte-14o91c5">Condition Abilities</h3> <p class="section-description svelte-14o91c5">Special actions granted by active conditions (e.g., Flicker of Deceit)</p> <div class="abilities-list svelte-14o91c5"></div></div>'),Yi=f('<button class="btn-remove svelte-14o91c5">√ó</button>'),Qi=f('<div class="state-card svelte-14o91c5"><div class="state-header svelte-14o91c5"><input type="text" placeholder="Effect name (e.g., Magic Weapon)" class="state-name svelte-14o91c5"/> <!></div> <div class="state-details svelte-14o91c5"><div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Attack Bonus</label> <input type="number" class="state-bonus svelte-14o91c5"/></div> <div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Damage Bonus</label> <input type="text" class="state-bonus svelte-14o91c5"/></div> <div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Target</label> <select class="state-bonus svelte-14o91c5"><option>Self</option><option>Other</option></select></div></div> <div class="state-description svelte-14o91c5"><label class="svelte-14o91c5">Description</label> <input type="text" placeholder="e.g., +1 to attack and damage rolls (Magic Weapon)" class="state-desc-input svelte-14o91c5"/></div></div>'),Xi=f('<div class="states-list svelte-14o91c5"></div>'),Zi=f('<p class="no-states svelte-14o91c5">No active effects. Add spell effects that modify your attacks.</p>'),en=f('<!> <div class="attacks-list svelte-14o91c5"><!> <!></div> <!> <div class="active-states-section svelte-14o91c5"><h3 class="svelte-14o91c5">Active Spell Effects</h3> <p class="section-description svelte-14o91c5">Effects that modify attack and damage rolls (e.g., Magic Weapon, Bless)</p> <button class="btn btn-secondary">Add Effect</button> <!></div>',1),tn=f("<section><!> <!></section> <!>",1);function an(i,c){Ot(c,!1);const t=()=>pt(de,"$character",m),v=()=>pt(ga,"$searchFilter",m),u=()=>pt(Xt,"$collapsedStates",m),p=()=>pt(ha,"$isEditMode",m),[m,L]=na(),h=k(),_=k(),Y=k(),F=[];function ie(y,N){de.update(ce=>{if(!ce.activeStates)return ce;const x=ce.activeStates.findIndex(je=>je.name===y);if(x===-1)return ce;const E=ce.activeStates[x];if(!E.abilities)return ce;const Z=E.abilities.findIndex(je=>je.name===N);if(Z===-1)return ce;const fe=E.abilities[Z];return fe.currentUses!==void 0&&fe.currentUses>0&&(fe.currentUses-=1,fe.usesPerRest!==void 0?Mt.add(`Used ${N} (${fe.currentUses}/${fe.usesPerRest} remaining)`,"info"):Mt.add(`Used ${N}`,"info")),ce})}const te=_a();let z=k({}),G=k({}),R=k(!1);function I(y){ma(z,e(z)[y]=!e(z)[y]),r(z,{...e(z)})}function H(y){return y.description.toLowerCase().includes("regain")&&(y.description.toLowerCase().includes("hit point")||y.description.toLowerCase().includes("hp"))}function Te(y){return["Shield of Faith","Bless","Aid","Magic Weapon"].includes(y)}function Je(){de.update(y=>(y.attacks=[...y.attacks,{id:crypto.randomUUID(),name:"",bonus:0,damage:"",damageType:"",notes:""}],y))}function X(y){de.update(N=>(N.attacks=N.attacks.filter(ce=>ce.id!==y),N))}function Pe(){r(R,!0)}function ue(){r(R,!1)}function xe(y){de.update(N=>(N.attacks=y,N)),r(R,!1),Mt.add("Attack order updated successfully!","success")}function Me(y){let N=y.damage,ce=!1,x=!1;if(y.spellRef){const Q=K(y.spellRef);if(Q&&(x=Za(Q),Q.level>0)){const we=y.castAtLevel||Q.level;let V=!1;if(y.source==="racial"){if(V=M(y.name),!V){Mt.add(`No uses of ${y.name} remaining!`,"error");return}}else if(V=g(we),!V){Mt.add(`No level ${we} spell slots available!`,"error");return}const j=Na(Q);j&&y.targetSucceededSave&&j.noDamageOnSave?N="0":(ce=j?.halfDamageOnSave&&y.targetSucceededSave||!1,N=q(y,Q))}}else if(t().activeStates&&t().activeStates.length>0){let Q=0,we=[];for(const V of t().activeStates)V.target!=="other"&&(typeof V.damageBonus=="string"?we.push(V.damageBonus):typeof V.damageBonus=="number"&&(Q+=V.damageBonus));if((Q!==0||we.length>0)&&N){const V=N.match(/(\d+d\d+)([+-]\d+)?/);if(V){const[,j,he]=V,Oe=(he?parseInt(he):0)+Q;let lt=`${j}`;Oe!==0&&(lt+=`${Oe>=0?"+":""}${Oe}`),we.length>0&&(lt+=" + "+we.join(" + ")),N=lt}}}const E=[];let Z=0;if(x){const Q=Qa(t(),t().abilities),we=t().proficiencyBonus||0;E.push({value:we,source:"proficiency"}),E.push({value:Q,source:"spellcasting"}),Z=we+Q}else y.bonus!==0&&E.push({value:y.bonus,source:"base"}),Z=y.bonus;let fe=[];if(t().activeStates)for(const Q of t().activeStates)Q.target!=="other"&&(typeof Q.attackBonus=="number"&&Q.attackBonus!==0?(E.push({value:Q.attackBonus,source:Q.name.toLowerCase()}),Z+=Q.attackBonus):typeof Q.attackBonus=="string"&&Q.attackBonus&&(fe.push(Q.attackBonus),E.push({value:Q.attackBonus,source:Q.name.toLowerCase()})));let je=`1d20${Z>=0?"+":""}${Z}`;fe.length>0&&(je+="+"+fe.join("+")),te("roll",{notation:je,damageNotation:N,attackName:y.name,applyHalfDamage:ce,bonusBreakdown:E,rollType:"attack"})}function T(y){if(!y.damage){Mt.add(`${y.name}: No damage specified`,"error");return}let N=y.damage,ce=!1;const x=[];let E=y.damageType||"";if(y.spellRef){const Z=K(y.spellRef);if(Z){const fe=H(Z);if(fe){const je=Qa(t(),t().abilities),Q=N.match(/^(\d+d\d+)/);Q&&(N=Q[1],je>0&&(N+=`+${je}`,x.push({value:je,source:"spellcasting"}))),E="Healing"}if(Z.level>0){const je=y.castAtLevel||Z.level;let Q=!1;if(y.source==="racial"){if(Q=M(y.name),!Q){Mt.add(`No uses of ${y.name} remaining!`,"error");return}}else if(Q=g(je),!Q){Mt.add(`No level ${je} spell slots available!`,"error");return}const we=Na(Z);we&&y.targetSucceededSave&&we.noDamageOnSave?N="0":(ce=we?.halfDamageOnSave&&y.targetSucceededSave||!1,fe||(N=q(y,Z))),Z.damageType&&!fe&&(E=Z.damageType)}}}else{const Z=N.match(/(\d+d\d+)([+-]\d+)?/);if(Z){const[,fe,je]=Z,Q=je?parseInt(je):0;if(Q!==0&&x.push({value:Q,source:"base"}),t().activeStates&&t().activeStates.length>0){let we=0,V=[];for(const j of t().activeStates)j.target!=="other"&&(typeof j.damageBonus=="string"?V.push(j.damageBonus):typeof j.damageBonus=="number"&&j.damageBonus!==0&&(x.push({value:j.damageBonus,source:j.name.toLowerCase()}),we+=j.damageBonus));if(we!==0||V.length>0){const j=Q+we;let he=`${fe}`;j!==0&&(he+=`${j>=0?"+":""}${j}`),V.length>0&&(he+=" + "+V.join(" + ")),N=he}}}}te("roll",{notation:N,attackName:y.name,applyHalfDamage:ce,bonusBreakdown:x,damageType:E})}let P=k([]),w=k(!1);$a(async()=>{r(P,await Ms()),r(w,!0)});function K(y){return e(P).find(N=>N.name===y)}function g(y){t().classFeatures.spellSlotsByLevel||It(de,n(t).classFeatures.spellSlotsByLevel={},n(t)),t().classFeatures.spellSlotsByLevel[y]||It(de,n(t).classFeatures.spellSlotsByLevel[y]=Array(2).fill(!1),n(t));const ce=t().classFeatures.spellSlotsByLevel[y].findIndex(x=>!x);return ce===-1?!1:(de.update(x=>(x.classFeatures.spellSlotsByLevel||(x.classFeatures.spellSlotsByLevel={}),x.classFeatures.spellSlotsByLevel[y]||(x.classFeatures.spellSlotsByLevel[y]=Array(2).fill(!1)),x.classFeatures.spellSlotsByLevel[y][ce]=!0,x)),!0)}function M(y){return!t().racialTraits||!t().racialTraits.uses[y]?!0:t().racialTraits.uses[y].currentUses<=0?!1:(sl(y),!0)}function q(y,N){let ce=y.damage,x=0,E=0;const Z=es(N);if(Z&&y.targetIsDamaged&&(ce=Z.alternateDamage),ri(N)&&(E+=Qa(t(),t().abilities)),t().activeStates)for(const Oe of t().activeStates)Oe.target!=="other"&&typeof Oe.damageBonus=="number"&&(E+=Oe.damageBonus);if(N.higherLevelSlot&&y.castAtLevel){const Oe=N.level,Fe=(y.castAtLevel||Oe)-Oe;if(Fe>0){const d=N.higherLevelSlot.match(/(\d+)d(\d+)\s+for\s+each.*?level\s+above/i);if(d){const[,me]=d;x+=Fe*parseInt(me)}}}if(y.targetIsFiendOrUndead&&N.description.includes("Fiend or an Undead")){const Oe=N.description.match(/increases by (\d+)d(\d+) if.*?Fiend or.*?Undead/i);if(Oe){const[,lt]=Oe;x+=parseInt(lt)}}const fe=ce.match(/(\d+)d(\d+)([+-]\d+)?/);if(!fe)return E!==0?E>=0?`${E}`:`${E}`:ce||"0";const[,je,Q,we]=fe,V=parseInt(je)+x,he=(we?parseInt(we):0)+E;let Ve=`${V}d${Q}`;return he!==0&&(Ve+=he>=0?`+${he}`:`${he}`),Ve}function Ae(y){const N=[];for(let x=y.level;x<=9;x++){const E=t().classFeatures.spellSlotsByLevel?.[x];E&&E.length>0&&N.push(x)}return N}function Le(){de.update(y=>(y.activeStates||(y.activeStates=[]),y.activeStates=[...y.activeStates,{name:"",attackBonus:0,damageBonus:0,description:"",target:"self"}],y))}function pe(y){de.update(N=>{if(N.activeStates){const ce=N.activeStates[y];ce?.hpBonus&&ce.target!=="other"&&(N.maxHP-=ce.hpBonus,N.currentHP=Math.max(1,Math.min(N.currentHP-ce.hpBonus,N.maxHP))),N.activeStates=N.activeStates.filter((x,E)=>E!==y)}return N})}function ne(y,N="self"){const ce=K(y.spellRef);if(!ce){Mt.add("Spell not found","error");return}const x=y.castAtLevel||ce.level;if(x>0){let V=!1;if(y.source==="racial"){if(V=M(y.name),!V){Mt.add(`No uses of ${y.name} remaining!`,"error");return}}else if(V=g(x),!V){Mt.add(`No level ${x} spell slots available!`,"error");return}}const E=oi(ce);if(!E){Mt.add(`${ce.name} cast! Check spell description for effects.`,"info");return}let Z=E.hpBonus||0,fe=E.description;ce.name==="Aid"&&x>ce.level&&(Z=5+(x-ce.level)*5,fe=`+${Z} HP (max and current) for 8 hours`);const Q=["Shield of Faith","Bless","Aid","Magic Weapon"].includes(ce.name);de.update(V=>{V.activeStates||(V.activeStates=[]);const j=V.activeStates.find(he=>he.name===ce.name);return j&&j.hpBonus&&j.target!=="other"&&(V.maxHP-=j.hpBonus,V.currentHP=Math.max(1,Math.min(V.currentHP-j.hpBonus,V.maxHP))),V.activeStates=V.activeStates.filter(he=>he.name!==ce.name),Z>0&&N==="self"&&(V.maxHP+=Z,V.currentHP+=Z),V.activeStates=[...V.activeStates,{name:ce.name,attackBonus:E.attackBonus,damageBonus:E.damageBonus,acBonus:E.acBonus,description:fe,target:N,hpBonus:Z}],V});const we=N==="self"?" on self":" on other";Mt.add(`${ce.name} cast${Q?we:""}! Effect added to Active Spell Effects.`,"success")}Ze(()=>t(),()=>{r(h,t().activeStates?t().activeStates.filter(y=>y.abilities&&y.abilities.length>0).flatMap(y=>y.abilities.map(N=>({...N,conditionName:y.name}))):[])}),Ze(()=>(t(),e(z),e(G)),()=>{if(t()&&t().attacks)for(const y of t().attacks)y.spellRef&&e(z)[y.id]===void 0&&ma(z,e(z)[y.id]=!0),y.spellRef&&e(G)[y.id]===void 0&&ma(G,e(G)[y.id]="self")}),Ze(()=>(t(),v()),()=>{r(_,t().attacks.filter(y=>{if(!v())return!0;const N=v().toLowerCase();return y.name.toLowerCase().includes(N)||y.damageType.toLowerCase().includes(N)}).sort((y,N)=>!y.spellRef&&N.spellRef?-1:y.spellRef&&!N.spellRef?1:0))}),Ze(()=>(v(),e(_)),()=>{r(Y,!v()||e(_).length>0||"attack".includes(v().toLowerCase())||"spell".includes(v().toLowerCase()))}),da(),Nt();var Be=tn(),He=Se(Be);let ot;var mt=l(He);{let y=$t(()=>(u(),n(()=>u().attacks?"Expand":"Collapse")));ya(mt,{title:"Attacks & Spells",get collapsed(){return u(),n(()=>u().attacks)},get ariaLabel(){return e(y)},onToggle:()=>Xt.update(N=>({...N,attacks:!N.attacks}))})}var vt=a(mt,2);{var Ke=y=>{var N=en(),ce=Se(N);{var x=Fe=>{var d=vi(),me=l(d),$e=a(me,2);{var ee=ke=>{var _e=ci();D("click",_e,Pe),o(ke,_e)};b($e,ke=>{t(),n(()=>t().attacks.length>0)&&ke(ee)})}s(d),D("click",me,Je),o(Fe,d)};b(ce,Fe=>{p()&&Fe(x)})}var E=a(ce,2),Z=l(E);kt(Z,1,()=>e(_),Fe=>Fe.id,(Fe,d,me)=>{var $e=Oi(),ee=l($e),ke=l(ee);{var _e=O=>{var le=di();Ce(le),Ne(le,()=>e(d).name,nt=>(e(d).name=nt,Ut(()=>(e(_),t(),v())))),o(O,le)},De=O=>{var le=ui(),nt=l(le,!0);s(le),C(()=>$(nt,(e(d),n(()=>e(d).name||"(Unnamed Attack)")))),o(O,le)};b(ke,O=>{p()?O(_e):O(De,!1)})}var re=a(ke,2);{var Ee=O=>{var le=fi();D("click",le,()=>X(e(d).id)),o(O,le)};b(re,O=>{p()&&O(Ee)})}s(ee);var be=a(ee,2),Ue=l(be);{var ze=O=>{var le=pi(),nt=l(le),Ye=a(nt,2);Ce(Ye),s(le),C(()=>{tt(nt,"for",`attack-bonus-${e(d),n(()=>e(d).id)??""}`),tt(Ye,"id",`attack-bonus-${e(d),n(()=>e(d).id)??""}`)}),Ne(Ye,()=>e(d).bonus,at=>(e(d).bonus=at,Ut(()=>(e(_),t(),v())))),o(O,le)};b(Ue,O=>{e(d),n(()=>e(d).bonus!==0&&e(d).bonus!==void 0)&&O(ze)})}var et=a(Ue,2);{var it=O=>{var le=mi(),nt=l(le),Ye=a(nt,2);Ce(Ye),s(le),C(()=>{tt(nt,"for",`attack-damage-${e(d),n(()=>e(d).id)??""}`),tt(Ye,"id",`attack-damage-${e(d),n(()=>e(d).id)??""}`)}),Ne(Ye,()=>e(d).damage,at=>(e(d).damage=at,Ut(()=>(e(_),t(),v())))),o(O,le)};b(et,O=>{e(d),n(()=>e(d).damage&&e(d).damage.trim()!=="")&&O(it)})}var ve=a(et,2),S=l(ve),U=a(S,2);Ce(U),s(ve),s(be);var J=a(be,2);{var se=O=>{var le=gt(),nt=Se(le);{var Ye=rt=>{var oe=gi();o(rt,oe)},at=rt=>{const oe=$t(()=>(e(d),n(()=>K(e(d).spellRef))));var B=gt(),Ge=Se(B);{var ae=A=>{const bt=$t(()=>(W(Na),W(e(oe)),n(()=>Na(e(oe))))),ht=$t(()=>(W(es),W(e(oe)),n(()=>es(e(oe)))));var ft=Ri(),ye=Se(ft),st=l(ye),Xe=a(l(st),2),Bt=l(Xe,!0);s(Xe),s(st);var yt=a(st,2);{var _t=Rt=>{var Ft=hi(),qt=l(Ft),sa=a(l(qt));s(qt);var oa=a(qt,2),ua=a(l(oa));s(oa);var Yt=a(oa,2),Et=a(l(Yt));s(Yt);var Kt=a(Yt,2),ea=a(l(Kt)),jt=a(ea);{var ct=Ht=>{var Wt=Tt();C(()=>$(Wt,`(${W(e(oe)),n(()=>e(oe).material)??""})`)),o(Ht,Wt)};b(jt,Ht=>{W(e(oe)),n(()=>e(oe).material)&&Ht(ct)})}s(Kt);var wt=a(Kt,2),St=a(l(wt),2);{var Pt=Ht=>{var Wt=Tt("Concentration,");o(Ht,Wt)};b(St,Ht=>{W(e(oe)),n(()=>e(oe).concentration)&&Ht(Pt)})}var Ct=a(St,1,!0);s(wt);var Vt=a(wt,2),zt=a(l(Vt));s(Vt);var ca=a(Vt,2);{var fa=Ht=>{var Wt=bi(),va=a(l(Wt));s(Wt),C(()=>$(va,` ${W(e(oe)),n(()=>e(oe).higherLevelSlot)??""}`)),o(Ht,Wt)};b(ca,Ht=>{W(e(oe)),n(()=>e(oe).higherLevelSlot)&&Ht(fa)})}s(Ft),C(Ht=>{$(sa,` ${W(e(oe)),n(()=>e(oe).level)??""}`),$(ua,` ${W(e(oe)),n(()=>e(oe).castingTime||e(oe).actionType)??""}`),$(Et,` ${W(e(oe)),n(()=>e(oe).range)??""}`),$(ea,` ${Ht??""}`),$(Ct,(W(e(oe)),n(()=>e(oe).duration))),$(zt,` ${W(e(oe)),n(()=>e(oe).description)??""}`)},[()=>(W(e(oe)),n(()=>e(oe).components.join(", ")))]),o(Rt,Ft)};b(yt,Rt=>{e(z),e(d),n(()=>!e(z)[e(d).id])&&Rt(_t)})}s(ye);var dt=a(ye,2);{var Jt=Rt=>{var Ft=wi(),qt=l(Ft),sa=l(qt);Ce(sa);var oa=a(sa),ua=a(oa);{var Yt=jt=>{var ct=_i(),wt=l(ct);s(ct),C(St=>$(wt,`(Spell Save DC: ${St??""})`),[()=>(W(is),t(),n(()=>is(t(),t().abilities)))]),o(jt,ct)};b(ua,jt=>{t(),n(()=>t().class)&&jt(Yt)})}var Et=a(ua,2);{var Kt=jt=>{var ct=yi();o(jt,ct)},ea=jt=>{var ct=gt(),wt=Se(ct);{var St=Pt=>{var Ct=xi();o(Pt,Ct)};b(wt,Pt=>{e(d),W(e(bt)),n(()=>e(d).targetSucceededSave&&e(bt).noDamageOnSave)&&Pt(St)},!0)}o(jt,ct)};b(Et,jt=>{e(d),W(e(bt)),n(()=>e(d).targetSucceededSave&&e(bt).halfDamageOnSave)?jt(Kt):jt(ea,!1)})}s(qt),s(Ft),C(jt=>$(oa,` Target succeeded on ${jt??""} save `),[()=>(W(e(bt)),n(()=>e(bt).ability.charAt(0).toUpperCase()+e(bt).ability.slice(1)))]),ka(sa,()=>e(d).targetSucceededSave,jt=>(e(d).targetSucceededSave=jt,Ut(()=>(e(_),t(),v())))),o(Rt,Ft)};b(dt,Rt=>{e(bt)&&Rt(Jt)})}var ra=a(dt,2);{var ta=Rt=>{var Ft=Si(),qt=l(Ft),sa=l(qt);Ce(sa);var oa=a(sa,2);{var ua=Et=>{const Kt=$t(()=>(e(d),W(e(oe)),n(()=>q(e(d),e(oe)))));var ea=$i(),jt=l(ea);s(ea),C(()=>$(jt,`(${W(e(ht)),n(()=>e(ht).alternateDamage)??""}, total: ${e(Kt)??""})`)),o(Et,ea)},Yt=Et=>{var Kt=ki(),ea=l(Kt);s(Kt),C(()=>$(ea,`(${W(e(ht)),n(()=>e(ht).baseDamage)??""})`)),o(Et,Kt)};b(oa,Et=>{e(d),n(()=>e(d).targetIsDamaged)?Et(ua):Et(Yt,!1)})}s(qt),s(Ft),ka(sa,()=>e(d).targetIsDamaged,Et=>(e(d).targetIsDamaged=Et,Ut(()=>(e(_),t(),v())))),o(Rt,Ft)};b(ra,Rt=>{e(ht)&&Rt(ta)})}var Zt=a(ra,2);{var aa=Rt=>{const Ft=$t(()=>(W(e(oe)),n(()=>Ae(e(oe)))));var qt=gt(),sa=Se(qt);{var oa=Yt=>{var Et=Ai(),Kt=Se(Et),ea=l(Kt),jt=a(ea,2);C(()=>{e(d),Ut(()=>{e(Ft)})}),kt(jt,5,()=>e(Ft),Lt,(Ct,Vt)=>{var zt=Ci(),ca=l(zt);s(zt);var fa={};C(()=>{$(ca,`Level ${e(Vt)??""}`),fa!==(fa=e(Vt))&&(zt.value=(zt.__value=e(Vt))??"")}),o(Ct,zt)}),s(jt);var ct=a(jt,2);{var wt=Ct=>{const Vt=$t(()=>(e(d),W(e(oe)),n(()=>q(e(d),e(oe)))));var zt=Di(),ca=l(zt);{var fa=va=>{var la=Tt("Healing");o(va,la)},Ht=va=>{var la=Tt("Damage");o(va,la)};b(ca,va=>{W(e(oe)),n(()=>H(e(oe)))?va(fa):va(Ht,!1)})}var Wt=a(ca);s(zt),C(()=>$(Wt,` ${e(Vt)??""}`)),o(Ct,zt)};b(ct,Ct=>{e(d),W(e(oe)),n(()=>e(d).castAtLevel&&e(d).castAtLevel>e(oe).level)&&Ct(wt)})}s(Kt);var St=a(Kt,2);{var Pt=Ct=>{var Vt=ji(),zt=l(Vt),ca=l(zt);Ce(ca);var fa=a(ca,2);{var Ht=Wt=>{const va=$t(()=>(e(d),W(e(oe)),n(()=>q(e(d),e(oe)))));var la=Li(),xa=l(la);s(la),C(()=>$(xa,`(+1d8, total: ${e(va)??""})`)),o(Wt,la)};b(fa,Wt=>{e(d),n(()=>e(d).targetIsFiendOrUndead)&&Wt(Ht)})}s(zt),s(Vt),ka(ca,()=>e(d).targetIsFiendOrUndead,Wt=>(e(d).targetIsFiendOrUndead=Wt,Ut(()=>(e(_),t(),v())))),o(Ct,Vt)};b(St,Ct=>{W(e(oe)),n(()=>e(oe).description.includes("Fiend or an Undead"))&&Ct(Pt)})}C(()=>{tt(ea,"for",`castLevel-${e(d),n(()=>e(d).id)??""}`),tt(jt,"id",`castLevel-${e(d),n(()=>e(d).id)??""}`)}),Ta(jt,()=>e(d).castAtLevel,Ct=>(e(d).castAtLevel=Ct,Ut(()=>(e(_),t(),v())))),o(Yt,Et)},ua=Yt=>{var Et=Bi();o(Yt,Et)};b(sa,Yt=>{W(e(Ft)),n(()=>e(Ft).length>0)?Yt(oa):Yt(ua,!1)})}o(Rt,qt)};b(Zt,Rt=>{W(e(oe)),n(()=>e(oe).higherLevelSlot&&e(oe).level>0)&&Rt(aa)})}C(()=>{tt(Xe,"aria-label",(e(z),e(d),n(()=>e(z)[e(d).id]?"Expand":"Collapse"))),$(Bt,(e(z),e(d),n(()=>e(z)[e(d).id]?"‚ñº":"‚ñ≤")))}),D("click",st,()=>I(e(d).id)),D("keydown",st,Rt=>Rt.key==="Enter"&&I(e(d).id)),o(A,ft)},Ie=A=>{var bt=Ti();o(A,bt)};b(Ge,A=>{e(oe)?A(ae):A(Ie,!1)})}o(rt,B)};b(nt,rt=>{e(P),n(()=>e(P).length===0)?rt(Ye):rt(at,!1)})}o(O,le)};b(J,O=>{e(d),n(()=>e(d).spellRef)&&O(se)})}var ge=a(J,2);{var Re=O=>{var le=gt(),nt=Se(le);{var Ye=at=>{var rt=Mi(),oe=l(rt),B=a(oe,2);wa(B),s(rt),C(()=>{tt(oe,"for",`attack-notes-${e(d),n(()=>e(d).id)??""}`),tt(B,"id",`attack-notes-${e(d),n(()=>e(d).id)??""}`)}),Ne(B,()=>e(d).notes,Ge=>(e(d).notes=Ge,Ut(()=>(e(_),t(),v())))),o(at,rt)};b(nt,at=>{e(d),n(()=>e(d).notes&&e(d).notes.trim()!=="")&&at(Ye)})}o(O,le)};b(ge,O=>{e(d),n(()=>!e(d).spellRef)&&O(Re)})}var Qe=a(ge,2),qe=l(Qe);{var ut=O=>{const le=$t(()=>(e(d),n(()=>K(e(d).spellRef))));var nt=gt(),Ye=Se(nt);{var at=rt=>{var oe=gt(),B=Se(oe);{var Ge=Ie=>{var A=Fi();D("click",A,()=>Me(e(d))),o(Ie,A)},ae=Ie=>{var A=gt(),bt=Se(A);{var ht=ye=>{var st=gt(),Xe=Se(st);{var Bt=_t=>{var dt=Pi(),Jt=l(dt),ra=l(Jt),ta=l(ra);Ce(ta),ta.value=ta.__value="self",Qt(),s(ra);var Zt=a(ra,2),aa=l(Zt);Ce(aa),aa.value=aa.__value="other",Qt(),s(Zt),s(Jt);var Rt=a(Jt,2),Ft=l(Rt);s(Rt),s(dt),C(()=>{tt(ta,"name",`target-${e(d),n(()=>e(d).id)??""}`),tt(aa,"name",`target-${e(d),n(()=>e(d).id)??""}`),$(Ft,`Cast ${W(e(le)),n(()=>e(le).name)??""}`)}),gs(F,[me],ta,()=>e(G)[e(d).id],qt=>ma(G,e(G)[e(d).id]=qt)),gs(F,[me],aa,()=>e(G)[e(d).id],qt=>ma(G,e(G)[e(d).id]=qt)),D("click",Rt,()=>ne(e(d),e(G)[e(d).id])),o(_t,dt)},yt=_t=>{var dt=Ii();D("click",dt,()=>ne(e(d),"self")),o(_t,dt)};b(Xe,_t=>{W(e(le)),n(()=>Te(e(le).name))?_t(Bt):_t(yt,!1)})}o(ye,st)},ft=ye=>{var st=gt(),Xe=Se(st);{var Bt=_t=>{var dt=Ei(),Jt=l(dt);{var ra=Zt=>{var aa=Tt("Roll Healing");o(Zt,aa)},ta=Zt=>{var aa=Tt("Roll Damage");o(Zt,aa)};b(Jt,Zt=>{W(e(le)),n(()=>H(e(le)))?Zt(ra):Zt(ta,!1)})}s(dt),C(Zt=>At(dt,1,`btn ${Zt??""}`),[()=>(W(e(le)),n(()=>H(e(le))?"btn-success":"btn-secondary"))]),D("click",dt,()=>T(e(d))),o(_t,dt)},yt=_t=>{var dt=Hi();D("click",dt,()=>ne(e(d),"self")),o(_t,dt)};b(Xe,_t=>{e(d),n(()=>e(d).damage&&e(d).damage.trim()!=="")?_t(Bt):_t(yt,!1)})}o(ye,st)};b(bt,ye=>{W(ws),W(e(le)),n(()=>ws(e(le)))?ye(ht):ye(ft,!1)},!0)}o(Ie,A)};b(B,Ie=>{W(Za),W(e(le)),n(()=>Za(e(le)))?Ie(Ge):Ie(ae,!1)})}o(rt,oe)};b(Ye,rt=>{e(le)&&rt(at)})}o(O,nt)},We=O=>{var le=gt(),nt=Se(le);{var Ye=at=>{var rt=Ni(),oe=Se(rt),B=a(oe,2);{var Ge=ae=>{var Ie=Ui();D("click",Ie,()=>T(e(d))),o(ae,Ie)};b(B,ae=>{e(d),n(()=>e(d).damage&&e(d).damage.trim()!=="")&&ae(Ge)})}D("click",oe,()=>Me(e(d))),o(at,rt)};b(nt,at=>{e(d),n(()=>!e(d).spellRef)&&at(Ye)},!0)}o(O,le)};b(qe,O=>{e(d),e(w),n(()=>e(d).spellRef&&e(w))?O(ut):O(We,!1)})}s(Qe),s($e),C(()=>{tt(S,"for",`attack-type-${e(d),n(()=>e(d).id)??""}`),tt(U,"id",`attack-type-${e(d),n(()=>e(d).id)??""}`)}),Ne(U,()=>e(d).damageType,O=>(e(d).damageType=O,Ut(()=>(e(_),t(),v())))),o(Fe,$e)});var fe=a(Z,2);{var je=Fe=>{var d=Gi();o(Fe,d)},Q=Fe=>{var d=gt(),me=Se(d);{var $e=ee=>{var ke=qi();o(ee,ke)};b(me,ee=>{e(_),n(()=>e(_).length===0)&&ee($e)},!0)}o(Fe,d)};b(fe,Fe=>{t(),n(()=>t().attacks.length===0)?Fe(je):Fe(Q,!1)})}s(E);var we=a(E,2);{var V=Fe=>{var d=Ji(),me=a(l(d),4);kt(me,5,()=>e(h),Lt,($e,ee)=>{var ke=Vi(),_e=l(ke),De=l(_e),re=l(De,!0);s(De);var Ee=a(De,2),be=l(Ee);s(Ee),s(_e);var Ue=a(_e,2),ze=l(Ue,!0);s(Ue);var et=a(Ue,2),it=l(et);{var ve=ge=>{var Re=zi(),Qe=l(Re),qe=a(Qe);{var ut=We=>{var O=Tt();C(()=>$(O,`per ${e(ee),n(()=>e(ee).restType)??""} rest`)),o(We,O)};b(qe,We=>{e(ee),n(()=>e(ee).restType)&&We(ut)})}s(Re),C(()=>$(Qe,`${e(ee),n(()=>e(ee).currentUses??e(ee).usesPerRest)??""}/${e(ee),n(()=>e(ee).usesPerRest)??""} uses `)),o(ge,Re)};b(it,ge=>{e(ee),n(()=>e(ee).usesPerRest)&&ge(ve)})}var S=a(it,2);{var U=ge=>{var Re=Wi();o(ge,Re)};b(S,ge=>{e(ee),n(()=>e(ee).requiresReaction)&&ge(U)})}var J=a(S,2);{var se=ge=>{var Re=Ki();C(()=>Re.disabled=(e(ee),n(()=>e(ee).currentUses===void 0||e(ee).currentUses===0))),D("click",Re,()=>ie(e(ee).conditionName,e(ee).name)),o(ge,Re)};b(J,ge=>{p(),e(ee),n(()=>!p()&&e(ee).usesPerRest)&&ge(se)})}s(et),s(ke),C(()=>{$(re,(e(ee),n(()=>e(ee).name))),$(be,`(${e(ee),n(()=>e(ee).conditionName)??""})`),$(ze,(e(ee),n(()=>e(ee).description)))}),o($e,ke)}),s(me),s(d),o(Fe,d)};b(we,Fe=>{e(h),n(()=>e(h).length>0)&&Fe(V)})}var j=a(we,2),he=a(l(j),4),Ve=a(he,2);{var Oe=Fe=>{var d=Xi();kt(d,5,()=>(t(),n(()=>t().activeStates)),Lt,(me,$e,ee)=>{var ke=Qi(),_e=l(ke),De=l(_e);Ce(De);var re=a(De,2);{var Ee=We=>{var O=Yi();D("click",O,()=>pe(ee)),o(We,O)};b(re,We=>{p()&&We(Ee)})}s(_e);var be=a(_e,2),Ue=l(be),ze=l(Ue);tt(ze,"for",`state-attack-bonus-${ee}`);var et=a(ze,2);Ce(et),tt(et,"id",`state-attack-bonus-${ee}`),s(Ue);var it=a(Ue,2),ve=l(it);tt(ve,"for",`state-damage-bonus-${ee}`);var S=a(ve,2);Ce(S),tt(S,"id",`state-damage-bonus-${ee}`),s(it);var U=a(it,2),J=l(U);tt(J,"for",`state-target-${ee}`);var se=a(J,2);C(()=>{e($e),Ut(()=>{})}),tt(se,"id",`state-target-${ee}`);var ge=l(se);ge.value=ge.__value="self";var Re=a(ge);Re.value=Re.__value="other",s(se),s(U),s(be);var Qe=a(be,2),qe=l(Qe);tt(qe,"for",`state-desc-${ee}`);var ut=a(qe,2);Ce(ut),tt(ut,"id",`state-desc-${ee}`),s(Qe),s(ke),Ne(De,()=>e($e).name,We=>(e($e).name=We,Ut(()=>t()),La(m,"$character"))),Ne(et,()=>e($e).attackBonus,We=>(e($e).attackBonus=We,Ut(()=>t()),La(m,"$character"))),Ne(S,()=>e($e).damageBonus,We=>(e($e).damageBonus=We,Ut(()=>t()),La(m,"$character"))),Ta(se,()=>e($e).target,We=>(e($e).target=We,Ut(()=>t()),La(m,"$character"))),Ne(ut,()=>e($e).description,We=>(e($e).description=We,Ut(()=>t()),La(m,"$character"))),o(me,ke)}),s(d),o(Fe,d)},lt=Fe=>{var d=Zi();o(Fe,d)};b(Ve,Fe=>{t(),n(()=>t().activeStates&&t().activeStates.length>0)?Fe(Oe):Fe(lt,!1)})}s(j),D("click",he,Le),o(y,N)};b(vt,y=>{u(),n(()=>!u().attacks)&&y(Ke)})}s(He);var xt=a(He,2);si(xt,{get show(){return e(R)},get attacks(){return t(),n(()=>t().attacks)},onSave:xe,onCancel:ue}),C(()=>ot=At(He,1,"attacks svelte-14o91c5",null,ot,{hidden:!e(Y)})),o(i,Be),Gt(),L()}var sn=f('<span class="slot-checkbox-x svelte-serp1j">&#8212;</span>'),ln=f('<label><input type="checkbox" class="slot-checkbox-input svelte-serp1j"/> <span><!></span></label>');function $s(i,c){Ot(c,!1);const t=()=>pt(ha,"$isEditMode",v),[v,u]=na();let p=Dt(c,"checked",8,!1),m=Dt(c,"disabled",8,!1),L=Dt(c,"className",8,""),h=Dt(c,"index",8,void 0),_=Dt(c,"ariaLabel",8,void 0);const Y=_a();function F(I){Y("change",{checked:I.currentTarget.checked,index:h()})}Nt();var ie=ln(),te=l(ie);Ce(te);var z=a(te,2),G=l(z);{var R=I=>{var H=sn();o(I,H)};b(G,I=>{p()&&I(R)})}s(z),s(ie),C(()=>{At(ie,1,"slot-checkbox-label "+L()+(t()?"":" not-editable"),"svelte-serp1j"),As(te,p()),te.disabled=m()||!t(),tt(te,"aria-label",_()),tt(te,"tabindex",t()?0:-1),At(z,1,`slot-checkbox-custom ${p()?"used":""} ${t()?"":"readonly"}`,"svelte-serp1j")}),D("change",te,F),o(i,ie),Gt(),u()}function nn(i,c){Ot(c,!1);const t=()=>pt(de,"$character",v),[v,u]=na();let p=k(),m=k();Ze(()=>(t(),e(p),e(m),us),()=>{t().race&&t().level&&(t().race!==e(p)||t().level!==e(m))&&(ll(),us(),r(p,t().race),r(m,t().level))}),da(),Nt(),Gt(),u()}var rn=f('<p class="no-features svelte-1kpvv0n">Select a class to see available features</p>'),on=f('<p class="no-features svelte-1kpvv0n">No class features available at this level</p>'),cn=f('<div class="spell-slots svelte-1kpvv0n"><label class="svelte-1kpvv0n"> </label> <div class="slots-tracker svelte-1kpvv0n"></div></div>'),vn=f('<div class="all-spell-slots"></div>'),dn=f('<div class="feature-box spellcasting svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"> </h3> <div class="spell-stats svelte-1kpvv0n"><div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Spell Save DC</label> <div class="spell-value svelte-1kpvv0n"> </div></div> <div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <div class="spell-value svelte-1kpvv0n"> </div></div></div> <!> <div class="prepared-spells svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <textarea placeholder="List your prepared spells..." class="svelte-1kpvv0n"></textarea></div></div>'),un=f('<p class="unlimited svelte-1kpvv0n">Unlimited Uses</p>'),fn=f('<div class="slots-tracker svelte-1kpvv0n"></div> <div class="uses-actions-row"><button class="btn btn-primary use-enabled"> </button></div> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div>',1),pn=f('<div class="uses-tracker svelte-1kpvv0n"><!></div>'),mn=f('<div class="pool-tracker svelte-1kpvv0n"><input type="number" min="0" class="pool-input svelte-1kpvv0n"/> <span> </span> <button class="btn-small svelte-1kpvv0n"> </button></div>'),gn=f('<p class="no-uses svelte-1kpvv0n">No Channel Divinity uses remaining</p>'),bn=f('<div class="channel-divinity-option svelte-1kpvv0n"><button class="btn btn-primary use-enabled svelte-1kpvv0n">Use Channel Divinity</button> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div> <!></div>'),hn=f('<div class="feature-box svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"><!> </h3> <p class="feature-description svelte-1kpvv0n"> </p> <!></div>'),_n=f('<div class="features-grid svelte-1kpvv0n"><!> <!></div>'),yn=f("<!> <!>",1),xn=f("<section><!> <!></section>");function wn(i,c){Ot(c,!1);const t=()=>pt(de,"$character",m),v=()=>pt(qa,"$abilityModifiers",m),u=()=>pt(ga,"$searchFilter",m),p=()=>pt(Xt,"$collapsedStates",m),[m,L]=na(),h=k(),_=k(),Y=k(),F=k(),ie=k(),te=k(),z=k();let G=k(0),R=k(0);function I(g,M){de.update(q=>(q.classFeatures.features[g]=M,q))}function H(){de.update(g=>(g.classFeatures.spellSlotsByLevel||(g.classFeatures.spellSlotsByLevel={}),e(F).forEach(({level:M,slots:q})=>{g.classFeatures.spellSlotsByLevel[M]||(g.classFeatures.spellSlotsByLevel[M]=Array(q).fill(!1))}),g))}function Te(g){if(typeof g.maxUses=="function"){if((g.name==="Divine Sense"||g.name==="War Priest")&&e(h)?.spellcastingAbility){const M=v()[e(h).spellcastingAbility];return g.maxUses(t().level,M)}return g.maxUses(t().level)}return g.maxUses||0}function Je(g,M){de.update(q=>((!q.classFeatures.features[g]||!Array.isArray(q.classFeatures.features[g])||q.classFeatures.features[g].length!==M)&&(q.classFeatures.features[g]=Array(M).fill(!1)),q))}Es(()=>{e(te)&&t()&&t().classFeatures&&t().classFeatures.features&&e(te).forEach(g=>{if(g.type==="uses"){const M=g.name.replace(/\s+/g,""),q=Te(g),Ae=t().classFeatures.features[M];(!Array.isArray(Ae)||Ae.length!==q)&&Je(M,q)}})});function X(g){return typeof g.maxPool=="function"?g.maxPool(t().level):g.maxPool||0}function Pe(g){return typeof g.description=="function"?g.description(t().level):g.description}function ue(){const g="ChannelDivinity";de.update(M=>{const q=M.classFeatures.features[g];return typeof q=="number"&&q>0&&(M.classFeatures.features[g]=q-1),M})}function xe(){Xt.update(g=>({...g,classFeatures:!g.classFeatures}))}Ze(()=>(t(),ia),()=>{r(h,t().class?ia(t().class):null)}),Ze(()=>(t(),Ca),()=>{r(_,t().class?Ca(t().class,t().level,t().subclass):[])}),Ze(()=>(t(),_s),()=>{r(Y,t().class?_s(t().class,t().level):0)}),Ze(()=>(e(h),t()),()=>{r(F,(()=>{if(!e(h)?.spellcaster)return[];const g=t().level,M=[];return g>=1&&M.push({level:1,slots:Math.min(4,2+Math.floor(g/3))}),g>=3&&M.push({level:2,slots:Math.min(3,2+Math.floor((g-3)/4))}),g>=5&&M.push({level:3,slots:Math.min(3,2+Math.floor((g-5)/5))}),g>=7&&M.push({level:4,slots:Math.min(3,1+Math.floor((g-7)/6))}),g>=9&&M.push({level:5,slots:Math.min(2,1+Math.floor((g-9)/8))}),g>=11&&M.push({level:6,slots:1}),g>=13&&M.push({level:7,slots:1}),g>=15&&M.push({level:8,slots:1}),g>=17&&M.push({level:9,slots:1}),M})())}),Ze(()=>(e(h),v(),t(),ys),()=>{if(e(h)?.spellcaster&&e(h).spellcastingAbility){const g=v()[e(h).spellcastingAbility];r(G,_l(t().class,g,t().proficiencyBonus)||0),r(R,ys(t().class,t().level,g))}}),Ze(()=>(t(),e(h),e(F)),()=>{t().class&&e(h)?.spellcaster&&e(F).length>0&&H()}),Ze(()=>t(),()=>{r(ie,(()=>{const M=t().classFeatures.features["ChannelDivinity"];return typeof M=="number"?M:0})())}),Ze(()=>(e(_),u()),()=>{r(te,e(_).filter(g=>{if(!u())return!0;const M=u().toLowerCase();return g.name.toLowerCase().includes(M)||Pe(g).toLowerCase().includes(M)}))}),Ze(()=>(u(),t(),e(te)),()=>{r(z,!u()||t().class||"class features".includes(u().toLowerCase())||"spellcasting".includes(u().toLowerCase())||e(te).length>0)}),da(),Nt();var Me=xn();let T;var P=l(Me);{let g=$t(()=>(p(),n(()=>p().classFeatures?"Expand":"Collapse")));ya(P,{title:"Class Features",get collapsed(){return p(),n(()=>p().classFeatures)},get ariaLabel(){return e(g)},onToggle:xe})}var w=a(P,2);{var K=g=>{var M=yn(),q=Se(M);nn(q,{});var Ae=a(q,2);{var Le=ne=>{var Be=rn();o(ne,Be)},pe=ne=>{var Be=gt(),He=Se(Be);{var ot=vt=>{var Ke=on();o(vt,Ke)},mt=vt=>{var Ke=_n(),xt=l(Ke);{var y=ce=>{var x=dn(),E=l(x),Z=l(E);s(E);var fe=a(E,2),je=l(fe),Q=a(l(je),2),we=l(Q,!0);s(Q),s(je);var V=a(je,2),j=a(l(V),2),he=l(j,!0);s(j),s(V),s(fe);var Ve=a(fe,2);{var Oe=d=>{var me=vn();kt(me,5,()=>e(F),Lt,($e,ee)=>{let ke=()=>e(ee).level,_e=()=>e(ee).slots;const De=$t(()=>(t(),ke(),_e(),n(()=>t().classFeatures.spellSlotsByLevel?.[ke()]||Array(_e()).fill(!1))));var re=cn(),Ee=l(re),be=l(Ee);s(Ee);var Ue=a(Ee,2);kt(Ue,5,()=>e(De),Lt,(ze,et,it)=>{{let ve=$t(()=>(W(e(De)),n(()=>e(De)[it]||!1)));$s(ze,{get checked(){return e(ve)},$$events:{change:S=>{de.update(U=>(U.classFeatures.spellSlotsByLevel||(U.classFeatures.spellSlotsByLevel={}),U.classFeatures.spellSlotsByLevel[ke()]||(U.classFeatures.spellSlotsByLevel[ke()]=Array(_e()).fill(!1)),U.classFeatures.spellSlotsByLevel[ke()][it]=S.detail.checked,U))}}})}}),s(Ue),s(re),C(()=>$(be,`${ke()===1?"1st":ke()===2?"2nd":ke()===3?"3rd":`${ke()}th`} Level Spell Slots`)),o($e,re)}),s(me),o(d,me)};b(Ve,d=>{e(F),n(()=>e(F).length>0)&&d(Oe)})}var lt=a(Ve,2),Fe=a(l(lt),2);wa(Fe),s(lt),s(x),C(d=>{$(Z,`Spellcasting (${d??""})`),$(we,e(G)),$(he,e(R))},[()=>(e(h),n(()=>e(h).spellcastingAbility?.toUpperCase()))]),Ne(Fe,()=>t().classFeatures.preparedSpells,d=>It(de,n(t).classFeatures.preparedSpells=d,n(t))),o(ce,x)};b(xt,ce=>{e(h),n(()=>e(h)?.spellcaster)&&ce(y)})}var N=a(xt,2);kt(N,1,()=>e(te),Lt,(ce,x)=>{const E=$t(()=>(e(x),n(()=>e(x).name.replace(/\s+/g,"")))),Z=$t(()=>(t(),W(e(E)),n(()=>t().classFeatures.features[e(E)]))),fe=$t(()=>typeof e(Z)=="number");var je=hn(),Q=l(je),we=l(Q);{var V=d=>{var me=Tt("Channel Divinity:");o(d,me)};b(we,d=>{e(x),n(()=>e(x).type==="channelDivinity")&&d(V)})}var j=a(we);s(Q);var he=a(Q,2),Ve=l(he,!0);s(he);var Oe=a(he,2);{var lt=d=>{const me=$t(()=>(e(x),n(()=>Te(e(x))))),$e=$t(()=>(W(e(Z)),W(e(me)),n(()=>Array.isArray(e(Z))?e(Z):Array(e(me)).fill(!1))));var ee=pn(),ke=l(ee);{var _e=re=>{var Ee=un();o(re,Ee)},De=re=>{var Ee=fn(),be=Se(Ee);kt(be,5,()=>e($e),Lt,(U,J,se)=>{$s(U,{get checked(){return e(J)},index:se,$$events:{change:ge=>{de.update(Re=>(Re.classFeatures.features[e(E)]||(Re.classFeatures.features[e(E)]=Array(e(me)).fill(!1)),Re.classFeatures.features[e(E)][se]=ge.detail.checked,Re))}}})}),s(be);var Ue=a(be,2),ze=l(Ue),et=l(ze);s(ze),s(Ue);var it=a(Ue,2),ve=l(it),S=l(ve);s(ve),s(it),C(U=>{ze.disabled=U,$(et,`Use ${e(x),n(()=>e(x).name)??""}`),$(S,`Resets on ${e(x),n(()=>e(x).resetOn==="short"?"Short Rest":"Long Rest")??""}`)},[()=>(W(e($e)),n(()=>e($e).filter(U=>!U).length<=0))]),D("click",ze,()=>{de.update(U=>{U.classFeatures.features[e(E)]||(U.classFeatures.features[e(E)]=Array(e(me)).fill(!1));const J=U.classFeatures.features[e(E)],se=J.findIndex(ge=>!ge);return se!==-1&&(J[se]=!0),U})}),o(re,Ee)};b(ke,re=>{e(me)===1/0?re(_e):re(De,!1)})}s(ee),o(d,ee)},Fe=d=>{var me=gt(),$e=Se(me);{var ee=_e=>{const De=$t(()=>(e(x),n(()=>X(e(x)))));var re=mn(),Ee=l(re);Ce(Ee);var be=a(Ee,2),Ue=l(be);s(be);var ze=a(be,2),et=l(ze,!0);s(ze),s(re),C(()=>{Ba(Ee,e(fe)&&e(Z)!==void 0?e(Z):e(De)),tt(Ee,"max",e(De)),$(Ue,`/ ${e(De)??""}`),$(et,(e(x),n(()=>e(x).resetOn==="short"?"Short Rest":"Long Rest")))}),D("input",Ee,it=>{de.update(ve=>(ve.classFeatures.features[e(E)]=parseInt(it.currentTarget.value)||0,ve))}),D("click",ze,()=>I(e(E),e(De))),o(_e,re)},ke=_e=>{var De=gt(),re=Se(De);{var Ee=be=>{var Ue=bn(),ze=l(Ue),et=a(ze,2),it=l(et),ve=l(it);s(it),s(et);var S=a(et,2);{var U=J=>{var se=gn();o(J,se)};b(S,J=>{e(ie)<=0&&J(U)})}s(Ue),C(()=>{ze.disabled=e(ie)<=0,$(ve,`Resets on ${e(x),n(()=>e(x).resetOn==="short"?"Short Rest":"Long Rest")??""}`)}),D("click",ze,ue),o(be,Ue)};b(re,be=>{e(x),n(()=>e(x).type==="channelDivinity")&&be(Ee)},!0)}o(_e,De)};b($e,_e=>{e(x),n(()=>e(x).type==="pool")?_e(ee):_e(ke,!1)},!0)}o(d,me)};b(Oe,d=>{e(x),n(()=>e(x).type==="uses")?d(lt):d(Fe,!1)})}s(je),C(d=>{$(j,` ${e(x),n(()=>e(x).name)??""}`),$(Ve,d)},[()=>(e(x),n(()=>Pe(e(x))))]),o(ce,je)}),s(Ke),o(vt,Ke)};b(He,vt=>{e(_),n(()=>e(_).length===0)?vt(ot):vt(mt,!1)},!0)}o(ne,Be)};b(Ae,ne=>{t(),n(()=>!t().class)?ne(Le):ne(pe,!1)})}o(g,M)};b(w,g=>{p(),n(()=>!p().classFeatures)&&g(K)})}s(Me),C(()=>T=At(Me,1,"class-features svelte-1kpvv0n",null,T,{hidden:!e(z)})),o(i,Me),Gt(),L()}var $n=f('<textarea placeholder="Enter features, traits, and special abilities..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Equipment</h3> <textarea placeholder="List your equipment and inventory..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Notes</h3> <textarea placeholder="Additional notes..." class="svelte-wttn0l"></textarea>',1),kn=f("<section><!> <!></section>");function Sn(i,c){Ot(c,!1);const t=()=>pt(ga,"$searchFilter",p),v=()=>pt(de,"$character",p),u=()=>pt(Xt,"$collapsedStates",p),[p,m]=na(),L=k();function h(){Xt.update(z=>({...z,notes:!z.notes}))}Ze(()=>(t(),v()),()=>{r(L,!t()||"features".includes(t().toLowerCase())||"traits".includes(t().toLowerCase())||"equipment".includes(t().toLowerCase())||"notes".includes(t().toLowerCase())||v().features.toLowerCase().includes(t().toLowerCase())||v().equipment.toLowerCase().includes(t().toLowerCase())||v().notes.toLowerCase().includes(t().toLowerCase()))}),da(),Nt();var _=kn();let Y;var F=l(_);{let z=$t(()=>(u(),n(()=>u().notes?"Expand":"Collapse")));ya(F,{title:"Features & Traits",get collapsed(){return u(),n(()=>u().notes)},get ariaLabel(){return e(z)},onToggle:h})}var ie=a(F,2);{var te=z=>{var G=$n(),R=Se(G);wa(R);var I=a(R,4);wa(I);var H=a(I,4);wa(H),Ne(R,()=>v().features,Te=>It(de,n(v).features=Te,n(v))),Ne(I,()=>v().equipment,Te=>It(de,n(v).equipment=Te,n(v))),Ne(H,()=>v().notes,Te=>It(de,n(v).notes=Te,n(v))),o(z,G)};b(ie,z=>{u(),n(()=>!u().notes)&&z(te)})}s(_),C(()=>Y=At(_,1,"notes svelte-wttn0l",null,Y,{hidden:!e(L)})),o(i,_),Gt(),m()}var Cn=f(" <!> <!> <!> <!> <!>",1),Dn=f('<div class="color-picker-section svelte-1r90jgp"><h3 class="svelte-1r90jgp">Dice Colors</h3> <div class="color-inputs svelte-1r90jgp"><div class="color-input-group svelte-1r90jgp"><label for="dice-color" class="svelte-1r90jgp">Dice Color</label> <input type="color" id="dice-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="label-color" class="svelte-1r90jgp">Label Color</label> <input type="color" id="label-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="desk-color" class="svelte-1r90jgp">Background Color</label> <input type="color" id="desk-color" class="svelte-1r90jgp"/></div></div></div>'),Ln=f('<div class="loading svelte-1r90jgp"><p class="svelte-1r90jgp">Loading 3D dice...</p></div>'),jn=f('<div class="custom-dice-selector svelte-1r90jgp"><h3 class="svelte-1r90jgp">Choose Dice to Roll</h3> <div class="dice-inputs svelte-1r90jgp"><div class="dice-input-group svelte-1r90jgp"><label for="d4" class="svelte-1r90jgp">d4</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d4" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d6" class="svelte-1r90jgp">d6</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d6" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d8" class="svelte-1r90jgp">d8</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d8" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d10" class="svelte-1r90jgp">d10</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d10" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d12" class="svelte-1r90jgp">d12</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d12" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d20" class="svelte-1r90jgp">d20</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d20" min="0" max="10"/></div></div> <div class="dice-controls svelte-1r90jgp"><button class="btn btn-primary use-enabled svelte-1r90jgp"> </button> <button class="btn btn-secondary use-enabled svelte-1r90jgp">Reset</button></div></div>'),An=f('<h3 class="svelte-1r90jgp"> </h3>'),Bn=f('<h3 class="svelte-1r90jgp"> </h3>'),Rn=f('<h3 class="svelte-1r90jgp"> </h3>'),Tn=f('<h3 class="svelte-1r90jgp"> </h3>'),Mn=f('<span class="crit-badge svelte-1r90jgp">CRITICAL HIT!</span>'),Fn=f('<span class="crit-badge crit-fail svelte-1r90jgp">CRITICAL MISS!</span>'),Pn=f('<div class="bonus-item svelte-1r90jgp"><span class="bonus-value svelte-1r90jgp"> </span> <span class="bonus-source svelte-1r90jgp"> </span></div>'),In=f('<div class="bonus-breakdown svelte-1r90jgp"></div>'),En=f('<p class="modifier-text svelte-1r90jgp"> </p>'),Hn=f('<div class="svelte-1r90jgp"><em class="svelte-1r90jgp">No damage is dealt on a critical miss.</em></div>'),Un=f('<button class="btn btn-follow-up svelte-1r90jgp"> </button>'),Nn=f('<button class="btn btn-guided-strike svelte-1r90jgp">‚ö° Use Guided Strike (+10)</button>'),On=f('<div class="follow-up-actions svelte-1r90jgp"><!> <!></div>'),Gn=f('<div class="result-header svelte-1r90jgp"><!> <!> <!></div> <div class="result-total svelte-1r90jgp"> </div> <div class="result-details svelte-1r90jgp"><!></div> <!> <!>',1),qn=f('<div role="button" tabindex="-1"><div class="modal-content svelte-1r90jgp" role="dialog" tabindex="0"><div class="modal-header svelte-1r90jgp"><h2 class="svelte-1r90jgp"><!></h2> <div class="header-buttons svelte-1r90jgp"><button class="color-btn svelte-1r90jgp" title="Customize dice colors">üé®</button> <button class="close-btn svelte-1r90jgp">√ó</button></div></div> <!> <!> <div class="dice-main-area svelte-1r90jgp"><div class="dice-container svelte-1r90jgp"></div> <!></div> <div><!></div></div></div>');function zn(i,c){Ot(c,!1);const t=()=>pt(de,"$character",v),[v,u]=na(),p=k(),m=k(),L=k(),h=_a();let _=Dt(c,"notation",12,""),Y=Dt(c,"visible",8,!1),F=Dt(c,"damageNotation",12,""),ie=Dt(c,"damageType",8,""),te=Dt(c,"attackName",12,""),z=Dt(c,"applyHalfDamage",8,!1),G=Dt(c,"bonusBreakdown",28,()=>[]),R=Dt(c,"rollType",12,"other"),I=null,H=k(void 0),Te=k(!1),Je=k(""),X=k(null);function Pe(){return e(X)?.resultTotal??null}function ue(S,U,J){const se=[];if(!S||!S.result)return se;const ge=U.match(/([+-]?\d*d\d+|[+-]?\d+)/g)||[];let Re=0;const Qe=new Set;for(const qe of ge){const ut=qe.trim();if(!ut)continue;const We=ut.match(/([+-]?)(\d*)d(\d+)/);if(We){const O=parseInt(We[2]||"1"),le=`${O}d${We[3]}`,nt=J.findIndex((rt,oe)=>!Qe.has(oe)&&typeof rt.value=="string"&&rt.value===le),Ye=[];for(let rt=0;rt<O&&Re<S.result.length;rt++)Ye.push(S.result[Re++]);const at=nt>=0?J[nt].source:"base die";nt>=0&&Qe.add(nt);for(const rt of Ye)se.push({display:`${rt}`,source:at})}}for(let qe=0;qe<J.length;qe++)if(!Qe.has(qe)&&typeof J[qe].value=="number"){const ut=J[qe].value;se.push({display:ut>=0?`+${ut}`:`${ut}`,source:J[qe].source})}return se}let xe=k(0),Me=k(0),T=k(0),P=k(0),w=k(0),K=k(0),g=k(0),M=k([]),q=k(!1),Ae=k(!1),Le=k(!1),pe=k("#051e0a"),ne=k("#ffffff"),Be=k("#3a2004"),He=k(!1);function ot(S){return S.length===9&&S.startsWith("#")?S.substring(0,7):S}function mt(S,U="ff"){return S.length===7&&S.startsWith("#")?S+U:S}function vt(){if(window.DICE&&e(H))try{I&&e(H)&&ma(H,e(H).innerHTML="");const S=e(H).clientWidth||500,U=e(H).clientHeight||300;I=new window.DICE.dice_box(e(H),{w:S,h:U}),r(Te,!0)}catch(S){console.error("Error initializing dice box:",S)}}$a(()=>{const S=se=>new Promise((ge,Re)=>{if(document.querySelector(`script[src="${se}"]`)){ge(null);return}const qe=document.createElement("script");qe.src=se,qe.onload=()=>{ge(null)},qe.onerror=()=>{console.error(`Failed to load: ${se}`),Re(new Error(`Failed to load ${se}`))},document.head.appendChild(qe)});setTimeout(()=>{S(`${ja}/libs/three.min.js`).then(()=>S(`${ja}/libs/cannon.min.js`)).then(()=>S(`${ja}/libs/teal.js`)).then(()=>S(`${ja}/dice.js`)).then(()=>{if(window.DICE){const se=window.DICE.getColors();r(pe,ot(se.dice_color)),r(ne,ot(se.label_color)),r(Be,ot(se.desk_color))}vt()}).catch(se=>{console.error("Failed to load dice libraries:",se)})},100);const U=()=>{e(Te)&&vt()},J=se=>{Y()&&se.key==="Escape"&&fe()};return window.addEventListener("resize",U),window.addEventListener("keydown",J),()=>{window.removeEventListener("resize",U),window.removeEventListener("keydown",J)}});function Ke(S,U="other"){if(!I||!e(Te))return;r(X,null),r(M,[]),r(q,!1),r(Ae,!1),U==="damage"&&G([]),R(U),r(Le,!1),I.diceToRoll=S;const J=ge=>null,se=ge=>{let Re=ge.resultTotal,Qe=ge.resultString;if(z()&&(Re=Math.floor(Re/2),Qe=Qe+" (halved)"),r(X,{...ge,resultTotal:Re,resultString:Qe}),console.log("Final roll result:",e(X)),console.log({type:U}),U==="attack"&&ge.result&&ge.result.length>0){const qe=ge.result[0];r(q,qe===20),r(Ae,qe===1)}if(r(M,[]),console.log("Setting up follow-up actions. Type:",U,"damageNotation:",F(),"isCriticalSuccess:",e(q),"isCriticalFail:",e(Ae)),U==="attack"&&F())if(e(q)){const qe=N(F());e(M).push({label:`Roll Critical Damage (${qe})`,notation:qe})}else e(Ae)||e(M).push({label:`Roll Damage (${F()})`,notation:F()})};I.start_throw(J,se)}function xt(){const S=[];e(xe)>0&&S.push(`${e(xe)}d4`),e(Me)>0&&S.push(`${e(Me)}d6`),e(T)>0&&S.push(`${e(T)}d8`),e(P)>0&&S.push(`${e(P)}d10`),e(w)>0&&S.push(`${e(w)}d12`),e(K)>0&&S.push(`${e(K)}d20`);let U=S.join("+")||"1d20";return e(g)!==0&&(U+=e(g)>=0?`+${e(g)}`:`${e(g)}`),U}function y(){const S=xt();Ke(S)}function N(S){return S.replace(/(\d+)d(\d+)/g,(U,J,se)=>`${parseInt(J)*2}d${se}`)}function ce(){r(xe,0),r(Me,0),r(T,0),r(P,0),r(w,0),r(K,0),r(g,0),r(X,null),r(M,[]),r(q,!1),r(Ae,!1),R("other"),r(Le,!1)}function x(){window.DICE&&(window.DICE.setColors({dice_color:mt(e(pe),"ff"),label_color:mt(e(ne),"ff"),desk_color:e(Be)}),I&&(I.updateDeskColor(e(Be)),I.updateDiceColors()))}function E(){r(He,!e(He))}function Z(){!e(X)||e(m)<=0||e(Le)||(r(X,{...e(X),resultTotal:e(X).resultTotal+10,resultString:e(X).resultString+" + 10 (Guided Strike)"}),de.update(S=>{const U="ChannelDivinity",J=S.classFeatures.features[U];return typeof J=="number"&&J>0&&(S.classFeatures.features[U]=J-1),S}),r(Le,!0))}function fe(){h("close"),_(""),F(""),te(""),r(Je,""),r(X,null),r(Le,!1),r(q,!1),r(Ae,!1),ce()}Ze(()=>(t(),Ca),()=>{r(p,t().class?Ca(t().class,t().level,t().subclass).some(U=>U.name==="Guided Strike"):!1)}),Ze(()=>t(),()=>{r(m,(()=>{const U=t().classFeatures.features["ChannelDivinity"];return typeof U=="number"?U:0})())}),Ze(()=>(e(xe),e(Me),e(T),e(P),e(w),e(K),e(g)),()=>{r(L,(()=>{const S=[];e(xe)>0&&S.push(`${e(xe)}d4`),e(Me)>0&&S.push(`${e(Me)}d6`),e(T)>0&&S.push(`${e(T)}d8`),e(P)>0&&S.push(`${e(P)}d10`),e(w)>0&&S.push(`${e(w)}d12`),e(K)>0&&S.push(`${e(K)}d20`);let U=S.join("+")||"1d20";return e(g)!==0&&(U+=e(g)>=0?`+${e(g)}`:`${e(g)}`),U})())}),Ze(()=>(W(_()),e(Te),W(Y()),e(Je),W(F()),W(te()),W(R())),()=>{_()&&e(Te)&&Y()&&_()!==e(Je)&&(r(Je,_()),r(X,null),r(M,[]),r(q,!1),r(Ae,!1),r(Le,!1),console.log("Auto-roll triggered. notation:",_(),"damageNotation:",F(),"attackName:",te(),"rollType:",R()),setTimeout(()=>Ke(_(),R()),200))}),da();var je={getLastRollTotal:Pe};Nt();var Q=qn();let we;var V=l(Q),j=l(V),he=l(j),Ve=l(he);{var Oe=S=>{var U=Cn(),J=Se(U),se=a(J);{var ge=Ye=>{var at=Tt("- Attack Roll");o(Ye,at)};b(se,Ye=>{R()==="attack"&&Ye(ge)})}var Re=a(se,2);{var Qe=Ye=>{var at=Tt("- Damage Roll");o(Ye,at)};b(Re,Ye=>{R()==="damage"&&Ye(Qe)})}var qe=a(Re,2);{var ut=Ye=>{var at=Tt("- Healing Roll");o(Ye,at)};b(qe,Ye=>{R()==="healing"&&Ye(ut)})}var We=a(qe,2);{var O=Ye=>{var at=Tt("- Ability Check");o(Ye,at)};b(We,Ye=>{R()==="check"&&Ye(O)})}var le=a(We,2);{var nt=Ye=>{var at=Tt("- Saving Throw");o(Ye,at)};b(le,Ye=>{R()==="save"&&Ye(nt)})}C(()=>$(J,`${te()??""} `)),o(S,U)},lt=S=>{var U=Tt("Dice Roller");o(S,U)};b(Ve,S=>{te()?S(Oe):S(lt,!1)})}s(he);var Fe=a(he,2),d=l(Fe),me=a(d,2);s(Fe),s(j);var $e=a(j,2);{var ee=S=>{var U=Dn(),J=a(l(U),2),se=l(J),ge=a(l(se),2);Ce(ge),s(se);var Re=a(se,2),Qe=a(l(Re),2);Ce(Qe),s(Re);var qe=a(Re,2),ut=a(l(qe),2);Ce(ut),s(qe),s(J),s(U),Ne(ge,()=>e(pe),We=>r(pe,We)),D("change",ge,x),Ne(Qe,()=>e(ne),We=>r(ne,We)),D("change",Qe,x),Ne(ut,()=>e(Be),We=>r(Be,We)),D("change",ut,x),o(S,U)};b($e,S=>{e(He)&&S(ee)})}var ke=a($e,2);{var _e=S=>{var U=Ln();o(S,U)};b(ke,S=>{e(Te)||S(_e)})}var De=a(ke,2),re=l(De);Ra(re,S=>r(H,S),()=>e(H));var Ee=a(re,2);{var be=S=>{var U=jn(),J=a(l(U),2),se=l(J),ge=a(l(se),2);Ce(ge),s(se);var Re=a(se,2),Qe=a(l(Re),2);Ce(Qe),s(Re);var qe=a(Re,2),ut=a(l(qe),2);Ce(ut),s(qe);var We=a(qe,2),O=a(l(We),2);Ce(O),s(We);var le=a(We,2),nt=a(l(le),2);Ce(nt),s(le);var Ye=a(le,2),at=a(l(Ye),2);Ce(at),s(Ye),s(J);var rt=a(J,2),oe=l(rt),B=l(oe);s(oe);var Ge=a(oe,2);s(rt),s(U),C(()=>{oe.disabled=!e(Te),$(B,`Roll ${e(L)??""}`)}),Ne(ge,()=>e(xe),ae=>r(xe,ae)),Ne(Qe,()=>e(Me),ae=>r(Me,ae)),Ne(ut,()=>e(T),ae=>r(T,ae)),Ne(O,()=>e(P),ae=>r(P,ae)),Ne(nt,()=>e(w),ae=>r(w,ae)),Ne(at,()=>e(K),ae=>r(K,ae)),D("click",oe,y),D("click",Ge,ce),o(S,U)};b(Ee,S=>{_()||S(be)})}s(De);var Ue=a(De,2);let ze;var et=l(Ue);{var it=S=>{var U=Gn(),J=Se(U),se=l(J);{var ge=ae=>{var Ie=An(),A=l(Ie,!0);s(Ie),C(()=>$(A,te()?`${te()} - Healing`:"Healing")),o(ae,Ie)},Re=ae=>{var Ie=gt(),A=Se(Ie);{var bt=ft=>{var ye=Bn(),st=l(ye,!0);s(ye),C(()=>$(st,te()?`${te()} - ${ie()} Damage`:`${ie()} Damage`)),o(ft,ye)},ht=ft=>{var ye=gt(),st=Se(ye);{var Xe=yt=>{var _t=Rn(),dt=l(_t,!0);s(_t),C(()=>$(dt,te()?`${te()} - Damage`:"Damage")),o(yt,_t)},Bt=yt=>{var _t=Tn(),dt=l(_t,!0);s(_t),C(()=>$(dt,te()?`${te()} - Result`:"Result")),o(yt,_t)};b(st,yt=>{R()==="damage"?yt(Xe):yt(Bt,!1)},!0)}o(ft,ye)};b(A,ft=>{R()==="damage"&&ie()?ft(bt):ft(ht,!1)},!0)}o(ae,Ie)};b(se,ae=>{R()==="damage"&&ie()==="Healing"?ae(ge):ae(Re,!1)})}var Qe=a(se,2);{var qe=ae=>{var Ie=Mn();o(ae,Ie)};b(Qe,ae=>{e(q)&&ae(qe)})}var ut=a(Qe,2);{var We=ae=>{var Ie=Fn();o(ae,Ie)};b(ut,ae=>{e(Ae)&&ae(We)})}s(J);var O=a(J,2),le=l(O,!0);s(O);var nt=a(O,2),Ye=l(nt);{var at=ae=>{var Ie=gt(),A=Se(Ie);{var bt=ft=>{var ye=In();kt(ye,5,()=>(e(X),W(_()),W(G()),n(()=>ue(e(X),_(),G()))),Lt,(st,Xe)=>{var Bt=Pn(),yt=l(Bt),_t=l(yt,!0);s(yt);var dt=a(yt,2),Jt=l(dt);s(dt),s(Bt),C(()=>{$(_t,(e(Xe),n(()=>e(Xe).display))),$(Jt,`(${e(Xe),n(()=>e(Xe).source)??""})`)}),o(st,Bt)}),s(ye),o(ft,ye)},ht=ft=>{var ye=gt(),st=Se(ye);{var Xe=Bt=>{var yt=En(),_t=l(yt);s(yt),C(()=>$(_t,`Modifier: ${e(X),n(()=>e(X).constant>=0?"+":"")??""}${e(X),n(()=>e(X).constant)??""}`)),o(Bt,yt)};b(st,Bt=>{e(X),n(()=>e(X).constant)&&Bt(Xe)},!0)}o(ft,ye)};b(A,ft=>{W(G()),n(()=>G().length>0)?ft(bt):ft(ht,!1)})}o(ae,Ie)};b(Ye,ae=>{e(X),W(G()),n(()=>e(X).constant||G().length>0)&&ae(at)})}s(nt);var rt=a(nt,2);{var oe=ae=>{var Ie=Hn();o(ae,Ie)};b(rt,ae=>{e(Ae)&&ae(oe)})}var B=a(rt,2);{var Ge=ae=>{var Ie=On(),A=l(Ie);kt(A,1,()=>e(M),Lt,(ft,ye)=>{var st=Un(),Xe=l(st,!0);s(st),C(()=>$(Xe,(e(ye),n(()=>e(ye).label)))),D("click",st,()=>Ke(e(ye).notation,"damage")),o(ft,st)});var bt=a(A,2);{var ht=ft=>{var ye=Nn();C(()=>{ye.disabled=e(m)<=0,tt(ye,"title",e(m)<=0?"No Channel Divinity uses remaining":"Use Channel Divinity to add +10 to this attack roll")}),D("click",ye,Z),o(ft,ye)};b(bt,ft=>{e(p)&&R()==="attack"&&!e(Le)&&e(m)>0&&!e(Ae)&&ft(ht)})}s(Ie),o(ae,Ie)};b(B,ae=>{e(M),e(p),W(R()),e(Le),e(m),n(()=>e(M).length>0||e(p)&&R()==="attack"&&!e(Le)&&e(m)>0)&&ae(Ge)})}C(()=>$(le,(e(X),n(()=>e(X).resultTotal)))),o(S,U)};b(et,S=>{e(X)&&S(it)})}s(Ue),s(V),s(Q),C(()=>{we=At(Q,1,"modal-overlay svelte-1r90jgp",null,we,{hidden:!Y()}),ze=At(Ue,1,"roll-result svelte-1r90jgp",null,ze,{"has-result":e(X)})}),D("click",d,E),D("click",me,fe),D("click",V,cs(function(S){Sa.call(this,c,S)})),D("keydown",V,function(S){Sa.call(this,c,S)}),D("click",Q,fe),D("keydown",Q,S=>S.key==="Escape"&&fe()),o(i,Q),bl(c,"getLastRollTotal",Pe);var ve=Gt(je);return u(),ve}const za="https://api.github.com/gists";async function Wn(i,c,t){if(!c)throw new Error("GitHub token is required");const v=JSON.stringify(i,null,2),u=`${i.name||"character"}_dnd.json`,p={description:t||`D&D Character: ${i.name}`,public:!1,files:{[u]:{content:v}}},m=await fetch(za,{method:"POST",headers:{Authorization:`token ${c}`,"Content-Type":"application/json"},body:JSON.stringify(p)});if(!m.ok)throw new Error(`Failed to create gist: ${m.statusText}`);return(await m.json()).id}async function Kn(i,c,t){if(!c||!t)throw new Error("GitHub token and Gist ID are required");const v=JSON.stringify(i,null,2),p={files:{[`${i.name||"character"}_dnd.json`]:{content:v}}},m=await fetch(`${za}/${t}`,{method:"PATCH",headers:{Authorization:`token ${c}`,"Content-Type":"application/json"},body:JSON.stringify(p)});if(!m.ok)throw new Error(`Failed to update gist: ${m.statusText}`)}async function Vn(i,c){if(!i)throw new Error("Gist ID is required");const t={"Content-Type":"application/json"};c&&(t.Authorization=`token ${c}`);const v=await fetch(`${za}/${i}`,{method:"GET",headers:t});if(!v.ok)throw new Error(`Failed to load gist: ${v.statusText}`);const u=await v.json(),p=Object.values(u.files);if(p.length===0)throw new Error("No files found in gist");const L=p[0].content;try{const h=JSON.parse(L);return h.attacks&&Array.isArray(h.attacks)&&(h.attacks=h.attacks.map(_=>({..._,id:_.id||crypto.randomUUID()}))),h.classFeatures?(h.classFeatures.features||(h.classFeatures.features={}),h.classFeatures.spellSlots||(h.classFeatures.spellSlots=[]),h.classFeatures.preparedSpells===void 0&&(h.classFeatures.preparedSpells="")):h.classFeatures={features:{},spellSlots:[],preparedSpells:""},h}catch{throw new Error("Invalid character data in gist")}}function ks(i){typeof window<"u"&&localStorage.setItem("dnd_gist_config",JSON.stringify(i))}function Jn(){if(typeof window<"u"){const i=localStorage.getItem("dnd_gist_config");if(i)return JSON.parse(i)}return{}}async function Yn(i,c=30){if(!i)throw new Error("GitHub token is required to list gists");const t=await fetch(`${za}?per_page=${c}`,{method:"GET",headers:{Authorization:`token ${i}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error(`Failed to list gists: ${t.statusText}`);return await t.json()}var Qn=f('<div class="error-message svelte-1jb5ckg"> </div>'),Xn=f('<div class="toggle-container svelte-1jb5ckg"><button type="button" class="toggle-btn svelte-1jb5ckg"> </button></div>'),Zn=f('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID (leave empty to create new)</label> <input type="text" id="gistId" placeholder="Optional: existing Gist ID to update" class="svelte-1jb5ckg"/></div>'),er=f('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),tr=f('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),ar=f('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Update (or leave unselected to create new)</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),sr=f('<div class="info-message svelte-1jb5ckg">No gists found. A new one will be created.</div>'),lr=f('<!> <div class="form-group svelte-1jb5ckg"><label for="description" class="svelte-1jb5ckg"> </label> <input type="text" id="description" placeholder="D&amp;D Character Sheet" class="svelte-1jb5ckg"/></div>',1),ir=f('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID *</label> <input type="text" id="gistId" placeholder="Enter Gist ID (for public or your private gists)" required class="svelte-1jb5ckg"/></div>'),nr=f('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),rr=f('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),or=f('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Load</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),cr=f('<div class="info-message svelte-1jb5ckg">No gists found. Enter a Gist ID manually or create a new one in Save mode.</div>'),vr=f('<div class="modal-overlay svelte-1jb5ckg" role="button" tabindex="-1"><div class="modal-content svelte-1jb5ckg" role="dialog" tabindex="0"><div class="modal-header svelte-1jb5ckg"><h2 class="svelte-1jb5ckg"> </h2> <button class="close-btn svelte-1jb5ckg">√ó</button></div> <div class="modal-body svelte-1jb5ckg"><!> <div class="form-group svelte-1jb5ckg"><label for="token" class="svelte-1jb5ckg"> <a href="https://github.com/settings/tokens" target="_blank" rel="noopener" class="svelte-1jb5ckg">Get token</a></label> <input type="password" id="token" placeholder="ghp_xxxxxxxxxxxxx" class="svelte-1jb5ckg"/></div> <!> <!> <div class="modal-actions svelte-1jb5ckg"><button class="btn btn-primary svelte-1jb5ckg"><!></button> <button class="btn btn-secondary svelte-1jb5ckg">Cancel</button></div></div></div></div>');function dr(i,c){Ot(c,!1);const t=()=>pt(de,"$character",v),[v,u]=na(),p=_a();let m=Dt(c,"mode",8,"save"),L=k(""),h=k(""),_=k(""),Y=k(!1),F=k(""),ie=k(!1),te=k(!1),z=k([]),G=k(null);const R=Jn();R.token&&r(L,R.token),R.gistId&&r(h,R.gistId),$a(async()=>{e(L)&&!e(ie)&&await I()});async function I(){if(e(L)){r(te,!0),r(F,"");try{r(z,await Yn(e(L))),e(h)&&r(G,e(z).find(x=>x.id===e(h))||null)}catch(x){r(F,x.message||"Failed to load gists"),r(z,[])}finally{r(te,!1)}}}function H(x){r(G,x),r(h,x.id)}function Te(){r(ie,!e(ie)),r(F,""),!e(ie)&&e(L)&&I()}async function Je(){if(!e(L)){r(F,"GitHub token is required");return}const x=e(G)?.id||e(h);r(Y,!0),r(F,"");try{if(x)await Kn(t(),e(L),x),r(h,x),Mt.add("Character updated in Gist successfully!","success");else{const E=await Wn(t(),e(L),e(_));r(h,E),Mt.add(`Character saved to Gist! ID: ${E}`,"success")}ks({token:e(L),gistId:e(h)}),p("close")}catch(E){r(F,E.message||"Failed to save to Gist")}finally{r(Y,!1)}}async function X(){const x=e(G)?.id||e(h);if(!x){r(F,"Please select a gist or enter a Gist ID");return}r(Y,!0),r(F,"");try{const E=await Vn(x,e(L)||void 0);de.set(E),r(h,x),ks({token:e(L),gistId:e(h)}),Mt.add("Character loaded from Gist successfully!","success"),p("close")}catch(E){r(F,E.message||"Failed to load from Gist")}finally{r(Y,!1)}}function Pe(){p("close")}Nt();var ue=vr(),xe=l(ue),Me=l(xe),T=l(Me),P=l(T,!0);s(T);var w=a(T,2);s(Me);var K=a(Me,2),g=l(K);{var M=x=>{var E=Qn(),Z=l(E,!0);s(E),C(()=>$(Z,e(F))),o(x,E)};b(g,x=>{e(F)&&x(M)})}var q=a(g,2),Ae=l(q),Le=l(Ae);Qt(),s(Ae);var pe=a(Ae,2);Ce(pe),s(q);var ne=a(q,2);{var Be=x=>{var E=Xn(),Z=l(E),fe=l(Z,!0);s(Z),s(E),C(()=>{Z.disabled=e(Y),$(fe,e(ie)?"üìã Show My Gists":"‚úèÔ∏è Enter Gist ID Manually")}),D("click",Z,Te),o(x,E)};b(ne,x=>{(m()==="load"||m()==="save"&&e(L))&&x(Be)})}var He=a(ne,2);{var ot=x=>{var E=lr(),Z=Se(E);{var fe=he=>{var Ve=Zn(),Oe=a(l(Ve),2);Ce(Oe),s(Ve),C(()=>Oe.disabled=e(Y)),Ne(Oe,()=>e(h),lt=>r(h,lt)),o(he,Ve)},je=he=>{var Ve=gt(),Oe=Se(Ve);{var lt=d=>{var me=er();o(d,me)},Fe=d=>{var me=gt(),$e=Se(me);{var ee=_e=>{var De=ar(),re=a(l(De),2);kt(re,5,()=>e(z),Lt,(Ee,be)=>{var Ue=tr();let ze;var et=l(Ue),it=l(et),ve=l(it,!0);s(it);var S=a(it,2),U=l(S,!0);s(S),s(et);var J=a(et,2),se=l(J),ge=l(se);s(se);var Re=a(se,2),Qe=l(Re);s(Re),s(J),s(Ue),C(qe=>{ze=At(Ue,1,"gist-item svelte-1jb5ckg",null,ze,{selected:e(G)?.id===e(be).id}),Ue.disabled=e(Y),$(ve,(e(be),n(()=>e(be).description||"Untitled"))),$(U,(e(be),n(()=>e(be).public?"üåê Public":"üîí Private"))),$(ge,`ID: ${e(be),n(()=>e(be).id)??""}`),$(Qe,`Updated: ${qe??""}`)},[()=>(e(be),n(()=>new Date(e(be).updated_at).toLocaleDateString()))]),D("click",Ue,()=>H(e(be))),o(Ee,Ue)}),s(re),s(De),o(_e,De)},ke=_e=>{var De=gt(),re=Se(De);{var Ee=be=>{var Ue=sr();o(be,Ue)};b(re,be=>{e(L)&&be(Ee)},!0)}o(_e,De)};b($e,_e=>{e(z),n(()=>e(z).length>0)?_e(ee):_e(ke,!1)},!0)}o(d,me)};b(Oe,d=>{e(te)?d(lt):d(Fe,!1)},!0)}o(he,Ve)};b(Z,he=>{e(ie)||!e(L)?he(fe):he(je,!1)})}var Q=a(Z,2),we=l(Q),V=l(we);s(we);var j=a(we,2);Ce(j),s(Q),C(()=>{$(V,`Description ${e(h)?"(optional)":""}`),j.disabled=e(Y)}),Ne(j,()=>e(_),he=>r(_,he)),o(x,E)},mt=x=>{var E=gt(),Z=Se(E);{var fe=Q=>{var we=ir(),V=a(l(we),2);Ce(V),s(we),C(()=>V.disabled=e(Y)),Ne(V,()=>e(h),j=>r(h,j)),o(Q,we)},je=Q=>{var we=gt(),V=Se(we);{var j=Ve=>{var Oe=nr();o(Ve,Oe)},he=Ve=>{var Oe=gt(),lt=Se(Oe);{var Fe=me=>{var $e=or(),ee=a(l($e),2);kt(ee,5,()=>e(z),Lt,(ke,_e)=>{var De=rr();let re;var Ee=l(De),be=l(Ee),Ue=l(be,!0);s(be);var ze=a(be,2),et=l(ze,!0);s(ze),s(Ee);var it=a(Ee,2),ve=l(it),S=l(ve);s(ve);var U=a(ve,2),J=l(U);s(U),s(it),s(De),C(se=>{re=At(De,1,"gist-item svelte-1jb5ckg",null,re,{selected:e(G)?.id===e(_e).id}),De.disabled=e(Y),$(Ue,(e(_e),n(()=>e(_e).description||"Untitled"))),$(et,(e(_e),n(()=>e(_e).public?"üåê Public":"üîí Private"))),$(S,`ID: ${e(_e),n(()=>e(_e).id)??""}`),$(J,`Updated: ${se??""}`)},[()=>(e(_e),n(()=>new Date(e(_e).updated_at).toLocaleDateString()))]),D("click",De,()=>H(e(_e))),o(ke,De)}),s(ee),s($e),o(me,$e)},d=me=>{var $e=gt(),ee=Se($e);{var ke=_e=>{var De=cr();o(_e,De)};b(ee,_e=>{e(L)&&_e(ke)},!0)}o(me,$e)};b(lt,me=>{e(z),n(()=>e(z).length>0)?me(Fe):me(d,!1)},!0)}o(Ve,Oe)};b(V,Ve=>{e(te)?Ve(j):Ve(he,!1)},!0)}o(Q,we)};b(Z,Q=>{e(ie)||!e(L)?Q(fe):Q(je,!1)},!0)}o(x,E)};b(He,x=>{m()==="save"?x(ot):x(mt,!1)})}var vt=a(He,2),Ke=l(vt),xt=l(Ke);{var y=x=>{var E=Tt();C(()=>$(E,m()==="save"?"Saving...":"Loading...")),o(x,E)},N=x=>{var E=Tt();C(()=>$(E,m()==="save"?"Save":"Load")),o(x,E)};b(xt,x=>{e(Y)?x(y):x(N,!1)})}s(Ke);var ce=a(Ke,2);s(vt),s(K),s(xe),s(ue),C(()=>{$(P,m()==="save"?"Save to GitHub Gist":"Load from GitHub Gist"),$(Le,`GitHub Token ${m()==="load"?"(optional for public gists)":"(required)"} `),pe.disabled=e(Y),Ke.disabled=e(Y),ce.disabled=e(Y)}),D("click",w,Pe),Ne(pe,()=>e(L),x=>r(L,x)),D("blur",pe,()=>{e(L)&&!e(ie)&&I()}),D("click",Ke,function(...x){(m()==="save"?Je:X)?.apply(this,x)}),D("click",ce,Pe),D("click",xe,cs(function(x){Sa.call(this,c,x)})),D("keydown",xe,function(x){Sa.call(this,c,x)}),D("click",ue,Pe),D("keydown",ue,x=>x.key==="Escape"&&Pe()),o(i,ue),Gt(),u()}var ur=f('<div class="loading svelte-1ngjemu">Loading D&D data...</div>'),fr=f("<option> </option>"),pr=f('<select class="level-filter svelte-1ngjemu"><option>All Levels</option><option>Cantrip</option><!></select>'),mr=f('<div class="no-results svelte-1ngjemu"> </div>'),gr=f('<div class="item-meta svelte-1ngjemu"> </div>'),br=f('<div class="item-meta svelte-1ngjemu"> </div>'),hr=f('<button><div class="item-name svelte-1ngjemu"> </div> <!></button>'),_r=f('<p class="higher-levels"><strong>At Higher Levels:</strong> </p>'),yr=f('<p class="cantrip-upgrade"><strong>Cantrip Upgrade:</strong> </p>'),xr=f('<h3 class="svelte-1ngjemu"> </h3> <p class="spell-meta svelte-1ngjemu"><!> <!></p> <p class="spell-classes"><strong>Classes:</strong> </p> <div class="spell-stats svelte-1ngjemu"><div><strong>Casting Time:</strong> </div> <div><strong>Range:</strong> </div> <div><strong>Components:</strong> <!></div> <div><strong>Duration:</strong> <!> </div></div> <p class="description svelte-1ngjemu"> </p> <!> <!>',1),wr=f('<p class="prerequisite svelte-1ngjemu"><strong>Prerequisite:</strong> </p>'),$r=f('<h3 class="svelte-1ngjemu"> </h3> <!> <p class="description svelte-1ngjemu"> </p> <a target="_blank" rel="noopener" class="source-link svelte-1ngjemu">View Full Details ‚Üí</a>',1),kr=f('<div class="item-details svelte-1ngjemu"><!></div>'),Sr=f('<div class="controls svelte-1ngjemu"><div class="tabs svelte-1ngjemu"><button> </button> <button> </button></div> <div class="search-controls svelte-1ngjemu"><input type="text" placeholder="Search by name or description..." class="search-input svelte-1ngjemu"/> <!></div></div> <div class="content-container svelte-1ngjemu"><div class="items-list svelte-1ngjemu"><!></div> <!></div>',1),Cr=f('<div class="modal-backdrop svelte-1ngjemu" role="presentation"><div class="modal svelte-1ngjemu" role="dialog" aria-modal="true" tabindex="-1"><div class="modal-header svelte-1ngjemu"><h2 class="svelte-1ngjemu">Browse D&D Spells & Feats</h2> <button class="close-btn svelte-1ngjemu" aria-label="Close">&times;</button></div> <div class="modal-body svelte-1ngjemu"><!></div> <div class="modal-footer svelte-1ngjemu"><button class="btn-secondary svelte-1ngjemu">Cancel</button> <button class="btn-primary svelte-1ngjemu">Add to Character Sheet</button></div></div></div>');function Dr(i,c){Ot(c,!1);const t=k(),v=k(),u=k();let p=Dt(c,"onClose",8),m=k("spell"),L=k(!0),h=k(""),_=k(null),Y=k([]),F=k([]),ie=k(null);$a(async()=>{r(L,!0);try{r(Y,await Ms()),r(F,await li())}catch(w){console.error("Failed to load data:",w)}finally{r(L,!1)}});function te(w){r(ie,w)}function z(w){const K=w.match(/(\d+d\d+(?:\s*\+\s*\d+)?)/i);return K?K[1]:""}function G(w){const K=w.split(/\.( |$)/)[0].trim(),g=Array.from(w.matchAll(/\*\*(.*?)\*\*/g)).map(q=>q[1].replace(/\.$/,""));let M=K;return g.length&&(M+=" | Effects: "+g.join(", ")),M}function R(){if(e(ie)){if(e(m)==="spell"){const w=e(ie);de.update(K=>{const M=[];w.range&&M.push(`Range: ${w.range}`),w.castingTime&&M.push(`Cast: ${w.castingTime}`),w.duration&&M.push(`Duration: ${w.duration}`),w.actionType==="Save"&&M.push("Saving throw spell"),w.components&&w.components.length>0&&M.push(`Components: ${w.components.join(", ")}`),w.material&&M.push(`Material: ${w.material}`);const q=M.join(" | "),Ae=G(w.description),Le={id:crypto.randomUUID(),name:`${w.name}${w.concentration?" (C)":""}${w.ritual?" (R)":""}`,bonus:w.actionType==="Attack"?5:0,damage:z(w.description),damageType:`${w.school} (Lvl ${w.level})`,spellRef:w.name,infoNotes:q,generalNotes:Ae,castAtLevel:w.level};return K.attacks=[...K.attacks,Le],K})}else if(e(m)==="feat"){const w=e(ie);de.update(K=>{const g=`${w.name}${w.prerequisite?` (Req: ${w.prerequisite})`:""}
${w.description}
`;return K.features=K.features?`${K.features}
${g}`:g,K})}r(ie,null),p()()}}Ze(()=>(e(_),e(Y),e(h)),()=>{r(t,e(_)!==null?ii(xs(e(Y),e(h)),e(_)):xs(e(Y),e(h)))}),Ze(()=>(e(F),e(h)),()=>{r(v,ni(e(F),e(h)))}),Ze(()=>(e(m),e(t),e(v)),()=>{r(u,e(m)==="spell"?e(t):e(v))}),da(),Nt();var I=Cr(),H=l(I),Te=l(H),Je=a(l(Te),2);s(Te);var X=a(Te,2),Pe=l(X);{var ue=w=>{var K=ur();o(w,K)},xe=w=>{var K=Sr(),g=Se(K),M=l(g),q=l(M);let Ae;var Le=l(q);s(q);var pe=a(q,2);let ne;var Be=l(pe);s(pe),s(M);var He=a(M,2),ot=l(He);Ce(ot);var mt=a(ot,2);{var vt=Z=>{var fe=pr();C(()=>{e(_),Ut(()=>{})});var je=l(fe);je.value=(je.__value=null)??"";var Q=a(je);Q.value=Q.__value=0;var we=a(Q);kt(we,0,()=>[1,2,3,4,5,6,7,8,9],Lt,(V,j)=>{var he=fr(),Ve=l(he);s(he);var Oe={};C(()=>{$(Ve,`Level ${j??""}`),Oe!==(Oe=j)&&(he.value=(he.__value=j)??"")}),o(V,he)}),s(fe),Ta(fe,()=>e(_),V=>r(_,V)),o(Z,fe)};b(mt,Z=>{e(m)==="spell"&&Z(vt)})}s(He),s(g);var Ke=a(g,2),xt=l(Ke),y=l(xt);{var N=Z=>{var fe=mr(),je=l(fe);s(fe),C(()=>$(je,`No ${e(m)??""}s found`)),o(Z,fe)},ce=Z=>{var fe=gt(),je=Se(fe);kt(je,1,()=>e(u),Lt,(Q,we)=>{var V=hr();let j;var he=l(V),Ve=l(he,!0);s(he);var Oe=a(he,2);{var lt=d=>{const me=$t(()=>e(we));var $e=gr(),ee=l($e);s($e),C(()=>$(ee,`Level ${W(e(me)),n(()=>e(me).level)??""} ‚Ä¢ ${W(e(me)),n(()=>e(me).school)??""}`)),o(d,$e)},Fe=d=>{const me=$t(()=>e(we));var $e=gt(),ee=Se($e);{var ke=_e=>{var De=br(),re=l(De,!0);s(De),C(()=>$(re,(W(e(me)),n(()=>e(me).prerequisite)))),o(_e,De)};b(ee,_e=>{W(e(me)),n(()=>e(me).prerequisite)&&_e(ke)})}o(d,$e)};b(Oe,d=>{e(m)==="spell"?d(lt):d(Fe,!1)})}s(V),C(()=>{j=At(V,1,"item-card svelte-1ngjemu",null,j,{selected:e(ie)?.name===e(we).name}),$(Ve,(e(we),n(()=>e(we).name)))}),D("click",V,()=>te(e(we))),o(Q,V)}),o(Z,fe)};b(y,Z=>{e(u),n(()=>e(u).length===0)?Z(N):Z(ce,!1)})}s(xt);var x=a(xt,2);{var E=Z=>{var fe=kr(),je=l(fe);{var Q=V=>{const j=$t(()=>e(ie));var he=xr(),Ve=Se(he),Oe=l(Ve,!0);s(Ve);var lt=a(Ve,2),Fe=l(lt);{var d=O=>{var le=Tt();C(()=>$(le,`${W(e(j)),n(()=>e(j).school)??""} cantrip`)),o(O,le)},me=O=>{var le=Tt();C(()=>$(le,`Level ${W(e(j)),n(()=>e(j).level)??""} ${W(e(j)),n(()=>e(j).school)??""}`)),o(O,le)};b(Fe,O=>{W(e(j)),n(()=>e(j).level===0)?O(d):O(me,!1)})}var $e=a(Fe,2);{var ee=O=>{var le=Tt("(ritual)");o(O,le)};b($e,O=>{W(e(j)),n(()=>e(j).ritual)&&O(ee)})}s(lt);var ke=a(lt,2),_e=a(l(ke));s(ke);var De=a(ke,2),re=l(De),Ee=a(l(re));s(re);var be=a(re,2),Ue=a(l(be));s(be);var ze=a(be,2),et=a(l(ze)),it=a(et);{var ve=O=>{var le=Tt();C(()=>$(le,`(${W(e(j)),n(()=>e(j).material)??""})`)),o(O,le)};b(it,O=>{W(e(j)),n(()=>e(j).material)&&O(ve)})}s(ze);var S=a(ze,2),U=a(l(S),2);{var J=O=>{var le=Tt("Concentration,");o(O,le)};b(U,O=>{W(e(j)),n(()=>e(j).concentration)&&O(J)})}var se=a(U,1,!0);s(S),s(De);var ge=a(De,2),Re=l(ge,!0);s(ge);var Qe=a(ge,2);{var qe=O=>{var le=_r(),nt=a(l(le));s(le),C(()=>$(nt,` ${W(e(j)),n(()=>e(j).higherLevelSlot)??""}`)),o(O,le)};b(Qe,O=>{W(e(j)),n(()=>e(j).higherLevelSlot)&&O(qe)})}var ut=a(Qe,2);{var We=O=>{var le=yr(),nt=a(l(le));s(le),C(()=>$(nt,` ${W(e(j)),n(()=>e(j).cantripUpgrade)??""}`)),o(O,le)};b(ut,O=>{W(e(j)),n(()=>e(j).cantripUpgrade)&&O(We)})}C((O,le)=>{$(Oe,(W(e(j)),n(()=>e(j).name))),$(_e,` ${O??""}`),$(Ee,` ${W(e(j)),n(()=>e(j).castingTime||e(j).actionType)??""}`),$(Ue,` ${W(e(j)),n(()=>e(j).range)??""}`),$(et,` ${le??""}`),$(se,(W(e(j)),n(()=>e(j).duration))),$(Re,(W(e(j)),n(()=>e(j).description)))},[()=>(W(e(j)),n(()=>e(j).classes.join(", "))),()=>(W(e(j)),n(()=>e(j).components.join(", ").toUpperCase()))]),o(V,he)},we=V=>{const j=$t(()=>e(ie));var he=$r(),Ve=Se(he),Oe=l(Ve,!0);s(Ve);var lt=a(Ve,2);{var Fe=ee=>{var ke=wr(),_e=a(l(ke));s(ke),C(()=>$(_e,` ${W(e(j)),n(()=>e(j).prerequisite)??""}`)),o(ee,ke)};b(lt,ee=>{W(e(j)),n(()=>e(j).prerequisite)&&ee(Fe)})}var d=a(lt,2),me=l(d,!0);s(d);var $e=a(d,2);C(()=>{$(Oe,(W(e(j)),n(()=>e(j).name))),$(me,(W(e(j)),n(()=>e(j).description))),tt($e,"href",(W(e(j)),n(()=>e(j).source)))}),o(V,he)};b(je,V=>{e(m)==="spell"?V(Q):V(we,!1)})}s(fe),o(Z,fe)};b(x,Z=>{e(ie)&&Z(E)})}s(Ke),C(()=>{Ae=At(q,1,"tab svelte-1ngjemu",null,Ae,{active:e(m)==="spell"}),$(Le,`üìú Spells (${e(Y),n(()=>e(Y).length)??""})`),ne=At(pe,1,"tab svelte-1ngjemu",null,ne,{active:e(m)==="feat"}),$(Be,`‚≠ê Feats (${e(F),n(()=>e(F).length)??""})`)}),D("click",q,()=>{r(m,"spell"),r(ie,null),r(h,"")}),D("click",pe,()=>{r(m,"feat"),r(ie,null),r(h,"")}),Ne(ot,()=>e(h),Z=>r(h,Z)),o(w,K)};b(Pe,w=>{e(L)?w(ue):w(xe,!1)})}s(X);var Me=a(X,2),T=l(Me),P=a(T,2);s(Me),s(H),s(I),C(()=>P.disabled=!e(ie)),D("click",Je,function(...w){p()?.apply(this,w)}),D("click",T,function(...w){p()?.apply(this,w)}),D("click",P,R),D("click",H,cs(function(w){Sa.call(this,c,w)})),D("keydown",H,function(w){Sa.call(this,c,w)}),D("click",I,function(...w){p()?.apply(this,w)}),D("keydown",I,w=>w.key==="Escape"&&p()()),o(i,I),Gt()}var Lr=f('<span class="resistance-tag svelte-gdwwx1"> <button type="button" class="tag-remove svelte-gdwwx1">√ó</button></span>'),jr=f('<div class="resistance-list svelte-gdwwx1"></div>'),Ar=f('<p class="ability-meta svelte-gdwwx1"> <!></p>'),Br=f('<p class="ability-meta svelte-gdwwx1">Requires Reaction</p>'),Rr=f('<div class="ability-card svelte-gdwwx1"><div class="ability-header svelte-gdwwx1"><strong class="svelte-gdwwx1"> </strong> <button type="button" class="ability-remove svelte-gdwwx1">√ó</button></div> <p class="ability-description svelte-gdwwx1"> </p> <!></div>'),Tr=f('<div class="abilities-list svelte-gdwwx1"></div>'),Mr=f(`<div class="modal-backdrop svelte-gdwwx1" role="presentation"><div class="modal-content svelte-gdwwx1" role="dialog" aria-modal="true" aria-labelledby="modal-title"><div class="modal-header svelte-gdwwx1"><h3 id="modal-title" class="svelte-gdwwx1">Add Custom Condition</h3> <button class="btn-close svelte-gdwwx1" aria-label="Close">√ó</button></div> <div class="modal-body svelte-gdwwx1"><div class="form-group svelte-gdwwx1"><label for="conditionName" class="svelte-gdwwx1">Condition Name*</label> <input type="text" id="conditionName" placeholder="e.g., Cazna's Mark" class="svelte-gdwwx1"/></div> <div class="form-group svelte-gdwwx1"><label for="description" class="svelte-gdwwx1">Description</label> <textarea id="description" placeholder="Describe the condition..." rows="3" class="svelte-gdwwx1"></textarea></div> <div class="form-row svelte-gdwwx1"><div class="form-group svelte-gdwwx1"><label for="attackBonus" class="svelte-gdwwx1">Attack Bonus</label> <input type="text" id="attackBonus" placeholder="0 or 1d4" class="svelte-gdwwx1"/></div> <div class="form-group svelte-gdwwx1"><label for="damageBonus" class="svelte-gdwwx1">Damage Bonus</label> <input type="text" id="damageBonus" placeholder="0 or 1d6" class="svelte-gdwwx1"/></div> <div class="form-group svelte-gdwwx1"><label for="acBonus" class="svelte-gdwwx1">AC Bonus</label> <input type="number" id="acBonus" placeholder="0" class="svelte-gdwwx1"/></div></div> <div class="form-group svelte-gdwwx1"><label for="darkvision" class="svelte-gdwwx1">Darkvision (feet)</label> <input type="number" id="darkvision" placeholder="0" min="0" step="30" class="svelte-gdwwx1"/> <small class="help-text svelte-gdwwx1">Grant or extend darkvision (e.g., 60 for 60 feet)</small></div> <div class="form-group svelte-gdwwx1"><label class="svelte-gdwwx1">Damage Resistances</label> <div class="resistance-input-group svelte-gdwwx1"><input type="text" placeholder="e.g., cold, fire, poison" class="svelte-gdwwx1"/> <button type="button" class="btn-add svelte-gdwwx1">Add</button></div> <!></div> <div class="form-group svelte-gdwwx1"><label class="svelte-gdwwx1">Special Abilities</label> <div class="ability-form svelte-gdwwx1"><input type="text" placeholder="Ability name (e.g., Flicker of Deceit)" class="ability-name-input svelte-gdwwx1"/> <textarea placeholder="Ability description..." rows="2" class="ability-desc-input svelte-gdwwx1"></textarea> <div class="ability-options svelte-gdwwx1"><div class="ability-option svelte-gdwwx1"><label for="abilityUses" class="svelte-gdwwx1">Uses per rest</label> <input type="number" id="abilityUses" min="0" class="svelte-gdwwx1"/></div> <div class="ability-option svelte-gdwwx1"><label for="restType" class="svelte-gdwwx1">Rest type</label> <select id="restType" class="svelte-gdwwx1"><option>Short</option><option>Long</option></select></div> <div class="ability-option svelte-gdwwx1"><label class="svelte-gdwwx1"><input type="checkbox" class="svelte-gdwwx1"/> Requires Reaction</label></div></div> <button type="button" class="btn-add svelte-gdwwx1">Add Ability</button></div> <!></div></div> <div class="modal-footer svelte-gdwwx1"><button class="btn btn-secondary svelte-gdwwx1">Cancel</button> <button class="btn btn-primary svelte-gdwwx1">Add Condition</button></div></div></div>`);function Fr(i,c){Ot(c,!1);let t=Dt(c,"show",8,!1),v=Dt(c,"onSave",8),u=Dt(c,"onCancel",8),p=k(""),m=k(""),L=k(0),h=k(0),_=k(0),Y=k(0),F=k([]),ie=k(""),te=k([]),z=k(""),G=k(""),R=k(0),I=k("short"),H=k(!1);function Te(){r(p,""),r(m,""),r(L,0),r(h,0),r(_,0),r(Y,0),r(F,[]),r(ie,""),r(te,[]),r(z,""),r(G,""),r(R,0),r(I,"short"),r(H,!1)}function Je(){e(ie).trim()&&(r(F,[...e(F),e(ie).trim()]),r(ie,""))}function X(g){r(F,e(F).filter((M,q)=>q!==g))}function Pe(){if(e(z).trim()&&e(G).trim()){const g={name:e(z).trim(),description:e(G).trim(),requiresReaction:e(H)};e(R)>0&&(g.usesPerRest=e(R),g.currentUses=e(R),g.restType=e(I)),r(te,[...e(te),g]),r(z,""),r(G,""),r(R,0),r(I,"short"),r(H,!1)}}function ue(g){r(te,e(te).filter((M,q)=>q!==g))}function xe(){if(!e(p).trim()){alert("Please enter a condition name");return}const g={name:e(p).trim(),description:e(m).trim()||"Custom condition",attackBonus:e(L)||0,damageBonus:e(h)||0,target:"self"};e(_)!==0&&(g.acBonus=e(_)),e(Y)>0&&(g.darkvision=e(Y)),e(F).length>0&&(g.resistances=e(F)),e(te).length>0&&(g.abilities=e(te)),v()(g),Te()}function Me(){Te(),u()()}function T(g){g.target===g.currentTarget&&Me()}Nt();var P=gt(),w=Se(P);{var K=g=>{var M=Mr(),q=l(M),Ae=l(q),Le=a(l(Ae),2);s(Ae);var pe=a(Ae,2),ne=l(pe),Be=a(l(ne),2);Ce(Be),s(ne);var He=a(ne,2),ot=a(l(He),2);wa(ot),s(He);var mt=a(He,2),vt=l(mt),Ke=a(l(vt),2);Ce(Ke),s(vt);var xt=a(vt,2),y=a(l(xt),2);Ce(y),s(xt);var N=a(xt,2),ce=a(l(N),2);Ce(ce),s(N),s(mt);var x=a(mt,2),E=a(l(x),2);Ce(E),Qt(2),s(x);var Z=a(x,2),fe=a(l(Z),2),je=l(fe);Ce(je);var Q=a(je,2);s(fe);var we=a(fe,2);{var V=ve=>{var S=jr();kt(S,5,()=>e(F),Lt,(U,J,se)=>{var ge=Lr(),Re=l(ge),Qe=a(Re);s(ge),C(()=>{$(Re,`${e(J)??""} `),tt(Qe,"aria-label",`Remove ${e(J)??""}`)}),D("click",Qe,()=>X(se)),o(U,ge)}),s(S),o(ve,S)};b(we,ve=>{e(F),n(()=>e(F).length>0)&&ve(V)})}s(Z);var j=a(Z,2),he=a(l(j),2),Ve=l(he);Ce(Ve);var Oe=a(Ve,2);wa(Oe);var lt=a(Oe,2),Fe=l(lt),d=a(l(Fe),2);Ce(d),s(Fe);var me=a(Fe,2),$e=a(l(me),2);C(()=>{e(I),Ut(()=>{})});var ee=l($e);ee.value=ee.__value="short";var ke=a(ee);ke.value=ke.__value="long",s($e),s(me);var _e=a(me,2),De=l(_e),re=l(De);Ce(re),Qt(),s(De),s(_e),s(lt);var Ee=a(lt,2);s(he);var be=a(he,2);{var Ue=ve=>{var S=Tr();kt(S,5,()=>e(te),Lt,(U,J,se)=>{var ge=Rr(),Re=l(ge),Qe=l(Re),qe=l(Qe,!0);s(Qe);var ut=a(Qe,2);s(Re);var We=a(Re,2),O=l(We,!0);s(We);var le=a(We,2);{var nt=at=>{var rt=Ar(),oe=l(rt),B=a(oe);{var Ge=ae=>{var Ie=Tt("‚Ä¢ Requires Reaction");o(ae,Ie)};b(B,ae=>{e(J),n(()=>e(J).requiresReaction)&&ae(Ge)})}s(rt),C(()=>$(oe,`${e(J),n(()=>e(J).usesPerRest)??""} use${e(J),n(()=>e(J).usesPerRest>1?"s":"")??""} per ${e(J),n(()=>e(J).restType)??""}
                      rest `)),o(at,rt)},Ye=at=>{var rt=gt(),oe=Se(rt);{var B=Ge=>{var ae=Br();o(Ge,ae)};b(oe,Ge=>{e(J),n(()=>e(J).requiresReaction)&&Ge(B)},!0)}o(at,rt)};b(le,at=>{e(J),n(()=>e(J).usesPerRest)?at(nt):at(Ye,!1)})}s(ge),C(()=>{$(qe,(e(J),n(()=>e(J).name))),tt(ut,"aria-label",`Remove ${e(J),n(()=>e(J).name)??""}`),$(O,(e(J),n(()=>e(J).description)))}),D("click",ut,()=>ue(se)),o(U,ge)}),s(S),o(ve,S)};b(be,ve=>{e(te),n(()=>e(te).length>0)&&ve(Ue)})}s(j),s(pe);var ze=a(pe,2),et=l(ze),it=a(et,2);s(ze),s(q),s(M),D("click",Le,Me),Ne(Be,()=>e(p),ve=>r(p,ve)),Ne(ot,()=>e(m),ve=>r(m,ve)),Ne(Ke,()=>e(L),ve=>r(L,ve)),Ne(y,()=>e(h),ve=>r(h,ve)),Ne(ce,()=>e(_),ve=>r(_,ve)),Ne(E,()=>e(Y),ve=>r(Y,ve)),Ne(je,()=>e(ie),ve=>r(ie,ve)),D("keydown",je,ve=>ve.key==="Enter"&&Je()),D("click",Q,Je),Ne(Ve,()=>e(z),ve=>r(z,ve)),Ne(Oe,()=>e(G),ve=>r(G,ve)),Ne(d,()=>e(R),ve=>r(R,ve)),Ta($e,()=>e(I),ve=>r(I,ve)),ka(re,()=>e(H),ve=>r(H,ve)),D("click",Ee,Pe),D("click",et,Me),D("click",it,xe),D("click",M,T),o(g,M)};b(w,g=>{t()&&g(K)})}o(i,P),Gt()}var Pr=f("<option></option>"),Ir=f("<button> </button>"),Er=f('<button class="btn btn-primary calculate-btn use-enabled svelte-uvfntf">Calculate Damage</button>'),Hr=f('<div class="adjustment-msg svelte-uvfntf"> </div>'),Ur=f('<div class="calculation-result svelte-uvfntf"><div class="result-header svelte-uvfntf"><h4 class="svelte-uvfntf">Damage Calculation</h4></div> <div class="result-content svelte-uvfntf"><div class="damage-breakdown svelte-uvfntf"><div class="damage-row svelte-uvfntf"><span class="label svelte-uvfntf">Original Damage:</span> <span class="value svelte-uvfntf"> </span></div> <div class="adjustments svelte-uvfntf"></div> <div class="damage-row final svelte-uvfntf"><span class="label svelte-uvfntf">Final Damage:</span> <span class="value damage-value svelte-uvfntf"> </span></div></div></div> <div class="result-actions svelte-uvfntf"><button class="btn btn-primary apply-btn use-enabled svelte-uvfntf">Apply Damage</button> <button class="btn btn-secondary cancel-btn use-enabled svelte-uvfntf">Cancel</button></div></div>'),Nr=f('<div class="damage-form svelte-uvfntf"><div class="input-group svelte-uvfntf"><div class="input-field svelte-uvfntf"><label for="damageAmount" class="svelte-uvfntf">Damage Amount</label> <input type="number" id="damageAmount" min="0" placeholder="0" class="damage-input-field use-enabled svelte-uvfntf"/></div> <div class="input-field svelte-uvfntf"><label for="damageType" class="svelte-uvfntf">Damage Type</label> <input type="text" id="damageType" list="damageTypes" placeholder="e.g., fire, cold" class="damage-input-field use-enabled svelte-uvfntf"/> <datalist id="damageTypes"></datalist></div></div> <div class="quick-types svelte-uvfntf"><span class="quick-types-label svelte-uvfntf">Quick Select:</span> <!></div> <!></div>'),Or=f("<section><!> <!></section>");function Gr(i,c){Ot(c,!1);const t=()=>pt(de,"$character",p),v=()=>pt(ga,"$searchFilter",p),u=()=>pt(Xt,"$collapsedStates",p),[p,m]=na(),L=k();_a();let h=k(0),_=k(""),Y=k(!1),F=k(0),ie=k([]);const te=["slashing","piercing","bludgeoning","fire","cold","lightning","thunder","acid","poison","necrotic","radiant","psychic","force"];function z(){if(e(h)<0){Mt.add("Damage amount cannot be negative","error");return}if(!e(_).trim()){Mt.add("Please enter or select a damage type","error");return}const Pe=Pl(e(h),e(_),t());r(F,Pe.finalDamage),r(ie,Pe.adjustments),r(Y,!0)}function G(){de.update(Pe=>Il(Pe,e(F))),Mt.add(`Applied ${e(F)} damage to character (${e(_)})`,"info"),r(h,0),r(_,""),r(Y,!1),r(F,0),r(ie,[])}function R(){r(Y,!1),r(F,0),r(ie,[])}Ze(()=>v(),()=>{r(L,!v()||"damage".includes(v().toLowerCase())||"resistance".includes(v().toLowerCase())||"immune".includes(v().toLowerCase()))}),da(),Nt();var I=Or();let H;var Te=l(I);{let Pe=$t(()=>(u(),n(()=>u().damageInput?"Expand":"Collapse")));ya(Te,{title:"Apply Damage",get collapsed(){return u(),n(()=>u().damageInput)},get ariaLabel(){return e(Pe)},onToggle:()=>Xt.update(ue=>({...ue,damageInput:!ue.damageInput}))})}var Je=a(Te,2);{var X=Pe=>{var ue=Nr(),xe=l(ue),Me=l(xe),T=a(l(Me),2);Ce(T),s(Me);var P=a(Me,2),w=a(l(P),2);Ce(w);var K=a(w,2);kt(K,5,()=>te,Lt,(pe,ne)=>{var Be=Pr(),He={};C(()=>{He!==(He=e(ne))&&(Be.value=(Be.__value=e(ne))??"")}),o(pe,Be)}),s(K),s(P),s(xe);var g=a(xe,2),M=a(l(g),2);kt(M,1,()=>te,Lt,(pe,ne)=>{var Be=Ir();let He;var ot=l(Be,!0);s(Be),C(()=>{He=At(Be,1,"quick-type-btn use-enabled svelte-uvfntf",null,He,{active:e(_)===e(ne)}),$(ot,e(ne))}),D("click",Be,()=>r(_,e(ne))),o(pe,Be)}),s(g);var q=a(g,2);{var Ae=pe=>{var ne=Er();D("click",ne,z),o(pe,ne)},Le=pe=>{var ne=Ur(),Be=a(l(ne),2),He=l(Be),ot=l(He),mt=a(l(ot),2),vt=l(mt);s(mt),s(ot);var Ke=a(ot,2);kt(Ke,5,()=>e(ie),Lt,(Z,fe)=>{var je=Hr(),Q=l(je,!0);s(je),C(()=>$(Q,e(fe))),o(Z,je)}),s(Ke);var xt=a(Ke,2),y=a(l(xt),2),N=l(y,!0);s(y),s(xt),s(He),s(Be);var ce=a(Be,2),x=l(ce),E=a(x,2);s(ce),s(ne),C(()=>{$(vt,`${e(h)??""} ${e(_)??""}`),$(N,e(F))}),D("click",x,G),D("click",E,R),o(pe,ne)};b(q,pe=>{e(Y)?pe(Le,!1):pe(Ae)})}s(ue),Ne(T,()=>e(h),pe=>r(h,pe)),Ne(w,()=>e(_),pe=>r(_,pe)),o(Pe,ue)};b(Je,Pe=>{u(),n(()=>!u().damageInput)&&Pe(X)})}s(I),C(()=>H=At(I,1,"damage-input svelte-uvfntf",null,H,{hidden:!e(L)})),o(i,I),Gt(),m()}var qr=f('<button class="console-toggle svelte-x96uf"> </button>'),zr=f('<div class="no-logs svelte-x96uf">No console messages yet</div>'),Wr=f('<div><span class="log-timestamp svelte-x96uf"> </span> <span class="log-type svelte-x96uf"> </span> <span class="log-message svelte-x96uf"> </span></div>'),Kr=f('<div class="console-content svelte-x96uf"><!></div>'),Vr=f('<div><div class="console-header svelte-x96uf"><span class="console-title svelte-x96uf"> </span> <div class="console-controls svelte-x96uf"><button class="control-btn svelte-x96uf"> </button> <button class="control-btn svelte-x96uf">üóëÔ∏è</button> <button class="control-btn svelte-x96uf">‚úï</button></div></div> <!></div>'),Jr=f('<div class="console-viewer svelte-x96uf"><!> <!></div>');function Yr(i,c){Ot(c,!1);let t=k([]),v=k(!1),u=k(!1);$a(()=>{const z=console.log;console.log=function(...H){p("log",H),z.apply(console,H)};const G=console.error;console.error=function(...H){p("error",H),G.apply(console,H)};const R=console.warn;console.warn=function(...H){p("warn",H),R.apply(console,H)};const I=console.info;return console.info=function(...H){p("info",H),I.apply(console,H)},window.addEventListener("error",H=>{p("error",[`Uncaught Error: ${H.message} at ${H.filename}:${H.lineno}:${H.colno}`])}),window.addEventListener("unhandledrejection",H=>{p("error",[`Unhandled Promise Rejection: ${H.reason}`])}),()=>{console.log=z,console.error=G,console.warn=R,console.info=I}});function p(z,G){const R=G.map(H=>{if(typeof H=="object")try{return JSON.stringify(H,null,2)}catch{return String(H)}return String(H)}).join(" "),I=new Date().toLocaleTimeString();r(t,[...e(t),{type:z,message:R,timestamp:I}]),e(t).length>100&&r(t,e(t).slice(-100))}function m(){r(t,[])}function L(){r(v,!e(v))}function h(){r(u,!e(u))}Nt();var _=Jr(),Y=l(_);{var F=z=>{var G=qr(),R=l(G);s(G),C(()=>$(R,`üêõ Console (${e(t).length??""})`)),D("click",G,L),o(z,G)};b(Y,z=>{e(v)||z(F)})}var ie=a(Y,2);{var te=z=>{var G=Vr();let R;var I=l(G),H=l(I),Te=l(H);s(H);var Je=a(H,2),X=l(Je),Pe=l(X,!0);s(X);var ue=a(X,2),xe=a(ue,2);s(Je),s(I);var Me=a(I,2);{var T=P=>{var w=Kr(),K=l(w);{var g=q=>{var Ae=zr();o(q,Ae)},M=q=>{var Ae=gt(),Le=Se(Ae);kt(Le,1,()=>e(t),Lt,(pe,ne)=>{var Be=Wr(),He=l(Be),ot=l(He,!0);s(He);var mt=a(He,2),vt=l(mt);s(mt);var Ke=a(mt,2),xt=l(Ke,!0);s(Ke),s(Be),C(y=>{At(Be,1,`log-entry ${e(ne).type??""}`,"svelte-x96uf"),$(ot,e(ne).timestamp),$(vt,`[${y??""}]`),$(xt,e(ne).message)},[()=>e(ne).type.toUpperCase()]),o(pe,Be)}),o(q,Ae)};b(K,q=>{e(t).length===0?q(g):q(M,!1)})}s(w),o(P,w)};b(Me,P=>{e(u)||P(T)})}s(G),C(()=>{R=At(G,1,"console-panel svelte-x96uf",null,R,{minimized:e(u)}),$(Te,`üêõ Console Logs (${e(t).length??""})`),$(Pe,e(u)?"‚ñ≤":"‚ñº")}),D("click",X,h),D("click",ue,m),D("click",xe,L),o(z,G)};b(ie,z=>{e(v)&&z(te)})}s(_),o(i,_),Gt()}var Qr=f('<link rel="icon" type="image/png" href="favicon4.png"/> <meta name="viewport" content="width=device-width, initial-scale=1"/>',1),Xr=f('<span class="character-name svelte-1uha8ag"> </span>'),Zr=f("<span> </span>"),eo=f('<div class="spell-slots-header svelte-1uha8ag"></div>'),to=f("<span> </span><br/>",1),ao=f("<span> </span><br/>",1),so=f("<span> </span><br/>",1),lo=f("<span> </span><br/>",1),io=f("<span> </span><br/>",1),no=f("<span> </span><br/>",1),ro=f("<br/><em> <!>)</em>",1),oo=f("<br/><em>(requires reaction)</em>",1),co=f('<div class="ability-detail"><strong> </strong> <!></div>'),vo=f('<div class="abilities-section"><strong>Abilities:</strong><br/> <!></div>'),uo=f('<span class="effect-tooltip"><strong> </strong><br/> <br/> <!> <!> <!> <!> <!> <!> <!></span>'),fo=f('<button class="effect-remove-btn svelte-1uha8ag">√ó</button>'),po=f('<span class="effect-badge svelte-1uha8ag" tabindex="0"> <!> <!></span>'),mo=f(`<div class="active-effects-header svelte-1uha8ag"></div> <style>.effect-badge {
              position: relative;
            }
            .effect-tooltip {
              position: absolute;
              top: 120%;
              left: 50%;
              transform: translateX(-50%);
              background: #fff;
              color: #222;
              border: 1px solid #a5b4fc;
              border-radius: 6px;
              padding: 8px 12px;
              font-size: 0.95em;
              box-shadow: 0 2px 8px rgba(0, 0, 0, 0.12);
              z-index: 10;
              min-width: 180px;
              max-width: 300px;
              white-space: normal;
              pointer-events: none;
              opacity: 1;
              transition: opacity 0.15s;
            }

            .abilities-section {
              margin-top: 8px;
              padding-top: 8px;
              border-top: 1px solid #e5e7eb;
            }

            .ability-detail {
              margin-top: 6px;
              padding: 4px;
              background: #f9fafb;
              border-radius: 4px;
              font-size: 0.9em;
            }

            .ability-detail strong {
              color: #6366f1;
            }

            .ability-detail em {
              font-size: 0.85em;
              color: #6b7280;
            }</style>`,1),go=f('<div class="rest-menu svelte-1uha8ag"><button class="rest-option svelte-1uha8ag">‚òï Short Rest</button> <button class="rest-option svelte-1uha8ag">üõèÔ∏è Long Rest</button></div>'),bo=f('<div class="container svelte-1uha8ag"><header class="svelte-1uha8ag"><div class="header-top svelte-1uha8ag"><div class="header-title svelte-1uha8ag"><div class="title-row svelte-1uha8ag"><h1 class="svelte-1uha8ag">D&D Character Sheet</h1> <!></div> <!> <!></div> <div class="header-right svelte-1uha8ag"><div class="header-controls svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">üé≤</span><span class="btn-text svelte-1uha8ag">Roll Dice</span></button> <div class="rest-button-container svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">üò¥</span><span class="btn-text svelte-1uha8ag">Rest</span></button> <!></div> <button class="btn btn-secondary use-enabled" title="Add custom condition with effects"><span class="btn-icon svelte-1uha8ag">‚ú®</span><span class="btn-text svelte-1uha8ag">Add Condition</span></button> <div class="mode-toggle"><button><span class="btn-icon svelte-1uha8ag"> </span><span class="btn-text svelte-1uha8ag"> </span></button></div></div> <div class="header-search svelte-1uha8ag"><input type="text" placeholder="üîç Search..." class="search-input use-enabled svelte-1uha8ag"/></div></div></div> <div class="header-actions svelte-1uha8ag"><button class="btn btn-mode svelte-1uha8ag">üìö Browse Spells & Feats</button> <button class="btn btn-secondary">Save to Gist</button> <button class="btn btn-secondary">Load from Gist</button> <button class="btn btn-secondary">Export JSON</button> <button class="btn btn-secondary">Import JSON</button> <input type="file" accept=".json" style="display: none;"/></div></header> <main class="svelte-1uha8ag"><!> <!> <!> <!> <!> <!> <!> <!></main></div> <!> <!> <!> <!> <!> <!>',1);function Co(i,c){Ot(c,!1);const t=()=>pt(de,"$character",p),v=()=>pt(ha,"$isEditMode",p),u=()=>pt(ga,"$searchFilter",p),[p,m]=na();function L(){const B=[],Ge=t().classFeatures.spellSlotsByLevel||{};for(let ae=1;ae<=9;ae++){const Ie=Ge[ae];if(Ie&&Ie.length>0){const A=Ie.length,bt=Ie.filter(ht=>ht).length;B.push({level:ae,available:A-bt,total:A})}}return B}let h=k(!1),_=k(!1),Y=k(!1),F=k(!1),ie=k("save"),te=k(void 0),z=k(""),G=k(""),R=k(""),I=k(!1),H=k([]),Te=k("other"),Je=k(),X=!1,Pe=1,ue=k(!1),xe=k(null);function Me(B){r(xe,B)}function T(){r(xe,null)}function P(B){r(xe,e(xe)===B?null:B)}function w(B){de.update(Ge=>(Ge.activeStates||(Ge.activeStates=[]),Ge.activeStates=[...Ge.activeStates,B],Ge)),r(F,!1),Mt.add(`Added condition: ${B.name}`,"success")}function K(){r(F,!1)}function g(){const B=[];de.update(A=>{const bt=A.hitDice.current;A.hitDice.current=Math.min(A.hitDice.max,A.hitDice.current+Math.max(1,Math.floor(A.hitDice.max/2)));const ht=A.hitDice.current-bt;if(ht>0&&B.push(`${ht} hit ${ht===1?"die":"dice"}`),A.class){const ft=Ca(A.class,A.level,A.subclass);A.classFeatures.features||(A.classFeatures.features={}),ft.forEach(ye=>{if(ye.resetOn==="short"){const st=ye.name.replace(/\s+/g,"");if(ye.type==="uses"){const Xe=typeof ye.maxUses=="function"?ye.maxUses(A.level):ye.maxUses;A.classFeatures.features[st]=Array(Xe).fill(!1),B.push(ye.name)}else if(ye.type==="pool"){const Xe=typeof ye.maxPool=="function"?ye.maxPool(A.level):ye.maxPool;Xe!==void 0&&(A.classFeatures.features[st]=Xe,B.push(ye.name))}}})}return A.activeStates&&A.activeStates.forEach(ft=>{ft.abilities&&ft.abilities.forEach(ye=>{if(ye.restType==="short"&&ye.usesPerRest){const st=ye.usesPerRest-(ye.currentUses||0)>0;ye.currentUses=ye.usesPerRest,st&&B.push(`${ft.name}: ${ye.name}`)}})}),A}),fs("short"),ps(t().race,t().level).some(A=>A.restType==="short"&&A.usesPerRest)&&B.push("racial traits"),r(ue,!1);const Ie=B.length>0?`Short rest taken! Restored: ${B.join(", ")}`:"Short rest taken!";Mt.add(Ie,"success")}function M(){const B=[];de.update(A=>{const bt=A.maxHP-A.currentHP;bt>0&&B.push(`${bt} HP`),A.currentHP=A.maxHP,A.tempHP=0;const ht=A.hitDice.max-A.hitDice.current;ht>0&&B.push(`${ht} hit ${ht===1?"die":"dice"}`),A.hitDice.current=A.hitDice.max;let ft=0;if(A.classFeatures.spellSlotsByLevel&&Object.keys(A.classFeatures.spellSlotsByLevel).forEach(ye=>{const st=A.classFeatures.spellSlotsByLevel[parseInt(ye)];if(st){const Xe=st.filter(Bt=>Bt).length;ft+=Xe,A.classFeatures.spellSlotsByLevel[parseInt(ye)]=Array(st.length).fill(!1)}}),ft>0&&B.push(`${ft} spell ${ft===1?"slot":"slots"}`),A.class){const ye=Ca(A.class,A.level,A.subclass);A.classFeatures.features||(A.classFeatures.features={});let st=!1;ye.forEach(Xe=>{const Bt=Xe.name.replace(/\s+/g,"");if(!(Xe.type==="info"||Xe.type==="channelDivinity")){if(Xe.type==="uses"){const yt=typeof Xe.maxUses=="function"?Xe.maxUses(A.level):Xe.maxUses;A.classFeatures.features[Bt]=Array(yt).fill(!1),st=!0}else if(Xe.type==="pool"){const yt=typeof Xe.maxPool=="function"?Xe.maxPool(A.level):Xe.maxPool;yt!==void 0&&(A.classFeatures.features[Bt]=yt,st=!0)}}}),st&&B.push("all class features")}if(A.activeStates){let ye=!1;A.activeStates.forEach(st=>{st.abilities&&st.abilities.forEach(Xe=>{if(Xe.usesPerRest){const Bt=(Xe.currentUses||0)<Xe.usesPerRest;Xe.currentUses=Xe.usesPerRest,Bt&&(ye=!0)}})}),ye&&B.push("condition abilities")}return A}),fs("long"),ps(t().race,t().level).some(A=>A.usesPerRest)&&B.push("racial traits"),r(ue,!1);const Ie=B.length>0?`Long rest taken! Restored: ${B.join(", ")}`:"Long rest taken! Fully rested.";Mt.add(Ie,"success")}function q(B){r(z,""),r(G,""),r(R,""),r(I,!1),r(H,[]),r(Te,"other"),X=!1,typeof B=="string"?r(z,B):(r(z,B.notation),r(G,B.damageNotation||""),r(R,B.attackName||""),r(I,!!B.applyHalfDamage),r(H,B.bonusBreakdown||[]),r(Te,B.rollType||"other")),r(h,!0)}function Ae(B){const{notation:Ge,count:ae,bonusBreakdown:Ie}=B.detail;r(z,""),X=!0,Pe=ae||1,setTimeout(()=>{r(z,Ge),r(G,""),r(R,"Hit Die"),r(H,Ie||[]),r(Te,"other")},0),r(h,!0)}function Le(){if(r(h,!1),X&&e(Je)){const B=e(Je).getLastRollTotal();if(B!==null){const Ge=Math.max(1,B);de.update(ae=>(ae.hitDice.current=Math.max(0,ae.hitDice.current-Pe),ae.currentHP=Math.min(ae.maxHP,ae.currentHP+Ge),ae))}X=!1}}function pe(){ha.update(B=>!B)}function ne(B){B.target.closest(".rest-button-container")||r(ue,!1)}$a(()=>{const B=ha.subscribe(Ge=>{Ge?document.body.classList.remove("use-mode"):document.body.classList.add("use-mode")});return document.addEventListener("click",ne),()=>{B(),document.removeEventListener("click",ne)}});function Be(){rl(t())}function He(){e(te)?.click()}async function ot(B){const ae=B.target.files?.[0];if(ae)try{const Ie=await ol(ae);de.set(Ie),alert("Character imported successfully!")}catch{alert("Failed to import character file")}}Nt();var mt=bo();il("1uha8ag",B=>{var Ge=Qr();Qt(2),Ds(()=>{el.title="D&D Character Sheet"}),o(B,Ge)});var vt=Se(mt),Ke=l(vt),xt=l(Ke),y=l(xt),N=l(y),ce=a(l(N),2);{var x=B=>{var Ge=Xr(),ae=l(Ge);s(Ge),C(()=>$(ae,`${t().name??""} (${t().level??""})`)),o(B,Ge)};b(ce,B=>{t().name&&B(x)})}s(N);var E=a(N,2);{var Z=B=>{var Ge=eo();kt(Ge,5,L,Lt,(ae,Ie)=>{var A=Zr();let bt;var ht=l(A);s(A),C(()=>{bt=At(A,1,"slot-badge svelte-1uha8ag",null,bt,{depleted:e(Ie).available===0}),$(ht,`Lv${e(Ie).level??""}: ${e(Ie).available??""}/${e(Ie).total??""}`)}),o(ae,A)}),s(Ge),o(B,Ge)};b(E,B=>{L().length>0&&B(Z)})}var fe=a(E,2);{var je=B=>{var Ge=mo(),ae=Se(Ge);kt(ae,5,()=>t().activeStates,Lt,(Ie,A,bt)=>{var ht=po(),ft=l(ht),ye=a(ft);{var st=yt=>{var _t=uo(),dt=l(_t),Jt=l(dt,!0);s(dt);var ra=a(dt,2),ta=a(ra,3);{var Zt=ct=>{var wt=to(),St=Se(wt),Pt=l(St);s(St),Qt(),C(()=>$(Pt,`Attack Bonus: ${typeof e(A).attackBonus=="number"&&e(A).attackBonus>0?"+":""}${e(A).attackBonus??""}`)),o(ct,wt)};b(ta,ct=>{e(A).attackBonus&&ct(Zt)})}var aa=a(ta,2);{var Rt=ct=>{var wt=ao(),St=Se(wt),Pt=l(St);s(St),Qt(),C(()=>$(Pt,`Damage Bonus: ${typeof e(A).damageBonus=="number"&&e(A).damageBonus>0?"+":""}${e(A).damageBonus??""}`)),o(ct,wt)};b(aa,ct=>{e(A).damageBonus&&ct(Rt)})}var Ft=a(aa,2);{var qt=ct=>{var wt=so(),St=Se(wt),Pt=l(St);s(St),Qt(),C(()=>$(Pt,`AC Bonus: ${e(A).acBonus>0?"+":""}${e(A).acBonus??""}`)),o(ct,wt)};b(Ft,ct=>{e(A).acBonus&&ct(qt)})}var sa=a(Ft,2);{var oa=ct=>{var wt=lo(),St=Se(wt),Pt=l(St);s(St),Qt(),C(()=>$(Pt,`Darkvision: ${e(A).darkvision??""} feet`)),o(ct,wt)};b(sa,ct=>{e(A).darkvision&&ct(oa)})}var ua=a(sa,2);{var Yt=ct=>{var wt=io(),St=Se(wt),Pt=l(St);s(St),Qt(),C(Ct=>$(Pt,`Resistances: ${Ct??""}`),[()=>e(A).resistances.join(", ")]),o(ct,wt)};b(ua,ct=>{e(A).resistances&&e(A).resistances.length>0&&ct(Yt)})}var Et=a(ua,2);{var Kt=ct=>{var wt=no(),St=Se(wt),Pt=l(St);s(St),Qt(),C(Ct=>$(Pt,`Immunities: ${Ct??""}`),[()=>e(A).immunities.join(", ")]),o(ct,wt)};b(Et,ct=>{e(A).immunities&&e(A).immunities.length>0&&ct(Kt)})}var ea=a(Et,2);{var jt=ct=>{var wt=vo(),St=a(l(wt),3);kt(St,1,()=>e(A).abilities,Lt,(Pt,Ct)=>{var Vt=co(),zt=l(Vt),ca=l(zt);s(zt);var fa=a(zt),Ht=a(fa);{var Wt=la=>{var xa=ro(),Fa=a(Se(xa)),Pa=l(Fa),Da=a(Pa);{var Wa=Ka=>{var Fs=Tt(", requires reaction");o(Ka,Fs)};b(Da,Ka=>{e(Ct).requiresReaction&&Ka(Wa)})}Qt(),s(Fa),C(()=>$(Pa,`(${(e(Ct).currentUses||0)??""}/${e(Ct).usesPerRest??""} uses per ${e(Ct).restType??""}
                                rest`)),o(la,xa)},va=la=>{var xa=gt(),Fa=Se(xa);{var Pa=Da=>{var Wa=oo();Qt(),o(Da,Wa)};b(Fa,Da=>{e(Ct).requiresReaction&&Da(Pa)},!0)}o(la,xa)};b(Ht,la=>{e(Ct).usesPerRest?la(Wt):la(va,!1)})}s(Vt),C(()=>{$(ca,`${e(Ct).name??""}:`),$(fa,` ${e(Ct).description??""} `)}),o(Pt,Vt)}),s(wt),o(ct,wt)};b(ea,ct=>{e(A).abilities&&e(A).abilities.length>0&&ct(jt)})}s(_t),C(()=>{$(Jt,e(A).name),$(ra,` ${e(A).description??""}`)}),o(yt,_t)};b(ye,yt=>{e(xe)===bt&&yt(st)})}var Xe=a(ye,2);{var Bt=yt=>{var _t=fo();C(()=>tt(_t,"title",`End ${e(A).name??""}`)),D("click",_t,()=>{de.update(dt=>{if(dt.activeStates){const Jt=dt.activeStates[bt];Jt?.hpBonus&&Jt.target!=="other"&&(dt.maxHP-=Jt.hpBonus,dt.currentHP=Math.max(1,Math.min(dt.currentHP-Jt.hpBonus,dt.maxHP))),dt.activeStates=dt.activeStates.filter((ra,ta)=>ta!==bt)}return dt})}),o(yt,_t)};b(Xe,yt=>{v()||yt(Bt)})}s(ht),C(()=>{tt(ht,"aria-label",e(A).name),$(ft,`‚ú® ${e(A).name??""} `)}),D("mouseenter",ht,()=>Me(bt)),D("mouseleave",ht,T),D("focus",ht,()=>Me(bt)),D("blur",ht,T),D("click",ht,()=>P(bt)),o(Ie,ht)}),s(ae),Qt(2),o(B,Ge)};b(fe,B=>{t().activeStates&&t().activeStates.length>0&&B(je)})}s(y);var Q=a(y,2),we=l(Q),V=l(we),j=a(V,2),he=l(j),Ve=a(he,2);{var Oe=B=>{var Ge=go(),ae=l(Ge),Ie=a(ae,2);s(Ge),D("click",ae,g),D("click",Ie,M),o(B,Ge)};b(Ve,B=>{e(ue)&&B(Oe)})}s(j);var lt=a(j,2),Fe=a(lt,2),d=l(Fe);let me;var $e=l(d),ee=l($e,!0);s($e);var ke=a($e),_e=l(ke,!0);s(ke),s(d),s(Fe),s(we);var De=a(we,2),re=l(De);Ce(re),s(De),s(Q),s(xt);var Ee=a(xt,2),be=l(Ee),Ue=a(be,2),ze=a(Ue,2),et=a(ze,2),it=a(et,2),ve=a(it,2);Ra(ve,B=>r(te,B),()=>e(te)),s(Ee),s(Ke);var S=a(Ke,2),U=l(S);Dl(U,{});var J=a(U,2);Bl(J,{$$events:{roll:B=>q(B.detail)}});var se=a(J,2);Xl(se,{$$events:{roll:B=>q(B.detail)}});var ge=a(se,2);Vl(ge,{$$events:{rollHitDice:Ae}});var Re=a(ge,2);Gr(Re,{});var Qe=a(Re,2);an(Qe,{$$events:{roll:B=>q(B.detail)}});var qe=a(Qe,2);wn(qe,{});var ut=a(qe,2);Sn(ut,{}),s(S),s(vt);var We=a(vt,2);Ra(zn(We,{get notation(){return e(z)},get damageNotation(){return e(G)},get attackName(){return e(R)},get applyHalfDamage(){return e(I)},get bonusBreakdown(){return e(H)},get rollType(){return e(Te)},get visible(){return e(h)},$$events:{close:Le},$$legacy:!0}),B=>r(Je,B),()=>e(Je));var O=a(We,2);{var le=B=>{dr(B,{get mode(){return e(ie)},$$events:{close:()=>r(_,!1)}})};b(O,B=>{e(_)&&B(le)})}var nt=a(O,2);{var Ye=B=>{Dr(B,{onClose:()=>r(Y,!1)})};b(nt,B=>{e(Y)&&B(Ye)})}var at=a(nt,2);Fr(at,{get show(){return e(F)},onSave:w,onCancel:K});var rt=a(at,2);nl(rt,{});var oe=a(rt,2);Yr(oe,{}),C(()=>{me=At(d,1,"btn btn-mode svelte-1uha8ag",null,me,{"use-mode":!v()}),$(ee,v()?"üìù":"üé≤"),$(_e,v()?"Edit Mode":"Use Mode")}),D("click",V,()=>{r(H,[]),r(h,!0)}),D("click",he,()=>r(ue,!e(ue))),D("click",lt,()=>r(F,!0)),D("click",d,pe),Ne(re,u,B=>cl(ga,B)),D("click",be,()=>r(Y,!0)),D("click",Ue,()=>{r(ie,"save"),r(_,!0)}),D("click",ze,()=>{r(ie,"load"),r(_,!0)}),D("click",et,Be),D("click",it,He),D("change",ve,ot),o(i,mt),Gt(),m()}export{Co as component};
