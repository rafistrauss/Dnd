import{d as gs,g as Ns,f as d,e as R,a as o,s as S,c as bt,t as Pt}from"../chunks/BESELRjb.js";import{i as zt}from"../chunks/JMgyEzd3.js";import{c as $a,o as wa,a as Os,b as Gs}from"../chunks/CtPH092J.js";import{F as L,T as ha,Y as ns,j as qs,aZ as zs,U as bs,ag as Ws,aD as Ks,aK as Vs,aE as Js,a1 as Ys,av as Oa,a7 as us,i as As,a_ as Qs,a$ as Rs,b0 as Ya,K as ya,e as Bs,b1 as Ts,b2 as Xs,b3 as Zs,b4 as el,q as os,b5 as tl,b6 as al,ab as sl,d as i,r as fs,g as ll,C as Wt,G as Kt,H as l,I as s,J as a,b7 as Ye,b8 as pa,s as n,a4 as C,f as e,m as Ct,E as we,b9 as qt,ao as ta,A as N,ba,bb as ja,bc as rl}from"../chunks/DyJ43TGI.js";import{t as il,c as aa,a as de,e as $t,i as jt,u as Ms,s as _a,b as Mt,d as Qa,f as xa,g as Va,j as nl,k as Ut,l as ol,m as hs,n as es,h as cl,T as vl,o as dl,p as ul,r as _s,q as ys}from"../chunks/DXf4DosC.js";import{i as g,s as ca,a as ut,b as Ot,d as Fa,e as fl}from"../chunks/CCL4udNy.js";import{p as At,b as Ua}from"../chunks/iXw84bXb.js";import{b as Pa,r as pl}from"../chunks/YNcUz3Hz.js";function ml(r,c,t=!1,v=!1,f=!1){var p=r,m="";L(()=>{var w=qs;if(m===(m=c()??"")){ha&&ns();return}if(w.nodes_start!==null&&(zs(w.nodes_start,w.nodes_end),w.nodes_start=w.nodes_end=null),m!==""){if(ha){bs.data;for(var y=ns(),h=y;y!==null&&(y.nodeType!==Ws||y.data!=="");)h=y,y=Ks(y);if(y===null)throw Vs(),Js;gs(bs,h),p=Ys(y);return}var W=m+"";t?W=`<svg>${W}</svg>`:v&&(W=`<math>${W}</math>`);var P=Ns(W);if((t||v)&&(P=Oa(P)),gs(Oa(P),P.lastChild),t||v)for(;Oa(P);)p.before(Oa(P));else p.before(P)}})}function gl(r,c,t,v,f){ha&&ns();var p=c.$$slots?.[t],m=!1;p===!0&&(p=c[t],m=!0),p===void 0?f!==null&&f(r):p(r,m?()=>v:v)}function bl(r,c,t,v){var f=r.__style;if(ha||f!==c){var p=il(c);(!ha||p!==r.getAttribute("style"))&&(p==null?r.removeAttribute("style"):r.style.cssText=p),r.__style=c}return v}function Ja(r,c,t=!1){if(r.multiple){if(c==null)return;if(!As(c))return Qs();for(var v of r.options)v.selected=c.includes(Ia(v));return}for(v of r.options){var f=Ia(v);if(Rs(f,c)){v.selected=!0;return}}(!t||c!==void 0)&&(r.selectedIndex=-1)}function cs(r){var c=new MutationObserver(()=>{Ja(r,r.__value)});c.observe(r,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),us(()=>{c.disconnect()})}function Ha(r,c,t=c){var v=new WeakSet,f=!0;Ya(r,"change",p=>{var m=p?"[selected]":":checked",w;if(r.multiple)w=[].map.call(r.querySelectorAll(m),Ia);else{var y=r.querySelector(m)??r.querySelector("option:not([disabled])");w=y&&Ia(y)}t(w),ya!==null&&v.add(ya)}),Bs(()=>{var p=c();if(r===document.activeElement){var m=Ts??ya;if(v.has(m))return}if(Ja(r,p,f),f&&p===void 0){var w=r.querySelector(":checked");w!==null&&(p=Ia(w),t(p))}r.__value=p,f=!1}),cs(r)}function Ia(r){return"__value"in r?r.__value:r.value}const hl=Symbol("is custom element"),_l=Symbol("is html");function Ce(r){if(ha){var c=!1,t=()=>{if(!c){if(c=!0,r.hasAttribute("value")){var v=r.value;et(r,"value",null),r.value=v}if(r.hasAttribute("checked")){var f=r.checked;et(r,"checked",null),r.checked=f}}};r.__on_r=t,os(t),tl()}}function Ea(r,c){var t=ps(r);t.value===(t.value=c??void 0)||r.value===c&&(c!==0||r.nodeName!=="PROGRESS")||(r.value=c??"")}function Fs(r,c){var t=ps(r);t.checked!==(t.checked=c??void 0)&&(r.checked=c)}function et(r,c,t,v){var f=ps(r);ha&&(f[c]=r.getAttribute(c),c==="src"||c==="srcset"||c==="href"&&r.nodeName==="LINK")||f[c]!==(f[c]=t)&&(c==="loading"&&(r[Xs]=t),t==null?r.removeAttribute(c):typeof t!="string"&&yl(r).includes(c)?r[c]=t:r.setAttribute(c,t))}function ps(r){return r.__attributes??={[hl]:r.nodeName.includes("-"),[_l]:r.namespaceURI===Zs}}var xs=new Map;function yl(r){var c=r.getAttribute("is")||r.nodeName,t=xs.get(c);if(t)return t;xs.set(c,t=[]);for(var v,f=r,p=Element.prototype;p!==f;){v=al(f);for(var m in v)v[m].set&&t.push(m);f=el(f)}return t}function Ne(r,c,t=c){var v=new WeakSet;Ya(r,"input",async f=>{var p=f?r.defaultValue:r.value;if(p=as(r)?ss(p):p,t(p),ya!==null&&v.add(ya),await sl(),p!==(p=c())){var m=r.selectionStart,w=r.selectionEnd,y=r.value.length;if(r.value=p??"",w!==null){var h=r.value.length;m===w&&w===y&&h>y?(r.selectionStart=h,r.selectionEnd=h):(r.selectionStart=m,r.selectionEnd=Math.min(w,h))}}}),(ha&&r.defaultValue!==r.value||i(c)==null&&r.value)&&(t(as(r)?ss(r.value):r.value),ya!==null&&v.add(ya)),fs(()=>{var f=c();if(r===document.activeElement){var p=Ts??ya;if(v.has(p))return}as(r)&&f===ss(r.value)||r.type==="date"&&!f&&!r.value||f!==r.value&&(r.value=f??"")})}const ts=new Set;function $s(r,c,t,v,f=v){var p=t.getAttribute("type")==="checkbox",m=r;let w=!1;if(c!==null)for(var y of c)m=m[y]??=[];m.push(t),Ya(t,"change",()=>{var h=t.__value;p&&(h=ws(m,h,t.checked)),f(h)},()=>f(p?[]:null)),fs(()=>{var h=v();if(ha&&t.defaultChecked!==t.checked){w=!0;return}p?(h=h||[],t.checked=h.includes(t.__value)):t.checked=Rs(t.__value,h)}),us(()=>{var h=m.indexOf(t);h!==-1&&m.splice(h,1)}),ts.has(m)||(ts.add(m),os(()=>{m.sort((h,W)=>h.compareDocumentPosition(W)===4?-1:1),ts.delete(m)})),os(()=>{if(w){var h;if(p)h=ws(m,h,t.checked);else{var W=m.find(P=>P.checked);h=W?.__value}f(h)}})}function La(r,c,t=c){Ya(r,"change",v=>{var f=v?r.defaultChecked:r.checked;t(f)}),(ha&&r.defaultChecked!==r.checked||i(c)==null)&&t(r.checked),fs(()=>{var v=c();r.checked=!!v})}function ws(r,c,t){for(var v=new Set,f=0;f<r.length;f+=1)r[f].checked&&v.add(r[f].__value);return t||v.delete(c),Array.from(v)}function as(r){var c=r.type;return c==="number"||c==="range"}function ss(r){return r===""?null:+r}function xl(r,c,t){var v=ll(r,c);v&&v.set&&(r[c]=t,us(()=>{r[c]=null}))}function ms(r){return function(...c){var t=c[0];return t.stopPropagation(),r?.apply(this,c)}}function Aa(r,c){var t=r.$$events?.[c.type],v=As(t)?t.slice():t==null?[]:[t];for(var f of v)f.call(this,c)}const $l="";function Ps(...r){return Pa+$l+pl(r[0],r[1])}const vs={paladin:{name:"Paladin",hitDice:"d10",spellcaster:!0,spellcastingAbility:"charisma",spellSlotsByLevel:{1:0,2:2,3:3,4:3,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Divine Sense",type:"uses",maxUses:(r,c=1)=>1+Math.max(1,c),resetOn:"long",description:"Detect celestials, fiends, and undead within 60 feet",minLevel:1},{name:"Lay on Hands",type:"pool",maxPool:r=>r*5,resetOn:"long",description:"Heal wounds or cure disease",minLevel:1},{name:"Divine Smite",type:"spellSlot",description:"Expend spell slot to deal extra radiant damage",minLevel:2,rollable:!0},{name:"Channel Divinity",type:"pool",maxPool:r=>r>=18?3:r>=6?2:1,resetOn:"short",description:"Sacred Weapon or Turn Undead",minLevel:3}]},fighter:{name:"Fighter",hitDice:"d10",spellcaster:!1,features:[{name:"Second Wind",type:"uses",maxUses:1,resetOn:"short",description:"Regain 1d10 + fighter level HP as bonus action",minLevel:1,rollable:!0,rollFormula:r=>`1d10+${r}`},{name:"Action Surge",type:"uses",maxUses:r=>r>=17?2:1,resetOn:"short",description:"Take one additional action on your turn",minLevel:2},{name:"Indomitable",type:"uses",maxUses:r=>r>=17?3:r>=13?2:1,resetOn:"long",description:"Reroll a failed saving throw",minLevel:9}],subclasses:{champion:{name:"Champion",features:[{name:"Improved Critical",type:"info",description:"Critical hit on 19-20",minLevel:3},{name:"Remarkable Athlete",type:"info",description:"Add half proficiency to STR/DEX/CON checks, increase long jump distance",minLevel:7},{name:"Additional Fighting Style",type:"info",description:"Choose a second fighting style",minLevel:10},{name:"Superior Critical",type:"info",description:"Critical hit on 18-20",minLevel:15},{name:"Survivor",type:"info",description:"Regain 5 + CON mod HP at start of turn if below half HP",minLevel:18}]},battlemaster:{name:"Battle Master",features:[{name:"Combat Superiority",type:"uses",maxUses:r=>r>=15?6:r>=7?5:4,resetOn:"short",description:r=>`Use superiority dice (${r>=18?"d12":r>=10?"d10":"d8"}) for maneuvers`,minLevel:3},{name:"Know Your Enemy",type:"info",description:"Learn capabilities of creatures you observe",minLevel:7},{name:"Improved Combat Superiority",type:"info",description:"Superiority dice become d10",minLevel:10},{name:"Relentless",type:"info",description:"Regain 1 superiority die if you have none at start of turn",minLevel:15}]}}},rogue:{name:"Rogue",hitDice:"d8",spellcaster:!1,features:[{name:"Sneak Attack",type:"info",description:r=>`Deal ${Math.ceil(r/2)}d6 extra damage once per turn with advantage or ally nearby`,minLevel:1,rollable:!0,rollFormula:r=>`${Math.ceil(r/2)}d6`},{name:"Cunning Action",type:"info",description:"Dash, Disengage, or Hide as a bonus action",minLevel:2},{name:"Uncanny Dodge",type:"info",description:"Use reaction to halve damage from an attack",minLevel:5},{name:"Evasion",type:"info",description:"Take no damage on successful Dex save (half on fail)",minLevel:7}]},wizard:{name:"Wizard",hitDice:"d6",spellcaster:!0,spellcastingAbility:"intelligence",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Arcane Recovery",type:"uses",maxUses:1,resetOn:"long",description:r=>`Recover spell slots totaling up to ${Math.ceil(r/2)} levels during short rest`,minLevel:1},{name:"Spell Mastery",type:"info",description:"Cast one 1st-level and one 2nd-level spell at will",minLevel:18}]},cleric:{name:"Cleric",hitDice:"d8",spellcaster:!0,spellcastingAbility:"wisdom",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Channel Divinity",type:"pool",maxPool:r=>r>=18?3:r>=6?2:1,resetOn:"short",description:"Turn Undead or domain-specific ability",minLevel:2},{name:"Destroy Undead",type:"info",description:r=>`Channel Divinity destroys undead of CR ${r>=17?4:r>=14?3:r>=11?2:r>=8?1:.5} or lower`,minLevel:5},{name:"Divine Intervention",type:"uses",maxUses:1,resetOn:"long",description:r=>`${r}% chance to succeed, implore deity for aid`,minLevel:10}],subclasses:{war:{name:"War Domain",features:[{name:"War Priest",type:"uses",maxUses:(r,c=1)=>Math.max(1,c),resetOn:"long",description:"Make one weapon attack as a bonus action",minLevel:1},{name:"Guided Strike",type:"channelDivinity",description:"Use your Channel Divinity to gain +10 to an attack roll. Make this choice after you see the roll, but before the DM says whether the attack hits or misses.",minLevel:2,resetOn:"short"},{name:"War God's Blessing",type:"channelDivinity",description:"Use reaction to grant +10 to an ally's attack roll within 30 feet. Consumes one use of Channel Divinity.",minLevel:6,resetOn:"short"},{name:"Divine Strike",type:"info",description:r=>`Deal extra ${r>=14?"2d8":"1d8"} weapon damage once per turn`,minLevel:8,rollable:!0,rollFormula:r=>r>=14?"2d8":"1d8"},{name:"Avatar of Battle",type:"info",description:"Gain resistance to nonmagical weapon damage",minLevel:17}]},life:{name:"Life Domain",features:[{name:"Disciple of Life",type:"info",description:"Healing spells restore additional 2 + spell level HP",minLevel:1},{name:"Preserve Life",type:"pool",maxPool:r=>r*5,resetOn:"short",description:"Restore HP to creatures within 30 feet",minLevel:2},{name:"Blessed Healer",type:"info",description:"Regain 2 + spell level HP when you cast healing spell",minLevel:6},{name:"Divine Strike",type:"info",description:r=>`Deal extra ${r>=14?"2d8":"1d8"} radiant damage once per turn`,minLevel:8,rollable:!0,rollFormula:r=>r>=14?"2d8":"1d8"},{name:"Supreme Healing",type:"info",description:"Maximize healing dice instead of rolling",minLevel:17}]}}},barbarian:{name:"Barbarian",hitDice:"d12",spellcaster:!1,features:[{name:"Rage",type:"uses",maxUses:r=>r>=20?1/0:r>=17?6:r>=12?5:r>=6?4:r>=3?3:2,resetOn:"long",description:r=>`+${r>=16?4:r>=9?3:2} damage, resistance to physical damage`,minLevel:1},{name:"Reckless Attack",type:"info",description:"Gain advantage on melee attacks, enemies get advantage on you",minLevel:2},{name:"Danger Sense",type:"info",description:"Advantage on Dex saves against effects you can see",minLevel:2}],subclasses:{berserker:{name:"Path of the Berserker",features:[{name:"Frenzy",type:"info",description:"While raging, make melee attack as bonus action (gain 1 exhaustion after rage)",minLevel:3},{name:"Mindless Rage",type:"info",description:"Cannot be charmed or frightened while raging",minLevel:6},{name:"Intimidating Presence",type:"info",description:"Use action to frighten creature within 30 feet",minLevel:10},{name:"Retaliation",type:"info",description:"When damaged by creature within 5 feet, make melee attack as reaction",minLevel:14}]}}}};function oa(r){const c=r.toLowerCase();return vs[c]||null}function Ra(r,c,t){const v=oa(r);if(!v)return[];const f=v.features.filter(p=>!p.minLevel||p.minLevel<=c);if(t&&v.subclasses&&v.subclasses[t]){const p=v.subclasses[t].features.filter(m=>!m.minLevel||m.minLevel<=c);return[...f,...p]}return f}function Ss(r){const c=oa(r);return!c||!c.subclasses?[]:Object.keys(c.subclasses).map(t=>({id:t,name:c.subclasses[t].name}))}function ks(r,c){const t=oa(r);return!t||!t.spellcaster||!t.spellSlotsByLevel?0:t.spellSlotsByLevel[c]||0}function Cs(r,c,t){const v=oa(r);return!v||!v.spellcaster?0:Math.max(1,t+c)}function wl(r,c,t){const v=oa(r);return!v||!v.spellcaster?null:8+c+t}function Sl(){return Object.keys(vs).map(r=>({id:r,name:vs[r].name}))}var kl=d('<div class="section-header svelte-ls99y2" role="button" tabindex="0"><h2 class="svelte-ls99y2"> </h2> <span class="collapse-btn svelte-ls99y2"> </span></div>');function Sa(r,c){Wt(c,!1);let t=At(c,"title",8),v=At(c,"collapsed",8),f=At(c,"ariaLabel",8,""),p=At(c,"onToggle",8);zt();var m=kl(),w=l(m),y=l(w,!0);s(w);var h=a(w,2),W=l(h,!0);s(h),s(m),L(()=>{et(m,"aria-expanded",!v()),et(m,"aria-label",f()),S(y,t()),S(W,v()?"‚ñº":"‚ñ≤")}),R("click",m,function(...P){p()?.apply(this,P)}),R("keydown",m,P=>{(P.key==="Enter"||P.key===" ")&&p()()}),o(r,m),Kt()}var Cl=d("<option> </option>"),Dl=d("<option> </option>"),Ll=d('<div class="form-group svelte-172i2fj"><label for="characterSubclass" class="svelte-172i2fj">Subclass</label> <select id="characterSubclass" class="svelte-172i2fj"><option>Select Subclass</option><!></select></div>'),jl=d('<div class="info-grid svelte-172i2fj"><div class="form-group svelte-172i2fj"><label for="characterName" class="svelte-172i2fj">Character Name</label> <input type="text" id="characterName" placeholder="Enter name" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterClass" class="svelte-172i2fj">Class</label> <select id="characterClass" class="svelte-172i2fj"><option>Select Class</option><!></select></div> <!> <div class="form-group svelte-172i2fj"><label for="characterLevel" class="svelte-172i2fj">Level</label> <input type="number" id="characterLevel" min="1" max="20" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterRace" class="svelte-172i2fj">Race</label> <input type="text" id="characterRace" placeholder="e.g., Human" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterBackground" class="svelte-172i2fj">Background</label> <input type="text" id="characterBackground" placeholder="e.g., Soldier" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterAlignment" class="svelte-172i2fj">Alignment</label> <input type="text" id="characterAlignment" placeholder="e.g., Lawful Good" class="svelte-172i2fj"/></div></div>'),Al=d('<section class="character-info svelte-172i2fj"><!> <!></section>');function Rl(r,c){Wt(c,!1);const t=()=>ut(de,"$character",f),v=()=>ut(aa,"$collapsedStates",f),[f,p]=ca(),m=C(),w=Sl();function y(E){const A=E.target;de.update(B=>(B.class=A.value,B.subclass="",B))}function h(E){const A=E.target;de.update(B=>(B.subclass=A.value,B))}function W(E){const A=E.target;de.update(B=>(B.level=parseInt(A.value)||1,B)),Ms()}Ye(()=>(t(),Ss),()=>{n(m,t().class?Ss(t().class):[])}),pa(),zt();var P=Al(),Q=l(P);{let E=Ct(()=>(v(),i(()=>v().characterInfo?"Expand":"Collapse")));Sa(Q,{title:"Character Info",get collapsed(){return v(),i(()=>v().characterInfo)},get ariaLabel(){return e(E)},onToggle:()=>aa.update(A=>({...A,characterInfo:!A.characterInfo}))})}var ee=a(Q,2);{var K=E=>{var A=jl(),B=l(A),F=a(l(B),2);Ce(F),s(B);var ue=a(B,2),Ue=a(l(ue),2),V=l(Ue);V.value=V.__value="";var Be=a(V);$t(Be,1,()=>w,jt,(je,me)=>{var ce=Cl(),Ae=l(ce,!0);s(ce);var qe={};L(()=>{S(Ae,(e(me),i(()=>e(me).name))),qe!==(qe=(e(me),i(()=>e(me).id)))&&(ce.value=(ce.__value=(e(me),i(()=>e(me).id)))??"")}),o(je,ce)}),s(Ue);var ve;cs(Ue),s(ue);var ge=a(ue,2);{var Le=je=>{var me=Ll(),ce=a(l(me),2),Ae=l(ce);Ae.value=Ae.__value="";var qe=a(Ae);$t(qe,1,()=>e(m),jt,(pt,it)=>{var Ve=Dl(),yt=l(Ve,!0);s(Ve);var Dt={};L(()=>{S(yt,(e(it),i(()=>e(it).name))),Dt!==(Dt=(e(it),i(()=>e(it).id)))&&(Ve.value=(Ve.__value=(e(it),i(()=>e(it).id)))??"")}),o(pt,Ve)}),s(ce);var tt;cs(ce),s(me),L(()=>{tt!==(tt=(t(),i(()=>t().subclass)))&&(ce.value=(ce.__value=(t(),i(()=>t().subclass)))??"",Ja(ce,(t(),i(()=>t().subclass))))}),R("change",ce,h),o(je,me)};g(ge,je=>{e(m),i(()=>e(m).length>0)&&je(Le)})}var T=a(ge,2),U=a(l(T),2);Ce(U),s(T);var $=a(T,2),X=a(l($),2);Ce(X),s($);var b=a($,2),I=a(l(b),2);Ce(I),s(b);var Y=a(b,2),Se=a(l(Y),2);Ce(Se),s(Y),s(A),L(()=>{ve!==(ve=(t(),i(()=>t().class)))&&(Ue.value=(Ue.__value=(t(),i(()=>t().class)))??"",Ja(Ue,(t(),i(()=>t().class)))),Ea(U,(t(),i(()=>t().level)))}),Ne(F,()=>t().name,je=>Ot(de,i(t).name=je,i(t))),R("change",Ue,y),R("change",U,W),Ne(X,()=>t().race,je=>Ot(de,i(t).race=je,i(t))),Ne(I,()=>t().background,je=>Ot(de,i(t).background=je,i(t))),Ne(Se,()=>t().alignment,je=>Ot(de,i(t).alignment=je,i(t))),o(E,A)};g(ee,E=>{v(),i(()=>!v().characterInfo)&&E(K)})}s(P),o(r,P),Kt(),p()}var Bl=d('<div class="ability-card svelte-bbv1xt"><h3 class="svelte-bbv1xt"> </h3> <input type="number" class="ability-score svelte-bbv1xt" min="1" max="30"/> <div class="ability-modifier svelte-bbv1xt"> </div> <div class="roll-buttons svelte-bbv1xt"><button class="roll-btn svelte-bbv1xt">Check</button> <button class="roll-btn svelte-bbv1xt">Save</button></div> <div class="save-proficiency svelte-bbv1xt"><input type="checkbox" class="svelte-bbv1xt"/> <label class="svelte-bbv1xt">Save Prof.</label></div></div>'),Tl=d('<div class="proficiency-bonus svelte-bbv1xt"><label for="profBonus">Proficiency Bonus</label> <input type="number" id="profBonus" class="prof-input svelte-bbv1xt"/></div> <div class="abilities-grid svelte-bbv1xt"></div>',1),Ml=d("<section><!> <!></section>");function Fl(r,c){Wt(c,!1);const t=()=>ut(Qa,"$abilityModifiers",w),v=()=>ut(de,"$character",w),f=()=>ut(_a,"$searchFilter",w),p=()=>ut(aa,"$collapsedStates",w),m=()=>ut(xa,"$isEditMode",w),[w,y]=ca(),h=C(),W=C(),P=$a(),Q=[{key:"strength",label:"Strength"},{key:"dexterity",label:"Dexterity"},{key:"constitution",label:"Constitution"},{key:"intelligence",label:"Intelligence"},{key:"wisdom",label:"Wisdom"},{key:"charisma",label:"Charisma"}];function ee(){Ms()}function K(V){const Be=t()[V],ve=`1d20${Be>=0?"+":""}${Be}`,ge=[];ge.push({value:"1d20",source:"base die"}),Be!==0&&ge.push({value:Be,source:V}),P("roll",{notation:ve,rollType:"check",bonusBreakdown:ge})}function E(V){const Be=t()[V],ve=v().saveProficiencies[V]?v().proficiencyBonus:0,ge=Be+ve,Le=`1d20${ge>=0?"+":""}${ge}`,T=[];T.push({value:"1d20",source:"base die"}),Be!==0&&T.push({value:Be,source:V}),ve!==0&&T.push({value:ve,source:"proficiency"}),P("roll",{notation:Le,rollType:"save",bonusBreakdown:T})}Ye(()=>f(),()=>{n(h,Q.filter(({label:V})=>f()?V.toLowerCase().includes(f().toLowerCase()):!0))}),Ye(()=>(e(h),f()),()=>{n(W,e(h).length>0||!f()||f().toLowerCase().includes("proficiency"))}),pa(),zt();var A=Ml();let B;var F=l(A);Sa(F,{title:"Ability Scores",get collapsed(){return p(),i(()=>p().abilityScores)},ariaLabel:"Toggle Ability Scores Section",onToggle:()=>aa.update(V=>({...V,abilityScores:!V.abilityScores}))});var ue=a(F,2);{var Ue=V=>{var Be=Tl(),ve=we(Be),ge=a(l(ve),2);Ce(ge),s(ve);var Le=a(ve,2);$t(Le,5,()=>e(h),jt,(T,U)=>{let $=()=>e(U).key,X=()=>e(U).label;var b=Bl(),I=l(b),Y=l(I,!0);s(I);var Se=a(I,2);Ce(Se);var je=a(Se,2),me=l(je);s(je);var ce=a(je,2),Ae=l(ce),qe=a(Ae,2);s(ce);var tt=a(ce,2),pt=l(tt);Ce(pt);var it=a(pt,2);s(tt),s(b),L(Ve=>{S(Y,Ve),S(me,`${t(),$(),i(()=>t()[$()]>=0?"+":"")??""}${t(),$(),i(()=>t()[$()])??""}`),pt.disabled=!m(),et(pt,"id",`${$()}-save`),et(it,"for",`${$()}-save`)},[()=>(X(),i(()=>X().substring(0,3).toUpperCase()))]),Ne(Se,()=>v().abilities[$()],Ve=>Ot(de,i(v).abilities[$()]=Ve,i(v))),R("change",Se,ee),R("click",Ae,()=>K($())),R("click",qe,()=>E($())),La(pt,()=>v().saveProficiencies[$()],Ve=>Ot(de,i(v).saveProficiencies[$()]=Ve,i(v))),o(T,b)}),s(Le),Ne(ge,()=>v().proficiencyBonus,T=>Ot(de,i(v).proficiencyBonus=T,i(v))),o(V,Be)};g(ue,V=>{p(),i(()=>!p().abilityScores)&&V(Ue)})}s(A),L(()=>B=Mt(A,1,"ability-scores svelte-bbv1xt",null,B,{hidden:!e(W)})),o(r,A),Kt(),y()}const Is=[{name:"Unarmored",type:"none",baseAC:10},{name:"Padded",type:"light",baseAC:11},{name:"Leather",type:"light",baseAC:11},{name:"Studded Leather",type:"light",baseAC:12},{name:"Hide",type:"medium",baseAC:12,maxDexBonus:2},{name:"Chain Shirt",type:"medium",baseAC:13,maxDexBonus:2},{name:"Scale Mail",type:"medium",baseAC:14,maxDexBonus:2},{name:"Breastplate",type:"medium",baseAC:14,maxDexBonus:2},{name:"Half Plate",type:"medium",baseAC:15,maxDexBonus:2},{name:"Ring Mail",type:"heavy",baseAC:14,maxDexBonus:0},{name:"Chain Mail",type:"heavy",baseAC:16,maxDexBonus:0},{name:"Splint",type:"heavy",baseAC:17,maxDexBonus:0},{name:"Plate",type:"heavy",baseAC:18,maxDexBonus:0}];function Es(r){return Is.find(c=>c.name===r)}function Pl(r,c,t){if(!r)return 10+c+(t?2:0);const v=Es(r);if(!v)return 10+c+(t?2:0);let f=v.baseAC;return v.maxDexBonus===void 0?f+=c:v.maxDexBonus>0&&(f+=Math.min(c,v.maxDexBonus)),t&&(f+=2),f}function Na(r){return Math.floor((r-10)/2)}function ds(r,c){if(!r.class)return null;const t=oa(r.class);if(!t||!t.spellcaster||!t.spellcastingAbility)return null;const v=Na(c[t.spellcastingAbility]);return 8+r.proficiencyBonus+v}function ls(r,c){if(!r.class)return 0;const t=oa(r.class);return!t||!t.spellcaster||!t.spellcastingAbility?0:Na(c[t.spellcastingAbility])}function Il(r,c){const t=[],v=Na(c.dexterity),f=r.armorName?Es(r.armorName):void 0;if(f){if(f.type==="none")t.push("Unarmored"),t.push("Base: 10"),t.push(`Dexterity: ${v>=0?"+":""}${v}`);else if(f.type==="light")t.push(`${f.name}: ${f.baseAC}`),t.push(`Dexterity: ${v>=0?"+":""}${v}`);else if(f.type==="medium"){const p=Math.min(2,v);t.push(`${f.name}: ${f.baseAC}`),t.push(`Dexterity: ${p>=0?"+":""}${p} (max +2)`)}else f.type==="heavy"&&(t.push(`${f.name}: ${f.baseAC}`),t.push("Dexterity: +0 (heavy armor)"));r.shieldEquipped&&t.push("Shield: +2")}else{t.push("Base: 10"),v!==0&&t.push(`Dexterity: ${v>=0?"+":""}${v}`);const p=10+v,m=r.armorClass-p;m!==0&&t.push(`Other: ${m>=0?"+":""}${m}`)}return r.activeStates&&r.activeStates.length>0&&r.activeStates.forEach(p=>{typeof p.acBonus=="number"&&p.acBonus!==0&&(!p.target||p.target==="self")&&t.push(`${p.name}: ${p.acBonus>=0?"+":""}${p.acBonus}`)}),t.join(`
`)}function El(r,c){const t=[],v=Na(c.dexterity);t.push(`Dexterity: ${v>=0?"+":""}${v}`);const f=r.initiative-v;return f!==0&&t.push(`Other Bonuses: ${f>=0?"+":""}${f}`),t.join(`
`)}function Ul(r,c){if(!r.class)return"";const t=oa(r.class);if(!t||!t.spellcaster||!t.spellcastingAbility)return"";const v=[],f=Na(c[t.spellcastingAbility]),p=t.spellcastingAbility.charAt(0).toUpperCase()+t.spellcastingAbility.slice(1);return v.push("Base: 8"),v.push(`Proficiency: +${r.proficiencyBonus}`),v.push(`${p}: ${f>=0?"+":""}${f}`),v.join(`
`)}function Hl(r,c,t){const v=[];let f=r;const p=c.toLowerCase().trim();if(t.activeStates){for(const w of t.activeStates)if(w.immunities&&w.immunities.length>0&&w.immunities.some(h=>h.toLowerCase().trim()===p))return v.push(`Immune to ${c} (${w.name})`),{finalDamage:0,adjustments:v}}let m=!1;if(t.activeStates){for(const w of t.activeStates)if(w.resistances&&w.resistances.length>0&&w.resistances.some(h=>h.toLowerCase().trim()===p)){const h=Math.floor(f/2);v.push(`Resistant to ${c} (${w.name}): ${f} ‚Üí ${h}`),f=h,m=!0;break}}if(!m&&t.race){const w=Va(t.race);if(w){for(const y of w.traits)if(y.resistances&&y.resistances.some(h=>h.toLowerCase().trim()===p)){const h=Math.floor(f/2);v.push(`Resistant to ${c} (racial trait): ${f} ‚Üí ${h}`),f=h,m=!0;break}}}return v.length===0&&v.push(`No adjustments for ${c}`),{finalDamage:f,adjustments:v}}function Nl(r,c){const t={...r};if(t.tempHP>0){if(c<=t.tempHP)return t.tempHP-=c,t;c-=t.tempHP,t.tempHP=0}return t.currentHP=Math.max(0,t.currentHP-c),t}var Ol=d('<button class="info-icon svelte-1o8ci7b" type="button">‚ÑπÔ∏è</button>'),Gl=d('<button class="info-icon svelte-1o8ci7b" type="button">‚ÑπÔ∏è</button>'),ql=d("<div><!></div>"),zl=d('<div class="tooltip-wrapper svelte-1o8ci7b"><!> <!></div>');function rs(r,c){Wt(c,!1);let t=At(c,"tooltipContent",8),v=At(c,"ariaLabel",8,"Show information"),f=C(!1),p=C(),m=C(!1),w=C(null),y=C(!1),h=C(!1),W=C("");const P=Math.random().toString(36).slice(2);function Q(){window.dispatchEvent(new CustomEvent("tooltip-open",{detail:P}))}function ee(T){T.detail!==P&&(n(f,!1),n(y,!1))}function K(){n(m,window.matchMedia("(pointer: coarse)").matches||"ontouchstart"in window)}function E(){if(!e(w)||!e(p))return;const T=e(p).getBoundingClientRect(),U=e(w).getBoundingClientRect();let $=T.bottom+5,X=T.left;n(y,!1),X+U.width>window.innerWidth-8&&(X=T.right-U.width,n(y,!0),X<8&&(X=8)),X<8&&(X=8),$+U.height>window.innerHeight-8&&($=T.top-U.height-5),n(W,`position:fixed;top:${$}px;left:${X}px;z-index:1000;`),n(h,!0)}function A(){Q(),n(f,!1),n(h,!1),requestAnimationFrame(()=>{n(f,!0),n(h,!1),setTimeout(E,0)})}function B(){n(f,!1),n(y,!1)}function F(T){T.stopPropagation(),e(f)?(n(f,!1),n(y,!1),n(h,!1)):(Q(),n(f,!1),n(h,!1),requestAnimationFrame(()=>{n(f,!0),n(h,!1),setTimeout(E,0)}))}function ue(T){e(p)&&!e(p).contains(T.target)&&(n(f,!1),n(y,!1))}wa(()=>{K(),document.addEventListener("click",ue),window.addEventListener("tooltip-open",ee)}),Os(()=>{document.removeEventListener("click",ue),window.removeEventListener("tooltip-open",ee)}),zt();var Ue=zl(),V=l(Ue);{var Be=T=>{var U=Ol();L(()=>et(U,"aria-label",v())),R("click",U,F),o(T,U)},ve=T=>{var U=Gl();L(()=>et(U,"aria-label",v())),R("mouseenter",U,A),R("mouseleave",U,B),o(T,U)};g(V,T=>{e(m)?T(Be):T(ve,!1)})}var ge=a(V,2);{var Le=T=>{var U=ql(),$=l(U);gl($,c,"content",{},X=>{var b=bt(),I=we(b);ml(I,t),o(X,b)}),s(U),Ua(U,X=>n(w,X),()=>e(w)),L(()=>{Mt(U,1,`tooltip-popup ${e(y)?"right-align":""}`,"svelte-1o8ci7b"),bl(U,e(h)?e(W)+"opacity:1;pointer-events:auto;":"opacity:0;pointer-events:none;position:fixed;top:0;left:0;z-index:1000;")}),o(T,U)};g(ge,T=>{e(f)&&T(Le)})}s(Ue),Ua(Ue,T=>n(p,T),()=>e(p)),o(r,Ue),Kt()}var Wl=d("<option> </option>"),Kl=d('<div class="armor-config svelte-1r5hyyb"><h4 class="svelte-1r5hyyb">Armor Configuration</h4> <div class="armor-controls svelte-1r5hyyb"><div class="armor-field svelte-1r5hyyb"><label for="armorName" class="svelte-1r5hyyb">Armor</label> <select id="armorName" class="armor-select svelte-1r5hyyb"><option>None (Unarmored)</option><!></select></div> <div class="armor-field svelte-1r5hyyb"><label class="shield-label svelte-1r5hyyb"><input type="checkbox" class="shield-checkbox svelte-1r5hyyb"/> Shield Equipped (+2 AC)</label></div></div></div>'),Vl=d('<div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="spellSaveDC" class="svelte-1r5hyyb">Spell Save DC</label> <!></div> <input type="number" id="spellSaveDC" class="stat-input svelte-1r5hyyb" readonly=""/></div>'),Jl=d('<span class="hit-dice-type"> </span>'),Yl=d('<!> <div class="stats-grid svelte-1r5hyyb"><div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="armorClass" class="svelte-1r5hyyb">Armor Class</label> <!></div> <input type="text" id="armorClass" readonly=""/></div> <div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="initiative" class="svelte-1r5hyyb">Initiative</label> <!></div> <input type="text" id="initiative" class="stat-input svelte-1r5hyyb" readonly=""/></div> <div class="stat-box svelte-1r5hyyb"><label for="speed" class="svelte-1r5hyyb">Speed</label> <input type="text" id="speed" class="stat-input svelte-1r5hyyb"/></div> <!></div> <div class="hp-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Points</h3> <div><div class="hp-inputs svelte-1r5hyyb"><input type="number" class="hp-current svelte-1r5hyyb" min="0"/> <span class="hp-separator svelte-1r5hyyb">/</span> <input type="number" class="hp-max svelte-1r5hyyb" min="0"/></div> <div class="hp-controls svelte-1r5hyyb"><button class="hp-btn svelte-1r5hyyb">‚àí</button> <button class="hp-btn svelte-1r5hyyb">+</button> <button class="hp-btn svelte-1r5hyyb">‚àí5</button> <button class="hp-btn svelte-1r5hyyb">+5</button></div></div> <div class="temp-hp svelte-1r5hyyb"><label for="tempHP" class="svelte-1r5hyyb">Temp HP</label> <input type="number" id="tempHP" min="0" class="svelte-1r5hyyb"/></div></div> <div class="hit-dice-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Dice</h3> <div class="hit-dice-display svelte-1r5hyyb"><input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <span>/</span> <input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <!></div> <div class="hit-dice-controls svelte-1r5hyyb"><label for="hitDiceCount" class="svelte-1r5hyyb">Roll</label> <div class="hit-dice-count-controls svelte-1r5hyyb"><button class="hit-dice-btn svelte-1r5hyyb">‚àí</button> <input type="number" id="hitDiceCount" class="hit-dice-count-input svelte-1r5hyyb" min="1"/> <button class="hit-dice-btn svelte-1r5hyyb">+</button></div> <button class="btn btn-primary roll-hit-dice use-enabled svelte-1r5hyyb">üé≤ Roll</button></div></div>',1),Ql=d("<section><!> <!></section>");function Xl(r,c){Wt(c,!1);const t=()=>ut(de,"$character",w),v=()=>ut(Qa,"$abilityModifiers",w),f=()=>ut(_a,"$searchFilter",w),p=()=>ut(aa,"$collapsedStates",w),m=()=>ut(xa,"$isEditMode",w),[w,y]=ca(),h=C(),W=C(),P=C(),Q=C(),ee=C(),K=C(),E=C(),A=$a();let B=C(1);function F(T){de.update(U=>(U.currentHP=Math.max(0,Math.min(U.maxHP,U.currentHP+T)),U))}function ue(T){const U=e(B)+T,$=t().hitDice.current;n(B,Math.max(1,Math.min($,U)))}function Ue(T=1){if(t().hitDice.current<=0){alert("No hit dice remaining!");return}if(!t().class){alert("Please select a class first!");return}const U=oa(t().class);if(!U){alert("Invalid class configuration!");return}const $=Math.min(T,t().hitDice.current),X=U.hitDice,b=v().constitution,I=b*$,Y=I>=0?`+${I}`:`${I}`,Se=`${$}${X}${Y}`,je=[];if(je.push({value:`${$}${X}`,source:"hit dice"}),b!==0)for(let me=0;me<$;me++)je.push({value:b,source:"constitution"});A("rollHitDice",{notation:Se,hitDie:X,count:$,bonusBreakdown:je})}Ye(()=>(t(),v(),de),()=>{if(t().armorName!==void 0||t().shieldEquipped!==void 0){const T=v().dexterity,U=Pl(t().armorName,T,t().shieldEquipped||!1);t().armorClass!==U&&de.update($=>({...$,armorClass:U}))}}),Ye(()=>(v(),t(),de),()=>{const T=v().dexterity;t().initiative!==T&&de.update(U=>({...U,initiative:T}))}),Ye(()=>t(),()=>{n(h,ds(t(),t().abilities))}),Ye(()=>t(),()=>{n(W,Il(t(),t().abilities))}),Ye(()=>t(),()=>{n(P,El(t(),t().abilities))}),Ye(()=>t(),()=>{n(Q,Ul(t(),t().abilities))}),Ye(()=>(t(),e(B)),()=>{const T=t().hitDice.current;T>0&&e(B)>T&&n(B,T)}),Ye(()=>t(),()=>{n(ee,t().activeStates&&t().activeStates.length>0?t().activeStates.reduce((T,U)=>T+(U.acBonus||0),0):0)}),Ye(()=>t(),()=>{n(K,t().activeStates&&t().activeStates.length>0?t().activeStates.some(T=>T.name==="Aid"&&T.target==="self"):!1)}),Ye(()=>f(),()=>{n(E,!f()||"armor class".includes(f().toLowerCase())||"initiative".includes(f().toLowerCase())||"speed".includes(f().toLowerCase())||"hit points".includes(f().toLowerCase())||"hp".includes(f().toLowerCase())||"hit dice".includes(f().toLowerCase())||"spell save".includes(f().toLowerCase())||"combat".includes(f().toLowerCase()))}),pa(),zt();var V=Ql();let Be;var ve=l(V);{let T=Ct(()=>(p(),i(()=>p().combatStats?"Expand":"Collapse")));Sa(ve,{title:"Combat Stats",get collapsed(){return p(),i(()=>p().combatStats)},get ariaLabel(){return e(T)},onToggle:()=>aa.update(U=>({...U,combatStats:!U.combatStats}))})}var ge=a(ve,2);{var Le=T=>{var U=Yl(),$=we(U);{var X=le=>{var Me=Kl(),ke=a(l(Me),2),We=l(ke),Oe=a(l(We),2);L(()=>{t(),qt(()=>{})});var Xe=l(Oe);Xe.value=(Xe.__value=void 0)??"";var ot=a(Xe);$t(ot,1,()=>Is,jt,(J,re)=>{var Fe=bt(),Ge=we(Fe);{var Pe=Re=>{var ct=Wl(),ft=l(ct);s(ct);var Ie={};L(()=>{S(ft,`${e(re),i(()=>e(re).name)??""} (AC ${e(re),i(()=>e(re).baseAC)??""})`),Ie!==(Ie=(e(re),i(()=>e(re).name)))&&(ct.value=(ct.__value=(e(re),i(()=>e(re).name)))??"")}),o(Re,ct)};g(Ge,Re=>{e(re),i(()=>e(re).name!=="Unarmored")&&Re(Pe)})}o(J,Fe)}),s(Oe),s(We);var oe=a(We,2),j=l(oe),q=l(j);Ce(q),ta(),s(j),s(oe),s(ke),s(Me),Ha(Oe,()=>t().armorName,J=>Ot(de,i(t).armorName=J,i(t))),La(q,()=>t().shieldEquipped,J=>Ot(de,i(t).shieldEquipped=J,i(t))),o(le,Me)};g($,le=>{m()&&le(X)})}var b=a($,2),I=l(b),Y=l(I),Se=a(l(Y),2);rs(Se,{get tooltipContent(){return e(W)},ariaLabel:"Show AC breakdown"}),s(Y);var je=a(Y,2);Ce(je),s(I);var me=a(I,2),ce=l(me),Ae=a(l(ce),2);rs(Ae,{get tooltipContent(){return e(P)},ariaLabel:"Show Initiative breakdown"}),s(ce);var qe=a(ce,2);Ce(qe),s(me);var tt=a(me,2),pt=a(l(tt),2);Ce(pt),s(tt);var it=a(tt,2);{var Ve=le=>{var Me=Vl(),ke=l(Me),We=a(l(ke),2);rs(We,{get tooltipContent(){return e(Q)},ariaLabel:"Show Spell Save DC breakdown"}),s(ke);var Oe=a(ke,2);Ce(Oe),s(Me),L(()=>Ea(Oe,e(h))),o(le,Me)};g(it,le=>{e(h)!==null&&le(Ve)})}s(b);var yt=a(b,2),Dt=a(l(yt),2);let k;var z=l(Dt),_=l(z);Ce(_);var O=a(_,4);Ce(O),s(z);var Z=a(z,2),ie=l(Z),he=a(ie,2),_e=a(he,2),Te=a(_e,2);s(Z),s(Dt);var se=a(Dt,2),D=a(l(se),2);Ce(D),s(se),s(yt);var te=a(yt,2),De=a(l(te),2),ze=l(De);Ce(ze);var Qe=a(ze,4);Ce(Qe);var mt=a(Qe,2);{var ye=le=>{const Me=Ct(()=>(N(oa),t(),i(()=>oa(t().class))));var ke=bt(),We=we(ke);{var Oe=Xe=>{const ot=Ct(()=>(v(),i(()=>v().constitution)));var oe=Jl(),j=l(oe);s(oe),L(()=>S(j,`(${N(e(Me)),i(()=>e(Me).hitDice)??""}${(e(ot)>=0?`+${e(ot)}`:e(ot))??""})`)),o(Xe,oe)};g(We,Xe=>{e(Me)&&Xe(Oe)})}o(le,ke)};g(mt,le=>{t(),i(()=>t().class)&&le(ye)})}s(De);var ae=a(De,2),u=a(l(ae),2),Je=l(u),xe=a(Je,2);Ce(xe);var G=a(xe,2);s(u);var be=a(u,2);s(ae),s(te),L(()=>{Ea(je,(e(ee),t(),i(()=>e(ee)!==0?`${t().armorClass} ‚Üí ${t().armorClass+e(ee)}`:`${t().armorClass}`))),Mt(je,1,nl(e(ee)!==0?"stat-input ac-enhanced":"stat-input"),"svelte-1r5hyyb"),Ea(qe,(t(),i(()=>t().initiative))),k=Mt(Dt,1,"hp-display svelte-1r5hyyb",null,k,{"aid-active":e(K)}),et(_,"max",(t(),i(()=>t().maxHP))),et(ze,"max",(t(),i(()=>t().hitDice.max))),Je.disabled=e(B)<=1,et(xe,"max",(t(),i(()=>t().hitDice.current))),G.disabled=(e(B),t(),i(()=>e(B)>=t().hitDice.current)),be.disabled=(t(),i(()=>t().hitDice.current<=0||!t().class))}),Ne(pt,()=>t().speed,le=>Ot(de,i(t).speed=le,i(t))),Ne(_,()=>t().currentHP,le=>Ot(de,i(t).currentHP=le,i(t))),Ne(O,()=>t().maxHP,le=>Ot(de,i(t).maxHP=le,i(t))),R("click",ie,()=>F(-1)),R("click",he,()=>F(1)),R("click",_e,()=>F(-5)),R("click",Te,()=>F(5)),Ne(D,()=>t().tempHP,le=>Ot(de,i(t).tempHP=le,i(t))),Ne(ze,()=>t().hitDice.current,le=>Ot(de,i(t).hitDice.current=le,i(t))),Ne(Qe,()=>t().hitDice.max,le=>Ot(de,i(t).hitDice.max=le,i(t))),R("click",Je,()=>ue(-1)),Ne(xe,()=>e(B),le=>n(B,le)),R("input",xe,le=>{const Me=le.target,ke=parseInt(Me.value);ke>t().hitDice.current&&n(B,t().hitDice.current),ke<1&&n(B,1)}),R("click",G,()=>ue(1)),R("click",be,()=>Ue(e(B))),o(T,U)};g(ge,T=>{p(),i(()=>!p().combatStats)&&T(Le)})}s(V),L(()=>Be=Mt(V,1,"combat-stats svelte-1r5hyyb",null,Be,{hidden:!e(E)})),o(r,V),Kt(),y()}const Ga={acrobatics:"dexterity",animalHandling:"wisdom",arcana:"intelligence",athletics:"strength",deception:"charisma",history:"intelligence",insight:"wisdom",intimidation:"charisma",investigation:"intelligence",medicine:"wisdom",nature:"intelligence",perception:"wisdom",performance:"charisma",persuasion:"charisma",religion:"intelligence",sleightOfHand:"dexterity",stealth:"dexterity",survival:"wisdom"};var Zl=d('<div class="skill-row svelte-1f1pl16"><input type="checkbox" class="svelte-1f1pl16"/> <label class="svelte-1f1pl16"> <span class="ability-tag svelte-1f1pl16"> </span></label> <span class="skill-modifier svelte-1f1pl16"> </span> <button class="roll-btn svelte-1f1pl16">Roll</button></div>'),er=d('<div class="skills-grid svelte-1f1pl16"></div>'),tr=d("<section><!> <!></section>");function ar(r,c){Wt(c,!1);const t=()=>ut(de,"$character",w),v=()=>ut(Qa,"$abilityModifiers",w),f=()=>ut(_a,"$searchFilter",w),p=()=>ut(aa,"$collapsedStates",w),m=()=>ut(xa,"$isEditMode",w),[w,y]=ca(),h=C(),W=C(),P=C(),Q=C(),ee=C(),K=C(),E=$a(),A=[{key:"acrobatics",label:"Acrobatics"},{key:"animalHandling",label:"Animal Handling"},{key:"arcana",label:"Arcana"},{key:"athletics",label:"Athletics"},{key:"deception",label:"Deception"},{key:"history",label:"History"},{key:"insight",label:"Insight"},{key:"intimidation",label:"Intimidation"},{key:"investigation",label:"Investigation"},{key:"medicine",label:"Medicine"},{key:"nature",label:"Nature"},{key:"perception",label:"Perception"},{key:"performance",label:"Performance"},{key:"persuasion",label:"Persuasion"},{key:"religion",label:"Religion"},{key:"sleightOfHand",label:"Sleight of Hand"},{key:"stealth",label:"Stealth"},{key:"survival",label:"Survival"}];function B(ve){const ge=Ga[ve],Le=v()[ge],T=t().skillProficiencies[ve]?t().proficiencyBonus:0,U=e(h)[ve],$=`1d20${U>=0?"+":""}${U}`,X=[];X.push({value:"1d20",source:"base die"}),Le!==0&&X.push({value:Le,source:ge}),T!==0&&X.push({value:T,source:"proficiency"}),E("roll",{notation:$,rollType:"check",bonusBreakdown:X})}Ye(()=>{},()=>{n(h,{})}),Ye(()=>t(),()=>{n(W,t().skillProficiencies)}),Ye(()=>t(),()=>{n(P,t().proficiencyBonus)}),Ye(()=>v(),()=>{n(Q,v())}),Ye(()=>(e(Q),e(W),e(P)),()=>{for(const{key:ve}of A){const ge=Ga[ve],Le=e(Q)[ge],T=e(W)[ve]?e(P):0;ba(h,e(h)[ve]=Le+T)}}),Ye(()=>f(),()=>{n(ee,A.filter(({label:ve})=>f()?ve.toLowerCase().includes(f().toLowerCase()):!0))}),Ye(()=>e(ee),()=>{n(K,e(ee).length>0)}),pa(),zt();var F=tr();let ue;var Ue=l(F);{let ve=Ct(()=>(p(),i(()=>p().skills?"Expand":"Collapse")));Sa(Ue,{title:"Skills",get collapsed(){return p(),i(()=>p().skills)},get ariaLabel(){return e(ve)},onToggle:()=>aa.update(ge=>({...ge,skills:!ge.skills}))})}var V=a(Ue,2);{var Be=ve=>{var ge=er();$t(ge,5,()=>e(ee),jt,(Le,T)=>{let U=()=>e(T).key,$=()=>e(T).label;var X=Zl(),b=l(X);Ce(b);var I=a(b,2),Y=l(I),Se=a(Y),je=l(Se);s(Se),s(I);var me=a(I,2),ce=l(me);s(me);var Ae=a(me,2);s(X),L(qe=>{Fs(b,(e(W),U(),i(()=>e(W)[U()]))),b.disabled=!m(),et(b,"id",U()),et(I,"for",U()),S(Y,`${$()??""} `),S(je,`(${qe??""})`),S(ce,`${e(h),U(),i(()=>e(h)[U()]>=0?"+":"")??""}${e(h),U(),i(()=>e(h)[U()])??""}`)},[()=>(N(Ga),U(),i(()=>Ga[U()].substring(0,3).toUpperCase()))]),R("change",b,qe=>{console.log("Skill proficiency changed:",U(),qe.target.checked),de.update(tt=>({...tt,skillProficiencies:{...tt.skillProficiencies,[U()]:qe.target.checked}}))}),R("click",Ae,()=>B(U())),o(Le,X)}),s(ge),o(ve,ge)};g(V,ve=>{p(),i(()=>!p().skills)&&ve(Be)})}s(F),L(()=>ue=Mt(F,1,"skills svelte-1f1pl16",null,ue,{hidden:!e(K)})),o(r,F),Kt(),y()}var sr=d('<p class="empty-message svelte-1123ljy">No attacks or spells to reorder.</p>'),lr=d('<li class="reorder-item svelte-1123ljy"><span class="attack-name svelte-1123ljy"> </span> <div class="reorder-buttons svelte-1123ljy"><button class="btn-move svelte-1123ljy" aria-label="Move up">‚ñ≤</button> <button class="btn-move svelte-1123ljy" aria-label="Move down">‚ñº</button></div></li>'),rr=d('<ul class="reorder-list svelte-1123ljy"></ul>'),ir=d('<div class="modal-backdrop svelte-1123ljy" role="presentation"><div class="modal-content svelte-1123ljy" role="dialog" aria-modal="true" aria-labelledby="modal-title"><div class="modal-header svelte-1123ljy"><h3 id="modal-title" class="svelte-1123ljy">Reorder Attacks & Spells</h3> <button class="btn-close svelte-1123ljy" aria-label="Close">√ó</button></div> <div class="modal-body svelte-1123ljy"><!></div> <div class="modal-footer svelte-1123ljy"><button class="btn btn-secondary svelte-1123ljy">Cancel</button> <button class="btn btn-primary svelte-1123ljy">Save Order</button></div></div></div>');function nr(r,c){Wt(c,!1);let t=At(c,"show",8,!1),v=At(c,"attacks",24,()=>[]),f=At(c,"onSave",8),p=At(c,"onCancel",8),m=C([]);function w(A,B){const F=e(m)[A];ba(m,e(m)[A]=e(m)[B]),ba(m,e(m)[B]=F),n(m,[...e(m)])}function y(A){A>0&&w(A,A-1)}function h(A){A<e(m).length-1&&w(A,A+1)}function W(){f()(e(m))}function P(){p()()}function Q(A){A.target===A.currentTarget&&P()}Ye(()=>(N(t()),N(v())),()=>{t()&&n(m,[...v()])}),pa(),zt();var ee=bt(),K=we(ee);{var E=A=>{var B=ir(),F=l(B),ue=l(F),Ue=a(l(ue),2);s(ue);var V=a(ue,2),Be=l(V);{var ve=$=>{var X=sr();o($,X)},ge=$=>{var X=rr();$t(X,7,()=>e(m),b=>b.id,(b,I,Y)=>{var Se=lr(),je=l(Se),me=l(je,!0);s(je);var ce=a(je,2),Ae=l(ce),qe=a(Ae,2);s(ce),s(Se),L(()=>{S(me,(e(I),i(()=>e(I).name||"(Unnamed attack or spell)"))),Ae.disabled=e(Y)===0,qe.disabled=(N(e(Y)),e(m),i(()=>e(Y)===e(m).length-1))}),R("click",Ae,()=>y(e(Y))),R("click",qe,()=>h(e(Y))),o(b,Se)}),s(X),o($,X)};g(Be,$=>{e(m),i(()=>e(m).length===0)?$(ve):$(ge,!1)})}s(V);var Le=a(V,2),T=l(Le),U=a(T,2);s(Le),s(F),s(B),R("click",Ue,P),R("click",T,P),R("click",U,W),R("click",B,Q),o(A,B)};g(K,A=>{t()&&A(E)})}o(r,ee),Kt()}let qa=null,za=null;async function Us(){if(qa)return qa;try{return qa=await(await fetch(Ps("/data/spells.json"))).json(),qa||[]}catch(r){return console.error("Failed to load spells:",r),[]}}async function or(){if(za)return za;try{return za=await(await fetch(Ps("/data/feats.json"))).json(),za||[]}catch(r){return console.error("Failed to load feats:",r),[]}}function Ds(r,c){if(!c.trim())return r;const t=c.toLowerCase();return r.filter(v=>v.name.toLowerCase().includes(t)||v.school.toLowerCase().includes(t)||v.classes.some(f=>f.toLowerCase().includes(t))||v.description.toLowerCase().includes(t))}function cr(r,c){return c===null?r:r.filter(t=>t.level===c)}function vr(r,c){if(!c.trim())return r;const t=c.toLowerCase();return r.filter(v=>v.name.toLowerCase().includes(t)||v.description.toLowerCase().includes(t))}function Wa(r){const c=r.description,t=/\b(Strength|Dexterity|Constitution|Intelligence|Wisdom|Charisma)\s+saving\s+throw/i,v=c.match(t);if(!v)return null;const f=v[1].toLowerCase(),m=/half\s+(?:as\s+much\s+)?damage\s+on\s+a\s+successful(?:\s+save)?/i.test(c),y=/saving\s+throw\s+or\s+take.*?damage/i.test(c)&&!m;return{ability:f,halfDamageOnSave:m,noDamageOnSave:y}}function dr(r){const c=r.description;return/(plus|add)\s+your\s+spellcasting\s+(ability\s+)?modifier/i.test(c)}function Da(r){const c=r.description.toLowerCase();return c.includes("ranged spell attack")||c.includes("melee spell attack")}function Ka(r){const c=r.description.toLowerCase();if(["Divine Favor","Bless","Aid","Command"].includes(r.name))return!0;const f=["takes","take","deals","deal","damage equal to","force damage","fire damage","cold damage","lightning damage","thunder damage","acid damage","poison damage","necrotic damage","radiant damage","psychic damage","regain","regains","hit point"].some(w=>c.includes(w));return["bonus to attack","bonus to damage","bonus to ac","gains a +","gain a +","+1 bonus","+2 bonus","+3 bonus","advantage on","becomes a magic weapon"].some(w=>c.includes(w))&&!f}function ur(r){const c=r.description;let t=0,v=0,f=0,p="";const m=c.match(/\+(\d+)\s+bonus\s+to\s+attack\s+rolls\s+and\s+damage\s+rolls/i);if(m){const y=parseInt(m[1]);t=y,v=y,p=`+${y} to attack and damage rolls`}if(r.name==="Bless"&&(p="Add 1d4 to attack rolls and saves",t="1d4"),r.name==="Aid")return p="+5 HP (max and current) for 8 hours",{attackBonus:0,damageBonus:0,acBonus:0,hpBonus:5,description:p,name:r.name};r.name==="Divine Favor"&&(p="Your weapon attacks deal an extra 1d4 radiant damage on a hit.",v="1d4");const w=c.match(/\+(\d+)\s+bonus\s+to\s+AC/i);return w&&(f=parseInt(w[1]),p=`+${f} to AC`),r.name==="Haste"&&(p="+2 AC, doubled speed, extra action",f=2),p||t!==0||v!==0||f!==0?{attackBonus:t,damageBonus:v,acBonus:f,description:p||r.description.substring(0,100),name:r.name}:null}function is(r){const c=r.description,t=/takes?\s+(\d+d\d+)\s+\w+\s+damage[^.]*\.\s*If\s+the\s+target\s+is\s+missing.*?instead\s+takes?\s+(\d+d\d+)/is,v=c.match(t);return v?{baseDamage:v[1],alternateDamage:v[2]}:null}var fr=d('<button class="btn btn-secondary">Reorder</button>'),pr=d('<div class="edit-buttons svelte-14o91c5"><button class="btn btn-secondary">Add Attack</button> <!></div>'),mr=d('<input type="text" placeholder="Attack name" class="attack-name svelte-14o91c5"/>'),gr=d('<h4 class="attack-name-display svelte-14o91c5"> </h4>'),br=d('<button class="btn-remove svelte-14o91c5">√ó</button>'),hr=d('<div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Bonus</label> <input type="number" class="attack-bonus svelte-14o91c5"/></div>'),_r=d('<div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Damage</label> <input type="text" placeholder="e.g., 2d6+3" class="attack-damage svelte-14o91c5"/></div>'),yr=d('<div class="spell-info-loading svelte-14o91c5">Loading spell info...</div>'),xr=d('<li class="svelte-14o91c5"><strong>At Higher Levels:</strong> </li>'),$r=d('<li style="color: #007bff;" class="svelte-14o91c5"><strong>Special:</strong> Mage Hand is invisible when cast via Githyanki Psionics.</li>'),wr=d('<li style="color: #007bff;" class="svelte-14o91c5"><strong>Cast via:</strong> </li>'),Sr=d("<!> <!>",1),kr=d('<ul class="svelte-14o91c5"><li class="svelte-14o91c5"><strong>Level:</strong> </li> <li class="svelte-14o91c5"><strong>Casting Time:</strong> </li> <li class="svelte-14o91c5"><strong>Range:</strong> </li> <li class="svelte-14o91c5"><strong>Components:</strong> <!></li> <li class="svelte-14o91c5"><strong>Duration:</strong> <!> </li> <li class="svelte-14o91c5"><strong>Description:</strong> </li> <!> <!></ul>'),Cr=d('<span class="scaled-damage svelte-14o91c5" style="margin-left: 8px;"> </span>'),Dr=d('<span class="scaled-damage svelte-14o91c5">(Half damage)</span>'),Lr=d('<span class="scaled-damage svelte-14o91c5">(No damage)</span>'),jr=d('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> <!> <!></label></div>'),Ar=d('<span class="scaled-damage svelte-14o91c5"> </span>'),Rr=d('<span class="scaled-damage svelte-14o91c5"> </span>'),Br=d('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> Target is missing HP <!></label></div>'),Tr=d("<option> </option>"),Mr=d('<span class="scaled-damage svelte-14o91c5"><!> </span>'),Fr=d('<span class="scaled-damage svelte-14o91c5"> </span>'),Pr=d('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> Target is Fiend or Undead <!></label></div>'),Ir=d('<div class="spell-level-selector svelte-14o91c5"><label class="svelte-14o91c5">Cast at Level:</label> <select class="spell-level-select use-enabled svelte-14o91c5"></select> <!></div> <!>',1),Er=d('<div class="spell-info svelte-14o91c5"><div class="spell-info-header svelte-14o91c5" role="button" tabindex="0"><h4 class="svelte-14o91c5">Spell Info</h4> <button class="collapse-btn-small svelte-14o91c5"> </button></div> <!></div> <!> <!> <!>',1),Ur=d('<div class="spell-info-missing svelte-14o91c5">Spell info not found.</div>'),Hr=d('<div class="attack-notes svelte-14o91c5"><label class="svelte-14o91c5">Notes</label> <textarea placeholder="e.g., DC 15 Dex save, Range 120 ft, Concentration" class="notes-input svelte-14o91c5" rows="2"></textarea></div>'),Nr=d('<div style="margin-bottom: 0.5em;"><label style="font-size:0.95em;"><input type="checkbox" class="svelte-14o91c5"/> Use Racial Trait <span style="color:#007bff; font-size:0.95em; margin-left:0.5em;"> </span></label></div>'),Or=d('<button class="btn btn-primary">Roll Attack (Spell Slot)</button>'),Gr=d('<button class="btn btn-primary" disabled>No spell slots available</button>'),qr=d('<button class="btn btn-primary">Roll Attack (Racial Trait)</button>'),zr=d('<button class="btn btn-primary" disabled>No racial uses left</button>'),Wr=d('<div class="buff-target-selection svelte-14o91c5"><div class="target-options svelte-14o91c5"><label class="target-option svelte-14o91c5"><input type="radio" class="svelte-14o91c5"/> Self</label> <label class="target-option svelte-14o91c5"><input type="radio" class="svelte-14o91c5"/> Other</label></div> <button class="btn btn-info"> </button></div>'),Kr=d('<button class="btn btn-info">Cast Spell</button>'),Vr=d("<button><!></button>"),Jr=d('<button class="btn btn-info">Cast Spell</button>'),Yr=d("<!> <!> <!> <!>",1),Qr=d('<button class="btn btn-secondary">Roll Damage</button>'),Xr=d('<button class="btn btn-primary">Roll Attack</button> <!>',1),Zr=d('<div class="attack-card svelte-14o91c5"><div class="attack-header svelte-14o91c5"><!> <!></div> <div class="attack-details svelte-14o91c5"><!> <!> <div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Type</label> <input type="text" placeholder="e.g., slashing" class="attack-type svelte-14o91c5"/></div></div> <!> <!> <div class="attack-actions svelte-14o91c5"><!> <!></div></div>'),ei=d('<p class="no-attacks svelte-14o91c5">No attacks added yet. Click "Add Attack" to create one.</p>'),ti=d('<p class="no-attacks svelte-14o91c5">No attacks match your search.</p>'),ai=d('<span class="ability-uses svelte-14o91c5"> <!></span>'),si=d('<span class="ability-reaction svelte-14o91c5">‚ö° Reaction</span>'),li=d('<button class="btn btn-ability svelte-14o91c5">Use Ability</button>'),ri=d('<div class="ability-card svelte-14o91c5"><div class="ability-header svelte-14o91c5"><h4 class="ability-name svelte-14o91c5"> </h4> <span class="ability-source svelte-14o91c5"> </span></div> <p class="ability-description svelte-14o91c5"> </p> <div class="ability-footer svelte-14o91c5"><!> <!> <!></div></div>'),ii=d('<div class="condition-abilities-section svelte-14o91c5"><h3 class="abilities-header svelte-14o91c5">Condition Abilities</h3> <p class="section-description svelte-14o91c5">Special actions granted by active conditions (e.g., Flicker of Deceit)</p> <div class="abilities-list svelte-14o91c5"></div></div>'),ni=d('<button class="btn-remove svelte-14o91c5">√ó</button>'),oi=d('<div class="state-card svelte-14o91c5"><div class="state-header svelte-14o91c5"><input type="text" placeholder="Effect name (e.g., Magic Weapon)" class="state-name svelte-14o91c5"/> <!></div> <div class="state-details svelte-14o91c5"><div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Attack Bonus</label> <input type="number" class="state-bonus svelte-14o91c5"/></div> <div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Damage Bonus</label> <input type="text" class="state-bonus svelte-14o91c5"/></div> <div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Target</label> <select class="state-bonus svelte-14o91c5"><option>Self</option><option>Other</option></select></div></div> <div class="state-description svelte-14o91c5"><label class="svelte-14o91c5">Description</label> <input type="text" placeholder="e.g., +1 to attack and damage rolls (Magic Weapon)" class="state-desc-input svelte-14o91c5"/></div></div>'),ci=d('<div class="states-list svelte-14o91c5"></div>'),vi=d('<p class="no-states svelte-14o91c5">No active effects. Add spell effects that modify your attacks.</p>'),di=d('<!> <div class="attacks-list svelte-14o91c5"><!> <!> <!></div> <!> <div class="active-states-section svelte-14o91c5"><h3 class="svelte-14o91c5">Active Spell Effects</h3> <p class="section-description svelte-14o91c5">Effects that modify attack and damage rolls (e.g., Magic Weapon, Bless)</p> <button class="btn btn-secondary">Add Effect</button> <!></div>',1),ui=d("<section><!> <!></section> <!>",1);function fi(r,c){Wt(c,!1);const t=()=>ut(de,"$character",m),v=()=>ut(_a,"$searchFilter",m),f=()=>ut(aa,"$collapsedStates",m),p=()=>ut(xa,"$isEditMode",m),[m,w]=ca(),y=C(),h=C(),W=C(),P=[];let Q=C({});function ee(k,z){de.update(_=>{if(!_.activeStates)return _;const O=_.activeStates.findIndex(_e=>_e.name===k);if(O===-1)return _;const Z=_.activeStates[O];if(!Z.abilities)return _;const ie=Z.abilities.findIndex(_e=>_e.name===z);if(ie===-1)return _;const he=Z.abilities[ie];return he.currentUses!==void 0&&he.currentUses>0&&(he.currentUses-=1,he.usesPerRest!==void 0?Ut.add(`Used ${z} (${he.currentUses}/${he.usesPerRest} remaining)`,"info"):Ut.add(`Used ${z}`,"info")),_})}const K=$a();let E=C({}),A=C({}),B=C(!1);function F(k){ba(E,e(E)[k]=!e(E)[k]),n(E,{...e(E)})}function ue(k){return k.description.toLowerCase().includes("regain")&&(k.description.toLowerCase().includes("hit point")||k.description.toLowerCase().includes("hp"))}function Ue(k){return["Shield of Faith","Bless","Aid","Magic Weapon"].includes(k)}function V(){de.update(k=>(k.attacks=[...k.attacks,{id:crypto.randomUUID(),name:"",bonus:0,damage:"",damageType:"",notes:""}],k))}function Be(k){de.update(z=>(z.attacks=z.attacks.filter(_=>_.id!==k),z))}function ve(){n(B,!0)}function ge(){n(B,!1)}function Le(k){de.update(z=>(z.attacks=k,z)),n(B,!1),Ut.add("Attack order updated successfully!","success")}function T(k,z){let _=k.damage,O=!1,Z=!1;if(k.spellRef){const se=b(k.spellRef);if(se&&(Z=Da(se),se.level>0)){const D=k.castAtLevel||se.level;let te=!1;if(z||k.source==="racial"){if(te=Y(k.name),!te){Ut.add(`No uses of ${k.name} remaining!`,"error");return}}else if(te=I(D),!te){Ut.add(`No level ${D} spell slots available!`,"error");return}const ze=Wa(se);ze&&k.targetSucceededSave&&ze.noDamageOnSave?_="0":(O=ze?.halfDamageOnSave&&k.targetSucceededSave||!1,_=Se(k,se))}}else if(t().activeStates&&t().activeStates.length>0){let se=0,D=[];for(const te of t().activeStates)te.target!=="other"&&(typeof te.damageBonus=="string"?D.push(te.damageBonus):typeof te.damageBonus=="number"&&(se+=te.damageBonus));if((se!==0||D.length>0)&&_){const te=_.match(/(\d+d\d+)([+-]\d+)?/);if(te){const[,De,ze]=te,mt=(ze?parseInt(ze):0)+se;let ye=`${De}`;mt!==0&&(ye+=`${mt>=0?"+":""}${mt}`),D.length>0&&(ye+=" + "+D.join(" + ")),_=ye}}}const ie=[];let he=0;if(Z){const se=ls(t(),t().abilities),D=t().proficiencyBonus||0;ie.push({value:D,source:"proficiency"}),ie.push({value:se,source:"spellcasting"}),he=D+se}else k.bonus!==0&&ie.push({value:k.bonus,source:"base"}),he=k.bonus;let _e=[];if(t().activeStates)for(const se of t().activeStates)se.target!=="other"&&(typeof se.attackBonus=="number"&&se.attackBonus!==0?(ie.push({value:se.attackBonus,source:se.name.toLowerCase()}),he+=se.attackBonus):typeof se.attackBonus=="string"&&se.attackBonus&&_e.push(se.attackBonus));let Te=`1d20${he>=0?"+":""}${he}`;_e.length>0&&(Te+="+"+_e.join("+")),K("roll",{notation:Te,damageNotation:_,attackName:k.name,applyHalfDamage:O,bonusBreakdown:ie,rollType:"attack"})}function U(k){if(!k.damage){Ut.add(`${k.name}: No damage specified`,"error");return}let z=k.damage,_=!1;const O=[];let Z=k.damageType||"";if(k.spellRef){const ie=b(k.spellRef);if(ie){const he=ue(ie);if(he){const _e=ls(t(),t().abilities),Te=z.match(/^(\d+d\d+)/);Te&&(z=Te[1],_e>0&&(z+=`+${_e}`,O.push({value:_e,source:"spellcasting"}))),Z="Healing"}if(ie.level>0){const _e=k.castAtLevel||ie.level;let Te=!1;if(k.source==="racial"){if(Te=Y(k.name),!Te){Ut.add(`No uses of ${k.name} remaining!`,"error");return}}else if(Te=I(_e),!Te){Ut.add(`No level ${_e} spell slots available!`,"error");return}const se=Wa(ie);se&&k.targetSucceededSave&&se.noDamageOnSave?z="0":(_=se?.halfDamageOnSave&&k.targetSucceededSave||!1,he||(z=Se(k,ie)))}}}else{const ie=z.match(/(\d+d\d+)([+-]\d+)?/);if(ie){const[,he,_e]=ie,Te=_e?parseInt(_e):0;if(Te!==0&&O.push({value:Te,source:"base"}),t().activeStates&&t().activeStates.length>0){let se=0,D=[];for(const te of t().activeStates)te.target!=="other"&&(typeof te.damageBonus=="string"?D.push(te.damageBonus):typeof te.damageBonus=="number"&&te.damageBonus!==0&&(O.push({value:te.damageBonus,source:te.name.toLowerCase()}),se+=te.damageBonus));if(se!==0||D.length>0){const te=Te+se;let De=`${he}`;te!==0&&(De+=`${te>=0?"+":""}${te}`),D.length>0&&(De+=" + "+D.join(" + ")),z=De}}}}K("roll",{notation:z,attackName:k.name,applyHalfDamage:_,bonusBreakdown:O,damageType:Z})}let $=C([]),X=C(!1);wa(async()=>{n($,await Us()),n(X,!0)});function b(k){return e($).find(z=>z.name===k)}function I(k){t().classFeatures.spellSlotsByLevel||Ot(de,i(t).classFeatures.spellSlotsByLevel={},i(t)),t().classFeatures.spellSlotsByLevel[k]||Ot(de,i(t).classFeatures.spellSlotsByLevel[k]=Array(2).fill(!1),i(t));const _=t().classFeatures.spellSlotsByLevel[k].findIndex(O=>!O);return _===-1?!1:(de.update(O=>(O.classFeatures.spellSlotsByLevel||(O.classFeatures.spellSlotsByLevel={}),O.classFeatures.spellSlotsByLevel[k]||(O.classFeatures.spellSlotsByLevel[k]=Array(2).fill(!1)),O.classFeatures.spellSlotsByLevel[k][_]=!0,O)),!0)}function Y(k){return!t().racialTraits||!t().racialTraits.uses[k]?!0:t().racialTraits.uses[k].currentUses<=0?!1:(ol(k),!0)}function Se(k,z){let _=k.damage,O=0,Z=0;const ie=is(z);if(ie&&k.targetIsDamaged&&(_=ie.alternateDamage),dr(z)&&(Z+=ls(t(),t().abilities)),t().activeStates)for(const Qe of t().activeStates)Qe.target!=="other"&&typeof Qe.damageBonus=="number"&&(Z+=Qe.damageBonus);if(z.higherLevelSlot&&k.castAtLevel){const Qe=z.level,ye=(k.castAtLevel||Qe)-Qe;if(ye>0){const ae=z.higherLevelSlot.match(/(\d+)d(\d+)\s+for\s+each.*?level\s+above/i);if(ae){const[,u]=ae;O+=ye*parseInt(u)}}}if(k.targetIsFiendOrUndead&&z.description.includes("Fiend or an Undead")){const Qe=z.description.match(/increases by (\d+)d(\d+) if.*?Fiend or.*?Undead/i);if(Qe){const[,mt]=Qe;O+=parseInt(mt)}}const he=_.match(/(\d+)d(\d+)([+-]\d+)?/);if(!he)return Z!==0?Z>=0?`${Z}`:`${Z}`:_||"0";const[,_e,Te,se]=he,D=parseInt(_e)+O,De=(se?parseInt(se):0)+Z;let ze=`${D}d${Te}`;return De!==0&&(ze+=De>=0?`+${De}`:`${De}`),ze}function je(k){const z=[];for(let O=k.level;O<=9;O++){const Z=t().classFeatures.spellSlotsByLevel?.[O];Z&&Z.length>0&&z.push(O)}return z}function me(){de.update(k=>(k.activeStates||(k.activeStates=[]),k.activeStates=[...k.activeStates,{name:"",attackBonus:0,damageBonus:0,description:"",target:"self"}],k))}function ce(k){de.update(z=>{if(z.activeStates){const _=z.activeStates[k];_?.hpBonus&&_.target!=="other"&&(z.maxHP-=_.hpBonus,z.currentHP=Math.max(1,Math.min(z.currentHP-_.hpBonus,z.maxHP))),z.activeStates=z.activeStates.filter((O,Z)=>Z!==k)}return z})}function Ae(k,z="self"){const _=b(k.spellRef);if(!_){Ut.add("Spell not found","error");return}const O=k.castAtLevel||_.level;if(O>0){let D=!1;if(k.source==="racial"){if(D=Y(k.name),!D){Ut.add(`No uses of ${k.name} remaining!`,"error");return}}else if(D=I(O),!D){Ut.add(`No level ${O} spell slots available!`,"error");return}}const Z=ur(_);if(!Z){Ut.add(`${_.name} cast! Check spell description for effects.`,"info");return}let ie=Z.hpBonus||0,he=Z.description;_.name==="Aid"&&O>_.level&&(ie=5+(O-_.level)*5,he=`+${ie} HP (max and current) for 8 hours`);const Te=["Shield of Faith","Bless","Aid","Magic Weapon"].includes(_.name);de.update(D=>{D.activeStates||(D.activeStates=[]);const te=D.activeStates.find(De=>De.name===_.name);return te&&te.hpBonus&&te.target!=="other"&&(D.maxHP-=te.hpBonus,D.currentHP=Math.max(1,Math.min(D.currentHP-te.hpBonus,D.maxHP))),D.activeStates=D.activeStates.filter(De=>De.name!==_.name),ie>0&&z==="self"&&(D.maxHP+=ie,D.currentHP+=ie),D.activeStates=[...D.activeStates,{name:_.name,attackBonus:Z.attackBonus,damageBonus:Z.damageBonus,acBonus:Z.acBonus,description:he,target:z,hpBonus:ie}],D});const se=z==="self"?" on self":" on other";Ut.add(`${_.name} cast${Te?se:""}! Effect added to Active Spell Effects.`,"success")}Ye(()=>t(),()=>{n(y,t().activeStates?t().activeStates.filter(k=>k.abilities&&k.abilities.length>0).flatMap(k=>k.abilities.map(z=>({...z,conditionName:k.name}))):[])}),Ye(()=>(t(),e(E),e(A)),()=>{if(t()&&t().attacks)for(const k of t().attacks)k.spellRef&&e(E)[k.id]===void 0&&ba(E,e(E)[k.id]=!0),k.spellRef&&e(A)[k.id]===void 0&&ba(A,e(A)[k.id]="self")}),Ye(()=>(t(),v()),()=>{n(h,t().attacks.filter(k=>{if(!v())return!0;const z=v().toLowerCase();return k.name.toLowerCase().includes(z)||k.damageType.toLowerCase().includes(z)}).sort((k,z)=>!k.spellRef&&z.spellRef?-1:k.spellRef&&!z.spellRef?1:0))}),Ye(()=>(v(),e(h)),()=>{n(W,!v()||e(h).length>0||"attack".includes(v().toLowerCase())||"spell".includes(v().toLowerCase()))}),pa(),zt();var qe=ui(),tt=we(qe);let pt;var it=l(tt);{let k=Ct(()=>(f(),i(()=>f().attacks?"Expand":"Collapse")));Sa(it,{title:"Attacks & Spells",get collapsed(){return f(),i(()=>f().attacks)},get ariaLabel(){return e(k)},onToggle:()=>aa.update(z=>({...z,attacks:!z.attacks}))})}var Ve=a(it,2);{var yt=k=>{var z=di(),_=we(z);{var O=ae=>{var u=pr(),Je=l(u),xe=a(Je,2);{var G=be=>{var le=fr();R("click",le,ve),o(be,le)};g(xe,be=>{t(),i(()=>t().attacks.length>0)&&be(G)})}s(u),R("click",Je,V),o(ae,u)};g(_,ae=>{p()&&ae(O)})}var Z=a(_,2),ie=l(Z);$t(ie,1,()=>e(h),ae=>ae.id,(ae,u,Je)=>{var xe=Zr(),G=l(xe),be=l(G);{var le=fe=>{var ne=mr();Ce(ne),Ne(ne,()=>e(u).name,Ze=>(e(u).name=Ze,qt(()=>(e(h),t(),v())))),o(fe,ne)},Me=fe=>{var ne=gr(),Ze=l(ne,!0);s(ne),L(()=>S(Ze,(e(u),i(()=>e(u).name||"(Unnamed Attack)")))),o(fe,ne)};g(be,fe=>{p()?fe(le):fe(Me,!1)})}var ke=a(be,2);{var We=fe=>{var ne=br();R("click",ne,()=>Be(e(u).id)),o(fe,ne)};g(ke,fe=>{p()&&fe(We)})}s(G);var Oe=a(G,2),Xe=l(Oe);{var ot=fe=>{var ne=hr(),Ze=l(ne),ht=a(Ze,2);Ce(ht),s(ne),L(()=>{et(Ze,"for",`attack-bonus-${e(u),i(()=>e(u).id)??""}`),et(ht,"id",`attack-bonus-${e(u),i(()=>e(u).id)??""}`)}),Ne(ht,()=>e(u).bonus,M=>(e(u).bonus=M,qt(()=>(e(h),t(),v())))),o(fe,ne)};g(Xe,fe=>{e(u),i(()=>e(u).bonus!==0&&e(u).bonus!==void 0)&&fe(ot)})}var oe=a(Xe,2);{var j=fe=>{var ne=_r(),Ze=l(ne),ht=a(Ze,2);Ce(ht),s(ne),L(()=>{et(Ze,"for",`attack-damage-${e(u),i(()=>e(u).id)??""}`),et(ht,"id",`attack-damage-${e(u),i(()=>e(u).id)??""}`)}),Ne(ht,()=>e(u).damage,M=>(e(u).damage=M,qt(()=>(e(h),t(),v())))),o(fe,ne)};g(oe,fe=>{e(u),i(()=>e(u).damage&&e(u).damage.trim()!=="")&&fe(j)})}var q=a(oe,2),J=l(q),re=a(J,2);Ce(re),s(q),s(Oe);var Fe=a(Oe,2);{var Ge=fe=>{var ne=bt(),Ze=we(ne);{var ht=$e=>{var x=yr();o($e,x)},M=$e=>{const x=Ct(()=>(e(u),i(()=>b(e(u).spellRef))));var He=bt(),H=we(He);{var Bt=at=>{const pe=Ct(()=>(N(Wa),N(e(x)),i(()=>Wa(e(x))))),vt=Ct(()=>(N(is),N(e(x)),i(()=>is(e(x)))));var st=Er(),Ft=we(st),Ke=l(Ft),gt=a(l(Ke),2),xt=l(gt,!0);s(gt),s(Ke);var Ht=a(Ke,2);{var ra=lt=>{var It=kr(),Yt=l(It),Qt=a(l(Yt));s(Yt);var na=a(Yt,2),va=a(l(na));s(na);var da=a(na,2),Vt=a(l(da));s(da);var rt=a(da,2),dt=a(l(rt)),nt=a(dt);{var Tt=kt=>{var Jt=Pt();L(()=>S(Jt,`(${N(e(x)),i(()=>e(x).material)??""})`)),o(kt,Jt)};g(nt,kt=>{N(e(x)),i(()=>e(x).material)&&kt(Tt)})}s(rt);var Et=a(rt,2),ua=a(l(Et),2);{var Nt=kt=>{var Jt=Pt("Concentration,");o(kt,Jt)};g(ua,kt=>{N(e(x)),i(()=>e(x).concentration)&&kt(Nt)})}var la=a(ua,1,!0);s(Et);var Gt=a(Et,2),fa=a(l(Gt));s(Gt);var ma=a(Gt,2);{var ka=kt=>{var Jt=xr(),ga=a(l(Jt));s(Jt),L(()=>S(ga,` ${N(e(x)),i(()=>e(x).higherLevelSlot)??""}`)),o(kt,Jt)};g(ma,kt=>{N(e(x)),i(()=>e(x).higherLevelSlot)&&kt(ka)})}var Zt=a(ma,2);{var ea=kt=>{var Jt=Sr(),ga=we(Jt);{var Ba=Ca=>{var Ma=$r();o(Ca,Ma)};g(ga,Ca=>{e(u),N(e(x)),i(()=>e(u).racialTraitName==="Githyanki Psionics"&&e(x).name==="Mage Hand")&&Ca(Ba)})}var Ta=a(ga,2);{var Za=Ca=>{var Ma=wr(),Hs=a(l(Ma));s(Ma),L(()=>S(Hs,` ${e(u),i(()=>e(u).racialTraitName)??""}`)),o(Ca,Ma)};g(Ta,Ca=>{e(u),i(()=>e(u).racialTraitName)&&Ca(Za)})}o(kt,Jt)};g(Zt,kt=>{e(u),i(()=>e(u).source==="racial")&&kt(ea)})}s(It),L(kt=>{S(Qt,` ${N(e(x)),i(()=>e(x).level)??""}`),S(va,` ${N(e(x)),i(()=>e(x).castingTime||e(x).actionType)??""}`),S(Vt,` ${N(e(x)),i(()=>e(x).range)??""}`),S(dt,` ${kt??""}`),S(la,(N(e(x)),i(()=>e(x).duration))),S(fa,` ${N(e(x)),i(()=>e(x).description)??""}`)},[()=>(N(e(x)),i(()=>e(x).components.join(", ")))]),o(lt,It)};g(Ht,lt=>{e(E),e(u),i(()=>!e(E)[e(u).id])&&lt(ra)})}s(Ft);var St=a(Ft,2);{var Rt=lt=>{var It=jr(),Yt=l(It),Qt=l(Yt);Ce(Qt);var na=a(Qt),va=a(na);{var da=nt=>{var Tt=Cr(),Et=l(Tt);s(Tt),L(ua=>S(Et,`(Spell Save DC: ${ua??""})`),[()=>(N(ds),t(),i(()=>ds(t(),t().abilities)))]),o(nt,Tt)};g(va,nt=>{t(),i(()=>t().class)&&nt(da)})}var Vt=a(va,2);{var rt=nt=>{var Tt=Dr();o(nt,Tt)},dt=nt=>{var Tt=bt(),Et=we(Tt);{var ua=Nt=>{var la=Lr();o(Nt,la)};g(Et,Nt=>{e(u),N(e(pe)),i(()=>e(u).targetSucceededSave&&e(pe).noDamageOnSave)&&Nt(ua)},!0)}o(nt,Tt)};g(Vt,nt=>{e(u),N(e(pe)),i(()=>e(u).targetSucceededSave&&e(pe).halfDamageOnSave)?nt(rt):nt(dt,!1)})}s(Yt),s(It),L(nt=>S(na,` Target succeeded on ${nt??""} save `),[()=>(N(e(pe)),i(()=>e(pe).ability.charAt(0).toUpperCase()+e(pe).ability.slice(1)))]),La(Qt,()=>e(u).targetSucceededSave,nt=>(e(u).targetSucceededSave=nt,qt(()=>(e(h),t(),v())))),o(lt,It)};g(St,lt=>{e(pe)&&lt(Rt)})}var sa=a(St,2);{var ia=lt=>{var It=Br(),Yt=l(It),Qt=l(Yt);Ce(Qt);var na=a(Qt,2);{var va=Vt=>{const rt=Ct(()=>(e(u),N(e(x)),i(()=>Se(e(u),e(x)))));var dt=Ar(),nt=l(dt);s(dt),L(()=>S(nt,`(${N(e(vt)),i(()=>e(vt).alternateDamage)??""}, total: ${e(rt)??""})`)),o(Vt,dt)},da=Vt=>{var rt=Rr(),dt=l(rt);s(rt),L(()=>S(dt,`(${N(e(vt)),i(()=>e(vt).baseDamage)??""})`)),o(Vt,rt)};g(na,Vt=>{e(u),i(()=>e(u).targetIsDamaged)?Vt(va):Vt(da,!1)})}s(Yt),s(It),La(Qt,()=>e(u).targetIsDamaged,Vt=>(e(u).targetIsDamaged=Vt,qt(()=>(e(h),t(),v())))),o(lt,It)};g(sa,lt=>{e(vt)&&lt(ia)})}var Xt=a(sa,2);{var Lt=lt=>{const It=Ct(()=>(N(e(x)),i(()=>je(e(x)))));var Yt=bt(),Qt=we(Yt);{var na=va=>{var da=Ir(),Vt=we(da),rt=l(Vt),dt=a(rt,2);L(()=>{e(u),qt(()=>{e(It)})}),$t(dt,5,()=>e(It),jt,(Nt,la)=>{var Gt=Tr(),fa=l(Gt);s(Gt);var ma={};L(()=>{S(fa,`Level ${e(la)??""}`),ma!==(ma=e(la))&&(Gt.value=(Gt.__value=e(la))??"")}),o(Nt,Gt)}),s(dt);var nt=a(dt,2);{var Tt=Nt=>{const la=Ct(()=>(e(u),N(e(x)),i(()=>Se(e(u),e(x)))));var Gt=Mr(),fa=l(Gt);{var ma=ea=>{var kt=Pt("Healing");o(ea,kt)},ka=ea=>{var kt=Pt("Damage");o(ea,kt)};g(fa,ea=>{N(e(x)),i(()=>ue(e(x)))?ea(ma):ea(ka,!1)})}var Zt=a(fa);s(Gt),L(()=>S(Zt,` ${e(la)??""}`)),o(Nt,Gt)};g(nt,Nt=>{e(u),N(e(x)),i(()=>e(u).castAtLevel&&e(u).castAtLevel>e(x).level)&&Nt(Tt)})}s(Vt);var Et=a(Vt,2);{var ua=Nt=>{var la=Pr(),Gt=l(la),fa=l(Gt);Ce(fa);var ma=a(fa,2);{var ka=Zt=>{const ea=Ct(()=>(e(u),N(e(x)),i(()=>Se(e(u),e(x)))));var kt=Fr(),Jt=l(kt);s(kt),L(()=>S(Jt,`(+1d8, total: ${e(ea)??""})`)),o(Zt,kt)};g(ma,Zt=>{e(u),i(()=>e(u).targetIsFiendOrUndead)&&Zt(ka)})}s(Gt),s(la),La(fa,()=>e(u).targetIsFiendOrUndead,Zt=>(e(u).targetIsFiendOrUndead=Zt,qt(()=>(e(h),t(),v())))),o(Nt,la)};g(Et,Nt=>{N(e(x)),i(()=>e(x).description.includes("Fiend or an Undead"))&&Nt(ua)})}L(()=>{et(rt,"for",`castLevel-${e(u),i(()=>e(u).id)??""}`),et(dt,"id",`castLevel-${e(u),i(()=>e(u).id)??""}`)}),Ha(dt,()=>e(u).castAtLevel,Nt=>(e(u).castAtLevel=Nt,qt(()=>(e(h),t(),v())))),o(va,da)};g(Qt,va=>{N(e(It)),e(Q),e(u),i(()=>e(It).length>0&&!e(Q)[e(u).id])&&va(na)})}o(lt,Yt)};g(Xt,lt=>{N(e(x)),i(()=>e(x).higherLevelSlot&&e(x).level>0)&&lt(Lt)})}L(()=>{et(gt,"aria-label",(e(E),e(u),i(()=>e(E)[e(u).id]?"Expand":"Collapse"))),S(xt,(e(E),e(u),i(()=>e(E)[e(u).id]?"‚ñº":"‚ñ≤")))}),R("click",Ke,()=>F(e(u).id)),R("keydown",Ke,lt=>lt.key==="Enter"&&F(e(u).id)),o(at,st)},_t=at=>{var pe=Ur();o(at,pe)};g(H,at=>{e(x)?at(Bt):at(_t,!1)})}o($e,He)};g(Ze,$e=>{e($),i(()=>e($).length===0)?$e(ht):$e(M,!1)})}o(fe,ne)};g(Fe,fe=>{e(u),i(()=>e(u).spellRef)&&fe(Ge)})}var Pe=a(Fe,2);{var Re=fe=>{var ne=bt(),Ze=we(ne);{var ht=M=>{var $e=Hr(),x=l($e),He=a(x,2);ja(He),s($e),L(()=>{et(x,"for",`attack-notes-${e(u),i(()=>e(u).id)??""}`),et(He,"id",`attack-notes-${e(u),i(()=>e(u).id)??""}`)}),Ne(He,()=>e(u).notes,H=>(e(u).notes=H,qt(()=>(e(h),t(),v())))),o(M,$e)};g(Ze,M=>{e(u),i(()=>e(u).notes&&e(u).notes.trim()!=="")&&M(ht)})}o(fe,ne)};g(Pe,fe=>{e(u),i(()=>!e(u).spellRef)&&fe(Re)})}var ct=a(Pe,2),ft=l(ct);{var Ie=fe=>{const ne=Ct(()=>(e(u),i(()=>b(e(u).spellRef))));var Ze=bt(),ht=we(Ze);{var M=$e=>{const x=Ct(()=>(t(),e(u),i(()=>t().racialTraits&&t().racialTraits.uses[e(u).name])));var He=Yr(),H=we(He);{var Bt=Ke=>{var gt=Nr(),xt=l(gt),Ht=l(xt);Ce(Ht);var ra=a(Ht,2),St=l(ra);s(ra),s(xt),s(gt),L(()=>S(St,`(${N(e(x)),i(()=>e(x).currentUses)??""}/${N(e(x)),i(()=>e(x).maxUses)??""} uses left)`)),La(Ht,()=>e(Q)[e(u).id],Rt=>ba(Q,e(Q)[e(u).id]=Rt)),R("change",Ht,()=>{n(Q,{...e(Q)})}),o(Ke,gt)};g(H,Ke=>{e(u),N(e(x)),i(()=>e(u).source==="racial"&&e(x))&&Ke(Bt)})}var _t=a(H,2);{var at=Ke=>{var gt=bt(),xt=we(gt);{var Ht=St=>{var Rt=bt(),sa=we(Rt);{var ia=Lt=>{var lt=Or();R("click",lt,()=>T(e(u),!1)),o(Lt,lt)},Xt=Lt=>{var lt=Gr();o(Lt,lt)};g(sa,Lt=>{t(),N(e(ne)),i(()=>t().classFeatures&&t().classFeatures.spellSlotsByLevel&&t().classFeatures.spellSlotsByLevel[e(ne).level]?.some(lt=>!lt))?Lt(ia):Lt(Xt,!1)})}o(St,Rt)},ra=St=>{var Rt=bt(),sa=we(Rt);{var ia=Lt=>{var lt=qr();R("click",lt,()=>T(e(u),!0)),o(Lt,lt)},Xt=Lt=>{var lt=zr();o(Lt,lt)};g(sa,Lt=>{N(e(x)),i(()=>e(x)&&e(x).currentUses>0)?Lt(ia):Lt(Xt,!1)})}o(St,Rt)};g(xt,St=>{e(Q),e(u),i(()=>!e(Q)[e(u).id])?St(Ht):St(ra,!1)})}o(Ke,gt)};g(_t,Ke=>{N(Da),N(e(ne)),i(()=>Da(e(ne)))&&Ke(at)})}var pe=a(_t,2);{var vt=Ke=>{var gt=bt(),xt=we(gt);{var Ht=St=>{var Rt=Wr(),sa=l(Rt),ia=l(sa),Xt=l(ia);Ce(Xt),Xt.value=Xt.__value="self",ta(),s(ia);var Lt=a(ia,2),lt=l(Lt);Ce(lt),lt.value=lt.__value="other",ta(),s(Lt),s(sa);var It=a(sa,2),Yt=l(It);s(It),s(Rt),L(()=>{et(Xt,"name",`target-${e(u),i(()=>e(u).id)??""}`),et(lt,"name",`target-${e(u),i(()=>e(u).id)??""}`),S(Yt,`Cast ${N(e(ne)),i(()=>e(ne).name)??""}`)}),$s(P,[Je],Xt,()=>e(A)[e(u).id],Qt=>ba(A,e(A)[e(u).id]=Qt)),$s(P,[Je],lt,()=>e(A)[e(u).id],Qt=>ba(A,e(A)[e(u).id]=Qt)),R("click",It,()=>Ae(e(u),e(A)[e(u).id])),o(St,Rt)},ra=St=>{var Rt=Kr();R("click",Rt,()=>Ae(e(u),"self")),o(St,Rt)};g(xt,St=>{N(e(ne)),i(()=>Ue(e(ne).name))?St(Ht):St(ra,!1)})}o(Ke,gt)};g(pe,Ke=>{N(Da),N(e(ne)),N(Ka),i(()=>!Da(e(ne))&&Ka(e(ne)))&&Ke(vt)})}var st=a(pe,2);{var Ft=Ke=>{var gt=bt(),xt=we(gt);{var Ht=St=>{var Rt=Vr(),sa=l(Rt);{var ia=Lt=>{var lt=Pt("Roll Healing");o(Lt,lt)},Xt=Lt=>{var lt=Pt("Roll Damage");o(Lt,lt)};g(sa,Lt=>{N(e(ne)),i(()=>ue(e(ne)))?Lt(ia):Lt(Xt,!1)})}s(Rt),L(Lt=>Mt(Rt,1,`btn ${Lt??""}`),[()=>(N(e(ne)),i(()=>ue(e(ne))?"btn-success":"btn-secondary"))]),R("click",Rt,()=>U(e(u))),o(St,Rt)},ra=St=>{var Rt=Jr();R("click",Rt,()=>Ae(e(u),"self")),o(St,Rt)};g(xt,St=>{e(u),i(()=>e(u).damage&&e(u).damage.trim()!=="")?St(Ht):St(ra,!1)})}o(Ke,gt)};g(st,Ke=>{N(Da),N(e(ne)),N(Ka),i(()=>!Da(e(ne))&&!Ka(e(ne)))&&Ke(Ft)})}o($e,He)};g(ht,$e=>{e(ne)&&$e(M)})}o(fe,Ze)};g(ft,fe=>{e(u),e(X),i(()=>e(u).spellRef&&e(X))&&fe(Ie)})}var Ee=a(ft,2);{var wt=fe=>{var ne=Xr(),Ze=we(ne),ht=a(Ze,2);{var M=$e=>{var x=Qr();R("click",x,()=>U(e(u))),o($e,x)};g(ht,$e=>{e(u),i(()=>e(u).damage&&e(u).damage.trim()!=="")&&$e(M)})}R("click",Ze,()=>T(e(u))),o(fe,ne)};g(Ee,fe=>{e(u),i(()=>!e(u).spellRef)&&fe(wt)})}s(ct),s(xe),L(()=>{et(J,"for",`attack-type-${e(u),i(()=>e(u).id)??""}`),et(re,"id",`attack-type-${e(u),i(()=>e(u).id)??""}`)}),Ne(re,()=>e(u).damageType,fe=>(e(u).damageType=fe,qt(()=>(e(h),t(),v())))),o(ae,xe)});var he=a(ie,2);{var _e=ae=>{var u=ei();o(ae,u)};g(he,ae=>{t(),i(()=>t().attacks.length===0)&&ae(_e)})}var Te=a(he,2);{var se=ae=>{var u=ti();o(ae,u)};g(Te,ae=>{e(h),t(),i(()=>e(h).length===0&&t().attacks.length>0)&&ae(se)})}s(Z);var D=a(Z,2);{var te=ae=>{var u=ii(),Je=a(l(u),4);$t(Je,5,()=>e(y),jt,(xe,G)=>{var be=ri(),le=l(be),Me=l(le),ke=l(Me,!0);s(Me);var We=a(Me,2),Oe=l(We);s(We),s(le);var Xe=a(le,2),ot=l(Xe,!0);s(Xe);var oe=a(Xe,2),j=l(oe);{var q=Pe=>{var Re=ai(),ct=l(Re),ft=a(ct);{var Ie=Ee=>{var wt=Pt();L(()=>S(wt,`per ${e(G),i(()=>e(G).restType)??""} rest`)),o(Ee,wt)};g(ft,Ee=>{e(G),i(()=>e(G).restType)&&Ee(Ie)})}s(Re),L(()=>S(ct,`${e(G),i(()=>e(G).currentUses??e(G).usesPerRest)??""}/${e(G),i(()=>e(G).usesPerRest)??""} uses `)),o(Pe,Re)};g(j,Pe=>{e(G),i(()=>e(G).usesPerRest)&&Pe(q)})}var J=a(j,2);{var re=Pe=>{var Re=si();o(Pe,Re)};g(J,Pe=>{e(G),i(()=>e(G).requiresReaction)&&Pe(re)})}var Fe=a(J,2);{var Ge=Pe=>{var Re=li();L(()=>Re.disabled=(e(G),i(()=>e(G).currentUses===void 0||e(G).currentUses===0))),R("click",Re,()=>ee(e(G).conditionName,e(G).name)),o(Pe,Re)};g(Fe,Pe=>{p(),e(G),i(()=>!p()&&e(G).usesPerRest)&&Pe(Ge)})}s(oe),s(be),L(()=>{S(ke,(e(G),i(()=>e(G).name))),S(Oe,`(${e(G),i(()=>e(G).conditionName)??""})`),S(ot,(e(G),i(()=>e(G).description)))}),o(xe,be)}),s(Je),s(u),o(ae,u)};g(D,ae=>{e(y),i(()=>e(y).length>0)&&ae(te)})}var De=a(D,2),ze=a(l(De),4),Qe=a(ze,2);{var mt=ae=>{var u=ci();$t(u,5,()=>(t(),i(()=>t().activeStates)),jt,(Je,xe,G)=>{var be=oi(),le=l(be),Me=l(le);Ce(Me);var ke=a(Me,2);{var We=Ee=>{var wt=ni();R("click",wt,()=>ce(G)),o(Ee,wt)};g(ke,Ee=>{p()&&Ee(We)})}s(le);var Oe=a(le,2),Xe=l(Oe),ot=l(Xe);et(ot,"for",`state-attack-bonus-${G}`);var oe=a(ot,2);Ce(oe),et(oe,"id",`state-attack-bonus-${G}`),s(Xe);var j=a(Xe,2),q=l(j);et(q,"for",`state-damage-bonus-${G}`);var J=a(q,2);Ce(J),et(J,"id",`state-damage-bonus-${G}`),s(j);var re=a(j,2),Fe=l(re);et(Fe,"for",`state-target-${G}`);var Ge=a(Fe,2);L(()=>{e(xe),qt(()=>{})}),et(Ge,"id",`state-target-${G}`);var Pe=l(Ge);Pe.value=Pe.__value="self";var Re=a(Pe);Re.value=Re.__value="other",s(Ge),s(re),s(Oe);var ct=a(Oe,2),ft=l(ct);et(ft,"for",`state-desc-${G}`);var Ie=a(ft,2);Ce(Ie),et(Ie,"id",`state-desc-${G}`),s(ct),s(be),Ne(Me,()=>e(xe).name,Ee=>(e(xe).name=Ee,qt(()=>t()),Fa(m,"$character"))),Ne(oe,()=>e(xe).attackBonus,Ee=>(e(xe).attackBonus=Ee,qt(()=>t()),Fa(m,"$character"))),Ne(J,()=>e(xe).damageBonus,Ee=>(e(xe).damageBonus=Ee,qt(()=>t()),Fa(m,"$character"))),Ha(Ge,()=>e(xe).target,Ee=>(e(xe).target=Ee,qt(()=>t()),Fa(m,"$character"))),Ne(Ie,()=>e(xe).description,Ee=>(e(xe).description=Ee,qt(()=>t()),Fa(m,"$character"))),o(Je,be)}),s(u),o(ae,u)},ye=ae=>{var u=vi();o(ae,u)};g(Qe,ae=>{t(),i(()=>t().activeStates&&t().activeStates.length>0)?ae(mt):ae(ye,!1)})}s(De),R("click",ze,me),o(k,z)};g(Ve,k=>{f(),i(()=>!f().attacks)&&k(yt)})}s(tt);var Dt=a(tt,2);nr(Dt,{get show(){return e(B)},get attacks(){return t(),i(()=>t().attacks)},onSave:Le,onCancel:ge}),L(()=>pt=Mt(tt,1,"attacks svelte-14o91c5",null,pt,{hidden:!e(W)})),o(r,qe),Kt(),w()}var pi=d('<span class="slot-checkbox-x svelte-serp1j">&#8212;</span>'),mi=d('<label><input type="checkbox" class="slot-checkbox-input svelte-serp1j"/> <span><!></span></label>');function Ls(r,c){Wt(c,!1);const t=()=>ut(xa,"$isEditMode",v),[v,f]=ca();let p=At(c,"checked",8,!1),m=At(c,"disabled",8,!1),w=At(c,"className",8,""),y=At(c,"index",8,void 0),h=At(c,"ariaLabel",8,void 0);const W=$a();function P(B){W("change",{checked:B.currentTarget.checked,index:y()})}zt();var Q=mi(),ee=l(Q);Ce(ee);var K=a(ee,2),E=l(K);{var A=B=>{var F=pi();o(B,F)};g(E,B=>{p()&&B(A)})}s(K),s(Q),L(()=>{Mt(Q,1,"slot-checkbox-label "+w()+(t()?"":" not-editable"),"svelte-serp1j"),Fs(ee,p()),ee.disabled=m()||!t(),et(ee,"aria-label",h()),et(ee,"tabindex",t()?0:-1),Mt(K,1,`slot-checkbox-custom ${p()?"used":""} ${t()?"":"readonly"}`,"svelte-serp1j")}),R("change",ee,P),o(r,Q),Kt(),f()}var gi=d('<span style="color:#007bff; margin-left:0.5em;"> </span>'),bi=d("<li><strong> </strong> <!></li>"),hi=d('<div class="racial-traits"><h4>Racial Traits</h4> <ul></ul></div>'),_i=d("<li> </li>"),yi=d('<div class="racial-resistances"><h4>Racial Resistances</h4> <ul></ul></div>'),xi=d("<!> <!>",1);function $i(r,c){Wt(c,!1);const t=()=>ut(de,"$character",v),[v,f]=ca(),p=C(),m=C();let w=C(),y=C();wa(()=>{t().race&&t().level&&(hs(),es(),n(w,t().race),n(y,t().level))}),Ye(()=>(t(),e(w),e(y),es),()=>{t().race&&t().level&&(t().race!==e(w)||t().level!==e(y))&&(hs(),es(),n(w,t().race),n(y,t().level))}),Ye(()=>(t(),Va),()=>{n(p,(()=>{const K=t().activeStates?t().activeStates.filter(B=>B.name&&B.name.toLowerCase().includes("racial")).flatMap(B=>B.resistances||[]):[],E=Va(t().race||""),A=E?E.traits.flatMap(B=>B.resistances||[]):[];return Array.from(new Set([...K,...A]))})())}),Ye(()=>t(),()=>{n(m,(()=>{const K=Va(t().race||"");return K?K.traits:[]})())}),pa(),zt();var h=xi(),W=we(h);{var P=K=>{var E=hi(),A=a(l(E),2);$t(A,5,()=>e(m),jt,(B,F)=>{var ue=bi(),Ue=l(ue),V=l(Ue);s(Ue);var Be=a(Ue),ve=a(Be);{var ge=Le=>{var T=gi(),U=l(T);s(T),L($=>S(U,`(Resistances: ${$??""})`),[()=>(e(F),i(()=>e(F).resistances.map($=>$.charAt(0).toUpperCase()+$.slice(1)).join(", ")))]),o(Le,T)};g(ve,Le=>{e(F),i(()=>e(F).resistances&&e(F).resistances.length>0)&&Le(ge)})}s(ue),L(()=>{S(V,`${e(F),i(()=>e(F).name)??""}:`),S(Be,` ${e(F),i(()=>e(F).description)??""} `)}),o(B,ue)}),s(A),s(E),o(K,E)};g(W,K=>{e(m),i(()=>e(m).length>0)&&K(P)})}var Q=a(W,2);{var ee=K=>{var E=yi(),A=a(l(E),2);$t(A,5,()=>e(p),jt,(B,F)=>{var ue=_i(),Ue=l(ue,!0);s(ue),L(V=>S(Ue,V),[()=>(e(F),i(()=>e(F).charAt(0).toUpperCase()+e(F).slice(1)))]),o(B,ue)}),s(A),s(E),o(K,E)};g(Q,K=>{e(p),i(()=>e(p).length>0)&&K(ee)})}o(r,h),Kt(),f()}var wi=d('<p class="no-features svelte-1kpvv0n">Select a class to see available features</p>'),Si=d('<p class="no-features svelte-1kpvv0n">No class features available at this level</p>'),ki=d('<div class="spell-slots svelte-1kpvv0n"><label class="svelte-1kpvv0n"> </label> <div class="slots-tracker svelte-1kpvv0n"></div></div>'),Ci=d('<div class="all-spell-slots"></div>'),Di=d('<div class="feature-box spellcasting svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"> </h3> <div class="spell-stats svelte-1kpvv0n"><div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Spell Save DC</label> <div class="spell-value svelte-1kpvv0n"> </div></div> <div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <div class="spell-value svelte-1kpvv0n"> </div></div></div> <!> <div class="prepared-spells svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <textarea placeholder="List your prepared spells..." class="svelte-1kpvv0n"></textarea></div></div>'),Li=d('<p class="unlimited svelte-1kpvv0n">Unlimited Uses</p>'),ji=d('<div class="slots-tracker svelte-1kpvv0n"></div> <div class="uses-actions-row"><button class="btn btn-primary use-enabled"> </button></div> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div>',1),Ai=d('<div class="uses-tracker svelte-1kpvv0n"><!></div>'),Ri=d('<div class="pool-tracker svelte-1kpvv0n"><input type="number" min="0" class="pool-input svelte-1kpvv0n"/> <span> </span> <button class="btn-small svelte-1kpvv0n"> </button></div>'),Bi=d('<p class="no-uses svelte-1kpvv0n">No Channel Divinity uses remaining</p>'),Ti=d('<div class="channel-divinity-option svelte-1kpvv0n"><button class="btn btn-primary use-enabled svelte-1kpvv0n">Use Channel Divinity</button> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div> <!></div>'),Mi=d('<div class="feature-box svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"><!> </h3> <p class="feature-description svelte-1kpvv0n"> </p> <!></div>'),Fi=d('<div class="features-grid svelte-1kpvv0n"><!> <!></div>'),Pi=d("<!> <!>",1),Ii=d("<section><!> <!></section>");function Ei(r,c){Wt(c,!1);const t=()=>ut(de,"$character",m),v=()=>ut(Qa,"$abilityModifiers",m),f=()=>ut(_a,"$searchFilter",m),p=()=>ut(aa,"$collapsedStates",m),[m,w]=ca(),y=C(),h=C(),W=C(),P=C(),Q=C(),ee=C(),K=C();let E=C(0),A=C(0);function B(b,I){de.update(Y=>(Y.classFeatures.features[b]=I,Y))}function F(){de.update(b=>(b.classFeatures.spellSlotsByLevel||(b.classFeatures.spellSlotsByLevel={}),e(P).forEach(({level:I,slots:Y})=>{b.classFeatures.spellSlotsByLevel[I]||(b.classFeatures.spellSlotsByLevel[I]=Array(Y).fill(!1))}),b))}function ue(b){if(typeof b.maxUses=="function"){if((b.name==="Divine Sense"||b.name==="War Priest")&&e(y)?.spellcastingAbility){const I=v()[e(y).spellcastingAbility];return b.maxUses(t().level,I)}return b.maxUses(t().level)}return b.maxUses||0}function Ue(b,I){de.update(Y=>((!Y.classFeatures.features[b]||!Array.isArray(Y.classFeatures.features[b])||Y.classFeatures.features[b].length!==I)&&(Y.classFeatures.features[b]=Array(I).fill(!1)),Y))}Gs(()=>{e(ee)&&t()&&t().classFeatures&&t().classFeatures.features&&e(ee).forEach(b=>{if(b.type==="uses"){const I=b.name.replace(/\s+/g,""),Y=ue(b),Se=t().classFeatures.features[I];(!Array.isArray(Se)||Se.length!==Y)&&Ue(I,Y)}})});function V(b){return typeof b.maxPool=="function"?b.maxPool(t().level):b.maxPool||0}function Be(b){return typeof b.description=="function"?b.description(t().level):b.description}function ve(){const b="ChannelDivinity";de.update(I=>{const Y=I.classFeatures.features[b];return typeof Y=="number"&&Y>0&&(I.classFeatures.features[b]=Y-1),I})}function ge(){aa.update(b=>({...b,classFeatures:!b.classFeatures}))}Ye(()=>(t(),oa),()=>{n(y,t().class?oa(t().class):null)}),Ye(()=>(t(),Ra),()=>{n(h,t().class?Ra(t().class,t().level,t().subclass):[])}),Ye(()=>(t(),ks),()=>{n(W,t().class?ks(t().class,t().level):0)}),Ye(()=>(e(y),t()),()=>{n(P,(()=>{if(!e(y)?.spellcaster)return[];const b=t().level,I=[];return b>=1&&I.push({level:1,slots:Math.min(4,2+Math.floor(b/3))}),b>=3&&I.push({level:2,slots:Math.min(3,2+Math.floor((b-3)/4))}),b>=5&&I.push({level:3,slots:Math.min(3,2+Math.floor((b-5)/5))}),b>=7&&I.push({level:4,slots:Math.min(3,1+Math.floor((b-7)/6))}),b>=9&&I.push({level:5,slots:Math.min(2,1+Math.floor((b-9)/8))}),b>=11&&I.push({level:6,slots:1}),b>=13&&I.push({level:7,slots:1}),b>=15&&I.push({level:8,slots:1}),b>=17&&I.push({level:9,slots:1}),I})())}),Ye(()=>(e(y),v(),t(),Cs),()=>{if(e(y)?.spellcaster&&e(y).spellcastingAbility){const b=v()[e(y).spellcastingAbility];n(E,wl(t().class,b,t().proficiencyBonus)||0),n(A,Cs(t().class,t().level,b))}}),Ye(()=>(t(),e(y),e(P)),()=>{t().class&&e(y)?.spellcaster&&e(P).length>0&&F()}),Ye(()=>t(),()=>{n(Q,(()=>{const I=t().classFeatures.features["ChannelDivinity"];return typeof I=="number"?I:0})())}),Ye(()=>(e(h),f()),()=>{n(ee,e(h).filter(b=>{if(!f())return!0;const I=f().toLowerCase();return b.name.toLowerCase().includes(I)||Be(b).toLowerCase().includes(I)}))}),Ye(()=>(f(),t(),e(ee)),()=>{n(K,!f()||t().class||"class features".includes(f().toLowerCase())||"spellcasting".includes(f().toLowerCase())||e(ee).length>0)}),pa(),zt();var Le=Ii();let T;var U=l(Le);{let b=Ct(()=>(p(),i(()=>p().classFeatures?"Expand":"Collapse")));Sa(U,{title:"Class Features",get collapsed(){return p(),i(()=>p().classFeatures)},get ariaLabel(){return e(b)},onToggle:ge})}var $=a(U,2);{var X=b=>{var I=Pi(),Y=we(I);$i(Y,{});var Se=a(Y,2);{var je=ce=>{var Ae=wi();o(ce,Ae)},me=ce=>{var Ae=bt(),qe=we(Ae);{var tt=it=>{var Ve=Si();o(it,Ve)},pt=it=>{var Ve=Fi(),yt=l(Ve);{var Dt=z=>{var _=Di(),O=l(_),Z=l(O);s(O);var ie=a(O,2),he=l(ie),_e=a(l(he),2),Te=l(_e,!0);s(_e),s(he);var se=a(he,2),D=a(l(se),2),te=l(D,!0);s(D),s(se),s(ie);var De=a(ie,2);{var ze=ye=>{var ae=Ci();$t(ae,5,()=>e(P),jt,(u,Je)=>{let xe=()=>e(Je).level,G=()=>e(Je).slots;const be=Ct(()=>(t(),xe(),G(),i(()=>t().classFeatures.spellSlotsByLevel?.[xe()]||Array(G()).fill(!1))));var le=ki(),Me=l(le),ke=l(Me);s(Me);var We=a(Me,2);$t(We,5,()=>e(be),jt,(Oe,Xe,ot)=>{{let oe=Ct(()=>(N(e(be)),i(()=>e(be)[ot]||!1)));Ls(Oe,{get checked(){return e(oe)},$$events:{change:j=>{de.update(q=>(q.classFeatures.spellSlotsByLevel||(q.classFeatures.spellSlotsByLevel={}),q.classFeatures.spellSlotsByLevel[xe()]||(q.classFeatures.spellSlotsByLevel[xe()]=Array(G()).fill(!1)),q.classFeatures.spellSlotsByLevel[xe()][ot]=j.detail.checked,q))}}})}}),s(We),s(le),L(()=>S(ke,`${xe()===1?"1st":xe()===2?"2nd":xe()===3?"3rd":`${xe()}th`} Level Spell Slots`)),o(u,le)}),s(ae),o(ye,ae)};g(De,ye=>{e(P),i(()=>e(P).length>0)&&ye(ze)})}var Qe=a(De,2),mt=a(l(Qe),2);ja(mt),s(Qe),s(_),L(ye=>{S(Z,`Spellcasting (${ye??""})`),S(Te,e(E)),S(te,e(A))},[()=>(e(y),i(()=>e(y).spellcastingAbility?.toUpperCase()))]),Ne(mt,()=>t().classFeatures.preparedSpells,ye=>Ot(de,i(t).classFeatures.preparedSpells=ye,i(t))),o(z,_)};g(yt,z=>{e(y),i(()=>e(y)?.spellcaster)&&z(Dt)})}var k=a(yt,2);$t(k,1,()=>e(ee),jt,(z,_)=>{const O=Ct(()=>(e(_),i(()=>e(_).name.replace(/\s+/g,"")))),Z=Ct(()=>(t(),N(e(O)),i(()=>t().classFeatures.features[e(O)]))),ie=Ct(()=>typeof e(Z)=="number");var he=Mi(),_e=l(he),Te=l(_e);{var se=ye=>{var ae=Pt("Channel Divinity:");o(ye,ae)};g(Te,ye=>{e(_),i(()=>e(_).type==="channelDivinity")&&ye(se)})}var D=a(Te);s(_e);var te=a(_e,2),De=l(te,!0);s(te);var ze=a(te,2);{var Qe=ye=>{const ae=Ct(()=>(e(_),i(()=>ue(e(_))))),u=Ct(()=>(N(e(Z)),N(e(ae)),i(()=>Array.isArray(e(Z))?e(Z):Array(e(ae)).fill(!1))));var Je=Ai(),xe=l(Je);{var G=le=>{var Me=Li();o(le,Me)},be=le=>{var Me=ji(),ke=we(Me);$t(ke,5,()=>e(u),jt,(q,J,re)=>{Ls(q,{get checked(){return e(J)},index:re,$$events:{change:Fe=>{de.update(Ge=>(Ge.classFeatures.features[e(O)]||(Ge.classFeatures.features[e(O)]=Array(e(ae)).fill(!1)),Ge.classFeatures.features[e(O)][re]=Fe.detail.checked,Ge))}}})}),s(ke);var We=a(ke,2),Oe=l(We),Xe=l(Oe);s(Oe),s(We);var ot=a(We,2),oe=l(ot),j=l(oe);s(oe),s(ot),L(q=>{Oe.disabled=q,S(Xe,`Use ${e(_),i(()=>e(_).name)??""}`),S(j,`Resets on ${e(_),i(()=>e(_).resetOn==="short"?"Short Rest":"Long Rest")??""}`)},[()=>(N(e(u)),i(()=>e(u).filter(q=>!q).length<=0))]),R("click",Oe,()=>{de.update(q=>{q.classFeatures.features[e(O)]||(q.classFeatures.features[e(O)]=Array(e(ae)).fill(!1));const J=q.classFeatures.features[e(O)],re=J.findIndex(Fe=>!Fe);return re!==-1&&(J[re]=!0),q})}),o(le,Me)};g(xe,le=>{e(ae)===1/0?le(G):le(be,!1)})}s(Je),o(ye,Je)},mt=ye=>{var ae=bt(),u=we(ae);{var Je=G=>{const be=Ct(()=>(e(_),i(()=>V(e(_)))));var le=Ri(),Me=l(le);Ce(Me);var ke=a(Me,2),We=l(ke);s(ke);var Oe=a(ke,2),Xe=l(Oe,!0);s(Oe),s(le),L(()=>{Ea(Me,e(ie)&&e(Z)!==void 0?e(Z):e(be)),et(Me,"max",e(be)),S(We,`/ ${e(be)??""}`),S(Xe,(e(_),i(()=>e(_).resetOn==="short"?"Short Rest":"Long Rest")))}),R("input",Me,ot=>{de.update(oe=>(oe.classFeatures.features[e(O)]=parseInt(ot.currentTarget.value)||0,oe))}),R("click",Oe,()=>B(e(O),e(be))),o(G,le)},xe=G=>{var be=bt(),le=we(be);{var Me=ke=>{var We=Ti(),Oe=l(We),Xe=a(Oe,2),ot=l(Xe),oe=l(ot);s(ot),s(Xe);var j=a(Xe,2);{var q=J=>{var re=Bi();o(J,re)};g(j,J=>{e(Q)<=0&&J(q)})}s(We),L(()=>{Oe.disabled=e(Q)<=0,S(oe,`Resets on ${e(_),i(()=>e(_).resetOn==="short"?"Short Rest":"Long Rest")??""}`)}),R("click",Oe,ve),o(ke,We)};g(le,ke=>{e(_),i(()=>e(_).type==="channelDivinity")&&ke(Me)},!0)}o(G,be)};g(u,G=>{e(_),i(()=>e(_).type==="pool")?G(Je):G(xe,!1)},!0)}o(ye,ae)};g(ze,ye=>{e(_),i(()=>e(_).type==="uses")?ye(Qe):ye(mt,!1)})}s(he),L(ye=>{S(D,` ${e(_),i(()=>e(_).name)??""}`),S(De,ye)},[()=>(e(_),i(()=>Be(e(_))))]),o(z,he)}),s(Ve),o(it,Ve)};g(qe,it=>{e(h),i(()=>e(h).length===0)?it(tt):it(pt,!1)},!0)}o(ce,Ae)};g(Se,ce=>{t(),i(()=>!t().class)?ce(je):ce(me,!1)})}o(b,I)};g($,b=>{p(),i(()=>!p().classFeatures)&&b(X)})}s(Le),L(()=>T=Mt(Le,1,"class-features svelte-1kpvv0n",null,T,{hidden:!e(K)})),o(r,Le),Kt(),w()}var Ui=d('<textarea placeholder="Enter features, traits, and special abilities..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Equipment</h3> <textarea placeholder="List your equipment and inventory..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Notes</h3> <textarea placeholder="Additional notes..." class="svelte-wttn0l"></textarea>',1),Hi=d("<section><!> <!></section>");function Ni(r,c){Wt(c,!1);const t=()=>ut(_a,"$searchFilter",p),v=()=>ut(de,"$character",p),f=()=>ut(aa,"$collapsedStates",p),[p,m]=ca(),w=C();function y(){aa.update(K=>({...K,notes:!K.notes}))}Ye(()=>(t(),v()),()=>{n(w,!t()||"features".includes(t().toLowerCase())||"traits".includes(t().toLowerCase())||"equipment".includes(t().toLowerCase())||"notes".includes(t().toLowerCase())||v().features.toLowerCase().includes(t().toLowerCase())||v().equipment.toLowerCase().includes(t().toLowerCase())||v().notes.toLowerCase().includes(t().toLowerCase()))}),pa(),zt();var h=Hi();let W;var P=l(h);{let K=Ct(()=>(f(),i(()=>f().notes?"Expand":"Collapse")));Sa(P,{title:"Features & Traits",get collapsed(){return f(),i(()=>f().notes)},get ariaLabel(){return e(K)},onToggle:y})}var Q=a(P,2);{var ee=K=>{var E=Ui(),A=we(E);ja(A);var B=a(A,4);ja(B);var F=a(B,4);ja(F),Ne(A,()=>v().features,ue=>Ot(de,i(v).features=ue,i(v))),Ne(B,()=>v().equipment,ue=>Ot(de,i(v).equipment=ue,i(v))),Ne(F,()=>v().notes,ue=>Ot(de,i(v).notes=ue,i(v))),o(K,E)};g(Q,K=>{f(),i(()=>!f().notes)&&K(ee)})}s(h),L(()=>W=Mt(h,1,"notes svelte-wttn0l",null,W,{hidden:!e(w)})),o(r,h),Kt(),m()}var Oi=d(" <!> <!> <!> <!> <!>",1),Gi=d('<div class="color-picker-section svelte-1r90jgp"><h3 class="svelte-1r90jgp">Dice Colors</h3> <div class="color-inputs svelte-1r90jgp"><div class="color-input-group svelte-1r90jgp"><label for="dice-color" class="svelte-1r90jgp">Dice Color</label> <input type="color" id="dice-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="label-color" class="svelte-1r90jgp">Label Color</label> <input type="color" id="label-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="desk-color" class="svelte-1r90jgp">Background Color</label> <input type="color" id="desk-color" class="svelte-1r90jgp"/></div></div></div>'),qi=d('<div class="loading svelte-1r90jgp"><p class="svelte-1r90jgp">Loading 3D dice...</p></div>'),zi=d('<div class="custom-dice-selector svelte-1r90jgp"><h3 class="svelte-1r90jgp">Choose Dice to Roll</h3> <div class="dice-inputs svelte-1r90jgp"><div class="dice-input-group svelte-1r90jgp"><label for="d4" class="svelte-1r90jgp">d4</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d4" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d6" class="svelte-1r90jgp">d6</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d6" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d8" class="svelte-1r90jgp">d8</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d8" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d10" class="svelte-1r90jgp">d10</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d10" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d12" class="svelte-1r90jgp">d12</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d12" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d20" class="svelte-1r90jgp">d20</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d20" min="0" max="10"/></div></div> <div class="dice-controls svelte-1r90jgp"><button class="btn btn-primary use-enabled svelte-1r90jgp"> </button> <button class="btn btn-secondary use-enabled svelte-1r90jgp">Reset</button></div></div>'),Wi=d('<h3 class="svelte-1r90jgp"> </h3>'),Ki=d('<h3 class="svelte-1r90jgp"> </h3>'),Vi=d('<h3 class="svelte-1r90jgp"> </h3>'),Ji=d('<h3 class="svelte-1r90jgp"> </h3>'),Yi=d('<span class="crit-badge svelte-1r90jgp">CRITICAL HIT!</span>'),Qi=d('<span class="crit-badge crit-fail svelte-1r90jgp">CRITICAL MISS!</span>'),Xi=d('<div class="bonus-item svelte-1r90jgp"><span class="bonus-value svelte-1r90jgp"> </span> <span class="bonus-source svelte-1r90jgp"> </span></div>'),Zi=d('<div class="bonus-breakdown svelte-1r90jgp"></div>'),en=d('<p class="modifier-text svelte-1r90jgp"> </p>'),tn=d('<div class="svelte-1r90jgp"><em class="svelte-1r90jgp">No damage is dealt on a critical miss.</em></div>'),an=d('<button class="btn btn-follow-up svelte-1r90jgp"> </button>'),sn=d('<button class="btn btn-guided-strike svelte-1r90jgp">‚ö° Use Guided Strike (+10)</button>'),ln=d('<div class="follow-up-actions svelte-1r90jgp"><!> <!></div>'),rn=d('<div class="result-header svelte-1r90jgp"><!> <!> <!></div> <div class="result-total svelte-1r90jgp"> </div> <div class="result-details svelte-1r90jgp"><!></div> <!> <!>',1),nn=d('<div role="button" tabindex="-1"><div class="modal-content svelte-1r90jgp" role="dialog" tabindex="0"><div class="modal-header svelte-1r90jgp"><h2 class="svelte-1r90jgp"><!></h2> <div class="header-buttons svelte-1r90jgp"><button class="color-btn svelte-1r90jgp" title="Customize dice colors">üé®</button> <button class="close-btn svelte-1r90jgp">√ó</button></div></div> <!> <!> <div class="dice-main-area svelte-1r90jgp"><div class="dice-container svelte-1r90jgp"></div> <!></div> <div><!></div></div></div>');function on(r,c){Wt(c,!1);const t=()=>ut(de,"$character",v),[v,f]=ca(),p=C(),m=C(),w=C(),y=$a();let h=At(c,"notation",12,""),W=At(c,"visible",8,!1),P=At(c,"damageNotation",12,""),Q=At(c,"damageType",8,""),ee=At(c,"attackName",12,""),K=At(c,"applyHalfDamage",8,!1),E=At(c,"bonusBreakdown",28,()=>[]),A=At(c,"rollType",12,"other"),B=null,F=C(void 0),ue=C(!1),Ue=C(""),V=C(null);function Be(){return e(V)?.resultTotal??null}function ve(j,q,J){const re=[];if(!j||!j.result)return re;const Fe=q.match(/([+-]?\d*d\d+|[+-]?\d+)/g)||[];let Ge=0;const Pe=new Set;for(const Re of Fe){const ct=Re.trim();if(!ct)continue;const ft=ct.match(/([+-]?)(\d*)d(\d+)/);if(ft){const Ie=parseInt(ft[2]||"1"),Ee=`${Ie}d${ft[3]}`,wt=J.findIndex((Ze,ht)=>!Pe.has(ht)&&typeof Ze.value=="string"&&Ze.value===Ee),fe=[];for(let Ze=0;Ze<Ie&&Ge<j.result.length;Ze++)fe.push(j.result[Ge++]);const ne=wt>=0?J[wt].source:"base die";wt>=0&&Pe.add(wt);for(const Ze of fe)re.push({display:`${Ze}`,source:ne})}}for(let Re=0;Re<J.length;Re++)if(!Pe.has(Re)&&typeof J[Re].value=="number"){const ct=J[Re].value;re.push({display:ct>=0?`+${ct}`:`${ct}`,source:J[Re].source})}return re}let ge=C(0),Le=C(0),T=C(0),U=C(0),$=C(0),X=C(0),b=C(0),I=C([]),Y=C(!1),Se=C(!1),je=C(!1),me=C("#051e0a"),ce=C("#ffffff"),Ae=C("#3a2004"),qe=C(!1);function tt(j){return j.length===9&&j.startsWith("#")?j.substring(0,7):j}function pt(j,q="ff"){return j.length===7&&j.startsWith("#")?j+q:j}function it(){if(window.DICE&&e(F))try{B&&e(F)&&ba(F,e(F).innerHTML="");const j=e(F).clientWidth||500,q=e(F).clientHeight||300;B=new window.DICE.dice_box(e(F),{w:j,h:q}),n(ue,!0)}catch(j){console.error("Error initializing dice box:",j)}}wa(()=>{const j=re=>new Promise((Fe,Ge)=>{if(document.querySelector(`script[src="${re}"]`)){Fe(null);return}const Re=document.createElement("script");Re.src=re,Re.onload=()=>{Fe(null)},Re.onerror=()=>{console.error(`Failed to load: ${re}`),Ge(new Error(`Failed to load ${re}`))},document.head.appendChild(Re)});setTimeout(()=>{j(`${Pa}/libs/three.min.js`).then(()=>j(`${Pa}/libs/cannon.min.js`)).then(()=>j(`${Pa}/libs/teal.js`)).then(()=>j(`${Pa}/dice.js`)).then(()=>{if(window.DICE){const re=window.DICE.getColors();n(me,tt(re.dice_color)),n(ce,tt(re.label_color)),n(Ae,tt(re.desk_color))}it()}).catch(re=>{console.error("Failed to load dice libraries:",re)})},100);const q=()=>{e(ue)&&it()},J=re=>{W()&&re.key==="Escape"&&ie()};return window.addEventListener("resize",q),window.addEventListener("keydown",J),()=>{window.removeEventListener("resize",q),window.removeEventListener("keydown",J)}});function Ve(j,q="other"){if(!B||!e(ue))return;n(V,null),n(I,[]),n(Y,!1),n(Se,!1),q==="damage"&&E([]),A(q),n(je,!1),B.diceToRoll=j;const J=Fe=>null,re=Fe=>{let Ge=Fe.resultTotal,Pe=Fe.resultString;if(K()&&(Ge=Math.floor(Ge/2),Pe=Pe+" (halved)"),n(V,{...Fe,resultTotal:Ge,resultString:Pe}),console.log("Final roll result:",e(V)),console.log({type:q}),q==="attack"&&Fe.result&&Fe.result.length>0){const Re=Fe.result[0];n(Y,Re===20),n(Se,Re===1)}if(n(I,[]),console.log("Setting up follow-up actions. Type:",q,"damageNotation:",P(),"isCriticalSuccess:",e(Y),"isCriticalFail:",e(Se)),q==="attack"&&P())if(e(Y)){const Re=k(P());e(I).push({label:`Roll Critical Damage (${Re})`,notation:Re})}else e(Se)||e(I).push({label:`Roll Damage (${P()})`,notation:P()})};B.start_throw(J,re)}function yt(){const j=[];e(ge)>0&&j.push(`${e(ge)}d4`),e(Le)>0&&j.push(`${e(Le)}d6`),e(T)>0&&j.push(`${e(T)}d8`),e(U)>0&&j.push(`${e(U)}d10`),e($)>0&&j.push(`${e($)}d12`),e(X)>0&&j.push(`${e(X)}d20`);let q=j.join("+")||"1d20";return e(b)!==0&&(q+=e(b)>=0?`+${e(b)}`:`${e(b)}`),q}function Dt(){const j=yt();Ve(j)}function k(j){return j.replace(/(\d+)d(\d+)/g,(q,J,re)=>`${parseInt(J)*2}d${re}`)}function z(){n(ge,0),n(Le,0),n(T,0),n(U,0),n($,0),n(X,0),n(b,0),n(V,null),n(I,[]),n(Y,!1),n(Se,!1),A("other"),n(je,!1)}function _(){window.DICE&&(window.DICE.setColors({dice_color:pt(e(me),"ff"),label_color:pt(e(ce),"ff"),desk_color:e(Ae)}),B&&(B.updateDeskColor(e(Ae)),B.updateDiceColors()))}function O(){n(qe,!e(qe))}function Z(){!e(V)||e(m)<=0||e(je)||(n(V,{...e(V),resultTotal:e(V).resultTotal+10,resultString:e(V).resultString+" + 10 (Guided Strike)"}),de.update(j=>{const q="ChannelDivinity",J=j.classFeatures.features[q];return typeof J=="number"&&J>0&&(j.classFeatures.features[q]=J-1),j}),n(je,!0))}function ie(){y("close"),h(""),P(""),ee(""),n(Ue,""),n(V,null),n(je,!1),n(Y,!1),n(Se,!1),z()}Ye(()=>(t(),Ra),()=>{n(p,t().class?Ra(t().class,t().level,t().subclass).some(q=>q.name==="Guided Strike"):!1)}),Ye(()=>t(),()=>{n(m,(()=>{const q=t().classFeatures.features["ChannelDivinity"];return typeof q=="number"?q:0})())}),Ye(()=>(e(ge),e(Le),e(T),e(U),e($),e(X),e(b)),()=>{n(w,(()=>{const j=[];e(ge)>0&&j.push(`${e(ge)}d4`),e(Le)>0&&j.push(`${e(Le)}d6`),e(T)>0&&j.push(`${e(T)}d8`),e(U)>0&&j.push(`${e(U)}d10`),e($)>0&&j.push(`${e($)}d12`),e(X)>0&&j.push(`${e(X)}d20`);let q=j.join("+")||"1d20";return e(b)!==0&&(q+=e(b)>=0?`+${e(b)}`:`${e(b)}`),q})())}),Ye(()=>(N(h()),e(ue),N(W()),e(Ue),N(P()),N(ee()),N(A())),()=>{h()&&e(ue)&&W()&&h()!==e(Ue)&&(n(Ue,h()),n(V,null),n(I,[]),n(Y,!1),n(Se,!1),n(je,!1),console.log("Auto-roll triggered. notation:",h(),"damageNotation:",P(),"attackName:",ee(),"rollType:",A()),setTimeout(()=>Ve(h(),A()),200))}),pa();var he={getLastRollTotal:Be};zt();var _e=nn();let Te;var se=l(_e),D=l(se),te=l(D),De=l(te);{var ze=j=>{var q=Oi(),J=we(q),re=a(J);{var Fe=fe=>{var ne=Pt("- Attack Roll");o(fe,ne)};g(re,fe=>{A()==="attack"&&fe(Fe)})}var Ge=a(re,2);{var Pe=fe=>{var ne=Pt("- Damage Roll");o(fe,ne)};g(Ge,fe=>{A()==="damage"&&fe(Pe)})}var Re=a(Ge,2);{var ct=fe=>{var ne=Pt("- Healing Roll");o(fe,ne)};g(Re,fe=>{A()==="healing"&&fe(ct)})}var ft=a(Re,2);{var Ie=fe=>{var ne=Pt("- Ability Check");o(fe,ne)};g(ft,fe=>{A()==="check"&&fe(Ie)})}var Ee=a(ft,2);{var wt=fe=>{var ne=Pt("- Saving Throw");o(fe,ne)};g(Ee,fe=>{A()==="save"&&fe(wt)})}L(()=>S(J,`${ee()??""} `)),o(j,q)},Qe=j=>{var q=Pt("Dice Roller");o(j,q)};g(De,j=>{ee()?j(ze):j(Qe,!1)})}s(te);var mt=a(te,2),ye=l(mt),ae=a(ye,2);s(mt),s(D);var u=a(D,2);{var Je=j=>{var q=Gi(),J=a(l(q),2),re=l(J),Fe=a(l(re),2);Ce(Fe),s(re);var Ge=a(re,2),Pe=a(l(Ge),2);Ce(Pe),s(Ge);var Re=a(Ge,2),ct=a(l(Re),2);Ce(ct),s(Re),s(J),s(q),Ne(Fe,()=>e(me),ft=>n(me,ft)),R("change",Fe,_),Ne(Pe,()=>e(ce),ft=>n(ce,ft)),R("change",Pe,_),Ne(ct,()=>e(Ae),ft=>n(Ae,ft)),R("change",ct,_),o(j,q)};g(u,j=>{e(qe)&&j(Je)})}var xe=a(u,2);{var G=j=>{var q=qi();o(j,q)};g(xe,j=>{e(ue)||j(G)})}var be=a(xe,2),le=l(be);Ua(le,j=>n(F,j),()=>e(F));var Me=a(le,2);{var ke=j=>{var q=zi(),J=a(l(q),2),re=l(J),Fe=a(l(re),2);Ce(Fe),s(re);var Ge=a(re,2),Pe=a(l(Ge),2);Ce(Pe),s(Ge);var Re=a(Ge,2),ct=a(l(Re),2);Ce(ct),s(Re);var ft=a(Re,2),Ie=a(l(ft),2);Ce(Ie),s(ft);var Ee=a(ft,2),wt=a(l(Ee),2);Ce(wt),s(Ee);var fe=a(Ee,2),ne=a(l(fe),2);Ce(ne),s(fe),s(J);var Ze=a(J,2),ht=l(Ze),M=l(ht);s(ht);var $e=a(ht,2);s(Ze),s(q),L(()=>{ht.disabled=!e(ue),S(M,`Roll ${e(w)??""}`)}),Ne(Fe,()=>e(ge),x=>n(ge,x)),Ne(Pe,()=>e(Le),x=>n(Le,x)),Ne(ct,()=>e(T),x=>n(T,x)),Ne(Ie,()=>e(U),x=>n(U,x)),Ne(wt,()=>e($),x=>n($,x)),Ne(ne,()=>e(X),x=>n(X,x)),R("click",ht,Dt),R("click",$e,z),o(j,q)};g(Me,j=>{h()||j(ke)})}s(be);var We=a(be,2);let Oe;var Xe=l(We);{var ot=j=>{var q=rn(),J=we(q),re=l(J);{var Fe=x=>{var He=Wi(),H=l(He,!0);s(He),L(()=>S(H,ee()?`${ee()} - Healing`:"Healing")),o(x,He)},Ge=x=>{var He=bt(),H=we(He);{var Bt=at=>{var pe=Ki(),vt=l(pe,!0);s(pe),L(()=>S(vt,ee()?`${ee()} - ${Q()} Damage`:`${Q()} Damage`)),o(at,pe)},_t=at=>{var pe=bt(),vt=we(pe);{var st=Ke=>{var gt=Vi(),xt=l(gt,!0);s(gt),L(()=>S(xt,ee()?`${ee()} - Damage`:"Damage")),o(Ke,gt)},Ft=Ke=>{var gt=Ji(),xt=l(gt,!0);s(gt),L(()=>S(xt,ee()?`${ee()} - Result`:"Result")),o(Ke,gt)};g(vt,Ke=>{A()==="damage"?Ke(st):Ke(Ft,!1)},!0)}o(at,pe)};g(H,at=>{A()==="damage"&&Q()?at(Bt):at(_t,!1)},!0)}o(x,He)};g(re,x=>{A()==="damage"&&Q()==="Healing"?x(Fe):x(Ge,!1)})}var Pe=a(re,2);{var Re=x=>{var He=Yi();o(x,He)};g(Pe,x=>{e(Y)&&x(Re)})}var ct=a(Pe,2);{var ft=x=>{var He=Qi();o(x,He)};g(ct,x=>{e(Se)&&x(ft)})}s(J);var Ie=a(J,2),Ee=l(Ie,!0);s(Ie);var wt=a(Ie,2),fe=l(wt);{var ne=x=>{var He=bt(),H=we(He);{var Bt=at=>{var pe=Zi();$t(pe,5,()=>(e(V),N(h()),N(E()),i(()=>ve(e(V),h(),E()))),jt,(vt,st)=>{var Ft=Xi(),Ke=l(Ft),gt=l(Ke,!0);s(Ke);var xt=a(Ke,2),Ht=l(xt);s(xt),s(Ft),L(()=>{S(gt,(e(st),i(()=>e(st).display))),S(Ht,`(${e(st),i(()=>e(st).source)??""})`)}),o(vt,Ft)}),s(pe),o(at,pe)},_t=at=>{var pe=bt(),vt=we(pe);{var st=Ft=>{var Ke=en(),gt=l(Ke);s(Ke),L(()=>S(gt,`Modifier: ${e(V),i(()=>e(V).constant>=0?"+":"")??""}${e(V),i(()=>e(V).constant)??""}`)),o(Ft,Ke)};g(vt,Ft=>{e(V),i(()=>e(V).constant)&&Ft(st)},!0)}o(at,pe)};g(H,at=>{N(E()),i(()=>E().length>0)?at(Bt):at(_t,!1)})}o(x,He)};g(fe,x=>{e(V),N(E()),i(()=>e(V).constant||E().length>0)&&x(ne)})}s(wt);var Ze=a(wt,2);{var ht=x=>{var He=tn();o(x,He)};g(Ze,x=>{e(Se)&&x(ht)})}var M=a(Ze,2);{var $e=x=>{var He=ln(),H=l(He);$t(H,1,()=>e(I),jt,(at,pe)=>{var vt=an(),st=l(vt,!0);s(vt),L(()=>S(st,(e(pe),i(()=>e(pe).label)))),R("click",vt,()=>Ve(e(pe).notation,"damage")),o(at,vt)});var Bt=a(H,2);{var _t=at=>{var pe=sn();L(()=>{pe.disabled=e(m)<=0,et(pe,"title",e(m)<=0?"No Channel Divinity uses remaining":"Use Channel Divinity to add +10 to this attack roll")}),R("click",pe,Z),o(at,pe)};g(Bt,at=>{e(p)&&A()==="attack"&&!e(je)&&e(m)>0&&!e(Se)&&at(_t)})}s(He),o(x,He)};g(M,x=>{e(I),e(p),N(A()),e(je),e(m),i(()=>e(I).length>0||e(p)&&A()==="attack"&&!e(je)&&e(m)>0)&&x($e)})}L(()=>S(Ee,(e(V),i(()=>e(V).resultTotal)))),o(j,q)};g(Xe,j=>{e(V)&&j(ot)})}s(We),s(se),s(_e),L(()=>{Te=Mt(_e,1,"modal-overlay svelte-1r90jgp",null,Te,{hidden:!W()}),Oe=Mt(We,1,"roll-result svelte-1r90jgp",null,Oe,{"has-result":e(V)})}),R("click",ye,O),R("click",ae,ie),R("click",se,ms(function(j){Aa.call(this,c,j)})),R("keydown",se,function(j){Aa.call(this,c,j)}),R("click",_e,ie),R("keydown",_e,j=>j.key==="Escape"&&ie()),o(r,_e),xl(c,"getLastRollTotal",Be);var oe=Kt(he);return f(),oe}const Xa="https://api.github.com/gists";async function cn(r,c,t){if(!c)throw new Error("GitHub token is required");const v=JSON.stringify(r,null,2),f=`${r.name||"character"}_dnd.json`,p={description:t||`D&D Character: ${r.name}`,public:!1,files:{[f]:{content:v}}},m=await fetch(Xa,{method:"POST",headers:{Authorization:`token ${c}`,"Content-Type":"application/json"},body:JSON.stringify(p)});if(!m.ok)throw new Error(`Failed to create gist: ${m.statusText}`);return(await m.json()).id}async function vn(r,c,t){if(!c||!t)throw new Error("GitHub token and Gist ID are required");const v=JSON.stringify(r,null,2),p={files:{[`${r.name||"character"}_dnd.json`]:{content:v}}},m=await fetch(`${Xa}/${t}`,{method:"PATCH",headers:{Authorization:`token ${c}`,"Content-Type":"application/json"},body:JSON.stringify(p)});if(!m.ok)throw new Error(`Failed to update gist: ${m.statusText}`)}async function dn(r,c){if(!r)throw new Error("Gist ID is required");const t={"Content-Type":"application/json"};c&&(t.Authorization=`token ${c}`);const v=await fetch(`${Xa}/${r}`,{method:"GET",headers:t});if(!v.ok)throw new Error(`Failed to load gist: ${v.statusText}`);const f=await v.json(),p=Object.values(f.files);if(p.length===0)throw new Error("No files found in gist");const w=p[0].content;try{const y=JSON.parse(w);return y.attacks&&Array.isArray(y.attacks)&&(y.attacks=y.attacks.map(h=>({...h,id:h.id||crypto.randomUUID()}))),y.classFeatures?(y.classFeatures.features||(y.classFeatures.features={}),y.classFeatures.spellSlots||(y.classFeatures.spellSlots=[]),y.classFeatures.preparedSpells===void 0&&(y.classFeatures.preparedSpells="")):y.classFeatures={features:{},spellSlots:[],preparedSpells:""},y}catch{throw new Error("Invalid character data in gist")}}function js(r){typeof window<"u"&&localStorage.setItem("dnd_gist_config",JSON.stringify(r))}function un(){if(typeof window<"u"){const r=localStorage.getItem("dnd_gist_config");if(r)return JSON.parse(r)}return{}}async function fn(r,c=30){if(!r)throw new Error("GitHub token is required to list gists");const t=await fetch(`${Xa}?per_page=${c}`,{method:"GET",headers:{Authorization:`token ${r}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error(`Failed to list gists: ${t.statusText}`);return await t.json()}var pn=d('<div class="error-message svelte-1jb5ckg"> </div>'),mn=d('<div class="toggle-container svelte-1jb5ckg"><button type="button" class="toggle-btn svelte-1jb5ckg"> </button></div>'),gn=d('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID (leave empty to create new)</label> <input type="text" id="gistId" placeholder="Optional: existing Gist ID to update" class="svelte-1jb5ckg"/></div>'),bn=d('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),hn=d('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),_n=d('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Update (or leave unselected to create new)</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),yn=d('<div class="info-message svelte-1jb5ckg">No gists found. A new one will be created.</div>'),xn=d('<!> <div class="form-group svelte-1jb5ckg"><label for="description" class="svelte-1jb5ckg"> </label> <input type="text" id="description" placeholder="D&amp;D Character Sheet" class="svelte-1jb5ckg"/></div>',1),$n=d('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID *</label> <input type="text" id="gistId" placeholder="Enter Gist ID (for public or your private gists)" required class="svelte-1jb5ckg"/></div>'),wn=d('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),Sn=d('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),kn=d('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Load</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),Cn=d('<div class="info-message svelte-1jb5ckg">No gists found. Enter a Gist ID manually or create a new one in Save mode.</div>'),Dn=d('<div class="modal-overlay svelte-1jb5ckg" role="button" tabindex="-1"><div class="modal-content svelte-1jb5ckg" role="dialog" tabindex="0"><div class="modal-header svelte-1jb5ckg"><h2 class="svelte-1jb5ckg"> </h2> <button class="close-btn svelte-1jb5ckg">√ó</button></div> <div class="modal-body svelte-1jb5ckg"><!> <div class="form-group svelte-1jb5ckg"><label for="token" class="svelte-1jb5ckg"> <a href="https://github.com/settings/tokens" target="_blank" rel="noopener" class="svelte-1jb5ckg">Get token</a></label> <input type="password" id="token" placeholder="ghp_xxxxxxxxxxxxx" class="svelte-1jb5ckg"/></div> <!> <!> <div class="modal-actions svelte-1jb5ckg"><button class="btn btn-primary svelte-1jb5ckg"><!></button> <button class="btn btn-secondary svelte-1jb5ckg">Cancel</button></div></div></div></div>');function Ln(r,c){Wt(c,!1);const t=()=>ut(de,"$character",v),[v,f]=ca(),p=$a();let m=At(c,"mode",8,"save"),w=C(""),y=C(""),h=C(""),W=C(!1),P=C(""),Q=C(!1),ee=C(!1),K=C([]),E=C(null);const A=un();A.token&&n(w,A.token),A.gistId&&n(y,A.gistId),wa(async()=>{e(w)&&!e(Q)&&await B()});async function B(){if(e(w)){n(ee,!0),n(P,"");try{n(K,await fn(e(w))),e(y)&&n(E,e(K).find(_=>_.id===e(y))||null)}catch(_){n(P,_.message||"Failed to load gists"),n(K,[])}finally{n(ee,!1)}}}function F(_){n(E,_),n(y,_.id)}function ue(){n(Q,!e(Q)),n(P,""),!e(Q)&&e(w)&&B()}async function Ue(){if(!e(w)){n(P,"GitHub token is required");return}const _=e(E)?.id||e(y);n(W,!0),n(P,"");try{if(_)await vn(t(),e(w),_),n(y,_),Ut.add("Character updated in Gist successfully!","success");else{const O=await cn(t(),e(w),e(h));n(y,O),Ut.add(`Character saved to Gist! ID: ${O}`,"success")}js({token:e(w),gistId:e(y)}),p("close")}catch(O){n(P,O.message||"Failed to save to Gist")}finally{n(W,!1)}}async function V(){const _=e(E)?.id||e(y);if(!_){n(P,"Please select a gist or enter a Gist ID");return}n(W,!0),n(P,"");try{const O=await dn(_,e(w)||void 0);de.set(O),n(y,_),js({token:e(w),gistId:e(y)}),Ut.add("Character loaded from Gist successfully!","success"),p("close")}catch(O){n(P,O.message||"Failed to load from Gist")}finally{n(W,!1)}}function Be(){p("close")}zt();var ve=Dn(),ge=l(ve),Le=l(ge),T=l(Le),U=l(T,!0);s(T);var $=a(T,2);s(Le);var X=a(Le,2),b=l(X);{var I=_=>{var O=pn(),Z=l(O,!0);s(O),L(()=>S(Z,e(P))),o(_,O)};g(b,_=>{e(P)&&_(I)})}var Y=a(b,2),Se=l(Y),je=l(Se);ta(),s(Se);var me=a(Se,2);Ce(me),s(Y);var ce=a(Y,2);{var Ae=_=>{var O=mn(),Z=l(O),ie=l(Z,!0);s(Z),s(O),L(()=>{Z.disabled=e(W),S(ie,e(Q)?"üìã Show My Gists":"‚úèÔ∏è Enter Gist ID Manually")}),R("click",Z,ue),o(_,O)};g(ce,_=>{(m()==="load"||m()==="save"&&e(w))&&_(Ae)})}var qe=a(ce,2);{var tt=_=>{var O=xn(),Z=we(O);{var ie=te=>{var De=gn(),ze=a(l(De),2);Ce(ze),s(De),L(()=>ze.disabled=e(W)),Ne(ze,()=>e(y),Qe=>n(y,Qe)),o(te,De)},he=te=>{var De=bt(),ze=we(De);{var Qe=ye=>{var ae=bn();o(ye,ae)},mt=ye=>{var ae=bt(),u=we(ae);{var Je=G=>{var be=_n(),le=a(l(be),2);$t(le,5,()=>e(K),jt,(Me,ke)=>{var We=hn();let Oe;var Xe=l(We),ot=l(Xe),oe=l(ot,!0);s(ot);var j=a(ot,2),q=l(j,!0);s(j),s(Xe);var J=a(Xe,2),re=l(J),Fe=l(re);s(re);var Ge=a(re,2),Pe=l(Ge);s(Ge),s(J),s(We),L(Re=>{Oe=Mt(We,1,"gist-item svelte-1jb5ckg",null,Oe,{selected:e(E)?.id===e(ke).id}),We.disabled=e(W),S(oe,(e(ke),i(()=>e(ke).description||"Untitled"))),S(q,(e(ke),i(()=>e(ke).public?"üåê Public":"üîí Private"))),S(Fe,`ID: ${e(ke),i(()=>e(ke).id)??""}`),S(Pe,`Updated: ${Re??""}`)},[()=>(e(ke),i(()=>new Date(e(ke).updated_at).toLocaleDateString()))]),R("click",We,()=>F(e(ke))),o(Me,We)}),s(le),s(be),o(G,be)},xe=G=>{var be=bt(),le=we(be);{var Me=ke=>{var We=yn();o(ke,We)};g(le,ke=>{e(w)&&ke(Me)},!0)}o(G,be)};g(u,G=>{e(K),i(()=>e(K).length>0)?G(Je):G(xe,!1)},!0)}o(ye,ae)};g(ze,ye=>{e(ee)?ye(Qe):ye(mt,!1)},!0)}o(te,De)};g(Z,te=>{e(Q)||!e(w)?te(ie):te(he,!1)})}var _e=a(Z,2),Te=l(_e),se=l(Te);s(Te);var D=a(Te,2);Ce(D),s(_e),L(()=>{S(se,`Description ${e(y)?"(optional)":""}`),D.disabled=e(W)}),Ne(D,()=>e(h),te=>n(h,te)),o(_,O)},pt=_=>{var O=bt(),Z=we(O);{var ie=_e=>{var Te=$n(),se=a(l(Te),2);Ce(se),s(Te),L(()=>se.disabled=e(W)),Ne(se,()=>e(y),D=>n(y,D)),o(_e,Te)},he=_e=>{var Te=bt(),se=we(Te);{var D=De=>{var ze=wn();o(De,ze)},te=De=>{var ze=bt(),Qe=we(ze);{var mt=ae=>{var u=kn(),Je=a(l(u),2);$t(Je,5,()=>e(K),jt,(xe,G)=>{var be=Sn();let le;var Me=l(be),ke=l(Me),We=l(ke,!0);s(ke);var Oe=a(ke,2),Xe=l(Oe,!0);s(Oe),s(Me);var ot=a(Me,2),oe=l(ot),j=l(oe);s(oe);var q=a(oe,2),J=l(q);s(q),s(ot),s(be),L(re=>{le=Mt(be,1,"gist-item svelte-1jb5ckg",null,le,{selected:e(E)?.id===e(G).id}),be.disabled=e(W),S(We,(e(G),i(()=>e(G).description||"Untitled"))),S(Xe,(e(G),i(()=>e(G).public?"üåê Public":"üîí Private"))),S(j,`ID: ${e(G),i(()=>e(G).id)??""}`),S(J,`Updated: ${re??""}`)},[()=>(e(G),i(()=>new Date(e(G).updated_at).toLocaleDateString()))]),R("click",be,()=>F(e(G))),o(xe,be)}),s(Je),s(u),o(ae,u)},ye=ae=>{var u=bt(),Je=we(u);{var xe=G=>{var be=Cn();o(G,be)};g(Je,G=>{e(w)&&G(xe)},!0)}o(ae,u)};g(Qe,ae=>{e(K),i(()=>e(K).length>0)?ae(mt):ae(ye,!1)},!0)}o(De,ze)};g(se,De=>{e(ee)?De(D):De(te,!1)},!0)}o(_e,Te)};g(Z,_e=>{e(Q)||!e(w)?_e(ie):_e(he,!1)},!0)}o(_,O)};g(qe,_=>{m()==="save"?_(tt):_(pt,!1)})}var it=a(qe,2),Ve=l(it),yt=l(Ve);{var Dt=_=>{var O=Pt();L(()=>S(O,m()==="save"?"Saving...":"Loading...")),o(_,O)},k=_=>{var O=Pt();L(()=>S(O,m()==="save"?"Save":"Load")),o(_,O)};g(yt,_=>{e(W)?_(Dt):_(k,!1)})}s(Ve);var z=a(Ve,2);s(it),s(X),s(ge),s(ve),L(()=>{S(U,m()==="save"?"Save to GitHub Gist":"Load from GitHub Gist"),S(je,`GitHub Token ${m()==="load"?"(optional for public gists)":"(required)"} `),me.disabled=e(W),Ve.disabled=e(W),z.disabled=e(W)}),R("click",$,Be),Ne(me,()=>e(w),_=>n(w,_)),R("blur",me,()=>{e(w)&&!e(Q)&&B()}),R("click",Ve,function(..._){(m()==="save"?Ue:V)?.apply(this,_)}),R("click",z,Be),R("click",ge,ms(function(_){Aa.call(this,c,_)})),R("keydown",ge,function(_){Aa.call(this,c,_)}),R("click",ve,Be),R("keydown",ve,_=>_.key==="Escape"&&Be()),o(r,ve),Kt(),f()}var jn=d('<div class="loading svelte-1ngjemu">Loading D&D data...</div>'),An=d("<option> </option>"),Rn=d('<select class="level-filter svelte-1ngjemu"><option>All Levels</option><option>Cantrip</option><!></select>'),Bn=d('<div class="no-results svelte-1ngjemu"> </div>'),Tn=d('<div class="item-meta svelte-1ngjemu"> </div>'),Mn=d('<div class="item-meta svelte-1ngjemu"> </div>'),Fn=d('<button><div class="item-name svelte-1ngjemu"> </div> <!></button>'),Pn=d('<p class="higher-levels"><strong>At Higher Levels:</strong> </p>'),In=d('<p class="cantrip-upgrade"><strong>Cantrip Upgrade:</strong> </p>'),En=d('<h3 class="svelte-1ngjemu"> </h3> <p class="spell-meta svelte-1ngjemu"><!> <!></p> <p class="spell-classes"><strong>Classes:</strong> </p> <div class="spell-stats svelte-1ngjemu"><div><strong>Casting Time:</strong> </div> <div><strong>Range:</strong> </div> <div><strong>Components:</strong> <!></div> <div><strong>Duration:</strong> <!> </div></div> <p class="description svelte-1ngjemu"> </p> <!> <!>',1),Un=d('<p class="prerequisite svelte-1ngjemu"><strong>Prerequisite:</strong> </p>'),Hn=d('<h3 class="svelte-1ngjemu"> </h3> <!> <p class="description svelte-1ngjemu"> </p> <a target="_blank" rel="noopener" class="source-link svelte-1ngjemu">View Full Details ‚Üí</a>',1),Nn=d('<div class="item-details svelte-1ngjemu"><!></div>'),On=d('<div class="controls svelte-1ngjemu"><div class="tabs svelte-1ngjemu"><button> </button> <button> </button></div> <div class="search-controls svelte-1ngjemu"><input type="text" placeholder="Search by name or description..." class="search-input svelte-1ngjemu"/> <!></div></div> <div class="content-container svelte-1ngjemu"><div class="items-list svelte-1ngjemu"><!></div> <!></div>',1),Gn=d('<div class="modal-backdrop svelte-1ngjemu" role="presentation"><div class="modal svelte-1ngjemu" role="dialog" aria-modal="true" tabindex="-1"><div class="modal-header svelte-1ngjemu"><h2 class="svelte-1ngjemu">Browse D&D Spells & Feats</h2> <button class="close-btn svelte-1ngjemu" aria-label="Close">&times;</button></div> <div class="modal-body svelte-1ngjemu"><!></div> <div class="modal-footer svelte-1ngjemu"><button class="btn-secondary svelte-1ngjemu">Cancel</button> <button class="btn-primary svelte-1ngjemu">Add to Character Sheet</button></div></div></div>');function qn(r,c){Wt(c,!1);const t=C(),v=C(),f=C();let p=At(c,"onClose",8),m=C("spell"),w=C(!0),y=C(""),h=C(null),W=C([]),P=C([]),Q=C(null);wa(async()=>{n(w,!0);try{n(W,await Us()),n(P,await or())}catch($){console.error("Failed to load data:",$)}finally{n(w,!1)}});function ee($){n(Q,$)}function K($){const X=$.match(/(\d+d\d+(?:\s*\+\s*\d+)?)/i);return X?X[1]:""}function E($){const X=$.split(/\.( |$)/)[0].trim(),b=Array.from($.matchAll(/\*\*(.*?)\*\*/g)).map(Y=>Y[1].replace(/\.$/,""));let I=X;return b.length&&(I+=" | Effects: "+b.join(", ")),I}function A(){if(e(Q)){if(e(m)==="spell"){const $=e(Q);de.update(X=>{const I=[];$.range&&I.push(`Range: ${$.range}`),$.castingTime&&I.push(`Cast: ${$.castingTime}`),$.duration&&I.push(`Duration: ${$.duration}`),$.actionType==="Save"&&I.push("Saving throw spell"),$.components&&$.components.length>0&&I.push(`Components: ${$.components.join(", ")}`),$.material&&I.push(`Material: ${$.material}`);const Y=I.join(" | "),Se=E($.description),je={id:crypto.randomUUID(),name:`${$.name}${$.concentration?" (C)":""}${$.ritual?" (R)":""}`,bonus:$.actionType==="Attack"?5:0,damage:K($.description),damageType:`${$.school} (Lvl ${$.level})`,spellRef:$.name,infoNotes:Y,generalNotes:Se,castAtLevel:$.level};return X.attacks=[...X.attacks,je],X})}else if(e(m)==="feat"){const $=e(Q);de.update(X=>{const b=`${$.name}${$.prerequisite?` (Req: ${$.prerequisite})`:""}
${$.description}
`;return X.features=X.features?`${X.features}
${b}`:b,X})}n(Q,null),p()()}}Ye(()=>(e(h),e(W),e(y)),()=>{n(t,e(h)!==null?cr(Ds(e(W),e(y)),e(h)):Ds(e(W),e(y)))}),Ye(()=>(e(P),e(y)),()=>{n(v,vr(e(P),e(y)))}),Ye(()=>(e(m),e(t),e(v)),()=>{n(f,e(m)==="spell"?e(t):e(v))}),pa(),zt();var B=Gn(),F=l(B),ue=l(F),Ue=a(l(ue),2);s(ue);var V=a(ue,2),Be=l(V);{var ve=$=>{var X=jn();o($,X)},ge=$=>{var X=On(),b=we(X),I=l(b),Y=l(I);let Se;var je=l(Y);s(Y);var me=a(Y,2);let ce;var Ae=l(me);s(me),s(I);var qe=a(I,2),tt=l(qe);Ce(tt);var pt=a(tt,2);{var it=Z=>{var ie=Rn();L(()=>{e(h),qt(()=>{})});var he=l(ie);he.value=(he.__value=null)??"";var _e=a(he);_e.value=_e.__value=0;var Te=a(_e);$t(Te,0,()=>[1,2,3,4,5,6,7,8,9],jt,(se,D)=>{var te=An(),De=l(te);s(te);var ze={};L(()=>{S(De,`Level ${D??""}`),ze!==(ze=D)&&(te.value=(te.__value=D)??"")}),o(se,te)}),s(ie),Ha(ie,()=>e(h),se=>n(h,se)),o(Z,ie)};g(pt,Z=>{e(m)==="spell"&&Z(it)})}s(qe),s(b);var Ve=a(b,2),yt=l(Ve),Dt=l(yt);{var k=Z=>{var ie=Bn(),he=l(ie);s(ie),L(()=>S(he,`No ${e(m)??""}s found`)),o(Z,ie)},z=Z=>{var ie=bt(),he=we(ie);$t(he,1,()=>e(f),jt,(_e,Te)=>{var se=Fn();let D;var te=l(se),De=l(te,!0);s(te);var ze=a(te,2);{var Qe=ye=>{const ae=Ct(()=>e(Te));var u=Tn(),Je=l(u);s(u),L(()=>S(Je,`Level ${N(e(ae)),i(()=>e(ae).level)??""} ‚Ä¢ ${N(e(ae)),i(()=>e(ae).school)??""}`)),o(ye,u)},mt=ye=>{const ae=Ct(()=>e(Te));var u=bt(),Je=we(u);{var xe=G=>{var be=Mn(),le=l(be,!0);s(be),L(()=>S(le,(N(e(ae)),i(()=>e(ae).prerequisite)))),o(G,be)};g(Je,G=>{N(e(ae)),i(()=>e(ae).prerequisite)&&G(xe)})}o(ye,u)};g(ze,ye=>{e(m)==="spell"?ye(Qe):ye(mt,!1)})}s(se),L(()=>{D=Mt(se,1,"item-card svelte-1ngjemu",null,D,{selected:e(Q)?.name===e(Te).name}),S(De,(e(Te),i(()=>e(Te).name)))}),R("click",se,()=>ee(e(Te))),o(_e,se)}),o(Z,ie)};g(Dt,Z=>{e(f),i(()=>e(f).length===0)?Z(k):Z(z,!1)})}s(yt);var _=a(yt,2);{var O=Z=>{var ie=Nn(),he=l(ie);{var _e=se=>{const D=Ct(()=>e(Q));var te=En(),De=we(te),ze=l(De,!0);s(De);var Qe=a(De,2),mt=l(Qe);{var ye=Ie=>{var Ee=Pt();L(()=>S(Ee,`${N(e(D)),i(()=>e(D).school)??""} cantrip`)),o(Ie,Ee)},ae=Ie=>{var Ee=Pt();L(()=>S(Ee,`Level ${N(e(D)),i(()=>e(D).level)??""} ${N(e(D)),i(()=>e(D).school)??""}`)),o(Ie,Ee)};g(mt,Ie=>{N(e(D)),i(()=>e(D).level===0)?Ie(ye):Ie(ae,!1)})}var u=a(mt,2);{var Je=Ie=>{var Ee=Pt("(ritual)");o(Ie,Ee)};g(u,Ie=>{N(e(D)),i(()=>e(D).ritual)&&Ie(Je)})}s(Qe);var xe=a(Qe,2),G=a(l(xe));s(xe);var be=a(xe,2),le=l(be),Me=a(l(le));s(le);var ke=a(le,2),We=a(l(ke));s(ke);var Oe=a(ke,2),Xe=a(l(Oe)),ot=a(Xe);{var oe=Ie=>{var Ee=Pt();L(()=>S(Ee,`(${N(e(D)),i(()=>e(D).material)??""})`)),o(Ie,Ee)};g(ot,Ie=>{N(e(D)),i(()=>e(D).material)&&Ie(oe)})}s(Oe);var j=a(Oe,2),q=a(l(j),2);{var J=Ie=>{var Ee=Pt("Concentration,");o(Ie,Ee)};g(q,Ie=>{N(e(D)),i(()=>e(D).concentration)&&Ie(J)})}var re=a(q,1,!0);s(j),s(be);var Fe=a(be,2),Ge=l(Fe,!0);s(Fe);var Pe=a(Fe,2);{var Re=Ie=>{var Ee=Pn(),wt=a(l(Ee));s(Ee),L(()=>S(wt,` ${N(e(D)),i(()=>e(D).higherLevelSlot)??""}`)),o(Ie,Ee)};g(Pe,Ie=>{N(e(D)),i(()=>e(D).higherLevelSlot)&&Ie(Re)})}var ct=a(Pe,2);{var ft=Ie=>{var Ee=In(),wt=a(l(Ee));s(Ee),L(()=>S(wt,` ${N(e(D)),i(()=>e(D).cantripUpgrade)??""}`)),o(Ie,Ee)};g(ct,Ie=>{N(e(D)),i(()=>e(D).cantripUpgrade)&&Ie(ft)})}L((Ie,Ee)=>{S(ze,(N(e(D)),i(()=>e(D).name))),S(G,` ${Ie??""}`),S(Me,` ${N(e(D)),i(()=>e(D).castingTime||e(D).actionType)??""}`),S(We,` ${N(e(D)),i(()=>e(D).range)??""}`),S(Xe,` ${Ee??""}`),S(re,(N(e(D)),i(()=>e(D).duration))),S(Ge,(N(e(D)),i(()=>e(D).description)))},[()=>(N(e(D)),i(()=>e(D).classes.join(", "))),()=>(N(e(D)),i(()=>e(D).components.join(", ").toUpperCase()))]),o(se,te)},Te=se=>{const D=Ct(()=>e(Q));var te=Hn(),De=we(te),ze=l(De,!0);s(De);var Qe=a(De,2);{var mt=Je=>{var xe=Un(),G=a(l(xe));s(xe),L(()=>S(G,` ${N(e(D)),i(()=>e(D).prerequisite)??""}`)),o(Je,xe)};g(Qe,Je=>{N(e(D)),i(()=>e(D).prerequisite)&&Je(mt)})}var ye=a(Qe,2),ae=l(ye,!0);s(ye);var u=a(ye,2);L(()=>{S(ze,(N(e(D)),i(()=>e(D).name))),S(ae,(N(e(D)),i(()=>e(D).description))),et(u,"href",(N(e(D)),i(()=>e(D).source)))}),o(se,te)};g(he,se=>{e(m)==="spell"?se(_e):se(Te,!1)})}s(ie),o(Z,ie)};g(_,Z=>{e(Q)&&Z(O)})}s(Ve),L(()=>{Se=Mt(Y,1,"tab svelte-1ngjemu",null,Se,{active:e(m)==="spell"}),S(je,`üìú Spells (${e(W),i(()=>e(W).length)??""})`),ce=Mt(me,1,"tab svelte-1ngjemu",null,ce,{active:e(m)==="feat"}),S(Ae,`‚≠ê Feats (${e(P),i(()=>e(P).length)??""})`)}),R("click",Y,()=>{n(m,"spell"),n(Q,null),n(y,"")}),R("click",me,()=>{n(m,"feat"),n(Q,null),n(y,"")}),Ne(tt,()=>e(y),Z=>n(y,Z)),o($,X)};g(Be,$=>{e(w)?$(ve):$(ge,!1)})}s(V);var Le=a(V,2),T=l(Le),U=a(T,2);s(Le),s(F),s(B),L(()=>U.disabled=!e(Q)),R("click",Ue,function(...$){p()?.apply(this,$)}),R("click",T,function(...$){p()?.apply(this,$)}),R("click",U,A),R("click",F,ms(function($){Aa.call(this,c,$)})),R("keydown",F,function($){Aa.call(this,c,$)}),R("click",B,function(...$){p()?.apply(this,$)}),R("keydown",B,$=>$.key==="Escape"&&p()()),o(r,B),Kt()}var zn=d('<span class="resistance-tag svelte-gdwwx1"> <button type="button" class="tag-remove svelte-gdwwx1">√ó</button></span>'),Wn=d('<div class="resistance-list svelte-gdwwx1"></div>'),Kn=d('<p class="ability-meta svelte-gdwwx1"> <!></p>'),Vn=d('<p class="ability-meta svelte-gdwwx1">Requires Reaction</p>'),Jn=d('<div class="ability-card svelte-gdwwx1"><div class="ability-header svelte-gdwwx1"><strong class="svelte-gdwwx1"> </strong> <button type="button" class="ability-remove svelte-gdwwx1">√ó</button></div> <p class="ability-description svelte-gdwwx1"> </p> <!></div>'),Yn=d('<div class="abilities-list svelte-gdwwx1"></div>'),Qn=d(`<div class="modal-backdrop svelte-gdwwx1" role="presentation"><div class="modal-content svelte-gdwwx1" role="dialog" aria-modal="true" aria-labelledby="modal-title"><div class="modal-header svelte-gdwwx1"><h3 id="modal-title" class="svelte-gdwwx1">Add Custom Condition</h3> <button class="btn-close svelte-gdwwx1" aria-label="Close">√ó</button></div> <div class="modal-body svelte-gdwwx1"><div class="form-group svelte-gdwwx1"><label for="conditionName" class="svelte-gdwwx1">Condition Name*</label> <input type="text" id="conditionName" placeholder="e.g., Cazna's Mark" class="svelte-gdwwx1"/></div> <div class="form-group svelte-gdwwx1"><label for="description" class="svelte-gdwwx1">Description</label> <textarea id="description" placeholder="Describe the condition..." rows="3" class="svelte-gdwwx1"></textarea></div> <div class="form-row svelte-gdwwx1"><div class="form-group svelte-gdwwx1"><label for="attackBonus" class="svelte-gdwwx1">Attack Bonus</label> <input type="text" id="attackBonus" placeholder="0 or 1d4" class="svelte-gdwwx1"/></div> <div class="form-group svelte-gdwwx1"><label for="damageBonus" class="svelte-gdwwx1">Damage Bonus</label> <input type="text" id="damageBonus" placeholder="0 or 1d6" class="svelte-gdwwx1"/></div> <div class="form-group svelte-gdwwx1"><label for="acBonus" class="svelte-gdwwx1">AC Bonus</label> <input type="number" id="acBonus" placeholder="0" class="svelte-gdwwx1"/></div></div> <div class="form-group svelte-gdwwx1"><label for="darkvision" class="svelte-gdwwx1">Darkvision (feet)</label> <input type="number" id="darkvision" placeholder="0" min="0" step="30" class="svelte-gdwwx1"/> <small class="help-text svelte-gdwwx1">Grant or extend darkvision (e.g., 60 for 60 feet)</small></div> <div class="form-group svelte-gdwwx1"><label class="svelte-gdwwx1">Damage Resistances</label> <div class="resistance-input-group svelte-gdwwx1"><input type="text" placeholder="e.g., cold, fire, poison" class="svelte-gdwwx1"/> <button type="button" class="btn-add svelte-gdwwx1">Add</button></div> <!></div> <div class="form-group svelte-gdwwx1"><label class="svelte-gdwwx1">Special Abilities</label> <div class="ability-form svelte-gdwwx1"><input type="text" placeholder="Ability name (e.g., Flicker of Deceit)" class="ability-name-input svelte-gdwwx1"/> <textarea placeholder="Ability description..." rows="2" class="ability-desc-input svelte-gdwwx1"></textarea> <div class="ability-options svelte-gdwwx1"><div class="ability-option svelte-gdwwx1"><label for="abilityUses" class="svelte-gdwwx1">Uses per rest</label> <input type="number" id="abilityUses" min="0" class="svelte-gdwwx1"/></div> <div class="ability-option svelte-gdwwx1"><label for="restType" class="svelte-gdwwx1">Rest type</label> <select id="restType" class="svelte-gdwwx1"><option>Short</option><option>Long</option></select></div> <div class="ability-option svelte-gdwwx1"><label class="svelte-gdwwx1"><input type="checkbox" class="svelte-gdwwx1"/> Requires Reaction</label></div></div> <button type="button" class="btn-add svelte-gdwwx1">Add Ability</button></div> <!></div></div> <div class="modal-footer svelte-gdwwx1"><button class="btn btn-secondary svelte-gdwwx1">Cancel</button> <button class="btn btn-primary svelte-gdwwx1">Add Condition</button></div></div></div>`);function Xn(r,c){Wt(c,!1);let t=At(c,"show",8,!1),v=At(c,"onSave",8),f=At(c,"onCancel",8),p=C(""),m=C(""),w=C(0),y=C(0),h=C(0),W=C(0),P=C([]),Q=C(""),ee=C([]),K=C(""),E=C(""),A=C(0),B=C("short"),F=C(!1);function ue(){n(p,""),n(m,""),n(w,0),n(y,0),n(h,0),n(W,0),n(P,[]),n(Q,""),n(ee,[]),n(K,""),n(E,""),n(A,0),n(B,"short"),n(F,!1)}function Ue(){e(Q).trim()&&(n(P,[...e(P),e(Q).trim()]),n(Q,""))}function V(b){n(P,e(P).filter((I,Y)=>Y!==b))}function Be(){if(e(K).trim()&&e(E).trim()){const b={name:e(K).trim(),description:e(E).trim(),requiresReaction:e(F)};e(A)>0&&(b.usesPerRest=e(A),b.currentUses=e(A),b.restType=e(B)),n(ee,[...e(ee),b]),n(K,""),n(E,""),n(A,0),n(B,"short"),n(F,!1)}}function ve(b){n(ee,e(ee).filter((I,Y)=>Y!==b))}function ge(){if(!e(p).trim()){alert("Please enter a condition name");return}const b={name:e(p).trim(),description:e(m).trim()||"Custom condition",attackBonus:e(w)||0,damageBonus:e(y)||0,target:"self"};e(h)!==0&&(b.acBonus=e(h)),e(W)>0&&(b.darkvision=e(W)),e(P).length>0&&(b.resistances=e(P)),e(ee).length>0&&(b.abilities=e(ee)),v()(b),ue()}function Le(){ue(),f()()}function T(b){b.target===b.currentTarget&&Le()}zt();var U=bt(),$=we(U);{var X=b=>{var I=Qn(),Y=l(I),Se=l(Y),je=a(l(Se),2);s(Se);var me=a(Se,2),ce=l(me),Ae=a(l(ce),2);Ce(Ae),s(ce);var qe=a(ce,2),tt=a(l(qe),2);ja(tt),s(qe);var pt=a(qe,2),it=l(pt),Ve=a(l(it),2);Ce(Ve),s(it);var yt=a(it,2),Dt=a(l(yt),2);Ce(Dt),s(yt);var k=a(yt,2),z=a(l(k),2);Ce(z),s(k),s(pt);var _=a(pt,2),O=a(l(_),2);Ce(O),ta(2),s(_);var Z=a(_,2),ie=a(l(Z),2),he=l(ie);Ce(he);var _e=a(he,2);s(ie);var Te=a(ie,2);{var se=oe=>{var j=Wn();$t(j,5,()=>e(P),jt,(q,J,re)=>{var Fe=zn(),Ge=l(Fe),Pe=a(Ge);s(Fe),L(()=>{S(Ge,`${e(J)??""} `),et(Pe,"aria-label",`Remove ${e(J)??""}`)}),R("click",Pe,()=>V(re)),o(q,Fe)}),s(j),o(oe,j)};g(Te,oe=>{e(P),i(()=>e(P).length>0)&&oe(se)})}s(Z);var D=a(Z,2),te=a(l(D),2),De=l(te);Ce(De);var ze=a(De,2);ja(ze);var Qe=a(ze,2),mt=l(Qe),ye=a(l(mt),2);Ce(ye),s(mt);var ae=a(mt,2),u=a(l(ae),2);L(()=>{e(B),qt(()=>{})});var Je=l(u);Je.value=Je.__value="short";var xe=a(Je);xe.value=xe.__value="long",s(u),s(ae);var G=a(ae,2),be=l(G),le=l(be);Ce(le),ta(),s(be),s(G),s(Qe);var Me=a(Qe,2);s(te);var ke=a(te,2);{var We=oe=>{var j=Yn();$t(j,5,()=>e(ee),jt,(q,J,re)=>{var Fe=Jn(),Ge=l(Fe),Pe=l(Ge),Re=l(Pe,!0);s(Pe);var ct=a(Pe,2);s(Ge);var ft=a(Ge,2),Ie=l(ft,!0);s(ft);var Ee=a(ft,2);{var wt=ne=>{var Ze=Kn(),ht=l(Ze),M=a(ht);{var $e=x=>{var He=Pt("‚Ä¢ Requires Reaction");o(x,He)};g(M,x=>{e(J),i(()=>e(J).requiresReaction)&&x($e)})}s(Ze),L(()=>S(ht,`${e(J),i(()=>e(J).usesPerRest)??""} use${e(J),i(()=>e(J).usesPerRest>1?"s":"")??""} per ${e(J),i(()=>e(J).restType)??""}
                      rest `)),o(ne,Ze)},fe=ne=>{var Ze=bt(),ht=we(Ze);{var M=$e=>{var x=Vn();o($e,x)};g(ht,$e=>{e(J),i(()=>e(J).requiresReaction)&&$e(M)},!0)}o(ne,Ze)};g(Ee,ne=>{e(J),i(()=>e(J).usesPerRest)?ne(wt):ne(fe,!1)})}s(Fe),L(()=>{S(Re,(e(J),i(()=>e(J).name))),et(ct,"aria-label",`Remove ${e(J),i(()=>e(J).name)??""}`),S(Ie,(e(J),i(()=>e(J).description)))}),R("click",ct,()=>ve(re)),o(q,Fe)}),s(j),o(oe,j)};g(ke,oe=>{e(ee),i(()=>e(ee).length>0)&&oe(We)})}s(D),s(me);var Oe=a(me,2),Xe=l(Oe),ot=a(Xe,2);s(Oe),s(Y),s(I),R("click",je,Le),Ne(Ae,()=>e(p),oe=>n(p,oe)),Ne(tt,()=>e(m),oe=>n(m,oe)),Ne(Ve,()=>e(w),oe=>n(w,oe)),Ne(Dt,()=>e(y),oe=>n(y,oe)),Ne(z,()=>e(h),oe=>n(h,oe)),Ne(O,()=>e(W),oe=>n(W,oe)),Ne(he,()=>e(Q),oe=>n(Q,oe)),R("keydown",he,oe=>oe.key==="Enter"&&Ue()),R("click",_e,Ue),Ne(De,()=>e(K),oe=>n(K,oe)),Ne(ze,()=>e(E),oe=>n(E,oe)),Ne(ye,()=>e(A),oe=>n(A,oe)),Ha(u,()=>e(B),oe=>n(B,oe)),La(le,()=>e(F),oe=>n(F,oe)),R("click",Me,Be),R("click",Xe,Le),R("click",ot,ge),R("click",I,T),o(b,I)};g($,b=>{t()&&b(X)})}o(r,U),Kt()}var Zn=d("<option></option>"),eo=d("<button> </button>"),to=d('<button class="btn btn-primary calculate-btn use-enabled svelte-uvfntf">Calculate Damage</button>'),ao=d('<div class="adjustment-msg svelte-uvfntf"> </div>'),so=d('<div class="calculation-result svelte-uvfntf"><div class="result-header svelte-uvfntf"><h4 class="svelte-uvfntf">Damage Calculation</h4></div> <div class="result-content svelte-uvfntf"><div class="damage-breakdown svelte-uvfntf"><div class="damage-row svelte-uvfntf"><span class="label svelte-uvfntf">Original Damage:</span> <span class="value svelte-uvfntf"> </span></div> <div class="adjustments svelte-uvfntf"></div> <div class="damage-row final svelte-uvfntf"><span class="label svelte-uvfntf">Final Damage:</span> <span class="value damage-value svelte-uvfntf"> </span></div></div></div> <div class="result-actions svelte-uvfntf"><button class="btn btn-primary apply-btn use-enabled svelte-uvfntf">Apply Damage</button> <button class="btn btn-secondary cancel-btn use-enabled svelte-uvfntf">Cancel</button></div></div>'),lo=d('<div class="damage-form svelte-uvfntf"><div class="input-group svelte-uvfntf"><div class="input-field svelte-uvfntf"><label for="damageAmount" class="svelte-uvfntf">Damage Amount</label> <input type="number" id="damageAmount" min="0" placeholder="0" class="damage-input-field use-enabled svelte-uvfntf"/></div> <div class="input-field svelte-uvfntf"><label for="damageType" class="svelte-uvfntf">Damage Type</label> <input type="text" id="damageType" list="damageTypes" placeholder="e.g., fire, cold" class="damage-input-field use-enabled svelte-uvfntf"/> <datalist id="damageTypes"></datalist></div></div> <div class="quick-types svelte-uvfntf"><span class="quick-types-label svelte-uvfntf">Quick Select:</span> <!></div> <!></div>'),ro=d("<section><!> <!></section>");function io(r,c){Wt(c,!1);const t=()=>ut(de,"$character",p),v=()=>ut(_a,"$searchFilter",p),f=()=>ut(aa,"$collapsedStates",p),[p,m]=ca(),w=C();$a();let y=C(0),h=C(""),W=C(!1),P=C(0),Q=C([]);const ee=["slashing","piercing","bludgeoning","fire","cold","lightning","thunder","acid","poison","necrotic","radiant","psychic","force"];function K(){if(e(y)<0){Ut.add("Damage amount cannot be negative","error");return}if(!e(h).trim()){Ut.add("Please enter or select a damage type","error");return}const Be=Hl(e(y),e(h),t());n(P,Be.finalDamage),n(Q,Be.adjustments),n(W,!0)}function E(){de.update(Be=>Nl(Be,e(P))),Ut.add(`Applied ${e(P)} damage to character (${e(h)})`,"info"),n(y,0),n(h,""),n(W,!1),n(P,0),n(Q,[])}function A(){n(W,!1),n(P,0),n(Q,[])}Ye(()=>v(),()=>{n(w,!v()||"damage".includes(v().toLowerCase())||"resistance".includes(v().toLowerCase())||"immune".includes(v().toLowerCase()))}),pa(),zt();var B=ro();let F;var ue=l(B);{let Be=Ct(()=>(f(),i(()=>f().damageInput?"Expand":"Collapse")));Sa(ue,{title:"Apply Damage",get collapsed(){return f(),i(()=>f().damageInput)},get ariaLabel(){return e(Be)},onToggle:()=>aa.update(ve=>({...ve,damageInput:!ve.damageInput}))})}var Ue=a(ue,2);{var V=Be=>{var ve=lo(),ge=l(ve),Le=l(ge),T=a(l(Le),2);Ce(T),s(Le);var U=a(Le,2),$=a(l(U),2);Ce($);var X=a($,2);$t(X,5,()=>ee,jt,(me,ce)=>{var Ae=Zn(),qe={};L(()=>{qe!==(qe=e(ce))&&(Ae.value=(Ae.__value=e(ce))??"")}),o(me,Ae)}),s(X),s(U),s(ge);var b=a(ge,2),I=a(l(b),2);$t(I,1,()=>ee,jt,(me,ce)=>{var Ae=eo();let qe;var tt=l(Ae,!0);s(Ae),L(()=>{qe=Mt(Ae,1,"quick-type-btn use-enabled svelte-uvfntf",null,qe,{active:e(h)===e(ce)}),S(tt,e(ce))}),R("click",Ae,()=>n(h,e(ce))),o(me,Ae)}),s(b);var Y=a(b,2);{var Se=me=>{var ce=to();R("click",ce,K),o(me,ce)},je=me=>{var ce=so(),Ae=a(l(ce),2),qe=l(Ae),tt=l(qe),pt=a(l(tt),2),it=l(pt);s(pt),s(tt);var Ve=a(tt,2);$t(Ve,5,()=>e(Q),jt,(Z,ie)=>{var he=ao(),_e=l(he,!0);s(he),L(()=>S(_e,e(ie))),o(Z,he)}),s(Ve);var yt=a(Ve,2),Dt=a(l(yt),2),k=l(Dt,!0);s(Dt),s(yt),s(qe),s(Ae);var z=a(Ae,2),_=l(z),O=a(_,2);s(z),s(ce),L(()=>{S(it,`${e(y)??""} ${e(h)??""}`),S(k,e(P))}),R("click",_,E),R("click",O,A),o(me,ce)};g(Y,me=>{e(W)?me(je,!1):me(Se)})}s(ve),Ne(T,()=>e(y),me=>n(y,me)),Ne($,()=>e(h),me=>n(h,me)),o(Be,ve)};g(Ue,Be=>{f(),i(()=>!f().damageInput)&&Be(V)})}s(B),L(()=>F=Mt(B,1,"damage-input svelte-uvfntf",null,F,{hidden:!e(w)})),o(r,B),Kt(),m()}var no=d('<button class="console-toggle svelte-x96uf"> </button>'),oo=d('<div class="no-logs svelte-x96uf">No console messages yet</div>'),co=d('<div><span class="log-timestamp svelte-x96uf"> </span> <span class="log-type svelte-x96uf"> </span> <span class="log-message svelte-x96uf"> </span></div>'),vo=d('<div class="console-content svelte-x96uf"><!></div>'),uo=d('<div><div class="console-header svelte-x96uf"><span class="console-title svelte-x96uf"> </span> <div class="console-controls svelte-x96uf"><button class="control-btn svelte-x96uf"> </button> <button class="control-btn svelte-x96uf">üóëÔ∏è</button> <button class="control-btn svelte-x96uf">‚úï</button></div></div> <!></div>'),fo=d('<div class="console-viewer svelte-x96uf"><!> <!></div>');function po(r,c){Wt(c,!1);let t=C([]),v=C(!1),f=C(!1);wa(()=>{const K=console.log;console.log=function(...F){p("log",F),K.apply(console,F)};const E=console.error;console.error=function(...F){p("error",F),E.apply(console,F)};const A=console.warn;console.warn=function(...F){p("warn",F),A.apply(console,F)};const B=console.info;return console.info=function(...F){p("info",F),B.apply(console,F)},window.addEventListener("error",F=>{p("error",[`Uncaught Error: ${F.message} at ${F.filename}:${F.lineno}:${F.colno}`])}),window.addEventListener("unhandledrejection",F=>{p("error",[`Unhandled Promise Rejection: ${F.reason}`])}),()=>{console.log=K,console.error=E,console.warn=A,console.info=B}});function p(K,E){const A=E.map(F=>{if(typeof F=="object")try{return JSON.stringify(F,null,2)}catch{return String(F)}return String(F)}).join(" "),B=new Date().toLocaleTimeString();n(t,[...e(t),{type:K,message:A,timestamp:B}]),e(t).length>100&&n(t,e(t).slice(-100))}function m(){n(t,[])}function w(){n(v,!e(v))}function y(){n(f,!e(f))}zt();var h=fo(),W=l(h);{var P=K=>{var E=no(),A=l(E);s(E),L(()=>S(A,`üêõ Console (${e(t).length??""})`)),R("click",E,w),o(K,E)};g(W,K=>{e(v)||K(P)})}var Q=a(W,2);{var ee=K=>{var E=uo();let A;var B=l(E),F=l(B),ue=l(F);s(F);var Ue=a(F,2),V=l(Ue),Be=l(V,!0);s(V);var ve=a(V,2),ge=a(ve,2);s(Ue),s(B);var Le=a(B,2);{var T=U=>{var $=vo(),X=l($);{var b=Y=>{var Se=oo();o(Y,Se)},I=Y=>{var Se=bt(),je=we(Se);$t(je,1,()=>e(t),jt,(me,ce)=>{var Ae=co(),qe=l(Ae),tt=l(qe,!0);s(qe);var pt=a(qe,2),it=l(pt);s(pt);var Ve=a(pt,2),yt=l(Ve,!0);s(Ve),s(Ae),L(Dt=>{Mt(Ae,1,`log-entry ${e(ce).type??""}`,"svelte-x96uf"),S(tt,e(ce).timestamp),S(it,`[${Dt??""}]`),S(yt,e(ce).message)},[()=>e(ce).type.toUpperCase()]),o(me,Ae)}),o(Y,Se)};g(X,Y=>{e(t).length===0?Y(b):Y(I,!1)})}s($),o(U,$)};g(Le,U=>{e(f)||U(T)})}s(E),L(()=>{A=Mt(E,1,"console-panel svelte-x96uf",null,A,{minimized:e(f)}),S(ue,`üêõ Console Logs (${e(t).length??""})`),S(Be,e(f)?"‚ñ≤":"‚ñº")}),R("click",V,y),R("click",ve,m),R("click",ge,w),o(K,E)};g(Q,K=>{e(v)&&K(ee)})}s(h),o(r,h),Kt()}var mo=d('<link rel="icon" type="image/png" href="favicon4.png"/> <meta name="viewport" content="width=device-width, initial-scale=1"/>',1),go=d('<span class="character-name svelte-1uha8ag"> </span>'),bo=d("<span> </span>"),ho=d('<div class="spell-slots-header svelte-1uha8ag"></div>'),_o=d("<span> </span><br/>",1),yo=d("<span> </span><br/>",1),xo=d("<span> </span><br/>",1),$o=d("<span> </span><br/>",1),wo=d("<span> </span><br/>",1),So=d("<span> </span><br/>",1),ko=d("<br/><em> <!>)</em>",1),Co=d("<br/><em>(requires reaction)</em>",1),Do=d('<div class="ability-detail"><strong> </strong> <!></div>'),Lo=d('<div class="abilities-section"><strong>Abilities:</strong><br/> <!></div>'),jo=d('<span class="effect-tooltip"><strong> </strong><br/> <br/> <!> <!> <!> <!> <!> <!> <!></span>'),Ao=d('<button class="effect-remove-btn svelte-1uha8ag">√ó</button>'),Ro=d('<span class="effect-badge svelte-1uha8ag" tabindex="0"> <!> <!></span>'),Bo=d(`<div class="active-effects-header svelte-1uha8ag"></div> <style>.effect-badge {
              position: relative;
            }
            .effect-tooltip {
              position: absolute;
              top: 120%;
              left: 50%;
              transform: translateX(-50%);
              background: #fff;
              color: #222;
              border: 1px solid #a5b4fc;
              border-radius: 6px;
              padding: 8px 12px;
              font-size: 0.95em;
              box-shadow: 0 2px 8px rgba(0, 0, 0, 0.12);
              z-index: 10;
              min-width: 180px;
              max-width: 300px;
              white-space: normal;
              pointer-events: none;
              opacity: 1;
              transition: opacity 0.15s;
            }

            .abilities-section {
              margin-top: 8px;
              padding-top: 8px;
              border-top: 1px solid #e5e7eb;
            }

            .ability-detail {
              margin-top: 6px;
              padding: 4px;
              background: #f9fafb;
              border-radius: 4px;
              font-size: 0.9em;
            }

            .ability-detail strong {
              color: #6366f1;
            }

            .ability-detail em {
              font-size: 0.85em;
              color: #6b7280;
            }</style>`,1),To=d('<div class="rest-menu svelte-1uha8ag"><button class="rest-option svelte-1uha8ag">‚òï Short Rest</button> <button class="rest-option svelte-1uha8ag">üõèÔ∏è Long Rest</button></div>'),Mo=d('<div class="container svelte-1uha8ag"><header class="svelte-1uha8ag"><div class="header-top svelte-1uha8ag"><div class="header-title svelte-1uha8ag"><div class="title-row svelte-1uha8ag"><h1 class="svelte-1uha8ag">D&D Character Sheet</h1> <!></div> <!> <!></div> <div class="header-right svelte-1uha8ag"><div class="header-controls svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">üé≤</span><span class="btn-text svelte-1uha8ag">Roll Dice</span></button> <div class="rest-button-container svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">üò¥</span><span class="btn-text svelte-1uha8ag">Rest</span></button> <!></div> <button class="btn btn-secondary use-enabled" title="Add custom condition with effects"><span class="btn-icon svelte-1uha8ag">‚ú®</span><span class="btn-text svelte-1uha8ag">Add Condition</span></button> <div class="mode-toggle"><button><span class="btn-icon svelte-1uha8ag"> </span><span class="btn-text svelte-1uha8ag"> </span></button></div></div> <div class="header-search svelte-1uha8ag"><input type="text" placeholder="üîç Search..." class="search-input use-enabled svelte-1uha8ag"/></div></div></div> <div class="header-actions svelte-1uha8ag"><button class="btn btn-mode svelte-1uha8ag">üìö Browse Spells & Feats</button> <button class="btn btn-secondary">Save to Gist</button> <button class="btn btn-secondary">Load from Gist</button> <button class="btn btn-secondary">Export JSON</button> <button class="btn btn-secondary">Import JSON</button> <input type="file" accept=".json" style="display: none;"/></div></header> <main class="svelte-1uha8ag"><!> <!> <!> <!> <!> <!> <!> <!></main></div> <!> <!> <!> <!> <!> <!>',1);function Go(r,c){Wt(c,!1);const t=()=>ut(de,"$character",p),v=()=>ut(xa,"$isEditMode",p),f=()=>ut(_a,"$searchFilter",p),[p,m]=ca();function w(){const M=[],$e=t().classFeatures.spellSlotsByLevel||{};for(let x=1;x<=9;x++){const He=$e[x];if(He&&He.length>0){const H=He.length,Bt=He.filter(_t=>_t).length;M.push({level:x,available:H-Bt,total:H})}}return M}let y=C(!1),h=C(!1),W=C(!1),P=C(!1),Q=C("save"),ee=C(void 0),K=C(""),E=C(""),A=C(""),B=C(!1),F=C([]),ue=C("other"),Ue=C(),V=!1,Be=1,ve=C(!1),ge=C(null);function Le(M){n(ge,M)}function T(){n(ge,null)}function U(M){n(ge,e(ge)===M?null:M)}function $(M){de.update($e=>($e.activeStates||($e.activeStates=[]),$e.activeStates=[...$e.activeStates,M],$e)),n(P,!1),Ut.add(`Added condition: ${M.name}`,"success")}function X(){n(P,!1)}function b(){const M=[];de.update(H=>{const Bt=H.hitDice.current;H.hitDice.current=Math.min(H.hitDice.max,H.hitDice.current+Math.max(1,Math.floor(H.hitDice.max/2)));const _t=H.hitDice.current-Bt;if(_t>0&&M.push(`${_t} hit ${_t===1?"die":"dice"}`),H.class){const at=Ra(H.class,H.level,H.subclass);H.classFeatures.features||(H.classFeatures.features={}),at.forEach(pe=>{if(pe.resetOn==="short"){const vt=pe.name.replace(/\s+/g,"");if(pe.type==="uses"){const st=typeof pe.maxUses=="function"?pe.maxUses(H.level):pe.maxUses;H.classFeatures.features[vt]=Array(st).fill(!1),M.push(pe.name)}else if(pe.type==="pool"){const st=typeof pe.maxPool=="function"?pe.maxPool(H.level):pe.maxPool;st!==void 0&&(H.classFeatures.features[vt]=st,M.push(pe.name))}}})}return H.activeStates&&H.activeStates.forEach(at=>{at.abilities&&at.abilities.forEach(pe=>{if(pe.restType==="short"&&pe.usesPerRest){const vt=pe.usesPerRest-(pe.currentUses||0)>0;pe.currentUses=pe.usesPerRest,vt&&M.push(`${at.name}: ${pe.name}`)}})}),H}),_s("short"),ys(t().race,t().level).some(H=>H.restType==="short"&&H.usesPerRest)&&M.push("racial traits"),n(ve,!1);const He=M.length>0?`Short rest taken! Restored: ${M.join(", ")}`:"Short rest taken!";Ut.add(He,"success")}function I(){const M=[];de.update(H=>{const Bt=H.maxHP-H.currentHP;Bt>0&&M.push(`${Bt} HP`),H.currentHP=H.maxHP,H.tempHP=0;const _t=H.hitDice.max-H.hitDice.current;_t>0&&M.push(`${_t} hit ${_t===1?"die":"dice"}`),H.hitDice.current=H.hitDice.max;let at=0;if(H.classFeatures.spellSlotsByLevel&&Object.keys(H.classFeatures.spellSlotsByLevel).forEach(pe=>{const vt=H.classFeatures.spellSlotsByLevel[parseInt(pe)];if(vt){const st=vt.filter(Ft=>Ft).length;at+=st,H.classFeatures.spellSlotsByLevel[parseInt(pe)]=Array(vt.length).fill(!1)}}),at>0&&M.push(`${at} spell ${at===1?"slot":"slots"}`),H.class){const pe=Ra(H.class,H.level,H.subclass);H.classFeatures.features||(H.classFeatures.features={});let vt=!1;pe.forEach(st=>{const Ft=st.name.replace(/\s+/g,"");if(!(st.type==="info"||st.type==="channelDivinity")){if(st.type==="uses"){const Ke=typeof st.maxUses=="function"?st.maxUses(H.level):st.maxUses;H.classFeatures.features[Ft]=Array(Ke).fill(!1),vt=!0}else if(st.type==="pool"){const Ke=typeof st.maxPool=="function"?st.maxPool(H.level):st.maxPool;Ke!==void 0&&(H.classFeatures.features[Ft]=Ke,vt=!0)}}}),vt&&M.push("all class features")}if(H.activeStates){let pe=!1;H.activeStates.forEach(vt=>{vt.abilities&&vt.abilities.forEach(st=>{if(st.usesPerRest){const Ft=(st.currentUses||0)<st.usesPerRest;st.currentUses=st.usesPerRest,Ft&&(pe=!0)}})}),pe&&M.push("condition abilities")}return H}),_s("long"),ys(t().race,t().level).some(H=>H.usesPerRest)&&M.push("racial traits"),n(ve,!1);const He=M.length>0?`Long rest taken! Restored: ${M.join(", ")}`:"Long rest taken! Fully rested.";Ut.add(He,"success")}function Y(M){n(K,""),n(E,""),n(A,""),n(B,!1),n(F,[]),n(ue,"other"),V=!1,typeof M=="string"?n(K,M):(n(K,M.notation),n(E,M.damageNotation||""),n(A,M.attackName||""),n(B,!!M.applyHalfDamage),n(F,M.bonusBreakdown||[]),n(ue,M.rollType||"other")),n(y,!0)}function Se(M){const{notation:$e,count:x,bonusBreakdown:He}=M.detail;n(K,""),V=!0,Be=x||1,setTimeout(()=>{n(K,$e),n(E,""),n(A,"Hit Die"),n(F,He||[]),n(ue,"other")},0),n(y,!0)}function je(){if(n(y,!1),V&&e(Ue)){const M=e(Ue).getLastRollTotal();if(M!==null){const $e=Math.max(1,M);de.update(x=>(x.hitDice.current=Math.max(0,x.hitDice.current-Be),x.currentHP=Math.min(x.maxHP,x.currentHP+$e),x))}V=!1}}function me(){xa.update(M=>!M)}function ce(M){M.target.closest(".rest-button-container")||n(ve,!1)}wa(()=>{const M=xa.subscribe($e=>{$e?document.body.classList.remove("use-mode"):document.body.classList.add("use-mode")});return document.addEventListener("click",ce),()=>{M(),document.removeEventListener("click",ce)}});function Ae(){dl(t())}function qe(){e(ee)?.click()}async function tt(M){const x=M.target.files?.[0];if(x)try{const He=await ul(x);de.set(He),alert("Character imported successfully!")}catch{alert("Failed to import character file")}}zt();var pt=Mo();cl("1uha8ag",M=>{var $e=mo();ta(2),Bs(()=>{rl.title="D&D Character Sheet"}),o(M,$e)});var it=we(pt),Ve=l(it),yt=l(Ve),Dt=l(yt),k=l(Dt),z=a(l(k),2);{var _=M=>{var $e=go(),x=l($e);s($e),L(()=>S(x,`${t().name??""} (${t().level??""})`)),o(M,$e)};g(z,M=>{t().name&&M(_)})}s(k);var O=a(k,2);{var Z=M=>{var $e=ho();$t($e,5,w,jt,(x,He)=>{var H=bo();let Bt;var _t=l(H);s(H),L(()=>{Bt=Mt(H,1,"slot-badge svelte-1uha8ag",null,Bt,{depleted:e(He).available===0}),S(_t,`Lv${e(He).level??""}: ${e(He).available??""}/${e(He).total??""}`)}),o(x,H)}),s($e),o(M,$e)};g(O,M=>{w().length>0&&M(Z)})}var ie=a(O,2);{var he=M=>{var $e=Bo(),x=we($e);$t(x,5,()=>t().activeStates,jt,(He,H,Bt)=>{var _t=Ro(),at=l(_t),pe=a(at);{var vt=Ke=>{var gt=jo(),xt=l(gt),Ht=l(xt,!0);s(xt);var ra=a(xt,2),St=a(ra,3);{var Rt=rt=>{var dt=_o(),nt=we(dt),Tt=l(nt);s(nt),ta(),L(()=>S(Tt,`Attack Bonus: ${typeof e(H).attackBonus=="number"&&e(H).attackBonus>0?"+":""}${e(H).attackBonus??""}`)),o(rt,dt)};g(St,rt=>{e(H).attackBonus&&rt(Rt)})}var sa=a(St,2);{var ia=rt=>{var dt=yo(),nt=we(dt),Tt=l(nt);s(nt),ta(),L(()=>S(Tt,`Damage Bonus: ${typeof e(H).damageBonus=="number"&&e(H).damageBonus>0?"+":""}${e(H).damageBonus??""}`)),o(rt,dt)};g(sa,rt=>{e(H).damageBonus&&rt(ia)})}var Xt=a(sa,2);{var Lt=rt=>{var dt=xo(),nt=we(dt),Tt=l(nt);s(nt),ta(),L(()=>S(Tt,`AC Bonus: ${e(H).acBonus>0?"+":""}${e(H).acBonus??""}`)),o(rt,dt)};g(Xt,rt=>{e(H).acBonus&&rt(Lt)})}var lt=a(Xt,2);{var It=rt=>{var dt=$o(),nt=we(dt),Tt=l(nt);s(nt),ta(),L(()=>S(Tt,`Darkvision: ${e(H).darkvision??""} feet`)),o(rt,dt)};g(lt,rt=>{e(H).darkvision&&rt(It)})}var Yt=a(lt,2);{var Qt=rt=>{var dt=wo(),nt=we(dt),Tt=l(nt);s(nt),ta(),L(Et=>S(Tt,`Resistances: ${Et??""}`),[()=>e(H).resistances.join(", ")]),o(rt,dt)};g(Yt,rt=>{e(H).resistances&&e(H).resistances.length>0&&rt(Qt)})}var na=a(Yt,2);{var va=rt=>{var dt=So(),nt=we(dt),Tt=l(nt);s(nt),ta(),L(Et=>S(Tt,`Immunities: ${Et??""}`),[()=>e(H).immunities.join(", ")]),o(rt,dt)};g(na,rt=>{e(H).immunities&&e(H).immunities.length>0&&rt(va)})}var da=a(na,2);{var Vt=rt=>{var dt=Lo(),nt=a(l(dt),3);$t(nt,1,()=>e(H).abilities,jt,(Tt,Et)=>{var ua=Do(),Nt=l(ua),la=l(Nt);s(Nt);var Gt=a(Nt),fa=a(Gt);{var ma=Zt=>{var ea=ko(),kt=a(we(ea)),Jt=l(kt),ga=a(Jt);{var Ba=Ta=>{var Za=Pt(", requires reaction");o(Ta,Za)};g(ga,Ta=>{e(Et).requiresReaction&&Ta(Ba)})}ta(),s(kt),L(()=>S(Jt,`(${(e(Et).currentUses||0)??""}/${e(Et).usesPerRest??""} uses per ${e(Et).restType??""}
                                rest`)),o(Zt,ea)},ka=Zt=>{var ea=bt(),kt=we(ea);{var Jt=ga=>{var Ba=Co();ta(),o(ga,Ba)};g(kt,ga=>{e(Et).requiresReaction&&ga(Jt)},!0)}o(Zt,ea)};g(fa,Zt=>{e(Et).usesPerRest?Zt(ma):Zt(ka,!1)})}s(ua),L(()=>{S(la,`${e(Et).name??""}:`),S(Gt,` ${e(Et).description??""} `)}),o(Tt,ua)}),s(dt),o(rt,dt)};g(da,rt=>{e(H).abilities&&e(H).abilities.length>0&&rt(Vt)})}s(gt),L(()=>{S(Ht,e(H).name),S(ra,` ${e(H).description??""}`)}),o(Ke,gt)};g(pe,Ke=>{e(ge)===Bt&&Ke(vt)})}var st=a(pe,2);{var Ft=Ke=>{var gt=Ao();L(()=>et(gt,"title",`End ${e(H).name??""}`)),R("click",gt,()=>{de.update(xt=>{if(xt.activeStates){const Ht=xt.activeStates[Bt];Ht?.hpBonus&&Ht.target!=="other"&&(xt.maxHP-=Ht.hpBonus,xt.currentHP=Math.max(1,Math.min(xt.currentHP-Ht.hpBonus,xt.maxHP))),xt.activeStates=xt.activeStates.filter((ra,St)=>St!==Bt)}return xt})}),o(Ke,gt)};g(st,Ke=>{v()||Ke(Ft)})}s(_t),L(()=>{et(_t,"aria-label",e(H).name),S(at,`‚ú® ${e(H).name??""} `)}),R("mouseenter",_t,()=>Le(Bt)),R("mouseleave",_t,T),R("focus",_t,()=>Le(Bt)),R("blur",_t,T),R("click",_t,()=>U(Bt)),o(He,_t)}),s(x),ta(2),o(M,$e)};g(ie,M=>{t().activeStates&&t().activeStates.length>0&&M(he)})}s(Dt);var _e=a(Dt,2),Te=l(_e),se=l(Te),D=a(se,2),te=l(D),De=a(te,2);{var ze=M=>{var $e=To(),x=l($e),He=a(x,2);s($e),R("click",x,b),R("click",He,I),o(M,$e)};g(De,M=>{e(ve)&&M(ze)})}s(D);var Qe=a(D,2),mt=a(Qe,2),ye=l(mt);let ae;var u=l(ye),Je=l(u,!0);s(u);var xe=a(u),G=l(xe,!0);s(xe),s(ye),s(mt),s(Te);var be=a(Te,2),le=l(be);Ce(le),s(be),s(_e),s(yt);var Me=a(yt,2),ke=l(Me),We=a(ke,2),Oe=a(We,2),Xe=a(Oe,2),ot=a(Xe,2),oe=a(ot,2);Ua(oe,M=>n(ee,M),()=>e(ee)),s(Me),s(Ve);var j=a(Ve,2),q=l(j);Rl(q,{});var J=a(q,2);Fl(J,{$$events:{roll:M=>Y(M.detail)}});var re=a(J,2);ar(re,{$$events:{roll:M=>Y(M.detail)}});var Fe=a(re,2);Xl(Fe,{$$events:{rollHitDice:Se}});var Ge=a(Fe,2);io(Ge,{});var Pe=a(Ge,2);fi(Pe,{$$events:{roll:M=>Y(M.detail)}});var Re=a(Pe,2);Ei(Re,{});var ct=a(Re,2);Ni(ct,{}),s(j),s(it);var ft=a(it,2);Ua(on(ft,{get notation(){return e(K)},get damageNotation(){return e(E)},get attackName(){return e(A)},get applyHalfDamage(){return e(B)},get bonusBreakdown(){return e(F)},get rollType(){return e(ue)},get visible(){return e(y)},$$events:{close:je},$$legacy:!0}),M=>n(Ue,M),()=>e(Ue));var Ie=a(ft,2);{var Ee=M=>{Ln(M,{get mode(){return e(Q)},$$events:{close:()=>n(h,!1)}})};g(Ie,M=>{e(h)&&M(Ee)})}var wt=a(Ie,2);{var fe=M=>{qn(M,{onClose:()=>n(W,!1)})};g(wt,M=>{e(W)&&M(fe)})}var ne=a(wt,2);Xn(ne,{get show(){return e(P)},onSave:$,onCancel:X});var Ze=a(ne,2);vl(Ze,{});var ht=a(Ze,2);po(ht,{}),L(()=>{ae=Mt(ye,1,"btn btn-mode svelte-1uha8ag",null,ae,{"use-mode":!v()}),S(Je,v()?"üìù":"üé≤"),S(G,v()?"Edit Mode":"Use Mode")}),R("click",se,()=>{n(F,[]),n(y,!0)}),R("click",te,()=>n(ve,!e(ve))),R("click",Qe,()=>n(P,!0)),R("click",ye,me),Ne(le,f,M=>fl(_a,M)),R("click",ke,()=>n(W,!0)),R("click",We,()=>{n(Q,"save"),n(h,!0)}),R("click",Oe,()=>{n(Q,"load"),n(h,!0)}),R("click",Xe,Ae),R("click",ot,qe),R("change",oe,tt),o(r,pt),Kt(),m()}export{Go as component};
