import{d as ds,g as Is,f as d,e as j,a as o,s as $,c as bt,t as Mt}from"../chunks/BESELRjb.js";import{i as Ot}from"../chunks/JMgyEzd3.js";import{c as _a,o as $a,a as Es,b as Us}from"../chunks/CtPH092J.js";import{F as k,T as ua,Y as ts,j as Hs,aZ as Ns,U as us,ag as Os,aD as Gs,aK as qs,aE as zs,a1 as Ws,av as Ia,a7 as rs,i as Cs,a_ as Ks,a$ as Ds,b0 as Ga,K as ha,e as Ls,b1 as js,b2 as Vs,b3 as Js,b4 as Ys,q as as,b5 as Qs,b6 as Xs,ab as Zs,d as i,r as os,g as el,C as Gt,G as qt,H as l,I as s,J as a,b7 as et,b8 as ca,s as r,a4 as S,f as e,m as _t,E as je,b9 as Ht,ao as Qt,A as ee,ba as pa,bb as xa,bc as tl}from"../chunks/DyJ43TGI.js";import{t as al,c as Xt,a as ge,e as yt,i as kt,u as As,s as ga,b as Bt,d as qa,f as ma,g as sl,j as Nt,k as fs,l as ps,m as ss,n as ll,h as nl,T as il,o as rl,p as ol,r as ms}from"../chunks/t82uA2lk.js";import{i as g,s as ra,a as dt,b as Ft,d as La,e as cl}from"../chunks/CCL4udNy.js";import{p as Ct,b as Ra}from"../chunks/iXw84bXb.js";import{b as ja,r as vl}from"../chunks/DqRFSKdp.js";function dl(n,c,t=!1,v=!1,u=!1){var f=n,p="";k(()=>{var C=Hs;if(p===(p=c()??"")){ua&&ts();return}if(C.nodes_start!==null&&(Ns(C.nodes_start,C.nodes_end),C.nodes_start=C.nodes_end=null),p!==""){if(ua){us.data;for(var h=ts(),_=h;h!==null&&(h.nodeType!==Os||h.data!=="");)_=h,h=Gs(h);if(h===null)throw qs(),zs;ds(us,_),f=Ws(h);return}var X=p+"";t?X=`<svg>${X}</svg>`:v&&(X=`<math>${X}</math>`);var P=Is(X);if((t||v)&&(P=Ia(P)),ds(Ia(P),P.lastChild),t||v)for(;Ia(P);)f.before(Ia(P));else f.before(P)}})}function ul(n,c,t,v,u){ua&&ts();var f=c.$$slots?.[t],p=!1;f===!0&&(f=c[t],p=!0),f===void 0?u!==null&&u(n):f(n,p?()=>v:v)}function fl(n,c,t,v){var u=n.__style;if(ua||u!==c){var f=al(c);(!ua||f!==n.getAttribute("style"))&&(f==null?n.removeAttribute("style"):n.style.cssText=f),n.__style=c}return v}function Oa(n,c,t=!1){if(n.multiple){if(c==null)return;if(!Cs(c))return Ks();for(var v of n.options)v.selected=c.includes(Aa(v));return}for(v of n.options){var u=Aa(v);if(Ds(u,c)){v.selected=!0;return}}(!t||c!==void 0)&&(n.selectedIndex=-1)}function ls(n){var c=new MutationObserver(()=>{Oa(n,n.__value)});c.observe(n,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),rs(()=>{c.disconnect()})}function Ta(n,c,t=c){var v=new WeakSet,u=!0;Ga(n,"change",f=>{var p=f?"[selected]":":checked",C;if(n.multiple)C=[].map.call(n.querySelectorAll(p),Aa);else{var h=n.querySelector(p)??n.querySelector("option:not([disabled])");C=h&&Aa(h)}t(C),ha!==null&&v.add(ha)}),Ls(()=>{var f=c();if(n===document.activeElement){var p=js??ha;if(v.has(p))return}if(Oa(n,f,u),u&&f===void 0){var C=n.querySelector(":checked");C!==null&&(f=Aa(C),t(f))}n.__value=f,u=!1}),ls(n)}function Aa(n){return"__value"in n?n.__value:n.value}const pl=Symbol("is custom element"),ml=Symbol("is html");function Be(n){if(ua){var c=!1,t=()=>{if(!c){if(c=!0,n.hasAttribute("value")){var v=n.value;lt(n,"value",null),n.value=v}if(n.hasAttribute("checked")){var u=n.checked;lt(n,"checked",null),n.checked=u}}};n.__on_r=t,as(t),Qs()}}function Ba(n,c){var t=cs(n);t.value===(t.value=c??void 0)||n.value===c&&(c!==0||n.nodeName!=="PROGRESS")||(n.value=c??"")}function Bs(n,c){var t=cs(n);t.checked!==(t.checked=c??void 0)&&(n.checked=c)}function lt(n,c,t,v){var u=cs(n);ua&&(u[c]=n.getAttribute(c),c==="src"||c==="srcset"||c==="href"&&n.nodeName==="LINK")||u[c]!==(u[c]=t)&&(c==="loading"&&(n[Vs]=t),t==null?n.removeAttribute(c):typeof t!="string"&&gl(n).includes(c)?n[c]=t:n.setAttribute(c,t))}function cs(n){return n.__attributes??={[pl]:n.nodeName.includes("-"),[ml]:n.namespaceURI===Js}}var gs=new Map;function gl(n){var c=n.getAttribute("is")||n.nodeName,t=gs.get(c);if(t)return t;gs.set(c,t=[]);for(var v,u=n,f=Element.prototype;f!==u;){v=Xs(u);for(var p in v)v[p].set&&t.push(p);u=Ys(u)}return t}function qe(n,c,t=c){var v=new WeakSet;Ga(n,"input",async u=>{var f=u?n.defaultValue:n.value;if(f=Ja(n)?Ya(f):f,t(f),ha!==null&&v.add(ha),await Zs(),f!==(f=c())){var p=n.selectionStart,C=n.selectionEnd,h=n.value.length;if(n.value=f??"",C!==null){var _=n.value.length;p===C&&C===h&&_>h?(n.selectionStart=_,n.selectionEnd=_):(n.selectionStart=p,n.selectionEnd=Math.min(C,_))}}}),(ua&&n.defaultValue!==n.value||i(c)==null&&n.value)&&(t(Ja(n)?Ya(n.value):n.value),ha!==null&&v.add(ha)),os(()=>{var u=c();if(n===document.activeElement){var f=js??ha;if(v.has(f))return}Ja(n)&&u===Ya(n.value)||n.type==="date"&&!u&&!n.value||u!==n.value&&(n.value=u??"")})}const Va=new Set;function bs(n,c,t,v,u=v){var f=t.getAttribute("type")==="checkbox",p=n;let C=!1;if(c!==null)for(var h of c)p=p[h]??=[];p.push(t),Ga(t,"change",()=>{var _=t.__value;f&&(_=hs(p,_,t.checked)),u(_)},()=>u(f?[]:null)),os(()=>{var _=v();if(ua&&t.defaultChecked!==t.checked){C=!0;return}f?(_=_||[],t.checked=_.includes(t.__value)):t.checked=Ds(t.__value,_)}),rs(()=>{var _=p.indexOf(t);_!==-1&&p.splice(_,1)}),Va.has(p)||(Va.add(p),as(()=>{p.sort((_,X)=>_.compareDocumentPosition(X)===4?-1:1),Va.delete(p)})),as(()=>{if(C){var _;if(f)_=hs(p,_,t.checked);else{var X=p.find(P=>P.checked);_=X?.__value}u(_)}})}function wa(n,c,t=c){Ga(n,"change",v=>{var u=v?n.defaultChecked:n.checked;t(u)}),(ua&&n.defaultChecked!==n.checked||i(c)==null)&&t(n.checked),os(()=>{var v=c();n.checked=!!v})}function hs(n,c,t){for(var v=new Set,u=0;u<n.length;u+=1)n[u].checked&&v.add(n[u].__value);return t||v.delete(c),Array.from(v)}function Ja(n){var c=n.type;return c==="number"||c==="range"}function Ya(n){return n===""?null:+n}function bl(n,c,t){var v=el(n,c);v&&v.set&&(n[c]=t,rs(()=>{n[c]=null}))}function vs(n){return function(...c){var t=c[0];return t.stopPropagation(),n?.apply(this,c)}}function ka(n,c){var t=n.$$events?.[c.type],v=Cs(t)?t.slice():t==null?[]:[t];for(var u of v)u.call(this,c)}const hl="";function Rs(...n){return ja+hl+vl(n[0],n[1])}const ns={paladin:{name:"Paladin",hitDice:"d10",spellcaster:!0,spellcastingAbility:"charisma",spellSlotsByLevel:{1:0,2:2,3:3,4:3,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Divine Sense",type:"uses",maxUses:(n,c=1)=>1+Math.max(1,c),resetOn:"long",description:"Detect celestials, fiends, and undead within 60 feet",minLevel:1},{name:"Lay on Hands",type:"pool",maxPool:n=>n*5,resetOn:"long",description:"Heal wounds or cure disease",minLevel:1},{name:"Divine Smite",type:"spellSlot",description:"Expend spell slot to deal extra radiant damage",minLevel:2,rollable:!0},{name:"Channel Divinity",type:"pool",maxPool:n=>n>=18?3:n>=6?2:1,resetOn:"short",description:"Sacred Weapon or Turn Undead",minLevel:3}]},fighter:{name:"Fighter",hitDice:"d10",spellcaster:!1,features:[{name:"Second Wind",type:"uses",maxUses:1,resetOn:"short",description:"Regain 1d10 + fighter level HP as bonus action",minLevel:1,rollable:!0,rollFormula:n=>`1d10+${n}`},{name:"Action Surge",type:"uses",maxUses:n=>n>=17?2:1,resetOn:"short",description:"Take one additional action on your turn",minLevel:2},{name:"Indomitable",type:"uses",maxUses:n=>n>=17?3:n>=13?2:1,resetOn:"long",description:"Reroll a failed saving throw",minLevel:9}],subclasses:{champion:{name:"Champion",features:[{name:"Improved Critical",type:"info",description:"Critical hit on 19-20",minLevel:3},{name:"Remarkable Athlete",type:"info",description:"Add half proficiency to STR/DEX/CON checks, increase long jump distance",minLevel:7},{name:"Additional Fighting Style",type:"info",description:"Choose a second fighting style",minLevel:10},{name:"Superior Critical",type:"info",description:"Critical hit on 18-20",minLevel:15},{name:"Survivor",type:"info",description:"Regain 5 + CON mod HP at start of turn if below half HP",minLevel:18}]},battlemaster:{name:"Battle Master",features:[{name:"Combat Superiority",type:"uses",maxUses:n=>n>=15?6:n>=7?5:4,resetOn:"short",description:n=>`Use superiority dice (${n>=18?"d12":n>=10?"d10":"d8"}) for maneuvers`,minLevel:3},{name:"Know Your Enemy",type:"info",description:"Learn capabilities of creatures you observe",minLevel:7},{name:"Improved Combat Superiority",type:"info",description:"Superiority dice become d10",minLevel:10},{name:"Relentless",type:"info",description:"Regain 1 superiority die if you have none at start of turn",minLevel:15}]}}},rogue:{name:"Rogue",hitDice:"d8",spellcaster:!1,features:[{name:"Sneak Attack",type:"info",description:n=>`Deal ${Math.ceil(n/2)}d6 extra damage once per turn with advantage or ally nearby`,minLevel:1,rollable:!0,rollFormula:n=>`${Math.ceil(n/2)}d6`},{name:"Cunning Action",type:"info",description:"Dash, Disengage, or Hide as a bonus action",minLevel:2},{name:"Uncanny Dodge",type:"info",description:"Use reaction to halve damage from an attack",minLevel:5},{name:"Evasion",type:"info",description:"Take no damage on successful Dex save (half on fail)",minLevel:7}]},wizard:{name:"Wizard",hitDice:"d6",spellcaster:!0,spellcastingAbility:"intelligence",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Arcane Recovery",type:"uses",maxUses:1,resetOn:"long",description:n=>`Recover spell slots totaling up to ${Math.ceil(n/2)} levels during short rest`,minLevel:1},{name:"Spell Mastery",type:"info",description:"Cast one 1st-level and one 2nd-level spell at will",minLevel:18}]},cleric:{name:"Cleric",hitDice:"d8",spellcaster:!0,spellcastingAbility:"wisdom",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Channel Divinity",type:"pool",maxPool:n=>n>=18?3:n>=6?2:1,resetOn:"short",description:"Turn Undead or domain-specific ability",minLevel:2},{name:"Destroy Undead",type:"info",description:n=>`Channel Divinity destroys undead of CR ${n>=17?4:n>=14?3:n>=11?2:n>=8?1:.5} or lower`,minLevel:5},{name:"Divine Intervention",type:"uses",maxUses:1,resetOn:"long",description:n=>`${n}% chance to succeed, implore deity for aid`,minLevel:10}],subclasses:{war:{name:"War Domain",features:[{name:"War Priest",type:"uses",maxUses:(n,c=1)=>Math.max(1,c),resetOn:"long",description:"Make one weapon attack as a bonus action",minLevel:1},{name:"Guided Strike",type:"channelDivinity",description:"Use your Channel Divinity to gain +10 to an attack roll. Make this choice after you see the roll, but before the DM says whether the attack hits or misses.",minLevel:2,resetOn:"short"},{name:"War God's Blessing",type:"channelDivinity",description:"Use reaction to grant +10 to an ally's attack roll within 30 feet. Consumes one use of Channel Divinity.",minLevel:6,resetOn:"short"},{name:"Divine Strike",type:"info",description:n=>`Deal extra ${n>=14?"2d8":"1d8"} weapon damage once per turn`,minLevel:8,rollable:!0,rollFormula:n=>n>=14?"2d8":"1d8"},{name:"Avatar of Battle",type:"info",description:"Gain resistance to nonmagical weapon damage",minLevel:17}]},life:{name:"Life Domain",features:[{name:"Disciple of Life",type:"info",description:"Healing spells restore additional 2 + spell level HP",minLevel:1},{name:"Preserve Life",type:"pool",maxPool:n=>n*5,resetOn:"short",description:"Restore HP to creatures within 30 feet",minLevel:2},{name:"Blessed Healer",type:"info",description:"Regain 2 + spell level HP when you cast healing spell",minLevel:6},{name:"Divine Strike",type:"info",description:n=>`Deal extra ${n>=14?"2d8":"1d8"} radiant damage once per turn`,minLevel:8,rollable:!0,rollFormula:n=>n>=14?"2d8":"1d8"},{name:"Supreme Healing",type:"info",description:"Maximize healing dice instead of rolling",minLevel:17}]}}},barbarian:{name:"Barbarian",hitDice:"d12",spellcaster:!1,features:[{name:"Rage",type:"uses",maxUses:n=>n>=20?1/0:n>=17?6:n>=12?5:n>=6?4:n>=3?3:2,resetOn:"long",description:n=>`+${n>=16?4:n>=9?3:2} damage, resistance to physical damage`,minLevel:1},{name:"Reckless Attack",type:"info",description:"Gain advantage on melee attacks, enemies get advantage on you",minLevel:2},{name:"Danger Sense",type:"info",description:"Advantage on Dex saves against effects you can see",minLevel:2}],subclasses:{berserker:{name:"Path of the Berserker",features:[{name:"Frenzy",type:"info",description:"While raging, make melee attack as bonus action (gain 1 exhaustion after rage)",minLevel:3},{name:"Mindless Rage",type:"info",description:"Cannot be charmed or frightened while raging",minLevel:6},{name:"Intimidating Presence",type:"info",description:"Use action to frighten creature within 30 feet",minLevel:10},{name:"Retaliation",type:"info",description:"When damaged by creature within 5 feet, make melee attack as reaction",minLevel:14}]}}}};function ia(n){const c=n.toLowerCase();return ns[c]||null}function Sa(n,c,t){const v=ia(n);if(!v)return[];const u=v.features.filter(f=>!f.minLevel||f.minLevel<=c);if(t&&v.subclasses&&v.subclasses[t]){const f=v.subclasses[t].features.filter(p=>!p.minLevel||p.minLevel<=c);return[...u,...f]}return u}function _s(n){const c=ia(n);return!c||!c.subclasses?[]:Object.keys(c.subclasses).map(t=>({id:t,name:c.subclasses[t].name}))}function ys(n,c){const t=ia(n);return!t||!t.spellcaster||!t.spellSlotsByLevel?0:t.spellSlotsByLevel[c]||0}function xs(n,c,t){const v=ia(n);return!v||!v.spellcaster?0:Math.max(1,t+c)}function _l(n,c,t){const v=ia(n);return!v||!v.spellcaster?null:8+c+t}function yl(){return Object.keys(ns).map(n=>({id:n,name:ns[n].name}))}var xl=d('<div class="section-header svelte-ls99y2" role="button" tabindex="0"><h2 class="svelte-ls99y2"> </h2> <span class="collapse-btn svelte-ls99y2"> </span></div>');function ya(n,c){Gt(c,!1);let t=Ct(c,"title",8),v=Ct(c,"collapsed",8),u=Ct(c,"ariaLabel",8,""),f=Ct(c,"onToggle",8);Ot();var p=xl(),C=l(p),h=l(C,!0);s(C);var _=a(C,2),X=l(_,!0);s(_),s(p),k(()=>{lt(p,"aria-expanded",!v()),lt(p,"aria-label",u()),$(h,t()),$(X,v()?"‚ñº":"‚ñ≤")}),j("click",p,function(...P){f()?.apply(this,P)}),j("keydown",p,P=>{(P.key==="Enter"||P.key===" ")&&f()()}),o(n,p),qt()}var $l=d("<option> </option>"),wl=d("<option> </option>"),kl=d('<div class="form-group svelte-172i2fj"><label for="characterSubclass" class="svelte-172i2fj">Subclass</label> <select id="characterSubclass" class="svelte-172i2fj"><option>Select Subclass</option><!></select></div>'),Sl=d('<div class="info-grid svelte-172i2fj"><div class="form-group svelte-172i2fj"><label for="characterName" class="svelte-172i2fj">Character Name</label> <input type="text" id="characterName" placeholder="Enter name" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterClass" class="svelte-172i2fj">Class</label> <select id="characterClass" class="svelte-172i2fj"><option>Select Class</option><!></select></div> <!> <div class="form-group svelte-172i2fj"><label for="characterLevel" class="svelte-172i2fj">Level</label> <input type="number" id="characterLevel" min="1" max="20" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterRace" class="svelte-172i2fj">Race</label> <input type="text" id="characterRace" placeholder="e.g., Human" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterBackground" class="svelte-172i2fj">Background</label> <input type="text" id="characterBackground" placeholder="e.g., Soldier" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterAlignment" class="svelte-172i2fj">Alignment</label> <input type="text" id="characterAlignment" placeholder="e.g., Lawful Good" class="svelte-172i2fj"/></div></div>'),Cl=d('<section class="character-info svelte-172i2fj"><!> <!></section>');function Dl(n,c){Gt(c,!1);const t=()=>dt(ge,"$character",u),v=()=>dt(Xt,"$collapsedStates",u),[u,f]=ra(),p=S(),C=yl();function h(z){const L=z.target;ge.update(A=>(A.class=L.value,A.subclass="",A))}function _(z){const L=z.target;ge.update(A=>(A.subclass=L.value,A))}function X(z){const L=z.target;ge.update(A=>(A.level=parseInt(L.value)||1,A)),As()}et(()=>(t(),_s),()=>{r(p,t().class?_s(t().class):[])}),ca(),Ot();var P=Cl(),oe=l(P);{let z=_t(()=>(v(),i(()=>v().characterInfo?"Expand":"Collapse")));ya(oe,{title:"Character Info",get collapsed(){return v(),i(()=>v().characterInfo)},get ariaLabel(){return e(z)},onToggle:()=>Xt.update(L=>({...L,characterInfo:!L.characterInfo}))})}var ae=a(oe,2);{var W=z=>{var L=Sl(),A=l(L),O=a(l(A),2);Be(O),s(A);var Te=a(A,2),Re=a(l(Te),2),Y=l(Re);Y.value=Y.__value="";var Me=a(Y);yt(Me,1,()=>C,kt,(we,ue)=>{var ce=$l(),ke=l(ce,!0);s(ce);var Ge={};k(()=>{$(ke,(e(ue),i(()=>e(ue).name))),Ge!==(Ge=(e(ue),i(()=>e(ue).id)))&&(ce.value=(ce.__value=(e(ue),i(()=>e(ue).id)))??"")}),o(we,ce)}),s(Re);var me;ls(Re),s(Te);var be=a(Te,2);{var Fe=we=>{var ue=kl(),ce=a(l(ue),2),ke=l(ce);ke.value=ke.__value="";var Ge=a(ke);yt(Ge,1,()=>e(p),kt,(mt,ct)=>{var Je=wl(),w=l(Je,!0);s(Je);var U={};k(()=>{$(w,(e(ct),i(()=>e(ct).name))),U!==(U=(e(ct),i(()=>e(ct).id)))&&(Je.value=(Je.__value=(e(ct),i(()=>e(ct).id)))??"")}),o(mt,Je)}),s(ce);var rt;ls(ce),s(ue),k(()=>{rt!==(rt=(t(),i(()=>t().subclass)))&&(ce.value=(ce.__value=(t(),i(()=>t().subclass)))??"",Oa(ce,(t(),i(()=>t().subclass))))}),j("change",ce,_),o(we,ue)};g(be,we=>{e(p),i(()=>e(p).length>0)&&we(Fe)})}var F=a(be,2),I=a(l(F),2);Be(I),s(F);var x=a(F,2),K=a(l(x),2);Be(K),s(x);var b=a(x,2),B=a(l(b),2);Be(B),s(b);var R=a(b,2),De=a(l(R),2);Be(De),s(R),s(L),k(()=>{me!==(me=(t(),i(()=>t().class)))&&(Re.value=(Re.__value=(t(),i(()=>t().class)))??"",Oa(Re,(t(),i(()=>t().class)))),Ba(I,(t(),i(()=>t().level)))}),qe(O,()=>t().name,we=>Ft(ge,i(t).name=we,i(t))),j("change",Re,h),j("change",I,X),qe(K,()=>t().race,we=>Ft(ge,i(t).race=we,i(t))),qe(B,()=>t().background,we=>Ft(ge,i(t).background=we,i(t))),qe(De,()=>t().alignment,we=>Ft(ge,i(t).alignment=we,i(t))),o(z,L)};g(ae,z=>{v(),i(()=>!v().characterInfo)&&z(W)})}s(P),o(n,P),qt(),f()}var Ll=d('<div class="ability-card svelte-bbv1xt"><h3 class="svelte-bbv1xt"> </h3> <input type="number" class="ability-score svelte-bbv1xt" min="1" max="30"/> <div class="ability-modifier svelte-bbv1xt"> </div> <div class="roll-buttons svelte-bbv1xt"><button class="roll-btn svelte-bbv1xt">Check</button> <button class="roll-btn svelte-bbv1xt">Save</button></div> <div class="save-proficiency svelte-bbv1xt"><input type="checkbox" class="svelte-bbv1xt"/> <label class="svelte-bbv1xt">Save Prof.</label></div></div>'),jl=d('<div class="proficiency-bonus svelte-bbv1xt"><label for="profBonus">Proficiency Bonus</label> <input type="number" id="profBonus" class="prof-input svelte-bbv1xt"/></div> <div class="abilities-grid svelte-bbv1xt"></div>',1),Al=d("<section><!> <!></section>");function Bl(n,c){Gt(c,!1);const t=()=>dt(qa,"$abilityModifiers",C),v=()=>dt(ge,"$character",C),u=()=>dt(ga,"$searchFilter",C),f=()=>dt(Xt,"$collapsedStates",C),p=()=>dt(ma,"$isEditMode",C),[C,h]=ra(),_=S(),X=S(),P=_a(),oe=[{key:"strength",label:"Strength"},{key:"dexterity",label:"Dexterity"},{key:"constitution",label:"Constitution"},{key:"intelligence",label:"Intelligence"},{key:"wisdom",label:"Wisdom"},{key:"charisma",label:"Charisma"}];function ae(){As()}function W(Y){const Me=t()[Y],me=`1d20${Me>=0?"+":""}${Me}`,be=[];be.push({value:"1d20",source:"base die"}),Me!==0&&be.push({value:Me,source:Y}),P("roll",{notation:me,rollType:"check",bonusBreakdown:be})}function z(Y){const Me=t()[Y],me=v().saveProficiencies[Y]?v().proficiencyBonus:0,be=Me+me,Fe=`1d20${be>=0?"+":""}${be}`,F=[];F.push({value:"1d20",source:"base die"}),Me!==0&&F.push({value:Me,source:Y}),me!==0&&F.push({value:me,source:"proficiency"}),P("roll",{notation:Fe,rollType:"save",bonusBreakdown:F})}et(()=>u(),()=>{r(_,oe.filter(({label:Y})=>u()?Y.toLowerCase().includes(u().toLowerCase()):!0))}),et(()=>(e(_),u()),()=>{r(X,e(_).length>0||!u()||u().toLowerCase().includes("proficiency"))}),ca(),Ot();var L=Al();let A;var O=l(L);ya(O,{title:"Ability Scores",get collapsed(){return f(),i(()=>f().abilityScores)},ariaLabel:"Toggle Ability Scores Section",onToggle:()=>Xt.update(Y=>({...Y,abilityScores:!Y.abilityScores}))});var Te=a(O,2);{var Re=Y=>{var Me=jl(),me=je(Me),be=a(l(me),2);Be(be),s(me);var Fe=a(me,2);yt(Fe,5,()=>e(_),kt,(F,I)=>{let x=()=>e(I).key,K=()=>e(I).label;var b=Ll(),B=l(b),R=l(B,!0);s(B);var De=a(B,2);Be(De);var we=a(De,2),ue=l(we);s(we);var ce=a(we,2),ke=l(ce),Ge=a(ke,2);s(ce);var rt=a(ce,2),mt=l(rt);Be(mt);var ct=a(mt,2);s(rt),s(b),k(Je=>{$(R,Je),$(ue,`${t(),x(),i(()=>t()[x()]>=0?"+":"")??""}${t(),x(),i(()=>t()[x()])??""}`),mt.disabled=!p(),lt(mt,"id",`${x()}-save`),lt(ct,"for",`${x()}-save`)},[()=>(K(),i(()=>K().substring(0,3).toUpperCase()))]),qe(De,()=>v().abilities[x()],Je=>Ft(ge,i(v).abilities[x()]=Je,i(v))),j("change",De,ae),j("click",ke,()=>W(x())),j("click",Ge,()=>z(x())),wa(mt,()=>v().saveProficiencies[x()],Je=>Ft(ge,i(v).saveProficiencies[x()]=Je,i(v))),o(F,b)}),s(Fe),qe(be,()=>v().proficiencyBonus,F=>Ft(ge,i(v).proficiencyBonus=F,i(v))),o(Y,Me)};g(Te,Y=>{f(),i(()=>!f().abilityScores)&&Y(Re)})}s(L),k(()=>A=Bt(L,1,"ability-scores svelte-bbv1xt",null,A,{hidden:!e(X)})),o(n,L),qt(),h()}const Ts=[{name:"Unarmored",type:"none",baseAC:10},{name:"Padded",type:"light",baseAC:11},{name:"Leather",type:"light",baseAC:11},{name:"Studded Leather",type:"light",baseAC:12},{name:"Hide",type:"medium",baseAC:12,maxDexBonus:2},{name:"Chain Shirt",type:"medium",baseAC:13,maxDexBonus:2},{name:"Scale Mail",type:"medium",baseAC:14,maxDexBonus:2},{name:"Breastplate",type:"medium",baseAC:14,maxDexBonus:2},{name:"Half Plate",type:"medium",baseAC:15,maxDexBonus:2},{name:"Ring Mail",type:"heavy",baseAC:14,maxDexBonus:0},{name:"Chain Mail",type:"heavy",baseAC:16,maxDexBonus:0},{name:"Splint",type:"heavy",baseAC:17,maxDexBonus:0},{name:"Plate",type:"heavy",baseAC:18,maxDexBonus:0}];function Ms(n){return Ts.find(c=>c.name===n)}function Rl(n,c,t){if(!n)return 10+c+(t?2:0);const v=Ms(n);if(!v)return 10+c+(t?2:0);let u=v.baseAC;return v.maxDexBonus===void 0?u+=c:v.maxDexBonus>0&&(u+=Math.min(c,v.maxDexBonus)),t&&(u+=2),u}function Ma(n){return Math.floor((n-10)/2)}function is(n,c){if(!n.class)return null;const t=ia(n.class);if(!t||!t.spellcaster||!t.spellcastingAbility)return null;const v=Ma(c[t.spellcastingAbility]);return 8+n.proficiencyBonus+v}function Qa(n,c){if(!n.class)return 0;const t=ia(n.class);return!t||!t.spellcaster||!t.spellcastingAbility?0:Ma(c[t.spellcastingAbility])}function Tl(n,c){const t=[],v=Ma(c.dexterity),u=n.armorName?Ms(n.armorName):void 0;if(u){if(u.type==="none")t.push("Unarmored"),t.push("Base: 10"),t.push(`Dexterity: ${v>=0?"+":""}${v}`);else if(u.type==="light")t.push(`${u.name}: ${u.baseAC}`),t.push(`Dexterity: ${v>=0?"+":""}${v}`);else if(u.type==="medium"){const f=Math.min(2,v);t.push(`${u.name}: ${u.baseAC}`),t.push(`Dexterity: ${f>=0?"+":""}${f} (max +2)`)}else u.type==="heavy"&&(t.push(`${u.name}: ${u.baseAC}`),t.push("Dexterity: +0 (heavy armor)"));n.shieldEquipped&&t.push("Shield: +2")}else{t.push("Base: 10"),v!==0&&t.push(`Dexterity: ${v>=0?"+":""}${v}`);const f=10+v,p=n.armorClass-f;p!==0&&t.push(`Other: ${p>=0?"+":""}${p}`)}return n.activeStates&&n.activeStates.length>0&&n.activeStates.forEach(f=>{typeof f.acBonus=="number"&&f.acBonus!==0&&(!f.target||f.target==="self")&&t.push(`${f.name}: ${f.acBonus>=0?"+":""}${f.acBonus}`)}),t.join(`
`)}function Ml(n,c){const t=[],v=Ma(c.dexterity);t.push(`Dexterity: ${v>=0?"+":""}${v}`);const u=n.initiative-v;return u!==0&&t.push(`Other Bonuses: ${u>=0?"+":""}${u}`),t.join(`
`)}function Fl(n,c){if(!n.class)return"";const t=ia(n.class);if(!t||!t.spellcaster||!t.spellcastingAbility)return"";const v=[],u=Ma(c[t.spellcastingAbility]),f=t.spellcastingAbility.charAt(0).toUpperCase()+t.spellcastingAbility.slice(1);return v.push("Base: 8"),v.push(`Proficiency: +${n.proficiencyBonus}`),v.push(`${f}: ${u>=0?"+":""}${u}`),v.join(`
`)}function Pl(n,c,t){const v=[];let u=n;const f=c.toLowerCase().trim();if(t.activeStates){for(const p of t.activeStates)if(p.immunities&&p.immunities.length>0&&p.immunities.some(h=>h.toLowerCase().trim()===f))return v.push(`Immune to ${c} (${p.name})`),{finalDamage:0,adjustments:v}}if(t.activeStates){for(const p of t.activeStates)if(p.resistances&&p.resistances.length>0&&p.resistances.some(h=>h.toLowerCase().trim()===f)){const h=Math.floor(u/2);v.push(`Resistant to ${c} (${p.name}): ${u} ‚Üí ${h}`),u=h;break}}return v.length===0&&v.push(`No adjustments for ${c}`),{finalDamage:u,adjustments:v}}function Il(n,c){const t={...n};if(t.tempHP>0){if(c<=t.tempHP)return t.tempHP-=c,t;c-=t.tempHP,t.tempHP=0}return t.currentHP=Math.max(0,t.currentHP-c),t}var El=d('<button class="info-icon svelte-1o8ci7b" type="button">‚ÑπÔ∏è</button>'),Ul=d('<button class="info-icon svelte-1o8ci7b" type="button">‚ÑπÔ∏è</button>'),Hl=d("<div><!></div>"),Nl=d('<div class="tooltip-wrapper svelte-1o8ci7b"><!> <!></div>');function Xa(n,c){Gt(c,!1);let t=Ct(c,"tooltipContent",8),v=Ct(c,"ariaLabel",8,"Show information"),u=S(!1),f=S(),p=S(!1),C=S(null),h=S(!1),_=S(!1),X=S("");const P=Math.random().toString(36).slice(2);function oe(){window.dispatchEvent(new CustomEvent("tooltip-open",{detail:P}))}function ae(F){F.detail!==P&&(r(u,!1),r(h,!1))}function W(){r(p,window.matchMedia("(pointer: coarse)").matches||"ontouchstart"in window)}function z(){if(!e(C)||!e(f))return;const F=e(f).getBoundingClientRect(),I=e(C).getBoundingClientRect();let x=F.bottom+5,K=F.left;r(h,!1),K+I.width>window.innerWidth-8&&(K=F.right-I.width,r(h,!0),K<8&&(K=8)),K<8&&(K=8),x+I.height>window.innerHeight-8&&(x=F.top-I.height-5),r(X,`position:fixed;top:${x}px;left:${K}px;z-index:1000;`),r(_,!0)}function L(){oe(),r(u,!1),r(_,!1),requestAnimationFrame(()=>{r(u,!0),r(_,!1),setTimeout(z,0)})}function A(){r(u,!1),r(h,!1)}function O(F){F.stopPropagation(),e(u)?(r(u,!1),r(h,!1),r(_,!1)):(oe(),r(u,!1),r(_,!1),requestAnimationFrame(()=>{r(u,!0),r(_,!1),setTimeout(z,0)}))}function Te(F){e(f)&&!e(f).contains(F.target)&&(r(u,!1),r(h,!1))}$a(()=>{W(),document.addEventListener("click",Te),window.addEventListener("tooltip-open",ae)}),Es(()=>{document.removeEventListener("click",Te),window.removeEventListener("tooltip-open",ae)}),Ot();var Re=Nl(),Y=l(Re);{var Me=F=>{var I=El();k(()=>lt(I,"aria-label",v())),j("click",I,O),o(F,I)},me=F=>{var I=Ul();k(()=>lt(I,"aria-label",v())),j("mouseenter",I,L),j("mouseleave",I,A),o(F,I)};g(Y,F=>{e(p)?F(Me):F(me,!1)})}var be=a(Y,2);{var Fe=F=>{var I=Hl(),x=l(I);ul(x,c,"content",{},K=>{var b=bt(),B=je(b);dl(B,t),o(K,b)}),s(I),Ra(I,K=>r(C,K),()=>e(C)),k(()=>{Bt(I,1,`tooltip-popup ${e(h)?"right-align":""}`,"svelte-1o8ci7b"),fl(I,e(_)?e(X)+"opacity:1;pointer-events:auto;":"opacity:0;pointer-events:none;position:fixed;top:0;left:0;z-index:1000;")}),o(F,I)};g(be,F=>{e(u)&&F(Fe)})}s(Re),Ra(Re,F=>r(f,F),()=>e(f)),o(n,Re),qt()}var Ol=d("<option> </option>"),Gl=d('<div class="armor-config svelte-1r5hyyb"><h4 class="svelte-1r5hyyb">Armor Configuration</h4> <div class="armor-controls svelte-1r5hyyb"><div class="armor-field svelte-1r5hyyb"><label for="armorName" class="svelte-1r5hyyb">Armor</label> <select id="armorName" class="armor-select svelte-1r5hyyb"><option>None (Unarmored)</option><!></select></div> <div class="armor-field svelte-1r5hyyb"><label class="shield-label svelte-1r5hyyb"><input type="checkbox" class="shield-checkbox svelte-1r5hyyb"/> Shield Equipped (+2 AC)</label></div></div></div>'),ql=d('<div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="spellSaveDC" class="svelte-1r5hyyb">Spell Save DC</label> <!></div> <input type="number" id="spellSaveDC" class="stat-input svelte-1r5hyyb" readonly=""/></div>'),zl=d('<span class="hit-dice-type"> </span>'),Wl=d('<!> <div class="stats-grid svelte-1r5hyyb"><div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="armorClass" class="svelte-1r5hyyb">Armor Class</label> <!></div> <input type="text" id="armorClass" readonly=""/></div> <div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="initiative" class="svelte-1r5hyyb">Initiative</label> <!></div> <input type="text" id="initiative" class="stat-input svelte-1r5hyyb" readonly=""/></div> <div class="stat-box svelte-1r5hyyb"><label for="speed" class="svelte-1r5hyyb">Speed</label> <input type="text" id="speed" class="stat-input svelte-1r5hyyb"/></div> <!></div> <div class="hp-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Points</h3> <div><div class="hp-inputs svelte-1r5hyyb"><input type="number" class="hp-current svelte-1r5hyyb" min="0"/> <span class="hp-separator svelte-1r5hyyb">/</span> <input type="number" class="hp-max svelte-1r5hyyb" min="0"/></div> <div class="hp-controls svelte-1r5hyyb"><button class="hp-btn svelte-1r5hyyb">‚àí</button> <button class="hp-btn svelte-1r5hyyb">+</button> <button class="hp-btn svelte-1r5hyyb">‚àí5</button> <button class="hp-btn svelte-1r5hyyb">+5</button></div></div> <div class="temp-hp svelte-1r5hyyb"><label for="tempHP" class="svelte-1r5hyyb">Temp HP</label> <input type="number" id="tempHP" min="0" class="svelte-1r5hyyb"/></div></div> <div class="hit-dice-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Dice</h3> <div class="hit-dice-display svelte-1r5hyyb"><input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <span>/</span> <input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <!></div> <div class="hit-dice-controls svelte-1r5hyyb"><label for="hitDiceCount" class="svelte-1r5hyyb">Roll</label> <div class="hit-dice-count-controls svelte-1r5hyyb"><button class="hit-dice-btn svelte-1r5hyyb">‚àí</button> <input type="number" id="hitDiceCount" class="hit-dice-count-input svelte-1r5hyyb" min="1"/> <button class="hit-dice-btn svelte-1r5hyyb">+</button></div> <button class="btn btn-primary roll-hit-dice use-enabled svelte-1r5hyyb">üé≤ Roll</button></div></div>',1),Kl=d("<section><!> <!></section>");function Vl(n,c){Gt(c,!1);const t=()=>dt(ge,"$character",C),v=()=>dt(qa,"$abilityModifiers",C),u=()=>dt(ga,"$searchFilter",C),f=()=>dt(Xt,"$collapsedStates",C),p=()=>dt(ma,"$isEditMode",C),[C,h]=ra(),_=S(),X=S(),P=S(),oe=S(),ae=S(),W=S(),z=S(),L=_a();let A=S(1);function O(F){ge.update(I=>(I.currentHP=Math.max(0,Math.min(I.maxHP,I.currentHP+F)),I))}function Te(F){const I=e(A)+F,x=t().hitDice.current;r(A,Math.max(1,Math.min(x,I)))}function Re(F=1){if(t().hitDice.current<=0){alert("No hit dice remaining!");return}if(!t().class){alert("Please select a class first!");return}const I=ia(t().class);if(!I){alert("Invalid class configuration!");return}const x=Math.min(F,t().hitDice.current),K=I.hitDice,b=v().constitution,B=b*x,R=B>=0?`+${B}`:`${B}`,De=`${x}${K}${R}`,we=[];if(we.push({value:`${x}${K}`,source:"hit dice"}),b!==0)for(let ue=0;ue<x;ue++)we.push({value:b,source:"constitution"});L("rollHitDice",{notation:De,hitDie:K,count:x,bonusBreakdown:we})}et(()=>(t(),v(),ge),()=>{if(t().armorName!==void 0||t().shieldEquipped!==void 0){const F=v().dexterity,I=Rl(t().armorName,F,t().shieldEquipped||!1);t().armorClass!==I&&ge.update(x=>({...x,armorClass:I}))}}),et(()=>(v(),t(),ge),()=>{const F=v().dexterity;t().initiative!==F&&ge.update(I=>({...I,initiative:F}))}),et(()=>t(),()=>{r(_,is(t(),t().abilities))}),et(()=>t(),()=>{r(X,Tl(t(),t().abilities))}),et(()=>t(),()=>{r(P,Ml(t(),t().abilities))}),et(()=>t(),()=>{r(oe,Fl(t(),t().abilities))}),et(()=>(t(),e(A)),()=>{const F=t().hitDice.current;F>0&&e(A)>F&&r(A,F)}),et(()=>t(),()=>{r(ae,t().activeStates&&t().activeStates.length>0?t().activeStates.reduce((F,I)=>F+(I.acBonus||0),0):0)}),et(()=>t(),()=>{r(W,t().activeStates&&t().activeStates.length>0?t().activeStates.some(F=>F.name==="Aid"&&F.target==="self"):!1)}),et(()=>u(),()=>{r(z,!u()||"armor class".includes(u().toLowerCase())||"initiative".includes(u().toLowerCase())||"speed".includes(u().toLowerCase())||"hit points".includes(u().toLowerCase())||"hp".includes(u().toLowerCase())||"hit dice".includes(u().toLowerCase())||"spell save".includes(u().toLowerCase())||"combat".includes(u().toLowerCase()))}),ca(),Ot();var Y=Kl();let Me;var me=l(Y);{let F=_t(()=>(f(),i(()=>f().combatStats?"Expand":"Collapse")));ya(me,{title:"Combat Stats",get collapsed(){return f(),i(()=>f().combatStats)},get ariaLabel(){return e(F)},onToggle:()=>Xt.update(I=>({...I,combatStats:!I.combatStats}))})}var be=a(me,2);{var Fe=F=>{var I=Wl(),x=je(I);{var K=de=>{var Ee=Gl(),ye=a(l(Ee),2),Qe=l(ye),ze=a(l(Qe),2);k(()=>{t(),Ht(()=>{})});var ot=l(ze);ot.value=(ot.__value=void 0)??"";var vt=a(ot);yt(vt,1,()=>Ts,kt,(Z,Q)=>{var Ce=bt(),We=je(Ce);{var tt=Ke=>{var Ye=Ol(),pe=l(Ye);s(Ye);var V={};k(()=>{$(pe,`${e(Q),i(()=>e(Q).name)??""} (AC ${e(Q),i(()=>e(Q).baseAC)??""})`),V!==(V=(e(Q),i(()=>e(Q).name)))&&(Ye.value=(Ye.__value=(e(Q),i(()=>e(Q).name)))??"")}),o(Ke,Ye)};g(We,Ke=>{e(Q),i(()=>e(Q).name!=="Unarmored")&&Ke(tt)})}o(Z,Ce)}),s(ze),s(Qe);var fe=a(Qe,2),D=l(fe),q=l(D);Be(q),Qt(),s(D),s(fe),s(ye),s(Ee),Ta(ze,()=>t().armorName,Z=>Ft(ge,i(t).armorName=Z,i(t))),wa(q,()=>t().shieldEquipped,Z=>Ft(ge,i(t).shieldEquipped=Z,i(t))),o(de,Ee)};g(x,de=>{p()&&de(K)})}var b=a(x,2),B=l(b),R=l(B),De=a(l(R),2);Xa(De,{get tooltipContent(){return e(X)},ariaLabel:"Show AC breakdown"}),s(R);var we=a(R,2);Be(we),s(B);var ue=a(B,2),ce=l(ue),ke=a(l(ce),2);Xa(ke,{get tooltipContent(){return e(P)},ariaLabel:"Show Initiative breakdown"}),s(ce);var Ge=a(ce,2);Be(Ge),s(ue);var rt=a(ue,2),mt=a(l(rt),2);Be(mt),s(rt);var ct=a(rt,2);{var Je=de=>{var Ee=ql(),ye=l(Ee),Qe=a(l(ye),2);Xa(Qe,{get tooltipContent(){return e(oe)},ariaLabel:"Show Spell Save DC breakdown"}),s(ye);var ze=a(ye,2);Be(ze),s(Ee),k(()=>Ba(ze,e(_))),o(de,Ee)};g(ct,de=>{e(_)!==null&&de(Je)})}s(b);var w=a(b,2),U=a(l(w),2);let he;var xe=l(U),y=l(xe);Be(y);var G=a(y,4);Be(G),s(xe);var re=a(xe,2),_e=l(re),ne=a(_e,2),N=a(ne,2),H=a(N,2);s(re),s(U);var se=a(U,2),T=a(l(se),2);Be(T),s(se),s(w);var Pe=a(w,2),Ae=a(l(Pe),2),Xe=l(Ae);Be(Xe);var Se=a(Xe,4);Be(Se);var m=a(Se,2);{var ve=de=>{const Ee=_t(()=>(ee(ia),t(),i(()=>ia(t().class))));var ye=bt(),Qe=je(ye);{var ze=ot=>{const vt=_t(()=>(v(),i(()=>v().constitution)));var fe=zl(),D=l(fe);s(fe),k(()=>$(D,`(${ee(e(Ee)),i(()=>e(Ee).hitDice)??""}${(e(vt)>=0?`+${e(vt)}`:e(vt))??""})`)),o(ot,fe)};g(Qe,ot=>{e(Ee)&&ot(ze)})}o(de,ye)};g(m,de=>{t(),i(()=>t().class)&&de(ve)})}s(Ae);var ie=a(Ae,2),J=a(l(ie),2),Oe=l(J),Ie=a(Oe,2);Be(Ie);var Le=a(Ie,2);s(J);var Ue=a(J,2);s(ie),s(Pe),k(()=>{Ba(we,(e(ae),t(),i(()=>e(ae)!==0?`${t().armorClass} ‚Üí ${t().armorClass+e(ae)}`:`${t().armorClass}`))),Bt(we,1,sl(e(ae)!==0?"stat-input ac-enhanced":"stat-input"),"svelte-1r5hyyb"),Ba(Ge,(t(),i(()=>t().initiative))),he=Bt(U,1,"hp-display svelte-1r5hyyb",null,he,{"aid-active":e(W)}),lt(y,"max",(t(),i(()=>t().maxHP))),lt(Xe,"max",(t(),i(()=>t().hitDice.max))),Oe.disabled=e(A)<=1,lt(Ie,"max",(t(),i(()=>t().hitDice.current))),Le.disabled=(e(A),t(),i(()=>e(A)>=t().hitDice.current)),Ue.disabled=(t(),i(()=>t().hitDice.current<=0||!t().class))}),qe(mt,()=>t().speed,de=>Ft(ge,i(t).speed=de,i(t))),qe(y,()=>t().currentHP,de=>Ft(ge,i(t).currentHP=de,i(t))),qe(G,()=>t().maxHP,de=>Ft(ge,i(t).maxHP=de,i(t))),j("click",_e,()=>O(-1)),j("click",ne,()=>O(1)),j("click",N,()=>O(-5)),j("click",H,()=>O(5)),qe(T,()=>t().tempHP,de=>Ft(ge,i(t).tempHP=de,i(t))),qe(Xe,()=>t().hitDice.current,de=>Ft(ge,i(t).hitDice.current=de,i(t))),qe(Se,()=>t().hitDice.max,de=>Ft(ge,i(t).hitDice.max=de,i(t))),j("click",Oe,()=>Te(-1)),qe(Ie,()=>e(A),de=>r(A,de)),j("input",Ie,de=>{const Ee=de.target,ye=parseInt(Ee.value);ye>t().hitDice.current&&r(A,t().hitDice.current),ye<1&&r(A,1)}),j("click",Le,()=>Te(1)),j("click",Ue,()=>Re(e(A))),o(F,I)};g(be,F=>{f(),i(()=>!f().combatStats)&&F(Fe)})}s(Y),k(()=>Me=Bt(Y,1,"combat-stats svelte-1r5hyyb",null,Me,{hidden:!e(z)})),o(n,Y),qt(),h()}const Ea={acrobatics:"dexterity",animalHandling:"wisdom",arcana:"intelligence",athletics:"strength",deception:"charisma",history:"intelligence",insight:"wisdom",intimidation:"charisma",investigation:"intelligence",medicine:"wisdom",nature:"intelligence",perception:"wisdom",performance:"charisma",persuasion:"charisma",religion:"intelligence",sleightOfHand:"dexterity",stealth:"dexterity",survival:"wisdom"};var Jl=d('<div class="skill-row svelte-1f1pl16"><input type="checkbox" class="svelte-1f1pl16"/> <label class="svelte-1f1pl16"> <span class="ability-tag svelte-1f1pl16"> </span></label> <span class="skill-modifier svelte-1f1pl16"> </span> <button class="roll-btn svelte-1f1pl16">Roll</button></div>'),Yl=d('<div class="skills-grid svelte-1f1pl16"></div>'),Ql=d("<section><!> <!></section>");function Xl(n,c){Gt(c,!1);const t=()=>dt(ge,"$character",C),v=()=>dt(qa,"$abilityModifiers",C),u=()=>dt(ga,"$searchFilter",C),f=()=>dt(Xt,"$collapsedStates",C),p=()=>dt(ma,"$isEditMode",C),[C,h]=ra(),_=S(),X=S(),P=S(),oe=S(),ae=S(),W=S(),z=_a(),L=[{key:"acrobatics",label:"Acrobatics"},{key:"animalHandling",label:"Animal Handling"},{key:"arcana",label:"Arcana"},{key:"athletics",label:"Athletics"},{key:"deception",label:"Deception"},{key:"history",label:"History"},{key:"insight",label:"Insight"},{key:"intimidation",label:"Intimidation"},{key:"investigation",label:"Investigation"},{key:"medicine",label:"Medicine"},{key:"nature",label:"Nature"},{key:"perception",label:"Perception"},{key:"performance",label:"Performance"},{key:"persuasion",label:"Persuasion"},{key:"religion",label:"Religion"},{key:"sleightOfHand",label:"Sleight of Hand"},{key:"stealth",label:"Stealth"},{key:"survival",label:"Survival"}];function A(me){const be=Ea[me],Fe=v()[be],F=t().skillProficiencies[me]?t().proficiencyBonus:0,I=e(_)[me],x=`1d20${I>=0?"+":""}${I}`,K=[];K.push({value:"1d20",source:"base die"}),Fe!==0&&K.push({value:Fe,source:be}),F!==0&&K.push({value:F,source:"proficiency"}),z("roll",{notation:x,rollType:"check",bonusBreakdown:K})}et(()=>{},()=>{r(_,{})}),et(()=>t(),()=>{r(X,t().skillProficiencies)}),et(()=>t(),()=>{r(P,t().proficiencyBonus)}),et(()=>v(),()=>{r(oe,v())}),et(()=>(e(oe),e(X),e(P)),()=>{for(const{key:me}of L){const be=Ea[me],Fe=e(oe)[be],F=e(X)[me]?e(P):0;pa(_,e(_)[me]=Fe+F)}}),et(()=>u(),()=>{r(ae,L.filter(({label:me})=>u()?me.toLowerCase().includes(u().toLowerCase()):!0))}),et(()=>e(ae),()=>{r(W,e(ae).length>0)}),ca(),Ot();var O=Ql();let Te;var Re=l(O);{let me=_t(()=>(f(),i(()=>f().skills?"Expand":"Collapse")));ya(Re,{title:"Skills",get collapsed(){return f(),i(()=>f().skills)},get ariaLabel(){return e(me)},onToggle:()=>Xt.update(be=>({...be,skills:!be.skills}))})}var Y=a(Re,2);{var Me=me=>{var be=Yl();yt(be,5,()=>e(ae),kt,(Fe,F)=>{let I=()=>e(F).key,x=()=>e(F).label;var K=Jl(),b=l(K);Be(b);var B=a(b,2),R=l(B),De=a(R),we=l(De);s(De),s(B);var ue=a(B,2),ce=l(ue);s(ue);var ke=a(ue,2);s(K),k(Ge=>{Bs(b,(e(X),I(),i(()=>e(X)[I()]))),b.disabled=!p(),lt(b,"id",I()),lt(B,"for",I()),$(R,`${x()??""} `),$(we,`(${Ge??""})`),$(ce,`${e(_),I(),i(()=>e(_)[I()]>=0?"+":"")??""}${e(_),I(),i(()=>e(_)[I()])??""}`)},[()=>(ee(Ea),I(),i(()=>Ea[I()].substring(0,3).toUpperCase()))]),j("change",b,Ge=>{console.log("Skill proficiency changed:",I(),Ge.target.checked),ge.update(rt=>({...rt,skillProficiencies:{...rt.skillProficiencies,[I()]:Ge.target.checked}}))}),j("click",ke,()=>A(I())),o(Fe,K)}),s(be),o(me,be)};g(Y,me=>{f(),i(()=>!f().skills)&&me(Me)})}s(O),k(()=>Te=Bt(O,1,"skills svelte-1f1pl16",null,Te,{hidden:!e(W)})),o(n,O),qt(),h()}var Zl=d('<p class="empty-message svelte-1123ljy">No attacks or spells to reorder.</p>'),en=d('<li class="reorder-item svelte-1123ljy"><span class="attack-name svelte-1123ljy"> </span> <div class="reorder-buttons svelte-1123ljy"><button class="btn-move svelte-1123ljy" aria-label="Move up">‚ñ≤</button> <button class="btn-move svelte-1123ljy" aria-label="Move down">‚ñº</button></div></li>'),tn=d('<ul class="reorder-list svelte-1123ljy"></ul>'),an=d('<div class="modal-backdrop svelte-1123ljy" role="presentation"><div class="modal-content svelte-1123ljy" role="dialog" aria-modal="true" aria-labelledby="modal-title"><div class="modal-header svelte-1123ljy"><h3 id="modal-title" class="svelte-1123ljy">Reorder Attacks & Spells</h3> <button class="btn-close svelte-1123ljy" aria-label="Close">√ó</button></div> <div class="modal-body svelte-1123ljy"><!></div> <div class="modal-footer svelte-1123ljy"><button class="btn btn-secondary svelte-1123ljy">Cancel</button> <button class="btn btn-primary svelte-1123ljy">Save Order</button></div></div></div>');function sn(n,c){Gt(c,!1);let t=Ct(c,"show",8,!1),v=Ct(c,"attacks",24,()=>[]),u=Ct(c,"onSave",8),f=Ct(c,"onCancel",8),p=S([]);function C(L,A){const O=e(p)[L];pa(p,e(p)[L]=e(p)[A]),pa(p,e(p)[A]=O),r(p,[...e(p)])}function h(L){L>0&&C(L,L-1)}function _(L){L<e(p).length-1&&C(L,L+1)}function X(){u()(e(p))}function P(){f()()}function oe(L){L.target===L.currentTarget&&P()}et(()=>(ee(t()),ee(v())),()=>{t()&&r(p,[...v()])}),ca(),Ot();var ae=bt(),W=je(ae);{var z=L=>{var A=an(),O=l(A),Te=l(O),Re=a(l(Te),2);s(Te);var Y=a(Te,2),Me=l(Y);{var me=x=>{var K=Zl();o(x,K)},be=x=>{var K=tn();yt(K,7,()=>e(p),b=>b.id,(b,B,R)=>{var De=en(),we=l(De),ue=l(we,!0);s(we);var ce=a(we,2),ke=l(ce),Ge=a(ke,2);s(ce),s(De),k(()=>{$(ue,(e(B),i(()=>e(B).name||"(Unnamed attack or spell)"))),ke.disabled=e(R)===0,Ge.disabled=(ee(e(R)),e(p),i(()=>e(R)===e(p).length-1))}),j("click",ke,()=>h(e(R))),j("click",Ge,()=>_(e(R))),o(b,De)}),s(K),o(x,K)};g(Me,x=>{e(p),i(()=>e(p).length===0)?x(me):x(be,!1)})}s(Y);var Fe=a(Y,2),F=l(Fe),I=a(F,2);s(Fe),s(O),s(A),j("click",Re,P),j("click",F,P),j("click",I,X),j("click",A,oe),o(L,A)};g(W,L=>{t()&&L(z)})}o(n,ae),qt()}let Ua=null,Ha=null;async function Fs(){if(Ua)return Ua;try{return Ua=await(await fetch(Rs("/data/spells.json"))).json(),Ua||[]}catch(n){return console.error("Failed to load spells:",n),[]}}async function ln(){if(Ha)return Ha;try{return Ha=await(await fetch(Rs("/data/feats.json"))).json(),Ha||[]}catch(n){return console.error("Failed to load feats:",n),[]}}function $s(n,c){if(!c.trim())return n;const t=c.toLowerCase();return n.filter(v=>v.name.toLowerCase().includes(t)||v.school.toLowerCase().includes(t)||v.classes.some(u=>u.toLowerCase().includes(t))||v.description.toLowerCase().includes(t))}function nn(n,c){return c===null?n:n.filter(t=>t.level===c)}function rn(n,c){if(!c.trim())return n;const t=c.toLowerCase();return n.filter(v=>v.name.toLowerCase().includes(t)||v.description.toLowerCase().includes(t))}function Na(n){const c=n.description,t=/\b(Strength|Dexterity|Constitution|Intelligence|Wisdom|Charisma)\s+saving\s+throw/i,v=c.match(t);if(!v)return null;const u=v[1].toLowerCase(),p=/half\s+(?:as\s+much\s+)?damage\s+on\s+a\s+successful(?:\s+save)?/i.test(c),h=/saving\s+throw\s+or\s+take.*?damage/i.test(c)&&!p;return{ability:u,halfDamageOnSave:p,noDamageOnSave:h}}function on(n){const c=n.description;return/(plus|add)\s+your\s+spellcasting\s+(ability\s+)?modifier/i.test(c)}function Za(n){const c=n.description.toLowerCase();return c.includes("ranged spell attack")||c.includes("melee spell attack")}function ws(n){const c=n.description.toLowerCase();if(["Divine Favor","Bless","Aid","Command"].includes(n.name))return!0;const u=["takes","take","deals","deal","damage equal to","force damage","fire damage","cold damage","lightning damage","thunder damage","acid damage","poison damage","necrotic damage","radiant damage","psychic damage","regain","regains","hit point"].some(C=>c.includes(C));return["bonus to attack","bonus to damage","bonus to ac","gains a +","gain a +","+1 bonus","+2 bonus","+3 bonus","advantage on","becomes a magic weapon"].some(C=>c.includes(C))&&!u}function cn(n){const c=n.description;let t=0,v=0,u=0,f="";const p=c.match(/\+(\d+)\s+bonus\s+to\s+attack\s+rolls\s+and\s+damage\s+rolls/i);if(p){const h=parseInt(p[1]);t=h,v=h,f=`+${h} to attack and damage rolls`}if(n.name==="Bless"&&(f="Add 1d4 to attack rolls and saves",t="1d4"),n.name==="Aid")return f="+5 HP (max and current) for 8 hours",{attackBonus:0,damageBonus:0,acBonus:0,hpBonus:5,description:f,name:n.name};n.name==="Divine Favor"&&(f="Your weapon attacks deal an extra 1d4 radiant damage on a hit.",v="1d4");const C=c.match(/\+(\d+)\s+bonus\s+to\s+AC/i);return C&&(u=parseInt(C[1]),f=`+${u} to AC`),n.name==="Haste"&&(f="+2 AC, doubled speed, extra action",u=2),f||t!==0||v!==0||u!==0?{attackBonus:t,damageBonus:v,acBonus:u,description:f||n.description.substring(0,100),name:n.name}:null}function es(n){const c=n.description,t=/takes?\s+(\d+d\d+)\s+\w+\s+damage[^.]*\.\s*If\s+the\s+target\s+is\s+missing.*?instead\s+takes?\s+(\d+d\d+)/is,v=c.match(t);return v?{baseDamage:v[1],alternateDamage:v[2]}:null}var vn=d('<button class="btn btn-secondary">Reorder</button>'),dn=d('<div class="edit-buttons svelte-14o91c5"><button class="btn btn-secondary">Add Attack</button> <!></div>'),un=d('<input type="text" placeholder="Attack name" class="attack-name svelte-14o91c5"/>'),fn=d('<h4 class="attack-name-display svelte-14o91c5"> </h4>'),pn=d('<button class="btn-remove svelte-14o91c5">√ó</button>'),mn=d('<div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Bonus</label> <input type="number" class="attack-bonus svelte-14o91c5"/></div>'),gn=d('<div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Damage</label> <input type="text" placeholder="e.g., 2d6+3" class="attack-damage svelte-14o91c5"/></div>'),bn=d('<div class="spell-info-loading svelte-14o91c5">Loading spell info...</div>'),hn=d('<li class="svelte-14o91c5"><strong>At Higher Levels:</strong> </li>'),_n=d('<ul class="svelte-14o91c5"><li class="svelte-14o91c5"><strong>Level:</strong> </li> <li class="svelte-14o91c5"><strong>Casting Time:</strong> </li> <li class="svelte-14o91c5"><strong>Range:</strong> </li> <li class="svelte-14o91c5"><strong>Components:</strong> <!></li> <li class="svelte-14o91c5"><strong>Duration:</strong> <!> </li> <li class="svelte-14o91c5"><strong>Description:</strong> </li> <!></ul>'),yn=d('<span class="scaled-damage svelte-14o91c5" style="margin-left: 8px;"> </span>'),xn=d('<span class="scaled-damage svelte-14o91c5">(Half damage)</span>'),$n=d('<span class="scaled-damage svelte-14o91c5">(No damage)</span>'),wn=d('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> <!> <!></label></div>'),kn=d('<span class="scaled-damage svelte-14o91c5"> </span>'),Sn=d('<span class="scaled-damage svelte-14o91c5"> </span>'),Cn=d('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> Target is missing HP <!></label></div>'),Dn=d("<option> </option>"),Ln=d('<span class="scaled-damage svelte-14o91c5"><!> </span>'),jn=d('<span class="scaled-damage svelte-14o91c5"> </span>'),An=d('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> Target is Fiend or Undead <!></label></div>'),Bn=d('<div class="spell-level-selector svelte-14o91c5"><label class="svelte-14o91c5">Cast at Level:</label> <select class="spell-level-select use-enabled svelte-14o91c5"></select> <!></div> <!>',1),Rn=d('<div class="spell-level-selector svelte-14o91c5"><span style="color: #dc3545; font-weight: bold;">No spell slots available!</span></div>'),Tn=d('<div class="spell-info svelte-14o91c5"><div class="spell-info-header svelte-14o91c5" role="button" tabindex="0"><h4 class="svelte-14o91c5">Spell Info</h4> <button class="collapse-btn-small svelte-14o91c5"> </button></div> <!></div> <!> <!> <!>',1),Mn=d('<div class="spell-info-missing svelte-14o91c5">Spell info not found.</div>'),Fn=d('<div class="attack-notes svelte-14o91c5"><label class="svelte-14o91c5">Notes</label> <textarea placeholder="e.g., DC 15 Dex save, Range 120 ft, Concentration" class="notes-input svelte-14o91c5" rows="2"></textarea></div>'),Pn=d('<button class="btn btn-primary">Roll Attack</button>'),In=d('<div class="buff-target-selection svelte-14o91c5"><div class="target-options svelte-14o91c5"><label class="target-option svelte-14o91c5"><input type="radio" class="svelte-14o91c5"/> Self</label> <label class="target-option svelte-14o91c5"><input type="radio" class="svelte-14o91c5"/> Other</label></div> <button class="btn btn-info"> </button></div>'),En=d('<button class="btn btn-info">Cast Spell</button>'),Un=d("<button><!></button>"),Hn=d('<button class="btn btn-info">Cast Spell</button>'),Nn=d('<button class="btn btn-secondary">Roll Damage</button>'),On=d('<button class="btn btn-primary">Roll Attack</button> <!>',1),Gn=d('<div class="attack-card svelte-14o91c5"><div class="attack-header svelte-14o91c5"><!> <!></div> <div class="attack-details svelte-14o91c5"><!> <!> <div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Type</label> <input type="text" placeholder="e.g., slashing" class="attack-type svelte-14o91c5"/></div></div> <!> <!> <div class="attack-actions svelte-14o91c5"><!></div></div>'),qn=d('<p class="no-attacks svelte-14o91c5">No attacks added yet. Click "Add Attack" to create one.</p>'),zn=d('<p class="no-attacks svelte-14o91c5">No attacks match your search.</p>'),Wn=d('<span class="ability-uses svelte-14o91c5"> <!></span>'),Kn=d('<span class="ability-reaction svelte-14o91c5">‚ö° Reaction</span>'),Vn=d('<button class="btn btn-ability svelte-14o91c5">Use Ability</button>'),Jn=d('<div class="ability-card svelte-14o91c5"><div class="ability-header svelte-14o91c5"><h4 class="ability-name svelte-14o91c5"> </h4> <span class="ability-source svelte-14o91c5"> </span></div> <p class="ability-description svelte-14o91c5"> </p> <div class="ability-footer svelte-14o91c5"><!> <!> <!></div></div>'),Yn=d('<div class="condition-abilities-section svelte-14o91c5"><h3 class="abilities-header svelte-14o91c5">Condition Abilities</h3> <p class="section-description svelte-14o91c5">Special actions granted by active conditions (e.g., Flicker of Deceit)</p> <div class="abilities-list svelte-14o91c5"></div></div>'),Qn=d('<button class="btn-remove svelte-14o91c5">√ó</button>'),Xn=d('<div class="state-card svelte-14o91c5"><div class="state-header svelte-14o91c5"><input type="text" placeholder="Effect name (e.g., Magic Weapon)" class="state-name svelte-14o91c5"/> <!></div> <div class="state-details svelte-14o91c5"><div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Attack Bonus</label> <input type="number" class="state-bonus svelte-14o91c5"/></div> <div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Damage Bonus</label> <input type="text" class="state-bonus svelte-14o91c5"/></div> <div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Target</label> <select class="state-bonus svelte-14o91c5"><option>Self</option><option>Other</option></select></div></div> <div class="state-description svelte-14o91c5"><label class="svelte-14o91c5">Description</label> <input type="text" placeholder="e.g., +1 to attack and damage rolls (Magic Weapon)" class="state-desc-input svelte-14o91c5"/></div></div>'),Zn=d('<div class="states-list svelte-14o91c5"></div>'),ei=d('<p class="no-states svelte-14o91c5">No active effects. Add spell effects that modify your attacks.</p>'),ti=d('<!> <div class="attacks-list svelte-14o91c5"><!> <!></div> <!> <div class="active-states-section svelte-14o91c5"><h3 class="svelte-14o91c5">Active Spell Effects</h3> <p class="section-description svelte-14o91c5">Effects that modify attack and damage rolls (e.g., Magic Weapon, Bless)</p> <button class="btn btn-secondary">Add Effect</button> <!></div>',1),ai=d("<section><!> <!></section> <!>",1);function si(n,c){Gt(c,!1);const t=()=>dt(ge,"$character",p),v=()=>dt(ga,"$searchFilter",p),u=()=>dt(Xt,"$collapsedStates",p),f=()=>dt(ma,"$isEditMode",p),[p,C]=ra(),h=S(),_=S(),X=S(),P=[];function oe(w,U){ge.update(he=>{if(!he.activeStates)return he;const xe=he.activeStates.findIndex(_e=>_e.name===w);if(xe===-1)return he;const y=he.activeStates[xe];if(!y.abilities)return he;const G=y.abilities.findIndex(_e=>_e.name===U);if(G===-1)return he;const re=y.abilities[G];return re.currentUses!==void 0&&re.currentUses>0&&(re.currentUses-=1,re.usesPerRest!==void 0?Nt.add(`Used ${U} (${re.currentUses}/${re.usesPerRest} remaining)`,"info"):Nt.add(`Used ${U}`,"info")),he})}const ae=_a();let W=S({}),z=S({}),L=S(!1);function A(w){pa(W,e(W)[w]=!e(W)[w]),r(W,{...e(W)})}function O(w){return w.description.toLowerCase().includes("regain")&&(w.description.toLowerCase().includes("hit point")||w.description.toLowerCase().includes("hp"))}function Te(w){return["Shield of Faith","Bless","Aid","Magic Weapon"].includes(w)}function Re(){ge.update(w=>(w.attacks=[...w.attacks,{id:crypto.randomUUID(),name:"",bonus:0,damage:"",damageType:"",notes:""}],w))}function Y(w){ge.update(U=>(U.attacks=U.attacks.filter(he=>he.id!==w),U))}function Me(){r(L,!0)}function me(){r(L,!1)}function be(w){ge.update(U=>(U.attacks=w,U)),r(L,!1),Nt.add("Attack order updated successfully!","success")}function Fe(w){let U=w.damage,he=!1,xe=!1;if(w.spellRef){const ne=K(w.spellRef);if(ne&&(xe=Za(ne),ne.level>0)){const N=w.castAtLevel||ne.level;if(!b(N)){Nt.add(`No level ${N} spell slots available!`,"error");return}const se=Na(ne);se&&w.targetSucceededSave&&se.noDamageOnSave?U="0":(he=se?.halfDamageOnSave&&w.targetSucceededSave||!1,U=B(w,ne))}}else if(t().activeStates&&t().activeStates.length>0){let ne=0,N=[];for(const H of t().activeStates)H.target!=="other"&&(typeof H.damageBonus=="string"?N.push(H.damageBonus):typeof H.damageBonus=="number"&&(ne+=H.damageBonus));if((ne!==0||N.length>0)&&U){const H=U.match(/(\d+d\d+)([+-]\d+)?/);if(H){const[,se,T]=H,Ae=(T?parseInt(T):0)+ne;let Xe=`${se}`;Ae!==0&&(Xe+=`${Ae>=0?"+":""}${Ae}`),N.length>0&&(Xe+=" + "+N.join(" + ")),U=Xe}}}const y=[];let G=0;if(xe){const ne=Qa(t(),t().abilities),N=t().proficiencyBonus||0;y.push({value:N,source:"proficiency"}),y.push({value:ne,source:"spellcasting"}),G=N+ne}else w.bonus!==0&&y.push({value:w.bonus,source:"base"}),G=w.bonus;let re=[];if(t().activeStates)for(const ne of t().activeStates)ne.target!=="other"&&(typeof ne.attackBonus=="number"&&ne.attackBonus!==0?(y.push({value:ne.attackBonus,source:ne.name.toLowerCase()}),G+=ne.attackBonus):typeof ne.attackBonus=="string"&&ne.attackBonus&&(re.push(ne.attackBonus),y.push({value:ne.attackBonus,source:ne.name.toLowerCase()})));let _e=`1d20${G>=0?"+":""}${G}`;re.length>0&&(_e+="+"+re.join("+")),ae("roll",{notation:_e,damageNotation:U,attackName:w.name,applyHalfDamage:he,bonusBreakdown:y,rollType:"attack"})}function F(w){if(!w.damage){Nt.add(`${w.name}: No damage specified`,"error");return}let U=w.damage,he=!1;const xe=[];let y=w.damageType||"";if(w.spellRef){const G=K(w.spellRef);if(G){const re=O(G);if(re){const _e=Qa(t(),t().abilities),ne=U.match(/^(\d+d\d+)/);ne&&(U=ne[1],_e>0&&(U+=`+${_e}`,xe.push({value:_e,source:"spellcasting"}))),y="Healing"}if(G.level>0){const _e=w.castAtLevel||G.level;if(!b(_e)){Nt.add(`No level ${_e} spell slots available!`,"error");return}const N=Na(G);N&&w.targetSucceededSave&&N.noDamageOnSave?U="0":(he=N?.halfDamageOnSave&&w.targetSucceededSave||!1,re||(U=B(w,G))),G.damageType&&!re&&(y=G.damageType)}}}else{const G=U.match(/(\d+d\d+)([+-]\d+)?/);if(G){const[,re,_e]=G,ne=_e?parseInt(_e):0;if(ne!==0&&xe.push({value:ne,source:"base"}),t().activeStates&&t().activeStates.length>0){let N=0,H=[];for(const se of t().activeStates)se.target!=="other"&&(typeof se.damageBonus=="string"?H.push(se.damageBonus):typeof se.damageBonus=="number"&&se.damageBonus!==0&&(xe.push({value:se.damageBonus,source:se.name.toLowerCase()}),N+=se.damageBonus));if(N!==0||H.length>0){const se=ne+N;let T=`${re}`;se!==0&&(T+=`${se>=0?"+":""}${se}`),H.length>0&&(T+=" + "+H.join(" + ")),U=T}}}}ae("roll",{notation:U,attackName:w.name,applyHalfDamage:he,bonusBreakdown:xe,damageType:y})}let I=S([]),x=S(!1);$a(async()=>{r(I,await Fs()),r(x,!0)});function K(w){return e(I).find(U=>U.name===w)}function b(w){t().classFeatures.spellSlotsByLevel||Ft(ge,i(t).classFeatures.spellSlotsByLevel={},i(t)),t().classFeatures.spellSlotsByLevel[w]||Ft(ge,i(t).classFeatures.spellSlotsByLevel[w]=Array(2).fill(!1),i(t));const he=t().classFeatures.spellSlotsByLevel[w].findIndex(xe=>!xe);return he===-1?!1:(ge.update(xe=>(xe.classFeatures.spellSlotsByLevel||(xe.classFeatures.spellSlotsByLevel={}),xe.classFeatures.spellSlotsByLevel[w]||(xe.classFeatures.spellSlotsByLevel[w]=Array(2).fill(!1)),xe.classFeatures.spellSlotsByLevel[w][he]=!0,xe)),!0)}function B(w,U){let he=w.damage,xe=0,y=0;const G=es(U);if(G&&w.targetIsDamaged&&(he=G.alternateDamage),on(U)&&(y+=Qa(t(),t().abilities)),t().activeStates)for(const Ae of t().activeStates)Ae.target!=="other"&&typeof Ae.damageBonus=="number"&&(y+=Ae.damageBonus);if(U.higherLevelSlot&&w.castAtLevel){const Ae=U.level,Se=(w.castAtLevel||Ae)-Ae;if(Se>0){const m=U.higherLevelSlot.match(/(\d+)d(\d+)\s+for\s+each.*?level\s+above/i);if(m){const[,ve]=m;xe+=Se*parseInt(ve)}}}if(w.targetIsFiendOrUndead&&U.description.includes("Fiend or an Undead")){const Ae=U.description.match(/increases by (\d+)d(\d+) if.*?Fiend or.*?Undead/i);if(Ae){const[,Xe]=Ae;xe+=parseInt(Xe)}}const re=he.match(/(\d+)d(\d+)([+-]\d+)?/);if(!re)return y!==0?y>=0?`${y}`:`${y}`:he||"0";const[,_e,ne,N]=re,H=parseInt(_e)+xe,T=(N?parseInt(N):0)+y;let Pe=`${H}d${ne}`;return T!==0&&(Pe+=T>=0?`+${T}`:`${T}`),Pe}function R(w){const U=[];for(let xe=w.level;xe<=9;xe++){const y=t().classFeatures.spellSlotsByLevel?.[xe];y&&y.length>0&&U.push(xe)}return U}function De(){ge.update(w=>(w.activeStates||(w.activeStates=[]),w.activeStates=[...w.activeStates,{name:"",attackBonus:0,damageBonus:0,description:"",target:"self"}],w))}function we(w){ge.update(U=>{if(U.activeStates){const he=U.activeStates[w];he?.hpBonus&&he.target!=="other"&&(U.maxHP-=he.hpBonus,U.currentHP=Math.max(1,Math.min(U.currentHP-he.hpBonus,U.maxHP))),U.activeStates=U.activeStates.filter((xe,y)=>y!==w)}return U})}function ue(w,U="self"){const he=K(w.spellRef);if(!he){Nt.add("Spell not found","error");return}const xe=w.castAtLevel||he.level;if(xe>0&&!b(xe)){Nt.add(`No level ${xe} spell slots available!`,"error");return}const y=cn(he);if(!y){Nt.add(`${he.name} cast! Check spell description for effects.`,"info");return}let G=y.hpBonus||0,re=y.description;he.name==="Aid"&&xe>he.level&&(G=5+(xe-he.level)*5,re=`+${G} HP (max and current) for 8 hours`);const ne=["Shield of Faith","Bless","Aid","Magic Weapon"].includes(he.name);ge.update(H=>{H.activeStates||(H.activeStates=[]);const se=H.activeStates.find(T=>T.name===he.name);return se&&se.hpBonus&&se.target!=="other"&&(H.maxHP-=se.hpBonus,H.currentHP=Math.max(1,Math.min(H.currentHP-se.hpBonus,H.maxHP))),H.activeStates=H.activeStates.filter(T=>T.name!==he.name),G>0&&U==="self"&&(H.maxHP+=G,H.currentHP+=G),H.activeStates=[...H.activeStates,{name:he.name,attackBonus:y.attackBonus,damageBonus:y.damageBonus,acBonus:y.acBonus,description:re,target:U,hpBonus:G}],H});const N=U==="self"?" on self":" on other";Nt.add(`${he.name} cast${ne?N:""}! Effect added to Active Spell Effects.`,"success")}et(()=>t(),()=>{r(h,t().activeStates?t().activeStates.filter(w=>w.abilities&&w.abilities.length>0).flatMap(w=>w.abilities.map(U=>({...U,conditionName:w.name}))):[])}),et(()=>(t(),e(W),e(z)),()=>{if(t()&&t().attacks)for(const w of t().attacks)w.spellRef&&e(W)[w.id]===void 0&&pa(W,e(W)[w.id]=!0),w.spellRef&&e(z)[w.id]===void 0&&pa(z,e(z)[w.id]="self")}),et(()=>(t(),v()),()=>{r(_,t().attacks.filter(w=>{if(!v())return!0;const U=v().toLowerCase();return w.name.toLowerCase().includes(U)||w.damageType.toLowerCase().includes(U)}).sort((w,U)=>!w.spellRef&&U.spellRef?-1:w.spellRef&&!U.spellRef?1:0))}),et(()=>(v(),e(_)),()=>{r(X,!v()||e(_).length>0||"attack".includes(v().toLowerCase())||"spell".includes(v().toLowerCase()))}),ca(),Ot();var ce=ai(),ke=je(ce);let Ge;var rt=l(ke);{let w=_t(()=>(u(),i(()=>u().attacks?"Expand":"Collapse")));ya(rt,{title:"Attacks & Spells",get collapsed(){return u(),i(()=>u().attacks)},get ariaLabel(){return e(w)},onToggle:()=>Xt.update(U=>({...U,attacks:!U.attacks}))})}var mt=a(rt,2);{var ct=w=>{var U=ti(),he=je(U);{var xe=Se=>{var m=dn(),ve=l(m),ie=a(ve,2);{var J=Oe=>{var Ie=vn();j("click",Ie,Me),o(Oe,Ie)};g(ie,Oe=>{t(),i(()=>t().attacks.length>0)&&Oe(J)})}s(m),j("click",ve,Re),o(Se,m)};g(he,Se=>{f()&&Se(xe)})}var y=a(he,2),G=l(y);yt(G,1,()=>e(_),Se=>Se.id,(Se,m,ve)=>{var ie=Gn(),J=l(ie),Oe=l(J);{var Ie=pe=>{var V=un();Be(V),qe(V,()=>e(m).name,Ne=>(e(m).name=Ne,Ht(()=>(e(_),t(),v())))),o(pe,V)},Le=pe=>{var V=fn(),Ne=l(V,!0);s(V),k(()=>$(Ne,(e(m),i(()=>e(m).name||"(Unnamed Attack)")))),o(pe,V)};g(Oe,pe=>{f()?pe(Ie):pe(Le,!1)})}var Ue=a(Oe,2);{var de=pe=>{var V=pn();j("click",V,()=>Y(e(m).id)),o(pe,V)};g(Ue,pe=>{f()&&pe(de)})}s(J);var Ee=a(J,2),ye=l(Ee);{var Qe=pe=>{var V=mn(),Ne=l(V),ut=a(Ne,2);Be(ut),s(V),k(()=>{lt(Ne,"for",`attack-bonus-${e(m),i(()=>e(m).id)??""}`),lt(ut,"id",`attack-bonus-${e(m),i(()=>e(m).id)??""}`)}),qe(ut,()=>e(m).bonus,Ze=>(e(m).bonus=Ze,Ht(()=>(e(_),t(),v())))),o(pe,V)};g(ye,pe=>{e(m),i(()=>e(m).bonus!==0&&e(m).bonus!==void 0)&&pe(Qe)})}var ze=a(ye,2);{var ot=pe=>{var V=gn(),Ne=l(V),ut=a(Ne,2);Be(ut),s(V),k(()=>{lt(Ne,"for",`attack-damage-${e(m),i(()=>e(m).id)??""}`),lt(ut,"id",`attack-damage-${e(m),i(()=>e(m).id)??""}`)}),qe(ut,()=>e(m).damage,Ze=>(e(m).damage=Ze,Ht(()=>(e(_),t(),v())))),o(pe,V)};g(ze,pe=>{e(m),i(()=>e(m).damage&&e(m).damage.trim()!=="")&&pe(ot)})}var vt=a(ze,2),fe=l(vt),D=a(fe,2);Be(D),s(vt),s(Ee);var q=a(Ee,2);{var Z=pe=>{var V=bt(),Ne=je(V);{var ut=at=>{var le=bn();o(at,le)},Ze=at=>{const le=_t(()=>(e(m),i(()=>K(e(m).spellRef))));var Dt=bt(),E=je(Dt);{var Ve=He=>{const M=_t(()=>(ee(Na),ee(e(le)),i(()=>Na(e(le))))),xt=_t(()=>(ee(es),ee(e(le)),i(()=>es(e(le)))));var ht=Tn(),st=je(ht),$e=l(st),ft=a(l($e),2),nt=l(ft,!0);s(ft),s($e);var Rt=a($e,2);{var it=Tt=>{var Pt=_n(),Et=l(Pt),la=a(l(Et));s(Et);var na=a(Et,2),va=a(l(na));s(na);var Yt=a(na,2),Ut=a(l(Yt));s(Yt);var Wt=a(Yt,2),Zt=a(l(Wt)),jt=a(Zt);{var ea=It=>{var Vt=Mt();k(()=>$(Vt,`(${ee(e(le)),i(()=>e(le).material)??""})`)),o(It,Vt)};g(jt,It=>{ee(e(le)),i(()=>e(le).material)&&It(ea)})}s(Wt);var gt=a(Wt,2),$t=a(l(gt),2);{var Lt=It=>{var Vt=Mt("Concentration,");o(It,Vt)};g($t,It=>{ee(e(le)),i(()=>e(le).concentration)&&It(Lt)})}var wt=a($t,1,!0);s(gt);var At=a(gt,2),Kt=a(l(At));s(At);var ta=a(At,2);{var da=It=>{var Vt=hn(),oa=a(l(Vt));s(Vt),k(()=>$(oa,` ${ee(e(le)),i(()=>e(le).higherLevelSlot)??""}`)),o(It,Vt)};g(ta,It=>{ee(e(le)),i(()=>e(le).higherLevelSlot)&&It(da)})}s(Pt),k(It=>{$(la,` ${ee(e(le)),i(()=>e(le).level)??""}`),$(va,` ${ee(e(le)),i(()=>e(le).castingTime||e(le).actionType)??""}`),$(Ut,` ${ee(e(le)),i(()=>e(le).range)??""}`),$(Zt,` ${It??""}`),$(wt,(ee(e(le)),i(()=>e(le).duration))),$(Kt,` ${ee(e(le)),i(()=>e(le).description)??""}`)},[()=>(ee(e(le)),i(()=>e(le).components.join(", ")))]),o(Tt,Pt)};g(Rt,Tt=>{e(W),e(m),i(()=>!e(W)[e(m).id])&&Tt(it)})}s(st);var pt=a(st,2);{var St=Tt=>{var Pt=wn(),Et=l(Pt),la=l(Et);Be(la);var na=a(la),va=a(na);{var Yt=jt=>{var ea=yn(),gt=l(ea);s(ea),k($t=>$(gt,`(Spell Save DC: ${$t??""})`),[()=>(ee(is),t(),i(()=>is(t(),t().abilities)))]),o(jt,ea)};g(va,jt=>{t(),i(()=>t().class)&&jt(Yt)})}var Ut=a(va,2);{var Wt=jt=>{var ea=xn();o(jt,ea)},Zt=jt=>{var ea=bt(),gt=je(ea);{var $t=Lt=>{var wt=$n();o(Lt,wt)};g(gt,Lt=>{e(m),ee(e(M)),i(()=>e(m).targetSucceededSave&&e(M).noDamageOnSave)&&Lt($t)},!0)}o(jt,ea)};g(Ut,jt=>{e(m),ee(e(M)),i(()=>e(m).targetSucceededSave&&e(M).halfDamageOnSave)?jt(Wt):jt(Zt,!1)})}s(Et),s(Pt),k(jt=>$(na,` Target succeeded on ${jt??""} save `),[()=>(ee(e(M)),i(()=>e(M).ability.charAt(0).toUpperCase()+e(M).ability.slice(1)))]),wa(la,()=>e(m).targetSucceededSave,jt=>(e(m).targetSucceededSave=jt,Ht(()=>(e(_),t(),v())))),o(Tt,Pt)};g(pt,Tt=>{e(M)&&Tt(St)})}var Jt=a(pt,2);{var aa=Tt=>{var Pt=Cn(),Et=l(Pt),la=l(Et);Be(la);var na=a(la,2);{var va=Ut=>{const Wt=_t(()=>(e(m),ee(e(le)),i(()=>B(e(m),e(le)))));var Zt=kn(),jt=l(Zt);s(Zt),k(()=>$(jt,`(${ee(e(xt)),i(()=>e(xt).alternateDamage)??""}, total: ${e(Wt)??""})`)),o(Ut,Zt)},Yt=Ut=>{var Wt=Sn(),Zt=l(Wt);s(Wt),k(()=>$(Zt,`(${ee(e(xt)),i(()=>e(xt).baseDamage)??""})`)),o(Ut,Wt)};g(na,Ut=>{e(m),i(()=>e(m).targetIsDamaged)?Ut(va):Ut(Yt,!1)})}s(Et),s(Pt),wa(la,()=>e(m).targetIsDamaged,Ut=>(e(m).targetIsDamaged=Ut,Ht(()=>(e(_),t(),v())))),o(Tt,Pt)};g(Jt,Tt=>{e(xt)&&Tt(aa)})}var zt=a(Jt,2);{var sa=Tt=>{const Pt=_t(()=>(ee(e(le)),i(()=>R(e(le)))));var Et=bt(),la=je(Et);{var na=Yt=>{var Ut=Bn(),Wt=je(Ut),Zt=l(Wt),jt=a(Zt,2);k(()=>{e(m),Ht(()=>{e(Pt)})}),yt(jt,5,()=>e(Pt),kt,(wt,At)=>{var Kt=Dn(),ta=l(Kt);s(Kt);var da={};k(()=>{$(ta,`Level ${e(At)??""}`),da!==(da=e(At))&&(Kt.value=(Kt.__value=e(At))??"")}),o(wt,Kt)}),s(jt);var ea=a(jt,2);{var gt=wt=>{const At=_t(()=>(e(m),ee(e(le)),i(()=>B(e(m),e(le)))));var Kt=Ln(),ta=l(Kt);{var da=oa=>{var fa=Mt("Healing");o(oa,fa)},It=oa=>{var fa=Mt("Damage");o(oa,fa)};g(ta,oa=>{ee(e(le)),i(()=>O(e(le)))?oa(da):oa(It,!1)})}var Vt=a(ta);s(Kt),k(()=>$(Vt,` ${e(At)??""}`)),o(wt,Kt)};g(ea,wt=>{e(m),ee(e(le)),i(()=>e(m).castAtLevel&&e(m).castAtLevel>e(le).level)&&wt(gt)})}s(Wt);var $t=a(Wt,2);{var Lt=wt=>{var At=An(),Kt=l(At),ta=l(Kt);Be(ta);var da=a(ta,2);{var It=Vt=>{const oa=_t(()=>(e(m),ee(e(le)),i(()=>B(e(m),e(le)))));var fa=jn(),ba=l(fa);s(fa),k(()=>$(ba,`(+1d8, total: ${e(oa)??""})`)),o(Vt,fa)};g(da,Vt=>{e(m),i(()=>e(m).targetIsFiendOrUndead)&&Vt(It)})}s(Kt),s(At),wa(ta,()=>e(m).targetIsFiendOrUndead,Vt=>(e(m).targetIsFiendOrUndead=Vt,Ht(()=>(e(_),t(),v())))),o(wt,At)};g($t,wt=>{ee(e(le)),i(()=>e(le).description.includes("Fiend or an Undead"))&&wt(Lt)})}k(()=>{lt(Zt,"for",`castLevel-${e(m),i(()=>e(m).id)??""}`),lt(jt,"id",`castLevel-${e(m),i(()=>e(m).id)??""}`)}),Ta(jt,()=>e(m).castAtLevel,wt=>(e(m).castAtLevel=wt,Ht(()=>(e(_),t(),v())))),o(Yt,Ut)},va=Yt=>{var Ut=Rn();o(Yt,Ut)};g(la,Yt=>{ee(e(Pt)),i(()=>e(Pt).length>0)?Yt(na):Yt(va,!1)})}o(Tt,Et)};g(zt,Tt=>{ee(e(le)),i(()=>e(le).higherLevelSlot&&e(le).level>0)&&Tt(sa)})}k(()=>{lt(ft,"aria-label",(e(W),e(m),i(()=>e(W)[e(m).id]?"Expand":"Collapse"))),$(nt,(e(W),e(m),i(()=>e(W)[e(m).id]?"‚ñº":"‚ñ≤")))}),j("click",$e,()=>A(e(m).id)),j("keydown",$e,Tt=>Tt.key==="Enter"&&A(e(m).id)),o(He,ht)},te=He=>{var M=Mn();o(He,M)};g(E,He=>{e(le)?He(Ve):He(te,!1)})}o(at,Dt)};g(Ne,at=>{e(I),i(()=>e(I).length===0)?at(ut):at(Ze,!1)})}o(pe,V)};g(q,pe=>{e(m),i(()=>e(m).spellRef)&&pe(Z)})}var Q=a(q,2);{var Ce=pe=>{var V=bt(),Ne=je(V);{var ut=Ze=>{var at=Fn(),le=l(at),Dt=a(le,2);xa(Dt),s(at),k(()=>{lt(le,"for",`attack-notes-${e(m),i(()=>e(m).id)??""}`),lt(Dt,"id",`attack-notes-${e(m),i(()=>e(m).id)??""}`)}),qe(Dt,()=>e(m).notes,E=>(e(m).notes=E,Ht(()=>(e(_),t(),v())))),o(Ze,at)};g(Ne,Ze=>{e(m),i(()=>e(m).notes&&e(m).notes.trim()!=="")&&Ze(ut)})}o(pe,V)};g(Q,pe=>{e(m),i(()=>!e(m).spellRef)&&pe(Ce)})}var We=a(Q,2),tt=l(We);{var Ke=pe=>{const V=_t(()=>(e(m),i(()=>K(e(m).spellRef))));var Ne=bt(),ut=je(Ne);{var Ze=at=>{var le=bt(),Dt=je(le);{var E=te=>{var He=Pn();j("click",He,()=>Fe(e(m))),o(te,He)},Ve=te=>{var He=bt(),M=je(He);{var xt=st=>{var $e=bt(),ft=je($e);{var nt=it=>{var pt=In(),St=l(pt),Jt=l(St),aa=l(Jt);Be(aa),aa.value=aa.__value="self",Qt(),s(Jt);var zt=a(Jt,2),sa=l(zt);Be(sa),sa.value=sa.__value="other",Qt(),s(zt),s(St);var Tt=a(St,2),Pt=l(Tt);s(Tt),s(pt),k(()=>{lt(aa,"name",`target-${e(m),i(()=>e(m).id)??""}`),lt(sa,"name",`target-${e(m),i(()=>e(m).id)??""}`),$(Pt,`Cast ${ee(e(V)),i(()=>e(V).name)??""}`)}),bs(P,[ve],aa,()=>e(z)[e(m).id],Et=>pa(z,e(z)[e(m).id]=Et)),bs(P,[ve],sa,()=>e(z)[e(m).id],Et=>pa(z,e(z)[e(m).id]=Et)),j("click",Tt,()=>ue(e(m),e(z)[e(m).id])),o(it,pt)},Rt=it=>{var pt=En();j("click",pt,()=>ue(e(m),"self")),o(it,pt)};g(ft,it=>{ee(e(V)),i(()=>Te(e(V).name))?it(nt):it(Rt,!1)})}o(st,$e)},ht=st=>{var $e=bt(),ft=je($e);{var nt=it=>{var pt=Un(),St=l(pt);{var Jt=zt=>{var sa=Mt("Roll Healing");o(zt,sa)},aa=zt=>{var sa=Mt("Roll Damage");o(zt,sa)};g(St,zt=>{ee(e(V)),i(()=>O(e(V)))?zt(Jt):zt(aa,!1)})}s(pt),k(zt=>Bt(pt,1,`btn ${zt??""}`),[()=>(ee(e(V)),i(()=>O(e(V))?"btn-success":"btn-secondary"))]),j("click",pt,()=>F(e(m))),o(it,pt)},Rt=it=>{var pt=Hn();j("click",pt,()=>ue(e(m),"self")),o(it,pt)};g(ft,it=>{e(m),i(()=>e(m).damage&&e(m).damage.trim()!=="")?it(nt):it(Rt,!1)})}o(st,$e)};g(M,st=>{ee(ws),ee(e(V)),i(()=>ws(e(V)))?st(xt):st(ht,!1)},!0)}o(te,He)};g(Dt,te=>{ee(Za),ee(e(V)),i(()=>Za(e(V)))?te(E):te(Ve,!1)})}o(at,le)};g(ut,at=>{e(V)&&at(Ze)})}o(pe,Ne)},Ye=pe=>{var V=bt(),Ne=je(V);{var ut=Ze=>{var at=On(),le=je(at),Dt=a(le,2);{var E=Ve=>{var te=Nn();j("click",te,()=>F(e(m))),o(Ve,te)};g(Dt,Ve=>{e(m),i(()=>e(m).damage&&e(m).damage.trim()!=="")&&Ve(E)})}j("click",le,()=>Fe(e(m))),o(Ze,at)};g(Ne,Ze=>{e(m),i(()=>!e(m).spellRef)&&Ze(ut)},!0)}o(pe,V)};g(tt,pe=>{e(m),e(x),i(()=>e(m).spellRef&&e(x))?pe(Ke):pe(Ye,!1)})}s(We),s(ie),k(()=>{lt(fe,"for",`attack-type-${e(m),i(()=>e(m).id)??""}`),lt(D,"id",`attack-type-${e(m),i(()=>e(m).id)??""}`)}),qe(D,()=>e(m).damageType,pe=>(e(m).damageType=pe,Ht(()=>(e(_),t(),v())))),o(Se,ie)});var re=a(G,2);{var _e=Se=>{var m=qn();o(Se,m)},ne=Se=>{var m=bt(),ve=je(m);{var ie=J=>{var Oe=zn();o(J,Oe)};g(ve,J=>{e(_),i(()=>e(_).length===0)&&J(ie)},!0)}o(Se,m)};g(re,Se=>{t(),i(()=>t().attacks.length===0)?Se(_e):Se(ne,!1)})}s(y);var N=a(y,2);{var H=Se=>{var m=Yn(),ve=a(l(m),4);yt(ve,5,()=>e(h),kt,(ie,J)=>{var Oe=Jn(),Ie=l(Oe),Le=l(Ie),Ue=l(Le,!0);s(Le);var de=a(Le,2),Ee=l(de);s(de),s(Ie);var ye=a(Ie,2),Qe=l(ye,!0);s(ye);var ze=a(ye,2),ot=l(ze);{var vt=Q=>{var Ce=Wn(),We=l(Ce),tt=a(We);{var Ke=Ye=>{var pe=Mt();k(()=>$(pe,`per ${e(J),i(()=>e(J).restType)??""} rest`)),o(Ye,pe)};g(tt,Ye=>{e(J),i(()=>e(J).restType)&&Ye(Ke)})}s(Ce),k(()=>$(We,`${e(J),i(()=>e(J).currentUses??e(J).usesPerRest)??""}/${e(J),i(()=>e(J).usesPerRest)??""} uses `)),o(Q,Ce)};g(ot,Q=>{e(J),i(()=>e(J).usesPerRest)&&Q(vt)})}var fe=a(ot,2);{var D=Q=>{var Ce=Kn();o(Q,Ce)};g(fe,Q=>{e(J),i(()=>e(J).requiresReaction)&&Q(D)})}var q=a(fe,2);{var Z=Q=>{var Ce=Vn();k(()=>Ce.disabled=(e(J),i(()=>e(J).currentUses===void 0||e(J).currentUses===0))),j("click",Ce,()=>oe(e(J).conditionName,e(J).name)),o(Q,Ce)};g(q,Q=>{f(),e(J),i(()=>!f()&&e(J).usesPerRest)&&Q(Z)})}s(ze),s(Oe),k(()=>{$(Ue,(e(J),i(()=>e(J).name))),$(Ee,`(${e(J),i(()=>e(J).conditionName)??""})`),$(Qe,(e(J),i(()=>e(J).description)))}),o(ie,Oe)}),s(ve),s(m),o(Se,m)};g(N,Se=>{e(h),i(()=>e(h).length>0)&&Se(H)})}var se=a(N,2),T=a(l(se),4),Pe=a(T,2);{var Ae=Se=>{var m=Zn();yt(m,5,()=>(t(),i(()=>t().activeStates)),kt,(ve,ie,J)=>{var Oe=Xn(),Ie=l(Oe),Le=l(Ie);Be(Le);var Ue=a(Le,2);{var de=Ye=>{var pe=Qn();j("click",pe,()=>we(J)),o(Ye,pe)};g(Ue,Ye=>{f()&&Ye(de)})}s(Ie);var Ee=a(Ie,2),ye=l(Ee),Qe=l(ye);lt(Qe,"for",`state-attack-bonus-${J}`);var ze=a(Qe,2);Be(ze),lt(ze,"id",`state-attack-bonus-${J}`),s(ye);var ot=a(ye,2),vt=l(ot);lt(vt,"for",`state-damage-bonus-${J}`);var fe=a(vt,2);Be(fe),lt(fe,"id",`state-damage-bonus-${J}`),s(ot);var D=a(ot,2),q=l(D);lt(q,"for",`state-target-${J}`);var Z=a(q,2);k(()=>{e(ie),Ht(()=>{})}),lt(Z,"id",`state-target-${J}`);var Q=l(Z);Q.value=Q.__value="self";var Ce=a(Q);Ce.value=Ce.__value="other",s(Z),s(D),s(Ee);var We=a(Ee,2),tt=l(We);lt(tt,"for",`state-desc-${J}`);var Ke=a(tt,2);Be(Ke),lt(Ke,"id",`state-desc-${J}`),s(We),s(Oe),qe(Le,()=>e(ie).name,Ye=>(e(ie).name=Ye,Ht(()=>t()),La(p,"$character"))),qe(ze,()=>e(ie).attackBonus,Ye=>(e(ie).attackBonus=Ye,Ht(()=>t()),La(p,"$character"))),qe(fe,()=>e(ie).damageBonus,Ye=>(e(ie).damageBonus=Ye,Ht(()=>t()),La(p,"$character"))),Ta(Z,()=>e(ie).target,Ye=>(e(ie).target=Ye,Ht(()=>t()),La(p,"$character"))),qe(Ke,()=>e(ie).description,Ye=>(e(ie).description=Ye,Ht(()=>t()),La(p,"$character"))),o(ve,Oe)}),s(m),o(Se,m)},Xe=Se=>{var m=ei();o(Se,m)};g(Pe,Se=>{t(),i(()=>t().activeStates&&t().activeStates.length>0)?Se(Ae):Se(Xe,!1)})}s(se),j("click",T,De),o(w,U)};g(mt,w=>{u(),i(()=>!u().attacks)&&w(ct)})}s(ke);var Je=a(ke,2);sn(Je,{get show(){return e(L)},get attacks(){return t(),i(()=>t().attacks)},onSave:be,onCancel:me}),k(()=>Ge=Bt(ke,1,"attacks svelte-14o91c5",null,Ge,{hidden:!e(X)})),o(n,ce),qt(),C()}var li=d('<span class="slot-checkbox-x svelte-serp1j">&#8212;</span>'),ni=d('<label><input type="checkbox" class="slot-checkbox-input svelte-serp1j"/> <span><!></span></label>');function ks(n,c){Gt(c,!1);const t=()=>dt(ma,"$isEditMode",v),[v,u]=ra();let f=Ct(c,"checked",8,!1),p=Ct(c,"disabled",8,!1),C=Ct(c,"className",8,""),h=Ct(c,"index",8,void 0),_=Ct(c,"ariaLabel",8,void 0);const X=_a();function P(A){X("change",{checked:A.currentTarget.checked,index:h()})}Ot();var oe=ni(),ae=l(oe);Be(ae);var W=a(ae,2),z=l(W);{var L=A=>{var O=li();o(A,O)};g(z,A=>{f()&&A(L)})}s(W),s(oe),k(()=>{Bt(oe,1,"slot-checkbox-label "+C()+(t()?"":" not-editable"),"svelte-serp1j"),Bs(ae,f()),ae.disabled=p()||!t(),lt(ae,"aria-label",_()),lt(ae,"tabindex",t()?0:-1),Bt(W,1,`slot-checkbox-custom ${f()?"used":""} ${t()?"":"readonly"}`,"svelte-serp1j")}),j("change",ae,P),o(n,oe),qt(),u()}var ii=d('<span class="spell-type cantrip svelte-19b5nmj">Cantrip</span>'),ri=d('<span class="spell-type svelte-19b5nmj"> </span>'),oi=d('<span class="spell-notes svelte-19b5nmj"> </span>'),ci=d('<button class="btn btn-sm btn-primary svelte-19b5nmj">Use</button>'),vi=d('<div class="spell-uses svelte-19b5nmj"><span> </span> <!></div>'),di=d('<div class="spell-uses svelte-19b5nmj"><span class="uses-count unlimited svelte-19b5nmj">At will</span></div>'),ui=d('<span class="rest-type svelte-19b5nmj"> </span>'),fi=d('<span class="spellcasting-ability svelte-19b5nmj"> </span>'),pi=d('<span class="no-components svelte-19b5nmj">No components required</span>'),mi=d('<div class="racial-spell-item svelte-19b5nmj"><div class="spell-info svelte-19b5nmj"><span class="spell-name svelte-19b5nmj"> </span> <!> <!></div> <!> <div class="spell-meta svelte-19b5nmj"><!> <!> <!></div></div>'),gi=d('<div class="racial-spells svelte-19b5nmj"><h5 class="svelte-19b5nmj">Spells:</h5> <div class="racial-spells-list svelte-19b5nmj"></div></div>'),bi=d('<div class="feature-box racial-trait svelte-19b5nmj"><h4 class="svelte-19b5nmj"> </h4> <p class="feature-description svelte-19b5nmj"> </p> <!></div>'),hi=d('<div class="racial-traits-section svelte-19b5nmj"><h3 class="racial-traits-title svelte-19b5nmj">Racial Traits</h3> <!></div>');function _i(n,c){Gt(c,!1);const t=()=>dt(ge,"$character",u),v=()=>dt(ma,"$isEditMode",u),[u,f]=ra(),p=S(),C=S(),h=S();function _(L){ll(L)}function X(L){if(!t().racialTraits)return 0;const A=t().racialTraits.uses[L];return A?A.currentUses:0}function P(L){if(!t().racialTraits)return 0;const A=t().racialTraits.uses[L];return A?A.maxUses:0}function oe(L){return L.usesPerRest!==void 0}et(()=>(t(),fs),()=>{t().race&&t().level&&fs()}),et(()=>(t(),ps),()=>{r(p,t().race?ps(t().race):null)}),et(()=>t(),()=>{r(C,ss(t().race,t().level))}),et(()=>(e(p),e(C)),()=>{r(h,e(p)&&e(p).traits&&e(p).traits.length>0&&e(C).length>0)}),ca(),Ot();var ae=bt(),W=je(ae);{var z=L=>{var A=hi(),O=a(l(A),2);yt(O,1,()=>(e(p),i(()=>e(p).traits)),kt,(Te,Re)=>{var Y=bi(),Me=l(Y),me=l(Me,!0);s(Me);var be=a(Me,2),Fe=l(be,!0);s(be);var F=a(be,2);{var I=x=>{var K=gi(),b=a(l(K),2);yt(b,5,()=>e(C),kt,(B,R)=>{var De=mi(),we=l(De),ue=l(we),ce=l(ue,!0);s(ue);var ke=a(ue,2);{var Ge=N=>{var H=ii();o(N,H)},rt=N=>{var H=ri(),se=l(H);s(H),k(()=>$(se,`Level ${e(R),i(()=>e(R).level)??""}`)),o(N,H)};g(ke,N=>{e(R),i(()=>e(R).level===0)?N(Ge):N(rt,!1)})}var mt=a(ke,2);{var ct=N=>{var H=oi(),se=l(H);s(H),k(()=>$(se,`(${e(R),i(()=>e(R).notes)??""})`)),o(N,H)};g(mt,N=>{e(R),i(()=>e(R).notes)&&N(ct)})}s(we);var Je=a(we,2);{var w=N=>{const H=_t(()=>(e(R),i(()=>X(e(R).name)))),se=_t(()=>(e(R),i(()=>P(e(R).name))));var T=vi(),Pe=l(T);let Ae;var Xe=l(Pe);s(Pe);var Se=a(Pe,2);{var m=ve=>{var ie=ci();k(()=>{ie.disabled=e(H)===0,lt(ie,"aria-label",`Use ${e(R),i(()=>e(R).name)??""}`)}),j("click",ie,()=>_(e(R).name)),o(ve,ie)};g(Se,ve=>{v()||ve(m)})}s(T),k(()=>{Ae=Bt(Pe,1,"uses-count svelte-19b5nmj",null,Ae,{depleted:e(H)===0}),$(Xe,`${e(H)??""}/${e(se)??""} uses`)}),o(N,T)},U=N=>{var H=di();o(N,H)};g(Je,N=>{e(R),i(()=>oe(e(R)))?N(w):N(U,!1)})}var he=a(Je,2),xe=l(he);{var y=N=>{var H=ui(),se=l(H);s(H),k(()=>$(se,`Recharges on ${e(R),i(()=>e(R).restType==="short"?"Short":"Long")??""} Rest`)),o(N,H)};g(xe,N=>{e(R),i(()=>e(R).restType)&&N(y)})}var G=a(xe,2);{var re=N=>{var H=fi(),se=l(H);s(H),k(T=>$(se,`Spellcasting: ${T??""}`),[()=>(e(Re),i(()=>e(Re).spellcastingAbility.toUpperCase()))]),o(N,H)};g(G,N=>{e(Re),i(()=>e(Re).spellcastingAbility)&&N(re)})}var _e=a(G,2);{var ne=N=>{var H=pi();o(N,H)};g(_e,N=>{e(Re),i(()=>e(Re).componentsRequired===!1)&&N(ne)})}s(he),s(De),k(()=>$(ce,(e(R),i(()=>e(R).name)))),o(B,De)}),s(b),s(K),o(x,K)};g(F,x=>{e(Re),e(C),i(()=>e(Re).spells&&e(C).length>0)&&x(I)})}s(Y),k(()=>{$(me,(e(Re),i(()=>e(Re).name))),$(Fe,(e(Re),i(()=>e(Re).description)))}),o(Te,Y)}),s(A),o(L,A)};g(W,L=>{e(h)&&e(p)&&L(z)})}o(n,ae),qt(),f()}var yi=d('<p class="no-features svelte-1kpvv0n">Select a class to see available features</p>'),xi=d('<p class="no-features svelte-1kpvv0n">No class features available at this level</p>'),$i=d('<div class="spell-slots svelte-1kpvv0n"><label class="svelte-1kpvv0n"> </label> <div class="slots-tracker svelte-1kpvv0n"></div></div>'),wi=d('<div class="all-spell-slots"></div>'),ki=d('<div class="feature-box spellcasting svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"> </h3> <div class="spell-stats svelte-1kpvv0n"><div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Spell Save DC</label> <div class="spell-value svelte-1kpvv0n"> </div></div> <div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <div class="spell-value svelte-1kpvv0n"> </div></div></div> <!> <div class="prepared-spells svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <textarea placeholder="List your prepared spells..." class="svelte-1kpvv0n"></textarea></div></div>'),Si=d('<p class="unlimited svelte-1kpvv0n">Unlimited Uses</p>'),Ci=d('<div class="slots-tracker svelte-1kpvv0n"></div> <div class="uses-actions-row"><button class="btn btn-primary use-enabled"> </button></div> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div>',1),Di=d('<div class="uses-tracker svelte-1kpvv0n"><!></div>'),Li=d('<div class="pool-tracker svelte-1kpvv0n"><input type="number" min="0" class="pool-input svelte-1kpvv0n"/> <span> </span> <button class="btn-small svelte-1kpvv0n"> </button></div>'),ji=d('<p class="no-uses svelte-1kpvv0n">No Channel Divinity uses remaining</p>'),Ai=d('<div class="channel-divinity-option svelte-1kpvv0n"><button class="btn btn-primary use-enabled svelte-1kpvv0n">Use Channel Divinity</button> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div> <!></div>'),Bi=d('<div class="feature-box svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"><!> </h3> <p class="feature-description svelte-1kpvv0n"> </p> <!></div>'),Ri=d('<div class="features-grid svelte-1kpvv0n"><!> <!></div>'),Ti=d("<!> <!>",1),Mi=d("<section><!> <!></section>");function Fi(n,c){Gt(c,!1);const t=()=>dt(ge,"$character",p),v=()=>dt(qa,"$abilityModifiers",p),u=()=>dt(ga,"$searchFilter",p),f=()=>dt(Xt,"$collapsedStates",p),[p,C]=ra(),h=S(),_=S(),X=S(),P=S(),oe=S(),ae=S(),W=S();let z=S(0),L=S(0);function A(b,B){ge.update(R=>(R.classFeatures.features[b]=B,R))}function O(){ge.update(b=>(b.classFeatures.spellSlotsByLevel||(b.classFeatures.spellSlotsByLevel={}),e(P).forEach(({level:B,slots:R})=>{b.classFeatures.spellSlotsByLevel[B]||(b.classFeatures.spellSlotsByLevel[B]=Array(R).fill(!1))}),b))}function Te(b){if(typeof b.maxUses=="function"){if((b.name==="Divine Sense"||b.name==="War Priest")&&e(h)?.spellcastingAbility){const B=v()[e(h).spellcastingAbility];return b.maxUses(t().level,B)}return b.maxUses(t().level)}return b.maxUses||0}function Re(b,B){ge.update(R=>((!R.classFeatures.features[b]||!Array.isArray(R.classFeatures.features[b])||R.classFeatures.features[b].length!==B)&&(R.classFeatures.features[b]=Array(B).fill(!1)),R))}Us(()=>{e(ae)&&t()&&t().classFeatures&&t().classFeatures.features&&e(ae).forEach(b=>{if(b.type==="uses"){const B=b.name.replace(/\s+/g,""),R=Te(b),De=t().classFeatures.features[B];(!Array.isArray(De)||De.length!==R)&&Re(B,R)}})});function Y(b){return typeof b.maxPool=="function"?b.maxPool(t().level):b.maxPool||0}function Me(b){return typeof b.description=="function"?b.description(t().level):b.description}function me(){const b="ChannelDivinity";ge.update(B=>{const R=B.classFeatures.features[b];return typeof R=="number"&&R>0&&(B.classFeatures.features[b]=R-1),B})}function be(){Xt.update(b=>({...b,classFeatures:!b.classFeatures}))}et(()=>(t(),ia),()=>{r(h,t().class?ia(t().class):null)}),et(()=>(t(),Sa),()=>{r(_,t().class?Sa(t().class,t().level,t().subclass):[])}),et(()=>(t(),ys),()=>{r(X,t().class?ys(t().class,t().level):0)}),et(()=>(e(h),t()),()=>{r(P,(()=>{if(!e(h)?.spellcaster)return[];const b=t().level,B=[];return b>=1&&B.push({level:1,slots:Math.min(4,2+Math.floor(b/3))}),b>=3&&B.push({level:2,slots:Math.min(3,2+Math.floor((b-3)/4))}),b>=5&&B.push({level:3,slots:Math.min(3,2+Math.floor((b-5)/5))}),b>=7&&B.push({level:4,slots:Math.min(3,1+Math.floor((b-7)/6))}),b>=9&&B.push({level:5,slots:Math.min(2,1+Math.floor((b-9)/8))}),b>=11&&B.push({level:6,slots:1}),b>=13&&B.push({level:7,slots:1}),b>=15&&B.push({level:8,slots:1}),b>=17&&B.push({level:9,slots:1}),B})())}),et(()=>(e(h),v(),t(),xs),()=>{if(e(h)?.spellcaster&&e(h).spellcastingAbility){const b=v()[e(h).spellcastingAbility];r(z,_l(t().class,b,t().proficiencyBonus)||0),r(L,xs(t().class,t().level,b))}}),et(()=>(t(),e(h),e(P)),()=>{t().class&&e(h)?.spellcaster&&e(P).length>0&&O()}),et(()=>t(),()=>{r(oe,(()=>{const B=t().classFeatures.features["ChannelDivinity"];return typeof B=="number"?B:0})())}),et(()=>(e(_),u()),()=>{r(ae,e(_).filter(b=>{if(!u())return!0;const B=u().toLowerCase();return b.name.toLowerCase().includes(B)||Me(b).toLowerCase().includes(B)}))}),et(()=>(u(),t(),e(ae)),()=>{r(W,!u()||t().class||"class features".includes(u().toLowerCase())||"spellcasting".includes(u().toLowerCase())||e(ae).length>0)}),ca(),Ot();var Fe=Mi();let F;var I=l(Fe);{let b=_t(()=>(f(),i(()=>f().classFeatures?"Expand":"Collapse")));ya(I,{title:"Class Features",get collapsed(){return f(),i(()=>f().classFeatures)},get ariaLabel(){return e(b)},onToggle:be})}var x=a(I,2);{var K=b=>{var B=Ti(),R=je(B);_i(R,{});var De=a(R,2);{var we=ce=>{var ke=yi();o(ce,ke)},ue=ce=>{var ke=bt(),Ge=je(ke);{var rt=ct=>{var Je=xi();o(ct,Je)},mt=ct=>{var Je=Ri(),w=l(Je);{var U=xe=>{var y=ki(),G=l(y),re=l(G);s(G);var _e=a(G,2),ne=l(_e),N=a(l(ne),2),H=l(N,!0);s(N),s(ne);var se=a(ne,2),T=a(l(se),2),Pe=l(T,!0);s(T),s(se),s(_e);var Ae=a(_e,2);{var Xe=ve=>{var ie=wi();yt(ie,5,()=>e(P),kt,(J,Oe)=>{let Ie=()=>e(Oe).level,Le=()=>e(Oe).slots;const Ue=_t(()=>(t(),Ie(),Le(),i(()=>t().classFeatures.spellSlotsByLevel?.[Ie()]||Array(Le()).fill(!1))));var de=$i(),Ee=l(de),ye=l(Ee);s(Ee);var Qe=a(Ee,2);yt(Qe,5,()=>e(Ue),kt,(ze,ot,vt)=>{{let fe=_t(()=>(ee(e(Ue)),i(()=>e(Ue)[vt]||!1)));ks(ze,{get checked(){return e(fe)},$$events:{change:D=>{ge.update(q=>(q.classFeatures.spellSlotsByLevel||(q.classFeatures.spellSlotsByLevel={}),q.classFeatures.spellSlotsByLevel[Ie()]||(q.classFeatures.spellSlotsByLevel[Ie()]=Array(Le()).fill(!1)),q.classFeatures.spellSlotsByLevel[Ie()][vt]=D.detail.checked,q))}}})}}),s(Qe),s(de),k(()=>$(ye,`${Ie()===1?"1st":Ie()===2?"2nd":Ie()===3?"3rd":`${Ie()}th`} Level Spell Slots`)),o(J,de)}),s(ie),o(ve,ie)};g(Ae,ve=>{e(P),i(()=>e(P).length>0)&&ve(Xe)})}var Se=a(Ae,2),m=a(l(Se),2);xa(m),s(Se),s(y),k(ve=>{$(re,`Spellcasting (${ve??""})`),$(H,e(z)),$(Pe,e(L))},[()=>(e(h),i(()=>e(h).spellcastingAbility?.toUpperCase()))]),qe(m,()=>t().classFeatures.preparedSpells,ve=>Ft(ge,i(t).classFeatures.preparedSpells=ve,i(t))),o(xe,y)};g(w,xe=>{e(h),i(()=>e(h)?.spellcaster)&&xe(U)})}var he=a(w,2);yt(he,1,()=>e(ae),kt,(xe,y)=>{const G=_t(()=>(e(y),i(()=>e(y).name.replace(/\s+/g,"")))),re=_t(()=>(t(),ee(e(G)),i(()=>t().classFeatures.features[e(G)]))),_e=_t(()=>typeof e(re)=="number");var ne=Bi(),N=l(ne),H=l(N);{var se=ve=>{var ie=Mt("Channel Divinity:");o(ve,ie)};g(H,ve=>{e(y),i(()=>e(y).type==="channelDivinity")&&ve(se)})}var T=a(H);s(N);var Pe=a(N,2),Ae=l(Pe,!0);s(Pe);var Xe=a(Pe,2);{var Se=ve=>{const ie=_t(()=>(e(y),i(()=>Te(e(y))))),J=_t(()=>(ee(e(re)),ee(e(ie)),i(()=>Array.isArray(e(re))?e(re):Array(e(ie)).fill(!1))));var Oe=Di(),Ie=l(Oe);{var Le=de=>{var Ee=Si();o(de,Ee)},Ue=de=>{var Ee=Ci(),ye=je(Ee);yt(ye,5,()=>e(J),kt,(q,Z,Q)=>{ks(q,{get checked(){return e(Z)},index:Q,$$events:{change:Ce=>{ge.update(We=>(We.classFeatures.features[e(G)]||(We.classFeatures.features[e(G)]=Array(e(ie)).fill(!1)),We.classFeatures.features[e(G)][Q]=Ce.detail.checked,We))}}})}),s(ye);var Qe=a(ye,2),ze=l(Qe),ot=l(ze);s(ze),s(Qe);var vt=a(Qe,2),fe=l(vt),D=l(fe);s(fe),s(vt),k(q=>{ze.disabled=q,$(ot,`Use ${e(y),i(()=>e(y).name)??""}`),$(D,`Resets on ${e(y),i(()=>e(y).resetOn==="short"?"Short Rest":"Long Rest")??""}`)},[()=>(ee(e(J)),i(()=>e(J).filter(q=>!q).length<=0))]),j("click",ze,()=>{ge.update(q=>{q.classFeatures.features[e(G)]||(q.classFeatures.features[e(G)]=Array(e(ie)).fill(!1));const Z=q.classFeatures.features[e(G)],Q=Z.findIndex(Ce=>!Ce);return Q!==-1&&(Z[Q]=!0),q})}),o(de,Ee)};g(Ie,de=>{e(ie)===1/0?de(Le):de(Ue,!1)})}s(Oe),o(ve,Oe)},m=ve=>{var ie=bt(),J=je(ie);{var Oe=Le=>{const Ue=_t(()=>(e(y),i(()=>Y(e(y)))));var de=Li(),Ee=l(de);Be(Ee);var ye=a(Ee,2),Qe=l(ye);s(ye);var ze=a(ye,2),ot=l(ze,!0);s(ze),s(de),k(()=>{Ba(Ee,e(_e)&&e(re)!==void 0?e(re):e(Ue)),lt(Ee,"max",e(Ue)),$(Qe,`/ ${e(Ue)??""}`),$(ot,(e(y),i(()=>e(y).resetOn==="short"?"Short Rest":"Long Rest")))}),j("input",Ee,vt=>{ge.update(fe=>(fe.classFeatures.features[e(G)]=parseInt(vt.currentTarget.value)||0,fe))}),j("click",ze,()=>A(e(G),e(Ue))),o(Le,de)},Ie=Le=>{var Ue=bt(),de=je(Ue);{var Ee=ye=>{var Qe=Ai(),ze=l(Qe),ot=a(ze,2),vt=l(ot),fe=l(vt);s(vt),s(ot);var D=a(ot,2);{var q=Z=>{var Q=ji();o(Z,Q)};g(D,Z=>{e(oe)<=0&&Z(q)})}s(Qe),k(()=>{ze.disabled=e(oe)<=0,$(fe,`Resets on ${e(y),i(()=>e(y).resetOn==="short"?"Short Rest":"Long Rest")??""}`)}),j("click",ze,me),o(ye,Qe)};g(de,ye=>{e(y),i(()=>e(y).type==="channelDivinity")&&ye(Ee)},!0)}o(Le,Ue)};g(J,Le=>{e(y),i(()=>e(y).type==="pool")?Le(Oe):Le(Ie,!1)},!0)}o(ve,ie)};g(Xe,ve=>{e(y),i(()=>e(y).type==="uses")?ve(Se):ve(m,!1)})}s(ne),k(ve=>{$(T,` ${e(y),i(()=>e(y).name)??""}`),$(Ae,ve)},[()=>(e(y),i(()=>Me(e(y))))]),o(xe,ne)}),s(Je),o(ct,Je)};g(Ge,ct=>{e(_),i(()=>e(_).length===0)?ct(rt):ct(mt,!1)},!0)}o(ce,ke)};g(De,ce=>{t(),i(()=>!t().class)?ce(we):ce(ue,!1)})}o(b,B)};g(x,b=>{f(),i(()=>!f().classFeatures)&&b(K)})}s(Fe),k(()=>F=Bt(Fe,1,"class-features svelte-1kpvv0n",null,F,{hidden:!e(W)})),o(n,Fe),qt(),C()}var Pi=d('<textarea placeholder="Enter features, traits, and special abilities..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Equipment</h3> <textarea placeholder="List your equipment and inventory..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Notes</h3> <textarea placeholder="Additional notes..." class="svelte-wttn0l"></textarea>',1),Ii=d("<section><!> <!></section>");function Ei(n,c){Gt(c,!1);const t=()=>dt(ga,"$searchFilter",f),v=()=>dt(ge,"$character",f),u=()=>dt(Xt,"$collapsedStates",f),[f,p]=ra(),C=S();function h(){Xt.update(W=>({...W,notes:!W.notes}))}et(()=>(t(),v()),()=>{r(C,!t()||"features".includes(t().toLowerCase())||"traits".includes(t().toLowerCase())||"equipment".includes(t().toLowerCase())||"notes".includes(t().toLowerCase())||v().features.toLowerCase().includes(t().toLowerCase())||v().equipment.toLowerCase().includes(t().toLowerCase())||v().notes.toLowerCase().includes(t().toLowerCase()))}),ca(),Ot();var _=Ii();let X;var P=l(_);{let W=_t(()=>(u(),i(()=>u().notes?"Expand":"Collapse")));ya(P,{title:"Features & Traits",get collapsed(){return u(),i(()=>u().notes)},get ariaLabel(){return e(W)},onToggle:h})}var oe=a(P,2);{var ae=W=>{var z=Pi(),L=je(z);xa(L);var A=a(L,4);xa(A);var O=a(A,4);xa(O),qe(L,()=>v().features,Te=>Ft(ge,i(v).features=Te,i(v))),qe(A,()=>v().equipment,Te=>Ft(ge,i(v).equipment=Te,i(v))),qe(O,()=>v().notes,Te=>Ft(ge,i(v).notes=Te,i(v))),o(W,z)};g(oe,W=>{u(),i(()=>!u().notes)&&W(ae)})}s(_),k(()=>X=Bt(_,1,"notes svelte-wttn0l",null,X,{hidden:!e(C)})),o(n,_),qt(),p()}var Ui=d(" <!> <!> <!> <!> <!>",1),Hi=d('<div class="color-picker-section svelte-1r90jgp"><h3 class="svelte-1r90jgp">Dice Colors</h3> <div class="color-inputs svelte-1r90jgp"><div class="color-input-group svelte-1r90jgp"><label for="dice-color" class="svelte-1r90jgp">Dice Color</label> <input type="color" id="dice-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="label-color" class="svelte-1r90jgp">Label Color</label> <input type="color" id="label-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="desk-color" class="svelte-1r90jgp">Background Color</label> <input type="color" id="desk-color" class="svelte-1r90jgp"/></div></div></div>'),Ni=d('<div class="loading svelte-1r90jgp"><p class="svelte-1r90jgp">Loading 3D dice...</p></div>'),Oi=d('<div class="custom-dice-selector svelte-1r90jgp"><h3 class="svelte-1r90jgp">Choose Dice to Roll</h3> <div class="dice-inputs svelte-1r90jgp"><div class="dice-input-group svelte-1r90jgp"><label for="d4" class="svelte-1r90jgp">d4</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d4" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d6" class="svelte-1r90jgp">d6</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d6" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d8" class="svelte-1r90jgp">d8</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d8" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d10" class="svelte-1r90jgp">d10</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d10" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d12" class="svelte-1r90jgp">d12</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d12" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d20" class="svelte-1r90jgp">d20</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d20" min="0" max="10"/></div></div> <div class="dice-controls svelte-1r90jgp"><button class="btn btn-primary use-enabled svelte-1r90jgp"> </button> <button class="btn btn-secondary use-enabled svelte-1r90jgp">Reset</button></div></div>'),Gi=d('<h3 class="svelte-1r90jgp"> </h3>'),qi=d('<h3 class="svelte-1r90jgp"> </h3>'),zi=d('<h3 class="svelte-1r90jgp"> </h3>'),Wi=d('<h3 class="svelte-1r90jgp"> </h3>'),Ki=d('<span class="crit-badge svelte-1r90jgp">CRITICAL HIT!</span>'),Vi=d('<span class="crit-badge crit-fail svelte-1r90jgp">CRITICAL MISS!</span>'),Ji=d('<div class="bonus-item svelte-1r90jgp"><span class="bonus-value svelte-1r90jgp"> </span> <span class="bonus-source svelte-1r90jgp"> </span></div>'),Yi=d('<div class="bonus-breakdown svelte-1r90jgp"></div>'),Qi=d('<p class="modifier-text svelte-1r90jgp"> </p>'),Xi=d('<div class="svelte-1r90jgp"><em class="svelte-1r90jgp">No damage is dealt on a critical miss.</em></div>'),Zi=d('<button class="btn btn-follow-up svelte-1r90jgp"> </button>'),er=d('<button class="btn btn-guided-strike svelte-1r90jgp">‚ö° Use Guided Strike (+10)</button>'),tr=d('<div class="follow-up-actions svelte-1r90jgp"><!> <!></div>'),ar=d('<div class="result-header svelte-1r90jgp"><!> <!> <!></div> <div class="result-total svelte-1r90jgp"> </div> <div class="result-details svelte-1r90jgp"><!></div> <!> <!>',1),sr=d('<div role="button" tabindex="-1"><div class="modal-content svelte-1r90jgp" role="dialog" tabindex="0"><div class="modal-header svelte-1r90jgp"><h2 class="svelte-1r90jgp"><!></h2> <div class="header-buttons svelte-1r90jgp"><button class="color-btn svelte-1r90jgp" title="Customize dice colors">üé®</button> <button class="close-btn svelte-1r90jgp">√ó</button></div></div> <!> <!> <div class="dice-main-area svelte-1r90jgp"><div class="dice-container svelte-1r90jgp"></div> <!></div> <div><!></div></div></div>');function lr(n,c){Gt(c,!1);const t=()=>dt(ge,"$character",v),[v,u]=ra(),f=S(),p=S(),C=S(),h=_a();let _=Ct(c,"notation",12,""),X=Ct(c,"visible",8,!1),P=Ct(c,"damageNotation",12,""),oe=Ct(c,"damageType",8,""),ae=Ct(c,"attackName",12,""),W=Ct(c,"applyHalfDamage",8,!1),z=Ct(c,"bonusBreakdown",28,()=>[]),L=Ct(c,"rollType",12,"other"),A=null,O=S(void 0),Te=S(!1),Re=S(""),Y=S(null);function Me(){return e(Y)?.resultTotal??null}function me(D,q,Z){const Q=[];if(!D||!D.result)return Q;const Ce=q.match(/([+-]?\d*d\d+|[+-]?\d+)/g)||[];let We=0;const tt=new Set;for(const Ke of Ce){const Ye=Ke.trim();if(!Ye)continue;const pe=Ye.match(/([+-]?)(\d*)d(\d+)/);if(pe){const V=parseInt(pe[2]||"1"),Ne=`${V}d${pe[3]}`,ut=Z.findIndex((le,Dt)=>!tt.has(Dt)&&typeof le.value=="string"&&le.value===Ne),Ze=[];for(let le=0;le<V&&We<D.result.length;le++)Ze.push(D.result[We++]);const at=ut>=0?Z[ut].source:"base die";ut>=0&&tt.add(ut);for(const le of Ze)Q.push({display:`${le}`,source:at})}}for(let Ke=0;Ke<Z.length;Ke++)if(!tt.has(Ke)&&typeof Z[Ke].value=="number"){const Ye=Z[Ke].value;Q.push({display:Ye>=0?`+${Ye}`:`${Ye}`,source:Z[Ke].source})}return Q}let be=S(0),Fe=S(0),F=S(0),I=S(0),x=S(0),K=S(0),b=S(0),B=S([]),R=S(!1),De=S(!1),we=S(!1),ue=S("#051e0a"),ce=S("#ffffff"),ke=S("#3a2004"),Ge=S(!1);function rt(D){return D.length===9&&D.startsWith("#")?D.substring(0,7):D}function mt(D,q="ff"){return D.length===7&&D.startsWith("#")?D+q:D}function ct(){if(window.DICE&&e(O))try{A&&e(O)&&pa(O,e(O).innerHTML="");const D=e(O).clientWidth||500,q=e(O).clientHeight||300;A=new window.DICE.dice_box(e(O),{w:D,h:q}),r(Te,!0)}catch(D){console.error("Error initializing dice box:",D)}}$a(()=>{const D=Q=>new Promise((Ce,We)=>{if(document.querySelector(`script[src="${Q}"]`)){Ce(null);return}const Ke=document.createElement("script");Ke.src=Q,Ke.onload=()=>{Ce(null)},Ke.onerror=()=>{console.error(`Failed to load: ${Q}`),We(new Error(`Failed to load ${Q}`))},document.head.appendChild(Ke)});setTimeout(()=>{D(`${ja}/libs/three.min.js`).then(()=>D(`${ja}/libs/cannon.min.js`)).then(()=>D(`${ja}/libs/teal.js`)).then(()=>D(`${ja}/dice.js`)).then(()=>{if(window.DICE){const Q=window.DICE.getColors();r(ue,rt(Q.dice_color)),r(ce,rt(Q.label_color)),r(ke,rt(Q.desk_color))}ct()}).catch(Q=>{console.error("Failed to load dice libraries:",Q)})},100);const q=()=>{e(Te)&&ct()},Z=Q=>{X()&&Q.key==="Escape"&&_e()};return window.addEventListener("resize",q),window.addEventListener("keydown",Z),()=>{window.removeEventListener("resize",q),window.removeEventListener("keydown",Z)}});function Je(D,q="other"){if(!A||!e(Te))return;r(Y,null),r(B,[]),r(R,!1),r(De,!1),q==="damage"&&z([]),L(q),r(we,!1),A.diceToRoll=D;const Z=Ce=>null,Q=Ce=>{let We=Ce.resultTotal,tt=Ce.resultString;if(W()&&(We=Math.floor(We/2),tt=tt+" (halved)"),r(Y,{...Ce,resultTotal:We,resultString:tt}),console.log("Final roll result:",e(Y)),console.log({type:q}),q==="attack"&&Ce.result&&Ce.result.length>0){const Ke=Ce.result[0];r(R,Ke===20),r(De,Ke===1)}if(r(B,[]),console.log("Setting up follow-up actions. Type:",q,"damageNotation:",P(),"isCriticalSuccess:",e(R),"isCriticalFail:",e(De)),q==="attack"&&P())if(e(R)){const Ke=he(P());e(B).push({label:`Roll Critical Damage (${Ke})`,notation:Ke})}else e(De)||e(B).push({label:`Roll Damage (${P()})`,notation:P()})};A.start_throw(Z,Q)}function w(){const D=[];e(be)>0&&D.push(`${e(be)}d4`),e(Fe)>0&&D.push(`${e(Fe)}d6`),e(F)>0&&D.push(`${e(F)}d8`),e(I)>0&&D.push(`${e(I)}d10`),e(x)>0&&D.push(`${e(x)}d12`),e(K)>0&&D.push(`${e(K)}d20`);let q=D.join("+")||"1d20";return e(b)!==0&&(q+=e(b)>=0?`+${e(b)}`:`${e(b)}`),q}function U(){const D=w();Je(D)}function he(D){return D.replace(/(\d+)d(\d+)/g,(q,Z,Q)=>`${parseInt(Z)*2}d${Q}`)}function xe(){r(be,0),r(Fe,0),r(F,0),r(I,0),r(x,0),r(K,0),r(b,0),r(Y,null),r(B,[]),r(R,!1),r(De,!1),L("other"),r(we,!1)}function y(){window.DICE&&(window.DICE.setColors({dice_color:mt(e(ue),"ff"),label_color:mt(e(ce),"ff"),desk_color:e(ke)}),A&&(A.updateDeskColor(e(ke)),A.updateDiceColors()))}function G(){r(Ge,!e(Ge))}function re(){!e(Y)||e(p)<=0||e(we)||(r(Y,{...e(Y),resultTotal:e(Y).resultTotal+10,resultString:e(Y).resultString+" + 10 (Guided Strike)"}),ge.update(D=>{const q="ChannelDivinity",Z=D.classFeatures.features[q];return typeof Z=="number"&&Z>0&&(D.classFeatures.features[q]=Z-1),D}),r(we,!0))}function _e(){h("close"),_(""),P(""),ae(""),r(Re,""),r(Y,null),r(we,!1),r(R,!1),r(De,!1),xe()}et(()=>(t(),Sa),()=>{r(f,t().class?Sa(t().class,t().level,t().subclass).some(q=>q.name==="Guided Strike"):!1)}),et(()=>t(),()=>{r(p,(()=>{const q=t().classFeatures.features["ChannelDivinity"];return typeof q=="number"?q:0})())}),et(()=>(e(be),e(Fe),e(F),e(I),e(x),e(K),e(b)),()=>{r(C,(()=>{const D=[];e(be)>0&&D.push(`${e(be)}d4`),e(Fe)>0&&D.push(`${e(Fe)}d6`),e(F)>0&&D.push(`${e(F)}d8`),e(I)>0&&D.push(`${e(I)}d10`),e(x)>0&&D.push(`${e(x)}d12`),e(K)>0&&D.push(`${e(K)}d20`);let q=D.join("+")||"1d20";return e(b)!==0&&(q+=e(b)>=0?`+${e(b)}`:`${e(b)}`),q})())}),et(()=>(ee(_()),e(Te),ee(X()),e(Re),ee(P()),ee(ae()),ee(L())),()=>{_()&&e(Te)&&X()&&_()!==e(Re)&&(r(Re,_()),r(Y,null),r(B,[]),r(R,!1),r(De,!1),r(we,!1),console.log("Auto-roll triggered. notation:",_(),"damageNotation:",P(),"attackName:",ae(),"rollType:",L()),setTimeout(()=>Je(_(),L()),200))}),ca();var ne={getLastRollTotal:Me};Ot();var N=sr();let H;var se=l(N),T=l(se),Pe=l(T),Ae=l(Pe);{var Xe=D=>{var q=Ui(),Z=je(q),Q=a(Z);{var Ce=Ze=>{var at=Mt("- Attack Roll");o(Ze,at)};g(Q,Ze=>{L()==="attack"&&Ze(Ce)})}var We=a(Q,2);{var tt=Ze=>{var at=Mt("- Damage Roll");o(Ze,at)};g(We,Ze=>{L()==="damage"&&Ze(tt)})}var Ke=a(We,2);{var Ye=Ze=>{var at=Mt("- Healing Roll");o(Ze,at)};g(Ke,Ze=>{L()==="healing"&&Ze(Ye)})}var pe=a(Ke,2);{var V=Ze=>{var at=Mt("- Ability Check");o(Ze,at)};g(pe,Ze=>{L()==="check"&&Ze(V)})}var Ne=a(pe,2);{var ut=Ze=>{var at=Mt("- Saving Throw");o(Ze,at)};g(Ne,Ze=>{L()==="save"&&Ze(ut)})}k(()=>$(Z,`${ae()??""} `)),o(D,q)},Se=D=>{var q=Mt("Dice Roller");o(D,q)};g(Ae,D=>{ae()?D(Xe):D(Se,!1)})}s(Pe);var m=a(Pe,2),ve=l(m),ie=a(ve,2);s(m),s(T);var J=a(T,2);{var Oe=D=>{var q=Hi(),Z=a(l(q),2),Q=l(Z),Ce=a(l(Q),2);Be(Ce),s(Q);var We=a(Q,2),tt=a(l(We),2);Be(tt),s(We);var Ke=a(We,2),Ye=a(l(Ke),2);Be(Ye),s(Ke),s(Z),s(q),qe(Ce,()=>e(ue),pe=>r(ue,pe)),j("change",Ce,y),qe(tt,()=>e(ce),pe=>r(ce,pe)),j("change",tt,y),qe(Ye,()=>e(ke),pe=>r(ke,pe)),j("change",Ye,y),o(D,q)};g(J,D=>{e(Ge)&&D(Oe)})}var Ie=a(J,2);{var Le=D=>{var q=Ni();o(D,q)};g(Ie,D=>{e(Te)||D(Le)})}var Ue=a(Ie,2),de=l(Ue);Ra(de,D=>r(O,D),()=>e(O));var Ee=a(de,2);{var ye=D=>{var q=Oi(),Z=a(l(q),2),Q=l(Z),Ce=a(l(Q),2);Be(Ce),s(Q);var We=a(Q,2),tt=a(l(We),2);Be(tt),s(We);var Ke=a(We,2),Ye=a(l(Ke),2);Be(Ye),s(Ke);var pe=a(Ke,2),V=a(l(pe),2);Be(V),s(pe);var Ne=a(pe,2),ut=a(l(Ne),2);Be(ut),s(Ne);var Ze=a(Ne,2),at=a(l(Ze),2);Be(at),s(Ze),s(Z);var le=a(Z,2),Dt=l(le),E=l(Dt);s(Dt);var Ve=a(Dt,2);s(le),s(q),k(()=>{Dt.disabled=!e(Te),$(E,`Roll ${e(C)??""}`)}),qe(Ce,()=>e(be),te=>r(be,te)),qe(tt,()=>e(Fe),te=>r(Fe,te)),qe(Ye,()=>e(F),te=>r(F,te)),qe(V,()=>e(I),te=>r(I,te)),qe(ut,()=>e(x),te=>r(x,te)),qe(at,()=>e(K),te=>r(K,te)),j("click",Dt,U),j("click",Ve,xe),o(D,q)};g(Ee,D=>{_()||D(ye)})}s(Ue);var Qe=a(Ue,2);let ze;var ot=l(Qe);{var vt=D=>{var q=ar(),Z=je(q),Q=l(Z);{var Ce=te=>{var He=Gi(),M=l(He,!0);s(He),k(()=>$(M,ae()?`${ae()} - Healing`:"Healing")),o(te,He)},We=te=>{var He=bt(),M=je(He);{var xt=st=>{var $e=qi(),ft=l($e,!0);s($e),k(()=>$(ft,ae()?`${ae()} - ${oe()} Damage`:`${oe()} Damage`)),o(st,$e)},ht=st=>{var $e=bt(),ft=je($e);{var nt=it=>{var pt=zi(),St=l(pt,!0);s(pt),k(()=>$(St,ae()?`${ae()} - Damage`:"Damage")),o(it,pt)},Rt=it=>{var pt=Wi(),St=l(pt,!0);s(pt),k(()=>$(St,ae()?`${ae()} - Result`:"Result")),o(it,pt)};g(ft,it=>{L()==="damage"?it(nt):it(Rt,!1)},!0)}o(st,$e)};g(M,st=>{L()==="damage"&&oe()?st(xt):st(ht,!1)},!0)}o(te,He)};g(Q,te=>{L()==="damage"&&oe()==="Healing"?te(Ce):te(We,!1)})}var tt=a(Q,2);{var Ke=te=>{var He=Ki();o(te,He)};g(tt,te=>{e(R)&&te(Ke)})}var Ye=a(tt,2);{var pe=te=>{var He=Vi();o(te,He)};g(Ye,te=>{e(De)&&te(pe)})}s(Z);var V=a(Z,2),Ne=l(V,!0);s(V);var ut=a(V,2),Ze=l(ut);{var at=te=>{var He=bt(),M=je(He);{var xt=st=>{var $e=Yi();yt($e,5,()=>(e(Y),ee(_()),ee(z()),i(()=>me(e(Y),_(),z()))),kt,(ft,nt)=>{var Rt=Ji(),it=l(Rt),pt=l(it,!0);s(it);var St=a(it,2),Jt=l(St);s(St),s(Rt),k(()=>{$(pt,(e(nt),i(()=>e(nt).display))),$(Jt,`(${e(nt),i(()=>e(nt).source)??""})`)}),o(ft,Rt)}),s($e),o(st,$e)},ht=st=>{var $e=bt(),ft=je($e);{var nt=Rt=>{var it=Qi(),pt=l(it);s(it),k(()=>$(pt,`Modifier: ${e(Y),i(()=>e(Y).constant>=0?"+":"")??""}${e(Y),i(()=>e(Y).constant)??""}`)),o(Rt,it)};g(ft,Rt=>{e(Y),i(()=>e(Y).constant)&&Rt(nt)},!0)}o(st,$e)};g(M,st=>{ee(z()),i(()=>z().length>0)?st(xt):st(ht,!1)})}o(te,He)};g(Ze,te=>{e(Y),ee(z()),i(()=>e(Y).constant||z().length>0)&&te(at)})}s(ut);var le=a(ut,2);{var Dt=te=>{var He=Xi();o(te,He)};g(le,te=>{e(De)&&te(Dt)})}var E=a(le,2);{var Ve=te=>{var He=tr(),M=l(He);yt(M,1,()=>e(B),kt,(st,$e)=>{var ft=Zi(),nt=l(ft,!0);s(ft),k(()=>$(nt,(e($e),i(()=>e($e).label)))),j("click",ft,()=>Je(e($e).notation,"damage")),o(st,ft)});var xt=a(M,2);{var ht=st=>{var $e=er();k(()=>{$e.disabled=e(p)<=0,lt($e,"title",e(p)<=0?"No Channel Divinity uses remaining":"Use Channel Divinity to add +10 to this attack roll")}),j("click",$e,re),o(st,$e)};g(xt,st=>{e(f)&&L()==="attack"&&!e(we)&&e(p)>0&&!e(De)&&st(ht)})}s(He),o(te,He)};g(E,te=>{e(B),e(f),ee(L()),e(we),e(p),i(()=>e(B).length>0||e(f)&&L()==="attack"&&!e(we)&&e(p)>0)&&te(Ve)})}k(()=>$(Ne,(e(Y),i(()=>e(Y).resultTotal)))),o(D,q)};g(ot,D=>{e(Y)&&D(vt)})}s(Qe),s(se),s(N),k(()=>{H=Bt(N,1,"modal-overlay svelte-1r90jgp",null,H,{hidden:!X()}),ze=Bt(Qe,1,"roll-result svelte-1r90jgp",null,ze,{"has-result":e(Y)})}),j("click",ve,G),j("click",ie,_e),j("click",se,vs(function(D){ka.call(this,c,D)})),j("keydown",se,function(D){ka.call(this,c,D)}),j("click",N,_e),j("keydown",N,D=>D.key==="Escape"&&_e()),o(n,N),bl(c,"getLastRollTotal",Me);var fe=qt(ne);return u(),fe}const za="https://api.github.com/gists";async function nr(n,c,t){if(!c)throw new Error("GitHub token is required");const v=JSON.stringify(n,null,2),u=`${n.name||"character"}_dnd.json`,f={description:t||`D&D Character: ${n.name}`,public:!1,files:{[u]:{content:v}}},p=await fetch(za,{method:"POST",headers:{Authorization:`token ${c}`,"Content-Type":"application/json"},body:JSON.stringify(f)});if(!p.ok)throw new Error(`Failed to create gist: ${p.statusText}`);return(await p.json()).id}async function ir(n,c,t){if(!c||!t)throw new Error("GitHub token and Gist ID are required");const v=JSON.stringify(n,null,2),f={files:{[`${n.name||"character"}_dnd.json`]:{content:v}}},p=await fetch(`${za}/${t}`,{method:"PATCH",headers:{Authorization:`token ${c}`,"Content-Type":"application/json"},body:JSON.stringify(f)});if(!p.ok)throw new Error(`Failed to update gist: ${p.statusText}`)}async function rr(n,c){if(!n)throw new Error("Gist ID is required");const t={"Content-Type":"application/json"};c&&(t.Authorization=`token ${c}`);const v=await fetch(`${za}/${n}`,{method:"GET",headers:t});if(!v.ok)throw new Error(`Failed to load gist: ${v.statusText}`);const u=await v.json(),f=Object.values(u.files);if(f.length===0)throw new Error("No files found in gist");const C=f[0].content;try{const h=JSON.parse(C);return h.attacks&&Array.isArray(h.attacks)&&(h.attacks=h.attacks.map(_=>({..._,id:_.id||crypto.randomUUID()}))),h.classFeatures?(h.classFeatures.features||(h.classFeatures.features={}),h.classFeatures.spellSlots||(h.classFeatures.spellSlots=[]),h.classFeatures.preparedSpells===void 0&&(h.classFeatures.preparedSpells="")):h.classFeatures={features:{},spellSlots:[],preparedSpells:""},h}catch{throw new Error("Invalid character data in gist")}}function Ss(n){typeof window<"u"&&localStorage.setItem("dnd_gist_config",JSON.stringify(n))}function or(){if(typeof window<"u"){const n=localStorage.getItem("dnd_gist_config");if(n)return JSON.parse(n)}return{}}async function cr(n,c=30){if(!n)throw new Error("GitHub token is required to list gists");const t=await fetch(`${za}?per_page=${c}`,{method:"GET",headers:{Authorization:`token ${n}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error(`Failed to list gists: ${t.statusText}`);return await t.json()}var vr=d('<div class="error-message svelte-1jb5ckg"> </div>'),dr=d('<div class="toggle-container svelte-1jb5ckg"><button type="button" class="toggle-btn svelte-1jb5ckg"> </button></div>'),ur=d('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID (leave empty to create new)</label> <input type="text" id="gistId" placeholder="Optional: existing Gist ID to update" class="svelte-1jb5ckg"/></div>'),fr=d('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),pr=d('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),mr=d('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Update (or leave unselected to create new)</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),gr=d('<div class="info-message svelte-1jb5ckg">No gists found. A new one will be created.</div>'),br=d('<!> <div class="form-group svelte-1jb5ckg"><label for="description" class="svelte-1jb5ckg"> </label> <input type="text" id="description" placeholder="D&amp;D Character Sheet" class="svelte-1jb5ckg"/></div>',1),hr=d('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID *</label> <input type="text" id="gistId" placeholder="Enter Gist ID (for public or your private gists)" required class="svelte-1jb5ckg"/></div>'),_r=d('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),yr=d('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),xr=d('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Load</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),$r=d('<div class="info-message svelte-1jb5ckg">No gists found. Enter a Gist ID manually or create a new one in Save mode.</div>'),wr=d('<div class="modal-overlay svelte-1jb5ckg" role="button" tabindex="-1"><div class="modal-content svelte-1jb5ckg" role="dialog" tabindex="0"><div class="modal-header svelte-1jb5ckg"><h2 class="svelte-1jb5ckg"> </h2> <button class="close-btn svelte-1jb5ckg">√ó</button></div> <div class="modal-body svelte-1jb5ckg"><!> <div class="form-group svelte-1jb5ckg"><label for="token" class="svelte-1jb5ckg"> <a href="https://github.com/settings/tokens" target="_blank" rel="noopener" class="svelte-1jb5ckg">Get token</a></label> <input type="password" id="token" placeholder="ghp_xxxxxxxxxxxxx" class="svelte-1jb5ckg"/></div> <!> <!> <div class="modal-actions svelte-1jb5ckg"><button class="btn btn-primary svelte-1jb5ckg"><!></button> <button class="btn btn-secondary svelte-1jb5ckg">Cancel</button></div></div></div></div>');function kr(n,c){Gt(c,!1);const t=()=>dt(ge,"$character",v),[v,u]=ra(),f=_a();let p=Ct(c,"mode",8,"save"),C=S(""),h=S(""),_=S(""),X=S(!1),P=S(""),oe=S(!1),ae=S(!1),W=S([]),z=S(null);const L=or();L.token&&r(C,L.token),L.gistId&&r(h,L.gistId),$a(async()=>{e(C)&&!e(oe)&&await A()});async function A(){if(e(C)){r(ae,!0),r(P,"");try{r(W,await cr(e(C))),e(h)&&r(z,e(W).find(y=>y.id===e(h))||null)}catch(y){r(P,y.message||"Failed to load gists"),r(W,[])}finally{r(ae,!1)}}}function O(y){r(z,y),r(h,y.id)}function Te(){r(oe,!e(oe)),r(P,""),!e(oe)&&e(C)&&A()}async function Re(){if(!e(C)){r(P,"GitHub token is required");return}const y=e(z)?.id||e(h);r(X,!0),r(P,"");try{if(y)await ir(t(),e(C),y),r(h,y),Nt.add("Character updated in Gist successfully!","success");else{const G=await nr(t(),e(C),e(_));r(h,G),Nt.add(`Character saved to Gist! ID: ${G}`,"success")}Ss({token:e(C),gistId:e(h)}),f("close")}catch(G){r(P,G.message||"Failed to save to Gist")}finally{r(X,!1)}}async function Y(){const y=e(z)?.id||e(h);if(!y){r(P,"Please select a gist or enter a Gist ID");return}r(X,!0),r(P,"");try{const G=await rr(y,e(C)||void 0);ge.set(G),r(h,y),Ss({token:e(C),gistId:e(h)}),Nt.add("Character loaded from Gist successfully!","success"),f("close")}catch(G){r(P,G.message||"Failed to load from Gist")}finally{r(X,!1)}}function Me(){f("close")}Ot();var me=wr(),be=l(me),Fe=l(be),F=l(Fe),I=l(F,!0);s(F);var x=a(F,2);s(Fe);var K=a(Fe,2),b=l(K);{var B=y=>{var G=vr(),re=l(G,!0);s(G),k(()=>$(re,e(P))),o(y,G)};g(b,y=>{e(P)&&y(B)})}var R=a(b,2),De=l(R),we=l(De);Qt(),s(De);var ue=a(De,2);Be(ue),s(R);var ce=a(R,2);{var ke=y=>{var G=dr(),re=l(G),_e=l(re,!0);s(re),s(G),k(()=>{re.disabled=e(X),$(_e,e(oe)?"üìã Show My Gists":"‚úèÔ∏è Enter Gist ID Manually")}),j("click",re,Te),o(y,G)};g(ce,y=>{(p()==="load"||p()==="save"&&e(C))&&y(ke)})}var Ge=a(ce,2);{var rt=y=>{var G=br(),re=je(G);{var _e=Pe=>{var Ae=ur(),Xe=a(l(Ae),2);Be(Xe),s(Ae),k(()=>Xe.disabled=e(X)),qe(Xe,()=>e(h),Se=>r(h,Se)),o(Pe,Ae)},ne=Pe=>{var Ae=bt(),Xe=je(Ae);{var Se=ve=>{var ie=fr();o(ve,ie)},m=ve=>{var ie=bt(),J=je(ie);{var Oe=Le=>{var Ue=mr(),de=a(l(Ue),2);yt(de,5,()=>e(W),kt,(Ee,ye)=>{var Qe=pr();let ze;var ot=l(Qe),vt=l(ot),fe=l(vt,!0);s(vt);var D=a(vt,2),q=l(D,!0);s(D),s(ot);var Z=a(ot,2),Q=l(Z),Ce=l(Q);s(Q);var We=a(Q,2),tt=l(We);s(We),s(Z),s(Qe),k(Ke=>{ze=Bt(Qe,1,"gist-item svelte-1jb5ckg",null,ze,{selected:e(z)?.id===e(ye).id}),Qe.disabled=e(X),$(fe,(e(ye),i(()=>e(ye).description||"Untitled"))),$(q,(e(ye),i(()=>e(ye).public?"üåê Public":"üîí Private"))),$(Ce,`ID: ${e(ye),i(()=>e(ye).id)??""}`),$(tt,`Updated: ${Ke??""}`)},[()=>(e(ye),i(()=>new Date(e(ye).updated_at).toLocaleDateString()))]),j("click",Qe,()=>O(e(ye))),o(Ee,Qe)}),s(de),s(Ue),o(Le,Ue)},Ie=Le=>{var Ue=bt(),de=je(Ue);{var Ee=ye=>{var Qe=gr();o(ye,Qe)};g(de,ye=>{e(C)&&ye(Ee)},!0)}o(Le,Ue)};g(J,Le=>{e(W),i(()=>e(W).length>0)?Le(Oe):Le(Ie,!1)},!0)}o(ve,ie)};g(Xe,ve=>{e(ae)?ve(Se):ve(m,!1)},!0)}o(Pe,Ae)};g(re,Pe=>{e(oe)||!e(C)?Pe(_e):Pe(ne,!1)})}var N=a(re,2),H=l(N),se=l(H);s(H);var T=a(H,2);Be(T),s(N),k(()=>{$(se,`Description ${e(h)?"(optional)":""}`),T.disabled=e(X)}),qe(T,()=>e(_),Pe=>r(_,Pe)),o(y,G)},mt=y=>{var G=bt(),re=je(G);{var _e=N=>{var H=hr(),se=a(l(H),2);Be(se),s(H),k(()=>se.disabled=e(X)),qe(se,()=>e(h),T=>r(h,T)),o(N,H)},ne=N=>{var H=bt(),se=je(H);{var T=Ae=>{var Xe=_r();o(Ae,Xe)},Pe=Ae=>{var Xe=bt(),Se=je(Xe);{var m=ie=>{var J=xr(),Oe=a(l(J),2);yt(Oe,5,()=>e(W),kt,(Ie,Le)=>{var Ue=yr();let de;var Ee=l(Ue),ye=l(Ee),Qe=l(ye,!0);s(ye);var ze=a(ye,2),ot=l(ze,!0);s(ze),s(Ee);var vt=a(Ee,2),fe=l(vt),D=l(fe);s(fe);var q=a(fe,2),Z=l(q);s(q),s(vt),s(Ue),k(Q=>{de=Bt(Ue,1,"gist-item svelte-1jb5ckg",null,de,{selected:e(z)?.id===e(Le).id}),Ue.disabled=e(X),$(Qe,(e(Le),i(()=>e(Le).description||"Untitled"))),$(ot,(e(Le),i(()=>e(Le).public?"üåê Public":"üîí Private"))),$(D,`ID: ${e(Le),i(()=>e(Le).id)??""}`),$(Z,`Updated: ${Q??""}`)},[()=>(e(Le),i(()=>new Date(e(Le).updated_at).toLocaleDateString()))]),j("click",Ue,()=>O(e(Le))),o(Ie,Ue)}),s(Oe),s(J),o(ie,J)},ve=ie=>{var J=bt(),Oe=je(J);{var Ie=Le=>{var Ue=$r();o(Le,Ue)};g(Oe,Le=>{e(C)&&Le(Ie)},!0)}o(ie,J)};g(Se,ie=>{e(W),i(()=>e(W).length>0)?ie(m):ie(ve,!1)},!0)}o(Ae,Xe)};g(se,Ae=>{e(ae)?Ae(T):Ae(Pe,!1)},!0)}o(N,H)};g(re,N=>{e(oe)||!e(C)?N(_e):N(ne,!1)},!0)}o(y,G)};g(Ge,y=>{p()==="save"?y(rt):y(mt,!1)})}var ct=a(Ge,2),Je=l(ct),w=l(Je);{var U=y=>{var G=Mt();k(()=>$(G,p()==="save"?"Saving...":"Loading...")),o(y,G)},he=y=>{var G=Mt();k(()=>$(G,p()==="save"?"Save":"Load")),o(y,G)};g(w,y=>{e(X)?y(U):y(he,!1)})}s(Je);var xe=a(Je,2);s(ct),s(K),s(be),s(me),k(()=>{$(I,p()==="save"?"Save to GitHub Gist":"Load from GitHub Gist"),$(we,`GitHub Token ${p()==="load"?"(optional for public gists)":"(required)"} `),ue.disabled=e(X),Je.disabled=e(X),xe.disabled=e(X)}),j("click",x,Me),qe(ue,()=>e(C),y=>r(C,y)),j("blur",ue,()=>{e(C)&&!e(oe)&&A()}),j("click",Je,function(...y){(p()==="save"?Re:Y)?.apply(this,y)}),j("click",xe,Me),j("click",be,vs(function(y){ka.call(this,c,y)})),j("keydown",be,function(y){ka.call(this,c,y)}),j("click",me,Me),j("keydown",me,y=>y.key==="Escape"&&Me()),o(n,me),qt(),u()}var Sr=d('<div class="loading svelte-1ngjemu">Loading D&D data...</div>'),Cr=d("<option> </option>"),Dr=d('<select class="level-filter svelte-1ngjemu"><option>All Levels</option><option>Cantrip</option><!></select>'),Lr=d('<div class="no-results svelte-1ngjemu"> </div>'),jr=d('<div class="item-meta svelte-1ngjemu"> </div>'),Ar=d('<div class="item-meta svelte-1ngjemu"> </div>'),Br=d('<button><div class="item-name svelte-1ngjemu"> </div> <!></button>'),Rr=d('<p class="higher-levels"><strong>At Higher Levels:</strong> </p>'),Tr=d('<p class="cantrip-upgrade"><strong>Cantrip Upgrade:</strong> </p>'),Mr=d('<h3 class="svelte-1ngjemu"> </h3> <p class="spell-meta svelte-1ngjemu"><!> <!></p> <p class="spell-classes"><strong>Classes:</strong> </p> <div class="spell-stats svelte-1ngjemu"><div><strong>Casting Time:</strong> </div> <div><strong>Range:</strong> </div> <div><strong>Components:</strong> <!></div> <div><strong>Duration:</strong> <!> </div></div> <p class="description svelte-1ngjemu"> </p> <!> <!>',1),Fr=d('<p class="prerequisite svelte-1ngjemu"><strong>Prerequisite:</strong> </p>'),Pr=d('<h3 class="svelte-1ngjemu"> </h3> <!> <p class="description svelte-1ngjemu"> </p> <a target="_blank" rel="noopener" class="source-link svelte-1ngjemu">View Full Details ‚Üí</a>',1),Ir=d('<div class="item-details svelte-1ngjemu"><!></div>'),Er=d('<div class="controls svelte-1ngjemu"><div class="tabs svelte-1ngjemu"><button> </button> <button> </button></div> <div class="search-controls svelte-1ngjemu"><input type="text" placeholder="Search by name or description..." class="search-input svelte-1ngjemu"/> <!></div></div> <div class="content-container svelte-1ngjemu"><div class="items-list svelte-1ngjemu"><!></div> <!></div>',1),Ur=d('<div class="modal-backdrop svelte-1ngjemu" role="presentation"><div class="modal svelte-1ngjemu" role="dialog" aria-modal="true" tabindex="-1"><div class="modal-header svelte-1ngjemu"><h2 class="svelte-1ngjemu">Browse D&D Spells & Feats</h2> <button class="close-btn svelte-1ngjemu" aria-label="Close">&times;</button></div> <div class="modal-body svelte-1ngjemu"><!></div> <div class="modal-footer svelte-1ngjemu"><button class="btn-secondary svelte-1ngjemu">Cancel</button> <button class="btn-primary svelte-1ngjemu">Add to Character Sheet</button></div></div></div>');function Hr(n,c){Gt(c,!1);const t=S(),v=S(),u=S();let f=Ct(c,"onClose",8),p=S("spell"),C=S(!0),h=S(""),_=S(null),X=S([]),P=S([]),oe=S(null);$a(async()=>{r(C,!0);try{r(X,await Fs()),r(P,await ln())}catch(x){console.error("Failed to load data:",x)}finally{r(C,!1)}});function ae(x){r(oe,x)}function W(x){const K=x.match(/(\d+d\d+(?:\s*\+\s*\d+)?)/i);return K?K[1]:""}function z(x){const K=x.split(/\.( |$)/)[0].trim(),b=Array.from(x.matchAll(/\*\*(.*?)\*\*/g)).map(R=>R[1].replace(/\.$/,""));let B=K;return b.length&&(B+=" | Effects: "+b.join(", ")),B}function L(){if(e(oe)){if(e(p)==="spell"){const x=e(oe);ge.update(K=>{const B=[];x.range&&B.push(`Range: ${x.range}`),x.castingTime&&B.push(`Cast: ${x.castingTime}`),x.duration&&B.push(`Duration: ${x.duration}`),x.actionType==="Save"&&B.push("Saving throw spell"),x.components&&x.components.length>0&&B.push(`Components: ${x.components.join(", ")}`),x.material&&B.push(`Material: ${x.material}`);const R=B.join(" | "),De=z(x.description),we={id:crypto.randomUUID(),name:`${x.name}${x.concentration?" (C)":""}${x.ritual?" (R)":""}`,bonus:x.actionType==="Attack"?5:0,damage:W(x.description),damageType:`${x.school} (Lvl ${x.level})`,spellRef:x.name,infoNotes:R,generalNotes:De,castAtLevel:x.level};return K.attacks=[...K.attacks,we],K})}else if(e(p)==="feat"){const x=e(oe);ge.update(K=>{const b=`${x.name}${x.prerequisite?` (Req: ${x.prerequisite})`:""}
${x.description}
`;return K.features=K.features?`${K.features}
${b}`:b,K})}r(oe,null),f()()}}et(()=>(e(_),e(X),e(h)),()=>{r(t,e(_)!==null?nn($s(e(X),e(h)),e(_)):$s(e(X),e(h)))}),et(()=>(e(P),e(h)),()=>{r(v,rn(e(P),e(h)))}),et(()=>(e(p),e(t),e(v)),()=>{r(u,e(p)==="spell"?e(t):e(v))}),ca(),Ot();var A=Ur(),O=l(A),Te=l(O),Re=a(l(Te),2);s(Te);var Y=a(Te,2),Me=l(Y);{var me=x=>{var K=Sr();o(x,K)},be=x=>{var K=Er(),b=je(K),B=l(b),R=l(B);let De;var we=l(R);s(R);var ue=a(R,2);let ce;var ke=l(ue);s(ue),s(B);var Ge=a(B,2),rt=l(Ge);Be(rt);var mt=a(rt,2);{var ct=re=>{var _e=Dr();k(()=>{e(_),Ht(()=>{})});var ne=l(_e);ne.value=(ne.__value=null)??"";var N=a(ne);N.value=N.__value=0;var H=a(N);yt(H,0,()=>[1,2,3,4,5,6,7,8,9],kt,(se,T)=>{var Pe=Cr(),Ae=l(Pe);s(Pe);var Xe={};k(()=>{$(Ae,`Level ${T??""}`),Xe!==(Xe=T)&&(Pe.value=(Pe.__value=T)??"")}),o(se,Pe)}),s(_e),Ta(_e,()=>e(_),se=>r(_,se)),o(re,_e)};g(mt,re=>{e(p)==="spell"&&re(ct)})}s(Ge),s(b);var Je=a(b,2),w=l(Je),U=l(w);{var he=re=>{var _e=Lr(),ne=l(_e);s(_e),k(()=>$(ne,`No ${e(p)??""}s found`)),o(re,_e)},xe=re=>{var _e=bt(),ne=je(_e);yt(ne,1,()=>e(u),kt,(N,H)=>{var se=Br();let T;var Pe=l(se),Ae=l(Pe,!0);s(Pe);var Xe=a(Pe,2);{var Se=ve=>{const ie=_t(()=>e(H));var J=jr(),Oe=l(J);s(J),k(()=>$(Oe,`Level ${ee(e(ie)),i(()=>e(ie).level)??""} ‚Ä¢ ${ee(e(ie)),i(()=>e(ie).school)??""}`)),o(ve,J)},m=ve=>{const ie=_t(()=>e(H));var J=bt(),Oe=je(J);{var Ie=Le=>{var Ue=Ar(),de=l(Ue,!0);s(Ue),k(()=>$(de,(ee(e(ie)),i(()=>e(ie).prerequisite)))),o(Le,Ue)};g(Oe,Le=>{ee(e(ie)),i(()=>e(ie).prerequisite)&&Le(Ie)})}o(ve,J)};g(Xe,ve=>{e(p)==="spell"?ve(Se):ve(m,!1)})}s(se),k(()=>{T=Bt(se,1,"item-card svelte-1ngjemu",null,T,{selected:e(oe)?.name===e(H).name}),$(Ae,(e(H),i(()=>e(H).name)))}),j("click",se,()=>ae(e(H))),o(N,se)}),o(re,_e)};g(U,re=>{e(u),i(()=>e(u).length===0)?re(he):re(xe,!1)})}s(w);var y=a(w,2);{var G=re=>{var _e=Ir(),ne=l(_e);{var N=se=>{const T=_t(()=>e(oe));var Pe=Mr(),Ae=je(Pe),Xe=l(Ae,!0);s(Ae);var Se=a(Ae,2),m=l(Se);{var ve=V=>{var Ne=Mt();k(()=>$(Ne,`${ee(e(T)),i(()=>e(T).school)??""} cantrip`)),o(V,Ne)},ie=V=>{var Ne=Mt();k(()=>$(Ne,`Level ${ee(e(T)),i(()=>e(T).level)??""} ${ee(e(T)),i(()=>e(T).school)??""}`)),o(V,Ne)};g(m,V=>{ee(e(T)),i(()=>e(T).level===0)?V(ve):V(ie,!1)})}var J=a(m,2);{var Oe=V=>{var Ne=Mt("(ritual)");o(V,Ne)};g(J,V=>{ee(e(T)),i(()=>e(T).ritual)&&V(Oe)})}s(Se);var Ie=a(Se,2),Le=a(l(Ie));s(Ie);var Ue=a(Ie,2),de=l(Ue),Ee=a(l(de));s(de);var ye=a(de,2),Qe=a(l(ye));s(ye);var ze=a(ye,2),ot=a(l(ze)),vt=a(ot);{var fe=V=>{var Ne=Mt();k(()=>$(Ne,`(${ee(e(T)),i(()=>e(T).material)??""})`)),o(V,Ne)};g(vt,V=>{ee(e(T)),i(()=>e(T).material)&&V(fe)})}s(ze);var D=a(ze,2),q=a(l(D),2);{var Z=V=>{var Ne=Mt("Concentration,");o(V,Ne)};g(q,V=>{ee(e(T)),i(()=>e(T).concentration)&&V(Z)})}var Q=a(q,1,!0);s(D),s(Ue);var Ce=a(Ue,2),We=l(Ce,!0);s(Ce);var tt=a(Ce,2);{var Ke=V=>{var Ne=Rr(),ut=a(l(Ne));s(Ne),k(()=>$(ut,` ${ee(e(T)),i(()=>e(T).higherLevelSlot)??""}`)),o(V,Ne)};g(tt,V=>{ee(e(T)),i(()=>e(T).higherLevelSlot)&&V(Ke)})}var Ye=a(tt,2);{var pe=V=>{var Ne=Tr(),ut=a(l(Ne));s(Ne),k(()=>$(ut,` ${ee(e(T)),i(()=>e(T).cantripUpgrade)??""}`)),o(V,Ne)};g(Ye,V=>{ee(e(T)),i(()=>e(T).cantripUpgrade)&&V(pe)})}k((V,Ne)=>{$(Xe,(ee(e(T)),i(()=>e(T).name))),$(Le,` ${V??""}`),$(Ee,` ${ee(e(T)),i(()=>e(T).castingTime||e(T).actionType)??""}`),$(Qe,` ${ee(e(T)),i(()=>e(T).range)??""}`),$(ot,` ${Ne??""}`),$(Q,(ee(e(T)),i(()=>e(T).duration))),$(We,(ee(e(T)),i(()=>e(T).description)))},[()=>(ee(e(T)),i(()=>e(T).classes.join(", "))),()=>(ee(e(T)),i(()=>e(T).components.join(", ").toUpperCase()))]),o(se,Pe)},H=se=>{const T=_t(()=>e(oe));var Pe=Pr(),Ae=je(Pe),Xe=l(Ae,!0);s(Ae);var Se=a(Ae,2);{var m=Oe=>{var Ie=Fr(),Le=a(l(Ie));s(Ie),k(()=>$(Le,` ${ee(e(T)),i(()=>e(T).prerequisite)??""}`)),o(Oe,Ie)};g(Se,Oe=>{ee(e(T)),i(()=>e(T).prerequisite)&&Oe(m)})}var ve=a(Se,2),ie=l(ve,!0);s(ve);var J=a(ve,2);k(()=>{$(Xe,(ee(e(T)),i(()=>e(T).name))),$(ie,(ee(e(T)),i(()=>e(T).description))),lt(J,"href",(ee(e(T)),i(()=>e(T).source)))}),o(se,Pe)};g(ne,se=>{e(p)==="spell"?se(N):se(H,!1)})}s(_e),o(re,_e)};g(y,re=>{e(oe)&&re(G)})}s(Je),k(()=>{De=Bt(R,1,"tab svelte-1ngjemu",null,De,{active:e(p)==="spell"}),$(we,`üìú Spells (${e(X),i(()=>e(X).length)??""})`),ce=Bt(ue,1,"tab svelte-1ngjemu",null,ce,{active:e(p)==="feat"}),$(ke,`‚≠ê Feats (${e(P),i(()=>e(P).length)??""})`)}),j("click",R,()=>{r(p,"spell"),r(oe,null),r(h,"")}),j("click",ue,()=>{r(p,"feat"),r(oe,null),r(h,"")}),qe(rt,()=>e(h),re=>r(h,re)),o(x,K)};g(Me,x=>{e(C)?x(me):x(be,!1)})}s(Y);var Fe=a(Y,2),F=l(Fe),I=a(F,2);s(Fe),s(O),s(A),k(()=>I.disabled=!e(oe)),j("click",Re,function(...x){f()?.apply(this,x)}),j("click",F,function(...x){f()?.apply(this,x)}),j("click",I,L),j("click",O,vs(function(x){ka.call(this,c,x)})),j("keydown",O,function(x){ka.call(this,c,x)}),j("click",A,function(...x){f()?.apply(this,x)}),j("keydown",A,x=>x.key==="Escape"&&f()()),o(n,A),qt()}var Nr=d('<span class="resistance-tag svelte-gdwwx1"> <button type="button" class="tag-remove svelte-gdwwx1">√ó</button></span>'),Or=d('<div class="resistance-list svelte-gdwwx1"></div>'),Gr=d('<p class="ability-meta svelte-gdwwx1"> <!></p>'),qr=d('<p class="ability-meta svelte-gdwwx1">Requires Reaction</p>'),zr=d('<div class="ability-card svelte-gdwwx1"><div class="ability-header svelte-gdwwx1"><strong class="svelte-gdwwx1"> </strong> <button type="button" class="ability-remove svelte-gdwwx1">√ó</button></div> <p class="ability-description svelte-gdwwx1"> </p> <!></div>'),Wr=d('<div class="abilities-list svelte-gdwwx1"></div>'),Kr=d(`<div class="modal-backdrop svelte-gdwwx1" role="presentation"><div class="modal-content svelte-gdwwx1" role="dialog" aria-modal="true" aria-labelledby="modal-title"><div class="modal-header svelte-gdwwx1"><h3 id="modal-title" class="svelte-gdwwx1">Add Custom Condition</h3> <button class="btn-close svelte-gdwwx1" aria-label="Close">√ó</button></div> <div class="modal-body svelte-gdwwx1"><div class="form-group svelte-gdwwx1"><label for="conditionName" class="svelte-gdwwx1">Condition Name*</label> <input type="text" id="conditionName" placeholder="e.g., Cazna's Mark" class="svelte-gdwwx1"/></div> <div class="form-group svelte-gdwwx1"><label for="description" class="svelte-gdwwx1">Description</label> <textarea id="description" placeholder="Describe the condition..." rows="3" class="svelte-gdwwx1"></textarea></div> <div class="form-row svelte-gdwwx1"><div class="form-group svelte-gdwwx1"><label for="attackBonus" class="svelte-gdwwx1">Attack Bonus</label> <input type="text" id="attackBonus" placeholder="0 or 1d4" class="svelte-gdwwx1"/></div> <div class="form-group svelte-gdwwx1"><label for="damageBonus" class="svelte-gdwwx1">Damage Bonus</label> <input type="text" id="damageBonus" placeholder="0 or 1d6" class="svelte-gdwwx1"/></div> <div class="form-group svelte-gdwwx1"><label for="acBonus" class="svelte-gdwwx1">AC Bonus</label> <input type="number" id="acBonus" placeholder="0" class="svelte-gdwwx1"/></div></div> <div class="form-group svelte-gdwwx1"><label for="darkvision" class="svelte-gdwwx1">Darkvision (feet)</label> <input type="number" id="darkvision" placeholder="0" min="0" step="30" class="svelte-gdwwx1"/> <small class="help-text svelte-gdwwx1">Grant or extend darkvision (e.g., 60 for 60 feet)</small></div> <div class="form-group svelte-gdwwx1"><label class="svelte-gdwwx1">Damage Resistances</label> <div class="resistance-input-group svelte-gdwwx1"><input type="text" placeholder="e.g., cold, fire, poison" class="svelte-gdwwx1"/> <button type="button" class="btn-add svelte-gdwwx1">Add</button></div> <!></div> <div class="form-group svelte-gdwwx1"><label class="svelte-gdwwx1">Special Abilities</label> <div class="ability-form svelte-gdwwx1"><input type="text" placeholder="Ability name (e.g., Flicker of Deceit)" class="ability-name-input svelte-gdwwx1"/> <textarea placeholder="Ability description..." rows="2" class="ability-desc-input svelte-gdwwx1"></textarea> <div class="ability-options svelte-gdwwx1"><div class="ability-option svelte-gdwwx1"><label for="abilityUses" class="svelte-gdwwx1">Uses per rest</label> <input type="number" id="abilityUses" min="0" class="svelte-gdwwx1"/></div> <div class="ability-option svelte-gdwwx1"><label for="restType" class="svelte-gdwwx1">Rest type</label> <select id="restType" class="svelte-gdwwx1"><option>Short</option><option>Long</option></select></div> <div class="ability-option svelte-gdwwx1"><label class="svelte-gdwwx1"><input type="checkbox" class="svelte-gdwwx1"/> Requires Reaction</label></div></div> <button type="button" class="btn-add svelte-gdwwx1">Add Ability</button></div> <!></div></div> <div class="modal-footer svelte-gdwwx1"><button class="btn btn-secondary svelte-gdwwx1">Cancel</button> <button class="btn btn-primary svelte-gdwwx1">Add Condition</button></div></div></div>`);function Vr(n,c){Gt(c,!1);let t=Ct(c,"show",8,!1),v=Ct(c,"onSave",8),u=Ct(c,"onCancel",8),f=S(""),p=S(""),C=S(0),h=S(0),_=S(0),X=S(0),P=S([]),oe=S(""),ae=S([]),W=S(""),z=S(""),L=S(0),A=S("short"),O=S(!1);function Te(){r(f,""),r(p,""),r(C,0),r(h,0),r(_,0),r(X,0),r(P,[]),r(oe,""),r(ae,[]),r(W,""),r(z,""),r(L,0),r(A,"short"),r(O,!1)}function Re(){e(oe).trim()&&(r(P,[...e(P),e(oe).trim()]),r(oe,""))}function Y(b){r(P,e(P).filter((B,R)=>R!==b))}function Me(){if(e(W).trim()&&e(z).trim()){const b={name:e(W).trim(),description:e(z).trim(),requiresReaction:e(O)};e(L)>0&&(b.usesPerRest=e(L),b.currentUses=e(L),b.restType=e(A)),r(ae,[...e(ae),b]),r(W,""),r(z,""),r(L,0),r(A,"short"),r(O,!1)}}function me(b){r(ae,e(ae).filter((B,R)=>R!==b))}function be(){if(!e(f).trim()){alert("Please enter a condition name");return}const b={name:e(f).trim(),description:e(p).trim()||"Custom condition",attackBonus:e(C)||0,damageBonus:e(h)||0,target:"self"};e(_)!==0&&(b.acBonus=e(_)),e(X)>0&&(b.darkvision=e(X)),e(P).length>0&&(b.resistances=e(P)),e(ae).length>0&&(b.abilities=e(ae)),v()(b),Te()}function Fe(){Te(),u()()}function F(b){b.target===b.currentTarget&&Fe()}Ot();var I=bt(),x=je(I);{var K=b=>{var B=Kr(),R=l(B),De=l(R),we=a(l(De),2);s(De);var ue=a(De,2),ce=l(ue),ke=a(l(ce),2);Be(ke),s(ce);var Ge=a(ce,2),rt=a(l(Ge),2);xa(rt),s(Ge);var mt=a(Ge,2),ct=l(mt),Je=a(l(ct),2);Be(Je),s(ct);var w=a(ct,2),U=a(l(w),2);Be(U),s(w);var he=a(w,2),xe=a(l(he),2);Be(xe),s(he),s(mt);var y=a(mt,2),G=a(l(y),2);Be(G),Qt(2),s(y);var re=a(y,2),_e=a(l(re),2),ne=l(_e);Be(ne);var N=a(ne,2);s(_e);var H=a(_e,2);{var se=fe=>{var D=Or();yt(D,5,()=>e(P),kt,(q,Z,Q)=>{var Ce=Nr(),We=l(Ce),tt=a(We);s(Ce),k(()=>{$(We,`${e(Z)??""} `),lt(tt,"aria-label",`Remove ${e(Z)??""}`)}),j("click",tt,()=>Y(Q)),o(q,Ce)}),s(D),o(fe,D)};g(H,fe=>{e(P),i(()=>e(P).length>0)&&fe(se)})}s(re);var T=a(re,2),Pe=a(l(T),2),Ae=l(Pe);Be(Ae);var Xe=a(Ae,2);xa(Xe);var Se=a(Xe,2),m=l(Se),ve=a(l(m),2);Be(ve),s(m);var ie=a(m,2),J=a(l(ie),2);k(()=>{e(A),Ht(()=>{})});var Oe=l(J);Oe.value=Oe.__value="short";var Ie=a(Oe);Ie.value=Ie.__value="long",s(J),s(ie);var Le=a(ie,2),Ue=l(Le),de=l(Ue);Be(de),Qt(),s(Ue),s(Le),s(Se);var Ee=a(Se,2);s(Pe);var ye=a(Pe,2);{var Qe=fe=>{var D=Wr();yt(D,5,()=>e(ae),kt,(q,Z,Q)=>{var Ce=zr(),We=l(Ce),tt=l(We),Ke=l(tt,!0);s(tt);var Ye=a(tt,2);s(We);var pe=a(We,2),V=l(pe,!0);s(pe);var Ne=a(pe,2);{var ut=at=>{var le=Gr(),Dt=l(le),E=a(Dt);{var Ve=te=>{var He=Mt("‚Ä¢ Requires Reaction");o(te,He)};g(E,te=>{e(Z),i(()=>e(Z).requiresReaction)&&te(Ve)})}s(le),k(()=>$(Dt,`${e(Z),i(()=>e(Z).usesPerRest)??""} use${e(Z),i(()=>e(Z).usesPerRest>1?"s":"")??""} per ${e(Z),i(()=>e(Z).restType)??""}
                      rest `)),o(at,le)},Ze=at=>{var le=bt(),Dt=je(le);{var E=Ve=>{var te=qr();o(Ve,te)};g(Dt,Ve=>{e(Z),i(()=>e(Z).requiresReaction)&&Ve(E)},!0)}o(at,le)};g(Ne,at=>{e(Z),i(()=>e(Z).usesPerRest)?at(ut):at(Ze,!1)})}s(Ce),k(()=>{$(Ke,(e(Z),i(()=>e(Z).name))),lt(Ye,"aria-label",`Remove ${e(Z),i(()=>e(Z).name)??""}`),$(V,(e(Z),i(()=>e(Z).description)))}),j("click",Ye,()=>me(Q)),o(q,Ce)}),s(D),o(fe,D)};g(ye,fe=>{e(ae),i(()=>e(ae).length>0)&&fe(Qe)})}s(T),s(ue);var ze=a(ue,2),ot=l(ze),vt=a(ot,2);s(ze),s(R),s(B),j("click",we,Fe),qe(ke,()=>e(f),fe=>r(f,fe)),qe(rt,()=>e(p),fe=>r(p,fe)),qe(Je,()=>e(C),fe=>r(C,fe)),qe(U,()=>e(h),fe=>r(h,fe)),qe(xe,()=>e(_),fe=>r(_,fe)),qe(G,()=>e(X),fe=>r(X,fe)),qe(ne,()=>e(oe),fe=>r(oe,fe)),j("keydown",ne,fe=>fe.key==="Enter"&&Re()),j("click",N,Re),qe(Ae,()=>e(W),fe=>r(W,fe)),qe(Xe,()=>e(z),fe=>r(z,fe)),qe(ve,()=>e(L),fe=>r(L,fe)),Ta(J,()=>e(A),fe=>r(A,fe)),wa(de,()=>e(O),fe=>r(O,fe)),j("click",Ee,Me),j("click",ot,Fe),j("click",vt,be),j("click",B,F),o(b,B)};g(x,b=>{t()&&b(K)})}o(n,I),qt()}var Jr=d("<option></option>"),Yr=d("<button> </button>"),Qr=d('<button class="btn btn-primary calculate-btn use-enabled svelte-uvfntf">Calculate Damage</button>'),Xr=d('<div class="adjustment-msg svelte-uvfntf"> </div>'),Zr=d('<div class="calculation-result svelte-uvfntf"><div class="result-header svelte-uvfntf"><h4 class="svelte-uvfntf">Damage Calculation</h4></div> <div class="result-content svelte-uvfntf"><div class="damage-breakdown svelte-uvfntf"><div class="damage-row svelte-uvfntf"><span class="label svelte-uvfntf">Original Damage:</span> <span class="value svelte-uvfntf"> </span></div> <div class="adjustments svelte-uvfntf"></div> <div class="damage-row final svelte-uvfntf"><span class="label svelte-uvfntf">Final Damage:</span> <span class="value damage-value svelte-uvfntf"> </span></div></div></div> <div class="result-actions svelte-uvfntf"><button class="btn btn-primary apply-btn use-enabled svelte-uvfntf">Apply Damage</button> <button class="btn btn-secondary cancel-btn use-enabled svelte-uvfntf">Cancel</button></div></div>'),eo=d('<div class="damage-form svelte-uvfntf"><div class="input-group svelte-uvfntf"><div class="input-field svelte-uvfntf"><label for="damageAmount" class="svelte-uvfntf">Damage Amount</label> <input type="number" id="damageAmount" min="0" placeholder="0" class="damage-input-field use-enabled svelte-uvfntf"/></div> <div class="input-field svelte-uvfntf"><label for="damageType" class="svelte-uvfntf">Damage Type</label> <input type="text" id="damageType" list="damageTypes" placeholder="e.g., fire, cold" class="damage-input-field use-enabled svelte-uvfntf"/> <datalist id="damageTypes"></datalist></div></div> <div class="quick-types svelte-uvfntf"><span class="quick-types-label svelte-uvfntf">Quick Select:</span> <!></div> <!></div>'),to=d("<section><!> <!></section>");function ao(n,c){Gt(c,!1);const t=()=>dt(ge,"$character",f),v=()=>dt(ga,"$searchFilter",f),u=()=>dt(Xt,"$collapsedStates",f),[f,p]=ra(),C=S();_a();let h=S(0),_=S(""),X=S(!1),P=S(0),oe=S([]);const ae=["slashing","piercing","bludgeoning","fire","cold","lightning","thunder","acid","poison","necrotic","radiant","psychic","force"];function W(){if(e(h)<0){Nt.add("Damage amount cannot be negative","error");return}if(!e(_).trim()){Nt.add("Please enter or select a damage type","error");return}const Me=Pl(e(h),e(_),t());r(P,Me.finalDamage),r(oe,Me.adjustments),r(X,!0)}function z(){ge.update(Me=>Il(Me,e(P))),Nt.add(`Applied ${e(P)} damage to character (${e(_)})`,"info"),r(h,0),r(_,""),r(X,!1),r(P,0),r(oe,[])}function L(){r(X,!1),r(P,0),r(oe,[])}et(()=>v(),()=>{r(C,!v()||"damage".includes(v().toLowerCase())||"resistance".includes(v().toLowerCase())||"immune".includes(v().toLowerCase()))}),ca(),Ot();var A=to();let O;var Te=l(A);{let Me=_t(()=>(u(),i(()=>u().damageInput?"Expand":"Collapse")));ya(Te,{title:"Apply Damage",get collapsed(){return u(),i(()=>u().damageInput)},get ariaLabel(){return e(Me)},onToggle:()=>Xt.update(me=>({...me,damageInput:!me.damageInput}))})}var Re=a(Te,2);{var Y=Me=>{var me=eo(),be=l(me),Fe=l(be),F=a(l(Fe),2);Be(F),s(Fe);var I=a(Fe,2),x=a(l(I),2);Be(x);var K=a(x,2);yt(K,5,()=>ae,kt,(ue,ce)=>{var ke=Jr(),Ge={};k(()=>{Ge!==(Ge=e(ce))&&(ke.value=(ke.__value=e(ce))??"")}),o(ue,ke)}),s(K),s(I),s(be);var b=a(be,2),B=a(l(b),2);yt(B,1,()=>ae,kt,(ue,ce)=>{var ke=Yr();let Ge;var rt=l(ke,!0);s(ke),k(()=>{Ge=Bt(ke,1,"quick-type-btn use-enabled svelte-uvfntf",null,Ge,{active:e(_)===e(ce)}),$(rt,e(ce))}),j("click",ke,()=>r(_,e(ce))),o(ue,ke)}),s(b);var R=a(b,2);{var De=ue=>{var ce=Qr();j("click",ce,W),o(ue,ce)},we=ue=>{var ce=Zr(),ke=a(l(ce),2),Ge=l(ke),rt=l(Ge),mt=a(l(rt),2),ct=l(mt);s(mt),s(rt);var Je=a(rt,2);yt(Je,5,()=>e(oe),kt,(re,_e)=>{var ne=Xr(),N=l(ne,!0);s(ne),k(()=>$(N,e(_e))),o(re,ne)}),s(Je);var w=a(Je,2),U=a(l(w),2),he=l(U,!0);s(U),s(w),s(Ge),s(ke);var xe=a(ke,2),y=l(xe),G=a(y,2);s(xe),s(ce),k(()=>{$(ct,`${e(h)??""} ${e(_)??""}`),$(he,e(P))}),j("click",y,z),j("click",G,L),o(ue,ce)};g(R,ue=>{e(X)?ue(we,!1):ue(De)})}s(me),qe(F,()=>e(h),ue=>r(h,ue)),qe(x,()=>e(_),ue=>r(_,ue)),o(Me,me)};g(Re,Me=>{u(),i(()=>!u().damageInput)&&Me(Y)})}s(A),k(()=>O=Bt(A,1,"damage-input svelte-uvfntf",null,O,{hidden:!e(C)})),o(n,A),qt(),p()}var so=d('<button class="console-toggle svelte-x96uf"> </button>'),lo=d('<div class="no-logs svelte-x96uf">No console messages yet</div>'),no=d('<div><span class="log-timestamp svelte-x96uf"> </span> <span class="log-type svelte-x96uf"> </span> <span class="log-message svelte-x96uf"> </span></div>'),io=d('<div class="console-content svelte-x96uf"><!></div>'),ro=d('<div><div class="console-header svelte-x96uf"><span class="console-title svelte-x96uf"> </span> <div class="console-controls svelte-x96uf"><button class="control-btn svelte-x96uf"> </button> <button class="control-btn svelte-x96uf">üóëÔ∏è</button> <button class="control-btn svelte-x96uf">‚úï</button></div></div> <!></div>'),oo=d('<div class="console-viewer svelte-x96uf"><!> <!></div>');function co(n,c){Gt(c,!1);let t=S([]),v=S(!1),u=S(!1);$a(()=>{const W=console.log;console.log=function(...O){f("log",O),W.apply(console,O)};const z=console.error;console.error=function(...O){f("error",O),z.apply(console,O)};const L=console.warn;console.warn=function(...O){f("warn",O),L.apply(console,O)};const A=console.info;return console.info=function(...O){f("info",O),A.apply(console,O)},window.addEventListener("error",O=>{f("error",[`Uncaught Error: ${O.message} at ${O.filename}:${O.lineno}:${O.colno}`])}),window.addEventListener("unhandledrejection",O=>{f("error",[`Unhandled Promise Rejection: ${O.reason}`])}),()=>{console.log=W,console.error=z,console.warn=L,console.info=A}});function f(W,z){const L=z.map(O=>{if(typeof O=="object")try{return JSON.stringify(O,null,2)}catch{return String(O)}return String(O)}).join(" "),A=new Date().toLocaleTimeString();r(t,[...e(t),{type:W,message:L,timestamp:A}]),e(t).length>100&&r(t,e(t).slice(-100))}function p(){r(t,[])}function C(){r(v,!e(v))}function h(){r(u,!e(u))}Ot();var _=oo(),X=l(_);{var P=W=>{var z=so(),L=l(z);s(z),k(()=>$(L,`üêõ Console (${e(t).length??""})`)),j("click",z,C),o(W,z)};g(X,W=>{e(v)||W(P)})}var oe=a(X,2);{var ae=W=>{var z=ro();let L;var A=l(z),O=l(A),Te=l(O);s(O);var Re=a(O,2),Y=l(Re),Me=l(Y,!0);s(Y);var me=a(Y,2),be=a(me,2);s(Re),s(A);var Fe=a(A,2);{var F=I=>{var x=io(),K=l(x);{var b=R=>{var De=lo();o(R,De)},B=R=>{var De=bt(),we=je(De);yt(we,1,()=>e(t),kt,(ue,ce)=>{var ke=no(),Ge=l(ke),rt=l(Ge,!0);s(Ge);var mt=a(Ge,2),ct=l(mt);s(mt);var Je=a(mt,2),w=l(Je,!0);s(Je),s(ke),k(U=>{Bt(ke,1,`log-entry ${e(ce).type??""}`,"svelte-x96uf"),$(rt,e(ce).timestamp),$(ct,`[${U??""}]`),$(w,e(ce).message)},[()=>e(ce).type.toUpperCase()]),o(ue,ke)}),o(R,De)};g(K,R=>{e(t).length===0?R(b):R(B,!1)})}s(x),o(I,x)};g(Fe,I=>{e(u)||I(F)})}s(z),k(()=>{L=Bt(z,1,"console-panel svelte-x96uf",null,L,{minimized:e(u)}),$(Te,`üêõ Console Logs (${e(t).length??""})`),$(Me,e(u)?"‚ñ≤":"‚ñº")}),j("click",Y,h),j("click",me,p),j("click",be,C),o(W,z)};g(oe,W=>{e(v)&&W(ae)})}s(_),o(n,_),qt()}var vo=d('<link rel="icon" type="image/png" href="favicon4.png"/> <meta name="viewport" content="width=device-width, initial-scale=1"/>',1),uo=d('<span class="character-name svelte-1uha8ag"> </span>'),fo=d("<span> </span>"),po=d('<div class="spell-slots-header svelte-1uha8ag"></div>'),mo=d("<span> </span><br/>",1),go=d("<span> </span><br/>",1),bo=d("<span> </span><br/>",1),ho=d("<span> </span><br/>",1),_o=d("<span> </span><br/>",1),yo=d("<span> </span><br/>",1),xo=d("<br/><em> <!>)</em>",1),$o=d("<br/><em>(requires reaction)</em>",1),wo=d('<div class="ability-detail"><strong> </strong> <!></div>'),ko=d('<div class="abilities-section"><strong>Abilities:</strong><br/> <!></div>'),So=d('<span class="effect-tooltip"><strong> </strong><br/> <br/> <!> <!> <!> <!> <!> <!> <!></span>'),Co=d('<button class="effect-remove-btn svelte-1uha8ag">√ó</button>'),Do=d('<span class="effect-badge svelte-1uha8ag" tabindex="0"> <!> <!></span>'),Lo=d(`<div class="active-effects-header svelte-1uha8ag"></div> <style>.effect-badge {
              position: relative;
            }
            .effect-tooltip {
              position: absolute;
              top: 120%;
              left: 50%;
              transform: translateX(-50%);
              background: #fff;
              color: #222;
              border: 1px solid #a5b4fc;
              border-radius: 6px;
              padding: 8px 12px;
              font-size: 0.95em;
              box-shadow: 0 2px 8px rgba(0, 0, 0, 0.12);
              z-index: 10;
              min-width: 180px;
              max-width: 300px;
              white-space: normal;
              pointer-events: none;
              opacity: 1;
              transition: opacity 0.15s;
            }

            .abilities-section {
              margin-top: 8px;
              padding-top: 8px;
              border-top: 1px solid #e5e7eb;
            }

            .ability-detail {
              margin-top: 6px;
              padding: 4px;
              background: #f9fafb;
              border-radius: 4px;
              font-size: 0.9em;
            }

            .ability-detail strong {
              color: #6366f1;
            }

            .ability-detail em {
              font-size: 0.85em;
              color: #6b7280;
            }</style>`,1),jo=d('<div class="rest-menu svelte-1uha8ag"><button class="rest-option svelte-1uha8ag">‚òï Short Rest</button> <button class="rest-option svelte-1uha8ag">üõèÔ∏è Long Rest</button></div>'),Ao=d('<div class="container svelte-1uha8ag"><header class="svelte-1uha8ag"><div class="header-top svelte-1uha8ag"><div class="header-title svelte-1uha8ag"><div class="title-row svelte-1uha8ag"><h1 class="svelte-1uha8ag">D&D Character Sheet</h1> <!></div> <!> <!></div> <div class="header-right svelte-1uha8ag"><div class="header-controls svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">üé≤</span><span class="btn-text svelte-1uha8ag">Roll Dice</span></button> <div class="rest-button-container svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">üò¥</span><span class="btn-text svelte-1uha8ag">Rest</span></button> <!></div> <button class="btn btn-secondary use-enabled" title="Add custom condition with effects"><span class="btn-icon svelte-1uha8ag">‚ú®</span><span class="btn-text svelte-1uha8ag">Add Condition</span></button> <div class="mode-toggle"><button><span class="btn-icon svelte-1uha8ag"> </span><span class="btn-text svelte-1uha8ag"> </span></button></div></div> <div class="header-search svelte-1uha8ag"><input type="text" placeholder="üîç Search..." class="search-input use-enabled svelte-1uha8ag"/></div></div></div> <div class="header-actions svelte-1uha8ag"><button class="btn btn-mode svelte-1uha8ag">üìö Browse Spells & Feats</button> <button class="btn btn-secondary">Save to Gist</button> <button class="btn btn-secondary">Load from Gist</button> <button class="btn btn-secondary">Export JSON</button> <button class="btn btn-secondary">Import JSON</button> <input type="file" accept=".json" style="display: none;"/></div></header> <main class="svelte-1uha8ag"><!> <!> <!> <!> <!> <!> <!> <!></main></div> <!> <!> <!> <!> <!> <!>',1);function Uo(n,c){Gt(c,!1);const t=()=>dt(ge,"$character",f),v=()=>dt(ma,"$isEditMode",f),u=()=>dt(ga,"$searchFilter",f),[f,p]=ra();function C(){const E=[],Ve=t().classFeatures.spellSlotsByLevel||{};for(let te=1;te<=9;te++){const He=Ve[te];if(He&&He.length>0){const M=He.length,xt=He.filter(ht=>ht).length;E.push({level:te,available:M-xt,total:M})}}return E}let h=S(!1),_=S(!1),X=S(!1),P=S(!1),oe=S("save"),ae=S(void 0),W=S(""),z=S(""),L=S(""),A=S(!1),O=S([]),Te=S("other"),Re=S(),Y=!1,Me=1,me=S(!1),be=S(null);function Fe(E){r(be,E)}function F(){r(be,null)}function I(E){r(be,e(be)===E?null:E)}function x(E){ge.update(Ve=>(Ve.activeStates||(Ve.activeStates=[]),Ve.activeStates=[...Ve.activeStates,E],Ve)),r(P,!1),Nt.add(`Added condition: ${E.name}`,"success")}function K(){r(P,!1)}function b(){const E=[];ge.update(M=>{const xt=M.hitDice.current;M.hitDice.current=Math.min(M.hitDice.max,M.hitDice.current+Math.max(1,Math.floor(M.hitDice.max/2)));const ht=M.hitDice.current-xt;if(ht>0&&E.push(`${ht} hit ${ht===1?"die":"dice"}`),M.class){const st=Sa(M.class,M.level,M.subclass);M.classFeatures.features||(M.classFeatures.features={}),st.forEach($e=>{if($e.resetOn==="short"){const ft=$e.name.replace(/\s+/g,"");if($e.type==="uses"){const nt=typeof $e.maxUses=="function"?$e.maxUses(M.level):$e.maxUses;M.classFeatures.features[ft]=Array(nt).fill(!1),E.push($e.name)}else if($e.type==="pool"){const nt=typeof $e.maxPool=="function"?$e.maxPool(M.level):$e.maxPool;nt!==void 0&&(M.classFeatures.features[ft]=nt,E.push($e.name))}}})}return M.activeStates&&M.activeStates.forEach(st=>{st.abilities&&st.abilities.forEach($e=>{if($e.restType==="short"&&$e.usesPerRest){const ft=$e.usesPerRest-($e.currentUses||0)>0;$e.currentUses=$e.usesPerRest,ft&&E.push(`${st.name}: ${$e.name}`)}})}),M}),ms("short"),ss(t().race,t().level).some(M=>M.restType==="short"&&M.usesPerRest)&&E.push("racial traits"),r(me,!1);const He=E.length>0?`Short rest taken! Restored: ${E.join(", ")}`:"Short rest taken!";Nt.add(He,"success")}function B(){const E=[];ge.update(M=>{const xt=M.maxHP-M.currentHP;xt>0&&E.push(`${xt} HP`),M.currentHP=M.maxHP,M.tempHP=0;const ht=M.hitDice.max-M.hitDice.current;ht>0&&E.push(`${ht} hit ${ht===1?"die":"dice"}`),M.hitDice.current=M.hitDice.max;let st=0;if(M.classFeatures.spellSlotsByLevel&&Object.keys(M.classFeatures.spellSlotsByLevel).forEach($e=>{const ft=M.classFeatures.spellSlotsByLevel[parseInt($e)];if(ft){const nt=ft.filter(Rt=>Rt).length;st+=nt,M.classFeatures.spellSlotsByLevel[parseInt($e)]=Array(ft.length).fill(!1)}}),st>0&&E.push(`${st} spell ${st===1?"slot":"slots"}`),M.class){const $e=Sa(M.class,M.level,M.subclass);M.classFeatures.features||(M.classFeatures.features={});let ft=!1;$e.forEach(nt=>{const Rt=nt.name.replace(/\s+/g,"");if(!(nt.type==="info"||nt.type==="channelDivinity")){if(nt.type==="uses"){const it=typeof nt.maxUses=="function"?nt.maxUses(M.level):nt.maxUses;M.classFeatures.features[Rt]=Array(it).fill(!1),ft=!0}else if(nt.type==="pool"){const it=typeof nt.maxPool=="function"?nt.maxPool(M.level):nt.maxPool;it!==void 0&&(M.classFeatures.features[Rt]=it,ft=!0)}}}),ft&&E.push("all class features")}if(M.activeStates){let $e=!1;M.activeStates.forEach(ft=>{ft.abilities&&ft.abilities.forEach(nt=>{if(nt.usesPerRest){const Rt=(nt.currentUses||0)<nt.usesPerRest;nt.currentUses=nt.usesPerRest,Rt&&($e=!0)}})}),$e&&E.push("condition abilities")}return M}),ms("long"),ss(t().race,t().level).some(M=>M.usesPerRest)&&E.push("racial traits"),r(me,!1);const He=E.length>0?`Long rest taken! Restored: ${E.join(", ")}`:"Long rest taken! Fully rested.";Nt.add(He,"success")}function R(E){r(W,""),r(z,""),r(L,""),r(A,!1),r(O,[]),r(Te,"other"),Y=!1,typeof E=="string"?r(W,E):(r(W,E.notation),r(z,E.damageNotation||""),r(L,E.attackName||""),r(A,!!E.applyHalfDamage),r(O,E.bonusBreakdown||[]),r(Te,E.rollType||"other")),r(h,!0)}function De(E){const{notation:Ve,count:te,bonusBreakdown:He}=E.detail;r(W,""),Y=!0,Me=te||1,setTimeout(()=>{r(W,Ve),r(z,""),r(L,"Hit Die"),r(O,He||[]),r(Te,"other")},0),r(h,!0)}function we(){if(r(h,!1),Y&&e(Re)){const E=e(Re).getLastRollTotal();if(E!==null){const Ve=Math.max(1,E);ge.update(te=>(te.hitDice.current=Math.max(0,te.hitDice.current-Me),te.currentHP=Math.min(te.maxHP,te.currentHP+Ve),te))}Y=!1}}function ue(){ma.update(E=>!E)}function ce(E){E.target.closest(".rest-button-container")||r(me,!1)}$a(()=>{const E=ma.subscribe(Ve=>{Ve?document.body.classList.remove("use-mode"):document.body.classList.add("use-mode")});return document.addEventListener("click",ce),()=>{E(),document.removeEventListener("click",ce)}});function ke(){rl(t())}function Ge(){e(ae)?.click()}async function rt(E){const te=E.target.files?.[0];if(te)try{const He=await ol(te);ge.set(He),alert("Character imported successfully!")}catch{alert("Failed to import character file")}}Ot();var mt=Ao();nl("1uha8ag",E=>{var Ve=vo();Qt(2),Ls(()=>{tl.title="D&D Character Sheet"}),o(E,Ve)});var ct=je(mt),Je=l(ct),w=l(Je),U=l(w),he=l(U),xe=a(l(he),2);{var y=E=>{var Ve=uo(),te=l(Ve);s(Ve),k(()=>$(te,`${t().name??""} (${t().level??""})`)),o(E,Ve)};g(xe,E=>{t().name&&E(y)})}s(he);var G=a(he,2);{var re=E=>{var Ve=po();yt(Ve,5,C,kt,(te,He)=>{var M=fo();let xt;var ht=l(M);s(M),k(()=>{xt=Bt(M,1,"slot-badge svelte-1uha8ag",null,xt,{depleted:e(He).available===0}),$(ht,`Lv${e(He).level??""}: ${e(He).available??""}/${e(He).total??""}`)}),o(te,M)}),s(Ve),o(E,Ve)};g(G,E=>{C().length>0&&E(re)})}var _e=a(G,2);{var ne=E=>{var Ve=Lo(),te=je(Ve);yt(te,5,()=>t().activeStates,kt,(He,M,xt)=>{var ht=Do(),st=l(ht),$e=a(st);{var ft=it=>{var pt=So(),St=l(pt),Jt=l(St,!0);s(St);var aa=a(St,2),zt=a(aa,3);{var sa=gt=>{var $t=mo(),Lt=je($t),wt=l(Lt);s(Lt),Qt(),k(()=>$(wt,`Attack Bonus: ${typeof e(M).attackBonus=="number"&&e(M).attackBonus>0?"+":""}${e(M).attackBonus??""}`)),o(gt,$t)};g(zt,gt=>{e(M).attackBonus&&gt(sa)})}var Tt=a(zt,2);{var Pt=gt=>{var $t=go(),Lt=je($t),wt=l(Lt);s(Lt),Qt(),k(()=>$(wt,`Damage Bonus: ${typeof e(M).damageBonus=="number"&&e(M).damageBonus>0?"+":""}${e(M).damageBonus??""}`)),o(gt,$t)};g(Tt,gt=>{e(M).damageBonus&&gt(Pt)})}var Et=a(Tt,2);{var la=gt=>{var $t=bo(),Lt=je($t),wt=l(Lt);s(Lt),Qt(),k(()=>$(wt,`AC Bonus: ${e(M).acBonus>0?"+":""}${e(M).acBonus??""}`)),o(gt,$t)};g(Et,gt=>{e(M).acBonus&&gt(la)})}var na=a(Et,2);{var va=gt=>{var $t=ho(),Lt=je($t),wt=l(Lt);s(Lt),Qt(),k(()=>$(wt,`Darkvision: ${e(M).darkvision??""} feet`)),o(gt,$t)};g(na,gt=>{e(M).darkvision&&gt(va)})}var Yt=a(na,2);{var Ut=gt=>{var $t=_o(),Lt=je($t),wt=l(Lt);s(Lt),Qt(),k(At=>$(wt,`Resistances: ${At??""}`),[()=>e(M).resistances.join(", ")]),o(gt,$t)};g(Yt,gt=>{e(M).resistances&&e(M).resistances.length>0&&gt(Ut)})}var Wt=a(Yt,2);{var Zt=gt=>{var $t=yo(),Lt=je($t),wt=l(Lt);s(Lt),Qt(),k(At=>$(wt,`Immunities: ${At??""}`),[()=>e(M).immunities.join(", ")]),o(gt,$t)};g(Wt,gt=>{e(M).immunities&&e(M).immunities.length>0&&gt(Zt)})}var jt=a(Wt,2);{var ea=gt=>{var $t=ko(),Lt=a(l($t),3);yt(Lt,1,()=>e(M).abilities,kt,(wt,At)=>{var Kt=wo(),ta=l(Kt),da=l(ta);s(ta);var It=a(ta),Vt=a(It);{var oa=ba=>{var Ca=xo(),Fa=a(je(Ca)),Pa=l(Fa),Da=a(Pa);{var Wa=Ka=>{var Ps=Mt(", requires reaction");o(Ka,Ps)};g(Da,Ka=>{e(At).requiresReaction&&Ka(Wa)})}Qt(),s(Fa),k(()=>$(Pa,`(${(e(At).currentUses||0)??""}/${e(At).usesPerRest??""} uses per ${e(At).restType??""}
                                rest`)),o(ba,Ca)},fa=ba=>{var Ca=bt(),Fa=je(Ca);{var Pa=Da=>{var Wa=$o();Qt(),o(Da,Wa)};g(Fa,Da=>{e(At).requiresReaction&&Da(Pa)},!0)}o(ba,Ca)};g(Vt,ba=>{e(At).usesPerRest?ba(oa):ba(fa,!1)})}s(Kt),k(()=>{$(da,`${e(At).name??""}:`),$(It,` ${e(At).description??""} `)}),o(wt,Kt)}),s($t),o(gt,$t)};g(jt,gt=>{e(M).abilities&&e(M).abilities.length>0&&gt(ea)})}s(pt),k(()=>{$(Jt,e(M).name),$(aa,` ${e(M).description??""}`)}),o(it,pt)};g($e,it=>{e(be)===xt&&it(ft)})}var nt=a($e,2);{var Rt=it=>{var pt=Co();k(()=>lt(pt,"title",`End ${e(M).name??""}`)),j("click",pt,()=>{ge.update(St=>{if(St.activeStates){const Jt=St.activeStates[xt];Jt?.hpBonus&&Jt.target!=="other"&&(St.maxHP-=Jt.hpBonus,St.currentHP=Math.max(1,Math.min(St.currentHP-Jt.hpBonus,St.maxHP))),St.activeStates=St.activeStates.filter((aa,zt)=>zt!==xt)}return St})}),o(it,pt)};g(nt,it=>{v()||it(Rt)})}s(ht),k(()=>{lt(ht,"aria-label",e(M).name),$(st,`‚ú® ${e(M).name??""} `)}),j("mouseenter",ht,()=>Fe(xt)),j("mouseleave",ht,F),j("focus",ht,()=>Fe(xt)),j("blur",ht,F),j("click",ht,()=>I(xt)),o(He,ht)}),s(te),Qt(2),o(E,Ve)};g(_e,E=>{t().activeStates&&t().activeStates.length>0&&E(ne)})}s(U);var N=a(U,2),H=l(N),se=l(H),T=a(se,2),Pe=l(T),Ae=a(Pe,2);{var Xe=E=>{var Ve=jo(),te=l(Ve),He=a(te,2);s(Ve),j("click",te,b),j("click",He,B),o(E,Ve)};g(Ae,E=>{e(me)&&E(Xe)})}s(T);var Se=a(T,2),m=a(Se,2),ve=l(m);let ie;var J=l(ve),Oe=l(J,!0);s(J);var Ie=a(J),Le=l(Ie,!0);s(Ie),s(ve),s(m),s(H);var Ue=a(H,2),de=l(Ue);Be(de),s(Ue),s(N),s(w);var Ee=a(w,2),ye=l(Ee),Qe=a(ye,2),ze=a(Qe,2),ot=a(ze,2),vt=a(ot,2),fe=a(vt,2);Ra(fe,E=>r(ae,E),()=>e(ae)),s(Ee),s(Je);var D=a(Je,2),q=l(D);Dl(q,{});var Z=a(q,2);Bl(Z,{$$events:{roll:E=>R(E.detail)}});var Q=a(Z,2);Xl(Q,{$$events:{roll:E=>R(E.detail)}});var Ce=a(Q,2);Vl(Ce,{$$events:{rollHitDice:De}});var We=a(Ce,2);ao(We,{});var tt=a(We,2);si(tt,{$$events:{roll:E=>R(E.detail)}});var Ke=a(tt,2);Fi(Ke,{});var Ye=a(Ke,2);Ei(Ye,{}),s(D),s(ct);var pe=a(ct,2);Ra(lr(pe,{get notation(){return e(W)},get damageNotation(){return e(z)},get attackName(){return e(L)},get applyHalfDamage(){return e(A)},get bonusBreakdown(){return e(O)},get rollType(){return e(Te)},get visible(){return e(h)},$$events:{close:we},$$legacy:!0}),E=>r(Re,E),()=>e(Re));var V=a(pe,2);{var Ne=E=>{kr(E,{get mode(){return e(oe)},$$events:{close:()=>r(_,!1)}})};g(V,E=>{e(_)&&E(Ne)})}var ut=a(V,2);{var Ze=E=>{Hr(E,{onClose:()=>r(X,!1)})};g(ut,E=>{e(X)&&E(Ze)})}var at=a(ut,2);Vr(at,{get show(){return e(P)},onSave:x,onCancel:K});var le=a(at,2);il(le,{});var Dt=a(le,2);co(Dt,{}),k(()=>{ie=Bt(ve,1,"btn btn-mode svelte-1uha8ag",null,ie,{"use-mode":!v()}),$(Oe,v()?"üìù":"üé≤"),$(Le,v()?"Edit Mode":"Use Mode")}),j("click",se,()=>{r(O,[]),r(h,!0)}),j("click",Pe,()=>r(me,!e(me))),j("click",Se,()=>r(P,!0)),j("click",ve,ue),qe(de,u,E=>cl(ga,E)),j("click",ye,()=>r(X,!0)),j("click",Qe,()=>{r(oe,"save"),r(_,!0)}),j("click",ze,()=>{r(oe,"load"),r(_,!0)}),j("click",ot,ke),j("click",vt,Ge),j("change",fe,rt),o(n,mt),qt(),p()}export{Uo as component};
