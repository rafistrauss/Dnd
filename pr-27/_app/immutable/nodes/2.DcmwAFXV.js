import{d as ms,g as Us,f as u,e as j,a as o,s as k,c as bt,t as Pt}from"../chunks/BESELRjb.js";import{i as zt}from"../chunks/JMgyEzd3.js";import{c as $a,o as wa,a as Ns,b as Os}from"../chunks/CtPH092J.js";import{F as L,T as ha,Y as rs,j as Gs,aZ as qs,U as gs,ag as zs,aD as Ws,aK as Ks,aE as Vs,a1 as Js,av as Oa,a7 as ds,i as js,a_ as Ys,a$ as As,b0 as Ja,K as ya,e as Bs,b1 as Rs,b2 as Qs,b3 as Xs,b4 as Zs,q as ns,b5 as el,b6 as tl,ab as al,d as r,r as us,g as sl,C as Wt,G as Kt,H as l,I as s,J as a,b7 as Xe,b8 as pa,s as n,a4 as C,f as e,m as kt,E as Se,b9 as qt,ao as ta,A as H,ba,bb as ja,bc as ll}from"../chunks/DyJ43TGI.js";import{t as il,c as aa,a as ve,e as Lt,i as Bt,u as Ts,s as _a,b as Mt,d as Ya,f as xa,g as rl,j as Ht,k as nl,l as bs,m as Za,h as ol,T as cl,n as vl,o as dl,r as hs,p as _s}from"../chunks/C1zjLAJO.js";import{i as g,s as ca,a as ut,b as Ot,d as Fa,e as ul}from"../chunks/CCL4udNy.js";import{p as jt,b as Ha}from"../chunks/iXw84bXb.js";import{b as Pa,r as fl}from"../chunks/OU8HMmrQ.js";function pl(i,c,t=!1,v=!1,f=!1){var p=i,m="";L(()=>{var A=Gs;if(m===(m=c()??"")){ha&&rs();return}if(A.nodes_start!==null&&(qs(A.nodes_start,A.nodes_end),A.nodes_start=A.nodes_end=null),m!==""){if(ha){gs.data;for(var y=rs(),x=y;y!==null&&(y.nodeType!==zs||y.data!=="");)x=y,y=Ws(y);if(y===null)throw Ks(),Vs;ms(gs,x),p=Js(y);return}var V=m+"";t?V=`<svg>${V}</svg>`:v&&(V=`<math>${V}</math>`);var F=Us(V);if((t||v)&&(F=Oa(F)),ms(Oa(F),F.lastChild),t||v)for(;Oa(F);)p.before(Oa(F));else p.before(F)}})}function ml(i,c,t,v,f){ha&&rs();var p=c.$$slots?.[t],m=!1;p===!0&&(p=c[t],m=!0),p===void 0?f!==null&&f(i):p(i,m?()=>v:v)}function gl(i,c,t,v){var f=i.__style;if(ha||f!==c){var p=il(c);(!ha||p!==i.getAttribute("style"))&&(p==null?i.removeAttribute("style"):i.style.cssText=p),i.__style=c}return v}function Va(i,c,t=!1){if(i.multiple){if(c==null)return;if(!js(c))return Ys();for(var v of i.options)v.selected=c.includes(Ia(v));return}for(v of i.options){var f=Ia(v);if(As(f,c)){v.selected=!0;return}}(!t||c!==void 0)&&(i.selectedIndex=-1)}function os(i){var c=new MutationObserver(()=>{Va(i,i.__value)});c.observe(i,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),ds(()=>{c.disconnect()})}function Ua(i,c,t=c){var v=new WeakSet,f=!0;Ja(i,"change",p=>{var m=p?"[selected]":":checked",A;if(i.multiple)A=[].map.call(i.querySelectorAll(m),Ia);else{var y=i.querySelector(m)??i.querySelector("option:not([disabled])");A=y&&Ia(y)}t(A),ya!==null&&v.add(ya)}),Bs(()=>{var p=c();if(i===document.activeElement){var m=Rs??ya;if(v.has(m))return}if(Va(i,p,f),f&&p===void 0){var A=i.querySelector(":checked");A!==null&&(p=Ia(A),t(p))}i.__value=p,f=!1}),os(i)}function Ia(i){return"__value"in i?i.__value:i.value}const bl=Symbol("is custom element"),hl=Symbol("is html");function ke(i){if(ha){var c=!1,t=()=>{if(!c){if(c=!0,i.hasAttribute("value")){var v=i.value;et(i,"value",null),i.value=v}if(i.hasAttribute("checked")){var f=i.checked;et(i,"checked",null),i.checked=f}}};i.__on_r=t,ns(t),el()}}function Ea(i,c){var t=fs(i);t.value===(t.value=c??void 0)||i.value===c&&(c!==0||i.nodeName!=="PROGRESS")||(i.value=c??"")}function Ms(i,c){var t=fs(i);t.checked!==(t.checked=c??void 0)&&(i.checked=c)}function et(i,c,t,v){var f=fs(i);ha&&(f[c]=i.getAttribute(c),c==="src"||c==="srcset"||c==="href"&&i.nodeName==="LINK")||f[c]!==(f[c]=t)&&(c==="loading"&&(i[Qs]=t),t==null?i.removeAttribute(c):typeof t!="string"&&_l(i).includes(c)?i[c]=t:i.setAttribute(c,t))}function fs(i){return i.__attributes??={[bl]:i.nodeName.includes("-"),[hl]:i.namespaceURI===Xs}}var ys=new Map;function _l(i){var c=i.getAttribute("is")||i.nodeName,t=ys.get(c);if(t)return t;ys.set(c,t=[]);for(var v,f=i,p=Element.prototype;p!==f;){v=tl(f);for(var m in v)v[m].set&&t.push(m);f=Zs(f)}return t}function Ue(i,c,t=c){var v=new WeakSet;Ja(i,"input",async f=>{var p=f?i.defaultValue:i.value;if(p=ts(i)?as(p):p,t(p),ya!==null&&v.add(ya),await al(),p!==(p=c())){var m=i.selectionStart,A=i.selectionEnd,y=i.value.length;if(i.value=p??"",A!==null){var x=i.value.length;m===A&&A===y&&x>y?(i.selectionStart=x,i.selectionEnd=x):(i.selectionStart=m,i.selectionEnd=Math.min(A,x))}}}),(ha&&i.defaultValue!==i.value||r(c)==null&&i.value)&&(t(ts(i)?as(i.value):i.value),ya!==null&&v.add(ya)),us(()=>{var f=c();if(i===document.activeElement){var p=Rs??ya;if(v.has(p))return}ts(i)&&f===as(i.value)||i.type==="date"&&!f&&!i.value||f!==i.value&&(i.value=f??"")})}const es=new Set;function xs(i,c,t,v,f=v){var p=t.getAttribute("type")==="checkbox",m=i;let A=!1;if(c!==null)for(var y of c)m=m[y]??=[];m.push(t),Ja(t,"change",()=>{var x=t.__value;p&&(x=$s(m,x,t.checked)),f(x)},()=>f(p?[]:null)),us(()=>{var x=v();if(ha&&t.defaultChecked!==t.checked){A=!0;return}p?(x=x||[],t.checked=x.includes(t.__value)):t.checked=As(t.__value,x)}),ds(()=>{var x=m.indexOf(t);x!==-1&&m.splice(x,1)}),es.has(m)||(es.add(m),ns(()=>{m.sort((x,V)=>x.compareDocumentPosition(V)===4?-1:1),es.delete(m)})),ns(()=>{if(A){var x;if(p)x=$s(m,x,t.checked);else{var V=m.find(F=>F.checked);x=V?.__value}f(x)}})}function La(i,c,t=c){Ja(i,"change",v=>{var f=v?i.defaultChecked:i.checked;t(f)}),(ha&&i.defaultChecked!==i.checked||r(c)==null)&&t(i.checked),us(()=>{var v=c();i.checked=!!v})}function $s(i,c,t){for(var v=new Set,f=0;f<i.length;f+=1)i[f].checked&&v.add(i[f].__value);return t||v.delete(c),Array.from(v)}function ts(i){var c=i.type;return c==="number"||c==="range"}function as(i){return i===""?null:+i}function yl(i,c,t){var v=sl(i,c);v&&v.set&&(i[c]=t,ds(()=>{i[c]=null}))}function ps(i){return function(...c){var t=c[0];return t.stopPropagation(),i?.apply(this,c)}}function Aa(i,c){var t=i.$$events?.[c.type],v=js(t)?t.slice():t==null?[]:[t];for(var f of v)f.call(this,c)}const xl="";function Fs(...i){return Pa+xl+fl(i[0],i[1])}const cs={paladin:{name:"Paladin",hitDice:"d10",spellcaster:!0,spellcastingAbility:"charisma",spellSlotsByLevel:{1:0,2:2,3:3,4:3,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Divine Sense",type:"uses",maxUses:(i,c=1)=>1+Math.max(1,c),resetOn:"long",description:"Detect celestials, fiends, and undead within 60 feet",minLevel:1},{name:"Lay on Hands",type:"pool",maxPool:i=>i*5,resetOn:"long",description:"Heal wounds or cure disease",minLevel:1},{name:"Divine Smite",type:"spellSlot",description:"Expend spell slot to deal extra radiant damage",minLevel:2,rollable:!0},{name:"Channel Divinity",type:"pool",maxPool:i=>i>=18?3:i>=6?2:1,resetOn:"short",description:"Sacred Weapon or Turn Undead",minLevel:3}]},fighter:{name:"Fighter",hitDice:"d10",spellcaster:!1,features:[{name:"Second Wind",type:"uses",maxUses:1,resetOn:"short",description:"Regain 1d10 + fighter level HP as bonus action",minLevel:1,rollable:!0,rollFormula:i=>`1d10+${i}`},{name:"Action Surge",type:"uses",maxUses:i=>i>=17?2:1,resetOn:"short",description:"Take one additional action on your turn",minLevel:2},{name:"Indomitable",type:"uses",maxUses:i=>i>=17?3:i>=13?2:1,resetOn:"long",description:"Reroll a failed saving throw",minLevel:9}],subclasses:{champion:{name:"Champion",features:[{name:"Improved Critical",type:"info",description:"Critical hit on 19-20",minLevel:3},{name:"Remarkable Athlete",type:"info",description:"Add half proficiency to STR/DEX/CON checks, increase long jump distance",minLevel:7},{name:"Additional Fighting Style",type:"info",description:"Choose a second fighting style",minLevel:10},{name:"Superior Critical",type:"info",description:"Critical hit on 18-20",minLevel:15},{name:"Survivor",type:"info",description:"Regain 5 + CON mod HP at start of turn if below half HP",minLevel:18}]},battlemaster:{name:"Battle Master",features:[{name:"Combat Superiority",type:"uses",maxUses:i=>i>=15?6:i>=7?5:4,resetOn:"short",description:i=>`Use superiority dice (${i>=18?"d12":i>=10?"d10":"d8"}) for maneuvers`,minLevel:3},{name:"Know Your Enemy",type:"info",description:"Learn capabilities of creatures you observe",minLevel:7},{name:"Improved Combat Superiority",type:"info",description:"Superiority dice become d10",minLevel:10},{name:"Relentless",type:"info",description:"Regain 1 superiority die if you have none at start of turn",minLevel:15}]}}},rogue:{name:"Rogue",hitDice:"d8",spellcaster:!1,features:[{name:"Sneak Attack",type:"info",description:i=>`Deal ${Math.ceil(i/2)}d6 extra damage once per turn with advantage or ally nearby`,minLevel:1,rollable:!0,rollFormula:i=>`${Math.ceil(i/2)}d6`},{name:"Cunning Action",type:"info",description:"Dash, Disengage, or Hide as a bonus action",minLevel:2},{name:"Uncanny Dodge",type:"info",description:"Use reaction to halve damage from an attack",minLevel:5},{name:"Evasion",type:"info",description:"Take no damage on successful Dex save (half on fail)",minLevel:7}]},wizard:{name:"Wizard",hitDice:"d6",spellcaster:!0,spellcastingAbility:"intelligence",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Arcane Recovery",type:"uses",maxUses:1,resetOn:"long",description:i=>`Recover spell slots totaling up to ${Math.ceil(i/2)} levels during short rest`,minLevel:1},{name:"Spell Mastery",type:"info",description:"Cast one 1st-level and one 2nd-level spell at will",minLevel:18}]},cleric:{name:"Cleric",hitDice:"d8",spellcaster:!0,spellcastingAbility:"wisdom",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Channel Divinity",type:"pool",maxPool:i=>i>=18?3:i>=6?2:1,resetOn:"short",description:"Turn Undead or domain-specific ability",minLevel:2},{name:"Destroy Undead",type:"info",description:i=>`Channel Divinity destroys undead of CR ${i>=17?4:i>=14?3:i>=11?2:i>=8?1:.5} or lower`,minLevel:5},{name:"Divine Intervention",type:"uses",maxUses:1,resetOn:"long",description:i=>`${i}% chance to succeed, implore deity for aid`,minLevel:10}],subclasses:{war:{name:"War Domain",features:[{name:"War Priest",type:"uses",maxUses:(i,c=1)=>Math.max(1,c),resetOn:"long",description:"Make one weapon attack as a bonus action",minLevel:1},{name:"Guided Strike",type:"channelDivinity",description:"Use your Channel Divinity to gain +10 to an attack roll. Make this choice after you see the roll, but before the DM says whether the attack hits or misses.",minLevel:2,resetOn:"short"},{name:"War God's Blessing",type:"channelDivinity",description:"Use reaction to grant +10 to an ally's attack roll within 30 feet. Consumes one use of Channel Divinity.",minLevel:6,resetOn:"short"},{name:"Divine Strike",type:"info",description:i=>`Deal extra ${i>=14?"2d8":"1d8"} weapon damage once per turn`,minLevel:8,rollable:!0,rollFormula:i=>i>=14?"2d8":"1d8"},{name:"Avatar of Battle",type:"info",description:"Gain resistance to nonmagical weapon damage",minLevel:17}]},life:{name:"Life Domain",features:[{name:"Disciple of Life",type:"info",description:"Healing spells restore additional 2 + spell level HP",minLevel:1},{name:"Preserve Life",type:"pool",maxPool:i=>i*5,resetOn:"short",description:"Restore HP to creatures within 30 feet",minLevel:2},{name:"Blessed Healer",type:"info",description:"Regain 2 + spell level HP when you cast healing spell",minLevel:6},{name:"Divine Strike",type:"info",description:i=>`Deal extra ${i>=14?"2d8":"1d8"} radiant damage once per turn`,minLevel:8,rollable:!0,rollFormula:i=>i>=14?"2d8":"1d8"},{name:"Supreme Healing",type:"info",description:"Maximize healing dice instead of rolling",minLevel:17}]}}},barbarian:{name:"Barbarian",hitDice:"d12",spellcaster:!1,features:[{name:"Rage",type:"uses",maxUses:i=>i>=20?1/0:i>=17?6:i>=12?5:i>=6?4:i>=3?3:2,resetOn:"long",description:i=>`+${i>=16?4:i>=9?3:2} damage, resistance to physical damage`,minLevel:1},{name:"Reckless Attack",type:"info",description:"Gain advantage on melee attacks, enemies get advantage on you",minLevel:2},{name:"Danger Sense",type:"info",description:"Advantage on Dex saves against effects you can see",minLevel:2}],subclasses:{berserker:{name:"Path of the Berserker",features:[{name:"Frenzy",type:"info",description:"While raging, make melee attack as bonus action (gain 1 exhaustion after rage)",minLevel:3},{name:"Mindless Rage",type:"info",description:"Cannot be charmed or frightened while raging",minLevel:6},{name:"Intimidating Presence",type:"info",description:"Use action to frighten creature within 30 feet",minLevel:10},{name:"Retaliation",type:"info",description:"When damaged by creature within 5 feet, make melee attack as reaction",minLevel:14}]}}}};function oa(i){const c=i.toLowerCase();return cs[c]||null}function Ba(i,c,t){const v=oa(i);if(!v)return[];const f=v.features.filter(p=>!p.minLevel||p.minLevel<=c);if(t&&v.subclasses&&v.subclasses[t]){const p=v.subclasses[t].features.filter(m=>!m.minLevel||m.minLevel<=c);return[...f,...p]}return f}function ws(i){const c=oa(i);return!c||!c.subclasses?[]:Object.keys(c.subclasses).map(t=>({id:t,name:c.subclasses[t].name}))}function Ss(i,c){const t=oa(i);return!t||!t.spellcaster||!t.spellSlotsByLevel?0:t.spellSlotsByLevel[c]||0}function ks(i,c,t){const v=oa(i);return!v||!v.spellcaster?0:Math.max(1,t+c)}function $l(i,c,t){const v=oa(i);return!v||!v.spellcaster?null:8+c+t}function wl(){return Object.keys(cs).map(i=>({id:i,name:cs[i].name}))}var Sl=u('<div class="section-header svelte-ls99y2" role="button" tabindex="0"><h2 class="svelte-ls99y2"> </h2> <span class="collapse-btn svelte-ls99y2"> </span></div>');function Sa(i,c){Wt(c,!1);let t=jt(c,"title",8),v=jt(c,"collapsed",8),f=jt(c,"ariaLabel",8,""),p=jt(c,"onToggle",8);zt();var m=Sl(),A=l(m),y=l(A,!0);s(A);var x=a(A,2),V=l(x,!0);s(x),s(m),L(()=>{et(m,"aria-expanded",!v()),et(m,"aria-label",f()),k(y,t()),k(V,v()?"‚ñº":"‚ñ≤")}),j("click",m,function(...F){p()?.apply(this,F)}),j("keydown",m,F=>{(F.key==="Enter"||F.key===" ")&&p()()}),o(i,m),Kt()}var kl=u("<option> </option>"),Cl=u("<option> </option>"),Dl=u('<div class="form-group svelte-172i2fj"><label for="characterSubclass" class="svelte-172i2fj">Subclass</label> <select id="characterSubclass" class="svelte-172i2fj"><option>Select Subclass</option><!></select></div>'),Ll=u('<div class="info-grid svelte-172i2fj"><div class="form-group svelte-172i2fj"><label for="characterName" class="svelte-172i2fj">Character Name</label> <input type="text" id="characterName" placeholder="Enter name" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterClass" class="svelte-172i2fj">Class</label> <select id="characterClass" class="svelte-172i2fj"><option>Select Class</option><!></select></div> <!> <div class="form-group svelte-172i2fj"><label for="characterLevel" class="svelte-172i2fj">Level</label> <input type="number" id="characterLevel" min="1" max="20" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterRace" class="svelte-172i2fj">Race</label> <input type="text" id="characterRace" placeholder="e.g., Human" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterBackground" class="svelte-172i2fj">Background</label> <input type="text" id="characterBackground" placeholder="e.g., Soldier" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterAlignment" class="svelte-172i2fj">Alignment</label> <input type="text" id="characterAlignment" placeholder="e.g., Lawful Good" class="svelte-172i2fj"/></div></div>'),jl=u('<section class="character-info svelte-172i2fj"><!> <!></section>');function Al(i,c){Wt(c,!1);const t=()=>ut(ve,"$character",f),v=()=>ut(aa,"$collapsedStates",f),[f,p]=ca(),m=C(),A=wl();function y(G){const B=G.target;ve.update(P=>(P.class=B.value,P.subclass="",P))}function x(G){const B=G.target;ve.update(P=>(P.subclass=B.value,P))}function V(G){const B=G.target;ve.update(P=>(P.level=parseInt(B.value)||1,P)),Ts()}Xe(()=>(t(),ws),()=>{n(m,t().class?ws(t().class):[])}),pa(),zt();var F=jl(),X=l(F);{let G=kt(()=>(v(),r(()=>v().characterInfo?"Expand":"Collapse")));Sa(X,{title:"Character Info",get collapsed(){return v(),r(()=>v().characterInfo)},get ariaLabel(){return e(G)},onToggle:()=>aa.update(B=>({...B,characterInfo:!B.characterInfo}))})}var ae=a(X,2);{var ie=G=>{var B=Ll(),P=l(B),q=a(l(P),2);ke(q),s(P);var De=a(P,2),Je=a(l(De),2),J=l(Je);J.value=J.__value="";var Ee=a(J);Lt(Ee,1,()=>A,Bt,(Le,pe)=>{var ce=kl(),je=l(ce,!0);s(ce);var Ge={};L(()=>{k(je,(e(pe),r(()=>e(pe).name))),Ge!==(Ge=(e(pe),r(()=>e(pe).id)))&&(ce.value=(ce.__value=(e(pe),r(()=>e(pe).id)))??"")}),o(Le,ce)}),s(Je);var de;os(Je),s(De);var ge=a(De,2);{var Te=Le=>{var pe=Dl(),ce=a(l(pe),2),je=l(ce);je.value=je.__value="";var Ge=a(je);Lt(Ge,1,()=>e(m),Bt,(pt,rt)=>{var Ke=Cl(),yt=l(Ke,!0);s(Ke);var Ct={};L(()=>{k(yt,(e(rt),r(()=>e(rt).name))),Ct!==(Ct=(e(rt),r(()=>e(rt).id)))&&(Ke.value=(Ke.__value=(e(rt),r(()=>e(rt).id)))??"")}),o(pt,Ke)}),s(ce);var tt;os(ce),s(pe),L(()=>{tt!==(tt=(t(),r(()=>t().subclass)))&&(ce.value=(ce.__value=(t(),r(()=>t().subclass)))??"",Va(ce,(t(),r(()=>t().subclass))))}),j("change",ce,x),o(Le,pe)};g(ge,Le=>{e(m),r(()=>e(m).length>0)&&Le(Te)})}var T=a(ge,2),E=a(l(T),2);ke(E),s(T);var $=a(T,2),Y=a(l($),2);ke(Y),s($);var b=a($,2),M=a(l(b),2);ke(M),s(b);var K=a(b,2),$e=a(l(K),2);ke($e),s(K),s(B),L(()=>{de!==(de=(t(),r(()=>t().class)))&&(Je.value=(Je.__value=(t(),r(()=>t().class)))??"",Va(Je,(t(),r(()=>t().class)))),Ea(E,(t(),r(()=>t().level)))}),Ue(q,()=>t().name,Le=>Ot(ve,r(t).name=Le,r(t))),j("change",Je,y),j("change",E,V),Ue(Y,()=>t().race,Le=>Ot(ve,r(t).race=Le,r(t))),Ue(M,()=>t().background,Le=>Ot(ve,r(t).background=Le,r(t))),Ue($e,()=>t().alignment,Le=>Ot(ve,r(t).alignment=Le,r(t))),o(G,B)};g(ae,G=>{v(),r(()=>!v().characterInfo)&&G(ie)})}s(F),o(i,F),Kt(),p()}var Bl=u('<div class="ability-card svelte-bbv1xt"><h3 class="svelte-bbv1xt"> </h3> <input type="number" class="ability-score svelte-bbv1xt" min="1" max="30"/> <div class="ability-modifier svelte-bbv1xt"> </div> <div class="roll-buttons svelte-bbv1xt"><button class="roll-btn svelte-bbv1xt">Check</button> <button class="roll-btn svelte-bbv1xt">Save</button></div> <div class="save-proficiency svelte-bbv1xt"><input type="checkbox" class="svelte-bbv1xt"/> <label class="svelte-bbv1xt">Save Prof.</label></div></div>'),Rl=u('<div class="proficiency-bonus svelte-bbv1xt"><label for="profBonus">Proficiency Bonus</label> <input type="number" id="profBonus" class="prof-input svelte-bbv1xt"/></div> <div class="abilities-grid svelte-bbv1xt"></div>',1),Tl=u("<section><!> <!></section>");function Ml(i,c){Wt(c,!1);const t=()=>ut(Ya,"$abilityModifiers",A),v=()=>ut(ve,"$character",A),f=()=>ut(_a,"$searchFilter",A),p=()=>ut(aa,"$collapsedStates",A),m=()=>ut(xa,"$isEditMode",A),[A,y]=ca(),x=C(),V=C(),F=$a(),X=[{key:"strength",label:"Strength"},{key:"dexterity",label:"Dexterity"},{key:"constitution",label:"Constitution"},{key:"intelligence",label:"Intelligence"},{key:"wisdom",label:"Wisdom"},{key:"charisma",label:"Charisma"}];function ae(){Ts()}function ie(J){const Ee=t()[J],de=`1d20${Ee>=0?"+":""}${Ee}`,ge=[];ge.push({value:"1d20",source:"base die"}),Ee!==0&&ge.push({value:Ee,source:J}),F("roll",{notation:de,rollType:"check",bonusBreakdown:ge})}function G(J){const Ee=t()[J],de=v().saveProficiencies[J]?v().proficiencyBonus:0,ge=Ee+de,Te=`1d20${ge>=0?"+":""}${ge}`,T=[];T.push({value:"1d20",source:"base die"}),Ee!==0&&T.push({value:Ee,source:J}),de!==0&&T.push({value:de,source:"proficiency"}),F("roll",{notation:Te,rollType:"save",bonusBreakdown:T})}Xe(()=>f(),()=>{n(x,X.filter(({label:J})=>f()?J.toLowerCase().includes(f().toLowerCase()):!0))}),Xe(()=>(e(x),f()),()=>{n(V,e(x).length>0||!f()||f().toLowerCase().includes("proficiency"))}),pa(),zt();var B=Tl();let P;var q=l(B);Sa(q,{title:"Ability Scores",get collapsed(){return p(),r(()=>p().abilityScores)},ariaLabel:"Toggle Ability Scores Section",onToggle:()=>aa.update(J=>({...J,abilityScores:!J.abilityScores}))});var De=a(q,2);{var Je=J=>{var Ee=Rl(),de=Se(Ee),ge=a(l(de),2);ke(ge),s(de);var Te=a(de,2);Lt(Te,5,()=>e(x),Bt,(T,E)=>{let $=()=>e(E).key,Y=()=>e(E).label;var b=Bl(),M=l(b),K=l(M,!0);s(M);var $e=a(M,2);ke($e);var Le=a($e,2),pe=l(Le);s(Le);var ce=a(Le,2),je=l(ce),Ge=a(je,2);s(ce);var tt=a(ce,2),pt=l(tt);ke(pt);var rt=a(pt,2);s(tt),s(b),L(Ke=>{k(K,Ke),k(pe,`${t(),$(),r(()=>t()[$()]>=0?"+":"")??""}${t(),$(),r(()=>t()[$()])??""}`),pt.disabled=!m(),et(pt,"id",`${$()}-save`),et(rt,"for",`${$()}-save`)},[()=>(Y(),r(()=>Y().substring(0,3).toUpperCase()))]),Ue($e,()=>v().abilities[$()],Ke=>Ot(ve,r(v).abilities[$()]=Ke,r(v))),j("change",$e,ae),j("click",je,()=>ie($())),j("click",Ge,()=>G($())),La(pt,()=>v().saveProficiencies[$()],Ke=>Ot(ve,r(v).saveProficiencies[$()]=Ke,r(v))),o(T,b)}),s(Te),Ue(ge,()=>v().proficiencyBonus,T=>Ot(ve,r(v).proficiencyBonus=T,r(v))),o(J,Ee)};g(De,J=>{p(),r(()=>!p().abilityScores)&&J(Je)})}s(B),L(()=>P=Mt(B,1,"ability-scores svelte-bbv1xt",null,P,{hidden:!e(V)})),o(i,B),Kt(),y()}const Ps=[{name:"Unarmored",type:"none",baseAC:10},{name:"Padded",type:"light",baseAC:11},{name:"Leather",type:"light",baseAC:11},{name:"Studded Leather",type:"light",baseAC:12},{name:"Hide",type:"medium",baseAC:12,maxDexBonus:2},{name:"Chain Shirt",type:"medium",baseAC:13,maxDexBonus:2},{name:"Scale Mail",type:"medium",baseAC:14,maxDexBonus:2},{name:"Breastplate",type:"medium",baseAC:14,maxDexBonus:2},{name:"Half Plate",type:"medium",baseAC:15,maxDexBonus:2},{name:"Ring Mail",type:"heavy",baseAC:14,maxDexBonus:0},{name:"Chain Mail",type:"heavy",baseAC:16,maxDexBonus:0},{name:"Splint",type:"heavy",baseAC:17,maxDexBonus:0},{name:"Plate",type:"heavy",baseAC:18,maxDexBonus:0}];function Is(i){return Ps.find(c=>c.name===i)}function Fl(i,c,t){if(!i)return 10+c+(t?2:0);const v=Is(i);if(!v)return 10+c+(t?2:0);let f=v.baseAC;return v.maxDexBonus===void 0?f+=c:v.maxDexBonus>0&&(f+=Math.min(c,v.maxDexBonus)),t&&(f+=2),f}function Na(i){return Math.floor((i-10)/2)}function vs(i,c){if(!i.class)return null;const t=oa(i.class);if(!t||!t.spellcaster||!t.spellcastingAbility)return null;const v=Na(c[t.spellcastingAbility]);return 8+i.proficiencyBonus+v}function ss(i,c){if(!i.class)return 0;const t=oa(i.class);return!t||!t.spellcaster||!t.spellcastingAbility?0:Na(c[t.spellcastingAbility])}function Pl(i,c){const t=[],v=Na(c.dexterity),f=i.armorName?Is(i.armorName):void 0;if(f){if(f.type==="none")t.push("Unarmored"),t.push("Base: 10"),t.push(`Dexterity: ${v>=0?"+":""}${v}`);else if(f.type==="light")t.push(`${f.name}: ${f.baseAC}`),t.push(`Dexterity: ${v>=0?"+":""}${v}`);else if(f.type==="medium"){const p=Math.min(2,v);t.push(`${f.name}: ${f.baseAC}`),t.push(`Dexterity: ${p>=0?"+":""}${p} (max +2)`)}else f.type==="heavy"&&(t.push(`${f.name}: ${f.baseAC}`),t.push("Dexterity: +0 (heavy armor)"));i.shieldEquipped&&t.push("Shield: +2")}else{t.push("Base: 10"),v!==0&&t.push(`Dexterity: ${v>=0?"+":""}${v}`);const p=10+v,m=i.armorClass-p;m!==0&&t.push(`Other: ${m>=0?"+":""}${m}`)}return i.activeStates&&i.activeStates.length>0&&i.activeStates.forEach(p=>{typeof p.acBonus=="number"&&p.acBonus!==0&&(!p.target||p.target==="self")&&t.push(`${p.name}: ${p.acBonus>=0?"+":""}${p.acBonus}`)}),t.join(`
`)}function Il(i,c){const t=[],v=Na(c.dexterity);t.push(`Dexterity: ${v>=0?"+":""}${v}`);const f=i.initiative-v;return f!==0&&t.push(`Other Bonuses: ${f>=0?"+":""}${f}`),t.join(`
`)}function El(i,c){if(!i.class)return"";const t=oa(i.class);if(!t||!t.spellcaster||!t.spellcastingAbility)return"";const v=[],f=Na(c[t.spellcastingAbility]),p=t.spellcastingAbility.charAt(0).toUpperCase()+t.spellcastingAbility.slice(1);return v.push("Base: 8"),v.push(`Proficiency: +${i.proficiencyBonus}`),v.push(`${p}: ${f>=0?"+":""}${f}`),v.join(`
`)}function Hl(i,c,t){const v=[];let f=i;const p=c.toLowerCase().trim();if(t.activeStates){for(const m of t.activeStates)if(m.immunities&&m.immunities.length>0&&m.immunities.some(y=>y.toLowerCase().trim()===p))return v.push(`Immune to ${c} (${m.name})`),{finalDamage:0,adjustments:v}}if(t.activeStates){for(const m of t.activeStates)if(m.resistances&&m.resistances.length>0&&m.resistances.some(y=>y.toLowerCase().trim()===p)){const y=Math.floor(f/2);v.push(`Resistant to ${c} (${m.name}): ${f} ‚Üí ${y}`),f=y;break}}return v.length===0&&v.push(`No adjustments for ${c}`),{finalDamage:f,adjustments:v}}function Ul(i,c){const t={...i};if(t.tempHP>0){if(c<=t.tempHP)return t.tempHP-=c,t;c-=t.tempHP,t.tempHP=0}return t.currentHP=Math.max(0,t.currentHP-c),t}var Nl=u('<button class="info-icon svelte-1o8ci7b" type="button">‚ÑπÔ∏è</button>'),Ol=u('<button class="info-icon svelte-1o8ci7b" type="button">‚ÑπÔ∏è</button>'),Gl=u("<div><!></div>"),ql=u('<div class="tooltip-wrapper svelte-1o8ci7b"><!> <!></div>');function ls(i,c){Wt(c,!1);let t=jt(c,"tooltipContent",8),v=jt(c,"ariaLabel",8,"Show information"),f=C(!1),p=C(),m=C(!1),A=C(null),y=C(!1),x=C(!1),V=C("");const F=Math.random().toString(36).slice(2);function X(){window.dispatchEvent(new CustomEvent("tooltip-open",{detail:F}))}function ae(T){T.detail!==F&&(n(f,!1),n(y,!1))}function ie(){n(m,window.matchMedia("(pointer: coarse)").matches||"ontouchstart"in window)}function G(){if(!e(A)||!e(p))return;const T=e(p).getBoundingClientRect(),E=e(A).getBoundingClientRect();let $=T.bottom+5,Y=T.left;n(y,!1),Y+E.width>window.innerWidth-8&&(Y=T.right-E.width,n(y,!0),Y<8&&(Y=8)),Y<8&&(Y=8),$+E.height>window.innerHeight-8&&($=T.top-E.height-5),n(V,`position:fixed;top:${$}px;left:${Y}px;z-index:1000;`),n(x,!0)}function B(){X(),n(f,!1),n(x,!1),requestAnimationFrame(()=>{n(f,!0),n(x,!1),setTimeout(G,0)})}function P(){n(f,!1),n(y,!1)}function q(T){T.stopPropagation(),e(f)?(n(f,!1),n(y,!1),n(x,!1)):(X(),n(f,!1),n(x,!1),requestAnimationFrame(()=>{n(f,!0),n(x,!1),setTimeout(G,0)}))}function De(T){e(p)&&!e(p).contains(T.target)&&(n(f,!1),n(y,!1))}wa(()=>{ie(),document.addEventListener("click",De),window.addEventListener("tooltip-open",ae)}),Ns(()=>{document.removeEventListener("click",De),window.removeEventListener("tooltip-open",ae)}),zt();var Je=ql(),J=l(Je);{var Ee=T=>{var E=Nl();L(()=>et(E,"aria-label",v())),j("click",E,q),o(T,E)},de=T=>{var E=Ol();L(()=>et(E,"aria-label",v())),j("mouseenter",E,B),j("mouseleave",E,P),o(T,E)};g(J,T=>{e(m)?T(Ee):T(de,!1)})}var ge=a(J,2);{var Te=T=>{var E=Gl(),$=l(E);ml($,c,"content",{},Y=>{var b=bt(),M=Se(b);pl(M,t),o(Y,b)}),s(E),Ha(E,Y=>n(A,Y),()=>e(A)),L(()=>{Mt(E,1,`tooltip-popup ${e(y)?"right-align":""}`,"svelte-1o8ci7b"),gl(E,e(x)?e(V)+"opacity:1;pointer-events:auto;":"opacity:0;pointer-events:none;position:fixed;top:0;left:0;z-index:1000;")}),o(T,E)};g(ge,T=>{e(f)&&T(Te)})}s(Je),Ha(Je,T=>n(p,T),()=>e(p)),o(i,Je),Kt()}var zl=u("<option> </option>"),Wl=u('<div class="armor-config svelte-1r5hyyb"><h4 class="svelte-1r5hyyb">Armor Configuration</h4> <div class="armor-controls svelte-1r5hyyb"><div class="armor-field svelte-1r5hyyb"><label for="armorName" class="svelte-1r5hyyb">Armor</label> <select id="armorName" class="armor-select svelte-1r5hyyb"><option>None (Unarmored)</option><!></select></div> <div class="armor-field svelte-1r5hyyb"><label class="shield-label svelte-1r5hyyb"><input type="checkbox" class="shield-checkbox svelte-1r5hyyb"/> Shield Equipped (+2 AC)</label></div></div></div>'),Kl=u('<div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="spellSaveDC" class="svelte-1r5hyyb">Spell Save DC</label> <!></div> <input type="number" id="spellSaveDC" class="stat-input svelte-1r5hyyb" readonly=""/></div>'),Vl=u('<span class="hit-dice-type"> </span>'),Jl=u('<!> <div class="stats-grid svelte-1r5hyyb"><div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="armorClass" class="svelte-1r5hyyb">Armor Class</label> <!></div> <input type="text" id="armorClass" readonly=""/></div> <div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="initiative" class="svelte-1r5hyyb">Initiative</label> <!></div> <input type="text" id="initiative" class="stat-input svelte-1r5hyyb" readonly=""/></div> <div class="stat-box svelte-1r5hyyb"><label for="speed" class="svelte-1r5hyyb">Speed</label> <input type="text" id="speed" class="stat-input svelte-1r5hyyb"/></div> <!></div> <div class="hp-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Points</h3> <div><div class="hp-inputs svelte-1r5hyyb"><input type="number" class="hp-current svelte-1r5hyyb" min="0"/> <span class="hp-separator svelte-1r5hyyb">/</span> <input type="number" class="hp-max svelte-1r5hyyb" min="0"/></div> <div class="hp-controls svelte-1r5hyyb"><button class="hp-btn svelte-1r5hyyb">‚àí</button> <button class="hp-btn svelte-1r5hyyb">+</button> <button class="hp-btn svelte-1r5hyyb">‚àí5</button> <button class="hp-btn svelte-1r5hyyb">+5</button></div></div> <div class="temp-hp svelte-1r5hyyb"><label for="tempHP" class="svelte-1r5hyyb">Temp HP</label> <input type="number" id="tempHP" min="0" class="svelte-1r5hyyb"/></div></div> <div class="hit-dice-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Dice</h3> <div class="hit-dice-display svelte-1r5hyyb"><input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <span>/</span> <input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <!></div> <div class="hit-dice-controls svelte-1r5hyyb"><label for="hitDiceCount" class="svelte-1r5hyyb">Roll</label> <div class="hit-dice-count-controls svelte-1r5hyyb"><button class="hit-dice-btn svelte-1r5hyyb">‚àí</button> <input type="number" id="hitDiceCount" class="hit-dice-count-input svelte-1r5hyyb" min="1"/> <button class="hit-dice-btn svelte-1r5hyyb">+</button></div> <button class="btn btn-primary roll-hit-dice use-enabled svelte-1r5hyyb">üé≤ Roll</button></div></div>',1),Yl=u("<section><!> <!></section>");function Ql(i,c){Wt(c,!1);const t=()=>ut(ve,"$character",A),v=()=>ut(Ya,"$abilityModifiers",A),f=()=>ut(_a,"$searchFilter",A),p=()=>ut(aa,"$collapsedStates",A),m=()=>ut(xa,"$isEditMode",A),[A,y]=ca(),x=C(),V=C(),F=C(),X=C(),ae=C(),ie=C(),G=C(),B=$a();let P=C(1);function q(T){ve.update(E=>(E.currentHP=Math.max(0,Math.min(E.maxHP,E.currentHP+T)),E))}function De(T){const E=e(P)+T,$=t().hitDice.current;n(P,Math.max(1,Math.min($,E)))}function Je(T=1){if(t().hitDice.current<=0){alert("No hit dice remaining!");return}if(!t().class){alert("Please select a class first!");return}const E=oa(t().class);if(!E){alert("Invalid class configuration!");return}const $=Math.min(T,t().hitDice.current),Y=E.hitDice,b=v().constitution,M=b*$,K=M>=0?`+${M}`:`${M}`,$e=`${$}${Y}${K}`,Le=[];if(Le.push({value:`${$}${Y}`,source:"hit dice"}),b!==0)for(let pe=0;pe<$;pe++)Le.push({value:b,source:"constitution"});B("rollHitDice",{notation:$e,hitDie:Y,count:$,bonusBreakdown:Le})}Xe(()=>(t(),v(),ve),()=>{if(t().armorName!==void 0||t().shieldEquipped!==void 0){const T=v().dexterity,E=Fl(t().armorName,T,t().shieldEquipped||!1);t().armorClass!==E&&ve.update($=>({...$,armorClass:E}))}}),Xe(()=>(v(),t(),ve),()=>{const T=v().dexterity;t().initiative!==T&&ve.update(E=>({...E,initiative:T}))}),Xe(()=>t(),()=>{n(x,vs(t(),t().abilities))}),Xe(()=>t(),()=>{n(V,Pl(t(),t().abilities))}),Xe(()=>t(),()=>{n(F,Il(t(),t().abilities))}),Xe(()=>t(),()=>{n(X,El(t(),t().abilities))}),Xe(()=>(t(),e(P)),()=>{const T=t().hitDice.current;T>0&&e(P)>T&&n(P,T)}),Xe(()=>t(),()=>{n(ae,t().activeStates&&t().activeStates.length>0?t().activeStates.reduce((T,E)=>T+(E.acBonus||0),0):0)}),Xe(()=>t(),()=>{n(ie,t().activeStates&&t().activeStates.length>0?t().activeStates.some(T=>T.name==="Aid"&&T.target==="self"):!1)}),Xe(()=>f(),()=>{n(G,!f()||"armor class".includes(f().toLowerCase())||"initiative".includes(f().toLowerCase())||"speed".includes(f().toLowerCase())||"hit points".includes(f().toLowerCase())||"hp".includes(f().toLowerCase())||"hit dice".includes(f().toLowerCase())||"spell save".includes(f().toLowerCase())||"combat".includes(f().toLowerCase()))}),pa(),zt();var J=Yl();let Ee;var de=l(J);{let T=kt(()=>(p(),r(()=>p().combatStats?"Expand":"Collapse")));Sa(de,{title:"Combat Stats",get collapsed(){return p(),r(()=>p().combatStats)},get ariaLabel(){return e(T)},onToggle:()=>aa.update(E=>({...E,combatStats:!E.combatStats}))})}var ge=a(de,2);{var Te=T=>{var E=Jl(),$=Se(E);{var Y=se=>{var Re=Wl(),we=a(l(Re),2),ze=l(we),Ne=a(l(ze),2);L(()=>{t(),qt(()=>{})});var Qe=l(Ne);Qe.value=(Qe.__value=void 0)??"";var ot=a(Qe);Lt(ot,1,()=>Ps,Bt,(W,le)=>{var Me=bt(),Oe=Se(Me);{var Fe=Ae=>{var ct=zl(),ft=l(ct);s(ct);var Pe={};L(()=>{k(ft,`${e(le),r(()=>e(le).name)??""} (AC ${e(le),r(()=>e(le).baseAC)??""})`),Pe!==(Pe=(e(le),r(()=>e(le).name)))&&(ct.value=(ct.__value=(e(le),r(()=>e(le).name)))??"")}),o(Ae,ct)};g(Oe,Ae=>{e(le),r(()=>e(le).name!=="Unarmored")&&Ae(Fe)})}o(W,Me)}),s(Ne),s(ze);var oe=a(ze,2),D=l(oe),O=l(D);ke(O),ta(),s(D),s(oe),s(we),s(Re),Ua(Ne,()=>t().armorName,W=>Ot(ve,r(t).armorName=W,r(t))),La(O,()=>t().shieldEquipped,W=>Ot(ve,r(t).shieldEquipped=W,r(t))),o(se,Re)};g($,se=>{m()&&se(Y)})}var b=a($,2),M=l(b),K=l(M),$e=a(l(K),2);ls($e,{get tooltipContent(){return e(V)},ariaLabel:"Show AC breakdown"}),s(K);var Le=a(K,2);ke(Le),s(M);var pe=a(M,2),ce=l(pe),je=a(l(ce),2);ls(je,{get tooltipContent(){return e(F)},ariaLabel:"Show Initiative breakdown"}),s(ce);var Ge=a(ce,2);ke(Ge),s(pe);var tt=a(pe,2),pt=a(l(tt),2);ke(pt),s(tt);var rt=a(tt,2);{var Ke=se=>{var Re=Kl(),we=l(Re),ze=a(l(we),2);ls(ze,{get tooltipContent(){return e(X)},ariaLabel:"Show Spell Save DC breakdown"}),s(we);var Ne=a(we,2);ke(Ne),s(Re),L(()=>Ea(Ne,e(x))),o(se,Re)};g(rt,se=>{e(x)!==null&&se(Ke)})}s(b);var yt=a(b,2),Ct=a(l(yt),2);let w;var z=l(Ct),h=l(z);ke(h);var U=a(h,4);ke(U),s(z);var Q=a(z,2),re=l(Q),be=a(re,2),he=a(be,2),Be=a(he,2);s(Q),s(Ct);var te=a(Ct,2),S=a(l(te),2);ke(S),s(te),s(yt);var Z=a(yt,2),Ce=a(l(Z),2),qe=l(Ce);ke(qe);var Ye=a(qe,4);ke(Ye);var mt=a(Ye,2);{var _e=se=>{const Re=kt(()=>(H(oa),t(),r(()=>oa(t().class))));var we=bt(),ze=Se(we);{var Ne=Qe=>{const ot=kt(()=>(v(),r(()=>v().constitution)));var oe=Vl(),D=l(oe);s(oe),L(()=>k(D,`(${H(e(Re)),r(()=>e(Re).hitDice)??""}${(e(ot)>=0?`+${e(ot)}`:e(ot))??""})`)),o(Qe,oe)};g(ze,Qe=>{e(Re)&&Qe(Ne)})}o(se,we)};g(mt,se=>{t(),r(()=>t().class)&&se(_e)})}s(Ce);var ee=a(Ce,2),d=a(l(ee),2),Ve=l(d),ye=a(Ve,2);ke(ye);var N=a(ye,2);s(d);var me=a(d,2);s(ee),s(Z),L(()=>{Ea(Le,(e(ae),t(),r(()=>e(ae)!==0?`${t().armorClass} ‚Üí ${t().armorClass+e(ae)}`:`${t().armorClass}`))),Mt(Le,1,rl(e(ae)!==0?"stat-input ac-enhanced":"stat-input"),"svelte-1r5hyyb"),Ea(Ge,(t(),r(()=>t().initiative))),w=Mt(Ct,1,"hp-display svelte-1r5hyyb",null,w,{"aid-active":e(ie)}),et(h,"max",(t(),r(()=>t().maxHP))),et(qe,"max",(t(),r(()=>t().hitDice.max))),Ve.disabled=e(P)<=1,et(ye,"max",(t(),r(()=>t().hitDice.current))),N.disabled=(e(P),t(),r(()=>e(P)>=t().hitDice.current)),me.disabled=(t(),r(()=>t().hitDice.current<=0||!t().class))}),Ue(pt,()=>t().speed,se=>Ot(ve,r(t).speed=se,r(t))),Ue(h,()=>t().currentHP,se=>Ot(ve,r(t).currentHP=se,r(t))),Ue(U,()=>t().maxHP,se=>Ot(ve,r(t).maxHP=se,r(t))),j("click",re,()=>q(-1)),j("click",be,()=>q(1)),j("click",he,()=>q(-5)),j("click",Be,()=>q(5)),Ue(S,()=>t().tempHP,se=>Ot(ve,r(t).tempHP=se,r(t))),Ue(qe,()=>t().hitDice.current,se=>Ot(ve,r(t).hitDice.current=se,r(t))),Ue(Ye,()=>t().hitDice.max,se=>Ot(ve,r(t).hitDice.max=se,r(t))),j("click",Ve,()=>De(-1)),Ue(ye,()=>e(P),se=>n(P,se)),j("input",ye,se=>{const Re=se.target,we=parseInt(Re.value);we>t().hitDice.current&&n(P,t().hitDice.current),we<1&&n(P,1)}),j("click",N,()=>De(1)),j("click",me,()=>Je(e(P))),o(T,E)};g(ge,T=>{p(),r(()=>!p().combatStats)&&T(Te)})}s(J),L(()=>Ee=Mt(J,1,"combat-stats svelte-1r5hyyb",null,Ee,{hidden:!e(G)})),o(i,J),Kt(),y()}const Ga={acrobatics:"dexterity",animalHandling:"wisdom",arcana:"intelligence",athletics:"strength",deception:"charisma",history:"intelligence",insight:"wisdom",intimidation:"charisma",investigation:"intelligence",medicine:"wisdom",nature:"intelligence",perception:"wisdom",performance:"charisma",persuasion:"charisma",religion:"intelligence",sleightOfHand:"dexterity",stealth:"dexterity",survival:"wisdom"};var Xl=u('<div class="skill-row svelte-1f1pl16"><input type="checkbox" class="svelte-1f1pl16"/> <label class="svelte-1f1pl16"> <span class="ability-tag svelte-1f1pl16"> </span></label> <span class="skill-modifier svelte-1f1pl16"> </span> <button class="roll-btn svelte-1f1pl16">Roll</button></div>'),Zl=u('<div class="skills-grid svelte-1f1pl16"></div>'),ei=u("<section><!> <!></section>");function ti(i,c){Wt(c,!1);const t=()=>ut(ve,"$character",A),v=()=>ut(Ya,"$abilityModifiers",A),f=()=>ut(_a,"$searchFilter",A),p=()=>ut(aa,"$collapsedStates",A),m=()=>ut(xa,"$isEditMode",A),[A,y]=ca(),x=C(),V=C(),F=C(),X=C(),ae=C(),ie=C(),G=$a(),B=[{key:"acrobatics",label:"Acrobatics"},{key:"animalHandling",label:"Animal Handling"},{key:"arcana",label:"Arcana"},{key:"athletics",label:"Athletics"},{key:"deception",label:"Deception"},{key:"history",label:"History"},{key:"insight",label:"Insight"},{key:"intimidation",label:"Intimidation"},{key:"investigation",label:"Investigation"},{key:"medicine",label:"Medicine"},{key:"nature",label:"Nature"},{key:"perception",label:"Perception"},{key:"performance",label:"Performance"},{key:"persuasion",label:"Persuasion"},{key:"religion",label:"Religion"},{key:"sleightOfHand",label:"Sleight of Hand"},{key:"stealth",label:"Stealth"},{key:"survival",label:"Survival"}];function P(de){const ge=Ga[de],Te=v()[ge],T=t().skillProficiencies[de]?t().proficiencyBonus:0,E=e(x)[de],$=`1d20${E>=0?"+":""}${E}`,Y=[];Y.push({value:"1d20",source:"base die"}),Te!==0&&Y.push({value:Te,source:ge}),T!==0&&Y.push({value:T,source:"proficiency"}),G("roll",{notation:$,rollType:"check",bonusBreakdown:Y})}Xe(()=>{},()=>{n(x,{})}),Xe(()=>t(),()=>{n(V,t().skillProficiencies)}),Xe(()=>t(),()=>{n(F,t().proficiencyBonus)}),Xe(()=>v(),()=>{n(X,v())}),Xe(()=>(e(X),e(V),e(F)),()=>{for(const{key:de}of B){const ge=Ga[de],Te=e(X)[ge],T=e(V)[de]?e(F):0;ba(x,e(x)[de]=Te+T)}}),Xe(()=>f(),()=>{n(ae,B.filter(({label:de})=>f()?de.toLowerCase().includes(f().toLowerCase()):!0))}),Xe(()=>e(ae),()=>{n(ie,e(ae).length>0)}),pa(),zt();var q=ei();let De;var Je=l(q);{let de=kt(()=>(p(),r(()=>p().skills?"Expand":"Collapse")));Sa(Je,{title:"Skills",get collapsed(){return p(),r(()=>p().skills)},get ariaLabel(){return e(de)},onToggle:()=>aa.update(ge=>({...ge,skills:!ge.skills}))})}var J=a(Je,2);{var Ee=de=>{var ge=Zl();Lt(ge,5,()=>e(ae),Bt,(Te,T)=>{let E=()=>e(T).key,$=()=>e(T).label;var Y=Xl(),b=l(Y);ke(b);var M=a(b,2),K=l(M),$e=a(K),Le=l($e);s($e),s(M);var pe=a(M,2),ce=l(pe);s(pe);var je=a(pe,2);s(Y),L(Ge=>{Ms(b,(e(V),E(),r(()=>e(V)[E()]))),b.disabled=!m(),et(b,"id",E()),et(M,"for",E()),k(K,`${$()??""} `),k(Le,`(${Ge??""})`),k(ce,`${e(x),E(),r(()=>e(x)[E()]>=0?"+":"")??""}${e(x),E(),r(()=>e(x)[E()])??""}`)},[()=>(H(Ga),E(),r(()=>Ga[E()].substring(0,3).toUpperCase()))]),j("change",b,Ge=>{console.log("Skill proficiency changed:",E(),Ge.target.checked),ve.update(tt=>({...tt,skillProficiencies:{...tt.skillProficiencies,[E()]:Ge.target.checked}}))}),j("click",je,()=>P(E())),o(Te,Y)}),s(ge),o(de,ge)};g(J,de=>{p(),r(()=>!p().skills)&&de(Ee)})}s(q),L(()=>De=Mt(q,1,"skills svelte-1f1pl16",null,De,{hidden:!e(ie)})),o(i,q),Kt(),y()}var ai=u('<p class="empty-message svelte-1123ljy">No attacks or spells to reorder.</p>'),si=u('<li class="reorder-item svelte-1123ljy"><span class="attack-name svelte-1123ljy"> </span> <div class="reorder-buttons svelte-1123ljy"><button class="btn-move svelte-1123ljy" aria-label="Move up">‚ñ≤</button> <button class="btn-move svelte-1123ljy" aria-label="Move down">‚ñº</button></div></li>'),li=u('<ul class="reorder-list svelte-1123ljy"></ul>'),ii=u('<div class="modal-backdrop svelte-1123ljy" role="presentation"><div class="modal-content svelte-1123ljy" role="dialog" aria-modal="true" aria-labelledby="modal-title"><div class="modal-header svelte-1123ljy"><h3 id="modal-title" class="svelte-1123ljy">Reorder Attacks & Spells</h3> <button class="btn-close svelte-1123ljy" aria-label="Close">√ó</button></div> <div class="modal-body svelte-1123ljy"><!></div> <div class="modal-footer svelte-1123ljy"><button class="btn btn-secondary svelte-1123ljy">Cancel</button> <button class="btn btn-primary svelte-1123ljy">Save Order</button></div></div></div>');function ri(i,c){Wt(c,!1);let t=jt(c,"show",8,!1),v=jt(c,"attacks",24,()=>[]),f=jt(c,"onSave",8),p=jt(c,"onCancel",8),m=C([]);function A(B,P){const q=e(m)[B];ba(m,e(m)[B]=e(m)[P]),ba(m,e(m)[P]=q),n(m,[...e(m)])}function y(B){B>0&&A(B,B-1)}function x(B){B<e(m).length-1&&A(B,B+1)}function V(){f()(e(m))}function F(){p()()}function X(B){B.target===B.currentTarget&&F()}Xe(()=>(H(t()),H(v())),()=>{t()&&n(m,[...v()])}),pa(),zt();var ae=bt(),ie=Se(ae);{var G=B=>{var P=ii(),q=l(P),De=l(q),Je=a(l(De),2);s(De);var J=a(De,2),Ee=l(J);{var de=$=>{var Y=ai();o($,Y)},ge=$=>{var Y=li();Lt(Y,7,()=>e(m),b=>b.id,(b,M,K)=>{var $e=si(),Le=l($e),pe=l(Le,!0);s(Le);var ce=a(Le,2),je=l(ce),Ge=a(je,2);s(ce),s($e),L(()=>{k(pe,(e(M),r(()=>e(M).name||"(Unnamed attack or spell)"))),je.disabled=e(K)===0,Ge.disabled=(H(e(K)),e(m),r(()=>e(K)===e(m).length-1))}),j("click",je,()=>y(e(K))),j("click",Ge,()=>x(e(K))),o(b,$e)}),s(Y),o($,Y)};g(Ee,$=>{e(m),r(()=>e(m).length===0)?$(de):$(ge,!1)})}s(J);var Te=a(J,2),T=l(Te),E=a(T,2);s(Te),s(q),s(P),j("click",Je,F),j("click",T,F),j("click",E,V),j("click",P,X),o(B,P)};g(ie,B=>{t()&&B(G)})}o(i,ae),Kt()}let qa=null,za=null;async function Es(){if(qa)return qa;try{return qa=await(await fetch(Fs("/data/spells.json"))).json(),qa||[]}catch(i){return console.error("Failed to load spells:",i),[]}}async function ni(){if(za)return za;try{return za=await(await fetch(Fs("/data/feats.json"))).json(),za||[]}catch(i){return console.error("Failed to load feats:",i),[]}}function Cs(i,c){if(!c.trim())return i;const t=c.toLowerCase();return i.filter(v=>v.name.toLowerCase().includes(t)||v.school.toLowerCase().includes(t)||v.classes.some(f=>f.toLowerCase().includes(t))||v.description.toLowerCase().includes(t))}function oi(i,c){return c===null?i:i.filter(t=>t.level===c)}function ci(i,c){if(!c.trim())return i;const t=c.toLowerCase();return i.filter(v=>v.name.toLowerCase().includes(t)||v.description.toLowerCase().includes(t))}function Wa(i){const c=i.description,t=/\b(Strength|Dexterity|Constitution|Intelligence|Wisdom|Charisma)\s+saving\s+throw/i,v=c.match(t);if(!v)return null;const f=v[1].toLowerCase(),m=/half\s+(?:as\s+much\s+)?damage\s+on\s+a\s+successful(?:\s+save)?/i.test(c),y=/saving\s+throw\s+or\s+take.*?damage/i.test(c)&&!m;return{ability:f,halfDamageOnSave:m,noDamageOnSave:y}}function vi(i){const c=i.description;return/(plus|add)\s+your\s+spellcasting\s+(ability\s+)?modifier/i.test(c)}function Da(i){const c=i.description.toLowerCase();return c.includes("ranged spell attack")||c.includes("melee spell attack")}function Ka(i){const c=i.description.toLowerCase();if(["Divine Favor","Bless","Aid","Command"].includes(i.name))return!0;const f=["takes","take","deals","deal","damage equal to","force damage","fire damage","cold damage","lightning damage","thunder damage","acid damage","poison damage","necrotic damage","radiant damage","psychic damage","regain","regains","hit point"].some(A=>c.includes(A));return["bonus to attack","bonus to damage","bonus to ac","gains a +","gain a +","+1 bonus","+2 bonus","+3 bonus","advantage on","becomes a magic weapon"].some(A=>c.includes(A))&&!f}function di(i){const c=i.description;let t=0,v=0,f=0,p="";const m=c.match(/\+(\d+)\s+bonus\s+to\s+attack\s+rolls\s+and\s+damage\s+rolls/i);if(m){const y=parseInt(m[1]);t=y,v=y,p=`+${y} to attack and damage rolls`}if(i.name==="Bless"&&(p="Add 1d4 to attack rolls and saves",t="1d4"),i.name==="Aid")return p="+5 HP (max and current) for 8 hours",{attackBonus:0,damageBonus:0,acBonus:0,hpBonus:5,description:p,name:i.name};i.name==="Divine Favor"&&(p="Your weapon attacks deal an extra 1d4 radiant damage on a hit.",v="1d4");const A=c.match(/\+(\d+)\s+bonus\s+to\s+AC/i);return A&&(f=parseInt(A[1]),p=`+${f} to AC`),i.name==="Haste"&&(p="+2 AC, doubled speed, extra action",f=2),p||t!==0||v!==0||f!==0?{attackBonus:t,damageBonus:v,acBonus:f,description:p||i.description.substring(0,100),name:i.name}:null}function is(i){const c=i.description,t=/takes?\s+(\d+d\d+)\s+\w+\s+damage[^.]*\.\s*If\s+the\s+target\s+is\s+missing.*?instead\s+takes?\s+(\d+d\d+)/is,v=c.match(t);return v?{baseDamage:v[1],alternateDamage:v[2]}:null}var ui=u('<button class="btn btn-secondary">Reorder</button>'),fi=u('<div class="edit-buttons svelte-14o91c5"><button class="btn btn-secondary">Add Attack</button> <!></div>'),pi=u('<input type="text" placeholder="Attack name" class="attack-name svelte-14o91c5"/>'),mi=u('<h4 class="attack-name-display svelte-14o91c5"> </h4>'),gi=u('<button class="btn-remove svelte-14o91c5">√ó</button>'),bi=u('<div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Bonus</label> <input type="number" class="attack-bonus svelte-14o91c5"/></div>'),hi=u('<div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Damage</label> <input type="text" placeholder="e.g., 2d6+3" class="attack-damage svelte-14o91c5"/></div>'),_i=u('<div class="spell-info-loading svelte-14o91c5">Loading spell info...</div>'),yi=u('<li class="svelte-14o91c5"><strong>At Higher Levels:</strong> </li>'),xi=u('<li style="color: #007bff;" class="svelte-14o91c5"><strong>Special:</strong> Mage Hand is invisible when cast via Githyanki Psionics.</li>'),$i=u('<li style="color: #007bff;" class="svelte-14o91c5"><strong>Cast via:</strong> </li>'),wi=u("<!> <!>",1),Si=u('<ul class="svelte-14o91c5"><li class="svelte-14o91c5"><strong>Level:</strong> </li> <li class="svelte-14o91c5"><strong>Casting Time:</strong> </li> <li class="svelte-14o91c5"><strong>Range:</strong> </li> <li class="svelte-14o91c5"><strong>Components:</strong> <!></li> <li class="svelte-14o91c5"><strong>Duration:</strong> <!> </li> <li class="svelte-14o91c5"><strong>Description:</strong> </li> <!> <!></ul>'),ki=u('<span class="scaled-damage svelte-14o91c5" style="margin-left: 8px;"> </span>'),Ci=u('<span class="scaled-damage svelte-14o91c5">(Half damage)</span>'),Di=u('<span class="scaled-damage svelte-14o91c5">(No damage)</span>'),Li=u('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> <!> <!></label></div>'),ji=u('<span class="scaled-damage svelte-14o91c5"> </span>'),Ai=u('<span class="scaled-damage svelte-14o91c5"> </span>'),Bi=u('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> Target is missing HP <!></label></div>'),Ri=u("<option> </option>"),Ti=u('<span class="scaled-damage svelte-14o91c5"><!> </span>'),Mi=u('<span class="scaled-damage svelte-14o91c5"> </span>'),Fi=u('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> Target is Fiend or Undead <!></label></div>'),Pi=u('<div class="spell-level-selector svelte-14o91c5"><label class="svelte-14o91c5">Cast at Level:</label> <select class="spell-level-select use-enabled svelte-14o91c5"></select> <!></div> <!>',1),Ii=u('<div class="spell-info svelte-14o91c5"><div class="spell-info-header svelte-14o91c5" role="button" tabindex="0"><h4 class="svelte-14o91c5">Spell Info</h4> <button class="collapse-btn-small svelte-14o91c5"> </button></div> <!></div> <!> <!> <!>',1),Ei=u('<div class="spell-info-missing svelte-14o91c5">Spell info not found.</div>'),Hi=u('<div class="attack-notes svelte-14o91c5"><label class="svelte-14o91c5">Notes</label> <textarea placeholder="e.g., DC 15 Dex save, Range 120 ft, Concentration" class="notes-input svelte-14o91c5" rows="2"></textarea></div>'),Ui=u('<div style="margin-bottom: 0.5em;"><label style="font-size:0.95em;"><input type="checkbox" class="svelte-14o91c5"/> Use Racial Trait <span style="color:#007bff; font-size:0.95em; margin-left:0.5em;"> </span></label></div>'),Ni=u('<button class="btn btn-primary">Roll Attack (Spell Slot)</button>'),Oi=u('<button class="btn btn-primary" disabled>No spell slots available</button>'),Gi=u('<button class="btn btn-primary">Roll Attack (Racial Trait)</button>'),qi=u('<button class="btn btn-primary" disabled>No racial uses left</button>'),zi=u('<div class="buff-target-selection svelte-14o91c5"><div class="target-options svelte-14o91c5"><label class="target-option svelte-14o91c5"><input type="radio" class="svelte-14o91c5"/> Self</label> <label class="target-option svelte-14o91c5"><input type="radio" class="svelte-14o91c5"/> Other</label></div> <button class="btn btn-info"> </button></div>'),Wi=u('<button class="btn btn-info">Cast Spell</button>'),Ki=u("<button><!></button>"),Vi=u('<button class="btn btn-info">Cast Spell</button>'),Ji=u("<!> <!> <!> <!>",1),Yi=u('<button class="btn btn-secondary">Roll Damage</button>'),Qi=u('<button class="btn btn-primary">Roll Attack</button> <!>',1),Xi=u('<div class="attack-card svelte-14o91c5"><div class="attack-header svelte-14o91c5"><!> <!></div> <div class="attack-details svelte-14o91c5"><!> <!> <div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Type</label> <input type="text" placeholder="e.g., slashing" class="attack-type svelte-14o91c5"/></div></div> <!> <!> <div class="attack-actions svelte-14o91c5"><!> <!></div></div>'),Zi=u('<p class="no-attacks svelte-14o91c5">No attacks added yet. Click "Add Attack" to create one.</p>'),er=u('<p class="no-attacks svelte-14o91c5">No attacks match your search.</p>'),tr=u('<span class="ability-uses svelte-14o91c5"> <!></span>'),ar=u('<span class="ability-reaction svelte-14o91c5">‚ö° Reaction</span>'),sr=u('<button class="btn btn-ability svelte-14o91c5">Use Ability</button>'),lr=u('<div class="ability-card svelte-14o91c5"><div class="ability-header svelte-14o91c5"><h4 class="ability-name svelte-14o91c5"> </h4> <span class="ability-source svelte-14o91c5"> </span></div> <p class="ability-description svelte-14o91c5"> </p> <div class="ability-footer svelte-14o91c5"><!> <!> <!></div></div>'),ir=u('<div class="condition-abilities-section svelte-14o91c5"><h3 class="abilities-header svelte-14o91c5">Condition Abilities</h3> <p class="section-description svelte-14o91c5">Special actions granted by active conditions (e.g., Flicker of Deceit)</p> <div class="abilities-list svelte-14o91c5"></div></div>'),rr=u('<button class="btn-remove svelte-14o91c5">√ó</button>'),nr=u('<div class="state-card svelte-14o91c5"><div class="state-header svelte-14o91c5"><input type="text" placeholder="Effect name (e.g., Magic Weapon)" class="state-name svelte-14o91c5"/> <!></div> <div class="state-details svelte-14o91c5"><div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Attack Bonus</label> <input type="number" class="state-bonus svelte-14o91c5"/></div> <div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Damage Bonus</label> <input type="text" class="state-bonus svelte-14o91c5"/></div> <div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Target</label> <select class="state-bonus svelte-14o91c5"><option>Self</option><option>Other</option></select></div></div> <div class="state-description svelte-14o91c5"><label class="svelte-14o91c5">Description</label> <input type="text" placeholder="e.g., +1 to attack and damage rolls (Magic Weapon)" class="state-desc-input svelte-14o91c5"/></div></div>'),or=u('<div class="states-list svelte-14o91c5"></div>'),cr=u('<p class="no-states svelte-14o91c5">No active effects. Add spell effects that modify your attacks.</p>'),vr=u('<!> <div class="attacks-list svelte-14o91c5"><!> <!> <!></div> <!> <div class="active-states-section svelte-14o91c5"><h3 class="svelte-14o91c5">Active Spell Effects</h3> <p class="section-description svelte-14o91c5">Effects that modify attack and damage rolls (e.g., Magic Weapon, Bless)</p> <button class="btn btn-secondary">Add Effect</button> <!></div>',1),dr=u("<section><!> <!></section> <!>",1);function ur(i,c){Wt(c,!1);const t=()=>ut(ve,"$character",m),v=()=>ut(_a,"$searchFilter",m),f=()=>ut(aa,"$collapsedStates",m),p=()=>ut(xa,"$isEditMode",m),[m,A]=ca(),y=C(),x=C(),V=C(),F=[];let X=C({});function ae(w,z){ve.update(h=>{if(!h.activeStates)return h;const U=h.activeStates.findIndex(he=>he.name===w);if(U===-1)return h;const Q=h.activeStates[U];if(!Q.abilities)return h;const re=Q.abilities.findIndex(he=>he.name===z);if(re===-1)return h;const be=Q.abilities[re];return be.currentUses!==void 0&&be.currentUses>0&&(be.currentUses-=1,be.usesPerRest!==void 0?Ht.add(`Used ${z} (${be.currentUses}/${be.usesPerRest} remaining)`,"info"):Ht.add(`Used ${z}`,"info")),h})}const ie=$a();let G=C({}),B=C({}),P=C(!1);function q(w){ba(G,e(G)[w]=!e(G)[w]),n(G,{...e(G)})}function De(w){return w.description.toLowerCase().includes("regain")&&(w.description.toLowerCase().includes("hit point")||w.description.toLowerCase().includes("hp"))}function Je(w){return["Shield of Faith","Bless","Aid","Magic Weapon"].includes(w)}function J(){ve.update(w=>(w.attacks=[...w.attacks,{id:crypto.randomUUID(),name:"",bonus:0,damage:"",damageType:"",notes:""}],w))}function Ee(w){ve.update(z=>(z.attacks=z.attacks.filter(h=>h.id!==w),z))}function de(){n(P,!0)}function ge(){n(P,!1)}function Te(w){ve.update(z=>(z.attacks=w,z)),n(P,!1),Ht.add("Attack order updated successfully!","success")}function T(w,z){let h=w.damage,U=!1,Q=!1;if(w.spellRef){const te=b(w.spellRef);if(te&&(Q=Da(te),te.level>0)){const S=w.castAtLevel||te.level;let Z=!1;if(z||w.source==="racial"){if(Z=K(w.name),!Z){Ht.add(`No uses of ${w.name} remaining!`,"error");return}}else if(Z=M(S),!Z){Ht.add(`No level ${S} spell slots available!`,"error");return}const qe=Wa(te);qe&&w.targetSucceededSave&&qe.noDamageOnSave?h="0":(U=qe?.halfDamageOnSave&&w.targetSucceededSave||!1,h=$e(w,te))}}else if(t().activeStates&&t().activeStates.length>0){let te=0,S=[];for(const Z of t().activeStates)Z.target!=="other"&&(typeof Z.damageBonus=="string"?S.push(Z.damageBonus):typeof Z.damageBonus=="number"&&(te+=Z.damageBonus));if((te!==0||S.length>0)&&h){const Z=h.match(/(\d+d\d+)([+-]\d+)?/);if(Z){const[,Ce,qe]=Z,mt=(qe?parseInt(qe):0)+te;let _e=`${Ce}`;mt!==0&&(_e+=`${mt>=0?"+":""}${mt}`),S.length>0&&(_e+=" + "+S.join(" + ")),h=_e}}}const re=[];let be=0;if(Q){const te=ss(t(),t().abilities),S=t().proficiencyBonus||0;re.push({value:S,source:"proficiency"}),re.push({value:te,source:"spellcasting"}),be=S+te}else w.bonus!==0&&re.push({value:w.bonus,source:"base"}),be=w.bonus;let he=[];if(t().activeStates)for(const te of t().activeStates)te.target!=="other"&&(typeof te.attackBonus=="number"&&te.attackBonus!==0?(re.push({value:te.attackBonus,source:te.name.toLowerCase()}),be+=te.attackBonus):typeof te.attackBonus=="string"&&te.attackBonus&&he.push(te.attackBonus));let Be=`1d20${be>=0?"+":""}${be}`;he.length>0&&(Be+="+"+he.join("+")),ie("roll",{notation:Be,damageNotation:h,attackName:w.name,applyHalfDamage:U,bonusBreakdown:re,rollType:"attack"})}function E(w){if(!w.damage){Ht.add(`${w.name}: No damage specified`,"error");return}let z=w.damage,h=!1;const U=[];let Q=w.damageType||"";if(w.spellRef){const re=b(w.spellRef);if(re){const be=De(re);if(be){const he=ss(t(),t().abilities),Be=z.match(/^(\d+d\d+)/);Be&&(z=Be[1],he>0&&(z+=`+${he}`,U.push({value:he,source:"spellcasting"}))),Q="Healing"}if(re.level>0){const he=w.castAtLevel||re.level;let Be=!1;if(w.source==="racial"){if(Be=K(w.name),!Be){Ht.add(`No uses of ${w.name} remaining!`,"error");return}}else if(Be=M(he),!Be){Ht.add(`No level ${he} spell slots available!`,"error");return}const te=Wa(re);te&&w.targetSucceededSave&&te.noDamageOnSave?z="0":(h=te?.halfDamageOnSave&&w.targetSucceededSave||!1,be||(z=$e(w,re)))}}}else{const re=z.match(/(\d+d\d+)([+-]\d+)?/);if(re){const[,be,he]=re,Be=he?parseInt(he):0;if(Be!==0&&U.push({value:Be,source:"base"}),t().activeStates&&t().activeStates.length>0){let te=0,S=[];for(const Z of t().activeStates)Z.target!=="other"&&(typeof Z.damageBonus=="string"?S.push(Z.damageBonus):typeof Z.damageBonus=="number"&&Z.damageBonus!==0&&(U.push({value:Z.damageBonus,source:Z.name.toLowerCase()}),te+=Z.damageBonus));if(te!==0||S.length>0){const Z=Be+te;let Ce=`${be}`;Z!==0&&(Ce+=`${Z>=0?"+":""}${Z}`),S.length>0&&(Ce+=" + "+S.join(" + ")),z=Ce}}}}ie("roll",{notation:z,attackName:w.name,applyHalfDamage:h,bonusBreakdown:U,damageType:Q})}let $=C([]),Y=C(!1);wa(async()=>{n($,await Es()),n(Y,!0)});function b(w){return e($).find(z=>z.name===w)}function M(w){t().classFeatures.spellSlotsByLevel||Ot(ve,r(t).classFeatures.spellSlotsByLevel={},r(t)),t().classFeatures.spellSlotsByLevel[w]||Ot(ve,r(t).classFeatures.spellSlotsByLevel[w]=Array(2).fill(!1),r(t));const h=t().classFeatures.spellSlotsByLevel[w].findIndex(U=>!U);return h===-1?!1:(ve.update(U=>(U.classFeatures.spellSlotsByLevel||(U.classFeatures.spellSlotsByLevel={}),U.classFeatures.spellSlotsByLevel[w]||(U.classFeatures.spellSlotsByLevel[w]=Array(2).fill(!1)),U.classFeatures.spellSlotsByLevel[w][h]=!0,U)),!0)}function K(w){return!t().racialTraits||!t().racialTraits.uses[w]?!0:t().racialTraits.uses[w].currentUses<=0?!1:(nl(w),!0)}function $e(w,z){let h=w.damage,U=0,Q=0;const re=is(z);if(re&&w.targetIsDamaged&&(h=re.alternateDamage),vi(z)&&(Q+=ss(t(),t().abilities)),t().activeStates)for(const Ye of t().activeStates)Ye.target!=="other"&&typeof Ye.damageBonus=="number"&&(Q+=Ye.damageBonus);if(z.higherLevelSlot&&w.castAtLevel){const Ye=z.level,_e=(w.castAtLevel||Ye)-Ye;if(_e>0){const ee=z.higherLevelSlot.match(/(\d+)d(\d+)\s+for\s+each.*?level\s+above/i);if(ee){const[,d]=ee;U+=_e*parseInt(d)}}}if(w.targetIsFiendOrUndead&&z.description.includes("Fiend or an Undead")){const Ye=z.description.match(/increases by (\d+)d(\d+) if.*?Fiend or.*?Undead/i);if(Ye){const[,mt]=Ye;U+=parseInt(mt)}}const be=h.match(/(\d+)d(\d+)([+-]\d+)?/);if(!be)return Q!==0?Q>=0?`${Q}`:`${Q}`:h||"0";const[,he,Be,te]=be,S=parseInt(he)+U,Ce=(te?parseInt(te):0)+Q;let qe=`${S}d${Be}`;return Ce!==0&&(qe+=Ce>=0?`+${Ce}`:`${Ce}`),qe}function Le(w){const z=[];for(let U=w.level;U<=9;U++){const Q=t().classFeatures.spellSlotsByLevel?.[U];Q&&Q.length>0&&z.push(U)}return z}function pe(){ve.update(w=>(w.activeStates||(w.activeStates=[]),w.activeStates=[...w.activeStates,{name:"",attackBonus:0,damageBonus:0,description:"",target:"self"}],w))}function ce(w){ve.update(z=>{if(z.activeStates){const h=z.activeStates[w];h?.hpBonus&&h.target!=="other"&&(z.maxHP-=h.hpBonus,z.currentHP=Math.max(1,Math.min(z.currentHP-h.hpBonus,z.maxHP))),z.activeStates=z.activeStates.filter((U,Q)=>Q!==w)}return z})}function je(w,z="self"){const h=b(w.spellRef);if(!h){Ht.add("Spell not found","error");return}const U=w.castAtLevel||h.level;if(U>0){let S=!1;if(w.source==="racial"){if(S=K(w.name),!S){Ht.add(`No uses of ${w.name} remaining!`,"error");return}}else if(S=M(U),!S){Ht.add(`No level ${U} spell slots available!`,"error");return}}const Q=di(h);if(!Q){Ht.add(`${h.name} cast! Check spell description for effects.`,"info");return}let re=Q.hpBonus||0,be=Q.description;h.name==="Aid"&&U>h.level&&(re=5+(U-h.level)*5,be=`+${re} HP (max and current) for 8 hours`);const Be=["Shield of Faith","Bless","Aid","Magic Weapon"].includes(h.name);ve.update(S=>{S.activeStates||(S.activeStates=[]);const Z=S.activeStates.find(Ce=>Ce.name===h.name);return Z&&Z.hpBonus&&Z.target!=="other"&&(S.maxHP-=Z.hpBonus,S.currentHP=Math.max(1,Math.min(S.currentHP-Z.hpBonus,S.maxHP))),S.activeStates=S.activeStates.filter(Ce=>Ce.name!==h.name),re>0&&z==="self"&&(S.maxHP+=re,S.currentHP+=re),S.activeStates=[...S.activeStates,{name:h.name,attackBonus:Q.attackBonus,damageBonus:Q.damageBonus,acBonus:Q.acBonus,description:be,target:z,hpBonus:re}],S});const te=z==="self"?" on self":" on other";Ht.add(`${h.name} cast${Be?te:""}! Effect added to Active Spell Effects.`,"success")}Xe(()=>t(),()=>{n(y,t().activeStates?t().activeStates.filter(w=>w.abilities&&w.abilities.length>0).flatMap(w=>w.abilities.map(z=>({...z,conditionName:w.name}))):[])}),Xe(()=>(t(),e(G),e(B)),()=>{if(t()&&t().attacks)for(const w of t().attacks)w.spellRef&&e(G)[w.id]===void 0&&ba(G,e(G)[w.id]=!0),w.spellRef&&e(B)[w.id]===void 0&&ba(B,e(B)[w.id]="self")}),Xe(()=>(t(),v()),()=>{n(x,t().attacks.filter(w=>{if(!v())return!0;const z=v().toLowerCase();return w.name.toLowerCase().includes(z)||w.damageType.toLowerCase().includes(z)}).sort((w,z)=>!w.spellRef&&z.spellRef?-1:w.spellRef&&!z.spellRef?1:0))}),Xe(()=>(v(),e(x)),()=>{n(V,!v()||e(x).length>0||"attack".includes(v().toLowerCase())||"spell".includes(v().toLowerCase()))}),pa(),zt();var Ge=dr(),tt=Se(Ge);let pt;var rt=l(tt);{let w=kt(()=>(f(),r(()=>f().attacks?"Expand":"Collapse")));Sa(rt,{title:"Attacks & Spells",get collapsed(){return f(),r(()=>f().attacks)},get ariaLabel(){return e(w)},onToggle:()=>aa.update(z=>({...z,attacks:!z.attacks}))})}var Ke=a(rt,2);{var yt=w=>{var z=vr(),h=Se(z);{var U=ee=>{var d=fi(),Ve=l(d),ye=a(Ve,2);{var N=me=>{var se=ui();j("click",se,de),o(me,se)};g(ye,me=>{t(),r(()=>t().attacks.length>0)&&me(N)})}s(d),j("click",Ve,J),o(ee,d)};g(h,ee=>{p()&&ee(U)})}var Q=a(h,2),re=l(Q);Lt(re,1,()=>e(x),ee=>ee.id,(ee,d,Ve)=>{var ye=Xi(),N=l(ye),me=l(N);{var se=ue=>{var ne=pi();ke(ne),Ue(ne,()=>e(d).name,Ze=>(e(d).name=Ze,qt(()=>(e(x),t(),v())))),o(ue,ne)},Re=ue=>{var ne=mi(),Ze=l(ne,!0);s(ne),L(()=>k(Ze,(e(d),r(()=>e(d).name||"(Unnamed Attack)")))),o(ue,ne)};g(me,ue=>{p()?ue(se):ue(Re,!1)})}var we=a(me,2);{var ze=ue=>{var ne=gi();j("click",ne,()=>Ee(e(d).id)),o(ue,ne)};g(we,ue=>{p()&&ue(ze)})}s(N);var Ne=a(N,2),Qe=l(Ne);{var ot=ue=>{var ne=bi(),Ze=l(ne),ht=a(Ze,2);ke(ht),s(ne),L(()=>{et(Ze,"for",`attack-bonus-${e(d),r(()=>e(d).id)??""}`),et(ht,"id",`attack-bonus-${e(d),r(()=>e(d).id)??""}`)}),Ue(ht,()=>e(d).bonus,R=>(e(d).bonus=R,qt(()=>(e(x),t(),v())))),o(ue,ne)};g(Qe,ue=>{e(d),r(()=>e(d).bonus!==0&&e(d).bonus!==void 0)&&ue(ot)})}var oe=a(Qe,2);{var D=ue=>{var ne=hi(),Ze=l(ne),ht=a(Ze,2);ke(ht),s(ne),L(()=>{et(Ze,"for",`attack-damage-${e(d),r(()=>e(d).id)??""}`),et(ht,"id",`attack-damage-${e(d),r(()=>e(d).id)??""}`)}),Ue(ht,()=>e(d).damage,R=>(e(d).damage=R,qt(()=>(e(x),t(),v())))),o(ue,ne)};g(oe,ue=>{e(d),r(()=>e(d).damage&&e(d).damage.trim()!=="")&&ue(D)})}var O=a(oe,2),W=l(O),le=a(W,2);ke(le),s(O),s(Ne);var Me=a(Ne,2);{var Oe=ue=>{var ne=bt(),Ze=Se(ne);{var ht=xe=>{var _=_i();o(xe,_)},R=xe=>{const _=kt(()=>(e(d),r(()=>b(e(d).spellRef))));var He=bt(),I=Se(He);{var Rt=at=>{const fe=kt(()=>(H(Wa),H(e(_)),r(()=>Wa(e(_))))),vt=kt(()=>(H(is),H(e(_)),r(()=>is(e(_)))));var st=Ii(),Ft=Se(st),We=l(Ft),gt=a(l(We),2),xt=l(gt,!0);s(gt),s(We);var Ut=a(We,2);{var ia=lt=>{var It=Si(),Yt=l(It),Qt=a(l(Yt));s(Yt);var na=a(Yt,2),va=a(l(na));s(na);var da=a(na,2),Vt=a(l(da));s(da);var it=a(da,2),dt=a(l(it)),nt=a(dt);{var Tt=St=>{var Jt=Pt();L(()=>k(Jt,`(${H(e(_)),r(()=>e(_).material)??""})`)),o(St,Jt)};g(nt,St=>{H(e(_)),r(()=>e(_).material)&&St(Tt)})}s(it);var Et=a(it,2),ua=a(l(Et),2);{var Nt=St=>{var Jt=Pt("Concentration,");o(St,Jt)};g(ua,St=>{H(e(_)),r(()=>e(_).concentration)&&St(Nt)})}var la=a(ua,1,!0);s(Et);var Gt=a(Et,2),fa=a(l(Gt));s(Gt);var ma=a(Gt,2);{var ka=St=>{var Jt=yi(),ga=a(l(Jt));s(Jt),L(()=>k(ga,` ${H(e(_)),r(()=>e(_).higherLevelSlot)??""}`)),o(St,Jt)};g(ma,St=>{H(e(_)),r(()=>e(_).higherLevelSlot)&&St(ka)})}var Zt=a(ma,2);{var ea=St=>{var Jt=wi(),ga=Se(Jt);{var Ra=Ca=>{var Ma=xi();o(Ca,Ma)};g(ga,Ca=>{e(d),H(e(_)),r(()=>e(d).racialTraitName==="Githyanki Psionics"&&e(_).name==="Mage Hand")&&Ca(Ra)})}var Ta=a(ga,2);{var Xa=Ca=>{var Ma=$i(),Hs=a(l(Ma));s(Ma),L(()=>k(Hs,` ${e(d),r(()=>e(d).racialTraitName)??""}`)),o(Ca,Ma)};g(Ta,Ca=>{e(d),r(()=>e(d).racialTraitName)&&Ca(Xa)})}o(St,Jt)};g(Zt,St=>{e(d),r(()=>e(d).source==="racial")&&St(ea)})}s(It),L(St=>{k(Qt,` ${H(e(_)),r(()=>e(_).level)??""}`),k(va,` ${H(e(_)),r(()=>e(_).castingTime||e(_).actionType)??""}`),k(Vt,` ${H(e(_)),r(()=>e(_).range)??""}`),k(dt,` ${St??""}`),k(la,(H(e(_)),r(()=>e(_).duration))),k(fa,` ${H(e(_)),r(()=>e(_).description)??""}`)},[()=>(H(e(_)),r(()=>e(_).components.join(", ")))]),o(lt,It)};g(Ut,lt=>{e(G),e(d),r(()=>!e(G)[e(d).id])&&lt(ia)})}s(Ft);var wt=a(Ft,2);{var At=lt=>{var It=Li(),Yt=l(It),Qt=l(Yt);ke(Qt);var na=a(Qt),va=a(na);{var da=nt=>{var Tt=ki(),Et=l(Tt);s(Tt),L(ua=>k(Et,`(Spell Save DC: ${ua??""})`),[()=>(H(vs),t(),r(()=>vs(t(),t().abilities)))]),o(nt,Tt)};g(va,nt=>{t(),r(()=>t().class)&&nt(da)})}var Vt=a(va,2);{var it=nt=>{var Tt=Ci();o(nt,Tt)},dt=nt=>{var Tt=bt(),Et=Se(Tt);{var ua=Nt=>{var la=Di();o(Nt,la)};g(Et,Nt=>{e(d),H(e(fe)),r(()=>e(d).targetSucceededSave&&e(fe).noDamageOnSave)&&Nt(ua)},!0)}o(nt,Tt)};g(Vt,nt=>{e(d),H(e(fe)),r(()=>e(d).targetSucceededSave&&e(fe).halfDamageOnSave)?nt(it):nt(dt,!1)})}s(Yt),s(It),L(nt=>k(na,` Target succeeded on ${nt??""} save `),[()=>(H(e(fe)),r(()=>e(fe).ability.charAt(0).toUpperCase()+e(fe).ability.slice(1)))]),La(Qt,()=>e(d).targetSucceededSave,nt=>(e(d).targetSucceededSave=nt,qt(()=>(e(x),t(),v())))),o(lt,It)};g(wt,lt=>{e(fe)&&lt(At)})}var sa=a(wt,2);{var ra=lt=>{var It=Bi(),Yt=l(It),Qt=l(Yt);ke(Qt);var na=a(Qt,2);{var va=Vt=>{const it=kt(()=>(e(d),H(e(_)),r(()=>$e(e(d),e(_)))));var dt=ji(),nt=l(dt);s(dt),L(()=>k(nt,`(${H(e(vt)),r(()=>e(vt).alternateDamage)??""}, total: ${e(it)??""})`)),o(Vt,dt)},da=Vt=>{var it=Ai(),dt=l(it);s(it),L(()=>k(dt,`(${H(e(vt)),r(()=>e(vt).baseDamage)??""})`)),o(Vt,it)};g(na,Vt=>{e(d),r(()=>e(d).targetIsDamaged)?Vt(va):Vt(da,!1)})}s(Yt),s(It),La(Qt,()=>e(d).targetIsDamaged,Vt=>(e(d).targetIsDamaged=Vt,qt(()=>(e(x),t(),v())))),o(lt,It)};g(sa,lt=>{e(vt)&&lt(ra)})}var Xt=a(sa,2);{var Dt=lt=>{const It=kt(()=>(H(e(_)),r(()=>Le(e(_)))));var Yt=bt(),Qt=Se(Yt);{var na=va=>{var da=Pi(),Vt=Se(da),it=l(Vt),dt=a(it,2);L(()=>{e(d),qt(()=>{e(It)})}),Lt(dt,5,()=>e(It),Bt,(Nt,la)=>{var Gt=Ri(),fa=l(Gt);s(Gt);var ma={};L(()=>{k(fa,`Level ${e(la)??""}`),ma!==(ma=e(la))&&(Gt.value=(Gt.__value=e(la))??"")}),o(Nt,Gt)}),s(dt);var nt=a(dt,2);{var Tt=Nt=>{const la=kt(()=>(e(d),H(e(_)),r(()=>$e(e(d),e(_)))));var Gt=Ti(),fa=l(Gt);{var ma=ea=>{var St=Pt("Healing");o(ea,St)},ka=ea=>{var St=Pt("Damage");o(ea,St)};g(fa,ea=>{H(e(_)),r(()=>De(e(_)))?ea(ma):ea(ka,!1)})}var Zt=a(fa);s(Gt),L(()=>k(Zt,` ${e(la)??""}`)),o(Nt,Gt)};g(nt,Nt=>{e(d),H(e(_)),r(()=>e(d).castAtLevel&&e(d).castAtLevel>e(_).level)&&Nt(Tt)})}s(Vt);var Et=a(Vt,2);{var ua=Nt=>{var la=Fi(),Gt=l(la),fa=l(Gt);ke(fa);var ma=a(fa,2);{var ka=Zt=>{const ea=kt(()=>(e(d),H(e(_)),r(()=>$e(e(d),e(_)))));var St=Mi(),Jt=l(St);s(St),L(()=>k(Jt,`(+1d8, total: ${e(ea)??""})`)),o(Zt,St)};g(ma,Zt=>{e(d),r(()=>e(d).targetIsFiendOrUndead)&&Zt(ka)})}s(Gt),s(la),La(fa,()=>e(d).targetIsFiendOrUndead,Zt=>(e(d).targetIsFiendOrUndead=Zt,qt(()=>(e(x),t(),v())))),o(Nt,la)};g(Et,Nt=>{H(e(_)),r(()=>e(_).description.includes("Fiend or an Undead"))&&Nt(ua)})}L(()=>{et(it,"for",`castLevel-${e(d),r(()=>e(d).id)??""}`),et(dt,"id",`castLevel-${e(d),r(()=>e(d).id)??""}`)}),Ua(dt,()=>e(d).castAtLevel,Nt=>(e(d).castAtLevel=Nt,qt(()=>(e(x),t(),v())))),o(va,da)};g(Qt,va=>{H(e(It)),e(X),e(d),r(()=>e(It).length>0&&!e(X)[e(d).id])&&va(na)})}o(lt,Yt)};g(Xt,lt=>{H(e(_)),r(()=>e(_).higherLevelSlot&&e(_).level>0)&&lt(Dt)})}L(()=>{et(gt,"aria-label",(e(G),e(d),r(()=>e(G)[e(d).id]?"Expand":"Collapse"))),k(xt,(e(G),e(d),r(()=>e(G)[e(d).id]?"‚ñº":"‚ñ≤")))}),j("click",We,()=>q(e(d).id)),j("keydown",We,lt=>lt.key==="Enter"&&q(e(d).id)),o(at,st)},_t=at=>{var fe=Ei();o(at,fe)};g(I,at=>{e(_)?at(Rt):at(_t,!1)})}o(xe,He)};g(Ze,xe=>{e($),r(()=>e($).length===0)?xe(ht):xe(R,!1)})}o(ue,ne)};g(Me,ue=>{e(d),r(()=>e(d).spellRef)&&ue(Oe)})}var Fe=a(Me,2);{var Ae=ue=>{var ne=bt(),Ze=Se(ne);{var ht=R=>{var xe=Hi(),_=l(xe),He=a(_,2);ja(He),s(xe),L(()=>{et(_,"for",`attack-notes-${e(d),r(()=>e(d).id)??""}`),et(He,"id",`attack-notes-${e(d),r(()=>e(d).id)??""}`)}),Ue(He,()=>e(d).notes,I=>(e(d).notes=I,qt(()=>(e(x),t(),v())))),o(R,xe)};g(Ze,R=>{e(d),r(()=>e(d).notes&&e(d).notes.trim()!=="")&&R(ht)})}o(ue,ne)};g(Fe,ue=>{e(d),r(()=>!e(d).spellRef)&&ue(Ae)})}var ct=a(Fe,2),ft=l(ct);{var Pe=ue=>{const ne=kt(()=>(e(d),r(()=>b(e(d).spellRef))));var Ze=bt(),ht=Se(Ze);{var R=xe=>{const _=kt(()=>(t(),e(d),r(()=>t().racialTraits&&t().racialTraits.uses[e(d).name])));var He=Ji(),I=Se(He);{var Rt=We=>{var gt=Ui(),xt=l(gt),Ut=l(xt);ke(Ut);var ia=a(Ut,2),wt=l(ia);s(ia),s(xt),s(gt),L(()=>k(wt,`(${H(e(_)),r(()=>e(_).currentUses)??""}/${H(e(_)),r(()=>e(_).maxUses)??""} uses left)`)),La(Ut,()=>e(X)[e(d).id],At=>ba(X,e(X)[e(d).id]=At)),j("change",Ut,()=>{n(X,{...e(X)})}),o(We,gt)};g(I,We=>{e(d),H(e(_)),r(()=>e(d).source==="racial"&&e(_))&&We(Rt)})}var _t=a(I,2);{var at=We=>{var gt=bt(),xt=Se(gt);{var Ut=wt=>{var At=bt(),sa=Se(At);{var ra=Dt=>{var lt=Ni();j("click",lt,()=>T(e(d),!1)),o(Dt,lt)},Xt=Dt=>{var lt=Oi();o(Dt,lt)};g(sa,Dt=>{t(),H(e(ne)),r(()=>t().classFeatures&&t().classFeatures.spellSlotsByLevel&&t().classFeatures.spellSlotsByLevel[e(ne).level]?.some(lt=>!lt))?Dt(ra):Dt(Xt,!1)})}o(wt,At)},ia=wt=>{var At=bt(),sa=Se(At);{var ra=Dt=>{var lt=Gi();j("click",lt,()=>T(e(d),!0)),o(Dt,lt)},Xt=Dt=>{var lt=qi();o(Dt,lt)};g(sa,Dt=>{H(e(_)),r(()=>e(_)&&e(_).currentUses>0)?Dt(ra):Dt(Xt,!1)})}o(wt,At)};g(xt,wt=>{e(X),e(d),r(()=>!e(X)[e(d).id])?wt(Ut):wt(ia,!1)})}o(We,gt)};g(_t,We=>{H(Da),H(e(ne)),r(()=>Da(e(ne)))&&We(at)})}var fe=a(_t,2);{var vt=We=>{var gt=bt(),xt=Se(gt);{var Ut=wt=>{var At=zi(),sa=l(At),ra=l(sa),Xt=l(ra);ke(Xt),Xt.value=Xt.__value="self",ta(),s(ra);var Dt=a(ra,2),lt=l(Dt);ke(lt),lt.value=lt.__value="other",ta(),s(Dt),s(sa);var It=a(sa,2),Yt=l(It);s(It),s(At),L(()=>{et(Xt,"name",`target-${e(d),r(()=>e(d).id)??""}`),et(lt,"name",`target-${e(d),r(()=>e(d).id)??""}`),k(Yt,`Cast ${H(e(ne)),r(()=>e(ne).name)??""}`)}),xs(F,[Ve],Xt,()=>e(B)[e(d).id],Qt=>ba(B,e(B)[e(d).id]=Qt)),xs(F,[Ve],lt,()=>e(B)[e(d).id],Qt=>ba(B,e(B)[e(d).id]=Qt)),j("click",It,()=>je(e(d),e(B)[e(d).id])),o(wt,At)},ia=wt=>{var At=Wi();j("click",At,()=>je(e(d),"self")),o(wt,At)};g(xt,wt=>{H(e(ne)),r(()=>Je(e(ne).name))?wt(Ut):wt(ia,!1)})}o(We,gt)};g(fe,We=>{H(Da),H(e(ne)),H(Ka),r(()=>!Da(e(ne))&&Ka(e(ne)))&&We(vt)})}var st=a(fe,2);{var Ft=We=>{var gt=bt(),xt=Se(gt);{var Ut=wt=>{var At=Ki(),sa=l(At);{var ra=Dt=>{var lt=Pt("Roll Healing");o(Dt,lt)},Xt=Dt=>{var lt=Pt("Roll Damage");o(Dt,lt)};g(sa,Dt=>{H(e(ne)),r(()=>De(e(ne)))?Dt(ra):Dt(Xt,!1)})}s(At),L(Dt=>Mt(At,1,`btn ${Dt??""}`),[()=>(H(e(ne)),r(()=>De(e(ne))?"btn-success":"btn-secondary"))]),j("click",At,()=>E(e(d))),o(wt,At)},ia=wt=>{var At=Vi();j("click",At,()=>je(e(d),"self")),o(wt,At)};g(xt,wt=>{e(d),r(()=>e(d).damage&&e(d).damage.trim()!=="")?wt(Ut):wt(ia,!1)})}o(We,gt)};g(st,We=>{H(Da),H(e(ne)),H(Ka),r(()=>!Da(e(ne))&&!Ka(e(ne)))&&We(Ft)})}o(xe,He)};g(ht,xe=>{e(ne)&&xe(R)})}o(ue,Ze)};g(ft,ue=>{e(d),e(Y),r(()=>e(d).spellRef&&e(Y))&&ue(Pe)})}var Ie=a(ft,2);{var $t=ue=>{var ne=Qi(),Ze=Se(ne),ht=a(Ze,2);{var R=xe=>{var _=Yi();j("click",_,()=>E(e(d))),o(xe,_)};g(ht,xe=>{e(d),r(()=>e(d).damage&&e(d).damage.trim()!=="")&&xe(R)})}j("click",Ze,()=>T(e(d))),o(ue,ne)};g(Ie,ue=>{e(d),r(()=>!e(d).spellRef)&&ue($t)})}s(ct),s(ye),L(()=>{et(W,"for",`attack-type-${e(d),r(()=>e(d).id)??""}`),et(le,"id",`attack-type-${e(d),r(()=>e(d).id)??""}`)}),Ue(le,()=>e(d).damageType,ue=>(e(d).damageType=ue,qt(()=>(e(x),t(),v())))),o(ee,ye)});var be=a(re,2);{var he=ee=>{var d=Zi();o(ee,d)};g(be,ee=>{t(),r(()=>t().attacks.length===0)&&ee(he)})}var Be=a(be,2);{var te=ee=>{var d=er();o(ee,d)};g(Be,ee=>{e(x),t(),r(()=>e(x).length===0&&t().attacks.length>0)&&ee(te)})}s(Q);var S=a(Q,2);{var Z=ee=>{var d=ir(),Ve=a(l(d),4);Lt(Ve,5,()=>e(y),Bt,(ye,N)=>{var me=lr(),se=l(me),Re=l(se),we=l(Re,!0);s(Re);var ze=a(Re,2),Ne=l(ze);s(ze),s(se);var Qe=a(se,2),ot=l(Qe,!0);s(Qe);var oe=a(Qe,2),D=l(oe);{var O=Fe=>{var Ae=tr(),ct=l(Ae),ft=a(ct);{var Pe=Ie=>{var $t=Pt();L(()=>k($t,`per ${e(N),r(()=>e(N).restType)??""} rest`)),o(Ie,$t)};g(ft,Ie=>{e(N),r(()=>e(N).restType)&&Ie(Pe)})}s(Ae),L(()=>k(ct,`${e(N),r(()=>e(N).currentUses??e(N).usesPerRest)??""}/${e(N),r(()=>e(N).usesPerRest)??""} uses `)),o(Fe,Ae)};g(D,Fe=>{e(N),r(()=>e(N).usesPerRest)&&Fe(O)})}var W=a(D,2);{var le=Fe=>{var Ae=ar();o(Fe,Ae)};g(W,Fe=>{e(N),r(()=>e(N).requiresReaction)&&Fe(le)})}var Me=a(W,2);{var Oe=Fe=>{var Ae=sr();L(()=>Ae.disabled=(e(N),r(()=>e(N).currentUses===void 0||e(N).currentUses===0))),j("click",Ae,()=>ae(e(N).conditionName,e(N).name)),o(Fe,Ae)};g(Me,Fe=>{p(),e(N),r(()=>!p()&&e(N).usesPerRest)&&Fe(Oe)})}s(oe),s(me),L(()=>{k(we,(e(N),r(()=>e(N).name))),k(Ne,`(${e(N),r(()=>e(N).conditionName)??""})`),k(ot,(e(N),r(()=>e(N).description)))}),o(ye,me)}),s(Ve),s(d),o(ee,d)};g(S,ee=>{e(y),r(()=>e(y).length>0)&&ee(Z)})}var Ce=a(S,2),qe=a(l(Ce),4),Ye=a(qe,2);{var mt=ee=>{var d=or();Lt(d,5,()=>(t(),r(()=>t().activeStates)),Bt,(Ve,ye,N)=>{var me=nr(),se=l(me),Re=l(se);ke(Re);var we=a(Re,2);{var ze=Ie=>{var $t=rr();j("click",$t,()=>ce(N)),o(Ie,$t)};g(we,Ie=>{p()&&Ie(ze)})}s(se);var Ne=a(se,2),Qe=l(Ne),ot=l(Qe);et(ot,"for",`state-attack-bonus-${N}`);var oe=a(ot,2);ke(oe),et(oe,"id",`state-attack-bonus-${N}`),s(Qe);var D=a(Qe,2),O=l(D);et(O,"for",`state-damage-bonus-${N}`);var W=a(O,2);ke(W),et(W,"id",`state-damage-bonus-${N}`),s(D);var le=a(D,2),Me=l(le);et(Me,"for",`state-target-${N}`);var Oe=a(Me,2);L(()=>{e(ye),qt(()=>{})}),et(Oe,"id",`state-target-${N}`);var Fe=l(Oe);Fe.value=Fe.__value="self";var Ae=a(Fe);Ae.value=Ae.__value="other",s(Oe),s(le),s(Ne);var ct=a(Ne,2),ft=l(ct);et(ft,"for",`state-desc-${N}`);var Pe=a(ft,2);ke(Pe),et(Pe,"id",`state-desc-${N}`),s(ct),s(me),Ue(Re,()=>e(ye).name,Ie=>(e(ye).name=Ie,qt(()=>t()),Fa(m,"$character"))),Ue(oe,()=>e(ye).attackBonus,Ie=>(e(ye).attackBonus=Ie,qt(()=>t()),Fa(m,"$character"))),Ue(W,()=>e(ye).damageBonus,Ie=>(e(ye).damageBonus=Ie,qt(()=>t()),Fa(m,"$character"))),Ua(Oe,()=>e(ye).target,Ie=>(e(ye).target=Ie,qt(()=>t()),Fa(m,"$character"))),Ue(Pe,()=>e(ye).description,Ie=>(e(ye).description=Ie,qt(()=>t()),Fa(m,"$character"))),o(Ve,me)}),s(d),o(ee,d)},_e=ee=>{var d=cr();o(ee,d)};g(Ye,ee=>{t(),r(()=>t().activeStates&&t().activeStates.length>0)?ee(mt):ee(_e,!1)})}s(Ce),j("click",qe,pe),o(w,z)};g(Ke,w=>{f(),r(()=>!f().attacks)&&w(yt)})}s(tt);var Ct=a(tt,2);ri(Ct,{get show(){return e(P)},get attacks(){return t(),r(()=>t().attacks)},onSave:Te,onCancel:ge}),L(()=>pt=Mt(tt,1,"attacks svelte-14o91c5",null,pt,{hidden:!e(V)})),o(i,Ge),Kt(),A()}var fr=u('<span class="slot-checkbox-x svelte-serp1j">&#8212;</span>'),pr=u('<label><input type="checkbox" class="slot-checkbox-input svelte-serp1j"/> <span><!></span></label>');function Ds(i,c){Wt(c,!1);const t=()=>ut(xa,"$isEditMode",v),[v,f]=ca();let p=jt(c,"checked",8,!1),m=jt(c,"disabled",8,!1),A=jt(c,"className",8,""),y=jt(c,"index",8,void 0),x=jt(c,"ariaLabel",8,void 0);const V=$a();function F(P){V("change",{checked:P.currentTarget.checked,index:y()})}zt();var X=pr(),ae=l(X);ke(ae);var ie=a(ae,2),G=l(ie);{var B=P=>{var q=fr();o(P,q)};g(G,P=>{p()&&P(B)})}s(ie),s(X),L(()=>{Mt(X,1,"slot-checkbox-label "+A()+(t()?"":" not-editable"),"svelte-serp1j"),Ms(ae,p()),ae.disabled=m()||!t(),et(ae,"aria-label",x()),et(ae,"tabindex",t()?0:-1),Mt(ie,1,`slot-checkbox-custom ${p()?"used":""} ${t()?"":"readonly"}`,"svelte-serp1j")}),j("change",ae,F),o(i,X),Kt(),f()}function mr(i,c){Wt(c,!1);const t=()=>ut(ve,"$character",v),[v,f]=ca();let p=C(),m=C();wa(()=>{t().race&&t().level&&(bs(),Za(),n(p,t().race),n(m,t().level))}),Xe(()=>(t(),e(p),e(m),Za),()=>{t().race&&t().level&&(t().race!==e(p)||t().level!==e(m))&&(bs(),Za(),n(p,t().race),n(m,t().level))}),pa(),zt(),Kt(),f()}var gr=u('<p class="no-features svelte-1kpvv0n">Select a class to see available features</p>'),br=u('<p class="no-features svelte-1kpvv0n">No class features available at this level</p>'),hr=u('<div class="spell-slots svelte-1kpvv0n"><label class="svelte-1kpvv0n"> </label> <div class="slots-tracker svelte-1kpvv0n"></div></div>'),_r=u('<div class="all-spell-slots"></div>'),yr=u('<div class="feature-box spellcasting svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"> </h3> <div class="spell-stats svelte-1kpvv0n"><div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Spell Save DC</label> <div class="spell-value svelte-1kpvv0n"> </div></div> <div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <div class="spell-value svelte-1kpvv0n"> </div></div></div> <!> <div class="prepared-spells svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <textarea placeholder="List your prepared spells..." class="svelte-1kpvv0n"></textarea></div></div>'),xr=u('<p class="unlimited svelte-1kpvv0n">Unlimited Uses</p>'),$r=u('<div class="slots-tracker svelte-1kpvv0n"></div> <div class="uses-actions-row"><button class="btn btn-primary use-enabled"> </button></div> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div>',1),wr=u('<div class="uses-tracker svelte-1kpvv0n"><!></div>'),Sr=u('<div class="pool-tracker svelte-1kpvv0n"><input type="number" min="0" class="pool-input svelte-1kpvv0n"/> <span> </span> <button class="btn-small svelte-1kpvv0n"> </button></div>'),kr=u('<p class="no-uses svelte-1kpvv0n">No Channel Divinity uses remaining</p>'),Cr=u('<div class="channel-divinity-option svelte-1kpvv0n"><button class="btn btn-primary use-enabled svelte-1kpvv0n">Use Channel Divinity</button> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div> <!></div>'),Dr=u('<div class="feature-box svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"><!> </h3> <p class="feature-description svelte-1kpvv0n"> </p> <!></div>'),Lr=u('<div class="features-grid svelte-1kpvv0n"><!> <!></div>'),jr=u("<!> <!>",1),Ar=u("<section><!> <!></section>");function Br(i,c){Wt(c,!1);const t=()=>ut(ve,"$character",m),v=()=>ut(Ya,"$abilityModifiers",m),f=()=>ut(_a,"$searchFilter",m),p=()=>ut(aa,"$collapsedStates",m),[m,A]=ca(),y=C(),x=C(),V=C(),F=C(),X=C(),ae=C(),ie=C();let G=C(0),B=C(0);function P(b,M){ve.update(K=>(K.classFeatures.features[b]=M,K))}function q(){ve.update(b=>(b.classFeatures.spellSlotsByLevel||(b.classFeatures.spellSlotsByLevel={}),e(F).forEach(({level:M,slots:K})=>{b.classFeatures.spellSlotsByLevel[M]||(b.classFeatures.spellSlotsByLevel[M]=Array(K).fill(!1))}),b))}function De(b){if(typeof b.maxUses=="function"){if((b.name==="Divine Sense"||b.name==="War Priest")&&e(y)?.spellcastingAbility){const M=v()[e(y).spellcastingAbility];return b.maxUses(t().level,M)}return b.maxUses(t().level)}return b.maxUses||0}function Je(b,M){ve.update(K=>((!K.classFeatures.features[b]||!Array.isArray(K.classFeatures.features[b])||K.classFeatures.features[b].length!==M)&&(K.classFeatures.features[b]=Array(M).fill(!1)),K))}Os(()=>{e(ae)&&t()&&t().classFeatures&&t().classFeatures.features&&e(ae).forEach(b=>{if(b.type==="uses"){const M=b.name.replace(/\s+/g,""),K=De(b),$e=t().classFeatures.features[M];(!Array.isArray($e)||$e.length!==K)&&Je(M,K)}})});function J(b){return typeof b.maxPool=="function"?b.maxPool(t().level):b.maxPool||0}function Ee(b){return typeof b.description=="function"?b.description(t().level):b.description}function de(){const b="ChannelDivinity";ve.update(M=>{const K=M.classFeatures.features[b];return typeof K=="number"&&K>0&&(M.classFeatures.features[b]=K-1),M})}function ge(){aa.update(b=>({...b,classFeatures:!b.classFeatures}))}Xe(()=>(t(),oa),()=>{n(y,t().class?oa(t().class):null)}),Xe(()=>(t(),Ba),()=>{n(x,t().class?Ba(t().class,t().level,t().subclass):[])}),Xe(()=>(t(),Ss),()=>{n(V,t().class?Ss(t().class,t().level):0)}),Xe(()=>(e(y),t()),()=>{n(F,(()=>{if(!e(y)?.spellcaster)return[];const b=t().level,M=[];return b>=1&&M.push({level:1,slots:Math.min(4,2+Math.floor(b/3))}),b>=3&&M.push({level:2,slots:Math.min(3,2+Math.floor((b-3)/4))}),b>=5&&M.push({level:3,slots:Math.min(3,2+Math.floor((b-5)/5))}),b>=7&&M.push({level:4,slots:Math.min(3,1+Math.floor((b-7)/6))}),b>=9&&M.push({level:5,slots:Math.min(2,1+Math.floor((b-9)/8))}),b>=11&&M.push({level:6,slots:1}),b>=13&&M.push({level:7,slots:1}),b>=15&&M.push({level:8,slots:1}),b>=17&&M.push({level:9,slots:1}),M})())}),Xe(()=>(e(y),v(),t(),ks),()=>{if(e(y)?.spellcaster&&e(y).spellcastingAbility){const b=v()[e(y).spellcastingAbility];n(G,$l(t().class,b,t().proficiencyBonus)||0),n(B,ks(t().class,t().level,b))}}),Xe(()=>(t(),e(y),e(F)),()=>{t().class&&e(y)?.spellcaster&&e(F).length>0&&q()}),Xe(()=>t(),()=>{n(X,(()=>{const M=t().classFeatures.features["ChannelDivinity"];return typeof M=="number"?M:0})())}),Xe(()=>(e(x),f()),()=>{n(ae,e(x).filter(b=>{if(!f())return!0;const M=f().toLowerCase();return b.name.toLowerCase().includes(M)||Ee(b).toLowerCase().includes(M)}))}),Xe(()=>(f(),t(),e(ae)),()=>{n(ie,!f()||t().class||"class features".includes(f().toLowerCase())||"spellcasting".includes(f().toLowerCase())||e(ae).length>0)}),pa(),zt();var Te=Ar();let T;var E=l(Te);{let b=kt(()=>(p(),r(()=>p().classFeatures?"Expand":"Collapse")));Sa(E,{title:"Class Features",get collapsed(){return p(),r(()=>p().classFeatures)},get ariaLabel(){return e(b)},onToggle:ge})}var $=a(E,2);{var Y=b=>{var M=jr(),K=Se(M);mr(K,{});var $e=a(K,2);{var Le=ce=>{var je=gr();o(ce,je)},pe=ce=>{var je=bt(),Ge=Se(je);{var tt=rt=>{var Ke=br();o(rt,Ke)},pt=rt=>{var Ke=Lr(),yt=l(Ke);{var Ct=z=>{var h=yr(),U=l(h),Q=l(U);s(U);var re=a(U,2),be=l(re),he=a(l(be),2),Be=l(he,!0);s(he),s(be);var te=a(be,2),S=a(l(te),2),Z=l(S,!0);s(S),s(te),s(re);var Ce=a(re,2);{var qe=_e=>{var ee=_r();Lt(ee,5,()=>e(F),Bt,(d,Ve)=>{let ye=()=>e(Ve).level,N=()=>e(Ve).slots;const me=kt(()=>(t(),ye(),N(),r(()=>t().classFeatures.spellSlotsByLevel?.[ye()]||Array(N()).fill(!1))));var se=hr(),Re=l(se),we=l(Re);s(Re);var ze=a(Re,2);Lt(ze,5,()=>e(me),Bt,(Ne,Qe,ot)=>{{let oe=kt(()=>(H(e(me)),r(()=>e(me)[ot]||!1)));Ds(Ne,{get checked(){return e(oe)},$$events:{change:D=>{ve.update(O=>(O.classFeatures.spellSlotsByLevel||(O.classFeatures.spellSlotsByLevel={}),O.classFeatures.spellSlotsByLevel[ye()]||(O.classFeatures.spellSlotsByLevel[ye()]=Array(N()).fill(!1)),O.classFeatures.spellSlotsByLevel[ye()][ot]=D.detail.checked,O))}}})}}),s(ze),s(se),L(()=>k(we,`${ye()===1?"1st":ye()===2?"2nd":ye()===3?"3rd":`${ye()}th`} Level Spell Slots`)),o(d,se)}),s(ee),o(_e,ee)};g(Ce,_e=>{e(F),r(()=>e(F).length>0)&&_e(qe)})}var Ye=a(Ce,2),mt=a(l(Ye),2);ja(mt),s(Ye),s(h),L(_e=>{k(Q,`Spellcasting (${_e??""})`),k(Be,e(G)),k(Z,e(B))},[()=>(e(y),r(()=>e(y).spellcastingAbility?.toUpperCase()))]),Ue(mt,()=>t().classFeatures.preparedSpells,_e=>Ot(ve,r(t).classFeatures.preparedSpells=_e,r(t))),o(z,h)};g(yt,z=>{e(y),r(()=>e(y)?.spellcaster)&&z(Ct)})}var w=a(yt,2);Lt(w,1,()=>e(ae),Bt,(z,h)=>{const U=kt(()=>(e(h),r(()=>e(h).name.replace(/\s+/g,"")))),Q=kt(()=>(t(),H(e(U)),r(()=>t().classFeatures.features[e(U)]))),re=kt(()=>typeof e(Q)=="number");var be=Dr(),he=l(be),Be=l(he);{var te=_e=>{var ee=Pt("Channel Divinity:");o(_e,ee)};g(Be,_e=>{e(h),r(()=>e(h).type==="channelDivinity")&&_e(te)})}var S=a(Be);s(he);var Z=a(he,2),Ce=l(Z,!0);s(Z);var qe=a(Z,2);{var Ye=_e=>{const ee=kt(()=>(e(h),r(()=>De(e(h))))),d=kt(()=>(H(e(Q)),H(e(ee)),r(()=>Array.isArray(e(Q))?e(Q):Array(e(ee)).fill(!1))));var Ve=wr(),ye=l(Ve);{var N=se=>{var Re=xr();o(se,Re)},me=se=>{var Re=$r(),we=Se(Re);Lt(we,5,()=>e(d),Bt,(O,W,le)=>{Ds(O,{get checked(){return e(W)},index:le,$$events:{change:Me=>{ve.update(Oe=>(Oe.classFeatures.features[e(U)]||(Oe.classFeatures.features[e(U)]=Array(e(ee)).fill(!1)),Oe.classFeatures.features[e(U)][le]=Me.detail.checked,Oe))}}})}),s(we);var ze=a(we,2),Ne=l(ze),Qe=l(Ne);s(Ne),s(ze);var ot=a(ze,2),oe=l(ot),D=l(oe);s(oe),s(ot),L(O=>{Ne.disabled=O,k(Qe,`Use ${e(h),r(()=>e(h).name)??""}`),k(D,`Resets on ${e(h),r(()=>e(h).resetOn==="short"?"Short Rest":"Long Rest")??""}`)},[()=>(H(e(d)),r(()=>e(d).filter(O=>!O).length<=0))]),j("click",Ne,()=>{ve.update(O=>{O.classFeatures.features[e(U)]||(O.classFeatures.features[e(U)]=Array(e(ee)).fill(!1));const W=O.classFeatures.features[e(U)],le=W.findIndex(Me=>!Me);return le!==-1&&(W[le]=!0),O})}),o(se,Re)};g(ye,se=>{e(ee)===1/0?se(N):se(me,!1)})}s(Ve),o(_e,Ve)},mt=_e=>{var ee=bt(),d=Se(ee);{var Ve=N=>{const me=kt(()=>(e(h),r(()=>J(e(h)))));var se=Sr(),Re=l(se);ke(Re);var we=a(Re,2),ze=l(we);s(we);var Ne=a(we,2),Qe=l(Ne,!0);s(Ne),s(se),L(()=>{Ea(Re,e(re)&&e(Q)!==void 0?e(Q):e(me)),et(Re,"max",e(me)),k(ze,`/ ${e(me)??""}`),k(Qe,(e(h),r(()=>e(h).resetOn==="short"?"Short Rest":"Long Rest")))}),j("input",Re,ot=>{ve.update(oe=>(oe.classFeatures.features[e(U)]=parseInt(ot.currentTarget.value)||0,oe))}),j("click",Ne,()=>P(e(U),e(me))),o(N,se)},ye=N=>{var me=bt(),se=Se(me);{var Re=we=>{var ze=Cr(),Ne=l(ze),Qe=a(Ne,2),ot=l(Qe),oe=l(ot);s(ot),s(Qe);var D=a(Qe,2);{var O=W=>{var le=kr();o(W,le)};g(D,W=>{e(X)<=0&&W(O)})}s(ze),L(()=>{Ne.disabled=e(X)<=0,k(oe,`Resets on ${e(h),r(()=>e(h).resetOn==="short"?"Short Rest":"Long Rest")??""}`)}),j("click",Ne,de),o(we,ze)};g(se,we=>{e(h),r(()=>e(h).type==="channelDivinity")&&we(Re)},!0)}o(N,me)};g(d,N=>{e(h),r(()=>e(h).type==="pool")?N(Ve):N(ye,!1)},!0)}o(_e,ee)};g(qe,_e=>{e(h),r(()=>e(h).type==="uses")?_e(Ye):_e(mt,!1)})}s(be),L(_e=>{k(S,` ${e(h),r(()=>e(h).name)??""}`),k(Ce,_e)},[()=>(e(h),r(()=>Ee(e(h))))]),o(z,be)}),s(Ke),o(rt,Ke)};g(Ge,rt=>{e(x),r(()=>e(x).length===0)?rt(tt):rt(pt,!1)},!0)}o(ce,je)};g($e,ce=>{t(),r(()=>!t().class)?ce(Le):ce(pe,!1)})}o(b,M)};g($,b=>{p(),r(()=>!p().classFeatures)&&b(Y)})}s(Te),L(()=>T=Mt(Te,1,"class-features svelte-1kpvv0n",null,T,{hidden:!e(ie)})),o(i,Te),Kt(),A()}var Rr=u('<textarea placeholder="Enter features, traits, and special abilities..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Equipment</h3> <textarea placeholder="List your equipment and inventory..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Notes</h3> <textarea placeholder="Additional notes..." class="svelte-wttn0l"></textarea>',1),Tr=u("<section><!> <!></section>");function Mr(i,c){Wt(c,!1);const t=()=>ut(_a,"$searchFilter",p),v=()=>ut(ve,"$character",p),f=()=>ut(aa,"$collapsedStates",p),[p,m]=ca(),A=C();function y(){aa.update(ie=>({...ie,notes:!ie.notes}))}Xe(()=>(t(),v()),()=>{n(A,!t()||"features".includes(t().toLowerCase())||"traits".includes(t().toLowerCase())||"equipment".includes(t().toLowerCase())||"notes".includes(t().toLowerCase())||v().features.toLowerCase().includes(t().toLowerCase())||v().equipment.toLowerCase().includes(t().toLowerCase())||v().notes.toLowerCase().includes(t().toLowerCase()))}),pa(),zt();var x=Tr();let V;var F=l(x);{let ie=kt(()=>(f(),r(()=>f().notes?"Expand":"Collapse")));Sa(F,{title:"Features & Traits",get collapsed(){return f(),r(()=>f().notes)},get ariaLabel(){return e(ie)},onToggle:y})}var X=a(F,2);{var ae=ie=>{var G=Rr(),B=Se(G);ja(B);var P=a(B,4);ja(P);var q=a(P,4);ja(q),Ue(B,()=>v().features,De=>Ot(ve,r(v).features=De,r(v))),Ue(P,()=>v().equipment,De=>Ot(ve,r(v).equipment=De,r(v))),Ue(q,()=>v().notes,De=>Ot(ve,r(v).notes=De,r(v))),o(ie,G)};g(X,ie=>{f(),r(()=>!f().notes)&&ie(ae)})}s(x),L(()=>V=Mt(x,1,"notes svelte-wttn0l",null,V,{hidden:!e(A)})),o(i,x),Kt(),m()}var Fr=u(" <!> <!> <!> <!> <!>",1),Pr=u('<div class="color-picker-section svelte-1r90jgp"><h3 class="svelte-1r90jgp">Dice Colors</h3> <div class="color-inputs svelte-1r90jgp"><div class="color-input-group svelte-1r90jgp"><label for="dice-color" class="svelte-1r90jgp">Dice Color</label> <input type="color" id="dice-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="label-color" class="svelte-1r90jgp">Label Color</label> <input type="color" id="label-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="desk-color" class="svelte-1r90jgp">Background Color</label> <input type="color" id="desk-color" class="svelte-1r90jgp"/></div></div></div>'),Ir=u('<div class="loading svelte-1r90jgp"><p class="svelte-1r90jgp">Loading 3D dice...</p></div>'),Er=u('<div class="custom-dice-selector svelte-1r90jgp"><h3 class="svelte-1r90jgp">Choose Dice to Roll</h3> <div class="dice-inputs svelte-1r90jgp"><div class="dice-input-group svelte-1r90jgp"><label for="d4" class="svelte-1r90jgp">d4</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d4" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d6" class="svelte-1r90jgp">d6</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d6" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d8" class="svelte-1r90jgp">d8</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d8" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d10" class="svelte-1r90jgp">d10</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d10" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d12" class="svelte-1r90jgp">d12</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d12" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d20" class="svelte-1r90jgp">d20</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d20" min="0" max="10"/></div></div> <div class="dice-controls svelte-1r90jgp"><button class="btn btn-primary use-enabled svelte-1r90jgp"> </button> <button class="btn btn-secondary use-enabled svelte-1r90jgp">Reset</button></div></div>'),Hr=u('<h3 class="svelte-1r90jgp"> </h3>'),Ur=u('<h3 class="svelte-1r90jgp"> </h3>'),Nr=u('<h3 class="svelte-1r90jgp"> </h3>'),Or=u('<h3 class="svelte-1r90jgp"> </h3>'),Gr=u('<span class="crit-badge svelte-1r90jgp">CRITICAL HIT!</span>'),qr=u('<span class="crit-badge crit-fail svelte-1r90jgp">CRITICAL MISS!</span>'),zr=u('<div class="bonus-item svelte-1r90jgp"><span class="bonus-value svelte-1r90jgp"> </span> <span class="bonus-source svelte-1r90jgp"> </span></div>'),Wr=u('<div class="bonus-breakdown svelte-1r90jgp"></div>'),Kr=u('<p class="modifier-text svelte-1r90jgp"> </p>'),Vr=u('<div class="svelte-1r90jgp"><em class="svelte-1r90jgp">No damage is dealt on a critical miss.</em></div>'),Jr=u('<button class="btn btn-follow-up svelte-1r90jgp"> </button>'),Yr=u('<button class="btn btn-guided-strike svelte-1r90jgp">‚ö° Use Guided Strike (+10)</button>'),Qr=u('<div class="follow-up-actions svelte-1r90jgp"><!> <!></div>'),Xr=u('<div class="result-header svelte-1r90jgp"><!> <!> <!></div> <div class="result-total svelte-1r90jgp"> </div> <div class="result-details svelte-1r90jgp"><!></div> <!> <!>',1),Zr=u('<div role="button" tabindex="-1"><div class="modal-content svelte-1r90jgp" role="dialog" tabindex="0"><div class="modal-header svelte-1r90jgp"><h2 class="svelte-1r90jgp"><!></h2> <div class="header-buttons svelte-1r90jgp"><button class="color-btn svelte-1r90jgp" title="Customize dice colors">üé®</button> <button class="close-btn svelte-1r90jgp">√ó</button></div></div> <!> <!> <div class="dice-main-area svelte-1r90jgp"><div class="dice-container svelte-1r90jgp"></div> <!></div> <div><!></div></div></div>');function en(i,c){Wt(c,!1);const t=()=>ut(ve,"$character",v),[v,f]=ca(),p=C(),m=C(),A=C(),y=$a();let x=jt(c,"notation",12,""),V=jt(c,"visible",8,!1),F=jt(c,"damageNotation",12,""),X=jt(c,"damageType",8,""),ae=jt(c,"attackName",12,""),ie=jt(c,"applyHalfDamage",8,!1),G=jt(c,"bonusBreakdown",28,()=>[]),B=jt(c,"rollType",12,"other"),P=null,q=C(void 0),De=C(!1),Je=C(""),J=C(null);function Ee(){return e(J)?.resultTotal??null}function de(D,O,W){const le=[];if(!D||!D.result)return le;const Me=O.match(/([+-]?\d*d\d+|[+-]?\d+)/g)||[];let Oe=0;const Fe=new Set;for(const Ae of Me){const ct=Ae.trim();if(!ct)continue;const ft=ct.match(/([+-]?)(\d*)d(\d+)/);if(ft){const Pe=parseInt(ft[2]||"1"),Ie=`${Pe}d${ft[3]}`,$t=W.findIndex((Ze,ht)=>!Fe.has(ht)&&typeof Ze.value=="string"&&Ze.value===Ie),ue=[];for(let Ze=0;Ze<Pe&&Oe<D.result.length;Ze++)ue.push(D.result[Oe++]);const ne=$t>=0?W[$t].source:"base die";$t>=0&&Fe.add($t);for(const Ze of ue)le.push({display:`${Ze}`,source:ne})}}for(let Ae=0;Ae<W.length;Ae++)if(!Fe.has(Ae)&&typeof W[Ae].value=="number"){const ct=W[Ae].value;le.push({display:ct>=0?`+${ct}`:`${ct}`,source:W[Ae].source})}return le}let ge=C(0),Te=C(0),T=C(0),E=C(0),$=C(0),Y=C(0),b=C(0),M=C([]),K=C(!1),$e=C(!1),Le=C(!1),pe=C("#051e0a"),ce=C("#ffffff"),je=C("#3a2004"),Ge=C(!1);function tt(D){return D.length===9&&D.startsWith("#")?D.substring(0,7):D}function pt(D,O="ff"){return D.length===7&&D.startsWith("#")?D+O:D}function rt(){if(window.DICE&&e(q))try{P&&e(q)&&ba(q,e(q).innerHTML="");const D=e(q).clientWidth||500,O=e(q).clientHeight||300;P=new window.DICE.dice_box(e(q),{w:D,h:O}),n(De,!0)}catch(D){console.error("Error initializing dice box:",D)}}wa(()=>{const D=le=>new Promise((Me,Oe)=>{if(document.querySelector(`script[src="${le}"]`)){Me(null);return}const Ae=document.createElement("script");Ae.src=le,Ae.onload=()=>{Me(null)},Ae.onerror=()=>{console.error(`Failed to load: ${le}`),Oe(new Error(`Failed to load ${le}`))},document.head.appendChild(Ae)});setTimeout(()=>{D(`${Pa}/libs/three.min.js`).then(()=>D(`${Pa}/libs/cannon.min.js`)).then(()=>D(`${Pa}/libs/teal.js`)).then(()=>D(`${Pa}/dice.js`)).then(()=>{if(window.DICE){const le=window.DICE.getColors();n(pe,tt(le.dice_color)),n(ce,tt(le.label_color)),n(je,tt(le.desk_color))}rt()}).catch(le=>{console.error("Failed to load dice libraries:",le)})},100);const O=()=>{e(De)&&rt()},W=le=>{V()&&le.key==="Escape"&&re()};return window.addEventListener("resize",O),window.addEventListener("keydown",W),()=>{window.removeEventListener("resize",O),window.removeEventListener("keydown",W)}});function Ke(D,O="other"){if(!P||!e(De))return;n(J,null),n(M,[]),n(K,!1),n($e,!1),O==="damage"&&G([]),B(O),n(Le,!1),P.diceToRoll=D;const W=Me=>null,le=Me=>{let Oe=Me.resultTotal,Fe=Me.resultString;if(ie()&&(Oe=Math.floor(Oe/2),Fe=Fe+" (halved)"),n(J,{...Me,resultTotal:Oe,resultString:Fe}),console.log("Final roll result:",e(J)),console.log({type:O}),O==="attack"&&Me.result&&Me.result.length>0){const Ae=Me.result[0];n(K,Ae===20),n($e,Ae===1)}if(n(M,[]),console.log("Setting up follow-up actions. Type:",O,"damageNotation:",F(),"isCriticalSuccess:",e(K),"isCriticalFail:",e($e)),O==="attack"&&F())if(e(K)){const Ae=w(F());e(M).push({label:`Roll Critical Damage (${Ae})`,notation:Ae})}else e($e)||e(M).push({label:`Roll Damage (${F()})`,notation:F()})};P.start_throw(W,le)}function yt(){const D=[];e(ge)>0&&D.push(`${e(ge)}d4`),e(Te)>0&&D.push(`${e(Te)}d6`),e(T)>0&&D.push(`${e(T)}d8`),e(E)>0&&D.push(`${e(E)}d10`),e($)>0&&D.push(`${e($)}d12`),e(Y)>0&&D.push(`${e(Y)}d20`);let O=D.join("+")||"1d20";return e(b)!==0&&(O+=e(b)>=0?`+${e(b)}`:`${e(b)}`),O}function Ct(){const D=yt();Ke(D)}function w(D){return D.replace(/(\d+)d(\d+)/g,(O,W,le)=>`${parseInt(W)*2}d${le}`)}function z(){n(ge,0),n(Te,0),n(T,0),n(E,0),n($,0),n(Y,0),n(b,0),n(J,null),n(M,[]),n(K,!1),n($e,!1),B("other"),n(Le,!1)}function h(){window.DICE&&(window.DICE.setColors({dice_color:pt(e(pe),"ff"),label_color:pt(e(ce),"ff"),desk_color:e(je)}),P&&(P.updateDeskColor(e(je)),P.updateDiceColors()))}function U(){n(Ge,!e(Ge))}function Q(){!e(J)||e(m)<=0||e(Le)||(n(J,{...e(J),resultTotal:e(J).resultTotal+10,resultString:e(J).resultString+" + 10 (Guided Strike)"}),ve.update(D=>{const O="ChannelDivinity",W=D.classFeatures.features[O];return typeof W=="number"&&W>0&&(D.classFeatures.features[O]=W-1),D}),n(Le,!0))}function re(){y("close"),x(""),F(""),ae(""),n(Je,""),n(J,null),n(Le,!1),n(K,!1),n($e,!1),z()}Xe(()=>(t(),Ba),()=>{n(p,t().class?Ba(t().class,t().level,t().subclass).some(O=>O.name==="Guided Strike"):!1)}),Xe(()=>t(),()=>{n(m,(()=>{const O=t().classFeatures.features["ChannelDivinity"];return typeof O=="number"?O:0})())}),Xe(()=>(e(ge),e(Te),e(T),e(E),e($),e(Y),e(b)),()=>{n(A,(()=>{const D=[];e(ge)>0&&D.push(`${e(ge)}d4`),e(Te)>0&&D.push(`${e(Te)}d6`),e(T)>0&&D.push(`${e(T)}d8`),e(E)>0&&D.push(`${e(E)}d10`),e($)>0&&D.push(`${e($)}d12`),e(Y)>0&&D.push(`${e(Y)}d20`);let O=D.join("+")||"1d20";return e(b)!==0&&(O+=e(b)>=0?`+${e(b)}`:`${e(b)}`),O})())}),Xe(()=>(H(x()),e(De),H(V()),e(Je),H(F()),H(ae()),H(B())),()=>{x()&&e(De)&&V()&&x()!==e(Je)&&(n(Je,x()),n(J,null),n(M,[]),n(K,!1),n($e,!1),n(Le,!1),console.log("Auto-roll triggered. notation:",x(),"damageNotation:",F(),"attackName:",ae(),"rollType:",B()),setTimeout(()=>Ke(x(),B()),200))}),pa();var be={getLastRollTotal:Ee};zt();var he=Zr();let Be;var te=l(he),S=l(te),Z=l(S),Ce=l(Z);{var qe=D=>{var O=Fr(),W=Se(O),le=a(W);{var Me=ue=>{var ne=Pt("- Attack Roll");o(ue,ne)};g(le,ue=>{B()==="attack"&&ue(Me)})}var Oe=a(le,2);{var Fe=ue=>{var ne=Pt("- Damage Roll");o(ue,ne)};g(Oe,ue=>{B()==="damage"&&ue(Fe)})}var Ae=a(Oe,2);{var ct=ue=>{var ne=Pt("- Healing Roll");o(ue,ne)};g(Ae,ue=>{B()==="healing"&&ue(ct)})}var ft=a(Ae,2);{var Pe=ue=>{var ne=Pt("- Ability Check");o(ue,ne)};g(ft,ue=>{B()==="check"&&ue(Pe)})}var Ie=a(ft,2);{var $t=ue=>{var ne=Pt("- Saving Throw");o(ue,ne)};g(Ie,ue=>{B()==="save"&&ue($t)})}L(()=>k(W,`${ae()??""} `)),o(D,O)},Ye=D=>{var O=Pt("Dice Roller");o(D,O)};g(Ce,D=>{ae()?D(qe):D(Ye,!1)})}s(Z);var mt=a(Z,2),_e=l(mt),ee=a(_e,2);s(mt),s(S);var d=a(S,2);{var Ve=D=>{var O=Pr(),W=a(l(O),2),le=l(W),Me=a(l(le),2);ke(Me),s(le);var Oe=a(le,2),Fe=a(l(Oe),2);ke(Fe),s(Oe);var Ae=a(Oe,2),ct=a(l(Ae),2);ke(ct),s(Ae),s(W),s(O),Ue(Me,()=>e(pe),ft=>n(pe,ft)),j("change",Me,h),Ue(Fe,()=>e(ce),ft=>n(ce,ft)),j("change",Fe,h),Ue(ct,()=>e(je),ft=>n(je,ft)),j("change",ct,h),o(D,O)};g(d,D=>{e(Ge)&&D(Ve)})}var ye=a(d,2);{var N=D=>{var O=Ir();o(D,O)};g(ye,D=>{e(De)||D(N)})}var me=a(ye,2),se=l(me);Ha(se,D=>n(q,D),()=>e(q));var Re=a(se,2);{var we=D=>{var O=Er(),W=a(l(O),2),le=l(W),Me=a(l(le),2);ke(Me),s(le);var Oe=a(le,2),Fe=a(l(Oe),2);ke(Fe),s(Oe);var Ae=a(Oe,2),ct=a(l(Ae),2);ke(ct),s(Ae);var ft=a(Ae,2),Pe=a(l(ft),2);ke(Pe),s(ft);var Ie=a(ft,2),$t=a(l(Ie),2);ke($t),s(Ie);var ue=a(Ie,2),ne=a(l(ue),2);ke(ne),s(ue),s(W);var Ze=a(W,2),ht=l(Ze),R=l(ht);s(ht);var xe=a(ht,2);s(Ze),s(O),L(()=>{ht.disabled=!e(De),k(R,`Roll ${e(A)??""}`)}),Ue(Me,()=>e(ge),_=>n(ge,_)),Ue(Fe,()=>e(Te),_=>n(Te,_)),Ue(ct,()=>e(T),_=>n(T,_)),Ue(Pe,()=>e(E),_=>n(E,_)),Ue($t,()=>e($),_=>n($,_)),Ue(ne,()=>e(Y),_=>n(Y,_)),j("click",ht,Ct),j("click",xe,z),o(D,O)};g(Re,D=>{x()||D(we)})}s(me);var ze=a(me,2);let Ne;var Qe=l(ze);{var ot=D=>{var O=Xr(),W=Se(O),le=l(W);{var Me=_=>{var He=Hr(),I=l(He,!0);s(He),L(()=>k(I,ae()?`${ae()} - Healing`:"Healing")),o(_,He)},Oe=_=>{var He=bt(),I=Se(He);{var Rt=at=>{var fe=Ur(),vt=l(fe,!0);s(fe),L(()=>k(vt,ae()?`${ae()} - ${X()} Damage`:`${X()} Damage`)),o(at,fe)},_t=at=>{var fe=bt(),vt=Se(fe);{var st=We=>{var gt=Nr(),xt=l(gt,!0);s(gt),L(()=>k(xt,ae()?`${ae()} - Damage`:"Damage")),o(We,gt)},Ft=We=>{var gt=Or(),xt=l(gt,!0);s(gt),L(()=>k(xt,ae()?`${ae()} - Result`:"Result")),o(We,gt)};g(vt,We=>{B()==="damage"?We(st):We(Ft,!1)},!0)}o(at,fe)};g(I,at=>{B()==="damage"&&X()?at(Rt):at(_t,!1)},!0)}o(_,He)};g(le,_=>{B()==="damage"&&X()==="Healing"?_(Me):_(Oe,!1)})}var Fe=a(le,2);{var Ae=_=>{var He=Gr();o(_,He)};g(Fe,_=>{e(K)&&_(Ae)})}var ct=a(Fe,2);{var ft=_=>{var He=qr();o(_,He)};g(ct,_=>{e($e)&&_(ft)})}s(W);var Pe=a(W,2),Ie=l(Pe,!0);s(Pe);var $t=a(Pe,2),ue=l($t);{var ne=_=>{var He=bt(),I=Se(He);{var Rt=at=>{var fe=Wr();Lt(fe,5,()=>(e(J),H(x()),H(G()),r(()=>de(e(J),x(),G()))),Bt,(vt,st)=>{var Ft=zr(),We=l(Ft),gt=l(We,!0);s(We);var xt=a(We,2),Ut=l(xt);s(xt),s(Ft),L(()=>{k(gt,(e(st),r(()=>e(st).display))),k(Ut,`(${e(st),r(()=>e(st).source)??""})`)}),o(vt,Ft)}),s(fe),o(at,fe)},_t=at=>{var fe=bt(),vt=Se(fe);{var st=Ft=>{var We=Kr(),gt=l(We);s(We),L(()=>k(gt,`Modifier: ${e(J),r(()=>e(J).constant>=0?"+":"")??""}${e(J),r(()=>e(J).constant)??""}`)),o(Ft,We)};g(vt,Ft=>{e(J),r(()=>e(J).constant)&&Ft(st)},!0)}o(at,fe)};g(I,at=>{H(G()),r(()=>G().length>0)?at(Rt):at(_t,!1)})}o(_,He)};g(ue,_=>{e(J),H(G()),r(()=>e(J).constant||G().length>0)&&_(ne)})}s($t);var Ze=a($t,2);{var ht=_=>{var He=Vr();o(_,He)};g(Ze,_=>{e($e)&&_(ht)})}var R=a(Ze,2);{var xe=_=>{var He=Qr(),I=l(He);Lt(I,1,()=>e(M),Bt,(at,fe)=>{var vt=Jr(),st=l(vt,!0);s(vt),L(()=>k(st,(e(fe),r(()=>e(fe).label)))),j("click",vt,()=>Ke(e(fe).notation,"damage")),o(at,vt)});var Rt=a(I,2);{var _t=at=>{var fe=Yr();L(()=>{fe.disabled=e(m)<=0,et(fe,"title",e(m)<=0?"No Channel Divinity uses remaining":"Use Channel Divinity to add +10 to this attack roll")}),j("click",fe,Q),o(at,fe)};g(Rt,at=>{e(p)&&B()==="attack"&&!e(Le)&&e(m)>0&&!e($e)&&at(_t)})}s(He),o(_,He)};g(R,_=>{e(M),e(p),H(B()),e(Le),e(m),r(()=>e(M).length>0||e(p)&&B()==="attack"&&!e(Le)&&e(m)>0)&&_(xe)})}L(()=>k(Ie,(e(J),r(()=>e(J).resultTotal)))),o(D,O)};g(Qe,D=>{e(J)&&D(ot)})}s(ze),s(te),s(he),L(()=>{Be=Mt(he,1,"modal-overlay svelte-1r90jgp",null,Be,{hidden:!V()}),Ne=Mt(ze,1,"roll-result svelte-1r90jgp",null,Ne,{"has-result":e(J)})}),j("click",_e,U),j("click",ee,re),j("click",te,ps(function(D){Aa.call(this,c,D)})),j("keydown",te,function(D){Aa.call(this,c,D)}),j("click",he,re),j("keydown",he,D=>D.key==="Escape"&&re()),o(i,he),yl(c,"getLastRollTotal",Ee);var oe=Kt(be);return f(),oe}const Qa="https://api.github.com/gists";async function tn(i,c,t){if(!c)throw new Error("GitHub token is required");const v=JSON.stringify(i,null,2),f=`${i.name||"character"}_dnd.json`,p={description:t||`D&D Character: ${i.name}`,public:!1,files:{[f]:{content:v}}},m=await fetch(Qa,{method:"POST",headers:{Authorization:`token ${c}`,"Content-Type":"application/json"},body:JSON.stringify(p)});if(!m.ok)throw new Error(`Failed to create gist: ${m.statusText}`);return(await m.json()).id}async function an(i,c,t){if(!c||!t)throw new Error("GitHub token and Gist ID are required");const v=JSON.stringify(i,null,2),p={files:{[`${i.name||"character"}_dnd.json`]:{content:v}}},m=await fetch(`${Qa}/${t}`,{method:"PATCH",headers:{Authorization:`token ${c}`,"Content-Type":"application/json"},body:JSON.stringify(p)});if(!m.ok)throw new Error(`Failed to update gist: ${m.statusText}`)}async function sn(i,c){if(!i)throw new Error("Gist ID is required");const t={"Content-Type":"application/json"};c&&(t.Authorization=`token ${c}`);const v=await fetch(`${Qa}/${i}`,{method:"GET",headers:t});if(!v.ok)throw new Error(`Failed to load gist: ${v.statusText}`);const f=await v.json(),p=Object.values(f.files);if(p.length===0)throw new Error("No files found in gist");const A=p[0].content;try{const y=JSON.parse(A);return y.attacks&&Array.isArray(y.attacks)&&(y.attacks=y.attacks.map(x=>({...x,id:x.id||crypto.randomUUID()}))),y.classFeatures?(y.classFeatures.features||(y.classFeatures.features={}),y.classFeatures.spellSlots||(y.classFeatures.spellSlots=[]),y.classFeatures.preparedSpells===void 0&&(y.classFeatures.preparedSpells="")):y.classFeatures={features:{},spellSlots:[],preparedSpells:""},y}catch{throw new Error("Invalid character data in gist")}}function Ls(i){typeof window<"u"&&localStorage.setItem("dnd_gist_config",JSON.stringify(i))}function ln(){if(typeof window<"u"){const i=localStorage.getItem("dnd_gist_config");if(i)return JSON.parse(i)}return{}}async function rn(i,c=30){if(!i)throw new Error("GitHub token is required to list gists");const t=await fetch(`${Qa}?per_page=${c}`,{method:"GET",headers:{Authorization:`token ${i}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error(`Failed to list gists: ${t.statusText}`);return await t.json()}var nn=u('<div class="error-message svelte-1jb5ckg"> </div>'),on=u('<div class="toggle-container svelte-1jb5ckg"><button type="button" class="toggle-btn svelte-1jb5ckg"> </button></div>'),cn=u('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID (leave empty to create new)</label> <input type="text" id="gistId" placeholder="Optional: existing Gist ID to update" class="svelte-1jb5ckg"/></div>'),vn=u('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),dn=u('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),un=u('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Update (or leave unselected to create new)</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),fn=u('<div class="info-message svelte-1jb5ckg">No gists found. A new one will be created.</div>'),pn=u('<!> <div class="form-group svelte-1jb5ckg"><label for="description" class="svelte-1jb5ckg"> </label> <input type="text" id="description" placeholder="D&amp;D Character Sheet" class="svelte-1jb5ckg"/></div>',1),mn=u('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID *</label> <input type="text" id="gistId" placeholder="Enter Gist ID (for public or your private gists)" required class="svelte-1jb5ckg"/></div>'),gn=u('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),bn=u('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),hn=u('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Load</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),_n=u('<div class="info-message svelte-1jb5ckg">No gists found. Enter a Gist ID manually or create a new one in Save mode.</div>'),yn=u('<div class="modal-overlay svelte-1jb5ckg" role="button" tabindex="-1"><div class="modal-content svelte-1jb5ckg" role="dialog" tabindex="0"><div class="modal-header svelte-1jb5ckg"><h2 class="svelte-1jb5ckg"> </h2> <button class="close-btn svelte-1jb5ckg">√ó</button></div> <div class="modal-body svelte-1jb5ckg"><!> <div class="form-group svelte-1jb5ckg"><label for="token" class="svelte-1jb5ckg"> <a href="https://github.com/settings/tokens" target="_blank" rel="noopener" class="svelte-1jb5ckg">Get token</a></label> <input type="password" id="token" placeholder="ghp_xxxxxxxxxxxxx" class="svelte-1jb5ckg"/></div> <!> <!> <div class="modal-actions svelte-1jb5ckg"><button class="btn btn-primary svelte-1jb5ckg"><!></button> <button class="btn btn-secondary svelte-1jb5ckg">Cancel</button></div></div></div></div>');function xn(i,c){Wt(c,!1);const t=()=>ut(ve,"$character",v),[v,f]=ca(),p=$a();let m=jt(c,"mode",8,"save"),A=C(""),y=C(""),x=C(""),V=C(!1),F=C(""),X=C(!1),ae=C(!1),ie=C([]),G=C(null);const B=ln();B.token&&n(A,B.token),B.gistId&&n(y,B.gistId),wa(async()=>{e(A)&&!e(X)&&await P()});async function P(){if(e(A)){n(ae,!0),n(F,"");try{n(ie,await rn(e(A))),e(y)&&n(G,e(ie).find(h=>h.id===e(y))||null)}catch(h){n(F,h.message||"Failed to load gists"),n(ie,[])}finally{n(ae,!1)}}}function q(h){n(G,h),n(y,h.id)}function De(){n(X,!e(X)),n(F,""),!e(X)&&e(A)&&P()}async function Je(){if(!e(A)){n(F,"GitHub token is required");return}const h=e(G)?.id||e(y);n(V,!0),n(F,"");try{if(h)await an(t(),e(A),h),n(y,h),Ht.add("Character updated in Gist successfully!","success");else{const U=await tn(t(),e(A),e(x));n(y,U),Ht.add(`Character saved to Gist! ID: ${U}`,"success")}Ls({token:e(A),gistId:e(y)}),p("close")}catch(U){n(F,U.message||"Failed to save to Gist")}finally{n(V,!1)}}async function J(){const h=e(G)?.id||e(y);if(!h){n(F,"Please select a gist or enter a Gist ID");return}n(V,!0),n(F,"");try{const U=await sn(h,e(A)||void 0);ve.set(U),n(y,h),Ls({token:e(A),gistId:e(y)}),Ht.add("Character loaded from Gist successfully!","success"),p("close")}catch(U){n(F,U.message||"Failed to load from Gist")}finally{n(V,!1)}}function Ee(){p("close")}zt();var de=yn(),ge=l(de),Te=l(ge),T=l(Te),E=l(T,!0);s(T);var $=a(T,2);s(Te);var Y=a(Te,2),b=l(Y);{var M=h=>{var U=nn(),Q=l(U,!0);s(U),L(()=>k(Q,e(F))),o(h,U)};g(b,h=>{e(F)&&h(M)})}var K=a(b,2),$e=l(K),Le=l($e);ta(),s($e);var pe=a($e,2);ke(pe),s(K);var ce=a(K,2);{var je=h=>{var U=on(),Q=l(U),re=l(Q,!0);s(Q),s(U),L(()=>{Q.disabled=e(V),k(re,e(X)?"üìã Show My Gists":"‚úèÔ∏è Enter Gist ID Manually")}),j("click",Q,De),o(h,U)};g(ce,h=>{(m()==="load"||m()==="save"&&e(A))&&h(je)})}var Ge=a(ce,2);{var tt=h=>{var U=pn(),Q=Se(U);{var re=Z=>{var Ce=cn(),qe=a(l(Ce),2);ke(qe),s(Ce),L(()=>qe.disabled=e(V)),Ue(qe,()=>e(y),Ye=>n(y,Ye)),o(Z,Ce)},be=Z=>{var Ce=bt(),qe=Se(Ce);{var Ye=_e=>{var ee=vn();o(_e,ee)},mt=_e=>{var ee=bt(),d=Se(ee);{var Ve=N=>{var me=un(),se=a(l(me),2);Lt(se,5,()=>e(ie),Bt,(Re,we)=>{var ze=dn();let Ne;var Qe=l(ze),ot=l(Qe),oe=l(ot,!0);s(ot);var D=a(ot,2),O=l(D,!0);s(D),s(Qe);var W=a(Qe,2),le=l(W),Me=l(le);s(le);var Oe=a(le,2),Fe=l(Oe);s(Oe),s(W),s(ze),L(Ae=>{Ne=Mt(ze,1,"gist-item svelte-1jb5ckg",null,Ne,{selected:e(G)?.id===e(we).id}),ze.disabled=e(V),k(oe,(e(we),r(()=>e(we).description||"Untitled"))),k(O,(e(we),r(()=>e(we).public?"üåê Public":"üîí Private"))),k(Me,`ID: ${e(we),r(()=>e(we).id)??""}`),k(Fe,`Updated: ${Ae??""}`)},[()=>(e(we),r(()=>new Date(e(we).updated_at).toLocaleDateString()))]),j("click",ze,()=>q(e(we))),o(Re,ze)}),s(se),s(me),o(N,me)},ye=N=>{var me=bt(),se=Se(me);{var Re=we=>{var ze=fn();o(we,ze)};g(se,we=>{e(A)&&we(Re)},!0)}o(N,me)};g(d,N=>{e(ie),r(()=>e(ie).length>0)?N(Ve):N(ye,!1)},!0)}o(_e,ee)};g(qe,_e=>{e(ae)?_e(Ye):_e(mt,!1)},!0)}o(Z,Ce)};g(Q,Z=>{e(X)||!e(A)?Z(re):Z(be,!1)})}var he=a(Q,2),Be=l(he),te=l(Be);s(Be);var S=a(Be,2);ke(S),s(he),L(()=>{k(te,`Description ${e(y)?"(optional)":""}`),S.disabled=e(V)}),Ue(S,()=>e(x),Z=>n(x,Z)),o(h,U)},pt=h=>{var U=bt(),Q=Se(U);{var re=he=>{var Be=mn(),te=a(l(Be),2);ke(te),s(Be),L(()=>te.disabled=e(V)),Ue(te,()=>e(y),S=>n(y,S)),o(he,Be)},be=he=>{var Be=bt(),te=Se(Be);{var S=Ce=>{var qe=gn();o(Ce,qe)},Z=Ce=>{var qe=bt(),Ye=Se(qe);{var mt=ee=>{var d=hn(),Ve=a(l(d),2);Lt(Ve,5,()=>e(ie),Bt,(ye,N)=>{var me=bn();let se;var Re=l(me),we=l(Re),ze=l(we,!0);s(we);var Ne=a(we,2),Qe=l(Ne,!0);s(Ne),s(Re);var ot=a(Re,2),oe=l(ot),D=l(oe);s(oe);var O=a(oe,2),W=l(O);s(O),s(ot),s(me),L(le=>{se=Mt(me,1,"gist-item svelte-1jb5ckg",null,se,{selected:e(G)?.id===e(N).id}),me.disabled=e(V),k(ze,(e(N),r(()=>e(N).description||"Untitled"))),k(Qe,(e(N),r(()=>e(N).public?"üåê Public":"üîí Private"))),k(D,`ID: ${e(N),r(()=>e(N).id)??""}`),k(W,`Updated: ${le??""}`)},[()=>(e(N),r(()=>new Date(e(N).updated_at).toLocaleDateString()))]),j("click",me,()=>q(e(N))),o(ye,me)}),s(Ve),s(d),o(ee,d)},_e=ee=>{var d=bt(),Ve=Se(d);{var ye=N=>{var me=_n();o(N,me)};g(Ve,N=>{e(A)&&N(ye)},!0)}o(ee,d)};g(Ye,ee=>{e(ie),r(()=>e(ie).length>0)?ee(mt):ee(_e,!1)},!0)}o(Ce,qe)};g(te,Ce=>{e(ae)?Ce(S):Ce(Z,!1)},!0)}o(he,Be)};g(Q,he=>{e(X)||!e(A)?he(re):he(be,!1)},!0)}o(h,U)};g(Ge,h=>{m()==="save"?h(tt):h(pt,!1)})}var rt=a(Ge,2),Ke=l(rt),yt=l(Ke);{var Ct=h=>{var U=Pt();L(()=>k(U,m()==="save"?"Saving...":"Loading...")),o(h,U)},w=h=>{var U=Pt();L(()=>k(U,m()==="save"?"Save":"Load")),o(h,U)};g(yt,h=>{e(V)?h(Ct):h(w,!1)})}s(Ke);var z=a(Ke,2);s(rt),s(Y),s(ge),s(de),L(()=>{k(E,m()==="save"?"Save to GitHub Gist":"Load from GitHub Gist"),k(Le,`GitHub Token ${m()==="load"?"(optional for public gists)":"(required)"} `),pe.disabled=e(V),Ke.disabled=e(V),z.disabled=e(V)}),j("click",$,Ee),Ue(pe,()=>e(A),h=>n(A,h)),j("blur",pe,()=>{e(A)&&!e(X)&&P()}),j("click",Ke,function(...h){(m()==="save"?Je:J)?.apply(this,h)}),j("click",z,Ee),j("click",ge,ps(function(h){Aa.call(this,c,h)})),j("keydown",ge,function(h){Aa.call(this,c,h)}),j("click",de,Ee),j("keydown",de,h=>h.key==="Escape"&&Ee()),o(i,de),Kt(),f()}var $n=u('<div class="loading svelte-1ngjemu">Loading D&D data...</div>'),wn=u("<option> </option>"),Sn=u('<select class="level-filter svelte-1ngjemu"><option>All Levels</option><option>Cantrip</option><!></select>'),kn=u('<div class="no-results svelte-1ngjemu"> </div>'),Cn=u('<div class="item-meta svelte-1ngjemu"> </div>'),Dn=u('<div class="item-meta svelte-1ngjemu"> </div>'),Ln=u('<button><div class="item-name svelte-1ngjemu"> </div> <!></button>'),jn=u('<p class="higher-levels"><strong>At Higher Levels:</strong> </p>'),An=u('<p class="cantrip-upgrade"><strong>Cantrip Upgrade:</strong> </p>'),Bn=u('<h3 class="svelte-1ngjemu"> </h3> <p class="spell-meta svelte-1ngjemu"><!> <!></p> <p class="spell-classes"><strong>Classes:</strong> </p> <div class="spell-stats svelte-1ngjemu"><div><strong>Casting Time:</strong> </div> <div><strong>Range:</strong> </div> <div><strong>Components:</strong> <!></div> <div><strong>Duration:</strong> <!> </div></div> <p class="description svelte-1ngjemu"> </p> <!> <!>',1),Rn=u('<p class="prerequisite svelte-1ngjemu"><strong>Prerequisite:</strong> </p>'),Tn=u('<h3 class="svelte-1ngjemu"> </h3> <!> <p class="description svelte-1ngjemu"> </p> <a target="_blank" rel="noopener" class="source-link svelte-1ngjemu">View Full Details ‚Üí</a>',1),Mn=u('<div class="item-details svelte-1ngjemu"><!></div>'),Fn=u('<div class="controls svelte-1ngjemu"><div class="tabs svelte-1ngjemu"><button> </button> <button> </button></div> <div class="search-controls svelte-1ngjemu"><input type="text" placeholder="Search by name or description..." class="search-input svelte-1ngjemu"/> <!></div></div> <div class="content-container svelte-1ngjemu"><div class="items-list svelte-1ngjemu"><!></div> <!></div>',1),Pn=u('<div class="modal-backdrop svelte-1ngjemu" role="presentation"><div class="modal svelte-1ngjemu" role="dialog" aria-modal="true" tabindex="-1"><div class="modal-header svelte-1ngjemu"><h2 class="svelte-1ngjemu">Browse D&D Spells & Feats</h2> <button class="close-btn svelte-1ngjemu" aria-label="Close">&times;</button></div> <div class="modal-body svelte-1ngjemu"><!></div> <div class="modal-footer svelte-1ngjemu"><button class="btn-secondary svelte-1ngjemu">Cancel</button> <button class="btn-primary svelte-1ngjemu">Add to Character Sheet</button></div></div></div>');function In(i,c){Wt(c,!1);const t=C(),v=C(),f=C();let p=jt(c,"onClose",8),m=C("spell"),A=C(!0),y=C(""),x=C(null),V=C([]),F=C([]),X=C(null);wa(async()=>{n(A,!0);try{n(V,await Es()),n(F,await ni())}catch($){console.error("Failed to load data:",$)}finally{n(A,!1)}});function ae($){n(X,$)}function ie($){const Y=$.match(/(\d+d\d+(?:\s*\+\s*\d+)?)/i);return Y?Y[1]:""}function G($){const Y=$.split(/\.( |$)/)[0].trim(),b=Array.from($.matchAll(/\*\*(.*?)\*\*/g)).map(K=>K[1].replace(/\.$/,""));let M=Y;return b.length&&(M+=" | Effects: "+b.join(", ")),M}function B(){if(e(X)){if(e(m)==="spell"){const $=e(X);ve.update(Y=>{const M=[];$.range&&M.push(`Range: ${$.range}`),$.castingTime&&M.push(`Cast: ${$.castingTime}`),$.duration&&M.push(`Duration: ${$.duration}`),$.actionType==="Save"&&M.push("Saving throw spell"),$.components&&$.components.length>0&&M.push(`Components: ${$.components.join(", ")}`),$.material&&M.push(`Material: ${$.material}`);const K=M.join(" | "),$e=G($.description),Le={id:crypto.randomUUID(),name:`${$.name}${$.concentration?" (C)":""}${$.ritual?" (R)":""}`,bonus:$.actionType==="Attack"?5:0,damage:ie($.description),damageType:`${$.school} (Lvl ${$.level})`,spellRef:$.name,infoNotes:K,generalNotes:$e,castAtLevel:$.level};return Y.attacks=[...Y.attacks,Le],Y})}else if(e(m)==="feat"){const $=e(X);ve.update(Y=>{const b=`${$.name}${$.prerequisite?` (Req: ${$.prerequisite})`:""}
${$.description}
`;return Y.features=Y.features?`${Y.features}
${b}`:b,Y})}n(X,null),p()()}}Xe(()=>(e(x),e(V),e(y)),()=>{n(t,e(x)!==null?oi(Cs(e(V),e(y)),e(x)):Cs(e(V),e(y)))}),Xe(()=>(e(F),e(y)),()=>{n(v,ci(e(F),e(y)))}),Xe(()=>(e(m),e(t),e(v)),()=>{n(f,e(m)==="spell"?e(t):e(v))}),pa(),zt();var P=Pn(),q=l(P),De=l(q),Je=a(l(De),2);s(De);var J=a(De,2),Ee=l(J);{var de=$=>{var Y=$n();o($,Y)},ge=$=>{var Y=Fn(),b=Se(Y),M=l(b),K=l(M);let $e;var Le=l(K);s(K);var pe=a(K,2);let ce;var je=l(pe);s(pe),s(M);var Ge=a(M,2),tt=l(Ge);ke(tt);var pt=a(tt,2);{var rt=Q=>{var re=Sn();L(()=>{e(x),qt(()=>{})});var be=l(re);be.value=(be.__value=null)??"";var he=a(be);he.value=he.__value=0;var Be=a(he);Lt(Be,0,()=>[1,2,3,4,5,6,7,8,9],Bt,(te,S)=>{var Z=wn(),Ce=l(Z);s(Z);var qe={};L(()=>{k(Ce,`Level ${S??""}`),qe!==(qe=S)&&(Z.value=(Z.__value=S)??"")}),o(te,Z)}),s(re),Ua(re,()=>e(x),te=>n(x,te)),o(Q,re)};g(pt,Q=>{e(m)==="spell"&&Q(rt)})}s(Ge),s(b);var Ke=a(b,2),yt=l(Ke),Ct=l(yt);{var w=Q=>{var re=kn(),be=l(re);s(re),L(()=>k(be,`No ${e(m)??""}s found`)),o(Q,re)},z=Q=>{var re=bt(),be=Se(re);Lt(be,1,()=>e(f),Bt,(he,Be)=>{var te=Ln();let S;var Z=l(te),Ce=l(Z,!0);s(Z);var qe=a(Z,2);{var Ye=_e=>{const ee=kt(()=>e(Be));var d=Cn(),Ve=l(d);s(d),L(()=>k(Ve,`Level ${H(e(ee)),r(()=>e(ee).level)??""} ‚Ä¢ ${H(e(ee)),r(()=>e(ee).school)??""}`)),o(_e,d)},mt=_e=>{const ee=kt(()=>e(Be));var d=bt(),Ve=Se(d);{var ye=N=>{var me=Dn(),se=l(me,!0);s(me),L(()=>k(se,(H(e(ee)),r(()=>e(ee).prerequisite)))),o(N,me)};g(Ve,N=>{H(e(ee)),r(()=>e(ee).prerequisite)&&N(ye)})}o(_e,d)};g(qe,_e=>{e(m)==="spell"?_e(Ye):_e(mt,!1)})}s(te),L(()=>{S=Mt(te,1,"item-card svelte-1ngjemu",null,S,{selected:e(X)?.name===e(Be).name}),k(Ce,(e(Be),r(()=>e(Be).name)))}),j("click",te,()=>ae(e(Be))),o(he,te)}),o(Q,re)};g(Ct,Q=>{e(f),r(()=>e(f).length===0)?Q(w):Q(z,!1)})}s(yt);var h=a(yt,2);{var U=Q=>{var re=Mn(),be=l(re);{var he=te=>{const S=kt(()=>e(X));var Z=Bn(),Ce=Se(Z),qe=l(Ce,!0);s(Ce);var Ye=a(Ce,2),mt=l(Ye);{var _e=Pe=>{var Ie=Pt();L(()=>k(Ie,`${H(e(S)),r(()=>e(S).school)??""} cantrip`)),o(Pe,Ie)},ee=Pe=>{var Ie=Pt();L(()=>k(Ie,`Level ${H(e(S)),r(()=>e(S).level)??""} ${H(e(S)),r(()=>e(S).school)??""}`)),o(Pe,Ie)};g(mt,Pe=>{H(e(S)),r(()=>e(S).level===0)?Pe(_e):Pe(ee,!1)})}var d=a(mt,2);{var Ve=Pe=>{var Ie=Pt("(ritual)");o(Pe,Ie)};g(d,Pe=>{H(e(S)),r(()=>e(S).ritual)&&Pe(Ve)})}s(Ye);var ye=a(Ye,2),N=a(l(ye));s(ye);var me=a(ye,2),se=l(me),Re=a(l(se));s(se);var we=a(se,2),ze=a(l(we));s(we);var Ne=a(we,2),Qe=a(l(Ne)),ot=a(Qe);{var oe=Pe=>{var Ie=Pt();L(()=>k(Ie,`(${H(e(S)),r(()=>e(S).material)??""})`)),o(Pe,Ie)};g(ot,Pe=>{H(e(S)),r(()=>e(S).material)&&Pe(oe)})}s(Ne);var D=a(Ne,2),O=a(l(D),2);{var W=Pe=>{var Ie=Pt("Concentration,");o(Pe,Ie)};g(O,Pe=>{H(e(S)),r(()=>e(S).concentration)&&Pe(W)})}var le=a(O,1,!0);s(D),s(me);var Me=a(me,2),Oe=l(Me,!0);s(Me);var Fe=a(Me,2);{var Ae=Pe=>{var Ie=jn(),$t=a(l(Ie));s(Ie),L(()=>k($t,` ${H(e(S)),r(()=>e(S).higherLevelSlot)??""}`)),o(Pe,Ie)};g(Fe,Pe=>{H(e(S)),r(()=>e(S).higherLevelSlot)&&Pe(Ae)})}var ct=a(Fe,2);{var ft=Pe=>{var Ie=An(),$t=a(l(Ie));s(Ie),L(()=>k($t,` ${H(e(S)),r(()=>e(S).cantripUpgrade)??""}`)),o(Pe,Ie)};g(ct,Pe=>{H(e(S)),r(()=>e(S).cantripUpgrade)&&Pe(ft)})}L((Pe,Ie)=>{k(qe,(H(e(S)),r(()=>e(S).name))),k(N,` ${Pe??""}`),k(Re,` ${H(e(S)),r(()=>e(S).castingTime||e(S).actionType)??""}`),k(ze,` ${H(e(S)),r(()=>e(S).range)??""}`),k(Qe,` ${Ie??""}`),k(le,(H(e(S)),r(()=>e(S).duration))),k(Oe,(H(e(S)),r(()=>e(S).description)))},[()=>(H(e(S)),r(()=>e(S).classes.join(", "))),()=>(H(e(S)),r(()=>e(S).components.join(", ").toUpperCase()))]),o(te,Z)},Be=te=>{const S=kt(()=>e(X));var Z=Tn(),Ce=Se(Z),qe=l(Ce,!0);s(Ce);var Ye=a(Ce,2);{var mt=Ve=>{var ye=Rn(),N=a(l(ye));s(ye),L(()=>k(N,` ${H(e(S)),r(()=>e(S).prerequisite)??""}`)),o(Ve,ye)};g(Ye,Ve=>{H(e(S)),r(()=>e(S).prerequisite)&&Ve(mt)})}var _e=a(Ye,2),ee=l(_e,!0);s(_e);var d=a(_e,2);L(()=>{k(qe,(H(e(S)),r(()=>e(S).name))),k(ee,(H(e(S)),r(()=>e(S).description))),et(d,"href",(H(e(S)),r(()=>e(S).source)))}),o(te,Z)};g(be,te=>{e(m)==="spell"?te(he):te(Be,!1)})}s(re),o(Q,re)};g(h,Q=>{e(X)&&Q(U)})}s(Ke),L(()=>{$e=Mt(K,1,"tab svelte-1ngjemu",null,$e,{active:e(m)==="spell"}),k(Le,`üìú Spells (${e(V),r(()=>e(V).length)??""})`),ce=Mt(pe,1,"tab svelte-1ngjemu",null,ce,{active:e(m)==="feat"}),k(je,`‚≠ê Feats (${e(F),r(()=>e(F).length)??""})`)}),j("click",K,()=>{n(m,"spell"),n(X,null),n(y,"")}),j("click",pe,()=>{n(m,"feat"),n(X,null),n(y,"")}),Ue(tt,()=>e(y),Q=>n(y,Q)),o($,Y)};g(Ee,$=>{e(A)?$(de):$(ge,!1)})}s(J);var Te=a(J,2),T=l(Te),E=a(T,2);s(Te),s(q),s(P),L(()=>E.disabled=!e(X)),j("click",Je,function(...$){p()?.apply(this,$)}),j("click",T,function(...$){p()?.apply(this,$)}),j("click",E,B),j("click",q,ps(function($){Aa.call(this,c,$)})),j("keydown",q,function($){Aa.call(this,c,$)}),j("click",P,function(...$){p()?.apply(this,$)}),j("keydown",P,$=>$.key==="Escape"&&p()()),o(i,P),Kt()}var En=u('<span class="resistance-tag svelte-gdwwx1"> <button type="button" class="tag-remove svelte-gdwwx1">√ó</button></span>'),Hn=u('<div class="resistance-list svelte-gdwwx1"></div>'),Un=u('<p class="ability-meta svelte-gdwwx1"> <!></p>'),Nn=u('<p class="ability-meta svelte-gdwwx1">Requires Reaction</p>'),On=u('<div class="ability-card svelte-gdwwx1"><div class="ability-header svelte-gdwwx1"><strong class="svelte-gdwwx1"> </strong> <button type="button" class="ability-remove svelte-gdwwx1">√ó</button></div> <p class="ability-description svelte-gdwwx1"> </p> <!></div>'),Gn=u('<div class="abilities-list svelte-gdwwx1"></div>'),qn=u(`<div class="modal-backdrop svelte-gdwwx1" role="presentation"><div class="modal-content svelte-gdwwx1" role="dialog" aria-modal="true" aria-labelledby="modal-title"><div class="modal-header svelte-gdwwx1"><h3 id="modal-title" class="svelte-gdwwx1">Add Custom Condition</h3> <button class="btn-close svelte-gdwwx1" aria-label="Close">√ó</button></div> <div class="modal-body svelte-gdwwx1"><div class="form-group svelte-gdwwx1"><label for="conditionName" class="svelte-gdwwx1">Condition Name*</label> <input type="text" id="conditionName" placeholder="e.g., Cazna's Mark" class="svelte-gdwwx1"/></div> <div class="form-group svelte-gdwwx1"><label for="description" class="svelte-gdwwx1">Description</label> <textarea id="description" placeholder="Describe the condition..." rows="3" class="svelte-gdwwx1"></textarea></div> <div class="form-row svelte-gdwwx1"><div class="form-group svelte-gdwwx1"><label for="attackBonus" class="svelte-gdwwx1">Attack Bonus</label> <input type="text" id="attackBonus" placeholder="0 or 1d4" class="svelte-gdwwx1"/></div> <div class="form-group svelte-gdwwx1"><label for="damageBonus" class="svelte-gdwwx1">Damage Bonus</label> <input type="text" id="damageBonus" placeholder="0 or 1d6" class="svelte-gdwwx1"/></div> <div class="form-group svelte-gdwwx1"><label for="acBonus" class="svelte-gdwwx1">AC Bonus</label> <input type="number" id="acBonus" placeholder="0" class="svelte-gdwwx1"/></div></div> <div class="form-group svelte-gdwwx1"><label for="darkvision" class="svelte-gdwwx1">Darkvision (feet)</label> <input type="number" id="darkvision" placeholder="0" min="0" step="30" class="svelte-gdwwx1"/> <small class="help-text svelte-gdwwx1">Grant or extend darkvision (e.g., 60 for 60 feet)</small></div> <div class="form-group svelte-gdwwx1"><label class="svelte-gdwwx1">Damage Resistances</label> <div class="resistance-input-group svelte-gdwwx1"><input type="text" placeholder="e.g., cold, fire, poison" class="svelte-gdwwx1"/> <button type="button" class="btn-add svelte-gdwwx1">Add</button></div> <!></div> <div class="form-group svelte-gdwwx1"><label class="svelte-gdwwx1">Special Abilities</label> <div class="ability-form svelte-gdwwx1"><input type="text" placeholder="Ability name (e.g., Flicker of Deceit)" class="ability-name-input svelte-gdwwx1"/> <textarea placeholder="Ability description..." rows="2" class="ability-desc-input svelte-gdwwx1"></textarea> <div class="ability-options svelte-gdwwx1"><div class="ability-option svelte-gdwwx1"><label for="abilityUses" class="svelte-gdwwx1">Uses per rest</label> <input type="number" id="abilityUses" min="0" class="svelte-gdwwx1"/></div> <div class="ability-option svelte-gdwwx1"><label for="restType" class="svelte-gdwwx1">Rest type</label> <select id="restType" class="svelte-gdwwx1"><option>Short</option><option>Long</option></select></div> <div class="ability-option svelte-gdwwx1"><label class="svelte-gdwwx1"><input type="checkbox" class="svelte-gdwwx1"/> Requires Reaction</label></div></div> <button type="button" class="btn-add svelte-gdwwx1">Add Ability</button></div> <!></div></div> <div class="modal-footer svelte-gdwwx1"><button class="btn btn-secondary svelte-gdwwx1">Cancel</button> <button class="btn btn-primary svelte-gdwwx1">Add Condition</button></div></div></div>`);function zn(i,c){Wt(c,!1);let t=jt(c,"show",8,!1),v=jt(c,"onSave",8),f=jt(c,"onCancel",8),p=C(""),m=C(""),A=C(0),y=C(0),x=C(0),V=C(0),F=C([]),X=C(""),ae=C([]),ie=C(""),G=C(""),B=C(0),P=C("short"),q=C(!1);function De(){n(p,""),n(m,""),n(A,0),n(y,0),n(x,0),n(V,0),n(F,[]),n(X,""),n(ae,[]),n(ie,""),n(G,""),n(B,0),n(P,"short"),n(q,!1)}function Je(){e(X).trim()&&(n(F,[...e(F),e(X).trim()]),n(X,""))}function J(b){n(F,e(F).filter((M,K)=>K!==b))}function Ee(){if(e(ie).trim()&&e(G).trim()){const b={name:e(ie).trim(),description:e(G).trim(),requiresReaction:e(q)};e(B)>0&&(b.usesPerRest=e(B),b.currentUses=e(B),b.restType=e(P)),n(ae,[...e(ae),b]),n(ie,""),n(G,""),n(B,0),n(P,"short"),n(q,!1)}}function de(b){n(ae,e(ae).filter((M,K)=>K!==b))}function ge(){if(!e(p).trim()){alert("Please enter a condition name");return}const b={name:e(p).trim(),description:e(m).trim()||"Custom condition",attackBonus:e(A)||0,damageBonus:e(y)||0,target:"self"};e(x)!==0&&(b.acBonus=e(x)),e(V)>0&&(b.darkvision=e(V)),e(F).length>0&&(b.resistances=e(F)),e(ae).length>0&&(b.abilities=e(ae)),v()(b),De()}function Te(){De(),f()()}function T(b){b.target===b.currentTarget&&Te()}zt();var E=bt(),$=Se(E);{var Y=b=>{var M=qn(),K=l(M),$e=l(K),Le=a(l($e),2);s($e);var pe=a($e,2),ce=l(pe),je=a(l(ce),2);ke(je),s(ce);var Ge=a(ce,2),tt=a(l(Ge),2);ja(tt),s(Ge);var pt=a(Ge,2),rt=l(pt),Ke=a(l(rt),2);ke(Ke),s(rt);var yt=a(rt,2),Ct=a(l(yt),2);ke(Ct),s(yt);var w=a(yt,2),z=a(l(w),2);ke(z),s(w),s(pt);var h=a(pt,2),U=a(l(h),2);ke(U),ta(2),s(h);var Q=a(h,2),re=a(l(Q),2),be=l(re);ke(be);var he=a(be,2);s(re);var Be=a(re,2);{var te=oe=>{var D=Hn();Lt(D,5,()=>e(F),Bt,(O,W,le)=>{var Me=En(),Oe=l(Me),Fe=a(Oe);s(Me),L(()=>{k(Oe,`${e(W)??""} `),et(Fe,"aria-label",`Remove ${e(W)??""}`)}),j("click",Fe,()=>J(le)),o(O,Me)}),s(D),o(oe,D)};g(Be,oe=>{e(F),r(()=>e(F).length>0)&&oe(te)})}s(Q);var S=a(Q,2),Z=a(l(S),2),Ce=l(Z);ke(Ce);var qe=a(Ce,2);ja(qe);var Ye=a(qe,2),mt=l(Ye),_e=a(l(mt),2);ke(_e),s(mt);var ee=a(mt,2),d=a(l(ee),2);L(()=>{e(P),qt(()=>{})});var Ve=l(d);Ve.value=Ve.__value="short";var ye=a(Ve);ye.value=ye.__value="long",s(d),s(ee);var N=a(ee,2),me=l(N),se=l(me);ke(se),ta(),s(me),s(N),s(Ye);var Re=a(Ye,2);s(Z);var we=a(Z,2);{var ze=oe=>{var D=Gn();Lt(D,5,()=>e(ae),Bt,(O,W,le)=>{var Me=On(),Oe=l(Me),Fe=l(Oe),Ae=l(Fe,!0);s(Fe);var ct=a(Fe,2);s(Oe);var ft=a(Oe,2),Pe=l(ft,!0);s(ft);var Ie=a(ft,2);{var $t=ne=>{var Ze=Un(),ht=l(Ze),R=a(ht);{var xe=_=>{var He=Pt("‚Ä¢ Requires Reaction");o(_,He)};g(R,_=>{e(W),r(()=>e(W).requiresReaction)&&_(xe)})}s(Ze),L(()=>k(ht,`${e(W),r(()=>e(W).usesPerRest)??""} use${e(W),r(()=>e(W).usesPerRest>1?"s":"")??""} per ${e(W),r(()=>e(W).restType)??""}
                      rest `)),o(ne,Ze)},ue=ne=>{var Ze=bt(),ht=Se(Ze);{var R=xe=>{var _=Nn();o(xe,_)};g(ht,xe=>{e(W),r(()=>e(W).requiresReaction)&&xe(R)},!0)}o(ne,Ze)};g(Ie,ne=>{e(W),r(()=>e(W).usesPerRest)?ne($t):ne(ue,!1)})}s(Me),L(()=>{k(Ae,(e(W),r(()=>e(W).name))),et(ct,"aria-label",`Remove ${e(W),r(()=>e(W).name)??""}`),k(Pe,(e(W),r(()=>e(W).description)))}),j("click",ct,()=>de(le)),o(O,Me)}),s(D),o(oe,D)};g(we,oe=>{e(ae),r(()=>e(ae).length>0)&&oe(ze)})}s(S),s(pe);var Ne=a(pe,2),Qe=l(Ne),ot=a(Qe,2);s(Ne),s(K),s(M),j("click",Le,Te),Ue(je,()=>e(p),oe=>n(p,oe)),Ue(tt,()=>e(m),oe=>n(m,oe)),Ue(Ke,()=>e(A),oe=>n(A,oe)),Ue(Ct,()=>e(y),oe=>n(y,oe)),Ue(z,()=>e(x),oe=>n(x,oe)),Ue(U,()=>e(V),oe=>n(V,oe)),Ue(be,()=>e(X),oe=>n(X,oe)),j("keydown",be,oe=>oe.key==="Enter"&&Je()),j("click",he,Je),Ue(Ce,()=>e(ie),oe=>n(ie,oe)),Ue(qe,()=>e(G),oe=>n(G,oe)),Ue(_e,()=>e(B),oe=>n(B,oe)),Ua(d,()=>e(P),oe=>n(P,oe)),La(se,()=>e(q),oe=>n(q,oe)),j("click",Re,Ee),j("click",Qe,Te),j("click",ot,ge),j("click",M,T),o(b,M)};g($,b=>{t()&&b(Y)})}o(i,E),Kt()}var Wn=u("<option></option>"),Kn=u("<button> </button>"),Vn=u('<button class="btn btn-primary calculate-btn use-enabled svelte-uvfntf">Calculate Damage</button>'),Jn=u('<div class="adjustment-msg svelte-uvfntf"> </div>'),Yn=u('<div class="calculation-result svelte-uvfntf"><div class="result-header svelte-uvfntf"><h4 class="svelte-uvfntf">Damage Calculation</h4></div> <div class="result-content svelte-uvfntf"><div class="damage-breakdown svelte-uvfntf"><div class="damage-row svelte-uvfntf"><span class="label svelte-uvfntf">Original Damage:</span> <span class="value svelte-uvfntf"> </span></div> <div class="adjustments svelte-uvfntf"></div> <div class="damage-row final svelte-uvfntf"><span class="label svelte-uvfntf">Final Damage:</span> <span class="value damage-value svelte-uvfntf"> </span></div></div></div> <div class="result-actions svelte-uvfntf"><button class="btn btn-primary apply-btn use-enabled svelte-uvfntf">Apply Damage</button> <button class="btn btn-secondary cancel-btn use-enabled svelte-uvfntf">Cancel</button></div></div>'),Qn=u('<div class="damage-form svelte-uvfntf"><div class="input-group svelte-uvfntf"><div class="input-field svelte-uvfntf"><label for="damageAmount" class="svelte-uvfntf">Damage Amount</label> <input type="number" id="damageAmount" min="0" placeholder="0" class="damage-input-field use-enabled svelte-uvfntf"/></div> <div class="input-field svelte-uvfntf"><label for="damageType" class="svelte-uvfntf">Damage Type</label> <input type="text" id="damageType" list="damageTypes" placeholder="e.g., fire, cold" class="damage-input-field use-enabled svelte-uvfntf"/> <datalist id="damageTypes"></datalist></div></div> <div class="quick-types svelte-uvfntf"><span class="quick-types-label svelte-uvfntf">Quick Select:</span> <!></div> <!></div>'),Xn=u("<section><!> <!></section>");function Zn(i,c){Wt(c,!1);const t=()=>ut(ve,"$character",p),v=()=>ut(_a,"$searchFilter",p),f=()=>ut(aa,"$collapsedStates",p),[p,m]=ca(),A=C();$a();let y=C(0),x=C(""),V=C(!1),F=C(0),X=C([]);const ae=["slashing","piercing","bludgeoning","fire","cold","lightning","thunder","acid","poison","necrotic","radiant","psychic","force"];function ie(){if(e(y)<0){Ht.add("Damage amount cannot be negative","error");return}if(!e(x).trim()){Ht.add("Please enter or select a damage type","error");return}const Ee=Hl(e(y),e(x),t());n(F,Ee.finalDamage),n(X,Ee.adjustments),n(V,!0)}function G(){ve.update(Ee=>Ul(Ee,e(F))),Ht.add(`Applied ${e(F)} damage to character (${e(x)})`,"info"),n(y,0),n(x,""),n(V,!1),n(F,0),n(X,[])}function B(){n(V,!1),n(F,0),n(X,[])}Xe(()=>v(),()=>{n(A,!v()||"damage".includes(v().toLowerCase())||"resistance".includes(v().toLowerCase())||"immune".includes(v().toLowerCase()))}),pa(),zt();var P=Xn();let q;var De=l(P);{let Ee=kt(()=>(f(),r(()=>f().damageInput?"Expand":"Collapse")));Sa(De,{title:"Apply Damage",get collapsed(){return f(),r(()=>f().damageInput)},get ariaLabel(){return e(Ee)},onToggle:()=>aa.update(de=>({...de,damageInput:!de.damageInput}))})}var Je=a(De,2);{var J=Ee=>{var de=Qn(),ge=l(de),Te=l(ge),T=a(l(Te),2);ke(T),s(Te);var E=a(Te,2),$=a(l(E),2);ke($);var Y=a($,2);Lt(Y,5,()=>ae,Bt,(pe,ce)=>{var je=Wn(),Ge={};L(()=>{Ge!==(Ge=e(ce))&&(je.value=(je.__value=e(ce))??"")}),o(pe,je)}),s(Y),s(E),s(ge);var b=a(ge,2),M=a(l(b),2);Lt(M,1,()=>ae,Bt,(pe,ce)=>{var je=Kn();let Ge;var tt=l(je,!0);s(je),L(()=>{Ge=Mt(je,1,"quick-type-btn use-enabled svelte-uvfntf",null,Ge,{active:e(x)===e(ce)}),k(tt,e(ce))}),j("click",je,()=>n(x,e(ce))),o(pe,je)}),s(b);var K=a(b,2);{var $e=pe=>{var ce=Vn();j("click",ce,ie),o(pe,ce)},Le=pe=>{var ce=Yn(),je=a(l(ce),2),Ge=l(je),tt=l(Ge),pt=a(l(tt),2),rt=l(pt);s(pt),s(tt);var Ke=a(tt,2);Lt(Ke,5,()=>e(X),Bt,(Q,re)=>{var be=Jn(),he=l(be,!0);s(be),L(()=>k(he,e(re))),o(Q,be)}),s(Ke);var yt=a(Ke,2),Ct=a(l(yt),2),w=l(Ct,!0);s(Ct),s(yt),s(Ge),s(je);var z=a(je,2),h=l(z),U=a(h,2);s(z),s(ce),L(()=>{k(rt,`${e(y)??""} ${e(x)??""}`),k(w,e(F))}),j("click",h,G),j("click",U,B),o(pe,ce)};g(K,pe=>{e(V)?pe(Le,!1):pe($e)})}s(de),Ue(T,()=>e(y),pe=>n(y,pe)),Ue($,()=>e(x),pe=>n(x,pe)),o(Ee,de)};g(Je,Ee=>{f(),r(()=>!f().damageInput)&&Ee(J)})}s(P),L(()=>q=Mt(P,1,"damage-input svelte-uvfntf",null,q,{hidden:!e(A)})),o(i,P),Kt(),m()}var eo=u('<button class="console-toggle svelte-x96uf"> </button>'),to=u('<div class="no-logs svelte-x96uf">No console messages yet</div>'),ao=u('<div><span class="log-timestamp svelte-x96uf"> </span> <span class="log-type svelte-x96uf"> </span> <span class="log-message svelte-x96uf"> </span></div>'),so=u('<div class="console-content svelte-x96uf"><!></div>'),lo=u('<div><div class="console-header svelte-x96uf"><span class="console-title svelte-x96uf"> </span> <div class="console-controls svelte-x96uf"><button class="control-btn svelte-x96uf"> </button> <button class="control-btn svelte-x96uf">üóëÔ∏è</button> <button class="control-btn svelte-x96uf">‚úï</button></div></div> <!></div>'),io=u('<div class="console-viewer svelte-x96uf"><!> <!></div>');function ro(i,c){Wt(c,!1);let t=C([]),v=C(!1),f=C(!1);wa(()=>{const ie=console.log;console.log=function(...q){p("log",q),ie.apply(console,q)};const G=console.error;console.error=function(...q){p("error",q),G.apply(console,q)};const B=console.warn;console.warn=function(...q){p("warn",q),B.apply(console,q)};const P=console.info;return console.info=function(...q){p("info",q),P.apply(console,q)},window.addEventListener("error",q=>{p("error",[`Uncaught Error: ${q.message} at ${q.filename}:${q.lineno}:${q.colno}`])}),window.addEventListener("unhandledrejection",q=>{p("error",[`Unhandled Promise Rejection: ${q.reason}`])}),()=>{console.log=ie,console.error=G,console.warn=B,console.info=P}});function p(ie,G){const B=G.map(q=>{if(typeof q=="object")try{return JSON.stringify(q,null,2)}catch{return String(q)}return String(q)}).join(" "),P=new Date().toLocaleTimeString();n(t,[...e(t),{type:ie,message:B,timestamp:P}]),e(t).length>100&&n(t,e(t).slice(-100))}function m(){n(t,[])}function A(){n(v,!e(v))}function y(){n(f,!e(f))}zt();var x=io(),V=l(x);{var F=ie=>{var G=eo(),B=l(G);s(G),L(()=>k(B,`üêõ Console (${e(t).length??""})`)),j("click",G,A),o(ie,G)};g(V,ie=>{e(v)||ie(F)})}var X=a(V,2);{var ae=ie=>{var G=lo();let B;var P=l(G),q=l(P),De=l(q);s(q);var Je=a(q,2),J=l(Je),Ee=l(J,!0);s(J);var de=a(J,2),ge=a(de,2);s(Je),s(P);var Te=a(P,2);{var T=E=>{var $=so(),Y=l($);{var b=K=>{var $e=to();o(K,$e)},M=K=>{var $e=bt(),Le=Se($e);Lt(Le,1,()=>e(t),Bt,(pe,ce)=>{var je=ao(),Ge=l(je),tt=l(Ge,!0);s(Ge);var pt=a(Ge,2),rt=l(pt);s(pt);var Ke=a(pt,2),yt=l(Ke,!0);s(Ke),s(je),L(Ct=>{Mt(je,1,`log-entry ${e(ce).type??""}`,"svelte-x96uf"),k(tt,e(ce).timestamp),k(rt,`[${Ct??""}]`),k(yt,e(ce).message)},[()=>e(ce).type.toUpperCase()]),o(pe,je)}),o(K,$e)};g(Y,K=>{e(t).length===0?K(b):K(M,!1)})}s($),o(E,$)};g(Te,E=>{e(f)||E(T)})}s(G),L(()=>{B=Mt(G,1,"console-panel svelte-x96uf",null,B,{minimized:e(f)}),k(De,`üêõ Console Logs (${e(t).length??""})`),k(Ee,e(f)?"‚ñ≤":"‚ñº")}),j("click",J,y),j("click",de,m),j("click",ge,A),o(ie,G)};g(X,ie=>{e(v)&&ie(ae)})}s(x),o(i,x),Kt()}var no=u('<link rel="icon" type="image/png" href="favicon4.png"/> <meta name="viewport" content="width=device-width, initial-scale=1"/>',1),oo=u('<span class="character-name svelte-1uha8ag"> </span>'),co=u("<span> </span>"),vo=u('<div class="spell-slots-header svelte-1uha8ag"></div>'),uo=u("<span> </span><br/>",1),fo=u("<span> </span><br/>",1),po=u("<span> </span><br/>",1),mo=u("<span> </span><br/>",1),go=u("<span> </span><br/>",1),bo=u("<span> </span><br/>",1),ho=u("<br/><em> <!>)</em>",1),_o=u("<br/><em>(requires reaction)</em>",1),yo=u('<div class="ability-detail"><strong> </strong> <!></div>'),xo=u('<div class="abilities-section"><strong>Abilities:</strong><br/> <!></div>'),$o=u('<span class="effect-tooltip"><strong> </strong><br/> <br/> <!> <!> <!> <!> <!> <!> <!></span>'),wo=u('<button class="effect-remove-btn svelte-1uha8ag">√ó</button>'),So=u('<span class="effect-badge svelte-1uha8ag" tabindex="0"> <!> <!></span>'),ko=u(`<div class="active-effects-header svelte-1uha8ag"></div> <style>.effect-badge {
              position: relative;
            }
            .effect-tooltip {
              position: absolute;
              top: 120%;
              left: 50%;
              transform: translateX(-50%);
              background: #fff;
              color: #222;
              border: 1px solid #a5b4fc;
              border-radius: 6px;
              padding: 8px 12px;
              font-size: 0.95em;
              box-shadow: 0 2px 8px rgba(0, 0, 0, 0.12);
              z-index: 10;
              min-width: 180px;
              max-width: 300px;
              white-space: normal;
              pointer-events: none;
              opacity: 1;
              transition: opacity 0.15s;
            }

            .abilities-section {
              margin-top: 8px;
              padding-top: 8px;
              border-top: 1px solid #e5e7eb;
            }

            .ability-detail {
              margin-top: 6px;
              padding: 4px;
              background: #f9fafb;
              border-radius: 4px;
              font-size: 0.9em;
            }

            .ability-detail strong {
              color: #6366f1;
            }

            .ability-detail em {
              font-size: 0.85em;
              color: #6b7280;
            }</style>`,1),Co=u('<div class="rest-menu svelte-1uha8ag"><button class="rest-option svelte-1uha8ag">‚òï Short Rest</button> <button class="rest-option svelte-1uha8ag">üõèÔ∏è Long Rest</button></div>'),Do=u('<div class="container svelte-1uha8ag"><header class="svelte-1uha8ag"><div class="header-top svelte-1uha8ag"><div class="header-title svelte-1uha8ag"><div class="title-row svelte-1uha8ag"><h1 class="svelte-1uha8ag">D&D Character Sheet</h1> <!></div> <!> <!></div> <div class="header-right svelte-1uha8ag"><div class="header-controls svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">üé≤</span><span class="btn-text svelte-1uha8ag">Roll Dice</span></button> <div class="rest-button-container svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">üò¥</span><span class="btn-text svelte-1uha8ag">Rest</span></button> <!></div> <button class="btn btn-secondary use-enabled" title="Add custom condition with effects"><span class="btn-icon svelte-1uha8ag">‚ú®</span><span class="btn-text svelte-1uha8ag">Add Condition</span></button> <div class="mode-toggle"><button><span class="btn-icon svelte-1uha8ag"> </span><span class="btn-text svelte-1uha8ag"> </span></button></div></div> <div class="header-search svelte-1uha8ag"><input type="text" placeholder="üîç Search..." class="search-input use-enabled svelte-1uha8ag"/></div></div></div> <div class="header-actions svelte-1uha8ag"><button class="btn btn-mode svelte-1uha8ag">üìö Browse Spells & Feats</button> <button class="btn btn-secondary">Save to Gist</button> <button class="btn btn-secondary">Load from Gist</button> <button class="btn btn-secondary">Export JSON</button> <button class="btn btn-secondary">Import JSON</button> <input type="file" accept=".json" style="display: none;"/></div></header> <main class="svelte-1uha8ag"><!> <!> <!> <!> <!> <!> <!> <!></main></div> <!> <!> <!> <!> <!> <!>',1);function Po(i,c){Wt(c,!1);const t=()=>ut(ve,"$character",p),v=()=>ut(xa,"$isEditMode",p),f=()=>ut(_a,"$searchFilter",p),[p,m]=ca();function A(){const R=[],xe=t().classFeatures.spellSlotsByLevel||{};for(let _=1;_<=9;_++){const He=xe[_];if(He&&He.length>0){const I=He.length,Rt=He.filter(_t=>_t).length;R.push({level:_,available:I-Rt,total:I})}}return R}let y=C(!1),x=C(!1),V=C(!1),F=C(!1),X=C("save"),ae=C(void 0),ie=C(""),G=C(""),B=C(""),P=C(!1),q=C([]),De=C("other"),Je=C(),J=!1,Ee=1,de=C(!1),ge=C(null);function Te(R){n(ge,R)}function T(){n(ge,null)}function E(R){n(ge,e(ge)===R?null:R)}function $(R){ve.update(xe=>(xe.activeStates||(xe.activeStates=[]),xe.activeStates=[...xe.activeStates,R],xe)),n(F,!1),Ht.add(`Added condition: ${R.name}`,"success")}function Y(){n(F,!1)}function b(){const R=[];ve.update(I=>{const Rt=I.hitDice.current;I.hitDice.current=Math.min(I.hitDice.max,I.hitDice.current+Math.max(1,Math.floor(I.hitDice.max/2)));const _t=I.hitDice.current-Rt;if(_t>0&&R.push(`${_t} hit ${_t===1?"die":"dice"}`),I.class){const at=Ba(I.class,I.level,I.subclass);I.classFeatures.features||(I.classFeatures.features={}),at.forEach(fe=>{if(fe.resetOn==="short"){const vt=fe.name.replace(/\s+/g,"");if(fe.type==="uses"){const st=typeof fe.maxUses=="function"?fe.maxUses(I.level):fe.maxUses;I.classFeatures.features[vt]=Array(st).fill(!1),R.push(fe.name)}else if(fe.type==="pool"){const st=typeof fe.maxPool=="function"?fe.maxPool(I.level):fe.maxPool;st!==void 0&&(I.classFeatures.features[vt]=st,R.push(fe.name))}}})}return I.activeStates&&I.activeStates.forEach(at=>{at.abilities&&at.abilities.forEach(fe=>{if(fe.restType==="short"&&fe.usesPerRest){const vt=fe.usesPerRest-(fe.currentUses||0)>0;fe.currentUses=fe.usesPerRest,vt&&R.push(`${at.name}: ${fe.name}`)}})}),I}),hs("short"),_s(t().race,t().level).some(I=>I.restType==="short"&&I.usesPerRest)&&R.push("racial traits"),n(de,!1);const He=R.length>0?`Short rest taken! Restored: ${R.join(", ")}`:"Short rest taken!";Ht.add(He,"success")}function M(){const R=[];ve.update(I=>{const Rt=I.maxHP-I.currentHP;Rt>0&&R.push(`${Rt} HP`),I.currentHP=I.maxHP,I.tempHP=0;const _t=I.hitDice.max-I.hitDice.current;_t>0&&R.push(`${_t} hit ${_t===1?"die":"dice"}`),I.hitDice.current=I.hitDice.max;let at=0;if(I.classFeatures.spellSlotsByLevel&&Object.keys(I.classFeatures.spellSlotsByLevel).forEach(fe=>{const vt=I.classFeatures.spellSlotsByLevel[parseInt(fe)];if(vt){const st=vt.filter(Ft=>Ft).length;at+=st,I.classFeatures.spellSlotsByLevel[parseInt(fe)]=Array(vt.length).fill(!1)}}),at>0&&R.push(`${at} spell ${at===1?"slot":"slots"}`),I.class){const fe=Ba(I.class,I.level,I.subclass);I.classFeatures.features||(I.classFeatures.features={});let vt=!1;fe.forEach(st=>{const Ft=st.name.replace(/\s+/g,"");if(!(st.type==="info"||st.type==="channelDivinity")){if(st.type==="uses"){const We=typeof st.maxUses=="function"?st.maxUses(I.level):st.maxUses;I.classFeatures.features[Ft]=Array(We).fill(!1),vt=!0}else if(st.type==="pool"){const We=typeof st.maxPool=="function"?st.maxPool(I.level):st.maxPool;We!==void 0&&(I.classFeatures.features[Ft]=We,vt=!0)}}}),vt&&R.push("all class features")}if(I.activeStates){let fe=!1;I.activeStates.forEach(vt=>{vt.abilities&&vt.abilities.forEach(st=>{if(st.usesPerRest){const Ft=(st.currentUses||0)<st.usesPerRest;st.currentUses=st.usesPerRest,Ft&&(fe=!0)}})}),fe&&R.push("condition abilities")}return I}),hs("long"),_s(t().race,t().level).some(I=>I.usesPerRest)&&R.push("racial traits"),n(de,!1);const He=R.length>0?`Long rest taken! Restored: ${R.join(", ")}`:"Long rest taken! Fully rested.";Ht.add(He,"success")}function K(R){n(ie,""),n(G,""),n(B,""),n(P,!1),n(q,[]),n(De,"other"),J=!1,typeof R=="string"?n(ie,R):(n(ie,R.notation),n(G,R.damageNotation||""),n(B,R.attackName||""),n(P,!!R.applyHalfDamage),n(q,R.bonusBreakdown||[]),n(De,R.rollType||"other")),n(y,!0)}function $e(R){const{notation:xe,count:_,bonusBreakdown:He}=R.detail;n(ie,""),J=!0,Ee=_||1,setTimeout(()=>{n(ie,xe),n(G,""),n(B,"Hit Die"),n(q,He||[]),n(De,"other")},0),n(y,!0)}function Le(){if(n(y,!1),J&&e(Je)){const R=e(Je).getLastRollTotal();if(R!==null){const xe=Math.max(1,R);ve.update(_=>(_.hitDice.current=Math.max(0,_.hitDice.current-Ee),_.currentHP=Math.min(_.maxHP,_.currentHP+xe),_))}J=!1}}function pe(){xa.update(R=>!R)}function ce(R){R.target.closest(".rest-button-container")||n(de,!1)}wa(()=>{const R=xa.subscribe(xe=>{xe?document.body.classList.remove("use-mode"):document.body.classList.add("use-mode")});return document.addEventListener("click",ce),()=>{R(),document.removeEventListener("click",ce)}});function je(){vl(t())}function Ge(){e(ae)?.click()}async function tt(R){const _=R.target.files?.[0];if(_)try{const He=await dl(_);ve.set(He),alert("Character imported successfully!")}catch{alert("Failed to import character file")}}zt();var pt=Do();ol("1uha8ag",R=>{var xe=no();ta(2),Bs(()=>{ll.title="D&D Character Sheet"}),o(R,xe)});var rt=Se(pt),Ke=l(rt),yt=l(Ke),Ct=l(yt),w=l(Ct),z=a(l(w),2);{var h=R=>{var xe=oo(),_=l(xe);s(xe),L(()=>k(_,`${t().name??""} (${t().level??""})`)),o(R,xe)};g(z,R=>{t().name&&R(h)})}s(w);var U=a(w,2);{var Q=R=>{var xe=vo();Lt(xe,5,A,Bt,(_,He)=>{var I=co();let Rt;var _t=l(I);s(I),L(()=>{Rt=Mt(I,1,"slot-badge svelte-1uha8ag",null,Rt,{depleted:e(He).available===0}),k(_t,`Lv${e(He).level??""}: ${e(He).available??""}/${e(He).total??""}`)}),o(_,I)}),s(xe),o(R,xe)};g(U,R=>{A().length>0&&R(Q)})}var re=a(U,2);{var be=R=>{var xe=ko(),_=Se(xe);Lt(_,5,()=>t().activeStates,Bt,(He,I,Rt)=>{var _t=So(),at=l(_t),fe=a(at);{var vt=We=>{var gt=$o(),xt=l(gt),Ut=l(xt,!0);s(xt);var ia=a(xt,2),wt=a(ia,3);{var At=it=>{var dt=uo(),nt=Se(dt),Tt=l(nt);s(nt),ta(),L(()=>k(Tt,`Attack Bonus: ${typeof e(I).attackBonus=="number"&&e(I).attackBonus>0?"+":""}${e(I).attackBonus??""}`)),o(it,dt)};g(wt,it=>{e(I).attackBonus&&it(At)})}var sa=a(wt,2);{var ra=it=>{var dt=fo(),nt=Se(dt),Tt=l(nt);s(nt),ta(),L(()=>k(Tt,`Damage Bonus: ${typeof e(I).damageBonus=="number"&&e(I).damageBonus>0?"+":""}${e(I).damageBonus??""}`)),o(it,dt)};g(sa,it=>{e(I).damageBonus&&it(ra)})}var Xt=a(sa,2);{var Dt=it=>{var dt=po(),nt=Se(dt),Tt=l(nt);s(nt),ta(),L(()=>k(Tt,`AC Bonus: ${e(I).acBonus>0?"+":""}${e(I).acBonus??""}`)),o(it,dt)};g(Xt,it=>{e(I).acBonus&&it(Dt)})}var lt=a(Xt,2);{var It=it=>{var dt=mo(),nt=Se(dt),Tt=l(nt);s(nt),ta(),L(()=>k(Tt,`Darkvision: ${e(I).darkvision??""} feet`)),o(it,dt)};g(lt,it=>{e(I).darkvision&&it(It)})}var Yt=a(lt,2);{var Qt=it=>{var dt=go(),nt=Se(dt),Tt=l(nt);s(nt),ta(),L(Et=>k(Tt,`Resistances: ${Et??""}`),[()=>e(I).resistances.join(", ")]),o(it,dt)};g(Yt,it=>{e(I).resistances&&e(I).resistances.length>0&&it(Qt)})}var na=a(Yt,2);{var va=it=>{var dt=bo(),nt=Se(dt),Tt=l(nt);s(nt),ta(),L(Et=>k(Tt,`Immunities: ${Et??""}`),[()=>e(I).immunities.join(", ")]),o(it,dt)};g(na,it=>{e(I).immunities&&e(I).immunities.length>0&&it(va)})}var da=a(na,2);{var Vt=it=>{var dt=xo(),nt=a(l(dt),3);Lt(nt,1,()=>e(I).abilities,Bt,(Tt,Et)=>{var ua=yo(),Nt=l(ua),la=l(Nt);s(Nt);var Gt=a(Nt),fa=a(Gt);{var ma=Zt=>{var ea=ho(),St=a(Se(ea)),Jt=l(St),ga=a(Jt);{var Ra=Ta=>{var Xa=Pt(", requires reaction");o(Ta,Xa)};g(ga,Ta=>{e(Et).requiresReaction&&Ta(Ra)})}ta(),s(St),L(()=>k(Jt,`(${(e(Et).currentUses||0)??""}/${e(Et).usesPerRest??""} uses per ${e(Et).restType??""}
                                rest`)),o(Zt,ea)},ka=Zt=>{var ea=bt(),St=Se(ea);{var Jt=ga=>{var Ra=_o();ta(),o(ga,Ra)};g(St,ga=>{e(Et).requiresReaction&&ga(Jt)},!0)}o(Zt,ea)};g(fa,Zt=>{e(Et).usesPerRest?Zt(ma):Zt(ka,!1)})}s(ua),L(()=>{k(la,`${e(Et).name??""}:`),k(Gt,` ${e(Et).description??""} `)}),o(Tt,ua)}),s(dt),o(it,dt)};g(da,it=>{e(I).abilities&&e(I).abilities.length>0&&it(Vt)})}s(gt),L(()=>{k(Ut,e(I).name),k(ia,` ${e(I).description??""}`)}),o(We,gt)};g(fe,We=>{e(ge)===Rt&&We(vt)})}var st=a(fe,2);{var Ft=We=>{var gt=wo();L(()=>et(gt,"title",`End ${e(I).name??""}`)),j("click",gt,()=>{ve.update(xt=>{if(xt.activeStates){const Ut=xt.activeStates[Rt];Ut?.hpBonus&&Ut.target!=="other"&&(xt.maxHP-=Ut.hpBonus,xt.currentHP=Math.max(1,Math.min(xt.currentHP-Ut.hpBonus,xt.maxHP))),xt.activeStates=xt.activeStates.filter((ia,wt)=>wt!==Rt)}return xt})}),o(We,gt)};g(st,We=>{v()||We(Ft)})}s(_t),L(()=>{et(_t,"aria-label",e(I).name),k(at,`‚ú® ${e(I).name??""} `)}),j("mouseenter",_t,()=>Te(Rt)),j("mouseleave",_t,T),j("focus",_t,()=>Te(Rt)),j("blur",_t,T),j("click",_t,()=>E(Rt)),o(He,_t)}),s(_),ta(2),o(R,xe)};g(re,R=>{t().activeStates&&t().activeStates.length>0&&R(be)})}s(Ct);var he=a(Ct,2),Be=l(he),te=l(Be),S=a(te,2),Z=l(S),Ce=a(Z,2);{var qe=R=>{var xe=Co(),_=l(xe),He=a(_,2);s(xe),j("click",_,b),j("click",He,M),o(R,xe)};g(Ce,R=>{e(de)&&R(qe)})}s(S);var Ye=a(S,2),mt=a(Ye,2),_e=l(mt);let ee;var d=l(_e),Ve=l(d,!0);s(d);var ye=a(d),N=l(ye,!0);s(ye),s(_e),s(mt),s(Be);var me=a(Be,2),se=l(me);ke(se),s(me),s(he),s(yt);var Re=a(yt,2),we=l(Re),ze=a(we,2),Ne=a(ze,2),Qe=a(Ne,2),ot=a(Qe,2),oe=a(ot,2);Ha(oe,R=>n(ae,R),()=>e(ae)),s(Re),s(Ke);var D=a(Ke,2),O=l(D);Al(O,{});var W=a(O,2);Ml(W,{$$events:{roll:R=>K(R.detail)}});var le=a(W,2);ti(le,{$$events:{roll:R=>K(R.detail)}});var Me=a(le,2);Ql(Me,{$$events:{rollHitDice:$e}});var Oe=a(Me,2);Zn(Oe,{});var Fe=a(Oe,2);ur(Fe,{$$events:{roll:R=>K(R.detail)}});var Ae=a(Fe,2);Br(Ae,{});var ct=a(Ae,2);Mr(ct,{}),s(D),s(rt);var ft=a(rt,2);Ha(en(ft,{get notation(){return e(ie)},get damageNotation(){return e(G)},get attackName(){return e(B)},get applyHalfDamage(){return e(P)},get bonusBreakdown(){return e(q)},get rollType(){return e(De)},get visible(){return e(y)},$$events:{close:Le},$$legacy:!0}),R=>n(Je,R),()=>e(Je));var Pe=a(ft,2);{var Ie=R=>{xn(R,{get mode(){return e(X)},$$events:{close:()=>n(x,!1)}})};g(Pe,R=>{e(x)&&R(Ie)})}var $t=a(Pe,2);{var ue=R=>{In(R,{onClose:()=>n(V,!1)})};g($t,R=>{e(V)&&R(ue)})}var ne=a($t,2);zn(ne,{get show(){return e(F)},onSave:$,onCancel:Y});var Ze=a(ne,2);cl(Ze,{});var ht=a(Ze,2);ro(ht,{}),L(()=>{ee=Mt(_e,1,"btn btn-mode svelte-1uha8ag",null,ee,{"use-mode":!v()}),k(Ve,v()?"üìù":"üé≤"),k(N,v()?"Edit Mode":"Use Mode")}),j("click",te,()=>{n(q,[]),n(y,!0)}),j("click",Z,()=>n(de,!e(de))),j("click",Ye,()=>n(F,!0)),j("click",_e,pe),Ue(se,f,R=>ul(_a,R)),j("click",we,()=>n(V,!0)),j("click",ze,()=>{n(X,"save"),n(x,!0)}),j("click",Ne,()=>{n(X,"load"),n(x,!0)}),j("click",Qe,je),j("click",ot,Ge),j("change",oe,tt),o(i,pt),Kt(),m()}export{Po as component};
