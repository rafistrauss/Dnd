import{d as vs,g as Ps,f as d,e as B,a as o,s as w,c as gt,t as Rt}from"../chunks/BESELRjb.js";import{i as qt}from"../chunks/JMgyEzd3.js";import{c as ha,o as Sa,a as Is,b as Es}from"../chunks/CtPH092J.js";import{F as S,T as pa,Y as es,j as Us,aZ as Hs,U as ds,ag as Ns,aD as Os,aK as Gs,aE as qs,a1 as zs,av as Pa,a7 as ns,i as Ss,a_ as Ws,a$ as Cs,b0 as Oa,K as ga,e as Ds,b1 as Ls,b2 as Ks,b3 as Vs,b4 as Js,q as ts,b5 as Ys,b6 as Qs,ab as Xs,d as n,r as rs,g as Zs,C as zt,G as Wt,H as l,I as s,J as a,b7 as tt,b8 as va,s as r,a4 as D,f as e,m as yt,E as Le,b9 as Ut,ao as Yt,A as V,ba as fa,bb as xa,bc as el}from"../chunks/DyJ43TGI.js";import{t as tl,c as Qt,a as ge,e as xt,i as Ct,u as js,s as ma,b as At,d as Ga,f as ba,g as al,j as Ht,k as us,l as ps,m as as,n as sl,h as ll,T as il,o as nl,p as rl,r as fs}from"../chunks/t82uA2lk.js";import{i as b,s as na,a as mt,b as Pt,d as Da,e as ol}from"../chunks/CCL4udNy.js";import{p as St,b as Ba}from"../chunks/iXw84bXb.js";import{b as La,r as cl}from"../chunks/CQ3vs-km.js";function vl(i,c,t=!1,v=!1,u=!1){var p=i,f="";S(()=>{var j=Us;if(f===(f=c()??"")){pa&&es();return}if(j.nodes_start!==null&&(Hs(j.nodes_start,j.nodes_end),j.nodes_start=j.nodes_end=null),f!==""){if(pa){ds.data;for(var _=es(),y=_;_!==null&&(_.nodeType!==Ns||_.data!=="");)y=_,_=Os(_);if(_===null)throw Gs(),qs;vs(ds,y),p=zs(_);return}var Y=f+"";t?Y=`<svg>${Y}</svg>`:v&&(Y=`<math>${Y}</math>`);var P=Ps(Y);if((t||v)&&(P=Pa(P)),vs(Pa(P),P.lastChild),t||v)for(;Pa(P);)p.before(Pa(P));else p.before(P)}})}function dl(i,c,t,v,u){pa&&es();var p=c.$$slots?.[t],f=!1;p===!0&&(p=c[t],f=!0),p===void 0?u!==null&&u(i):p(i,f?()=>v:v)}function ul(i,c,t,v){var u=i.__style;if(pa||u!==c){var p=tl(c);(!pa||p!==i.getAttribute("style"))&&(p==null?i.removeAttribute("style"):i.style.cssText=p),i.__style=c}return v}function Na(i,c,t=!1){if(i.multiple){if(c==null)return;if(!Ss(c))return Ws();for(var v of i.options)v.selected=c.includes(ja(v));return}for(v of i.options){var u=ja(v);if(Cs(u,c)){v.selected=!0;return}}(!t||c!==void 0)&&(i.selectedIndex=-1)}function ss(i){var c=new MutationObserver(()=>{Na(i,i.__value)});c.observe(i,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),ns(()=>{c.disconnect()})}function Ra(i,c,t=c){var v=new WeakSet,u=!0;Oa(i,"change",p=>{var f=p?"[selected]":":checked",j;if(i.multiple)j=[].map.call(i.querySelectorAll(f),ja);else{var _=i.querySelector(f)??i.querySelector("option:not([disabled])");j=_&&ja(_)}t(j),ga!==null&&v.add(ga)}),Ds(()=>{var p=c();if(i===document.activeElement){var f=Ls??ga;if(v.has(f))return}if(Na(i,p,u),u&&p===void 0){var j=i.querySelector(":checked");j!==null&&(p=ja(j),t(p))}i.__value=p,u=!1}),ss(i)}function ja(i){return"__value"in i?i.__value:i.value}const pl=Symbol("is custom element"),fl=Symbol("is html");function je(i){if(pa){var c=!1,t=()=>{if(!c){if(c=!0,i.hasAttribute("value")){var v=i.value;nt(i,"value",null),i.value=v}if(i.hasAttribute("checked")){var u=i.checked;nt(i,"checked",null),i.checked=u}}};i.__on_r=t,ts(t),Ys()}}function Aa(i,c){var t=os(i);t.value===(t.value=c??void 0)||i.value===c&&(c!==0||i.nodeName!=="PROGRESS")||(i.value=c??"")}function As(i,c){var t=os(i);t.checked!==(t.checked=c??void 0)&&(i.checked=c)}function nt(i,c,t,v){var u=os(i);pa&&(u[c]=i.getAttribute(c),c==="src"||c==="srcset"||c==="href"&&i.nodeName==="LINK")||u[c]!==(u[c]=t)&&(c==="loading"&&(i[Ks]=t),t==null?i.removeAttribute(c):typeof t!="string"&&ml(i).includes(c)?i[c]=t:i.setAttribute(c,t))}function os(i){return i.__attributes??={[pl]:i.nodeName.includes("-"),[fl]:i.namespaceURI===Vs}}var ms=new Map;function ml(i){var c=i.getAttribute("is")||i.nodeName,t=ms.get(c);if(t)return t;ms.set(c,t=[]);for(var v,u=i,p=Element.prototype;p!==u;){v=Qs(u);for(var f in v)v[f].set&&t.push(f);u=Js(u)}return t}function Ne(i,c,t=c){var v=new WeakSet;Oa(i,"input",async u=>{var p=u?i.defaultValue:i.value;if(p=Va(i)?Ja(p):p,t(p),ga!==null&&v.add(ga),await Xs(),p!==(p=c())){var f=i.selectionStart,j=i.selectionEnd,_=i.value.length;if(i.value=p??"",j!==null){var y=i.value.length;f===j&&j===_&&y>_?(i.selectionStart=y,i.selectionEnd=y):(i.selectionStart=f,i.selectionEnd=Math.min(j,y))}}}),(pa&&i.defaultValue!==i.value||n(c)==null&&i.value)&&(t(Va(i)?Ja(i.value):i.value),ga!==null&&v.add(ga)),rs(()=>{var u=c();if(i===document.activeElement){var p=Ls??ga;if(v.has(p))return}Va(i)&&u===Ja(i.value)||i.type==="date"&&!u&&!i.value||u!==i.value&&(i.value=u??"")})}const Ka=new Set;function gs(i,c,t,v,u=v){var p=t.getAttribute("type")==="checkbox",f=i;let j=!1;if(c!==null)for(var _ of c)f=f[_]??=[];f.push(t),Oa(t,"change",()=>{var y=t.__value;p&&(y=bs(f,y,t.checked)),u(y)},()=>u(p?[]:null)),rs(()=>{var y=v();if(pa&&t.defaultChecked!==t.checked){j=!0;return}p?(y=y||[],t.checked=y.includes(t.__value)):t.checked=Cs(t.__value,y)}),ns(()=>{var y=f.indexOf(t);y!==-1&&f.splice(y,1)}),Ka.has(f)||(Ka.add(f),ts(()=>{f.sort((y,Y)=>y.compareDocumentPosition(Y)===4?-1:1),Ka.delete(f)})),ts(()=>{if(j){var y;if(p)y=bs(f,y,t.checked);else{var Y=f.find(P=>P.checked);y=Y?.__value}u(y)}})}function $a(i,c,t=c){Oa(i,"change",v=>{var u=v?i.defaultChecked:i.checked;t(u)}),(pa&&i.defaultChecked!==i.checked||n(c)==null)&&t(i.checked),rs(()=>{var v=c();i.checked=!!v})}function bs(i,c,t){for(var v=new Set,u=0;u<i.length;u+=1)i[u].checked&&v.add(i[u].__value);return t||v.delete(c),Array.from(v)}function Va(i){var c=i.type;return c==="number"||c==="range"}function Ja(i){return i===""?null:+i}function gl(i,c,t){var v=Zs(i,c);v&&v.set&&(i[c]=t,ns(()=>{i[c]=null}))}function cs(i){return function(...c){var t=c[0];return t.stopPropagation(),i?.apply(this,c)}}function ka(i,c){var t=i.$$events?.[c.type],v=Ss(t)?t.slice():t==null?[]:[t];for(var u of v)u.call(this,c)}const bl="";function Bs(...i){return La+bl+cl(i[0],i[1])}const ls={paladin:{name:"Paladin",hitDice:"d10",spellcaster:!0,spellcastingAbility:"charisma",spellSlotsByLevel:{1:0,2:2,3:3,4:3,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Divine Sense",type:"uses",maxUses:(i,c=1)=>1+Math.max(1,c),resetOn:"long",description:"Detect celestials, fiends, and undead within 60 feet",minLevel:1},{name:"Lay on Hands",type:"pool",maxPool:i=>i*5,resetOn:"long",description:"Heal wounds or cure disease",minLevel:1},{name:"Divine Smite",type:"spellSlot",description:"Expend spell slot to deal extra radiant damage",minLevel:2,rollable:!0},{name:"Channel Divinity",type:"pool",maxPool:i=>i>=18?3:i>=6?2:1,resetOn:"short",description:"Sacred Weapon or Turn Undead",minLevel:3}]},fighter:{name:"Fighter",hitDice:"d10",spellcaster:!1,features:[{name:"Second Wind",type:"uses",maxUses:1,resetOn:"short",description:"Regain 1d10 + fighter level HP as bonus action",minLevel:1,rollable:!0,rollFormula:i=>`1d10+${i}`},{name:"Action Surge",type:"uses",maxUses:i=>i>=17?2:1,resetOn:"short",description:"Take one additional action on your turn",minLevel:2},{name:"Indomitable",type:"uses",maxUses:i=>i>=17?3:i>=13?2:1,resetOn:"long",description:"Reroll a failed saving throw",minLevel:9}],subclasses:{champion:{name:"Champion",features:[{name:"Improved Critical",type:"info",description:"Critical hit on 19-20",minLevel:3},{name:"Remarkable Athlete",type:"info",description:"Add half proficiency to STR/DEX/CON checks, increase long jump distance",minLevel:7},{name:"Additional Fighting Style",type:"info",description:"Choose a second fighting style",minLevel:10},{name:"Superior Critical",type:"info",description:"Critical hit on 18-20",minLevel:15},{name:"Survivor",type:"info",description:"Regain 5 + CON mod HP at start of turn if below half HP",minLevel:18}]},battlemaster:{name:"Battle Master",features:[{name:"Combat Superiority",type:"uses",maxUses:i=>i>=15?6:i>=7?5:4,resetOn:"short",description:i=>`Use superiority dice (${i>=18?"d12":i>=10?"d10":"d8"}) for maneuvers`,minLevel:3},{name:"Know Your Enemy",type:"info",description:"Learn capabilities of creatures you observe",minLevel:7},{name:"Improved Combat Superiority",type:"info",description:"Superiority dice become d10",minLevel:10},{name:"Relentless",type:"info",description:"Regain 1 superiority die if you have none at start of turn",minLevel:15}]}}},rogue:{name:"Rogue",hitDice:"d8",spellcaster:!1,features:[{name:"Sneak Attack",type:"info",description:i=>`Deal ${Math.ceil(i/2)}d6 extra damage once per turn with advantage or ally nearby`,minLevel:1,rollable:!0,rollFormula:i=>`${Math.ceil(i/2)}d6`},{name:"Cunning Action",type:"info",description:"Dash, Disengage, or Hide as a bonus action",minLevel:2},{name:"Uncanny Dodge",type:"info",description:"Use reaction to halve damage from an attack",minLevel:5},{name:"Evasion",type:"info",description:"Take no damage on successful Dex save (half on fail)",minLevel:7}]},wizard:{name:"Wizard",hitDice:"d6",spellcaster:!0,spellcastingAbility:"intelligence",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Arcane Recovery",type:"uses",maxUses:1,resetOn:"long",description:i=>`Recover spell slots totaling up to ${Math.ceil(i/2)} levels during short rest`,minLevel:1},{name:"Spell Mastery",type:"info",description:"Cast one 1st-level and one 2nd-level spell at will",minLevel:18}]},cleric:{name:"Cleric",hitDice:"d8",spellcaster:!0,spellcastingAbility:"wisdom",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Channel Divinity",type:"pool",maxPool:i=>i>=18?3:i>=6?2:1,resetOn:"short",description:"Turn Undead or domain-specific ability",minLevel:2},{name:"Destroy Undead",type:"info",description:i=>`Channel Divinity destroys undead of CR ${i>=17?4:i>=14?3:i>=11?2:i>=8?1:.5} or lower`,minLevel:5},{name:"Divine Intervention",type:"uses",maxUses:1,resetOn:"long",description:i=>`${i}% chance to succeed, implore deity for aid`,minLevel:10}],subclasses:{war:{name:"War Domain",features:[{name:"War Priest",type:"uses",maxUses:(i,c=1)=>Math.max(1,c),resetOn:"long",description:"Make one weapon attack as a bonus action",minLevel:1},{name:"Guided Strike",type:"channelDivinity",description:"Use your Channel Divinity to gain +10 to an attack roll. Make this choice after you see the roll, but before the DM says whether the attack hits or misses.",minLevel:2,resetOn:"short"},{name:"War God's Blessing",type:"channelDivinity",description:"Use reaction to grant +10 to an ally's attack roll within 30 feet. Consumes one use of Channel Divinity.",minLevel:6,resetOn:"short"},{name:"Divine Strike",type:"info",description:i=>`Deal extra ${i>=14?"2d8":"1d8"} weapon damage once per turn`,minLevel:8,rollable:!0,rollFormula:i=>i>=14?"2d8":"1d8"},{name:"Avatar of Battle",type:"info",description:"Gain resistance to nonmagical weapon damage",minLevel:17}]},life:{name:"Life Domain",features:[{name:"Disciple of Life",type:"info",description:"Healing spells restore additional 2 + spell level HP",minLevel:1},{name:"Preserve Life",type:"pool",maxPool:i=>i*5,resetOn:"short",description:"Restore HP to creatures within 30 feet",minLevel:2},{name:"Blessed Healer",type:"info",description:"Regain 2 + spell level HP when you cast healing spell",minLevel:6},{name:"Divine Strike",type:"info",description:i=>`Deal extra ${i>=14?"2d8":"1d8"} radiant damage once per turn`,minLevel:8,rollable:!0,rollFormula:i=>i>=14?"2d8":"1d8"},{name:"Supreme Healing",type:"info",description:"Maximize healing dice instead of rolling",minLevel:17}]}}},barbarian:{name:"Barbarian",hitDice:"d12",spellcaster:!1,features:[{name:"Rage",type:"uses",maxUses:i=>i>=20?1/0:i>=17?6:i>=12?5:i>=6?4:i>=3?3:2,resetOn:"long",description:i=>`+${i>=16?4:i>=9?3:2} damage, resistance to physical damage`,minLevel:1},{name:"Reckless Attack",type:"info",description:"Gain advantage on melee attacks, enemies get advantage on you",minLevel:2},{name:"Danger Sense",type:"info",description:"Advantage on Dex saves against effects you can see",minLevel:2}],subclasses:{berserker:{name:"Path of the Berserker",features:[{name:"Frenzy",type:"info",description:"While raging, make melee attack as bonus action (gain 1 exhaustion after rage)",minLevel:3},{name:"Mindless Rage",type:"info",description:"Cannot be charmed or frightened while raging",minLevel:6},{name:"Intimidating Presence",type:"info",description:"Use action to frighten creature within 30 feet",minLevel:10},{name:"Retaliation",type:"info",description:"When damaged by creature within 5 feet, make melee attack as reaction",minLevel:14}]}}}};function ia(i){const c=i.toLowerCase();return ls[c]||null}function wa(i,c,t){const v=ia(i);if(!v)return[];const u=v.features.filter(p=>!p.minLevel||p.minLevel<=c);if(t&&v.subclasses&&v.subclasses[t]){const p=v.subclasses[t].features.filter(f=>!f.minLevel||f.minLevel<=c);return[...u,...p]}return u}function hs(i){const c=ia(i);return!c||!c.subclasses?[]:Object.keys(c.subclasses).map(t=>({id:t,name:c.subclasses[t].name}))}function _s(i,c){const t=ia(i);return!t||!t.spellcaster||!t.spellSlotsByLevel?0:t.spellSlotsByLevel[c]||0}function ys(i,c,t){const v=ia(i);return!v||!v.spellcaster?0:Math.max(1,t+c)}function hl(i,c,t){const v=ia(i);return!v||!v.spellcaster?null:8+c+t}function _l(){return Object.keys(ls).map(i=>({id:i,name:ls[i].name}))}var yl=d('<div class="section-header svelte-ls99y2" role="button" tabindex="0"><h2 class="svelte-ls99y2"> </h2> <span class="collapse-btn svelte-ls99y2"> </span></div>');function _a(i,c){zt(c,!1);let t=St(c,"title",8),v=St(c,"collapsed",8),u=St(c,"ariaLabel",8,""),p=St(c,"onToggle",8);qt();var f=yl(),j=l(f),_=l(j,!0);s(j);var y=a(j,2),Y=l(y,!0);s(y),s(f),S(()=>{nt(f,"aria-expanded",!v()),nt(f,"aria-label",u()),w(_,t()),w(Y,v()?"‚ñº":"‚ñ≤")}),B("click",f,function(...P){p()?.apply(this,P)}),B("keydown",f,P=>{(P.key==="Enter"||P.key===" ")&&p()()}),o(i,f),Wt()}var xl=d("<option> </option>"),$l=d("<option> </option>"),kl=d('<div class="form-group svelte-172i2fj"><label for="characterSubclass" class="svelte-172i2fj">Subclass</label> <select id="characterSubclass" class="svelte-172i2fj"><option>Select Subclass</option><!></select></div>'),wl=d('<div class="info-grid svelte-172i2fj"><div class="form-group svelte-172i2fj"><label for="characterName" class="svelte-172i2fj">Character Name</label> <input type="text" id="characterName" placeholder="Enter name" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterClass" class="svelte-172i2fj">Class</label> <select id="characterClass" class="svelte-172i2fj"><option>Select Class</option><!></select></div> <!> <div class="form-group svelte-172i2fj"><label for="characterLevel" class="svelte-172i2fj">Level</label> <input type="number" id="characterLevel" min="1" max="20" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterRace" class="svelte-172i2fj">Race</label> <input type="text" id="characterRace" placeholder="e.g., Human" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterBackground" class="svelte-172i2fj">Background</label> <input type="text" id="characterBackground" placeholder="e.g., Soldier" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterAlignment" class="svelte-172i2fj">Alignment</label> <input type="text" id="characterAlignment" placeholder="e.g., Lawful Good" class="svelte-172i2fj"/></div></div>'),Sl=d('<section class="character-info svelte-172i2fj"><!> <!></section>');function Cl(i,c){zt(c,!1);const t=()=>mt(ge,"$character",u),v=()=>mt(Qt,"$collapsedStates",u),[u,p]=na(),f=D(),j=_l();function _(J){const M=J.target;ge.update(U=>(U.class=M.value,U.subclass="",U))}function y(J){const M=J.target;ge.update(U=>(U.subclass=M.value,U))}function Y(J){const M=J.target;ge.update(U=>(U.level=parseInt(M.value)||1,U)),js()}tt(()=>(t(),hs),()=>{r(f,t().class?hs(t().class):[])}),va(),qt();var P=Sl(),ne=l(P);{let J=yt(()=>(v(),n(()=>v().characterInfo?"Expand":"Collapse")));_a(ne,{title:"Character Info",get collapsed(){return v(),n(()=>v().characterInfo)},get ariaLabel(){return e(J)},onToggle:()=>Qt.update(M=>({...M,characterInfo:!M.characterInfo}))})}var ee=a(ne,2);{var se=J=>{var M=wl(),U=l(M),pe=a(l(U),2);je(pe),s(U);var he=a(U,2),Qe=a(l(he),2),Q=l(Qe);Q.value=Q.__value="";var Ie=a(Q);xt(Ie,1,()=>j,Ct,(Ce,me)=>{var ve=xl(),Te=l(ve,!0);s(ve);var Ve={};S(()=>{w(Te,(e(me),n(()=>e(me).name))),Ve!==(Ve=(e(me),n(()=>e(me).id)))&&(ve.value=(ve.__value=(e(me),n(()=>e(me).id)))??"")}),o(Ce,ve)}),s(Qe);var fe;ss(Qe),s(he);var $e=a(he,2);{var Be=Ce=>{var me=kl(),ve=a(l(me),2),Te=l(ve);Te.value=Te.__value="";var Ve=a(Te);xt(Ve,1,()=>e(f),Ct,(ht,ct)=>{var Xe=$l(),k=l(Xe,!0);s(Xe);var E={};S(()=>{w(k,(e(ct),n(()=>e(ct).name))),E!==(E=(e(ct),n(()=>e(ct).id)))&&(Xe.value=(Xe.__value=(e(ct),n(()=>e(ct).id)))??"")}),o(ht,Xe)}),s(ve);var ot;ss(ve),s(me),S(()=>{ot!==(ot=(t(),n(()=>t().subclass)))&&(ve.value=(ve.__value=(t(),n(()=>t().subclass)))??"",Na(ve,(t(),n(()=>t().subclass))))}),B("change",ve,y),o(Ce,me)};b($e,Ce=>{e(f),n(()=>e(f).length>0)&&Ce(Be)})}var F=a($e,2),I=a(l(F),2);je(I),s(F);var x=a(F,2),W=a(l(x),2);je(W),s(x);var g=a(x,2),$=a(l(g),2);je($),s(g);var Z=a(g,2),Re=a(l(Z),2);je(Re),s(Z),s(M),S(()=>{fe!==(fe=(t(),n(()=>t().class)))&&(Qe.value=(Qe.__value=(t(),n(()=>t().class)))??"",Na(Qe,(t(),n(()=>t().class)))),Aa(I,(t(),n(()=>t().level)))}),Ne(pe,()=>t().name,Ce=>Pt(ge,n(t).name=Ce,n(t))),B("change",Qe,_),B("change",I,Y),Ne(W,()=>t().race,Ce=>Pt(ge,n(t).race=Ce,n(t))),Ne($,()=>t().background,Ce=>Pt(ge,n(t).background=Ce,n(t))),Ne(Re,()=>t().alignment,Ce=>Pt(ge,n(t).alignment=Ce,n(t))),o(J,M)};b(ee,J=>{v(),n(()=>!v().characterInfo)&&J(se)})}s(P),o(i,P),Wt(),p()}var Dl=d('<div class="ability-card svelte-bbv1xt"><h3 class="svelte-bbv1xt"> </h3> <input type="number" class="ability-score svelte-bbv1xt" min="1" max="30"/> <div class="ability-modifier svelte-bbv1xt"> </div> <div class="roll-buttons svelte-bbv1xt"><button class="roll-btn svelte-bbv1xt">Check</button> <button class="roll-btn svelte-bbv1xt">Save</button></div> <div class="save-proficiency svelte-bbv1xt"><input type="checkbox" class="svelte-bbv1xt"/> <label class="svelte-bbv1xt">Save Prof.</label></div></div>'),Ll=d('<div class="proficiency-bonus svelte-bbv1xt"><label for="profBonus">Proficiency Bonus</label> <input type="number" id="profBonus" class="prof-input svelte-bbv1xt"/></div> <div class="abilities-grid svelte-bbv1xt"></div>',1),jl=d("<section><!> <!></section>");function Al(i,c){zt(c,!1);const t=()=>mt(Ga,"$abilityModifiers",j),v=()=>mt(ge,"$character",j),u=()=>mt(ma,"$searchFilter",j),p=()=>mt(Qt,"$collapsedStates",j),f=()=>mt(ba,"$isEditMode",j),[j,_]=na(),y=D(),Y=D(),P=ha(),ne=[{key:"strength",label:"Strength"},{key:"dexterity",label:"Dexterity"},{key:"constitution",label:"Constitution"},{key:"intelligence",label:"Intelligence"},{key:"wisdom",label:"Wisdom"},{key:"charisma",label:"Charisma"}];function ee(){js()}function se(Q){const Ie=t()[Q],fe=`1d20${Ie>=0?"+":""}${Ie}`,$e=[];$e.push({value:"1d20",source:"base die"}),Ie!==0&&$e.push({value:Ie,source:Q}),P("roll",{notation:fe,rollType:"check",bonusBreakdown:$e})}function J(Q){const Ie=t()[Q],fe=v().saveProficiencies[Q]?v().proficiencyBonus:0,$e=Ie+fe,Be=`1d20${$e>=0?"+":""}${$e}`,F=[];F.push({value:"1d20",source:"base die"}),Ie!==0&&F.push({value:Ie,source:Q}),fe!==0&&F.push({value:fe,source:"proficiency"}),P("roll",{notation:Be,rollType:"save",bonusBreakdown:F})}tt(()=>u(),()=>{r(y,ne.filter(({label:Q})=>u()?Q.toLowerCase().includes(u().toLowerCase()):!0))}),tt(()=>(e(y),u()),()=>{r(Y,e(y).length>0||!u()||u().toLowerCase().includes("proficiency"))}),va(),qt();var M=jl();let U;var pe=l(M);_a(pe,{title:"Ability Scores",get collapsed(){return p(),n(()=>p().abilityScores)},ariaLabel:"Toggle Ability Scores Section",onToggle:()=>Qt.update(Q=>({...Q,abilityScores:!Q.abilityScores}))});var he=a(pe,2);{var Qe=Q=>{var Ie=Ll(),fe=Le(Ie),$e=a(l(fe),2);je($e),s(fe);var Be=a(fe,2);xt(Be,5,()=>e(y),Ct,(F,I)=>{let x=()=>e(I).key,W=()=>e(I).label;var g=Dl(),$=l(g),Z=l($,!0);s($);var Re=a($,2);je(Re);var Ce=a(Re,2),me=l(Ce);s(Ce);var ve=a(Ce,2),Te=l(ve),Ve=a(Te,2);s(ve);var ot=a(ve,2),ht=l(ot);je(ht);var ct=a(ht,2);s(ot),s(g),S(Xe=>{w(Z,Xe),w(me,`${t(),x(),n(()=>t()[x()]>=0?"+":"")??""}${t(),x(),n(()=>t()[x()])??""}`),ht.disabled=!f(),nt(ht,"id",`${x()}-save`),nt(ct,"for",`${x()}-save`)},[()=>(W(),n(()=>W().substring(0,3).toUpperCase()))]),Ne(Re,()=>v().abilities[x()],Xe=>Pt(ge,n(v).abilities[x()]=Xe,n(v))),B("change",Re,ee),B("click",Te,()=>se(x())),B("click",Ve,()=>J(x())),$a(ht,()=>v().saveProficiencies[x()],Xe=>Pt(ge,n(v).saveProficiencies[x()]=Xe,n(v))),o(F,g)}),s(Be),Ne($e,()=>v().proficiencyBonus,F=>Pt(ge,n(v).proficiencyBonus=F,n(v))),o(Q,Ie)};b(he,Q=>{p(),n(()=>!p().abilityScores)&&Q(Qe)})}s(M),S(()=>U=At(M,1,"ability-scores svelte-bbv1xt",null,U,{hidden:!e(Y)})),o(i,M),Wt(),_()}const Rs=[{name:"Unarmored",type:"none",baseAC:10},{name:"Padded",type:"light",baseAC:11},{name:"Leather",type:"light",baseAC:11},{name:"Studded Leather",type:"light",baseAC:12},{name:"Hide",type:"medium",baseAC:12,maxDexBonus:2},{name:"Chain Shirt",type:"medium",baseAC:13,maxDexBonus:2},{name:"Scale Mail",type:"medium",baseAC:14,maxDexBonus:2},{name:"Breastplate",type:"medium",baseAC:14,maxDexBonus:2},{name:"Half Plate",type:"medium",baseAC:15,maxDexBonus:2},{name:"Ring Mail",type:"heavy",baseAC:14,maxDexBonus:0},{name:"Chain Mail",type:"heavy",baseAC:16,maxDexBonus:0},{name:"Splint",type:"heavy",baseAC:17,maxDexBonus:0},{name:"Plate",type:"heavy",baseAC:18,maxDexBonus:0}];function Ts(i){return Rs.find(c=>c.name===i)}function Bl(i,c,t){if(!i)return 10+c+(t?2:0);const v=Ts(i);if(!v)return 10+c+(t?2:0);let u=v.baseAC;return v.maxDexBonus===void 0?u+=c:v.maxDexBonus>0&&(u+=Math.min(c,v.maxDexBonus)),t&&(u+=2),u}function Ta(i){return Math.floor((i-10)/2)}function is(i,c){if(!i.class)return null;const t=ia(i.class);if(!t||!t.spellcaster||!t.spellcastingAbility)return null;const v=Ta(c[t.spellcastingAbility]);return 8+i.proficiencyBonus+v}function Ya(i,c){if(!i.class)return 0;const t=ia(i.class);return!t||!t.spellcaster||!t.spellcastingAbility?0:Ta(c[t.spellcastingAbility])}function Rl(i,c){const t=[],v=Ta(c.dexterity),u=i.armorName?Ts(i.armorName):void 0;if(u){if(u.type==="none")t.push("Unarmored"),t.push("Base: 10"),t.push(`Dexterity: ${v>=0?"+":""}${v}`);else if(u.type==="light")t.push(`${u.name}: ${u.baseAC}`),t.push(`Dexterity: ${v>=0?"+":""}${v}`);else if(u.type==="medium"){const p=Math.min(2,v);t.push(`${u.name}: ${u.baseAC}`),t.push(`Dexterity: ${p>=0?"+":""}${p} (max +2)`)}else u.type==="heavy"&&(t.push(`${u.name}: ${u.baseAC}`),t.push("Dexterity: +0 (heavy armor)"));i.shieldEquipped&&t.push("Shield: +2")}else{t.push("Base: 10"),v!==0&&t.push(`Dexterity: ${v>=0?"+":""}${v}`);const p=10+v,f=i.armorClass-p;f!==0&&t.push(`Other: ${f>=0?"+":""}${f}`)}return i.activeStates&&i.activeStates.length>0&&i.activeStates.forEach(p=>{typeof p.acBonus=="number"&&p.acBonus!==0&&(!p.target||p.target==="self")&&t.push(`${p.name}: ${p.acBonus>=0?"+":""}${p.acBonus}`)}),t.join(`
`)}function Tl(i,c){const t=[],v=Ta(c.dexterity);t.push(`Dexterity: ${v>=0?"+":""}${v}`);const u=i.initiative-v;return u!==0&&t.push(`Other Bonuses: ${u>=0?"+":""}${u}`),t.join(`
`)}function Ml(i,c){if(!i.class)return"";const t=ia(i.class);if(!t||!t.spellcaster||!t.spellcastingAbility)return"";const v=[],u=Ta(c[t.spellcastingAbility]),p=t.spellcastingAbility.charAt(0).toUpperCase()+t.spellcastingAbility.slice(1);return v.push("Base: 8"),v.push(`Proficiency: +${i.proficiencyBonus}`),v.push(`${p}: ${u>=0?"+":""}${u}`),v.join(`
`)}function Fl(i,c,t){const v=[];let u=i;const p=c.toLowerCase().trim();if(t.activeStates){for(const f of t.activeStates)if(f.immunities&&f.immunities.length>0&&f.immunities.some(_=>_.toLowerCase().trim()===p))return v.push(`Immune to ${c} (${f.name})`),{finalDamage:0,adjustments:v}}if(t.activeStates){for(const f of t.activeStates)if(f.resistances&&f.resistances.length>0&&f.resistances.some(_=>_.toLowerCase().trim()===p)){const _=Math.floor(u/2);v.push(`Resistant to ${c} (${f.name}): ${u} ‚Üí ${_}`),u=_;break}}return v.length===0&&v.push(`No adjustments for ${c}`),{finalDamage:u,adjustments:v}}function Pl(i,c){const t={...i};if(t.tempHP>0){if(c<=t.tempHP)return t.tempHP-=c,t;c-=t.tempHP,t.tempHP=0}return t.currentHP=Math.max(0,t.currentHP-c),t}var Il=d('<button class="info-icon svelte-1o8ci7b" type="button">‚ÑπÔ∏è</button>'),El=d('<button class="info-icon svelte-1o8ci7b" type="button">‚ÑπÔ∏è</button>'),Ul=d("<div><!></div>"),Hl=d('<div class="tooltip-wrapper svelte-1o8ci7b"><!> <!></div>');function Qa(i,c){zt(c,!1);let t=St(c,"tooltipContent",8),v=St(c,"ariaLabel",8,"Show information"),u=D(!1),p=D(),f=D(!1),j=D(null),_=D(!1),y=D(!1),Y=D("");const P=Math.random().toString(36).slice(2);function ne(){window.dispatchEvent(new CustomEvent("tooltip-open",{detail:P}))}function ee(F){F.detail!==P&&(r(u,!1),r(_,!1))}function se(){r(f,window.matchMedia("(pointer: coarse)").matches||"ontouchstart"in window)}function J(){if(!e(j)||!e(p))return;const F=e(p).getBoundingClientRect(),I=e(j).getBoundingClientRect();let x=F.bottom+5,W=F.left;r(_,!1),W+I.width>window.innerWidth-8&&(W=F.right-I.width,r(_,!0),W<8&&(W=8)),W<8&&(W=8),x+I.height>window.innerHeight-8&&(x=F.top-I.height-5),r(Y,`position:fixed;top:${x}px;left:${W}px;z-index:1000;`),r(y,!0)}function M(){ne(),r(u,!1),r(y,!1),requestAnimationFrame(()=>{r(u,!0),r(y,!1),setTimeout(J,0)})}function U(){r(u,!1),r(_,!1)}function pe(F){F.stopPropagation(),e(u)?(r(u,!1),r(_,!1),r(y,!1)):(ne(),r(u,!1),r(y,!1),requestAnimationFrame(()=>{r(u,!0),r(y,!1),setTimeout(J,0)}))}function he(F){e(p)&&!e(p).contains(F.target)&&(r(u,!1),r(_,!1))}Sa(()=>{se(),document.addEventListener("click",he),window.addEventListener("tooltip-open",ee)}),Is(()=>{document.removeEventListener("click",he),window.removeEventListener("tooltip-open",ee)}),qt();var Qe=Hl(),Q=l(Qe);{var Ie=F=>{var I=Il();S(()=>nt(I,"aria-label",v())),B("click",I,pe),o(F,I)},fe=F=>{var I=El();S(()=>nt(I,"aria-label",v())),B("mouseenter",I,M),B("mouseleave",I,U),o(F,I)};b(Q,F=>{e(f)?F(Ie):F(fe,!1)})}var $e=a(Q,2);{var Be=F=>{var I=Ul(),x=l(I);dl(x,c,"content",{},W=>{var g=gt(),$=Le(g);vl($,t),o(W,g)}),s(I),Ba(I,W=>r(j,W),()=>e(j)),S(()=>{At(I,1,`tooltip-popup ${e(_)?"right-align":""}`,"svelte-1o8ci7b"),ul(I,e(y)?e(Y)+"opacity:1;pointer-events:auto;":"opacity:0;pointer-events:none;position:fixed;top:0;left:0;z-index:1000;")}),o(F,I)};b($e,F=>{e(u)&&F(Be)})}s(Qe),Ba(Qe,F=>r(p,F),()=>e(p)),o(i,Qe),Wt()}var Nl=d("<option> </option>"),Ol=d('<div class="armor-config svelte-1r5hyyb"><h4 class="svelte-1r5hyyb">Armor Configuration</h4> <div class="armor-controls svelte-1r5hyyb"><div class="armor-field svelte-1r5hyyb"><label for="armorName" class="svelte-1r5hyyb">Armor</label> <select id="armorName" class="armor-select svelte-1r5hyyb"><option>None (Unarmored)</option><!></select></div> <div class="armor-field svelte-1r5hyyb"><label class="shield-label svelte-1r5hyyb"><input type="checkbox" class="shield-checkbox svelte-1r5hyyb"/> Shield Equipped (+2 AC)</label></div></div></div>'),Gl=d('<div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="spellSaveDC" class="svelte-1r5hyyb">Spell Save DC</label> <!></div> <input type="number" id="spellSaveDC" class="stat-input svelte-1r5hyyb" readonly=""/></div>'),ql=d('<span class="hit-dice-type"> </span>'),zl=d('<!> <div class="stats-grid svelte-1r5hyyb"><div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="armorClass" class="svelte-1r5hyyb">Armor Class</label> <!></div> <input type="text" id="armorClass" readonly=""/></div> <div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="initiative" class="svelte-1r5hyyb">Initiative</label> <!></div> <input type="text" id="initiative" class="stat-input svelte-1r5hyyb" readonly=""/></div> <div class="stat-box svelte-1r5hyyb"><label for="speed" class="svelte-1r5hyyb">Speed</label> <input type="text" id="speed" class="stat-input svelte-1r5hyyb"/></div> <!></div> <div class="hp-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Points</h3> <div><div class="hp-inputs svelte-1r5hyyb"><input type="number" class="hp-current svelte-1r5hyyb" min="0"/> <span class="hp-separator svelte-1r5hyyb">/</span> <input type="number" class="hp-max svelte-1r5hyyb" min="0"/></div> <div class="hp-controls svelte-1r5hyyb"><button class="hp-btn svelte-1r5hyyb">‚àí</button> <button class="hp-btn svelte-1r5hyyb">+</button> <button class="hp-btn svelte-1r5hyyb">‚àí5</button> <button class="hp-btn svelte-1r5hyyb">+5</button></div></div> <div class="temp-hp svelte-1r5hyyb"><label for="tempHP" class="svelte-1r5hyyb">Temp HP</label> <input type="number" id="tempHP" min="0" class="svelte-1r5hyyb"/></div></div> <div class="hit-dice-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Dice</h3> <div class="hit-dice-display svelte-1r5hyyb"><input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <span>/</span> <input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <!></div> <div class="hit-dice-controls svelte-1r5hyyb"><label for="hitDiceCount" class="svelte-1r5hyyb">Roll</label> <div class="hit-dice-count-controls svelte-1r5hyyb"><button class="hit-dice-btn svelte-1r5hyyb">‚àí</button> <input type="number" id="hitDiceCount" class="hit-dice-count-input svelte-1r5hyyb" min="1"/> <button class="hit-dice-btn svelte-1r5hyyb">+</button></div> <button class="btn btn-primary roll-hit-dice use-enabled svelte-1r5hyyb">üé≤ Roll</button></div></div>',1),Wl=d("<section><!> <!></section>");function Kl(i,c){zt(c,!1);const t=()=>mt(ge,"$character",j),v=()=>mt(Ga,"$abilityModifiers",j),u=()=>mt(ma,"$searchFilter",j),p=()=>mt(Qt,"$collapsedStates",j),f=()=>mt(ba,"$isEditMode",j),[j,_]=na(),y=D(),Y=D(),P=D(),ne=D(),ee=D(),se=D(),J=D(),M=ha();let U=D(1);function pe(F){ge.update(I=>(I.currentHP=Math.max(0,Math.min(I.maxHP,I.currentHP+F)),I))}function he(F){const I=e(U)+F,x=t().hitDice.current;r(U,Math.max(1,Math.min(x,I)))}function Qe(F=1){if(t().hitDice.current<=0){alert("No hit dice remaining!");return}if(!t().class){alert("Please select a class first!");return}const I=ia(t().class);if(!I){alert("Invalid class configuration!");return}const x=Math.min(F,t().hitDice.current),W=I.hitDice,g=v().constitution,$=g*x,Z=$>=0?`+${$}`:`${$}`,Re=`${x}${W}${Z}`,Ce=[];if(Ce.push({value:`${x}${W}`,source:"hit dice"}),g!==0)for(let me=0;me<x;me++)Ce.push({value:g,source:"constitution"});M("rollHitDice",{notation:Re,hitDie:W,count:x,bonusBreakdown:Ce})}tt(()=>(t(),v(),ge),()=>{if(t().armorName!==void 0||t().shieldEquipped!==void 0){const F=v().dexterity,I=Bl(t().armorName,F,t().shieldEquipped||!1);t().armorClass!==I&&ge.update(x=>({...x,armorClass:I}))}}),tt(()=>(v(),t(),ge),()=>{const F=v().dexterity;t().initiative!==F&&ge.update(I=>({...I,initiative:F}))}),tt(()=>t(),()=>{r(y,is(t(),t().abilities))}),tt(()=>t(),()=>{r(Y,Rl(t(),t().abilities))}),tt(()=>t(),()=>{r(P,Tl(t(),t().abilities))}),tt(()=>t(),()=>{r(ne,Ml(t(),t().abilities))}),tt(()=>(t(),e(U)),()=>{const F=t().hitDice.current;F>0&&e(U)>F&&r(U,F)}),tt(()=>t(),()=>{r(ee,t().activeStates&&t().activeStates.length>0?t().activeStates.reduce((F,I)=>F+(I.acBonus||0),0):0)}),tt(()=>t(),()=>{r(se,t().activeStates&&t().activeStates.length>0?t().activeStates.some(F=>F.name==="Aid"&&F.target==="self"):!1)}),tt(()=>u(),()=>{r(J,!u()||"armor class".includes(u().toLowerCase())||"initiative".includes(u().toLowerCase())||"speed".includes(u().toLowerCase())||"hit points".includes(u().toLowerCase())||"hp".includes(u().toLowerCase())||"hit dice".includes(u().toLowerCase())||"spell save".includes(u().toLowerCase())||"combat".includes(u().toLowerCase()))}),va(),qt();var Q=Wl();let Ie;var fe=l(Q);{let F=yt(()=>(p(),n(()=>p().combatStats?"Expand":"Collapse")));_a(fe,{title:"Combat Stats",get collapsed(){return p(),n(()=>p().combatStats)},get ariaLabel(){return e(F)},onToggle:()=>Qt.update(I=>({...I,combatStats:!I.combatStats}))})}var $e=a(fe,2);{var Be=F=>{var I=zl(),x=Le(I);{var W=oe=>{var Fe=Ol(),ye=a(l(Fe),2),Ye=l(ye),Oe=a(l(Ye),2);S(()=>{t(),Ut(()=>{})});var rt=l(Oe);rt.value=(rt.__value=void 0)??"";var vt=a(rt);xt(vt,1,()=>Rs,Ct,(K,z)=>{var ke=gt(),Ge=Le(ke);{var st=qe=>{var We=Nl(),de=l(We);s(We);var G={};S(()=>{w(de,`${e(z),n(()=>e(z).name)??""} (AC ${e(z),n(()=>e(z).baseAC)??""})`),G!==(G=(e(z),n(()=>e(z).name)))&&(We.value=(We.__value=(e(z),n(()=>e(z).name)))??"")}),o(qe,We)};b(Ge,qe=>{e(z),n(()=>e(z).name!=="Unarmored")&&qe(st)})}o(K,ke)}),s(Oe),s(Ye);var ce=a(Ye,2),L=l(ce),O=l(L);je(O),Yt(),s(L),s(ce),s(ye),s(Fe),Ra(Oe,()=>t().armorName,K=>Pt(ge,n(t).armorName=K,n(t))),$a(O,()=>t().shieldEquipped,K=>Pt(ge,n(t).shieldEquipped=K,n(t))),o(oe,Fe)};b(x,oe=>{f()&&oe(W)})}var g=a(x,2),$=l(g),Z=l($),Re=a(l(Z),2);Qa(Re,{get tooltipContent(){return e(Y)},ariaLabel:"Show AC breakdown"}),s(Z);var Ce=a(Z,2);je(Ce),s($);var me=a($,2),ve=l(me),Te=a(l(ve),2);Qa(Te,{get tooltipContent(){return e(P)},ariaLabel:"Show Initiative breakdown"}),s(ve);var Ve=a(ve,2);je(Ve),s(me);var ot=a(me,2),ht=a(l(ot),2);je(ht),s(ot);var ct=a(ot,2);{var Xe=oe=>{var Fe=Gl(),ye=l(Fe),Ye=a(l(ye),2);Qa(Ye,{get tooltipContent(){return e(ne)},ariaLabel:"Show Spell Save DC breakdown"}),s(ye);var Oe=a(ye,2);je(Oe),s(Fe),S(()=>Aa(Oe,e(y))),o(oe,Fe)};b(ct,oe=>{e(y)!==null&&oe(Xe)})}s(g);var k=a(g,2),E=a(l(k),2);let be;var xe=l(E),h=l(xe);je(h);var H=a(h,4);je(H),s(xe);var le=a(xe,2),_e=l(le),T=a(_e,2),N=a(T,2),X=a(N,2);s(le),s(E);var ie=a(E,2),R=a(l(ie),2);je(R),s(ie),s(k);var Ee=a(k,2),Ae=a(l(Ee),2),Je=l(Ae);je(Je);var De=a(Je,4);je(De);var m=a(De,2);{var ue=oe=>{const Fe=yt(()=>(V(ia),t(),n(()=>ia(t().class))));var ye=gt(),Ye=Le(ye);{var Oe=rt=>{const vt=yt(()=>(v(),n(()=>v().constitution)));var ce=ql(),L=l(ce);s(ce),S(()=>w(L,`(${V(e(Fe)),n(()=>e(Fe).hitDice)??""}${(e(vt)>=0?`+${e(vt)}`:e(vt))??""})`)),o(rt,ce)};b(Ye,rt=>{e(Fe)&&rt(Oe)})}o(oe,ye)};b(m,oe=>{t(),n(()=>t().class)&&oe(ue)})}s(Ae);var re=a(Ae,2),q=a(l(re),2),He=l(q),Me=a(He,2);je(Me);var we=a(Me,2);s(q);var Pe=a(q,2);s(re),s(Ee),S(()=>{Aa(Ce,(e(ee),t(),n(()=>e(ee)!==0?`${t().armorClass} ‚Üí ${t().armorClass+e(ee)}`:`${t().armorClass}`))),At(Ce,1,al(e(ee)!==0?"stat-input ac-enhanced":"stat-input"),"svelte-1r5hyyb"),Aa(Ve,(t(),n(()=>t().initiative))),be=At(E,1,"hp-display svelte-1r5hyyb",null,be,{"aid-active":e(se)}),nt(h,"max",(t(),n(()=>t().maxHP))),nt(Je,"max",(t(),n(()=>t().hitDice.max))),He.disabled=e(U)<=1,nt(Me,"max",(t(),n(()=>t().hitDice.current))),we.disabled=(e(U),t(),n(()=>e(U)>=t().hitDice.current)),Pe.disabled=(t(),n(()=>t().hitDice.current<=0||!t().class))}),Ne(ht,()=>t().speed,oe=>Pt(ge,n(t).speed=oe,n(t))),Ne(h,()=>t().currentHP,oe=>Pt(ge,n(t).currentHP=oe,n(t))),Ne(H,()=>t().maxHP,oe=>Pt(ge,n(t).maxHP=oe,n(t))),B("click",_e,()=>pe(-1)),B("click",T,()=>pe(1)),B("click",N,()=>pe(-5)),B("click",X,()=>pe(5)),Ne(R,()=>t().tempHP,oe=>Pt(ge,n(t).tempHP=oe,n(t))),Ne(Je,()=>t().hitDice.current,oe=>Pt(ge,n(t).hitDice.current=oe,n(t))),Ne(De,()=>t().hitDice.max,oe=>Pt(ge,n(t).hitDice.max=oe,n(t))),B("click",He,()=>he(-1)),Ne(Me,()=>e(U),oe=>r(U,oe)),B("input",Me,oe=>{const Fe=oe.target,ye=parseInt(Fe.value);ye>t().hitDice.current&&r(U,t().hitDice.current),ye<1&&r(U,1)}),B("click",we,()=>he(1)),B("click",Pe,()=>Qe(e(U))),o(F,I)};b($e,F=>{p(),n(()=>!p().combatStats)&&F(Be)})}s(Q),S(()=>Ie=At(Q,1,"combat-stats svelte-1r5hyyb",null,Ie,{hidden:!e(J)})),o(i,Q),Wt(),_()}const Ia={acrobatics:"dexterity",animalHandling:"wisdom",arcana:"intelligence",athletics:"strength",deception:"charisma",history:"intelligence",insight:"wisdom",intimidation:"charisma",investigation:"intelligence",medicine:"wisdom",nature:"intelligence",perception:"wisdom",performance:"charisma",persuasion:"charisma",religion:"intelligence",sleightOfHand:"dexterity",stealth:"dexterity",survival:"wisdom"};var Vl=d('<div class="skill-row svelte-1f1pl16"><input type="checkbox" class="svelte-1f1pl16"/> <label class="svelte-1f1pl16"> <span class="ability-tag svelte-1f1pl16"> </span></label> <span class="skill-modifier svelte-1f1pl16"> </span> <button class="roll-btn svelte-1f1pl16">Roll</button></div>'),Jl=d('<div class="skills-grid svelte-1f1pl16"></div>'),Yl=d("<section><!> <!></section>");function Ql(i,c){zt(c,!1);const t=()=>mt(ge,"$character",j),v=()=>mt(Ga,"$abilityModifiers",j),u=()=>mt(ma,"$searchFilter",j),p=()=>mt(Qt,"$collapsedStates",j),f=()=>mt(ba,"$isEditMode",j),[j,_]=na(),y=D(),Y=D(),P=D(),ne=D(),ee=D(),se=D(),J=ha(),M=[{key:"acrobatics",label:"Acrobatics"},{key:"animalHandling",label:"Animal Handling"},{key:"arcana",label:"Arcana"},{key:"athletics",label:"Athletics"},{key:"deception",label:"Deception"},{key:"history",label:"History"},{key:"insight",label:"Insight"},{key:"intimidation",label:"Intimidation"},{key:"investigation",label:"Investigation"},{key:"medicine",label:"Medicine"},{key:"nature",label:"Nature"},{key:"perception",label:"Perception"},{key:"performance",label:"Performance"},{key:"persuasion",label:"Persuasion"},{key:"religion",label:"Religion"},{key:"sleightOfHand",label:"Sleight of Hand"},{key:"stealth",label:"Stealth"},{key:"survival",label:"Survival"}];function U(fe){const $e=Ia[fe],Be=v()[$e],F=t().skillProficiencies[fe]?t().proficiencyBonus:0,I=e(y)[fe],x=`1d20${I>=0?"+":""}${I}`,W=[];W.push({value:"1d20",source:"base die"}),Be!==0&&W.push({value:Be,source:$e}),F!==0&&W.push({value:F,source:"proficiency"}),J("roll",{notation:x,rollType:"check",bonusBreakdown:W})}tt(()=>{},()=>{r(y,{})}),tt(()=>t(),()=>{r(Y,t().skillProficiencies)}),tt(()=>t(),()=>{r(P,t().proficiencyBonus)}),tt(()=>v(),()=>{r(ne,v())}),tt(()=>(e(ne),e(Y),e(P)),()=>{for(const{key:fe}of M){const $e=Ia[fe],Be=e(ne)[$e],F=e(Y)[fe]?e(P):0;fa(y,e(y)[fe]=Be+F)}}),tt(()=>u(),()=>{r(ee,M.filter(({label:fe})=>u()?fe.toLowerCase().includes(u().toLowerCase()):!0))}),tt(()=>e(ee),()=>{r(se,e(ee).length>0)}),va(),qt();var pe=Yl();let he;var Qe=l(pe);{let fe=yt(()=>(p(),n(()=>p().skills?"Expand":"Collapse")));_a(Qe,{title:"Skills",get collapsed(){return p(),n(()=>p().skills)},get ariaLabel(){return e(fe)},onToggle:()=>Qt.update($e=>({...$e,skills:!$e.skills}))})}var Q=a(Qe,2);{var Ie=fe=>{var $e=Jl();xt($e,5,()=>e(ee),Ct,(Be,F)=>{let I=()=>e(F).key,x=()=>e(F).label;var W=Vl(),g=l(W);je(g);var $=a(g,2),Z=l($),Re=a(Z),Ce=l(Re);s(Re),s($);var me=a($,2),ve=l(me);s(me);var Te=a(me,2);s(W),S(Ve=>{As(g,(e(Y),I(),n(()=>e(Y)[I()]))),g.disabled=!f(),nt(g,"id",I()),nt($,"for",I()),w(Z,`${x()??""} `),w(Ce,`(${Ve??""})`),w(ve,`${e(y),I(),n(()=>e(y)[I()]>=0?"+":"")??""}${e(y),I(),n(()=>e(y)[I()])??""}`)},[()=>(V(Ia),I(),n(()=>Ia[I()].substring(0,3).toUpperCase()))]),B("change",g,Ve=>{console.log("Skill proficiency changed:",I(),Ve.target.checked),ge.update(ot=>({...ot,skillProficiencies:{...ot.skillProficiencies,[I()]:Ve.target.checked}}))}),B("click",Te,()=>U(I())),o(Be,W)}),s($e),o(fe,$e)};b(Q,fe=>{p(),n(()=>!p().skills)&&fe(Ie)})}s(pe),S(()=>he=At(pe,1,"skills svelte-1f1pl16",null,he,{hidden:!e(se)})),o(i,pe),Wt(),_()}var Xl=d('<p class="empty-message svelte-1123ljy">No attacks or spells to reorder.</p>'),Zl=d('<li class="reorder-item svelte-1123ljy"><span class="attack-name svelte-1123ljy"> </span> <div class="reorder-buttons svelte-1123ljy"><button class="btn-move svelte-1123ljy" aria-label="Move up">‚ñ≤</button> <button class="btn-move svelte-1123ljy" aria-label="Move down">‚ñº</button></div></li>'),ei=d('<ul class="reorder-list svelte-1123ljy"></ul>'),ti=d('<div class="modal-backdrop svelte-1123ljy" role="presentation"><div class="modal-content svelte-1123ljy" role="dialog" aria-modal="true" aria-labelledby="modal-title"><div class="modal-header svelte-1123ljy"><h3 id="modal-title" class="svelte-1123ljy">Reorder Attacks & Spells</h3> <button class="btn-close svelte-1123ljy" aria-label="Close">√ó</button></div> <div class="modal-body svelte-1123ljy"><!></div> <div class="modal-footer svelte-1123ljy"><button class="btn btn-secondary svelte-1123ljy">Cancel</button> <button class="btn btn-primary svelte-1123ljy">Save Order</button></div></div></div>');function ai(i,c){zt(c,!1);let t=St(c,"show",8,!1),v=St(c,"attacks",24,()=>[]),u=St(c,"onSave",8),p=St(c,"onCancel",8),f=D([]);function j(M,U){const pe=e(f)[M];fa(f,e(f)[M]=e(f)[U]),fa(f,e(f)[U]=pe),r(f,[...e(f)])}function _(M){M>0&&j(M,M-1)}function y(M){M<e(f).length-1&&j(M,M+1)}function Y(){u()(e(f))}function P(){p()()}function ne(M){M.target===M.currentTarget&&P()}tt(()=>(V(t()),V(v())),()=>{t()&&r(f,[...v()])}),va(),qt();var ee=gt(),se=Le(ee);{var J=M=>{var U=ti(),pe=l(U),he=l(pe),Qe=a(l(he),2);s(he);var Q=a(he,2),Ie=l(Q);{var fe=x=>{var W=Xl();o(x,W)},$e=x=>{var W=ei();xt(W,7,()=>e(f),g=>g.id,(g,$,Z)=>{var Re=Zl(),Ce=l(Re),me=l(Ce,!0);s(Ce);var ve=a(Ce,2),Te=l(ve),Ve=a(Te,2);s(ve),s(Re),S(()=>{w(me,(e($),n(()=>e($).name||"(Unnamed attack or spell)"))),Te.disabled=e(Z)===0,Ve.disabled=(V(e(Z)),e(f),n(()=>e(Z)===e(f).length-1))}),B("click",Te,()=>_(e(Z))),B("click",Ve,()=>y(e(Z))),o(g,Re)}),s(W),o(x,W)};b(Ie,x=>{e(f),n(()=>e(f).length===0)?x(fe):x($e,!1)})}s(Q);var Be=a(Q,2),F=l(Be),I=a(F,2);s(Be),s(pe),s(U),B("click",Qe,P),B("click",F,P),B("click",I,Y),B("click",U,ne),o(M,U)};b(se,M=>{t()&&M(J)})}o(i,ee),Wt()}let Ea=null,Ua=null;async function Ms(){if(Ea)return Ea;try{return Ea=await(await fetch(Bs("/data/spells.json"))).json(),Ea||[]}catch(i){return console.error("Failed to load spells:",i),[]}}async function si(){if(Ua)return Ua;try{return Ua=await(await fetch(Bs("/data/feats.json"))).json(),Ua||[]}catch(i){return console.error("Failed to load feats:",i),[]}}function xs(i,c){if(!c.trim())return i;const t=c.toLowerCase();return i.filter(v=>v.name.toLowerCase().includes(t)||v.school.toLowerCase().includes(t)||v.classes.some(u=>u.toLowerCase().includes(t))||v.description.toLowerCase().includes(t))}function li(i,c){return c===null?i:i.filter(t=>t.level===c)}function ii(i,c){if(!c.trim())return i;const t=c.toLowerCase();return i.filter(v=>v.name.toLowerCase().includes(t)||v.description.toLowerCase().includes(t))}function Ha(i){const c=i.description,t=/\b(Strength|Dexterity|Constitution|Intelligence|Wisdom|Charisma)\s+saving\s+throw/i,v=c.match(t);if(!v)return null;const u=v[1].toLowerCase(),f=/half\s+(?:as\s+much\s+)?damage\s+on\s+a\s+successful(?:\s+save)?/i.test(c),_=/saving\s+throw\s+or\s+take.*?damage/i.test(c)&&!f;return{ability:u,halfDamageOnSave:f,noDamageOnSave:_}}function ni(i){const c=i.description;return/(plus|add)\s+your\s+spellcasting\s+(ability\s+)?modifier/i.test(c)}function Xa(i){const c=i.description.toLowerCase();return c.includes("ranged spell attack")||c.includes("melee spell attack")}function $s(i){const c=i.description.toLowerCase();if(["Divine Favor","Bless","Aid","Command"].includes(i.name))return!0;const u=["takes","take","deals","deal","damage equal to","force damage","fire damage","cold damage","lightning damage","thunder damage","acid damage","poison damage","necrotic damage","radiant damage","psychic damage","regain","regains","hit point"].some(j=>c.includes(j));return["bonus to attack","bonus to damage","bonus to ac","gains a +","gain a +","+1 bonus","+2 bonus","+3 bonus","advantage on","becomes a magic weapon"].some(j=>c.includes(j))&&!u}function ri(i){const c=i.description;let t=0,v=0,u=0,p="";const f=c.match(/\+(\d+)\s+bonus\s+to\s+attack\s+rolls\s+and\s+damage\s+rolls/i);if(f){const _=parseInt(f[1]);t=_,v=_,p=`+${_} to attack and damage rolls`}if(i.name==="Bless"&&(p="Add 1d4 to attack rolls and saves",t="1d4"),i.name==="Aid")return p="+5 HP (max and current) for 8 hours",{attackBonus:0,damageBonus:0,acBonus:0,hpBonus:5,description:p,name:i.name};i.name==="Divine Favor"&&(p="Your weapon attacks deal an extra 1d4 radiant damage on a hit.",v="1d4");const j=c.match(/\+(\d+)\s+bonus\s+to\s+AC/i);return j&&(u=parseInt(j[1]),p=`+${u} to AC`),i.name==="Haste"&&(p="+2 AC, doubled speed, extra action",u=2),p||t!==0||v!==0||u!==0?{attackBonus:t,damageBonus:v,acBonus:u,description:p||i.description.substring(0,100),name:i.name}:null}function Za(i){const c=i.description,t=/takes?\s+(\d+d\d+)\s+\w+\s+damage[^.]*\.\s*If\s+the\s+target\s+is\s+missing.*?instead\s+takes?\s+(\d+d\d+)/is,v=c.match(t);return v?{baseDamage:v[1],alternateDamage:v[2]}:null}var oi=d('<button class="btn btn-secondary">Reorder</button>'),ci=d('<div class="edit-buttons svelte-14o91c5"><button class="btn btn-secondary">Add Attack</button> <!></div>'),vi=d('<input type="text" placeholder="Attack name" class="attack-name svelte-14o91c5"/>'),di=d('<h4 class="attack-name-display svelte-14o91c5"> </h4>'),ui=d('<button class="btn-remove svelte-14o91c5">√ó</button>'),pi=d('<div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Bonus</label> <input type="number" class="attack-bonus svelte-14o91c5"/></div>'),fi=d('<div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Damage</label> <input type="text" placeholder="e.g., 2d6+3" class="attack-damage svelte-14o91c5"/></div>'),mi=d('<div class="spell-info-loading svelte-14o91c5">Loading spell info...</div>'),gi=d('<li class="svelte-14o91c5"><strong>At Higher Levels:</strong> </li>'),bi=d('<ul class="svelte-14o91c5"><li class="svelte-14o91c5"><strong>Level:</strong> </li> <li class="svelte-14o91c5"><strong>Casting Time:</strong> </li> <li class="svelte-14o91c5"><strong>Range:</strong> </li> <li class="svelte-14o91c5"><strong>Components:</strong> <!></li> <li class="svelte-14o91c5"><strong>Duration:</strong> <!> </li> <li class="svelte-14o91c5"><strong>Description:</strong> </li> <!></ul>'),hi=d('<span class="scaled-damage svelte-14o91c5" style="margin-left: 8px;"> </span>'),_i=d('<span class="scaled-damage svelte-14o91c5">(Half damage)</span>'),yi=d('<span class="scaled-damage svelte-14o91c5">(No damage)</span>'),xi=d('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> <!> <!></label></div>'),$i=d('<span class="scaled-damage svelte-14o91c5"> </span>'),ki=d('<span class="scaled-damage svelte-14o91c5"> </span>'),wi=d('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> Target is missing HP <!></label></div>'),Si=d("<option> </option>"),Ci=d('<span class="scaled-damage svelte-14o91c5"><!> </span>'),Di=d('<span class="scaled-damage svelte-14o91c5"> </span>'),Li=d('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> Target is Fiend or Undead <!></label></div>'),ji=d('<div class="spell-level-selector svelte-14o91c5"><label class="svelte-14o91c5">Cast at Level:</label> <select class="spell-level-select use-enabled svelte-14o91c5"></select> <!></div> <!>',1),Ai=d('<div class="spell-level-selector svelte-14o91c5"><span style="color: #dc3545; font-weight: bold;">No spell slots available!</span></div>'),Bi=d('<div class="spell-info svelte-14o91c5"><div class="spell-info-header svelte-14o91c5" role="button" tabindex="0"><h4 class="svelte-14o91c5">Spell Info</h4> <button class="collapse-btn-small svelte-14o91c5"> </button></div> <!></div> <!> <!> <!>',1),Ri=d('<div class="spell-info-missing svelte-14o91c5">Spell info not found.</div>'),Ti=d('<div class="attack-notes svelte-14o91c5"><label class="svelte-14o91c5">Notes</label> <textarea placeholder="e.g., DC 15 Dex save, Range 120 ft, Concentration" class="notes-input svelte-14o91c5" rows="2"></textarea></div>'),Mi=d('<button class="btn btn-primary">Roll Attack</button>'),Fi=d('<div class="buff-target-selection svelte-14o91c5"><div class="target-options svelte-14o91c5"><label class="target-option svelte-14o91c5"><input type="radio" class="svelte-14o91c5"/> Self</label> <label class="target-option svelte-14o91c5"><input type="radio" class="svelte-14o91c5"/> Other</label></div> <button class="btn btn-info"> </button></div>'),Pi=d('<button class="btn btn-info">Cast Spell</button>'),Ii=d("<button><!></button>"),Ei=d('<button class="btn btn-info">Cast Spell</button>'),Ui=d('<button class="btn btn-secondary">Roll Damage</button>'),Hi=d('<button class="btn btn-primary">Roll Attack</button> <!>',1),Ni=d('<div class="attack-card svelte-14o91c5"><div class="attack-header svelte-14o91c5"><!> <!></div> <div class="attack-details svelte-14o91c5"><!> <!> <div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Type</label> <input type="text" placeholder="e.g., slashing" class="attack-type svelte-14o91c5"/></div></div> <!> <!> <div class="attack-actions svelte-14o91c5"><!></div></div>'),Oi=d('<p class="no-attacks svelte-14o91c5">No attacks added yet. Click "Add Attack" to create one.</p>'),Gi=d('<p class="no-attacks svelte-14o91c5">No attacks match your search.</p>'),qi=d('<span class="ability-uses svelte-14o91c5"> <!></span>'),zi=d('<span class="ability-reaction svelte-14o91c5">‚ö° Reaction</span>'),Wi=d('<button class="btn btn-ability svelte-14o91c5">Use Ability</button>'),Ki=d('<div class="ability-card svelte-14o91c5"><div class="ability-header svelte-14o91c5"><h4 class="ability-name svelte-14o91c5"> </h4> <span class="ability-source svelte-14o91c5"> </span></div> <p class="ability-description svelte-14o91c5"> </p> <div class="ability-footer svelte-14o91c5"><!> <!> <!></div></div>'),Vi=d('<div class="condition-abilities-section svelte-14o91c5"><h3 class="abilities-header svelte-14o91c5">Condition Abilities</h3> <p class="section-description svelte-14o91c5">Special actions granted by active conditions (e.g., Flicker of Deceit)</p> <div class="abilities-list svelte-14o91c5"></div></div>'),Ji=d('<button class="btn-remove svelte-14o91c5">√ó</button>'),Yi=d('<div class="state-card svelte-14o91c5"><div class="state-header svelte-14o91c5"><input type="text" placeholder="Effect name (e.g., Magic Weapon)" class="state-name svelte-14o91c5"/> <!></div> <div class="state-details svelte-14o91c5"><div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Attack Bonus</label> <input type="number" class="state-bonus svelte-14o91c5"/></div> <div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Damage Bonus</label> <input type="text" class="state-bonus svelte-14o91c5"/></div> <div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Target</label> <select class="state-bonus svelte-14o91c5"><option>Self</option><option>Other</option></select></div></div> <div class="state-description svelte-14o91c5"><label class="svelte-14o91c5">Description</label> <input type="text" placeholder="e.g., +1 to attack and damage rolls (Magic Weapon)" class="state-desc-input svelte-14o91c5"/></div></div>'),Qi=d('<div class="states-list svelte-14o91c5"></div>'),Xi=d('<p class="no-states svelte-14o91c5">No active effects. Add spell effects that modify your attacks.</p>'),Zi=d('<!> <div class="attacks-list svelte-14o91c5"><!> <!></div> <!> <div class="active-states-section svelte-14o91c5"><h3 class="svelte-14o91c5">Active Spell Effects</h3> <p class="section-description svelte-14o91c5">Effects that modify attack and damage rolls (e.g., Magic Weapon, Bless)</p> <button class="btn btn-secondary">Add Effect</button> <!></div>',1),en=d("<section><!> <!></section> <!>",1);function tn(i,c){zt(c,!1);const t=()=>mt(ge,"$character",f),v=()=>mt(ma,"$searchFilter",f),u=()=>mt(Qt,"$collapsedStates",f),p=()=>mt(ba,"$isEditMode",f),[f,j]=na(),_=D(),y=D(),Y=D(),P=[];function ne(k,E){ge.update(be=>{if(!be.activeStates)return be;const xe=be.activeStates.findIndex(_e=>_e.name===k);if(xe===-1)return be;const h=be.activeStates[xe];if(!h.abilities)return be;const H=h.abilities.findIndex(_e=>_e.name===E);if(H===-1)return be;const le=h.abilities[H];return le.currentUses!==void 0&&le.currentUses>0&&(le.currentUses-=1,le.usesPerRest!==void 0?Ht.add(`Used ${E} (${le.currentUses}/${le.usesPerRest} remaining)`,"info"):Ht.add(`Used ${E}`,"info")),be})}const ee=ha();let se=D({}),J=D({}),M=D(!1);function U(k){fa(se,e(se)[k]=!e(se)[k]),r(se,{...e(se)})}function pe(k){return k.description.toLowerCase().includes("regain")&&(k.description.toLowerCase().includes("hit point")||k.description.toLowerCase().includes("hp"))}function he(k){return["Shield of Faith","Bless","Aid","Magic Weapon"].includes(k)}function Qe(){ge.update(k=>(k.attacks=[...k.attacks,{id:crypto.randomUUID(),name:"",bonus:0,damage:"",damageType:"",notes:""}],k))}function Q(k){ge.update(E=>(E.attacks=E.attacks.filter(be=>be.id!==k),E))}function Ie(){r(M,!0)}function fe(){r(M,!1)}function $e(k){ge.update(E=>(E.attacks=k,E)),r(M,!1),Ht.add("Attack order updated successfully!","success")}function Be(k){let E=k.damage,be=!1,xe=!1;if(k.spellRef){const T=W(k.spellRef);if(T&&(xe=Xa(T),T.level>0)){const N=k.castAtLevel||T.level;if(!g(N)){Ht.add(`No level ${N} spell slots available!`,"error");return}const ie=Ha(T);ie&&k.targetSucceededSave&&ie.noDamageOnSave?E="0":(be=ie?.halfDamageOnSave&&k.targetSucceededSave||!1,E=$(k,T))}}else if(t().activeStates&&t().activeStates.length>0){let T=0,N=[];for(const X of t().activeStates)X.target!=="other"&&(typeof X.damageBonus=="string"?N.push(X.damageBonus):typeof X.damageBonus=="number"&&(T+=X.damageBonus));if((T!==0||N.length>0)&&E){const X=E.match(/(\d+d\d+)([+-]\d+)?/);if(X){const[,ie,R]=X,Ae=(R?parseInt(R):0)+T;let Je=`${ie}`;Ae!==0&&(Je+=`${Ae>=0?"+":""}${Ae}`),N.length>0&&(Je+=" + "+N.join(" + ")),E=Je}}}const h=[];let H=0;if(xe){const T=Ya(t(),t().abilities),N=t().proficiencyBonus||0;h.push({value:N,source:"proficiency"}),h.push({value:T,source:"spellcasting"}),H=N+T}else k.bonus!==0&&h.push({value:k.bonus,source:"base"}),H=k.bonus;let le=[];if(t().activeStates)for(const T of t().activeStates)T.target!=="other"&&(typeof T.attackBonus=="number"&&T.attackBonus!==0?(h.push({value:T.attackBonus,source:T.name.toLowerCase()}),H+=T.attackBonus):typeof T.attackBonus=="string"&&T.attackBonus&&(le.push(T.attackBonus),h.push({value:T.attackBonus,source:T.name.toLowerCase()})));let _e=`1d20${H>=0?"+":""}${H}`;le.length>0&&(_e+="+"+le.join("+")),ee("roll",{notation:_e,damageNotation:E,attackName:k.name,applyHalfDamage:be,bonusBreakdown:h,rollType:"attack"})}function F(k){if(!k.damage){Ht.add(`${k.name}: No damage specified`,"error");return}let E=k.damage,be=!1;const xe=[];let h=k.damageType||"";if(k.spellRef){const H=W(k.spellRef);if(H){const le=pe(H);if(le){const _e=Ya(t(),t().abilities),T=E.match(/^(\d+d\d+)/);T&&(E=T[1],_e>0&&(E+=`+${_e}`,xe.push({value:_e,source:"spellcasting"}))),h="Healing"}if(H.level>0){const _e=k.castAtLevel||H.level;if(!g(_e)){Ht.add(`No level ${_e} spell slots available!`,"error");return}const N=Ha(H);N&&k.targetSucceededSave&&N.noDamageOnSave?E="0":(be=N?.halfDamageOnSave&&k.targetSucceededSave||!1,le||(E=$(k,H))),H.damageType&&!le&&(h=H.damageType)}}}else{const H=E.match(/(\d+d\d+)([+-]\d+)?/);if(H){const[,le,_e]=H,T=_e?parseInt(_e):0;if(T!==0&&xe.push({value:T,source:"base"}),t().activeStates&&t().activeStates.length>0){let N=0,X=[];for(const ie of t().activeStates)ie.target!=="other"&&(typeof ie.damageBonus=="string"?X.push(ie.damageBonus):typeof ie.damageBonus=="number"&&ie.damageBonus!==0&&(xe.push({value:ie.damageBonus,source:ie.name.toLowerCase()}),N+=ie.damageBonus));if(N!==0||X.length>0){const ie=T+N;let R=`${le}`;ie!==0&&(R+=`${ie>=0?"+":""}${ie}`),X.length>0&&(R+=" + "+X.join(" + ")),E=R}}}}ee("roll",{notation:E,attackName:k.name,applyHalfDamage:be,bonusBreakdown:xe,damageType:h})}let I=D([]),x=D(!1);Sa(async()=>{r(I,await Ms()),r(x,!0)});function W(k){return e(I).find(E=>E.name===k)}function g(k){t().classFeatures.spellSlotsByLevel||Pt(ge,n(t).classFeatures.spellSlotsByLevel={},n(t)),t().classFeatures.spellSlotsByLevel[k]||Pt(ge,n(t).classFeatures.spellSlotsByLevel[k]=Array(2).fill(!1),n(t));const be=t().classFeatures.spellSlotsByLevel[k].findIndex(xe=>!xe);return be===-1?!1:(ge.update(xe=>(xe.classFeatures.spellSlotsByLevel||(xe.classFeatures.spellSlotsByLevel={}),xe.classFeatures.spellSlotsByLevel[k]||(xe.classFeatures.spellSlotsByLevel[k]=Array(2).fill(!1)),xe.classFeatures.spellSlotsByLevel[k][be]=!0,xe)),!0)}function $(k,E){let be=k.damage,xe=0,h=0;const H=Za(E);if(H&&k.targetIsDamaged&&(be=H.alternateDamage),ni(E)&&(h+=Ya(t(),t().abilities)),t().activeStates)for(const Ae of t().activeStates)Ae.target!=="other"&&typeof Ae.damageBonus=="number"&&(h+=Ae.damageBonus);if(E.higherLevelSlot&&k.castAtLevel){const Ae=E.level,De=(k.castAtLevel||Ae)-Ae;if(De>0){const m=E.higherLevelSlot.match(/(\d+)d(\d+)\s+for\s+each.*?level\s+above/i);if(m){const[,ue]=m;xe+=De*parseInt(ue)}}}if(k.targetIsFiendOrUndead&&E.description.includes("Fiend or an Undead")){const Ae=E.description.match(/increases by (\d+)d(\d+) if.*?Fiend or.*?Undead/i);if(Ae){const[,Je]=Ae;xe+=parseInt(Je)}}const le=be.match(/(\d+)d(\d+)([+-]\d+)?/);if(!le)return h!==0?h>=0?`${h}`:`${h}`:be||"0";const[,_e,T,N]=le,X=parseInt(_e)+xe,R=(N?parseInt(N):0)+h;let Ee=`${X}d${T}`;return R!==0&&(Ee+=R>=0?`+${R}`:`${R}`),Ee}function Z(k){const E=[];for(let xe=k.level;xe<=9;xe++){const h=t().classFeatures.spellSlotsByLevel?.[xe];h&&h.length>0&&E.push(xe)}return E}function Re(){ge.update(k=>(k.activeStates||(k.activeStates=[]),k.activeStates=[...k.activeStates,{name:"",attackBonus:0,damageBonus:0,description:"",target:"self"}],k))}function Ce(k){ge.update(E=>{if(E.activeStates){const be=E.activeStates[k];be?.hpBonus&&be.target!=="other"&&(E.maxHP-=be.hpBonus,E.currentHP=Math.max(1,Math.min(E.currentHP-be.hpBonus,E.maxHP))),E.activeStates=E.activeStates.filter((xe,h)=>h!==k)}return E})}function me(k,E="self"){const be=W(k.spellRef);if(!be){Ht.add("Spell not found","error");return}const xe=k.castAtLevel||be.level;if(xe>0&&!g(xe)){Ht.add(`No level ${xe} spell slots available!`,"error");return}const h=ri(be);if(!h){Ht.add(`${be.name} cast! Check spell description for effects.`,"info");return}let H=h.hpBonus||0,le=h.description;be.name==="Aid"&&xe>be.level&&(H=5+(xe-be.level)*5,le=`+${H} HP (max and current) for 8 hours`);const T=["Shield of Faith","Bless","Aid","Magic Weapon"].includes(be.name);ge.update(X=>{X.activeStates||(X.activeStates=[]);const ie=X.activeStates.find(R=>R.name===be.name);return ie&&ie.hpBonus&&ie.target!=="other"&&(X.maxHP-=ie.hpBonus,X.currentHP=Math.max(1,Math.min(X.currentHP-ie.hpBonus,X.maxHP))),X.activeStates=X.activeStates.filter(R=>R.name!==be.name),H>0&&E==="self"&&(X.maxHP+=H,X.currentHP+=H),X.activeStates=[...X.activeStates,{name:be.name,attackBonus:h.attackBonus,damageBonus:h.damageBonus,acBonus:h.acBonus,description:le,target:E,hpBonus:H}],X});const N=E==="self"?" on self":" on other";Ht.add(`${be.name} cast${T?N:""}! Effect added to Active Spell Effects.`,"success")}tt(()=>t(),()=>{r(_,t().activeStates?t().activeStates.filter(k=>k.abilities&&k.abilities.length>0).flatMap(k=>k.abilities.map(E=>({...E,conditionName:k.name}))):[])}),tt(()=>(t(),e(se),e(J)),()=>{if(t()&&t().attacks)for(const k of t().attacks)k.spellRef&&e(se)[k.id]===void 0&&fa(se,e(se)[k.id]=!0),k.spellRef&&e(J)[k.id]===void 0&&fa(J,e(J)[k.id]="self")}),tt(()=>(t(),v()),()=>{r(y,t().attacks.filter(k=>{if(!v())return!0;const E=v().toLowerCase();return k.name.toLowerCase().includes(E)||k.damageType.toLowerCase().includes(E)}).sort((k,E)=>!k.spellRef&&E.spellRef?-1:k.spellRef&&!E.spellRef?1:0))}),tt(()=>(v(),e(y)),()=>{r(Y,!v()||e(y).length>0||"attack".includes(v().toLowerCase())||"spell".includes(v().toLowerCase()))}),va(),qt();var ve=en(),Te=Le(ve);let Ve;var ot=l(Te);{let k=yt(()=>(u(),n(()=>u().attacks?"Expand":"Collapse")));_a(ot,{title:"Attacks & Spells",get collapsed(){return u(),n(()=>u().attacks)},get ariaLabel(){return e(k)},onToggle:()=>Qt.update(E=>({...E,attacks:!E.attacks}))})}var ht=a(ot,2);{var ct=k=>{var E=Zi(),be=Le(E);{var xe=De=>{var m=ci(),ue=l(m),re=a(ue,2);{var q=He=>{var Me=oi();B("click",Me,Ie),o(He,Me)};b(re,He=>{t(),n(()=>t().attacks.length>0)&&He(q)})}s(m),B("click",ue,Qe),o(De,m)};b(be,De=>{p()&&De(xe)})}var h=a(be,2),H=l(h);xt(H,1,()=>e(y),De=>De.id,(De,m,ue)=>{var re=Ni(),q=l(re),He=l(q);{var Me=de=>{var G=vi();je(G),Ne(G,()=>e(m).name,Ue=>(e(m).name=Ue,Ut(()=>(e(y),t(),v())))),o(de,G)},we=de=>{var G=di(),Ue=l(G,!0);s(G),S(()=>w(Ue,(e(m),n(()=>e(m).name||"(Unnamed Attack)")))),o(de,G)};b(He,de=>{p()?de(Me):de(we,!1)})}var Pe=a(He,2);{var oe=de=>{var G=ui();B("click",G,()=>Q(e(m).id)),o(de,G)};b(Pe,de=>{p()&&de(oe)})}s(q);var Fe=a(q,2),ye=l(Fe);{var Ye=de=>{var G=pi(),Ue=l(G),ut=a(Ue,2);je(ut),s(G),S(()=>{nt(Ue,"for",`attack-bonus-${e(m),n(()=>e(m).id)??""}`),nt(ut,"id",`attack-bonus-${e(m),n(()=>e(m).id)??""}`)}),Ne(ut,()=>e(m).bonus,Ze=>(e(m).bonus=Ze,Ut(()=>(e(y),t(),v())))),o(de,G)};b(ye,de=>{e(m),n(()=>e(m).bonus!==0&&e(m).bonus!==void 0)&&de(Ye)})}var Oe=a(ye,2);{var rt=de=>{var G=fi(),Ue=l(G),ut=a(Ue,2);je(ut),s(G),S(()=>{nt(Ue,"for",`attack-damage-${e(m),n(()=>e(m).id)??""}`),nt(ut,"id",`attack-damage-${e(m),n(()=>e(m).id)??""}`)}),Ne(ut,()=>e(m).damage,Ze=>(e(m).damage=Ze,Ut(()=>(e(y),t(),v())))),o(de,G)};b(Oe,de=>{e(m),n(()=>e(m).damage&&e(m).damage.trim()!=="")&&de(rt)})}var vt=a(Oe,2),ce=l(vt),L=a(ce,2);je(L),s(vt),s(Fe);var O=a(Fe,2);{var K=de=>{var G=gt(),Ue=Le(G);{var ut=lt=>{var te=mi();o(lt,te)},Ze=lt=>{const te=yt(()=>(e(m),n(()=>W(e(m).spellRef))));var A=gt(),Ke=Le(A);{var at=C=>{const pt=yt(()=>(V(Ha),V(e(te)),n(()=>Ha(e(te))))),bt=yt(()=>(V(Za),V(e(te)),n(()=>Za(e(te)))));var jt=Bi(),Se=Le(jt),ze=l(Se),et=a(l(ze),2),Lt=l(et,!0);s(et),s(ze);var $t=a(ze,2);{var ft=Bt=>{var Mt=bi(),Nt=l(Mt),sa=a(l(Nt));s(Nt);var ra=a(Nt,2),da=a(l(ra));s(ra);var Jt=a(ra,2),It=a(l(Jt));s(Jt);var Kt=a(Jt,2),Zt=a(l(Kt)),Dt=a(Zt);{var dt=Et=>{var Gt=Rt();S(()=>w(Gt,`(${V(e(te)),n(()=>e(te).material)??""})`)),o(Et,Gt)};b(Dt,Et=>{V(e(te)),n(()=>e(te).material)&&Et(dt)})}s(Kt);var _t=a(Kt,2),kt=a(l(_t),2);{var Ft=Et=>{var Gt=Rt("Concentration,");o(Et,Gt)};b(kt,Et=>{V(e(te)),n(()=>e(te).concentration)&&Et(Ft)})}var wt=a(kt,1,!0);s(_t);var Vt=a(_t,2),Ot=a(l(Vt));s(Vt);var oa=a(Vt,2);{var ua=Et=>{var Gt=gi(),ca=a(l(Gt));s(Gt),S(()=>w(ca,` ${V(e(te)),n(()=>e(te).higherLevelSlot)??""}`)),o(Et,Gt)};b(oa,Et=>{V(e(te)),n(()=>e(te).higherLevelSlot)&&Et(ua)})}s(Mt),S(Et=>{w(sa,` ${V(e(te)),n(()=>e(te).level)??""}`),w(da,` ${V(e(te)),n(()=>e(te).castingTime||e(te).actionType)??""}`),w(It,` ${V(e(te)),n(()=>e(te).range)??""}`),w(Zt,` ${Et??""}`),w(wt,(V(e(te)),n(()=>e(te).duration))),w(Ot,` ${V(e(te)),n(()=>e(te).description)??""}`)},[()=>(V(e(te)),n(()=>e(te).components.join(", ")))]),o(Bt,Mt)};b($t,Bt=>{e(se),e(m),n(()=>!e(se)[e(m).id])&&Bt(ft)})}s(Se);var it=a(Se,2);{var Tt=Bt=>{var Mt=xi(),Nt=l(Mt),sa=l(Nt);je(sa);var ra=a(sa),da=a(ra);{var Jt=Dt=>{var dt=hi(),_t=l(dt);s(dt),S(kt=>w(_t,`(Spell Save DC: ${kt??""})`),[()=>(V(is),t(),n(()=>is(t(),t().abilities)))]),o(Dt,dt)};b(da,Dt=>{t(),n(()=>t().class)&&Dt(Jt)})}var It=a(da,2);{var Kt=Dt=>{var dt=_i();o(Dt,dt)},Zt=Dt=>{var dt=gt(),_t=Le(dt);{var kt=Ft=>{var wt=yi();o(Ft,wt)};b(_t,Ft=>{e(m),V(e(pt)),n(()=>e(m).targetSucceededSave&&e(pt).noDamageOnSave)&&Ft(kt)},!0)}o(Dt,dt)};b(It,Dt=>{e(m),V(e(pt)),n(()=>e(m).targetSucceededSave&&e(pt).halfDamageOnSave)?Dt(Kt):Dt(Zt,!1)})}s(Nt),s(Mt),S(Dt=>w(ra,` Target succeeded on ${Dt??""} save `),[()=>(V(e(pt)),n(()=>e(pt).ability.charAt(0).toUpperCase()+e(pt).ability.slice(1)))]),$a(sa,()=>e(m).targetSucceededSave,Dt=>(e(m).targetSucceededSave=Dt,Ut(()=>(e(y),t(),v())))),o(Bt,Mt)};b(it,Bt=>{e(pt)&&Bt(Tt)})}var ea=a(it,2);{var ta=Bt=>{var Mt=wi(),Nt=l(Mt),sa=l(Nt);je(sa);var ra=a(sa,2);{var da=It=>{const Kt=yt(()=>(e(m),V(e(te)),n(()=>$(e(m),e(te)))));var Zt=$i(),Dt=l(Zt);s(Zt),S(()=>w(Dt,`(${V(e(bt)),n(()=>e(bt).alternateDamage)??""}, total: ${e(Kt)??""})`)),o(It,Zt)},Jt=It=>{var Kt=ki(),Zt=l(Kt);s(Kt),S(()=>w(Zt,`(${V(e(bt)),n(()=>e(bt).baseDamage)??""})`)),o(It,Kt)};b(ra,It=>{e(m),n(()=>e(m).targetIsDamaged)?It(da):It(Jt,!1)})}s(Nt),s(Mt),$a(sa,()=>e(m).targetIsDamaged,It=>(e(m).targetIsDamaged=It,Ut(()=>(e(y),t(),v())))),o(Bt,Mt)};b(ea,Bt=>{e(bt)&&Bt(ta)})}var Xt=a(ea,2);{var aa=Bt=>{const Mt=yt(()=>(V(e(te)),n(()=>Z(e(te)))));var Nt=gt(),sa=Le(Nt);{var ra=Jt=>{var It=ji(),Kt=Le(It),Zt=l(Kt),Dt=a(Zt,2);S(()=>{e(m),Ut(()=>{e(Mt)})}),xt(Dt,5,()=>e(Mt),Ct,(wt,Vt)=>{var Ot=Si(),oa=l(Ot);s(Ot);var ua={};S(()=>{w(oa,`Level ${e(Vt)??""}`),ua!==(ua=e(Vt))&&(Ot.value=(Ot.__value=e(Vt))??"")}),o(wt,Ot)}),s(Dt);var dt=a(Dt,2);{var _t=wt=>{const Vt=yt(()=>(e(m),V(e(te)),n(()=>$(e(m),e(te)))));var Ot=Ci(),oa=l(Ot);{var ua=ca=>{var la=Rt("Healing");o(ca,la)},Et=ca=>{var la=Rt("Damage");o(ca,la)};b(oa,ca=>{V(e(te)),n(()=>pe(e(te)))?ca(ua):ca(Et,!1)})}var Gt=a(oa);s(Ot),S(()=>w(Gt,` ${e(Vt)??""}`)),o(wt,Ot)};b(dt,wt=>{e(m),V(e(te)),n(()=>e(m).castAtLevel&&e(m).castAtLevel>e(te).level)&&wt(_t)})}s(Kt);var kt=a(Kt,2);{var Ft=wt=>{var Vt=Li(),Ot=l(Vt),oa=l(Ot);je(oa);var ua=a(oa,2);{var Et=Gt=>{const ca=yt(()=>(e(m),V(e(te)),n(()=>$(e(m),e(te)))));var la=Di(),ya=l(la);s(la),S(()=>w(ya,`(+1d8, total: ${e(ca)??""})`)),o(Gt,la)};b(ua,Gt=>{e(m),n(()=>e(m).targetIsFiendOrUndead)&&Gt(Et)})}s(Ot),s(Vt),$a(oa,()=>e(m).targetIsFiendOrUndead,Gt=>(e(m).targetIsFiendOrUndead=Gt,Ut(()=>(e(y),t(),v())))),o(wt,Vt)};b(kt,wt=>{V(e(te)),n(()=>e(te).description.includes("Fiend or an Undead"))&&wt(Ft)})}S(()=>{nt(Zt,"for",`castLevel-${e(m),n(()=>e(m).id)??""}`),nt(Dt,"id",`castLevel-${e(m),n(()=>e(m).id)??""}`)}),Ra(Dt,()=>e(m).castAtLevel,wt=>(e(m).castAtLevel=wt,Ut(()=>(e(y),t(),v())))),o(Jt,It)},da=Jt=>{var It=Ai();o(Jt,It)};b(sa,Jt=>{V(e(Mt)),n(()=>e(Mt).length>0)?Jt(ra):Jt(da,!1)})}o(Bt,Nt)};b(Xt,Bt=>{V(e(te)),n(()=>e(te).higherLevelSlot&&e(te).level>0)&&Bt(aa)})}S(()=>{nt(et,"aria-label",(e(se),e(m),n(()=>e(se)[e(m).id]?"Expand":"Collapse"))),w(Lt,(e(se),e(m),n(()=>e(se)[e(m).id]?"‚ñº":"‚ñ≤")))}),B("click",ze,()=>U(e(m).id)),B("keydown",ze,Bt=>Bt.key==="Enter"&&U(e(m).id)),o(C,jt)},ae=C=>{var pt=Ri();o(C,pt)};b(Ke,C=>{e(te)?C(at):C(ae,!1)})}o(lt,A)};b(Ue,lt=>{e(I),n(()=>e(I).length===0)?lt(ut):lt(Ze,!1)})}o(de,G)};b(O,de=>{e(m),n(()=>e(m).spellRef)&&de(K)})}var z=a(O,2);{var ke=de=>{var G=gt(),Ue=Le(G);{var ut=Ze=>{var lt=Ti(),te=l(lt),A=a(te,2);xa(A),s(lt),S(()=>{nt(te,"for",`attack-notes-${e(m),n(()=>e(m).id)??""}`),nt(A,"id",`attack-notes-${e(m),n(()=>e(m).id)??""}`)}),Ne(A,()=>e(m).notes,Ke=>(e(m).notes=Ke,Ut(()=>(e(y),t(),v())))),o(Ze,lt)};b(Ue,Ze=>{e(m),n(()=>e(m).notes&&e(m).notes.trim()!=="")&&Ze(ut)})}o(de,G)};b(z,de=>{e(m),n(()=>!e(m).spellRef)&&de(ke)})}var Ge=a(z,2),st=l(Ge);{var qe=de=>{const G=yt(()=>(e(m),n(()=>W(e(m).spellRef))));var Ue=gt(),ut=Le(Ue);{var Ze=lt=>{var te=gt(),A=Le(te);{var Ke=ae=>{var C=Mi();B("click",C,()=>Be(e(m))),o(ae,C)},at=ae=>{var C=gt(),pt=Le(C);{var bt=Se=>{var ze=gt(),et=Le(ze);{var Lt=ft=>{var it=Fi(),Tt=l(it),ea=l(Tt),ta=l(ea);je(ta),ta.value=ta.__value="self",Yt(),s(ea);var Xt=a(ea,2),aa=l(Xt);je(aa),aa.value=aa.__value="other",Yt(),s(Xt),s(Tt);var Bt=a(Tt,2),Mt=l(Bt);s(Bt),s(it),S(()=>{nt(ta,"name",`target-${e(m),n(()=>e(m).id)??""}`),nt(aa,"name",`target-${e(m),n(()=>e(m).id)??""}`),w(Mt,`Cast ${V(e(G)),n(()=>e(G).name)??""}`)}),gs(P,[ue],ta,()=>e(J)[e(m).id],Nt=>fa(J,e(J)[e(m).id]=Nt)),gs(P,[ue],aa,()=>e(J)[e(m).id],Nt=>fa(J,e(J)[e(m).id]=Nt)),B("click",Bt,()=>me(e(m),e(J)[e(m).id])),o(ft,it)},$t=ft=>{var it=Pi();B("click",it,()=>me(e(m),"self")),o(ft,it)};b(et,ft=>{V(e(G)),n(()=>he(e(G).name))?ft(Lt):ft($t,!1)})}o(Se,ze)},jt=Se=>{var ze=gt(),et=Le(ze);{var Lt=ft=>{var it=Ii(),Tt=l(it);{var ea=Xt=>{var aa=Rt("Roll Healing");o(Xt,aa)},ta=Xt=>{var aa=Rt("Roll Damage");o(Xt,aa)};b(Tt,Xt=>{V(e(G)),n(()=>pe(e(G)))?Xt(ea):Xt(ta,!1)})}s(it),S(Xt=>At(it,1,`btn ${Xt??""}`),[()=>(V(e(G)),n(()=>pe(e(G))?"btn-success":"btn-secondary"))]),B("click",it,()=>F(e(m))),o(ft,it)},$t=ft=>{var it=Ei();B("click",it,()=>me(e(m),"self")),o(ft,it)};b(et,ft=>{e(m),n(()=>e(m).damage&&e(m).damage.trim()!=="")?ft(Lt):ft($t,!1)})}o(Se,ze)};b(pt,Se=>{V($s),V(e(G)),n(()=>$s(e(G)))?Se(bt):Se(jt,!1)},!0)}o(ae,C)};b(A,ae=>{V(Xa),V(e(G)),n(()=>Xa(e(G)))?ae(Ke):ae(at,!1)})}o(lt,te)};b(ut,lt=>{e(G)&&lt(Ze)})}o(de,Ue)},We=de=>{var G=gt(),Ue=Le(G);{var ut=Ze=>{var lt=Hi(),te=Le(lt),A=a(te,2);{var Ke=at=>{var ae=Ui();B("click",ae,()=>F(e(m))),o(at,ae)};b(A,at=>{e(m),n(()=>e(m).damage&&e(m).damage.trim()!=="")&&at(Ke)})}B("click",te,()=>Be(e(m))),o(Ze,lt)};b(Ue,Ze=>{e(m),n(()=>!e(m).spellRef)&&Ze(ut)},!0)}o(de,G)};b(st,de=>{e(m),e(x),n(()=>e(m).spellRef&&e(x))?de(qe):de(We,!1)})}s(Ge),s(re),S(()=>{nt(ce,"for",`attack-type-${e(m),n(()=>e(m).id)??""}`),nt(L,"id",`attack-type-${e(m),n(()=>e(m).id)??""}`)}),Ne(L,()=>e(m).damageType,de=>(e(m).damageType=de,Ut(()=>(e(y),t(),v())))),o(De,re)});var le=a(H,2);{var _e=De=>{var m=Oi();o(De,m)},T=De=>{var m=gt(),ue=Le(m);{var re=q=>{var He=Gi();o(q,He)};b(ue,q=>{e(y),n(()=>e(y).length===0)&&q(re)},!0)}o(De,m)};b(le,De=>{t(),n(()=>t().attacks.length===0)?De(_e):De(T,!1)})}s(h);var N=a(h,2);{var X=De=>{var m=Vi(),ue=a(l(m),4);xt(ue,5,()=>e(_),Ct,(re,q)=>{var He=Ki(),Me=l(He),we=l(Me),Pe=l(we,!0);s(we);var oe=a(we,2),Fe=l(oe);s(oe),s(Me);var ye=a(Me,2),Ye=l(ye,!0);s(ye);var Oe=a(ye,2),rt=l(Oe);{var vt=z=>{var ke=qi(),Ge=l(ke),st=a(Ge);{var qe=We=>{var de=Rt();S(()=>w(de,`per ${e(q),n(()=>e(q).restType)??""} rest`)),o(We,de)};b(st,We=>{e(q),n(()=>e(q).restType)&&We(qe)})}s(ke),S(()=>w(Ge,`${e(q),n(()=>e(q).currentUses??e(q).usesPerRest)??""}/${e(q),n(()=>e(q).usesPerRest)??""} uses `)),o(z,ke)};b(rt,z=>{e(q),n(()=>e(q).usesPerRest)&&z(vt)})}var ce=a(rt,2);{var L=z=>{var ke=zi();o(z,ke)};b(ce,z=>{e(q),n(()=>e(q).requiresReaction)&&z(L)})}var O=a(ce,2);{var K=z=>{var ke=Wi();S(()=>ke.disabled=(e(q),n(()=>e(q).currentUses===void 0||e(q).currentUses===0))),B("click",ke,()=>ne(e(q).conditionName,e(q).name)),o(z,ke)};b(O,z=>{p(),e(q),n(()=>!p()&&e(q).usesPerRest)&&z(K)})}s(Oe),s(He),S(()=>{w(Pe,(e(q),n(()=>e(q).name))),w(Fe,`(${e(q),n(()=>e(q).conditionName)??""})`),w(Ye,(e(q),n(()=>e(q).description)))}),o(re,He)}),s(ue),s(m),o(De,m)};b(N,De=>{e(_),n(()=>e(_).length>0)&&De(X)})}var ie=a(N,2),R=a(l(ie),4),Ee=a(R,2);{var Ae=De=>{var m=Qi();xt(m,5,()=>(t(),n(()=>t().activeStates)),Ct,(ue,re,q)=>{var He=Yi(),Me=l(He),we=l(Me);je(we);var Pe=a(we,2);{var oe=We=>{var de=Ji();B("click",de,()=>Ce(q)),o(We,de)};b(Pe,We=>{p()&&We(oe)})}s(Me);var Fe=a(Me,2),ye=l(Fe),Ye=l(ye);nt(Ye,"for",`state-attack-bonus-${q}`);var Oe=a(Ye,2);je(Oe),nt(Oe,"id",`state-attack-bonus-${q}`),s(ye);var rt=a(ye,2),vt=l(rt);nt(vt,"for",`state-damage-bonus-${q}`);var ce=a(vt,2);je(ce),nt(ce,"id",`state-damage-bonus-${q}`),s(rt);var L=a(rt,2),O=l(L);nt(O,"for",`state-target-${q}`);var K=a(O,2);S(()=>{e(re),Ut(()=>{})}),nt(K,"id",`state-target-${q}`);var z=l(K);z.value=z.__value="self";var ke=a(z);ke.value=ke.__value="other",s(K),s(L),s(Fe);var Ge=a(Fe,2),st=l(Ge);nt(st,"for",`state-desc-${q}`);var qe=a(st,2);je(qe),nt(qe,"id",`state-desc-${q}`),s(Ge),s(He),Ne(we,()=>e(re).name,We=>(e(re).name=We,Ut(()=>t()),Da(f,"$character"))),Ne(Oe,()=>e(re).attackBonus,We=>(e(re).attackBonus=We,Ut(()=>t()),Da(f,"$character"))),Ne(ce,()=>e(re).damageBonus,We=>(e(re).damageBonus=We,Ut(()=>t()),Da(f,"$character"))),Ra(K,()=>e(re).target,We=>(e(re).target=We,Ut(()=>t()),Da(f,"$character"))),Ne(qe,()=>e(re).description,We=>(e(re).description=We,Ut(()=>t()),Da(f,"$character"))),o(ue,He)}),s(m),o(De,m)},Je=De=>{var m=Xi();o(De,m)};b(Ee,De=>{t(),n(()=>t().activeStates&&t().activeStates.length>0)?De(Ae):De(Je,!1)})}s(ie),B("click",R,Re),o(k,E)};b(ht,k=>{u(),n(()=>!u().attacks)&&k(ct)})}s(Te);var Xe=a(Te,2);ai(Xe,{get show(){return e(M)},get attacks(){return t(),n(()=>t().attacks)},onSave:$e,onCancel:fe}),S(()=>Ve=At(Te,1,"attacks svelte-14o91c5",null,Ve,{hidden:!e(Y)})),o(i,ve),Wt(),j()}var an=d('<span class="slot-checkbox-x svelte-serp1j">&#8212;</span>'),sn=d('<label><input type="checkbox" class="slot-checkbox-input svelte-serp1j"/> <span><!></span></label>');function ks(i,c){zt(c,!1);const t=()=>mt(ba,"$isEditMode",v),[v,u]=na();let p=St(c,"checked",8,!1),f=St(c,"disabled",8,!1),j=St(c,"className",8,""),_=St(c,"index",8,void 0),y=St(c,"ariaLabel",8,void 0);const Y=ha();function P(U){Y("change",{checked:U.currentTarget.checked,index:_()})}qt();var ne=sn(),ee=l(ne);je(ee);var se=a(ee,2),J=l(se);{var M=U=>{var pe=an();o(U,pe)};b(J,U=>{p()&&U(M)})}s(se),s(ne),S(()=>{At(ne,1,"slot-checkbox-label "+j()+(t()?"":" not-editable"),"svelte-serp1j"),As(ee,p()),ee.disabled=f()||!t(),nt(ee,"aria-label",y()),nt(ee,"tabindex",t()?0:-1),At(se,1,`slot-checkbox-custom ${p()?"used":""} ${t()?"":"readonly"}`,"svelte-serp1j")}),B("change",ee,P),o(i,ne),Wt(),u()}var ln=d('<span class="spell-type cantrip svelte-19b5nmj">Cantrip</span>'),nn=d('<span class="spell-type svelte-19b5nmj"> </span>'),rn=d('<span class="spell-notes svelte-19b5nmj"> </span>'),on=d('<div class="spell-uses svelte-19b5nmj"><span> </span> <button class="btn btn-sm btn-primary svelte-19b5nmj">Use</button></div>'),cn=d('<div class="spell-uses svelte-19b5nmj"><span class="uses-count unlimited svelte-19b5nmj">At will</span></div>'),vn=d('<span class="rest-type svelte-19b5nmj"> </span>'),dn=d('<span class="spellcasting-ability svelte-19b5nmj"> </span>'),un=d('<span class="no-components svelte-19b5nmj">No components required</span>'),pn=d('<div class="racial-spell-item svelte-19b5nmj"><div class="spell-info svelte-19b5nmj"><span class="spell-name svelte-19b5nmj"> </span> <!> <!></div> <!> <div class="spell-meta svelte-19b5nmj"><!> <!> <!></div></div>'),fn=d('<div class="racial-spells svelte-19b5nmj"><h5 class="svelte-19b5nmj">Spells:</h5> <div class="racial-spells-list svelte-19b5nmj"></div></div>'),mn=d('<div class="feature-box racial-trait svelte-19b5nmj"><h4 class="svelte-19b5nmj"> </h4> <p class="feature-description svelte-19b5nmj"> </p> <!></div>'),gn=d('<div class="racial-traits-section svelte-19b5nmj"><h3 class="racial-traits-title svelte-19b5nmj">Racial Traits</h3> <!></div>');function bn(i,c){zt(c,!1);const t=()=>mt(ge,"$character",v),[v,u]=na(),p=D(),f=D(),j=D();function _(J){sl(J)}function y(J){if(!t().racialTraits)return 0;const M=t().racialTraits.uses[J];return M?M.currentUses:0}function Y(J){if(!t().racialTraits)return 0;const M=t().racialTraits.uses[J];return M?M.maxUses:0}function P(J){return J.usesPerRest!==void 0}tt(()=>(t(),us),()=>{t().race&&t().level&&us()}),tt(()=>(t(),ps),()=>{r(p,t().race?ps(t().race):null)}),tt(()=>t(),()=>{r(f,as(t().race,t().level))}),tt(()=>(e(p),e(f)),()=>{r(j,e(p)&&e(p).traits&&e(p).traits.length>0&&e(f).length>0)}),va(),qt();var ne=gt(),ee=Le(ne);{var se=J=>{var M=gn(),U=a(l(M),2);xt(U,1,()=>(e(p),n(()=>e(p).traits)),Ct,(pe,he)=>{var Qe=mn(),Q=l(Qe),Ie=l(Q,!0);s(Q);var fe=a(Q,2),$e=l(fe,!0);s(fe);var Be=a(fe,2);{var F=I=>{var x=fn(),W=a(l(x),2);xt(W,5,()=>e(f),Ct,(g,$)=>{var Z=pn(),Re=l(Z),Ce=l(Re),me=l(Ce,!0);s(Ce);var ve=a(Ce,2);{var Te=T=>{var N=ln();o(T,N)},Ve=T=>{var N=nn(),X=l(N);s(N),S(()=>w(X,`Level ${e($),n(()=>e($).level)??""}`)),o(T,N)};b(ve,T=>{e($),n(()=>e($).level===0)?T(Te):T(Ve,!1)})}var ot=a(ve,2);{var ht=T=>{var N=rn(),X=l(N);s(N),S(()=>w(X,`(${e($),n(()=>e($).notes)??""})`)),o(T,N)};b(ot,T=>{e($),n(()=>e($).notes)&&T(ht)})}s(Re);var ct=a(Re,2);{var Xe=T=>{const N=yt(()=>(e($),n(()=>y(e($).name)))),X=yt(()=>(e($),n(()=>Y(e($).name))));var ie=on(),R=l(ie);let Ee;var Ae=l(R);s(R);var Je=a(R,2);s(ie),S(()=>{Ee=At(R,1,"uses-count svelte-19b5nmj",null,Ee,{depleted:e(N)===0}),w(Ae,`${e(N)??""}/${e(X)??""} uses`),Je.disabled=e(N)===0,nt(Je,"aria-label",`Use ${e($),n(()=>e($).name)??""}`)}),B("click",Je,()=>_(e($).name)),o(T,ie)},k=T=>{var N=cn();o(T,N)};b(ct,T=>{e($),n(()=>P(e($)))?T(Xe):T(k,!1)})}var E=a(ct,2),be=l(E);{var xe=T=>{var N=vn(),X=l(N);s(N),S(()=>w(X,`Recharges on ${e($),n(()=>e($).restType==="short"?"Short":"Long")??""} Rest`)),o(T,N)};b(be,T=>{e($),n(()=>e($).restType)&&T(xe)})}var h=a(be,2);{var H=T=>{var N=dn(),X=l(N);s(N),S(ie=>w(X,`Spellcasting: ${ie??""}`),[()=>(e(he),n(()=>e(he).spellcastingAbility.toUpperCase()))]),o(T,N)};b(h,T=>{e(he),n(()=>e(he).spellcastingAbility)&&T(H)})}var le=a(h,2);{var _e=T=>{var N=un();o(T,N)};b(le,T=>{e(he),n(()=>e(he).componentsRequired===!1)&&T(_e)})}s(E),s(Z),S(()=>w(me,(e($),n(()=>e($).name)))),o(g,Z)}),s(W),s(x),o(I,x)};b(Be,I=>{e(he),e(f),n(()=>e(he).spells&&e(f).length>0)&&I(F)})}s(Qe),S(()=>{w(Ie,(e(he),n(()=>e(he).name))),w($e,(e(he),n(()=>e(he).description)))}),o(pe,Qe)}),s(M),o(J,M)};b(ee,J=>{e(j)&&e(p)&&J(se)})}o(i,ne),Wt(),u()}var hn=d('<p class="no-features svelte-1kpvv0n">Select a class to see available features</p>'),_n=d('<p class="no-features svelte-1kpvv0n">No class features available at this level</p>'),yn=d('<div class="spell-slots svelte-1kpvv0n"><label class="svelte-1kpvv0n"> </label> <div class="slots-tracker svelte-1kpvv0n"></div></div>'),xn=d('<div class="all-spell-slots"></div>'),$n=d('<div class="feature-box spellcasting svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"> </h3> <div class="spell-stats svelte-1kpvv0n"><div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Spell Save DC</label> <div class="spell-value svelte-1kpvv0n"> </div></div> <div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <div class="spell-value svelte-1kpvv0n"> </div></div></div> <!> <div class="prepared-spells svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <textarea placeholder="List your prepared spells..." class="svelte-1kpvv0n"></textarea></div></div>'),kn=d('<p class="unlimited svelte-1kpvv0n">Unlimited Uses</p>'),wn=d('<div class="slots-tracker svelte-1kpvv0n"></div> <div class="uses-actions-row"><button class="btn btn-primary use-enabled"> </button></div> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div>',1),Sn=d('<div class="uses-tracker svelte-1kpvv0n"><!></div>'),Cn=d('<div class="pool-tracker svelte-1kpvv0n"><input type="number" min="0" class="pool-input svelte-1kpvv0n"/> <span> </span> <button class="btn-small svelte-1kpvv0n"> </button></div>'),Dn=d('<p class="no-uses svelte-1kpvv0n">No Channel Divinity uses remaining</p>'),Ln=d('<div class="channel-divinity-option svelte-1kpvv0n"><button class="btn btn-primary use-enabled svelte-1kpvv0n">Use Channel Divinity</button> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div> <!></div>'),jn=d('<div class="feature-box svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"><!> </h3> <p class="feature-description svelte-1kpvv0n"> </p> <!></div>'),An=d('<div class="features-grid svelte-1kpvv0n"><!> <!></div>'),Bn=d("<!> <!>",1),Rn=d("<section><!> <!></section>");function Tn(i,c){zt(c,!1);const t=()=>mt(ge,"$character",f),v=()=>mt(Ga,"$abilityModifiers",f),u=()=>mt(ma,"$searchFilter",f),p=()=>mt(Qt,"$collapsedStates",f),[f,j]=na(),_=D(),y=D(),Y=D(),P=D(),ne=D(),ee=D(),se=D();let J=D(0),M=D(0);function U(g,$){ge.update(Z=>(Z.classFeatures.features[g]=$,Z))}function pe(){ge.update(g=>(g.classFeatures.spellSlotsByLevel||(g.classFeatures.spellSlotsByLevel={}),e(P).forEach(({level:$,slots:Z})=>{g.classFeatures.spellSlotsByLevel[$]||(g.classFeatures.spellSlotsByLevel[$]=Array(Z).fill(!1))}),g))}function he(g){if(typeof g.maxUses=="function"){if((g.name==="Divine Sense"||g.name==="War Priest")&&e(_)?.spellcastingAbility){const $=v()[e(_).spellcastingAbility];return g.maxUses(t().level,$)}return g.maxUses(t().level)}return g.maxUses||0}function Qe(g,$){ge.update(Z=>((!Z.classFeatures.features[g]||!Array.isArray(Z.classFeatures.features[g])||Z.classFeatures.features[g].length!==$)&&(Z.classFeatures.features[g]=Array($).fill(!1)),Z))}Es(()=>{e(ee)&&t()&&t().classFeatures&&t().classFeatures.features&&e(ee).forEach(g=>{if(g.type==="uses"){const $=g.name.replace(/\s+/g,""),Z=he(g),Re=t().classFeatures.features[$];(!Array.isArray(Re)||Re.length!==Z)&&Qe($,Z)}})});function Q(g){return typeof g.maxPool=="function"?g.maxPool(t().level):g.maxPool||0}function Ie(g){return typeof g.description=="function"?g.description(t().level):g.description}function fe(){const g="ChannelDivinity";ge.update($=>{const Z=$.classFeatures.features[g];return typeof Z=="number"&&Z>0&&($.classFeatures.features[g]=Z-1),$})}function $e(){Qt.update(g=>({...g,classFeatures:!g.classFeatures}))}tt(()=>(t(),ia),()=>{r(_,t().class?ia(t().class):null)}),tt(()=>(t(),wa),()=>{r(y,t().class?wa(t().class,t().level,t().subclass):[])}),tt(()=>(t(),_s),()=>{r(Y,t().class?_s(t().class,t().level):0)}),tt(()=>(e(_),t()),()=>{r(P,(()=>{if(!e(_)?.spellcaster)return[];const g=t().level,$=[];return g>=1&&$.push({level:1,slots:Math.min(4,2+Math.floor(g/3))}),g>=3&&$.push({level:2,slots:Math.min(3,2+Math.floor((g-3)/4))}),g>=5&&$.push({level:3,slots:Math.min(3,2+Math.floor((g-5)/5))}),g>=7&&$.push({level:4,slots:Math.min(3,1+Math.floor((g-7)/6))}),g>=9&&$.push({level:5,slots:Math.min(2,1+Math.floor((g-9)/8))}),g>=11&&$.push({level:6,slots:1}),g>=13&&$.push({level:7,slots:1}),g>=15&&$.push({level:8,slots:1}),g>=17&&$.push({level:9,slots:1}),$})())}),tt(()=>(e(_),v(),t(),ys),()=>{if(e(_)?.spellcaster&&e(_).spellcastingAbility){const g=v()[e(_).spellcastingAbility];r(J,hl(t().class,g,t().proficiencyBonus)||0),r(M,ys(t().class,t().level,g))}}),tt(()=>(t(),e(_),e(P)),()=>{t().class&&e(_)?.spellcaster&&e(P).length>0&&pe()}),tt(()=>t(),()=>{r(ne,(()=>{const $=t().classFeatures.features["ChannelDivinity"];return typeof $=="number"?$:0})())}),tt(()=>(e(y),u()),()=>{r(ee,e(y).filter(g=>{if(!u())return!0;const $=u().toLowerCase();return g.name.toLowerCase().includes($)||Ie(g).toLowerCase().includes($)}))}),tt(()=>(u(),t(),e(ee)),()=>{r(se,!u()||t().class||"class features".includes(u().toLowerCase())||"spellcasting".includes(u().toLowerCase())||e(ee).length>0)}),va(),qt();var Be=Rn();let F;var I=l(Be);{let g=yt(()=>(p(),n(()=>p().classFeatures?"Expand":"Collapse")));_a(I,{title:"Class Features",get collapsed(){return p(),n(()=>p().classFeatures)},get ariaLabel(){return e(g)},onToggle:$e})}var x=a(I,2);{var W=g=>{var $=Bn(),Z=Le($);bn(Z,{});var Re=a(Z,2);{var Ce=ve=>{var Te=hn();o(ve,Te)},me=ve=>{var Te=gt(),Ve=Le(Te);{var ot=ct=>{var Xe=_n();o(ct,Xe)},ht=ct=>{var Xe=An(),k=l(Xe);{var E=xe=>{var h=$n(),H=l(h),le=l(H);s(H);var _e=a(H,2),T=l(_e),N=a(l(T),2),X=l(N,!0);s(N),s(T);var ie=a(T,2),R=a(l(ie),2),Ee=l(R,!0);s(R),s(ie),s(_e);var Ae=a(_e,2);{var Je=ue=>{var re=xn();xt(re,5,()=>e(P),Ct,(q,He)=>{let Me=()=>e(He).level,we=()=>e(He).slots;const Pe=yt(()=>(t(),Me(),we(),n(()=>t().classFeatures.spellSlotsByLevel?.[Me()]||Array(we()).fill(!1))));var oe=yn(),Fe=l(oe),ye=l(Fe);s(Fe);var Ye=a(Fe,2);xt(Ye,5,()=>e(Pe),Ct,(Oe,rt,vt)=>{{let ce=yt(()=>(V(e(Pe)),n(()=>e(Pe)[vt]||!1)));ks(Oe,{get checked(){return e(ce)},$$events:{change:L=>{ge.update(O=>(O.classFeatures.spellSlotsByLevel||(O.classFeatures.spellSlotsByLevel={}),O.classFeatures.spellSlotsByLevel[Me()]||(O.classFeatures.spellSlotsByLevel[Me()]=Array(we()).fill(!1)),O.classFeatures.spellSlotsByLevel[Me()][vt]=L.detail.checked,O))}}})}}),s(Ye),s(oe),S(()=>w(ye,`${Me()===1?"1st":Me()===2?"2nd":Me()===3?"3rd":`${Me()}th`} Level Spell Slots`)),o(q,oe)}),s(re),o(ue,re)};b(Ae,ue=>{e(P),n(()=>e(P).length>0)&&ue(Je)})}var De=a(Ae,2),m=a(l(De),2);xa(m),s(De),s(h),S(ue=>{w(le,`Spellcasting (${ue??""})`),w(X,e(J)),w(Ee,e(M))},[()=>(e(_),n(()=>e(_).spellcastingAbility?.toUpperCase()))]),Ne(m,()=>t().classFeatures.preparedSpells,ue=>Pt(ge,n(t).classFeatures.preparedSpells=ue,n(t))),o(xe,h)};b(k,xe=>{e(_),n(()=>e(_)?.spellcaster)&&xe(E)})}var be=a(k,2);xt(be,1,()=>e(ee),Ct,(xe,h)=>{const H=yt(()=>(e(h),n(()=>e(h).name.replace(/\s+/g,"")))),le=yt(()=>(t(),V(e(H)),n(()=>t().classFeatures.features[e(H)]))),_e=yt(()=>typeof e(le)=="number");var T=jn(),N=l(T),X=l(N);{var ie=ue=>{var re=Rt("Channel Divinity:");o(ue,re)};b(X,ue=>{e(h),n(()=>e(h).type==="channelDivinity")&&ue(ie)})}var R=a(X);s(N);var Ee=a(N,2),Ae=l(Ee,!0);s(Ee);var Je=a(Ee,2);{var De=ue=>{const re=yt(()=>(e(h),n(()=>he(e(h))))),q=yt(()=>(V(e(le)),V(e(re)),n(()=>Array.isArray(e(le))?e(le):Array(e(re)).fill(!1))));var He=Sn(),Me=l(He);{var we=oe=>{var Fe=kn();o(oe,Fe)},Pe=oe=>{var Fe=wn(),ye=Le(Fe);xt(ye,5,()=>e(q),Ct,(O,K,z)=>{ks(O,{get checked(){return e(K)},index:z,$$events:{change:ke=>{ge.update(Ge=>(Ge.classFeatures.features[e(H)]||(Ge.classFeatures.features[e(H)]=Array(e(re)).fill(!1)),Ge.classFeatures.features[e(H)][z]=ke.detail.checked,Ge))}}})}),s(ye);var Ye=a(ye,2),Oe=l(Ye),rt=l(Oe);s(Oe),s(Ye);var vt=a(Ye,2),ce=l(vt),L=l(ce);s(ce),s(vt),S(O=>{Oe.disabled=O,w(rt,`Use ${e(h),n(()=>e(h).name)??""}`),w(L,`Resets on ${e(h),n(()=>e(h).resetOn==="short"?"Short Rest":"Long Rest")??""}`)},[()=>(V(e(q)),n(()=>e(q).filter(O=>!O).length<=0))]),B("click",Oe,()=>{ge.update(O=>{O.classFeatures.features[e(H)]||(O.classFeatures.features[e(H)]=Array(e(re)).fill(!1));const K=O.classFeatures.features[e(H)],z=K.findIndex(ke=>!ke);return z!==-1&&(K[z]=!0),O})}),o(oe,Fe)};b(Me,oe=>{e(re)===1/0?oe(we):oe(Pe,!1)})}s(He),o(ue,He)},m=ue=>{var re=gt(),q=Le(re);{var He=we=>{const Pe=yt(()=>(e(h),n(()=>Q(e(h)))));var oe=Cn(),Fe=l(oe);je(Fe);var ye=a(Fe,2),Ye=l(ye);s(ye);var Oe=a(ye,2),rt=l(Oe,!0);s(Oe),s(oe),S(()=>{Aa(Fe,e(_e)&&e(le)!==void 0?e(le):e(Pe)),nt(Fe,"max",e(Pe)),w(Ye,`/ ${e(Pe)??""}`),w(rt,(e(h),n(()=>e(h).resetOn==="short"?"Short Rest":"Long Rest")))}),B("input",Fe,vt=>{ge.update(ce=>(ce.classFeatures.features[e(H)]=parseInt(vt.currentTarget.value)||0,ce))}),B("click",Oe,()=>U(e(H),e(Pe))),o(we,oe)},Me=we=>{var Pe=gt(),oe=Le(Pe);{var Fe=ye=>{var Ye=Ln(),Oe=l(Ye),rt=a(Oe,2),vt=l(rt),ce=l(vt);s(vt),s(rt);var L=a(rt,2);{var O=K=>{var z=Dn();o(K,z)};b(L,K=>{e(ne)<=0&&K(O)})}s(Ye),S(()=>{Oe.disabled=e(ne)<=0,w(ce,`Resets on ${e(h),n(()=>e(h).resetOn==="short"?"Short Rest":"Long Rest")??""}`)}),B("click",Oe,fe),o(ye,Ye)};b(oe,ye=>{e(h),n(()=>e(h).type==="channelDivinity")&&ye(Fe)},!0)}o(we,Pe)};b(q,we=>{e(h),n(()=>e(h).type==="pool")?we(He):we(Me,!1)},!0)}o(ue,re)};b(Je,ue=>{e(h),n(()=>e(h).type==="uses")?ue(De):ue(m,!1)})}s(T),S(ue=>{w(R,` ${e(h),n(()=>e(h).name)??""}`),w(Ae,ue)},[()=>(e(h),n(()=>Ie(e(h))))]),o(xe,T)}),s(Xe),o(ct,Xe)};b(Ve,ct=>{e(y),n(()=>e(y).length===0)?ct(ot):ct(ht,!1)},!0)}o(ve,Te)};b(Re,ve=>{t(),n(()=>!t().class)?ve(Ce):ve(me,!1)})}o(g,$)};b(x,g=>{p(),n(()=>!p().classFeatures)&&g(W)})}s(Be),S(()=>F=At(Be,1,"class-features svelte-1kpvv0n",null,F,{hidden:!e(se)})),o(i,Be),Wt(),j()}var Mn=d('<textarea placeholder="Enter features, traits, and special abilities..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Equipment</h3> <textarea placeholder="List your equipment and inventory..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Notes</h3> <textarea placeholder="Additional notes..." class="svelte-wttn0l"></textarea>',1),Fn=d("<section><!> <!></section>");function Pn(i,c){zt(c,!1);const t=()=>mt(ma,"$searchFilter",p),v=()=>mt(ge,"$character",p),u=()=>mt(Qt,"$collapsedStates",p),[p,f]=na(),j=D();function _(){Qt.update(se=>({...se,notes:!se.notes}))}tt(()=>(t(),v()),()=>{r(j,!t()||"features".includes(t().toLowerCase())||"traits".includes(t().toLowerCase())||"equipment".includes(t().toLowerCase())||"notes".includes(t().toLowerCase())||v().features.toLowerCase().includes(t().toLowerCase())||v().equipment.toLowerCase().includes(t().toLowerCase())||v().notes.toLowerCase().includes(t().toLowerCase()))}),va(),qt();var y=Fn();let Y;var P=l(y);{let se=yt(()=>(u(),n(()=>u().notes?"Expand":"Collapse")));_a(P,{title:"Features & Traits",get collapsed(){return u(),n(()=>u().notes)},get ariaLabel(){return e(se)},onToggle:_})}var ne=a(P,2);{var ee=se=>{var J=Mn(),M=Le(J);xa(M);var U=a(M,4);xa(U);var pe=a(U,4);xa(pe),Ne(M,()=>v().features,he=>Pt(ge,n(v).features=he,n(v))),Ne(U,()=>v().equipment,he=>Pt(ge,n(v).equipment=he,n(v))),Ne(pe,()=>v().notes,he=>Pt(ge,n(v).notes=he,n(v))),o(se,J)};b(ne,se=>{u(),n(()=>!u().notes)&&se(ee)})}s(y),S(()=>Y=At(y,1,"notes svelte-wttn0l",null,Y,{hidden:!e(j)})),o(i,y),Wt(),f()}var In=d(" <!> <!> <!> <!> <!>",1),En=d('<div class="color-picker-section svelte-1r90jgp"><h3 class="svelte-1r90jgp">Dice Colors</h3> <div class="color-inputs svelte-1r90jgp"><div class="color-input-group svelte-1r90jgp"><label for="dice-color" class="svelte-1r90jgp">Dice Color</label> <input type="color" id="dice-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="label-color" class="svelte-1r90jgp">Label Color</label> <input type="color" id="label-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="desk-color" class="svelte-1r90jgp">Background Color</label> <input type="color" id="desk-color" class="svelte-1r90jgp"/></div></div></div>'),Un=d('<div class="loading svelte-1r90jgp"><p class="svelte-1r90jgp">Loading 3D dice...</p></div>'),Hn=d('<div class="custom-dice-selector svelte-1r90jgp"><h3 class="svelte-1r90jgp">Choose Dice to Roll</h3> <div class="dice-inputs svelte-1r90jgp"><div class="dice-input-group svelte-1r90jgp"><label for="d4" class="svelte-1r90jgp">d4</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d4" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d6" class="svelte-1r90jgp">d6</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d6" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d8" class="svelte-1r90jgp">d8</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d8" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d10" class="svelte-1r90jgp">d10</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d10" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d12" class="svelte-1r90jgp">d12</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d12" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d20" class="svelte-1r90jgp">d20</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d20" min="0" max="10"/></div></div> <div class="dice-controls svelte-1r90jgp"><button class="btn btn-primary use-enabled svelte-1r90jgp"> </button> <button class="btn btn-secondary use-enabled svelte-1r90jgp">Reset</button></div></div>'),Nn=d('<h3 class="svelte-1r90jgp"> </h3>'),On=d('<h3 class="svelte-1r90jgp"> </h3>'),Gn=d('<h3 class="svelte-1r90jgp"> </h3>'),qn=d('<h3 class="svelte-1r90jgp"> </h3>'),zn=d('<span class="crit-badge svelte-1r90jgp">CRITICAL HIT!</span>'),Wn=d('<span class="crit-badge crit-fail svelte-1r90jgp">CRITICAL MISS!</span>'),Kn=d('<div class="bonus-item svelte-1r90jgp"><span class="bonus-value svelte-1r90jgp"> </span> <span class="bonus-source svelte-1r90jgp"> </span></div>'),Vn=d('<div class="bonus-breakdown svelte-1r90jgp"></div>'),Jn=d('<p class="modifier-text svelte-1r90jgp"> </p>'),Yn=d('<div class="svelte-1r90jgp"><em class="svelte-1r90jgp">No damage is dealt on a critical miss.</em></div>'),Qn=d('<button class="btn btn-follow-up svelte-1r90jgp"> </button>'),Xn=d('<button class="btn btn-guided-strike svelte-1r90jgp">‚ö° Use Guided Strike (+10)</button>'),Zn=d('<div class="follow-up-actions svelte-1r90jgp"><!> <!></div>'),er=d('<div class="result-header svelte-1r90jgp"><!> <!> <!></div> <div class="result-total svelte-1r90jgp"> </div> <div class="result-details svelte-1r90jgp"><!></div> <!> <!>',1),tr=d('<div role="button" tabindex="-1"><div class="modal-content svelte-1r90jgp" role="dialog" tabindex="0"><div class="modal-header svelte-1r90jgp"><h2 class="svelte-1r90jgp"><!></h2> <div class="header-buttons svelte-1r90jgp"><button class="color-btn svelte-1r90jgp" title="Customize dice colors">üé®</button> <button class="close-btn svelte-1r90jgp">√ó</button></div></div> <!> <!> <div class="dice-main-area svelte-1r90jgp"><div class="dice-container svelte-1r90jgp"></div> <!></div> <div><!></div></div></div>');function ar(i,c){zt(c,!1);const t=()=>mt(ge,"$character",v),[v,u]=na(),p=D(),f=D(),j=D(),_=ha();let y=St(c,"notation",12,""),Y=St(c,"visible",8,!1),P=St(c,"damageNotation",12,""),ne=St(c,"damageType",8,""),ee=St(c,"attackName",12,""),se=St(c,"applyHalfDamage",8,!1),J=St(c,"bonusBreakdown",28,()=>[]),M=St(c,"rollType",12,"other"),U=null,pe=D(void 0),he=D(!1),Qe=D(""),Q=D(null);function Ie(){return e(Q)?.resultTotal??null}function fe(L,O,K){const z=[];if(!L||!L.result)return z;const ke=O.match(/([+-]?\d*d\d+|[+-]?\d+)/g)||[];let Ge=0;const st=new Set;for(const qe of ke){const We=qe.trim();if(!We)continue;const de=We.match(/([+-]?)(\d*)d(\d+)/);if(de){const G=parseInt(de[2]||"1"),Ue=`${G}d${de[3]}`,ut=K.findIndex((te,A)=>!st.has(A)&&typeof te.value=="string"&&te.value===Ue),Ze=[];for(let te=0;te<G&&Ge<L.result.length;te++)Ze.push(L.result[Ge++]);const lt=ut>=0?K[ut].source:"base die";ut>=0&&st.add(ut);for(const te of Ze)z.push({display:`${te}`,source:lt})}}for(let qe=0;qe<K.length;qe++)if(!st.has(qe)&&typeof K[qe].value=="number"){const We=K[qe].value;z.push({display:We>=0?`+${We}`:`${We}`,source:K[qe].source})}return z}let $e=D(0),Be=D(0),F=D(0),I=D(0),x=D(0),W=D(0),g=D(0),$=D([]),Z=D(!1),Re=D(!1),Ce=D(!1),me=D("#051e0a"),ve=D("#ffffff"),Te=D("#3a2004"),Ve=D(!1);function ot(L){return L.length===9&&L.startsWith("#")?L.substring(0,7):L}function ht(L,O="ff"){return L.length===7&&L.startsWith("#")?L+O:L}function ct(){if(window.DICE&&e(pe))try{U&&e(pe)&&fa(pe,e(pe).innerHTML="");const L=e(pe).clientWidth||500,O=e(pe).clientHeight||300;U=new window.DICE.dice_box(e(pe),{w:L,h:O}),r(he,!0)}catch(L){console.error("Error initializing dice box:",L)}}Sa(()=>{const L=z=>new Promise((ke,Ge)=>{if(document.querySelector(`script[src="${z}"]`)){ke(null);return}const qe=document.createElement("script");qe.src=z,qe.onload=()=>{ke(null)},qe.onerror=()=>{console.error(`Failed to load: ${z}`),Ge(new Error(`Failed to load ${z}`))},document.head.appendChild(qe)});setTimeout(()=>{L(`${La}/libs/three.min.js`).then(()=>L(`${La}/libs/cannon.min.js`)).then(()=>L(`${La}/libs/teal.js`)).then(()=>L(`${La}/dice.js`)).then(()=>{if(window.DICE){const z=window.DICE.getColors();r(me,ot(z.dice_color)),r(ve,ot(z.label_color)),r(Te,ot(z.desk_color))}ct()}).catch(z=>{console.error("Failed to load dice libraries:",z)})},100);const O=()=>{e(he)&&ct()},K=z=>{Y()&&z.key==="Escape"&&_e()};return window.addEventListener("resize",O),window.addEventListener("keydown",K),()=>{window.removeEventListener("resize",O),window.removeEventListener("keydown",K)}});function Xe(L,O="other"){if(!U||!e(he))return;r(Q,null),r($,[]),r(Z,!1),r(Re,!1),O==="damage"&&J([]),M(O),r(Ce,!1),U.diceToRoll=L;const K=ke=>null,z=ke=>{let Ge=ke.resultTotal,st=ke.resultString;if(se()&&(Ge=Math.floor(Ge/2),st=st+" (halved)"),r(Q,{...ke,resultTotal:Ge,resultString:st}),console.log("Final roll result:",e(Q)),console.log({type:O}),O==="attack"&&ke.result&&ke.result.length>0){const qe=ke.result[0];r(Z,qe===20),r(Re,qe===1)}if(r($,[]),console.log("Setting up follow-up actions. Type:",O,"damageNotation:",P(),"isCriticalSuccess:",e(Z),"isCriticalFail:",e(Re)),O==="attack"&&P())if(e(Z)){const qe=be(P());e($).push({label:`Roll Critical Damage (${qe})`,notation:qe})}else e(Re)||e($).push({label:`Roll Damage (${P()})`,notation:P()})};U.start_throw(K,z)}function k(){const L=[];e($e)>0&&L.push(`${e($e)}d4`),e(Be)>0&&L.push(`${e(Be)}d6`),e(F)>0&&L.push(`${e(F)}d8`),e(I)>0&&L.push(`${e(I)}d10`),e(x)>0&&L.push(`${e(x)}d12`),e(W)>0&&L.push(`${e(W)}d20`);let O=L.join("+")||"1d20";return e(g)!==0&&(O+=e(g)>=0?`+${e(g)}`:`${e(g)}`),O}function E(){const L=k();Xe(L)}function be(L){return L.replace(/(\d+)d(\d+)/g,(O,K,z)=>`${parseInt(K)*2}d${z}`)}function xe(){r($e,0),r(Be,0),r(F,0),r(I,0),r(x,0),r(W,0),r(g,0),r(Q,null),r($,[]),r(Z,!1),r(Re,!1),M("other"),r(Ce,!1)}function h(){window.DICE&&(window.DICE.setColors({dice_color:ht(e(me),"ff"),label_color:ht(e(ve),"ff"),desk_color:e(Te)}),U&&(U.updateDeskColor(e(Te)),U.updateDiceColors()))}function H(){r(Ve,!e(Ve))}function le(){!e(Q)||e(f)<=0||e(Ce)||(r(Q,{...e(Q),resultTotal:e(Q).resultTotal+10,resultString:e(Q).resultString+" + 10 (Guided Strike)"}),ge.update(L=>{const O="ChannelDivinity",K=L.classFeatures.features[O];return typeof K=="number"&&K>0&&(L.classFeatures.features[O]=K-1),L}),r(Ce,!0))}function _e(){_("close"),y(""),P(""),ee(""),r(Qe,""),r(Q,null),r(Ce,!1),r(Z,!1),r(Re,!1),xe()}tt(()=>(t(),wa),()=>{r(p,t().class?wa(t().class,t().level,t().subclass).some(O=>O.name==="Guided Strike"):!1)}),tt(()=>t(),()=>{r(f,(()=>{const O=t().classFeatures.features["ChannelDivinity"];return typeof O=="number"?O:0})())}),tt(()=>(e($e),e(Be),e(F),e(I),e(x),e(W),e(g)),()=>{r(j,(()=>{const L=[];e($e)>0&&L.push(`${e($e)}d4`),e(Be)>0&&L.push(`${e(Be)}d6`),e(F)>0&&L.push(`${e(F)}d8`),e(I)>0&&L.push(`${e(I)}d10`),e(x)>0&&L.push(`${e(x)}d12`),e(W)>0&&L.push(`${e(W)}d20`);let O=L.join("+")||"1d20";return e(g)!==0&&(O+=e(g)>=0?`+${e(g)}`:`${e(g)}`),O})())}),tt(()=>(V(y()),e(he),V(Y()),e(Qe),V(P()),V(ee()),V(M())),()=>{y()&&e(he)&&Y()&&y()!==e(Qe)&&(r(Qe,y()),r(Q,null),r($,[]),r(Z,!1),r(Re,!1),r(Ce,!1),console.log("Auto-roll triggered. notation:",y(),"damageNotation:",P(),"attackName:",ee(),"rollType:",M()),setTimeout(()=>Xe(y(),M()),200))}),va();var T={getLastRollTotal:Ie};qt();var N=tr();let X;var ie=l(N),R=l(ie),Ee=l(R),Ae=l(Ee);{var Je=L=>{var O=In(),K=Le(O),z=a(K);{var ke=Ze=>{var lt=Rt("- Attack Roll");o(Ze,lt)};b(z,Ze=>{M()==="attack"&&Ze(ke)})}var Ge=a(z,2);{var st=Ze=>{var lt=Rt("- Damage Roll");o(Ze,lt)};b(Ge,Ze=>{M()==="damage"&&Ze(st)})}var qe=a(Ge,2);{var We=Ze=>{var lt=Rt("- Healing Roll");o(Ze,lt)};b(qe,Ze=>{M()==="healing"&&Ze(We)})}var de=a(qe,2);{var G=Ze=>{var lt=Rt("- Ability Check");o(Ze,lt)};b(de,Ze=>{M()==="check"&&Ze(G)})}var Ue=a(de,2);{var ut=Ze=>{var lt=Rt("- Saving Throw");o(Ze,lt)};b(Ue,Ze=>{M()==="save"&&Ze(ut)})}S(()=>w(K,`${ee()??""} `)),o(L,O)},De=L=>{var O=Rt("Dice Roller");o(L,O)};b(Ae,L=>{ee()?L(Je):L(De,!1)})}s(Ee);var m=a(Ee,2),ue=l(m),re=a(ue,2);s(m),s(R);var q=a(R,2);{var He=L=>{var O=En(),K=a(l(O),2),z=l(K),ke=a(l(z),2);je(ke),s(z);var Ge=a(z,2),st=a(l(Ge),2);je(st),s(Ge);var qe=a(Ge,2),We=a(l(qe),2);je(We),s(qe),s(K),s(O),Ne(ke,()=>e(me),de=>r(me,de)),B("change",ke,h),Ne(st,()=>e(ve),de=>r(ve,de)),B("change",st,h),Ne(We,()=>e(Te),de=>r(Te,de)),B("change",We,h),o(L,O)};b(q,L=>{e(Ve)&&L(He)})}var Me=a(q,2);{var we=L=>{var O=Un();o(L,O)};b(Me,L=>{e(he)||L(we)})}var Pe=a(Me,2),oe=l(Pe);Ba(oe,L=>r(pe,L),()=>e(pe));var Fe=a(oe,2);{var ye=L=>{var O=Hn(),K=a(l(O),2),z=l(K),ke=a(l(z),2);je(ke),s(z);var Ge=a(z,2),st=a(l(Ge),2);je(st),s(Ge);var qe=a(Ge,2),We=a(l(qe),2);je(We),s(qe);var de=a(qe,2),G=a(l(de),2);je(G),s(de);var Ue=a(de,2),ut=a(l(Ue),2);je(ut),s(Ue);var Ze=a(Ue,2),lt=a(l(Ze),2);je(lt),s(Ze),s(K);var te=a(K,2),A=l(te),Ke=l(A);s(A);var at=a(A,2);s(te),s(O),S(()=>{A.disabled=!e(he),w(Ke,`Roll ${e(j)??""}`)}),Ne(ke,()=>e($e),ae=>r($e,ae)),Ne(st,()=>e(Be),ae=>r(Be,ae)),Ne(We,()=>e(F),ae=>r(F,ae)),Ne(G,()=>e(I),ae=>r(I,ae)),Ne(ut,()=>e(x),ae=>r(x,ae)),Ne(lt,()=>e(W),ae=>r(W,ae)),B("click",A,E),B("click",at,xe),o(L,O)};b(Fe,L=>{y()||L(ye)})}s(Pe);var Ye=a(Pe,2);let Oe;var rt=l(Ye);{var vt=L=>{var O=er(),K=Le(O),z=l(K);{var ke=ae=>{var C=Nn(),pt=l(C,!0);s(C),S(()=>w(pt,ee()?`${ee()} - Healing`:"Healing")),o(ae,C)},Ge=ae=>{var C=gt(),pt=Le(C);{var bt=Se=>{var ze=On(),et=l(ze,!0);s(ze),S(()=>w(et,ee()?`${ee()} - ${ne()} Damage`:`${ne()} Damage`)),o(Se,ze)},jt=Se=>{var ze=gt(),et=Le(ze);{var Lt=ft=>{var it=Gn(),Tt=l(it,!0);s(it),S(()=>w(Tt,ee()?`${ee()} - Damage`:"Damage")),o(ft,it)},$t=ft=>{var it=qn(),Tt=l(it,!0);s(it),S(()=>w(Tt,ee()?`${ee()} - Result`:"Result")),o(ft,it)};b(et,ft=>{M()==="damage"?ft(Lt):ft($t,!1)},!0)}o(Se,ze)};b(pt,Se=>{M()==="damage"&&ne()?Se(bt):Se(jt,!1)},!0)}o(ae,C)};b(z,ae=>{M()==="damage"&&ne()==="Healing"?ae(ke):ae(Ge,!1)})}var st=a(z,2);{var qe=ae=>{var C=zn();o(ae,C)};b(st,ae=>{e(Z)&&ae(qe)})}var We=a(st,2);{var de=ae=>{var C=Wn();o(ae,C)};b(We,ae=>{e(Re)&&ae(de)})}s(K);var G=a(K,2),Ue=l(G,!0);s(G);var ut=a(G,2),Ze=l(ut);{var lt=ae=>{var C=gt(),pt=Le(C);{var bt=Se=>{var ze=Vn();xt(ze,5,()=>(e(Q),V(y()),V(J()),n(()=>fe(e(Q),y(),J()))),Ct,(et,Lt)=>{var $t=Kn(),ft=l($t),it=l(ft,!0);s(ft);var Tt=a(ft,2),ea=l(Tt);s(Tt),s($t),S(()=>{w(it,(e(Lt),n(()=>e(Lt).display))),w(ea,`(${e(Lt),n(()=>e(Lt).source)??""})`)}),o(et,$t)}),s(ze),o(Se,ze)},jt=Se=>{var ze=gt(),et=Le(ze);{var Lt=$t=>{var ft=Jn(),it=l(ft);s(ft),S(()=>w(it,`Modifier: ${e(Q),n(()=>e(Q).constant>=0?"+":"")??""}${e(Q),n(()=>e(Q).constant)??""}`)),o($t,ft)};b(et,$t=>{e(Q),n(()=>e(Q).constant)&&$t(Lt)},!0)}o(Se,ze)};b(pt,Se=>{V(J()),n(()=>J().length>0)?Se(bt):Se(jt,!1)})}o(ae,C)};b(Ze,ae=>{e(Q),V(J()),n(()=>e(Q).constant||J().length>0)&&ae(lt)})}s(ut);var te=a(ut,2);{var A=ae=>{var C=Yn();o(ae,C)};b(te,ae=>{e(Re)&&ae(A)})}var Ke=a(te,2);{var at=ae=>{var C=Zn(),pt=l(C);xt(pt,1,()=>e($),Ct,(Se,ze)=>{var et=Qn(),Lt=l(et,!0);s(et),S(()=>w(Lt,(e(ze),n(()=>e(ze).label)))),B("click",et,()=>Xe(e(ze).notation,"damage")),o(Se,et)});var bt=a(pt,2);{var jt=Se=>{var ze=Xn();S(()=>{ze.disabled=e(f)<=0,nt(ze,"title",e(f)<=0?"No Channel Divinity uses remaining":"Use Channel Divinity to add +10 to this attack roll")}),B("click",ze,le),o(Se,ze)};b(bt,Se=>{e(p)&&M()==="attack"&&!e(Ce)&&e(f)>0&&!e(Re)&&Se(jt)})}s(C),o(ae,C)};b(Ke,ae=>{e($),e(p),V(M()),e(Ce),e(f),n(()=>e($).length>0||e(p)&&M()==="attack"&&!e(Ce)&&e(f)>0)&&ae(at)})}S(()=>w(Ue,(e(Q),n(()=>e(Q).resultTotal)))),o(L,O)};b(rt,L=>{e(Q)&&L(vt)})}s(Ye),s(ie),s(N),S(()=>{X=At(N,1,"modal-overlay svelte-1r90jgp",null,X,{hidden:!Y()}),Oe=At(Ye,1,"roll-result svelte-1r90jgp",null,Oe,{"has-result":e(Q)})}),B("click",ue,H),B("click",re,_e),B("click",ie,cs(function(L){ka.call(this,c,L)})),B("keydown",ie,function(L){ka.call(this,c,L)}),B("click",N,_e),B("keydown",N,L=>L.key==="Escape"&&_e()),o(i,N),gl(c,"getLastRollTotal",Ie);var ce=Wt(T);return u(),ce}const qa="https://api.github.com/gists";async function sr(i,c,t){if(!c)throw new Error("GitHub token is required");const v=JSON.stringify(i,null,2),u=`${i.name||"character"}_dnd.json`,p={description:t||`D&D Character: ${i.name}`,public:!1,files:{[u]:{content:v}}},f=await fetch(qa,{method:"POST",headers:{Authorization:`token ${c}`,"Content-Type":"application/json"},body:JSON.stringify(p)});if(!f.ok)throw new Error(`Failed to create gist: ${f.statusText}`);return(await f.json()).id}async function lr(i,c,t){if(!c||!t)throw new Error("GitHub token and Gist ID are required");const v=JSON.stringify(i,null,2),p={files:{[`${i.name||"character"}_dnd.json`]:{content:v}}},f=await fetch(`${qa}/${t}`,{method:"PATCH",headers:{Authorization:`token ${c}`,"Content-Type":"application/json"},body:JSON.stringify(p)});if(!f.ok)throw new Error(`Failed to update gist: ${f.statusText}`)}async function ir(i,c){if(!i)throw new Error("Gist ID is required");const t={"Content-Type":"application/json"};c&&(t.Authorization=`token ${c}`);const v=await fetch(`${qa}/${i}`,{method:"GET",headers:t});if(!v.ok)throw new Error(`Failed to load gist: ${v.statusText}`);const u=await v.json(),p=Object.values(u.files);if(p.length===0)throw new Error("No files found in gist");const j=p[0].content;try{const _=JSON.parse(j);return _.attacks&&Array.isArray(_.attacks)&&(_.attacks=_.attacks.map(y=>({...y,id:y.id||crypto.randomUUID()}))),_.classFeatures?(_.classFeatures.features||(_.classFeatures.features={}),_.classFeatures.spellSlots||(_.classFeatures.spellSlots=[]),_.classFeatures.preparedSpells===void 0&&(_.classFeatures.preparedSpells="")):_.classFeatures={features:{},spellSlots:[],preparedSpells:""},_}catch{throw new Error("Invalid character data in gist")}}function ws(i){typeof window<"u"&&localStorage.setItem("dnd_gist_config",JSON.stringify(i))}function nr(){if(typeof window<"u"){const i=localStorage.getItem("dnd_gist_config");if(i)return JSON.parse(i)}return{}}async function rr(i,c=30){if(!i)throw new Error("GitHub token is required to list gists");const t=await fetch(`${qa}?per_page=${c}`,{method:"GET",headers:{Authorization:`token ${i}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error(`Failed to list gists: ${t.statusText}`);return await t.json()}var or=d('<div class="error-message svelte-1jb5ckg"> </div>'),cr=d('<div class="toggle-container svelte-1jb5ckg"><button type="button" class="toggle-btn svelte-1jb5ckg"> </button></div>'),vr=d('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID (leave empty to create new)</label> <input type="text" id="gistId" placeholder="Optional: existing Gist ID to update" class="svelte-1jb5ckg"/></div>'),dr=d('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),ur=d('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),pr=d('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Update (or leave unselected to create new)</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),fr=d('<div class="info-message svelte-1jb5ckg">No gists found. A new one will be created.</div>'),mr=d('<!> <div class="form-group svelte-1jb5ckg"><label for="description" class="svelte-1jb5ckg"> </label> <input type="text" id="description" placeholder="D&amp;D Character Sheet" class="svelte-1jb5ckg"/></div>',1),gr=d('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID *</label> <input type="text" id="gistId" placeholder="Enter Gist ID (for public or your private gists)" required class="svelte-1jb5ckg"/></div>'),br=d('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),hr=d('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),_r=d('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Load</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),yr=d('<div class="info-message svelte-1jb5ckg">No gists found. Enter a Gist ID manually or create a new one in Save mode.</div>'),xr=d('<div class="modal-overlay svelte-1jb5ckg" role="button" tabindex="-1"><div class="modal-content svelte-1jb5ckg" role="dialog" tabindex="0"><div class="modal-header svelte-1jb5ckg"><h2 class="svelte-1jb5ckg"> </h2> <button class="close-btn svelte-1jb5ckg">√ó</button></div> <div class="modal-body svelte-1jb5ckg"><!> <div class="form-group svelte-1jb5ckg"><label for="token" class="svelte-1jb5ckg"> <a href="https://github.com/settings/tokens" target="_blank" rel="noopener" class="svelte-1jb5ckg">Get token</a></label> <input type="password" id="token" placeholder="ghp_xxxxxxxxxxxxx" class="svelte-1jb5ckg"/></div> <!> <!> <div class="modal-actions svelte-1jb5ckg"><button class="btn btn-primary svelte-1jb5ckg"><!></button> <button class="btn btn-secondary svelte-1jb5ckg">Cancel</button></div></div></div></div>');function $r(i,c){zt(c,!1);const t=()=>mt(ge,"$character",v),[v,u]=na(),p=ha();let f=St(c,"mode",8,"save"),j=D(""),_=D(""),y=D(""),Y=D(!1),P=D(""),ne=D(!1),ee=D(!1),se=D([]),J=D(null);const M=nr();M.token&&r(j,M.token),M.gistId&&r(_,M.gistId),Sa(async()=>{e(j)&&!e(ne)&&await U()});async function U(){if(e(j)){r(ee,!0),r(P,"");try{r(se,await rr(e(j))),e(_)&&r(J,e(se).find(h=>h.id===e(_))||null)}catch(h){r(P,h.message||"Failed to load gists"),r(se,[])}finally{r(ee,!1)}}}function pe(h){r(J,h),r(_,h.id)}function he(){r(ne,!e(ne)),r(P,""),!e(ne)&&e(j)&&U()}async function Qe(){if(!e(j)){r(P,"GitHub token is required");return}const h=e(J)?.id||e(_);r(Y,!0),r(P,"");try{if(h)await lr(t(),e(j),h),r(_,h),Ht.add("Character updated in Gist successfully!","success");else{const H=await sr(t(),e(j),e(y));r(_,H),Ht.add(`Character saved to Gist! ID: ${H}`,"success")}ws({token:e(j),gistId:e(_)}),p("close")}catch(H){r(P,H.message||"Failed to save to Gist")}finally{r(Y,!1)}}async function Q(){const h=e(J)?.id||e(_);if(!h){r(P,"Please select a gist or enter a Gist ID");return}r(Y,!0),r(P,"");try{const H=await ir(h,e(j)||void 0);ge.set(H),r(_,h),ws({token:e(j),gistId:e(_)}),Ht.add("Character loaded from Gist successfully!","success"),p("close")}catch(H){r(P,H.message||"Failed to load from Gist")}finally{r(Y,!1)}}function Ie(){p("close")}qt();var fe=xr(),$e=l(fe),Be=l($e),F=l(Be),I=l(F,!0);s(F);var x=a(F,2);s(Be);var W=a(Be,2),g=l(W);{var $=h=>{var H=or(),le=l(H,!0);s(H),S(()=>w(le,e(P))),o(h,H)};b(g,h=>{e(P)&&h($)})}var Z=a(g,2),Re=l(Z),Ce=l(Re);Yt(),s(Re);var me=a(Re,2);je(me),s(Z);var ve=a(Z,2);{var Te=h=>{var H=cr(),le=l(H),_e=l(le,!0);s(le),s(H),S(()=>{le.disabled=e(Y),w(_e,e(ne)?"üìã Show My Gists":"‚úèÔ∏è Enter Gist ID Manually")}),B("click",le,he),o(h,H)};b(ve,h=>{(f()==="load"||f()==="save"&&e(j))&&h(Te)})}var Ve=a(ve,2);{var ot=h=>{var H=mr(),le=Le(H);{var _e=Ee=>{var Ae=vr(),Je=a(l(Ae),2);je(Je),s(Ae),S(()=>Je.disabled=e(Y)),Ne(Je,()=>e(_),De=>r(_,De)),o(Ee,Ae)},T=Ee=>{var Ae=gt(),Je=Le(Ae);{var De=ue=>{var re=dr();o(ue,re)},m=ue=>{var re=gt(),q=Le(re);{var He=we=>{var Pe=pr(),oe=a(l(Pe),2);xt(oe,5,()=>e(se),Ct,(Fe,ye)=>{var Ye=ur();let Oe;var rt=l(Ye),vt=l(rt),ce=l(vt,!0);s(vt);var L=a(vt,2),O=l(L,!0);s(L),s(rt);var K=a(rt,2),z=l(K),ke=l(z);s(z);var Ge=a(z,2),st=l(Ge);s(Ge),s(K),s(Ye),S(qe=>{Oe=At(Ye,1,"gist-item svelte-1jb5ckg",null,Oe,{selected:e(J)?.id===e(ye).id}),Ye.disabled=e(Y),w(ce,(e(ye),n(()=>e(ye).description||"Untitled"))),w(O,(e(ye),n(()=>e(ye).public?"üåê Public":"üîí Private"))),w(ke,`ID: ${e(ye),n(()=>e(ye).id)??""}`),w(st,`Updated: ${qe??""}`)},[()=>(e(ye),n(()=>new Date(e(ye).updated_at).toLocaleDateString()))]),B("click",Ye,()=>pe(e(ye))),o(Fe,Ye)}),s(oe),s(Pe),o(we,Pe)},Me=we=>{var Pe=gt(),oe=Le(Pe);{var Fe=ye=>{var Ye=fr();o(ye,Ye)};b(oe,ye=>{e(j)&&ye(Fe)},!0)}o(we,Pe)};b(q,we=>{e(se),n(()=>e(se).length>0)?we(He):we(Me,!1)},!0)}o(ue,re)};b(Je,ue=>{e(ee)?ue(De):ue(m,!1)},!0)}o(Ee,Ae)};b(le,Ee=>{e(ne)||!e(j)?Ee(_e):Ee(T,!1)})}var N=a(le,2),X=l(N),ie=l(X);s(X);var R=a(X,2);je(R),s(N),S(()=>{w(ie,`Description ${e(_)?"(optional)":""}`),R.disabled=e(Y)}),Ne(R,()=>e(y),Ee=>r(y,Ee)),o(h,H)},ht=h=>{var H=gt(),le=Le(H);{var _e=N=>{var X=gr(),ie=a(l(X),2);je(ie),s(X),S(()=>ie.disabled=e(Y)),Ne(ie,()=>e(_),R=>r(_,R)),o(N,X)},T=N=>{var X=gt(),ie=Le(X);{var R=Ae=>{var Je=br();o(Ae,Je)},Ee=Ae=>{var Je=gt(),De=Le(Je);{var m=re=>{var q=_r(),He=a(l(q),2);xt(He,5,()=>e(se),Ct,(Me,we)=>{var Pe=hr();let oe;var Fe=l(Pe),ye=l(Fe),Ye=l(ye,!0);s(ye);var Oe=a(ye,2),rt=l(Oe,!0);s(Oe),s(Fe);var vt=a(Fe,2),ce=l(vt),L=l(ce);s(ce);var O=a(ce,2),K=l(O);s(O),s(vt),s(Pe),S(z=>{oe=At(Pe,1,"gist-item svelte-1jb5ckg",null,oe,{selected:e(J)?.id===e(we).id}),Pe.disabled=e(Y),w(Ye,(e(we),n(()=>e(we).description||"Untitled"))),w(rt,(e(we),n(()=>e(we).public?"üåê Public":"üîí Private"))),w(L,`ID: ${e(we),n(()=>e(we).id)??""}`),w(K,`Updated: ${z??""}`)},[()=>(e(we),n(()=>new Date(e(we).updated_at).toLocaleDateString()))]),B("click",Pe,()=>pe(e(we))),o(Me,Pe)}),s(He),s(q),o(re,q)},ue=re=>{var q=gt(),He=Le(q);{var Me=we=>{var Pe=yr();o(we,Pe)};b(He,we=>{e(j)&&we(Me)},!0)}o(re,q)};b(De,re=>{e(se),n(()=>e(se).length>0)?re(m):re(ue,!1)},!0)}o(Ae,Je)};b(ie,Ae=>{e(ee)?Ae(R):Ae(Ee,!1)},!0)}o(N,X)};b(le,N=>{e(ne)||!e(j)?N(_e):N(T,!1)},!0)}o(h,H)};b(Ve,h=>{f()==="save"?h(ot):h(ht,!1)})}var ct=a(Ve,2),Xe=l(ct),k=l(Xe);{var E=h=>{var H=Rt();S(()=>w(H,f()==="save"?"Saving...":"Loading...")),o(h,H)},be=h=>{var H=Rt();S(()=>w(H,f()==="save"?"Save":"Load")),o(h,H)};b(k,h=>{e(Y)?h(E):h(be,!1)})}s(Xe);var xe=a(Xe,2);s(ct),s(W),s($e),s(fe),S(()=>{w(I,f()==="save"?"Save to GitHub Gist":"Load from GitHub Gist"),w(Ce,`GitHub Token ${f()==="load"?"(optional for public gists)":"(required)"} `),me.disabled=e(Y),Xe.disabled=e(Y),xe.disabled=e(Y)}),B("click",x,Ie),Ne(me,()=>e(j),h=>r(j,h)),B("blur",me,()=>{e(j)&&!e(ne)&&U()}),B("click",Xe,function(...h){(f()==="save"?Qe:Q)?.apply(this,h)}),B("click",xe,Ie),B("click",$e,cs(function(h){ka.call(this,c,h)})),B("keydown",$e,function(h){ka.call(this,c,h)}),B("click",fe,Ie),B("keydown",fe,h=>h.key==="Escape"&&Ie()),o(i,fe),Wt(),u()}var kr=d('<div class="loading svelte-1ngjemu">Loading D&D data...</div>'),wr=d("<option> </option>"),Sr=d('<select class="level-filter svelte-1ngjemu"><option>All Levels</option><option>Cantrip</option><!></select>'),Cr=d('<div class="no-results svelte-1ngjemu"> </div>'),Dr=d('<div class="item-meta svelte-1ngjemu"> </div>'),Lr=d('<div class="item-meta svelte-1ngjemu"> </div>'),jr=d('<button><div class="item-name svelte-1ngjemu"> </div> <!></button>'),Ar=d('<p class="higher-levels"><strong>At Higher Levels:</strong> </p>'),Br=d('<p class="cantrip-upgrade"><strong>Cantrip Upgrade:</strong> </p>'),Rr=d('<h3 class="svelte-1ngjemu"> </h3> <p class="spell-meta svelte-1ngjemu"><!> <!></p> <p class="spell-classes"><strong>Classes:</strong> </p> <div class="spell-stats svelte-1ngjemu"><div><strong>Casting Time:</strong> </div> <div><strong>Range:</strong> </div> <div><strong>Components:</strong> <!></div> <div><strong>Duration:</strong> <!> </div></div> <p class="description svelte-1ngjemu"> </p> <!> <!>',1),Tr=d('<p class="prerequisite svelte-1ngjemu"><strong>Prerequisite:</strong> </p>'),Mr=d('<h3 class="svelte-1ngjemu"> </h3> <!> <p class="description svelte-1ngjemu"> </p> <a target="_blank" rel="noopener" class="source-link svelte-1ngjemu">View Full Details ‚Üí</a>',1),Fr=d('<div class="item-details svelte-1ngjemu"><!></div>'),Pr=d('<div class="controls svelte-1ngjemu"><div class="tabs svelte-1ngjemu"><button> </button> <button> </button></div> <div class="search-controls svelte-1ngjemu"><input type="text" placeholder="Search by name or description..." class="search-input svelte-1ngjemu"/> <!></div></div> <div class="content-container svelte-1ngjemu"><div class="items-list svelte-1ngjemu"><!></div> <!></div>',1),Ir=d('<div class="modal-backdrop svelte-1ngjemu" role="presentation"><div class="modal svelte-1ngjemu" role="dialog" aria-modal="true" tabindex="-1"><div class="modal-header svelte-1ngjemu"><h2 class="svelte-1ngjemu">Browse D&D Spells & Feats</h2> <button class="close-btn svelte-1ngjemu" aria-label="Close">&times;</button></div> <div class="modal-body svelte-1ngjemu"><!></div> <div class="modal-footer svelte-1ngjemu"><button class="btn-secondary svelte-1ngjemu">Cancel</button> <button class="btn-primary svelte-1ngjemu">Add to Character Sheet</button></div></div></div>');function Er(i,c){zt(c,!1);const t=D(),v=D(),u=D();let p=St(c,"onClose",8),f=D("spell"),j=D(!0),_=D(""),y=D(null),Y=D([]),P=D([]),ne=D(null);Sa(async()=>{r(j,!0);try{r(Y,await Ms()),r(P,await si())}catch(x){console.error("Failed to load data:",x)}finally{r(j,!1)}});function ee(x){r(ne,x)}function se(x){const W=x.match(/(\d+d\d+(?:\s*\+\s*\d+)?)/i);return W?W[1]:""}function J(x){const W=x.split(/\.( |$)/)[0].trim(),g=Array.from(x.matchAll(/\*\*(.*?)\*\*/g)).map(Z=>Z[1].replace(/\.$/,""));let $=W;return g.length&&($+=" | Effects: "+g.join(", ")),$}function M(){if(e(ne)){if(e(f)==="spell"){const x=e(ne);ge.update(W=>{const $=[];x.range&&$.push(`Range: ${x.range}`),x.castingTime&&$.push(`Cast: ${x.castingTime}`),x.duration&&$.push(`Duration: ${x.duration}`),x.actionType==="Save"&&$.push("Saving throw spell"),x.components&&x.components.length>0&&$.push(`Components: ${x.components.join(", ")}`),x.material&&$.push(`Material: ${x.material}`);const Z=$.join(" | "),Re=J(x.description),Ce={id:crypto.randomUUID(),name:`${x.name}${x.concentration?" (C)":""}${x.ritual?" (R)":""}`,bonus:x.actionType==="Attack"?5:0,damage:se(x.description),damageType:`${x.school} (Lvl ${x.level})`,spellRef:x.name,infoNotes:Z,generalNotes:Re,castAtLevel:x.level};return W.attacks=[...W.attacks,Ce],W})}else if(e(f)==="feat"){const x=e(ne);ge.update(W=>{const g=`${x.name}${x.prerequisite?` (Req: ${x.prerequisite})`:""}
${x.description}
`;return W.features=W.features?`${W.features}
${g}`:g,W})}r(ne,null),p()()}}tt(()=>(e(y),e(Y),e(_)),()=>{r(t,e(y)!==null?li(xs(e(Y),e(_)),e(y)):xs(e(Y),e(_)))}),tt(()=>(e(P),e(_)),()=>{r(v,ii(e(P),e(_)))}),tt(()=>(e(f),e(t),e(v)),()=>{r(u,e(f)==="spell"?e(t):e(v))}),va(),qt();var U=Ir(),pe=l(U),he=l(pe),Qe=a(l(he),2);s(he);var Q=a(he,2),Ie=l(Q);{var fe=x=>{var W=kr();o(x,W)},$e=x=>{var W=Pr(),g=Le(W),$=l(g),Z=l($);let Re;var Ce=l(Z);s(Z);var me=a(Z,2);let ve;var Te=l(me);s(me),s($);var Ve=a($,2),ot=l(Ve);je(ot);var ht=a(ot,2);{var ct=le=>{var _e=Sr();S(()=>{e(y),Ut(()=>{})});var T=l(_e);T.value=(T.__value=null)??"";var N=a(T);N.value=N.__value=0;var X=a(N);xt(X,0,()=>[1,2,3,4,5,6,7,8,9],Ct,(ie,R)=>{var Ee=wr(),Ae=l(Ee);s(Ee);var Je={};S(()=>{w(Ae,`Level ${R??""}`),Je!==(Je=R)&&(Ee.value=(Ee.__value=R)??"")}),o(ie,Ee)}),s(_e),Ra(_e,()=>e(y),ie=>r(y,ie)),o(le,_e)};b(ht,le=>{e(f)==="spell"&&le(ct)})}s(Ve),s(g);var Xe=a(g,2),k=l(Xe),E=l(k);{var be=le=>{var _e=Cr(),T=l(_e);s(_e),S(()=>w(T,`No ${e(f)??""}s found`)),o(le,_e)},xe=le=>{var _e=gt(),T=Le(_e);xt(T,1,()=>e(u),Ct,(N,X)=>{var ie=jr();let R;var Ee=l(ie),Ae=l(Ee,!0);s(Ee);var Je=a(Ee,2);{var De=ue=>{const re=yt(()=>e(X));var q=Dr(),He=l(q);s(q),S(()=>w(He,`Level ${V(e(re)),n(()=>e(re).level)??""} ‚Ä¢ ${V(e(re)),n(()=>e(re).school)??""}`)),o(ue,q)},m=ue=>{const re=yt(()=>e(X));var q=gt(),He=Le(q);{var Me=we=>{var Pe=Lr(),oe=l(Pe,!0);s(Pe),S(()=>w(oe,(V(e(re)),n(()=>e(re).prerequisite)))),o(we,Pe)};b(He,we=>{V(e(re)),n(()=>e(re).prerequisite)&&we(Me)})}o(ue,q)};b(Je,ue=>{e(f)==="spell"?ue(De):ue(m,!1)})}s(ie),S(()=>{R=At(ie,1,"item-card svelte-1ngjemu",null,R,{selected:e(ne)?.name===e(X).name}),w(Ae,(e(X),n(()=>e(X).name)))}),B("click",ie,()=>ee(e(X))),o(N,ie)}),o(le,_e)};b(E,le=>{e(u),n(()=>e(u).length===0)?le(be):le(xe,!1)})}s(k);var h=a(k,2);{var H=le=>{var _e=Fr(),T=l(_e);{var N=ie=>{const R=yt(()=>e(ne));var Ee=Rr(),Ae=Le(Ee),Je=l(Ae,!0);s(Ae);var De=a(Ae,2),m=l(De);{var ue=G=>{var Ue=Rt();S(()=>w(Ue,`${V(e(R)),n(()=>e(R).school)??""} cantrip`)),o(G,Ue)},re=G=>{var Ue=Rt();S(()=>w(Ue,`Level ${V(e(R)),n(()=>e(R).level)??""} ${V(e(R)),n(()=>e(R).school)??""}`)),o(G,Ue)};b(m,G=>{V(e(R)),n(()=>e(R).level===0)?G(ue):G(re,!1)})}var q=a(m,2);{var He=G=>{var Ue=Rt("(ritual)");o(G,Ue)};b(q,G=>{V(e(R)),n(()=>e(R).ritual)&&G(He)})}s(De);var Me=a(De,2),we=a(l(Me));s(Me);var Pe=a(Me,2),oe=l(Pe),Fe=a(l(oe));s(oe);var ye=a(oe,2),Ye=a(l(ye));s(ye);var Oe=a(ye,2),rt=a(l(Oe)),vt=a(rt);{var ce=G=>{var Ue=Rt();S(()=>w(Ue,`(${V(e(R)),n(()=>e(R).material)??""})`)),o(G,Ue)};b(vt,G=>{V(e(R)),n(()=>e(R).material)&&G(ce)})}s(Oe);var L=a(Oe,2),O=a(l(L),2);{var K=G=>{var Ue=Rt("Concentration,");o(G,Ue)};b(O,G=>{V(e(R)),n(()=>e(R).concentration)&&G(K)})}var z=a(O,1,!0);s(L),s(Pe);var ke=a(Pe,2),Ge=l(ke,!0);s(ke);var st=a(ke,2);{var qe=G=>{var Ue=Ar(),ut=a(l(Ue));s(Ue),S(()=>w(ut,` ${V(e(R)),n(()=>e(R).higherLevelSlot)??""}`)),o(G,Ue)};b(st,G=>{V(e(R)),n(()=>e(R).higherLevelSlot)&&G(qe)})}var We=a(st,2);{var de=G=>{var Ue=Br(),ut=a(l(Ue));s(Ue),S(()=>w(ut,` ${V(e(R)),n(()=>e(R).cantripUpgrade)??""}`)),o(G,Ue)};b(We,G=>{V(e(R)),n(()=>e(R).cantripUpgrade)&&G(de)})}S((G,Ue)=>{w(Je,(V(e(R)),n(()=>e(R).name))),w(we,` ${G??""}`),w(Fe,` ${V(e(R)),n(()=>e(R).castingTime||e(R).actionType)??""}`),w(Ye,` ${V(e(R)),n(()=>e(R).range)??""}`),w(rt,` ${Ue??""}`),w(z,(V(e(R)),n(()=>e(R).duration))),w(Ge,(V(e(R)),n(()=>e(R).description)))},[()=>(V(e(R)),n(()=>e(R).classes.join(", "))),()=>(V(e(R)),n(()=>e(R).components.join(", ").toUpperCase()))]),o(ie,Ee)},X=ie=>{const R=yt(()=>e(ne));var Ee=Mr(),Ae=Le(Ee),Je=l(Ae,!0);s(Ae);var De=a(Ae,2);{var m=He=>{var Me=Tr(),we=a(l(Me));s(Me),S(()=>w(we,` ${V(e(R)),n(()=>e(R).prerequisite)??""}`)),o(He,Me)};b(De,He=>{V(e(R)),n(()=>e(R).prerequisite)&&He(m)})}var ue=a(De,2),re=l(ue,!0);s(ue);var q=a(ue,2);S(()=>{w(Je,(V(e(R)),n(()=>e(R).name))),w(re,(V(e(R)),n(()=>e(R).description))),nt(q,"href",(V(e(R)),n(()=>e(R).source)))}),o(ie,Ee)};b(T,ie=>{e(f)==="spell"?ie(N):ie(X,!1)})}s(_e),o(le,_e)};b(h,le=>{e(ne)&&le(H)})}s(Xe),S(()=>{Re=At(Z,1,"tab svelte-1ngjemu",null,Re,{active:e(f)==="spell"}),w(Ce,`üìú Spells (${e(Y),n(()=>e(Y).length)??""})`),ve=At(me,1,"tab svelte-1ngjemu",null,ve,{active:e(f)==="feat"}),w(Te,`‚≠ê Feats (${e(P),n(()=>e(P).length)??""})`)}),B("click",Z,()=>{r(f,"spell"),r(ne,null),r(_,"")}),B("click",me,()=>{r(f,"feat"),r(ne,null),r(_,"")}),Ne(ot,()=>e(_),le=>r(_,le)),o(x,W)};b(Ie,x=>{e(j)?x(fe):x($e,!1)})}s(Q);var Be=a(Q,2),F=l(Be),I=a(F,2);s(Be),s(pe),s(U),S(()=>I.disabled=!e(ne)),B("click",Qe,function(...x){p()?.apply(this,x)}),B("click",F,function(...x){p()?.apply(this,x)}),B("click",I,M),B("click",pe,cs(function(x){ka.call(this,c,x)})),B("keydown",pe,function(x){ka.call(this,c,x)}),B("click",U,function(...x){p()?.apply(this,x)}),B("keydown",U,x=>x.key==="Escape"&&p()()),o(i,U),Wt()}var Ur=d('<span class="resistance-tag svelte-gdwwx1"> <button type="button" class="tag-remove svelte-gdwwx1">√ó</button></span>'),Hr=d('<div class="resistance-list svelte-gdwwx1"></div>'),Nr=d('<p class="ability-meta svelte-gdwwx1"> <!></p>'),Or=d('<p class="ability-meta svelte-gdwwx1">Requires Reaction</p>'),Gr=d('<div class="ability-card svelte-gdwwx1"><div class="ability-header svelte-gdwwx1"><strong class="svelte-gdwwx1"> </strong> <button type="button" class="ability-remove svelte-gdwwx1">√ó</button></div> <p class="ability-description svelte-gdwwx1"> </p> <!></div>'),qr=d('<div class="abilities-list svelte-gdwwx1"></div>'),zr=d(`<div class="modal-backdrop svelte-gdwwx1" role="presentation"><div class="modal-content svelte-gdwwx1" role="dialog" aria-modal="true" aria-labelledby="modal-title"><div class="modal-header svelte-gdwwx1"><h3 id="modal-title" class="svelte-gdwwx1">Add Custom Condition</h3> <button class="btn-close svelte-gdwwx1" aria-label="Close">√ó</button></div> <div class="modal-body svelte-gdwwx1"><div class="form-group svelte-gdwwx1"><label for="conditionName" class="svelte-gdwwx1">Condition Name*</label> <input type="text" id="conditionName" placeholder="e.g., Cazna's Mark" class="svelte-gdwwx1"/></div> <div class="form-group svelte-gdwwx1"><label for="description" class="svelte-gdwwx1">Description</label> <textarea id="description" placeholder="Describe the condition..." rows="3" class="svelte-gdwwx1"></textarea></div> <div class="form-row svelte-gdwwx1"><div class="form-group svelte-gdwwx1"><label for="attackBonus" class="svelte-gdwwx1">Attack Bonus</label> <input type="text" id="attackBonus" placeholder="0 or 1d4" class="svelte-gdwwx1"/></div> <div class="form-group svelte-gdwwx1"><label for="damageBonus" class="svelte-gdwwx1">Damage Bonus</label> <input type="text" id="damageBonus" placeholder="0 or 1d6" class="svelte-gdwwx1"/></div> <div class="form-group svelte-gdwwx1"><label for="acBonus" class="svelte-gdwwx1">AC Bonus</label> <input type="number" id="acBonus" placeholder="0" class="svelte-gdwwx1"/></div></div> <div class="form-group svelte-gdwwx1"><label for="darkvision" class="svelte-gdwwx1">Darkvision (feet)</label> <input type="number" id="darkvision" placeholder="0" min="0" step="30" class="svelte-gdwwx1"/> <small class="help-text svelte-gdwwx1">Grant or extend darkvision (e.g., 60 for 60 feet)</small></div> <div class="form-group svelte-gdwwx1"><label class="svelte-gdwwx1">Damage Resistances</label> <div class="resistance-input-group svelte-gdwwx1"><input type="text" placeholder="e.g., cold, fire, poison" class="svelte-gdwwx1"/> <button type="button" class="btn-add svelte-gdwwx1">Add</button></div> <!></div> <div class="form-group svelte-gdwwx1"><label class="svelte-gdwwx1">Special Abilities</label> <div class="ability-form svelte-gdwwx1"><input type="text" placeholder="Ability name (e.g., Flicker of Deceit)" class="ability-name-input svelte-gdwwx1"/> <textarea placeholder="Ability description..." rows="2" class="ability-desc-input svelte-gdwwx1"></textarea> <div class="ability-options svelte-gdwwx1"><div class="ability-option svelte-gdwwx1"><label for="abilityUses" class="svelte-gdwwx1">Uses per rest</label> <input type="number" id="abilityUses" min="0" class="svelte-gdwwx1"/></div> <div class="ability-option svelte-gdwwx1"><label for="restType" class="svelte-gdwwx1">Rest type</label> <select id="restType" class="svelte-gdwwx1"><option>Short</option><option>Long</option></select></div> <div class="ability-option svelte-gdwwx1"><label class="svelte-gdwwx1"><input type="checkbox" class="svelte-gdwwx1"/> Requires Reaction</label></div></div> <button type="button" class="btn-add svelte-gdwwx1">Add Ability</button></div> <!></div></div> <div class="modal-footer svelte-gdwwx1"><button class="btn btn-secondary svelte-gdwwx1">Cancel</button> <button class="btn btn-primary svelte-gdwwx1">Add Condition</button></div></div></div>`);function Wr(i,c){zt(c,!1);let t=St(c,"show",8,!1),v=St(c,"onSave",8),u=St(c,"onCancel",8),p=D(""),f=D(""),j=D(0),_=D(0),y=D(0),Y=D(0),P=D([]),ne=D(""),ee=D([]),se=D(""),J=D(""),M=D(0),U=D("short"),pe=D(!1);function he(){r(p,""),r(f,""),r(j,0),r(_,0),r(y,0),r(Y,0),r(P,[]),r(ne,""),r(ee,[]),r(se,""),r(J,""),r(M,0),r(U,"short"),r(pe,!1)}function Qe(){e(ne).trim()&&(r(P,[...e(P),e(ne).trim()]),r(ne,""))}function Q(g){r(P,e(P).filter(($,Z)=>Z!==g))}function Ie(){if(e(se).trim()&&e(J).trim()){const g={name:e(se).trim(),description:e(J).trim(),requiresReaction:e(pe)};e(M)>0&&(g.usesPerRest=e(M),g.currentUses=e(M),g.restType=e(U)),r(ee,[...e(ee),g]),r(se,""),r(J,""),r(M,0),r(U,"short"),r(pe,!1)}}function fe(g){r(ee,e(ee).filter(($,Z)=>Z!==g))}function $e(){if(!e(p).trim()){alert("Please enter a condition name");return}const g={name:e(p).trim(),description:e(f).trim()||"Custom condition",attackBonus:e(j)||0,damageBonus:e(_)||0,target:"self"};e(y)!==0&&(g.acBonus=e(y)),e(Y)>0&&(g.darkvision=e(Y)),e(P).length>0&&(g.resistances=e(P)),e(ee).length>0&&(g.abilities=e(ee)),v()(g),he()}function Be(){he(),u()()}function F(g){g.target===g.currentTarget&&Be()}qt();var I=gt(),x=Le(I);{var W=g=>{var $=zr(),Z=l($),Re=l(Z),Ce=a(l(Re),2);s(Re);var me=a(Re,2),ve=l(me),Te=a(l(ve),2);je(Te),s(ve);var Ve=a(ve,2),ot=a(l(Ve),2);xa(ot),s(Ve);var ht=a(Ve,2),ct=l(ht),Xe=a(l(ct),2);je(Xe),s(ct);var k=a(ct,2),E=a(l(k),2);je(E),s(k);var be=a(k,2),xe=a(l(be),2);je(xe),s(be),s(ht);var h=a(ht,2),H=a(l(h),2);je(H),Yt(2),s(h);var le=a(h,2),_e=a(l(le),2),T=l(_e);je(T);var N=a(T,2);s(_e);var X=a(_e,2);{var ie=ce=>{var L=Hr();xt(L,5,()=>e(P),Ct,(O,K,z)=>{var ke=Ur(),Ge=l(ke),st=a(Ge);s(ke),S(()=>{w(Ge,`${e(K)??""} `),nt(st,"aria-label",`Remove ${e(K)??""}`)}),B("click",st,()=>Q(z)),o(O,ke)}),s(L),o(ce,L)};b(X,ce=>{e(P),n(()=>e(P).length>0)&&ce(ie)})}s(le);var R=a(le,2),Ee=a(l(R),2),Ae=l(Ee);je(Ae);var Je=a(Ae,2);xa(Je);var De=a(Je,2),m=l(De),ue=a(l(m),2);je(ue),s(m);var re=a(m,2),q=a(l(re),2);S(()=>{e(U),Ut(()=>{})});var He=l(q);He.value=He.__value="short";var Me=a(He);Me.value=Me.__value="long",s(q),s(re);var we=a(re,2),Pe=l(we),oe=l(Pe);je(oe),Yt(),s(Pe),s(we),s(De);var Fe=a(De,2);s(Ee);var ye=a(Ee,2);{var Ye=ce=>{var L=qr();xt(L,5,()=>e(ee),Ct,(O,K,z)=>{var ke=Gr(),Ge=l(ke),st=l(Ge),qe=l(st,!0);s(st);var We=a(st,2);s(Ge);var de=a(Ge,2),G=l(de,!0);s(de);var Ue=a(de,2);{var ut=lt=>{var te=Nr(),A=l(te),Ke=a(A);{var at=ae=>{var C=Rt("‚Ä¢ Requires Reaction");o(ae,C)};b(Ke,ae=>{e(K),n(()=>e(K).requiresReaction)&&ae(at)})}s(te),S(()=>w(A,`${e(K),n(()=>e(K).usesPerRest)??""} use${e(K),n(()=>e(K).usesPerRest>1?"s":"")??""} per ${e(K),n(()=>e(K).restType)??""}
                      rest `)),o(lt,te)},Ze=lt=>{var te=gt(),A=Le(te);{var Ke=at=>{var ae=Or();o(at,ae)};b(A,at=>{e(K),n(()=>e(K).requiresReaction)&&at(Ke)},!0)}o(lt,te)};b(Ue,lt=>{e(K),n(()=>e(K).usesPerRest)?lt(ut):lt(Ze,!1)})}s(ke),S(()=>{w(qe,(e(K),n(()=>e(K).name))),nt(We,"aria-label",`Remove ${e(K),n(()=>e(K).name)??""}`),w(G,(e(K),n(()=>e(K).description)))}),B("click",We,()=>fe(z)),o(O,ke)}),s(L),o(ce,L)};b(ye,ce=>{e(ee),n(()=>e(ee).length>0)&&ce(Ye)})}s(R),s(me);var Oe=a(me,2),rt=l(Oe),vt=a(rt,2);s(Oe),s(Z),s($),B("click",Ce,Be),Ne(Te,()=>e(p),ce=>r(p,ce)),Ne(ot,()=>e(f),ce=>r(f,ce)),Ne(Xe,()=>e(j),ce=>r(j,ce)),Ne(E,()=>e(_),ce=>r(_,ce)),Ne(xe,()=>e(y),ce=>r(y,ce)),Ne(H,()=>e(Y),ce=>r(Y,ce)),Ne(T,()=>e(ne),ce=>r(ne,ce)),B("keydown",T,ce=>ce.key==="Enter"&&Qe()),B("click",N,Qe),Ne(Ae,()=>e(se),ce=>r(se,ce)),Ne(Je,()=>e(J),ce=>r(J,ce)),Ne(ue,()=>e(M),ce=>r(M,ce)),Ra(q,()=>e(U),ce=>r(U,ce)),$a(oe,()=>e(pe),ce=>r(pe,ce)),B("click",Fe,Ie),B("click",rt,Be),B("click",vt,$e),B("click",$,F),o(g,$)};b(x,g=>{t()&&g(W)})}o(i,I),Wt()}var Kr=d("<option></option>"),Vr=d("<button> </button>"),Jr=d('<button class="btn btn-primary calculate-btn use-enabled svelte-uvfntf">Calculate Damage</button>'),Yr=d('<div class="adjustment-msg svelte-uvfntf"> </div>'),Qr=d('<div class="calculation-result svelte-uvfntf"><div class="result-header svelte-uvfntf"><h4 class="svelte-uvfntf">Damage Calculation</h4></div> <div class="result-content svelte-uvfntf"><div class="damage-breakdown svelte-uvfntf"><div class="damage-row svelte-uvfntf"><span class="label svelte-uvfntf">Original Damage:</span> <span class="value svelte-uvfntf"> </span></div> <div class="adjustments svelte-uvfntf"></div> <div class="damage-row final svelte-uvfntf"><span class="label svelte-uvfntf">Final Damage:</span> <span class="value damage-value svelte-uvfntf"> </span></div></div></div> <div class="result-actions svelte-uvfntf"><button class="btn btn-primary apply-btn use-enabled svelte-uvfntf">Apply Damage</button> <button class="btn btn-secondary cancel-btn use-enabled svelte-uvfntf">Cancel</button></div></div>'),Xr=d('<div class="damage-form svelte-uvfntf"><div class="input-group svelte-uvfntf"><div class="input-field svelte-uvfntf"><label for="damageAmount" class="svelte-uvfntf">Damage Amount</label> <input type="number" id="damageAmount" min="0" placeholder="0" class="damage-input-field use-enabled svelte-uvfntf"/></div> <div class="input-field svelte-uvfntf"><label for="damageType" class="svelte-uvfntf">Damage Type</label> <input type="text" id="damageType" list="damageTypes" placeholder="e.g., fire, cold" class="damage-input-field use-enabled svelte-uvfntf"/> <datalist id="damageTypes"></datalist></div></div> <div class="quick-types svelte-uvfntf"><span class="quick-types-label svelte-uvfntf">Quick Select:</span> <!></div> <!></div>'),Zr=d("<section><!> <!></section>");function eo(i,c){zt(c,!1);const t=()=>mt(ge,"$character",p),v=()=>mt(ma,"$searchFilter",p),u=()=>mt(Qt,"$collapsedStates",p),[p,f]=na(),j=D();ha();let _=D(0),y=D(""),Y=D(!1),P=D(0),ne=D([]);const ee=["slashing","piercing","bludgeoning","fire","cold","lightning","thunder","acid","poison","necrotic","radiant","psychic","force"];function se(){if(e(_)<0){Ht.add("Damage amount cannot be negative","error");return}if(!e(y).trim()){Ht.add("Please enter or select a damage type","error");return}const Ie=Fl(e(_),e(y),t());r(P,Ie.finalDamage),r(ne,Ie.adjustments),r(Y,!0)}function J(){ge.update(Ie=>Pl(Ie,e(P))),Ht.add(`Applied ${e(P)} damage to character (${e(y)})`,"info"),r(_,0),r(y,""),r(Y,!1),r(P,0),r(ne,[])}function M(){r(Y,!1),r(P,0),r(ne,[])}tt(()=>v(),()=>{r(j,!v()||"damage".includes(v().toLowerCase())||"resistance".includes(v().toLowerCase())||"immune".includes(v().toLowerCase()))}),va(),qt();var U=Zr();let pe;var he=l(U);{let Ie=yt(()=>(u(),n(()=>u().damageInput?"Expand":"Collapse")));_a(he,{title:"Apply Damage",get collapsed(){return u(),n(()=>u().damageInput)},get ariaLabel(){return e(Ie)},onToggle:()=>Qt.update(fe=>({...fe,damageInput:!fe.damageInput}))})}var Qe=a(he,2);{var Q=Ie=>{var fe=Xr(),$e=l(fe),Be=l($e),F=a(l(Be),2);je(F),s(Be);var I=a(Be,2),x=a(l(I),2);je(x);var W=a(x,2);xt(W,5,()=>ee,Ct,(me,ve)=>{var Te=Kr(),Ve={};S(()=>{Ve!==(Ve=e(ve))&&(Te.value=(Te.__value=e(ve))??"")}),o(me,Te)}),s(W),s(I),s($e);var g=a($e,2),$=a(l(g),2);xt($,1,()=>ee,Ct,(me,ve)=>{var Te=Vr();let Ve;var ot=l(Te,!0);s(Te),S(()=>{Ve=At(Te,1,"quick-type-btn use-enabled svelte-uvfntf",null,Ve,{active:e(y)===e(ve)}),w(ot,e(ve))}),B("click",Te,()=>r(y,e(ve))),o(me,Te)}),s(g);var Z=a(g,2);{var Re=me=>{var ve=Jr();B("click",ve,se),o(me,ve)},Ce=me=>{var ve=Qr(),Te=a(l(ve),2),Ve=l(Te),ot=l(Ve),ht=a(l(ot),2),ct=l(ht);s(ht),s(ot);var Xe=a(ot,2);xt(Xe,5,()=>e(ne),Ct,(le,_e)=>{var T=Yr(),N=l(T,!0);s(T),S(()=>w(N,e(_e))),o(le,T)}),s(Xe);var k=a(Xe,2),E=a(l(k),2),be=l(E,!0);s(E),s(k),s(Ve),s(Te);var xe=a(Te,2),h=l(xe),H=a(h,2);s(xe),s(ve),S(()=>{w(ct,`${e(_)??""} ${e(y)??""}`),w(be,e(P))}),B("click",h,J),B("click",H,M),o(me,ve)};b(Z,me=>{e(Y)?me(Ce,!1):me(Re)})}s(fe),Ne(F,()=>e(_),me=>r(_,me)),Ne(x,()=>e(y),me=>r(y,me)),o(Ie,fe)};b(Qe,Ie=>{u(),n(()=>!u().damageInput)&&Ie(Q)})}s(U),S(()=>pe=At(U,1,"damage-input svelte-uvfntf",null,pe,{hidden:!e(j)})),o(i,U),Wt(),f()}var to=d('<link rel="icon" type="image/png" href="favicon4.png"/> <meta name="viewport" content="width=device-width, initial-scale=1"/>',1),ao=d('<span class="character-name svelte-1uha8ag"> </span>'),so=d("<span> </span>"),lo=d('<div class="spell-slots-header svelte-1uha8ag"></div>'),io=d("<span> </span><br/>",1),no=d("<span> </span><br/>",1),ro=d("<span> </span><br/>",1),oo=d("<span> </span><br/>",1),co=d("<span> </span><br/>",1),vo=d("<span> </span><br/>",1),uo=d("<br/><em> <!>)</em>",1),po=d("<br/><em>(requires reaction)</em>",1),fo=d('<div class="ability-detail"><strong> </strong> <!></div>'),mo=d('<div class="abilities-section"><strong>Abilities:</strong><br/> <!></div>'),go=d('<span class="effect-tooltip"><strong> </strong><br/> <br/> <!> <!> <!> <!> <!> <!> <!></span>'),bo=d('<button class="effect-remove-btn svelte-1uha8ag">√ó</button>'),ho=d('<span class="effect-badge svelte-1uha8ag" tabindex="0"> <!> <!></span>'),_o=d(`<div class="active-effects-header svelte-1uha8ag"></div> <style>.effect-badge {
              position: relative;
            }
            .effect-tooltip {
              position: absolute;
              top: 120%;
              left: 50%;
              transform: translateX(-50%);
              background: #fff;
              color: #222;
              border: 1px solid #a5b4fc;
              border-radius: 6px;
              padding: 8px 12px;
              font-size: 0.95em;
              box-shadow: 0 2px 8px rgba(0, 0, 0, 0.12);
              z-index: 10;
              min-width: 180px;
              max-width: 300px;
              white-space: normal;
              pointer-events: none;
              opacity: 1;
              transition: opacity 0.15s;
            }

            .abilities-section {
              margin-top: 8px;
              padding-top: 8px;
              border-top: 1px solid #e5e7eb;
            }

            .ability-detail {
              margin-top: 6px;
              padding: 4px;
              background: #f9fafb;
              border-radius: 4px;
              font-size: 0.9em;
            }

            .ability-detail strong {
              color: #6366f1;
            }

            .ability-detail em {
              font-size: 0.85em;
              color: #6b7280;
            }</style>`,1),yo=d('<div class="rest-menu svelte-1uha8ag"><button class="rest-option svelte-1uha8ag">‚òï Short Rest</button> <button class="rest-option svelte-1uha8ag">üõèÔ∏è Long Rest</button></div>'),xo=d('<div class="container svelte-1uha8ag"><header class="svelte-1uha8ag"><div class="header-top svelte-1uha8ag"><div class="header-title svelte-1uha8ag"><div class="title-row svelte-1uha8ag"><h1 class="svelte-1uha8ag">D&D Character Sheet</h1> <!></div> <!> <!></div> <div class="header-right svelte-1uha8ag"><div class="header-controls svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">üé≤</span><span class="btn-text svelte-1uha8ag">Roll Dice</span></button> <div class="rest-button-container svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">üò¥</span><span class="btn-text svelte-1uha8ag">Rest</span></button> <!></div> <button class="btn btn-secondary use-enabled" title="Add custom condition with effects"><span class="btn-icon svelte-1uha8ag">‚ú®</span><span class="btn-text svelte-1uha8ag">Add Condition</span></button> <div class="mode-toggle"><button><span class="btn-icon svelte-1uha8ag"> </span><span class="btn-text svelte-1uha8ag"> </span></button></div></div> <div class="header-search svelte-1uha8ag"><input type="text" placeholder="üîç Search..." class="search-input use-enabled svelte-1uha8ag"/></div></div></div> <div class="header-actions svelte-1uha8ag"><button class="btn btn-mode svelte-1uha8ag">üìö Browse Spells & Feats</button> <button class="btn btn-secondary">Save to Gist</button> <button class="btn btn-secondary">Load from Gist</button> <button class="btn btn-secondary">Export JSON</button> <button class="btn btn-secondary">Import JSON</button> <input type="file" accept=".json" style="display: none;"/></div></header> <main class="svelte-1uha8ag"><!> <!> <!> <!> <!> <!> <!> <!></main></div> <!> <!> <!> <!> <!>',1);function Ao(i,c){zt(c,!1);const t=()=>mt(ge,"$character",p),v=()=>mt(ba,"$isEditMode",p),u=()=>mt(ma,"$searchFilter",p),[p,f]=na();function j(){const A=[],Ke=t().classFeatures.spellSlotsByLevel||{};for(let at=1;at<=9;at++){const ae=Ke[at];if(ae&&ae.length>0){const C=ae.length,pt=ae.filter(bt=>bt).length;A.push({level:at,available:C-pt,total:C})}}return A}let _=D(!1),y=D(!1),Y=D(!1),P=D(!1),ne=D("save"),ee=D(void 0),se=D(""),J=D(""),M=D(""),U=D(!1),pe=D([]),he=D("other"),Qe=D(),Q=!1,Ie=1,fe=D(!1),$e=D(null);function Be(A){r($e,A)}function F(){r($e,null)}function I(A){r($e,e($e)===A?null:A)}function x(A){ge.update(Ke=>(Ke.activeStates||(Ke.activeStates=[]),Ke.activeStates=[...Ke.activeStates,A],Ke)),r(P,!1),Ht.add(`Added condition: ${A.name}`,"success")}function W(){r(P,!1)}function g(){const A=[];ge.update(C=>{const pt=C.hitDice.current;C.hitDice.current=Math.min(C.hitDice.max,C.hitDice.current+Math.max(1,Math.floor(C.hitDice.max/2)));const bt=C.hitDice.current-pt;if(bt>0&&A.push(`${bt} hit ${bt===1?"die":"dice"}`),C.class){const jt=wa(C.class,C.level,C.subclass);C.classFeatures.features||(C.classFeatures.features={}),jt.forEach(Se=>{if(Se.resetOn==="short"){const ze=Se.name.replace(/\s+/g,"");if(Se.type==="uses"){const et=typeof Se.maxUses=="function"?Se.maxUses(C.level):Se.maxUses;C.classFeatures.features[ze]=Array(et).fill(!1),A.push(Se.name)}else if(Se.type==="pool"){const et=typeof Se.maxPool=="function"?Se.maxPool(C.level):Se.maxPool;et!==void 0&&(C.classFeatures.features[ze]=et,A.push(Se.name))}}})}return C.activeStates&&C.activeStates.forEach(jt=>{jt.abilities&&jt.abilities.forEach(Se=>{if(Se.restType==="short"&&Se.usesPerRest){const ze=Se.usesPerRest-(Se.currentUses||0)>0;Se.currentUses=Se.usesPerRest,ze&&A.push(`${jt.name}: ${Se.name}`)}})}),C}),fs("short"),as(t().race,t().level).some(C=>C.restType==="short"&&C.usesPerRest)&&A.push("racial traits"),r(fe,!1);const ae=A.length>0?`Short rest taken! Restored: ${A.join(", ")}`:"Short rest taken!";Ht.add(ae,"success")}function $(){const A=[];ge.update(C=>{const pt=C.maxHP-C.currentHP;pt>0&&A.push(`${pt} HP`),C.currentHP=C.maxHP,C.tempHP=0;const bt=C.hitDice.max-C.hitDice.current;bt>0&&A.push(`${bt} hit ${bt===1?"die":"dice"}`),C.hitDice.current=C.hitDice.max;let jt=0;if(C.classFeatures.spellSlotsByLevel&&Object.keys(C.classFeatures.spellSlotsByLevel).forEach(Se=>{const ze=C.classFeatures.spellSlotsByLevel[parseInt(Se)];if(ze){const et=ze.filter(Lt=>Lt).length;jt+=et,C.classFeatures.spellSlotsByLevel[parseInt(Se)]=Array(ze.length).fill(!1)}}),jt>0&&A.push(`${jt} spell ${jt===1?"slot":"slots"}`),C.class){const Se=wa(C.class,C.level,C.subclass);C.classFeatures.features||(C.classFeatures.features={});let ze=!1;Se.forEach(et=>{const Lt=et.name.replace(/\s+/g,"");if(!(et.type==="info"||et.type==="channelDivinity")){if(et.type==="uses"){const $t=typeof et.maxUses=="function"?et.maxUses(C.level):et.maxUses;C.classFeatures.features[Lt]=Array($t).fill(!1),ze=!0}else if(et.type==="pool"){const $t=typeof et.maxPool=="function"?et.maxPool(C.level):et.maxPool;$t!==void 0&&(C.classFeatures.features[Lt]=$t,ze=!0)}}}),ze&&A.push("all class features")}if(C.activeStates){let Se=!1;C.activeStates.forEach(ze=>{ze.abilities&&ze.abilities.forEach(et=>{if(et.usesPerRest){const Lt=(et.currentUses||0)<et.usesPerRest;et.currentUses=et.usesPerRest,Lt&&(Se=!0)}})}),Se&&A.push("condition abilities")}return C}),fs("long"),as(t().race,t().level).some(C=>C.usesPerRest)&&A.push("racial traits"),r(fe,!1);const ae=A.length>0?`Long rest taken! Restored: ${A.join(", ")}`:"Long rest taken! Fully rested.";Ht.add(ae,"success")}function Z(A){r(se,""),r(J,""),r(M,""),r(U,!1),r(pe,[]),r(he,"other"),Q=!1,typeof A=="string"?r(se,A):(r(se,A.notation),r(J,A.damageNotation||""),r(M,A.attackName||""),r(U,!!A.applyHalfDamage),r(pe,A.bonusBreakdown||[]),r(he,A.rollType||"other")),r(_,!0)}function Re(A){const{notation:Ke,count:at,bonusBreakdown:ae}=A.detail;r(se,""),Q=!0,Ie=at||1,setTimeout(()=>{r(se,Ke),r(J,""),r(M,"Hit Die"),r(pe,ae||[]),r(he,"other")},0),r(_,!0)}function Ce(){if(r(_,!1),Q&&e(Qe)){const A=e(Qe).getLastRollTotal();if(A!==null){const Ke=Math.max(1,A);ge.update(at=>(at.hitDice.current=Math.max(0,at.hitDice.current-Ie),at.currentHP=Math.min(at.maxHP,at.currentHP+Ke),at))}Q=!1}}function me(){ba.update(A=>!A)}function ve(A){A.target.closest(".rest-button-container")||r(fe,!1)}Sa(()=>{const A=ba.subscribe(Ke=>{Ke?document.body.classList.remove("use-mode"):document.body.classList.add("use-mode")});return document.addEventListener("click",ve),()=>{A(),document.removeEventListener("click",ve)}});function Te(){nl(t())}function Ve(){e(ee)?.click()}async function ot(A){const at=A.target.files?.[0];if(at)try{const ae=await rl(at);ge.set(ae),alert("Character imported successfully!")}catch{alert("Failed to import character file")}}qt();var ht=xo();ll("1uha8ag",A=>{var Ke=to();Yt(2),Ds(()=>{el.title="D&D Character Sheet"}),o(A,Ke)});var ct=Le(ht),Xe=l(ct),k=l(Xe),E=l(k),be=l(E),xe=a(l(be),2);{var h=A=>{var Ke=ao(),at=l(Ke);s(Ke),S(()=>w(at,`${t().name??""} (${t().level??""})`)),o(A,Ke)};b(xe,A=>{t().name&&A(h)})}s(be);var H=a(be,2);{var le=A=>{var Ke=lo();xt(Ke,5,j,Ct,(at,ae)=>{var C=so();let pt;var bt=l(C);s(C),S(()=>{pt=At(C,1,"slot-badge svelte-1uha8ag",null,pt,{depleted:e(ae).available===0}),w(bt,`Lv${e(ae).level??""}: ${e(ae).available??""}/${e(ae).total??""}`)}),o(at,C)}),s(Ke),o(A,Ke)};b(H,A=>{j().length>0&&A(le)})}var _e=a(H,2);{var T=A=>{var Ke=_o(),at=Le(Ke);xt(at,5,()=>t().activeStates,Ct,(ae,C,pt)=>{var bt=ho(),jt=l(bt),Se=a(jt);{var ze=$t=>{var ft=go(),it=l(ft),Tt=l(it,!0);s(it);var ea=a(it,2),ta=a(ea,3);{var Xt=dt=>{var _t=io(),kt=Le(_t),Ft=l(kt);s(kt),Yt(),S(()=>w(Ft,`Attack Bonus: ${typeof e(C).attackBonus=="number"&&e(C).attackBonus>0?"+":""}${e(C).attackBonus??""}`)),o(dt,_t)};b(ta,dt=>{e(C).attackBonus&&dt(Xt)})}var aa=a(ta,2);{var Bt=dt=>{var _t=no(),kt=Le(_t),Ft=l(kt);s(kt),Yt(),S(()=>w(Ft,`Damage Bonus: ${typeof e(C).damageBonus=="number"&&e(C).damageBonus>0?"+":""}${e(C).damageBonus??""}`)),o(dt,_t)};b(aa,dt=>{e(C).damageBonus&&dt(Bt)})}var Mt=a(aa,2);{var Nt=dt=>{var _t=ro(),kt=Le(_t),Ft=l(kt);s(kt),Yt(),S(()=>w(Ft,`AC Bonus: ${e(C).acBonus>0?"+":""}${e(C).acBonus??""}`)),o(dt,_t)};b(Mt,dt=>{e(C).acBonus&&dt(Nt)})}var sa=a(Mt,2);{var ra=dt=>{var _t=oo(),kt=Le(_t),Ft=l(kt);s(kt),Yt(),S(()=>w(Ft,`Darkvision: ${e(C).darkvision??""} feet`)),o(dt,_t)};b(sa,dt=>{e(C).darkvision&&dt(ra)})}var da=a(sa,2);{var Jt=dt=>{var _t=co(),kt=Le(_t),Ft=l(kt);s(kt),Yt(),S(wt=>w(Ft,`Resistances: ${wt??""}`),[()=>e(C).resistances.join(", ")]),o(dt,_t)};b(da,dt=>{e(C).resistances&&e(C).resistances.length>0&&dt(Jt)})}var It=a(da,2);{var Kt=dt=>{var _t=vo(),kt=Le(_t),Ft=l(kt);s(kt),Yt(),S(wt=>w(Ft,`Immunities: ${wt??""}`),[()=>e(C).immunities.join(", ")]),o(dt,_t)};b(It,dt=>{e(C).immunities&&e(C).immunities.length>0&&dt(Kt)})}var Zt=a(It,2);{var Dt=dt=>{var _t=mo(),kt=a(l(_t),3);xt(kt,1,()=>e(C).abilities,Ct,(Ft,wt)=>{var Vt=fo(),Ot=l(Vt),oa=l(Ot);s(Ot);var ua=a(Ot),Et=a(ua);{var Gt=la=>{var ya=uo(),Ma=a(Le(ya)),Fa=l(Ma),Ca=a(Fa);{var za=Wa=>{var Fs=Rt(", requires reaction");o(Wa,Fs)};b(Ca,Wa=>{e(wt).requiresReaction&&Wa(za)})}Yt(),s(Ma),S(()=>w(Fa,`(${(e(wt).currentUses||0)??""}/${e(wt).usesPerRest??""} uses per ${e(wt).restType??""}
                                rest`)),o(la,ya)},ca=la=>{var ya=gt(),Ma=Le(ya);{var Fa=Ca=>{var za=po();Yt(),o(Ca,za)};b(Ma,Ca=>{e(wt).requiresReaction&&Ca(Fa)},!0)}o(la,ya)};b(Et,la=>{e(wt).usesPerRest?la(Gt):la(ca,!1)})}s(Vt),S(()=>{w(oa,`${e(wt).name??""}:`),w(ua,` ${e(wt).description??""} `)}),o(Ft,Vt)}),s(_t),o(dt,_t)};b(Zt,dt=>{e(C).abilities&&e(C).abilities.length>0&&dt(Dt)})}s(ft),S(()=>{w(Tt,e(C).name),w(ea,` ${e(C).description??""}`)}),o($t,ft)};b(Se,$t=>{e($e)===pt&&$t(ze)})}var et=a(Se,2);{var Lt=$t=>{var ft=bo();S(()=>nt(ft,"title",`End ${e(C).name??""}`)),B("click",ft,()=>{ge.update(it=>{if(it.activeStates){const Tt=it.activeStates[pt];Tt?.hpBonus&&Tt.target!=="other"&&(it.maxHP-=Tt.hpBonus,it.currentHP=Math.max(1,Math.min(it.currentHP-Tt.hpBonus,it.maxHP))),it.activeStates=it.activeStates.filter((ea,ta)=>ta!==pt)}return it})}),o($t,ft)};b(et,$t=>{v()||$t(Lt)})}s(bt),S(()=>{nt(bt,"aria-label",e(C).name),w(jt,`‚ú® ${e(C).name??""} `)}),B("mouseenter",bt,()=>Be(pt)),B("mouseleave",bt,F),B("focus",bt,()=>Be(pt)),B("blur",bt,F),B("click",bt,()=>I(pt)),o(ae,bt)}),s(at),Yt(2),o(A,Ke)};b(_e,A=>{t().activeStates&&t().activeStates.length>0&&A(T)})}s(E);var N=a(E,2),X=l(N),ie=l(X),R=a(ie,2),Ee=l(R),Ae=a(Ee,2);{var Je=A=>{var Ke=yo(),at=l(Ke),ae=a(at,2);s(Ke),B("click",at,g),B("click",ae,$),o(A,Ke)};b(Ae,A=>{e(fe)&&A(Je)})}s(R);var De=a(R,2),m=a(De,2),ue=l(m);let re;var q=l(ue),He=l(q,!0);s(q);var Me=a(q),we=l(Me,!0);s(Me),s(ue),s(m),s(X);var Pe=a(X,2),oe=l(Pe);je(oe),s(Pe),s(N),s(k);var Fe=a(k,2),ye=l(Fe),Ye=a(ye,2),Oe=a(Ye,2),rt=a(Oe,2),vt=a(rt,2),ce=a(vt,2);Ba(ce,A=>r(ee,A),()=>e(ee)),s(Fe),s(Xe);var L=a(Xe,2),O=l(L);Cl(O,{});var K=a(O,2);Al(K,{$$events:{roll:A=>Z(A.detail)}});var z=a(K,2);Ql(z,{$$events:{roll:A=>Z(A.detail)}});var ke=a(z,2);Kl(ke,{$$events:{rollHitDice:Re}});var Ge=a(ke,2);eo(Ge,{});var st=a(Ge,2);tn(st,{$$events:{roll:A=>Z(A.detail)}});var qe=a(st,2);Tn(qe,{});var We=a(qe,2);Pn(We,{}),s(L),s(ct);var de=a(ct,2);Ba(ar(de,{get notation(){return e(se)},get damageNotation(){return e(J)},get attackName(){return e(M)},get applyHalfDamage(){return e(U)},get bonusBreakdown(){return e(pe)},get rollType(){return e(he)},get visible(){return e(_)},$$events:{close:Ce},$$legacy:!0}),A=>r(Qe,A),()=>e(Qe));var G=a(de,2);{var Ue=A=>{$r(A,{get mode(){return e(ne)},$$events:{close:()=>r(y,!1)}})};b(G,A=>{e(y)&&A(Ue)})}var ut=a(G,2);{var Ze=A=>{Er(A,{onClose:()=>r(Y,!1)})};b(ut,A=>{e(Y)&&A(Ze)})}var lt=a(ut,2);Wr(lt,{get show(){return e(P)},onSave:x,onCancel:W});var te=a(lt,2);il(te,{}),S(()=>{re=At(ue,1,"btn btn-mode svelte-1uha8ag",null,re,{"use-mode":!v()}),w(He,v()?"üìù":"üé≤"),w(we,v()?"Edit Mode":"Use Mode")}),B("click",ie,()=>{r(pe,[]),r(_,!0)}),B("click",Ee,()=>r(fe,!e(fe))),B("click",De,()=>r(P,!0)),B("click",ue,me),Ne(oe,u,A=>ol(ma,A)),B("click",ye,()=>r(Y,!0)),B("click",Ye,()=>{r(ne,"save"),r(y,!0)}),B("click",Oe,()=>{r(ne,"load"),r(y,!0)}),B("click",rt,Te),B("click",vt,Ve),B("change",ce,ot),o(i,ht),Wt(),f()}export{Ao as component};
