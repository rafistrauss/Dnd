import{d as vs,g as Ps,f as d,e as A,a as o,s as k,c as gt,t as Rt}from"../chunks/BESELRjb.js";import{i as qt}from"../chunks/JMgyEzd3.js";import{c as ha,o as Sa,a as Is,b as Es}from"../chunks/CtPH092J.js";import{F as w,T as fa,Y as es,j as Us,aZ as Hs,U as ds,ag as Ns,aD as Os,aK as Gs,aE as qs,a1 as zs,av as Pa,a7 as ns,i as Ss,a_ as Ws,a$ as Cs,b0 as Oa,K as ba,e as Ds,b1 as Ls,b2 as Ks,b3 as Vs,b4 as Js,q as ts,b5 as Ys,b6 as Qs,ab as Xs,d as n,r as rs,g as Zs,C as zt,G as Wt,H as l,I as s,J as a,b7 as tt,b8 as va,s as r,a4 as C,f as e,m as yt,E as Le,b9 as Ut,ao as Yt,A as J,ba as pa,bb as xa,bc as el}from"../chunks/DyJ43TGI.js";import{t as tl,c as Qt,a as me,e as xt,i as Ct,u as js,s as ga,b as At,d as Ga,f as ma,g as al,j as Ht,k as us,l as fs,m as as,n as sl,h as ll,T as il,o as nl,p as rl,r as ps}from"../chunks/t82uA2lk.js";import{i as b,s as na,a as ut,b as Pt,d as Da,e as ol}from"../chunks/CCL4udNy.js";import{p as St,b as Ba}from"../chunks/iXw84bXb.js";import{b as La,r as cl}from"../chunks/Crg_p4nl.js";function vl(i,c,t=!1,v=!1,u=!1){var p=i,f="";w(()=>{var L=Us;if(f===(f=c()??"")){fa&&es();return}if(L.nodes_start!==null&&(Hs(L.nodes_start,L.nodes_end),L.nodes_start=L.nodes_end=null),f!==""){if(fa){ds.data;for(var h=es(),y=h;h!==null&&(h.nodeType!==Ns||h.data!=="");)y=h,h=Os(h);if(h===null)throw Gs(),qs;vs(ds,y),p=zs(h);return}var Y=f+"";t?Y=`<svg>${Y}</svg>`:v&&(Y=`<math>${Y}</math>`);var F=Ps(Y);if((t||v)&&(F=Pa(F)),vs(Pa(F),F.lastChild),t||v)for(;Pa(F);)p.before(Pa(F));else p.before(F)}})}function dl(i,c,t,v,u){fa&&es();var p=c.$$slots?.[t],f=!1;p===!0&&(p=c[t],f=!0),p===void 0?u!==null&&u(i):p(i,f?()=>v:v)}function ul(i,c,t,v){var u=i.__style;if(fa||u!==c){var p=tl(c);(!fa||p!==i.getAttribute("style"))&&(p==null?i.removeAttribute("style"):i.style.cssText=p),i.__style=c}return v}function Na(i,c,t=!1){if(i.multiple){if(c==null)return;if(!Ss(c))return Ws();for(var v of i.options)v.selected=c.includes(ja(v));return}for(v of i.options){var u=ja(v);if(Cs(u,c)){v.selected=!0;return}}(!t||c!==void 0)&&(i.selectedIndex=-1)}function ss(i){var c=new MutationObserver(()=>{Na(i,i.__value)});c.observe(i,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),ns(()=>{c.disconnect()})}function Ra(i,c,t=c){var v=new WeakSet,u=!0;Oa(i,"change",p=>{var f=p?"[selected]":":checked",L;if(i.multiple)L=[].map.call(i.querySelectorAll(f),ja);else{var h=i.querySelector(f)??i.querySelector("option:not([disabled])");L=h&&ja(h)}t(L),ba!==null&&v.add(ba)}),Ds(()=>{var p=c();if(i===document.activeElement){var f=Ls??ba;if(v.has(f))return}if(Na(i,p,u),u&&p===void 0){var L=i.querySelector(":checked");L!==null&&(p=ja(L),t(p))}i.__value=p,u=!1}),ss(i)}function ja(i){return"__value"in i?i.__value:i.value}const fl=Symbol("is custom element"),pl=Symbol("is html");function je(i){if(fa){var c=!1,t=()=>{if(!c){if(c=!0,i.hasAttribute("value")){var v=i.value;nt(i,"value",null),i.value=v}if(i.hasAttribute("checked")){var u=i.checked;nt(i,"checked",null),i.checked=u}}};i.__on_r=t,ts(t),Ys()}}function Aa(i,c){var t=os(i);t.value===(t.value=c??void 0)||i.value===c&&(c!==0||i.nodeName!=="PROGRESS")||(i.value=c??"")}function As(i,c){var t=os(i);t.checked!==(t.checked=c??void 0)&&(i.checked=c)}function nt(i,c,t,v){var u=os(i);fa&&(u[c]=i.getAttribute(c),c==="src"||c==="srcset"||c==="href"&&i.nodeName==="LINK")||u[c]!==(u[c]=t)&&(c==="loading"&&(i[Ks]=t),t==null?i.removeAttribute(c):typeof t!="string"&&ml(i).includes(c)?i[c]=t:i.setAttribute(c,t))}function os(i){return i.__attributes??={[fl]:i.nodeName.includes("-"),[pl]:i.namespaceURI===Vs}}var ms=new Map;function ml(i){var c=i.getAttribute("is")||i.nodeName,t=ms.get(c);if(t)return t;ms.set(c,t=[]);for(var v,u=i,p=Element.prototype;p!==u;){v=Qs(u);for(var f in v)v[f].set&&t.push(f);u=Js(u)}return t}function Oe(i,c,t=c){var v=new WeakSet;Oa(i,"input",async u=>{var p=u?i.defaultValue:i.value;if(p=Va(i)?Ja(p):p,t(p),ba!==null&&v.add(ba),await Xs(),p!==(p=c())){var f=i.selectionStart,L=i.selectionEnd,h=i.value.length;if(i.value=p??"",L!==null){var y=i.value.length;f===L&&L===h&&y>h?(i.selectionStart=y,i.selectionEnd=y):(i.selectionStart=f,i.selectionEnd=Math.min(L,y))}}}),(fa&&i.defaultValue!==i.value||n(c)==null&&i.value)&&(t(Va(i)?Ja(i.value):i.value),ba!==null&&v.add(ba)),rs(()=>{var u=c();if(i===document.activeElement){var p=Ls??ba;if(v.has(p))return}Va(i)&&u===Ja(i.value)||i.type==="date"&&!u&&!i.value||u!==i.value&&(i.value=u??"")})}const Ka=new Set;function gs(i,c,t,v,u=v){var p=t.getAttribute("type")==="checkbox",f=i;let L=!1;if(c!==null)for(var h of c)f=f[h]??=[];f.push(t),Oa(t,"change",()=>{var y=t.__value;p&&(y=bs(f,y,t.checked)),u(y)},()=>u(p?[]:null)),rs(()=>{var y=v();if(fa&&t.defaultChecked!==t.checked){L=!0;return}p?(y=y||[],t.checked=y.includes(t.__value)):t.checked=Cs(t.__value,y)}),ns(()=>{var y=f.indexOf(t);y!==-1&&f.splice(y,1)}),Ka.has(f)||(Ka.add(f),ts(()=>{f.sort((y,Y)=>y.compareDocumentPosition(Y)===4?-1:1),Ka.delete(f)})),ts(()=>{if(L){var y;if(p)y=bs(f,y,t.checked);else{var Y=f.find(F=>F.checked);y=Y?.__value}u(y)}})}function $a(i,c,t=c){Oa(i,"change",v=>{var u=v?i.defaultChecked:i.checked;t(u)}),(fa&&i.defaultChecked!==i.checked||n(c)==null)&&t(i.checked),rs(()=>{var v=c();i.checked=!!v})}function bs(i,c,t){for(var v=new Set,u=0;u<i.length;u+=1)i[u].checked&&v.add(i[u].__value);return t||v.delete(c),Array.from(v)}function Va(i){var c=i.type;return c==="number"||c==="range"}function Ja(i){return i===""?null:+i}function gl(i,c,t){var v=Zs(i,c);v&&v.set&&(i[c]=t,ns(()=>{i[c]=null}))}function cs(i){return function(...c){var t=c[0];return t.stopPropagation(),i?.apply(this,c)}}function ka(i,c){var t=i.$$events?.[c.type],v=Ss(t)?t.slice():t==null?[]:[t];for(var u of v)u.call(this,c)}const bl="";function Bs(...i){return La+bl+cl(i[0],i[1])}const ls={paladin:{name:"Paladin",hitDice:"d10",spellcaster:!0,spellcastingAbility:"charisma",spellSlotsByLevel:{1:0,2:2,3:3,4:3,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Divine Sense",type:"uses",maxUses:(i,c=1)=>1+Math.max(1,c),resetOn:"long",description:"Detect celestials, fiends, and undead within 60 feet",minLevel:1},{name:"Lay on Hands",type:"pool",maxPool:i=>i*5,resetOn:"long",description:"Heal wounds or cure disease",minLevel:1},{name:"Divine Smite",type:"spellSlot",description:"Expend spell slot to deal extra radiant damage",minLevel:2,rollable:!0},{name:"Channel Divinity",type:"pool",maxPool:i=>i>=18?3:i>=6?2:1,resetOn:"short",description:"Sacred Weapon or Turn Undead",minLevel:3}]},fighter:{name:"Fighter",hitDice:"d10",spellcaster:!1,features:[{name:"Second Wind",type:"uses",maxUses:1,resetOn:"short",description:"Regain 1d10 + fighter level HP as bonus action",minLevel:1,rollable:!0,rollFormula:i=>`1d10+${i}`},{name:"Action Surge",type:"uses",maxUses:i=>i>=17?2:1,resetOn:"short",description:"Take one additional action on your turn",minLevel:2},{name:"Indomitable",type:"uses",maxUses:i=>i>=17?3:i>=13?2:1,resetOn:"long",description:"Reroll a failed saving throw",minLevel:9}],subclasses:{champion:{name:"Champion",features:[{name:"Improved Critical",type:"info",description:"Critical hit on 19-20",minLevel:3},{name:"Remarkable Athlete",type:"info",description:"Add half proficiency to STR/DEX/CON checks, increase long jump distance",minLevel:7},{name:"Additional Fighting Style",type:"info",description:"Choose a second fighting style",minLevel:10},{name:"Superior Critical",type:"info",description:"Critical hit on 18-20",minLevel:15},{name:"Survivor",type:"info",description:"Regain 5 + CON mod HP at start of turn if below half HP",minLevel:18}]},battlemaster:{name:"Battle Master",features:[{name:"Combat Superiority",type:"uses",maxUses:i=>i>=15?6:i>=7?5:4,resetOn:"short",description:i=>`Use superiority dice (${i>=18?"d12":i>=10?"d10":"d8"}) for maneuvers`,minLevel:3},{name:"Know Your Enemy",type:"info",description:"Learn capabilities of creatures you observe",minLevel:7},{name:"Improved Combat Superiority",type:"info",description:"Superiority dice become d10",minLevel:10},{name:"Relentless",type:"info",description:"Regain 1 superiority die if you have none at start of turn",minLevel:15}]}}},rogue:{name:"Rogue",hitDice:"d8",spellcaster:!1,features:[{name:"Sneak Attack",type:"info",description:i=>`Deal ${Math.ceil(i/2)}d6 extra damage once per turn with advantage or ally nearby`,minLevel:1,rollable:!0,rollFormula:i=>`${Math.ceil(i/2)}d6`},{name:"Cunning Action",type:"info",description:"Dash, Disengage, or Hide as a bonus action",minLevel:2},{name:"Uncanny Dodge",type:"info",description:"Use reaction to halve damage from an attack",minLevel:5},{name:"Evasion",type:"info",description:"Take no damage on successful Dex save (half on fail)",minLevel:7}]},wizard:{name:"Wizard",hitDice:"d6",spellcaster:!0,spellcastingAbility:"intelligence",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Arcane Recovery",type:"uses",maxUses:1,resetOn:"long",description:i=>`Recover spell slots totaling up to ${Math.ceil(i/2)} levels during short rest`,minLevel:1},{name:"Spell Mastery",type:"info",description:"Cast one 1st-level and one 2nd-level spell at will",minLevel:18}]},cleric:{name:"Cleric",hitDice:"d8",spellcaster:!0,spellcastingAbility:"wisdom",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Channel Divinity",type:"pool",maxPool:i=>i>=18?3:i>=6?2:1,resetOn:"short",description:"Turn Undead or domain-specific ability",minLevel:2},{name:"Destroy Undead",type:"info",description:i=>`Channel Divinity destroys undead of CR ${i>=17?4:i>=14?3:i>=11?2:i>=8?1:.5} or lower`,minLevel:5},{name:"Divine Intervention",type:"uses",maxUses:1,resetOn:"long",description:i=>`${i}% chance to succeed, implore deity for aid`,minLevel:10}],subclasses:{war:{name:"War Domain",features:[{name:"War Priest",type:"uses",maxUses:(i,c=1)=>Math.max(1,c),resetOn:"long",description:"Make one weapon attack as a bonus action",minLevel:1},{name:"Guided Strike",type:"channelDivinity",description:"Use your Channel Divinity to gain +10 to an attack roll. Make this choice after you see the roll, but before the DM says whether the attack hits or misses.",minLevel:2,resetOn:"short"},{name:"War God's Blessing",type:"channelDivinity",description:"Use reaction to grant +10 to an ally's attack roll within 30 feet. Consumes one use of Channel Divinity.",minLevel:6,resetOn:"short"},{name:"Divine Strike",type:"info",description:i=>`Deal extra ${i>=14?"2d8":"1d8"} weapon damage once per turn`,minLevel:8,rollable:!0,rollFormula:i=>i>=14?"2d8":"1d8"},{name:"Avatar of Battle",type:"info",description:"Gain resistance to nonmagical weapon damage",minLevel:17}]},life:{name:"Life Domain",features:[{name:"Disciple of Life",type:"info",description:"Healing spells restore additional 2 + spell level HP",minLevel:1},{name:"Preserve Life",type:"pool",maxPool:i=>i*5,resetOn:"short",description:"Restore HP to creatures within 30 feet",minLevel:2},{name:"Blessed Healer",type:"info",description:"Regain 2 + spell level HP when you cast healing spell",minLevel:6},{name:"Divine Strike",type:"info",description:i=>`Deal extra ${i>=14?"2d8":"1d8"} radiant damage once per turn`,minLevel:8,rollable:!0,rollFormula:i=>i>=14?"2d8":"1d8"},{name:"Supreme Healing",type:"info",description:"Maximize healing dice instead of rolling",minLevel:17}]}}},barbarian:{name:"Barbarian",hitDice:"d12",spellcaster:!1,features:[{name:"Rage",type:"uses",maxUses:i=>i>=20?1/0:i>=17?6:i>=12?5:i>=6?4:i>=3?3:2,resetOn:"long",description:i=>`+${i>=16?4:i>=9?3:2} damage, resistance to physical damage`,minLevel:1},{name:"Reckless Attack",type:"info",description:"Gain advantage on melee attacks, enemies get advantage on you",minLevel:2},{name:"Danger Sense",type:"info",description:"Advantage on Dex saves against effects you can see",minLevel:2}],subclasses:{berserker:{name:"Path of the Berserker",features:[{name:"Frenzy",type:"info",description:"While raging, make melee attack as bonus action (gain 1 exhaustion after rage)",minLevel:3},{name:"Mindless Rage",type:"info",description:"Cannot be charmed or frightened while raging",minLevel:6},{name:"Intimidating Presence",type:"info",description:"Use action to frighten creature within 30 feet",minLevel:10},{name:"Retaliation",type:"info",description:"When damaged by creature within 5 feet, make melee attack as reaction",minLevel:14}]}}}};function ia(i){const c=i.toLowerCase();return ls[c]||null}function wa(i,c,t){const v=ia(i);if(!v)return[];const u=v.features.filter(p=>!p.minLevel||p.minLevel<=c);if(t&&v.subclasses&&v.subclasses[t]){const p=v.subclasses[t].features.filter(f=>!f.minLevel||f.minLevel<=c);return[...u,...p]}return u}function hs(i){const c=ia(i);return!c||!c.subclasses?[]:Object.keys(c.subclasses).map(t=>({id:t,name:c.subclasses[t].name}))}function _s(i,c){const t=ia(i);return!t||!t.spellcaster||!t.spellSlotsByLevel?0:t.spellSlotsByLevel[c]||0}function ys(i,c,t){const v=ia(i);return!v||!v.spellcaster?0:Math.max(1,t+c)}function hl(i,c,t){const v=ia(i);return!v||!v.spellcaster?null:8+c+t}function _l(){return Object.keys(ls).map(i=>({id:i,name:ls[i].name}))}var yl=d('<div class="section-header svelte-ls99y2" role="button" tabindex="0"><h2 class="svelte-ls99y2"> </h2> <span class="collapse-btn svelte-ls99y2"> </span></div>');function _a(i,c){zt(c,!1);let t=St(c,"title",8),v=St(c,"collapsed",8),u=St(c,"ariaLabel",8,""),p=St(c,"onToggle",8);qt();var f=yl(),L=l(f),h=l(L,!0);s(L);var y=a(L,2),Y=l(y,!0);s(y),s(f),w(()=>{nt(f,"aria-expanded",!v()),nt(f,"aria-label",u()),k(h,t()),k(Y,v()?"‚ñº":"‚ñ≤")}),A("click",f,function(...F){p()?.apply(this,F)}),A("keydown",f,F=>{(F.key==="Enter"||F.key===" ")&&p()()}),o(i,f),Wt()}var xl=d("<option> </option>"),$l=d("<option> </option>"),kl=d('<div class="form-group svelte-172i2fj"><label for="characterSubclass" class="svelte-172i2fj">Subclass</label> <select id="characterSubclass" class="svelte-172i2fj"><option>Select Subclass</option><!></select></div>'),wl=d('<div class="info-grid svelte-172i2fj"><div class="form-group svelte-172i2fj"><label for="characterName" class="svelte-172i2fj">Character Name</label> <input type="text" id="characterName" placeholder="Enter name" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterClass" class="svelte-172i2fj">Class</label> <select id="characterClass" class="svelte-172i2fj"><option>Select Class</option><!></select></div> <!> <div class="form-group svelte-172i2fj"><label for="characterLevel" class="svelte-172i2fj">Level</label> <input type="number" id="characterLevel" min="1" max="20" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterRace" class="svelte-172i2fj">Race</label> <input type="text" id="characterRace" placeholder="e.g., Human" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterBackground" class="svelte-172i2fj">Background</label> <input type="text" id="characterBackground" placeholder="e.g., Soldier" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterAlignment" class="svelte-172i2fj">Alignment</label> <input type="text" id="characterAlignment" placeholder="e.g., Lawful Good" class="svelte-172i2fj"/></div></div>'),Sl=d('<section class="character-info svelte-172i2fj"><!> <!></section>');function Cl(i,c){zt(c,!1);const t=()=>ut(me,"$character",u),v=()=>ut(Qt,"$collapsedStates",u),[u,p]=na(),f=C(),L=_l();function h(ne){const R=ne.target;me.update(P=>(P.class=R.value,P.subclass="",P))}function y(ne){const R=ne.target;me.update(P=>(P.subclass=R.value,P))}function Y(ne){const R=ne.target;me.update(P=>(P.level=parseInt(R.value)||1,P)),js()}tt(()=>(t(),hs),()=>{r(f,t().class?hs(t().class):[])}),va(),qt();var F=Sl(),re=l(F);{let ne=yt(()=>(v(),n(()=>v().characterInfo?"Expand":"Collapse")));_a(re,{title:"Character Info",get collapsed(){return v(),n(()=>v().characterInfo)},get ariaLabel(){return e(ne)},onToggle:()=>Qt.update(R=>({...R,characterInfo:!R.characterInfo}))})}var X=a(re,2);{var le=ne=>{var R=wl(),P=l(R),pe=a(l(P),2);je(pe),s(P);var Ee=a(P,2),Be=a(l(Ee),2),Q=l(Be);Q.value=Q.__value="";var Re=a(Q);xt(Re,1,()=>L,Ct,(Ce,de)=>{var fe=xl(),Ae=l(fe,!0);s(fe);var Je={};w(()=>{k(Ae,(e(de),n(()=>e(de).name))),Je!==(Je=(e(de),n(()=>e(de).id)))&&(fe.value=(fe.__value=(e(de),n(()=>e(de).id)))??"")}),o(Ce,fe)}),s(Be);var be;ss(Be),s(Ee);var ye=a(Ee,2);{var Te=Ce=>{var de=kl(),fe=a(l(de),2),Ae=l(fe);Ae.value=Ae.__value="";var Je=a(Ae);xt(Je,1,()=>e(f),Ct,(ht,dt)=>{var Qe=$l(),$=l(Qe,!0);s(Qe);var N={};w(()=>{k($,(e(dt),n(()=>e(dt).name))),N!==(N=(e(dt),n(()=>e(dt).id)))&&(Qe.value=(Qe.__value=(e(dt),n(()=>e(dt).id)))??"")}),o(ht,Qe)}),s(fe);var ot;ss(fe),s(de),w(()=>{ot!==(ot=(t(),n(()=>t().subclass)))&&(fe.value=(fe.__value=(t(),n(()=>t().subclass)))??"",Na(fe,(t(),n(()=>t().subclass))))}),A("change",fe,y),o(Ce,de)};b(ye,Ce=>{e(f),n(()=>e(f).length>0)&&Ce(Te)})}var M=a(ye,2),E=a(l(M),2);je(E),s(M);var x=a(M,2),W=a(l(x),2);je(W),s(x);var g=a(x,2),T=a(l(g),2);je(T),s(g);var I=a(g,2),Me=a(l(I),2);je(Me),s(I),s(R),w(()=>{be!==(be=(t(),n(()=>t().class)))&&(Be.value=(Be.__value=(t(),n(()=>t().class)))??"",Na(Be,(t(),n(()=>t().class)))),Aa(E,(t(),n(()=>t().level)))}),Oe(pe,()=>t().name,Ce=>Pt(me,n(t).name=Ce,n(t))),A("change",Be,h),A("change",E,Y),Oe(W,()=>t().race,Ce=>Pt(me,n(t).race=Ce,n(t))),Oe(T,()=>t().background,Ce=>Pt(me,n(t).background=Ce,n(t))),Oe(Me,()=>t().alignment,Ce=>Pt(me,n(t).alignment=Ce,n(t))),o(ne,R)};b(X,ne=>{v(),n(()=>!v().characterInfo)&&ne(le)})}s(F),o(i,F),Wt(),p()}var Dl=d('<div class="ability-card svelte-bbv1xt"><h3 class="svelte-bbv1xt"> </h3> <input type="number" class="ability-score svelte-bbv1xt" min="1" max="30"/> <div class="ability-modifier svelte-bbv1xt"> </div> <div class="roll-buttons svelte-bbv1xt"><button class="roll-btn svelte-bbv1xt">Check</button> <button class="roll-btn svelte-bbv1xt">Save</button></div> <div class="save-proficiency svelte-bbv1xt"><input type="checkbox" class="svelte-bbv1xt"/> <label class="svelte-bbv1xt">Save Prof.</label></div></div>'),Ll=d('<div class="proficiency-bonus svelte-bbv1xt"><label for="profBonus">Proficiency Bonus</label> <input type="number" id="profBonus" class="prof-input svelte-bbv1xt"/></div> <div class="abilities-grid svelte-bbv1xt"></div>',1),jl=d("<section><!> <!></section>");function Al(i,c){zt(c,!1);const t=()=>ut(Ga,"$abilityModifiers",L),v=()=>ut(me,"$character",L),u=()=>ut(ga,"$searchFilter",L),p=()=>ut(Qt,"$collapsedStates",L),f=()=>ut(ma,"$isEditMode",L),[L,h]=na(),y=C(),Y=C(),F=ha(),re=[{key:"strength",label:"Strength"},{key:"dexterity",label:"Dexterity"},{key:"constitution",label:"Constitution"},{key:"intelligence",label:"Intelligence"},{key:"wisdom",label:"Wisdom"},{key:"charisma",label:"Charisma"}];function X(){js()}function le(Q){const Re=t()[Q],be=`1d20${Re>=0?"+":""}${Re}`,ye=[];ye.push({value:"1d20",source:"base die"}),Re!==0&&ye.push({value:Re,source:Q}),F("roll",{notation:be,rollType:"check",bonusBreakdown:ye})}function ne(Q){const Re=t()[Q],be=v().saveProficiencies[Q]?v().proficiencyBonus:0,ye=Re+be,Te=`1d20${ye>=0?"+":""}${ye}`,M=[];M.push({value:"1d20",source:"base die"}),Re!==0&&M.push({value:Re,source:Q}),be!==0&&M.push({value:be,source:"proficiency"}),F("roll",{notation:Te,rollType:"save",bonusBreakdown:M})}tt(()=>u(),()=>{r(y,re.filter(({label:Q})=>u()?Q.toLowerCase().includes(u().toLowerCase()):!0))}),tt(()=>(e(y),u()),()=>{r(Y,e(y).length>0||!u()||u().toLowerCase().includes("proficiency"))}),va(),qt();var R=jl();let P;var pe=l(R);_a(pe,{title:"Ability Scores",get collapsed(){return p(),n(()=>p().abilityScores)},ariaLabel:"Toggle Ability Scores Section",onToggle:()=>Qt.update(Q=>({...Q,abilityScores:!Q.abilityScores}))});var Ee=a(pe,2);{var Be=Q=>{var Re=Ll(),be=Le(Re),ye=a(l(be),2);je(ye),s(be);var Te=a(be,2);xt(Te,5,()=>e(y),Ct,(M,E)=>{let x=()=>e(E).key,W=()=>e(E).label;var g=Dl(),T=l(g),I=l(T,!0);s(T);var Me=a(T,2);je(Me);var Ce=a(Me,2),de=l(Ce);s(Ce);var fe=a(Ce,2),Ae=l(fe),Je=a(Ae,2);s(fe);var ot=a(fe,2),ht=l(ot);je(ht);var dt=a(ht,2);s(ot),s(g),w(Qe=>{k(I,Qe),k(de,`${t(),x(),n(()=>t()[x()]>=0?"+":"")??""}${t(),x(),n(()=>t()[x()])??""}`),ht.disabled=!f(),nt(ht,"id",`${x()}-save`),nt(dt,"for",`${x()}-save`)},[()=>(W(),n(()=>W().substring(0,3).toUpperCase()))]),Oe(Me,()=>v().abilities[x()],Qe=>Pt(me,n(v).abilities[x()]=Qe,n(v))),A("change",Me,X),A("click",Ae,()=>le(x())),A("click",Je,()=>ne(x())),$a(ht,()=>v().saveProficiencies[x()],Qe=>Pt(me,n(v).saveProficiencies[x()]=Qe,n(v))),o(M,g)}),s(Te),Oe(ye,()=>v().proficiencyBonus,M=>Pt(me,n(v).proficiencyBonus=M,n(v))),o(Q,Re)};b(Ee,Q=>{p(),n(()=>!p().abilityScores)&&Q(Be)})}s(R),w(()=>P=At(R,1,"ability-scores svelte-bbv1xt",null,P,{hidden:!e(Y)})),o(i,R),Wt(),h()}const Rs=[{name:"Unarmored",type:"none",baseAC:10},{name:"Padded",type:"light",baseAC:11},{name:"Leather",type:"light",baseAC:11},{name:"Studded Leather",type:"light",baseAC:12},{name:"Hide",type:"medium",baseAC:12,maxDexBonus:2},{name:"Chain Shirt",type:"medium",baseAC:13,maxDexBonus:2},{name:"Scale Mail",type:"medium",baseAC:14,maxDexBonus:2},{name:"Breastplate",type:"medium",baseAC:14,maxDexBonus:2},{name:"Half Plate",type:"medium",baseAC:15,maxDexBonus:2},{name:"Ring Mail",type:"heavy",baseAC:14,maxDexBonus:0},{name:"Chain Mail",type:"heavy",baseAC:16,maxDexBonus:0},{name:"Splint",type:"heavy",baseAC:17,maxDexBonus:0},{name:"Plate",type:"heavy",baseAC:18,maxDexBonus:0}];function Ts(i){return Rs.find(c=>c.name===i)}function Bl(i,c,t){if(!i)return 10+c+(t?2:0);const v=Ts(i);if(!v)return 10+c+(t?2:0);let u=v.baseAC;return v.maxDexBonus===void 0?u+=c:v.maxDexBonus>0&&(u+=Math.min(c,v.maxDexBonus)),t&&(u+=2),u}function Ta(i){return Math.floor((i-10)/2)}function is(i,c){if(!i.class)return null;const t=ia(i.class);if(!t||!t.spellcaster||!t.spellcastingAbility)return null;const v=Ta(c[t.spellcastingAbility]);return 8+i.proficiencyBonus+v}function Ya(i,c){if(!i.class)return 0;const t=ia(i.class);return!t||!t.spellcaster||!t.spellcastingAbility?0:Ta(c[t.spellcastingAbility])}function Rl(i,c){const t=[],v=Ta(c.dexterity),u=i.armorName?Ts(i.armorName):void 0;if(u){if(u.type==="none")t.push("Unarmored"),t.push("Base: 10"),t.push(`Dexterity: ${v>=0?"+":""}${v}`);else if(u.type==="light")t.push(`${u.name}: ${u.baseAC}`),t.push(`Dexterity: ${v>=0?"+":""}${v}`);else if(u.type==="medium"){const p=Math.min(2,v);t.push(`${u.name}: ${u.baseAC}`),t.push(`Dexterity: ${p>=0?"+":""}${p} (max +2)`)}else u.type==="heavy"&&(t.push(`${u.name}: ${u.baseAC}`),t.push("Dexterity: +0 (heavy armor)"));i.shieldEquipped&&t.push("Shield: +2")}else{t.push("Base: 10"),v!==0&&t.push(`Dexterity: ${v>=0?"+":""}${v}`);const p=10+v,f=i.armorClass-p;f!==0&&t.push(`Other: ${f>=0?"+":""}${f}`)}return i.activeStates&&i.activeStates.length>0&&i.activeStates.forEach(p=>{typeof p.acBonus=="number"&&p.acBonus!==0&&(!p.target||p.target==="self")&&t.push(`${p.name}: ${p.acBonus>=0?"+":""}${p.acBonus}`)}),t.join(`
`)}function Tl(i,c){const t=[],v=Ta(c.dexterity);t.push(`Dexterity: ${v>=0?"+":""}${v}`);const u=i.initiative-v;return u!==0&&t.push(`Other Bonuses: ${u>=0?"+":""}${u}`),t.join(`
`)}function Ml(i,c){if(!i.class)return"";const t=ia(i.class);if(!t||!t.spellcaster||!t.spellcastingAbility)return"";const v=[],u=Ta(c[t.spellcastingAbility]),p=t.spellcastingAbility.charAt(0).toUpperCase()+t.spellcastingAbility.slice(1);return v.push("Base: 8"),v.push(`Proficiency: +${i.proficiencyBonus}`),v.push(`${p}: ${u>=0?"+":""}${u}`),v.join(`
`)}function Fl(i,c,t){const v=[];let u=i;const p=c.toLowerCase().trim();if(t.activeStates){for(const f of t.activeStates)if(f.immunities&&f.immunities.length>0&&f.immunities.some(h=>h.toLowerCase().trim()===p))return v.push(`Immune to ${c} (${f.name})`),{finalDamage:0,adjustments:v}}if(t.activeStates){for(const f of t.activeStates)if(f.resistances&&f.resistances.length>0&&f.resistances.some(h=>h.toLowerCase().trim()===p)){const h=Math.floor(u/2);v.push(`Resistant to ${c} (${f.name}): ${u} ‚Üí ${h}`),u=h;break}}return v.length===0&&v.push(`No adjustments for ${c}`),{finalDamage:u,adjustments:v}}function Pl(i,c){const t={...i};if(t.tempHP>0){if(c<=t.tempHP)return t.tempHP-=c,t;c-=t.tempHP,t.tempHP=0}return t.currentHP=Math.max(0,t.currentHP-c),t}var Il=d('<button class="info-icon svelte-1o8ci7b" type="button">‚ÑπÔ∏è</button>'),El=d('<button class="info-icon svelte-1o8ci7b" type="button">‚ÑπÔ∏è</button>'),Ul=d("<div><!></div>"),Hl=d('<div class="tooltip-wrapper svelte-1o8ci7b"><!> <!></div>');function Qa(i,c){zt(c,!1);let t=St(c,"tooltipContent",8),v=St(c,"ariaLabel",8,"Show information"),u=C(!1),p=C(),f=C(!1),L=C(null),h=C(!1),y=C(!1),Y=C("");const F=Math.random().toString(36).slice(2);function re(){window.dispatchEvent(new CustomEvent("tooltip-open",{detail:F}))}function X(M){M.detail!==F&&(r(u,!1),r(h,!1))}function le(){r(f,window.matchMedia("(pointer: coarse)").matches||"ontouchstart"in window)}function ne(){if(!e(L)||!e(p))return;const M=e(p).getBoundingClientRect(),E=e(L).getBoundingClientRect();let x=M.bottom+5,W=M.left;r(h,!1),W+E.width>window.innerWidth-8&&(W=M.right-E.width,r(h,!0),W<8&&(W=8)),W<8&&(W=8),x+E.height>window.innerHeight-8&&(x=M.top-E.height-5),r(Y,`position:fixed;top:${x}px;left:${W}px;z-index:1000;`),r(y,!0)}function R(){re(),r(u,!1),r(y,!1),requestAnimationFrame(()=>{r(u,!0),r(y,!1),setTimeout(ne,0)})}function P(){r(u,!1),r(h,!1)}function pe(M){M.stopPropagation(),e(u)?(r(u,!1),r(h,!1),r(y,!1)):(re(),r(u,!1),r(y,!1),requestAnimationFrame(()=>{r(u,!0),r(y,!1),setTimeout(ne,0)}))}function Ee(M){e(p)&&!e(p).contains(M.target)&&(r(u,!1),r(h,!1))}Sa(()=>{le(),document.addEventListener("click",Ee),window.addEventListener("tooltip-open",X)}),Is(()=>{document.removeEventListener("click",Ee),window.removeEventListener("tooltip-open",X)}),qt();var Be=Hl(),Q=l(Be);{var Re=M=>{var E=Il();w(()=>nt(E,"aria-label",v())),A("click",E,pe),o(M,E)},be=M=>{var E=El();w(()=>nt(E,"aria-label",v())),A("mouseenter",E,R),A("mouseleave",E,P),o(M,E)};b(Q,M=>{e(f)?M(Re):M(be,!1)})}var ye=a(Q,2);{var Te=M=>{var E=Ul(),x=l(E);dl(x,c,"content",{},W=>{var g=gt(),T=Le(g);vl(T,t),o(W,g)}),s(E),Ba(E,W=>r(L,W),()=>e(L)),w(()=>{At(E,1,`tooltip-popup ${e(h)?"right-align":""}`,"svelte-1o8ci7b"),ul(E,e(y)?e(Y)+"opacity:1;pointer-events:auto;":"opacity:0;pointer-events:none;position:fixed;top:0;left:0;z-index:1000;")}),o(M,E)};b(ye,M=>{e(u)&&M(Te)})}s(Be),Ba(Be,M=>r(p,M),()=>e(p)),o(i,Be),Wt()}var Nl=d("<option> </option>"),Ol=d('<div class="armor-config svelte-1r5hyyb"><h4 class="svelte-1r5hyyb">Armor Configuration</h4> <div class="armor-controls svelte-1r5hyyb"><div class="armor-field svelte-1r5hyyb"><label for="armorName" class="svelte-1r5hyyb">Armor</label> <select id="armorName" class="armor-select svelte-1r5hyyb"><option>None (Unarmored)</option><!></select></div> <div class="armor-field svelte-1r5hyyb"><label class="shield-label svelte-1r5hyyb"><input type="checkbox" class="shield-checkbox svelte-1r5hyyb"/> Shield Equipped (+2 AC)</label></div></div></div>'),Gl=d('<div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="spellSaveDC" class="svelte-1r5hyyb">Spell Save DC</label> <!></div> <input type="number" id="spellSaveDC" class="stat-input svelte-1r5hyyb" readonly=""/></div>'),ql=d('<span class="hit-dice-type"> </span>'),zl=d('<!> <div class="stats-grid svelte-1r5hyyb"><div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="armorClass" class="svelte-1r5hyyb">Armor Class</label> <!></div> <input type="text" id="armorClass" readonly=""/></div> <div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="initiative" class="svelte-1r5hyyb">Initiative</label> <!></div> <input type="text" id="initiative" class="stat-input svelte-1r5hyyb" readonly=""/></div> <div class="stat-box svelte-1r5hyyb"><label for="speed" class="svelte-1r5hyyb">Speed</label> <input type="text" id="speed" class="stat-input svelte-1r5hyyb"/></div> <!></div> <div class="hp-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Points</h3> <div><div class="hp-inputs svelte-1r5hyyb"><input type="number" class="hp-current svelte-1r5hyyb" min="0"/> <span class="hp-separator svelte-1r5hyyb">/</span> <input type="number" class="hp-max svelte-1r5hyyb" min="0"/></div> <div class="hp-controls svelte-1r5hyyb"><button class="hp-btn svelte-1r5hyyb">‚àí</button> <button class="hp-btn svelte-1r5hyyb">+</button> <button class="hp-btn svelte-1r5hyyb">‚àí5</button> <button class="hp-btn svelte-1r5hyyb">+5</button></div></div> <div class="temp-hp svelte-1r5hyyb"><label for="tempHP" class="svelte-1r5hyyb">Temp HP</label> <input type="number" id="tempHP" min="0" class="svelte-1r5hyyb"/></div></div> <div class="hit-dice-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Dice</h3> <div class="hit-dice-display svelte-1r5hyyb"><input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <span>/</span> <input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <!></div> <div class="hit-dice-controls svelte-1r5hyyb"><label for="hitDiceCount" class="svelte-1r5hyyb">Roll</label> <div class="hit-dice-count-controls svelte-1r5hyyb"><button class="hit-dice-btn svelte-1r5hyyb">‚àí</button> <input type="number" id="hitDiceCount" class="hit-dice-count-input svelte-1r5hyyb" min="1"/> <button class="hit-dice-btn svelte-1r5hyyb">+</button></div> <button class="btn btn-primary roll-hit-dice use-enabled svelte-1r5hyyb">üé≤ Roll</button></div></div>',1),Wl=d("<section><!> <!></section>");function Kl(i,c){zt(c,!1);const t=()=>ut(me,"$character",L),v=()=>ut(Ga,"$abilityModifiers",L),u=()=>ut(ga,"$searchFilter",L),p=()=>ut(Qt,"$collapsedStates",L),f=()=>ut(ma,"$isEditMode",L),[L,h]=na(),y=C(),Y=C(),F=C(),re=C(),X=C(),le=C(),ne=C(),R=ha();let P=C(1);function pe(M){me.update(E=>(E.currentHP=Math.max(0,Math.min(E.maxHP,E.currentHP+M)),E))}function Ee(M){const E=e(P)+M,x=t().hitDice.current;r(P,Math.max(1,Math.min(x,E)))}function Be(M=1){if(t().hitDice.current<=0){alert("No hit dice remaining!");return}if(!t().class){alert("Please select a class first!");return}const E=ia(t().class);if(!E){alert("Invalid class configuration!");return}const x=Math.min(M,t().hitDice.current),W=E.hitDice,g=v().constitution,T=g*x,I=T>=0?`+${T}`:`${T}`,Me=`${x}${W}${I}`,Ce=[];if(Ce.push({value:`${x}${W}`,source:"hit dice"}),g!==0)for(let de=0;de<x;de++)Ce.push({value:g,source:"constitution"});R("rollHitDice",{notation:Me,hitDie:W,count:x,bonusBreakdown:Ce})}tt(()=>(t(),v(),me),()=>{if(t().armorName!==void 0||t().shieldEquipped!==void 0){const M=v().dexterity,E=Bl(t().armorName,M,t().shieldEquipped||!1);t().armorClass!==E&&me.update(x=>({...x,armorClass:E}))}}),tt(()=>(v(),t(),me),()=>{const M=v().dexterity;t().initiative!==M&&me.update(E=>({...E,initiative:M}))}),tt(()=>t(),()=>{r(y,is(t(),t().abilities))}),tt(()=>t(),()=>{r(Y,Rl(t(),t().abilities))}),tt(()=>t(),()=>{r(F,Tl(t(),t().abilities))}),tt(()=>t(),()=>{r(re,Ml(t(),t().abilities))}),tt(()=>(t(),e(P)),()=>{const M=t().hitDice.current;M>0&&e(P)>M&&r(P,M)}),tt(()=>t(),()=>{r(X,t().activeStates&&t().activeStates.length>0?t().activeStates.reduce((M,E)=>M+(E.acBonus||0),0):0)}),tt(()=>t(),()=>{r(le,t().activeStates&&t().activeStates.length>0?t().activeStates.some(M=>M.name==="Aid"&&M.target==="self"):!1)}),tt(()=>u(),()=>{r(ne,!u()||"armor class".includes(u().toLowerCase())||"initiative".includes(u().toLowerCase())||"speed".includes(u().toLowerCase())||"hit points".includes(u().toLowerCase())||"hp".includes(u().toLowerCase())||"hit dice".includes(u().toLowerCase())||"spell save".includes(u().toLowerCase())||"combat".includes(u().toLowerCase()))}),va(),qt();var Q=Wl();let Re;var be=l(Q);{let M=yt(()=>(p(),n(()=>p().combatStats?"Expand":"Collapse")));_a(be,{title:"Combat Stats",get collapsed(){return p(),n(()=>p().combatStats)},get ariaLabel(){return e(M)},onToggle:()=>Qt.update(E=>({...E,combatStats:!E.combatStats}))})}var ye=a(be,2);{var Te=M=>{var E=zl(),x=Le(E);{var W=ce=>{var Ie=Ol(),_e=a(l(Ie),2),Ye=l(_e),Ge=a(l(Ye),2);w(()=>{t(),Ut(()=>{})});var rt=l(Ge);rt.value=(rt.__value=void 0)??"";var ct=a(rt);xt(ct,1,()=>Rs,Ct,(V,K)=>{var ke=gt(),qe=Le(ke);{var st=ze=>{var Ke=Nl(),ue=l(Ke);s(Ke);var q={};w(()=>{k(ue,`${e(K),n(()=>e(K).name)??""} (AC ${e(K),n(()=>e(K).baseAC)??""})`),q!==(q=(e(K),n(()=>e(K).name)))&&(Ke.value=(Ke.__value=(e(K),n(()=>e(K).name)))??"")}),o(ze,Ke)};b(qe,ze=>{e(K),n(()=>e(K).name!=="Unarmored")&&ze(st)})}o(V,ke)}),s(Ge),s(Ye);var ve=a(Ye,2),D=l(ve),G=l(D);je(G),Yt(),s(D),s(ve),s(_e),s(Ie),Ra(Ge,()=>t().armorName,V=>Pt(me,n(t).armorName=V,n(t))),$a(G,()=>t().shieldEquipped,V=>Pt(me,n(t).shieldEquipped=V,n(t))),o(ce,Ie)};b(x,ce=>{f()&&ce(W)})}var g=a(x,2),T=l(g),I=l(T),Me=a(l(I),2);Qa(Me,{get tooltipContent(){return e(Y)},ariaLabel:"Show AC breakdown"}),s(I);var Ce=a(I,2);je(Ce),s(T);var de=a(T,2),fe=l(de),Ae=a(l(fe),2);Qa(Ae,{get tooltipContent(){return e(F)},ariaLabel:"Show Initiative breakdown"}),s(fe);var Je=a(fe,2);je(Je),s(de);var ot=a(de,2),ht=a(l(ot),2);je(ht),s(ot);var dt=a(ot,2);{var Qe=ce=>{var Ie=Gl(),_e=l(Ie),Ye=a(l(_e),2);Qa(Ye,{get tooltipContent(){return e(re)},ariaLabel:"Show Spell Save DC breakdown"}),s(_e);var Ge=a(_e,2);je(Ge),s(Ie),w(()=>Aa(Ge,e(y))),o(ce,Ie)};b(dt,ce=>{e(y)!==null&&ce(Qe)})}s(g);var $=a(g,2),N=a(l($),2);let ge;var xe=l(N),_=l(xe);je(_);var O=a(_,4);je(O),s(xe);var ie=a(xe,2),he=l(ie),ee=a(he,2),H=a(ee,2),U=a(H,2);s(ie),s(N);var Z=a(N,2),B=a(l(Z),2);je(B),s(Z),s($);var Fe=a($,2),De=a(l(Fe),2),Xe=l(De);je(Xe);var $e=a(Xe,4);je($e);var m=a($e,2);{var oe=ce=>{const Ie=yt(()=>(J(ia),t(),n(()=>ia(t().class))));var _e=gt(),Ye=Le(_e);{var Ge=rt=>{const ct=yt(()=>(v(),n(()=>v().constitution)));var ve=ql(),D=l(ve);s(ve),w(()=>k(D,`(${J(e(Ie)),n(()=>e(Ie).hitDice)??""}${(e(ct)>=0?`+${e(ct)}`:e(ct))??""})`)),o(rt,ve)};b(Ye,rt=>{e(Ie)&&rt(Ge)})}o(ce,_e)};b(m,ce=>{t(),n(()=>t().class)&&ce(oe)})}s(De);var te=a(De,2),z=a(l(te),2),Ne=l(z),Pe=a(Ne,2);je(Pe);var we=a(Pe,2);s(z);var Ue=a(z,2);s(te),s(Fe),w(()=>{Aa(Ce,(e(X),t(),n(()=>e(X)!==0?`${t().armorClass} ‚Üí ${t().armorClass+e(X)}`:`${t().armorClass}`))),At(Ce,1,al(e(X)!==0?"stat-input ac-enhanced":"stat-input"),"svelte-1r5hyyb"),Aa(Je,(t(),n(()=>t().initiative))),ge=At(N,1,"hp-display svelte-1r5hyyb",null,ge,{"aid-active":e(le)}),nt(_,"max",(t(),n(()=>t().maxHP))),nt(Xe,"max",(t(),n(()=>t().hitDice.max))),Ne.disabled=e(P)<=1,nt(Pe,"max",(t(),n(()=>t().hitDice.current))),we.disabled=(e(P),t(),n(()=>e(P)>=t().hitDice.current)),Ue.disabled=(t(),n(()=>t().hitDice.current<=0||!t().class))}),Oe(ht,()=>t().speed,ce=>Pt(me,n(t).speed=ce,n(t))),Oe(_,()=>t().currentHP,ce=>Pt(me,n(t).currentHP=ce,n(t))),Oe(O,()=>t().maxHP,ce=>Pt(me,n(t).maxHP=ce,n(t))),A("click",he,()=>pe(-1)),A("click",ee,()=>pe(1)),A("click",H,()=>pe(-5)),A("click",U,()=>pe(5)),Oe(B,()=>t().tempHP,ce=>Pt(me,n(t).tempHP=ce,n(t))),Oe(Xe,()=>t().hitDice.current,ce=>Pt(me,n(t).hitDice.current=ce,n(t))),Oe($e,()=>t().hitDice.max,ce=>Pt(me,n(t).hitDice.max=ce,n(t))),A("click",Ne,()=>Ee(-1)),Oe(Pe,()=>e(P),ce=>r(P,ce)),A("input",Pe,ce=>{const Ie=ce.target,_e=parseInt(Ie.value);_e>t().hitDice.current&&r(P,t().hitDice.current),_e<1&&r(P,1)}),A("click",we,()=>Ee(1)),A("click",Ue,()=>Be(e(P))),o(M,E)};b(ye,M=>{p(),n(()=>!p().combatStats)&&M(Te)})}s(Q),w(()=>Re=At(Q,1,"combat-stats svelte-1r5hyyb",null,Re,{hidden:!e(ne)})),o(i,Q),Wt(),h()}const Ia={acrobatics:"dexterity",animalHandling:"wisdom",arcana:"intelligence",athletics:"strength",deception:"charisma",history:"intelligence",insight:"wisdom",intimidation:"charisma",investigation:"intelligence",medicine:"wisdom",nature:"intelligence",perception:"wisdom",performance:"charisma",persuasion:"charisma",religion:"intelligence",sleightOfHand:"dexterity",stealth:"dexterity",survival:"wisdom"};var Vl=d('<div class="skill-row svelte-1f1pl16"><input type="checkbox" class="svelte-1f1pl16"/> <label class="svelte-1f1pl16"> <span class="ability-tag svelte-1f1pl16"> </span></label> <span class="skill-modifier svelte-1f1pl16"> </span> <button class="roll-btn svelte-1f1pl16">Roll</button></div>'),Jl=d('<div class="skills-grid svelte-1f1pl16"></div>'),Yl=d("<section><!> <!></section>");function Ql(i,c){zt(c,!1);const t=()=>ut(me,"$character",L),v=()=>ut(Ga,"$abilityModifiers",L),u=()=>ut(ga,"$searchFilter",L),p=()=>ut(Qt,"$collapsedStates",L),f=()=>ut(ma,"$isEditMode",L),[L,h]=na(),y=C(),Y=C(),F=C(),re=C(),X=C(),le=C(),ne=ha(),R=[{key:"acrobatics",label:"Acrobatics"},{key:"animalHandling",label:"Animal Handling"},{key:"arcana",label:"Arcana"},{key:"athletics",label:"Athletics"},{key:"deception",label:"Deception"},{key:"history",label:"History"},{key:"insight",label:"Insight"},{key:"intimidation",label:"Intimidation"},{key:"investigation",label:"Investigation"},{key:"medicine",label:"Medicine"},{key:"nature",label:"Nature"},{key:"perception",label:"Perception"},{key:"performance",label:"Performance"},{key:"persuasion",label:"Persuasion"},{key:"religion",label:"Religion"},{key:"sleightOfHand",label:"Sleight of Hand"},{key:"stealth",label:"Stealth"},{key:"survival",label:"Survival"}];function P(be){const ye=Ia[be],Te=v()[ye],M=t().skillProficiencies[be]?t().proficiencyBonus:0,E=e(y)[be],x=`1d20${E>=0?"+":""}${E}`,W=[];W.push({value:"1d20",source:"base die"}),Te!==0&&W.push({value:Te,source:ye}),M!==0&&W.push({value:M,source:"proficiency"}),ne("roll",{notation:x,rollType:"check",bonusBreakdown:W})}tt(()=>{},()=>{r(y,{})}),tt(()=>t(),()=>{r(Y,t().skillProficiencies)}),tt(()=>t(),()=>{r(F,t().proficiencyBonus)}),tt(()=>v(),()=>{r(re,v())}),tt(()=>(e(re),e(Y),e(F)),()=>{for(const{key:be}of R){const ye=Ia[be],Te=e(re)[ye],M=e(Y)[be]?e(F):0;pa(y,e(y)[be]=Te+M)}}),tt(()=>u(),()=>{r(X,R.filter(({label:be})=>u()?be.toLowerCase().includes(u().toLowerCase()):!0))}),tt(()=>e(X),()=>{r(le,e(X).length>0)}),va(),qt();var pe=Yl();let Ee;var Be=l(pe);{let be=yt(()=>(p(),n(()=>p().skills?"Expand":"Collapse")));_a(Be,{title:"Skills",get collapsed(){return p(),n(()=>p().skills)},get ariaLabel(){return e(be)},onToggle:()=>Qt.update(ye=>({...ye,skills:!ye.skills}))})}var Q=a(Be,2);{var Re=be=>{var ye=Jl();xt(ye,5,()=>e(X),Ct,(Te,M)=>{let E=()=>e(M).key,x=()=>e(M).label;var W=Vl(),g=l(W);je(g);var T=a(g,2),I=l(T),Me=a(I),Ce=l(Me);s(Me),s(T);var de=a(T,2),fe=l(de);s(de);var Ae=a(de,2);s(W),w(Je=>{As(g,(e(Y),E(),n(()=>e(Y)[E()]))),g.disabled=!f(),nt(g,"id",E()),nt(T,"for",E()),k(I,`${x()??""} `),k(Ce,`(${Je??""})`),k(fe,`${e(y),E(),n(()=>e(y)[E()]>=0?"+":"")??""}${e(y),E(),n(()=>e(y)[E()])??""}`)},[()=>(J(Ia),E(),n(()=>Ia[E()].substring(0,3).toUpperCase()))]),A("change",g,Je=>{console.log("Skill proficiency changed:",E(),Je.target.checked),me.update(ot=>({...ot,skillProficiencies:{...ot.skillProficiencies,[E()]:Je.target.checked}}))}),A("click",Ae,()=>P(E())),o(Te,W)}),s(ye),o(be,ye)};b(Q,be=>{p(),n(()=>!p().skills)&&be(Re)})}s(pe),w(()=>Ee=At(pe,1,"skills svelte-1f1pl16",null,Ee,{hidden:!e(le)})),o(i,pe),Wt(),h()}var Xl=d('<p class="empty-message svelte-1123ljy">No attacks or spells to reorder.</p>'),Zl=d('<li class="reorder-item svelte-1123ljy"><span class="attack-name svelte-1123ljy"> </span> <div class="reorder-buttons svelte-1123ljy"><button class="btn-move svelte-1123ljy" aria-label="Move up">‚ñ≤</button> <button class="btn-move svelte-1123ljy" aria-label="Move down">‚ñº</button></div></li>'),ei=d('<ul class="reorder-list svelte-1123ljy"></ul>'),ti=d('<div class="modal-backdrop svelte-1123ljy" role="presentation"><div class="modal-content svelte-1123ljy" role="dialog" aria-modal="true" aria-labelledby="modal-title"><div class="modal-header svelte-1123ljy"><h3 id="modal-title" class="svelte-1123ljy">Reorder Attacks & Spells</h3> <button class="btn-close svelte-1123ljy" aria-label="Close">√ó</button></div> <div class="modal-body svelte-1123ljy"><!></div> <div class="modal-footer svelte-1123ljy"><button class="btn btn-secondary svelte-1123ljy">Cancel</button> <button class="btn btn-primary svelte-1123ljy">Save Order</button></div></div></div>');function ai(i,c){zt(c,!1);let t=St(c,"show",8,!1),v=St(c,"attacks",24,()=>[]),u=St(c,"onSave",8),p=St(c,"onCancel",8),f=C([]);function L(R,P){const pe=e(f)[R];pa(f,e(f)[R]=e(f)[P]),pa(f,e(f)[P]=pe),r(f,[...e(f)])}function h(R){R>0&&L(R,R-1)}function y(R){R<e(f).length-1&&L(R,R+1)}function Y(){u()(e(f))}function F(){p()()}function re(R){R.target===R.currentTarget&&F()}tt(()=>(J(t()),J(v())),()=>{t()&&r(f,[...v()])}),va(),qt();var X=gt(),le=Le(X);{var ne=R=>{var P=ti(),pe=l(P),Ee=l(pe),Be=a(l(Ee),2);s(Ee);var Q=a(Ee,2),Re=l(Q);{var be=x=>{var W=Xl();o(x,W)},ye=x=>{var W=ei();xt(W,7,()=>e(f),g=>g.id,(g,T,I)=>{var Me=Zl(),Ce=l(Me),de=l(Ce,!0);s(Ce);var fe=a(Ce,2),Ae=l(fe),Je=a(Ae,2);s(fe),s(Me),w(()=>{k(de,(e(T),n(()=>e(T).name||"(Unnamed attack or spell)"))),Ae.disabled=e(I)===0,Je.disabled=(J(e(I)),e(f),n(()=>e(I)===e(f).length-1))}),A("click",Ae,()=>h(e(I))),A("click",Je,()=>y(e(I))),o(g,Me)}),s(W),o(x,W)};b(Re,x=>{e(f),n(()=>e(f).length===0)?x(be):x(ye,!1)})}s(Q);var Te=a(Q,2),M=l(Te),E=a(M,2);s(Te),s(pe),s(P),A("click",Be,F),A("click",M,F),A("click",E,Y),A("click",P,re),o(R,P)};b(le,R=>{t()&&R(ne)})}o(i,X),Wt()}let Ea=null,Ua=null;async function Ms(){if(Ea)return Ea;try{return Ea=await(await fetch(Bs("/data/spells.json"))).json(),Ea||[]}catch(i){return console.error("Failed to load spells:",i),[]}}async function si(){if(Ua)return Ua;try{return Ua=await(await fetch(Bs("/data/feats.json"))).json(),Ua||[]}catch(i){return console.error("Failed to load feats:",i),[]}}function xs(i,c){if(!c.trim())return i;const t=c.toLowerCase();return i.filter(v=>v.name.toLowerCase().includes(t)||v.school.toLowerCase().includes(t)||v.classes.some(u=>u.toLowerCase().includes(t))||v.description.toLowerCase().includes(t))}function li(i,c){return c===null?i:i.filter(t=>t.level===c)}function ii(i,c){if(!c.trim())return i;const t=c.toLowerCase();return i.filter(v=>v.name.toLowerCase().includes(t)||v.description.toLowerCase().includes(t))}function Ha(i){const c=i.description,t=/\b(Strength|Dexterity|Constitution|Intelligence|Wisdom|Charisma)\s+saving\s+throw/i,v=c.match(t);if(!v)return null;const u=v[1].toLowerCase(),f=/half\s+(?:as\s+much\s+)?damage\s+on\s+a\s+successful(?:\s+save)?/i.test(c),h=/saving\s+throw\s+or\s+take.*?damage/i.test(c)&&!f;return{ability:u,halfDamageOnSave:f,noDamageOnSave:h}}function ni(i){const c=i.description;return/(plus|add)\s+your\s+spellcasting\s+(ability\s+)?modifier/i.test(c)}function Xa(i){const c=i.description.toLowerCase();return c.includes("ranged spell attack")||c.includes("melee spell attack")}function $s(i){const c=i.description.toLowerCase();if(["Divine Favor","Bless","Aid","Command"].includes(i.name))return!0;const u=["takes","take","deals","deal","damage equal to","force damage","fire damage","cold damage","lightning damage","thunder damage","acid damage","poison damage","necrotic damage","radiant damage","psychic damage","regain","regains","hit point"].some(L=>c.includes(L));return["bonus to attack","bonus to damage","bonus to ac","gains a +","gain a +","+1 bonus","+2 bonus","+3 bonus","advantage on","becomes a magic weapon"].some(L=>c.includes(L))&&!u}function ri(i){const c=i.description;let t=0,v=0,u=0,p="";const f=c.match(/\+(\d+)\s+bonus\s+to\s+attack\s+rolls\s+and\s+damage\s+rolls/i);if(f){const h=parseInt(f[1]);t=h,v=h,p=`+${h} to attack and damage rolls`}if(i.name==="Bless"&&(p="Add 1d4 to attack rolls and saves",t="1d4"),i.name==="Aid")return p="+5 HP (max and current) for 8 hours",{attackBonus:0,damageBonus:0,acBonus:0,hpBonus:5,description:p,name:i.name};i.name==="Divine Favor"&&(p="Your weapon attacks deal an extra 1d4 radiant damage on a hit.",v="1d4");const L=c.match(/\+(\d+)\s+bonus\s+to\s+AC/i);return L&&(u=parseInt(L[1]),p=`+${u} to AC`),i.name==="Haste"&&(p="+2 AC, doubled speed, extra action",u=2),p||t!==0||v!==0||u!==0?{attackBonus:t,damageBonus:v,acBonus:u,description:p||i.description.substring(0,100),name:i.name}:null}function Za(i){const c=i.description,t=/takes?\s+(\d+d\d+)\s+\w+\s+damage[^.]*\.\s*If\s+the\s+target\s+is\s+missing.*?instead\s+takes?\s+(\d+d\d+)/is,v=c.match(t);return v?{baseDamage:v[1],alternateDamage:v[2]}:null}var oi=d('<button class="btn btn-secondary">Reorder</button>'),ci=d('<div class="edit-buttons svelte-14o91c5"><button class="btn btn-secondary">Add Attack</button> <!></div>'),vi=d('<input type="text" placeholder="Attack name" class="attack-name svelte-14o91c5"/>'),di=d('<h4 class="attack-name-display svelte-14o91c5"> </h4>'),ui=d('<button class="btn-remove svelte-14o91c5">√ó</button>'),fi=d('<div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Bonus</label> <input type="number" class="attack-bonus svelte-14o91c5"/></div>'),pi=d('<div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Damage</label> <input type="text" placeholder="e.g., 2d6+3" class="attack-damage svelte-14o91c5"/></div>'),mi=d('<div class="spell-info-loading svelte-14o91c5">Loading spell info...</div>'),gi=d('<li class="svelte-14o91c5"><strong>At Higher Levels:</strong> </li>'),bi=d('<ul class="svelte-14o91c5"><li class="svelte-14o91c5"><strong>Level:</strong> </li> <li class="svelte-14o91c5"><strong>Casting Time:</strong> </li> <li class="svelte-14o91c5"><strong>Range:</strong> </li> <li class="svelte-14o91c5"><strong>Components:</strong> <!></li> <li class="svelte-14o91c5"><strong>Duration:</strong> <!> </li> <li class="svelte-14o91c5"><strong>Description:</strong> </li> <!></ul>'),hi=d('<span class="scaled-damage svelte-14o91c5" style="margin-left: 8px;"> </span>'),_i=d('<span class="scaled-damage svelte-14o91c5">(Half damage)</span>'),yi=d('<span class="scaled-damage svelte-14o91c5">(No damage)</span>'),xi=d('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> <!> <!></label></div>'),$i=d('<span class="scaled-damage svelte-14o91c5"> </span>'),ki=d('<span class="scaled-damage svelte-14o91c5"> </span>'),wi=d('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> Target is missing HP <!></label></div>'),Si=d("<option> </option>"),Ci=d('<span class="scaled-damage svelte-14o91c5"><!> </span>'),Di=d('<span class="scaled-damage svelte-14o91c5"> </span>'),Li=d('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> Target is Fiend or Undead <!></label></div>'),ji=d('<div class="spell-level-selector svelte-14o91c5"><label class="svelte-14o91c5">Cast at Level:</label> <select class="spell-level-select use-enabled svelte-14o91c5"></select> <!></div> <!>',1),Ai=d('<div class="spell-level-selector svelte-14o91c5"><span style="color: #dc3545; font-weight: bold;">No spell slots available!</span></div>'),Bi=d('<div class="spell-info svelte-14o91c5"><div class="spell-info-header svelte-14o91c5" role="button" tabindex="0"><h4 class="svelte-14o91c5">Spell Info</h4> <button class="collapse-btn-small svelte-14o91c5"> </button></div> <!></div> <!> <!> <!>',1),Ri=d('<div class="spell-info-missing svelte-14o91c5">Spell info not found.</div>'),Ti=d('<div class="attack-notes svelte-14o91c5"><label class="svelte-14o91c5">Notes</label> <textarea placeholder="e.g., DC 15 Dex save, Range 120 ft, Concentration" class="notes-input svelte-14o91c5" rows="2"></textarea></div>'),Mi=d('<button class="btn btn-primary">Roll Attack</button>'),Fi=d('<div class="buff-target-selection svelte-14o91c5"><div class="target-options svelte-14o91c5"><label class="target-option svelte-14o91c5"><input type="radio" class="svelte-14o91c5"/> Self</label> <label class="target-option svelte-14o91c5"><input type="radio" class="svelte-14o91c5"/> Other</label></div> <button class="btn btn-info"> </button></div>'),Pi=d('<button class="btn btn-info">Cast Spell</button>'),Ii=d("<button><!></button>"),Ei=d('<button class="btn btn-info">Cast Spell</button>'),Ui=d('<button class="btn btn-secondary">Roll Damage</button>'),Hi=d('<button class="btn btn-primary">Roll Attack</button> <!>',1),Ni=d('<div class="attack-card svelte-14o91c5"><div class="attack-header svelte-14o91c5"><!> <!></div> <div class="attack-details svelte-14o91c5"><!> <!> <div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Type</label> <input type="text" placeholder="e.g., slashing" class="attack-type svelte-14o91c5"/></div></div> <!> <!> <div class="attack-actions svelte-14o91c5"><!></div></div>'),Oi=d('<p class="no-attacks svelte-14o91c5">No attacks added yet. Click "Add Attack" to create one.</p>'),Gi=d('<p class="no-attacks svelte-14o91c5">No attacks match your search.</p>'),qi=d('<span class="ability-uses svelte-14o91c5"> <!></span>'),zi=d('<span class="ability-reaction svelte-14o91c5">‚ö° Reaction</span>'),Wi=d('<button class="btn btn-ability svelte-14o91c5">Use Ability</button>'),Ki=d('<div class="ability-card svelte-14o91c5"><div class="ability-header svelte-14o91c5"><h4 class="ability-name svelte-14o91c5"> </h4> <span class="ability-source svelte-14o91c5"> </span></div> <p class="ability-description svelte-14o91c5"> </p> <div class="ability-footer svelte-14o91c5"><!> <!> <!></div></div>'),Vi=d('<div class="condition-abilities-section svelte-14o91c5"><h3 class="abilities-header svelte-14o91c5">Condition Abilities</h3> <p class="section-description svelte-14o91c5">Special actions granted by active conditions (e.g., Flicker of Deceit)</p> <div class="abilities-list svelte-14o91c5"></div></div>'),Ji=d('<button class="btn-remove svelte-14o91c5">√ó</button>'),Yi=d('<div class="state-card svelte-14o91c5"><div class="state-header svelte-14o91c5"><input type="text" placeholder="Effect name (e.g., Magic Weapon)" class="state-name svelte-14o91c5"/> <!></div> <div class="state-details svelte-14o91c5"><div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Attack Bonus</label> <input type="number" class="state-bonus svelte-14o91c5"/></div> <div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Damage Bonus</label> <input type="text" class="state-bonus svelte-14o91c5"/></div> <div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Target</label> <select class="state-bonus svelte-14o91c5"><option>Self</option><option>Other</option></select></div></div> <div class="state-description svelte-14o91c5"><label class="svelte-14o91c5">Description</label> <input type="text" placeholder="e.g., +1 to attack and damage rolls (Magic Weapon)" class="state-desc-input svelte-14o91c5"/></div></div>'),Qi=d('<div class="states-list svelte-14o91c5"></div>'),Xi=d('<p class="no-states svelte-14o91c5">No active effects. Add spell effects that modify your attacks.</p>'),Zi=d('<!> <div class="attacks-list svelte-14o91c5"><!> <!></div> <!> <div class="active-states-section svelte-14o91c5"><h3 class="svelte-14o91c5">Active Spell Effects</h3> <p class="section-description svelte-14o91c5">Effects that modify attack and damage rolls (e.g., Magic Weapon, Bless)</p> <button class="btn btn-secondary">Add Effect</button> <!></div>',1),en=d("<section><!> <!></section> <!>",1);function tn(i,c){zt(c,!1);const t=()=>ut(me,"$character",f),v=()=>ut(ga,"$searchFilter",f),u=()=>ut(Qt,"$collapsedStates",f),p=()=>ut(ma,"$isEditMode",f),[f,L]=na(),h=C(),y=C(),Y=C(),F=[];function re($,N){me.update(ge=>{if(!ge.activeStates)return ge;const xe=ge.activeStates.findIndex(he=>he.name===$);if(xe===-1)return ge;const _=ge.activeStates[xe];if(!_.abilities)return ge;const O=_.abilities.findIndex(he=>he.name===N);if(O===-1)return ge;const ie=_.abilities[O];return ie.currentUses!==void 0&&ie.currentUses>0&&(ie.currentUses-=1,ie.usesPerRest!==void 0?Ht.add(`Used ${N} (${ie.currentUses}/${ie.usesPerRest} remaining)`,"info"):Ht.add(`Used ${N}`,"info")),ge})}const X=ha();let le=C({}),ne=C({}),R=C(!1);function P($){pa(le,e(le)[$]=!e(le)[$]),r(le,{...e(le)})}function pe($){return $.description.toLowerCase().includes("regain")&&($.description.toLowerCase().includes("hit point")||$.description.toLowerCase().includes("hp"))}function Ee($){return["Shield of Faith","Bless","Aid","Magic Weapon"].includes($)}function Be(){me.update($=>($.attacks=[...$.attacks,{id:crypto.randomUUID(),name:"",bonus:0,damage:"",damageType:"",notes:""}],$))}function Q($){me.update(N=>(N.attacks=N.attacks.filter(ge=>ge.id!==$),N))}function Re(){r(R,!0)}function be(){r(R,!1)}function ye($){me.update(N=>(N.attacks=$,N)),r(R,!1),Ht.add("Attack order updated successfully!","success")}function Te($){let N=$.damage,ge=!1,xe=!1;if($.spellRef){const ee=W($.spellRef);if(ee&&(xe=Xa(ee),ee.level>0)){const H=$.castAtLevel||ee.level;if(!g(H)){Ht.add(`No level ${H} spell slots available!`,"error");return}const Z=Ha(ee);Z&&$.targetSucceededSave&&Z.noDamageOnSave?N="0":(ge=Z?.halfDamageOnSave&&$.targetSucceededSave||!1,N=T($,ee))}}else if(t().activeStates&&t().activeStates.length>0){let ee=0,H=[];for(const U of t().activeStates)U.target!=="other"&&(typeof U.damageBonus=="string"?H.push(U.damageBonus):typeof U.damageBonus=="number"&&(ee+=U.damageBonus));if((ee!==0||H.length>0)&&N){const U=N.match(/(\d+d\d+)([+-]\d+)?/);if(U){const[,Z,B]=U,De=(B?parseInt(B):0)+ee;let Xe=`${Z}`;De!==0&&(Xe+=`${De>=0?"+":""}${De}`),H.length>0&&(Xe+=" + "+H.join(" + ")),N=Xe}}}const _=[];let O=0;if(xe){const ee=Ya(t(),t().abilities),H=t().proficiencyBonus||0;_.push({value:H,source:"proficiency"}),_.push({value:ee,source:"spellcasting"}),O=H+ee}else $.bonus!==0&&_.push({value:$.bonus,source:"base"}),O=$.bonus;let ie=[];if(t().activeStates)for(const ee of t().activeStates)ee.target!=="other"&&(typeof ee.attackBonus=="number"&&ee.attackBonus!==0?(_.push({value:ee.attackBonus,source:ee.name.toLowerCase()}),O+=ee.attackBonus):typeof ee.attackBonus=="string"&&ee.attackBonus&&(ie.push(ee.attackBonus),_.push({value:ee.attackBonus,source:ee.name.toLowerCase()})));let he=`1d20${O>=0?"+":""}${O}`;ie.length>0&&(he+="+"+ie.join("+")),X("roll",{notation:he,damageNotation:N,attackName:$.name,applyHalfDamage:ge,bonusBreakdown:_,rollType:"attack"})}function M($){if(!$.damage){Ht.add(`${$.name}: No damage specified`,"error");return}let N=$.damage,ge=!1;const xe=[];let _=$.damageType||"";if($.spellRef){const O=W($.spellRef);if(O){const ie=pe(O);if(ie){const he=Ya(t(),t().abilities),ee=N.match(/^(\d+d\d+)/);ee&&(N=ee[1],he>0&&(N+=`+${he}`,xe.push({value:he,source:"spellcasting"}))),_="Healing"}if(O.level>0){const he=$.castAtLevel||O.level;if(!g(he)){Ht.add(`No level ${he} spell slots available!`,"error");return}const H=Ha(O);H&&$.targetSucceededSave&&H.noDamageOnSave?N="0":(ge=H?.halfDamageOnSave&&$.targetSucceededSave||!1,ie||(N=T($,O))),O.damageType&&!ie&&(_=O.damageType)}}}else{const O=N.match(/(\d+d\d+)([+-]\d+)?/);if(O){const[,ie,he]=O,ee=he?parseInt(he):0;if(ee!==0&&xe.push({value:ee,source:"base"}),t().activeStates&&t().activeStates.length>0){let H=0,U=[];for(const Z of t().activeStates)Z.target!=="other"&&(typeof Z.damageBonus=="string"?U.push(Z.damageBonus):typeof Z.damageBonus=="number"&&Z.damageBonus!==0&&(xe.push({value:Z.damageBonus,source:Z.name.toLowerCase()}),H+=Z.damageBonus));if(H!==0||U.length>0){const Z=ee+H;let B=`${ie}`;Z!==0&&(B+=`${Z>=0?"+":""}${Z}`),U.length>0&&(B+=" + "+U.join(" + ")),N=B}}}}X("roll",{notation:N,attackName:$.name,applyHalfDamage:ge,bonusBreakdown:xe,damageType:_})}let E=C([]),x=C(!1);Sa(async()=>{r(E,await Ms()),r(x,!0)});function W($){return e(E).find(N=>N.name===$)}function g($){t().classFeatures.spellSlotsByLevel||Pt(me,n(t).classFeatures.spellSlotsByLevel={},n(t)),t().classFeatures.spellSlotsByLevel[$]||Pt(me,n(t).classFeatures.spellSlotsByLevel[$]=Array(2).fill(!1),n(t));const ge=t().classFeatures.spellSlotsByLevel[$].findIndex(xe=>!xe);return ge===-1?!1:(me.update(xe=>(xe.classFeatures.spellSlotsByLevel||(xe.classFeatures.spellSlotsByLevel={}),xe.classFeatures.spellSlotsByLevel[$]||(xe.classFeatures.spellSlotsByLevel[$]=Array(2).fill(!1)),xe.classFeatures.spellSlotsByLevel[$][ge]=!0,xe)),!0)}function T($,N){let ge=$.damage,xe=0,_=0;const O=Za(N);if(O&&$.targetIsDamaged&&(ge=O.alternateDamage),ni(N)&&(_+=Ya(t(),t().abilities)),t().activeStates)for(const De of t().activeStates)De.target!=="other"&&typeof De.damageBonus=="number"&&(_+=De.damageBonus);if(N.higherLevelSlot&&$.castAtLevel){const De=N.level,$e=($.castAtLevel||De)-De;if($e>0){const m=N.higherLevelSlot.match(/(\d+)d(\d+)\s+for\s+each.*?level\s+above/i);if(m){const[,oe]=m;xe+=$e*parseInt(oe)}}}if($.targetIsFiendOrUndead&&N.description.includes("Fiend or an Undead")){const De=N.description.match(/increases by (\d+)d(\d+) if.*?Fiend or.*?Undead/i);if(De){const[,Xe]=De;xe+=parseInt(Xe)}}const ie=ge.match(/(\d+)d(\d+)([+-]\d+)?/);if(!ie)return _!==0?_>=0?`${_}`:`${_}`:ge||"0";const[,he,ee,H]=ie,U=parseInt(he)+xe,B=(H?parseInt(H):0)+_;let Fe=`${U}d${ee}`;return B!==0&&(Fe+=B>=0?`+${B}`:`${B}`),Fe}function I($){const N=[];for(let xe=$.level;xe<=9;xe++){const _=t().classFeatures.spellSlotsByLevel?.[xe];_&&_.length>0&&N.push(xe)}return N}function Me(){me.update($=>($.activeStates||($.activeStates=[]),$.activeStates=[...$.activeStates,{name:"",attackBonus:0,damageBonus:0,description:"",target:"self"}],$))}function Ce($){me.update(N=>{if(N.activeStates){const ge=N.activeStates[$];ge?.hpBonus&&ge.target!=="other"&&(N.maxHP-=ge.hpBonus,N.currentHP=Math.max(1,Math.min(N.currentHP-ge.hpBonus,N.maxHP))),N.activeStates=N.activeStates.filter((xe,_)=>_!==$)}return N})}function de($,N="self"){const ge=W($.spellRef);if(!ge){Ht.add("Spell not found","error");return}const xe=$.castAtLevel||ge.level;if(xe>0&&!g(xe)){Ht.add(`No level ${xe} spell slots available!`,"error");return}const _=ri(ge);if(!_){Ht.add(`${ge.name} cast! Check spell description for effects.`,"info");return}let O=_.hpBonus||0,ie=_.description;ge.name==="Aid"&&xe>ge.level&&(O=5+(xe-ge.level)*5,ie=`+${O} HP (max and current) for 8 hours`);const ee=["Shield of Faith","Bless","Aid","Magic Weapon"].includes(ge.name);me.update(U=>{U.activeStates||(U.activeStates=[]);const Z=U.activeStates.find(B=>B.name===ge.name);return Z&&Z.hpBonus&&Z.target!=="other"&&(U.maxHP-=Z.hpBonus,U.currentHP=Math.max(1,Math.min(U.currentHP-Z.hpBonus,U.maxHP))),U.activeStates=U.activeStates.filter(B=>B.name!==ge.name),O>0&&N==="self"&&(U.maxHP+=O,U.currentHP+=O),U.activeStates=[...U.activeStates,{name:ge.name,attackBonus:_.attackBonus,damageBonus:_.damageBonus,acBonus:_.acBonus,description:ie,target:N,hpBonus:O}],U});const H=N==="self"?" on self":" on other";Ht.add(`${ge.name} cast${ee?H:""}! Effect added to Active Spell Effects.`,"success")}tt(()=>t(),()=>{r(h,t().activeStates?t().activeStates.filter($=>$.abilities&&$.abilities.length>0).flatMap($=>$.abilities.map(N=>({...N,conditionName:$.name}))):[])}),tt(()=>(t(),e(le),e(ne)),()=>{if(t()&&t().attacks)for(const $ of t().attacks)$.spellRef&&e(le)[$.id]===void 0&&pa(le,e(le)[$.id]=!0),$.spellRef&&e(ne)[$.id]===void 0&&pa(ne,e(ne)[$.id]="self")}),tt(()=>(t(),v()),()=>{r(y,t().attacks.filter($=>{if(!v())return!0;const N=v().toLowerCase();return $.name.toLowerCase().includes(N)||$.damageType.toLowerCase().includes(N)}).sort(($,N)=>!$.spellRef&&N.spellRef?-1:$.spellRef&&!N.spellRef?1:0))}),tt(()=>(v(),e(y)),()=>{r(Y,!v()||e(y).length>0||"attack".includes(v().toLowerCase())||"spell".includes(v().toLowerCase()))}),va(),qt();var fe=en(),Ae=Le(fe);let Je;var ot=l(Ae);{let $=yt(()=>(u(),n(()=>u().attacks?"Expand":"Collapse")));_a(ot,{title:"Attacks & Spells",get collapsed(){return u(),n(()=>u().attacks)},get ariaLabel(){return e($)},onToggle:()=>Qt.update(N=>({...N,attacks:!N.attacks}))})}var ht=a(ot,2);{var dt=$=>{var N=Zi(),ge=Le(N);{var xe=$e=>{var m=ci(),oe=l(m),te=a(oe,2);{var z=Ne=>{var Pe=oi();A("click",Pe,Re),o(Ne,Pe)};b(te,Ne=>{t(),n(()=>t().attacks.length>0)&&Ne(z)})}s(m),A("click",oe,Be),o($e,m)};b(ge,$e=>{p()&&$e(xe)})}var _=a(ge,2),O=l(_);xt(O,1,()=>e(y),$e=>$e.id,($e,m,oe)=>{var te=Ni(),z=l(te),Ne=l(z);{var Pe=ue=>{var q=vi();je(q),Oe(q,()=>e(m).name,He=>(e(m).name=He,Ut(()=>(e(y),t(),v())))),o(ue,q)},we=ue=>{var q=di(),He=l(q,!0);s(q),w(()=>k(He,(e(m),n(()=>e(m).name||"(Unnamed Attack)")))),o(ue,q)};b(Ne,ue=>{p()?ue(Pe):ue(we,!1)})}var Ue=a(Ne,2);{var ce=ue=>{var q=ui();A("click",q,()=>Q(e(m).id)),o(ue,q)};b(Ue,ue=>{p()&&ue(ce)})}s(z);var Ie=a(z,2),_e=l(Ie);{var Ye=ue=>{var q=fi(),He=l(q),ft=a(He,2);je(ft),s(q),w(()=>{nt(He,"for",`attack-bonus-${e(m),n(()=>e(m).id)??""}`),nt(ft,"id",`attack-bonus-${e(m),n(()=>e(m).id)??""}`)}),Oe(ft,()=>e(m).bonus,Ze=>(e(m).bonus=Ze,Ut(()=>(e(y),t(),v())))),o(ue,q)};b(_e,ue=>{e(m),n(()=>e(m).bonus!==0&&e(m).bonus!==void 0)&&ue(Ye)})}var Ge=a(_e,2);{var rt=ue=>{var q=pi(),He=l(q),ft=a(He,2);je(ft),s(q),w(()=>{nt(He,"for",`attack-damage-${e(m),n(()=>e(m).id)??""}`),nt(ft,"id",`attack-damage-${e(m),n(()=>e(m).id)??""}`)}),Oe(ft,()=>e(m).damage,Ze=>(e(m).damage=Ze,Ut(()=>(e(y),t(),v())))),o(ue,q)};b(Ge,ue=>{e(m),n(()=>e(m).damage&&e(m).damage.trim()!=="")&&ue(rt)})}var ct=a(Ge,2),ve=l(ct),D=a(ve,2);je(D),s(ct),s(Ie);var G=a(Ie,2);{var V=ue=>{var q=gt(),He=Le(q);{var ft=lt=>{var ae=mi();o(lt,ae)},Ze=lt=>{const ae=yt(()=>(e(m),n(()=>W(e(m).spellRef))));var j=gt(),Ve=Le(j);{var at=S=>{const pt=yt(()=>(J(Ha),J(e(ae)),n(()=>Ha(e(ae))))),bt=yt(()=>(J(Za),J(e(ae)),n(()=>Za(e(ae)))));var jt=Bi(),Se=Le(jt),We=l(Se),et=a(l(We),2),Lt=l(et,!0);s(et),s(We);var $t=a(We,2);{var mt=Bt=>{var Mt=bi(),Nt=l(Mt),sa=a(l(Nt));s(Nt);var ra=a(Nt,2),da=a(l(ra));s(ra);var Jt=a(ra,2),It=a(l(Jt));s(Jt);var Kt=a(Jt,2),Zt=a(l(Kt)),Dt=a(Zt);{var vt=Et=>{var Gt=Rt();w(()=>k(Gt,`(${J(e(ae)),n(()=>e(ae).material)??""})`)),o(Et,Gt)};b(Dt,Et=>{J(e(ae)),n(()=>e(ae).material)&&Et(vt)})}s(Kt);var _t=a(Kt,2),kt=a(l(_t),2);{var Ft=Et=>{var Gt=Rt("Concentration,");o(Et,Gt)};b(kt,Et=>{J(e(ae)),n(()=>e(ae).concentration)&&Et(Ft)})}var wt=a(kt,1,!0);s(_t);var Vt=a(_t,2),Ot=a(l(Vt));s(Vt);var oa=a(Vt,2);{var ua=Et=>{var Gt=gi(),ca=a(l(Gt));s(Gt),w(()=>k(ca,` ${J(e(ae)),n(()=>e(ae).higherLevelSlot)??""}`)),o(Et,Gt)};b(oa,Et=>{J(e(ae)),n(()=>e(ae).higherLevelSlot)&&Et(ua)})}s(Mt),w(Et=>{k(sa,` ${J(e(ae)),n(()=>e(ae).level)??""}`),k(da,` ${J(e(ae)),n(()=>e(ae).castingTime||e(ae).actionType)??""}`),k(It,` ${J(e(ae)),n(()=>e(ae).range)??""}`),k(Zt,` ${Et??""}`),k(wt,(J(e(ae)),n(()=>e(ae).duration))),k(Ot,` ${J(e(ae)),n(()=>e(ae).description)??""}`)},[()=>(J(e(ae)),n(()=>e(ae).components.join(", ")))]),o(Bt,Mt)};b($t,Bt=>{e(le),e(m),n(()=>!e(le)[e(m).id])&&Bt(mt)})}s(Se);var it=a(Se,2);{var Tt=Bt=>{var Mt=xi(),Nt=l(Mt),sa=l(Nt);je(sa);var ra=a(sa),da=a(ra);{var Jt=Dt=>{var vt=hi(),_t=l(vt);s(vt),w(kt=>k(_t,`(Spell Save DC: ${kt??""})`),[()=>(J(is),t(),n(()=>is(t(),t().abilities)))]),o(Dt,vt)};b(da,Dt=>{t(),n(()=>t().class)&&Dt(Jt)})}var It=a(da,2);{var Kt=Dt=>{var vt=_i();o(Dt,vt)},Zt=Dt=>{var vt=gt(),_t=Le(vt);{var kt=Ft=>{var wt=yi();o(Ft,wt)};b(_t,Ft=>{e(m),J(e(pt)),n(()=>e(m).targetSucceededSave&&e(pt).noDamageOnSave)&&Ft(kt)},!0)}o(Dt,vt)};b(It,Dt=>{e(m),J(e(pt)),n(()=>e(m).targetSucceededSave&&e(pt).halfDamageOnSave)?Dt(Kt):Dt(Zt,!1)})}s(Nt),s(Mt),w(Dt=>k(ra,` Target succeeded on ${Dt??""} save `),[()=>(J(e(pt)),n(()=>e(pt).ability.charAt(0).toUpperCase()+e(pt).ability.slice(1)))]),$a(sa,()=>e(m).targetSucceededSave,Dt=>(e(m).targetSucceededSave=Dt,Ut(()=>(e(y),t(),v())))),o(Bt,Mt)};b(it,Bt=>{e(pt)&&Bt(Tt)})}var ea=a(it,2);{var ta=Bt=>{var Mt=wi(),Nt=l(Mt),sa=l(Nt);je(sa);var ra=a(sa,2);{var da=It=>{const Kt=yt(()=>(e(m),J(e(ae)),n(()=>T(e(m),e(ae)))));var Zt=$i(),Dt=l(Zt);s(Zt),w(()=>k(Dt,`(${J(e(bt)),n(()=>e(bt).alternateDamage)??""}, total: ${e(Kt)??""})`)),o(It,Zt)},Jt=It=>{var Kt=ki(),Zt=l(Kt);s(Kt),w(()=>k(Zt,`(${J(e(bt)),n(()=>e(bt).baseDamage)??""})`)),o(It,Kt)};b(ra,It=>{e(m),n(()=>e(m).targetIsDamaged)?It(da):It(Jt,!1)})}s(Nt),s(Mt),$a(sa,()=>e(m).targetIsDamaged,It=>(e(m).targetIsDamaged=It,Ut(()=>(e(y),t(),v())))),o(Bt,Mt)};b(ea,Bt=>{e(bt)&&Bt(ta)})}var Xt=a(ea,2);{var aa=Bt=>{const Mt=yt(()=>(J(e(ae)),n(()=>I(e(ae)))));var Nt=gt(),sa=Le(Nt);{var ra=Jt=>{var It=ji(),Kt=Le(It),Zt=l(Kt),Dt=a(Zt,2);w(()=>{e(m),Ut(()=>{e(Mt)})}),xt(Dt,5,()=>e(Mt),Ct,(wt,Vt)=>{var Ot=Si(),oa=l(Ot);s(Ot);var ua={};w(()=>{k(oa,`Level ${e(Vt)??""}`),ua!==(ua=e(Vt))&&(Ot.value=(Ot.__value=e(Vt))??"")}),o(wt,Ot)}),s(Dt);var vt=a(Dt,2);{var _t=wt=>{const Vt=yt(()=>(e(m),J(e(ae)),n(()=>T(e(m),e(ae)))));var Ot=Ci(),oa=l(Ot);{var ua=ca=>{var la=Rt("Healing");o(ca,la)},Et=ca=>{var la=Rt("Damage");o(ca,la)};b(oa,ca=>{J(e(ae)),n(()=>pe(e(ae)))?ca(ua):ca(Et,!1)})}var Gt=a(oa);s(Ot),w(()=>k(Gt,` ${e(Vt)??""}`)),o(wt,Ot)};b(vt,wt=>{e(m),J(e(ae)),n(()=>e(m).castAtLevel&&e(m).castAtLevel>e(ae).level)&&wt(_t)})}s(Kt);var kt=a(Kt,2);{var Ft=wt=>{var Vt=Li(),Ot=l(Vt),oa=l(Ot);je(oa);var ua=a(oa,2);{var Et=Gt=>{const ca=yt(()=>(e(m),J(e(ae)),n(()=>T(e(m),e(ae)))));var la=Di(),ya=l(la);s(la),w(()=>k(ya,`(+1d8, total: ${e(ca)??""})`)),o(Gt,la)};b(ua,Gt=>{e(m),n(()=>e(m).targetIsFiendOrUndead)&&Gt(Et)})}s(Ot),s(Vt),$a(oa,()=>e(m).targetIsFiendOrUndead,Gt=>(e(m).targetIsFiendOrUndead=Gt,Ut(()=>(e(y),t(),v())))),o(wt,Vt)};b(kt,wt=>{J(e(ae)),n(()=>e(ae).description.includes("Fiend or an Undead"))&&wt(Ft)})}w(()=>{nt(Zt,"for",`castLevel-${e(m),n(()=>e(m).id)??""}`),nt(Dt,"id",`castLevel-${e(m),n(()=>e(m).id)??""}`)}),Ra(Dt,()=>e(m).castAtLevel,wt=>(e(m).castAtLevel=wt,Ut(()=>(e(y),t(),v())))),o(Jt,It)},da=Jt=>{var It=Ai();o(Jt,It)};b(sa,Jt=>{J(e(Mt)),n(()=>e(Mt).length>0)?Jt(ra):Jt(da,!1)})}o(Bt,Nt)};b(Xt,Bt=>{J(e(ae)),n(()=>e(ae).higherLevelSlot&&e(ae).level>0)&&Bt(aa)})}w(()=>{nt(et,"aria-label",(e(le),e(m),n(()=>e(le)[e(m).id]?"Expand":"Collapse"))),k(Lt,(e(le),e(m),n(()=>e(le)[e(m).id]?"‚ñº":"‚ñ≤")))}),A("click",We,()=>P(e(m).id)),A("keydown",We,Bt=>Bt.key==="Enter"&&P(e(m).id)),o(S,jt)},se=S=>{var pt=Ri();o(S,pt)};b(Ve,S=>{e(ae)?S(at):S(se,!1)})}o(lt,j)};b(He,lt=>{e(E),n(()=>e(E).length===0)?lt(ft):lt(Ze,!1)})}o(ue,q)};b(G,ue=>{e(m),n(()=>e(m).spellRef)&&ue(V)})}var K=a(G,2);{var ke=ue=>{var q=gt(),He=Le(q);{var ft=Ze=>{var lt=Ti(),ae=l(lt),j=a(ae,2);xa(j),s(lt),w(()=>{nt(ae,"for",`attack-notes-${e(m),n(()=>e(m).id)??""}`),nt(j,"id",`attack-notes-${e(m),n(()=>e(m).id)??""}`)}),Oe(j,()=>e(m).notes,Ve=>(e(m).notes=Ve,Ut(()=>(e(y),t(),v())))),o(Ze,lt)};b(He,Ze=>{e(m),n(()=>e(m).notes&&e(m).notes.trim()!=="")&&Ze(ft)})}o(ue,q)};b(K,ue=>{e(m),n(()=>!e(m).spellRef)&&ue(ke)})}var qe=a(K,2),st=l(qe);{var ze=ue=>{const q=yt(()=>(e(m),n(()=>W(e(m).spellRef))));var He=gt(),ft=Le(He);{var Ze=lt=>{var ae=gt(),j=Le(ae);{var Ve=se=>{var S=Mi();A("click",S,()=>Te(e(m))),o(se,S)},at=se=>{var S=gt(),pt=Le(S);{var bt=Se=>{var We=gt(),et=Le(We);{var Lt=mt=>{var it=Fi(),Tt=l(it),ea=l(Tt),ta=l(ea);je(ta),ta.value=ta.__value="self",Yt(),s(ea);var Xt=a(ea,2),aa=l(Xt);je(aa),aa.value=aa.__value="other",Yt(),s(Xt),s(Tt);var Bt=a(Tt,2),Mt=l(Bt);s(Bt),s(it),w(()=>{nt(ta,"name",`target-${e(m),n(()=>e(m).id)??""}`),nt(aa,"name",`target-${e(m),n(()=>e(m).id)??""}`),k(Mt,`Cast ${J(e(q)),n(()=>e(q).name)??""}`)}),gs(F,[oe],ta,()=>e(ne)[e(m).id],Nt=>pa(ne,e(ne)[e(m).id]=Nt)),gs(F,[oe],aa,()=>e(ne)[e(m).id],Nt=>pa(ne,e(ne)[e(m).id]=Nt)),A("click",Bt,()=>de(e(m),e(ne)[e(m).id])),o(mt,it)},$t=mt=>{var it=Pi();A("click",it,()=>de(e(m),"self")),o(mt,it)};b(et,mt=>{J(e(q)),n(()=>Ee(e(q).name))?mt(Lt):mt($t,!1)})}o(Se,We)},jt=Se=>{var We=gt(),et=Le(We);{var Lt=mt=>{var it=Ii(),Tt=l(it);{var ea=Xt=>{var aa=Rt("Roll Healing");o(Xt,aa)},ta=Xt=>{var aa=Rt("Roll Damage");o(Xt,aa)};b(Tt,Xt=>{J(e(q)),n(()=>pe(e(q)))?Xt(ea):Xt(ta,!1)})}s(it),w(Xt=>At(it,1,`btn ${Xt??""}`),[()=>(J(e(q)),n(()=>pe(e(q))?"btn-success":"btn-secondary"))]),A("click",it,()=>M(e(m))),o(mt,it)},$t=mt=>{var it=Ei();A("click",it,()=>de(e(m),"self")),o(mt,it)};b(et,mt=>{e(m),n(()=>e(m).damage&&e(m).damage.trim()!=="")?mt(Lt):mt($t,!1)})}o(Se,We)};b(pt,Se=>{J($s),J(e(q)),n(()=>$s(e(q)))?Se(bt):Se(jt,!1)},!0)}o(se,S)};b(j,se=>{J(Xa),J(e(q)),n(()=>Xa(e(q)))?se(Ve):se(at,!1)})}o(lt,ae)};b(ft,lt=>{e(q)&&lt(Ze)})}o(ue,He)},Ke=ue=>{var q=gt(),He=Le(q);{var ft=Ze=>{var lt=Hi(),ae=Le(lt),j=a(ae,2);{var Ve=at=>{var se=Ui();A("click",se,()=>M(e(m))),o(at,se)};b(j,at=>{e(m),n(()=>e(m).damage&&e(m).damage.trim()!=="")&&at(Ve)})}A("click",ae,()=>Te(e(m))),o(Ze,lt)};b(He,Ze=>{e(m),n(()=>!e(m).spellRef)&&Ze(ft)},!0)}o(ue,q)};b(st,ue=>{e(m),e(x),n(()=>e(m).spellRef&&e(x))?ue(ze):ue(Ke,!1)})}s(qe),s(te),w(()=>{nt(ve,"for",`attack-type-${e(m),n(()=>e(m).id)??""}`),nt(D,"id",`attack-type-${e(m),n(()=>e(m).id)??""}`)}),Oe(D,()=>e(m).damageType,ue=>(e(m).damageType=ue,Ut(()=>(e(y),t(),v())))),o($e,te)});var ie=a(O,2);{var he=$e=>{var m=Oi();o($e,m)},ee=$e=>{var m=gt(),oe=Le(m);{var te=z=>{var Ne=Gi();o(z,Ne)};b(oe,z=>{e(y),n(()=>e(y).length===0)&&z(te)},!0)}o($e,m)};b(ie,$e=>{t(),n(()=>t().attacks.length===0)?$e(he):$e(ee,!1)})}s(_);var H=a(_,2);{var U=$e=>{var m=Vi(),oe=a(l(m),4);xt(oe,5,()=>e(h),Ct,(te,z)=>{var Ne=Ki(),Pe=l(Ne),we=l(Pe),Ue=l(we,!0);s(we);var ce=a(we,2),Ie=l(ce);s(ce),s(Pe);var _e=a(Pe,2),Ye=l(_e,!0);s(_e);var Ge=a(_e,2),rt=l(Ge);{var ct=K=>{var ke=qi(),qe=l(ke),st=a(qe);{var ze=Ke=>{var ue=Rt();w(()=>k(ue,`per ${e(z),n(()=>e(z).restType)??""} rest`)),o(Ke,ue)};b(st,Ke=>{e(z),n(()=>e(z).restType)&&Ke(ze)})}s(ke),w(()=>k(qe,`${e(z),n(()=>e(z).currentUses??e(z).usesPerRest)??""}/${e(z),n(()=>e(z).usesPerRest)??""} uses `)),o(K,ke)};b(rt,K=>{e(z),n(()=>e(z).usesPerRest)&&K(ct)})}var ve=a(rt,2);{var D=K=>{var ke=zi();o(K,ke)};b(ve,K=>{e(z),n(()=>e(z).requiresReaction)&&K(D)})}var G=a(ve,2);{var V=K=>{var ke=Wi();w(()=>ke.disabled=(e(z),n(()=>e(z).currentUses===void 0||e(z).currentUses===0))),A("click",ke,()=>re(e(z).conditionName,e(z).name)),o(K,ke)};b(G,K=>{p(),e(z),n(()=>!p()&&e(z).usesPerRest)&&K(V)})}s(Ge),s(Ne),w(()=>{k(Ue,(e(z),n(()=>e(z).name))),k(Ie,`(${e(z),n(()=>e(z).conditionName)??""})`),k(Ye,(e(z),n(()=>e(z).description)))}),o(te,Ne)}),s(oe),s(m),o($e,m)};b(H,$e=>{e(h),n(()=>e(h).length>0)&&$e(U)})}var Z=a(H,2),B=a(l(Z),4),Fe=a(B,2);{var De=$e=>{var m=Qi();xt(m,5,()=>(t(),n(()=>t().activeStates)),Ct,(oe,te,z)=>{var Ne=Yi(),Pe=l(Ne),we=l(Pe);je(we);var Ue=a(we,2);{var ce=Ke=>{var ue=Ji();A("click",ue,()=>Ce(z)),o(Ke,ue)};b(Ue,Ke=>{p()&&Ke(ce)})}s(Pe);var Ie=a(Pe,2),_e=l(Ie),Ye=l(_e);nt(Ye,"for",`state-attack-bonus-${z}`);var Ge=a(Ye,2);je(Ge),nt(Ge,"id",`state-attack-bonus-${z}`),s(_e);var rt=a(_e,2),ct=l(rt);nt(ct,"for",`state-damage-bonus-${z}`);var ve=a(ct,2);je(ve),nt(ve,"id",`state-damage-bonus-${z}`),s(rt);var D=a(rt,2),G=l(D);nt(G,"for",`state-target-${z}`);var V=a(G,2);w(()=>{e(te),Ut(()=>{})}),nt(V,"id",`state-target-${z}`);var K=l(V);K.value=K.__value="self";var ke=a(K);ke.value=ke.__value="other",s(V),s(D),s(Ie);var qe=a(Ie,2),st=l(qe);nt(st,"for",`state-desc-${z}`);var ze=a(st,2);je(ze),nt(ze,"id",`state-desc-${z}`),s(qe),s(Ne),Oe(we,()=>e(te).name,Ke=>(e(te).name=Ke,Ut(()=>t()),Da(f,"$character"))),Oe(Ge,()=>e(te).attackBonus,Ke=>(e(te).attackBonus=Ke,Ut(()=>t()),Da(f,"$character"))),Oe(ve,()=>e(te).damageBonus,Ke=>(e(te).damageBonus=Ke,Ut(()=>t()),Da(f,"$character"))),Ra(V,()=>e(te).target,Ke=>(e(te).target=Ke,Ut(()=>t()),Da(f,"$character"))),Oe(ze,()=>e(te).description,Ke=>(e(te).description=Ke,Ut(()=>t()),Da(f,"$character"))),o(oe,Ne)}),s(m),o($e,m)},Xe=$e=>{var m=Xi();o($e,m)};b(Fe,$e=>{t(),n(()=>t().activeStates&&t().activeStates.length>0)?$e(De):$e(Xe,!1)})}s(Z),A("click",B,Me),o($,N)};b(ht,$=>{u(),n(()=>!u().attacks)&&$(dt)})}s(Ae);var Qe=a(Ae,2);ai(Qe,{get show(){return e(R)},get attacks(){return t(),n(()=>t().attacks)},onSave:ye,onCancel:be}),w(()=>Je=At(Ae,1,"attacks svelte-14o91c5",null,Je,{hidden:!e(Y)})),o(i,fe),Wt(),L()}var an=d('<span class="slot-checkbox-x svelte-serp1j">&#8212;</span>'),sn=d('<label><input type="checkbox" class="slot-checkbox-input svelte-serp1j"/> <span><!></span></label>');function ks(i,c){zt(c,!1);const t=()=>ut(ma,"$isEditMode",v),[v,u]=na();let p=St(c,"checked",8,!1),f=St(c,"disabled",8,!1),L=St(c,"className",8,""),h=St(c,"index",8,void 0),y=St(c,"ariaLabel",8,void 0);const Y=ha();function F(P){Y("change",{checked:P.currentTarget.checked,index:h()})}qt();var re=sn(),X=l(re);je(X);var le=a(X,2),ne=l(le);{var R=P=>{var pe=an();o(P,pe)};b(ne,P=>{p()&&P(R)})}s(le),s(re),w(()=>{At(re,1,"slot-checkbox-label "+L()+(t()?"":" not-editable"),"svelte-serp1j"),As(X,p()),X.disabled=f()||!t(),nt(X,"aria-label",y()),nt(X,"tabindex",t()?0:-1),At(le,1,`slot-checkbox-custom ${p()?"used":""} ${t()?"":"readonly"}`,"svelte-serp1j")}),A("change",X,F),o(i,re),Wt(),u()}var ln=d('<span class="spell-type cantrip svelte-19b5nmj">Cantrip</span>'),nn=d('<span class="spell-type svelte-19b5nmj"> </span>'),rn=d('<span class="spell-notes svelte-19b5nmj"> </span>'),on=d('<button class="btn btn-sm btn-primary svelte-19b5nmj">Use</button>'),cn=d('<div class="spell-uses svelte-19b5nmj"><span> </span> <!></div>'),vn=d('<div class="spell-uses svelte-19b5nmj"><span class="uses-count unlimited svelte-19b5nmj">At will</span></div>'),dn=d('<span class="rest-type svelte-19b5nmj"> </span>'),un=d('<span class="spellcasting-ability svelte-19b5nmj"> </span>'),fn=d('<span class="no-components svelte-19b5nmj">No components required</span>'),pn=d('<div class="racial-spell-item svelte-19b5nmj"><div class="spell-info svelte-19b5nmj"><span class="spell-name svelte-19b5nmj"> </span> <!> <!></div> <!> <div class="spell-meta svelte-19b5nmj"><!> <!> <!></div></div>'),mn=d('<div class="racial-spells svelte-19b5nmj"><h5 class="svelte-19b5nmj">Spells:</h5> <div class="racial-spells-list svelte-19b5nmj"></div></div>'),gn=d('<div class="feature-box racial-trait svelte-19b5nmj"><h4 class="svelte-19b5nmj"> </h4> <p class="feature-description svelte-19b5nmj"> </p> <!></div>'),bn=d('<div class="racial-traits-section svelte-19b5nmj"><h3 class="racial-traits-title svelte-19b5nmj">Racial Traits</h3> <!></div>');function hn(i,c){zt(c,!1);const t=()=>ut(me,"$character",u),v=()=>ut(ma,"$isEditMode",u),[u,p]=na(),f=C(),L=C(),h=C();function y(R){sl(R)}function Y(R){if(!t().racialTraits)return 0;const P=t().racialTraits.uses[R];return P?P.currentUses:0}function F(R){if(!t().racialTraits)return 0;const P=t().racialTraits.uses[R];return P?P.maxUses:0}function re(R){return R.usesPerRest!==void 0}tt(()=>(t(),us),()=>{t().race&&t().level&&us()}),tt(()=>(t(),fs),()=>{r(f,t().race?fs(t().race):null)}),tt(()=>t(),()=>{r(L,as(t().race,t().level))}),tt(()=>(e(f),e(L)),()=>{r(h,e(f)&&e(f).traits&&e(f).traits.length>0&&e(L).length>0)}),va(),qt();var X=gt(),le=Le(X);{var ne=R=>{var P=bn(),pe=a(l(P),2);xt(pe,1,()=>(e(f),n(()=>e(f).traits)),Ct,(Ee,Be)=>{var Q=gn(),Re=l(Q),be=l(Re,!0);s(Re);var ye=a(Re,2),Te=l(ye,!0);s(ye);var M=a(ye,2);{var E=x=>{var W=mn(),g=a(l(W),2);xt(g,5,()=>e(L),Ct,(T,I)=>{var Me=pn(),Ce=l(Me),de=l(Ce),fe=l(de,!0);s(de);var Ae=a(de,2);{var Je=H=>{var U=ln();o(H,U)},ot=H=>{var U=nn(),Z=l(U);s(U),w(()=>k(Z,`Level ${e(I),n(()=>e(I).level)??""}`)),o(H,U)};b(Ae,H=>{e(I),n(()=>e(I).level===0)?H(Je):H(ot,!1)})}var ht=a(Ae,2);{var dt=H=>{var U=rn(),Z=l(U);s(U),w(()=>k(Z,`(${e(I),n(()=>e(I).notes)??""})`)),o(H,U)};b(ht,H=>{e(I),n(()=>e(I).notes)&&H(dt)})}s(Ce);var Qe=a(Ce,2);{var $=H=>{const U=yt(()=>(e(I),n(()=>Y(e(I).name)))),Z=yt(()=>(e(I),n(()=>F(e(I).name))));var B=cn(),Fe=l(B);let De;var Xe=l(Fe);s(Fe);var $e=a(Fe,2);{var m=oe=>{var te=on();w(()=>{te.disabled=e(U)===0,nt(te,"aria-label",`Use ${e(I),n(()=>e(I).name)??""}`)}),A("click",te,()=>y(e(I).name)),o(oe,te)};b($e,oe=>{v()||oe(m)})}s(B),w(()=>{De=At(Fe,1,"uses-count svelte-19b5nmj",null,De,{depleted:e(U)===0}),k(Xe,`${e(U)??""}/${e(Z)??""} uses`)}),o(H,B)},N=H=>{var U=vn();o(H,U)};b(Qe,H=>{e(I),n(()=>re(e(I)))?H($):H(N,!1)})}var ge=a(Qe,2),xe=l(ge);{var _=H=>{var U=dn(),Z=l(U);s(U),w(()=>k(Z,`Recharges on ${e(I),n(()=>e(I).restType==="short"?"Short":"Long")??""} Rest`)),o(H,U)};b(xe,H=>{e(I),n(()=>e(I).restType)&&H(_)})}var O=a(xe,2);{var ie=H=>{var U=un(),Z=l(U);s(U),w(B=>k(Z,`Spellcasting: ${B??""}`),[()=>(e(Be),n(()=>e(Be).spellcastingAbility.toUpperCase()))]),o(H,U)};b(O,H=>{e(Be),n(()=>e(Be).spellcastingAbility)&&H(ie)})}var he=a(O,2);{var ee=H=>{var U=fn();o(H,U)};b(he,H=>{e(Be),n(()=>e(Be).componentsRequired===!1)&&H(ee)})}s(ge),s(Me),w(()=>k(fe,(e(I),n(()=>e(I).name)))),o(T,Me)}),s(g),s(W),o(x,W)};b(M,x=>{e(Be),e(L),n(()=>e(Be).spells&&e(L).length>0)&&x(E)})}s(Q),w(()=>{k(be,(e(Be),n(()=>e(Be).name))),k(Te,(e(Be),n(()=>e(Be).description)))}),o(Ee,Q)}),s(P),o(R,P)};b(le,R=>{e(h)&&e(f)&&R(ne)})}o(i,X),Wt(),p()}var _n=d('<p class="no-features svelte-1kpvv0n">Select a class to see available features</p>'),yn=d('<p class="no-features svelte-1kpvv0n">No class features available at this level</p>'),xn=d('<div class="spell-slots svelte-1kpvv0n"><label class="svelte-1kpvv0n"> </label> <div class="slots-tracker svelte-1kpvv0n"></div></div>'),$n=d('<div class="all-spell-slots"></div>'),kn=d('<div class="feature-box spellcasting svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"> </h3> <div class="spell-stats svelte-1kpvv0n"><div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Spell Save DC</label> <div class="spell-value svelte-1kpvv0n"> </div></div> <div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <div class="spell-value svelte-1kpvv0n"> </div></div></div> <!> <div class="prepared-spells svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <textarea placeholder="List your prepared spells..." class="svelte-1kpvv0n"></textarea></div></div>'),wn=d('<p class="unlimited svelte-1kpvv0n">Unlimited Uses</p>'),Sn=d('<div class="slots-tracker svelte-1kpvv0n"></div> <div class="uses-actions-row"><button class="btn btn-primary use-enabled"> </button></div> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div>',1),Cn=d('<div class="uses-tracker svelte-1kpvv0n"><!></div>'),Dn=d('<div class="pool-tracker svelte-1kpvv0n"><input type="number" min="0" class="pool-input svelte-1kpvv0n"/> <span> </span> <button class="btn-small svelte-1kpvv0n"> </button></div>'),Ln=d('<p class="no-uses svelte-1kpvv0n">No Channel Divinity uses remaining</p>'),jn=d('<div class="channel-divinity-option svelte-1kpvv0n"><button class="btn btn-primary use-enabled svelte-1kpvv0n">Use Channel Divinity</button> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div> <!></div>'),An=d('<div class="feature-box svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"><!> </h3> <p class="feature-description svelte-1kpvv0n"> </p> <!></div>'),Bn=d('<div class="features-grid svelte-1kpvv0n"><!> <!></div>'),Rn=d("<!> <!>",1),Tn=d("<section><!> <!></section>");function Mn(i,c){zt(c,!1);const t=()=>ut(me,"$character",f),v=()=>ut(Ga,"$abilityModifiers",f),u=()=>ut(ga,"$searchFilter",f),p=()=>ut(Qt,"$collapsedStates",f),[f,L]=na(),h=C(),y=C(),Y=C(),F=C(),re=C(),X=C(),le=C();let ne=C(0),R=C(0);function P(g,T){me.update(I=>(I.classFeatures.features[g]=T,I))}function pe(){me.update(g=>(g.classFeatures.spellSlotsByLevel||(g.classFeatures.spellSlotsByLevel={}),e(F).forEach(({level:T,slots:I})=>{g.classFeatures.spellSlotsByLevel[T]||(g.classFeatures.spellSlotsByLevel[T]=Array(I).fill(!1))}),g))}function Ee(g){if(typeof g.maxUses=="function"){if((g.name==="Divine Sense"||g.name==="War Priest")&&e(h)?.spellcastingAbility){const T=v()[e(h).spellcastingAbility];return g.maxUses(t().level,T)}return g.maxUses(t().level)}return g.maxUses||0}function Be(g,T){me.update(I=>((!I.classFeatures.features[g]||!Array.isArray(I.classFeatures.features[g])||I.classFeatures.features[g].length!==T)&&(I.classFeatures.features[g]=Array(T).fill(!1)),I))}Es(()=>{e(X)&&t()&&t().classFeatures&&t().classFeatures.features&&e(X).forEach(g=>{if(g.type==="uses"){const T=g.name.replace(/\s+/g,""),I=Ee(g),Me=t().classFeatures.features[T];(!Array.isArray(Me)||Me.length!==I)&&Be(T,I)}})});function Q(g){return typeof g.maxPool=="function"?g.maxPool(t().level):g.maxPool||0}function Re(g){return typeof g.description=="function"?g.description(t().level):g.description}function be(){const g="ChannelDivinity";me.update(T=>{const I=T.classFeatures.features[g];return typeof I=="number"&&I>0&&(T.classFeatures.features[g]=I-1),T})}function ye(){Qt.update(g=>({...g,classFeatures:!g.classFeatures}))}tt(()=>(t(),ia),()=>{r(h,t().class?ia(t().class):null)}),tt(()=>(t(),wa),()=>{r(y,t().class?wa(t().class,t().level,t().subclass):[])}),tt(()=>(t(),_s),()=>{r(Y,t().class?_s(t().class,t().level):0)}),tt(()=>(e(h),t()),()=>{r(F,(()=>{if(!e(h)?.spellcaster)return[];const g=t().level,T=[];return g>=1&&T.push({level:1,slots:Math.min(4,2+Math.floor(g/3))}),g>=3&&T.push({level:2,slots:Math.min(3,2+Math.floor((g-3)/4))}),g>=5&&T.push({level:3,slots:Math.min(3,2+Math.floor((g-5)/5))}),g>=7&&T.push({level:4,slots:Math.min(3,1+Math.floor((g-7)/6))}),g>=9&&T.push({level:5,slots:Math.min(2,1+Math.floor((g-9)/8))}),g>=11&&T.push({level:6,slots:1}),g>=13&&T.push({level:7,slots:1}),g>=15&&T.push({level:8,slots:1}),g>=17&&T.push({level:9,slots:1}),T})())}),tt(()=>(e(h),v(),t(),ys),()=>{if(e(h)?.spellcaster&&e(h).spellcastingAbility){const g=v()[e(h).spellcastingAbility];r(ne,hl(t().class,g,t().proficiencyBonus)||0),r(R,ys(t().class,t().level,g))}}),tt(()=>(t(),e(h),e(F)),()=>{t().class&&e(h)?.spellcaster&&e(F).length>0&&pe()}),tt(()=>t(),()=>{r(re,(()=>{const T=t().classFeatures.features["ChannelDivinity"];return typeof T=="number"?T:0})())}),tt(()=>(e(y),u()),()=>{r(X,e(y).filter(g=>{if(!u())return!0;const T=u().toLowerCase();return g.name.toLowerCase().includes(T)||Re(g).toLowerCase().includes(T)}))}),tt(()=>(u(),t(),e(X)),()=>{r(le,!u()||t().class||"class features".includes(u().toLowerCase())||"spellcasting".includes(u().toLowerCase())||e(X).length>0)}),va(),qt();var Te=Tn();let M;var E=l(Te);{let g=yt(()=>(p(),n(()=>p().classFeatures?"Expand":"Collapse")));_a(E,{title:"Class Features",get collapsed(){return p(),n(()=>p().classFeatures)},get ariaLabel(){return e(g)},onToggle:ye})}var x=a(E,2);{var W=g=>{var T=Rn(),I=Le(T);hn(I,{});var Me=a(I,2);{var Ce=fe=>{var Ae=_n();o(fe,Ae)},de=fe=>{var Ae=gt(),Je=Le(Ae);{var ot=dt=>{var Qe=yn();o(dt,Qe)},ht=dt=>{var Qe=Bn(),$=l(Qe);{var N=xe=>{var _=kn(),O=l(_),ie=l(O);s(O);var he=a(O,2),ee=l(he),H=a(l(ee),2),U=l(H,!0);s(H),s(ee);var Z=a(ee,2),B=a(l(Z),2),Fe=l(B,!0);s(B),s(Z),s(he);var De=a(he,2);{var Xe=oe=>{var te=$n();xt(te,5,()=>e(F),Ct,(z,Ne)=>{let Pe=()=>e(Ne).level,we=()=>e(Ne).slots;const Ue=yt(()=>(t(),Pe(),we(),n(()=>t().classFeatures.spellSlotsByLevel?.[Pe()]||Array(we()).fill(!1))));var ce=xn(),Ie=l(ce),_e=l(Ie);s(Ie);var Ye=a(Ie,2);xt(Ye,5,()=>e(Ue),Ct,(Ge,rt,ct)=>{{let ve=yt(()=>(J(e(Ue)),n(()=>e(Ue)[ct]||!1)));ks(Ge,{get checked(){return e(ve)},$$events:{change:D=>{me.update(G=>(G.classFeatures.spellSlotsByLevel||(G.classFeatures.spellSlotsByLevel={}),G.classFeatures.spellSlotsByLevel[Pe()]||(G.classFeatures.spellSlotsByLevel[Pe()]=Array(we()).fill(!1)),G.classFeatures.spellSlotsByLevel[Pe()][ct]=D.detail.checked,G))}}})}}),s(Ye),s(ce),w(()=>k(_e,`${Pe()===1?"1st":Pe()===2?"2nd":Pe()===3?"3rd":`${Pe()}th`} Level Spell Slots`)),o(z,ce)}),s(te),o(oe,te)};b(De,oe=>{e(F),n(()=>e(F).length>0)&&oe(Xe)})}var $e=a(De,2),m=a(l($e),2);xa(m),s($e),s(_),w(oe=>{k(ie,`Spellcasting (${oe??""})`),k(U,e(ne)),k(Fe,e(R))},[()=>(e(h),n(()=>e(h).spellcastingAbility?.toUpperCase()))]),Oe(m,()=>t().classFeatures.preparedSpells,oe=>Pt(me,n(t).classFeatures.preparedSpells=oe,n(t))),o(xe,_)};b($,xe=>{e(h),n(()=>e(h)?.spellcaster)&&xe(N)})}var ge=a($,2);xt(ge,1,()=>e(X),Ct,(xe,_)=>{const O=yt(()=>(e(_),n(()=>e(_).name.replace(/\s+/g,"")))),ie=yt(()=>(t(),J(e(O)),n(()=>t().classFeatures.features[e(O)]))),he=yt(()=>typeof e(ie)=="number");var ee=An(),H=l(ee),U=l(H);{var Z=oe=>{var te=Rt("Channel Divinity:");o(oe,te)};b(U,oe=>{e(_),n(()=>e(_).type==="channelDivinity")&&oe(Z)})}var B=a(U);s(H);var Fe=a(H,2),De=l(Fe,!0);s(Fe);var Xe=a(Fe,2);{var $e=oe=>{const te=yt(()=>(e(_),n(()=>Ee(e(_))))),z=yt(()=>(J(e(ie)),J(e(te)),n(()=>Array.isArray(e(ie))?e(ie):Array(e(te)).fill(!1))));var Ne=Cn(),Pe=l(Ne);{var we=ce=>{var Ie=wn();o(ce,Ie)},Ue=ce=>{var Ie=Sn(),_e=Le(Ie);xt(_e,5,()=>e(z),Ct,(G,V,K)=>{ks(G,{get checked(){return e(V)},index:K,$$events:{change:ke=>{me.update(qe=>(qe.classFeatures.features[e(O)]||(qe.classFeatures.features[e(O)]=Array(e(te)).fill(!1)),qe.classFeatures.features[e(O)][K]=ke.detail.checked,qe))}}})}),s(_e);var Ye=a(_e,2),Ge=l(Ye),rt=l(Ge);s(Ge),s(Ye);var ct=a(Ye,2),ve=l(ct),D=l(ve);s(ve),s(ct),w(G=>{Ge.disabled=G,k(rt,`Use ${e(_),n(()=>e(_).name)??""}`),k(D,`Resets on ${e(_),n(()=>e(_).resetOn==="short"?"Short Rest":"Long Rest")??""}`)},[()=>(J(e(z)),n(()=>e(z).filter(G=>!G).length<=0))]),A("click",Ge,()=>{me.update(G=>{G.classFeatures.features[e(O)]||(G.classFeatures.features[e(O)]=Array(e(te)).fill(!1));const V=G.classFeatures.features[e(O)],K=V.findIndex(ke=>!ke);return K!==-1&&(V[K]=!0),G})}),o(ce,Ie)};b(Pe,ce=>{e(te)===1/0?ce(we):ce(Ue,!1)})}s(Ne),o(oe,Ne)},m=oe=>{var te=gt(),z=Le(te);{var Ne=we=>{const Ue=yt(()=>(e(_),n(()=>Q(e(_)))));var ce=Dn(),Ie=l(ce);je(Ie);var _e=a(Ie,2),Ye=l(_e);s(_e);var Ge=a(_e,2),rt=l(Ge,!0);s(Ge),s(ce),w(()=>{Aa(Ie,e(he)&&e(ie)!==void 0?e(ie):e(Ue)),nt(Ie,"max",e(Ue)),k(Ye,`/ ${e(Ue)??""}`),k(rt,(e(_),n(()=>e(_).resetOn==="short"?"Short Rest":"Long Rest")))}),A("input",Ie,ct=>{me.update(ve=>(ve.classFeatures.features[e(O)]=parseInt(ct.currentTarget.value)||0,ve))}),A("click",Ge,()=>P(e(O),e(Ue))),o(we,ce)},Pe=we=>{var Ue=gt(),ce=Le(Ue);{var Ie=_e=>{var Ye=jn(),Ge=l(Ye),rt=a(Ge,2),ct=l(rt),ve=l(ct);s(ct),s(rt);var D=a(rt,2);{var G=V=>{var K=Ln();o(V,K)};b(D,V=>{e(re)<=0&&V(G)})}s(Ye),w(()=>{Ge.disabled=e(re)<=0,k(ve,`Resets on ${e(_),n(()=>e(_).resetOn==="short"?"Short Rest":"Long Rest")??""}`)}),A("click",Ge,be),o(_e,Ye)};b(ce,_e=>{e(_),n(()=>e(_).type==="channelDivinity")&&_e(Ie)},!0)}o(we,Ue)};b(z,we=>{e(_),n(()=>e(_).type==="pool")?we(Ne):we(Pe,!1)},!0)}o(oe,te)};b(Xe,oe=>{e(_),n(()=>e(_).type==="uses")?oe($e):oe(m,!1)})}s(ee),w(oe=>{k(B,` ${e(_),n(()=>e(_).name)??""}`),k(De,oe)},[()=>(e(_),n(()=>Re(e(_))))]),o(xe,ee)}),s(Qe),o(dt,Qe)};b(Je,dt=>{e(y),n(()=>e(y).length===0)?dt(ot):dt(ht,!1)},!0)}o(fe,Ae)};b(Me,fe=>{t(),n(()=>!t().class)?fe(Ce):fe(de,!1)})}o(g,T)};b(x,g=>{p(),n(()=>!p().classFeatures)&&g(W)})}s(Te),w(()=>M=At(Te,1,"class-features svelte-1kpvv0n",null,M,{hidden:!e(le)})),o(i,Te),Wt(),L()}var Fn=d('<textarea placeholder="Enter features, traits, and special abilities..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Equipment</h3> <textarea placeholder="List your equipment and inventory..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Notes</h3> <textarea placeholder="Additional notes..." class="svelte-wttn0l"></textarea>',1),Pn=d("<section><!> <!></section>");function In(i,c){zt(c,!1);const t=()=>ut(ga,"$searchFilter",p),v=()=>ut(me,"$character",p),u=()=>ut(Qt,"$collapsedStates",p),[p,f]=na(),L=C();function h(){Qt.update(le=>({...le,notes:!le.notes}))}tt(()=>(t(),v()),()=>{r(L,!t()||"features".includes(t().toLowerCase())||"traits".includes(t().toLowerCase())||"equipment".includes(t().toLowerCase())||"notes".includes(t().toLowerCase())||v().features.toLowerCase().includes(t().toLowerCase())||v().equipment.toLowerCase().includes(t().toLowerCase())||v().notes.toLowerCase().includes(t().toLowerCase()))}),va(),qt();var y=Pn();let Y;var F=l(y);{let le=yt(()=>(u(),n(()=>u().notes?"Expand":"Collapse")));_a(F,{title:"Features & Traits",get collapsed(){return u(),n(()=>u().notes)},get ariaLabel(){return e(le)},onToggle:h})}var re=a(F,2);{var X=le=>{var ne=Fn(),R=Le(ne);xa(R);var P=a(R,4);xa(P);var pe=a(P,4);xa(pe),Oe(R,()=>v().features,Ee=>Pt(me,n(v).features=Ee,n(v))),Oe(P,()=>v().equipment,Ee=>Pt(me,n(v).equipment=Ee,n(v))),Oe(pe,()=>v().notes,Ee=>Pt(me,n(v).notes=Ee,n(v))),o(le,ne)};b(re,le=>{u(),n(()=>!u().notes)&&le(X)})}s(y),w(()=>Y=At(y,1,"notes svelte-wttn0l",null,Y,{hidden:!e(L)})),o(i,y),Wt(),f()}var En=d(" <!> <!> <!> <!> <!>",1),Un=d('<div class="color-picker-section svelte-1r90jgp"><h3 class="svelte-1r90jgp">Dice Colors</h3> <div class="color-inputs svelte-1r90jgp"><div class="color-input-group svelte-1r90jgp"><label for="dice-color" class="svelte-1r90jgp">Dice Color</label> <input type="color" id="dice-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="label-color" class="svelte-1r90jgp">Label Color</label> <input type="color" id="label-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="desk-color" class="svelte-1r90jgp">Background Color</label> <input type="color" id="desk-color" class="svelte-1r90jgp"/></div></div></div>'),Hn=d('<div class="loading svelte-1r90jgp"><p class="svelte-1r90jgp">Loading 3D dice...</p></div>'),Nn=d('<div class="custom-dice-selector svelte-1r90jgp"><h3 class="svelte-1r90jgp">Choose Dice to Roll</h3> <div class="dice-inputs svelte-1r90jgp"><div class="dice-input-group svelte-1r90jgp"><label for="d4" class="svelte-1r90jgp">d4</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d4" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d6" class="svelte-1r90jgp">d6</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d6" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d8" class="svelte-1r90jgp">d8</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d8" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d10" class="svelte-1r90jgp">d10</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d10" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d12" class="svelte-1r90jgp">d12</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d12" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d20" class="svelte-1r90jgp">d20</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d20" min="0" max="10"/></div></div> <div class="dice-controls svelte-1r90jgp"><button class="btn btn-primary use-enabled svelte-1r90jgp"> </button> <button class="btn btn-secondary use-enabled svelte-1r90jgp">Reset</button></div></div>'),On=d('<h3 class="svelte-1r90jgp"> </h3>'),Gn=d('<h3 class="svelte-1r90jgp"> </h3>'),qn=d('<h3 class="svelte-1r90jgp"> </h3>'),zn=d('<h3 class="svelte-1r90jgp"> </h3>'),Wn=d('<span class="crit-badge svelte-1r90jgp">CRITICAL HIT!</span>'),Kn=d('<span class="crit-badge crit-fail svelte-1r90jgp">CRITICAL MISS!</span>'),Vn=d('<div class="bonus-item svelte-1r90jgp"><span class="bonus-value svelte-1r90jgp"> </span> <span class="bonus-source svelte-1r90jgp"> </span></div>'),Jn=d('<div class="bonus-breakdown svelte-1r90jgp"></div>'),Yn=d('<p class="modifier-text svelte-1r90jgp"> </p>'),Qn=d('<div class="svelte-1r90jgp"><em class="svelte-1r90jgp">No damage is dealt on a critical miss.</em></div>'),Xn=d('<button class="btn btn-follow-up svelte-1r90jgp"> </button>'),Zn=d('<button class="btn btn-guided-strike svelte-1r90jgp">‚ö° Use Guided Strike (+10)</button>'),er=d('<div class="follow-up-actions svelte-1r90jgp"><!> <!></div>'),tr=d('<div class="result-header svelte-1r90jgp"><!> <!> <!></div> <div class="result-total svelte-1r90jgp"> </div> <div class="result-details svelte-1r90jgp"><!></div> <!> <!>',1),ar=d('<div role="button" tabindex="-1"><div class="modal-content svelte-1r90jgp" role="dialog" tabindex="0"><div class="modal-header svelte-1r90jgp"><h2 class="svelte-1r90jgp"><!></h2> <div class="header-buttons svelte-1r90jgp"><button class="color-btn svelte-1r90jgp" title="Customize dice colors">üé®</button> <button class="close-btn svelte-1r90jgp">√ó</button></div></div> <!> <!> <div class="dice-main-area svelte-1r90jgp"><div class="dice-container svelte-1r90jgp"></div> <!></div> <div><!></div></div></div>');function sr(i,c){zt(c,!1);const t=()=>ut(me,"$character",v),[v,u]=na(),p=C(),f=C(),L=C(),h=ha();let y=St(c,"notation",12,""),Y=St(c,"visible",8,!1),F=St(c,"damageNotation",12,""),re=St(c,"damageType",8,""),X=St(c,"attackName",12,""),le=St(c,"applyHalfDamage",8,!1),ne=St(c,"bonusBreakdown",28,()=>[]),R=St(c,"rollType",12,"other"),P=null,pe=C(void 0),Ee=C(!1),Be=C(""),Q=C(null);function Re(){return e(Q)?.resultTotal??null}function be(D,G,V){const K=[];if(!D||!D.result)return K;const ke=G.match(/([+-]?\d*d\d+|[+-]?\d+)/g)||[];let qe=0;const st=new Set;for(const ze of ke){const Ke=ze.trim();if(!Ke)continue;const ue=Ke.match(/([+-]?)(\d*)d(\d+)/);if(ue){const q=parseInt(ue[2]||"1"),He=`${q}d${ue[3]}`,ft=V.findIndex((ae,j)=>!st.has(j)&&typeof ae.value=="string"&&ae.value===He),Ze=[];for(let ae=0;ae<q&&qe<D.result.length;ae++)Ze.push(D.result[qe++]);const lt=ft>=0?V[ft].source:"base die";ft>=0&&st.add(ft);for(const ae of Ze)K.push({display:`${ae}`,source:lt})}}for(let ze=0;ze<V.length;ze++)if(!st.has(ze)&&typeof V[ze].value=="number"){const Ke=V[ze].value;K.push({display:Ke>=0?`+${Ke}`:`${Ke}`,source:V[ze].source})}return K}let ye=C(0),Te=C(0),M=C(0),E=C(0),x=C(0),W=C(0),g=C(0),T=C([]),I=C(!1),Me=C(!1),Ce=C(!1),de=C("#051e0a"),fe=C("#ffffff"),Ae=C("#3a2004"),Je=C(!1);function ot(D){return D.length===9&&D.startsWith("#")?D.substring(0,7):D}function ht(D,G="ff"){return D.length===7&&D.startsWith("#")?D+G:D}function dt(){if(window.DICE&&e(pe))try{P&&e(pe)&&pa(pe,e(pe).innerHTML="");const D=e(pe).clientWidth||500,G=e(pe).clientHeight||300;P=new window.DICE.dice_box(e(pe),{w:D,h:G}),r(Ee,!0)}catch(D){console.error("Error initializing dice box:",D)}}Sa(()=>{const D=K=>new Promise((ke,qe)=>{if(document.querySelector(`script[src="${K}"]`)){ke(null);return}const ze=document.createElement("script");ze.src=K,ze.onload=()=>{ke(null)},ze.onerror=()=>{console.error(`Failed to load: ${K}`),qe(new Error(`Failed to load ${K}`))},document.head.appendChild(ze)});setTimeout(()=>{D(`${La}/libs/three.min.js`).then(()=>D(`${La}/libs/cannon.min.js`)).then(()=>D(`${La}/libs/teal.js`)).then(()=>D(`${La}/dice.js`)).then(()=>{if(window.DICE){const K=window.DICE.getColors();r(de,ot(K.dice_color)),r(fe,ot(K.label_color)),r(Ae,ot(K.desk_color))}dt()}).catch(K=>{console.error("Failed to load dice libraries:",K)})},100);const G=()=>{e(Ee)&&dt()},V=K=>{Y()&&K.key==="Escape"&&he()};return window.addEventListener("resize",G),window.addEventListener("keydown",V),()=>{window.removeEventListener("resize",G),window.removeEventListener("keydown",V)}});function Qe(D,G="other"){if(!P||!e(Ee))return;r(Q,null),r(T,[]),r(I,!1),r(Me,!1),G==="damage"&&ne([]),R(G),r(Ce,!1),P.diceToRoll=D;const V=ke=>null,K=ke=>{let qe=ke.resultTotal,st=ke.resultString;if(le()&&(qe=Math.floor(qe/2),st=st+" (halved)"),r(Q,{...ke,resultTotal:qe,resultString:st}),console.log("Final roll result:",e(Q)),console.log({type:G}),G==="attack"&&ke.result&&ke.result.length>0){const ze=ke.result[0];r(I,ze===20),r(Me,ze===1)}if(r(T,[]),console.log("Setting up follow-up actions. Type:",G,"damageNotation:",F(),"isCriticalSuccess:",e(I),"isCriticalFail:",e(Me)),G==="attack"&&F())if(e(I)){const ze=ge(F());e(T).push({label:`Roll Critical Damage (${ze})`,notation:ze})}else e(Me)||e(T).push({label:`Roll Damage (${F()})`,notation:F()})};P.start_throw(V,K)}function $(){const D=[];e(ye)>0&&D.push(`${e(ye)}d4`),e(Te)>0&&D.push(`${e(Te)}d6`),e(M)>0&&D.push(`${e(M)}d8`),e(E)>0&&D.push(`${e(E)}d10`),e(x)>0&&D.push(`${e(x)}d12`),e(W)>0&&D.push(`${e(W)}d20`);let G=D.join("+")||"1d20";return e(g)!==0&&(G+=e(g)>=0?`+${e(g)}`:`${e(g)}`),G}function N(){const D=$();Qe(D)}function ge(D){return D.replace(/(\d+)d(\d+)/g,(G,V,K)=>`${parseInt(V)*2}d${K}`)}function xe(){r(ye,0),r(Te,0),r(M,0),r(E,0),r(x,0),r(W,0),r(g,0),r(Q,null),r(T,[]),r(I,!1),r(Me,!1),R("other"),r(Ce,!1)}function _(){window.DICE&&(window.DICE.setColors({dice_color:ht(e(de),"ff"),label_color:ht(e(fe),"ff"),desk_color:e(Ae)}),P&&(P.updateDeskColor(e(Ae)),P.updateDiceColors()))}function O(){r(Je,!e(Je))}function ie(){!e(Q)||e(f)<=0||e(Ce)||(r(Q,{...e(Q),resultTotal:e(Q).resultTotal+10,resultString:e(Q).resultString+" + 10 (Guided Strike)"}),me.update(D=>{const G="ChannelDivinity",V=D.classFeatures.features[G];return typeof V=="number"&&V>0&&(D.classFeatures.features[G]=V-1),D}),r(Ce,!0))}function he(){h("close"),y(""),F(""),X(""),r(Be,""),r(Q,null),r(Ce,!1),r(I,!1),r(Me,!1),xe()}tt(()=>(t(),wa),()=>{r(p,t().class?wa(t().class,t().level,t().subclass).some(G=>G.name==="Guided Strike"):!1)}),tt(()=>t(),()=>{r(f,(()=>{const G=t().classFeatures.features["ChannelDivinity"];return typeof G=="number"?G:0})())}),tt(()=>(e(ye),e(Te),e(M),e(E),e(x),e(W),e(g)),()=>{r(L,(()=>{const D=[];e(ye)>0&&D.push(`${e(ye)}d4`),e(Te)>0&&D.push(`${e(Te)}d6`),e(M)>0&&D.push(`${e(M)}d8`),e(E)>0&&D.push(`${e(E)}d10`),e(x)>0&&D.push(`${e(x)}d12`),e(W)>0&&D.push(`${e(W)}d20`);let G=D.join("+")||"1d20";return e(g)!==0&&(G+=e(g)>=0?`+${e(g)}`:`${e(g)}`),G})())}),tt(()=>(J(y()),e(Ee),J(Y()),e(Be),J(F()),J(X()),J(R())),()=>{y()&&e(Ee)&&Y()&&y()!==e(Be)&&(r(Be,y()),r(Q,null),r(T,[]),r(I,!1),r(Me,!1),r(Ce,!1),console.log("Auto-roll triggered. notation:",y(),"damageNotation:",F(),"attackName:",X(),"rollType:",R()),setTimeout(()=>Qe(y(),R()),200))}),va();var ee={getLastRollTotal:Re};qt();var H=ar();let U;var Z=l(H),B=l(Z),Fe=l(B),De=l(Fe);{var Xe=D=>{var G=En(),V=Le(G),K=a(V);{var ke=Ze=>{var lt=Rt("- Attack Roll");o(Ze,lt)};b(K,Ze=>{R()==="attack"&&Ze(ke)})}var qe=a(K,2);{var st=Ze=>{var lt=Rt("- Damage Roll");o(Ze,lt)};b(qe,Ze=>{R()==="damage"&&Ze(st)})}var ze=a(qe,2);{var Ke=Ze=>{var lt=Rt("- Healing Roll");o(Ze,lt)};b(ze,Ze=>{R()==="healing"&&Ze(Ke)})}var ue=a(ze,2);{var q=Ze=>{var lt=Rt("- Ability Check");o(Ze,lt)};b(ue,Ze=>{R()==="check"&&Ze(q)})}var He=a(ue,2);{var ft=Ze=>{var lt=Rt("- Saving Throw");o(Ze,lt)};b(He,Ze=>{R()==="save"&&Ze(ft)})}w(()=>k(V,`${X()??""} `)),o(D,G)},$e=D=>{var G=Rt("Dice Roller");o(D,G)};b(De,D=>{X()?D(Xe):D($e,!1)})}s(Fe);var m=a(Fe,2),oe=l(m),te=a(oe,2);s(m),s(B);var z=a(B,2);{var Ne=D=>{var G=Un(),V=a(l(G),2),K=l(V),ke=a(l(K),2);je(ke),s(K);var qe=a(K,2),st=a(l(qe),2);je(st),s(qe);var ze=a(qe,2),Ke=a(l(ze),2);je(Ke),s(ze),s(V),s(G),Oe(ke,()=>e(de),ue=>r(de,ue)),A("change",ke,_),Oe(st,()=>e(fe),ue=>r(fe,ue)),A("change",st,_),Oe(Ke,()=>e(Ae),ue=>r(Ae,ue)),A("change",Ke,_),o(D,G)};b(z,D=>{e(Je)&&D(Ne)})}var Pe=a(z,2);{var we=D=>{var G=Hn();o(D,G)};b(Pe,D=>{e(Ee)||D(we)})}var Ue=a(Pe,2),ce=l(Ue);Ba(ce,D=>r(pe,D),()=>e(pe));var Ie=a(ce,2);{var _e=D=>{var G=Nn(),V=a(l(G),2),K=l(V),ke=a(l(K),2);je(ke),s(K);var qe=a(K,2),st=a(l(qe),2);je(st),s(qe);var ze=a(qe,2),Ke=a(l(ze),2);je(Ke),s(ze);var ue=a(ze,2),q=a(l(ue),2);je(q),s(ue);var He=a(ue,2),ft=a(l(He),2);je(ft),s(He);var Ze=a(He,2),lt=a(l(Ze),2);je(lt),s(Ze),s(V);var ae=a(V,2),j=l(ae),Ve=l(j);s(j);var at=a(j,2);s(ae),s(G),w(()=>{j.disabled=!e(Ee),k(Ve,`Roll ${e(L)??""}`)}),Oe(ke,()=>e(ye),se=>r(ye,se)),Oe(st,()=>e(Te),se=>r(Te,se)),Oe(Ke,()=>e(M),se=>r(M,se)),Oe(q,()=>e(E),se=>r(E,se)),Oe(ft,()=>e(x),se=>r(x,se)),Oe(lt,()=>e(W),se=>r(W,se)),A("click",j,N),A("click",at,xe),o(D,G)};b(Ie,D=>{y()||D(_e)})}s(Ue);var Ye=a(Ue,2);let Ge;var rt=l(Ye);{var ct=D=>{var G=tr(),V=Le(G),K=l(V);{var ke=se=>{var S=On(),pt=l(S,!0);s(S),w(()=>k(pt,X()?`${X()} - Healing`:"Healing")),o(se,S)},qe=se=>{var S=gt(),pt=Le(S);{var bt=Se=>{var We=Gn(),et=l(We,!0);s(We),w(()=>k(et,X()?`${X()} - ${re()} Damage`:`${re()} Damage`)),o(Se,We)},jt=Se=>{var We=gt(),et=Le(We);{var Lt=mt=>{var it=qn(),Tt=l(it,!0);s(it),w(()=>k(Tt,X()?`${X()} - Damage`:"Damage")),o(mt,it)},$t=mt=>{var it=zn(),Tt=l(it,!0);s(it),w(()=>k(Tt,X()?`${X()} - Result`:"Result")),o(mt,it)};b(et,mt=>{R()==="damage"?mt(Lt):mt($t,!1)},!0)}o(Se,We)};b(pt,Se=>{R()==="damage"&&re()?Se(bt):Se(jt,!1)},!0)}o(se,S)};b(K,se=>{R()==="damage"&&re()==="Healing"?se(ke):se(qe,!1)})}var st=a(K,2);{var ze=se=>{var S=Wn();o(se,S)};b(st,se=>{e(I)&&se(ze)})}var Ke=a(st,2);{var ue=se=>{var S=Kn();o(se,S)};b(Ke,se=>{e(Me)&&se(ue)})}s(V);var q=a(V,2),He=l(q,!0);s(q);var ft=a(q,2),Ze=l(ft);{var lt=se=>{var S=gt(),pt=Le(S);{var bt=Se=>{var We=Jn();xt(We,5,()=>(e(Q),J(y()),J(ne()),n(()=>be(e(Q),y(),ne()))),Ct,(et,Lt)=>{var $t=Vn(),mt=l($t),it=l(mt,!0);s(mt);var Tt=a(mt,2),ea=l(Tt);s(Tt),s($t),w(()=>{k(it,(e(Lt),n(()=>e(Lt).display))),k(ea,`(${e(Lt),n(()=>e(Lt).source)??""})`)}),o(et,$t)}),s(We),o(Se,We)},jt=Se=>{var We=gt(),et=Le(We);{var Lt=$t=>{var mt=Yn(),it=l(mt);s(mt),w(()=>k(it,`Modifier: ${e(Q),n(()=>e(Q).constant>=0?"+":"")??""}${e(Q),n(()=>e(Q).constant)??""}`)),o($t,mt)};b(et,$t=>{e(Q),n(()=>e(Q).constant)&&$t(Lt)},!0)}o(Se,We)};b(pt,Se=>{J(ne()),n(()=>ne().length>0)?Se(bt):Se(jt,!1)})}o(se,S)};b(Ze,se=>{e(Q),J(ne()),n(()=>e(Q).constant||ne().length>0)&&se(lt)})}s(ft);var ae=a(ft,2);{var j=se=>{var S=Qn();o(se,S)};b(ae,se=>{e(Me)&&se(j)})}var Ve=a(ae,2);{var at=se=>{var S=er(),pt=l(S);xt(pt,1,()=>e(T),Ct,(Se,We)=>{var et=Xn(),Lt=l(et,!0);s(et),w(()=>k(Lt,(e(We),n(()=>e(We).label)))),A("click",et,()=>Qe(e(We).notation,"damage")),o(Se,et)});var bt=a(pt,2);{var jt=Se=>{var We=Zn();w(()=>{We.disabled=e(f)<=0,nt(We,"title",e(f)<=0?"No Channel Divinity uses remaining":"Use Channel Divinity to add +10 to this attack roll")}),A("click",We,ie),o(Se,We)};b(bt,Se=>{e(p)&&R()==="attack"&&!e(Ce)&&e(f)>0&&!e(Me)&&Se(jt)})}s(S),o(se,S)};b(Ve,se=>{e(T),e(p),J(R()),e(Ce),e(f),n(()=>e(T).length>0||e(p)&&R()==="attack"&&!e(Ce)&&e(f)>0)&&se(at)})}w(()=>k(He,(e(Q),n(()=>e(Q).resultTotal)))),o(D,G)};b(rt,D=>{e(Q)&&D(ct)})}s(Ye),s(Z),s(H),w(()=>{U=At(H,1,"modal-overlay svelte-1r90jgp",null,U,{hidden:!Y()}),Ge=At(Ye,1,"roll-result svelte-1r90jgp",null,Ge,{"has-result":e(Q)})}),A("click",oe,O),A("click",te,he),A("click",Z,cs(function(D){ka.call(this,c,D)})),A("keydown",Z,function(D){ka.call(this,c,D)}),A("click",H,he),A("keydown",H,D=>D.key==="Escape"&&he()),o(i,H),gl(c,"getLastRollTotal",Re);var ve=Wt(ee);return u(),ve}const qa="https://api.github.com/gists";async function lr(i,c,t){if(!c)throw new Error("GitHub token is required");const v=JSON.stringify(i,null,2),u=`${i.name||"character"}_dnd.json`,p={description:t||`D&D Character: ${i.name}`,public:!1,files:{[u]:{content:v}}},f=await fetch(qa,{method:"POST",headers:{Authorization:`token ${c}`,"Content-Type":"application/json"},body:JSON.stringify(p)});if(!f.ok)throw new Error(`Failed to create gist: ${f.statusText}`);return(await f.json()).id}async function ir(i,c,t){if(!c||!t)throw new Error("GitHub token and Gist ID are required");const v=JSON.stringify(i,null,2),p={files:{[`${i.name||"character"}_dnd.json`]:{content:v}}},f=await fetch(`${qa}/${t}`,{method:"PATCH",headers:{Authorization:`token ${c}`,"Content-Type":"application/json"},body:JSON.stringify(p)});if(!f.ok)throw new Error(`Failed to update gist: ${f.statusText}`)}async function nr(i,c){if(!i)throw new Error("Gist ID is required");const t={"Content-Type":"application/json"};c&&(t.Authorization=`token ${c}`);const v=await fetch(`${qa}/${i}`,{method:"GET",headers:t});if(!v.ok)throw new Error(`Failed to load gist: ${v.statusText}`);const u=await v.json(),p=Object.values(u.files);if(p.length===0)throw new Error("No files found in gist");const L=p[0].content;try{const h=JSON.parse(L);return h.attacks&&Array.isArray(h.attacks)&&(h.attacks=h.attacks.map(y=>({...y,id:y.id||crypto.randomUUID()}))),h.classFeatures?(h.classFeatures.features||(h.classFeatures.features={}),h.classFeatures.spellSlots||(h.classFeatures.spellSlots=[]),h.classFeatures.preparedSpells===void 0&&(h.classFeatures.preparedSpells="")):h.classFeatures={features:{},spellSlots:[],preparedSpells:""},h}catch{throw new Error("Invalid character data in gist")}}function ws(i){typeof window<"u"&&localStorage.setItem("dnd_gist_config",JSON.stringify(i))}function rr(){if(typeof window<"u"){const i=localStorage.getItem("dnd_gist_config");if(i)return JSON.parse(i)}return{}}async function or(i,c=30){if(!i)throw new Error("GitHub token is required to list gists");const t=await fetch(`${qa}?per_page=${c}`,{method:"GET",headers:{Authorization:`token ${i}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error(`Failed to list gists: ${t.statusText}`);return await t.json()}var cr=d('<div class="error-message svelte-1jb5ckg"> </div>'),vr=d('<div class="toggle-container svelte-1jb5ckg"><button type="button" class="toggle-btn svelte-1jb5ckg"> </button></div>'),dr=d('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID (leave empty to create new)</label> <input type="text" id="gistId" placeholder="Optional: existing Gist ID to update" class="svelte-1jb5ckg"/></div>'),ur=d('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),fr=d('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),pr=d('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Update (or leave unselected to create new)</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),mr=d('<div class="info-message svelte-1jb5ckg">No gists found. A new one will be created.</div>'),gr=d('<!> <div class="form-group svelte-1jb5ckg"><label for="description" class="svelte-1jb5ckg"> </label> <input type="text" id="description" placeholder="D&amp;D Character Sheet" class="svelte-1jb5ckg"/></div>',1),br=d('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID *</label> <input type="text" id="gistId" placeholder="Enter Gist ID (for public or your private gists)" required class="svelte-1jb5ckg"/></div>'),hr=d('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),_r=d('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),yr=d('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Load</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),xr=d('<div class="info-message svelte-1jb5ckg">No gists found. Enter a Gist ID manually or create a new one in Save mode.</div>'),$r=d('<div class="modal-overlay svelte-1jb5ckg" role="button" tabindex="-1"><div class="modal-content svelte-1jb5ckg" role="dialog" tabindex="0"><div class="modal-header svelte-1jb5ckg"><h2 class="svelte-1jb5ckg"> </h2> <button class="close-btn svelte-1jb5ckg">√ó</button></div> <div class="modal-body svelte-1jb5ckg"><!> <div class="form-group svelte-1jb5ckg"><label for="token" class="svelte-1jb5ckg"> <a href="https://github.com/settings/tokens" target="_blank" rel="noopener" class="svelte-1jb5ckg">Get token</a></label> <input type="password" id="token" placeholder="ghp_xxxxxxxxxxxxx" class="svelte-1jb5ckg"/></div> <!> <!> <div class="modal-actions svelte-1jb5ckg"><button class="btn btn-primary svelte-1jb5ckg"><!></button> <button class="btn btn-secondary svelte-1jb5ckg">Cancel</button></div></div></div></div>');function kr(i,c){zt(c,!1);const t=()=>ut(me,"$character",v),[v,u]=na(),p=ha();let f=St(c,"mode",8,"save"),L=C(""),h=C(""),y=C(""),Y=C(!1),F=C(""),re=C(!1),X=C(!1),le=C([]),ne=C(null);const R=rr();R.token&&r(L,R.token),R.gistId&&r(h,R.gistId),Sa(async()=>{e(L)&&!e(re)&&await P()});async function P(){if(e(L)){r(X,!0),r(F,"");try{r(le,await or(e(L))),e(h)&&r(ne,e(le).find(_=>_.id===e(h))||null)}catch(_){r(F,_.message||"Failed to load gists"),r(le,[])}finally{r(X,!1)}}}function pe(_){r(ne,_),r(h,_.id)}function Ee(){r(re,!e(re)),r(F,""),!e(re)&&e(L)&&P()}async function Be(){if(!e(L)){r(F,"GitHub token is required");return}const _=e(ne)?.id||e(h);r(Y,!0),r(F,"");try{if(_)await ir(t(),e(L),_),r(h,_),Ht.add("Character updated in Gist successfully!","success");else{const O=await lr(t(),e(L),e(y));r(h,O),Ht.add(`Character saved to Gist! ID: ${O}`,"success")}ws({token:e(L),gistId:e(h)}),p("close")}catch(O){r(F,O.message||"Failed to save to Gist")}finally{r(Y,!1)}}async function Q(){const _=e(ne)?.id||e(h);if(!_){r(F,"Please select a gist or enter a Gist ID");return}r(Y,!0),r(F,"");try{const O=await nr(_,e(L)||void 0);me.set(O),r(h,_),ws({token:e(L),gistId:e(h)}),Ht.add("Character loaded from Gist successfully!","success"),p("close")}catch(O){r(F,O.message||"Failed to load from Gist")}finally{r(Y,!1)}}function Re(){p("close")}qt();var be=$r(),ye=l(be),Te=l(ye),M=l(Te),E=l(M,!0);s(M);var x=a(M,2);s(Te);var W=a(Te,2),g=l(W);{var T=_=>{var O=cr(),ie=l(O,!0);s(O),w(()=>k(ie,e(F))),o(_,O)};b(g,_=>{e(F)&&_(T)})}var I=a(g,2),Me=l(I),Ce=l(Me);Yt(),s(Me);var de=a(Me,2);je(de),s(I);var fe=a(I,2);{var Ae=_=>{var O=vr(),ie=l(O),he=l(ie,!0);s(ie),s(O),w(()=>{ie.disabled=e(Y),k(he,e(re)?"üìã Show My Gists":"‚úèÔ∏è Enter Gist ID Manually")}),A("click",ie,Ee),o(_,O)};b(fe,_=>{(f()==="load"||f()==="save"&&e(L))&&_(Ae)})}var Je=a(fe,2);{var ot=_=>{var O=gr(),ie=Le(O);{var he=Fe=>{var De=dr(),Xe=a(l(De),2);je(Xe),s(De),w(()=>Xe.disabled=e(Y)),Oe(Xe,()=>e(h),$e=>r(h,$e)),o(Fe,De)},ee=Fe=>{var De=gt(),Xe=Le(De);{var $e=oe=>{var te=ur();o(oe,te)},m=oe=>{var te=gt(),z=Le(te);{var Ne=we=>{var Ue=pr(),ce=a(l(Ue),2);xt(ce,5,()=>e(le),Ct,(Ie,_e)=>{var Ye=fr();let Ge;var rt=l(Ye),ct=l(rt),ve=l(ct,!0);s(ct);var D=a(ct,2),G=l(D,!0);s(D),s(rt);var V=a(rt,2),K=l(V),ke=l(K);s(K);var qe=a(K,2),st=l(qe);s(qe),s(V),s(Ye),w(ze=>{Ge=At(Ye,1,"gist-item svelte-1jb5ckg",null,Ge,{selected:e(ne)?.id===e(_e).id}),Ye.disabled=e(Y),k(ve,(e(_e),n(()=>e(_e).description||"Untitled"))),k(G,(e(_e),n(()=>e(_e).public?"üåê Public":"üîí Private"))),k(ke,`ID: ${e(_e),n(()=>e(_e).id)??""}`),k(st,`Updated: ${ze??""}`)},[()=>(e(_e),n(()=>new Date(e(_e).updated_at).toLocaleDateString()))]),A("click",Ye,()=>pe(e(_e))),o(Ie,Ye)}),s(ce),s(Ue),o(we,Ue)},Pe=we=>{var Ue=gt(),ce=Le(Ue);{var Ie=_e=>{var Ye=mr();o(_e,Ye)};b(ce,_e=>{e(L)&&_e(Ie)},!0)}o(we,Ue)};b(z,we=>{e(le),n(()=>e(le).length>0)?we(Ne):we(Pe,!1)},!0)}o(oe,te)};b(Xe,oe=>{e(X)?oe($e):oe(m,!1)},!0)}o(Fe,De)};b(ie,Fe=>{e(re)||!e(L)?Fe(he):Fe(ee,!1)})}var H=a(ie,2),U=l(H),Z=l(U);s(U);var B=a(U,2);je(B),s(H),w(()=>{k(Z,`Description ${e(h)?"(optional)":""}`),B.disabled=e(Y)}),Oe(B,()=>e(y),Fe=>r(y,Fe)),o(_,O)},ht=_=>{var O=gt(),ie=Le(O);{var he=H=>{var U=br(),Z=a(l(U),2);je(Z),s(U),w(()=>Z.disabled=e(Y)),Oe(Z,()=>e(h),B=>r(h,B)),o(H,U)},ee=H=>{var U=gt(),Z=Le(U);{var B=De=>{var Xe=hr();o(De,Xe)},Fe=De=>{var Xe=gt(),$e=Le(Xe);{var m=te=>{var z=yr(),Ne=a(l(z),2);xt(Ne,5,()=>e(le),Ct,(Pe,we)=>{var Ue=_r();let ce;var Ie=l(Ue),_e=l(Ie),Ye=l(_e,!0);s(_e);var Ge=a(_e,2),rt=l(Ge,!0);s(Ge),s(Ie);var ct=a(Ie,2),ve=l(ct),D=l(ve);s(ve);var G=a(ve,2),V=l(G);s(G),s(ct),s(Ue),w(K=>{ce=At(Ue,1,"gist-item svelte-1jb5ckg",null,ce,{selected:e(ne)?.id===e(we).id}),Ue.disabled=e(Y),k(Ye,(e(we),n(()=>e(we).description||"Untitled"))),k(rt,(e(we),n(()=>e(we).public?"üåê Public":"üîí Private"))),k(D,`ID: ${e(we),n(()=>e(we).id)??""}`),k(V,`Updated: ${K??""}`)},[()=>(e(we),n(()=>new Date(e(we).updated_at).toLocaleDateString()))]),A("click",Ue,()=>pe(e(we))),o(Pe,Ue)}),s(Ne),s(z),o(te,z)},oe=te=>{var z=gt(),Ne=Le(z);{var Pe=we=>{var Ue=xr();o(we,Ue)};b(Ne,we=>{e(L)&&we(Pe)},!0)}o(te,z)};b($e,te=>{e(le),n(()=>e(le).length>0)?te(m):te(oe,!1)},!0)}o(De,Xe)};b(Z,De=>{e(X)?De(B):De(Fe,!1)},!0)}o(H,U)};b(ie,H=>{e(re)||!e(L)?H(he):H(ee,!1)},!0)}o(_,O)};b(Je,_=>{f()==="save"?_(ot):_(ht,!1)})}var dt=a(Je,2),Qe=l(dt),$=l(Qe);{var N=_=>{var O=Rt();w(()=>k(O,f()==="save"?"Saving...":"Loading...")),o(_,O)},ge=_=>{var O=Rt();w(()=>k(O,f()==="save"?"Save":"Load")),o(_,O)};b($,_=>{e(Y)?_(N):_(ge,!1)})}s(Qe);var xe=a(Qe,2);s(dt),s(W),s(ye),s(be),w(()=>{k(E,f()==="save"?"Save to GitHub Gist":"Load from GitHub Gist"),k(Ce,`GitHub Token ${f()==="load"?"(optional for public gists)":"(required)"} `),de.disabled=e(Y),Qe.disabled=e(Y),xe.disabled=e(Y)}),A("click",x,Re),Oe(de,()=>e(L),_=>r(L,_)),A("blur",de,()=>{e(L)&&!e(re)&&P()}),A("click",Qe,function(..._){(f()==="save"?Be:Q)?.apply(this,_)}),A("click",xe,Re),A("click",ye,cs(function(_){ka.call(this,c,_)})),A("keydown",ye,function(_){ka.call(this,c,_)}),A("click",be,Re),A("keydown",be,_=>_.key==="Escape"&&Re()),o(i,be),Wt(),u()}var wr=d('<div class="loading svelte-1ngjemu">Loading D&D data...</div>'),Sr=d("<option> </option>"),Cr=d('<select class="level-filter svelte-1ngjemu"><option>All Levels</option><option>Cantrip</option><!></select>'),Dr=d('<div class="no-results svelte-1ngjemu"> </div>'),Lr=d('<div class="item-meta svelte-1ngjemu"> </div>'),jr=d('<div class="item-meta svelte-1ngjemu"> </div>'),Ar=d('<button><div class="item-name svelte-1ngjemu"> </div> <!></button>'),Br=d('<p class="higher-levels"><strong>At Higher Levels:</strong> </p>'),Rr=d('<p class="cantrip-upgrade"><strong>Cantrip Upgrade:</strong> </p>'),Tr=d('<h3 class="svelte-1ngjemu"> </h3> <p class="spell-meta svelte-1ngjemu"><!> <!></p> <p class="spell-classes"><strong>Classes:</strong> </p> <div class="spell-stats svelte-1ngjemu"><div><strong>Casting Time:</strong> </div> <div><strong>Range:</strong> </div> <div><strong>Components:</strong> <!></div> <div><strong>Duration:</strong> <!> </div></div> <p class="description svelte-1ngjemu"> </p> <!> <!>',1),Mr=d('<p class="prerequisite svelte-1ngjemu"><strong>Prerequisite:</strong> </p>'),Fr=d('<h3 class="svelte-1ngjemu"> </h3> <!> <p class="description svelte-1ngjemu"> </p> <a target="_blank" rel="noopener" class="source-link svelte-1ngjemu">View Full Details ‚Üí</a>',1),Pr=d('<div class="item-details svelte-1ngjemu"><!></div>'),Ir=d('<div class="controls svelte-1ngjemu"><div class="tabs svelte-1ngjemu"><button> </button> <button> </button></div> <div class="search-controls svelte-1ngjemu"><input type="text" placeholder="Search by name or description..." class="search-input svelte-1ngjemu"/> <!></div></div> <div class="content-container svelte-1ngjemu"><div class="items-list svelte-1ngjemu"><!></div> <!></div>',1),Er=d('<div class="modal-backdrop svelte-1ngjemu" role="presentation"><div class="modal svelte-1ngjemu" role="dialog" aria-modal="true" tabindex="-1"><div class="modal-header svelte-1ngjemu"><h2 class="svelte-1ngjemu">Browse D&D Spells & Feats</h2> <button class="close-btn svelte-1ngjemu" aria-label="Close">&times;</button></div> <div class="modal-body svelte-1ngjemu"><!></div> <div class="modal-footer svelte-1ngjemu"><button class="btn-secondary svelte-1ngjemu">Cancel</button> <button class="btn-primary svelte-1ngjemu">Add to Character Sheet</button></div></div></div>');function Ur(i,c){zt(c,!1);const t=C(),v=C(),u=C();let p=St(c,"onClose",8),f=C("spell"),L=C(!0),h=C(""),y=C(null),Y=C([]),F=C([]),re=C(null);Sa(async()=>{r(L,!0);try{r(Y,await Ms()),r(F,await si())}catch(x){console.error("Failed to load data:",x)}finally{r(L,!1)}});function X(x){r(re,x)}function le(x){const W=x.match(/(\d+d\d+(?:\s*\+\s*\d+)?)/i);return W?W[1]:""}function ne(x){const W=x.split(/\.( |$)/)[0].trim(),g=Array.from(x.matchAll(/\*\*(.*?)\*\*/g)).map(I=>I[1].replace(/\.$/,""));let T=W;return g.length&&(T+=" | Effects: "+g.join(", ")),T}function R(){if(e(re)){if(e(f)==="spell"){const x=e(re);me.update(W=>{const T=[];x.range&&T.push(`Range: ${x.range}`),x.castingTime&&T.push(`Cast: ${x.castingTime}`),x.duration&&T.push(`Duration: ${x.duration}`),x.actionType==="Save"&&T.push("Saving throw spell"),x.components&&x.components.length>0&&T.push(`Components: ${x.components.join(", ")}`),x.material&&T.push(`Material: ${x.material}`);const I=T.join(" | "),Me=ne(x.description),Ce={id:crypto.randomUUID(),name:`${x.name}${x.concentration?" (C)":""}${x.ritual?" (R)":""}`,bonus:x.actionType==="Attack"?5:0,damage:le(x.description),damageType:`${x.school} (Lvl ${x.level})`,spellRef:x.name,infoNotes:I,generalNotes:Me,castAtLevel:x.level};return W.attacks=[...W.attacks,Ce],W})}else if(e(f)==="feat"){const x=e(re);me.update(W=>{const g=`${x.name}${x.prerequisite?` (Req: ${x.prerequisite})`:""}
${x.description}
`;return W.features=W.features?`${W.features}
${g}`:g,W})}r(re,null),p()()}}tt(()=>(e(y),e(Y),e(h)),()=>{r(t,e(y)!==null?li(xs(e(Y),e(h)),e(y)):xs(e(Y),e(h)))}),tt(()=>(e(F),e(h)),()=>{r(v,ii(e(F),e(h)))}),tt(()=>(e(f),e(t),e(v)),()=>{r(u,e(f)==="spell"?e(t):e(v))}),va(),qt();var P=Er(),pe=l(P),Ee=l(pe),Be=a(l(Ee),2);s(Ee);var Q=a(Ee,2),Re=l(Q);{var be=x=>{var W=wr();o(x,W)},ye=x=>{var W=Ir(),g=Le(W),T=l(g),I=l(T);let Me;var Ce=l(I);s(I);var de=a(I,2);let fe;var Ae=l(de);s(de),s(T);var Je=a(T,2),ot=l(Je);je(ot);var ht=a(ot,2);{var dt=ie=>{var he=Cr();w(()=>{e(y),Ut(()=>{})});var ee=l(he);ee.value=(ee.__value=null)??"";var H=a(ee);H.value=H.__value=0;var U=a(H);xt(U,0,()=>[1,2,3,4,5,6,7,8,9],Ct,(Z,B)=>{var Fe=Sr(),De=l(Fe);s(Fe);var Xe={};w(()=>{k(De,`Level ${B??""}`),Xe!==(Xe=B)&&(Fe.value=(Fe.__value=B)??"")}),o(Z,Fe)}),s(he),Ra(he,()=>e(y),Z=>r(y,Z)),o(ie,he)};b(ht,ie=>{e(f)==="spell"&&ie(dt)})}s(Je),s(g);var Qe=a(g,2),$=l(Qe),N=l($);{var ge=ie=>{var he=Dr(),ee=l(he);s(he),w(()=>k(ee,`No ${e(f)??""}s found`)),o(ie,he)},xe=ie=>{var he=gt(),ee=Le(he);xt(ee,1,()=>e(u),Ct,(H,U)=>{var Z=Ar();let B;var Fe=l(Z),De=l(Fe,!0);s(Fe);var Xe=a(Fe,2);{var $e=oe=>{const te=yt(()=>e(U));var z=Lr(),Ne=l(z);s(z),w(()=>k(Ne,`Level ${J(e(te)),n(()=>e(te).level)??""} ‚Ä¢ ${J(e(te)),n(()=>e(te).school)??""}`)),o(oe,z)},m=oe=>{const te=yt(()=>e(U));var z=gt(),Ne=Le(z);{var Pe=we=>{var Ue=jr(),ce=l(Ue,!0);s(Ue),w(()=>k(ce,(J(e(te)),n(()=>e(te).prerequisite)))),o(we,Ue)};b(Ne,we=>{J(e(te)),n(()=>e(te).prerequisite)&&we(Pe)})}o(oe,z)};b(Xe,oe=>{e(f)==="spell"?oe($e):oe(m,!1)})}s(Z),w(()=>{B=At(Z,1,"item-card svelte-1ngjemu",null,B,{selected:e(re)?.name===e(U).name}),k(De,(e(U),n(()=>e(U).name)))}),A("click",Z,()=>X(e(U))),o(H,Z)}),o(ie,he)};b(N,ie=>{e(u),n(()=>e(u).length===0)?ie(ge):ie(xe,!1)})}s($);var _=a($,2);{var O=ie=>{var he=Pr(),ee=l(he);{var H=Z=>{const B=yt(()=>e(re));var Fe=Tr(),De=Le(Fe),Xe=l(De,!0);s(De);var $e=a(De,2),m=l($e);{var oe=q=>{var He=Rt();w(()=>k(He,`${J(e(B)),n(()=>e(B).school)??""} cantrip`)),o(q,He)},te=q=>{var He=Rt();w(()=>k(He,`Level ${J(e(B)),n(()=>e(B).level)??""} ${J(e(B)),n(()=>e(B).school)??""}`)),o(q,He)};b(m,q=>{J(e(B)),n(()=>e(B).level===0)?q(oe):q(te,!1)})}var z=a(m,2);{var Ne=q=>{var He=Rt("(ritual)");o(q,He)};b(z,q=>{J(e(B)),n(()=>e(B).ritual)&&q(Ne)})}s($e);var Pe=a($e,2),we=a(l(Pe));s(Pe);var Ue=a(Pe,2),ce=l(Ue),Ie=a(l(ce));s(ce);var _e=a(ce,2),Ye=a(l(_e));s(_e);var Ge=a(_e,2),rt=a(l(Ge)),ct=a(rt);{var ve=q=>{var He=Rt();w(()=>k(He,`(${J(e(B)),n(()=>e(B).material)??""})`)),o(q,He)};b(ct,q=>{J(e(B)),n(()=>e(B).material)&&q(ve)})}s(Ge);var D=a(Ge,2),G=a(l(D),2);{var V=q=>{var He=Rt("Concentration,");o(q,He)};b(G,q=>{J(e(B)),n(()=>e(B).concentration)&&q(V)})}var K=a(G,1,!0);s(D),s(Ue);var ke=a(Ue,2),qe=l(ke,!0);s(ke);var st=a(ke,2);{var ze=q=>{var He=Br(),ft=a(l(He));s(He),w(()=>k(ft,` ${J(e(B)),n(()=>e(B).higherLevelSlot)??""}`)),o(q,He)};b(st,q=>{J(e(B)),n(()=>e(B).higherLevelSlot)&&q(ze)})}var Ke=a(st,2);{var ue=q=>{var He=Rr(),ft=a(l(He));s(He),w(()=>k(ft,` ${J(e(B)),n(()=>e(B).cantripUpgrade)??""}`)),o(q,He)};b(Ke,q=>{J(e(B)),n(()=>e(B).cantripUpgrade)&&q(ue)})}w((q,He)=>{k(Xe,(J(e(B)),n(()=>e(B).name))),k(we,` ${q??""}`),k(Ie,` ${J(e(B)),n(()=>e(B).castingTime||e(B).actionType)??""}`),k(Ye,` ${J(e(B)),n(()=>e(B).range)??""}`),k(rt,` ${He??""}`),k(K,(J(e(B)),n(()=>e(B).duration))),k(qe,(J(e(B)),n(()=>e(B).description)))},[()=>(J(e(B)),n(()=>e(B).classes.join(", "))),()=>(J(e(B)),n(()=>e(B).components.join(", ").toUpperCase()))]),o(Z,Fe)},U=Z=>{const B=yt(()=>e(re));var Fe=Fr(),De=Le(Fe),Xe=l(De,!0);s(De);var $e=a(De,2);{var m=Ne=>{var Pe=Mr(),we=a(l(Pe));s(Pe),w(()=>k(we,` ${J(e(B)),n(()=>e(B).prerequisite)??""}`)),o(Ne,Pe)};b($e,Ne=>{J(e(B)),n(()=>e(B).prerequisite)&&Ne(m)})}var oe=a($e,2),te=l(oe,!0);s(oe);var z=a(oe,2);w(()=>{k(Xe,(J(e(B)),n(()=>e(B).name))),k(te,(J(e(B)),n(()=>e(B).description))),nt(z,"href",(J(e(B)),n(()=>e(B).source)))}),o(Z,Fe)};b(ee,Z=>{e(f)==="spell"?Z(H):Z(U,!1)})}s(he),o(ie,he)};b(_,ie=>{e(re)&&ie(O)})}s(Qe),w(()=>{Me=At(I,1,"tab svelte-1ngjemu",null,Me,{active:e(f)==="spell"}),k(Ce,`üìú Spells (${e(Y),n(()=>e(Y).length)??""})`),fe=At(de,1,"tab svelte-1ngjemu",null,fe,{active:e(f)==="feat"}),k(Ae,`‚≠ê Feats (${e(F),n(()=>e(F).length)??""})`)}),A("click",I,()=>{r(f,"spell"),r(re,null),r(h,"")}),A("click",de,()=>{r(f,"feat"),r(re,null),r(h,"")}),Oe(ot,()=>e(h),ie=>r(h,ie)),o(x,W)};b(Re,x=>{e(L)?x(be):x(ye,!1)})}s(Q);var Te=a(Q,2),M=l(Te),E=a(M,2);s(Te),s(pe),s(P),w(()=>E.disabled=!e(re)),A("click",Be,function(...x){p()?.apply(this,x)}),A("click",M,function(...x){p()?.apply(this,x)}),A("click",E,R),A("click",pe,cs(function(x){ka.call(this,c,x)})),A("keydown",pe,function(x){ka.call(this,c,x)}),A("click",P,function(...x){p()?.apply(this,x)}),A("keydown",P,x=>x.key==="Escape"&&p()()),o(i,P),Wt()}var Hr=d('<span class="resistance-tag svelte-gdwwx1"> <button type="button" class="tag-remove svelte-gdwwx1">√ó</button></span>'),Nr=d('<div class="resistance-list svelte-gdwwx1"></div>'),Or=d('<p class="ability-meta svelte-gdwwx1"> <!></p>'),Gr=d('<p class="ability-meta svelte-gdwwx1">Requires Reaction</p>'),qr=d('<div class="ability-card svelte-gdwwx1"><div class="ability-header svelte-gdwwx1"><strong class="svelte-gdwwx1"> </strong> <button type="button" class="ability-remove svelte-gdwwx1">√ó</button></div> <p class="ability-description svelte-gdwwx1"> </p> <!></div>'),zr=d('<div class="abilities-list svelte-gdwwx1"></div>'),Wr=d(`<div class="modal-backdrop svelte-gdwwx1" role="presentation"><div class="modal-content svelte-gdwwx1" role="dialog" aria-modal="true" aria-labelledby="modal-title"><div class="modal-header svelte-gdwwx1"><h3 id="modal-title" class="svelte-gdwwx1">Add Custom Condition</h3> <button class="btn-close svelte-gdwwx1" aria-label="Close">√ó</button></div> <div class="modal-body svelte-gdwwx1"><div class="form-group svelte-gdwwx1"><label for="conditionName" class="svelte-gdwwx1">Condition Name*</label> <input type="text" id="conditionName" placeholder="e.g., Cazna's Mark" class="svelte-gdwwx1"/></div> <div class="form-group svelte-gdwwx1"><label for="description" class="svelte-gdwwx1">Description</label> <textarea id="description" placeholder="Describe the condition..." rows="3" class="svelte-gdwwx1"></textarea></div> <div class="form-row svelte-gdwwx1"><div class="form-group svelte-gdwwx1"><label for="attackBonus" class="svelte-gdwwx1">Attack Bonus</label> <input type="text" id="attackBonus" placeholder="0 or 1d4" class="svelte-gdwwx1"/></div> <div class="form-group svelte-gdwwx1"><label for="damageBonus" class="svelte-gdwwx1">Damage Bonus</label> <input type="text" id="damageBonus" placeholder="0 or 1d6" class="svelte-gdwwx1"/></div> <div class="form-group svelte-gdwwx1"><label for="acBonus" class="svelte-gdwwx1">AC Bonus</label> <input type="number" id="acBonus" placeholder="0" class="svelte-gdwwx1"/></div></div> <div class="form-group svelte-gdwwx1"><label for="darkvision" class="svelte-gdwwx1">Darkvision (feet)</label> <input type="number" id="darkvision" placeholder="0" min="0" step="30" class="svelte-gdwwx1"/> <small class="help-text svelte-gdwwx1">Grant or extend darkvision (e.g., 60 for 60 feet)</small></div> <div class="form-group svelte-gdwwx1"><label class="svelte-gdwwx1">Damage Resistances</label> <div class="resistance-input-group svelte-gdwwx1"><input type="text" placeholder="e.g., cold, fire, poison" class="svelte-gdwwx1"/> <button type="button" class="btn-add svelte-gdwwx1">Add</button></div> <!></div> <div class="form-group svelte-gdwwx1"><label class="svelte-gdwwx1">Special Abilities</label> <div class="ability-form svelte-gdwwx1"><input type="text" placeholder="Ability name (e.g., Flicker of Deceit)" class="ability-name-input svelte-gdwwx1"/> <textarea placeholder="Ability description..." rows="2" class="ability-desc-input svelte-gdwwx1"></textarea> <div class="ability-options svelte-gdwwx1"><div class="ability-option svelte-gdwwx1"><label for="abilityUses" class="svelte-gdwwx1">Uses per rest</label> <input type="number" id="abilityUses" min="0" class="svelte-gdwwx1"/></div> <div class="ability-option svelte-gdwwx1"><label for="restType" class="svelte-gdwwx1">Rest type</label> <select id="restType" class="svelte-gdwwx1"><option>Short</option><option>Long</option></select></div> <div class="ability-option svelte-gdwwx1"><label class="svelte-gdwwx1"><input type="checkbox" class="svelte-gdwwx1"/> Requires Reaction</label></div></div> <button type="button" class="btn-add svelte-gdwwx1">Add Ability</button></div> <!></div></div> <div class="modal-footer svelte-gdwwx1"><button class="btn btn-secondary svelte-gdwwx1">Cancel</button> <button class="btn btn-primary svelte-gdwwx1">Add Condition</button></div></div></div>`);function Kr(i,c){zt(c,!1);let t=St(c,"show",8,!1),v=St(c,"onSave",8),u=St(c,"onCancel",8),p=C(""),f=C(""),L=C(0),h=C(0),y=C(0),Y=C(0),F=C([]),re=C(""),X=C([]),le=C(""),ne=C(""),R=C(0),P=C("short"),pe=C(!1);function Ee(){r(p,""),r(f,""),r(L,0),r(h,0),r(y,0),r(Y,0),r(F,[]),r(re,""),r(X,[]),r(le,""),r(ne,""),r(R,0),r(P,"short"),r(pe,!1)}function Be(){e(re).trim()&&(r(F,[...e(F),e(re).trim()]),r(re,""))}function Q(g){r(F,e(F).filter((T,I)=>I!==g))}function Re(){if(e(le).trim()&&e(ne).trim()){const g={name:e(le).trim(),description:e(ne).trim(),requiresReaction:e(pe)};e(R)>0&&(g.usesPerRest=e(R),g.currentUses=e(R),g.restType=e(P)),r(X,[...e(X),g]),r(le,""),r(ne,""),r(R,0),r(P,"short"),r(pe,!1)}}function be(g){r(X,e(X).filter((T,I)=>I!==g))}function ye(){if(!e(p).trim()){alert("Please enter a condition name");return}const g={name:e(p).trim(),description:e(f).trim()||"Custom condition",attackBonus:e(L)||0,damageBonus:e(h)||0,target:"self"};e(y)!==0&&(g.acBonus=e(y)),e(Y)>0&&(g.darkvision=e(Y)),e(F).length>0&&(g.resistances=e(F)),e(X).length>0&&(g.abilities=e(X)),v()(g),Ee()}function Te(){Ee(),u()()}function M(g){g.target===g.currentTarget&&Te()}qt();var E=gt(),x=Le(E);{var W=g=>{var T=Wr(),I=l(T),Me=l(I),Ce=a(l(Me),2);s(Me);var de=a(Me,2),fe=l(de),Ae=a(l(fe),2);je(Ae),s(fe);var Je=a(fe,2),ot=a(l(Je),2);xa(ot),s(Je);var ht=a(Je,2),dt=l(ht),Qe=a(l(dt),2);je(Qe),s(dt);var $=a(dt,2),N=a(l($),2);je(N),s($);var ge=a($,2),xe=a(l(ge),2);je(xe),s(ge),s(ht);var _=a(ht,2),O=a(l(_),2);je(O),Yt(2),s(_);var ie=a(_,2),he=a(l(ie),2),ee=l(he);je(ee);var H=a(ee,2);s(he);var U=a(he,2);{var Z=ve=>{var D=Nr();xt(D,5,()=>e(F),Ct,(G,V,K)=>{var ke=Hr(),qe=l(ke),st=a(qe);s(ke),w(()=>{k(qe,`${e(V)??""} `),nt(st,"aria-label",`Remove ${e(V)??""}`)}),A("click",st,()=>Q(K)),o(G,ke)}),s(D),o(ve,D)};b(U,ve=>{e(F),n(()=>e(F).length>0)&&ve(Z)})}s(ie);var B=a(ie,2),Fe=a(l(B),2),De=l(Fe);je(De);var Xe=a(De,2);xa(Xe);var $e=a(Xe,2),m=l($e),oe=a(l(m),2);je(oe),s(m);var te=a(m,2),z=a(l(te),2);w(()=>{e(P),Ut(()=>{})});var Ne=l(z);Ne.value=Ne.__value="short";var Pe=a(Ne);Pe.value=Pe.__value="long",s(z),s(te);var we=a(te,2),Ue=l(we),ce=l(Ue);je(ce),Yt(),s(Ue),s(we),s($e);var Ie=a($e,2);s(Fe);var _e=a(Fe,2);{var Ye=ve=>{var D=zr();xt(D,5,()=>e(X),Ct,(G,V,K)=>{var ke=qr(),qe=l(ke),st=l(qe),ze=l(st,!0);s(st);var Ke=a(st,2);s(qe);var ue=a(qe,2),q=l(ue,!0);s(ue);var He=a(ue,2);{var ft=lt=>{var ae=Or(),j=l(ae),Ve=a(j);{var at=se=>{var S=Rt("‚Ä¢ Requires Reaction");o(se,S)};b(Ve,se=>{e(V),n(()=>e(V).requiresReaction)&&se(at)})}s(ae),w(()=>k(j,`${e(V),n(()=>e(V).usesPerRest)??""} use${e(V),n(()=>e(V).usesPerRest>1?"s":"")??""} per ${e(V),n(()=>e(V).restType)??""}
                      rest `)),o(lt,ae)},Ze=lt=>{var ae=gt(),j=Le(ae);{var Ve=at=>{var se=Gr();o(at,se)};b(j,at=>{e(V),n(()=>e(V).requiresReaction)&&at(Ve)},!0)}o(lt,ae)};b(He,lt=>{e(V),n(()=>e(V).usesPerRest)?lt(ft):lt(Ze,!1)})}s(ke),w(()=>{k(ze,(e(V),n(()=>e(V).name))),nt(Ke,"aria-label",`Remove ${e(V),n(()=>e(V).name)??""}`),k(q,(e(V),n(()=>e(V).description)))}),A("click",Ke,()=>be(K)),o(G,ke)}),s(D),o(ve,D)};b(_e,ve=>{e(X),n(()=>e(X).length>0)&&ve(Ye)})}s(B),s(de);var Ge=a(de,2),rt=l(Ge),ct=a(rt,2);s(Ge),s(I),s(T),A("click",Ce,Te),Oe(Ae,()=>e(p),ve=>r(p,ve)),Oe(ot,()=>e(f),ve=>r(f,ve)),Oe(Qe,()=>e(L),ve=>r(L,ve)),Oe(N,()=>e(h),ve=>r(h,ve)),Oe(xe,()=>e(y),ve=>r(y,ve)),Oe(O,()=>e(Y),ve=>r(Y,ve)),Oe(ee,()=>e(re),ve=>r(re,ve)),A("keydown",ee,ve=>ve.key==="Enter"&&Be()),A("click",H,Be),Oe(De,()=>e(le),ve=>r(le,ve)),Oe(Xe,()=>e(ne),ve=>r(ne,ve)),Oe(oe,()=>e(R),ve=>r(R,ve)),Ra(z,()=>e(P),ve=>r(P,ve)),$a(ce,()=>e(pe),ve=>r(pe,ve)),A("click",Ie,Re),A("click",rt,Te),A("click",ct,ye),A("click",T,M),o(g,T)};b(x,g=>{t()&&g(W)})}o(i,E),Wt()}var Vr=d("<option></option>"),Jr=d("<button> </button>"),Yr=d('<button class="btn btn-primary calculate-btn use-enabled svelte-uvfntf">Calculate Damage</button>'),Qr=d('<div class="adjustment-msg svelte-uvfntf"> </div>'),Xr=d('<div class="calculation-result svelte-uvfntf"><div class="result-header svelte-uvfntf"><h4 class="svelte-uvfntf">Damage Calculation</h4></div> <div class="result-content svelte-uvfntf"><div class="damage-breakdown svelte-uvfntf"><div class="damage-row svelte-uvfntf"><span class="label svelte-uvfntf">Original Damage:</span> <span class="value svelte-uvfntf"> </span></div> <div class="adjustments svelte-uvfntf"></div> <div class="damage-row final svelte-uvfntf"><span class="label svelte-uvfntf">Final Damage:</span> <span class="value damage-value svelte-uvfntf"> </span></div></div></div> <div class="result-actions svelte-uvfntf"><button class="btn btn-primary apply-btn use-enabled svelte-uvfntf">Apply Damage</button> <button class="btn btn-secondary cancel-btn use-enabled svelte-uvfntf">Cancel</button></div></div>'),Zr=d('<div class="damage-form svelte-uvfntf"><div class="input-group svelte-uvfntf"><div class="input-field svelte-uvfntf"><label for="damageAmount" class="svelte-uvfntf">Damage Amount</label> <input type="number" id="damageAmount" min="0" placeholder="0" class="damage-input-field use-enabled svelte-uvfntf"/></div> <div class="input-field svelte-uvfntf"><label for="damageType" class="svelte-uvfntf">Damage Type</label> <input type="text" id="damageType" list="damageTypes" placeholder="e.g., fire, cold" class="damage-input-field use-enabled svelte-uvfntf"/> <datalist id="damageTypes"></datalist></div></div> <div class="quick-types svelte-uvfntf"><span class="quick-types-label svelte-uvfntf">Quick Select:</span> <!></div> <!></div>'),eo=d("<section><!> <!></section>");function to(i,c){zt(c,!1);const t=()=>ut(me,"$character",p),v=()=>ut(ga,"$searchFilter",p),u=()=>ut(Qt,"$collapsedStates",p),[p,f]=na(),L=C();ha();let h=C(0),y=C(""),Y=C(!1),F=C(0),re=C([]);const X=["slashing","piercing","bludgeoning","fire","cold","lightning","thunder","acid","poison","necrotic","radiant","psychic","force"];function le(){if(e(h)<0){Ht.add("Damage amount cannot be negative","error");return}if(!e(y).trim()){Ht.add("Please enter or select a damage type","error");return}const Re=Fl(e(h),e(y),t());r(F,Re.finalDamage),r(re,Re.adjustments),r(Y,!0)}function ne(){me.update(Re=>Pl(Re,e(F))),Ht.add(`Applied ${e(F)} damage to character (${e(y)})`,"info"),r(h,0),r(y,""),r(Y,!1),r(F,0),r(re,[])}function R(){r(Y,!1),r(F,0),r(re,[])}tt(()=>v(),()=>{r(L,!v()||"damage".includes(v().toLowerCase())||"resistance".includes(v().toLowerCase())||"immune".includes(v().toLowerCase()))}),va(),qt();var P=eo();let pe;var Ee=l(P);{let Re=yt(()=>(u(),n(()=>u().damageInput?"Expand":"Collapse")));_a(Ee,{title:"Apply Damage",get collapsed(){return u(),n(()=>u().damageInput)},get ariaLabel(){return e(Re)},onToggle:()=>Qt.update(be=>({...be,damageInput:!be.damageInput}))})}var Be=a(Ee,2);{var Q=Re=>{var be=Zr(),ye=l(be),Te=l(ye),M=a(l(Te),2);je(M),s(Te);var E=a(Te,2),x=a(l(E),2);je(x);var W=a(x,2);xt(W,5,()=>X,Ct,(de,fe)=>{var Ae=Vr(),Je={};w(()=>{Je!==(Je=e(fe))&&(Ae.value=(Ae.__value=e(fe))??"")}),o(de,Ae)}),s(W),s(E),s(ye);var g=a(ye,2),T=a(l(g),2);xt(T,1,()=>X,Ct,(de,fe)=>{var Ae=Jr();let Je;var ot=l(Ae,!0);s(Ae),w(()=>{Je=At(Ae,1,"quick-type-btn use-enabled svelte-uvfntf",null,Je,{active:e(y)===e(fe)}),k(ot,e(fe))}),A("click",Ae,()=>r(y,e(fe))),o(de,Ae)}),s(g);var I=a(g,2);{var Me=de=>{var fe=Yr();A("click",fe,le),o(de,fe)},Ce=de=>{var fe=Xr(),Ae=a(l(fe),2),Je=l(Ae),ot=l(Je),ht=a(l(ot),2),dt=l(ht);s(ht),s(ot);var Qe=a(ot,2);xt(Qe,5,()=>e(re),Ct,(ie,he)=>{var ee=Qr(),H=l(ee,!0);s(ee),w(()=>k(H,e(he))),o(ie,ee)}),s(Qe);var $=a(Qe,2),N=a(l($),2),ge=l(N,!0);s(N),s($),s(Je),s(Ae);var xe=a(Ae,2),_=l(xe),O=a(_,2);s(xe),s(fe),w(()=>{k(dt,`${e(h)??""} ${e(y)??""}`),k(ge,e(F))}),A("click",_,ne),A("click",O,R),o(de,fe)};b(I,de=>{e(Y)?de(Ce,!1):de(Me)})}s(be),Oe(M,()=>e(h),de=>r(h,de)),Oe(x,()=>e(y),de=>r(y,de)),o(Re,be)};b(Be,Re=>{u(),n(()=>!u().damageInput)&&Re(Q)})}s(P),w(()=>pe=At(P,1,"damage-input svelte-uvfntf",null,pe,{hidden:!e(L)})),o(i,P),Wt(),f()}var ao=d('<link rel="icon" type="image/png" href="favicon4.png"/> <meta name="viewport" content="width=device-width, initial-scale=1"/>',1),so=d('<span class="character-name svelte-1uha8ag"> </span>'),lo=d("<span> </span>"),io=d('<div class="spell-slots-header svelte-1uha8ag"></div>'),no=d("<span> </span><br/>",1),ro=d("<span> </span><br/>",1),oo=d("<span> </span><br/>",1),co=d("<span> </span><br/>",1),vo=d("<span> </span><br/>",1),uo=d("<span> </span><br/>",1),fo=d("<br/><em> <!>)</em>",1),po=d("<br/><em>(requires reaction)</em>",1),mo=d('<div class="ability-detail"><strong> </strong> <!></div>'),go=d('<div class="abilities-section"><strong>Abilities:</strong><br/> <!></div>'),bo=d('<span class="effect-tooltip"><strong> </strong><br/> <br/> <!> <!> <!> <!> <!> <!> <!></span>'),ho=d('<button class="effect-remove-btn svelte-1uha8ag">√ó</button>'),_o=d('<span class="effect-badge svelte-1uha8ag" tabindex="0"> <!> <!></span>'),yo=d(`<div class="active-effects-header svelte-1uha8ag"></div> <style>.effect-badge {
              position: relative;
            }
            .effect-tooltip {
              position: absolute;
              top: 120%;
              left: 50%;
              transform: translateX(-50%);
              background: #fff;
              color: #222;
              border: 1px solid #a5b4fc;
              border-radius: 6px;
              padding: 8px 12px;
              font-size: 0.95em;
              box-shadow: 0 2px 8px rgba(0, 0, 0, 0.12);
              z-index: 10;
              min-width: 180px;
              max-width: 300px;
              white-space: normal;
              pointer-events: none;
              opacity: 1;
              transition: opacity 0.15s;
            }

            .abilities-section {
              margin-top: 8px;
              padding-top: 8px;
              border-top: 1px solid #e5e7eb;
            }

            .ability-detail {
              margin-top: 6px;
              padding: 4px;
              background: #f9fafb;
              border-radius: 4px;
              font-size: 0.9em;
            }

            .ability-detail strong {
              color: #6366f1;
            }

            .ability-detail em {
              font-size: 0.85em;
              color: #6b7280;
            }</style>`,1),xo=d('<div class="rest-menu svelte-1uha8ag"><button class="rest-option svelte-1uha8ag">‚òï Short Rest</button> <button class="rest-option svelte-1uha8ag">üõèÔ∏è Long Rest</button></div>'),$o=d('<div class="container svelte-1uha8ag"><header class="svelte-1uha8ag"><div class="header-top svelte-1uha8ag"><div class="header-title svelte-1uha8ag"><div class="title-row svelte-1uha8ag"><h1 class="svelte-1uha8ag">D&D Character Sheet</h1> <!></div> <!> <!></div> <div class="header-right svelte-1uha8ag"><div class="header-controls svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">üé≤</span><span class="btn-text svelte-1uha8ag">Roll Dice</span></button> <div class="rest-button-container svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">üò¥</span><span class="btn-text svelte-1uha8ag">Rest</span></button> <!></div> <button class="btn btn-secondary use-enabled" title="Add custom condition with effects"><span class="btn-icon svelte-1uha8ag">‚ú®</span><span class="btn-text svelte-1uha8ag">Add Condition</span></button> <div class="mode-toggle"><button><span class="btn-icon svelte-1uha8ag"> </span><span class="btn-text svelte-1uha8ag"> </span></button></div></div> <div class="header-search svelte-1uha8ag"><input type="text" placeholder="üîç Search..." class="search-input use-enabled svelte-1uha8ag"/></div></div></div> <div class="header-actions svelte-1uha8ag"><button class="btn btn-mode svelte-1uha8ag">üìö Browse Spells & Feats</button> <button class="btn btn-secondary">Save to Gist</button> <button class="btn btn-secondary">Load from Gist</button> <button class="btn btn-secondary">Export JSON</button> <button class="btn btn-secondary">Import JSON</button> <input type="file" accept=".json" style="display: none;"/></div></header> <main class="svelte-1uha8ag"><!> <!> <!> <!> <!> <!> <!> <!></main></div> <!> <!> <!> <!> <!>',1);function Bo(i,c){zt(c,!1);const t=()=>ut(me,"$character",p),v=()=>ut(ma,"$isEditMode",p),u=()=>ut(ga,"$searchFilter",p),[p,f]=na();function L(){const j=[],Ve=t().classFeatures.spellSlotsByLevel||{};for(let at=1;at<=9;at++){const se=Ve[at];if(se&&se.length>0){const S=se.length,pt=se.filter(bt=>bt).length;j.push({level:at,available:S-pt,total:S})}}return j}let h=C(!1),y=C(!1),Y=C(!1),F=C(!1),re=C("save"),X=C(void 0),le=C(""),ne=C(""),R=C(""),P=C(!1),pe=C([]),Ee=C("other"),Be=C(),Q=!1,Re=1,be=C(!1),ye=C(null);function Te(j){r(ye,j)}function M(){r(ye,null)}function E(j){r(ye,e(ye)===j?null:j)}function x(j){me.update(Ve=>(Ve.activeStates||(Ve.activeStates=[]),Ve.activeStates=[...Ve.activeStates,j],Ve)),r(F,!1),Ht.add(`Added condition: ${j.name}`,"success")}function W(){r(F,!1)}function g(){const j=[];me.update(S=>{const pt=S.hitDice.current;S.hitDice.current=Math.min(S.hitDice.max,S.hitDice.current+Math.max(1,Math.floor(S.hitDice.max/2)));const bt=S.hitDice.current-pt;if(bt>0&&j.push(`${bt} hit ${bt===1?"die":"dice"}`),S.class){const jt=wa(S.class,S.level,S.subclass);S.classFeatures.features||(S.classFeatures.features={}),jt.forEach(Se=>{if(Se.resetOn==="short"){const We=Se.name.replace(/\s+/g,"");if(Se.type==="uses"){const et=typeof Se.maxUses=="function"?Se.maxUses(S.level):Se.maxUses;S.classFeatures.features[We]=Array(et).fill(!1),j.push(Se.name)}else if(Se.type==="pool"){const et=typeof Se.maxPool=="function"?Se.maxPool(S.level):Se.maxPool;et!==void 0&&(S.classFeatures.features[We]=et,j.push(Se.name))}}})}return S.activeStates&&S.activeStates.forEach(jt=>{jt.abilities&&jt.abilities.forEach(Se=>{if(Se.restType==="short"&&Se.usesPerRest){const We=Se.usesPerRest-(Se.currentUses||0)>0;Se.currentUses=Se.usesPerRest,We&&j.push(`${jt.name}: ${Se.name}`)}})}),S}),ps("short"),as(t().race,t().level).some(S=>S.restType==="short"&&S.usesPerRest)&&j.push("racial traits"),r(be,!1);const se=j.length>0?`Short rest taken! Restored: ${j.join(", ")}`:"Short rest taken!";Ht.add(se,"success")}function T(){const j=[];me.update(S=>{const pt=S.maxHP-S.currentHP;pt>0&&j.push(`${pt} HP`),S.currentHP=S.maxHP,S.tempHP=0;const bt=S.hitDice.max-S.hitDice.current;bt>0&&j.push(`${bt} hit ${bt===1?"die":"dice"}`),S.hitDice.current=S.hitDice.max;let jt=0;if(S.classFeatures.spellSlotsByLevel&&Object.keys(S.classFeatures.spellSlotsByLevel).forEach(Se=>{const We=S.classFeatures.spellSlotsByLevel[parseInt(Se)];if(We){const et=We.filter(Lt=>Lt).length;jt+=et,S.classFeatures.spellSlotsByLevel[parseInt(Se)]=Array(We.length).fill(!1)}}),jt>0&&j.push(`${jt} spell ${jt===1?"slot":"slots"}`),S.class){const Se=wa(S.class,S.level,S.subclass);S.classFeatures.features||(S.classFeatures.features={});let We=!1;Se.forEach(et=>{const Lt=et.name.replace(/\s+/g,"");if(!(et.type==="info"||et.type==="channelDivinity")){if(et.type==="uses"){const $t=typeof et.maxUses=="function"?et.maxUses(S.level):et.maxUses;S.classFeatures.features[Lt]=Array($t).fill(!1),We=!0}else if(et.type==="pool"){const $t=typeof et.maxPool=="function"?et.maxPool(S.level):et.maxPool;$t!==void 0&&(S.classFeatures.features[Lt]=$t,We=!0)}}}),We&&j.push("all class features")}if(S.activeStates){let Se=!1;S.activeStates.forEach(We=>{We.abilities&&We.abilities.forEach(et=>{if(et.usesPerRest){const Lt=(et.currentUses||0)<et.usesPerRest;et.currentUses=et.usesPerRest,Lt&&(Se=!0)}})}),Se&&j.push("condition abilities")}return S}),ps("long"),as(t().race,t().level).some(S=>S.usesPerRest)&&j.push("racial traits"),r(be,!1);const se=j.length>0?`Long rest taken! Restored: ${j.join(", ")}`:"Long rest taken! Fully rested.";Ht.add(se,"success")}function I(j){r(le,""),r(ne,""),r(R,""),r(P,!1),r(pe,[]),r(Ee,"other"),Q=!1,typeof j=="string"?r(le,j):(r(le,j.notation),r(ne,j.damageNotation||""),r(R,j.attackName||""),r(P,!!j.applyHalfDamage),r(pe,j.bonusBreakdown||[]),r(Ee,j.rollType||"other")),r(h,!0)}function Me(j){const{notation:Ve,count:at,bonusBreakdown:se}=j.detail;r(le,""),Q=!0,Re=at||1,setTimeout(()=>{r(le,Ve),r(ne,""),r(R,"Hit Die"),r(pe,se||[]),r(Ee,"other")},0),r(h,!0)}function Ce(){if(r(h,!1),Q&&e(Be)){const j=e(Be).getLastRollTotal();if(j!==null){const Ve=Math.max(1,j);me.update(at=>(at.hitDice.current=Math.max(0,at.hitDice.current-Re),at.currentHP=Math.min(at.maxHP,at.currentHP+Ve),at))}Q=!1}}function de(){ma.update(j=>!j)}function fe(j){j.target.closest(".rest-button-container")||r(be,!1)}Sa(()=>{const j=ma.subscribe(Ve=>{Ve?document.body.classList.remove("use-mode"):document.body.classList.add("use-mode")});return document.addEventListener("click",fe),()=>{j(),document.removeEventListener("click",fe)}});function Ae(){nl(t())}function Je(){e(X)?.click()}async function ot(j){const at=j.target.files?.[0];if(at)try{const se=await rl(at);me.set(se),alert("Character imported successfully!")}catch{alert("Failed to import character file")}}qt();var ht=$o();ll("1uha8ag",j=>{var Ve=ao();Yt(2),Ds(()=>{el.title="D&D Character Sheet"}),o(j,Ve)});var dt=Le(ht),Qe=l(dt),$=l(Qe),N=l($),ge=l(N),xe=a(l(ge),2);{var _=j=>{var Ve=so(),at=l(Ve);s(Ve),w(()=>k(at,`${t().name??""} (${t().level??""})`)),o(j,Ve)};b(xe,j=>{t().name&&j(_)})}s(ge);var O=a(ge,2);{var ie=j=>{var Ve=io();xt(Ve,5,L,Ct,(at,se)=>{var S=lo();let pt;var bt=l(S);s(S),w(()=>{pt=At(S,1,"slot-badge svelte-1uha8ag",null,pt,{depleted:e(se).available===0}),k(bt,`Lv${e(se).level??""}: ${e(se).available??""}/${e(se).total??""}`)}),o(at,S)}),s(Ve),o(j,Ve)};b(O,j=>{L().length>0&&j(ie)})}var he=a(O,2);{var ee=j=>{var Ve=yo(),at=Le(Ve);xt(at,5,()=>t().activeStates,Ct,(se,S,pt)=>{var bt=_o(),jt=l(bt),Se=a(jt);{var We=$t=>{var mt=bo(),it=l(mt),Tt=l(it,!0);s(it);var ea=a(it,2),ta=a(ea,3);{var Xt=vt=>{var _t=no(),kt=Le(_t),Ft=l(kt);s(kt),Yt(),w(()=>k(Ft,`Attack Bonus: ${typeof e(S).attackBonus=="number"&&e(S).attackBonus>0?"+":""}${e(S).attackBonus??""}`)),o(vt,_t)};b(ta,vt=>{e(S).attackBonus&&vt(Xt)})}var aa=a(ta,2);{var Bt=vt=>{var _t=ro(),kt=Le(_t),Ft=l(kt);s(kt),Yt(),w(()=>k(Ft,`Damage Bonus: ${typeof e(S).damageBonus=="number"&&e(S).damageBonus>0?"+":""}${e(S).damageBonus??""}`)),o(vt,_t)};b(aa,vt=>{e(S).damageBonus&&vt(Bt)})}var Mt=a(aa,2);{var Nt=vt=>{var _t=oo(),kt=Le(_t),Ft=l(kt);s(kt),Yt(),w(()=>k(Ft,`AC Bonus: ${e(S).acBonus>0?"+":""}${e(S).acBonus??""}`)),o(vt,_t)};b(Mt,vt=>{e(S).acBonus&&vt(Nt)})}var sa=a(Mt,2);{var ra=vt=>{var _t=co(),kt=Le(_t),Ft=l(kt);s(kt),Yt(),w(()=>k(Ft,`Darkvision: ${e(S).darkvision??""} feet`)),o(vt,_t)};b(sa,vt=>{e(S).darkvision&&vt(ra)})}var da=a(sa,2);{var Jt=vt=>{var _t=vo(),kt=Le(_t),Ft=l(kt);s(kt),Yt(),w(wt=>k(Ft,`Resistances: ${wt??""}`),[()=>e(S).resistances.join(", ")]),o(vt,_t)};b(da,vt=>{e(S).resistances&&e(S).resistances.length>0&&vt(Jt)})}var It=a(da,2);{var Kt=vt=>{var _t=uo(),kt=Le(_t),Ft=l(kt);s(kt),Yt(),w(wt=>k(Ft,`Immunities: ${wt??""}`),[()=>e(S).immunities.join(", ")]),o(vt,_t)};b(It,vt=>{e(S).immunities&&e(S).immunities.length>0&&vt(Kt)})}var Zt=a(It,2);{var Dt=vt=>{var _t=go(),kt=a(l(_t),3);xt(kt,1,()=>e(S).abilities,Ct,(Ft,wt)=>{var Vt=mo(),Ot=l(Vt),oa=l(Ot);s(Ot);var ua=a(Ot),Et=a(ua);{var Gt=la=>{var ya=fo(),Ma=a(Le(ya)),Fa=l(Ma),Ca=a(Fa);{var za=Wa=>{var Fs=Rt(", requires reaction");o(Wa,Fs)};b(Ca,Wa=>{e(wt).requiresReaction&&Wa(za)})}Yt(),s(Ma),w(()=>k(Fa,`(${(e(wt).currentUses||0)??""}/${e(wt).usesPerRest??""} uses per ${e(wt).restType??""}
                                rest`)),o(la,ya)},ca=la=>{var ya=gt(),Ma=Le(ya);{var Fa=Ca=>{var za=po();Yt(),o(Ca,za)};b(Ma,Ca=>{e(wt).requiresReaction&&Ca(Fa)},!0)}o(la,ya)};b(Et,la=>{e(wt).usesPerRest?la(Gt):la(ca,!1)})}s(Vt),w(()=>{k(oa,`${e(wt).name??""}:`),k(ua,` ${e(wt).description??""} `)}),o(Ft,Vt)}),s(_t),o(vt,_t)};b(Zt,vt=>{e(S).abilities&&e(S).abilities.length>0&&vt(Dt)})}s(mt),w(()=>{k(Tt,e(S).name),k(ea,` ${e(S).description??""}`)}),o($t,mt)};b(Se,$t=>{e(ye)===pt&&$t(We)})}var et=a(Se,2);{var Lt=$t=>{var mt=ho();w(()=>nt(mt,"title",`End ${e(S).name??""}`)),A("click",mt,()=>{me.update(it=>{if(it.activeStates){const Tt=it.activeStates[pt];Tt?.hpBonus&&Tt.target!=="other"&&(it.maxHP-=Tt.hpBonus,it.currentHP=Math.max(1,Math.min(it.currentHP-Tt.hpBonus,it.maxHP))),it.activeStates=it.activeStates.filter((ea,ta)=>ta!==pt)}return it})}),o($t,mt)};b(et,$t=>{v()||$t(Lt)})}s(bt),w(()=>{nt(bt,"aria-label",e(S).name),k(jt,`‚ú® ${e(S).name??""} `)}),A("mouseenter",bt,()=>Te(pt)),A("mouseleave",bt,M),A("focus",bt,()=>Te(pt)),A("blur",bt,M),A("click",bt,()=>E(pt)),o(se,bt)}),s(at),Yt(2),o(j,Ve)};b(he,j=>{t().activeStates&&t().activeStates.length>0&&j(ee)})}s(N);var H=a(N,2),U=l(H),Z=l(U),B=a(Z,2),Fe=l(B),De=a(Fe,2);{var Xe=j=>{var Ve=xo(),at=l(Ve),se=a(at,2);s(Ve),A("click",at,g),A("click",se,T),o(j,Ve)};b(De,j=>{e(be)&&j(Xe)})}s(B);var $e=a(B,2),m=a($e,2),oe=l(m);let te;var z=l(oe),Ne=l(z,!0);s(z);var Pe=a(z),we=l(Pe,!0);s(Pe),s(oe),s(m),s(U);var Ue=a(U,2),ce=l(Ue);je(ce),s(Ue),s(H),s($);var Ie=a($,2),_e=l(Ie),Ye=a(_e,2),Ge=a(Ye,2),rt=a(Ge,2),ct=a(rt,2),ve=a(ct,2);Ba(ve,j=>r(X,j),()=>e(X)),s(Ie),s(Qe);var D=a(Qe,2),G=l(D);Cl(G,{});var V=a(G,2);Al(V,{$$events:{roll:j=>I(j.detail)}});var K=a(V,2);Ql(K,{$$events:{roll:j=>I(j.detail)}});var ke=a(K,2);Kl(ke,{$$events:{rollHitDice:Me}});var qe=a(ke,2);to(qe,{});var st=a(qe,2);tn(st,{$$events:{roll:j=>I(j.detail)}});var ze=a(st,2);Mn(ze,{});var Ke=a(ze,2);In(Ke,{}),s(D),s(dt);var ue=a(dt,2);Ba(sr(ue,{get notation(){return e(le)},get damageNotation(){return e(ne)},get attackName(){return e(R)},get applyHalfDamage(){return e(P)},get bonusBreakdown(){return e(pe)},get rollType(){return e(Ee)},get visible(){return e(h)},$$events:{close:Ce},$$legacy:!0}),j=>r(Be,j),()=>e(Be));var q=a(ue,2);{var He=j=>{kr(j,{get mode(){return e(re)},$$events:{close:()=>r(y,!1)}})};b(q,j=>{e(y)&&j(He)})}var ft=a(q,2);{var Ze=j=>{Ur(j,{onClose:()=>r(Y,!1)})};b(ft,j=>{e(Y)&&j(Ze)})}var lt=a(ft,2);Kr(lt,{get show(){return e(F)},onSave:x,onCancel:W});var ae=a(lt,2);il(ae,{}),w(()=>{te=At(oe,1,"btn btn-mode svelte-1uha8ag",null,te,{"use-mode":!v()}),k(Ne,v()?"üìù":"üé≤"),k(we,v()?"Edit Mode":"Use Mode")}),A("click",Z,()=>{r(pe,[]),r(h,!0)}),A("click",Fe,()=>r(be,!e(be))),A("click",$e,()=>r(F,!0)),A("click",oe,de),Oe(ce,u,j=>ol(ga,j)),A("click",_e,()=>r(Y,!0)),A("click",Ye,()=>{r(re,"save"),r(y,!0)}),A("click",Ge,()=>{r(re,"load"),r(y,!0)}),A("click",rt,Ae),A("click",ct,Je),A("change",ve,ot),o(i,ht),Wt(),f()}export{Bo as component};
