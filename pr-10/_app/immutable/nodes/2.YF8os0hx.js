import{f as P,a as j,c as st,t as Et}from"../chunks/mkZmZ81y.js";import{i as Te}from"../chunks/FBASNTL0.js";import{w as dt,d as ia,c as at,o as qt}from"../chunks/z5UwTqwm.js";import{h as Re,T as ra,f as na,z as e,a9 as Be,V as oa,W as ca,X as Mt,k as ht,j as mt,e as rt,C as va,aJ as da,au as Nt,c as tt,b as $t,s as ua,aH as Jt,R as Lt,a as St,$ as U,am as Rt,aP as zt,aQ as Vt,aR as fa,g as pa,aS as Wt,r as Yt,p as ba,aT as gt,q as ha,aU as ma,i as ga,aV as _a,aW as ya,aG as ka,d as xa,a0 as Xt,aX as $a,aY as Sa,aZ as Zt,aN as Ca,w as u,Z as Kt,a_ as wa,a3 as Da,E as He,G as le,I as Pe,J as n,M as i,K as r,a$ as Se,b0 as Ke,a2 as b,F as je,A as ze,b1 as nt,b2 as ct,b3 as La,Y as ja,b4 as Fa}from"../chunks/ByemHS7S.js";import{e as M,s as ee}from"../chunks/BWpo5zNc.js";import{i as oe,s as Je,a as ce,c as ge,p as lt,b as Ct,d as Aa}from"../chunks/BCScMMe7.js";import{s as Le,r as W,a as Qt,b as Tt,h as Ia}from"../chunks/CuTwUnHZ.js";import{b as ot}from"../chunks/-SJzkqQD.js";function Xe(t,s){return s}function Ea(t,s,a){for(var l=[],c=s.length,d=0;d<c;d++)_a(s[d].e,l,!0);ya(l,()=>{var v=l.length===0&&a!==null;if(v){var h=a,o=h.parentNode;ka(o),o.append(h),t.items.clear(),Ne(t,s[0].prev,s[c-1].next)}for(var _=0;_<c;_++){var g=s[_];v||(t.items.delete(g.k),Ne(t,g.prev,g.next)),xa(g.e,!v)}t.first===s[0]&&(t.first=s[0].prev)})}function Ve(t,s,a,l,c,d=null){var v=t,h=new Map,o=null,_=(s&Wt)!==0,g=(s&Vt)!==0,N=(s&zt)!==0;if(_){var y=t;v=Re?ht(pa(y)):y.appendChild(St())}Re&&ra();var E=null,q=Be(()=>{var w=a();return Lt(w)?w:w==null?[]:Jt(w)}),F,f=!0;function $(){Ma(G,F,v,s,l),E!==null&&(F.length===0?(E.fragment?(v.before(E.fragment),E.fragment=null):Yt(E.effect),A.first=E.effect):ba(E.effect,()=>{E=null}))}var A=na(()=>{F=e(q);var w=F.length;let I=!1;if(Re){var m=oa(v)===ca;m!==(w===0)&&(v=Mt(),ht(v),mt(!1),I=!0)}for(var S=new Set,R=tt,O=null,B=ua(),X=0;X<w;X+=1){Re&&rt.nodeType===va&&rt.data===da&&(v=rt,I=!0,mt(!1));var ne=F[X],k=l(ne,X),x=f?null:h.get(k);x?(g&&Nt(x.v,ne),N?Nt(x.i,X):x.i=X,B&&R.skipped_effects.delete(x.e)):(x=Na(f?v:null,O,ne,k,X,c,s,a),f&&(x.o=!0,O===null?o=x:O.next=x,O=x),h.set(k,x)),S.add(k)}if(w===0&&d&&!E)if(f)E={fragment:null,effect:$t(()=>d(v))};else{var C=document.createDocumentFragment(),Q=St();C.append(Q),E={fragment:C,effect:$t(()=>d(Q))}}if(Re&&w>0&&ht(Mt()),!f)if(B){for(const[J,z]of h)S.has(J)||R.skipped_effects.add(z.e);R.oncommit($),R.ondiscard(()=>{})}else $();I&&mt(!0),e(q)}),G={effect:A,items:h,first:o};f=!1,Re&&(v=rt)}function Ma(t,s,a,l,c){var d=(l&ma)!==0,v=s.length,h=t.items,o=t.first,_,g=null,N,y=[],E=[],q,F,f,$;if(d)for($=0;$<v;$+=1)q=s[$],F=c(q,$),f=h.get(F),f.a?.measure(),(N??=new Set).add(f);for($=0;$<v;$+=1){if(q=s[$],F=c(q,$),f=h.get(F),t.first??=f,!f.o){f.o=!0;var A=g?g.next:o;Ne(t,g,f),Ne(t,f,A),_t(f,A,a),g=f,y=[],E=[],o=g.next;continue}if((f.e.f&gt)!==0&&(Yt(f.e),d&&(f.a?.unfix(),(N??=new Set).delete(f))),f!==o){if(_!==void 0&&_.has(f)){if(y.length<E.length){var G=E[0],w;g=G.prev;var I=y[0],m=y[y.length-1];for(w=0;w<y.length;w+=1)_t(y[w],G,a);for(w=0;w<E.length;w+=1)_.delete(E[w]);Ne(t,I.prev,m.next),Ne(t,g,I),Ne(t,m,G),o=G,g=m,$-=1,y=[],E=[]}else _.delete(f),_t(f,o,a),Ne(t,f.prev,f.next),Ne(t,f,g===null?t.first:g.next),Ne(t,g,f),g=f;continue}for(y=[],E=[];o!==null&&o.k!==F;)(o.e.f&gt)===0&&(_??=new Set).add(o),E.push(o),o=o.next;if(o===null)continue;f=o}y.push(f),g=f,o=f.next}if(o!==null||_!==void 0){for(var S=_===void 0?[]:Jt(_);o!==null;)(o.e.f&gt)===0&&S.push(o),o=o.next;var R=S.length;if(R>0){var O=(l&Wt)!==0&&v===0?a:null;if(d){for($=0;$<R;$+=1)S[$].a?.measure();for($=0;$<R;$+=1)S[$].a?.fix()}Ea(t,S,O)}}d&&ha(()=>{if(N!==void 0)for(f of N)f.a?.apply()})}function Na(t,s,a,l,c,d,v,h){var o=(v&Vt)!==0,_=(v&fa)===0,g=o?_?U(a,!1,!1):Rt(a):a,N=(v&zt)===0?c:Rt(c),y={i:N,v:g,k:l,a:null,e:null,o:!1,prev:s,next:null};try{if(t===null){var E=document.createDocumentFragment();E.append(t=St())}return y.e=$t(()=>d(t,g,N,h)),s!==null&&(s.next=y),y}finally{}}function _t(t,s,a){for(var l=t.next?t.next.e.nodes_start:a,c=s?s.e.nodes_start:a,d=t.e.nodes_start;d!==null&&d!==l;){var v=ga(d);c.before(d),d=v}}function Ne(t,s,a){s===null?(t.first=a,t.effect.first=a&&a.e):(s.e.next&&(s.e.next.prev=null),s.next=a,s.e.next=a&&a.e),a===null?t.effect.last=s&&s.e:(a.e.prev&&(a.e.prev.next=null),a.prev=s,a.e.prev=s&&s.e)}const Ht=[...` 	
\r\fÂ \v\uFEFF`];function Ra(t,s,a){var l=t==null?"":""+t;if(a){for(var c in a)if(a[c])l=l?l+" "+c:c;else if(l.length)for(var d=c.length,v=0;(v=l.indexOf(c,v))>=0;){var h=v+d;(v===0||Ht.includes(l[v-1]))&&(h===l.length||Ht.includes(l[h]))?l=(v===0?"":l.substring(0,v))+l.substring(h+1):v=h}}return l===""?null:l}function qe(t,s,a,l,c,d){var v=t.__className;if(Re||v!==a||v===void 0){var h=Ra(a,l,d);(!Re||h!==t.getAttribute("class"))&&(h==null?t.removeAttribute("class"):t.className=h),t.__className=a}else if(d&&c!==d)for(var o in d){var _=!!d[o];(c==null||_!==!!c[o])&&t.classList.toggle(o,_)}return d}function ea(t,s,a=!1){if(t.multiple){if(s==null)return;if(!Lt(s))return $a();for(var l of t.options)l.selected=s.includes(Pt(l));return}for(l of t.options){var c=Pt(l);if(Sa(c,s)){l.selected=!0;return}}(!a||s!==void 0)&&(t.selectedIndex=-1)}function Ta(t){var s=new MutationObserver(()=>{ea(t,t.__value)});s.observe(t,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Xt(()=>{s.disconnect()})}function Pt(t){return"__value"in t?t.__value:t.value}function K(t,s,a=s){var l=new WeakSet;Zt(t,"input",async c=>{var d=c?t.defaultValue:t.value;if(d=yt(t)?kt(d):d,a(d),tt!==null&&l.add(tt),await Ca(),d!==(d=s())){var v=t.selectionStart,h=t.selectionEnd,o=t.value.length;if(t.value=d??"",h!==null){var _=t.value.length;v===h&&h===o&&_>o?(t.selectionStart=_,t.selectionEnd=_):(t.selectionStart=v,t.selectionEnd=Math.min(h,_))}}}),(Re&&t.defaultValue!==t.value||u(s)==null&&t.value)&&(a(yt(t)?kt(t.value):t.value),tt!==null&&l.add(tt)),Kt(()=>{var c=s();if(t===document.activeElement){var d=wa??tt;if(l.has(d))return}yt(t)&&c===kt(t.value)||t.type==="date"&&!c&&!t.value||c!==t.value&&(t.value=c??"")})}function jt(t,s,a=s){Zt(t,"change",l=>{var c=l?t.defaultChecked:t.checked;a(c)}),(Re&&t.defaultChecked!==t.checked||u(s)==null)&&a(t.checked),Kt(()=>{var l=s();t.checked=!!l})}function yt(t){var s=t.type;return s==="number"||s==="range"}function kt(t){return t===""?null:+t}function Ha(t,s,a){var l=Da(t,s);l&&l.set&&(t[s]=a,Xt(()=>{t[s]=null}))}function ta(t){return function(...s){var a=s[0];return a.stopPropagation(),t?.apply(this,s)}}function vt(t,s){var a=t.$$events?.[s.type],l=Lt(a)?a.slice():a==null?[]:[a];for(var c of l)c.call(this,s)}const wt={name:"",class:"",level:1,race:"",background:"",alignment:"",armorClass:10,initiative:0,speed:"30 ft",currentHP:0,maxHP:0,tempHP:0,hitDice:{current:3,max:3},abilities:{strength:10,dexterity:10,constitution:10,intelligence:10,wisdom:10,charisma:10},proficiencyBonus:2,saveProficiencies:{strength:!1,dexterity:!1,constitution:!1,intelligence:!1,wisdom:!1,charisma:!1},skillProficiencies:{acrobatics:!1,animalHandling:!1,arcana:!1,athletics:!1,deception:!1,history:!1,insight:!1,intimidation:!1,investigation:!1,medicine:!1,nature:!1,perception:!1,performance:!1,persuasion:!1,religion:!1,sleightOfHand:!1,stealth:!1,survival:!1},attacks:[],features:"",equipment:"",notes:"",classFeatures:{features:{},spellSlots:[],preparedSpells:""}};function Pa(){try{const t=localStorage.getItem("dndCharacter");if(t){const s={...wt,...JSON.parse(t)};return s.attacks&&Array.isArray(s.attacks)&&(s.attacks=s.attacks.map(a=>({...a,id:a.id||crypto.randomUUID()}))),s.classFeatures?(s.classFeatures.features||(s.classFeatures.features={}),s.classFeatures.spellSlots||(s.classFeatures.spellSlots=[]),s.classFeatures.preparedSpells===void 0&&(s.classFeatures.preparedSpells="")):s.classFeatures={features:{},spellSlots:[],preparedSpells:""},s}}catch(t){console.error("Failed to load character from storage:",t)}return wt}const H=dt(Pa());H.subscribe(t=>{try{localStorage.setItem("dndCharacter",JSON.stringify(t))}catch(s){console.error("Failed to save character to storage:",s)}});const it=dt(!0);{const t=localStorage.getItem("dndMode");it.set(t==="edit"),it.subscribe(s=>{localStorage.setItem("dndMode",s?"edit":"use")})}const ut=ia(H,t=>{const s=a=>Math.floor((a-10)/2);return{strength:s(t.abilities.strength),dexterity:s(t.abilities.dexterity),constitution:s(t.abilities.constitution),intelligence:s(t.abilities.intelligence),wisdom:s(t.abilities.wisdom),charisma:s(t.abilities.charisma)}});function Oa(t){return Math.ceil(t/4)+1}function Ua(){H.update(t=>(t.proficiencyBonus=Oa(t.level),t))}function Ga(t){const s=JSON.stringify(t,null,2),a="data:application/json;charset=utf-8,"+encodeURIComponent(s),l=`${t.name||"character"}_${new Date().toISOString().split("T")[0]}.json`,c=document.createElement("a");c.setAttribute("href",a),c.setAttribute("download",l),c.click()}function Ba(t){return new Promise((s,a)=>{const l=new FileReader;l.onload=c=>{try{const d=JSON.parse(c.target?.result),v={...wt,...d};v.attacks&&Array.isArray(v.attacks)&&(v.attacks=v.attacks.map(h=>({...h,id:h.id||crypto.randomUUID()}))),v.classFeatures?(v.classFeatures.features||(v.classFeatures.features={}),v.classFeatures.spellSlots||(v.classFeatures.spellSlots=[]),v.classFeatures.preparedSpells===void 0&&(v.classFeatures.preparedSpells="")):v.classFeatures={features:{},spellSlots:[],preparedSpells:""},s(v)}catch{a(new Error("Invalid character file"))}},l.onerror=()=>a(new Error("Failed to read file")),l.readAsText(t)})}const We=dt("");function qa(){try{const t=localStorage.getItem("dndCollapsedStates");if(t)return JSON.parse(t)}catch(t){console.error("Failed to load collapsed states:",t)}return{characterInfo:!1,combatStats:!1,abilityScores:!1,skills:!1,attacks:!1,classFeatures:!1,notes:!1}}const Ce=dt(qa());Ce.subscribe(t=>{try{localStorage.setItem("dndCollapsedStates",JSON.stringify(t))}catch(s){console.error("Failed to save collapsed states:",s)}});const Dt={paladin:{name:"Paladin",hitDice:"d10",spellcaster:!0,spellcastingAbility:"charisma",spellSlotsByLevel:{1:0,2:2,3:3,4:3,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Divine Sense",type:"uses",maxUses:(t,s=1)=>1+Math.max(1,s),resetOn:"long",description:"Detect celestials, fiends, and undead within 60 feet",minLevel:1},{name:"Lay on Hands",type:"pool",maxPool:t=>t*5,resetOn:"long",description:"Heal wounds or cure disease",minLevel:1},{name:"Divine Smite",type:"spellSlot",description:"Expend spell slot to deal extra radiant damage",minLevel:2,rollable:!0},{name:"Channel Divinity",type:"uses",maxUses:t=>t>=18?3:t>=6?2:1,resetOn:"short",description:"Sacred Weapon or Turn Undead",minLevel:3}]},fighter:{name:"Fighter",hitDice:"d10",spellcaster:!1,features:[{name:"Second Wind",type:"uses",maxUses:1,resetOn:"short",description:"Regain 1d10 + fighter level HP as bonus action",minLevel:1,rollable:!0,rollFormula:t=>`1d10+${t}`},{name:"Action Surge",type:"uses",maxUses:t=>t>=17?2:1,resetOn:"short",description:"Take one additional action on your turn",minLevel:2},{name:"Indomitable",type:"uses",maxUses:t=>t>=17?3:t>=13?2:1,resetOn:"long",description:"Reroll a failed saving throw",minLevel:9}]},rogue:{name:"Rogue",hitDice:"d8",spellcaster:!1,features:[{name:"Sneak Attack",type:"info",description:t=>`Deal ${Math.ceil(t/2)}d6 extra damage once per turn with advantage or ally nearby`,minLevel:1,rollable:!0,rollFormula:t=>`${Math.ceil(t/2)}d6`},{name:"Cunning Action",type:"info",description:"Dash, Disengage, or Hide as a bonus action",minLevel:2},{name:"Uncanny Dodge",type:"info",description:"Use reaction to halve damage from an attack",minLevel:5},{name:"Evasion",type:"info",description:"Take no damage on successful Dex save (half on fail)",minLevel:7}]},wizard:{name:"Wizard",hitDice:"d6",spellcaster:!0,spellcastingAbility:"intelligence",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Arcane Recovery",type:"uses",maxUses:1,resetOn:"long",description:t=>`Recover spell slots totaling up to ${Math.ceil(t/2)} levels during short rest`,minLevel:1},{name:"Spell Mastery",type:"info",description:"Cast one 1st-level and one 2nd-level spell at will",minLevel:18}]},cleric:{name:"Cleric",hitDice:"d8",spellcaster:!0,spellcastingAbility:"wisdom",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Channel Divinity",type:"uses",maxUses:t=>t>=18?3:t>=6?2:1,resetOn:"short",description:"Turn Undead or domain-specific ability",minLevel:2},{name:"Destroy Undead",type:"info",description:t=>`Channel Divinity destroys undead of CR ${t>=17?4:t>=14?3:t>=11?2:t>=8?1:.5} or lower`,minLevel:5},{name:"Divine Intervention",type:"uses",maxUses:1,resetOn:"long",description:t=>`${t}% chance to succeed, implore deity for aid`,minLevel:10}]},barbarian:{name:"Barbarian",hitDice:"d12",spellcaster:!1,features:[{name:"Rage",type:"uses",maxUses:t=>t>=20?1/0:t>=17?6:t>=12?5:t>=6?4:t>=3?3:2,resetOn:"long",description:t=>`+${t>=16?4:t>=9?3:2} damage, resistance to physical damage`,minLevel:1},{name:"Reckless Attack",type:"info",description:"Gain advantage on melee attacks, enemies get advantage on you",minLevel:2},{name:"Danger Sense",type:"info",description:"Advantage on Dex saves against effects you can see",minLevel:2}]}};function Ze(t){const s=t.toLowerCase();return Dt[s]||null}function Ot(t,s){const a=Ze(t);return a?a.features.filter(l=>!l.minLevel||l.minLevel<=s):[]}function Ut(t,s){const a=Ze(t);return!a||!a.spellcaster||!a.spellSlotsByLevel?0:a.spellSlotsByLevel[s]||0}function Gt(t,s,a){const l=Ze(t);return!l||!l.spellcaster?0:Math.max(1,a+s)}function Ja(t,s,a){const l=Ze(t);return!l||!l.spellcaster?null:8+s+a}function za(){return Object.keys(Dt).map(t=>({id:t,name:Dt[t].name}))}var Va=P("<option> </option>"),Wa=P('<div class="info-grid svelte-172i2fj"><div class="form-group svelte-172i2fj"><label for="characterName" class="svelte-172i2fj">Character Name</label> <input type="text" id="characterName" placeholder="Enter name" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterClass" class="svelte-172i2fj">Class</label> <select id="characterClass" class="svelte-172i2fj"><option>Select Class</option><!></select></div> <div class="form-group svelte-172i2fj"><label for="characterLevel" class="svelte-172i2fj">Level</label> <input type="number" id="characterLevel" min="1" max="20" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterRace" class="svelte-172i2fj">Race</label> <input type="text" id="characterRace" placeholder="e.g., Human" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterBackground" class="svelte-172i2fj">Background</label> <input type="text" id="characterBackground" placeholder="e.g., Soldier" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterAlignment" class="svelte-172i2fj">Alignment</label> <input type="text" id="characterAlignment" placeholder="e.g., Lawful Good" class="svelte-172i2fj"/></div></div>'),Ya=P('<section class="character-info svelte-172i2fj"><div class="header svelte-172i2fj"><h2 class="svelte-172i2fj">Character Info</h2> <button class="collapse-btn svelte-172i2fj"> </button></div> <!></section>');function Xa(t,s){He(s,!1);const a=()=>ce(Ce,"$collapsedStates",c),l=()=>ce(H,"$character",c),[c,d]=Je(),v=za();function h(f){const $=f.target;H.update(A=>(A.class=$.value,A))}function o(f){const $=f.target;H.update(A=>(A.level=parseInt($.value)||1,A)),Ua()}function _(){Ce.update(f=>({...f,characterInfo:!f.characterInfo}))}Te();var g=Ya(),N=n(g),y=i(n(N),2),E=n(y,!0);r(y),r(N);var q=i(N,2);{var F=f=>{var $=Wa(),A=n($),G=i(n(A),2);W(G),r(A);var w=i(A,2),I=i(n(w),2),m=n(I);m.value=m.__value="";var S=i(m);Ve(S,1,()=>v,Xe,(J,z)=>{var Y=Va(),D=n(Y,!0);r(Y);var V={};le(()=>{ee(D,e(z).name),V!==(V=e(z).id)&&(Y.value=(Y.__value=e(z).id)??"")}),j(J,Y)}),r(I);var R;Ta(I),r(w);var O=i(w,2),B=i(n(O),2);W(B),r(O);var X=i(O,2),ne=i(n(X),2);W(ne),r(X);var k=i(X,2),x=i(n(k),2);W(x),r(k);var C=i(k,2),Q=i(n(C),2);W(Q),r(C),r($),le(()=>{R!==(R=l().class)&&(I.value=(I.__value=l().class)??"",ea(I,l().class)),Qt(B,l().level)}),K(G,()=>l().name,J=>ge(H,u(l).name=J,u(l))),M("change",I,h),M("change",B,o),K(ne,()=>l().race,J=>ge(H,u(l).race=J,u(l))),K(x,()=>l().background,J=>ge(H,u(l).background=J,u(l))),K(Q,()=>l().alignment,J=>ge(H,u(l).alignment=J,u(l))),j(f,$)};oe(q,f=>{a().characterInfo||f(F)})}r(g),le(()=>{Le(y,"aria-label",a().characterInfo?"Expand":"Collapse"),ee(E,a().characterInfo?"â–¼":"â–²")}),M("click",y,_),j(t,g),Pe(),d()}var Za=P('<div class="ability-card svelte-bbv1xt"><h3 class="svelte-bbv1xt"> </h3> <input type="number" class="ability-score svelte-bbv1xt" min="1" max="30"/> <div class="ability-modifier svelte-bbv1xt"> </div> <button class="roll-btn svelte-bbv1xt">Check</button> <div class="save-row svelte-bbv1xt"><input type="checkbox" class="svelte-bbv1xt"/> <label class="svelte-bbv1xt">Save</label> <button class="roll-btn-small svelte-bbv1xt">Roll</button></div></div>'),Ka=P('<div class="proficiency-bonus svelte-bbv1xt"><label for="profBonus">Proficiency Bonus</label> <input type="number" id="profBonus" class="prof-input svelte-bbv1xt"/></div> <div class="abilities-grid svelte-bbv1xt"></div>',1),Qa=P('<section><div class="header svelte-bbv1xt"><h2 class="svelte-bbv1xt">Ability Scores</h2> <button class="collapse-btn svelte-bbv1xt"> </button></div> <!></section>');function es(t,s){He(s,!1);const a=()=>ce(ut,"$abilityModifiers",v),l=()=>ce(H,"$character",v),c=()=>ce(We,"$searchFilter",v),d=()=>ce(Ce,"$collapsedStates",v),[v,h]=Je(),o=U(),_=U(),g=at(),N=[{key:"strength",label:"Strength"},{key:"dexterity",label:"Dexterity"},{key:"constitution",label:"Constitution"},{key:"intelligence",label:"Intelligence"},{key:"wisdom",label:"Wisdom"},{key:"charisma",label:"Charisma"}];function y(){updateProficiencyBonus()}function E(S){const R=a()[S],O=`1d20${R>=0?"+":""}${R}`;g("roll",O)}function q(S){const R=a()[S],O=l().saveProficiencies[S]?l().proficiencyBonus:0,B=R+O,X=`1d20${B>=0?"+":""}${B}`;g("roll",X)}function F(){Ce.update(S=>({...S,abilityScores:!S.abilityScores}))}Se(()=>c(),()=>{b(o,N.filter(({label:S})=>c()?S.toLowerCase().includes(c().toLowerCase()):!0))}),Se(()=>(e(o),c()),()=>{b(_,e(o).length>0||!c()||c().toLowerCase().includes("proficiency"))}),Ke(),Te();var f=Qa();let $;var A=n(f),G=i(n(A),2),w=n(G,!0);r(G),r(A);var I=i(A,2);{var m=S=>{var R=Ka(),O=je(R),B=i(n(O),2);W(B),r(O);var X=i(O,2);Ve(X,5,()=>e(o),Xe,(ne,k)=>{let x=()=>e(k).key,C=()=>e(k).label;var Q=Za(),J=n(Q),z=n(J,!0);r(J);var Y=i(J,2);W(Y);var D=i(Y,2),V=n(D);r(D);var ie=i(D,2),te=i(ie,2),de=n(te);W(de);var _e=i(de,2),he=i(_e,2);r(te),r(Q),le(me=>{ee(z,me),ee(V,`${a(),x(),u(()=>a()[x()]>=0?"+":"")??""}${a(),x(),u(()=>a()[x()])??""}`),Le(de,"id",`${x()}-save`),Le(_e,"for",`${x()}-save`)},[()=>(C(),u(()=>C().substring(0,3).toUpperCase()))]),K(Y,()=>l().abilities[x()],me=>ge(H,u(l).abilities[x()]=me,u(l))),M("change",Y,y),M("click",ie,()=>E(x())),jt(de,()=>l().saveProficiencies[x()],me=>ge(H,u(l).saveProficiencies[x()]=me,u(l))),M("click",he,()=>q(x())),j(ne,Q)}),r(X),K(B,()=>l().proficiencyBonus,ne=>ge(H,u(l).proficiencyBonus=ne,u(l))),j(S,R)};oe(I,S=>{d(),u(()=>!d().abilityScores)&&S(m)})}r(f),le(()=>{$=qe(f,1,"ability-scores svelte-bbv1xt",null,$,{hidden:!e(_)}),Le(G,"aria-label",(d(),u(()=>d().abilityScores?"Expand":"Collapse"))),ee(w,(d(),u(()=>d().abilityScores?"â–¼":"â–²")))}),M("click",G,F),j(t,f),Pe(),h()}var ts=P('<div class="stats-grid svelte-1r5hyyb"><div class="stat-box svelte-1r5hyyb"><label for="armorClass" class="svelte-1r5hyyb">Armor Class</label> <input type="number" id="armorClass" class="stat-input svelte-1r5hyyb"/></div> <div class="stat-box svelte-1r5hyyb"><label for="initiative" class="svelte-1r5hyyb">Initiative</label> <input type="number" id="initiative" class="stat-input svelte-1r5hyyb"/></div> <div class="stat-box svelte-1r5hyyb"><label for="speed" class="svelte-1r5hyyb">Speed</label> <input type="text" id="speed" class="stat-input svelte-1r5hyyb"/></div></div> <div class="hp-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Points</h3> <div class="hp-display svelte-1r5hyyb"><div class="hp-inputs svelte-1r5hyyb"><input type="number" class="hp-current svelte-1r5hyyb" min="0"/> <span class="hp-separator svelte-1r5hyyb">/</span> <input type="number" class="hp-max svelte-1r5hyyb" min="0"/></div> <div class="hp-controls svelte-1r5hyyb"><button class="hp-btn svelte-1r5hyyb">âˆ’</button> <button class="hp-btn svelte-1r5hyyb">+</button> <button class="hp-btn svelte-1r5hyyb">âˆ’5</button> <button class="hp-btn svelte-1r5hyyb">+5</button></div></div> <div class="temp-hp svelte-1r5hyyb"><label for="tempHP" class="svelte-1r5hyyb">Temp HP</label> <input type="number" id="tempHP" min="0" class="svelte-1r5hyyb"/></div></div> <div class="hit-dice-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Dice</h3> <div class="hit-dice-display svelte-1r5hyyb"><input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <span>/</span> <input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/></div> <button class="btn btn-primary roll-hit-dice use-enabled svelte-1r5hyyb">ðŸŽ² Roll Hit Die</button></div>',1),as=P('<section><div class="header svelte-1r5hyyb"><h2 class="svelte-1r5hyyb">Combat Stats</h2> <button class="collapse-btn svelte-1r5hyyb"> </button></div> <!></section>');function ss(t,s){He(s,!1);const a=()=>ce(H,"$character",v),l=()=>ce(ut,"$abilityModifiers",v),c=()=>ce(We,"$searchFilter",v),d=()=>ce(Ce,"$collapsedStates",v),[v,h]=Je(),o=U(),_=at();function g(w){H.update(I=>(I.currentHP=Math.max(0,Math.min(I.maxHP,I.currentHP+w)),I))}function N(){if(a().hitDice.current<=0){alert("No hit dice remaining!");return}if(!a().class){alert("Please select a class first!");return}const w=Ze(a().class);if(!w){alert("Invalid class configuration!");return}const I=w.hitDice,m=l().constitution,S=m>=0?`+${m}`:`${m}`,R=`1${I}${S}`;_("rollHitDice",{notation:R,hitDie:I})}function y(){Ce.update(w=>({...w,combatStats:!w.combatStats}))}Se(()=>c(),()=>{b(o,!c()||"armor class".includes(c().toLowerCase())||"initiative".includes(c().toLowerCase())||"speed".includes(c().toLowerCase())||"hit points".includes(c().toLowerCase())||"hp".includes(c().toLowerCase())||"hit dice".includes(c().toLowerCase())||"combat".includes(c().toLowerCase()))}),Ke(),Te();var E=as();let q;var F=n(E),f=i(n(F),2),$=n(f,!0);r(f),r(F);var A=i(F,2);{var G=w=>{var I=ts(),m=je(I),S=n(m),R=i(n(S),2);W(R),r(S);var O=i(S,2),B=i(n(O),2);W(B),r(O);var X=i(O,2),ne=i(n(X),2);W(ne),r(X),r(m);var k=i(m,2),x=i(n(k),2),C=n(x),Q=n(C);W(Q);var J=i(Q,4);W(J),r(C);var z=i(C,2),Y=n(z),D=i(Y,2),V=i(D,2),ie=i(V,2);r(z),r(x);var te=i(x,2),de=i(n(te),2);W(de),r(te),r(k);var _e=i(k,2),he=i(n(_e),2),me=n(he);W(me);var xe=i(me,4);W(xe),r(he);var Z=i(he,2);r(_e),le(()=>{Le(Q,"max",(a(),u(()=>a().maxHP))),Le(me,"max",(a(),u(()=>a().hitDice.max))),Z.disabled=(a(),u(()=>a().hitDice.current<=0||!a().class))}),K(R,()=>a().armorClass,p=>ge(H,u(a).armorClass=p,u(a))),K(B,()=>a().initiative,p=>ge(H,u(a).initiative=p,u(a))),K(ne,()=>a().speed,p=>ge(H,u(a).speed=p,u(a))),K(Q,()=>a().currentHP,p=>ge(H,u(a).currentHP=p,u(a))),K(J,()=>a().maxHP,p=>ge(H,u(a).maxHP=p,u(a))),M("click",Y,()=>g(-1)),M("click",D,()=>g(1)),M("click",V,()=>g(-5)),M("click",ie,()=>g(5)),K(de,()=>a().tempHP,p=>ge(H,u(a).tempHP=p,u(a))),K(me,()=>a().hitDice.current,p=>ge(H,u(a).hitDice.current=p,u(a))),K(xe,()=>a().hitDice.max,p=>ge(H,u(a).hitDice.max=p,u(a))),M("click",Z,N),j(w,I)};oe(A,w=>{d(),u(()=>!d().combatStats)&&w(G)})}r(E),le(()=>{q=qe(E,1,"combat-stats svelte-1r5hyyb",null,q,{hidden:!e(o)}),Le(f,"aria-label",(d(),u(()=>d().combatStats?"Expand":"Collapse"))),ee($,(d(),u(()=>d().combatStats?"â–¼":"â–²")))}),M("click",f,y),j(t,E),Pe(),h()}const xt={acrobatics:"dexterity",animalHandling:"wisdom",arcana:"intelligence",athletics:"strength",deception:"charisma",history:"intelligence",insight:"wisdom",intimidation:"charisma",investigation:"intelligence",medicine:"wisdom",nature:"intelligence",perception:"wisdom",performance:"charisma",persuasion:"charisma",religion:"intelligence",sleightOfHand:"dexterity",stealth:"dexterity",survival:"wisdom"};var ls=P('<div class="skill-row svelte-1f1pl16"><input type="checkbox" class="svelte-1f1pl16"/> <label class="svelte-1f1pl16"> <span class="ability-tag svelte-1f1pl16"> </span></label> <span class="skill-modifier svelte-1f1pl16"> </span> <button class="roll-btn svelte-1f1pl16">Roll</button></div>'),is=P('<div class="skills-grid svelte-1f1pl16"></div>'),rs=P('<section><div class="header svelte-1f1pl16"><h2 class="svelte-1f1pl16">Skills</h2> <button class="collapse-btn svelte-1f1pl16"> </button></div> <!></section>');function ns(t,s){He(s,!1);const a=()=>ce(ut,"$abilityModifiers",v),l=()=>ce(H,"$character",v),c=()=>ce(We,"$searchFilter",v),d=()=>ce(Ce,"$collapsedStates",v),[v,h]=Je(),o=U(),_=U(),g=at(),N=[{key:"acrobatics",label:"Acrobatics"},{key:"animalHandling",label:"Animal Handling"},{key:"arcana",label:"Arcana"},{key:"athletics",label:"Athletics"},{key:"deception",label:"Deception"},{key:"history",label:"History"},{key:"insight",label:"Insight"},{key:"intimidation",label:"Intimidation"},{key:"investigation",label:"Investigation"},{key:"medicine",label:"Medicine"},{key:"nature",label:"Nature"},{key:"perception",label:"Perception"},{key:"performance",label:"Performance"},{key:"persuasion",label:"Persuasion"},{key:"religion",label:"Religion"},{key:"sleightOfHand",label:"Sleight of Hand"},{key:"stealth",label:"Stealth"},{key:"survival",label:"Survival"}];function y(m){const S=xt[m],R=a()[S],O=l().skillProficiencies[m]?l().proficiencyBonus:0;return R+O}function E(m){const S=y(m),R=`1d20${S>=0?"+":""}${S}`;g("roll",R)}function q(){Ce.update(m=>({...m,skills:!m.skills}))}Se(()=>c(),()=>{b(o,N.filter(({label:m})=>c()?m.toLowerCase().includes(c().toLowerCase()):!0))}),Se(()=>e(o),()=>{b(_,e(o).length>0)}),Ke(),Te();var F=rs();let f;var $=n(F),A=i(n($),2),G=n(A,!0);r(A),r($);var w=i($,2);{var I=m=>{var S=is();Ve(S,5,()=>e(o),Xe,(R,O)=>{let B=()=>e(O).key,X=()=>e(O).label;const ne=Be(()=>(ze(xt),B(),u(()=>xt[B()]))),k=Be(()=>(B(),u(()=>y(B()))));var x=ls(),C=n(x);W(C);var Q=i(C,2),J=n(Q),z=i(J),Y=n(z);r(z),r(Q);var D=i(Q,2),V=n(D);r(D);var ie=i(D,2);r(x),le(te=>{Le(C,"id",B()),Le(Q,"for",B()),ee(J,`${X()??""} `),ee(Y,`(${te??""})`),ee(V,`${e(k)>=0?"+":""}${e(k)??""}`)},[()=>(ze(e(ne)),u(()=>e(ne).substring(0,3).toUpperCase()))]),jt(C,()=>l().skillProficiencies[B()],te=>ge(H,u(l).skillProficiencies[B()]=te,u(l))),M("click",ie,()=>E(B())),j(R,x)}),r(S),j(m,S)};oe(w,m=>{d(),u(()=>!d().skills)&&m(I)})}r(F),le(()=>{f=qe(F,1,"skills svelte-1f1pl16",null,f,{hidden:!e(_)}),Le(A,"aria-label",(d(),u(()=>d().skills?"Expand":"Collapse"))),ee(G,(d(),u(()=>d().skills?"â–¼":"â–²")))}),M("click",A,q),j(t,F),Pe(),h()}var os=P('<div class="attack-card svelte-14o91c5"><div class="attack-header svelte-14o91c5"><input type="text" placeholder="Attack name" class="attack-name svelte-14o91c5"/> <button class="btn-remove svelte-14o91c5">Ã—</button></div> <div class="attack-details svelte-14o91c5"><div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Bonus</label> <input type="number" class="attack-bonus svelte-14o91c5"/></div> <div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Damage</label> <input type="text" placeholder="e.g., 2d6+3" class="attack-damage svelte-14o91c5"/></div> <div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Type</label> <input type="text" placeholder="e.g., slashing" class="attack-type svelte-14o91c5"/></div></div> <div class="attack-actions svelte-14o91c5"><button class="btn btn-primary">Roll Attack</button> <button class="btn btn-secondary">Roll Damage</button></div></div>'),cs=P('<p class="no-attacks svelte-14o91c5">No attacks added yet. Click "Add Attack" to create one.</p>'),vs=P('<p class="no-attacks svelte-14o91c5">No attacks match your search.</p>'),ds=P('<button class="btn btn-secondary">Add Attack</button> <div class="attacks-list svelte-14o91c5"><!> <!></div>',1),us=P('<section><div class="header svelte-14o91c5"><h2 class="svelte-14o91c5">Attacks & Spells</h2> <button class="collapse-btn svelte-14o91c5"> </button></div> <!></section>');function fs(t,s){He(s,!1);const a=()=>ce(H,"$character",d),l=()=>ce(We,"$searchFilter",d),c=()=>ce(Ce,"$collapsedStates",d),[d,v]=Je(),h=U(),o=U(),_=at();function g(){H.update(m=>(m.attacks=[...m.attacks,{id:crypto.randomUUID(),name:"",bonus:0,damage:"",damageType:""}],m))}function N(m){H.update(S=>(S.attacks=S.attacks.filter(R=>R.id!==m),S))}function y(m){const S=`1d20${m.bonus>=0?"+":""}${m.bonus}`;_("roll",{notation:S,damageNotation:m.damage,attackName:m.name})}function E(m){if(!m.damage){alert(`${m.name}: No damage specified`);return}_("roll",{notation:m.damage})}function q(){Ce.update(m=>({...m,attacks:!m.attacks}))}Se(()=>(a(),l()),()=>{b(h,a().attacks.filter(m=>{if(!l())return!0;const S=l().toLowerCase();return m.name.toLowerCase().includes(S)||m.damageType.toLowerCase().includes(S)}))}),Se(()=>(l(),e(h)),()=>{b(o,!l()||e(h).length>0||"attack".includes(l().toLowerCase())||"spell".includes(l().toLowerCase()))}),Ke(),Te();var F=us();let f;var $=n(F),A=i(n($),2),G=n(A,!0);r(A),r($);var w=i($,2);{var I=m=>{var S=ds(),R=je(S),O=i(R,2),B=n(O);Ve(B,1,()=>e(h),x=>x.id,(x,C,Q)=>{var J=os(),z=n(J),Y=n(z);W(Y);var D=i(Y,2);r(z);var V=i(z,2),ie=n(V),te=i(n(ie),2);W(te),r(ie);var de=i(ie,2),_e=i(n(de),2);W(_e),r(de);var he=i(de,2),me=i(n(he),2);W(me),r(he),r(V);var xe=i(V,2),Z=n(xe),p=i(Z,2);r(xe),r(J),K(Y,()=>e(C).name,T=>(e(C).name=T,nt(()=>(e(h),a(),l())))),M("click",D,()=>N(e(C).id)),K(te,()=>e(C).bonus,T=>(e(C).bonus=T,nt(()=>(e(h),a(),l())))),K(_e,()=>e(C).damage,T=>(e(C).damage=T,nt(()=>(e(h),a(),l())))),K(me,()=>e(C).damageType,T=>(e(C).damageType=T,nt(()=>(e(h),a(),l())))),M("click",Z,()=>y(e(C))),M("click",p,()=>E(e(C))),j(x,J)});var X=i(B,2);{var ne=x=>{var C=cs();j(x,C)},k=x=>{var C=st(),Q=je(C);{var J=z=>{var Y=vs();j(z,Y)};oe(Q,z=>{e(h),u(()=>e(h).length===0)&&z(J)},!0)}j(x,C)};oe(X,x=>{a(),u(()=>a().attacks.length===0)?x(ne):x(k,!1)})}r(O),M("click",R,g),j(m,S)};oe(w,m=>{c(),u(()=>!c().attacks)&&m(I)})}r(F),le(()=>{f=qe(F,1,"attacks svelte-14o91c5",null,f,{hidden:!e(o)}),Le(A,"aria-label",(c(),u(()=>c().attacks?"Expand":"Collapse"))),ee(G,(c(),u(()=>c().attacks?"â–¼":"â–²")))}),M("click",A,q),j(t,F),Pe(),v()}var ps=P('<p class="no-features svelte-1kpvv0n">Select a class to see available features</p>'),bs=P('<p class="no-features svelte-1kpvv0n">No class features available at this level</p>'),hs=P('<input type="checkbox" class="slot-checkbox svelte-1kpvv0n"/>'),ms=P('<div class="spell-slots svelte-1kpvv0n"><label class="svelte-1kpvv0n">1st Level Spell Slots</label> <div class="slots-tracker svelte-1kpvv0n"><!> <button class="btn-small svelte-1kpvv0n">Long Rest</button></div></div>'),gs=P('<div class="feature-box spellcasting svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"> </h3> <div class="spell-stats svelte-1kpvv0n"><div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Spell Save DC</label> <div class="spell-value svelte-1kpvv0n"> </div></div> <div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <div class="spell-value svelte-1kpvv0n"> </div></div></div> <!> <div class="prepared-spells svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <textarea placeholder="List your prepared spells..." class="svelte-1kpvv0n"></textarea></div></div>'),_s=P('<p class="unlimited svelte-1kpvv0n">Unlimited Uses</p>'),ys=P('<input type="checkbox" class="use-checkbox svelte-1kpvv0n"/>'),ks=P('<input type="checkbox" class="use-checkbox svelte-1kpvv0n"/>'),xs=P('<!> <button class="btn-small svelte-1kpvv0n"> </button>',1),$s=P('<div class="uses-tracker svelte-1kpvv0n"><!></div>'),Ss=P('<div class="pool-tracker svelte-1kpvv0n"><input type="number" min="0" class="pool-input svelte-1kpvv0n"/> <span> </span> <button class="btn-small svelte-1kpvv0n"> </button></div>'),Cs=P('<div class="feature-box svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"> </h3> <p class="feature-description svelte-1kpvv0n"> </p> <!></div>'),ws=P('<div class="features-grid svelte-1kpvv0n"><!> <!></div>'),Ds=P('<section><div class="header svelte-1kpvv0n"><h2 class="svelte-1kpvv0n">Class Features</h2> <button class="collapse-btn svelte-1kpvv0n"> </button></div> <!></section>');function Ls(t,s){He(s,!1);const a=()=>ce(H,"$character",v),l=()=>ce(ut,"$abilityModifiers",v),c=()=>ce(We,"$searchFilter",v),d=()=>ce(Ce,"$collapsedStates",v),[v,h]=Je(),o=U(),_=U(),g=U(),N=U(),y=U();let E=U(0),q=U(0);function F(k,x){H.update(C=>(C.classFeatures.features[k]||(C.classFeatures.features[k]=[]),C.classFeatures.features[k]=Array(x).fill(!1),C))}function f(k,x){H.update(C=>(C.classFeatures.features[k]=x,C))}function $(){H.update(k=>(k.classFeatures.spellSlots=Array(e(g)).fill(!1),k))}function A(k){if(typeof k.maxUses=="function"){if(k.name==="Divine Sense"&&e(o)?.spellcastingAbility){const x=l()[e(o).spellcastingAbility];return k.maxUses(a().level,x)}return k.maxUses(a().level)}return k.maxUses||0}function G(k){return typeof k.maxPool=="function"?k.maxPool(a().level):k.maxPool||0}function w(k){return typeof k.description=="function"?k.description(a().level):k.description}function I(){Ce.update(k=>({...k,classFeatures:!k.classFeatures}))}Se(()=>(a(),Ze),()=>{b(o,a().class?Ze(a().class):null)}),Se(()=>(a(),Ot),()=>{b(_,a().class?Ot(a().class,a().level):[])}),Se(()=>(a(),Ut),()=>{b(g,a().class?Ut(a().class,a().level):0)}),Se(()=>(e(o),l(),a(),Gt),()=>{if(e(o)?.spellcaster&&e(o).spellcastingAbility){const k=l()[e(o).spellcastingAbility];b(E,Ja(a().class,k,a().proficiencyBonus)||0),b(q,Gt(a().class,a().level,k))}}),Se(()=>(e(_),c()),()=>{b(N,e(_).filter(k=>{if(!c())return!0;const x=c().toLowerCase();return k.name.toLowerCase().includes(x)||w(k).toLowerCase().includes(x)}))}),Se(()=>(c(),a(),e(N)),()=>{b(y,!c()||a().class||"class features".includes(c().toLowerCase())||"spellcasting".includes(c().toLowerCase())||e(N).length>0)}),Ke(),Te();var m=Ds();let S;var R=n(m),O=i(n(R),2),B=n(O,!0);r(O),r(R);var X=i(R,2);{var ne=k=>{var x=st(),C=je(x);{var Q=z=>{var Y=ps();j(z,Y)},J=z=>{var Y=st(),D=je(Y);{var V=te=>{var de=bs();j(te,de)},ie=te=>{var de=ws(),_e=n(de);{var he=xe=>{var Z=gs(),p=n(Z),T=n(p);r(p);var be=i(p,2),ae=n(be),ue=i(n(ae),2),L=n(ue,!0);r(ue),r(ae);var fe=i(ae,2),re=i(n(fe),2),Ee=n(re,!0);r(re),r(fe),r(be);var Fe=i(be,2);{var Oe=ye=>{var we=ms(),Ae=i(n(we),2),se=n(Ae);Ve(se,1,()=>(e(g),u(()=>Array(e(g)))),Xe,(ke,ve,De)=>{var Ie=hs();W(Ie),jt(Ie,()=>a().classFeatures.spellSlots[De],Ye=>ge(H,u(a).classFeatures.spellSlots[De]=Ye,u(a))),j(ke,Ie)});var pe=i(se,2);r(Ae),r(we),M("click",pe,$),j(ye,we)};oe(Fe,ye=>{e(g)>0&&ye(Oe)})}var Me=i(Fe,2),$e=i(n(Me),2);ct($e),r(Me),r(Z),le(ye=>{ee(T,`Spellcasting (${ye??""})`),ee(L,e(E)),ee(Ee,e(q))},[()=>(e(o),u(()=>e(o).spellcastingAbility?.toUpperCase()))]),K($e,()=>a().classFeatures.preparedSpells,ye=>ge(H,u(a).classFeatures.preparedSpells=ye,u(a))),j(xe,Z)};oe(_e,xe=>{e(o),u(()=>e(o)?.spellcaster)&&xe(he)})}var me=i(_e,2);Ve(me,1,()=>e(N),Xe,(xe,Z)=>{const p=Be(()=>(e(Z),u(()=>e(Z).name.replace(/\s+/g,"")))),T=Be(()=>(a(),ze(e(p)),u(()=>a().classFeatures.features[e(p)]))),be=Be(()=>(ze(e(T)),u(()=>Array.isArray(e(T))))),ae=Be(()=>typeof e(T)=="number");var ue=Cs(),L=n(ue),fe=n(L,!0);r(L);var re=i(L,2),Ee=n(re,!0);r(re);var Fe=i(re,2);{var Oe=$e=>{const ye=Be(()=>(e(Z),u(()=>A(e(Z)))));var we=$s(),Ae=n(we);{var se=ke=>{var ve=_s();j(ke,ve)},pe=ke=>{var ve=xs(),De=je(ve);Ve(De,1,()=>(ze(e(ye)),u(()=>Array(e(ye)))),Xe,(ft,At,Qe)=>{var It=st(),aa=je(It);{var sa=et=>{var Ue=ys();W(Ue),le(()=>Tt(Ue,(ze(e(T)),u(()=>e(T)&&e(T)[Qe]||!1)))),M("change",Ue,pt=>{H.update(Ge=>{Ge.classFeatures.features[e(p)]||(Ge.classFeatures.features[e(p)]=[]);const bt=Ge.classFeatures.features[e(p)];return bt[Qe]=pt.currentTarget.checked,Ge})}),j(et,Ue)},la=et=>{var Ue=ks();W(Ue),Tt(Ue,!1),M("change",Ue,pt=>{H.update(Ge=>{Ge.classFeatures.features[e(p)]||(Ge.classFeatures.features[e(p)]=[]);const bt=Ge.classFeatures.features[e(p)];return bt[Qe]=pt.currentTarget.checked,Ge})}),j(et,Ue)};oe(aa,et=>{e(be)?et(sa):et(la,!1)})}j(ft,It)});var Ie=i(De,2),Ye=n(Ie,!0);r(Ie),le(()=>ee(Ye,(e(Z),u(()=>e(Z).resetOn==="short"?"Short Rest":"Long Rest")))),M("click",Ie,()=>F(e(p),e(ye))),j(ke,ve)};oe(Ae,ke=>{e(ye)===1/0?ke(se):ke(pe,!1)})}r(we),j($e,we)},Me=$e=>{var ye=st(),we=je(ye);{var Ae=se=>{const pe=Be(()=>(e(Z),u(()=>G(e(Z)))));var ke=Ss(),ve=n(ke);W(ve);var De=i(ve,2),Ie=n(De);r(De);var Ye=i(De,2),ft=n(Ye,!0);r(Ye),r(ke),le(()=>{Qt(ve,e(ae)&&e(T)!==void 0?e(T):e(pe)),Le(ve,"max",e(pe)),ee(Ie,`/ ${e(pe)??""}`),ee(ft,(e(Z),u(()=>e(Z).resetOn==="short"?"Short Rest":"Long Rest")))}),M("input",ve,At=>{H.update(Qe=>(Qe.classFeatures.features[e(p)]=parseInt(At.currentTarget.value)||0,Qe))}),M("click",Ye,()=>f(e(p),e(pe))),j(se,ke)};oe(we,se=>{e(Z),u(()=>e(Z).type==="pool")&&se(Ae)},!0)}j($e,ye)};oe(Fe,$e=>{e(Z),u(()=>e(Z).type==="uses")?$e(Oe):$e(Me,!1)})}r(ue),le($e=>{ee(fe,(e(Z),u(()=>e(Z).name))),ee(Ee,$e)},[()=>(e(Z),u(()=>w(e(Z))))]),j(xe,ue)}),r(de),j(te,de)};oe(D,te=>{e(_),u(()=>e(_).length===0)?te(V):te(ie,!1)},!0)}j(z,Y)};oe(C,z=>{a(),u(()=>!a().class)?z(Q):z(J,!1)})}j(k,x)};oe(X,k=>{d(),u(()=>!d().classFeatures)&&k(ne)})}r(m),le(()=>{S=qe(m,1,"class-features svelte-1kpvv0n",null,S,{hidden:!e(y)}),Le(O,"aria-label",(d(),u(()=>d().classFeatures?"Expand":"Collapse"))),ee(B,(d(),u(()=>d().classFeatures?"â–¼":"â–²")))}),M("click",O,I),j(t,m),Pe(),h()}var js=P('<textarea placeholder="Enter features, traits, and special abilities..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Equipment</h3> <textarea placeholder="List your equipment and inventory..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Notes</h3> <textarea placeholder="Additional notes..." class="svelte-wttn0l"></textarea>',1),Fs=P('<section><div class="header svelte-wttn0l"><h2 class="svelte-wttn0l">Features & Traits</h2> <button class="collapse-btn svelte-wttn0l"> </button></div> <!></section>');function As(t,s){He(s,!1);const a=()=>ce(We,"$searchFilter",d),l=()=>ce(H,"$character",d),c=()=>ce(Ce,"$collapsedStates",d),[d,v]=Je(),h=U();function o(){Ce.update(f=>({...f,notes:!f.notes}))}Se(()=>(a(),l()),()=>{b(h,!a()||"features".includes(a().toLowerCase())||"traits".includes(a().toLowerCase())||"equipment".includes(a().toLowerCase())||"notes".includes(a().toLowerCase())||l().features.toLowerCase().includes(a().toLowerCase())||l().equipment.toLowerCase().includes(a().toLowerCase())||l().notes.toLowerCase().includes(a().toLowerCase()))}),Ke(),Te();var _=Fs();let g;var N=n(_),y=i(n(N),2),E=n(y,!0);r(y),r(N);var q=i(N,2);{var F=f=>{var $=js(),A=je($);ct(A);var G=i(A,4);ct(G);var w=i(G,4);ct(w),K(A,()=>l().features,I=>ge(H,u(l).features=I,u(l))),K(G,()=>l().equipment,I=>ge(H,u(l).equipment=I,u(l))),K(w,()=>l().notes,I=>ge(H,u(l).notes=I,u(l))),j(f,$)};oe(q,f=>{c(),u(()=>!c().notes)&&f(F)})}r(_),le(()=>{g=qe(_,1,"notes svelte-wttn0l",null,g,{hidden:!e(h)}),Le(y,"aria-label",(c(),u(()=>c().notes?"Expand":"Collapse"))),ee(E,(c(),u(()=>c().notes?"â–¼":"â–²")))}),M("click",y,o),j(t,_),Pe(),v()}var Is=P('<div class="loading svelte-1r90jgp"><p class="svelte-1r90jgp">Loading 3D dice...</p></div>'),Es=P('<div class="custom-dice-selector svelte-1r90jgp"><h3 class="svelte-1r90jgp">Choose Dice to Roll</h3> <div class="dice-inputs svelte-1r90jgp"><div class="dice-input-group svelte-1r90jgp"><label for="d4" class="svelte-1r90jgp">d4</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d4" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d6" class="svelte-1r90jgp">d6</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d6" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d8" class="svelte-1r90jgp">d8</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d8" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d10" class="svelte-1r90jgp">d10</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d10" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d12" class="svelte-1r90jgp">d12</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d12" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d20" class="svelte-1r90jgp">d20</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d20" min="0" max="10"/></div></div> <div class="dice-controls svelte-1r90jgp"><button class="btn btn-primary use-enabled svelte-1r90jgp"> </button> <button class="btn btn-secondary use-enabled svelte-1r90jgp">Reset</button></div></div>'),Ms=P('<span class="crit-badge svelte-1r90jgp">CRITICAL!</span>'),Ns=P('<p class="svelte-1r90jgp"> </p>'),Rs=P('<p class="modifier-text svelte-1r90jgp"> </p>'),Ts=P('<button class="btn btn-follow-up svelte-1r90jgp"> </button>'),Hs=P('<div class="follow-up-actions svelte-1r90jgp"></div>'),Ps=P('<div class="result-header svelte-1r90jgp"><h3 class="svelte-1r90jgp"> </h3> <!></div> <div class="result-total svelte-1r90jgp"> </div> <div class="result-details svelte-1r90jgp"><!> <!></div> <!>',1),Os=P('<div role="button" tabindex="-1"><div class="modal-content svelte-1r90jgp" role="dialog" tabindex="0"><div class="modal-header svelte-1r90jgp"><h2 class="svelte-1r90jgp">Dice Roller</h2> <button class="close-btn svelte-1r90jgp">Ã—</button></div> <!> <div class="dice-main-area svelte-1r90jgp"><div class="dice-container svelte-1r90jgp"></div> <!></div> <div><!></div></div></div>');function Us(t,s){He(s,!1);const a=U(),l=at();let c=lt(s,"notation",12,""),d=lt(s,"visible",8,!1),v=lt(s,"damageNotation",12,""),h=lt(s,"attackName",12,""),o=null,_=U(void 0),g=U(!1),N=U(""),y=U(null);function E(){return e(y)?.resultTotal??null}let q=U(0),F=U(0),f=U(0),$=U(0),A=U(0),G=U(0),w=U(0),I=U([]),m=U(!1);function S(){if(window.DICE&&e(_))try{o&&e(_)&&La(_,e(_).innerHTML="");const p=e(_).clientWidth||500,T=e(_).clientHeight||300;o=new window.DICE.dice_box(e(_),{w:p,h:T}),b(g,!0),console.log(`Dice box initialized with dimensions: ${p}x${T}`)}catch(p){console.error("Error initializing dice box:",p)}}qt(()=>{const p=ae=>new Promise((ue,L)=>{if(document.querySelector(`script[src="${ae}"]`)){console.log(`Script already loaded: ${ae}`),ue(null);return}const re=document.createElement("script");re.src=ae,re.onload=()=>{console.log(`Loaded: ${ae}`),ue(null)},re.onerror=()=>{console.error(`Failed to load: ${ae}`),L(new Error(`Failed to load ${ae}`))},document.head.appendChild(re)});setTimeout(()=>{p(`${ot}/libs/three.min.js`).then(()=>p(`${ot}/libs/cannon.min.js`)).then(()=>p(`${ot}/libs/teal.js`)).then(()=>p(`${ot}/dice.js`)).then(()=>{console.log("All scripts loaded, initializing dice box..."),console.log("DICE available:",!!window.DICE),console.log("Container available:",!!e(_)),S()}).catch(ae=>{console.error("Failed to load dice libraries:",ae)})},100);const T=()=>{e(g)&&(console.log("Window resized, reinitializing dice box..."),S())},be=ae=>{d()&&ae.key==="Escape"&&k()};return window.addEventListener("resize",T),window.addEventListener("keydown",be),()=>{window.removeEventListener("resize",T),window.removeEventListener("keydown",be)}});function R(p,T="other"){if(!o||!e(g))return;console.log("Rolling dice:",p,"type:",T),o.diceToRoll=p;const be=ue=>(console.log("Before roll:",ue),null),ae=ue=>{if(console.log("After roll:",ue),console.log("Result:",ue.resultTotal),b(y,ue),T==="attack"||T==="check"||T==="save"){const L=ue.results?.filter(fe=>fe.sides===20)||[];if(L.length>0){const fe=L[0].value;b(m,fe===20)}}if(b(I,[]),T==="attack"&&v())if(e(m)){const L=X(v());e(I).push({label:`Roll Critical Damage (${L})`,notation:L})}else e(I).push({label:`Roll Damage (${v()})`,notation:v()})};o.start_throw(be,ae)}function O(){const p=[];e(q)>0&&p.push(`${e(q)}d4`),e(F)>0&&p.push(`${e(F)}d6`),e(f)>0&&p.push(`${e(f)}d8`),e($)>0&&p.push(`${e($)}d10`),e(A)>0&&p.push(`${e(A)}d12`),e(G)>0&&p.push(`${e(G)}d20`);let T=p.join("+")||"1d20";return e(w)!==0&&(T+=e(w)>=0?`+${e(w)}`:`${e(w)}`),T}function B(){const p=O();R(p)}function X(p){return p.replace(/(\d+)d(\d+)/g,(T,be,ae)=>`${parseInt(be)*2}d${ae}`)}function ne(){b(q,0),b(F,0),b(f,0),b($,0),b(A,0),b(G,0),b(w,0),b(y,null),b(I,[]),b(m,!1)}function k(){l("close"),c(""),v(""),h(""),b(N,""),b(y,null),ne()}Se(()=>(e(q),e(F),e(f),e($),e(A),e(G),e(w)),()=>{b(a,(()=>{const p=[];e(q)>0&&p.push(`${e(q)}d4`),e(F)>0&&p.push(`${e(F)}d6`),e(f)>0&&p.push(`${e(f)}d8`),e($)>0&&p.push(`${e($)}d10`),e(A)>0&&p.push(`${e(A)}d12`),e(G)>0&&p.push(`${e(G)}d20`);let T=p.join("+")||"1d20";return e(w)!==0&&(T+=e(w)>=0?`+${e(w)}`:`${e(w)}`),T})())}),Se(()=>(ze(c()),e(g),ze(d())),()=>{if(c()&&e(g)&&d()){b(N,c()),b(y,null),b(I,[]),b(m,!1);const p=c().includes("1d20")?"attack":"other";setTimeout(()=>R(c(),p),200)}}),Ke();var x={getLastRollTotal:E};Te();var C=Os();let Q;var J=n(C),z=n(J),Y=i(n(z),2);r(z);var D=i(z,2);{var V=p=>{var T=Is();j(p,T)};oe(D,p=>{e(g)||p(V)})}var ie=i(D,2),te=n(ie);Ct(te,p=>b(_,p),()=>e(_));var de=i(te,2);{var _e=p=>{var T=Es(),be=i(n(T),2),ae=n(be),ue=i(n(ae),2);W(ue),r(ae);var L=i(ae,2),fe=i(n(L),2);W(fe),r(L);var re=i(L,2),Ee=i(n(re),2);W(Ee),r(re);var Fe=i(re,2),Oe=i(n(Fe),2);W(Oe),r(Fe);var Me=i(Fe,2),$e=i(n(Me),2);W($e),r(Me);var ye=i(Me,2),we=i(n(ye),2);W(we),r(ye),r(be);var Ae=i(be,2),se=n(Ae),pe=n(se);r(se);var ke=i(se,2);r(Ae),r(T),le(()=>{se.disabled=!e(g),ee(pe,`Roll ${e(a)??""}`)}),K(ue,()=>e(q),ve=>b(q,ve)),K(fe,()=>e(F),ve=>b(F,ve)),K(Ee,()=>e(f),ve=>b(f,ve)),K(Oe,()=>e($),ve=>b($,ve)),K($e,()=>e(A),ve=>b(A,ve)),K(we,()=>e(G),ve=>b(G,ve)),M("click",se,B),M("click",ke,ne),j(p,T)};oe(de,p=>{c()||p(_e)})}r(ie);var he=i(ie,2);let me;var xe=n(he);{var Z=p=>{var T=Ps(),be=je(T),ae=n(be),ue=n(ae,!0);r(ae);var L=i(ae,2);{var fe=se=>{var pe=Ms();j(se,pe)};oe(L,se=>{e(m)&&se(fe)})}r(be);var re=i(be,2),Ee=n(re,!0);r(re);var Fe=i(re,2),Oe=n(Fe);{var Me=se=>{var pe=Ns(),ke=n(pe,!0);r(pe),le(()=>ee(ke,(e(y),u(()=>e(y).resultString)))),j(se,pe)};oe(Oe,se=>{e(y),u(()=>e(y).resultString)&&se(Me)})}var $e=i(Oe,2);{var ye=se=>{var pe=Rs(),ke=n(pe);r(pe),le(()=>ee(ke,`Modifier: ${e(y),u(()=>e(y).constant>=0?"+":"")??""}${e(y),u(()=>e(y).constant)??""}`)),j(se,pe)};oe($e,se=>{e(y),u(()=>e(y).constant)&&se(ye)})}r(Fe);var we=i(Fe,2);{var Ae=se=>{var pe=Hs();Ve(pe,5,()=>e(I),Xe,(ke,ve)=>{var De=Ts(),Ie=n(De,!0);r(De),le(()=>ee(Ie,(e(ve),u(()=>e(ve).label)))),M("click",De,()=>R(e(ve).notation,"damage")),j(ke,De)}),r(pe),j(se,pe)};oe(we,se=>{e(I),u(()=>e(I).length>0)&&se(Ae)})}le(()=>{ee(ue,h()?`${h()} - Result`:"Result"),ee(Ee,(e(y),u(()=>e(y).resultTotal)))}),j(p,T)};oe(xe,p=>{e(y)&&p(Z)})}return r(he),r(J),r(C),le(()=>{Q=qe(C,1,"modal-overlay svelte-1r90jgp",null,Q,{hidden:!d()}),me=qe(he,1,"roll-result svelte-1r90jgp",null,me,{"has-result":e(y)})}),M("click",Y,k),M("click",J,ta(function(p){vt.call(this,s,p)})),M("keydown",J,function(p){vt.call(this,s,p)}),M("click",C,k),M("keydown",C,p=>p.key==="Escape"&&k()),j(t,C),Ha(s,"getLastRollTotal",E),Pe(x)}const Ft="https://api.github.com/gists";async function Gs(t,s,a){if(!s)throw new Error("GitHub token is required");const l=JSON.stringify(t,null,2),c=`${t.name||"character"}_dnd.json`,d={description:a||`D&D Character: ${t.name}`,public:!1,files:{[c]:{content:l}}},v=await fetch(Ft,{method:"POST",headers:{Authorization:`token ${s}`,"Content-Type":"application/json"},body:JSON.stringify(d)});if(!v.ok)throw new Error(`Failed to create gist: ${v.statusText}`);return(await v.json()).id}async function Bs(t,s,a){if(!s||!a)throw new Error("GitHub token and Gist ID are required");const l=JSON.stringify(t,null,2),d={files:{[`${t.name||"character"}_dnd.json`]:{content:l}}},v=await fetch(`${Ft}/${a}`,{method:"PATCH",headers:{Authorization:`token ${s}`,"Content-Type":"application/json"},body:JSON.stringify(d)});if(!v.ok)throw new Error(`Failed to update gist: ${v.statusText}`)}async function qs(t,s){if(!t)throw new Error("Gist ID is required");const a={"Content-Type":"application/json"};s&&(a.Authorization=`token ${s}`);const l=await fetch(`${Ft}/${t}`,{method:"GET",headers:a});if(!l.ok)throw new Error(`Failed to load gist: ${l.statusText}`);const c=await l.json(),d=Object.values(c.files);if(d.length===0)throw new Error("No files found in gist");const h=d[0].content;try{const o=JSON.parse(h);return o.attacks&&Array.isArray(o.attacks)&&(o.attacks=o.attacks.map(_=>({..._,id:_.id||crypto.randomUUID()}))),o.classFeatures?(o.classFeatures.features||(o.classFeatures.features={}),o.classFeatures.spellSlots||(o.classFeatures.spellSlots=[]),o.classFeatures.preparedSpells===void 0&&(o.classFeatures.preparedSpells="")):o.classFeatures={features:{},spellSlots:[],preparedSpells:""},o}catch{throw new Error("Invalid character data in gist")}}function Bt(t){typeof window<"u"&&localStorage.setItem("dnd_gist_config",JSON.stringify(t))}function Js(){if(typeof window<"u"){const t=localStorage.getItem("dnd_gist_config");if(t)return JSON.parse(t)}return{}}var zs=P('<div class="error-message svelte-1jb5ckg"> </div>'),Vs=P('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID (leave empty to create new)</label> <input type="text" id="gistId" placeholder="Optional: existing Gist ID to update" class="svelte-1jb5ckg"/></div> <div class="form-group svelte-1jb5ckg"><label for="description" class="svelte-1jb5ckg">Description</label> <input type="text" id="description" placeholder="D&amp;D Character Sheet" class="svelte-1jb5ckg"/></div>',1),Ws=P('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID *</label> <input type="text" id="gistId" placeholder="Enter Gist ID" required class="svelte-1jb5ckg"/></div>'),Ys=P('<div class="modal-overlay svelte-1jb5ckg" role="button" tabindex="-1"><div class="modal-content svelte-1jb5ckg" role="dialog" tabindex="0"><div class="modal-header svelte-1jb5ckg"><h2 class="svelte-1jb5ckg"> </h2> <button class="close-btn svelte-1jb5ckg">Ã—</button></div> <div class="modal-body svelte-1jb5ckg"><!> <div class="form-group svelte-1jb5ckg"><label for="token" class="svelte-1jb5ckg">GitHub Token (optional for public gists) <a href="https://github.com/settings/tokens" target="_blank" rel="noopener" class="svelte-1jb5ckg">Get token</a></label> <input type="password" id="token" placeholder="ghp_xxxxxxxxxxxxx" class="svelte-1jb5ckg"/></div> <!> <div class="modal-actions svelte-1jb5ckg"><button class="btn btn-primary svelte-1jb5ckg"><!></button> <button class="btn btn-secondary svelte-1jb5ckg">Cancel</button></div></div></div></div>');function Xs(t,s){He(s,!1);const a=()=>ce(H,"$character",l),[l,c]=Je(),d=at();let v=lt(s,"mode",8,"save"),h=U(""),o=U(""),_=U(""),g=U(!1),N=U("");const y=Js();y.token&&b(h,y.token),y.gistId&&b(o,y.gistId);async function E(){if(!e(h)){b(N,"GitHub token is required");return}b(g,!0),b(N,"");try{if(e(o))await Bs(a(),e(h),e(o)),alert("Character updated in Gist successfully!");else{const D=await Gs(a(),e(h),e(_));b(o,D),alert(`Character saved to Gist! ID: ${D}`)}Bt({token:e(h),gistId:e(o)}),d("close")}catch(D){b(N,D.message||"Failed to save to Gist")}finally{b(g,!1)}}async function q(){if(!e(o)){b(N,"Gist ID is required");return}b(g,!0),b(N,"");try{const D=await qs(e(o),e(h)||void 0);H.set(D),Bt({token:e(h),gistId:e(o)}),alert("Character loaded from Gist successfully!"),d("close")}catch(D){b(N,D.message||"Failed to load from Gist")}finally{b(g,!1)}}function F(){d("close")}Te();var f=Ys(),$=n(f),A=n($),G=n(A),w=n(G,!0);r(G);var I=i(G,2);r(A);var m=i(A,2),S=n(m);{var R=D=>{var V=zs(),ie=n(V,!0);r(V),le(()=>ee(ie,e(N))),j(D,V)};oe(S,D=>{e(N)&&D(R)})}var O=i(S,2),B=i(n(O),2);W(B),r(O);var X=i(O,2);{var ne=D=>{var V=Vs(),ie=je(V),te=i(n(ie),2);W(te),r(ie);var de=i(ie,2),_e=i(n(de),2);W(_e),r(de),le(()=>{te.disabled=e(g),_e.disabled=e(g)}),K(te,()=>e(o),he=>b(o,he)),K(_e,()=>e(_),he=>b(_,he)),j(D,V)},k=D=>{var V=Ws(),ie=i(n(V),2);W(ie),r(V),le(()=>ie.disabled=e(g)),K(ie,()=>e(o),te=>b(o,te)),j(D,V)};oe(X,D=>{v()==="save"?D(ne):D(k,!1)})}var x=i(X,2),C=n(x),Q=n(C);{var J=D=>{var V=Et();le(()=>ee(V,v()==="save"?"Saving...":"Loading...")),j(D,V)},z=D=>{var V=Et();le(()=>ee(V,v()==="save"?"Save":"Load")),j(D,V)};oe(Q,D=>{e(g)?D(J):D(z,!1)})}r(C);var Y=i(C,2);r(x),r(m),r($),r(f),le(()=>{ee(w,v()==="save"?"Save to GitHub Gist":"Load from GitHub Gist"),B.disabled=e(g),C.disabled=e(g),Y.disabled=e(g)}),M("click",I,F),K(B,()=>e(h),D=>b(h,D)),M("click",C,function(...D){(v()==="save"?E:q)?.apply(this,D)}),M("click",Y,F),M("click",$,ta(function(D){vt.call(this,s,D)})),M("keydown",$,function(D){vt.call(this,s,D)}),M("click",f,F),M("keydown",f,D=>D.key==="Escape"&&F()),j(t,f),Pe(),c()}var Zs=P('<link rel="icon" type="image/png" href="/favicon.png"/>'),Ks=P('<div class="container svelte-1uha8ag"><header class="svelte-1uha8ag"><div class="header-top svelte-1uha8ag"><h1 class="svelte-1uha8ag">D&D Character Sheet</h1> <div class="header-controls svelte-1uha8ag"><button class="btn btn-secondary use-enabled">ðŸŽ² Roll Dice</button> <input type="text" placeholder="ðŸ” Search (e.g., Religion, Strength, Attack...)" class="search-input svelte-1uha8ag"/> <div class="mode-toggle"><button> </button></div></div></div> <div class="header-actions svelte-1uha8ag"><button class="btn btn-secondary">Save to Gist</button> <button class="btn btn-secondary">Load from Gist</button> <button class="btn btn-secondary">Export JSON</button> <button class="btn btn-secondary">Import JSON</button> <input type="file" accept=".json" style="display: none;"/></div></header> <main class="svelte-1uha8ag"><!> <!> <!> <!> <!> <!> <!></main></div> <!> <!>',1);function nl(t,s){He(s,!1);const a=()=>ce(it,"$isEditMode",d),l=()=>ce(H,"$character",d),c=()=>ce(We,"$searchFilter",d),[d,v]=Je();let h=U(!1),o=U(!1),_=U("save"),g=U(void 0),N=U(""),y=U(""),E=U(""),q=U(),F=!1;function f(L){b(N,""),F=!1,setTimeout(typeof L=="string"?()=>{b(N,L),b(y,""),b(E,"")}:()=>{b(N,L.notation),b(y,L.damageNotation||""),b(E,L.attackName||"")},0),b(h,!0)}function $(L){const{notation:fe}=L.detail;b(N,""),F=!0,setTimeout(()=>{b(N,fe),b(y,""),b(E,"Hit Die")},0),b(h,!0)}function A(){if(b(h,!1),F&&e(q)){const L=e(q).getLastRollTotal();if(L!==null){const fe=Math.max(1,L);H.update(re=>(re.hitDice.current=Math.max(0,re.hitDice.current-1),re.currentHP=Math.min(re.maxHP,re.currentHP+fe),re))}F=!1}}function G(){console.log("toggleMode called, current isEditMode:",a()),it.update(L=>(console.log("Updating isEditMode from",L,"to",!L),!L))}qt(()=>(console.log("onMount - initial isEditMode:",a()),console.log("onMount - body classes:",document.body.className),it.subscribe(fe=>{console.log("isEditMode subscription triggered, value:",fe),console.log("Body classes before:",document.body.className),fe?(document.body.classList.remove("use-mode"),console.log("Removed use-mode class (Edit Mode)")):(document.body.classList.add("use-mode"),console.log("Added use-mode class (Use Mode)")),console.log("Body classes after:",document.body.className)})));function w(){Ga(l())}function I(){e(g)?.click()}async function m(L){const re=L.target.files?.[0];if(re)try{const Ee=await Ba(re);H.set(Ee),alert("Character imported successfully!")}catch{alert("Failed to import character file")}}Te();var S=Ks();Ia("1uha8ag",L=>{var fe=Zs();ja(()=>{Fa.title="D&D Character Sheet"}),j(L,fe)});var R=je(S),O=n(R),B=n(O),X=i(n(B),2),ne=n(X),k=i(ne,2);W(k);var x=i(k,2),C=n(x);let Q;var J=n(C,!0);r(C),r(x),r(X),r(B);var z=i(B,2),Y=n(z),D=i(Y,2),V=i(D,2),ie=i(V,2),te=i(ie,2);Ct(te,L=>b(g,L),()=>e(g)),r(z),r(O);var de=i(O,2),_e=n(de);Xa(_e,{});var he=i(_e,2);ss(he,{$$events:{rollHitDice:$}});var me=i(he,2);es(me,{$$events:{roll:L=>f(L.detail)}});var xe=i(me,2);ns(xe,{$$events:{roll:L=>f(L.detail)}});var Z=i(xe,2);fs(Z,{$$events:{roll:L=>f(L.detail)}});var p=i(Z,2);Ls(p,{});var T=i(p,2);As(T,{}),r(de),r(R);var be=i(R,2);Ct(Us(be,{get notation(){return e(N)},get damageNotation(){return e(y)},get attackName(){return e(E)},get visible(){return e(h)},$$events:{close:A},$$legacy:!0}),L=>b(q,L),()=>e(q));var ae=i(be,2);{var ue=L=>{Xs(L,{get mode(){return e(_)},$$events:{close:()=>b(o,!1)}})};oe(ae,L=>{e(o)&&L(ue)})}le(()=>{Q=qe(C,1,"btn btn-mode svelte-1uha8ag",null,Q,{"use-mode":!a()}),ee(J,a()?"ðŸ“ Edit Mode":"ðŸŽ² Use Mode")}),M("click",ne,()=>b(h,!0)),K(k,c,L=>Aa(We,L)),M("click",C,G),M("click",Y,()=>{b(_,"save"),b(o,!0)}),M("click",D,()=>{b(_,"load"),b(o,!0)}),M("click",V,w),M("click",ie,I),M("change",te,m),j(t,S),Pe(),v()}export{nl as component};
