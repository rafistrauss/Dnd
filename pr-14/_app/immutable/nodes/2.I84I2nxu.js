import{f,e as j,a as v,s as x,c as nt,t as bt}from"../chunks/B7Yu7-pH.js";import{i as yt}from"../chunks/Pgj_Karr.js";import{c as Gt,o as Qt,a as Wa}from"../chunks/YW1J0937.js";import{a7 as Ma,i as Pa,aZ as Ka,a_ as Ja,a$ as Sa,K as At,e as Ea,b0 as Ta,T as na,b1 as Va,b2 as Qa,q as Ya,b3 as Xa,b4 as Za,b5 as es,ab as ts,d as i,r as Ha,g as as,C as kt,b6 as et,b7 as jt,F as I,G as xt,s as o,a4 as R,H as r,J as a,I as l,f as e,E as Oe,m as rt,A as U,b8 as Ct,b9 as Kt,ba as Ua,ao as Ba,bb as ss}from"../chunks/TSJapsqm.js";import{c as Y,a as gt,e as ct,i as dt,u as Na,s as Rt,b as ut,d as Yt,f as la,t as Jt,h as ls,T as rs,g as is,j as ns}from"../chunks/ptv-4LDw.js";import{i as C,s as Lt,a as Ke,b as tt,d as os}from"../chunks/CsWWXapv.js";import{p as Et,b as _a}from"../chunks/CMWnilAD.js";import{b as Wt,r as cs}from"../chunks/CRoQ9TGC.js";function ra(s,n,t=!1){if(s.multiple){if(n==null)return;if(!Pa(n))return Ka();for(var c of s.options)c.selected=n.includes(Vt(c));return}for(c of s.options){var h=Vt(c);if(Ja(h,n)){c.selected=!0;return}}(!t||n!==void 0)&&(s.selectedIndex=-1)}function ya(s){var n=new MutationObserver(()=>{ra(s,s.__value)});n.observe(s,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Ma(()=>{n.disconnect()})}function Ga(s,n,t=n){var c=new WeakSet,h=!0;Sa(s,"change",S=>{var L=S?"[selected]":":checked",N;if(s.multiple)N=[].map.call(s.querySelectorAll(L),Vt);else{var _=s.querySelector(L)??s.querySelector("option:not([disabled])");N=_&&Vt(_)}t(N),At!==null&&c.add(At)}),Ea(()=>{var S=n();if(s===document.activeElement){var L=Ta??At;if(c.has(L))return}if(ra(s,S,h),h&&S===void 0){var N=s.querySelector(":checked");N!==null&&(S=Vt(N),t(S))}s.__value=S,h=!1}),ya(s)}function Vt(s){return"__value"in s?s.__value:s.value}const vs=Symbol("is custom element"),ds=Symbol("is html");function xe(s){if(na){var n=!1,t=()=>{if(!n){if(n=!0,s.hasAttribute("value")){var c=s.value;at(s,"value",null),s.value=c}if(s.hasAttribute("checked")){var h=s.checked;at(s,"checked",null),s.checked=h}}};s.__on_r=t,Ya(t),Xa()}}function $a(s,n){var t=Ca(s);t.value===(t.value=n??void 0)||s.value===n&&(n!==0||s.nodeName!=="PROGRESS")||(s.value=n??"")}function Da(s,n){var t=Ca(s);t.checked!==(t.checked=n??void 0)&&(s.checked=n)}function at(s,n,t,c){var h=Ca(s);na&&(h[n]=s.getAttribute(n),n==="src"||n==="srcset"||n==="href"&&s.nodeName==="LINK")||h[n]!==(h[n]=t)&&(n==="loading"&&(s[Za]=t),t==null?s.removeAttribute(n):typeof t!="string"&&us(s).includes(n)?s[n]=t:s.setAttribute(n,t))}function Ca(s){return s.__attributes??={[vs]:s.nodeName.includes("-"),[ds]:s.namespaceURI===Va}}var wa=new Map;function us(s){var n=s.getAttribute("is")||s.nodeName,t=wa.get(n);if(t)return t;wa.set(n,t=[]);for(var c,h=s,S=Element.prototype;S!==h;){c=es(h);for(var L in c)c[L].set&&t.push(L);h=Qa(h)}return t}function Ae(s,n,t=n){var c=new WeakSet;Sa(s,"input",async h=>{var S=h?s.defaultValue:s.value;if(S=ga(s)?ha(S):S,t(S),At!==null&&c.add(At),await ts(),S!==(S=n())){var L=s.selectionStart,N=s.selectionEnd,_=s.value.length;if(s.value=S??"",N!==null){var M=s.value.length;L===N&&N===_&&M>_?(s.selectionStart=M,s.selectionEnd=M):(s.selectionStart=L,s.selectionEnd=Math.min(N,M))}}}),(na&&s.defaultValue!==s.value||i(n)==null&&s.value)&&(t(ga(s)?ha(s.value):s.value),At!==null&&c.add(At)),Ha(()=>{var h=n();if(s===document.activeElement){var S=Ta??At;if(c.has(S))return}ga(s)&&h===ha(s.value)||s.type==="date"&&!h&&!s.value||h!==s.value&&(s.value=h??"")})}function ia(s,n,t=n){Sa(s,"change",c=>{var h=c?s.defaultChecked:s.checked;t(h)}),(na&&s.defaultChecked!==s.checked||i(n)==null)&&t(s.checked),Ha(()=>{var c=n();s.checked=!!c})}function ga(s){var n=s.type;return n==="number"||n==="range"}function ha(s){return s===""?null:+s}function ps(s,n,t){var c=as(s,n);c&&c.set&&(s[n]=t,Ma(()=>{s[n]=null}))}function La(s){return function(...n){var t=n[0];return t.stopPropagation(),s?.apply(this,n)}}function Bt(s,n){var t=s.$$events?.[n.type],c=Pa(t)?t.slice():t==null?[]:[t];for(var h of c)h.call(this,n)}const fs="";function Oa(...s){return Wt+fs+cs(s[0],s[1])}const ka={paladin:{name:"Paladin",hitDice:"d10",spellcaster:!0,spellcastingAbility:"charisma",spellSlotsByLevel:{1:0,2:2,3:3,4:3,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Divine Sense",type:"uses",maxUses:(s,n=1)=>1+Math.max(1,n),resetOn:"long",description:"Detect celestials, fiends, and undead within 60 feet",minLevel:1},{name:"Lay on Hands",type:"pool",maxPool:s=>s*5,resetOn:"long",description:"Heal wounds or cure disease",minLevel:1},{name:"Divine Smite",type:"spellSlot",description:"Expend spell slot to deal extra radiant damage",minLevel:2,rollable:!0},{name:"Channel Divinity",type:"pool",maxPool:s=>s>=18?3:s>=6?2:1,resetOn:"short",description:"Sacred Weapon or Turn Undead",minLevel:3}]},fighter:{name:"Fighter",hitDice:"d10",spellcaster:!1,features:[{name:"Second Wind",type:"uses",maxUses:1,resetOn:"short",description:"Regain 1d10 + fighter level HP as bonus action",minLevel:1,rollable:!0,rollFormula:s=>`1d10+${s}`},{name:"Action Surge",type:"uses",maxUses:s=>s>=17?2:1,resetOn:"short",description:"Take one additional action on your turn",minLevel:2},{name:"Indomitable",type:"uses",maxUses:s=>s>=17?3:s>=13?2:1,resetOn:"long",description:"Reroll a failed saving throw",minLevel:9}],subclasses:{champion:{name:"Champion",features:[{name:"Improved Critical",type:"info",description:"Critical hit on 19-20",minLevel:3},{name:"Remarkable Athlete",type:"info",description:"Add half proficiency to STR/DEX/CON checks, increase long jump distance",minLevel:7},{name:"Additional Fighting Style",type:"info",description:"Choose a second fighting style",minLevel:10},{name:"Superior Critical",type:"info",description:"Critical hit on 18-20",minLevel:15},{name:"Survivor",type:"info",description:"Regain 5 + CON mod HP at start of turn if below half HP",minLevel:18}]},battlemaster:{name:"Battle Master",features:[{name:"Combat Superiority",type:"uses",maxUses:s=>s>=15?6:s>=7?5:4,resetOn:"short",description:s=>`Use superiority dice (${s>=18?"d12":s>=10?"d10":"d8"}) for maneuvers`,minLevel:3},{name:"Know Your Enemy",type:"info",description:"Learn capabilities of creatures you observe",minLevel:7},{name:"Improved Combat Superiority",type:"info",description:"Superiority dice become d10",minLevel:10},{name:"Relentless",type:"info",description:"Regain 1 superiority die if you have none at start of turn",minLevel:15}]}}},rogue:{name:"Rogue",hitDice:"d8",spellcaster:!1,features:[{name:"Sneak Attack",type:"info",description:s=>`Deal ${Math.ceil(s/2)}d6 extra damage once per turn with advantage or ally nearby`,minLevel:1,rollable:!0,rollFormula:s=>`${Math.ceil(s/2)}d6`},{name:"Cunning Action",type:"info",description:"Dash, Disengage, or Hide as a bonus action",minLevel:2},{name:"Uncanny Dodge",type:"info",description:"Use reaction to halve damage from an attack",minLevel:5},{name:"Evasion",type:"info",description:"Take no damage on successful Dex save (half on fail)",minLevel:7}]},wizard:{name:"Wizard",hitDice:"d6",spellcaster:!0,spellcastingAbility:"intelligence",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Arcane Recovery",type:"uses",maxUses:1,resetOn:"long",description:s=>`Recover spell slots totaling up to ${Math.ceil(s/2)} levels during short rest`,minLevel:1},{name:"Spell Mastery",type:"info",description:"Cast one 1st-level and one 2nd-level spell at will",minLevel:18}]},cleric:{name:"Cleric",hitDice:"d8",spellcaster:!0,spellcastingAbility:"wisdom",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Channel Divinity",type:"pool",maxPool:s=>s>=18?3:s>=6?2:1,resetOn:"short",description:"Turn Undead or domain-specific ability",minLevel:2},{name:"Destroy Undead",type:"info",description:s=>`Channel Divinity destroys undead of CR ${s>=17?4:s>=14?3:s>=11?2:s>=8?1:.5} or lower`,minLevel:5},{name:"Divine Intervention",type:"uses",maxUses:1,resetOn:"long",description:s=>`${s}% chance to succeed, implore deity for aid`,minLevel:10}],subclasses:{war:{name:"War Domain",features:[{name:"War Priest",type:"uses",maxUses:(s,n=1)=>Math.max(1,n),resetOn:"long",description:"Make one weapon attack as a bonus action",minLevel:1},{name:"Guided Strike",type:"channelDivinity",description:"Use your Channel Divinity to gain +10 to an attack roll. Make this choice after you see the roll, but before the DM says whether the attack hits or misses.",minLevel:2,resetOn:"short"},{name:"War God's Blessing",type:"channelDivinity",description:"Use reaction to grant +10 to an ally's attack roll within 30 feet. Consumes one use of Channel Divinity.",minLevel:6,resetOn:"short"},{name:"Divine Strike",type:"info",description:s=>`Deal extra ${s>=14?"2d8":"1d8"} weapon damage once per turn`,minLevel:8,rollable:!0,rollFormula:s=>s>=14?"2d8":"1d8"},{name:"Avatar of Battle",type:"info",description:"Gain resistance to nonmagical weapon damage",minLevel:17}]},life:{name:"Life Domain",features:[{name:"Disciple of Life",type:"info",description:"Healing spells restore additional 2 + spell level HP",minLevel:1},{name:"Preserve Life",type:"pool",maxPool:s=>s*5,resetOn:"short",description:"Restore HP to creatures within 30 feet",minLevel:2},{name:"Blessed Healer",type:"info",description:"Regain 2 + spell level HP when you cast healing spell",minLevel:6},{name:"Divine Strike",type:"info",description:s=>`Deal extra ${s>=14?"2d8":"1d8"} radiant damage once per turn`,minLevel:8,rollable:!0,rollFormula:s=>s>=14?"2d8":"1d8"},{name:"Supreme Healing",type:"info",description:"Maximize healing dice instead of rolling",minLevel:17}]}}},barbarian:{name:"Barbarian",hitDice:"d12",spellcaster:!1,features:[{name:"Rage",type:"uses",maxUses:s=>s>=20?1/0:s>=17?6:s>=12?5:s>=6?4:s>=3?3:2,resetOn:"long",description:s=>`+${s>=16?4:s>=9?3:2} damage, resistance to physical damage`,minLevel:1},{name:"Reckless Attack",type:"info",description:"Gain advantage on melee attacks, enemies get advantage on you",minLevel:2},{name:"Danger Sense",type:"info",description:"Advantage on Dex saves against effects you can see",minLevel:2}],subclasses:{berserker:{name:"Path of the Berserker",features:[{name:"Frenzy",type:"info",description:"While raging, make melee attack as bonus action (gain 1 exhaustion after rage)",minLevel:3},{name:"Mindless Rage",type:"info",description:"Cannot be charmed or frightened while raging",minLevel:6},{name:"Intimidating Presence",type:"info",description:"Use action to frighten creature within 30 feet",minLevel:10},{name:"Retaliation",type:"info",description:"When damaged by creature within 5 feet, make melee attack as reaction",minLevel:14}]}}}};function _t(s){const n=s.toLowerCase();return ka[n]||null}function Nt(s,n,t){const c=_t(s);if(!c)return[];const h=c.features.filter(S=>!S.minLevel||S.minLevel<=n);if(t&&c.subclasses&&c.subclasses[t]){const S=c.subclasses[t].features.filter(L=>!L.minLevel||L.minLevel<=n);return[...h,...S]}return h}function ja(s){const n=_t(s);return!n||!n.subclasses?[]:Object.keys(n.subclasses).map(t=>({id:t,name:n.subclasses[t].name}))}function Fa(s,n){const t=_t(s);return!t||!t.spellcaster||!t.spellSlotsByLevel?0:t.spellSlotsByLevel[n]||0}function Aa(s,n,t){const c=_t(s);return!c||!c.spellcaster?0:Math.max(1,t+n)}function bs(s,n,t){const c=_t(s);return!c||!c.spellcaster?null:8+n+t}function gs(){return Object.keys(ka).map(s=>({id:s,name:ka[s].name}))}var hs=f("<option> </option>"),ms=f("<option> </option>"),_s=f('<div class="form-group svelte-172i2fj"><label for="characterSubclass" class="svelte-172i2fj">Subclass</label> <select id="characterSubclass" class="svelte-172i2fj"><option>Select Subclass</option><!></select></div>'),ys=f('<div class="info-grid svelte-172i2fj"><div class="form-group svelte-172i2fj"><label for="characterName" class="svelte-172i2fj">Character Name</label> <input type="text" id="characterName" placeholder="Enter name" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterClass" class="svelte-172i2fj">Class</label> <select id="characterClass" class="svelte-172i2fj"><option>Select Class</option><!></select></div> <!> <div class="form-group svelte-172i2fj"><label for="characterLevel" class="svelte-172i2fj">Level</label> <input type="number" id="characterLevel" min="1" max="20" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterRace" class="svelte-172i2fj">Race</label> <input type="text" id="characterRace" placeholder="e.g., Human" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterBackground" class="svelte-172i2fj">Background</label> <input type="text" id="characterBackground" placeholder="e.g., Soldier" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterAlignment" class="svelte-172i2fj">Alignment</label> <input type="text" id="characterAlignment" placeholder="e.g., Lawful Good" class="svelte-172i2fj"/></div></div>'),ks=f('<section class="character-info svelte-172i2fj"><div class="header svelte-172i2fj"><h2 class="svelte-172i2fj">Character Info</h2> <button class="collapse-btn svelte-172i2fj"> </button></div> <!></section>');function xs(s,n){kt(n,!1);const t=()=>Ke(Y,"$character",h),c=()=>Ke(gt,"$collapsedStates",h),[h,S]=Lt(),L=R(),N=gs();function _(P){const he=P.target;Y.update(ue=>(ue.class=he.value,ue.subclass="",ue))}function M(P){const he=P.target;Y.update(ue=>(ue.subclass=he.value,ue))}function ie(P){const he=P.target;Y.update(ue=>(ue.level=parseInt(he.value)||1,ue)),Na()}function K(){gt.update(P=>({...P,characterInfo:!P.characterInfo}))}et(()=>(t(),ja),()=>{o(L,t().class?ja(t().class):[])}),jt(),yt();var O=ks(),Re=r(O),ne=a(r(Re),2),ge=r(ne,!0);l(ne),l(Re);var de=a(Re,2);{var Ce=P=>{var he=ys(),ue=r(he),oe=a(r(ue),2);xe(oe),l(ue);var W=a(ue,2),q=a(r(W),2),se=r(q);se.value=se.__value="";var ce=a(se);ct(ce,1,()=>N,dt,(X,_e)=>{var pe=hs(),qe=r(pe,!0);l(pe);var Le={};I(()=>{x(qe,(e(_e),i(()=>e(_e).name))),Le!==(Le=(e(_e),i(()=>e(_e).id)))&&(pe.value=(pe.__value=(e(_e),i(()=>e(_e).id)))??"")}),v(X,pe)}),l(q);var Z;ya(q),l(W);var Ie=a(W,2);{var $=X=>{var _e=_s(),pe=a(r(_e),2),qe=r(pe);qe.value=qe.__value="";var Le=a(qe);ct(Le,1,()=>e(L),dt,(Pe,Je)=>{var Ve=ms(),Ze=r(Ve,!0);l(Ve);var T={};I(()=>{x(Ze,(e(Je),i(()=>e(Je).name))),T!==(T=(e(Je),i(()=>e(Je).id)))&&(Ve.value=(Ve.__value=(e(Je),i(()=>e(Je).id)))??"")}),v(Pe,Ve)}),l(pe);var g;ya(pe),l(_e),I(()=>{g!==(g=(t(),i(()=>t().subclass)))&&(pe.value=(pe.__value=(t(),i(()=>t().subclass)))??"",ra(pe,(t(),i(()=>t().subclass))))}),j("change",pe,M),v(X,_e)};C(Ie,X=>{e(L),i(()=>e(L).length>0)&&X($)})}var le=a(Ie,2),ee=a(r(le),2);xe(ee),l(le);var me=a(le,2),b=a(r(me),2);xe(b),l(me);var d=a(me,2),w=a(r(d),2);xe(w),l(d);var J=a(d,2),V=a(r(J),2);xe(V),l(J),l(he),I(()=>{Z!==(Z=(t(),i(()=>t().class)))&&(q.value=(q.__value=(t(),i(()=>t().class)))??"",ra(q,(t(),i(()=>t().class)))),$a(ee,(t(),i(()=>t().level)))}),Ae(oe,()=>t().name,X=>tt(Y,i(t).name=X,i(t))),j("change",q,_),j("change",ee,ie),Ae(b,()=>t().race,X=>tt(Y,i(t).race=X,i(t))),Ae(w,()=>t().background,X=>tt(Y,i(t).background=X,i(t))),Ae(V,()=>t().alignment,X=>tt(Y,i(t).alignment=X,i(t))),v(P,he)};C(de,P=>{c(),i(()=>!c().characterInfo)&&P(Ce)})}l(O),I(()=>{at(ne,"aria-label",(c(),i(()=>c().characterInfo?"Expand":"Collapse"))),x(ge,(c(),i(()=>c().characterInfo?"â–¼":"â–²")))}),j("click",ne,K),v(s,O),xt(),S()}var Ss=f('<div class="ability-card svelte-bbv1xt"><h3 class="svelte-bbv1xt"> </h3> <input type="number" class="ability-score svelte-bbv1xt" min="1" max="30"/> <div class="ability-modifier svelte-bbv1xt"> </div> <button class="roll-btn svelte-bbv1xt">Check</button> <div class="save-row svelte-bbv1xt"><input type="checkbox" class="svelte-bbv1xt"/> <label class="svelte-bbv1xt">Save</label> <button class="roll-btn-small svelte-bbv1xt">Roll</button></div></div>'),$s=f('<div class="proficiency-bonus svelte-bbv1xt"><label for="profBonus">Proficiency Bonus</label> <input type="number" id="profBonus" class="prof-input svelte-bbv1xt"/></div> <div class="abilities-grid svelte-bbv1xt"></div>',1),Cs=f('<section><div class="header svelte-bbv1xt"><h2 class="svelte-bbv1xt">Ability Scores</h2> <button class="collapse-btn svelte-bbv1xt"> </button></div> <!></section>');function Ls(s,n){kt(n,!1);const t=()=>Ke(Yt,"$abilityModifiers",L),c=()=>Ke(Y,"$character",L),h=()=>Ke(Rt,"$searchFilter",L),S=()=>Ke(gt,"$collapsedStates",L),[L,N]=Lt(),_=R(),M=R(),ie=Gt(),K=[{key:"strength",label:"Strength"},{key:"dexterity",label:"Dexterity"},{key:"constitution",label:"Constitution"},{key:"intelligence",label:"Intelligence"},{key:"wisdom",label:"Wisdom"},{key:"charisma",label:"Charisma"}];function O(){Na()}function Re(q){const se=t()[q],ce=`1d20${se>=0?"+":""}${se}`;ie("roll",ce)}function ne(q){const se=t()[q],ce=c().saveProficiencies[q]?c().proficiencyBonus:0,Z=se+ce,Ie=`1d20${Z>=0?"+":""}${Z}`;ie("roll",Ie)}function ge(){gt.update(q=>({...q,abilityScores:!q.abilityScores}))}et(()=>h(),()=>{o(_,K.filter(({label:q})=>h()?q.toLowerCase().includes(h().toLowerCase()):!0))}),et(()=>(e(_),h()),()=>{o(M,e(_).length>0||!h()||h().toLowerCase().includes("proficiency"))}),jt(),yt();var de=Cs();let Ce;var P=r(de),he=a(r(P),2),ue=r(he,!0);l(he),l(P);var oe=a(P,2);{var W=q=>{var se=$s(),ce=Oe(se),Z=a(r(ce),2);xe(Z),l(ce);var Ie=a(ce,2);ct(Ie,5,()=>e(_),dt,($,le)=>{let ee=()=>e(le).key,me=()=>e(le).label;var b=Ss(),d=r(b),w=r(d,!0);l(d);var J=a(d,2);xe(J);var V=a(J,2),X=r(V);l(V);var _e=a(V,2),pe=a(_e,2),qe=r(pe);xe(qe);var Le=a(qe,2),g=a(Le,2);l(pe),l(b),I(Pe=>{x(w,Pe),x(X,`${t(),ee(),i(()=>t()[ee()]>=0?"+":"")??""}${t(),ee(),i(()=>t()[ee()])??""}`),at(qe,"id",`${ee()}-save`),at(Le,"for",`${ee()}-save`)},[()=>(me(),i(()=>me().substring(0,3).toUpperCase()))]),Ae(J,()=>c().abilities[ee()],Pe=>tt(Y,i(c).abilities[ee()]=Pe,i(c))),j("change",J,O),j("click",_e,()=>Re(ee())),ia(qe,()=>c().saveProficiencies[ee()],Pe=>tt(Y,i(c).saveProficiencies[ee()]=Pe,i(c))),j("click",g,()=>ne(ee())),v($,b)}),l(Ie),Ae(Z,()=>c().proficiencyBonus,$=>tt(Y,i(c).proficiencyBonus=$,i(c))),v(q,se)};C(oe,q=>{S(),i(()=>!S().abilityScores)&&q(W)})}l(de),I(()=>{Ce=ut(de,1,"ability-scores svelte-bbv1xt",null,Ce,{hidden:!e(M)}),at(he,"aria-label",(S(),i(()=>S().abilityScores?"Expand":"Collapse"))),x(ue,(S(),i(()=>S().abilityScores?"â–¼":"â–²")))}),j("click",he,ge),v(s,de),xt(),N()}function xa(s,n){if(!s.class)return null;const t=_t(s.class);if(!t||!t.spellcaster||!t.spellcastingAbility)return null;const c=n[t.spellcastingAbility];return 8+s.proficiencyBonus+c}var Ds=f('<div class="stat-box svelte-1r5hyyb"><label for="spellSaveDC" class="svelte-1r5hyyb">Spell Save DC</label> <input type="number" id="spellSaveDC" class="stat-input svelte-1r5hyyb" readonly="" title="8 + Proficiency Bonus + Spellcasting Ability Modifier"/></div>'),ws=f('<span class="hit-dice-type"> </span>'),js=f('<div class="stats-grid svelte-1r5hyyb"><div class="stat-box svelte-1r5hyyb"><label for="armorClass" class="svelte-1r5hyyb">Armor Class</label> <input type="number" id="armorClass" class="stat-input svelte-1r5hyyb"/></div> <div class="stat-box svelte-1r5hyyb"><label for="initiative" class="svelte-1r5hyyb">Initiative</label> <input type="number" id="initiative" class="stat-input svelte-1r5hyyb"/></div> <div class="stat-box svelte-1r5hyyb"><label for="speed" class="svelte-1r5hyyb">Speed</label> <input type="text" id="speed" class="stat-input svelte-1r5hyyb"/></div> <!></div> <div class="hp-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Points</h3> <div class="hp-display svelte-1r5hyyb"><div class="hp-inputs svelte-1r5hyyb"><input type="number" class="hp-current svelte-1r5hyyb" min="0"/> <span class="hp-separator svelte-1r5hyyb">/</span> <input type="number" class="hp-max svelte-1r5hyyb" min="0"/></div> <div class="hp-controls svelte-1r5hyyb"><button class="hp-btn svelte-1r5hyyb">âˆ’</button> <button class="hp-btn svelte-1r5hyyb">+</button> <button class="hp-btn svelte-1r5hyyb">âˆ’5</button> <button class="hp-btn svelte-1r5hyyb">+5</button></div></div> <div class="temp-hp svelte-1r5hyyb"><label for="tempHP" class="svelte-1r5hyyb">Temp HP</label> <input type="number" id="tempHP" min="0" class="svelte-1r5hyyb"/></div></div> <div class="hit-dice-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Dice</h3> <div class="hit-dice-display svelte-1r5hyyb"><input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <span>/</span> <input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <!></div> <div class="hit-dice-controls"><label for="hitDiceCount" class="svelte-1r5hyyb">Roll</label> <input type="number" id="hitDiceCount" class="hit-dice-count-input svelte-1r5hyyb" min="1" value="1"/> <button class="btn btn-primary roll-hit-dice use-enabled svelte-1r5hyyb">ðŸŽ² Roll</button></div></div>',1),Fs=f('<section><div class="header svelte-1r5hyyb"><h2 class="svelte-1r5hyyb">Combat Stats</h2> <button class="collapse-btn svelte-1r5hyyb"> </button></div> <!></section>');function As(s,n){kt(n,!1);const t=()=>Ke(Y,"$character",L),c=()=>Ke(Yt,"$abilityModifiers",L),h=()=>Ke(Rt,"$searchFilter",L),S=()=>Ke(gt,"$collapsedStates",L),[L,N]=Lt(),_=R(),M=R(),ie=Gt();function K(oe){Y.update(W=>(W.currentHP=Math.max(0,Math.min(W.maxHP,W.currentHP+oe)),W))}function O(oe=1){if(t().hitDice.current<=0){alert("No hit dice remaining!");return}if(!t().class){alert("Please select a class first!");return}const W=_t(t().class);if(!W){alert("Invalid class configuration!");return}const q=Math.min(oe,t().hitDice.current),se=W.hitDice,ce=c().constitution,Z=ce>=0?`+${ce}`:`${ce}`,Ie=`${q}${se}${Z}`;ie("rollHitDice",{notation:Ie,hitDie:se,count:q})}function Re(){gt.update(oe=>({...oe,combatStats:!oe.combatStats}))}et(()=>(t(),c()),()=>{o(_,xa(t(),c()))}),et(()=>h(),()=>{o(M,!h()||"armor class".includes(h().toLowerCase())||"initiative".includes(h().toLowerCase())||"speed".includes(h().toLowerCase())||"hit points".includes(h().toLowerCase())||"hp".includes(h().toLowerCase())||"hit dice".includes(h().toLowerCase())||"spell save".includes(h().toLowerCase())||"combat".includes(h().toLowerCase()))}),jt(),yt();var ne=Fs();let ge;var de=r(ne),Ce=a(r(de),2),P=r(Ce,!0);l(Ce),l(de);var he=a(de,2);{var ue=oe=>{var W=js(),q=Oe(W),se=r(q),ce=a(r(se),2);xe(ce),l(se);var Z=a(se,2),Ie=a(r(Z),2);xe(Ie),l(Z);var $=a(Z,2),le=a(r($),2);xe(le),l($);var ee=a($,2);{var me=G=>{var ae=Ds(),k=a(r(ae),2);xe(k),l(ae),I(()=>$a(k,e(_))),v(G,ae)};C(ee,G=>{e(_)!==null&&G(me)})}l(q);var b=a(q,2),d=a(r(b),2),w=r(d),J=r(w);xe(J);var V=a(J,4);xe(V),l(w);var X=a(w,2),_e=r(X),pe=a(_e,2),qe=a(pe,2),Le=a(qe,2);l(X),l(d);var g=a(d,2),Pe=a(r(g),2);xe(Pe),l(g),l(b);var Je=a(b,2),Ve=a(r(Je),2),Ze=r(Ve);xe(Ze);var T=a(Ze,4);xe(T);var F=a(T,2);{var Q=G=>{const ae=rt(()=>(U(_t),t(),i(()=>_t(t().class))));var k=nt(),Se=Oe(k);{var $e=Ee=>{const ze=rt(()=>(c(),i(()=>c().constitution)));var Xe=ws(),Te=r(Xe);l(Xe),I(()=>x(Te,`(${U(e(ae)),i(()=>e(ae).hitDice)??""}${(e(ze)>=0?`+${e(ze)}`:e(ze))??""})`)),v(Ee,Xe)};C(Se,Ee=>{e(ae)&&Ee($e)})}v(G,k)};C(F,G=>{t(),i(()=>t().class)&&G(Q)})}l(Ve);var ve=a(Ve,2),Ne=a(r(ve),2),we=a(Ne,2);l(ve),l(Je),I(()=>{at(J,"max",(t(),i(()=>t().maxHP))),at(Ze,"max",(t(),i(()=>t().hitDice.max))),at(Ne,"max",(t(),i(()=>t().hitDice.current))),we.disabled=(t(),i(()=>t().hitDice.current<=0||!t().class))}),Ae(ce,()=>t().armorClass,G=>tt(Y,i(t).armorClass=G,i(t))),Ae(Ie,()=>t().initiative,G=>tt(Y,i(t).initiative=G,i(t))),Ae(le,()=>t().speed,G=>tt(Y,i(t).speed=G,i(t))),Ae(J,()=>t().currentHP,G=>tt(Y,i(t).currentHP=G,i(t))),Ae(V,()=>t().maxHP,G=>tt(Y,i(t).maxHP=G,i(t))),j("click",_e,()=>K(-1)),j("click",pe,()=>K(1)),j("click",qe,()=>K(-5)),j("click",Le,()=>K(5)),Ae(Pe,()=>t().tempHP,G=>tt(Y,i(t).tempHP=G,i(t))),Ae(Ze,()=>t().hitDice.current,G=>tt(Y,i(t).hitDice.current=G,i(t))),Ae(T,()=>t().hitDice.max,G=>tt(Y,i(t).hitDice.max=G,i(t))),j("input",Ne,G=>{const ae=G.target,k=parseInt(ae.value);k>t().hitDice.current&&(ae.value=String(t().hitDice.current)),k<1&&(ae.value="1")}),j("click",we,()=>{const G=document.getElementById("hitDiceCount"),ae=parseInt(G?.value||"1");O(ae)}),v(oe,W)};C(he,oe=>{S(),i(()=>!S().combatStats)&&oe(ue)})}l(ne),I(()=>{ge=ut(ne,1,"combat-stats svelte-1r5hyyb",null,ge,{hidden:!e(M)}),at(Ce,"aria-label",(S(),i(()=>S().combatStats?"Expand":"Collapse"))),x(P,(S(),i(()=>S().combatStats?"â–¼":"â–²")))}),j("click",Ce,Re),v(s,ne),xt(),N()}const ma={acrobatics:"dexterity",animalHandling:"wisdom",arcana:"intelligence",athletics:"strength",deception:"charisma",history:"intelligence",insight:"wisdom",intimidation:"charisma",investigation:"intelligence",medicine:"wisdom",nature:"intelligence",perception:"wisdom",performance:"charisma",persuasion:"charisma",religion:"intelligence",sleightOfHand:"dexterity",stealth:"dexterity",survival:"wisdom"};var Rs=f('<div class="skill-row svelte-1f1pl16"><input type="checkbox" class="svelte-1f1pl16"/> <label class="svelte-1f1pl16"> <span class="ability-tag svelte-1f1pl16"> </span></label> <span class="skill-modifier svelte-1f1pl16"> </span> <button class="roll-btn svelte-1f1pl16">Roll</button></div>'),Is=f('<div class="skills-grid svelte-1f1pl16"></div>'),Ms=f('<section><div class="header svelte-1f1pl16"><h2 class="svelte-1f1pl16">Skills</h2> <button class="collapse-btn svelte-1f1pl16"> </button></div> <!></section>');function Ps(s,n){kt(n,!1);const t=()=>Ke(Yt,"$abilityModifiers",L),c=()=>Ke(Y,"$character",L),h=()=>Ke(Rt,"$searchFilter",L),S=()=>Ke(gt,"$collapsedStates",L),[L,N]=Lt(),_=R(),M=R(),ie=Gt(),K=[{key:"acrobatics",label:"Acrobatics"},{key:"animalHandling",label:"Animal Handling"},{key:"arcana",label:"Arcana"},{key:"athletics",label:"Athletics"},{key:"deception",label:"Deception"},{key:"history",label:"History"},{key:"insight",label:"Insight"},{key:"intimidation",label:"Intimidation"},{key:"investigation",label:"Investigation"},{key:"medicine",label:"Medicine"},{key:"nature",label:"Nature"},{key:"perception",label:"Perception"},{key:"performance",label:"Performance"},{key:"persuasion",label:"Persuasion"},{key:"religion",label:"Religion"},{key:"sleightOfHand",label:"Sleight of Hand"},{key:"stealth",label:"Stealth"},{key:"survival",label:"Survival"}];function O(W){const q=ma[W],se=t()[q],ce=c().skillProficiencies[W]?c().proficiencyBonus:0;return se+ce}function Re(W){const q=O(W),se=`1d20${q>=0?"+":""}${q}`;ie("roll",se)}function ne(){gt.update(W=>({...W,skills:!W.skills}))}et(()=>h(),()=>{o(_,K.filter(({label:W})=>h()?W.toLowerCase().includes(h().toLowerCase()):!0))}),et(()=>e(_),()=>{o(M,e(_).length>0)}),jt(),yt();var ge=Ms();let de;var Ce=r(ge),P=a(r(Ce),2),he=r(P,!0);l(P),l(Ce);var ue=a(Ce,2);{var oe=W=>{var q=Is();ct(q,5,()=>e(_),dt,(se,ce)=>{let Z=()=>e(ce).key,Ie=()=>e(ce).label;const $=rt(()=>(U(ma),Z(),i(()=>ma[Z()]))),le=rt(()=>(Z(),i(()=>O(Z()))));var ee=Rs(),me=r(ee);xe(me);var b=a(me,2),d=r(b),w=a(d),J=r(w);l(w),l(b);var V=a(b,2),X=r(V);l(V);var _e=a(V,2);l(ee),I(pe=>{at(me,"id",Z()),at(b,"for",Z()),x(d,`${Ie()??""} `),x(J,`(${pe??""})`),x(X,`${e(le)>=0?"+":""}${e(le)??""}`)},[()=>(U(e($)),i(()=>e($).substring(0,3).toUpperCase()))]),ia(me,()=>c().skillProficiencies[Z()],pe=>tt(Y,i(c).skillProficiencies[Z()]=pe,i(c))),j("click",_e,()=>Re(Z())),v(se,ee)}),l(q),v(W,q)};C(ue,W=>{S(),i(()=>!S().skills)&&W(oe)})}l(ge),I(()=>{de=ut(ge,1,"skills svelte-1f1pl16",null,de,{hidden:!e(M)}),at(P,"aria-label",(S(),i(()=>S().skills?"Expand":"Collapse"))),x(he,(S(),i(()=>S().skills?"â–¼":"â–²")))}),j("click",P,ne),v(s,ge),xt(),N()}let ta=null,aa=null;async function qa(){if(ta)return ta;try{return ta=await(await fetch(Oa("/data/spells.json"))).json(),ta||[]}catch(s){return console.error("Failed to load spells:",s),[]}}async function Es(){if(aa)return aa;try{return aa=await(await fetch(Oa("/data/feats.json"))).json(),aa||[]}catch(s){return console.error("Failed to load feats:",s),[]}}function Ra(s,n){if(!n.trim())return s;const t=n.toLowerCase();return s.filter(c=>c.name.toLowerCase().includes(t)||c.school.toLowerCase().includes(t)||c.classes.some(h=>h.toLowerCase().includes(t))||c.description.toLowerCase().includes(t))}function Ts(s,n){return n===null?s:s.filter(t=>t.level===n)}function Hs(s,n){if(!n.trim())return s;const t=n.toLowerCase();return s.filter(c=>c.name.toLowerCase().includes(t)||c.description.toLowerCase().includes(t))}function sa(s){const n=s.description,t=/\b(Strength|Dexterity|Constitution|Intelligence|Wisdom|Charisma)\s+saving\s+throw/i,c=n.match(t);if(!c)return null;const h=c[1].toLowerCase(),L=/half\s+(?:as\s+much\s+)?damage\s+on\s+a\s+successful(?:\s+save)?/i.test(n),_=/saving\s+throw\s+or\s+take.*?damage/i.test(n)&&!L;return{ability:h,halfDamageOnSave:L,noDamageOnSave:_}}var Us=f('<button class="btn-remove svelte-14o91c5">Ã—</button>'),Bs=f('<div class="spell-info-loading svelte-14o91c5">Loading spell info...</div>'),Ns=f('<div class="spell-notes svelte-14o91c5"><h4 class="svelte-14o91c5">General Notes</h4> <p> </p></div>'),Gs=f('<li class="svelte-14o91c5"><strong>At Higher Levels:</strong> </li>'),Os=f('<ul class="svelte-14o91c5"><li class="svelte-14o91c5"><strong>Level:</strong> </li> <li class="svelte-14o91c5"><strong>Casting Time:</strong> </li> <li class="svelte-14o91c5"><strong>Range:</strong> </li> <li class="svelte-14o91c5"><strong>Components:</strong> <!></li> <li class="svelte-14o91c5"><strong>Duration:</strong> <!> </li> <li class="svelte-14o91c5"><strong>Description:</strong> </li> <!></ul>'),qs=f("<option> </option>"),zs=f('<span class="scaled-damage svelte-14o91c5"><!> </span>'),Ws=f('<span class="scaled-damage svelte-14o91c5"> </span>'),Ks=f('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> Target is Fiend or Undead <!></label></div>'),Js=f('<span class="scaled-damage svelte-14o91c5" style="margin-left: 8px;"> </span>'),Vs=f('<span class="scaled-damage svelte-14o91c5">(Half damage)</span>'),Qs=f('<span class="scaled-damage svelte-14o91c5">(No damage)</span>'),Ys=f('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> <!> <!></label></div>'),Xs=f('<div class="spell-level-selector svelte-14o91c5"><label class="svelte-14o91c5">Cast at Level:</label> <select class="spell-level-select use-enabled svelte-14o91c5"></select> <!></div> <!> <!>',1),Zs=f('<div class="spell-level-selector svelte-14o91c5"><span style="color: #dc3545; font-weight: bold;">No spell slots available!</span></div>'),el=f('<!> <div class="spell-info svelte-14o91c5"><div class="spell-info-header svelte-14o91c5" role="button" tabindex="0"><h4 class="svelte-14o91c5">Spell Info</h4> <button class="collapse-btn-small svelte-14o91c5"> </button></div> <!></div> <!>',1),tl=f('<div class="spell-info-missing svelte-14o91c5">Spell info not found.</div>'),al=f('<div class="attack-notes svelte-14o91c5"><label class="svelte-14o91c5">Notes</label> <textarea placeholder="e.g., DC 15 Dex save, Range 120 ft, Concentration" class="notes-input svelte-14o91c5" rows="2"></textarea></div>'),sl=f('<button class="btn btn-primary">Roll Attack</button>'),ll=f('<button class="btn btn-secondary"><!></button>'),rl=f('<button class="btn btn-secondary">Roll Damage</button>'),il=f('<div class="attack-card svelte-14o91c5"><div class="attack-header svelte-14o91c5"><input type="text" placeholder="Attack name" class="attack-name svelte-14o91c5"/> <!></div> <div class="attack-details svelte-14o91c5"><div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Bonus</label> <input type="number" class="attack-bonus svelte-14o91c5"/></div> <div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Damage</label> <input type="text" placeholder="e.g., 2d6+3" class="attack-damage svelte-14o91c5"/></div> <div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Type</label> <input type="text" placeholder="e.g., slashing" class="attack-type svelte-14o91c5"/></div></div> <!> <!> <div class="attack-actions svelte-14o91c5"><!> <!></div></div>'),nl=f('<p class="no-attacks svelte-14o91c5">No attacks added yet. Click "Add Attack" to create one.</p>'),ol=f('<p class="no-attacks svelte-14o91c5">No attacks match your search.</p>'),cl=f('<button class="btn btn-secondary">Add Attack</button> <div class="attacks-list svelte-14o91c5"><!> <!></div>',1),vl=f('<section><div class="header svelte-14o91c5"><h2 class="svelte-14o91c5">Attacks & Spells</h2> <button class="collapse-btn svelte-14o91c5"> </button></div> <!></section>');function dl(s,n){kt(n,!1);const t=()=>Ke(Y,"$character",N),c=()=>Ke(Rt,"$searchFilter",N),h=()=>Ke(gt,"$collapsedStates",N),S=()=>Ke(la,"$isEditMode",N),L=()=>Ke(Yt,"$abilityModifiers",N),[N,_]=Lt(),M=R(),ie=R(),K=Gt();let O=R({});function Re(d){Ua(O,e(O)[d]=!e(O)[d]),o(O,{...e(O)})}function ne(d){return d.description.toLowerCase().includes("regain")&&(d.description.toLowerCase().includes("hit point")||d.description.toLowerCase().includes("hp"))}function ge(){Y.update(d=>(d.attacks=[...d.attacks,{id:crypto.randomUUID(),name:"",bonus:0,damage:"",damageType:"",notes:""}],d))}function de(d){Y.update(w=>(w.attacks=w.attacks.filter(J=>J.id!==d),w))}function Ce(d){let w=d.damage,J=!1;if(d.spellRef){const X=W(d.spellRef);if(X&&X.level>0){const _e=d.castAtLevel||X.level;if(!q(_e)){alert(`No level ${_e} spell slots available!`);return}const qe=sa(X);qe&&d.targetSucceededSave&&qe.noDamageOnSave?w="0":(J=qe?.halfDamageOnSave&&d.targetSucceededSave||!1,w=se(d,X))}}const V=`1d20${d.bonus>=0?"+":""}${d.bonus}`;K("roll",{notation:V,damageNotation:w,attackName:d.name,applyHalfDamage:J})}function P(d){if(!d.damage){alert(`${d.name}: No damage specified`);return}let w=d.damage,J=!1;if(d.spellRef){const V=W(d.spellRef);if(V&&V.level>0){const X=d.castAtLevel||V.level;if(!q(X)){alert(`No level ${X} spell slots available!`);return}const pe=sa(V);pe&&d.targetSucceededSave&&pe.noDamageOnSave?w="0":(J=pe?.halfDamageOnSave&&d.targetSucceededSave||!1,w=se(d,V))}}K("roll",{notation:w,attackName:d.name,applyHalfDamage:J})}function he(){gt.update(d=>({...d,attacks:!d.attacks}))}let ue=R([]),oe=R(!1);Qt(async()=>{o(ue,await qa()),o(oe,!0)});function W(d){return e(ue).find(w=>w.name===d)}function q(d){t().classFeatures.spellSlotsByLevel||tt(Y,i(t).classFeatures.spellSlotsByLevel={},i(t)),t().classFeatures.spellSlotsByLevel[d]||tt(Y,i(t).classFeatures.spellSlotsByLevel[d]=Array(2).fill(!1),i(t));const J=t().classFeatures.spellSlotsByLevel[d].findIndex(V=>!V);return J===-1?!1:(Y.update(V=>(V.classFeatures.spellSlotsByLevel||(V.classFeatures.spellSlotsByLevel={}),V.classFeatures.spellSlotsByLevel[d]||(V.classFeatures.spellSlotsByLevel[d]=Array(2).fill(!1)),V.classFeatures.spellSlotsByLevel[d][J]=!0,V)),!0)}function se(d,w){let J=d.damage,V=0;if(w.higherLevelSlot&&d.castAtLevel){const Le=w.level,Pe=(d.castAtLevel||Le)-Le;if(Pe>0){const Je=w.higherLevelSlot.match(/(\d+)d(\d+)\s+for\s+each.*?level\s+above/i);if(Je){const[,Ve]=Je;V+=Pe*parseInt(Ve)}}}if(d.targetIsFiendOrUndead&&w.description.includes("Fiend or an Undead")){const Le=w.description.match(/increases by (\d+)d(\d+) if.*?Fiend or.*?Undead/i);if(Le){const[,g]=Le;V+=parseInt(g)}}const X=J.match(/(\d+)d(\d+)/);if(!X)return J;const[,_e,pe]=X;return`${parseInt(_e)+V}d${pe}`}function ce(d){const w=[];for(let V=d.level;V<=9;V++){const X=t().classFeatures.spellSlotsByLevel?.[V];X&&X.length>0&&w.push(V)}return w}et(()=>(t(),c()),()=>{o(M,t().attacks.filter(d=>{if(!c())return!0;const w=c().toLowerCase();return d.name.toLowerCase().includes(w)||d.damageType.toLowerCase().includes(w)}).sort((d,w)=>!d.spellRef&&w.spellRef?-1:d.spellRef&&!w.spellRef?1:0))}),et(()=>(c(),e(M)),()=>{o(ie,!c()||e(M).length>0||"attack".includes(c().toLowerCase())||"spell".includes(c().toLowerCase()))}),jt(),yt();var Z=vl();let Ie;var $=r(Z),le=a(r($),2),ee=r(le,!0);l(le),l($);var me=a($,2);{var b=d=>{var w=cl(),J=Oe(w),V=a(J,2),X=r(V);ct(X,1,()=>e(M),Le=>Le.id,(Le,g,Pe)=>{var Je=il(),Ve=r(Je),Ze=r(Ve);xe(Ze);var T=a(Ze,2);{var F=D=>{var z=Us();j("click",z,()=>de(e(g).id)),v(D,z)};C(T,D=>{S()&&D(F)})}l(Ve);var Q=a(Ve,2),ve=r(Q),Ne=a(r(ve),2);xe(Ne),l(ve);var we=a(ve,2),G=a(r(we),2);xe(G),l(we);var ae=a(we,2),k=a(r(ae),2);xe(k),l(ae),l(Q);var Se=a(Q,2);{var $e=D=>{var z=nt(),u=Oe(z);{var A=E=>{var m=Bs();v(E,m)},H=E=>{const m=rt(()=>(e(g),i(()=>W(e(g).spellRef))));var re=nt(),He=Oe(re);{var fe=p=>{var B=el(),y=Oe(B);{var je=it=>{var st=Ns(),pt=a(r(st),2),Mt=r(pt,!0);l(pt),l(st),I(()=>x(Mt,(e(g),i(()=>e(g).generalNotes)))),v(it,st)};C(y,it=>{e(g),i(()=>e(g).generalNotes)&&it(je)})}var Ue=a(y,2),Qe=r(Ue),De=a(r(Qe),2),Be=r(De,!0);l(De),l(Qe);var Fe=a(Qe,2);{var be=it=>{var st=Os(),pt=r(st),Mt=a(r(pt));l(pt);var Ot=a(pt,2),ca=a(r(Ot));l(Ot);var St=a(Ot,2),ht=a(r(St));l(St);var Tt=a(St,2),Ht=a(r(Tt)),Xt=a(Ht);{var Pt=Ye=>{var lt=bt();I(()=>x(lt,`(${U(e(m)),i(()=>e(m).material)??""})`)),v(Ye,lt)};C(Xt,Ye=>{U(e(m)),i(()=>e(m).material)&&Ye(Pt)})}l(Tt);var qt=a(Tt,2),Zt=a(r(qt),2);{var ea=Ye=>{var lt=bt("Concentration,");v(Ye,lt)};C(Zt,Ye=>{U(e(m)),i(()=>e(m).concentration)&&Ye(ea)})}var va=a(Zt,1,!0);l(qt);var zt=a(qt,2),da=a(r(zt));l(zt);var ot=a(zt,2);{var vt=Ye=>{var lt=Gs(),mt=a(r(lt));l(lt),I(()=>x(mt,` ${U(e(m)),i(()=>e(m).higherLevelSlot)??""}`)),v(Ye,lt)};C(ot,Ye=>{U(e(m)),i(()=>e(m).higherLevelSlot)&&Ye(vt)})}l(st),I(Ye=>{x(Mt,` ${U(e(m)),i(()=>e(m).level)??""}`),x(ca,` ${U(e(m)),i(()=>e(m).castingTime||e(m).actionType)??""}`),x(ht,` ${U(e(m)),i(()=>e(m).range)??""}`),x(Ht,` ${Ye??""}`),x(va,(U(e(m)),i(()=>e(m).duration))),x(da,` ${U(e(m)),i(()=>e(m).description)??""}`)},[()=>(U(e(m)),i(()=>e(m).components.join(", ")))]),v(it,st)};C(Fe,it=>{e(O),e(g),i(()=>!e(O)[e(g).id])&&it(be)})}l(Ue);var ke=a(Ue,2);{var It=it=>{const st=rt(()=>(U(e(m)),i(()=>ce(e(m)))));var pt=nt(),Mt=Oe(pt);{var Ot=St=>{const ht=rt(()=>(U(sa),U(e(m)),i(()=>sa(e(m)))));var Tt=Xs(),Ht=Oe(Tt),Xt=r(Ht),Pt=a(Xt,2);I(()=>{e(g),Ct(()=>{e(st)})}),ct(Pt,5,()=>e(st),dt,(ot,vt)=>{var Ye=qs(),lt=r(Ye);l(Ye);var mt={};I(()=>{x(lt,`Level ${e(vt)??""}`),mt!==(mt=e(vt))&&(Ye.value=(Ye.__value=e(vt))??"")}),v(ot,Ye)}),l(Pt);var qt=a(Pt,2);{var Zt=ot=>{const vt=rt(()=>(e(g),U(e(m)),i(()=>se(e(g),e(m)))));var Ye=zs(),lt=r(Ye);{var mt=$t=>{var wt=bt("Healing");v($t,wt)},Ut=$t=>{var wt=bt("Damage");v($t,wt)};C(lt,$t=>{U(e(m)),i(()=>ne(e(m)))?$t(mt):$t(Ut,!1)})}var Dt=a(lt);l(Ye),I(()=>x(Dt,` ${e(vt)??""}`)),v(ot,Ye)};C(qt,ot=>{e(g),U(e(m)),i(()=>e(g).castAtLevel&&e(g).castAtLevel>e(m).level)&&ot(Zt)})}l(Ht);var ea=a(Ht,2);{var va=ot=>{var vt=Ks(),Ye=r(vt),lt=r(Ye);xe(lt);var mt=a(lt,2);{var Ut=Dt=>{const $t=rt(()=>(e(g),U(e(m)),i(()=>se(e(g),e(m)))));var wt=Ws(),ua=r(wt);l(wt),I(()=>x(ua,`(+1d8, total: ${e($t)??""})`)),v(Dt,wt)};C(mt,Dt=>{e(g),i(()=>e(g).targetIsFiendOrUndead)&&Dt(Ut)})}l(Ye),l(vt),ia(lt,()=>e(g).targetIsFiendOrUndead,Dt=>(e(g).targetIsFiendOrUndead=Dt,Ct(()=>(e(M),t(),c())))),v(ot,vt)};C(ea,ot=>{U(e(m)),i(()=>e(m).description.includes("Fiend or an Undead"))&&ot(va)})}var zt=a(ea,2);{var da=ot=>{var vt=Ys(),Ye=r(vt),lt=r(Ye);xe(lt);var mt=a(lt),Ut=a(mt);{var Dt=ft=>{var Ft=Js(),pa=r(Ft);l(Ft),I(fa=>x(pa,`(Spell Save DC: ${fa??""})`),[()=>(U(xa),t(),L(),i(()=>xa(t(),L())))]),v(ft,Ft)};C(Ut,ft=>{t(),i(()=>t().class)&&ft(Dt)})}var $t=a(Ut,2);{var wt=ft=>{var Ft=Vs();v(ft,Ft)},ua=ft=>{var Ft=nt(),pa=Oe(Ft);{var fa=ba=>{var za=Qs();v(ba,za)};C(pa,ba=>{e(g),U(e(ht)),i(()=>e(g).targetSucceededSave&&e(ht).noDamageOnSave)&&ba(fa)},!0)}v(ft,Ft)};C($t,ft=>{e(g),U(e(ht)),i(()=>e(g).targetSucceededSave&&e(ht).halfDamageOnSave)?ft(wt):ft(ua,!1)})}l(Ye),l(vt),I(ft=>x(mt,` Target succeeded on ${ft??""} save `),[()=>(U(e(ht)),i(()=>e(ht).ability.charAt(0).toUpperCase()+e(ht).ability.slice(1)))]),ia(lt,()=>e(g).targetSucceededSave,ft=>(e(g).targetSucceededSave=ft,Ct(()=>(e(M),t(),c())))),v(ot,vt)};C(zt,ot=>{e(ht)&&ot(da)})}I(()=>{at(Xt,"for",`castLevel-${e(g),i(()=>e(g).id)??""}`),at(Pt,"id",`castLevel-${e(g),i(()=>e(g).id)??""}`)}),Ga(Pt,()=>e(g).castAtLevel,ot=>(e(g).castAtLevel=ot,Ct(()=>(e(M),t(),c())))),v(St,Tt)},ca=St=>{var ht=Zs();v(St,ht)};C(Mt,St=>{U(e(st)),i(()=>e(st).length>0)?St(Ot):St(ca,!1)})}v(it,pt)};C(ke,it=>{U(e(m)),i(()=>e(m).higherLevelSlot&&e(m).level>0)&&it(It)})}I(()=>{at(De,"aria-label",(e(O),e(g),i(()=>e(O)[e(g).id]?"Expand":"Collapse"))),x(Be,(e(O),e(g),i(()=>e(O)[e(g).id]?"â–¼":"â–²")))}),j("click",Qe,()=>Re(e(g).id)),j("keydown",Qe,it=>it.key==="Enter"&&Re(e(g).id)),v(p,B)},Me=p=>{var B=tl();v(p,B)};C(He,p=>{e(m)?p(fe):p(Me,!1)})}v(E,re)};C(u,E=>{e(ue),i(()=>e(ue).length===0)?E(A):E(H,!1)})}v(D,z)};C(Se,D=>{e(g),i(()=>e(g).spellRef)&&D($e)})}var Ee=a(Se,2);{var ze=D=>{var z=al(),u=a(r(z),2);Kt(u),l(z),Ae(u,()=>e(g).notes,A=>(e(g).notes=A,Ct(()=>(e(M),t(),c())))),v(D,z)};C(Ee,D=>{e(g),i(()=>!e(g).spellRef)&&D(ze)})}var Xe=a(Ee,2),Te=r(Xe);{var te=D=>{var z=sl();j("click",z,()=>Ce(e(g))),v(D,z)};C(Te,D=>{e(g),i(()=>e(g).bonus!==0||!e(g).spellRef)&&D(te)})}var ye=a(Te,2);{var Ge=D=>{const z=rt(()=>(e(g),i(()=>W(e(g).spellRef))));var u=ll(),A=r(u);{var H=m=>{var re=bt("Roll Healing");v(m,re)},E=m=>{var re=bt("Roll Damage");v(m,re)};C(A,m=>{U(e(z)),i(()=>e(z)&&ne(e(z)))?m(H):m(E,!1)})}l(u),j("click",u,()=>P(e(g))),v(D,u)},We=D=>{var z=rl();j("click",z,()=>P(e(g))),v(D,z)};C(ye,D=>{e(g),e(oe),i(()=>e(g).spellRef&&e(oe))?D(Ge):D(We,!1)})}l(Xe),l(Je),Ae(Ze,()=>e(g).name,D=>(e(g).name=D,Ct(()=>(e(M),t(),c())))),Ae(Ne,()=>e(g).bonus,D=>(e(g).bonus=D,Ct(()=>(e(M),t(),c())))),Ae(G,()=>e(g).damage,D=>(e(g).damage=D,Ct(()=>(e(M),t(),c())))),Ae(k,()=>e(g).damageType,D=>(e(g).damageType=D,Ct(()=>(e(M),t(),c())))),v(Le,Je)});var _e=a(X,2);{var pe=Le=>{var g=nl();v(Le,g)},qe=Le=>{var g=nt(),Pe=Oe(g);{var Je=Ve=>{var Ze=ol();v(Ve,Ze)};C(Pe,Ve=>{e(M),i(()=>e(M).length===0)&&Ve(Je)},!0)}v(Le,g)};C(_e,Le=>{t(),i(()=>t().attacks.length===0)?Le(pe):Le(qe,!1)})}l(V),j("click",J,ge),v(d,w)};C(me,d=>{h(),i(()=>!h().attacks)&&d(b)})}l(Z),I(()=>{Ie=ut(Z,1,"attacks svelte-14o91c5",null,Ie,{hidden:!e(ie)}),at(le,"aria-label",(h(),i(()=>h().attacks?"Expand":"Collapse"))),x(ee,(h(),i(()=>h().attacks?"â–¼":"â–²")))}),j("click",le,he),v(s,Z),xt(),_()}var ul=f('<p class="no-features svelte-1kpvv0n">Select a class to see available features</p>'),pl=f('<p class="no-features svelte-1kpvv0n">No class features available at this level</p>'),fl=f('<input type="checkbox" class="slot-checkbox svelte-1kpvv0n"/>'),bl=f('<div class="spell-slots svelte-1kpvv0n"><label class="svelte-1kpvv0n"> </label> <div class="slots-tracker svelte-1kpvv0n"></div></div>'),gl=f('<div class="all-spell-slots"></div>'),hl=f('<div class="feature-box spellcasting svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"> </h3> <div class="spell-stats svelte-1kpvv0n"><div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Spell Save DC</label> <div class="spell-value svelte-1kpvv0n"> </div></div> <div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <div class="spell-value svelte-1kpvv0n"> </div></div></div> <!> <div class="prepared-spells svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <textarea placeholder="List your prepared spells..." class="svelte-1kpvv0n"></textarea></div></div>'),ml=f('<p class="unlimited svelte-1kpvv0n">Unlimited Uses</p>'),_l=f('<input type="checkbox" class="slot-checkbox svelte-1kpvv0n"/>'),yl=f('<div class="slots-tracker svelte-1kpvv0n"></div> <div class="uses-actions-row"><button class="btn btn-primary use-enabled"> </button></div> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div>',1),kl=f('<div class="uses-tracker svelte-1kpvv0n"><!></div>'),xl=f('<div class="pool-tracker svelte-1kpvv0n"><input type="number" min="0" class="pool-input svelte-1kpvv0n"/> <span> </span> <button class="btn-small svelte-1kpvv0n"> </button></div>'),Sl=f('<p class="no-uses svelte-1kpvv0n">No Channel Divinity uses remaining</p>'),$l=f('<div class="channel-divinity-option svelte-1kpvv0n"><button class="btn btn-primary use-enabled svelte-1kpvv0n">Use Channel Divinity</button> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div> <!></div>'),Cl=f('<div class="feature-box svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"><!> </h3> <p class="feature-description svelte-1kpvv0n"> </p> <!></div>'),Ll=f('<div class="features-grid svelte-1kpvv0n"><!> <!></div>'),Dl=f('<section><div class="header svelte-1kpvv0n"><h2 class="svelte-1kpvv0n">Class Features</h2> <button class="collapse-btn svelte-1kpvv0n"> </button></div> <!></section>');function wl(s,n){kt(n,!1);const t=()=>Ke(Y,"$character",L),c=()=>Ke(Yt,"$abilityModifiers",L),h=()=>Ke(Rt,"$searchFilter",L),S=()=>Ke(gt,"$collapsedStates",L),[L,N]=Lt(),_=R(),M=R(),ie=R(),K=R(),O=R(),Re=R(),ne=R();let ge=R(0),de=R(0);function Ce(b,d){Y.update(w=>(w.classFeatures.features[b]=d,w))}function P(){Y.update(b=>(b.classFeatures.spellSlotsByLevel||(b.classFeatures.spellSlotsByLevel={}),e(K).forEach(({level:d,slots:w})=>{b.classFeatures.spellSlotsByLevel[d]||(b.classFeatures.spellSlotsByLevel[d]=Array(w).fill(!1))}),b))}function he(b){if(typeof b.maxUses=="function"){if((b.name==="Divine Sense"||b.name==="War Priest")&&e(_)?.spellcastingAbility){const d=c()[e(_).spellcastingAbility];return b.maxUses(t().level,d)}return b.maxUses(t().level)}return b.maxUses||0}function ue(b,d){Y.update(w=>((!w.classFeatures.features[b]||!Array.isArray(w.classFeatures.features[b])||w.classFeatures.features[b].length!==d)&&(w.classFeatures.features[b]=Array(d).fill(!1)),w))}Wa(()=>{e(Re)&&t()&&t().classFeatures&&t().classFeatures.features&&e(Re).forEach(b=>{if(b.type==="uses"){const d=b.name.replace(/\s+/g,""),w=he(b),J=t().classFeatures.features[d];(!Array.isArray(J)||J.length!==w)&&ue(d,w)}})});function oe(b){return typeof b.maxPool=="function"?b.maxPool(t().level):b.maxPool||0}function W(b){return typeof b.description=="function"?b.description(t().level):b.description}function q(){const b="ChannelDivinity";Y.update(d=>{const w=d.classFeatures.features[b];return typeof w=="number"&&w>0&&(d.classFeatures.features[b]=w-1),d})}function se(){gt.update(b=>({...b,classFeatures:!b.classFeatures}))}et(()=>(t(),_t),()=>{o(_,t().class?_t(t().class):null)}),et(()=>(t(),Nt),()=>{o(M,t().class?Nt(t().class,t().level,t().subclass):[])}),et(()=>(t(),Fa),()=>{o(ie,t().class?Fa(t().class,t().level):0)}),et(()=>(e(_),t()),()=>{o(K,(()=>{if(!e(_)?.spellcaster)return[];const b=t().level,d=[];return b>=1&&d.push({level:1,slots:Math.min(4,2+Math.floor(b/3))}),b>=3&&d.push({level:2,slots:Math.min(3,2+Math.floor((b-3)/4))}),b>=5&&d.push({level:3,slots:Math.min(3,2+Math.floor((b-5)/5))}),b>=7&&d.push({level:4,slots:Math.min(3,1+Math.floor((b-7)/6))}),b>=9&&d.push({level:5,slots:Math.min(2,1+Math.floor((b-9)/8))}),b>=11&&d.push({level:6,slots:1}),b>=13&&d.push({level:7,slots:1}),b>=15&&d.push({level:8,slots:1}),b>=17&&d.push({level:9,slots:1}),d})())}),et(()=>(e(_),c(),t(),Aa),()=>{if(e(_)?.spellcaster&&e(_).spellcastingAbility){const b=c()[e(_).spellcastingAbility];o(ge,bs(t().class,b,t().proficiencyBonus)||0),o(de,Aa(t().class,t().level,b))}}),et(()=>(t(),e(_),e(K)),()=>{t().class&&e(_)?.spellcaster&&e(K).length>0&&P()}),et(()=>t(),()=>{o(O,(()=>{const d=t().classFeatures.features["ChannelDivinity"];return typeof d=="number"?d:0})())}),et(()=>(e(M),h()),()=>{o(Re,e(M).filter(b=>{if(!h())return!0;const d=h().toLowerCase();return b.name.toLowerCase().includes(d)||W(b).toLowerCase().includes(d)}))}),et(()=>(h(),t(),e(Re)),()=>{o(ne,!h()||t().class||"class features".includes(h().toLowerCase())||"spellcasting".includes(h().toLowerCase())||e(Re).length>0)}),jt(),yt();var ce=Dl();let Z;var Ie=r(ce),$=a(r(Ie),2),le=r($,!0);l($),l(Ie);var ee=a(Ie,2);{var me=b=>{var d=nt(),w=Oe(d);{var J=X=>{var _e=ul();v(X,_e)},V=X=>{var _e=nt(),pe=Oe(_e);{var qe=g=>{var Pe=pl();v(g,Pe)},Le=g=>{var Pe=Ll(),Je=r(Pe);{var Ve=T=>{var F=hl(),Q=r(F),ve=r(Q);l(Q);var Ne=a(Q,2),we=r(Ne),G=a(r(we),2),ae=r(G,!0);l(G),l(we);var k=a(we,2),Se=a(r(k),2),$e=r(Se,!0);l(Se),l(k),l(Ne);var Ee=a(Ne,2);{var ze=te=>{var ye=gl();ct(ye,5,()=>e(K),dt,(Ge,We)=>{let D=()=>e(We).level,z=()=>e(We).slots;const u=rt(()=>(t(),D(),z(),i(()=>t().classFeatures.spellSlotsByLevel?.[D()]||Array(z()).fill(!1))));var A=bl(),H=r(A),E=r(H);l(H);var m=a(H,2);ct(m,5,()=>e(u),dt,(re,He,fe)=>{var Me=fl();xe(Me),I(()=>Da(Me,(U(e(u)),i(()=>e(u)[fe]||!1)))),j("change",Me,p=>{Y.update(B=>(B.classFeatures.spellSlotsByLevel||(B.classFeatures.spellSlotsByLevel={}),B.classFeatures.spellSlotsByLevel[D()]||(B.classFeatures.spellSlotsByLevel[D()]=Array(z()).fill(!1)),B.classFeatures.spellSlotsByLevel[D()][fe]=p.currentTarget.checked,B))}),v(re,Me)}),l(m),l(A),I(()=>x(E,`${D()===1?"1st":D()===2?"2nd":D()===3?"3rd":`${D()}th`} Level Spell Slots`)),v(Ge,A)}),l(ye),v(te,ye)};C(Ee,te=>{e(K),i(()=>e(K).length>0)&&te(ze)})}var Xe=a(Ee,2),Te=a(r(Xe),2);Kt(Te),l(Xe),l(F),I(te=>{x(ve,`Spellcasting (${te??""})`),x(ae,e(ge)),x($e,e(de))},[()=>(e(_),i(()=>e(_).spellcastingAbility?.toUpperCase()))]),Ae(Te,()=>t().classFeatures.preparedSpells,te=>tt(Y,i(t).classFeatures.preparedSpells=te,i(t))),v(T,F)};C(Je,T=>{e(_),i(()=>e(_)?.spellcaster)&&T(Ve)})}var Ze=a(Je,2);ct(Ze,1,()=>e(Re),dt,(T,F)=>{const Q=rt(()=>(e(F),i(()=>e(F).name.replace(/\s+/g,"")))),ve=rt(()=>(t(),U(e(Q)),i(()=>t().classFeatures.features[e(Q)]))),Ne=rt(()=>typeof e(ve)=="number");var we=Cl(),G=r(we),ae=r(G);{var k=te=>{var ye=bt("Channel Divinity:");v(te,ye)};C(ae,te=>{e(F),i(()=>e(F).type==="channelDivinity")&&te(k)})}var Se=a(ae);l(G);var $e=a(G,2),Ee=r($e,!0);l($e);var ze=a($e,2);{var Xe=te=>{const ye=rt(()=>(e(F),i(()=>he(e(F))))),Ge=rt(()=>(U(e(ve)),U(e(ye)),i(()=>Array.isArray(e(ve))?e(ve):Array(e(ye)).fill(!1))));var We=kl(),D=r(We);{var z=A=>{var H=ml();v(A,H)},u=A=>{var H=yl(),E=Oe(H);ct(E,5,()=>e(Ge),dt,(B,y,je)=>{var Ue=_l();xe(Ue),I(()=>Da(Ue,e(y))),j("change",Ue,Qe=>{Y.update(De=>(De.classFeatures.features[e(Q)]||(De.classFeatures.features[e(Q)]=Array(e(ye)).fill(!1)),De.classFeatures.features[e(Q)][je]=Qe.currentTarget.checked,De))}),v(B,Ue)}),l(E);var m=a(E,2),re=r(m),He=r(re);l(re),l(m);var fe=a(m,2),Me=r(fe),p=r(Me);l(Me),l(fe),I(B=>{re.disabled=B,x(He,`Use ${e(F),i(()=>e(F).name)??""}`),x(p,`Resets on ${e(F),i(()=>e(F).resetOn==="short"?"Short Rest":"Long Rest")??""}`)},[()=>(U(e(Ge)),i(()=>e(Ge).filter(B=>!B).length<=0))]),j("click",re,()=>{Y.update(B=>{B.classFeatures.features[e(Q)]||(B.classFeatures.features[e(Q)]=Array(e(ye)).fill(!1));const y=B.classFeatures.features[e(Q)],je=y.findIndex(Ue=>!Ue);return je!==-1&&(y[je]=!0),B})}),v(A,H)};C(D,A=>{e(ye)===1/0?A(z):A(u,!1)})}l(We),v(te,We)},Te=te=>{var ye=nt(),Ge=Oe(ye);{var We=z=>{const u=rt(()=>(e(F),i(()=>oe(e(F)))));var A=xl(),H=r(A);xe(H);var E=a(H,2),m=r(E);l(E);var re=a(E,2),He=r(re,!0);l(re),l(A),I(()=>{$a(H,e(Ne)&&e(ve)!==void 0?e(ve):e(u)),at(H,"max",e(u)),x(m,`/ ${e(u)??""}`),x(He,(e(F),i(()=>e(F).resetOn==="short"?"Short Rest":"Long Rest")))}),j("input",H,fe=>{Y.update(Me=>(Me.classFeatures.features[e(Q)]=parseInt(fe.currentTarget.value)||0,Me))}),j("click",re,()=>Ce(e(Q),e(u))),v(z,A)},D=z=>{var u=nt(),A=Oe(u);{var H=E=>{var m=$l(),re=r(m),He=a(re,2),fe=r(He),Me=r(fe);l(fe),l(He);var p=a(He,2);{var B=y=>{var je=Sl();v(y,je)};C(p,y=>{e(O)<=0&&y(B)})}l(m),I(()=>{re.disabled=e(O)<=0,x(Me,`Resets on ${e(F),i(()=>e(F).resetOn==="short"?"Short Rest":"Long Rest")??""}`)}),j("click",re,q),v(E,m)};C(A,E=>{e(F),i(()=>e(F).type==="channelDivinity")&&E(H)},!0)}v(z,u)};C(Ge,z=>{e(F),i(()=>e(F).type==="pool")?z(We):z(D,!1)},!0)}v(te,ye)};C(ze,te=>{e(F),i(()=>e(F).type==="uses")?te(Xe):te(Te,!1)})}l(we),I(te=>{x(Se,` ${e(F),i(()=>e(F).name)??""}`),x(Ee,te)},[()=>(e(F),i(()=>W(e(F))))]),v(T,we)}),l(Pe),v(g,Pe)};C(pe,g=>{e(M),i(()=>e(M).length===0)?g(qe):g(Le,!1)},!0)}v(X,_e)};C(w,X=>{t(),i(()=>!t().class)?X(J):X(V,!1)})}v(b,d)};C(ee,b=>{S(),i(()=>!S().classFeatures)&&b(me)})}l(ce),I(()=>{Z=ut(ce,1,"class-features svelte-1kpvv0n",null,Z,{hidden:!e(ne)}),at($,"aria-label",(S(),i(()=>S().classFeatures?"Expand":"Collapse"))),x(le,(S(),i(()=>S().classFeatures?"â–¼":"â–²")))}),j("click",$,se),v(s,ce),xt(),N()}var jl=f('<textarea placeholder="Enter features, traits, and special abilities..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Equipment</h3> <textarea placeholder="List your equipment and inventory..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Notes</h3> <textarea placeholder="Additional notes..." class="svelte-wttn0l"></textarea>',1),Fl=f('<section><div class="header svelte-wttn0l"><h2 class="svelte-wttn0l">Features & Traits</h2> <button class="collapse-btn svelte-wttn0l"> </button></div> <!></section>');function Al(s,n){kt(n,!1);const t=()=>Ke(Rt,"$searchFilter",S),c=()=>Ke(Y,"$character",S),h=()=>Ke(gt,"$collapsedStates",S),[S,L]=Lt(),N=R();function _(){gt.update(de=>({...de,notes:!de.notes}))}et(()=>(t(),c()),()=>{o(N,!t()||"features".includes(t().toLowerCase())||"traits".includes(t().toLowerCase())||"equipment".includes(t().toLowerCase())||"notes".includes(t().toLowerCase())||c().features.toLowerCase().includes(t().toLowerCase())||c().equipment.toLowerCase().includes(t().toLowerCase())||c().notes.toLowerCase().includes(t().toLowerCase()))}),jt(),yt();var M=Fl();let ie;var K=r(M),O=a(r(K),2),Re=r(O,!0);l(O),l(K);var ne=a(K,2);{var ge=de=>{var Ce=jl(),P=Oe(Ce);Kt(P);var he=a(P,4);Kt(he);var ue=a(he,4);Kt(ue),Ae(P,()=>c().features,oe=>tt(Y,i(c).features=oe,i(c))),Ae(he,()=>c().equipment,oe=>tt(Y,i(c).equipment=oe,i(c))),Ae(ue,()=>c().notes,oe=>tt(Y,i(c).notes=oe,i(c))),v(de,Ce)};C(ne,de=>{h(),i(()=>!h().notes)&&de(ge)})}l(M),I(()=>{ie=ut(M,1,"notes svelte-wttn0l",null,ie,{hidden:!e(N)}),at(O,"aria-label",(h(),i(()=>h().notes?"Expand":"Collapse"))),x(Re,(h(),i(()=>h().notes?"â–¼":"â–²")))}),j("click",O,_),v(s,M),xt(),L()}var Rl=f('<div class="color-picker-section svelte-1r90jgp"><h3 class="svelte-1r90jgp">Dice Colors</h3> <div class="color-inputs svelte-1r90jgp"><div class="color-input-group svelte-1r90jgp"><label for="dice-color" class="svelte-1r90jgp">Dice Color</label> <input type="color" id="dice-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="label-color" class="svelte-1r90jgp">Label Color</label> <input type="color" id="label-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="desk-color" class="svelte-1r90jgp">Background Color</label> <input type="color" id="desk-color" class="svelte-1r90jgp"/></div></div></div>'),Il=f('<div class="loading svelte-1r90jgp"><p class="svelte-1r90jgp">Loading 3D dice...</p></div>'),Ml=f('<div class="custom-dice-selector svelte-1r90jgp"><h3 class="svelte-1r90jgp">Choose Dice to Roll</h3> <div class="dice-inputs svelte-1r90jgp"><div class="dice-input-group svelte-1r90jgp"><label for="d4" class="svelte-1r90jgp">d4</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d4" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d6" class="svelte-1r90jgp">d6</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d6" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d8" class="svelte-1r90jgp">d8</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d8" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d10" class="svelte-1r90jgp">d10</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d10" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d12" class="svelte-1r90jgp">d12</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d12" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d20" class="svelte-1r90jgp">d20</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d20" min="0" max="10"/></div></div> <div class="dice-controls svelte-1r90jgp"><button class="btn btn-primary use-enabled svelte-1r90jgp"> </button> <button class="btn btn-secondary use-enabled svelte-1r90jgp">Reset</button></div></div>'),Pl=f('<span class="crit-badge svelte-1r90jgp">CRITICAL!</span>'),El=f('<p class="svelte-1r90jgp"> </p>'),Tl=f('<p class="modifier-text svelte-1r90jgp"> </p>'),Hl=f('<button class="btn btn-follow-up svelte-1r90jgp"> </button>'),Ul=f('<button class="btn btn-guided-strike svelte-1r90jgp">âš¡ Use Guided Strike (+10)</button>'),Bl=f('<div class="follow-up-actions svelte-1r90jgp"><!> <!></div>'),Nl=f('<div class="result-header svelte-1r90jgp"><h3 class="svelte-1r90jgp"> </h3> <!></div> <div class="result-total svelte-1r90jgp"> </div> <div class="result-details svelte-1r90jgp"><!> <!></div> <!>',1),Gl=f('<div role="button" tabindex="-1"><div class="modal-content svelte-1r90jgp" role="dialog" tabindex="0"><div class="modal-header svelte-1r90jgp"><h2 class="svelte-1r90jgp">Dice Roller</h2> <div class="header-buttons svelte-1r90jgp"><button class="color-btn svelte-1r90jgp" title="Customize dice colors">ðŸŽ¨</button> <button class="close-btn svelte-1r90jgp">Ã—</button></div></div> <!> <!> <div class="dice-main-area svelte-1r90jgp"><div class="dice-container svelte-1r90jgp"></div> <!></div> <div><!></div></div></div>');function Ol(s,n){kt(n,!1);const t=()=>Ke(Y,"$character",c),[c,h]=Lt(),S=R(),L=R(),N=R(),_=Gt();let M=Et(n,"notation",12,""),ie=Et(n,"visible",8,!1),K=Et(n,"damageNotation",12,""),O=Et(n,"attackName",12,""),Re=Et(n,"applyHalfDamage",8,!1),ne=null,ge=R(void 0),de=R(!1),Ce=R(""),P=R(null);function he(){return e(P)?.resultTotal??null}let ue=R(0),oe=R(0),W=R(0),q=R(0),se=R(0),ce=R(0),Z=R(0),Ie=R([]),$=R(!1),le=R("other"),ee=R(!1),me=R("#051e0a"),b=R("#ffffff"),d=R("#3a2004"),w=R(!1);function J(u){return u.length===9&&u.startsWith("#")?u.substring(0,7):u}function V(u,A="ff"){return u.length===7&&u.startsWith("#")?u+A:u}function X(){if(window.DICE&&e(ge))try{ne&&e(ge)&&Ua(ge,e(ge).innerHTML="");const u=e(ge).clientWidth||500,A=e(ge).clientHeight||300;ne=new window.DICE.dice_box(e(ge),{w:u,h:A}),o(de,!0)}catch(u){console.error("Error initializing dice box:",u)}}Qt(()=>{const u=E=>new Promise((m,re)=>{if(document.querySelector(`script[src="${E}"]`)){console.log(`Script already loaded: ${E}`),m(null);return}const fe=document.createElement("script");fe.src=E,fe.onload=()=>{console.log(`Loaded: ${E}`),m(null)},fe.onerror=()=>{console.error(`Failed to load: ${E}`),re(new Error(`Failed to load ${E}`))},document.head.appendChild(fe)});setTimeout(()=>{u(`${Wt}/libs/three.min.js`).then(()=>u(`${Wt}/libs/cannon.min.js`)).then(()=>u(`${Wt}/libs/teal.js`)).then(()=>u(`${Wt}/dice.js`)).then(()=>{if(console.log("All scripts loaded, initializing dice box..."),console.log("DICE available:",!!window.DICE),console.log("Container available:",!!e(ge)),window.DICE){const E=window.DICE.getColors();o(me,J(E.dice_color)),o(b,J(E.label_color)),o(d,J(E.desk_color))}X()}).catch(E=>{console.error("Failed to load dice libraries:",E)})},100);const A=()=>{e(de)&&(console.log("Window resized, reinitializing dice box..."),X())},H=E=>{ie()&&E.key==="Escape"&&Ze()};return window.addEventListener("resize",A),window.addEventListener("keydown",H),()=>{window.removeEventListener("resize",A),window.removeEventListener("keydown",H)}});function _e(u,A="other"){if(!ne||!e(de))return;console.log("Rolling dice:",u,"type:",A),o(le,A),o(ee,!1),ne.diceToRoll=u;const H=m=>(console.log("Before roll:",m),null),E=m=>{console.log("After roll:",m);let re=m.resultTotal,He=m.resultString;if(Re()&&(re=Math.floor(re/2),He=He+" (halved)"),o(P,{...m,resultTotal:re,resultString:He}),A==="attack"||A==="check"||A==="save"){const fe=m.results?.filter(Me=>Me.sides===20)||[];if(fe.length>0){const Me=fe[0].value;o($,Me===20)}}if(o(Ie,[]),A==="attack"&&K())if(e($)){const fe=Le(K());e(Ie).push({label:`Roll Critical Damage (${fe})`,notation:fe})}else e(Ie).push({label:`Roll Damage (${K()})`,notation:K()})};ne.start_throw(H,E)}function pe(){const u=[];e(ue)>0&&u.push(`${e(ue)}d4`),e(oe)>0&&u.push(`${e(oe)}d6`),e(W)>0&&u.push(`${e(W)}d8`),e(q)>0&&u.push(`${e(q)}d10`),e(se)>0&&u.push(`${e(se)}d12`),e(ce)>0&&u.push(`${e(ce)}d20`);let A=u.join("+")||"1d20";return e(Z)!==0&&(A+=e(Z)>=0?`+${e(Z)}`:`${e(Z)}`),A}function qe(){const u=pe();_e(u)}function Le(u){return u.replace(/(\d+)d(\d+)/g,(A,H,E)=>`${parseInt(H)*2}d${E}`)}function g(){o(ue,0),o(oe,0),o(W,0),o(q,0),o(se,0),o(ce,0),o(Z,0),o(P,null),o(Ie,[]),o($,!1),o(le,"other"),o(ee,!1)}function Pe(){window.DICE&&(window.DICE.setColors({dice_color:V(e(me),"ff"),label_color:V(e(b),"ff"),desk_color:e(d)}),ne&&(ne.updateDeskColor(e(d)),ne.updateDiceColors()))}function Je(){o(w,!e(w))}function Ve(){!e(P)||e(L)<=0||e(ee)||(o(P,{...e(P),resultTotal:e(P).resultTotal+10,resultString:e(P).resultString+" + 10 (Guided Strike)"}),Y.update(u=>{const A="ChannelDivinity",H=u.classFeatures.features[A];return typeof H=="number"&&H>0&&(u.classFeatures.features[A]=H-1),u}),o(ee,!0))}function Ze(){_("close"),M(""),K(""),O(""),o(Ce,""),o(P,null),o(ee,!1),g()}et(()=>(t(),Nt),()=>{o(S,t().class?Nt(t().class,t().level,t().subclass).some(A=>A.name==="Guided Strike"):!1)}),et(()=>t(),()=>{o(L,(()=>{const A=t().classFeatures.features["ChannelDivinity"];return typeof A=="number"?A:0})())}),et(()=>(e(ue),e(oe),e(W),e(q),e(se),e(ce),e(Z)),()=>{o(N,(()=>{const u=[];e(ue)>0&&u.push(`${e(ue)}d4`),e(oe)>0&&u.push(`${e(oe)}d6`),e(W)>0&&u.push(`${e(W)}d8`),e(q)>0&&u.push(`${e(q)}d10`),e(se)>0&&u.push(`${e(se)}d12`),e(ce)>0&&u.push(`${e(ce)}d20`);let A=u.join("+")||"1d20";return e(Z)!==0&&(A+=e(Z)>=0?`+${e(Z)}`:`${e(Z)}`),A})())}),et(()=>(U(M()),e(de),U(ie()),e(Ce),U(K()),U(O())),()=>{if(M()&&e(de)&&ie()&&M()!==e(Ce)){o(Ce,M()),o(P,null),o(Ie,[]),o($,!1),o(ee,!1);const u=M().includes("1d20")?"attack":"other";console.log("Auto-roll triggered. notation:",M(),"damageNotation:",K(),"attackName:",O()),setTimeout(()=>_e(M(),u),200)}}),jt();var T={getLastRollTotal:he};yt();var F=Gl();let Q;var ve=r(F),Ne=r(ve),we=a(r(Ne),2),G=r(we),ae=a(G,2);l(we),l(Ne);var k=a(Ne,2);{var Se=u=>{var A=Rl(),H=a(r(A),2),E=r(H),m=a(r(E),2);xe(m),l(E);var re=a(E,2),He=a(r(re),2);xe(He),l(re);var fe=a(re,2),Me=a(r(fe),2);xe(Me),l(fe),l(H),l(A),Ae(m,()=>e(me),p=>o(me,p)),j("change",m,Pe),Ae(He,()=>e(b),p=>o(b,p)),j("change",He,Pe),Ae(Me,()=>e(d),p=>o(d,p)),j("change",Me,Pe),v(u,A)};C(k,u=>{e(w)&&u(Se)})}var $e=a(k,2);{var Ee=u=>{var A=Il();v(u,A)};C($e,u=>{e(de)||u(Ee)})}var ze=a($e,2),Xe=r(ze);_a(Xe,u=>o(ge,u),()=>e(ge));var Te=a(Xe,2);{var te=u=>{var A=Ml(),H=a(r(A),2),E=r(H),m=a(r(E),2);xe(m),l(E);var re=a(E,2),He=a(r(re),2);xe(He),l(re);var fe=a(re,2),Me=a(r(fe),2);xe(Me),l(fe);var p=a(fe,2),B=a(r(p),2);xe(B),l(p);var y=a(p,2),je=a(r(y),2);xe(je),l(y);var Ue=a(y,2),Qe=a(r(Ue),2);xe(Qe),l(Ue),l(H);var De=a(H,2),Be=r(De),Fe=r(Be);l(Be);var be=a(Be,2);l(De),l(A),I(()=>{Be.disabled=!e(de),x(Fe,`Roll ${e(N)??""}`)}),Ae(m,()=>e(ue),ke=>o(ue,ke)),Ae(He,()=>e(oe),ke=>o(oe,ke)),Ae(Me,()=>e(W),ke=>o(W,ke)),Ae(B,()=>e(q),ke=>o(q,ke)),Ae(je,()=>e(se),ke=>o(se,ke)),Ae(Qe,()=>e(ce),ke=>o(ce,ke)),j("click",Be,qe),j("click",be,g),v(u,A)};C(Te,u=>{M()||u(te)})}l(ze);var ye=a(ze,2);let Ge;var We=r(ye);{var D=u=>{var A=Nl(),H=Oe(A),E=r(H),m=r(E,!0);l(E);var re=a(E,2);{var He=Be=>{var Fe=Pl();v(Be,Fe)};C(re,Be=>{e($)&&Be(He)})}l(H);var fe=a(H,2),Me=r(fe,!0);l(fe);var p=a(fe,2),B=r(p);{var y=Be=>{var Fe=El(),be=r(Fe,!0);l(Fe),I(()=>x(be,(e(P),i(()=>e(P).resultString)))),v(Be,Fe)};C(B,Be=>{e(P),i(()=>e(P).resultString)&&Be(y)})}var je=a(B,2);{var Ue=Be=>{var Fe=Tl(),be=r(Fe);l(Fe),I(()=>x(be,`Modifier: ${e(P),i(()=>e(P).constant>=0?"+":"")??""}${e(P),i(()=>e(P).constant)??""}`)),v(Be,Fe)};C(je,Be=>{e(P),i(()=>e(P).constant)&&Be(Ue)})}l(p);var Qe=a(p,2);{var De=Be=>{var Fe=Bl(),be=r(Fe);ct(be,1,()=>e(Ie),dt,(it,st)=>{var pt=Hl(),Mt=r(pt,!0);l(pt),I(()=>x(Mt,(e(st),i(()=>e(st).label)))),j("click",pt,()=>_e(e(st).notation,"damage")),v(it,pt)});var ke=a(be,2);{var It=it=>{var st=Ul();I(()=>{st.disabled=e(L)<=0,at(st,"title",e(L)<=0?"No Channel Divinity uses remaining":"Use Channel Divinity to add +10 to this attack roll")}),j("click",st,Ve),v(it,st)};C(ke,it=>{e(S)&&e(le)==="attack"&&!e(ee)&&it(It)})}l(Fe),v(Be,Fe)};C(Qe,Be=>{e(Ie),e(S),e(le),e(ee),i(()=>e(Ie).length>0||e(S)&&e(le)==="attack"&&!e(ee))&&Be(De)})}I(()=>{x(m,O()?`${O()} - Result`:"Result"),x(Me,(e(P),i(()=>e(P).resultTotal)))}),v(u,A)};C(We,u=>{e(P)&&u(D)})}l(ye),l(ve),l(F),I(()=>{Q=ut(F,1,"modal-overlay svelte-1r90jgp",null,Q,{hidden:!ie()}),Ge=ut(ye,1,"roll-result svelte-1r90jgp",null,Ge,{"has-result":e(P)})}),j("click",G,Je),j("click",ae,Ze),j("click",ve,La(function(u){Bt.call(this,n,u)})),j("keydown",ve,function(u){Bt.call(this,n,u)}),j("click",F,Ze),j("keydown",F,u=>u.key==="Escape"&&Ze()),v(s,F),ps(n,"getLastRollTotal",he);var z=xt(T);return h(),z}const oa="https://api.github.com/gists";async function ql(s,n,t){if(!n)throw new Error("GitHub token is required");const c=JSON.stringify(s,null,2),h=`${s.name||"character"}_dnd.json`,S={description:t||`D&D Character: ${s.name}`,public:!1,files:{[h]:{content:c}}},L=await fetch(oa,{method:"POST",headers:{Authorization:`token ${n}`,"Content-Type":"application/json"},body:JSON.stringify(S)});if(!L.ok)throw new Error(`Failed to create gist: ${L.statusText}`);return(await L.json()).id}async function zl(s,n,t){if(!n||!t)throw new Error("GitHub token and Gist ID are required");const c=JSON.stringify(s,null,2),S={files:{[`${s.name||"character"}_dnd.json`]:{content:c}}},L=await fetch(`${oa}/${t}`,{method:"PATCH",headers:{Authorization:`token ${n}`,"Content-Type":"application/json"},body:JSON.stringify(S)});if(!L.ok)throw new Error(`Failed to update gist: ${L.statusText}`)}async function Wl(s,n){if(!s)throw new Error("Gist ID is required");const t={"Content-Type":"application/json"};n&&(t.Authorization=`token ${n}`);const c=await fetch(`${oa}/${s}`,{method:"GET",headers:t});if(!c.ok)throw new Error(`Failed to load gist: ${c.statusText}`);const h=await c.json(),S=Object.values(h.files);if(S.length===0)throw new Error("No files found in gist");const N=S[0].content;try{const _=JSON.parse(N);return _.attacks&&Array.isArray(_.attacks)&&(_.attacks=_.attacks.map(M=>({...M,id:M.id||crypto.randomUUID()}))),_.classFeatures?(_.classFeatures.features||(_.classFeatures.features={}),_.classFeatures.spellSlots||(_.classFeatures.spellSlots=[]),_.classFeatures.preparedSpells===void 0&&(_.classFeatures.preparedSpells="")):_.classFeatures={features:{},spellSlots:[],preparedSpells:""},_}catch{throw new Error("Invalid character data in gist")}}function Ia(s){typeof window<"u"&&localStorage.setItem("dnd_gist_config",JSON.stringify(s))}function Kl(){if(typeof window<"u"){const s=localStorage.getItem("dnd_gist_config");if(s)return JSON.parse(s)}return{}}async function Jl(s,n=30){if(!s)throw new Error("GitHub token is required to list gists");const t=await fetch(`${oa}?per_page=${n}`,{method:"GET",headers:{Authorization:`token ${s}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error(`Failed to list gists: ${t.statusText}`);return await t.json()}var Vl=f('<div class="error-message svelte-1jb5ckg"> </div>'),Ql=f('<div class="toggle-container svelte-1jb5ckg"><button type="button" class="toggle-btn svelte-1jb5ckg"> </button></div>'),Yl=f('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID (leave empty to create new)</label> <input type="text" id="gistId" placeholder="Optional: existing Gist ID to update" class="svelte-1jb5ckg"/></div>'),Xl=f('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),Zl=f('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),er=f('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Update (or leave unselected to create new)</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),tr=f('<div class="info-message svelte-1jb5ckg">No gists found. A new one will be created.</div>'),ar=f('<!> <div class="form-group svelte-1jb5ckg"><label for="description" class="svelte-1jb5ckg"> </label> <input type="text" id="description" placeholder="D&amp;D Character Sheet" class="svelte-1jb5ckg"/></div>',1),sr=f('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID *</label> <input type="text" id="gistId" placeholder="Enter Gist ID (for public or your private gists)" required class="svelte-1jb5ckg"/></div>'),lr=f('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),rr=f('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),ir=f('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Load</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),nr=f('<div class="info-message svelte-1jb5ckg">No gists found. Enter a Gist ID manually or create a new one in Save mode.</div>'),or=f('<div class="modal-overlay svelte-1jb5ckg" role="button" tabindex="-1"><div class="modal-content svelte-1jb5ckg" role="dialog" tabindex="0"><div class="modal-header svelte-1jb5ckg"><h2 class="svelte-1jb5ckg"> </h2> <button class="close-btn svelte-1jb5ckg">Ã—</button></div> <div class="modal-body svelte-1jb5ckg"><!> <div class="form-group svelte-1jb5ckg"><label for="token" class="svelte-1jb5ckg"> <a href="https://github.com/settings/tokens" target="_blank" rel="noopener" class="svelte-1jb5ckg">Get token</a></label> <input type="password" id="token" placeholder="ghp_xxxxxxxxxxxxx" class="svelte-1jb5ckg"/></div> <!> <!> <div class="modal-actions svelte-1jb5ckg"><button class="btn btn-primary svelte-1jb5ckg"><!></button> <button class="btn btn-secondary svelte-1jb5ckg">Cancel</button></div></div></div></div>');function cr(s,n){kt(n,!1);const t=()=>Ke(Y,"$character",c),[c,h]=Lt(),S=Gt();let L=Et(n,"mode",8,"save"),N=R(""),_=R(""),M=R(""),ie=R(!1),K=R(""),O=R(!1),Re=R(!1),ne=R([]),ge=R(null);const de=Kl();de.token&&o(N,de.token),de.gistId&&o(_,de.gistId),Qt(async()=>{e(N)&&!e(O)&&await Ce()});async function Ce(){if(e(N)){o(Re,!0),o(K,"");try{o(ne,await Jl(e(N))),e(_)&&o(ge,e(ne).find(T=>T.id===e(_))||null)}catch(T){o(K,T.message||"Failed to load gists"),o(ne,[])}finally{o(Re,!1)}}}function P(T){o(ge,T),o(_,T.id)}function he(){o(O,!e(O)),o(K,""),!e(O)&&e(N)&&Ce()}async function ue(){if(!e(N)){o(K,"GitHub token is required");return}const T=e(ge)?.id||e(_);o(ie,!0),o(K,"");try{if(T)await zl(t(),e(N),T),o(_,T),Jt.add("Character updated in Gist successfully!","success");else{const F=await ql(t(),e(N),e(M));o(_,F),Jt.add(`Character saved to Gist! ID: ${F}`,"success")}Ia({token:e(N),gistId:e(_)}),S("close")}catch(F){o(K,F.message||"Failed to save to Gist")}finally{o(ie,!1)}}async function oe(){const T=e(ge)?.id||e(_);if(!T){o(K,"Please select a gist or enter a Gist ID");return}o(ie,!0),o(K,"");try{const F=await Wl(T,e(N)||void 0);Y.set(F),o(_,T),Ia({token:e(N),gistId:e(_)}),Jt.add("Character loaded from Gist successfully!","success"),S("close")}catch(F){o(K,F.message||"Failed to load from Gist")}finally{o(ie,!1)}}function W(){S("close")}yt();var q=or(),se=r(q),ce=r(se),Z=r(ce),Ie=r(Z,!0);l(Z);var $=a(Z,2);l(ce);var le=a(ce,2),ee=r(le);{var me=T=>{var F=Vl(),Q=r(F,!0);l(F),I(()=>x(Q,e(K))),v(T,F)};C(ee,T=>{e(K)&&T(me)})}var b=a(ee,2),d=r(b),w=r(d);Ba(),l(d);var J=a(d,2);xe(J),l(b);var V=a(b,2);{var X=T=>{var F=Ql(),Q=r(F),ve=r(Q,!0);l(Q),l(F),I(()=>{Q.disabled=e(ie),x(ve,e(O)?"ðŸ“‹ Show My Gists":"âœï¸ Enter Gist ID Manually")}),j("click",Q,he),v(T,F)};C(V,T=>{(L()==="load"||L()==="save"&&e(N))&&T(X)})}var _e=a(V,2);{var pe=T=>{var F=ar(),Q=Oe(F);{var ve=Se=>{var $e=Yl(),Ee=a(r($e),2);xe(Ee),l($e),I(()=>Ee.disabled=e(ie)),Ae(Ee,()=>e(_),ze=>o(_,ze)),v(Se,$e)},Ne=Se=>{var $e=nt(),Ee=Oe($e);{var ze=Te=>{var te=Xl();v(Te,te)},Xe=Te=>{var te=nt(),ye=Oe(te);{var Ge=D=>{var z=er(),u=a(r(z),2);ct(u,5,()=>e(ne),dt,(A,H)=>{var E=Zl();let m;var re=r(E),He=r(re),fe=r(He,!0);l(He);var Me=a(He,2),p=r(Me,!0);l(Me),l(re);var B=a(re,2),y=r(B),je=r(y);l(y);var Ue=a(y,2),Qe=r(Ue);l(Ue),l(B),l(E),I(De=>{m=ut(E,1,"gist-item svelte-1jb5ckg",null,m,{selected:e(ge)?.id===e(H).id}),E.disabled=e(ie),x(fe,(e(H),i(()=>e(H).description||"Untitled"))),x(p,(e(H),i(()=>e(H).public?"ðŸŒ Public":"ðŸ”’ Private"))),x(je,`ID: ${e(H),i(()=>e(H).id)??""}`),x(Qe,`Updated: ${De??""}`)},[()=>(e(H),i(()=>new Date(e(H).updated_at).toLocaleDateString()))]),j("click",E,()=>P(e(H))),v(A,E)}),l(u),l(z),v(D,z)},We=D=>{var z=nt(),u=Oe(z);{var A=H=>{var E=tr();v(H,E)};C(u,H=>{e(N)&&H(A)},!0)}v(D,z)};C(ye,D=>{e(ne),i(()=>e(ne).length>0)?D(Ge):D(We,!1)},!0)}v(Te,te)};C(Ee,Te=>{e(Re)?Te(ze):Te(Xe,!1)},!0)}v(Se,$e)};C(Q,Se=>{e(O)||!e(N)?Se(ve):Se(Ne,!1)})}var we=a(Q,2),G=r(we),ae=r(G);l(G);var k=a(G,2);xe(k),l(we),I(()=>{x(ae,`Description ${e(_)?"(optional)":""}`),k.disabled=e(ie)}),Ae(k,()=>e(M),Se=>o(M,Se)),v(T,F)},qe=T=>{var F=nt(),Q=Oe(F);{var ve=we=>{var G=sr(),ae=a(r(G),2);xe(ae),l(G),I(()=>ae.disabled=e(ie)),Ae(ae,()=>e(_),k=>o(_,k)),v(we,G)},Ne=we=>{var G=nt(),ae=Oe(G);{var k=$e=>{var Ee=lr();v($e,Ee)},Se=$e=>{var Ee=nt(),ze=Oe(Ee);{var Xe=te=>{var ye=ir(),Ge=a(r(ye),2);ct(Ge,5,()=>e(ne),dt,(We,D)=>{var z=rr();let u;var A=r(z),H=r(A),E=r(H,!0);l(H);var m=a(H,2),re=r(m,!0);l(m),l(A);var He=a(A,2),fe=r(He),Me=r(fe);l(fe);var p=a(fe,2),B=r(p);l(p),l(He),l(z),I(y=>{u=ut(z,1,"gist-item svelte-1jb5ckg",null,u,{selected:e(ge)?.id===e(D).id}),z.disabled=e(ie),x(E,(e(D),i(()=>e(D).description||"Untitled"))),x(re,(e(D),i(()=>e(D).public?"ðŸŒ Public":"ðŸ”’ Private"))),x(Me,`ID: ${e(D),i(()=>e(D).id)??""}`),x(B,`Updated: ${y??""}`)},[()=>(e(D),i(()=>new Date(e(D).updated_at).toLocaleDateString()))]),j("click",z,()=>P(e(D))),v(We,z)}),l(Ge),l(ye),v(te,ye)},Te=te=>{var ye=nt(),Ge=Oe(ye);{var We=D=>{var z=nr();v(D,z)};C(Ge,D=>{e(N)&&D(We)},!0)}v(te,ye)};C(ze,te=>{e(ne),i(()=>e(ne).length>0)?te(Xe):te(Te,!1)},!0)}v($e,Ee)};C(ae,$e=>{e(Re)?$e(k):$e(Se,!1)},!0)}v(we,G)};C(Q,we=>{e(O)||!e(N)?we(ve):we(Ne,!1)})}v(T,F)};C(_e,T=>{L()==="save"?T(pe):T(qe,!1)})}var Le=a(_e,2),g=r(Le),Pe=r(g);{var Je=T=>{var F=bt();I(()=>x(F,L()==="save"?"Saving...":"Loading...")),v(T,F)},Ve=T=>{var F=bt();I(()=>x(F,L()==="save"?"Save":"Load")),v(T,F)};C(Pe,T=>{e(ie)?T(Je):T(Ve,!1)})}l(g);var Ze=a(g,2);l(Le),l(le),l(se),l(q),I(()=>{x(Ie,L()==="save"?"Save to GitHub Gist":"Load from GitHub Gist"),x(w,`GitHub Token ${L()==="load"?"(optional for public gists)":"(required)"} `),J.disabled=e(ie),g.disabled=e(ie),Ze.disabled=e(ie)}),j("click",$,W),Ae(J,()=>e(N),T=>o(N,T)),j("blur",J,()=>{e(N)&&!e(O)&&Ce()}),j("click",g,function(...T){(L()==="save"?ue:oe)?.apply(this,T)}),j("click",Ze,W),j("click",se,La(function(T){Bt.call(this,n,T)})),j("keydown",se,function(T){Bt.call(this,n,T)}),j("click",q,W),j("keydown",q,T=>T.key==="Escape"&&W()),v(s,q),xt(),h()}var vr=f('<div class="loading svelte-1ngjemu">Loading D&D data...</div>'),dr=f("<option> </option>"),ur=f('<select class="level-filter svelte-1ngjemu"><option>All Levels</option><option>Cantrip</option><!></select>'),pr=f('<div class="no-results svelte-1ngjemu"> </div>'),fr=f('<div class="item-meta svelte-1ngjemu"> </div>'),br=f('<div class="item-meta svelte-1ngjemu"> </div>'),gr=f('<button><div class="item-name svelte-1ngjemu"> </div> <!></button>'),hr=f('<p class="higher-levels"><strong>At Higher Levels:</strong> </p>'),mr=f('<p class="cantrip-upgrade"><strong>Cantrip Upgrade:</strong> </p>'),_r=f('<h3 class="svelte-1ngjemu"> </h3> <p class="spell-meta svelte-1ngjemu"><!> <!></p> <p class="spell-classes"><strong>Classes:</strong> </p> <div class="spell-stats svelte-1ngjemu"><div><strong>Casting Time:</strong> </div> <div><strong>Range:</strong> </div> <div><strong>Components:</strong> <!></div> <div><strong>Duration:</strong> <!> </div></div> <p class="description svelte-1ngjemu"> </p> <!> <!>',1),yr=f('<p class="prerequisite svelte-1ngjemu"><strong>Prerequisite:</strong> </p>'),kr=f('<h3 class="svelte-1ngjemu"> </h3> <!> <p class="description svelte-1ngjemu"> </p> <a target="_blank" rel="noopener" class="source-link svelte-1ngjemu">View Full Details â†’</a>',1),xr=f('<div class="item-details svelte-1ngjemu"><!></div>'),Sr=f('<div class="controls svelte-1ngjemu"><div class="tabs svelte-1ngjemu"><button> </button> <button> </button></div> <div class="search-controls svelte-1ngjemu"><input type="text" placeholder="Search by name or description..." class="search-input svelte-1ngjemu"/> <!></div></div> <div class="content-container svelte-1ngjemu"><div class="items-list svelte-1ngjemu"><!></div> <!></div>',1),$r=f('<div class="modal-backdrop svelte-1ngjemu" role="presentation"><div class="modal svelte-1ngjemu" role="dialog" aria-modal="true" tabindex="-1"><div class="modal-header svelte-1ngjemu"><h2 class="svelte-1ngjemu">Browse D&D Spells & Feats</h2> <button class="close-btn svelte-1ngjemu" aria-label="Close">&times;</button></div> <div class="modal-body svelte-1ngjemu"><!></div> <div class="modal-footer svelte-1ngjemu"><button class="btn-secondary svelte-1ngjemu">Cancel</button> <button class="btn-primary svelte-1ngjemu">Add to Character Sheet</button></div></div></div>');function Cr(s,n){kt(n,!1);const t=R(),c=R(),h=R();let S=Et(n,"onClose",8),L=R("spell"),N=R(!0),_=R(""),M=R(null),ie=R([]),K=R([]),O=R(null);Qt(async()=>{o(N,!0);try{o(ie,await qa()),o(K,await Es())}catch($){console.error("Failed to load data:",$)}finally{o(N,!1)}});function Re($){o(O,$)}function ne($){const le=$.match(/(\d+d\d+(?:\s*\+\s*\d+)?)/i);return le?le[1]:""}function ge($){const le=$.split(/\.( |$)/)[0].trim(),ee=Array.from($.matchAll(/\*\*(.*?)\*\*/g)).map(b=>b[1].replace(/\.$/,""));let me=le;return ee.length&&(me+=" | Effects: "+ee.join(", ")),me}function de(){if(e(O)){if(e(L)==="spell"){const $=e(O);Y.update(le=>{const me=[];$.range&&me.push(`Range: ${$.range}`),$.castingTime&&me.push(`Cast: ${$.castingTime}`),$.duration&&me.push(`Duration: ${$.duration}`),$.actionType==="Save"&&me.push("Saving throw spell"),$.components&&$.components.length>0&&me.push(`Components: ${$.components.join(", ")}`),$.material&&me.push(`Material: ${$.material}`);const b=me.join(" | "),d=ge($.description),w={id:crypto.randomUUID(),name:`${$.name}${$.concentration?" (C)":""}${$.ritual?" (R)":""}`,bonus:$.actionType==="Attack"?5:0,damage:ne($.description),damageType:`${$.school} (Lvl ${$.level})`,spellRef:$.name,infoNotes:b,generalNotes:d,castAtLevel:$.level};return le.attacks=[...le.attacks,w],le})}else if(e(L)==="feat"){const $=e(O);Y.update(le=>{const ee=`${$.name}${$.prerequisite?` (Req: ${$.prerequisite})`:""}
${$.description}
`;return le.features=le.features?`${le.features}
${ee}`:ee,le})}o(O,null),S()()}}et(()=>(e(M),e(ie),e(_)),()=>{o(t,e(M)!==null?Ts(Ra(e(ie),e(_)),e(M)):Ra(e(ie),e(_)))}),et(()=>(e(K),e(_)),()=>{o(c,Hs(e(K),e(_)))}),et(()=>(e(L),e(t),e(c)),()=>{o(h,e(L)==="spell"?e(t):e(c))}),jt(),yt();var Ce=$r(),P=r(Ce),he=r(P),ue=a(r(he),2);l(he);var oe=a(he,2),W=r(oe);{var q=$=>{var le=vr();v($,le)},se=$=>{var le=Sr(),ee=Oe(le),me=r(ee),b=r(me);let d;var w=r(b);l(b);var J=a(b,2);let V;var X=r(J);l(J),l(me);var _e=a(me,2),pe=r(_e);xe(pe);var qe=a(pe,2);{var Le=Q=>{var ve=ur();I(()=>{e(M),Ct(()=>{})});var Ne=r(ve);Ne.value=(Ne.__value=null)??"";var we=a(Ne);we.value=we.__value=0;var G=a(we);ct(G,0,()=>[1,2,3,4,5,6,7,8,9],dt,(ae,k)=>{var Se=dr(),$e=r(Se);l(Se);var Ee={};I(()=>{x($e,`Level ${k??""}`),Ee!==(Ee=k)&&(Se.value=(Se.__value=k)??"")}),v(ae,Se)}),l(ve),Ga(ve,()=>e(M),ae=>o(M,ae)),v(Q,ve)};C(qe,Q=>{e(L)==="spell"&&Q(Le)})}l(_e),l(ee);var g=a(ee,2),Pe=r(g),Je=r(Pe);{var Ve=Q=>{var ve=pr(),Ne=r(ve);l(ve),I(()=>x(Ne,`No ${e(L)??""}s found`)),v(Q,ve)},Ze=Q=>{var ve=nt(),Ne=Oe(ve);ct(Ne,1,()=>e(h),dt,(we,G)=>{var ae=gr();let k;var Se=r(ae),$e=r(Se,!0);l(Se);var Ee=a(Se,2);{var ze=Te=>{const te=rt(()=>e(G));var ye=fr(),Ge=r(ye);l(ye),I(()=>x(Ge,`Level ${U(e(te)),i(()=>e(te).level)??""} â€¢ ${U(e(te)),i(()=>e(te).school)??""}`)),v(Te,ye)},Xe=Te=>{const te=rt(()=>e(G));var ye=nt(),Ge=Oe(ye);{var We=D=>{var z=br(),u=r(z,!0);l(z),I(()=>x(u,(U(e(te)),i(()=>e(te).prerequisite)))),v(D,z)};C(Ge,D=>{U(e(te)),i(()=>e(te).prerequisite)&&D(We)})}v(Te,ye)};C(Ee,Te=>{e(L)==="spell"?Te(ze):Te(Xe,!1)})}l(ae),I(()=>{k=ut(ae,1,"item-card svelte-1ngjemu",null,k,{selected:e(O)?.name===e(G).name}),x($e,(e(G),i(()=>e(G).name)))}),j("click",ae,()=>Re(e(G))),v(we,ae)}),v(Q,ve)};C(Je,Q=>{e(h),i(()=>e(h).length===0)?Q(Ve):Q(Ze,!1)})}l(Pe);var T=a(Pe,2);{var F=Q=>{var ve=xr(),Ne=r(ve);{var we=ae=>{const k=rt(()=>e(O));var Se=_r(),$e=Oe(Se),Ee=r($e,!0);l($e);var ze=a($e,2),Xe=r(ze);{var Te=be=>{var ke=bt();I(()=>x(ke,`${U(e(k)),i(()=>e(k).school)??""} cantrip`)),v(be,ke)},te=be=>{var ke=bt();I(()=>x(ke,`Level ${U(e(k)),i(()=>e(k).level)??""} ${U(e(k)),i(()=>e(k).school)??""}`)),v(be,ke)};C(Xe,be=>{U(e(k)),i(()=>e(k).level===0)?be(Te):be(te,!1)})}var ye=a(Xe,2);{var Ge=be=>{var ke=bt("(ritual)");v(be,ke)};C(ye,be=>{U(e(k)),i(()=>e(k).ritual)&&be(Ge)})}l(ze);var We=a(ze,2),D=a(r(We));l(We);var z=a(We,2),u=r(z),A=a(r(u));l(u);var H=a(u,2),E=a(r(H));l(H);var m=a(H,2),re=a(r(m)),He=a(re);{var fe=be=>{var ke=bt();I(()=>x(ke,`(${U(e(k)),i(()=>e(k).material)??""})`)),v(be,ke)};C(He,be=>{U(e(k)),i(()=>e(k).material)&&be(fe)})}l(m);var Me=a(m,2),p=a(r(Me),2);{var B=be=>{var ke=bt("Concentration,");v(be,ke)};C(p,be=>{U(e(k)),i(()=>e(k).concentration)&&be(B)})}var y=a(p,1,!0);l(Me),l(z);var je=a(z,2),Ue=r(je,!0);l(je);var Qe=a(je,2);{var De=be=>{var ke=hr(),It=a(r(ke));l(ke),I(()=>x(It,` ${U(e(k)),i(()=>e(k).higherLevelSlot)??""}`)),v(be,ke)};C(Qe,be=>{U(e(k)),i(()=>e(k).higherLevelSlot)&&be(De)})}var Be=a(Qe,2);{var Fe=be=>{var ke=mr(),It=a(r(ke));l(ke),I(()=>x(It,` ${U(e(k)),i(()=>e(k).cantripUpgrade)??""}`)),v(be,ke)};C(Be,be=>{U(e(k)),i(()=>e(k).cantripUpgrade)&&be(Fe)})}I((be,ke)=>{x(Ee,(U(e(k)),i(()=>e(k).name))),x(D,` ${be??""}`),x(A,` ${U(e(k)),i(()=>e(k).castingTime||e(k).actionType)??""}`),x(E,` ${U(e(k)),i(()=>e(k).range)??""}`),x(re,` ${ke??""}`),x(y,(U(e(k)),i(()=>e(k).duration))),x(Ue,(U(e(k)),i(()=>e(k).description)))},[()=>(U(e(k)),i(()=>e(k).classes.join(", "))),()=>(U(e(k)),i(()=>e(k).components.join(", ").toUpperCase()))]),v(ae,Se)},G=ae=>{const k=rt(()=>e(O));var Se=kr(),$e=Oe(Se),Ee=r($e,!0);l($e);var ze=a($e,2);{var Xe=Ge=>{var We=yr(),D=a(r(We));l(We),I(()=>x(D,` ${U(e(k)),i(()=>e(k).prerequisite)??""}`)),v(Ge,We)};C(ze,Ge=>{U(e(k)),i(()=>e(k).prerequisite)&&Ge(Xe)})}var Te=a(ze,2),te=r(Te,!0);l(Te);var ye=a(Te,2);I(()=>{x(Ee,(U(e(k)),i(()=>e(k).name))),x(te,(U(e(k)),i(()=>e(k).description))),at(ye,"href",(U(e(k)),i(()=>e(k).source)))}),v(ae,Se)};C(Ne,ae=>{e(L)==="spell"?ae(we):ae(G,!1)})}l(ve),v(Q,ve)};C(T,Q=>{e(O)&&Q(F)})}l(g),I(()=>{d=ut(b,1,"tab svelte-1ngjemu",null,d,{active:e(L)==="spell"}),x(w,`ðŸ“œ Spells (${e(ie),i(()=>e(ie).length)??""})`),V=ut(J,1,"tab svelte-1ngjemu",null,V,{active:e(L)==="feat"}),x(X,`â­ Feats (${e(K),i(()=>e(K).length)??""})`)}),j("click",b,()=>{o(L,"spell"),o(O,null),o(_,"")}),j("click",J,()=>{o(L,"feat"),o(O,null),o(_,"")}),Ae(pe,()=>e(_),Q=>o(_,Q)),v($,le)};C(W,$=>{e(N)?$(q):$(se,!1)})}l(oe);var ce=a(oe,2),Z=r(ce),Ie=a(Z,2);l(ce),l(P),l(Ce),I(()=>Ie.disabled=!e(O)),j("click",ue,function(...$){S()?.apply(this,$)}),j("click",Z,function(...$){S()?.apply(this,$)}),j("click",Ie,de),j("click",P,La(function($){Bt.call(this,n,$)})),j("keydown",P,function($){Bt.call(this,n,$)}),j("click",Ce,function(...$){S()?.apply(this,$)}),j("keydown",Ce,$=>$.key==="Escape"&&S()()),v(s,Ce),xt()}var Lr=f('<link rel="icon" type="image/png" href="favicon4.png"/> <meta name="viewport" content="width=device-width, initial-scale=1"/>',1),Dr=f('<span class="character-name svelte-1uha8ag"> </span>'),wr=f("<span> </span>"),jr=f('<div class="spell-slots-header svelte-1uha8ag"></div>'),Fr=f('<div class="rest-menu svelte-1uha8ag"><button class="rest-option svelte-1uha8ag">â˜• Short Rest</button> <button class="rest-option svelte-1uha8ag">ðŸ›ï¸ Long Rest</button></div>'),Ar=f('<div class="container svelte-1uha8ag"><header class="svelte-1uha8ag"><div class="header-top svelte-1uha8ag"><div class="header-title svelte-1uha8ag"><div class="title-row svelte-1uha8ag"><h1 class="svelte-1uha8ag">D&D Character Sheet</h1> <!></div> <!></div> <div class="header-right svelte-1uha8ag"><div class="header-controls svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">ðŸŽ²</span><span class="btn-text svelte-1uha8ag">Roll Dice</span></button> <div class="rest-button-container svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">ðŸ˜´</span><span class="btn-text svelte-1uha8ag">Rest</span></button> <!></div> <div class="mode-toggle"><button><span class="btn-icon svelte-1uha8ag"> </span><span class="btn-text svelte-1uha8ag"> </span></button></div></div> <div class="header-search svelte-1uha8ag"><input type="text" placeholder="ðŸ” Search..." class="search-input use-enabled svelte-1uha8ag"/></div></div></div> <div class="header-actions svelte-1uha8ag"><button class="btn btn-mode svelte-1uha8ag">ðŸ“š Browse Spells & Feats</button> <button class="btn btn-secondary">Save to Gist</button> <button class="btn btn-secondary">Load from Gist</button> <button class="btn btn-secondary">Export JSON</button> <button class="btn btn-secondary">Import JSON</button> <input type="file" accept=".json" style="display: none;"/></div></header> <main class="svelte-1uha8ag"><!> <!> <!> <!> <!> <!> <!></main></div> <!> <!> <!> <!>',1);function Br(s,n){kt(n,!1);const t=()=>Ke(Y,"$character",S),c=()=>Ke(la,"$isEditMode",S),h=()=>Ke(Rt,"$searchFilter",S),[S,L]=Lt();function N(){const p=[],B=t().classFeatures.spellSlotsByLevel||{};for(let y=1;y<=9;y++){const je=B[y];if(je&&je.length>0){const Ue=je.length,Qe=je.filter(De=>De).length;p.push({level:y,available:Ue-Qe,total:Ue})}}return p}let _=R(!1),M=R(!1),ie=R(!1),K=R("save"),O=R(void 0),Re=R(""),ne=R(""),ge=R(""),de=R(!1),Ce=R(),P=!1,he=R(!1);function ue(){const p=[];Y.update(y=>{const je=y.hitDice.current;y.hitDice.current=Math.min(y.hitDice.max,y.hitDice.current+Math.max(1,Math.floor(y.hitDice.max/2)));const Ue=y.hitDice.current-je;if(Ue>0&&p.push(`${Ue} hit ${Ue===1?"die":"dice"}`),y.class){const Qe=Nt(y.class,y.level,y.subclass);y.classFeatures.features||(y.classFeatures.features={}),Qe.forEach(De=>{if(De.resetOn==="short"){const Be=De.name.replace(/\s+/g,"");if(De.type==="uses"){const Fe=typeof De.maxUses=="function"?De.maxUses(y.level):De.maxUses;y.classFeatures.features[Be]=Array(Fe).fill(!1),p.push(De.name)}else if(De.type==="pool"){const Fe=typeof De.maxPool=="function"?De.maxPool(y.level):De.maxPool;Fe!==void 0&&(y.classFeatures.features[Be]=Fe,p.push(De.name))}}})}return y}),o(he,!1);const B=p.length>0?`Short rest taken! Restored: ${p.join(", ")}`:"Short rest taken!";Jt.add(B,"success")}function oe(){const p=[];Y.update(y=>{const je=y.maxHP-y.currentHP;je>0&&p.push(`${je} HP`),y.currentHP=y.maxHP,y.tempHP=0;const Ue=y.hitDice.max-y.hitDice.current;Ue>0&&p.push(`${Ue} hit ${Ue===1?"die":"dice"}`),y.hitDice.current=y.hitDice.max;let Qe=0;if(y.classFeatures.spellSlotsByLevel&&Object.keys(y.classFeatures.spellSlotsByLevel).forEach(De=>{const Be=y.classFeatures.spellSlotsByLevel[parseInt(De)];if(Be){const Fe=Be.filter(be=>be).length;Qe+=Fe,y.classFeatures.spellSlotsByLevel[parseInt(De)]=Array(Be.length).fill(!1)}}),Qe>0&&p.push(`${Qe} spell ${Qe===1?"slot":"slots"}`),y.class){const De=Nt(y.class,y.level,y.subclass);y.classFeatures.features||(y.classFeatures.features={});let Be=!1;De.forEach(Fe=>{const be=Fe.name.replace(/\s+/g,"");if(!(Fe.type==="info"||Fe.type==="channelDivinity")){if(Fe.type==="uses"){const ke=typeof Fe.maxUses=="function"?Fe.maxUses(y.level):Fe.maxUses;y.classFeatures.features[be]=Array(ke).fill(!1),Be=!0}else if(Fe.type==="pool"){const ke=typeof Fe.maxPool=="function"?Fe.maxPool(y.level):Fe.maxPool;ke!==void 0&&(y.classFeatures.features[be]=ke,Be=!0)}}}),Be&&p.push("all class features")}return y}),o(he,!1);const B=p.length>0?`Long rest taken! Restored: ${p.join(", ")}`:"Long rest taken! Fully rested.";Jt.add(B,"success")}function W(p){o(Re,""),o(ne,""),o(ge,""),o(de,!1),P=!1,typeof p=="string"?o(Re,p):(o(Re,p.notation),o(ne,p.damageNotation||""),o(ge,p.attackName||""),o(de,!!p.applyHalfDamage)),o(_,!0)}function q(p){const{notation:B}=p.detail;o(Re,""),P=!0,setTimeout(()=>{o(Re,B),o(ne,""),o(ge,"Hit Die")},0),o(_,!0)}function se(){if(o(_,!1),P&&e(Ce)){const p=e(Ce).getLastRollTotal();if(p!==null){const B=Math.max(1,p);Y.update(y=>(y.hitDice.current=Math.max(0,y.hitDice.current-1),y.currentHP=Math.min(y.maxHP,y.currentHP+B),y))}P=!1}}function ce(){console.log("toggleMode called, current isEditMode:",c()),la.update(p=>(console.log("Updating isEditMode from",p,"to",!p),!p))}function Z(p){p.target.closest(".rest-button-container")||o(he,!1)}Qt(()=>{console.log("onMount - initial isEditMode:",c()),console.log("onMount - body classes:",document.body.className);const p=la.subscribe(B=>{console.log("isEditMode subscription triggered, value:",B),console.log("Body classes before:",document.body.className),B?(document.body.classList.remove("use-mode"),console.log("Removed use-mode class (Edit Mode)")):(document.body.classList.add("use-mode"),console.log("Added use-mode class (Use Mode)")),console.log("Body classes after:",document.body.className)});return document.addEventListener("click",Z),()=>{p(),document.removeEventListener("click",Z)}});function Ie(){is(t())}function $(){e(O)?.click()}async function le(p){const y=p.target.files?.[0];if(y)try{const je=await ns(y);Y.set(je),alert("Character imported successfully!")}catch{alert("Failed to import character file")}}yt();var ee=Ar();ls("1uha8ag",p=>{var B=Lr();Ba(2),Ea(()=>{ss.title="D&D Character Sheet"}),v(p,B)});var me=Oe(ee),b=r(me),d=r(b),w=r(d),J=r(w),V=a(r(J),2);{var X=p=>{var B=Dr(),y=r(B,!0);l(B),I(()=>x(y,t().name)),v(p,B)};C(V,p=>{t().name&&p(X)})}l(J);var _e=a(J,2);{var pe=p=>{var B=jr();ct(B,5,N,dt,(y,je)=>{var Ue=wr();let Qe;var De=r(Ue);l(Ue),I(()=>{Qe=ut(Ue,1,"slot-badge svelte-1uha8ag",null,Qe,{depleted:e(je).available===0}),x(De,`Lv${e(je).level??""}: ${e(je).available??""}/${e(je).total??""}`)}),v(y,Ue)}),l(B),v(p,B)};C(_e,p=>{N().length>0&&p(pe)})}l(w);var qe=a(w,2),Le=r(qe),g=r(Le),Pe=a(g,2),Je=r(Pe),Ve=a(Je,2);{var Ze=p=>{var B=Fr(),y=r(B),je=a(y,2);l(B),j("click",y,ue),j("click",je,oe),v(p,B)};C(Ve,p=>{e(he)&&p(Ze)})}l(Pe);var T=a(Pe,2),F=r(T);let Q;var ve=r(F),Ne=r(ve,!0);l(ve);var we=a(ve),G=r(we,!0);l(we),l(F),l(T),l(Le);var ae=a(Le,2),k=r(ae);xe(k),l(ae),l(qe),l(d);var Se=a(d,2),$e=r(Se),Ee=a($e,2),ze=a(Ee,2),Xe=a(ze,2),Te=a(Xe,2),te=a(Te,2);_a(te,p=>o(O,p),()=>e(O)),l(Se),l(b);var ye=a(b,2),Ge=r(ye);xs(Ge,{});var We=a(Ge,2);As(We,{$$events:{rollHitDice:q}});var D=a(We,2);Ls(D,{$$events:{roll:p=>W(p.detail)}});var z=a(D,2);Ps(z,{$$events:{roll:p=>W(p.detail)}});var u=a(z,2);dl(u,{$$events:{roll:p=>W(p.detail)}});var A=a(u,2);wl(A,{});var H=a(A,2);Al(H,{}),l(ye),l(me);var E=a(me,2);_a(Ol(E,{get notation(){return e(Re)},get damageNotation(){return e(ne)},get attackName(){return e(ge)},get applyHalfDamage(){return e(de)},get visible(){return e(_)},$$events:{close:se},$$legacy:!0}),p=>o(Ce,p),()=>e(Ce));var m=a(E,2);{var re=p=>{cr(p,{get mode(){return e(K)},$$events:{close:()=>o(M,!1)}})};C(m,p=>{e(M)&&p(re)})}var He=a(m,2);{var fe=p=>{Cr(p,{onClose:()=>o(ie,!1)})};C(He,p=>{e(ie)&&p(fe)})}var Me=a(He,2);rs(Me,{}),I(()=>{Q=ut(F,1,"btn btn-mode svelte-1uha8ag",null,Q,{"use-mode":!c()}),x(Ne,c()?"ðŸ“":"ðŸŽ²"),x(G,c()?"Edit Mode":"Use Mode")}),j("click",g,()=>o(_,!0)),j("click",Je,()=>o(he,!e(he))),j("click",F,ce),Ae(k,h,p=>os(Rt,p)),j("click",$e,()=>o(ie,!0)),j("click",Ee,()=>{o(K,"save"),o(M,!0)}),j("click",ze,()=>{o(K,"load"),o(M,!0)}),j("click",Xe,Ie),j("click",Te,$),j("change",te,le),v(s,ee),xt(),L()}export{Br as component};
