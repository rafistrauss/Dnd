import{f as g,e as j,a as o,s as x,c as nt,t as ft}from"../chunks/BmKkCgmR.js";import{i as yt}from"../chunks/AFJ5q3G2.js";import{c as Tt,o as Jt}from"../chunks/BwhX61NF.js";import{a6 as Sa,i as Ca,b1 as Ba,b2 as Ta,b3 as ga,J as Ft,e as La,b4 as Da,aa as Na,b as i,r as wa,R as ja,g as Ga,B as xt,b5 as Ze,b6 as jt,E as I,F as kt,s as r,a3 as A,G as l,I as t,H as s,d as e,C as We,k as tt,z as E,b7 as Lt,b8 as zt,b9 as Fa,an as Aa,ba as Oa}from"../chunks/CmcvLP-Y.js";import{s as lt,c as V,a as gt,r as De,e as ut,i as bt,b as ha,u as Ra,d as At,f as pt,g as la,j as ta,k as qa,t as Wt,h as za,T as Wa,l as Ka,m as Ja}from"../chunks/BH0g7pxY.js";import{i as S,s as Dt,a as Je,b as at,d as Va}from"../chunks/BibxXT0t.js";import{p as Mt,b as pa}from"../chunks/BNYf2NzH.js";import{b as qt,r as Qa}from"../chunks/B8N6ovAX.js";function aa(n,d,a=!1){if(n.multiple){if(d==null)return;if(!Ca(d))return Ba();for(var v of n.options)v.selected=d.includes(Kt(v));return}for(v of n.options){var k=Kt(v);if(Ta(k,d)){v.selected=!0;return}}(!a||d!==void 0)&&(n.selectedIndex=-1)}function fa(n){var d=new MutationObserver(()=>{aa(n,n.__value)});d.observe(n,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Sa(()=>{d.disconnect()})}function Ia(n,d,a=d){var v=new WeakSet,k=!0;ga(n,"change",C=>{var D=C?"[selected]":":checked",G;if(n.multiple)G=[].map.call(n.querySelectorAll(D),Kt);else{var b=n.querySelector(D)??n.querySelector("option:not([disabled])");G=b&&Kt(b)}a(G),Ft!==null&&v.add(Ft)}),La(()=>{var C=d();if(n===document.activeElement){var D=Da??Ft;if(v.has(D))return}if(aa(n,C,k),k&&C===void 0){var G=n.querySelector(":checked");G!==null&&(C=Kt(G),a(C))}n.__value=C,k=!1}),fa(n)}function Kt(n){return"__value"in n?n.__value:n.value}function Me(n,d,a=d){var v=new WeakSet;ga(n,"input",async k=>{var C=k?n.defaultValue:n.value;if(C=va(n)?da(C):C,a(C),Ft!==null&&v.add(Ft),await Na(),C!==(C=d())){var D=n.selectionStart,G=n.selectionEnd,b=n.value.length;if(n.value=C??"",G!==null){var q=n.value.length;D===G&&G===b&&q>b?(n.selectionStart=q,n.selectionEnd=q):(n.selectionStart=D,n.selectionEnd=Math.min(G,q))}}}),(ja&&n.defaultValue!==n.value||i(d)==null&&n.value)&&(a(va(n)?da(n.value):n.value),Ft!==null&&v.add(Ft)),wa(()=>{var k=d();if(n===document.activeElement){var C=Da??Ft;if(v.has(C))return}va(n)&&k===da(n.value)||n.type==="date"&&!k&&!n.value||k!==n.value&&(n.value=k??"")})}function sa(n,d,a=d){ga(n,"change",v=>{var k=v?n.defaultChecked:n.checked;a(k)}),(ja&&n.defaultChecked!==n.checked||i(d)==null)&&a(n.checked),wa(()=>{var v=d();n.checked=!!v})}function va(n){var d=n.type;return d==="number"||d==="range"}function da(n){return n===""?null:+n}function Xa(n,d,a){var v=Ga(n,d);v&&v.set&&(n[d]=a,Sa(()=>{n[d]=null}))}function ma(n){return function(...d){var a=d[0];return a.stopPropagation(),n?.apply(this,d)}}function Ut(n,d){var a=n.$$events?.[d.type],v=Ca(a)?a.slice():a==null?[]:[a];for(var k of v)k.call(this,d)}const Ya="";function Ma(...n){return qt+Ya+Qa(n[0],n[1])}const ba={paladin:{name:"Paladin",hitDice:"d10",spellcaster:!0,spellcastingAbility:"charisma",spellSlotsByLevel:{1:0,2:2,3:3,4:3,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Divine Sense",type:"uses",maxUses:(n,d=1)=>1+Math.max(1,d),resetOn:"long",description:"Detect celestials, fiends, and undead within 60 feet",minLevel:1},{name:"Lay on Hands",type:"pool",maxPool:n=>n*5,resetOn:"long",description:"Heal wounds or cure disease",minLevel:1},{name:"Divine Smite",type:"spellSlot",description:"Expend spell slot to deal extra radiant damage",minLevel:2,rollable:!0},{name:"Channel Divinity",type:"pool",maxPool:n=>n>=18?3:n>=6?2:1,resetOn:"short",description:"Sacred Weapon or Turn Undead",minLevel:3}]},fighter:{name:"Fighter",hitDice:"d10",spellcaster:!1,features:[{name:"Second Wind",type:"uses",maxUses:1,resetOn:"short",description:"Regain 1d10 + fighter level HP as bonus action",minLevel:1,rollable:!0,rollFormula:n=>`1d10+${n}`},{name:"Action Surge",type:"uses",maxUses:n=>n>=17?2:1,resetOn:"short",description:"Take one additional action on your turn",minLevel:2},{name:"Indomitable",type:"uses",maxUses:n=>n>=17?3:n>=13?2:1,resetOn:"long",description:"Reroll a failed saving throw",minLevel:9}],subclasses:{champion:{name:"Champion",features:[{name:"Improved Critical",type:"info",description:"Critical hit on 19-20",minLevel:3},{name:"Remarkable Athlete",type:"info",description:"Add half proficiency to STR/DEX/CON checks, increase long jump distance",minLevel:7},{name:"Additional Fighting Style",type:"info",description:"Choose a second fighting style",minLevel:10},{name:"Superior Critical",type:"info",description:"Critical hit on 18-20",minLevel:15},{name:"Survivor",type:"info",description:"Regain 5 + CON mod HP at start of turn if below half HP",minLevel:18}]},battlemaster:{name:"Battle Master",features:[{name:"Combat Superiority",type:"uses",maxUses:n=>n>=15?6:n>=7?5:4,resetOn:"short",description:n=>`Use superiority dice (${n>=18?"d12":n>=10?"d10":"d8"}) for maneuvers`,minLevel:3},{name:"Know Your Enemy",type:"info",description:"Learn capabilities of creatures you observe",minLevel:7},{name:"Improved Combat Superiority",type:"info",description:"Superiority dice become d10",minLevel:10},{name:"Relentless",type:"info",description:"Regain 1 superiority die if you have none at start of turn",minLevel:15}]}}},rogue:{name:"Rogue",hitDice:"d8",spellcaster:!1,features:[{name:"Sneak Attack",type:"info",description:n=>`Deal ${Math.ceil(n/2)}d6 extra damage once per turn with advantage or ally nearby`,minLevel:1,rollable:!0,rollFormula:n=>`${Math.ceil(n/2)}d6`},{name:"Cunning Action",type:"info",description:"Dash, Disengage, or Hide as a bonus action",minLevel:2},{name:"Uncanny Dodge",type:"info",description:"Use reaction to halve damage from an attack",minLevel:5},{name:"Evasion",type:"info",description:"Take no damage on successful Dex save (half on fail)",minLevel:7}]},wizard:{name:"Wizard",hitDice:"d6",spellcaster:!0,spellcastingAbility:"intelligence",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Arcane Recovery",type:"uses",maxUses:1,resetOn:"long",description:n=>`Recover spell slots totaling up to ${Math.ceil(n/2)} levels during short rest`,minLevel:1},{name:"Spell Mastery",type:"info",description:"Cast one 1st-level and one 2nd-level spell at will",minLevel:18}]},cleric:{name:"Cleric",hitDice:"d8",spellcaster:!0,spellcastingAbility:"wisdom",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Channel Divinity",type:"pool",maxPool:n=>n>=18?3:n>=6?2:1,resetOn:"short",description:"Turn Undead or domain-specific ability",minLevel:2},{name:"Destroy Undead",type:"info",description:n=>`Channel Divinity destroys undead of CR ${n>=17?4:n>=14?3:n>=11?2:n>=8?1:.5} or lower`,minLevel:5},{name:"Divine Intervention",type:"uses",maxUses:1,resetOn:"long",description:n=>`${n}% chance to succeed, implore deity for aid`,minLevel:10}],subclasses:{war:{name:"War Domain",features:[{name:"War Priest",type:"uses",maxUses:(n,d=1)=>Math.max(1,d),resetOn:"long",description:"Make one weapon attack as a bonus action",minLevel:1},{name:"Guided Strike",type:"channelDivinity",description:"Use your Channel Divinity to gain +10 to an attack roll. Make this choice after you see the roll, but before the DM says whether the attack hits or misses.",minLevel:2,resetOn:"short"},{name:"War God's Blessing",type:"channelDivinity",description:"Use reaction to grant +10 to an ally's attack roll within 30 feet. Consumes one use of Channel Divinity.",minLevel:6,resetOn:"short"},{name:"Divine Strike",type:"info",description:n=>`Deal extra ${n>=14?"2d8":"1d8"} weapon damage once per turn`,minLevel:8,rollable:!0,rollFormula:n=>n>=14?"2d8":"1d8"},{name:"Avatar of Battle",type:"info",description:"Gain resistance to nonmagical weapon damage",minLevel:17}]},life:{name:"Life Domain",features:[{name:"Disciple of Life",type:"info",description:"Healing spells restore additional 2 + spell level HP",minLevel:1},{name:"Preserve Life",type:"pool",maxPool:n=>n*5,resetOn:"short",description:"Restore HP to creatures within 30 feet",minLevel:2},{name:"Blessed Healer",type:"info",description:"Regain 2 + spell level HP when you cast healing spell",minLevel:6},{name:"Divine Strike",type:"info",description:n=>`Deal extra ${n>=14?"2d8":"1d8"} radiant damage once per turn`,minLevel:8,rollable:!0,rollFormula:n=>n>=14?"2d8":"1d8"},{name:"Supreme Healing",type:"info",description:"Maximize healing dice instead of rolling",minLevel:17}]}}},barbarian:{name:"Barbarian",hitDice:"d12",spellcaster:!1,features:[{name:"Rage",type:"uses",maxUses:n=>n>=20?1/0:n>=17?6:n>=12?5:n>=6?4:n>=3?3:2,resetOn:"long",description:n=>`+${n>=16?4:n>=9?3:2} damage, resistance to physical damage`,minLevel:1},{name:"Reckless Attack",type:"info",description:"Gain advantage on melee attacks, enemies get advantage on you",minLevel:2},{name:"Danger Sense",type:"info",description:"Advantage on Dex saves against effects you can see",minLevel:2}],subclasses:{berserker:{name:"Path of the Berserker",features:[{name:"Frenzy",type:"info",description:"While raging, make melee attack as bonus action (gain 1 exhaustion after rage)",minLevel:3},{name:"Mindless Rage",type:"info",description:"Cannot be charmed or frightened while raging",minLevel:6},{name:"Intimidating Presence",type:"info",description:"Use action to frighten creature within 30 feet",minLevel:10},{name:"Retaliation",type:"info",description:"When damaged by creature within 5 feet, make melee attack as reaction",minLevel:14}]}}}};function _t(n){const d=n.toLowerCase();return ba[d]||null}function Bt(n,d,a){const v=_t(n);if(!v)return[];const k=v.features.filter(C=>!C.minLevel||C.minLevel<=d);if(a&&v.subclasses&&v.subclasses[a]){const C=v.subclasses[a].features.filter(D=>!D.minLevel||D.minLevel<=d);return[...k,...C]}return k}function _a(n){const d=_t(n);return!d||!d.subclasses?[]:Object.keys(d.subclasses).map(a=>({id:a,name:d.subclasses[a].name}))}function ya(n,d){const a=_t(n);return!a||!a.spellcaster||!a.spellSlotsByLevel?0:a.spellSlotsByLevel[d]||0}function xa(n,d,a){const v=_t(n);return!v||!v.spellcaster?0:Math.max(1,a+d)}function Za(n,d,a){const v=_t(n);return!v||!v.spellcaster?null:8+d+a}function es(){return Object.keys(ba).map(n=>({id:n,name:ba[n].name}))}var ts=g("<option> </option>"),as=g("<option> </option>"),ss=g('<div class="form-group svelte-172i2fj"><label for="characterSubclass" class="svelte-172i2fj">Subclass</label> <select id="characterSubclass" class="svelte-172i2fj"><option>Select Subclass</option><!></select></div>'),ls=g('<div class="info-grid svelte-172i2fj"><div class="form-group svelte-172i2fj"><label for="characterName" class="svelte-172i2fj">Character Name</label> <input type="text" id="characterName" placeholder="Enter name" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterClass" class="svelte-172i2fj">Class</label> <select id="characterClass" class="svelte-172i2fj"><option>Select Class</option><!></select></div> <!> <div class="form-group svelte-172i2fj"><label for="characterLevel" class="svelte-172i2fj">Level</label> <input type="number" id="characterLevel" min="1" max="20" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterRace" class="svelte-172i2fj">Race</label> <input type="text" id="characterRace" placeholder="e.g., Human" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterBackground" class="svelte-172i2fj">Background</label> <input type="text" id="characterBackground" placeholder="e.g., Soldier" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterAlignment" class="svelte-172i2fj">Alignment</label> <input type="text" id="characterAlignment" placeholder="e.g., Lawful Good" class="svelte-172i2fj"/></div></div>'),is=g('<section class="character-info svelte-172i2fj"><div class="header svelte-172i2fj"><h2 class="svelte-172i2fj">Character Info</h2> <button class="collapse-btn svelte-172i2fj"> </button></div> <!></section>');function ns(n,d){xt(d,!1);const a=()=>Je(V,"$character",k),v=()=>Je(gt,"$collapsedStates",k),[k,C]=Dt(),D=A(),G=es();function b(M){const ce=M.target;V.update(ge=>(ge.class=ce.value,ge.subclass="",ge))}function q(M){const ce=M.target;V.update(ge=>(ge.subclass=ce.value,ge))}function ie(M){const ce=M.target;V.update(ge=>(ge.level=parseInt(ce.value)||1,ge)),Ra()}function H(){gt.update(M=>({...M,characterInfo:!M.characterInfo}))}Ze(()=>(a(),_a),()=>{r(D,a().class?_a(a().class):[])}),jt(),yt();var W=is(),Be=l(W),re=t(l(Be),2),be=l(re,!0);s(re),s(Be);var ue=t(Be,2);{var ke=M=>{var ce=ls(),ge=l(ce),K=t(l(ge),2);De(K),s(ge);var z=t(ge,2),B=t(l(z),2),te=l(B);te.value=te.__value="";var ne=t(te);ut(ne,1,()=>G,bt,(ye,$e)=>{var xe=ts(),Se=l(xe,!0);s(xe);var h={};I(()=>{x(Se,(e($e),i(()=>e($e).name))),h!==(h=(e($e),i(()=>e($e).id)))&&(xe.value=(xe.__value=(e($e),i(()=>e($e).id)))??"")}),o(ye,xe)}),s(B);var Q;fa(B),s(z);var Fe=t(z,2);{var L=ye=>{var $e=ss(),xe=t(l($e),2),Se=l(xe);Se.value=Se.__value="";var h=t(Se);ut(h,1,()=>e(D),bt,(Pe,Ke)=>{var et=as(),Ye=l(et,!0);s(et);var _={};I(()=>{x(Ye,(e(Ke),i(()=>e(Ke).name))),_!==(_=(e(Ke),i(()=>e(Ke).id)))&&(et.value=(et.__value=(e(Ke),i(()=>e(Ke).id)))??"")}),o(Pe,et)}),s(xe);var Te;fa(xe),s($e),I(()=>{Te!==(Te=(a(),i(()=>a().subclass)))&&(xe.value=(xe.__value=(a(),i(()=>a().subclass)))??"",aa(xe,(a(),i(()=>a().subclass))))}),j("change",xe,q),o(ye,$e)};S(Fe,ye=>{e(D),i(()=>e(D).length>0)&&ye(L)})}var oe=t(Fe,2),J=t(l(oe),2);De(J),s(oe);var m=t(oe,2),c=t(l(m),2);De(c),s(m);var w=t(m,2),ve=t(l(w),2);De(ve),s(w);var T=t(w,2),ae=t(l(T),2);De(ae),s(T),s(ce),I(()=>{Q!==(Q=(a(),i(()=>a().class)))&&(B.value=(B.__value=(a(),i(()=>a().class)))??"",aa(B,(a(),i(()=>a().class)))),ha(J,(a(),i(()=>a().level)))}),Me(K,()=>a().name,ye=>at(V,i(a).name=ye,i(a))),j("change",B,b),j("change",J,ie),Me(c,()=>a().race,ye=>at(V,i(a).race=ye,i(a))),Me(ve,()=>a().background,ye=>at(V,i(a).background=ye,i(a))),Me(ae,()=>a().alignment,ye=>at(V,i(a).alignment=ye,i(a))),o(M,ce)};S(ue,M=>{v(),i(()=>!v().characterInfo)&&M(ke)})}s(W),I(()=>{lt(re,"aria-label",(v(),i(()=>v().characterInfo?"Expand":"Collapse"))),x(be,(v(),i(()=>v().characterInfo?"â–¼":"â–²")))}),j("click",re,H),o(n,W),kt(),C()}var rs=g('<div class="ability-card svelte-bbv1xt"><h3 class="svelte-bbv1xt"> </h3> <input type="number" class="ability-score svelte-bbv1xt" min="1" max="30"/> <div class="ability-modifier svelte-bbv1xt"> </div> <button class="roll-btn svelte-bbv1xt">Check</button> <div class="save-row svelte-bbv1xt"><input type="checkbox" class="svelte-bbv1xt"/> <label class="svelte-bbv1xt">Save</label> <button class="roll-btn-small svelte-bbv1xt">Roll</button></div></div>'),os=g('<div class="proficiency-bonus svelte-bbv1xt"><label for="profBonus">Proficiency Bonus</label> <input type="number" id="profBonus" class="prof-input svelte-bbv1xt"/></div> <div class="abilities-grid svelte-bbv1xt"></div>',1),cs=g('<section><div class="header svelte-bbv1xt"><h2 class="svelte-bbv1xt">Ability Scores</h2> <button class="collapse-btn svelte-bbv1xt"> </button></div> <!></section>');function vs(n,d){xt(d,!1);const a=()=>Je(la,"$abilityModifiers",D),v=()=>Je(V,"$character",D),k=()=>Je(At,"$searchFilter",D),C=()=>Je(gt,"$collapsedStates",D),[D,G]=Dt(),b=A(),q=A(),ie=Tt(),H=[{key:"strength",label:"Strength"},{key:"dexterity",label:"Dexterity"},{key:"constitution",label:"Constitution"},{key:"intelligence",label:"Intelligence"},{key:"wisdom",label:"Wisdom"},{key:"charisma",label:"Charisma"}];function W(){Ra()}function Be(B){const te=a()[B],ne=`1d20${te>=0?"+":""}${te}`;ie("roll",ne)}function re(B){const te=a()[B],ne=v().saveProficiencies[B]?v().proficiencyBonus:0,Q=te+ne,Fe=`1d20${Q>=0?"+":""}${Q}`;ie("roll",Fe)}function be(){gt.update(B=>({...B,abilityScores:!B.abilityScores}))}Ze(()=>k(),()=>{r(b,H.filter(({label:B})=>k()?B.toLowerCase().includes(k().toLowerCase()):!0))}),Ze(()=>(e(b),k()),()=>{r(q,e(b).length>0||!k()||k().toLowerCase().includes("proficiency"))}),jt(),yt();var ue=cs();let ke;var M=l(ue),ce=t(l(M),2),ge=l(ce,!0);s(ce),s(M);var K=t(M,2);{var z=B=>{var te=os(),ne=We(te),Q=t(l(ne),2);De(Q),s(ne);var Fe=t(ne,2);ut(Fe,5,()=>e(b),bt,(L,oe)=>{let J=()=>e(oe).key,m=()=>e(oe).label;var c=rs(),w=l(c),ve=l(w,!0);s(w);var T=t(w,2);De(T);var ae=t(T,2),ye=l(ae);s(ae);var $e=t(ae,2),xe=t($e,2),Se=l(xe);De(Se);var h=t(Se,2),Te=t(h,2);s(xe),s(c),I(Pe=>{x(ve,Pe),x(ye,`${a(),J(),i(()=>a()[J()]>=0?"+":"")??""}${a(),J(),i(()=>a()[J()])??""}`),lt(Se,"id",`${J()}-save`),lt(h,"for",`${J()}-save`)},[()=>(m(),i(()=>m().substring(0,3).toUpperCase()))]),Me(T,()=>v().abilities[J()],Pe=>at(V,i(v).abilities[J()]=Pe,i(v))),j("change",T,W),j("click",$e,()=>Be(J())),sa(Se,()=>v().saveProficiencies[J()],Pe=>at(V,i(v).saveProficiencies[J()]=Pe,i(v))),j("click",Te,()=>re(J())),o(L,c)}),s(Fe),Me(Q,()=>v().proficiencyBonus,L=>at(V,i(v).proficiencyBonus=L,i(v))),o(B,te)};S(K,B=>{C(),i(()=>!C().abilityScores)&&B(z)})}s(ue),I(()=>{ke=pt(ue,1,"ability-scores svelte-bbv1xt",null,ke,{hidden:!e(q)}),lt(ce,"aria-label",(C(),i(()=>C().abilityScores?"Expand":"Collapse"))),x(ge,(C(),i(()=>C().abilityScores?"â–¼":"â–²")))}),j("click",ce,be),o(n,ue),kt(),G()}var ds=g('<div class="stat-box svelte-1r5hyyb"><label for="spellSaveDC" class="svelte-1r5hyyb">Spell Save DC</label> <input type="number" id="spellSaveDC" class="stat-input svelte-1r5hyyb" readonly="" title="8 + Proficiency Bonus + Spellcasting Ability Modifier"/></div>'),us=g('<span class="hit-dice-type"> </span>'),ps=g('<div class="stats-grid svelte-1r5hyyb"><div class="stat-box svelte-1r5hyyb"><label for="armorClass" class="svelte-1r5hyyb">Armor Class</label> <input type="number" id="armorClass" class="stat-input svelte-1r5hyyb"/></div> <div class="stat-box svelte-1r5hyyb"><label for="initiative" class="svelte-1r5hyyb">Initiative</label> <input type="number" id="initiative" class="stat-input svelte-1r5hyyb"/></div> <div class="stat-box svelte-1r5hyyb"><label for="speed" class="svelte-1r5hyyb">Speed</label> <input type="text" id="speed" class="stat-input svelte-1r5hyyb"/></div> <!></div> <div class="hp-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Points</h3> <div class="hp-display svelte-1r5hyyb"><div class="hp-inputs svelte-1r5hyyb"><input type="number" class="hp-current svelte-1r5hyyb" min="0"/> <span class="hp-separator svelte-1r5hyyb">/</span> <input type="number" class="hp-max svelte-1r5hyyb" min="0"/></div> <div class="hp-controls svelte-1r5hyyb"><button class="hp-btn svelte-1r5hyyb">âˆ’</button> <button class="hp-btn svelte-1r5hyyb">+</button> <button class="hp-btn svelte-1r5hyyb">âˆ’5</button> <button class="hp-btn svelte-1r5hyyb">+5</button></div></div> <div class="temp-hp svelte-1r5hyyb"><label for="tempHP" class="svelte-1r5hyyb">Temp HP</label> <input type="number" id="tempHP" min="0" class="svelte-1r5hyyb"/></div></div> <div class="hit-dice-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Dice</h3> <div class="hit-dice-display svelte-1r5hyyb"><input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <span>/</span> <input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <!></div> <div class="hit-dice-controls"><label for="hitDiceCount" class="svelte-1r5hyyb">Roll</label> <input type="number" id="hitDiceCount" class="hit-dice-count-input svelte-1r5hyyb" min="1" value="1"/> <button class="btn btn-primary roll-hit-dice use-enabled svelte-1r5hyyb">ðŸŽ² Roll</button></div></div>',1),fs=g('<section><div class="header svelte-1r5hyyb"><h2 class="svelte-1r5hyyb">Combat Stats</h2> <button class="collapse-btn svelte-1r5hyyb"> </button></div> <!></section>');function bs(n,d){xt(d,!1);const a=()=>Je(V,"$character",D),v=()=>Je(la,"$abilityModifiers",D),k=()=>Je(At,"$searchFilter",D),C=()=>Je(gt,"$collapsedStates",D),[D,G]=Dt(),b=A(),q=A(),ie=Tt();function H(K){V.update(z=>(z.currentHP=Math.max(0,Math.min(z.maxHP,z.currentHP+K)),z))}function W(K=1){if(a().hitDice.current<=0){alert("No hit dice remaining!");return}if(!a().class){alert("Please select a class first!");return}const z=_t(a().class);if(!z){alert("Invalid class configuration!");return}const B=Math.min(K,a().hitDice.current),te=z.hitDice,ne=v().constitution,Q=ne>=0?`+${ne}`:`${ne}`,Fe=`${B}${te}${Q}`;ie("rollHitDice",{notation:Fe,hitDie:te,count:B})}function Be(){gt.update(K=>({...K,combatStats:!K.combatStats}))}Ze(()=>(a(),v()),()=>{r(b,(()=>{if(!a().class)return null;const K=_t(a().class);if(!K||!K.spellcaster||!K.spellcastingAbility)return null;const z=v()[K.spellcastingAbility];return 8+a().proficiencyBonus+z})())}),Ze(()=>k(),()=>{r(q,!k()||"armor class".includes(k().toLowerCase())||"initiative".includes(k().toLowerCase())||"speed".includes(k().toLowerCase())||"hit points".includes(k().toLowerCase())||"hp".includes(k().toLowerCase())||"hit dice".includes(k().toLowerCase())||"spell save".includes(k().toLowerCase())||"combat".includes(k().toLowerCase()))}),jt(),yt();var re=fs();let be;var ue=l(re),ke=t(l(ue),2),M=l(ke,!0);s(ke),s(ue);var ce=t(ue,2);{var ge=K=>{var z=ps(),B=We(z),te=l(B),ne=t(l(te),2);De(ne),s(te);var Q=t(te,2),Fe=t(l(Q),2);De(Fe),s(Q);var L=t(Q,2),oe=t(l(L),2);De(oe),s(L);var J=t(L,2);{var m=N=>{var X=ds(),y=t(l(X),2);De(y),s(X),I(()=>ha(y,e(b))),o(N,X)};S(J,N=>{e(b)!==null&&N(m)})}s(B);var c=t(B,2),w=t(l(c),2),ve=l(w),T=l(ve);De(T);var ae=t(T,4);De(ae),s(ve);var ye=t(ve,2),$e=l(ye),xe=t($e,2),Se=t(xe,2),h=t(Se,2);s(ye),s(w);var Te=t(w,2),Pe=t(l(Te),2);De(Pe),s(Te),s(c);var Ke=t(c,2),et=t(l(Ke),2),Ye=l(et);De(Ye);var _=t(Ye,4);De(_);var O=t(_,2);{var Y=N=>{const X=tt(()=>(E(_t),a(),i(()=>_t(a().class))));var y=nt(),Ae=We(y);{var me=Ne=>{const qe=tt(()=>(v(),i(()=>v().constitution)));var Qe=us(),we=l(Qe);s(Qe),I(()=>x(we,`(${E(e(X)),i(()=>e(X).hitDice)??""}${(e(qe)>=0?`+${e(qe)}`:e(qe))??""})`)),o(Ne,Qe)};S(Ae,Ne=>{e(X)&&Ne(me)})}o(N,y)};S(O,N=>{a(),i(()=>a().class)&&N(Y)})}s(et);var he=t(et,2),Oe=t(l(he),2),Ee=t(Oe,2);s(he),s(Ke),I(()=>{lt(T,"max",(a(),i(()=>a().maxHP))),lt(Ye,"max",(a(),i(()=>a().hitDice.max))),lt(Oe,"max",(a(),i(()=>a().hitDice.current))),Ee.disabled=(a(),i(()=>a().hitDice.current<=0||!a().class))}),Me(ne,()=>a().armorClass,N=>at(V,i(a).armorClass=N,i(a))),Me(Fe,()=>a().initiative,N=>at(V,i(a).initiative=N,i(a))),Me(oe,()=>a().speed,N=>at(V,i(a).speed=N,i(a))),Me(T,()=>a().currentHP,N=>at(V,i(a).currentHP=N,i(a))),Me(ae,()=>a().maxHP,N=>at(V,i(a).maxHP=N,i(a))),j("click",$e,()=>H(-1)),j("click",xe,()=>H(1)),j("click",Se,()=>H(-5)),j("click",h,()=>H(5)),Me(Pe,()=>a().tempHP,N=>at(V,i(a).tempHP=N,i(a))),Me(Ye,()=>a().hitDice.current,N=>at(V,i(a).hitDice.current=N,i(a))),Me(_,()=>a().hitDice.max,N=>at(V,i(a).hitDice.max=N,i(a))),j("input",Oe,N=>{const X=N.target,y=parseInt(X.value);y>a().hitDice.current&&(X.value=String(a().hitDice.current)),y<1&&(X.value="1")}),j("click",Ee,()=>{const N=document.getElementById("hitDiceCount"),X=parseInt(N?.value||"1");W(X)}),o(K,z)};S(ce,K=>{C(),i(()=>!C().combatStats)&&K(ge)})}s(re),I(()=>{be=pt(re,1,"combat-stats svelte-1r5hyyb",null,be,{hidden:!e(q)}),lt(ke,"aria-label",(C(),i(()=>C().combatStats?"Expand":"Collapse"))),x(M,(C(),i(()=>C().combatStats?"â–¼":"â–²")))}),j("click",ke,Be),o(n,re),kt(),G()}const ua={acrobatics:"dexterity",animalHandling:"wisdom",arcana:"intelligence",athletics:"strength",deception:"charisma",history:"intelligence",insight:"wisdom",intimidation:"charisma",investigation:"intelligence",medicine:"wisdom",nature:"intelligence",perception:"wisdom",performance:"charisma",persuasion:"charisma",religion:"intelligence",sleightOfHand:"dexterity",stealth:"dexterity",survival:"wisdom"};var gs=g('<div class="skill-row svelte-1f1pl16"><input type="checkbox" class="svelte-1f1pl16"/> <label class="svelte-1f1pl16"> <span class="ability-tag svelte-1f1pl16"> </span></label> <span class="skill-modifier svelte-1f1pl16"> </span> <button class="roll-btn svelte-1f1pl16">Roll</button></div>'),hs=g('<div class="skills-grid svelte-1f1pl16"></div>'),ms=g('<section><div class="header svelte-1f1pl16"><h2 class="svelte-1f1pl16">Skills</h2> <button class="collapse-btn svelte-1f1pl16"> </button></div> <!></section>');function _s(n,d){xt(d,!1);const a=()=>Je(la,"$abilityModifiers",D),v=()=>Je(V,"$character",D),k=()=>Je(At,"$searchFilter",D),C=()=>Je(gt,"$collapsedStates",D),[D,G]=Dt(),b=A(),q=A(),ie=Tt(),H=[{key:"acrobatics",label:"Acrobatics"},{key:"animalHandling",label:"Animal Handling"},{key:"arcana",label:"Arcana"},{key:"athletics",label:"Athletics"},{key:"deception",label:"Deception"},{key:"history",label:"History"},{key:"insight",label:"Insight"},{key:"intimidation",label:"Intimidation"},{key:"investigation",label:"Investigation"},{key:"medicine",label:"Medicine"},{key:"nature",label:"Nature"},{key:"perception",label:"Perception"},{key:"performance",label:"Performance"},{key:"persuasion",label:"Persuasion"},{key:"religion",label:"Religion"},{key:"sleightOfHand",label:"Sleight of Hand"},{key:"stealth",label:"Stealth"},{key:"survival",label:"Survival"}];function W(z){const B=ua[z],te=a()[B],ne=v().skillProficiencies[z]?v().proficiencyBonus:0;return te+ne}function Be(z){const B=W(z),te=`1d20${B>=0?"+":""}${B}`;ie("roll",te)}function re(){gt.update(z=>({...z,skills:!z.skills}))}Ze(()=>k(),()=>{r(b,H.filter(({label:z})=>k()?z.toLowerCase().includes(k().toLowerCase()):!0))}),Ze(()=>e(b),()=>{r(q,e(b).length>0)}),jt(),yt();var be=ms();let ue;var ke=l(be),M=t(l(ke),2),ce=l(M,!0);s(M),s(ke);var ge=t(ke,2);{var K=z=>{var B=hs();ut(B,5,()=>e(b),bt,(te,ne)=>{let Q=()=>e(ne).key,Fe=()=>e(ne).label;const L=tt(()=>(E(ua),Q(),i(()=>ua[Q()]))),oe=tt(()=>(Q(),i(()=>W(Q()))));var J=gs(),m=l(J);De(m);var c=t(m,2),w=l(c),ve=t(w),T=l(ve);s(ve),s(c);var ae=t(c,2),ye=l(ae);s(ae);var $e=t(ae,2);s(J),I(xe=>{lt(m,"id",Q()),lt(c,"for",Q()),x(w,`${Fe()??""} `),x(T,`(${xe??""})`),x(ye,`${e(oe)>=0?"+":""}${e(oe)??""}`)},[()=>(E(e(L)),i(()=>e(L).substring(0,3).toUpperCase()))]),sa(m,()=>v().skillProficiencies[Q()],xe=>at(V,i(v).skillProficiencies[Q()]=xe,i(v))),j("click",$e,()=>Be(Q())),o(te,J)}),s(B),o(z,B)};S(ge,z=>{C(),i(()=>!C().skills)&&z(K)})}s(be),I(()=>{ue=pt(be,1,"skills svelte-1f1pl16",null,ue,{hidden:!e(q)}),lt(M,"aria-label",(C(),i(()=>C().skills?"Expand":"Collapse"))),x(ce,(C(),i(()=>C().skills?"â–¼":"â–²")))}),j("click",M,re),o(n,be),kt(),G()}let Yt=null,Zt=null;async function Pa(){if(Yt)return Yt;try{return Yt=await(await fetch(Ma("/data/spells.json"))).json(),Yt||[]}catch(n){return console.error("Failed to load spells:",n),[]}}async function ys(){if(Zt)return Zt;try{return Zt=await(await fetch(Ma("/data/feats.json"))).json(),Zt||[]}catch(n){return console.error("Failed to load feats:",n),[]}}function ka(n,d){if(!d.trim())return n;const a=d.toLowerCase();return n.filter(v=>v.name.toLowerCase().includes(a)||v.school.toLowerCase().includes(a)||v.classes.some(k=>k.toLowerCase().includes(a))||v.description.toLowerCase().includes(a))}function xs(n,d){return d===null?n:n.filter(a=>a.level===d)}function ks(n,d){if(!d.trim())return n;const a=d.toLowerCase();return n.filter(v=>v.name.toLowerCase().includes(a)||v.description.toLowerCase().includes(a))}function ea(n){const d=n.description,a=/\b(Strength|Dexterity|Constitution|Intelligence|Wisdom|Charisma)\s+saving\s+throw/i,v=d.match(a);if(!v)return null;const k=v[1].toLowerCase(),D=/half\s+(?:as\s+much\s+)?damage\s+on\s+a\s+successful(?:\s+save)?/i.test(d),b=/saving\s+throw\s+or\s+take.*?damage/i.test(d)&&!D;return{ability:k,halfDamageOnSave:D,noDamageOnSave:b}}var $s=g('<button class="btn-remove svelte-14o91c5">Ã—</button>'),Ss=g('<div class="spell-info-loading svelte-14o91c5">Loading spell info...</div>'),Cs=g('<div class="spell-notes svelte-14o91c5"><h4 class="svelte-14o91c5">General Notes</h4> <p> </p></div>'),Ls=g('<li class="svelte-14o91c5"><strong>At Higher Levels:</strong> </li>'),Ds=g('<ul class="svelte-14o91c5"><li class="svelte-14o91c5"><strong>Level:</strong> </li> <li class="svelte-14o91c5"><strong>Casting Time:</strong> </li> <li class="svelte-14o91c5"><strong>Range:</strong> </li> <li class="svelte-14o91c5"><strong>Components:</strong> <!></li> <li class="svelte-14o91c5"><strong>Duration:</strong> <!> </li> <li class="svelte-14o91c5"><strong>Description:</strong> </li> <!></ul>'),ws=g("<option> </option>"),js=g('<span class="scaled-damage svelte-14o91c5"><!> </span>'),Fs=g('<span class="scaled-damage svelte-14o91c5"> </span>'),As=g('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> Target is Fiend or Undead <!></label></div>'),Rs=g('<span class="scaled-damage svelte-14o91c5">(Half damage)</span>'),Is=g('<span class="scaled-damage svelte-14o91c5">(No damage)</span>'),Ms=g('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> <!></label></div>'),Ps=g('<div class="spell-level-selector svelte-14o91c5"><label class="svelte-14o91c5">Cast at Level:</label> <select class="spell-level-select use-enabled svelte-14o91c5"></select> <!></div> <!> <!>',1),Es=g('<div class="spell-level-selector svelte-14o91c5"><span style="color: #dc3545; font-weight: bold;">No spell slots available!</span></div>'),Hs=g('<!> <div class="spell-info svelte-14o91c5"><div class="spell-info-header svelte-14o91c5" role="button" tabindex="0"><h4 class="svelte-14o91c5">Spell Info</h4> <button class="collapse-btn-small svelte-14o91c5"> </button></div> <!></div> <!>',1),Us=g('<div class="spell-info-missing svelte-14o91c5">Spell info not found.</div>'),Bs=g('<div class="attack-notes svelte-14o91c5"><label class="svelte-14o91c5">Notes</label> <textarea placeholder="e.g., DC 15 Dex save, Range 120 ft, Concentration" class="notes-input svelte-14o91c5" rows="2"></textarea></div>'),Ts=g('<button class="btn btn-primary">Roll Attack</button>'),Ns=g('<button class="btn btn-secondary"><!></button>'),Gs=g('<button class="btn btn-secondary">Roll Damage</button>'),Os=g('<div class="attack-card svelte-14o91c5"><div class="attack-header svelte-14o91c5"><input type="text" placeholder="Attack name" class="attack-name svelte-14o91c5"/> <!></div> <div class="attack-details svelte-14o91c5"><div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Bonus</label> <input type="number" class="attack-bonus svelte-14o91c5"/></div> <div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Damage</label> <input type="text" placeholder="e.g., 2d6+3" class="attack-damage svelte-14o91c5"/></div> <div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Type</label> <input type="text" placeholder="e.g., slashing" class="attack-type svelte-14o91c5"/></div></div> <!> <!> <div class="attack-actions svelte-14o91c5"><!> <!></div></div>'),qs=g('<p class="no-attacks svelte-14o91c5">No attacks added yet. Click "Add Attack" to create one.</p>'),zs=g('<p class="no-attacks svelte-14o91c5">No attacks match your search.</p>'),Ws=g('<button class="btn btn-secondary">Add Attack</button> <div class="attacks-list svelte-14o91c5"><!> <!></div>',1),Ks=g('<section><div class="header svelte-14o91c5"><h2 class="svelte-14o91c5">Attacks & Spells</h2> <button class="collapse-btn svelte-14o91c5"> </button></div> <!></section>');function Js(n,d){xt(d,!1);const a=()=>Je(V,"$character",D),v=()=>Je(At,"$searchFilter",D),k=()=>Je(gt,"$collapsedStates",D),C=()=>Je(ta,"$isEditMode",D),[D,G]=Dt(),b=A(),q=A(),ie=Tt();let H=A({});function W(c){Fa(H,e(H)[c]=!e(H)[c]),r(H,{...e(H)})}function Be(c){return c.description.toLowerCase().includes("regain")&&(c.description.toLowerCase().includes("hit point")||c.description.toLowerCase().includes("hp"))}function re(){V.update(c=>(c.attacks=[...c.attacks,{id:crypto.randomUUID(),name:"",bonus:0,damage:"",damageType:"",notes:""}],c))}function be(c){V.update(w=>(w.attacks=w.attacks.filter(ve=>ve.id!==c),w))}function ue(c){let w=c.damage,ve=!1;if(c.spellRef){const ae=K(c.spellRef);if(ae&&ae.level>0){const ye=c.castAtLevel||ae.level;if(!z(ye)){alert(`No level ${ye} spell slots available!`);return}const xe=ea(ae);xe&&c.targetSucceededSave&&xe.noDamageOnSave?w="0":(ve=xe?.halfDamageOnSave&&c.targetSucceededSave||!1,w=B(c,ae))}}const T=`1d20${c.bonus>=0?"+":""}${c.bonus}`;ie("roll",{notation:T,damageNotation:w,attackName:c.name,applyHalfDamage:ve})}function ke(c){if(!c.damage){alert(`${c.name}: No damage specified`);return}let w=c.damage,ve=!1;if(c.spellRef){const T=K(c.spellRef);if(T&&T.level>0){const ae=c.castAtLevel||T.level;if(!z(ae)){alert(`No level ${ae} spell slots available!`);return}const $e=ea(T);$e&&c.targetSucceededSave&&$e.noDamageOnSave?w="0":(ve=$e?.halfDamageOnSave&&c.targetSucceededSave||!1,w=B(c,T))}}ie("roll",{notation:w,attackName:c.name,applyHalfDamage:ve})}function M(){gt.update(c=>({...c,attacks:!c.attacks}))}let ce=A([]),ge=A(!1);Jt(async()=>{r(ce,await Pa()),r(ge,!0)});function K(c){return e(ce).find(w=>w.name===c)}function z(c){a().classFeatures.spellSlotsByLevel||at(V,i(a).classFeatures.spellSlotsByLevel={},i(a)),a().classFeatures.spellSlotsByLevel[c]||at(V,i(a).classFeatures.spellSlotsByLevel[c]=Array(2).fill(!1),i(a));const ve=a().classFeatures.spellSlotsByLevel[c].findIndex(T=>!T);return ve===-1?!1:(V.update(T=>(T.classFeatures.spellSlotsByLevel||(T.classFeatures.spellSlotsByLevel={}),T.classFeatures.spellSlotsByLevel[c]||(T.classFeatures.spellSlotsByLevel[c]=Array(2).fill(!1)),T.classFeatures.spellSlotsByLevel[c][ve]=!0,T)),!0)}function B(c,w){let ve=c.damage,T=0;if(w.higherLevelSlot&&c.castAtLevel){const Se=w.level,Te=(c.castAtLevel||Se)-Se;if(Te>0){const Pe=w.higherLevelSlot.match(/(\d+)d(\d+)\s+for\s+each.*?level\s+above/i);if(Pe){const[,Ke]=Pe;T+=Te*parseInt(Ke)}}}if(c.targetIsFiendOrUndead&&w.description.includes("Fiend or an Undead")){const Se=w.description.match(/increases by (\d+)d(\d+) if.*?Fiend or.*?Undead/i);if(Se){const[,h]=Se;T+=parseInt(h)}}const ae=ve.match(/(\d+)d(\d+)/);if(!ae)return ve;const[,ye,$e]=ae;return`${parseInt(ye)+T}d${$e}`}function te(c){const w=[];for(let T=c.level;T<=9;T++){const ae=a().classFeatures.spellSlotsByLevel?.[T];ae&&ae.length>0&&w.push(T)}return w}Ze(()=>(a(),v()),()=>{r(b,a().attacks.filter(c=>{if(!v())return!0;const w=v().toLowerCase();return c.name.toLowerCase().includes(w)||c.damageType.toLowerCase().includes(w)}).sort((c,w)=>!c.spellRef&&w.spellRef?-1:c.spellRef&&!w.spellRef?1:0))}),Ze(()=>(v(),e(b)),()=>{r(q,!v()||e(b).length>0||"attack".includes(v().toLowerCase())||"spell".includes(v().toLowerCase()))}),jt(),yt();var ne=Ks();let Q;var Fe=l(ne),L=t(l(Fe),2),oe=l(L,!0);s(L),s(Fe);var J=t(Fe,2);{var m=c=>{var w=Ws(),ve=We(w),T=t(ve,2),ae=l(T);ut(ae,1,()=>e(b),Se=>Se.id,(Se,h,Te)=>{var Pe=Os(),Ke=l(Pe),et=l(Ke);De(et);var Ye=t(et,2);{var _=P=>{var U=$s();j("click",U,()=>be(e(h).id)),o(P,U)};S(Ye,P=>{C()&&P(_)})}s(Ke);var O=t(Ke,2),Y=l(O),he=t(l(Y),2);De(he),s(Y);var Oe=t(Y,2),Ee=t(l(Oe),2);De(Ee),s(Oe);var N=t(Oe,2),X=t(l(N),2);De(X),s(N),s(O);var y=t(O,2);{var Ae=P=>{var U=nt(),Z=We(U);{var p=R=>{var u=Ss();o(R,u)},F=R=>{const u=tt(()=>(e(h),i(()=>K(e(h).spellRef))));var ee=nt(),Le=We(ee);{var je=Re=>{var f=Hs(),le=We(f);{var $=it=>{var rt=Cs(),ot=t(l(rt),2),$t=l(ot,!0);s(ot),s(rt),I(()=>x($t,(e(h),i(()=>e(h).generalNotes)))),o(it,rt)};S(le,it=>{e(h),i(()=>e(h).generalNotes)&&it($)})}var pe=t(le,2),He=l(pe),Xe=t(l(He),2),Ge=l(Xe,!0);s(Xe),s(He);var Ue=t(He,2);{var Ie=it=>{var rt=Ds(),ot=l(rt),$t=t(l(ot));s(ot);var Rt=t(ot,2),na=t(l(Rt));s(Rt);var St=t(Rt,2),ht=t(l(St));s(St);var Pt=t(St,2),Et=t(l(Pt)),Vt=t(Et);{var It=Ve=>{var st=ft();I(()=>x(st,`(${E(e(u)),i(()=>e(u).material)??""})`)),o(Ve,st)};S(Vt,Ve=>{E(e(u)),i(()=>e(u).material)&&Ve(It)})}s(Pt);var Nt=t(Pt,2),Qt=t(l(Nt),2);{var Xt=Ve=>{var st=ft("Concentration,");o(Ve,st)};S(Qt,Ve=>{E(e(u)),i(()=>e(u).concentration)&&Ve(Xt)})}var ra=t(Qt,1,!0);s(Nt);var Gt=t(Nt,2),oa=t(l(Gt));s(Gt);var vt=t(Gt,2);{var dt=Ve=>{var st=Ls(),mt=t(l(st));s(st),I(()=>x(mt,` ${E(e(u)),i(()=>e(u).higherLevelSlot)??""}`)),o(Ve,st)};S(vt,Ve=>{E(e(u)),i(()=>e(u).higherLevelSlot)&&Ve(dt)})}s(rt),I(Ve=>{x($t,` ${E(e(u)),i(()=>e(u).level)??""}`),x(na,` ${E(e(u)),i(()=>e(u).castingTime||e(u).actionType)??""}`),x(ht,` ${E(e(u)),i(()=>e(u).range)??""}`),x(Et,` ${Ve??""}`),x(ra,(E(e(u)),i(()=>e(u).duration))),x(oa,` ${E(e(u)),i(()=>e(u).description)??""}`)},[()=>(E(e(u)),i(()=>e(u).components.join(", ")))]),o(it,rt)};S(Ue,it=>{e(H),e(h),i(()=>!e(H)[e(h).id])&&it(Ie)})}s(pe);var fe=t(pe,2);{var _e=it=>{const rt=tt(()=>(E(e(u)),i(()=>te(e(u)))));var ot=nt(),$t=We(ot);{var Rt=St=>{const ht=tt(()=>(E(ea),E(e(u)),i(()=>ea(e(u)))));var Pt=Ps(),Et=We(Pt),Vt=l(Et),It=t(Vt,2);I(()=>{e(h),Lt(()=>{e(rt)})}),ut(It,5,()=>e(rt),bt,(vt,dt)=>{var Ve=ws(),st=l(Ve);s(Ve);var mt={};I(()=>{x(st,`Level ${e(dt)??""}`),mt!==(mt=e(dt))&&(Ve.value=(Ve.__value=e(dt))??"")}),o(vt,Ve)}),s(It);var Nt=t(It,2);{var Qt=vt=>{const dt=tt(()=>(e(h),E(e(u)),i(()=>B(e(h),e(u)))));var Ve=js(),st=l(Ve);{var mt=Ct=>{var ct=ft("Healing");o(Ct,ct)},Ot=Ct=>{var ct=ft("Damage");o(Ct,ct)};S(st,Ct=>{E(e(u)),i(()=>Be(e(u)))?Ct(mt):Ct(Ot,!1)})}var wt=t(st);s(Ve),I(()=>x(wt,` ${e(dt)??""}`)),o(vt,Ve)};S(Nt,vt=>{e(h),E(e(u)),i(()=>e(h).castAtLevel&&e(h).castAtLevel>e(u).level)&&vt(Qt)})}s(Et);var Xt=t(Et,2);{var ra=vt=>{var dt=As(),Ve=l(dt),st=l(Ve);De(st);var mt=t(st,2);{var Ot=wt=>{const Ct=tt(()=>(e(h),E(e(u)),i(()=>B(e(h),e(u)))));var ct=Fs(),Ht=l(ct);s(ct),I(()=>x(Ht,`(+1d8, total: ${e(Ct)??""})`)),o(wt,ct)};S(mt,wt=>{e(h),i(()=>e(h).targetIsFiendOrUndead)&&wt(Ot)})}s(Ve),s(dt),sa(st,()=>e(h).targetIsFiendOrUndead,wt=>(e(h).targetIsFiendOrUndead=wt,Lt(()=>(e(b),a(),v())))),o(vt,dt)};S(Xt,vt=>{E(e(u)),i(()=>e(u).description.includes("Fiend or an Undead"))&&vt(ra)})}var Gt=t(Xt,2);{var oa=vt=>{var dt=Ms(),Ve=l(dt),st=l(Ve);De(st);var mt=t(st),Ot=t(mt);{var wt=ct=>{var Ht=Rs();o(ct,Ht)},Ct=ct=>{var Ht=nt(),Ea=We(Ht);{var Ha=ca=>{var Ua=Is();o(ca,Ua)};S(Ea,ca=>{e(h),E(e(ht)),i(()=>e(h).targetSucceededSave&&e(ht).noDamageOnSave)&&ca(Ha)},!0)}o(ct,Ht)};S(Ot,ct=>{e(h),E(e(ht)),i(()=>e(h).targetSucceededSave&&e(ht).halfDamageOnSave)?ct(wt):ct(Ct,!1)})}s(Ve),s(dt),I(ct=>x(mt,` Target succeeded on ${ct??""} save `),[()=>(E(e(ht)),i(()=>e(ht).ability.charAt(0).toUpperCase()+e(ht).ability.slice(1)))]),sa(st,()=>e(h).targetSucceededSave,ct=>(e(h).targetSucceededSave=ct,Lt(()=>(e(b),a(),v())))),o(vt,dt)};S(Gt,vt=>{e(ht)&&vt(oa)})}I(()=>{lt(Vt,"for",`castLevel-${e(h),i(()=>e(h).id)??""}`),lt(It,"id",`castLevel-${e(h),i(()=>e(h).id)??""}`)}),Ia(It,()=>e(h).castAtLevel,vt=>(e(h).castAtLevel=vt,Lt(()=>(e(b),a(),v())))),o(St,Pt)},na=St=>{var ht=Es();o(St,ht)};S($t,St=>{E(e(rt)),i(()=>e(rt).length>0)?St(Rt):St(na,!1)})}o(it,ot)};S(fe,it=>{E(e(u)),i(()=>e(u).higherLevelSlot&&e(u).level>0)&&it(_e)})}I(()=>{lt(Xe,"aria-label",(e(H),e(h),i(()=>e(H)[e(h).id]?"Expand":"Collapse"))),x(Ge,(e(H),e(h),i(()=>e(H)[e(h).id]?"â–¼":"â–²")))}),j("click",He,()=>W(e(h).id)),j("keydown",He,it=>it.key==="Enter"&&W(e(h).id)),o(Re,f)},de=Re=>{var f=Us();o(Re,f)};S(Le,Re=>{e(u)?Re(je):Re(de,!1)})}o(R,ee)};S(Z,R=>{e(ce),i(()=>e(ce).length===0)?R(p):R(F,!1)})}o(P,U)};S(y,P=>{e(h),i(()=>e(h).spellRef)&&P(Ae)})}var me=t(y,2);{var Ne=P=>{var U=Bs(),Z=t(l(U),2);zt(Z),s(U),Me(Z,()=>e(h).notes,p=>(e(h).notes=p,Lt(()=>(e(b),a(),v())))),o(P,U)};S(me,P=>{e(h),i(()=>!e(h).spellRef)&&P(Ne)})}var qe=t(me,2),Qe=l(qe);{var we=P=>{var U=Ts();j("click",U,()=>ue(e(h))),o(P,U)};S(Qe,P=>{e(h),i(()=>e(h).bonus!==0||!e(h).spellRef)&&P(we)})}var se=t(Qe,2);{var Ce=P=>{const U=tt(()=>(e(h),i(()=>K(e(h).spellRef))));var Z=Ns(),p=l(Z);{var F=u=>{var ee=ft("Roll Healing");o(u,ee)},R=u=>{var ee=ft("Roll Damage");o(u,ee)};S(p,u=>{E(e(U)),i(()=>e(U)&&Be(e(U)))?u(F):u(R,!1)})}s(Z),j("click",Z,()=>ke(e(h))),o(P,Z)},ze=P=>{var U=Gs();j("click",U,()=>ke(e(h))),o(P,U)};S(se,P=>{e(h),e(ge),i(()=>e(h).spellRef&&e(ge))?P(Ce):P(ze,!1)})}s(qe),s(Pe),Me(et,()=>e(h).name,P=>(e(h).name=P,Lt(()=>(e(b),a(),v())))),Me(he,()=>e(h).bonus,P=>(e(h).bonus=P,Lt(()=>(e(b),a(),v())))),Me(Ee,()=>e(h).damage,P=>(e(h).damage=P,Lt(()=>(e(b),a(),v())))),Me(X,()=>e(h).damageType,P=>(e(h).damageType=P,Lt(()=>(e(b),a(),v())))),o(Se,Pe)});var ye=t(ae,2);{var $e=Se=>{var h=qs();o(Se,h)},xe=Se=>{var h=nt(),Te=We(h);{var Pe=Ke=>{var et=zs();o(Ke,et)};S(Te,Ke=>{e(b),i(()=>e(b).length===0)&&Ke(Pe)},!0)}o(Se,h)};S(ye,Se=>{a(),i(()=>a().attacks.length===0)?Se($e):Se(xe,!1)})}s(T),j("click",ve,re),o(c,w)};S(J,c=>{k(),i(()=>!k().attacks)&&c(m)})}s(ne),I(()=>{Q=pt(ne,1,"attacks svelte-14o91c5",null,Q,{hidden:!e(q)}),lt(L,"aria-label",(k(),i(()=>k().attacks?"Expand":"Collapse"))),x(oe,(k(),i(()=>k().attacks?"â–¼":"â–²")))}),j("click",L,M),o(n,ne),kt(),G()}var Vs=g('<p class="no-features svelte-1kpvv0n">Select a class to see available features</p>'),Qs=g('<p class="no-features svelte-1kpvv0n">No class features available at this level</p>'),Xs=g('<input type="checkbox" class="slot-checkbox svelte-1kpvv0n"/>'),Ys=g('<div class="spell-slots svelte-1kpvv0n"><label class="svelte-1kpvv0n"> </label> <div class="slots-tracker svelte-1kpvv0n"></div></div>'),Zs=g('<div class="all-spell-slots"></div>'),el=g('<div class="feature-box spellcasting svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"> </h3> <div class="spell-stats svelte-1kpvv0n"><div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Spell Save DC</label> <div class="spell-value svelte-1kpvv0n"> </div></div> <div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <div class="spell-value svelte-1kpvv0n"> </div></div></div> <!> <div class="prepared-spells svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <textarea placeholder="List your prepared spells..." class="svelte-1kpvv0n"></textarea></div></div>'),tl=g('<p class="unlimited svelte-1kpvv0n">Unlimited Uses</p>'),al=g('<p class="no-uses svelte-1kpvv0n">No uses remaining</p>'),sl=g('<div class="uses-with-button svelte-1kpvv0n"><button class="btn btn-primary use-enabled"> </button> <div class="uses-info svelte-1kpvv0n"><span class="uses-remaining svelte-1kpvv0n"> </span> <span class="reset-info svelte-1kpvv0n"> </span></div> <!></div>'),ll=g('<div class="uses-tracker svelte-1kpvv0n"><!></div>'),il=g('<div class="pool-tracker svelte-1kpvv0n"><input type="number" min="0" class="pool-input svelte-1kpvv0n"/> <span> </span> <button class="btn-small svelte-1kpvv0n"> </button></div>'),nl=g('<p class="no-uses svelte-1kpvv0n">No Channel Divinity uses remaining</p>'),rl=g('<div class="channel-divinity-option svelte-1kpvv0n"><button class="btn btn-primary use-enabled svelte-1kpvv0n">Use Channel Divinity</button> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div> <!></div>'),ol=g('<div class="feature-box svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"><!> </h3> <p class="feature-description svelte-1kpvv0n"> </p> <!></div>'),cl=g('<div class="features-grid svelte-1kpvv0n"><!> <!></div>'),vl=g('<section><div class="header svelte-1kpvv0n"><h2 class="svelte-1kpvv0n">Class Features</h2> <button class="collapse-btn svelte-1kpvv0n"> </button></div> <!></section>');function dl(n,d){xt(d,!1);const a=()=>Je(V,"$character",D),v=()=>Je(la,"$abilityModifiers",D),k=()=>Je(At,"$searchFilter",D),C=()=>Je(gt,"$collapsedStates",D),[D,G]=Dt(),b=A(),q=A(),ie=A(),H=A(),W=A(),Be=A(),re=A();let be=A(0),ue=A(0);function ke(m,c){V.update(w=>(w.classFeatures.features[m]=c,w))}function M(){V.update(m=>(m.classFeatures.spellSlotsByLevel||(m.classFeatures.spellSlotsByLevel={}),e(H).forEach(({level:c,slots:w})=>{m.classFeatures.spellSlotsByLevel[c]||(m.classFeatures.spellSlotsByLevel[c]=Array(w).fill(!1))}),m))}function ce(m){if(typeof m.maxUses=="function"){if((m.name==="Divine Sense"||m.name==="War Priest")&&e(b)?.spellcastingAbility){const c=v()[e(b).spellcastingAbility];return m.maxUses(a().level,c)}return m.maxUses(a().level)}return m.maxUses||0}function ge(m){return typeof m.maxPool=="function"?m.maxPool(a().level):m.maxPool||0}function K(m){return typeof m.description=="function"?m.description(a().level):m.description}function z(){const m="ChannelDivinity";V.update(c=>{const w=c.classFeatures.features[m];return typeof w=="number"&&w>0&&(c.classFeatures.features[m]=w-1),c})}function B(){gt.update(m=>({...m,classFeatures:!m.classFeatures}))}Ze(()=>(a(),_t),()=>{r(b,a().class?_t(a().class):null)}),Ze(()=>(a(),Bt),()=>{r(q,a().class?Bt(a().class,a().level,a().subclass):[])}),Ze(()=>(a(),ya),()=>{r(ie,a().class?ya(a().class,a().level):0)}),Ze(()=>(e(b),a()),()=>{r(H,(()=>{if(!e(b)?.spellcaster)return[];const m=a().level,c=[];return m>=1&&c.push({level:1,slots:Math.min(4,2+Math.floor(m/3))}),m>=3&&c.push({level:2,slots:Math.min(3,2+Math.floor((m-3)/4))}),m>=5&&c.push({level:3,slots:Math.min(3,2+Math.floor((m-5)/5))}),m>=7&&c.push({level:4,slots:Math.min(3,1+Math.floor((m-7)/6))}),m>=9&&c.push({level:5,slots:Math.min(2,1+Math.floor((m-9)/8))}),m>=11&&c.push({level:6,slots:1}),m>=13&&c.push({level:7,slots:1}),m>=15&&c.push({level:8,slots:1}),m>=17&&c.push({level:9,slots:1}),c})())}),Ze(()=>(e(b),v(),a(),xa),()=>{if(e(b)?.spellcaster&&e(b).spellcastingAbility){const m=v()[e(b).spellcastingAbility];r(be,Za(a().class,m,a().proficiencyBonus)||0),r(ue,xa(a().class,a().level,m))}}),Ze(()=>(a(),e(b),e(H)),()=>{a().class&&e(b)?.spellcaster&&e(H).length>0&&M()}),Ze(()=>a(),()=>{r(W,(()=>{const c=a().classFeatures.features["ChannelDivinity"];return typeof c=="number"?c:0})())}),Ze(()=>(e(q),k()),()=>{r(Be,e(q).filter(m=>{if(!k())return!0;const c=k().toLowerCase();return m.name.toLowerCase().includes(c)||K(m).toLowerCase().includes(c)}))}),Ze(()=>(k(),a(),e(Be)),()=>{r(re,!k()||a().class||"class features".includes(k().toLowerCase())||"spellcasting".includes(k().toLowerCase())||e(Be).length>0)}),jt(),yt();var te=vl();let ne;var Q=l(te),Fe=t(l(Q),2),L=l(Fe,!0);s(Fe),s(Q);var oe=t(Q,2);{var J=m=>{var c=nt(),w=We(c);{var ve=ae=>{var ye=Vs();o(ae,ye)},T=ae=>{var ye=nt(),$e=We(ye);{var xe=h=>{var Te=Qs();o(h,Te)},Se=h=>{var Te=cl(),Pe=l(Te);{var Ke=Ye=>{var _=el(),O=l(_),Y=l(O);s(O);var he=t(O,2),Oe=l(he),Ee=t(l(Oe),2),N=l(Ee,!0);s(Ee),s(Oe);var X=t(Oe,2),y=t(l(X),2),Ae=l(y,!0);s(y),s(X),s(he);var me=t(he,2);{var Ne=we=>{var se=Zs();ut(se,5,()=>e(H),bt,(Ce,ze)=>{let P=()=>e(ze).level,U=()=>e(ze).slots;const Z=tt(()=>(a(),P(),U(),i(()=>a().classFeatures.spellSlotsByLevel?.[P()]||Array(U()).fill(!1))));var p=Ys(),F=l(p),R=l(F);s(F);var u=t(F,2);ut(u,5,()=>(U(),i(()=>Array(U()))),bt,(ee,Le,je)=>{var de=Xs();De(de),I(()=>qa(de,(E(e(Z)),i(()=>e(Z)[je]||!1)))),j("change",de,Re=>{V.update(f=>(f.classFeatures.spellSlotsByLevel||(f.classFeatures.spellSlotsByLevel={}),f.classFeatures.spellSlotsByLevel[P()]||(f.classFeatures.spellSlotsByLevel[P()]=Array(U()).fill(!1)),f.classFeatures.spellSlotsByLevel[P()][je]=Re.currentTarget.checked,f))}),o(ee,de)}),s(u),s(p),I(()=>x(R,`${P()===1?"1st":P()===2?"2nd":P()===3?"3rd":`${P()}th`} Level Spell Slots`)),o(Ce,p)}),s(se),o(we,se)};S(me,we=>{e(H),i(()=>e(H).length>0)&&we(Ne)})}var qe=t(me,2),Qe=t(l(qe),2);zt(Qe),s(qe),s(_),I(we=>{x(Y,`Spellcasting (${we??""})`),x(N,e(be)),x(Ae,e(ue))},[()=>(e(b),i(()=>e(b).spellcastingAbility?.toUpperCase()))]),Me(Qe,()=>a().classFeatures.preparedSpells,we=>at(V,i(a).classFeatures.preparedSpells=we,i(a))),o(Ye,_)};S(Pe,Ye=>{e(b),i(()=>e(b)?.spellcaster)&&Ye(Ke)})}var et=t(Pe,2);ut(et,1,()=>e(Be),bt,(Ye,_)=>{const O=tt(()=>(e(_),i(()=>e(_).name.replace(/\s+/g,"")))),Y=tt(()=>(a(),E(e(O)),i(()=>a().classFeatures.features[e(O)]))),he=tt(()=>(E(e(Y)),i(()=>Array.isArray(e(Y))))),Oe=tt(()=>typeof e(Y)=="number");var Ee=ol(),N=l(Ee),X=l(N);{var y=se=>{var Ce=ft("Channel Divinity:");o(se,Ce)};S(X,se=>{e(_),i(()=>e(_).type==="channelDivinity")&&se(y)})}var Ae=t(X);s(N);var me=t(N,2),Ne=l(me,!0);s(me);var qe=t(me,2);{var Qe=se=>{const Ce=tt(()=>(e(_),i(()=>ce(e(_))))),ze=tt(()=>(E(e(he)),E(e(Ce)),E(e(Y)),i(()=>e(he)?e(Y).filter(R=>!R).length:e(Ce))));var P=ll(),U=l(P);{var Z=F=>{var R=tl();o(F,R)},p=F=>{var R=sl(),u=l(R),ee=l(u);s(u);var Le=t(u,2),je=l(Le),de=l(je);s(je);var Re=t(je,2),f=l(Re);s(Re),s(Le);var le=t(Le,2);{var $=pe=>{var He=al();o(pe,He)};S(le,pe=>{e(ze)<=0&&pe($)})}s(R),I(()=>{u.disabled=e(ze)<=0,x(ee,`Use ${e(_),i(()=>e(_).name)??""}`),x(de,`${e(ze)??""} / ${e(Ce)??""} uses`),x(f,`Resets on ${e(_),i(()=>e(_).resetOn==="short"?"Short Rest":"Long Rest")??""}`)}),j("click",u,()=>{V.update(pe=>{pe.classFeatures.features[e(O)]||(pe.classFeatures.features[e(O)]=Array(e(Ce)).fill(!1));const He=pe.classFeatures.features[e(O)],Xe=He.findIndex(Ge=>!Ge);return Xe!==-1&&(He[Xe]=!0),pe})}),o(F,R)};S(U,F=>{e(Ce)===1/0?F(Z):F(p,!1)})}s(P),o(se,P)},we=se=>{var Ce=nt(),ze=We(Ce);{var P=Z=>{const p=tt(()=>(e(_),i(()=>ge(e(_)))));var F=il(),R=l(F);De(R);var u=t(R,2),ee=l(u);s(u);var Le=t(u,2),je=l(Le,!0);s(Le),s(F),I(()=>{ha(R,e(Oe)&&e(Y)!==void 0?e(Y):e(p)),lt(R,"max",e(p)),x(ee,`/ ${e(p)??""}`),x(je,(e(_),i(()=>e(_).resetOn==="short"?"Short Rest":"Long Rest")))}),j("input",R,de=>{V.update(Re=>(Re.classFeatures.features[e(O)]=parseInt(de.currentTarget.value)||0,Re))}),j("click",Le,()=>ke(e(O),e(p))),o(Z,F)},U=Z=>{var p=nt(),F=We(p);{var R=u=>{var ee=rl(),Le=l(ee),je=t(Le,2),de=l(je),Re=l(de);s(de),s(je);var f=t(je,2);{var le=$=>{var pe=nl();o($,pe)};S(f,$=>{e(W)<=0&&$(le)})}s(ee),I(()=>{Le.disabled=e(W)<=0,x(Re,`Resets on ${e(_),i(()=>e(_).resetOn==="short"?"Short Rest":"Long Rest")??""}`)}),j("click",Le,z),o(u,ee)};S(F,u=>{e(_),i(()=>e(_).type==="channelDivinity")&&u(R)},!0)}o(Z,p)};S(ze,Z=>{e(_),i(()=>e(_).type==="pool")?Z(P):Z(U,!1)},!0)}o(se,Ce)};S(qe,se=>{e(_),i(()=>e(_).type==="uses")?se(Qe):se(we,!1)})}s(Ee),I(se=>{x(Ae,` ${e(_),i(()=>e(_).name)??""}`),x(Ne,se)},[()=>(e(_),i(()=>K(e(_))))]),o(Ye,Ee)}),s(Te),o(h,Te)};S($e,h=>{e(q),i(()=>e(q).length===0)?h(xe):h(Se,!1)},!0)}o(ae,ye)};S(w,ae=>{a(),i(()=>!a().class)?ae(ve):ae(T,!1)})}o(m,c)};S(oe,m=>{C(),i(()=>!C().classFeatures)&&m(J)})}s(te),I(()=>{ne=pt(te,1,"class-features svelte-1kpvv0n",null,ne,{hidden:!e(re)}),lt(Fe,"aria-label",(C(),i(()=>C().classFeatures?"Expand":"Collapse"))),x(L,(C(),i(()=>C().classFeatures?"â–¼":"â–²")))}),j("click",Fe,B),o(n,te),kt(),G()}var ul=g('<textarea placeholder="Enter features, traits, and special abilities..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Equipment</h3> <textarea placeholder="List your equipment and inventory..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Notes</h3> <textarea placeholder="Additional notes..." class="svelte-wttn0l"></textarea>',1),pl=g('<section><div class="header svelte-wttn0l"><h2 class="svelte-wttn0l">Features & Traits</h2> <button class="collapse-btn svelte-wttn0l"> </button></div> <!></section>');function fl(n,d){xt(d,!1);const a=()=>Je(At,"$searchFilter",C),v=()=>Je(V,"$character",C),k=()=>Je(gt,"$collapsedStates",C),[C,D]=Dt(),G=A();function b(){gt.update(ue=>({...ue,notes:!ue.notes}))}Ze(()=>(a(),v()),()=>{r(G,!a()||"features".includes(a().toLowerCase())||"traits".includes(a().toLowerCase())||"equipment".includes(a().toLowerCase())||"notes".includes(a().toLowerCase())||v().features.toLowerCase().includes(a().toLowerCase())||v().equipment.toLowerCase().includes(a().toLowerCase())||v().notes.toLowerCase().includes(a().toLowerCase()))}),jt(),yt();var q=pl();let ie;var H=l(q),W=t(l(H),2),Be=l(W,!0);s(W),s(H);var re=t(H,2);{var be=ue=>{var ke=ul(),M=We(ke);zt(M);var ce=t(M,4);zt(ce);var ge=t(ce,4);zt(ge),Me(M,()=>v().features,K=>at(V,i(v).features=K,i(v))),Me(ce,()=>v().equipment,K=>at(V,i(v).equipment=K,i(v))),Me(ge,()=>v().notes,K=>at(V,i(v).notes=K,i(v))),o(ue,ke)};S(re,ue=>{k(),i(()=>!k().notes)&&ue(be)})}s(q),I(()=>{ie=pt(q,1,"notes svelte-wttn0l",null,ie,{hidden:!e(G)}),lt(W,"aria-label",(k(),i(()=>k().notes?"Expand":"Collapse"))),x(Be,(k(),i(()=>k().notes?"â–¼":"â–²")))}),j("click",W,b),o(n,q),kt(),D()}var bl=g('<div class="color-picker-section svelte-1r90jgp"><h3 class="svelte-1r90jgp">Dice Colors</h3> <div class="color-inputs svelte-1r90jgp"><div class="color-input-group svelte-1r90jgp"><label for="dice-color" class="svelte-1r90jgp">Dice Color</label> <input type="color" id="dice-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="label-color" class="svelte-1r90jgp">Label Color</label> <input type="color" id="label-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="desk-color" class="svelte-1r90jgp">Background Color</label> <input type="color" id="desk-color" class="svelte-1r90jgp"/></div></div></div>'),gl=g('<div class="loading svelte-1r90jgp"><p class="svelte-1r90jgp">Loading 3D dice...</p></div>'),hl=g('<div class="custom-dice-selector svelte-1r90jgp"><h3 class="svelte-1r90jgp">Choose Dice to Roll</h3> <div class="dice-inputs svelte-1r90jgp"><div class="dice-input-group svelte-1r90jgp"><label for="d4" class="svelte-1r90jgp">d4</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d4" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d6" class="svelte-1r90jgp">d6</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d6" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d8" class="svelte-1r90jgp">d8</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d8" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d10" class="svelte-1r90jgp">d10</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d10" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d12" class="svelte-1r90jgp">d12</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d12" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d20" class="svelte-1r90jgp">d20</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d20" min="0" max="10"/></div></div> <div class="dice-controls svelte-1r90jgp"><button class="btn btn-primary use-enabled svelte-1r90jgp"> </button> <button class="btn btn-secondary use-enabled svelte-1r90jgp">Reset</button></div></div>'),ml=g('<span class="crit-badge svelte-1r90jgp">CRITICAL!</span>'),_l=g('<p class="svelte-1r90jgp"> </p>'),yl=g('<p class="modifier-text svelte-1r90jgp"> </p>'),xl=g('<button class="btn btn-follow-up svelte-1r90jgp"> </button>'),kl=g('<button class="btn btn-guided-strike svelte-1r90jgp">âš¡ Use Guided Strike (+10)</button>'),$l=g('<div class="follow-up-actions svelte-1r90jgp"><!> <!></div>'),Sl=g('<div class="result-header svelte-1r90jgp"><h3 class="svelte-1r90jgp"> </h3> <!></div> <div class="result-total svelte-1r90jgp"> </div> <div class="result-details svelte-1r90jgp"><!> <!></div> <!>',1),Cl=g('<div role="button" tabindex="-1"><div class="modal-content svelte-1r90jgp" role="dialog" tabindex="0"><div class="modal-header svelte-1r90jgp"><h2 class="svelte-1r90jgp">Dice Roller</h2> <div class="header-buttons svelte-1r90jgp"><button class="color-btn svelte-1r90jgp" title="Customize dice colors">ðŸŽ¨</button> <button class="close-btn svelte-1r90jgp">Ã—</button></div></div> <!> <!> <div class="dice-main-area svelte-1r90jgp"><div class="dice-container svelte-1r90jgp"></div> <!></div> <div><!></div></div></div>');function Ll(n,d){xt(d,!1);const a=()=>Je(V,"$character",v),[v,k]=Dt(),C=A(),D=A(),G=A(),b=Tt();let q=Mt(d,"notation",12,""),ie=Mt(d,"visible",8,!1),H=Mt(d,"damageNotation",12,""),W=Mt(d,"attackName",12,""),Be=Mt(d,"applyHalfDamage",8,!1),re=null,be=A(void 0),ue=A(!1),ke=A(""),M=A(null);function ce(){return e(M)?.resultTotal??null}let ge=A(0),K=A(0),z=A(0),B=A(0),te=A(0),ne=A(0),Q=A(0),Fe=A([]),L=A(!1),oe=A("other"),J=A(!1),m=A("#051e0a"),c=A("#ffffff"),w=A("#3a2004"),ve=A(!1);function T(p){return p.length===9&&p.startsWith("#")?p.substring(0,7):p}function ae(p,F="ff"){return p.length===7&&p.startsWith("#")?p+F:p}function ye(){if(window.DICE&&e(be))try{re&&e(be)&&Fa(be,e(be).innerHTML="");const p=e(be).clientWidth||500,F=e(be).clientHeight||300;re=new window.DICE.dice_box(e(be),{w:p,h:F}),r(ue,!0)}catch(p){console.error("Error initializing dice box:",p)}}Jt(()=>{const p=u=>new Promise((ee,Le)=>{if(document.querySelector(`script[src="${u}"]`)){console.log(`Script already loaded: ${u}`),ee(null);return}const de=document.createElement("script");de.src=u,de.onload=()=>{console.log(`Loaded: ${u}`),ee(null)},de.onerror=()=>{console.error(`Failed to load: ${u}`),Le(new Error(`Failed to load ${u}`))},document.head.appendChild(de)});setTimeout(()=>{p(`${qt}/libs/three.min.js`).then(()=>p(`${qt}/libs/cannon.min.js`)).then(()=>p(`${qt}/libs/teal.js`)).then(()=>p(`${qt}/dice.js`)).then(()=>{if(console.log("All scripts loaded, initializing dice box..."),console.log("DICE available:",!!window.DICE),console.log("Container available:",!!e(be)),window.DICE){const u=window.DICE.getColors();r(m,T(u.dice_color)),r(c,T(u.label_color)),r(w,T(u.desk_color))}ye()}).catch(u=>{console.error("Failed to load dice libraries:",u)})},100);const F=()=>{e(ue)&&(console.log("Window resized, reinitializing dice box..."),ye())},R=u=>{ie()&&u.key==="Escape"&&Ye()};return window.addEventListener("resize",F),window.addEventListener("keydown",R),()=>{window.removeEventListener("resize",F),window.removeEventListener("keydown",R)}});function $e(p,F="other"){if(!re||!e(ue))return;console.log("Rolling dice:",p,"type:",F),r(oe,F),r(J,!1),re.diceToRoll=p;const R=ee=>(console.log("Before roll:",ee),null),u=ee=>{console.log("After roll:",ee);let Le=ee.resultTotal,je=ee.resultString;if(Be()&&(Le=Math.floor(Le/2),je=je+" (halved)"),r(M,{...ee,resultTotal:Le,resultString:je}),F==="attack"||F==="check"||F==="save"){const de=ee.results?.filter(Re=>Re.sides===20)||[];if(de.length>0){const Re=de[0].value;r(L,Re===20)}}if(r(Fe,[]),F==="attack"&&H())if(e(L)){const de=h(H());e(Fe).push({label:`Roll Critical Damage (${de})`,notation:de})}else e(Fe).push({label:`Roll Damage (${H()})`,notation:H()})};re.start_throw(R,u)}function xe(){const p=[];e(ge)>0&&p.push(`${e(ge)}d4`),e(K)>0&&p.push(`${e(K)}d6`),e(z)>0&&p.push(`${e(z)}d8`),e(B)>0&&p.push(`${e(B)}d10`),e(te)>0&&p.push(`${e(te)}d12`),e(ne)>0&&p.push(`${e(ne)}d20`);let F=p.join("+")||"1d20";return e(Q)!==0&&(F+=e(Q)>=0?`+${e(Q)}`:`${e(Q)}`),F}function Se(){const p=xe();$e(p)}function h(p){return p.replace(/(\d+)d(\d+)/g,(F,R,u)=>`${parseInt(R)*2}d${u}`)}function Te(){r(ge,0),r(K,0),r(z,0),r(B,0),r(te,0),r(ne,0),r(Q,0),r(M,null),r(Fe,[]),r(L,!1),r(oe,"other"),r(J,!1)}function Pe(){window.DICE&&(window.DICE.setColors({dice_color:ae(e(m),"ff"),label_color:ae(e(c),"ff"),desk_color:e(w)}),re&&(re.updateDeskColor(e(w)),re.updateDiceColors()))}function Ke(){r(ve,!e(ve))}function et(){!e(M)||e(D)<=0||e(J)||(r(M,{...e(M),resultTotal:e(M).resultTotal+10,resultString:e(M).resultString+" + 10 (Guided Strike)"}),V.update(p=>{const F="ChannelDivinity",R=p.classFeatures.features[F];return typeof R=="number"&&R>0&&(p.classFeatures.features[F]=R-1),p}),r(J,!0))}function Ye(){b("close"),q(""),H(""),W(""),r(ke,""),r(M,null),r(J,!1),Te()}Ze(()=>(a(),Bt),()=>{r(C,a().class?Bt(a().class,a().level,a().subclass).some(F=>F.name==="Guided Strike"):!1)}),Ze(()=>a(),()=>{r(D,(()=>{const F=a().classFeatures.features["ChannelDivinity"];return typeof F=="number"?F:0})())}),Ze(()=>(e(ge),e(K),e(z),e(B),e(te),e(ne),e(Q)),()=>{r(G,(()=>{const p=[];e(ge)>0&&p.push(`${e(ge)}d4`),e(K)>0&&p.push(`${e(K)}d6`),e(z)>0&&p.push(`${e(z)}d8`),e(B)>0&&p.push(`${e(B)}d10`),e(te)>0&&p.push(`${e(te)}d12`),e(ne)>0&&p.push(`${e(ne)}d20`);let F=p.join("+")||"1d20";return e(Q)!==0&&(F+=e(Q)>=0?`+${e(Q)}`:`${e(Q)}`),F})())}),Ze(()=>(E(q()),e(ue),E(ie()),e(ke),E(H()),E(W())),()=>{if(q()&&e(ue)&&ie()&&q()!==e(ke)){r(ke,q()),r(M,null),r(Fe,[]),r(L,!1),r(J,!1);const p=q().includes("1d20")?"attack":"other";console.log("Auto-roll triggered. notation:",q(),"damageNotation:",H(),"attackName:",W()),setTimeout(()=>$e(q(),p),200)}}),jt();var _={getLastRollTotal:ce};yt();var O=Cl();let Y;var he=l(O),Oe=l(he),Ee=t(l(Oe),2),N=l(Ee),X=t(N,2);s(Ee),s(Oe);var y=t(Oe,2);{var Ae=p=>{var F=bl(),R=t(l(F),2),u=l(R),ee=t(l(u),2);De(ee),s(u);var Le=t(u,2),je=t(l(Le),2);De(je),s(Le);var de=t(Le,2),Re=t(l(de),2);De(Re),s(de),s(R),s(F),Me(ee,()=>e(m),f=>r(m,f)),j("change",ee,Pe),Me(je,()=>e(c),f=>r(c,f)),j("change",je,Pe),Me(Re,()=>e(w),f=>r(w,f)),j("change",Re,Pe),o(p,F)};S(y,p=>{e(ve)&&p(Ae)})}var me=t(y,2);{var Ne=p=>{var F=gl();o(p,F)};S(me,p=>{e(ue)||p(Ne)})}var qe=t(me,2),Qe=l(qe);pa(Qe,p=>r(be,p),()=>e(be));var we=t(Qe,2);{var se=p=>{var F=hl(),R=t(l(F),2),u=l(R),ee=t(l(u),2);De(ee),s(u);var Le=t(u,2),je=t(l(Le),2);De(je),s(Le);var de=t(Le,2),Re=t(l(de),2);De(Re),s(de);var f=t(de,2),le=t(l(f),2);De(le),s(f);var $=t(f,2),pe=t(l($),2);De(pe),s($);var He=t($,2),Xe=t(l(He),2);De(Xe),s(He),s(R);var Ge=t(R,2),Ue=l(Ge),Ie=l(Ue);s(Ue);var fe=t(Ue,2);s(Ge),s(F),I(()=>{Ue.disabled=!e(ue),x(Ie,`Roll ${e(G)??""}`)}),Me(ee,()=>e(ge),_e=>r(ge,_e)),Me(je,()=>e(K),_e=>r(K,_e)),Me(Re,()=>e(z),_e=>r(z,_e)),Me(le,()=>e(B),_e=>r(B,_e)),Me(pe,()=>e(te),_e=>r(te,_e)),Me(Xe,()=>e(ne),_e=>r(ne,_e)),j("click",Ue,Se),j("click",fe,Te),o(p,F)};S(we,p=>{q()||p(se)})}s(qe);var Ce=t(qe,2);let ze;var P=l(Ce);{var U=p=>{var F=Sl(),R=We(F),u=l(R),ee=l(u,!0);s(u);var Le=t(u,2);{var je=Ue=>{var Ie=ml();o(Ue,Ie)};S(Le,Ue=>{e(L)&&Ue(je)})}s(R);var de=t(R,2),Re=l(de,!0);s(de);var f=t(de,2),le=l(f);{var $=Ue=>{var Ie=_l(),fe=l(Ie,!0);s(Ie),I(()=>x(fe,(e(M),i(()=>e(M).resultString)))),o(Ue,Ie)};S(le,Ue=>{e(M),i(()=>e(M).resultString)&&Ue($)})}var pe=t(le,2);{var He=Ue=>{var Ie=yl(),fe=l(Ie);s(Ie),I(()=>x(fe,`Modifier: ${e(M),i(()=>e(M).constant>=0?"+":"")??""}${e(M),i(()=>e(M).constant)??""}`)),o(Ue,Ie)};S(pe,Ue=>{e(M),i(()=>e(M).constant)&&Ue(He)})}s(f);var Xe=t(f,2);{var Ge=Ue=>{var Ie=$l(),fe=l(Ie);ut(fe,1,()=>e(Fe),bt,(rt,ot)=>{var $t=xl(),Rt=l($t,!0);s($t),I(()=>x(Rt,(e(ot),i(()=>e(ot).label)))),j("click",$t,()=>$e(e(ot).notation,"damage")),o(rt,$t)});var _e=t(fe,2);{var it=rt=>{var ot=kl();I(()=>{ot.disabled=e(D)<=0,lt(ot,"title",e(D)<=0?"No Channel Divinity uses remaining":"Use Channel Divinity to add +10 to this attack roll")}),j("click",ot,et),o(rt,ot)};S(_e,rt=>{e(C)&&e(oe)==="attack"&&!e(J)&&rt(it)})}s(Ie),o(Ue,Ie)};S(Xe,Ue=>{e(Fe),e(C),e(oe),e(J),i(()=>e(Fe).length>0||e(C)&&e(oe)==="attack"&&!e(J))&&Ue(Ge)})}I(()=>{x(ee,W()?`${W()} - Result`:"Result"),x(Re,(e(M),i(()=>e(M).resultTotal)))}),o(p,F)};S(P,p=>{e(M)&&p(U)})}s(Ce),s(he),s(O),I(()=>{Y=pt(O,1,"modal-overlay svelte-1r90jgp",null,Y,{hidden:!ie()}),ze=pt(Ce,1,"roll-result svelte-1r90jgp",null,ze,{"has-result":e(M)})}),j("click",N,Ke),j("click",X,Ye),j("click",he,ma(function(p){Ut.call(this,d,p)})),j("keydown",he,function(p){Ut.call(this,d,p)}),j("click",O,Ye),j("keydown",O,p=>p.key==="Escape"&&Ye()),o(n,O),Xa(d,"getLastRollTotal",ce);var Z=kt(_);return k(),Z}const ia="https://api.github.com/gists";async function Dl(n,d,a){if(!d)throw new Error("GitHub token is required");const v=JSON.stringify(n,null,2),k=`${n.name||"character"}_dnd.json`,C={description:a||`D&D Character: ${n.name}`,public:!1,files:{[k]:{content:v}}},D=await fetch(ia,{method:"POST",headers:{Authorization:`token ${d}`,"Content-Type":"application/json"},body:JSON.stringify(C)});if(!D.ok)throw new Error(`Failed to create gist: ${D.statusText}`);return(await D.json()).id}async function wl(n,d,a){if(!d||!a)throw new Error("GitHub token and Gist ID are required");const v=JSON.stringify(n,null,2),C={files:{[`${n.name||"character"}_dnd.json`]:{content:v}}},D=await fetch(`${ia}/${a}`,{method:"PATCH",headers:{Authorization:`token ${d}`,"Content-Type":"application/json"},body:JSON.stringify(C)});if(!D.ok)throw new Error(`Failed to update gist: ${D.statusText}`)}async function jl(n,d){if(!n)throw new Error("Gist ID is required");const a={"Content-Type":"application/json"};d&&(a.Authorization=`token ${d}`);const v=await fetch(`${ia}/${n}`,{method:"GET",headers:a});if(!v.ok)throw new Error(`Failed to load gist: ${v.statusText}`);const k=await v.json(),C=Object.values(k.files);if(C.length===0)throw new Error("No files found in gist");const G=C[0].content;try{const b=JSON.parse(G);return b.attacks&&Array.isArray(b.attacks)&&(b.attacks=b.attacks.map(q=>({...q,id:q.id||crypto.randomUUID()}))),b.classFeatures?(b.classFeatures.features||(b.classFeatures.features={}),b.classFeatures.spellSlots||(b.classFeatures.spellSlots=[]),b.classFeatures.preparedSpells===void 0&&(b.classFeatures.preparedSpells="")):b.classFeatures={features:{},spellSlots:[],preparedSpells:""},b}catch{throw new Error("Invalid character data in gist")}}function $a(n){typeof window<"u"&&localStorage.setItem("dnd_gist_config",JSON.stringify(n))}function Fl(){if(typeof window<"u"){const n=localStorage.getItem("dnd_gist_config");if(n)return JSON.parse(n)}return{}}async function Al(n,d=30){if(!n)throw new Error("GitHub token is required to list gists");const a=await fetch(`${ia}?per_page=${d}`,{method:"GET",headers:{Authorization:`token ${n}`,"Content-Type":"application/json"}});if(!a.ok)throw new Error(`Failed to list gists: ${a.statusText}`);return await a.json()}var Rl=g('<div class="error-message svelte-1jb5ckg"> </div>'),Il=g('<div class="toggle-container svelte-1jb5ckg"><button type="button" class="toggle-btn svelte-1jb5ckg"> </button></div>'),Ml=g('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID (leave empty to create new)</label> <input type="text" id="gistId" placeholder="Optional: existing Gist ID to update" class="svelte-1jb5ckg"/></div>'),Pl=g('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),El=g('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),Hl=g('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Update (or leave unselected to create new)</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),Ul=g('<div class="info-message svelte-1jb5ckg">No gists found. A new one will be created.</div>'),Bl=g('<!> <div class="form-group svelte-1jb5ckg"><label for="description" class="svelte-1jb5ckg"> </label> <input type="text" id="description" placeholder="D&amp;D Character Sheet" class="svelte-1jb5ckg"/></div>',1),Tl=g('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID *</label> <input type="text" id="gistId" placeholder="Enter Gist ID (for public or your private gists)" required class="svelte-1jb5ckg"/></div>'),Nl=g('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),Gl=g('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),Ol=g('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Load</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),ql=g('<div class="info-message svelte-1jb5ckg">No gists found. Enter a Gist ID manually or create a new one in Save mode.</div>'),zl=g('<div class="modal-overlay svelte-1jb5ckg" role="button" tabindex="-1"><div class="modal-content svelte-1jb5ckg" role="dialog" tabindex="0"><div class="modal-header svelte-1jb5ckg"><h2 class="svelte-1jb5ckg"> </h2> <button class="close-btn svelte-1jb5ckg">Ã—</button></div> <div class="modal-body svelte-1jb5ckg"><!> <div class="form-group svelte-1jb5ckg"><label for="token" class="svelte-1jb5ckg"> <a href="https://github.com/settings/tokens" target="_blank" rel="noopener" class="svelte-1jb5ckg">Get token</a></label> <input type="password" id="token" placeholder="ghp_xxxxxxxxxxxxx" class="svelte-1jb5ckg"/></div> <!> <!> <div class="modal-actions svelte-1jb5ckg"><button class="btn btn-primary svelte-1jb5ckg"><!></button> <button class="btn btn-secondary svelte-1jb5ckg">Cancel</button></div></div></div></div>');function Wl(n,d){xt(d,!1);const a=()=>Je(V,"$character",v),[v,k]=Dt(),C=Tt();let D=Mt(d,"mode",8,"save"),G=A(""),b=A(""),q=A(""),ie=A(!1),H=A(""),W=A(!1),Be=A(!1),re=A([]),be=A(null);const ue=Fl();ue.token&&r(G,ue.token),ue.gistId&&r(b,ue.gistId),Jt(async()=>{e(G)&&!e(W)&&await ke()});async function ke(){if(e(G)){r(Be,!0),r(H,"");try{r(re,await Al(e(G))),e(b)&&r(be,e(re).find(_=>_.id===e(b))||null)}catch(_){r(H,_.message||"Failed to load gists"),r(re,[])}finally{r(Be,!1)}}}function M(_){r(be,_),r(b,_.id)}function ce(){r(W,!e(W)),r(H,""),!e(W)&&e(G)&&ke()}async function ge(){if(!e(G)){r(H,"GitHub token is required");return}const _=e(be)?.id||e(b);r(ie,!0),r(H,"");try{if(_)await wl(a(),e(G),_),r(b,_),Wt.add("Character updated in Gist successfully!","success");else{const O=await Dl(a(),e(G),e(q));r(b,O),Wt.add(`Character saved to Gist! ID: ${O}`,"success")}$a({token:e(G),gistId:e(b)}),C("close")}catch(O){r(H,O.message||"Failed to save to Gist")}finally{r(ie,!1)}}async function K(){const _=e(be)?.id||e(b);if(!_){r(H,"Please select a gist or enter a Gist ID");return}r(ie,!0),r(H,"");try{const O=await jl(_,e(G)||void 0);V.set(O),r(b,_),$a({token:e(G),gistId:e(b)}),Wt.add("Character loaded from Gist successfully!","success"),C("close")}catch(O){r(H,O.message||"Failed to load from Gist")}finally{r(ie,!1)}}function z(){C("close")}yt();var B=zl(),te=l(B),ne=l(te),Q=l(ne),Fe=l(Q,!0);s(Q);var L=t(Q,2);s(ne);var oe=t(ne,2),J=l(oe);{var m=_=>{var O=Rl(),Y=l(O,!0);s(O),I(()=>x(Y,e(H))),o(_,O)};S(J,_=>{e(H)&&_(m)})}var c=t(J,2),w=l(c),ve=l(w);Aa(),s(w);var T=t(w,2);De(T),s(c);var ae=t(c,2);{var ye=_=>{var O=Il(),Y=l(O),he=l(Y,!0);s(Y),s(O),I(()=>{Y.disabled=e(ie),x(he,e(W)?"ðŸ“‹ Show My Gists":"âœï¸ Enter Gist ID Manually")}),j("click",Y,ce),o(_,O)};S(ae,_=>{(D()==="load"||D()==="save"&&e(G))&&_(ye)})}var $e=t(ae,2);{var xe=_=>{var O=Bl(),Y=We(O);{var he=Ae=>{var me=Ml(),Ne=t(l(me),2);De(Ne),s(me),I(()=>Ne.disabled=e(ie)),Me(Ne,()=>e(b),qe=>r(b,qe)),o(Ae,me)},Oe=Ae=>{var me=nt(),Ne=We(me);{var qe=we=>{var se=Pl();o(we,se)},Qe=we=>{var se=nt(),Ce=We(se);{var ze=U=>{var Z=Hl(),p=t(l(Z),2);ut(p,5,()=>e(re),bt,(F,R)=>{var u=El();let ee;var Le=l(u),je=l(Le),de=l(je,!0);s(je);var Re=t(je,2),f=l(Re,!0);s(Re),s(Le);var le=t(Le,2),$=l(le),pe=l($);s($);var He=t($,2),Xe=l(He);s(He),s(le),s(u),I(Ge=>{ee=pt(u,1,"gist-item svelte-1jb5ckg",null,ee,{selected:e(be)?.id===e(R).id}),u.disabled=e(ie),x(de,(e(R),i(()=>e(R).description||"Untitled"))),x(f,(e(R),i(()=>e(R).public?"ðŸŒ Public":"ðŸ”’ Private"))),x(pe,`ID: ${e(R),i(()=>e(R).id)??""}`),x(Xe,`Updated: ${Ge??""}`)},[()=>(e(R),i(()=>new Date(e(R).updated_at).toLocaleDateString()))]),j("click",u,()=>M(e(R))),o(F,u)}),s(p),s(Z),o(U,Z)},P=U=>{var Z=nt(),p=We(Z);{var F=R=>{var u=Ul();o(R,u)};S(p,R=>{e(G)&&R(F)},!0)}o(U,Z)};S(Ce,U=>{e(re),i(()=>e(re).length>0)?U(ze):U(P,!1)},!0)}o(we,se)};S(Ne,we=>{e(Be)?we(qe):we(Qe,!1)},!0)}o(Ae,me)};S(Y,Ae=>{e(W)||!e(G)?Ae(he):Ae(Oe,!1)})}var Ee=t(Y,2),N=l(Ee),X=l(N);s(N);var y=t(N,2);De(y),s(Ee),I(()=>{x(X,`Description ${e(b)?"(optional)":""}`),y.disabled=e(ie)}),Me(y,()=>e(q),Ae=>r(q,Ae)),o(_,O)},Se=_=>{var O=nt(),Y=We(O);{var he=Ee=>{var N=Tl(),X=t(l(N),2);De(X),s(N),I(()=>X.disabled=e(ie)),Me(X,()=>e(b),y=>r(b,y)),o(Ee,N)},Oe=Ee=>{var N=nt(),X=We(N);{var y=me=>{var Ne=Nl();o(me,Ne)},Ae=me=>{var Ne=nt(),qe=We(Ne);{var Qe=se=>{var Ce=Ol(),ze=t(l(Ce),2);ut(ze,5,()=>e(re),bt,(P,U)=>{var Z=Gl();let p;var F=l(Z),R=l(F),u=l(R,!0);s(R);var ee=t(R,2),Le=l(ee,!0);s(ee),s(F);var je=t(F,2),de=l(je),Re=l(de);s(de);var f=t(de,2),le=l(f);s(f),s(je),s(Z),I($=>{p=pt(Z,1,"gist-item svelte-1jb5ckg",null,p,{selected:e(be)?.id===e(U).id}),Z.disabled=e(ie),x(u,(e(U),i(()=>e(U).description||"Untitled"))),x(Le,(e(U),i(()=>e(U).public?"ðŸŒ Public":"ðŸ”’ Private"))),x(Re,`ID: ${e(U),i(()=>e(U).id)??""}`),x(le,`Updated: ${$??""}`)},[()=>(e(U),i(()=>new Date(e(U).updated_at).toLocaleDateString()))]),j("click",Z,()=>M(e(U))),o(P,Z)}),s(ze),s(Ce),o(se,Ce)},we=se=>{var Ce=nt(),ze=We(Ce);{var P=U=>{var Z=ql();o(U,Z)};S(ze,U=>{e(G)&&U(P)},!0)}o(se,Ce)};S(qe,se=>{e(re),i(()=>e(re).length>0)?se(Qe):se(we,!1)},!0)}o(me,Ne)};S(X,me=>{e(Be)?me(y):me(Ae,!1)},!0)}o(Ee,N)};S(Y,Ee=>{e(W)||!e(G)?Ee(he):Ee(Oe,!1)})}o(_,O)};S($e,_=>{D()==="save"?_(xe):_(Se,!1)})}var h=t($e,2),Te=l(h),Pe=l(Te);{var Ke=_=>{var O=ft();I(()=>x(O,D()==="save"?"Saving...":"Loading...")),o(_,O)},et=_=>{var O=ft();I(()=>x(O,D()==="save"?"Save":"Load")),o(_,O)};S(Pe,_=>{e(ie)?_(Ke):_(et,!1)})}s(Te);var Ye=t(Te,2);s(h),s(oe),s(te),s(B),I(()=>{x(Fe,D()==="save"?"Save to GitHub Gist":"Load from GitHub Gist"),x(ve,`GitHub Token ${D()==="load"?"(optional for public gists)":"(required)"} `),T.disabled=e(ie),Te.disabled=e(ie),Ye.disabled=e(ie)}),j("click",L,z),Me(T,()=>e(G),_=>r(G,_)),j("blur",T,()=>{e(G)&&!e(W)&&ke()}),j("click",Te,function(..._){(D()==="save"?ge:K)?.apply(this,_)}),j("click",Ye,z),j("click",te,ma(function(_){Ut.call(this,d,_)})),j("keydown",te,function(_){Ut.call(this,d,_)}),j("click",B,z),j("keydown",B,_=>_.key==="Escape"&&z()),o(n,B),kt(),k()}var Kl=g('<div class="loading svelte-1ngjemu">Loading D&D data...</div>'),Jl=g("<option> </option>"),Vl=g('<select class="level-filter svelte-1ngjemu"><option>All Levels</option><option>Cantrip</option><!></select>'),Ql=g('<div class="no-results svelte-1ngjemu"> </div>'),Xl=g('<div class="item-meta svelte-1ngjemu"> </div>'),Yl=g('<div class="item-meta svelte-1ngjemu"> </div>'),Zl=g('<button><div class="item-name svelte-1ngjemu"> </div> <!></button>'),ei=g('<p class="higher-levels"><strong>At Higher Levels:</strong> </p>'),ti=g('<p class="cantrip-upgrade"><strong>Cantrip Upgrade:</strong> </p>'),ai=g('<h3 class="svelte-1ngjemu"> </h3> <p class="spell-meta svelte-1ngjemu"><!> <!></p> <p class="spell-classes"><strong>Classes:</strong> </p> <div class="spell-stats svelte-1ngjemu"><div><strong>Casting Time:</strong> </div> <div><strong>Range:</strong> </div> <div><strong>Components:</strong> <!></div> <div><strong>Duration:</strong> <!> </div></div> <p class="description svelte-1ngjemu"> </p> <!> <!>',1),si=g('<p class="prerequisite svelte-1ngjemu"><strong>Prerequisite:</strong> </p>'),li=g('<h3 class="svelte-1ngjemu"> </h3> <!> <p class="description svelte-1ngjemu"> </p> <a target="_blank" rel="noopener" class="source-link svelte-1ngjemu">View Full Details â†’</a>',1),ii=g('<div class="item-details svelte-1ngjemu"><!></div>'),ni=g('<div class="controls svelte-1ngjemu"><div class="tabs svelte-1ngjemu"><button> </button> <button> </button></div> <div class="search-controls svelte-1ngjemu"><input type="text" placeholder="Search by name or description..." class="search-input svelte-1ngjemu"/> <!></div></div> <div class="content-container svelte-1ngjemu"><div class="items-list svelte-1ngjemu"><!></div> <!></div>',1),ri=g('<div class="modal-backdrop svelte-1ngjemu" role="presentation"><div class="modal svelte-1ngjemu" role="dialog" aria-modal="true" tabindex="-1"><div class="modal-header svelte-1ngjemu"><h2 class="svelte-1ngjemu">Browse D&D Spells & Feats</h2> <button class="close-btn svelte-1ngjemu" aria-label="Close">&times;</button></div> <div class="modal-body svelte-1ngjemu"><!></div> <div class="modal-footer svelte-1ngjemu"><button class="btn-secondary svelte-1ngjemu">Cancel</button> <button class="btn-primary svelte-1ngjemu">Add to Character Sheet</button></div></div></div>');function oi(n,d){xt(d,!1);const a=A(),v=A(),k=A();let C=Mt(d,"onClose",8),D=A("spell"),G=A(!0),b=A(""),q=A(null),ie=A([]),H=A([]),W=A(null);Jt(async()=>{r(G,!0);try{r(ie,await Pa()),r(H,await ys())}catch(L){console.error("Failed to load data:",L)}finally{r(G,!1)}});function Be(L){r(W,L)}function re(L){const oe=L.match(/(\d+d\d+(?:\s*\+\s*\d+)?)/i);return oe?oe[1]:""}function be(L){const oe=L.split(/\.( |$)/)[0].trim(),J=Array.from(L.matchAll(/\*\*(.*?)\*\*/g)).map(c=>c[1].replace(/\.$/,""));let m=oe;return J.length&&(m+=" | Effects: "+J.join(", ")),m}function ue(){if(e(W)){if(e(D)==="spell"){const L=e(W);V.update(oe=>{const m=[];L.range&&m.push(`Range: ${L.range}`),L.castingTime&&m.push(`Cast: ${L.castingTime}`),L.duration&&m.push(`Duration: ${L.duration}`),L.actionType==="Save"&&m.push("Saving throw spell"),L.components&&L.components.length>0&&m.push(`Components: ${L.components.join(", ")}`),L.material&&m.push(`Material: ${L.material}`);const c=m.join(" | "),w=be(L.description),ve={id:crypto.randomUUID(),name:`${L.name}${L.concentration?" (C)":""}${L.ritual?" (R)":""}`,bonus:L.actionType==="Attack"?5:0,damage:re(L.description),damageType:`${L.school} (Lvl ${L.level})`,spellRef:L.name,infoNotes:c,generalNotes:w,castAtLevel:L.level};return oe.attacks=[...oe.attacks,ve],oe})}else if(e(D)==="feat"){const L=e(W);V.update(oe=>{const J=`${L.name}${L.prerequisite?` (Req: ${L.prerequisite})`:""}
${L.description}
`;return oe.features=oe.features?`${oe.features}
${J}`:J,oe})}r(W,null),C()()}}Ze(()=>(e(q),e(ie),e(b)),()=>{r(a,e(q)!==null?xs(ka(e(ie),e(b)),e(q)):ka(e(ie),e(b)))}),Ze(()=>(e(H),e(b)),()=>{r(v,ks(e(H),e(b)))}),Ze(()=>(e(D),e(a),e(v)),()=>{r(k,e(D)==="spell"?e(a):e(v))}),jt(),yt();var ke=ri(),M=l(ke),ce=l(M),ge=t(l(ce),2);s(ce);var K=t(ce,2),z=l(K);{var B=L=>{var oe=Kl();o(L,oe)},te=L=>{var oe=ni(),J=We(oe),m=l(J),c=l(m);let w;var ve=l(c);s(c);var T=t(c,2);let ae;var ye=l(T);s(T),s(m);var $e=t(m,2),xe=l($e);De(xe);var Se=t(xe,2);{var h=Y=>{var he=Vl();I(()=>{e(q),Lt(()=>{})});var Oe=l(he);Oe.value=(Oe.__value=null)??"";var Ee=t(Oe);Ee.value=Ee.__value=0;var N=t(Ee);ut(N,0,()=>[1,2,3,4,5,6,7,8,9],bt,(X,y)=>{var Ae=Jl(),me=l(Ae);s(Ae);var Ne={};I(()=>{x(me,`Level ${y??""}`),Ne!==(Ne=y)&&(Ae.value=(Ae.__value=y)??"")}),o(X,Ae)}),s(he),Ia(he,()=>e(q),X=>r(q,X)),o(Y,he)};S(Se,Y=>{e(D)==="spell"&&Y(h)})}s($e),s(J);var Te=t(J,2),Pe=l(Te),Ke=l(Pe);{var et=Y=>{var he=Ql(),Oe=l(he);s(he),I(()=>x(Oe,`No ${e(D)??""}s found`)),o(Y,he)},Ye=Y=>{var he=nt(),Oe=We(he);ut(Oe,1,()=>e(k),bt,(Ee,N)=>{var X=Zl();let y;var Ae=l(X),me=l(Ae,!0);s(Ae);var Ne=t(Ae,2);{var qe=we=>{const se=tt(()=>e(N));var Ce=Xl(),ze=l(Ce);s(Ce),I(()=>x(ze,`Level ${E(e(se)),i(()=>e(se).level)??""} â€¢ ${E(e(se)),i(()=>e(se).school)??""}`)),o(we,Ce)},Qe=we=>{const se=tt(()=>e(N));var Ce=nt(),ze=We(Ce);{var P=U=>{var Z=Yl(),p=l(Z,!0);s(Z),I(()=>x(p,(E(e(se)),i(()=>e(se).prerequisite)))),o(U,Z)};S(ze,U=>{E(e(se)),i(()=>e(se).prerequisite)&&U(P)})}o(we,Ce)};S(Ne,we=>{e(D)==="spell"?we(qe):we(Qe,!1)})}s(X),I(()=>{y=pt(X,1,"item-card svelte-1ngjemu",null,y,{selected:e(W)?.name===e(N).name}),x(me,(e(N),i(()=>e(N).name)))}),j("click",X,()=>Be(e(N))),o(Ee,X)}),o(Y,he)};S(Ke,Y=>{e(k),i(()=>e(k).length===0)?Y(et):Y(Ye,!1)})}s(Pe);var _=t(Pe,2);{var O=Y=>{var he=ii(),Oe=l(he);{var Ee=X=>{const y=tt(()=>e(W));var Ae=ai(),me=We(Ae),Ne=l(me,!0);s(me);var qe=t(me,2),Qe=l(qe);{var we=fe=>{var _e=ft();I(()=>x(_e,`${E(e(y)),i(()=>e(y).school)??""} cantrip`)),o(fe,_e)},se=fe=>{var _e=ft();I(()=>x(_e,`Level ${E(e(y)),i(()=>e(y).level)??""} ${E(e(y)),i(()=>e(y).school)??""}`)),o(fe,_e)};S(Qe,fe=>{E(e(y)),i(()=>e(y).level===0)?fe(we):fe(se,!1)})}var Ce=t(Qe,2);{var ze=fe=>{var _e=ft("(ritual)");o(fe,_e)};S(Ce,fe=>{E(e(y)),i(()=>e(y).ritual)&&fe(ze)})}s(qe);var P=t(qe,2),U=t(l(P));s(P);var Z=t(P,2),p=l(Z),F=t(l(p));s(p);var R=t(p,2),u=t(l(R));s(R);var ee=t(R,2),Le=t(l(ee)),je=t(Le);{var de=fe=>{var _e=ft();I(()=>x(_e,`(${E(e(y)),i(()=>e(y).material)??""})`)),o(fe,_e)};S(je,fe=>{E(e(y)),i(()=>e(y).material)&&fe(de)})}s(ee);var Re=t(ee,2),f=t(l(Re),2);{var le=fe=>{var _e=ft("Concentration,");o(fe,_e)};S(f,fe=>{E(e(y)),i(()=>e(y).concentration)&&fe(le)})}var $=t(f,1,!0);s(Re),s(Z);var pe=t(Z,2),He=l(pe,!0);s(pe);var Xe=t(pe,2);{var Ge=fe=>{var _e=ei(),it=t(l(_e));s(_e),I(()=>x(it,` ${E(e(y)),i(()=>e(y).higherLevelSlot)??""}`)),o(fe,_e)};S(Xe,fe=>{E(e(y)),i(()=>e(y).higherLevelSlot)&&fe(Ge)})}var Ue=t(Xe,2);{var Ie=fe=>{var _e=ti(),it=t(l(_e));s(_e),I(()=>x(it,` ${E(e(y)),i(()=>e(y).cantripUpgrade)??""}`)),o(fe,_e)};S(Ue,fe=>{E(e(y)),i(()=>e(y).cantripUpgrade)&&fe(Ie)})}I((fe,_e)=>{x(Ne,(E(e(y)),i(()=>e(y).name))),x(U,` ${fe??""}`),x(F,` ${E(e(y)),i(()=>e(y).castingTime||e(y).actionType)??""}`),x(u,` ${E(e(y)),i(()=>e(y).range)??""}`),x(Le,` ${_e??""}`),x($,(E(e(y)),i(()=>e(y).duration))),x(He,(E(e(y)),i(()=>e(y).description)))},[()=>(E(e(y)),i(()=>e(y).classes.join(", "))),()=>(E(e(y)),i(()=>e(y).components.join(", ").toUpperCase()))]),o(X,Ae)},N=X=>{const y=tt(()=>e(W));var Ae=li(),me=We(Ae),Ne=l(me,!0);s(me);var qe=t(me,2);{var Qe=ze=>{var P=si(),U=t(l(P));s(P),I(()=>x(U,` ${E(e(y)),i(()=>e(y).prerequisite)??""}`)),o(ze,P)};S(qe,ze=>{E(e(y)),i(()=>e(y).prerequisite)&&ze(Qe)})}var we=t(qe,2),se=l(we,!0);s(we);var Ce=t(we,2);I(()=>{x(Ne,(E(e(y)),i(()=>e(y).name))),x(se,(E(e(y)),i(()=>e(y).description))),lt(Ce,"href",(E(e(y)),i(()=>e(y).source)))}),o(X,Ae)};S(Oe,X=>{e(D)==="spell"?X(Ee):X(N,!1)})}s(he),o(Y,he)};S(_,Y=>{e(W)&&Y(O)})}s(Te),I(()=>{w=pt(c,1,"tab svelte-1ngjemu",null,w,{active:e(D)==="spell"}),x(ve,`ðŸ“œ Spells (${e(ie),i(()=>e(ie).length)??""})`),ae=pt(T,1,"tab svelte-1ngjemu",null,ae,{active:e(D)==="feat"}),x(ye,`â­ Feats (${e(H),i(()=>e(H).length)??""})`)}),j("click",c,()=>{r(D,"spell"),r(W,null),r(b,"")}),j("click",T,()=>{r(D,"feat"),r(W,null),r(b,"")}),Me(xe,()=>e(b),Y=>r(b,Y)),o(L,oe)};S(z,L=>{e(G)?L(B):L(te,!1)})}s(K);var ne=t(K,2),Q=l(ne),Fe=t(Q,2);s(ne),s(M),s(ke),I(()=>Fe.disabled=!e(W)),j("click",ge,function(...L){C()?.apply(this,L)}),j("click",Q,function(...L){C()?.apply(this,L)}),j("click",Fe,ue),j("click",M,ma(function(L){Ut.call(this,d,L)})),j("keydown",M,function(L){Ut.call(this,d,L)}),j("click",ke,function(...L){C()?.apply(this,L)}),j("keydown",ke,L=>L.key==="Escape"&&C()()),o(n,ke),kt()}var ci=g('<link rel="icon" type="image/png" href="/favicon.png"/> <meta name="viewport" content="width=device-width, initial-scale=1"/>',1),vi=g('<span class="character-name svelte-1uha8ag"> </span>'),di=g("<span> </span>"),ui=g('<div class="spell-slots-header svelte-1uha8ag"></div>'),pi=g('<div class="rest-menu svelte-1uha8ag"><button class="rest-option svelte-1uha8ag">â˜• Short Rest</button> <button class="rest-option svelte-1uha8ag">ðŸ›ï¸ Long Rest</button></div>'),fi=g('<div class="container svelte-1uha8ag"><header class="svelte-1uha8ag"><div class="header-top svelte-1uha8ag"><div class="header-title svelte-1uha8ag"><div class="title-row svelte-1uha8ag"><h1 class="svelte-1uha8ag">D&D Character Sheet</h1> <!></div> <!></div> <div class="header-right svelte-1uha8ag"><div class="header-controls svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">ðŸŽ²</span><span class="btn-text svelte-1uha8ag">Roll Dice</span></button> <div class="rest-button-container svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">ðŸ˜´</span><span class="btn-text svelte-1uha8ag">Rest</span></button> <!></div> <div class="mode-toggle"><button><span class="btn-icon svelte-1uha8ag"> </span><span class="btn-text svelte-1uha8ag"> </span></button></div></div> <div class="header-search svelte-1uha8ag"><input type="text" placeholder="ðŸ” Search..." class="search-input use-enabled svelte-1uha8ag"/></div></div></div> <div class="header-actions svelte-1uha8ag"><button class="btn btn-mode svelte-1uha8ag">ðŸ“š Browse Spells & Feats</button> <button class="btn btn-secondary">Save to Gist</button> <button class="btn btn-secondary">Load from Gist</button> <button class="btn btn-secondary">Export JSON</button> <button class="btn btn-secondary">Import JSON</button> <input type="file" accept=".json" style="display: none;"/></div></header> <main class="svelte-1uha8ag"><!> <!> <!> <!> <!> <!> <!></main></div> <!> <!> <!> <!>',1);function $i(n,d){xt(d,!1);const a=()=>Je(V,"$character",C),v=()=>Je(ta,"$isEditMode",C),k=()=>Je(At,"$searchFilter",C),[C,D]=Dt();function G(){const f=[],le=a().classFeatures.spellSlotsByLevel||{};for(let $=1;$<=9;$++){const pe=le[$];if(pe&&pe.length>0){const He=pe.length,Xe=pe.filter(Ge=>Ge).length;f.push({level:$,available:He-Xe,total:He})}}return f}let b=A(!1),q=A(!1),ie=A(!1),H=A("save"),W=A(void 0),Be=A(""),re=A(""),be=A(""),ue=A(!1),ke=A(),M=!1,ce=A(!1);function ge(){const f=[];V.update($=>{const pe=$.hitDice.current;$.hitDice.current=Math.min($.hitDice.max,$.hitDice.current+Math.max(1,Math.floor($.hitDice.max/2)));const He=$.hitDice.current-pe;if(He>0&&f.push(`${He} hit ${He===1?"die":"dice"}`),$.class){const Xe=Bt($.class,$.level,$.subclass);$.classFeatures.features||($.classFeatures.features={}),Xe.forEach(Ge=>{if(Ge.resetOn==="short"){const Ue=Ge.name.replace(/\s+/g,"");if(Ge.type==="uses"){const Ie=typeof Ge.maxUses=="function"?Ge.maxUses($.level):Ge.maxUses;$.classFeatures.features[Ue]=Array(Ie).fill(!1),f.push(Ge.name)}else if(Ge.type==="pool"){const Ie=typeof Ge.maxPool=="function"?Ge.maxPool($.level):Ge.maxPool;Ie!==void 0&&($.classFeatures.features[Ue]=Ie,f.push(Ge.name))}}})}return $}),r(ce,!1);const le=f.length>0?`Short rest taken! Restored: ${f.join(", ")}`:"Short rest taken!";Wt.add(le,"success")}function K(){const f=[];V.update($=>{const pe=$.maxHP-$.currentHP;pe>0&&f.push(`${pe} HP`),$.currentHP=$.maxHP,$.tempHP=0;const He=$.hitDice.max-$.hitDice.current;He>0&&f.push(`${He} hit ${He===1?"die":"dice"}`),$.hitDice.current=$.hitDice.max;let Xe=0;if($.classFeatures.spellSlotsByLevel&&Object.keys($.classFeatures.spellSlotsByLevel).forEach(Ge=>{const Ue=$.classFeatures.spellSlotsByLevel[parseInt(Ge)];if(Ue){const Ie=Ue.filter(fe=>fe).length;Xe+=Ie,$.classFeatures.spellSlotsByLevel[parseInt(Ge)]=Array(Ue.length).fill(!1)}}),Xe>0&&f.push(`${Xe} spell ${Xe===1?"slot":"slots"}`),$.class){const Ge=Bt($.class,$.level,$.subclass);$.classFeatures.features||($.classFeatures.features={});let Ue=!1;Ge.forEach(Ie=>{const fe=Ie.name.replace(/\s+/g,"");if(!(Ie.type==="info"||Ie.type==="channelDivinity")){if(Ie.type==="uses"){const _e=typeof Ie.maxUses=="function"?Ie.maxUses($.level):Ie.maxUses;$.classFeatures.features[fe]=Array(_e).fill(!1),Ue=!0}else if(Ie.type==="pool"){const _e=typeof Ie.maxPool=="function"?Ie.maxPool($.level):Ie.maxPool;_e!==void 0&&($.classFeatures.features[fe]=_e,Ue=!0)}}}),Ue&&f.push("all class features")}return $}),r(ce,!1);const le=f.length>0?`Long rest taken! Restored: ${f.join(", ")}`:"Long rest taken! Fully rested.";Wt.add(le,"success")}function z(f){r(Be,""),r(re,""),r(be,""),r(ue,!1),M=!1,typeof f=="string"?r(Be,f):(r(Be,f.notation),r(re,f.damageNotation||""),r(be,f.attackName||""),r(ue,!!f.applyHalfDamage)),r(b,!0)}function B(f){const{notation:le}=f.detail;r(Be,""),M=!0,setTimeout(()=>{r(Be,le),r(re,""),r(be,"Hit Die")},0),r(b,!0)}function te(){if(r(b,!1),M&&e(ke)){const f=e(ke).getLastRollTotal();if(f!==null){const le=Math.max(1,f);V.update($=>($.hitDice.current=Math.max(0,$.hitDice.current-1),$.currentHP=Math.min($.maxHP,$.currentHP+le),$))}M=!1}}function ne(){console.log("toggleMode called, current isEditMode:",v()),ta.update(f=>(console.log("Updating isEditMode from",f,"to",!f),!f))}function Q(f){f.target.closest(".rest-button-container")||r(ce,!1)}Jt(()=>{console.log("onMount - initial isEditMode:",v()),console.log("onMount - body classes:",document.body.className);const f=ta.subscribe(le=>{console.log("isEditMode subscription triggered, value:",le),console.log("Body classes before:",document.body.className),le?(document.body.classList.remove("use-mode"),console.log("Removed use-mode class (Edit Mode)")):(document.body.classList.add("use-mode"),console.log("Added use-mode class (Use Mode)")),console.log("Body classes after:",document.body.className)});return document.addEventListener("click",Q),()=>{f(),document.removeEventListener("click",Q)}});function Fe(){Ka(a())}function L(){e(W)?.click()}async function oe(f){const $=f.target.files?.[0];if($)try{const pe=await Ja($);V.set(pe),alert("Character imported successfully!")}catch{alert("Failed to import character file")}}yt();var J=fi();za("1uha8ag",f=>{var le=ci();Aa(2),La(()=>{Oa.title="D&D Character Sheet"}),o(f,le)});var m=We(J),c=l(m),w=l(c),ve=l(w),T=l(ve),ae=t(l(T),2);{var ye=f=>{var le=vi(),$=l(le,!0);s(le),I(()=>x($,a().name)),o(f,le)};S(ae,f=>{a().name&&f(ye)})}s(T);var $e=t(T,2);{var xe=f=>{var le=ui();ut(le,5,G,bt,($,pe)=>{var He=di();let Xe;var Ge=l(He);s(He),I(()=>{Xe=pt(He,1,"slot-badge svelte-1uha8ag",null,Xe,{depleted:e(pe).available===0}),x(Ge,`Lv${e(pe).level??""}: ${e(pe).available??""}/${e(pe).total??""}`)}),o($,He)}),s(le),o(f,le)};S($e,f=>{G().length>0&&f(xe)})}s(ve);var Se=t(ve,2),h=l(Se),Te=l(h),Pe=t(Te,2),Ke=l(Pe),et=t(Ke,2);{var Ye=f=>{var le=pi(),$=l(le),pe=t($,2);s(le),j("click",$,ge),j("click",pe,K),o(f,le)};S(et,f=>{e(ce)&&f(Ye)})}s(Pe);var _=t(Pe,2),O=l(_);let Y;var he=l(O),Oe=l(he,!0);s(he);var Ee=t(he),N=l(Ee,!0);s(Ee),s(O),s(_),s(h);var X=t(h,2),y=l(X);De(y),s(X),s(Se),s(w);var Ae=t(w,2),me=l(Ae),Ne=t(me,2),qe=t(Ne,2),Qe=t(qe,2),we=t(Qe,2),se=t(we,2);pa(se,f=>r(W,f),()=>e(W)),s(Ae),s(c);var Ce=t(c,2),ze=l(Ce);ns(ze,{});var P=t(ze,2);bs(P,{$$events:{rollHitDice:B}});var U=t(P,2);vs(U,{$$events:{roll:f=>z(f.detail)}});var Z=t(U,2);_s(Z,{$$events:{roll:f=>z(f.detail)}});var p=t(Z,2);Js(p,{$$events:{roll:f=>z(f.detail)}});var F=t(p,2);dl(F,{});var R=t(F,2);fl(R,{}),s(Ce),s(m);var u=t(m,2);pa(Ll(u,{get notation(){return e(Be)},get damageNotation(){return e(re)},get attackName(){return e(be)},get applyHalfDamage(){return e(ue)},get visible(){return e(b)},$$events:{close:te},$$legacy:!0}),f=>r(ke,f),()=>e(ke));var ee=t(u,2);{var Le=f=>{Wl(f,{get mode(){return e(H)},$$events:{close:()=>r(q,!1)}})};S(ee,f=>{e(q)&&f(Le)})}var je=t(ee,2);{var de=f=>{oi(f,{onClose:()=>r(ie,!1)})};S(je,f=>{e(ie)&&f(de)})}var Re=t(je,2);Wa(Re,{}),I(()=>{Y=pt(O,1,"btn btn-mode svelte-1uha8ag",null,Y,{"use-mode":!v()}),x(Oe,v()?"ðŸ“":"ðŸŽ²"),x(N,v()?"Edit Mode":"Use Mode")}),j("click",Te,()=>r(b,!0)),j("click",Ke,()=>r(ce,!e(ce))),j("click",O,ne),Me(y,k,f=>Va(At,f)),j("click",me,()=>r(ie,!0)),j("click",Ne,()=>{r(H,"save"),r(q,!0)}),j("click",qe,()=>{r(H,"load"),r(q,!0)}),j("click",Qe,Fe),j("click",we,L),j("change",se,oe),o(n,J),kt(),D()}export{$i as component};
