import{f,e as j,a as o,s as y,c as rt,t as ft}from"../chunks/BmKkCgmR.js";import{i as yt}from"../chunks/AFJ5q3G2.js";import{c as Gt,o as Qt}from"../chunks/BwhX61NF.js";import{a6 as Fa,i as Aa,b1 as Oa,b2 as qa,b3 as ka,J as At,e as Ra,b4 as Ia,aa as za,b as i,r as Ma,R as Pa,g as Wa,B as xt,b5 as et,b6 as jt,E as M,F as kt,s as r,a3 as A,G as l,I as a,H as s,d as e,C as We,k as tt,z as U,b7 as Ct,b8 as Kt,b9 as Ea,an as Ha,ba as Ka}from"../chunks/CmcvLP-Y.js";import{s as it,c as X,a as gt,r as Ce,e as vt,i as bt,b as $a,u as Ua,d as Rt,f as dt,g as Xt,j as la,k as Ja,t as Jt,h as Va,T as Qa,l as Xa,m as Ya}from"../chunks/BH0g7pxY.js";import{i as $,s as Lt,a as Ke,b as at,d as Za}from"../chunks/BibxXT0t.js";import{p as Et,b as ma}from"../chunks/BNYf2NzH.js";import{b as Wt,r as es}from"../chunks/CDTvVYaj.js";function ia(n,v,t=!1){if(n.multiple){if(v==null)return;if(!Aa(v))return Oa();for(var c of n.options)c.selected=v.includes(Vt(c));return}for(c of n.options){var S=Vt(c);if(qa(S,v)){c.selected=!0;return}}(!t||v!==void 0)&&(n.selectedIndex=-1)}function _a(n){var v=new MutationObserver(()=>{ia(n,n.__value)});v.observe(n,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Fa(()=>{v.disconnect()})}function Ba(n,v,t=v){var c=new WeakSet,S=!0;ka(n,"change",C=>{var D=C?"[selected]":":checked",B;if(n.multiple)B=[].map.call(n.querySelectorAll(D),Vt);else{var _=n.querySelector(D)??n.querySelector("option:not([disabled])");B=_&&Vt(_)}t(B),At!==null&&c.add(At)}),Ra(()=>{var C=v();if(n===document.activeElement){var D=Ia??At;if(c.has(D))return}if(ia(n,C,S),S&&C===void 0){var B=n.querySelector(":checked");B!==null&&(C=Vt(B),t(C))}n.__value=C,S=!1}),_a(n)}function Vt(n){return"__value"in n?n.__value:n.value}function Ie(n,v,t=v){var c=new WeakSet;ka(n,"input",async S=>{var C=S?n.defaultValue:n.value;if(C=ba(n)?ga(C):C,t(C),At!==null&&c.add(At),await za(),C!==(C=v())){var D=n.selectionStart,B=n.selectionEnd,_=n.value.length;if(n.value=C??"",B!==null){var P=n.value.length;D===B&&B===_&&P>_?(n.selectionStart=P,n.selectionEnd=P):(n.selectionStart=D,n.selectionEnd=Math.min(B,P))}}}),(Pa&&n.defaultValue!==n.value||i(v)==null&&n.value)&&(t(ba(n)?ga(n.value):n.value),At!==null&&c.add(At)),Ma(()=>{var S=v();if(n===document.activeElement){var C=Ia??At;if(c.has(C))return}ba(n)&&S===ga(n.value)||n.type==="date"&&!S&&!n.value||S!==n.value&&(n.value=S??"")})}function na(n,v,t=v){ka(n,"change",c=>{var S=c?n.defaultChecked:n.checked;t(S)}),(Pa&&n.defaultChecked!==n.checked||i(v)==null)&&t(n.checked),Ma(()=>{var c=v();n.checked=!!c})}function ba(n){var v=n.type;return v==="number"||v==="range"}function ga(n){return n===""?null:+n}function ts(n,v,t){var c=Wa(n,v);c&&c.set&&(n[v]=t,Fa(()=>{n[v]=null}))}function Sa(n){return function(...v){var t=v[0];return t.stopPropagation(),n?.apply(this,v)}}function Tt(n,v){var t=n.$$events?.[v.type],c=Aa(t)?t.slice():t==null?[]:[t];for(var S of c)S.call(this,v)}const as="";function Ta(...n){return Wt+as+es(n[0],n[1])}const ya={paladin:{name:"Paladin",hitDice:"d10",spellcaster:!0,spellcastingAbility:"charisma",spellSlotsByLevel:{1:0,2:2,3:3,4:3,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Divine Sense",type:"uses",maxUses:(n,v=1)=>1+Math.max(1,v),resetOn:"long",description:"Detect celestials, fiends, and undead within 60 feet",minLevel:1},{name:"Lay on Hands",type:"pool",maxPool:n=>n*5,resetOn:"long",description:"Heal wounds or cure disease",minLevel:1},{name:"Divine Smite",type:"spellSlot",description:"Expend spell slot to deal extra radiant damage",minLevel:2,rollable:!0},{name:"Channel Divinity",type:"pool",maxPool:n=>n>=18?3:n>=6?2:1,resetOn:"short",description:"Sacred Weapon or Turn Undead",minLevel:3}]},fighter:{name:"Fighter",hitDice:"d10",spellcaster:!1,features:[{name:"Second Wind",type:"uses",maxUses:1,resetOn:"short",description:"Regain 1d10 + fighter level HP as bonus action",minLevel:1,rollable:!0,rollFormula:n=>`1d10+${n}`},{name:"Action Surge",type:"uses",maxUses:n=>n>=17?2:1,resetOn:"short",description:"Take one additional action on your turn",minLevel:2},{name:"Indomitable",type:"uses",maxUses:n=>n>=17?3:n>=13?2:1,resetOn:"long",description:"Reroll a failed saving throw",minLevel:9}],subclasses:{champion:{name:"Champion",features:[{name:"Improved Critical",type:"info",description:"Critical hit on 19-20",minLevel:3},{name:"Remarkable Athlete",type:"info",description:"Add half proficiency to STR/DEX/CON checks, increase long jump distance",minLevel:7},{name:"Additional Fighting Style",type:"info",description:"Choose a second fighting style",minLevel:10},{name:"Superior Critical",type:"info",description:"Critical hit on 18-20",minLevel:15},{name:"Survivor",type:"info",description:"Regain 5 + CON mod HP at start of turn if below half HP",minLevel:18}]},battlemaster:{name:"Battle Master",features:[{name:"Combat Superiority",type:"uses",maxUses:n=>n>=15?6:n>=7?5:4,resetOn:"short",description:n=>`Use superiority dice (${n>=18?"d12":n>=10?"d10":"d8"}) for maneuvers`,minLevel:3},{name:"Know Your Enemy",type:"info",description:"Learn capabilities of creatures you observe",minLevel:7},{name:"Improved Combat Superiority",type:"info",description:"Superiority dice become d10",minLevel:10},{name:"Relentless",type:"info",description:"Regain 1 superiority die if you have none at start of turn",minLevel:15}]}}},rogue:{name:"Rogue",hitDice:"d8",spellcaster:!1,features:[{name:"Sneak Attack",type:"info",description:n=>`Deal ${Math.ceil(n/2)}d6 extra damage once per turn with advantage or ally nearby`,minLevel:1,rollable:!0,rollFormula:n=>`${Math.ceil(n/2)}d6`},{name:"Cunning Action",type:"info",description:"Dash, Disengage, or Hide as a bonus action",minLevel:2},{name:"Uncanny Dodge",type:"info",description:"Use reaction to halve damage from an attack",minLevel:5},{name:"Evasion",type:"info",description:"Take no damage on successful Dex save (half on fail)",minLevel:7}]},wizard:{name:"Wizard",hitDice:"d6",spellcaster:!0,spellcastingAbility:"intelligence",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Arcane Recovery",type:"uses",maxUses:1,resetOn:"long",description:n=>`Recover spell slots totaling up to ${Math.ceil(n/2)} levels during short rest`,minLevel:1},{name:"Spell Mastery",type:"info",description:"Cast one 1st-level and one 2nd-level spell at will",minLevel:18}]},cleric:{name:"Cleric",hitDice:"d8",spellcaster:!0,spellcastingAbility:"wisdom",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Channel Divinity",type:"pool",maxPool:n=>n>=18?3:n>=6?2:1,resetOn:"short",description:"Turn Undead or domain-specific ability",minLevel:2},{name:"Destroy Undead",type:"info",description:n=>`Channel Divinity destroys undead of CR ${n>=17?4:n>=14?3:n>=11?2:n>=8?1:.5} or lower`,minLevel:5},{name:"Divine Intervention",type:"uses",maxUses:1,resetOn:"long",description:n=>`${n}% chance to succeed, implore deity for aid`,minLevel:10}],subclasses:{war:{name:"War Domain",features:[{name:"War Priest",type:"uses",maxUses:(n,v=1)=>Math.max(1,v),resetOn:"long",description:"Make one weapon attack as a bonus action",minLevel:1},{name:"Guided Strike",type:"channelDivinity",description:"Use your Channel Divinity to gain +10 to an attack roll. Make this choice after you see the roll, but before the DM says whether the attack hits or misses.",minLevel:2,resetOn:"short"},{name:"War God's Blessing",type:"channelDivinity",description:"Use reaction to grant +10 to an ally's attack roll within 30 feet. Consumes one use of Channel Divinity.",minLevel:6,resetOn:"short"},{name:"Divine Strike",type:"info",description:n=>`Deal extra ${n>=14?"2d8":"1d8"} weapon damage once per turn`,minLevel:8,rollable:!0,rollFormula:n=>n>=14?"2d8":"1d8"},{name:"Avatar of Battle",type:"info",description:"Gain resistance to nonmagical weapon damage",minLevel:17}]},life:{name:"Life Domain",features:[{name:"Disciple of Life",type:"info",description:"Healing spells restore additional 2 + spell level HP",minLevel:1},{name:"Preserve Life",type:"pool",maxPool:n=>n*5,resetOn:"short",description:"Restore HP to creatures within 30 feet",minLevel:2},{name:"Blessed Healer",type:"info",description:"Regain 2 + spell level HP when you cast healing spell",minLevel:6},{name:"Divine Strike",type:"info",description:n=>`Deal extra ${n>=14?"2d8":"1d8"} radiant damage once per turn`,minLevel:8,rollable:!0,rollFormula:n=>n>=14?"2d8":"1d8"},{name:"Supreme Healing",type:"info",description:"Maximize healing dice instead of rolling",minLevel:17}]}}},barbarian:{name:"Barbarian",hitDice:"d12",spellcaster:!1,features:[{name:"Rage",type:"uses",maxUses:n=>n>=20?1/0:n>=17?6:n>=12?5:n>=6?4:n>=3?3:2,resetOn:"long",description:n=>`+${n>=16?4:n>=9?3:2} damage, resistance to physical damage`,minLevel:1},{name:"Reckless Attack",type:"info",description:"Gain advantage on melee attacks, enemies get advantage on you",minLevel:2},{name:"Danger Sense",type:"info",description:"Advantage on Dex saves against effects you can see",minLevel:2}],subclasses:{berserker:{name:"Path of the Berserker",features:[{name:"Frenzy",type:"info",description:"While raging, make melee attack as bonus action (gain 1 exhaustion after rage)",minLevel:3},{name:"Mindless Rage",type:"info",description:"Cannot be charmed or frightened while raging",minLevel:6},{name:"Intimidating Presence",type:"info",description:"Use action to frighten creature within 30 feet",minLevel:10},{name:"Retaliation",type:"info",description:"When damaged by creature within 5 feet, make melee attack as reaction",minLevel:14}]}}}};function _t(n){const v=n.toLowerCase();return ya[v]||null}function Nt(n,v,t){const c=_t(n);if(!c)return[];const S=c.features.filter(C=>!C.minLevel||C.minLevel<=v);if(t&&c.subclasses&&c.subclasses[t]){const C=c.subclasses[t].features.filter(D=>!D.minLevel||D.minLevel<=v);return[...S,...C]}return S}function Ca(n){const v=_t(n);return!v||!v.subclasses?[]:Object.keys(v.subclasses).map(t=>({id:t,name:v.subclasses[t].name}))}function La(n,v){const t=_t(n);return!t||!t.spellcaster||!t.spellSlotsByLevel?0:t.spellSlotsByLevel[v]||0}function Da(n,v,t){const c=_t(n);return!c||!c.spellcaster?0:Math.max(1,t+v)}function ss(n,v,t){const c=_t(n);return!c||!c.spellcaster?null:8+v+t}function ls(){return Object.keys(ya).map(n=>({id:n,name:ya[n].name}))}var is=f("<option> </option>"),ns=f("<option> </option>"),rs=f('<div class="form-group svelte-172i2fj"><label for="characterSubclass" class="svelte-172i2fj">Subclass</label> <select id="characterSubclass" class="svelte-172i2fj"><option>Select Subclass</option><!></select></div>'),os=f('<div class="info-grid svelte-172i2fj"><div class="form-group svelte-172i2fj"><label for="characterName" class="svelte-172i2fj">Character Name</label> <input type="text" id="characterName" placeholder="Enter name" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterClass" class="svelte-172i2fj">Class</label> <select id="characterClass" class="svelte-172i2fj"><option>Select Class</option><!></select></div> <!> <div class="form-group svelte-172i2fj"><label for="characterLevel" class="svelte-172i2fj">Level</label> <input type="number" id="characterLevel" min="1" max="20" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterRace" class="svelte-172i2fj">Race</label> <input type="text" id="characterRace" placeholder="e.g., Human" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterBackground" class="svelte-172i2fj">Background</label> <input type="text" id="characterBackground" placeholder="e.g., Soldier" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterAlignment" class="svelte-172i2fj">Alignment</label> <input type="text" id="characterAlignment" placeholder="e.g., Lawful Good" class="svelte-172i2fj"/></div></div>'),cs=f('<section class="character-info svelte-172i2fj"><div class="header svelte-172i2fj"><h2 class="svelte-172i2fj">Character Info</h2> <button class="collapse-btn svelte-172i2fj"> </button></div> <!></section>');function vs(n,v){xt(v,!1);const t=()=>Ke(X,"$character",S),c=()=>Ke(gt,"$collapsedStates",S),[S,C]=Lt(),D=A(),B=ls();function _(E){const ye=E.target;X.update(ue=>(ue.class=ye.value,ue.subclass="",ue))}function P(E){const ye=E.target;X.update(ue=>(ue.subclass=ye.value,ue))}function ne(E){const ye=E.target;X.update(ue=>(ue.level=parseInt(ye.value)||1,ue)),Ua()}function J(){gt.update(E=>({...E,characterInfo:!E.characterInfo}))}et(()=>(t(),Ca),()=>{r(D,t().class?Ca(t().class):[])}),jt(),yt();var T=cs(),He=l(T),re=a(l(He),2),me=l(re,!0);s(re),s(He);var de=a(He,2);{var Le=E=>{var ye=os(),ue=l(ye),oe=a(l(ue),2);Ce(oe),s(ue);var K=a(ue,2),G=a(l(K),2),Y=l(G);Y.value=Y.__value="";var pe=a(Y);vt(pe,1,()=>B,bt,(ee,De)=>{var fe=is(),ze=l(fe,!0);s(fe);var be={};M(()=>{y(ze,(e(De),i(()=>e(De).name))),be!==(be=(e(De),i(()=>e(De).id)))&&(fe.value=(fe.__value=(e(De),i(()=>e(De).id)))??"")}),o(ee,fe)}),s(G);var V;_a(G),s(K);var Fe=a(K,2);{var L=ee=>{var De=rs(),fe=a(l(De),2),ze=l(fe);ze.value=ze.__value="";var be=a(ze);vt(be,1,()=>e(D),bt,(Ne,Qe)=>{var Xe=ns(),Je=l(Xe,!0);s(Xe);var m={};M(()=>{y(Je,(e(Qe),i(()=>e(Qe).name))),m!==(m=(e(Qe),i(()=>e(Qe).id)))&&(Xe.value=(Xe.__value=(e(Qe),i(()=>e(Qe).id)))??"")}),o(Ne,Xe)}),s(fe);var b;_a(fe),s(De),M(()=>{b!==(b=(t(),i(()=>t().subclass)))&&(fe.value=(fe.__value=(t(),i(()=>t().subclass)))??"",ia(fe,(t(),i(()=>t().subclass))))}),j("change",fe,P),o(ee,De)};$(Fe,ee=>{e(D),i(()=>e(D).length>0)&&ee(L)})}var le=a(Fe,2),Q=a(l(le),2);Ce(Q),s(le);var g=a(le,2),I=a(l(g),2);Ce(I),s(g);var p=a(g,2),O=a(l(p),2);Ce(O),s(p);var Z=a(p,2),q=a(l(Z),2);Ce(q),s(Z),s(ye),M(()=>{V!==(V=(t(),i(()=>t().class)))&&(G.value=(G.__value=(t(),i(()=>t().class)))??"",ia(G,(t(),i(()=>t().class)))),$a(Q,(t(),i(()=>t().level)))}),Ie(oe,()=>t().name,ee=>at(X,i(t).name=ee,i(t))),j("change",G,_),j("change",Q,ne),Ie(I,()=>t().race,ee=>at(X,i(t).race=ee,i(t))),Ie(O,()=>t().background,ee=>at(X,i(t).background=ee,i(t))),Ie(q,()=>t().alignment,ee=>at(X,i(t).alignment=ee,i(t))),o(E,ye)};$(de,E=>{c(),i(()=>!c().characterInfo)&&E(Le)})}s(T),M(()=>{it(re,"aria-label",(c(),i(()=>c().characterInfo?"Expand":"Collapse"))),y(me,(c(),i(()=>c().characterInfo?"â–¼":"â–²")))}),j("click",re,J),o(n,T),kt(),C()}var ds=f('<div class="ability-card svelte-bbv1xt"><h3 class="svelte-bbv1xt"> </h3> <input type="number" class="ability-score svelte-bbv1xt" min="1" max="30"/> <div class="ability-modifier svelte-bbv1xt"> </div> <button class="roll-btn svelte-bbv1xt">Check</button> <div class="save-row svelte-bbv1xt"><input type="checkbox" class="svelte-bbv1xt"/> <label class="svelte-bbv1xt">Save</label> <button class="roll-btn-small svelte-bbv1xt">Roll</button></div></div>'),us=f('<div class="proficiency-bonus svelte-bbv1xt"><label for="profBonus">Proficiency Bonus</label> <input type="number" id="profBonus" class="prof-input svelte-bbv1xt"/></div> <div class="abilities-grid svelte-bbv1xt"></div>',1),ps=f('<section><div class="header svelte-bbv1xt"><h2 class="svelte-bbv1xt">Ability Scores</h2> <button class="collapse-btn svelte-bbv1xt"> </button></div> <!></section>');function fs(n,v){xt(v,!1);const t=()=>Ke(Xt,"$abilityModifiers",D),c=()=>Ke(X,"$character",D),S=()=>Ke(Rt,"$searchFilter",D),C=()=>Ke(gt,"$collapsedStates",D),[D,B]=Lt(),_=A(),P=A(),ne=Gt(),J=[{key:"strength",label:"Strength"},{key:"dexterity",label:"Dexterity"},{key:"constitution",label:"Constitution"},{key:"intelligence",label:"Intelligence"},{key:"wisdom",label:"Wisdom"},{key:"charisma",label:"Charisma"}];function T(){Ua()}function He(G){const Y=t()[G],pe=`1d20${Y>=0?"+":""}${Y}`;ne("roll",pe)}function re(G){const Y=t()[G],pe=c().saveProficiencies[G]?c().proficiencyBonus:0,V=Y+pe,Fe=`1d20${V>=0?"+":""}${V}`;ne("roll",Fe)}function me(){gt.update(G=>({...G,abilityScores:!G.abilityScores}))}et(()=>S(),()=>{r(_,J.filter(({label:G})=>S()?G.toLowerCase().includes(S().toLowerCase()):!0))}),et(()=>(e(_),S()),()=>{r(P,e(_).length>0||!S()||S().toLowerCase().includes("proficiency"))}),jt(),yt();var de=ps();let Le;var E=l(de),ye=a(l(E),2),ue=l(ye,!0);s(ye),s(E);var oe=a(E,2);{var K=G=>{var Y=us(),pe=We(Y),V=a(l(pe),2);Ce(V),s(pe);var Fe=a(pe,2);vt(Fe,5,()=>e(_),bt,(L,le)=>{let Q=()=>e(le).key,g=()=>e(le).label;var I=ds(),p=l(I),O=l(p,!0);s(p);var Z=a(p,2);Ce(Z);var q=a(Z,2),ee=l(q);s(q);var De=a(q,2),fe=a(De,2),ze=l(fe);Ce(ze);var be=a(ze,2),b=a(be,2);s(fe),s(I),M(Ne=>{y(O,Ne),y(ee,`${t(),Q(),i(()=>t()[Q()]>=0?"+":"")??""}${t(),Q(),i(()=>t()[Q()])??""}`),it(ze,"id",`${Q()}-save`),it(be,"for",`${Q()}-save`)},[()=>(g(),i(()=>g().substring(0,3).toUpperCase()))]),Ie(Z,()=>c().abilities[Q()],Ne=>at(X,i(c).abilities[Q()]=Ne,i(c))),j("change",Z,T),j("click",De,()=>He(Q())),na(ze,()=>c().saveProficiencies[Q()],Ne=>at(X,i(c).saveProficiencies[Q()]=Ne,i(c))),j("click",b,()=>re(Q())),o(L,I)}),s(Fe),Ie(V,()=>c().proficiencyBonus,L=>at(X,i(c).proficiencyBonus=L,i(c))),o(G,Y)};$(oe,G=>{C(),i(()=>!C().abilityScores)&&G(K)})}s(de),M(()=>{Le=dt(de,1,"ability-scores svelte-bbv1xt",null,Le,{hidden:!e(P)}),it(ye,"aria-label",(C(),i(()=>C().abilityScores?"Expand":"Collapse"))),y(ue,(C(),i(()=>C().abilityScores?"â–¼":"â–²")))}),j("click",ye,me),o(n,de),kt(),B()}function xa(n,v){if(!n.class)return null;const t=_t(n.class);if(!t||!t.spellcaster||!t.spellcastingAbility)return null;const c=v[t.spellcastingAbility];return 8+n.proficiencyBonus+c}var bs=f('<div class="stat-box svelte-1r5hyyb"><label for="spellSaveDC" class="svelte-1r5hyyb">Spell Save DC</label> <input type="number" id="spellSaveDC" class="stat-input svelte-1r5hyyb" readonly="" title="8 + Proficiency Bonus + Spellcasting Ability Modifier"/></div>'),gs=f('<span class="hit-dice-type"> </span>'),hs=f('<div class="stats-grid svelte-1r5hyyb"><div class="stat-box svelte-1r5hyyb"><label for="armorClass" class="svelte-1r5hyyb">Armor Class</label> <input type="number" id="armorClass" class="stat-input svelte-1r5hyyb"/></div> <div class="stat-box svelte-1r5hyyb"><label for="initiative" class="svelte-1r5hyyb">Initiative</label> <input type="number" id="initiative" class="stat-input svelte-1r5hyyb"/></div> <div class="stat-box svelte-1r5hyyb"><label for="speed" class="svelte-1r5hyyb">Speed</label> <input type="text" id="speed" class="stat-input svelte-1r5hyyb"/></div> <!></div> <div class="hp-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Points</h3> <div class="hp-display svelte-1r5hyyb"><div class="hp-inputs svelte-1r5hyyb"><input type="number" class="hp-current svelte-1r5hyyb" min="0"/> <span class="hp-separator svelte-1r5hyyb">/</span> <input type="number" class="hp-max svelte-1r5hyyb" min="0"/></div> <div class="hp-controls svelte-1r5hyyb"><button class="hp-btn svelte-1r5hyyb">âˆ’</button> <button class="hp-btn svelte-1r5hyyb">+</button> <button class="hp-btn svelte-1r5hyyb">âˆ’5</button> <button class="hp-btn svelte-1r5hyyb">+5</button></div></div> <div class="temp-hp svelte-1r5hyyb"><label for="tempHP" class="svelte-1r5hyyb">Temp HP</label> <input type="number" id="tempHP" min="0" class="svelte-1r5hyyb"/></div></div> <div class="hit-dice-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Dice</h3> <div class="hit-dice-display svelte-1r5hyyb"><input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <span>/</span> <input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <!></div> <div class="hit-dice-controls"><label for="hitDiceCount" class="svelte-1r5hyyb">Roll</label> <input type="number" id="hitDiceCount" class="hit-dice-count-input svelte-1r5hyyb" min="1" value="1"/> <button class="btn btn-primary roll-hit-dice use-enabled svelte-1r5hyyb">ðŸŽ² Roll</button></div></div>',1),ms=f('<section><div class="header svelte-1r5hyyb"><h2 class="svelte-1r5hyyb">Combat Stats</h2> <button class="collapse-btn svelte-1r5hyyb"> </button></div> <!></section>');function _s(n,v){xt(v,!1);const t=()=>Ke(X,"$character",D),c=()=>Ke(Xt,"$abilityModifiers",D),S=()=>Ke(Rt,"$searchFilter",D),C=()=>Ke(gt,"$collapsedStates",D),[D,B]=Lt(),_=A(),P=A(),ne=Gt();function J(oe){X.update(K=>(K.currentHP=Math.max(0,Math.min(K.maxHP,K.currentHP+oe)),K))}function T(oe=1){if(t().hitDice.current<=0){alert("No hit dice remaining!");return}if(!t().class){alert("Please select a class first!");return}const K=_t(t().class);if(!K){alert("Invalid class configuration!");return}const G=Math.min(oe,t().hitDice.current),Y=K.hitDice,pe=c().constitution,V=pe>=0?`+${pe}`:`${pe}`,Fe=`${G}${Y}${V}`;ne("rollHitDice",{notation:Fe,hitDie:Y,count:G})}function He(){gt.update(oe=>({...oe,combatStats:!oe.combatStats}))}et(()=>(t(),c()),()=>{r(_,xa(t(),c()))}),et(()=>S(),()=>{r(P,!S()||"armor class".includes(S().toLowerCase())||"initiative".includes(S().toLowerCase())||"speed".includes(S().toLowerCase())||"hit points".includes(S().toLowerCase())||"hp".includes(S().toLowerCase())||"hit dice".includes(S().toLowerCase())||"spell save".includes(S().toLowerCase())||"combat".includes(S().toLowerCase()))}),jt(),yt();var re=ms();let me;var de=l(re),Le=a(l(de),2),E=l(Le,!0);s(Le),s(de);var ye=a(de,2);{var ue=oe=>{var K=hs(),G=We(K),Y=l(G),pe=a(l(Y),2);Ce(pe),s(Y);var V=a(Y,2),Fe=a(l(V),2);Ce(Fe),s(V);var L=a(V,2),le=a(l(L),2);Ce(le),s(L);var Q=a(L,2);{var g=N=>{var te=bs(),x=a(l(te),2);Ce(x),s(te),M(()=>$a(x,e(_))),o(N,te)};$(Q,N=>{e(_)!==null&&N(g)})}s(G);var I=a(G,2),p=a(l(I),2),O=l(p),Z=l(O);Ce(Z);var q=a(Z,4);Ce(q),s(O);var ee=a(O,2),De=l(ee),fe=a(De,2),ze=a(fe,2),be=a(ze,2);s(ee),s(p);var b=a(p,2),Ne=a(l(b),2);Ce(Ne),s(b),s(I);var Qe=a(I,2),Xe=a(l(Qe),2),Je=l(Xe);Ce(Je);var m=a(Je,4);Ce(m);var W=a(m,2);{var ae=N=>{const te=tt(()=>(U(_t),t(),i(()=>_t(t().class))));var x=rt(),we=We(x);{var xe=Ue=>{const qe=tt(()=>(c(),i(()=>c().constitution)));var Ze=gs(),$e=l(Ze);s(Ze),M(()=>y($e,`(${U(e(te)),i(()=>e(te).hitDice)??""}${(e(qe)>=0?`+${e(qe)}`:e(qe))??""})`)),o(Ue,Ze)};$(we,Ue=>{e(te)&&Ue(xe)})}o(N,x)};$(W,N=>{t(),i(()=>t().class)&&N(ae)})}s(Xe);var ge=a(Xe,2),Oe=a(l(ge),2),Me=a(Oe,2);s(ge),s(Qe),M(()=>{it(Z,"max",(t(),i(()=>t().maxHP))),it(Je,"max",(t(),i(()=>t().hitDice.max))),it(Oe,"max",(t(),i(()=>t().hitDice.current))),Me.disabled=(t(),i(()=>t().hitDice.current<=0||!t().class))}),Ie(pe,()=>t().armorClass,N=>at(X,i(t).armorClass=N,i(t))),Ie(Fe,()=>t().initiative,N=>at(X,i(t).initiative=N,i(t))),Ie(le,()=>t().speed,N=>at(X,i(t).speed=N,i(t))),Ie(Z,()=>t().currentHP,N=>at(X,i(t).currentHP=N,i(t))),Ie(q,()=>t().maxHP,N=>at(X,i(t).maxHP=N,i(t))),j("click",De,()=>J(-1)),j("click",fe,()=>J(1)),j("click",ze,()=>J(-5)),j("click",be,()=>J(5)),Ie(Ne,()=>t().tempHP,N=>at(X,i(t).tempHP=N,i(t))),Ie(Je,()=>t().hitDice.current,N=>at(X,i(t).hitDice.current=N,i(t))),Ie(m,()=>t().hitDice.max,N=>at(X,i(t).hitDice.max=N,i(t))),j("input",Oe,N=>{const te=N.target,x=parseInt(te.value);x>t().hitDice.current&&(te.value=String(t().hitDice.current)),x<1&&(te.value="1")}),j("click",Me,()=>{const N=document.getElementById("hitDiceCount"),te=parseInt(N?.value||"1");T(te)}),o(oe,K)};$(ye,oe=>{C(),i(()=>!C().combatStats)&&oe(ue)})}s(re),M(()=>{me=dt(re,1,"combat-stats svelte-1r5hyyb",null,me,{hidden:!e(P)}),it(Le,"aria-label",(C(),i(()=>C().combatStats?"Expand":"Collapse"))),y(E,(C(),i(()=>C().combatStats?"â–¼":"â–²")))}),j("click",Le,He),o(n,re),kt(),B()}const ha={acrobatics:"dexterity",animalHandling:"wisdom",arcana:"intelligence",athletics:"strength",deception:"charisma",history:"intelligence",insight:"wisdom",intimidation:"charisma",investigation:"intelligence",medicine:"wisdom",nature:"intelligence",perception:"wisdom",performance:"charisma",persuasion:"charisma",religion:"intelligence",sleightOfHand:"dexterity",stealth:"dexterity",survival:"wisdom"};var ys=f('<div class="skill-row svelte-1f1pl16"><input type="checkbox" class="svelte-1f1pl16"/> <label class="svelte-1f1pl16"> <span class="ability-tag svelte-1f1pl16"> </span></label> <span class="skill-modifier svelte-1f1pl16"> </span> <button class="roll-btn svelte-1f1pl16">Roll</button></div>'),xs=f('<div class="skills-grid svelte-1f1pl16"></div>'),ks=f('<section><div class="header svelte-1f1pl16"><h2 class="svelte-1f1pl16">Skills</h2> <button class="collapse-btn svelte-1f1pl16"> </button></div> <!></section>');function $s(n,v){xt(v,!1);const t=()=>Ke(Xt,"$abilityModifiers",D),c=()=>Ke(X,"$character",D),S=()=>Ke(Rt,"$searchFilter",D),C=()=>Ke(gt,"$collapsedStates",D),[D,B]=Lt(),_=A(),P=A(),ne=Gt(),J=[{key:"acrobatics",label:"Acrobatics"},{key:"animalHandling",label:"Animal Handling"},{key:"arcana",label:"Arcana"},{key:"athletics",label:"Athletics"},{key:"deception",label:"Deception"},{key:"history",label:"History"},{key:"insight",label:"Insight"},{key:"intimidation",label:"Intimidation"},{key:"investigation",label:"Investigation"},{key:"medicine",label:"Medicine"},{key:"nature",label:"Nature"},{key:"perception",label:"Perception"},{key:"performance",label:"Performance"},{key:"persuasion",label:"Persuasion"},{key:"religion",label:"Religion"},{key:"sleightOfHand",label:"Sleight of Hand"},{key:"stealth",label:"Stealth"},{key:"survival",label:"Survival"}];function T(K){const G=ha[K],Y=t()[G],pe=c().skillProficiencies[K]?c().proficiencyBonus:0;return Y+pe}function He(K){const G=T(K),Y=`1d20${G>=0?"+":""}${G}`;ne("roll",Y)}function re(){gt.update(K=>({...K,skills:!K.skills}))}et(()=>S(),()=>{r(_,J.filter(({label:K})=>S()?K.toLowerCase().includes(S().toLowerCase()):!0))}),et(()=>e(_),()=>{r(P,e(_).length>0)}),jt(),yt();var me=ks();let de;var Le=l(me),E=a(l(Le),2),ye=l(E,!0);s(E),s(Le);var ue=a(Le,2);{var oe=K=>{var G=xs();vt(G,5,()=>e(_),bt,(Y,pe)=>{let V=()=>e(pe).key,Fe=()=>e(pe).label;const L=tt(()=>(U(ha),V(),i(()=>ha[V()]))),le=tt(()=>(V(),i(()=>T(V()))));var Q=ys(),g=l(Q);Ce(g);var I=a(g,2),p=l(I),O=a(p),Z=l(O);s(O),s(I);var q=a(I,2),ee=l(q);s(q);var De=a(q,2);s(Q),M(fe=>{it(g,"id",V()),it(I,"for",V()),y(p,`${Fe()??""} `),y(Z,`(${fe??""})`),y(ee,`${e(le)>=0?"+":""}${e(le)??""}`)},[()=>(U(e(L)),i(()=>e(L).substring(0,3).toUpperCase()))]),na(g,()=>c().skillProficiencies[V()],fe=>at(X,i(c).skillProficiencies[V()]=fe,i(c))),j("click",De,()=>He(V())),o(Y,Q)}),s(G),o(K,G)};$(ue,K=>{C(),i(()=>!C().skills)&&K(oe)})}s(me),M(()=>{de=dt(me,1,"skills svelte-1f1pl16",null,de,{hidden:!e(P)}),it(E,"aria-label",(C(),i(()=>C().skills?"Expand":"Collapse"))),y(ye,(C(),i(()=>C().skills?"â–¼":"â–²")))}),j("click",E,re),o(n,me),kt(),B()}let ta=null,aa=null;async function Na(){if(ta)return ta;try{return ta=await(await fetch(Ta("/data/spells.json"))).json(),ta||[]}catch(n){return console.error("Failed to load spells:",n),[]}}async function Ss(){if(aa)return aa;try{return aa=await(await fetch(Ta("/data/feats.json"))).json(),aa||[]}catch(n){return console.error("Failed to load feats:",n),[]}}function wa(n,v){if(!v.trim())return n;const t=v.toLowerCase();return n.filter(c=>c.name.toLowerCase().includes(t)||c.school.toLowerCase().includes(t)||c.classes.some(S=>S.toLowerCase().includes(t))||c.description.toLowerCase().includes(t))}function Cs(n,v){return v===null?n:n.filter(t=>t.level===v)}function Ls(n,v){if(!v.trim())return n;const t=v.toLowerCase();return n.filter(c=>c.name.toLowerCase().includes(t)||c.description.toLowerCase().includes(t))}function sa(n){const v=n.description,t=/\b(Strength|Dexterity|Constitution|Intelligence|Wisdom|Charisma)\s+saving\s+throw/i,c=v.match(t);if(!c)return null;const S=c[1].toLowerCase(),D=/half\s+(?:as\s+much\s+)?damage\s+on\s+a\s+successful(?:\s+save)?/i.test(v),_=/saving\s+throw\s+or\s+take.*?damage/i.test(v)&&!D;return{ability:S,halfDamageOnSave:D,noDamageOnSave:_}}var Ds=f('<button class="btn-remove svelte-14o91c5">Ã—</button>'),ws=f('<div class="spell-info-loading svelte-14o91c5">Loading spell info...</div>'),js=f('<div class="spell-notes svelte-14o91c5"><h4 class="svelte-14o91c5">General Notes</h4> <p> </p></div>'),Fs=f('<li class="svelte-14o91c5"><strong>At Higher Levels:</strong> </li>'),As=f('<ul class="svelte-14o91c5"><li class="svelte-14o91c5"><strong>Level:</strong> </li> <li class="svelte-14o91c5"><strong>Casting Time:</strong> </li> <li class="svelte-14o91c5"><strong>Range:</strong> </li> <li class="svelte-14o91c5"><strong>Components:</strong> <!></li> <li class="svelte-14o91c5"><strong>Duration:</strong> <!> </li> <li class="svelte-14o91c5"><strong>Description:</strong> </li> <!></ul>'),Rs=f("<option> </option>"),Is=f('<span class="scaled-damage svelte-14o91c5"><!> </span>'),Ms=f('<span class="scaled-damage svelte-14o91c5"> </span>'),Ps=f('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> Target is Fiend or Undead <!></label></div>'),Es=f('<span class="scaled-damage svelte-14o91c5" style="margin-left: 8px;"> </span>'),Hs=f('<span class="scaled-damage svelte-14o91c5">(Half damage)</span>'),Us=f('<span class="scaled-damage svelte-14o91c5">(No damage)</span>'),Bs=f('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> <!> <!></label></div>'),Ts=f('<div class="spell-level-selector svelte-14o91c5"><label class="svelte-14o91c5">Cast at Level:</label> <select class="spell-level-select use-enabled svelte-14o91c5"></select> <!></div> <!> <!>',1),Ns=f('<div class="spell-level-selector svelte-14o91c5"><span style="color: #dc3545; font-weight: bold;">No spell slots available!</span></div>'),Gs=f('<!> <div class="spell-info svelte-14o91c5"><div class="spell-info-header svelte-14o91c5" role="button" tabindex="0"><h4 class="svelte-14o91c5">Spell Info</h4> <button class="collapse-btn-small svelte-14o91c5"> </button></div> <!></div> <!>',1),Os=f('<div class="spell-info-missing svelte-14o91c5">Spell info not found.</div>'),qs=f('<div class="attack-notes svelte-14o91c5"><label class="svelte-14o91c5">Notes</label> <textarea placeholder="e.g., DC 15 Dex save, Range 120 ft, Concentration" class="notes-input svelte-14o91c5" rows="2"></textarea></div>'),zs=f('<button class="btn btn-primary">Roll Attack</button>'),Ws=f('<button class="btn btn-secondary"><!></button>'),Ks=f('<button class="btn btn-secondary">Roll Damage</button>'),Js=f('<div class="attack-card svelte-14o91c5"><div class="attack-header svelte-14o91c5"><input type="text" placeholder="Attack name" class="attack-name svelte-14o91c5"/> <!></div> <div class="attack-details svelte-14o91c5"><div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Bonus</label> <input type="number" class="attack-bonus svelte-14o91c5"/></div> <div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Damage</label> <input type="text" placeholder="e.g., 2d6+3" class="attack-damage svelte-14o91c5"/></div> <div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Type</label> <input type="text" placeholder="e.g., slashing" class="attack-type svelte-14o91c5"/></div></div> <!> <!> <div class="attack-actions svelte-14o91c5"><!> <!></div></div>'),Vs=f('<p class="no-attacks svelte-14o91c5">No attacks added yet. Click "Add Attack" to create one.</p>'),Qs=f('<p class="no-attacks svelte-14o91c5">No attacks match your search.</p>'),Xs=f('<button class="btn btn-secondary">Add Attack</button> <div class="attacks-list svelte-14o91c5"><!> <!></div>',1),Ys=f('<section><div class="header svelte-14o91c5"><h2 class="svelte-14o91c5">Attacks & Spells</h2> <button class="collapse-btn svelte-14o91c5"> </button></div> <!></section>');function Zs(n,v){xt(v,!1);const t=()=>Ke(X,"$character",B),c=()=>Ke(Rt,"$searchFilter",B),S=()=>Ke(gt,"$collapsedStates",B),C=()=>Ke(la,"$isEditMode",B),D=()=>Ke(Xt,"$abilityModifiers",B),[B,_]=Lt(),P=A(),ne=A(),J=Gt();let T=A({});function He(p){Ea(T,e(T)[p]=!e(T)[p]),r(T,{...e(T)})}function re(p){return p.description.toLowerCase().includes("regain")&&(p.description.toLowerCase().includes("hit point")||p.description.toLowerCase().includes("hp"))}function me(){X.update(p=>(p.attacks=[...p.attacks,{id:crypto.randomUUID(),name:"",bonus:0,damage:"",damageType:"",notes:""}],p))}function de(p){X.update(O=>(O.attacks=O.attacks.filter(Z=>Z.id!==p),O))}function Le(p){let O=p.damage,Z=!1;if(p.spellRef){const ee=K(p.spellRef);if(ee&&ee.level>0){const De=p.castAtLevel||ee.level;if(!G(De)){alert(`No level ${De} spell slots available!`);return}const ze=sa(ee);ze&&p.targetSucceededSave&&ze.noDamageOnSave?O="0":(Z=ze?.halfDamageOnSave&&p.targetSucceededSave||!1,O=Y(p,ee))}}const q=`1d20${p.bonus>=0?"+":""}${p.bonus}`;J("roll",{notation:q,damageNotation:O,attackName:p.name,applyHalfDamage:Z})}function E(p){if(!p.damage){alert(`${p.name}: No damage specified`);return}let O=p.damage,Z=!1;if(p.spellRef){const q=K(p.spellRef);if(q&&q.level>0){const ee=p.castAtLevel||q.level;if(!G(ee)){alert(`No level ${ee} spell slots available!`);return}const fe=sa(q);fe&&p.targetSucceededSave&&fe.noDamageOnSave?O="0":(Z=fe?.halfDamageOnSave&&p.targetSucceededSave||!1,O=Y(p,q))}}J("roll",{notation:O,attackName:p.name,applyHalfDamage:Z})}function ye(){gt.update(p=>({...p,attacks:!p.attacks}))}let ue=A([]),oe=A(!1);Qt(async()=>{r(ue,await Na()),r(oe,!0)});function K(p){return e(ue).find(O=>O.name===p)}function G(p){t().classFeatures.spellSlotsByLevel||at(X,i(t).classFeatures.spellSlotsByLevel={},i(t)),t().classFeatures.spellSlotsByLevel[p]||at(X,i(t).classFeatures.spellSlotsByLevel[p]=Array(2).fill(!1),i(t));const Z=t().classFeatures.spellSlotsByLevel[p].findIndex(q=>!q);return Z===-1?!1:(X.update(q=>(q.classFeatures.spellSlotsByLevel||(q.classFeatures.spellSlotsByLevel={}),q.classFeatures.spellSlotsByLevel[p]||(q.classFeatures.spellSlotsByLevel[p]=Array(2).fill(!1)),q.classFeatures.spellSlotsByLevel[p][Z]=!0,q)),!0)}function Y(p,O){let Z=p.damage,q=0;if(O.higherLevelSlot&&p.castAtLevel){const be=O.level,Ne=(p.castAtLevel||be)-be;if(Ne>0){const Qe=O.higherLevelSlot.match(/(\d+)d(\d+)\s+for\s+each.*?level\s+above/i);if(Qe){const[,Xe]=Qe;q+=Ne*parseInt(Xe)}}}if(p.targetIsFiendOrUndead&&O.description.includes("Fiend or an Undead")){const be=O.description.match(/increases by (\d+)d(\d+) if.*?Fiend or.*?Undead/i);if(be){const[,b]=be;q+=parseInt(b)}}const ee=Z.match(/(\d+)d(\d+)/);if(!ee)return Z;const[,De,fe]=ee;return`${parseInt(De)+q}d${fe}`}function pe(p){const O=[];for(let q=p.level;q<=9;q++){const ee=t().classFeatures.spellSlotsByLevel?.[q];ee&&ee.length>0&&O.push(q)}return O}et(()=>(t(),c()),()=>{r(P,t().attacks.filter(p=>{if(!c())return!0;const O=c().toLowerCase();return p.name.toLowerCase().includes(O)||p.damageType.toLowerCase().includes(O)}).sort((p,O)=>!p.spellRef&&O.spellRef?-1:p.spellRef&&!O.spellRef?1:0))}),et(()=>(c(),e(P)),()=>{r(ne,!c()||e(P).length>0||"attack".includes(c().toLowerCase())||"spell".includes(c().toLowerCase()))}),jt(),yt();var V=Ys();let Fe;var L=l(V),le=a(l(L),2),Q=l(le,!0);s(le),s(L);var g=a(L,2);{var I=p=>{var O=Xs(),Z=We(O),q=a(Z,2),ee=l(q);vt(ee,1,()=>e(P),be=>be.id,(be,b,Ne)=>{var Qe=Js(),Xe=l(Qe),Je=l(Xe);Ce(Je);var m=a(Je,2);{var W=F=>{var z=Ds();j("click",z,()=>de(e(b).id)),o(F,z)};$(m,F=>{C()&&F(W)})}s(Xe);var ae=a(Xe,2),ge=l(ae),Oe=a(l(ge),2);Ce(Oe),s(ge);var Me=a(ge,2),N=a(l(Me),2);Ce(N),s(Me);var te=a(Me,2),x=a(l(te),2);Ce(x),s(te),s(ae);var we=a(ae,2);{var xe=F=>{var z=rt(),d=We(z);{var w=R=>{var h=ws();o(R,h)},H=R=>{const h=tt(()=>(e(b),i(()=>K(e(b).spellRef))));var ce=rt(),je=We(ce);{var ve=u=>{var se=Gs(),k=We(se);{var ke=nt=>{var st=js(),ut=a(l(st),2),Mt=l(ut,!0);s(ut),s(st),M(()=>y(Mt,(e(b),i(()=>e(b).generalNotes)))),o(nt,st)};$(k,nt=>{e(b),i(()=>e(b).generalNotes)&&nt(ke)})}var Te=a(k,2),Ve=l(Te),Pe=a(l(Ve),2),Ee=l(Pe,!0);s(Pe),s(Ve);var Re=a(Ve,2);{var he=nt=>{var st=As(),ut=l(st),Mt=a(l(ut));s(ut);var Ot=a(ut,2),oa=a(l(Ot));s(Ot);var $t=a(Ot,2),ht=a(l($t));s($t);var Ht=a($t,2),Ut=a(l(Ht)),Yt=a(Ut);{var Pt=Ye=>{var lt=ft();M(()=>y(lt,`(${U(e(h)),i(()=>e(h).material)??""})`)),o(Ye,lt)};$(Yt,Ye=>{U(e(h)),i(()=>e(h).material)&&Ye(Pt)})}s(Ht);var qt=a(Ht,2),Zt=a(l(qt),2);{var ea=Ye=>{var lt=ft("Concentration,");o(Ye,lt)};$(Zt,Ye=>{U(e(h)),i(()=>e(h).concentration)&&Ye(ea)})}var ca=a(Zt,1,!0);s(qt);var zt=a(qt,2),va=a(l(zt));s(zt);var ot=a(zt,2);{var ct=Ye=>{var lt=Fs(),mt=a(l(lt));s(lt),M(()=>y(mt,` ${U(e(h)),i(()=>e(h).higherLevelSlot)??""}`)),o(Ye,lt)};$(ot,Ye=>{U(e(h)),i(()=>e(h).higherLevelSlot)&&Ye(ct)})}s(st),M(Ye=>{y(Mt,` ${U(e(h)),i(()=>e(h).level)??""}`),y(oa,` ${U(e(h)),i(()=>e(h).castingTime||e(h).actionType)??""}`),y(ht,` ${U(e(h)),i(()=>e(h).range)??""}`),y(Ut,` ${Ye??""}`),y(ca,(U(e(h)),i(()=>e(h).duration))),y(va,` ${U(e(h)),i(()=>e(h).description)??""}`)},[()=>(U(e(h)),i(()=>e(h).components.join(", ")))]),o(nt,st)};$(Re,nt=>{e(T),e(b),i(()=>!e(T)[e(b).id])&&nt(he)})}s(Te);var _e=a(Te,2);{var It=nt=>{const st=tt(()=>(U(e(h)),i(()=>pe(e(h)))));var ut=rt(),Mt=We(ut);{var Ot=$t=>{const ht=tt(()=>(U(sa),U(e(h)),i(()=>sa(e(h)))));var Ht=Ts(),Ut=We(Ht),Yt=l(Ut),Pt=a(Yt,2);M(()=>{e(b),Ct(()=>{e(st)})}),vt(Pt,5,()=>e(st),bt,(ot,ct)=>{var Ye=Rs(),lt=l(Ye);s(Ye);var mt={};M(()=>{y(lt,`Level ${e(ct)??""}`),mt!==(mt=e(ct))&&(Ye.value=(Ye.__value=e(ct))??"")}),o(ot,Ye)}),s(Pt);var qt=a(Pt,2);{var Zt=ot=>{const ct=tt(()=>(e(b),U(e(h)),i(()=>Y(e(b),e(h)))));var Ye=Is(),lt=l(Ye);{var mt=St=>{var wt=ft("Healing");o(St,wt)},Bt=St=>{var wt=ft("Damage");o(St,wt)};$(lt,St=>{U(e(h)),i(()=>re(e(h)))?St(mt):St(Bt,!1)})}var Dt=a(lt);s(Ye),M(()=>y(Dt,` ${e(ct)??""}`)),o(ot,Ye)};$(qt,ot=>{e(b),U(e(h)),i(()=>e(b).castAtLevel&&e(b).castAtLevel>e(h).level)&&ot(Zt)})}s(Ut);var ea=a(Ut,2);{var ca=ot=>{var ct=Ps(),Ye=l(ct),lt=l(Ye);Ce(lt);var mt=a(lt,2);{var Bt=Dt=>{const St=tt(()=>(e(b),U(e(h)),i(()=>Y(e(b),e(h)))));var wt=Ms(),da=l(wt);s(wt),M(()=>y(da,`(+1d8, total: ${e(St)??""})`)),o(Dt,wt)};$(mt,Dt=>{e(b),i(()=>e(b).targetIsFiendOrUndead)&&Dt(Bt)})}s(Ye),s(ct),na(lt,()=>e(b).targetIsFiendOrUndead,Dt=>(e(b).targetIsFiendOrUndead=Dt,Ct(()=>(e(P),t(),c())))),o(ot,ct)};$(ea,ot=>{U(e(h)),i(()=>e(h).description.includes("Fiend or an Undead"))&&ot(ca)})}var zt=a(ea,2);{var va=ot=>{var ct=Bs(),Ye=l(ct),lt=l(Ye);Ce(lt);var mt=a(lt),Bt=a(mt);{var Dt=pt=>{var Ft=Es(),ua=l(Ft);s(Ft),M(pa=>y(ua,`(Spell Save DC: ${pa??""})`),[()=>(U(xa),t(),D(),i(()=>xa(t(),D())))]),o(pt,Ft)};$(Bt,pt=>{t(),i(()=>t().class)&&pt(Dt)})}var St=a(Bt,2);{var wt=pt=>{var Ft=Hs();o(pt,Ft)},da=pt=>{var Ft=rt(),ua=We(Ft);{var pa=fa=>{var Ga=Us();o(fa,Ga)};$(ua,fa=>{e(b),U(e(ht)),i(()=>e(b).targetSucceededSave&&e(ht).noDamageOnSave)&&fa(pa)},!0)}o(pt,Ft)};$(St,pt=>{e(b),U(e(ht)),i(()=>e(b).targetSucceededSave&&e(ht).halfDamageOnSave)?pt(wt):pt(da,!1)})}s(Ye),s(ct),M(pt=>y(mt,` Target succeeded on ${pt??""} save `),[()=>(U(e(ht)),i(()=>e(ht).ability.charAt(0).toUpperCase()+e(ht).ability.slice(1)))]),na(lt,()=>e(b).targetSucceededSave,pt=>(e(b).targetSucceededSave=pt,Ct(()=>(e(P),t(),c())))),o(ot,ct)};$(zt,ot=>{e(ht)&&ot(va)})}M(()=>{it(Yt,"for",`castLevel-${e(b),i(()=>e(b).id)??""}`),it(Pt,"id",`castLevel-${e(b),i(()=>e(b).id)??""}`)}),Ba(Pt,()=>e(b).castAtLevel,ot=>(e(b).castAtLevel=ot,Ct(()=>(e(P),t(),c())))),o($t,Ht)},oa=$t=>{var ht=Ns();o($t,ht)};$(Mt,$t=>{U(e(st)),i(()=>e(st).length>0)?$t(Ot):$t(oa,!1)})}o(nt,ut)};$(_e,nt=>{U(e(h)),i(()=>e(h).higherLevelSlot&&e(h).level>0)&&nt(It)})}M(()=>{it(Pe,"aria-label",(e(T),e(b),i(()=>e(T)[e(b).id]?"Expand":"Collapse"))),y(Ee,(e(T),e(b),i(()=>e(T)[e(b).id]?"â–¼":"â–²")))}),j("click",Ve,()=>He(e(b).id)),j("keydown",Ve,nt=>nt.key==="Enter"&&He(e(b).id)),o(u,se)},Be=u=>{var se=Os();o(u,se)};$(je,u=>{e(h)?u(ve):u(Be,!1)})}o(R,ce)};$(d,R=>{e(ue),i(()=>e(ue).length===0)?R(w):R(H,!1)})}o(F,z)};$(we,F=>{e(b),i(()=>e(b).spellRef)&&F(xe)})}var Ue=a(we,2);{var qe=F=>{var z=qs(),d=a(l(z),2);Kt(d),s(z),Ie(d,()=>e(b).notes,w=>(e(b).notes=w,Ct(()=>(e(P),t(),c())))),o(F,z)};$(Ue,F=>{e(b),i(()=>!e(b).spellRef)&&F(qe)})}var Ze=a(Ue,2),$e=l(Ze);{var ie=F=>{var z=zs();j("click",z,()=>Le(e(b))),o(F,z)};$($e,F=>{e(b),i(()=>e(b).bonus!==0||!e(b).spellRef)&&F(ie)})}var Se=a($e,2);{var Ge=F=>{const z=tt(()=>(e(b),i(()=>K(e(b).spellRef))));var d=Ws(),w=l(d);{var H=h=>{var ce=ft("Roll Healing");o(h,ce)},R=h=>{var ce=ft("Roll Damage");o(h,ce)};$(w,h=>{U(e(z)),i(()=>e(z)&&re(e(z)))?h(H):h(R,!1)})}s(d),j("click",d,()=>E(e(b))),o(F,d)},Ae=F=>{var z=Ks();j("click",z,()=>E(e(b))),o(F,z)};$(Se,F=>{e(b),e(oe),i(()=>e(b).spellRef&&e(oe))?F(Ge):F(Ae,!1)})}s(Ze),s(Qe),Ie(Je,()=>e(b).name,F=>(e(b).name=F,Ct(()=>(e(P),t(),c())))),Ie(Oe,()=>e(b).bonus,F=>(e(b).bonus=F,Ct(()=>(e(P),t(),c())))),Ie(N,()=>e(b).damage,F=>(e(b).damage=F,Ct(()=>(e(P),t(),c())))),Ie(x,()=>e(b).damageType,F=>(e(b).damageType=F,Ct(()=>(e(P),t(),c())))),o(be,Qe)});var De=a(ee,2);{var fe=be=>{var b=Vs();o(be,b)},ze=be=>{var b=rt(),Ne=We(b);{var Qe=Xe=>{var Je=Qs();o(Xe,Je)};$(Ne,Xe=>{e(P),i(()=>e(P).length===0)&&Xe(Qe)},!0)}o(be,b)};$(De,be=>{t(),i(()=>t().attacks.length===0)?be(fe):be(ze,!1)})}s(q),j("click",Z,me),o(p,O)};$(g,p=>{S(),i(()=>!S().attacks)&&p(I)})}s(V),M(()=>{Fe=dt(V,1,"attacks svelte-14o91c5",null,Fe,{hidden:!e(ne)}),it(le,"aria-label",(S(),i(()=>S().attacks?"Expand":"Collapse"))),y(Q,(S(),i(()=>S().attacks?"â–¼":"â–²")))}),j("click",le,ye),o(n,V),kt(),_()}var el=f('<p class="no-features svelte-1kpvv0n">Select a class to see available features</p>'),tl=f('<p class="no-features svelte-1kpvv0n">No class features available at this level</p>'),al=f('<input type="checkbox" class="slot-checkbox svelte-1kpvv0n"/>'),sl=f('<div class="spell-slots svelte-1kpvv0n"><label class="svelte-1kpvv0n"> </label> <div class="slots-tracker svelte-1kpvv0n"></div></div>'),ll=f('<div class="all-spell-slots"></div>'),il=f('<div class="feature-box spellcasting svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"> </h3> <div class="spell-stats svelte-1kpvv0n"><div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Spell Save DC</label> <div class="spell-value svelte-1kpvv0n"> </div></div> <div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <div class="spell-value svelte-1kpvv0n"> </div></div></div> <!> <div class="prepared-spells svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <textarea placeholder="List your prepared spells..." class="svelte-1kpvv0n"></textarea></div></div>'),nl=f('<p class="unlimited svelte-1kpvv0n">Unlimited Uses</p>'),rl=f('<p class="no-uses svelte-1kpvv0n">No uses remaining</p>'),ol=f('<div class="uses-with-button svelte-1kpvv0n"><button class="btn btn-primary use-enabled"> </button> <div class="uses-info svelte-1kpvv0n"><span class="uses-remaining svelte-1kpvv0n"> </span> <span class="reset-info svelte-1kpvv0n"> </span></div> <!></div>'),cl=f('<div class="uses-tracker svelte-1kpvv0n"><!></div>'),vl=f('<div class="pool-tracker svelte-1kpvv0n"><input type="number" min="0" class="pool-input svelte-1kpvv0n"/> <span> </span> <button class="btn-small svelte-1kpvv0n"> </button></div>'),dl=f('<p class="no-uses svelte-1kpvv0n">No Channel Divinity uses remaining</p>'),ul=f('<div class="channel-divinity-option svelte-1kpvv0n"><button class="btn btn-primary use-enabled svelte-1kpvv0n">Use Channel Divinity</button> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div> <!></div>'),pl=f('<div class="feature-box svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"><!> </h3> <p class="feature-description svelte-1kpvv0n"> </p> <!></div>'),fl=f('<div class="features-grid svelte-1kpvv0n"><!> <!></div>'),bl=f('<section><div class="header svelte-1kpvv0n"><h2 class="svelte-1kpvv0n">Class Features</h2> <button class="collapse-btn svelte-1kpvv0n"> </button></div> <!></section>');function gl(n,v){xt(v,!1);const t=()=>Ke(X,"$character",D),c=()=>Ke(Xt,"$abilityModifiers",D),S=()=>Ke(Rt,"$searchFilter",D),C=()=>Ke(gt,"$collapsedStates",D),[D,B]=Lt(),_=A(),P=A(),ne=A(),J=A(),T=A(),He=A(),re=A();let me=A(0),de=A(0);function Le(g,I){X.update(p=>(p.classFeatures.features[g]=I,p))}function E(){X.update(g=>(g.classFeatures.spellSlotsByLevel||(g.classFeatures.spellSlotsByLevel={}),e(J).forEach(({level:I,slots:p})=>{g.classFeatures.spellSlotsByLevel[I]||(g.classFeatures.spellSlotsByLevel[I]=Array(p).fill(!1))}),g))}function ye(g){if(typeof g.maxUses=="function"){if((g.name==="Divine Sense"||g.name==="War Priest")&&e(_)?.spellcastingAbility){const I=c()[e(_).spellcastingAbility];return g.maxUses(t().level,I)}return g.maxUses(t().level)}return g.maxUses||0}function ue(g){return typeof g.maxPool=="function"?g.maxPool(t().level):g.maxPool||0}function oe(g){return typeof g.description=="function"?g.description(t().level):g.description}function K(){const g="ChannelDivinity";X.update(I=>{const p=I.classFeatures.features[g];return typeof p=="number"&&p>0&&(I.classFeatures.features[g]=p-1),I})}function G(){gt.update(g=>({...g,classFeatures:!g.classFeatures}))}et(()=>(t(),_t),()=>{r(_,t().class?_t(t().class):null)}),et(()=>(t(),Nt),()=>{r(P,t().class?Nt(t().class,t().level,t().subclass):[])}),et(()=>(t(),La),()=>{r(ne,t().class?La(t().class,t().level):0)}),et(()=>(e(_),t()),()=>{r(J,(()=>{if(!e(_)?.spellcaster)return[];const g=t().level,I=[];return g>=1&&I.push({level:1,slots:Math.min(4,2+Math.floor(g/3))}),g>=3&&I.push({level:2,slots:Math.min(3,2+Math.floor((g-3)/4))}),g>=5&&I.push({level:3,slots:Math.min(3,2+Math.floor((g-5)/5))}),g>=7&&I.push({level:4,slots:Math.min(3,1+Math.floor((g-7)/6))}),g>=9&&I.push({level:5,slots:Math.min(2,1+Math.floor((g-9)/8))}),g>=11&&I.push({level:6,slots:1}),g>=13&&I.push({level:7,slots:1}),g>=15&&I.push({level:8,slots:1}),g>=17&&I.push({level:9,slots:1}),I})())}),et(()=>(e(_),c(),t(),Da),()=>{if(e(_)?.spellcaster&&e(_).spellcastingAbility){const g=c()[e(_).spellcastingAbility];r(me,ss(t().class,g,t().proficiencyBonus)||0),r(de,Da(t().class,t().level,g))}}),et(()=>(t(),e(_),e(J)),()=>{t().class&&e(_)?.spellcaster&&e(J).length>0&&E()}),et(()=>t(),()=>{r(T,(()=>{const I=t().classFeatures.features["ChannelDivinity"];return typeof I=="number"?I:0})())}),et(()=>(e(P),S()),()=>{r(He,e(P).filter(g=>{if(!S())return!0;const I=S().toLowerCase();return g.name.toLowerCase().includes(I)||oe(g).toLowerCase().includes(I)}))}),et(()=>(S(),t(),e(He)),()=>{r(re,!S()||t().class||"class features".includes(S().toLowerCase())||"spellcasting".includes(S().toLowerCase())||e(He).length>0)}),jt(),yt();var Y=bl();let pe;var V=l(Y),Fe=a(l(V),2),L=l(Fe,!0);s(Fe),s(V);var le=a(V,2);{var Q=g=>{var I=rt(),p=We(I);{var O=q=>{var ee=el();o(q,ee)},Z=q=>{var ee=rt(),De=We(ee);{var fe=be=>{var b=tl();o(be,b)},ze=be=>{var b=fl(),Ne=l(b);{var Qe=Je=>{var m=il(),W=l(m),ae=l(W);s(W);var ge=a(W,2),Oe=l(ge),Me=a(l(Oe),2),N=l(Me,!0);s(Me),s(Oe);var te=a(Oe,2),x=a(l(te),2),we=l(x,!0);s(x),s(te),s(ge);var xe=a(ge,2);{var Ue=$e=>{var ie=ll();vt(ie,5,()=>e(J),bt,(Se,Ge)=>{let Ae=()=>e(Ge).level,F=()=>e(Ge).slots;const z=tt(()=>(t(),Ae(),F(),i(()=>t().classFeatures.spellSlotsByLevel?.[Ae()]||Array(F()).fill(!1))));var d=sl(),w=l(d),H=l(w);s(w);var R=a(w,2);vt(R,5,()=>(F(),i(()=>Array(F()))),bt,(h,ce,je)=>{var ve=al();Ce(ve),M(()=>Ja(ve,(U(e(z)),i(()=>e(z)[je]||!1)))),j("change",ve,Be=>{X.update(u=>(u.classFeatures.spellSlotsByLevel||(u.classFeatures.spellSlotsByLevel={}),u.classFeatures.spellSlotsByLevel[Ae()]||(u.classFeatures.spellSlotsByLevel[Ae()]=Array(F()).fill(!1)),u.classFeatures.spellSlotsByLevel[Ae()][je]=Be.currentTarget.checked,u))}),o(h,ve)}),s(R),s(d),M(()=>y(H,`${Ae()===1?"1st":Ae()===2?"2nd":Ae()===3?"3rd":`${Ae()}th`} Level Spell Slots`)),o(Se,d)}),s(ie),o($e,ie)};$(xe,$e=>{e(J),i(()=>e(J).length>0)&&$e(Ue)})}var qe=a(xe,2),Ze=a(l(qe),2);Kt(Ze),s(qe),s(m),M($e=>{y(ae,`Spellcasting (${$e??""})`),y(N,e(me)),y(we,e(de))},[()=>(e(_),i(()=>e(_).spellcastingAbility?.toUpperCase()))]),Ie(Ze,()=>t().classFeatures.preparedSpells,$e=>at(X,i(t).classFeatures.preparedSpells=$e,i(t))),o(Je,m)};$(Ne,Je=>{e(_),i(()=>e(_)?.spellcaster)&&Je(Qe)})}var Xe=a(Ne,2);vt(Xe,1,()=>e(He),bt,(Je,m)=>{const W=tt(()=>(e(m),i(()=>e(m).name.replace(/\s+/g,"")))),ae=tt(()=>(t(),U(e(W)),i(()=>t().classFeatures.features[e(W)]))),ge=tt(()=>(U(e(ae)),i(()=>Array.isArray(e(ae))))),Oe=tt(()=>typeof e(ae)=="number");var Me=pl(),N=l(Me),te=l(N);{var x=ie=>{var Se=ft("Channel Divinity:");o(ie,Se)};$(te,ie=>{e(m),i(()=>e(m).type==="channelDivinity")&&ie(x)})}var we=a(te);s(N);var xe=a(N,2),Ue=l(xe,!0);s(xe);var qe=a(xe,2);{var Ze=ie=>{const Se=tt(()=>(e(m),i(()=>ye(e(m))))),Ge=tt(()=>(U(e(ge)),U(e(Se)),U(e(ae)),i(()=>e(ge)?e(ae).filter(H=>!H).length:e(Se))));var Ae=cl(),F=l(Ae);{var z=w=>{var H=nl();o(w,H)},d=w=>{var H=ol(),R=l(H),h=l(R);s(R);var ce=a(R,2),je=l(ce),ve=l(je);s(je);var Be=a(je,2),u=l(Be);s(Be),s(ce);var se=a(ce,2);{var k=ke=>{var Te=rl();o(ke,Te)};$(se,ke=>{e(Ge)<=0&&ke(k)})}s(H),M(()=>{R.disabled=e(Ge)<=0,y(h,`Use ${e(m),i(()=>e(m).name)??""}`),y(ve,`${e(Ge)??""} / ${e(Se)??""} uses`),y(u,`Resets on ${e(m),i(()=>e(m).resetOn==="short"?"Short Rest":"Long Rest")??""}`)}),j("click",R,()=>{X.update(ke=>{ke.classFeatures.features[e(W)]||(ke.classFeatures.features[e(W)]=Array(e(Se)).fill(!1));const Te=ke.classFeatures.features[e(W)],Ve=Te.findIndex(Pe=>!Pe);return Ve!==-1&&(Te[Ve]=!0),ke})}),o(w,H)};$(F,w=>{e(Se)===1/0?w(z):w(d,!1)})}s(Ae),o(ie,Ae)},$e=ie=>{var Se=rt(),Ge=We(Se);{var Ae=z=>{const d=tt(()=>(e(m),i(()=>ue(e(m)))));var w=vl(),H=l(w);Ce(H);var R=a(H,2),h=l(R);s(R);var ce=a(R,2),je=l(ce,!0);s(ce),s(w),M(()=>{$a(H,e(Oe)&&e(ae)!==void 0?e(ae):e(d)),it(H,"max",e(d)),y(h,`/ ${e(d)??""}`),y(je,(e(m),i(()=>e(m).resetOn==="short"?"Short Rest":"Long Rest")))}),j("input",H,ve=>{X.update(Be=>(Be.classFeatures.features[e(W)]=parseInt(ve.currentTarget.value)||0,Be))}),j("click",ce,()=>Le(e(W),e(d))),o(z,w)},F=z=>{var d=rt(),w=We(d);{var H=R=>{var h=ul(),ce=l(h),je=a(ce,2),ve=l(je),Be=l(ve);s(ve),s(je);var u=a(je,2);{var se=k=>{var ke=dl();o(k,ke)};$(u,k=>{e(T)<=0&&k(se)})}s(h),M(()=>{ce.disabled=e(T)<=0,y(Be,`Resets on ${e(m),i(()=>e(m).resetOn==="short"?"Short Rest":"Long Rest")??""}`)}),j("click",ce,K),o(R,h)};$(w,R=>{e(m),i(()=>e(m).type==="channelDivinity")&&R(H)},!0)}o(z,d)};$(Ge,z=>{e(m),i(()=>e(m).type==="pool")?z(Ae):z(F,!1)},!0)}o(ie,Se)};$(qe,ie=>{e(m),i(()=>e(m).type==="uses")?ie(Ze):ie($e,!1)})}s(Me),M(ie=>{y(we,` ${e(m),i(()=>e(m).name)??""}`),y(Ue,ie)},[()=>(e(m),i(()=>oe(e(m))))]),o(Je,Me)}),s(b),o(be,b)};$(De,be=>{e(P),i(()=>e(P).length===0)?be(fe):be(ze,!1)},!0)}o(q,ee)};$(p,q=>{t(),i(()=>!t().class)?q(O):q(Z,!1)})}o(g,I)};$(le,g=>{C(),i(()=>!C().classFeatures)&&g(Q)})}s(Y),M(()=>{pe=dt(Y,1,"class-features svelte-1kpvv0n",null,pe,{hidden:!e(re)}),it(Fe,"aria-label",(C(),i(()=>C().classFeatures?"Expand":"Collapse"))),y(L,(C(),i(()=>C().classFeatures?"â–¼":"â–²")))}),j("click",Fe,G),o(n,Y),kt(),B()}var hl=f('<textarea placeholder="Enter features, traits, and special abilities..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Equipment</h3> <textarea placeholder="List your equipment and inventory..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Notes</h3> <textarea placeholder="Additional notes..." class="svelte-wttn0l"></textarea>',1),ml=f('<section><div class="header svelte-wttn0l"><h2 class="svelte-wttn0l">Features & Traits</h2> <button class="collapse-btn svelte-wttn0l"> </button></div> <!></section>');function _l(n,v){xt(v,!1);const t=()=>Ke(Rt,"$searchFilter",C),c=()=>Ke(X,"$character",C),S=()=>Ke(gt,"$collapsedStates",C),[C,D]=Lt(),B=A();function _(){gt.update(de=>({...de,notes:!de.notes}))}et(()=>(t(),c()),()=>{r(B,!t()||"features".includes(t().toLowerCase())||"traits".includes(t().toLowerCase())||"equipment".includes(t().toLowerCase())||"notes".includes(t().toLowerCase())||c().features.toLowerCase().includes(t().toLowerCase())||c().equipment.toLowerCase().includes(t().toLowerCase())||c().notes.toLowerCase().includes(t().toLowerCase()))}),jt(),yt();var P=ml();let ne;var J=l(P),T=a(l(J),2),He=l(T,!0);s(T),s(J);var re=a(J,2);{var me=de=>{var Le=hl(),E=We(Le);Kt(E);var ye=a(E,4);Kt(ye);var ue=a(ye,4);Kt(ue),Ie(E,()=>c().features,oe=>at(X,i(c).features=oe,i(c))),Ie(ye,()=>c().equipment,oe=>at(X,i(c).equipment=oe,i(c))),Ie(ue,()=>c().notes,oe=>at(X,i(c).notes=oe,i(c))),o(de,Le)};$(re,de=>{S(),i(()=>!S().notes)&&de(me)})}s(P),M(()=>{ne=dt(P,1,"notes svelte-wttn0l",null,ne,{hidden:!e(B)}),it(T,"aria-label",(S(),i(()=>S().notes?"Expand":"Collapse"))),y(He,(S(),i(()=>S().notes?"â–¼":"â–²")))}),j("click",T,_),o(n,P),kt(),D()}var yl=f('<div class="color-picker-section svelte-1r90jgp"><h3 class="svelte-1r90jgp">Dice Colors</h3> <div class="color-inputs svelte-1r90jgp"><div class="color-input-group svelte-1r90jgp"><label for="dice-color" class="svelte-1r90jgp">Dice Color</label> <input type="color" id="dice-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="label-color" class="svelte-1r90jgp">Label Color</label> <input type="color" id="label-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="desk-color" class="svelte-1r90jgp">Background Color</label> <input type="color" id="desk-color" class="svelte-1r90jgp"/></div></div></div>'),xl=f('<div class="loading svelte-1r90jgp"><p class="svelte-1r90jgp">Loading 3D dice...</p></div>'),kl=f('<div class="custom-dice-selector svelte-1r90jgp"><h3 class="svelte-1r90jgp">Choose Dice to Roll</h3> <div class="dice-inputs svelte-1r90jgp"><div class="dice-input-group svelte-1r90jgp"><label for="d4" class="svelte-1r90jgp">d4</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d4" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d6" class="svelte-1r90jgp">d6</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d6" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d8" class="svelte-1r90jgp">d8</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d8" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d10" class="svelte-1r90jgp">d10</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d10" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d12" class="svelte-1r90jgp">d12</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d12" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d20" class="svelte-1r90jgp">d20</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d20" min="0" max="10"/></div></div> <div class="dice-controls svelte-1r90jgp"><button class="btn btn-primary use-enabled svelte-1r90jgp"> </button> <button class="btn btn-secondary use-enabled svelte-1r90jgp">Reset</button></div></div>'),$l=f('<span class="crit-badge svelte-1r90jgp">CRITICAL!</span>'),Sl=f('<p class="svelte-1r90jgp"> </p>'),Cl=f('<p class="modifier-text svelte-1r90jgp"> </p>'),Ll=f('<button class="btn btn-follow-up svelte-1r90jgp"> </button>'),Dl=f('<button class="btn btn-guided-strike svelte-1r90jgp">âš¡ Use Guided Strike (+10)</button>'),wl=f('<div class="follow-up-actions svelte-1r90jgp"><!> <!></div>'),jl=f('<div class="result-header svelte-1r90jgp"><h3 class="svelte-1r90jgp"> </h3> <!></div> <div class="result-total svelte-1r90jgp"> </div> <div class="result-details svelte-1r90jgp"><!> <!></div> <!>',1),Fl=f('<div role="button" tabindex="-1"><div class="modal-content svelte-1r90jgp" role="dialog" tabindex="0"><div class="modal-header svelte-1r90jgp"><h2 class="svelte-1r90jgp">Dice Roller</h2> <div class="header-buttons svelte-1r90jgp"><button class="color-btn svelte-1r90jgp" title="Customize dice colors">ðŸŽ¨</button> <button class="close-btn svelte-1r90jgp">Ã—</button></div></div> <!> <!> <div class="dice-main-area svelte-1r90jgp"><div class="dice-container svelte-1r90jgp"></div> <!></div> <div><!></div></div></div>');function Al(n,v){xt(v,!1);const t=()=>Ke(X,"$character",c),[c,S]=Lt(),C=A(),D=A(),B=A(),_=Gt();let P=Et(v,"notation",12,""),ne=Et(v,"visible",8,!1),J=Et(v,"damageNotation",12,""),T=Et(v,"attackName",12,""),He=Et(v,"applyHalfDamage",8,!1),re=null,me=A(void 0),de=A(!1),Le=A(""),E=A(null);function ye(){return e(E)?.resultTotal??null}let ue=A(0),oe=A(0),K=A(0),G=A(0),Y=A(0),pe=A(0),V=A(0),Fe=A([]),L=A(!1),le=A("other"),Q=A(!1),g=A("#051e0a"),I=A("#ffffff"),p=A("#3a2004"),O=A(!1);function Z(d){return d.length===9&&d.startsWith("#")?d.substring(0,7):d}function q(d,w="ff"){return d.length===7&&d.startsWith("#")?d+w:d}function ee(){if(window.DICE&&e(me))try{re&&e(me)&&Ea(me,e(me).innerHTML="");const d=e(me).clientWidth||500,w=e(me).clientHeight||300;re=new window.DICE.dice_box(e(me),{w:d,h:w}),r(de,!0)}catch(d){console.error("Error initializing dice box:",d)}}Qt(()=>{const d=R=>new Promise((h,ce)=>{if(document.querySelector(`script[src="${R}"]`)){console.log(`Script already loaded: ${R}`),h(null);return}const ve=document.createElement("script");ve.src=R,ve.onload=()=>{console.log(`Loaded: ${R}`),h(null)},ve.onerror=()=>{console.error(`Failed to load: ${R}`),ce(new Error(`Failed to load ${R}`))},document.head.appendChild(ve)});setTimeout(()=>{d(`${Wt}/libs/three.min.js`).then(()=>d(`${Wt}/libs/cannon.min.js`)).then(()=>d(`${Wt}/libs/teal.js`)).then(()=>d(`${Wt}/dice.js`)).then(()=>{if(console.log("All scripts loaded, initializing dice box..."),console.log("DICE available:",!!window.DICE),console.log("Container available:",!!e(me)),window.DICE){const R=window.DICE.getColors();r(g,Z(R.dice_color)),r(I,Z(R.label_color)),r(p,Z(R.desk_color))}ee()}).catch(R=>{console.error("Failed to load dice libraries:",R)})},100);const w=()=>{e(de)&&(console.log("Window resized, reinitializing dice box..."),ee())},H=R=>{ne()&&R.key==="Escape"&&Je()};return window.addEventListener("resize",w),window.addEventListener("keydown",H),()=>{window.removeEventListener("resize",w),window.removeEventListener("keydown",H)}});function De(d,w="other"){if(!re||!e(de))return;console.log("Rolling dice:",d,"type:",w),r(le,w),r(Q,!1),re.diceToRoll=d;const H=h=>(console.log("Before roll:",h),null),R=h=>{console.log("After roll:",h);let ce=h.resultTotal,je=h.resultString;if(He()&&(ce=Math.floor(ce/2),je=je+" (halved)"),r(E,{...h,resultTotal:ce,resultString:je}),w==="attack"||w==="check"||w==="save"){const ve=h.results?.filter(Be=>Be.sides===20)||[];if(ve.length>0){const Be=ve[0].value;r(L,Be===20)}}if(r(Fe,[]),w==="attack"&&J())if(e(L)){const ve=be(J());e(Fe).push({label:`Roll Critical Damage (${ve})`,notation:ve})}else e(Fe).push({label:`Roll Damage (${J()})`,notation:J()})};re.start_throw(H,R)}function fe(){const d=[];e(ue)>0&&d.push(`${e(ue)}d4`),e(oe)>0&&d.push(`${e(oe)}d6`),e(K)>0&&d.push(`${e(K)}d8`),e(G)>0&&d.push(`${e(G)}d10`),e(Y)>0&&d.push(`${e(Y)}d12`),e(pe)>0&&d.push(`${e(pe)}d20`);let w=d.join("+")||"1d20";return e(V)!==0&&(w+=e(V)>=0?`+${e(V)}`:`${e(V)}`),w}function ze(){const d=fe();De(d)}function be(d){return d.replace(/(\d+)d(\d+)/g,(w,H,R)=>`${parseInt(H)*2}d${R}`)}function b(){r(ue,0),r(oe,0),r(K,0),r(G,0),r(Y,0),r(pe,0),r(V,0),r(E,null),r(Fe,[]),r(L,!1),r(le,"other"),r(Q,!1)}function Ne(){window.DICE&&(window.DICE.setColors({dice_color:q(e(g),"ff"),label_color:q(e(I),"ff"),desk_color:e(p)}),re&&(re.updateDeskColor(e(p)),re.updateDiceColors()))}function Qe(){r(O,!e(O))}function Xe(){!e(E)||e(D)<=0||e(Q)||(r(E,{...e(E),resultTotal:e(E).resultTotal+10,resultString:e(E).resultString+" + 10 (Guided Strike)"}),X.update(d=>{const w="ChannelDivinity",H=d.classFeatures.features[w];return typeof H=="number"&&H>0&&(d.classFeatures.features[w]=H-1),d}),r(Q,!0))}function Je(){_("close"),P(""),J(""),T(""),r(Le,""),r(E,null),r(Q,!1),b()}et(()=>(t(),Nt),()=>{r(C,t().class?Nt(t().class,t().level,t().subclass).some(w=>w.name==="Guided Strike"):!1)}),et(()=>t(),()=>{r(D,(()=>{const w=t().classFeatures.features["ChannelDivinity"];return typeof w=="number"?w:0})())}),et(()=>(e(ue),e(oe),e(K),e(G),e(Y),e(pe),e(V)),()=>{r(B,(()=>{const d=[];e(ue)>0&&d.push(`${e(ue)}d4`),e(oe)>0&&d.push(`${e(oe)}d6`),e(K)>0&&d.push(`${e(K)}d8`),e(G)>0&&d.push(`${e(G)}d10`),e(Y)>0&&d.push(`${e(Y)}d12`),e(pe)>0&&d.push(`${e(pe)}d20`);let w=d.join("+")||"1d20";return e(V)!==0&&(w+=e(V)>=0?`+${e(V)}`:`${e(V)}`),w})())}),et(()=>(U(P()),e(de),U(ne()),e(Le),U(J()),U(T())),()=>{if(P()&&e(de)&&ne()&&P()!==e(Le)){r(Le,P()),r(E,null),r(Fe,[]),r(L,!1),r(Q,!1);const d=P().includes("1d20")?"attack":"other";console.log("Auto-roll triggered. notation:",P(),"damageNotation:",J(),"attackName:",T()),setTimeout(()=>De(P(),d),200)}}),jt();var m={getLastRollTotal:ye};yt();var W=Fl();let ae;var ge=l(W),Oe=l(ge),Me=a(l(Oe),2),N=l(Me),te=a(N,2);s(Me),s(Oe);var x=a(Oe,2);{var we=d=>{var w=yl(),H=a(l(w),2),R=l(H),h=a(l(R),2);Ce(h),s(R);var ce=a(R,2),je=a(l(ce),2);Ce(je),s(ce);var ve=a(ce,2),Be=a(l(ve),2);Ce(Be),s(ve),s(H),s(w),Ie(h,()=>e(g),u=>r(g,u)),j("change",h,Ne),Ie(je,()=>e(I),u=>r(I,u)),j("change",je,Ne),Ie(Be,()=>e(p),u=>r(p,u)),j("change",Be,Ne),o(d,w)};$(x,d=>{e(O)&&d(we)})}var xe=a(x,2);{var Ue=d=>{var w=xl();o(d,w)};$(xe,d=>{e(de)||d(Ue)})}var qe=a(xe,2),Ze=l(qe);ma(Ze,d=>r(me,d),()=>e(me));var $e=a(Ze,2);{var ie=d=>{var w=kl(),H=a(l(w),2),R=l(H),h=a(l(R),2);Ce(h),s(R);var ce=a(R,2),je=a(l(ce),2);Ce(je),s(ce);var ve=a(ce,2),Be=a(l(ve),2);Ce(Be),s(ve);var u=a(ve,2),se=a(l(u),2);Ce(se),s(u);var k=a(u,2),ke=a(l(k),2);Ce(ke),s(k);var Te=a(k,2),Ve=a(l(Te),2);Ce(Ve),s(Te),s(H);var Pe=a(H,2),Ee=l(Pe),Re=l(Ee);s(Ee);var he=a(Ee,2);s(Pe),s(w),M(()=>{Ee.disabled=!e(de),y(Re,`Roll ${e(B)??""}`)}),Ie(h,()=>e(ue),_e=>r(ue,_e)),Ie(je,()=>e(oe),_e=>r(oe,_e)),Ie(Be,()=>e(K),_e=>r(K,_e)),Ie(se,()=>e(G),_e=>r(G,_e)),Ie(ke,()=>e(Y),_e=>r(Y,_e)),Ie(Ve,()=>e(pe),_e=>r(pe,_e)),j("click",Ee,ze),j("click",he,b),o(d,w)};$($e,d=>{P()||d(ie)})}s(qe);var Se=a(qe,2);let Ge;var Ae=l(Se);{var F=d=>{var w=jl(),H=We(w),R=l(H),h=l(R,!0);s(R);var ce=a(R,2);{var je=Ee=>{var Re=$l();o(Ee,Re)};$(ce,Ee=>{e(L)&&Ee(je)})}s(H);var ve=a(H,2),Be=l(ve,!0);s(ve);var u=a(ve,2),se=l(u);{var k=Ee=>{var Re=Sl(),he=l(Re,!0);s(Re),M(()=>y(he,(e(E),i(()=>e(E).resultString)))),o(Ee,Re)};$(se,Ee=>{e(E),i(()=>e(E).resultString)&&Ee(k)})}var ke=a(se,2);{var Te=Ee=>{var Re=Cl(),he=l(Re);s(Re),M(()=>y(he,`Modifier: ${e(E),i(()=>e(E).constant>=0?"+":"")??""}${e(E),i(()=>e(E).constant)??""}`)),o(Ee,Re)};$(ke,Ee=>{e(E),i(()=>e(E).constant)&&Ee(Te)})}s(u);var Ve=a(u,2);{var Pe=Ee=>{var Re=wl(),he=l(Re);vt(he,1,()=>e(Fe),bt,(nt,st)=>{var ut=Ll(),Mt=l(ut,!0);s(ut),M(()=>y(Mt,(e(st),i(()=>e(st).label)))),j("click",ut,()=>De(e(st).notation,"damage")),o(nt,ut)});var _e=a(he,2);{var It=nt=>{var st=Dl();M(()=>{st.disabled=e(D)<=0,it(st,"title",e(D)<=0?"No Channel Divinity uses remaining":"Use Channel Divinity to add +10 to this attack roll")}),j("click",st,Xe),o(nt,st)};$(_e,nt=>{e(C)&&e(le)==="attack"&&!e(Q)&&nt(It)})}s(Re),o(Ee,Re)};$(Ve,Ee=>{e(Fe),e(C),e(le),e(Q),i(()=>e(Fe).length>0||e(C)&&e(le)==="attack"&&!e(Q))&&Ee(Pe)})}M(()=>{y(h,T()?`${T()} - Result`:"Result"),y(Be,(e(E),i(()=>e(E).resultTotal)))}),o(d,w)};$(Ae,d=>{e(E)&&d(F)})}s(Se),s(ge),s(W),M(()=>{ae=dt(W,1,"modal-overlay svelte-1r90jgp",null,ae,{hidden:!ne()}),Ge=dt(Se,1,"roll-result svelte-1r90jgp",null,Ge,{"has-result":e(E)})}),j("click",N,Qe),j("click",te,Je),j("click",ge,Sa(function(d){Tt.call(this,v,d)})),j("keydown",ge,function(d){Tt.call(this,v,d)}),j("click",W,Je),j("keydown",W,d=>d.key==="Escape"&&Je()),o(n,W),ts(v,"getLastRollTotal",ye);var z=kt(m);return S(),z}const ra="https://api.github.com/gists";async function Rl(n,v,t){if(!v)throw new Error("GitHub token is required");const c=JSON.stringify(n,null,2),S=`${n.name||"character"}_dnd.json`,C={description:t||`D&D Character: ${n.name}`,public:!1,files:{[S]:{content:c}}},D=await fetch(ra,{method:"POST",headers:{Authorization:`token ${v}`,"Content-Type":"application/json"},body:JSON.stringify(C)});if(!D.ok)throw new Error(`Failed to create gist: ${D.statusText}`);return(await D.json()).id}async function Il(n,v,t){if(!v||!t)throw new Error("GitHub token and Gist ID are required");const c=JSON.stringify(n,null,2),C={files:{[`${n.name||"character"}_dnd.json`]:{content:c}}},D=await fetch(`${ra}/${t}`,{method:"PATCH",headers:{Authorization:`token ${v}`,"Content-Type":"application/json"},body:JSON.stringify(C)});if(!D.ok)throw new Error(`Failed to update gist: ${D.statusText}`)}async function Ml(n,v){if(!n)throw new Error("Gist ID is required");const t={"Content-Type":"application/json"};v&&(t.Authorization=`token ${v}`);const c=await fetch(`${ra}/${n}`,{method:"GET",headers:t});if(!c.ok)throw new Error(`Failed to load gist: ${c.statusText}`);const S=await c.json(),C=Object.values(S.files);if(C.length===0)throw new Error("No files found in gist");const B=C[0].content;try{const _=JSON.parse(B);return _.attacks&&Array.isArray(_.attacks)&&(_.attacks=_.attacks.map(P=>({...P,id:P.id||crypto.randomUUID()}))),_.classFeatures?(_.classFeatures.features||(_.classFeatures.features={}),_.classFeatures.spellSlots||(_.classFeatures.spellSlots=[]),_.classFeatures.preparedSpells===void 0&&(_.classFeatures.preparedSpells="")):_.classFeatures={features:{},spellSlots:[],preparedSpells:""},_}catch{throw new Error("Invalid character data in gist")}}function ja(n){typeof window<"u"&&localStorage.setItem("dnd_gist_config",JSON.stringify(n))}function Pl(){if(typeof window<"u"){const n=localStorage.getItem("dnd_gist_config");if(n)return JSON.parse(n)}return{}}async function El(n,v=30){if(!n)throw new Error("GitHub token is required to list gists");const t=await fetch(`${ra}?per_page=${v}`,{method:"GET",headers:{Authorization:`token ${n}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error(`Failed to list gists: ${t.statusText}`);return await t.json()}var Hl=f('<div class="error-message svelte-1jb5ckg"> </div>'),Ul=f('<div class="toggle-container svelte-1jb5ckg"><button type="button" class="toggle-btn svelte-1jb5ckg"> </button></div>'),Bl=f('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID (leave empty to create new)</label> <input type="text" id="gistId" placeholder="Optional: existing Gist ID to update" class="svelte-1jb5ckg"/></div>'),Tl=f('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),Nl=f('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),Gl=f('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Update (or leave unselected to create new)</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),Ol=f('<div class="info-message svelte-1jb5ckg">No gists found. A new one will be created.</div>'),ql=f('<!> <div class="form-group svelte-1jb5ckg"><label for="description" class="svelte-1jb5ckg"> </label> <input type="text" id="description" placeholder="D&amp;D Character Sheet" class="svelte-1jb5ckg"/></div>',1),zl=f('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID *</label> <input type="text" id="gistId" placeholder="Enter Gist ID (for public or your private gists)" required class="svelte-1jb5ckg"/></div>'),Wl=f('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),Kl=f('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),Jl=f('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Load</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),Vl=f('<div class="info-message svelte-1jb5ckg">No gists found. Enter a Gist ID manually or create a new one in Save mode.</div>'),Ql=f('<div class="modal-overlay svelte-1jb5ckg" role="button" tabindex="-1"><div class="modal-content svelte-1jb5ckg" role="dialog" tabindex="0"><div class="modal-header svelte-1jb5ckg"><h2 class="svelte-1jb5ckg"> </h2> <button class="close-btn svelte-1jb5ckg">Ã—</button></div> <div class="modal-body svelte-1jb5ckg"><!> <div class="form-group svelte-1jb5ckg"><label for="token" class="svelte-1jb5ckg"> <a href="https://github.com/settings/tokens" target="_blank" rel="noopener" class="svelte-1jb5ckg">Get token</a></label> <input type="password" id="token" placeholder="ghp_xxxxxxxxxxxxx" class="svelte-1jb5ckg"/></div> <!> <!> <div class="modal-actions svelte-1jb5ckg"><button class="btn btn-primary svelte-1jb5ckg"><!></button> <button class="btn btn-secondary svelte-1jb5ckg">Cancel</button></div></div></div></div>');function Xl(n,v){xt(v,!1);const t=()=>Ke(X,"$character",c),[c,S]=Lt(),C=Gt();let D=Et(v,"mode",8,"save"),B=A(""),_=A(""),P=A(""),ne=A(!1),J=A(""),T=A(!1),He=A(!1),re=A([]),me=A(null);const de=Pl();de.token&&r(B,de.token),de.gistId&&r(_,de.gistId),Qt(async()=>{e(B)&&!e(T)&&await Le()});async function Le(){if(e(B)){r(He,!0),r(J,"");try{r(re,await El(e(B))),e(_)&&r(me,e(re).find(m=>m.id===e(_))||null)}catch(m){r(J,m.message||"Failed to load gists"),r(re,[])}finally{r(He,!1)}}}function E(m){r(me,m),r(_,m.id)}function ye(){r(T,!e(T)),r(J,""),!e(T)&&e(B)&&Le()}async function ue(){if(!e(B)){r(J,"GitHub token is required");return}const m=e(me)?.id||e(_);r(ne,!0),r(J,"");try{if(m)await Il(t(),e(B),m),r(_,m),Jt.add("Character updated in Gist successfully!","success");else{const W=await Rl(t(),e(B),e(P));r(_,W),Jt.add(`Character saved to Gist! ID: ${W}`,"success")}ja({token:e(B),gistId:e(_)}),C("close")}catch(W){r(J,W.message||"Failed to save to Gist")}finally{r(ne,!1)}}async function oe(){const m=e(me)?.id||e(_);if(!m){r(J,"Please select a gist or enter a Gist ID");return}r(ne,!0),r(J,"");try{const W=await Ml(m,e(B)||void 0);X.set(W),r(_,m),ja({token:e(B),gistId:e(_)}),Jt.add("Character loaded from Gist successfully!","success"),C("close")}catch(W){r(J,W.message||"Failed to load from Gist")}finally{r(ne,!1)}}function K(){C("close")}yt();var G=Ql(),Y=l(G),pe=l(Y),V=l(pe),Fe=l(V,!0);s(V);var L=a(V,2);s(pe);var le=a(pe,2),Q=l(le);{var g=m=>{var W=Hl(),ae=l(W,!0);s(W),M(()=>y(ae,e(J))),o(m,W)};$(Q,m=>{e(J)&&m(g)})}var I=a(Q,2),p=l(I),O=l(p);Ha(),s(p);var Z=a(p,2);Ce(Z),s(I);var q=a(I,2);{var ee=m=>{var W=Ul(),ae=l(W),ge=l(ae,!0);s(ae),s(W),M(()=>{ae.disabled=e(ne),y(ge,e(T)?"ðŸ“‹ Show My Gists":"âœï¸ Enter Gist ID Manually")}),j("click",ae,ye),o(m,W)};$(q,m=>{(D()==="load"||D()==="save"&&e(B))&&m(ee)})}var De=a(q,2);{var fe=m=>{var W=ql(),ae=We(W);{var ge=we=>{var xe=Bl(),Ue=a(l(xe),2);Ce(Ue),s(xe),M(()=>Ue.disabled=e(ne)),Ie(Ue,()=>e(_),qe=>r(_,qe)),o(we,xe)},Oe=we=>{var xe=rt(),Ue=We(xe);{var qe=$e=>{var ie=Tl();o($e,ie)},Ze=$e=>{var ie=rt(),Se=We(ie);{var Ge=F=>{var z=Gl(),d=a(l(z),2);vt(d,5,()=>e(re),bt,(w,H)=>{var R=Nl();let h;var ce=l(R),je=l(ce),ve=l(je,!0);s(je);var Be=a(je,2),u=l(Be,!0);s(Be),s(ce);var se=a(ce,2),k=l(se),ke=l(k);s(k);var Te=a(k,2),Ve=l(Te);s(Te),s(se),s(R),M(Pe=>{h=dt(R,1,"gist-item svelte-1jb5ckg",null,h,{selected:e(me)?.id===e(H).id}),R.disabled=e(ne),y(ve,(e(H),i(()=>e(H).description||"Untitled"))),y(u,(e(H),i(()=>e(H).public?"ðŸŒ Public":"ðŸ”’ Private"))),y(ke,`ID: ${e(H),i(()=>e(H).id)??""}`),y(Ve,`Updated: ${Pe??""}`)},[()=>(e(H),i(()=>new Date(e(H).updated_at).toLocaleDateString()))]),j("click",R,()=>E(e(H))),o(w,R)}),s(d),s(z),o(F,z)},Ae=F=>{var z=rt(),d=We(z);{var w=H=>{var R=Ol();o(H,R)};$(d,H=>{e(B)&&H(w)},!0)}o(F,z)};$(Se,F=>{e(re),i(()=>e(re).length>0)?F(Ge):F(Ae,!1)},!0)}o($e,ie)};$(Ue,$e=>{e(He)?$e(qe):$e(Ze,!1)},!0)}o(we,xe)};$(ae,we=>{e(T)||!e(B)?we(ge):we(Oe,!1)})}var Me=a(ae,2),N=l(Me),te=l(N);s(N);var x=a(N,2);Ce(x),s(Me),M(()=>{y(te,`Description ${e(_)?"(optional)":""}`),x.disabled=e(ne)}),Ie(x,()=>e(P),we=>r(P,we)),o(m,W)},ze=m=>{var W=rt(),ae=We(W);{var ge=Me=>{var N=zl(),te=a(l(N),2);Ce(te),s(N),M(()=>te.disabled=e(ne)),Ie(te,()=>e(_),x=>r(_,x)),o(Me,N)},Oe=Me=>{var N=rt(),te=We(N);{var x=xe=>{var Ue=Wl();o(xe,Ue)},we=xe=>{var Ue=rt(),qe=We(Ue);{var Ze=ie=>{var Se=Jl(),Ge=a(l(Se),2);vt(Ge,5,()=>e(re),bt,(Ae,F)=>{var z=Kl();let d;var w=l(z),H=l(w),R=l(H,!0);s(H);var h=a(H,2),ce=l(h,!0);s(h),s(w);var je=a(w,2),ve=l(je),Be=l(ve);s(ve);var u=a(ve,2),se=l(u);s(u),s(je),s(z),M(k=>{d=dt(z,1,"gist-item svelte-1jb5ckg",null,d,{selected:e(me)?.id===e(F).id}),z.disabled=e(ne),y(R,(e(F),i(()=>e(F).description||"Untitled"))),y(ce,(e(F),i(()=>e(F).public?"ðŸŒ Public":"ðŸ”’ Private"))),y(Be,`ID: ${e(F),i(()=>e(F).id)??""}`),y(se,`Updated: ${k??""}`)},[()=>(e(F),i(()=>new Date(e(F).updated_at).toLocaleDateString()))]),j("click",z,()=>E(e(F))),o(Ae,z)}),s(Ge),s(Se),o(ie,Se)},$e=ie=>{var Se=rt(),Ge=We(Se);{var Ae=F=>{var z=Vl();o(F,z)};$(Ge,F=>{e(B)&&F(Ae)},!0)}o(ie,Se)};$(qe,ie=>{e(re),i(()=>e(re).length>0)?ie(Ze):ie($e,!1)},!0)}o(xe,Ue)};$(te,xe=>{e(He)?xe(x):xe(we,!1)},!0)}o(Me,N)};$(ae,Me=>{e(T)||!e(B)?Me(ge):Me(Oe,!1)})}o(m,W)};$(De,m=>{D()==="save"?m(fe):m(ze,!1)})}var be=a(De,2),b=l(be),Ne=l(b);{var Qe=m=>{var W=ft();M(()=>y(W,D()==="save"?"Saving...":"Loading...")),o(m,W)},Xe=m=>{var W=ft();M(()=>y(W,D()==="save"?"Save":"Load")),o(m,W)};$(Ne,m=>{e(ne)?m(Qe):m(Xe,!1)})}s(b);var Je=a(b,2);s(be),s(le),s(Y),s(G),M(()=>{y(Fe,D()==="save"?"Save to GitHub Gist":"Load from GitHub Gist"),y(O,`GitHub Token ${D()==="load"?"(optional for public gists)":"(required)"} `),Z.disabled=e(ne),b.disabled=e(ne),Je.disabled=e(ne)}),j("click",L,K),Ie(Z,()=>e(B),m=>r(B,m)),j("blur",Z,()=>{e(B)&&!e(T)&&Le()}),j("click",b,function(...m){(D()==="save"?ue:oe)?.apply(this,m)}),j("click",Je,K),j("click",Y,Sa(function(m){Tt.call(this,v,m)})),j("keydown",Y,function(m){Tt.call(this,v,m)}),j("click",G,K),j("keydown",G,m=>m.key==="Escape"&&K()),o(n,G),kt(),S()}var Yl=f('<div class="loading svelte-1ngjemu">Loading D&D data...</div>'),Zl=f("<option> </option>"),ei=f('<select class="level-filter svelte-1ngjemu"><option>All Levels</option><option>Cantrip</option><!></select>'),ti=f('<div class="no-results svelte-1ngjemu"> </div>'),ai=f('<div class="item-meta svelte-1ngjemu"> </div>'),si=f('<div class="item-meta svelte-1ngjemu"> </div>'),li=f('<button><div class="item-name svelte-1ngjemu"> </div> <!></button>'),ii=f('<p class="higher-levels"><strong>At Higher Levels:</strong> </p>'),ni=f('<p class="cantrip-upgrade"><strong>Cantrip Upgrade:</strong> </p>'),ri=f('<h3 class="svelte-1ngjemu"> </h3> <p class="spell-meta svelte-1ngjemu"><!> <!></p> <p class="spell-classes"><strong>Classes:</strong> </p> <div class="spell-stats svelte-1ngjemu"><div><strong>Casting Time:</strong> </div> <div><strong>Range:</strong> </div> <div><strong>Components:</strong> <!></div> <div><strong>Duration:</strong> <!> </div></div> <p class="description svelte-1ngjemu"> </p> <!> <!>',1),oi=f('<p class="prerequisite svelte-1ngjemu"><strong>Prerequisite:</strong> </p>'),ci=f('<h3 class="svelte-1ngjemu"> </h3> <!> <p class="description svelte-1ngjemu"> </p> <a target="_blank" rel="noopener" class="source-link svelte-1ngjemu">View Full Details â†’</a>',1),vi=f('<div class="item-details svelte-1ngjemu"><!></div>'),di=f('<div class="controls svelte-1ngjemu"><div class="tabs svelte-1ngjemu"><button> </button> <button> </button></div> <div class="search-controls svelte-1ngjemu"><input type="text" placeholder="Search by name or description..." class="search-input svelte-1ngjemu"/> <!></div></div> <div class="content-container svelte-1ngjemu"><div class="items-list svelte-1ngjemu"><!></div> <!></div>',1),ui=f('<div class="modal-backdrop svelte-1ngjemu" role="presentation"><div class="modal svelte-1ngjemu" role="dialog" aria-modal="true" tabindex="-1"><div class="modal-header svelte-1ngjemu"><h2 class="svelte-1ngjemu">Browse D&D Spells & Feats</h2> <button class="close-btn svelte-1ngjemu" aria-label="Close">&times;</button></div> <div class="modal-body svelte-1ngjemu"><!></div> <div class="modal-footer svelte-1ngjemu"><button class="btn-secondary svelte-1ngjemu">Cancel</button> <button class="btn-primary svelte-1ngjemu">Add to Character Sheet</button></div></div></div>');function pi(n,v){xt(v,!1);const t=A(),c=A(),S=A();let C=Et(v,"onClose",8),D=A("spell"),B=A(!0),_=A(""),P=A(null),ne=A([]),J=A([]),T=A(null);Qt(async()=>{r(B,!0);try{r(ne,await Na()),r(J,await Ss())}catch(L){console.error("Failed to load data:",L)}finally{r(B,!1)}});function He(L){r(T,L)}function re(L){const le=L.match(/(\d+d\d+(?:\s*\+\s*\d+)?)/i);return le?le[1]:""}function me(L){const le=L.split(/\.( |$)/)[0].trim(),Q=Array.from(L.matchAll(/\*\*(.*?)\*\*/g)).map(I=>I[1].replace(/\.$/,""));let g=le;return Q.length&&(g+=" | Effects: "+Q.join(", ")),g}function de(){if(e(T)){if(e(D)==="spell"){const L=e(T);X.update(le=>{const g=[];L.range&&g.push(`Range: ${L.range}`),L.castingTime&&g.push(`Cast: ${L.castingTime}`),L.duration&&g.push(`Duration: ${L.duration}`),L.actionType==="Save"&&g.push("Saving throw spell"),L.components&&L.components.length>0&&g.push(`Components: ${L.components.join(", ")}`),L.material&&g.push(`Material: ${L.material}`);const I=g.join(" | "),p=me(L.description),O={id:crypto.randomUUID(),name:`${L.name}${L.concentration?" (C)":""}${L.ritual?" (R)":""}`,bonus:L.actionType==="Attack"?5:0,damage:re(L.description),damageType:`${L.school} (Lvl ${L.level})`,spellRef:L.name,infoNotes:I,generalNotes:p,castAtLevel:L.level};return le.attacks=[...le.attacks,O],le})}else if(e(D)==="feat"){const L=e(T);X.update(le=>{const Q=`${L.name}${L.prerequisite?` (Req: ${L.prerequisite})`:""}
${L.description}
`;return le.features=le.features?`${le.features}
${Q}`:Q,le})}r(T,null),C()()}}et(()=>(e(P),e(ne),e(_)),()=>{r(t,e(P)!==null?Cs(wa(e(ne),e(_)),e(P)):wa(e(ne),e(_)))}),et(()=>(e(J),e(_)),()=>{r(c,Ls(e(J),e(_)))}),et(()=>(e(D),e(t),e(c)),()=>{r(S,e(D)==="spell"?e(t):e(c))}),jt(),yt();var Le=ui(),E=l(Le),ye=l(E),ue=a(l(ye),2);s(ye);var oe=a(ye,2),K=l(oe);{var G=L=>{var le=Yl();o(L,le)},Y=L=>{var le=di(),Q=We(le),g=l(Q),I=l(g);let p;var O=l(I);s(I);var Z=a(I,2);let q;var ee=l(Z);s(Z),s(g);var De=a(g,2),fe=l(De);Ce(fe);var ze=a(fe,2);{var be=ae=>{var ge=ei();M(()=>{e(P),Ct(()=>{})});var Oe=l(ge);Oe.value=(Oe.__value=null)??"";var Me=a(Oe);Me.value=Me.__value=0;var N=a(Me);vt(N,0,()=>[1,2,3,4,5,6,7,8,9],bt,(te,x)=>{var we=Zl(),xe=l(we);s(we);var Ue={};M(()=>{y(xe,`Level ${x??""}`),Ue!==(Ue=x)&&(we.value=(we.__value=x)??"")}),o(te,we)}),s(ge),Ba(ge,()=>e(P),te=>r(P,te)),o(ae,ge)};$(ze,ae=>{e(D)==="spell"&&ae(be)})}s(De),s(Q);var b=a(Q,2),Ne=l(b),Qe=l(Ne);{var Xe=ae=>{var ge=ti(),Oe=l(ge);s(ge),M(()=>y(Oe,`No ${e(D)??""}s found`)),o(ae,ge)},Je=ae=>{var ge=rt(),Oe=We(ge);vt(Oe,1,()=>e(S),bt,(Me,N)=>{var te=li();let x;var we=l(te),xe=l(we,!0);s(we);var Ue=a(we,2);{var qe=$e=>{const ie=tt(()=>e(N));var Se=ai(),Ge=l(Se);s(Se),M(()=>y(Ge,`Level ${U(e(ie)),i(()=>e(ie).level)??""} â€¢ ${U(e(ie)),i(()=>e(ie).school)??""}`)),o($e,Se)},Ze=$e=>{const ie=tt(()=>e(N));var Se=rt(),Ge=We(Se);{var Ae=F=>{var z=si(),d=l(z,!0);s(z),M(()=>y(d,(U(e(ie)),i(()=>e(ie).prerequisite)))),o(F,z)};$(Ge,F=>{U(e(ie)),i(()=>e(ie).prerequisite)&&F(Ae)})}o($e,Se)};$(Ue,$e=>{e(D)==="spell"?$e(qe):$e(Ze,!1)})}s(te),M(()=>{x=dt(te,1,"item-card svelte-1ngjemu",null,x,{selected:e(T)?.name===e(N).name}),y(xe,(e(N),i(()=>e(N).name)))}),j("click",te,()=>He(e(N))),o(Me,te)}),o(ae,ge)};$(Qe,ae=>{e(S),i(()=>e(S).length===0)?ae(Xe):ae(Je,!1)})}s(Ne);var m=a(Ne,2);{var W=ae=>{var ge=vi(),Oe=l(ge);{var Me=te=>{const x=tt(()=>e(T));var we=ri(),xe=We(we),Ue=l(xe,!0);s(xe);var qe=a(xe,2),Ze=l(qe);{var $e=he=>{var _e=ft();M(()=>y(_e,`${U(e(x)),i(()=>e(x).school)??""} cantrip`)),o(he,_e)},ie=he=>{var _e=ft();M(()=>y(_e,`Level ${U(e(x)),i(()=>e(x).level)??""} ${U(e(x)),i(()=>e(x).school)??""}`)),o(he,_e)};$(Ze,he=>{U(e(x)),i(()=>e(x).level===0)?he($e):he(ie,!1)})}var Se=a(Ze,2);{var Ge=he=>{var _e=ft("(ritual)");o(he,_e)};$(Se,he=>{U(e(x)),i(()=>e(x).ritual)&&he(Ge)})}s(qe);var Ae=a(qe,2),F=a(l(Ae));s(Ae);var z=a(Ae,2),d=l(z),w=a(l(d));s(d);var H=a(d,2),R=a(l(H));s(H);var h=a(H,2),ce=a(l(h)),je=a(ce);{var ve=he=>{var _e=ft();M(()=>y(_e,`(${U(e(x)),i(()=>e(x).material)??""})`)),o(he,_e)};$(je,he=>{U(e(x)),i(()=>e(x).material)&&he(ve)})}s(h);var Be=a(h,2),u=a(l(Be),2);{var se=he=>{var _e=ft("Concentration,");o(he,_e)};$(u,he=>{U(e(x)),i(()=>e(x).concentration)&&he(se)})}var k=a(u,1,!0);s(Be),s(z);var ke=a(z,2),Te=l(ke,!0);s(ke);var Ve=a(ke,2);{var Pe=he=>{var _e=ii(),It=a(l(_e));s(_e),M(()=>y(It,` ${U(e(x)),i(()=>e(x).higherLevelSlot)??""}`)),o(he,_e)};$(Ve,he=>{U(e(x)),i(()=>e(x).higherLevelSlot)&&he(Pe)})}var Ee=a(Ve,2);{var Re=he=>{var _e=ni(),It=a(l(_e));s(_e),M(()=>y(It,` ${U(e(x)),i(()=>e(x).cantripUpgrade)??""}`)),o(he,_e)};$(Ee,he=>{U(e(x)),i(()=>e(x).cantripUpgrade)&&he(Re)})}M((he,_e)=>{y(Ue,(U(e(x)),i(()=>e(x).name))),y(F,` ${he??""}`),y(w,` ${U(e(x)),i(()=>e(x).castingTime||e(x).actionType)??""}`),y(R,` ${U(e(x)),i(()=>e(x).range)??""}`),y(ce,` ${_e??""}`),y(k,(U(e(x)),i(()=>e(x).duration))),y(Te,(U(e(x)),i(()=>e(x).description)))},[()=>(U(e(x)),i(()=>e(x).classes.join(", "))),()=>(U(e(x)),i(()=>e(x).components.join(", ").toUpperCase()))]),o(te,we)},N=te=>{const x=tt(()=>e(T));var we=ci(),xe=We(we),Ue=l(xe,!0);s(xe);var qe=a(xe,2);{var Ze=Ge=>{var Ae=oi(),F=a(l(Ae));s(Ae),M(()=>y(F,` ${U(e(x)),i(()=>e(x).prerequisite)??""}`)),o(Ge,Ae)};$(qe,Ge=>{U(e(x)),i(()=>e(x).prerequisite)&&Ge(Ze)})}var $e=a(qe,2),ie=l($e,!0);s($e);var Se=a($e,2);M(()=>{y(Ue,(U(e(x)),i(()=>e(x).name))),y(ie,(U(e(x)),i(()=>e(x).description))),it(Se,"href",(U(e(x)),i(()=>e(x).source)))}),o(te,we)};$(Oe,te=>{e(D)==="spell"?te(Me):te(N,!1)})}s(ge),o(ae,ge)};$(m,ae=>{e(T)&&ae(W)})}s(b),M(()=>{p=dt(I,1,"tab svelte-1ngjemu",null,p,{active:e(D)==="spell"}),y(O,`ðŸ“œ Spells (${e(ne),i(()=>e(ne).length)??""})`),q=dt(Z,1,"tab svelte-1ngjemu",null,q,{active:e(D)==="feat"}),y(ee,`â­ Feats (${e(J),i(()=>e(J).length)??""})`)}),j("click",I,()=>{r(D,"spell"),r(T,null),r(_,"")}),j("click",Z,()=>{r(D,"feat"),r(T,null),r(_,"")}),Ie(fe,()=>e(_),ae=>r(_,ae)),o(L,le)};$(K,L=>{e(B)?L(G):L(Y,!1)})}s(oe);var pe=a(oe,2),V=l(pe),Fe=a(V,2);s(pe),s(E),s(Le),M(()=>Fe.disabled=!e(T)),j("click",ue,function(...L){C()?.apply(this,L)}),j("click",V,function(...L){C()?.apply(this,L)}),j("click",Fe,de),j("click",E,Sa(function(L){Tt.call(this,v,L)})),j("keydown",E,function(L){Tt.call(this,v,L)}),j("click",Le,function(...L){C()?.apply(this,L)}),j("keydown",Le,L=>L.key==="Escape"&&C()()),o(n,Le),kt()}var fi=f('<link rel="icon" type="image/png" href="/favicon.png"/> <meta name="viewport" content="width=device-width, initial-scale=1"/>',1),bi=f('<span class="character-name svelte-1uha8ag"> </span>'),gi=f("<span> </span>"),hi=f('<div class="spell-slots-header svelte-1uha8ag"></div>'),mi=f('<div class="rest-menu svelte-1uha8ag"><button class="rest-option svelte-1uha8ag">â˜• Short Rest</button> <button class="rest-option svelte-1uha8ag">ðŸ›ï¸ Long Rest</button></div>'),_i=f('<div class="container svelte-1uha8ag"><header class="svelte-1uha8ag"><div class="header-top svelte-1uha8ag"><div class="header-title svelte-1uha8ag"><div class="title-row svelte-1uha8ag"><h1 class="svelte-1uha8ag">D&D Character Sheet</h1> <!></div> <!></div> <div class="header-right svelte-1uha8ag"><div class="header-controls svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">ðŸŽ²</span><span class="btn-text svelte-1uha8ag">Roll Dice</span></button> <div class="rest-button-container svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">ðŸ˜´</span><span class="btn-text svelte-1uha8ag">Rest</span></button> <!></div> <div class="mode-toggle"><button><span class="btn-icon svelte-1uha8ag"> </span><span class="btn-text svelte-1uha8ag"> </span></button></div></div> <div class="header-search svelte-1uha8ag"><input type="text" placeholder="ðŸ” Search..." class="search-input use-enabled svelte-1uha8ag"/></div></div></div> <div class="header-actions svelte-1uha8ag"><button class="btn btn-mode svelte-1uha8ag">ðŸ“š Browse Spells & Feats</button> <button class="btn btn-secondary">Save to Gist</button> <button class="btn btn-secondary">Load from Gist</button> <button class="btn btn-secondary">Export JSON</button> <button class="btn btn-secondary">Import JSON</button> <input type="file" accept=".json" style="display: none;"/></div></header> <main class="svelte-1uha8ag"><!> <!> <!> <!> <!> <!> <!></main></div> <!> <!> <!> <!>',1);function wi(n,v){xt(v,!1);const t=()=>Ke(X,"$character",C),c=()=>Ke(la,"$isEditMode",C),S=()=>Ke(Rt,"$searchFilter",C),[C,D]=Lt();function B(){const u=[],se=t().classFeatures.spellSlotsByLevel||{};for(let k=1;k<=9;k++){const ke=se[k];if(ke&&ke.length>0){const Te=ke.length,Ve=ke.filter(Pe=>Pe).length;u.push({level:k,available:Te-Ve,total:Te})}}return u}let _=A(!1),P=A(!1),ne=A(!1),J=A("save"),T=A(void 0),He=A(""),re=A(""),me=A(""),de=A(!1),Le=A(),E=!1,ye=A(!1);function ue(){const u=[];X.update(k=>{const ke=k.hitDice.current;k.hitDice.current=Math.min(k.hitDice.max,k.hitDice.current+Math.max(1,Math.floor(k.hitDice.max/2)));const Te=k.hitDice.current-ke;if(Te>0&&u.push(`${Te} hit ${Te===1?"die":"dice"}`),k.class){const Ve=Nt(k.class,k.level,k.subclass);k.classFeatures.features||(k.classFeatures.features={}),Ve.forEach(Pe=>{if(Pe.resetOn==="short"){const Ee=Pe.name.replace(/\s+/g,"");if(Pe.type==="uses"){const Re=typeof Pe.maxUses=="function"?Pe.maxUses(k.level):Pe.maxUses;k.classFeatures.features[Ee]=Array(Re).fill(!1),u.push(Pe.name)}else if(Pe.type==="pool"){const Re=typeof Pe.maxPool=="function"?Pe.maxPool(k.level):Pe.maxPool;Re!==void 0&&(k.classFeatures.features[Ee]=Re,u.push(Pe.name))}}})}return k}),r(ye,!1);const se=u.length>0?`Short rest taken! Restored: ${u.join(", ")}`:"Short rest taken!";Jt.add(se,"success")}function oe(){const u=[];X.update(k=>{const ke=k.maxHP-k.currentHP;ke>0&&u.push(`${ke} HP`),k.currentHP=k.maxHP,k.tempHP=0;const Te=k.hitDice.max-k.hitDice.current;Te>0&&u.push(`${Te} hit ${Te===1?"die":"dice"}`),k.hitDice.current=k.hitDice.max;let Ve=0;if(k.classFeatures.spellSlotsByLevel&&Object.keys(k.classFeatures.spellSlotsByLevel).forEach(Pe=>{const Ee=k.classFeatures.spellSlotsByLevel[parseInt(Pe)];if(Ee){const Re=Ee.filter(he=>he).length;Ve+=Re,k.classFeatures.spellSlotsByLevel[parseInt(Pe)]=Array(Ee.length).fill(!1)}}),Ve>0&&u.push(`${Ve} spell ${Ve===1?"slot":"slots"}`),k.class){const Pe=Nt(k.class,k.level,k.subclass);k.classFeatures.features||(k.classFeatures.features={});let Ee=!1;Pe.forEach(Re=>{const he=Re.name.replace(/\s+/g,"");if(!(Re.type==="info"||Re.type==="channelDivinity")){if(Re.type==="uses"){const _e=typeof Re.maxUses=="function"?Re.maxUses(k.level):Re.maxUses;k.classFeatures.features[he]=Array(_e).fill(!1),Ee=!0}else if(Re.type==="pool"){const _e=typeof Re.maxPool=="function"?Re.maxPool(k.level):Re.maxPool;_e!==void 0&&(k.classFeatures.features[he]=_e,Ee=!0)}}}),Ee&&u.push("all class features")}return k}),r(ye,!1);const se=u.length>0?`Long rest taken! Restored: ${u.join(", ")}`:"Long rest taken! Fully rested.";Jt.add(se,"success")}function K(u){r(He,""),r(re,""),r(me,""),r(de,!1),E=!1,typeof u=="string"?r(He,u):(r(He,u.notation),r(re,u.damageNotation||""),r(me,u.attackName||""),r(de,!!u.applyHalfDamage)),r(_,!0)}function G(u){const{notation:se}=u.detail;r(He,""),E=!0,setTimeout(()=>{r(He,se),r(re,""),r(me,"Hit Die")},0),r(_,!0)}function Y(){if(r(_,!1),E&&e(Le)){const u=e(Le).getLastRollTotal();if(u!==null){const se=Math.max(1,u);X.update(k=>(k.hitDice.current=Math.max(0,k.hitDice.current-1),k.currentHP=Math.min(k.maxHP,k.currentHP+se),k))}E=!1}}function pe(){console.log("toggleMode called, current isEditMode:",c()),la.update(u=>(console.log("Updating isEditMode from",u,"to",!u),!u))}function V(u){u.target.closest(".rest-button-container")||r(ye,!1)}Qt(()=>{console.log("onMount - initial isEditMode:",c()),console.log("onMount - body classes:",document.body.className);const u=la.subscribe(se=>{console.log("isEditMode subscription triggered, value:",se),console.log("Body classes before:",document.body.className),se?(document.body.classList.remove("use-mode"),console.log("Removed use-mode class (Edit Mode)")):(document.body.classList.add("use-mode"),console.log("Added use-mode class (Use Mode)")),console.log("Body classes after:",document.body.className)});return document.addEventListener("click",V),()=>{u(),document.removeEventListener("click",V)}});function Fe(){Xa(t())}function L(){e(T)?.click()}async function le(u){const k=u.target.files?.[0];if(k)try{const ke=await Ya(k);X.set(ke),alert("Character imported successfully!")}catch{alert("Failed to import character file")}}yt();var Q=_i();Va("1uha8ag",u=>{var se=fi();Ha(2),Ra(()=>{Ka.title="D&D Character Sheet"}),o(u,se)});var g=We(Q),I=l(g),p=l(I),O=l(p),Z=l(O),q=a(l(Z),2);{var ee=u=>{var se=bi(),k=l(se,!0);s(se),M(()=>y(k,t().name)),o(u,se)};$(q,u=>{t().name&&u(ee)})}s(Z);var De=a(Z,2);{var fe=u=>{var se=hi();vt(se,5,B,bt,(k,ke)=>{var Te=gi();let Ve;var Pe=l(Te);s(Te),M(()=>{Ve=dt(Te,1,"slot-badge svelte-1uha8ag",null,Ve,{depleted:e(ke).available===0}),y(Pe,`Lv${e(ke).level??""}: ${e(ke).available??""}/${e(ke).total??""}`)}),o(k,Te)}),s(se),o(u,se)};$(De,u=>{B().length>0&&u(fe)})}s(O);var ze=a(O,2),be=l(ze),b=l(be),Ne=a(b,2),Qe=l(Ne),Xe=a(Qe,2);{var Je=u=>{var se=mi(),k=l(se),ke=a(k,2);s(se),j("click",k,ue),j("click",ke,oe),o(u,se)};$(Xe,u=>{e(ye)&&u(Je)})}s(Ne);var m=a(Ne,2),W=l(m);let ae;var ge=l(W),Oe=l(ge,!0);s(ge);var Me=a(ge),N=l(Me,!0);s(Me),s(W),s(m),s(be);var te=a(be,2),x=l(te);Ce(x),s(te),s(ze),s(p);var we=a(p,2),xe=l(we),Ue=a(xe,2),qe=a(Ue,2),Ze=a(qe,2),$e=a(Ze,2),ie=a($e,2);ma(ie,u=>r(T,u),()=>e(T)),s(we),s(I);var Se=a(I,2),Ge=l(Se);vs(Ge,{});var Ae=a(Ge,2);_s(Ae,{$$events:{rollHitDice:G}});var F=a(Ae,2);fs(F,{$$events:{roll:u=>K(u.detail)}});var z=a(F,2);$s(z,{$$events:{roll:u=>K(u.detail)}});var d=a(z,2);Zs(d,{$$events:{roll:u=>K(u.detail)}});var w=a(d,2);gl(w,{});var H=a(w,2);_l(H,{}),s(Se),s(g);var R=a(g,2);ma(Al(R,{get notation(){return e(He)},get damageNotation(){return e(re)},get attackName(){return e(me)},get applyHalfDamage(){return e(de)},get visible(){return e(_)},$$events:{close:Y},$$legacy:!0}),u=>r(Le,u),()=>e(Le));var h=a(R,2);{var ce=u=>{Xl(u,{get mode(){return e(J)},$$events:{close:()=>r(P,!1)}})};$(h,u=>{e(P)&&u(ce)})}var je=a(h,2);{var ve=u=>{pi(u,{onClose:()=>r(ne,!1)})};$(je,u=>{e(ne)&&u(ve)})}var Be=a(je,2);Qa(Be,{}),M(()=>{ae=dt(W,1,"btn btn-mode svelte-1uha8ag",null,ae,{"use-mode":!c()}),y(Oe,c()?"ðŸ“":"ðŸŽ²"),y(N,c()?"Edit Mode":"Use Mode")}),j("click",b,()=>r(_,!0)),j("click",Qe,()=>r(ye,!e(ye))),j("click",W,pe),Ie(x,S,u=>Za(Rt,u)),j("click",xe,()=>r(ne,!0)),j("click",Ue,()=>{r(J,"save"),r(P,!0)}),j("click",qe,()=>{r(J,"load"),r(P,!0)}),j("click",Ze,Fe),j("click",$e,L),j("change",ie,le),o(n,Q),kt(),D()}export{wi as component};
