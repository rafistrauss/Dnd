import{f as g,e as F,a as o,s as y,c as nt,t as bt}from"../chunks/BmKkCgmR.js";import{i as yt}from"../chunks/AFJ5q3G2.js";import{c as Ut,o as Vt}from"../chunks/BwhX61NF.js";import{a6 as $a,i as Sa,b1 as Ta,b2 as Ha,b3 as ba,J as Dt,e as Ca,b4 as La,aa as Ua,b as i,r as wa,R as Da,g as Ba,B as xt,b5 as Ye,b6 as wt,E as M,F as kt,s as n,a3 as A,G as l,I as t,H as s,d as e,C as ze,k as tt,z as I,b7 as St,b8 as Wt,b9 as ja,an as Fa,ba as Na}from"../chunks/CmcvLP-Y.js";import{s as lt,c as Y,a as ht,r as xe,e as ut,i as gt,b as ga,u as Ra,d as jt,f as pt,g as ta,j as Yt,k as Ga,t as Kt,h as Oa,T as qa,l as za,m as Wa}from"../chunks/BH0g7pxY.js";import{i as k,s as Ct,a as Je,b as at,d as Ka}from"../chunks/BibxXT0t.js";import{p as Et,b as ua}from"../chunks/BNYf2NzH.js";import{b as zt,r as Ja}from"../chunks/BZEbPckC.js";function Zt(r,u,a=!1){if(r.multiple){if(u==null)return;if(!Sa(u))return Ta();for(var v of r.options)v.selected=u.includes(Jt(v));return}for(v of r.options){var S=Jt(v);if(Ha(S,u)){v.selected=!0;return}}(!a||u!==void 0)&&(r.selectedIndex=-1)}function pa(r){var u=new MutationObserver(()=>{Zt(r,r.__value)});u.observe(r,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),$a(()=>{u.disconnect()})}function Aa(r,u,a=u){var v=new WeakSet,S=!0;ba(r,"change",C=>{var D=C?"[selected]":":checked",G;if(r.multiple)G=[].map.call(r.querySelectorAll(D),Jt);else{var h=r.querySelector(D)??r.querySelector("option:not([disabled])");G=h&&Jt(h)}a(G),Dt!==null&&v.add(Dt)}),Ca(()=>{var C=u();if(r===document.activeElement){var D=La??Dt;if(v.has(D))return}if(Zt(r,C,S),S&&C===void 0){var G=r.querySelector(":checked");G!==null&&(C=Jt(G),a(C))}r.__value=C,S=!1}),pa(r)}function Jt(r){return"__value"in r?r.__value:r.value}function Ie(r,u,a=u){var v=new WeakSet;ba(r,"input",async S=>{var C=S?r.defaultValue:r.value;if(C=ca(r)?va(C):C,a(C),Dt!==null&&v.add(Dt),await Ua(),C!==(C=u())){var D=r.selectionStart,G=r.selectionEnd,h=r.value.length;if(r.value=C??"",G!==null){var O=r.value.length;D===G&&G===h&&O>h?(r.selectionStart=O,r.selectionEnd=O):(r.selectionStart=D,r.selectionEnd=Math.min(G,O))}}}),(Da&&r.defaultValue!==r.value||i(u)==null&&r.value)&&(a(ca(r)?va(r.value):r.value),Dt!==null&&v.add(Dt)),wa(()=>{var S=u();if(r===document.activeElement){var C=La??Dt;if(v.has(C))return}ca(r)&&S===va(r.value)||r.type==="date"&&!S&&!r.value||S!==r.value&&(r.value=S??"")})}function ea(r,u,a=u){ba(r,"change",v=>{var S=v?r.defaultChecked:r.checked;a(S)}),(Da&&r.defaultChecked!==r.checked||i(u)==null)&&a(r.checked),wa(()=>{var v=u();r.checked=!!v})}function ca(r){var u=r.type;return u==="number"||u==="range"}function va(r){return r===""?null:+r}function Va(r,u,a){var v=Ba(r,u);v&&v.set&&(r[u]=a,$a(()=>{r[u]=null}))}function ha(r){return function(...u){var a=u[0];return a.stopPropagation(),r?.apply(this,u)}}function Tt(r,u){var a=r.$$events?.[u.type],v=Sa(a)?a.slice():a==null?[]:[a];for(var S of v)S.call(this,u)}const Qa="";function Ia(...r){return zt+Qa+Ja(r[0],r[1])}const fa={paladin:{name:"Paladin",hitDice:"d10",spellcaster:!0,spellcastingAbility:"charisma",spellSlotsByLevel:{1:0,2:2,3:3,4:3,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Divine Sense",type:"uses",maxUses:(r,u=1)=>1+Math.max(1,u),resetOn:"long",description:"Detect celestials, fiends, and undead within 60 feet",minLevel:1},{name:"Lay on Hands",type:"pool",maxPool:r=>r*5,resetOn:"long",description:"Heal wounds or cure disease",minLevel:1},{name:"Divine Smite",type:"spellSlot",description:"Expend spell slot to deal extra radiant damage",minLevel:2,rollable:!0},{name:"Channel Divinity",type:"pool",maxPool:r=>r>=18?3:r>=6?2:1,resetOn:"short",description:"Sacred Weapon or Turn Undead",minLevel:3}]},fighter:{name:"Fighter",hitDice:"d10",spellcaster:!1,features:[{name:"Second Wind",type:"uses",maxUses:1,resetOn:"short",description:"Regain 1d10 + fighter level HP as bonus action",minLevel:1,rollable:!0,rollFormula:r=>`1d10+${r}`},{name:"Action Surge",type:"uses",maxUses:r=>r>=17?2:1,resetOn:"short",description:"Take one additional action on your turn",minLevel:2},{name:"Indomitable",type:"uses",maxUses:r=>r>=17?3:r>=13?2:1,resetOn:"long",description:"Reroll a failed saving throw",minLevel:9}],subclasses:{champion:{name:"Champion",features:[{name:"Improved Critical",type:"info",description:"Critical hit on 19-20",minLevel:3},{name:"Remarkable Athlete",type:"info",description:"Add half proficiency to STR/DEX/CON checks, increase long jump distance",minLevel:7},{name:"Additional Fighting Style",type:"info",description:"Choose a second fighting style",minLevel:10},{name:"Superior Critical",type:"info",description:"Critical hit on 18-20",minLevel:15},{name:"Survivor",type:"info",description:"Regain 5 + CON mod HP at start of turn if below half HP",minLevel:18}]},battlemaster:{name:"Battle Master",features:[{name:"Combat Superiority",type:"uses",maxUses:r=>r>=15?6:r>=7?5:4,resetOn:"short",description:r=>`Use superiority dice (${r>=18?"d12":r>=10?"d10":"d8"}) for maneuvers`,minLevel:3},{name:"Know Your Enemy",type:"info",description:"Learn capabilities of creatures you observe",minLevel:7},{name:"Improved Combat Superiority",type:"info",description:"Superiority dice become d10",minLevel:10},{name:"Relentless",type:"info",description:"Regain 1 superiority die if you have none at start of turn",minLevel:15}]}}},rogue:{name:"Rogue",hitDice:"d8",spellcaster:!1,features:[{name:"Sneak Attack",type:"info",description:r=>`Deal ${Math.ceil(r/2)}d6 extra damage once per turn with advantage or ally nearby`,minLevel:1,rollable:!0,rollFormula:r=>`${Math.ceil(r/2)}d6`},{name:"Cunning Action",type:"info",description:"Dash, Disengage, or Hide as a bonus action",minLevel:2},{name:"Uncanny Dodge",type:"info",description:"Use reaction to halve damage from an attack",minLevel:5},{name:"Evasion",type:"info",description:"Take no damage on successful Dex save (half on fail)",minLevel:7}]},wizard:{name:"Wizard",hitDice:"d6",spellcaster:!0,spellcastingAbility:"intelligence",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Arcane Recovery",type:"uses",maxUses:1,resetOn:"long",description:r=>`Recover spell slots totaling up to ${Math.ceil(r/2)} levels during short rest`,minLevel:1},{name:"Spell Mastery",type:"info",description:"Cast one 1st-level and one 2nd-level spell at will",minLevel:18}]},cleric:{name:"Cleric",hitDice:"d8",spellcaster:!0,spellcastingAbility:"wisdom",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Channel Divinity",type:"pool",maxPool:r=>r>=18?3:r>=6?2:1,resetOn:"short",description:"Turn Undead or domain-specific ability",minLevel:2},{name:"Destroy Undead",type:"info",description:r=>`Channel Divinity destroys undead of CR ${r>=17?4:r>=14?3:r>=11?2:r>=8?1:.5} or lower`,minLevel:5},{name:"Divine Intervention",type:"uses",maxUses:1,resetOn:"long",description:r=>`${r}% chance to succeed, implore deity for aid`,minLevel:10}],subclasses:{war:{name:"War Domain",features:[{name:"War Priest",type:"uses",maxUses:(r,u=1)=>Math.max(1,u),resetOn:"long",description:"Make one weapon attack as a bonus action",minLevel:1},{name:"Guided Strike",type:"channelDivinity",description:"Use your Channel Divinity to gain +10 to an attack roll. Make this choice after you see the roll, but before the DM says whether the attack hits or misses.",minLevel:2,resetOn:"short"},{name:"War God's Blessing",type:"channelDivinity",description:"Use reaction to grant +10 to an ally's attack roll within 30 feet. Consumes one use of Channel Divinity.",minLevel:6,resetOn:"short"},{name:"Divine Strike",type:"info",description:r=>`Deal extra ${r>=14?"2d8":"1d8"} weapon damage once per turn`,minLevel:8,rollable:!0,rollFormula:r=>r>=14?"2d8":"1d8"},{name:"Avatar of Battle",type:"info",description:"Gain resistance to nonmagical weapon damage",minLevel:17}]},life:{name:"Life Domain",features:[{name:"Disciple of Life",type:"info",description:"Healing spells restore additional 2 + spell level HP",minLevel:1},{name:"Preserve Life",type:"pool",maxPool:r=>r*5,resetOn:"short",description:"Restore HP to creatures within 30 feet",minLevel:2},{name:"Blessed Healer",type:"info",description:"Regain 2 + spell level HP when you cast healing spell",minLevel:6},{name:"Divine Strike",type:"info",description:r=>`Deal extra ${r>=14?"2d8":"1d8"} radiant damage once per turn`,minLevel:8,rollable:!0,rollFormula:r=>r>=14?"2d8":"1d8"},{name:"Supreme Healing",type:"info",description:"Maximize healing dice instead of rolling",minLevel:17}]}}},barbarian:{name:"Barbarian",hitDice:"d12",spellcaster:!1,features:[{name:"Rage",type:"uses",maxUses:r=>r>=20?1/0:r>=17?6:r>=12?5:r>=6?4:r>=3?3:2,resetOn:"long",description:r=>`+${r>=16?4:r>=9?3:2} damage, resistance to physical damage`,minLevel:1},{name:"Reckless Attack",type:"info",description:"Gain advantage on melee attacks, enemies get advantage on you",minLevel:2},{name:"Danger Sense",type:"info",description:"Advantage on Dex saves against effects you can see",minLevel:2}],subclasses:{berserker:{name:"Path of the Berserker",features:[{name:"Frenzy",type:"info",description:"While raging, make melee attack as bonus action (gain 1 exhaustion after rage)",minLevel:3},{name:"Mindless Rage",type:"info",description:"Cannot be charmed or frightened while raging",minLevel:6},{name:"Intimidating Presence",type:"info",description:"Use action to frighten creature within 30 feet",minLevel:10},{name:"Retaliation",type:"info",description:"When damaged by creature within 5 feet, make melee attack as reaction",minLevel:14}]}}}};function _t(r){const u=r.toLowerCase();return fa[u]||null}function Ht(r,u,a){const v=_t(r);if(!v)return[];const S=v.features.filter(C=>!C.minLevel||C.minLevel<=u);if(a&&v.subclasses&&v.subclasses[a]){const C=v.subclasses[a].features.filter(D=>!D.minLevel||D.minLevel<=u);return[...S,...C]}return S}function ma(r){const u=_t(r);return!u||!u.subclasses?[]:Object.keys(u.subclasses).map(a=>({id:a,name:u.subclasses[a].name}))}function _a(r,u){const a=_t(r);return!a||!a.spellcaster||!a.spellSlotsByLevel?0:a.spellSlotsByLevel[u]||0}function ya(r,u,a){const v=_t(r);return!v||!v.spellcaster?0:Math.max(1,a+u)}function Xa(r,u,a){const v=_t(r);return!v||!v.spellcaster?null:8+u+a}function Ya(){return Object.keys(fa).map(r=>({id:r,name:fa[r].name}))}var Za=g("<option> </option>"),es=g("<option> </option>"),ts=g('<div class="form-group svelte-172i2fj"><label for="characterSubclass" class="svelte-172i2fj">Subclass</label> <select id="characterSubclass" class="svelte-172i2fj"><option>Select Subclass</option><!></select></div>'),as=g('<div class="info-grid svelte-172i2fj"><div class="form-group svelte-172i2fj"><label for="characterName" class="svelte-172i2fj">Character Name</label> <input type="text" id="characterName" placeholder="Enter name" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterClass" class="svelte-172i2fj">Class</label> <select id="characterClass" class="svelte-172i2fj"><option>Select Class</option><!></select></div> <!> <div class="form-group svelte-172i2fj"><label for="characterLevel" class="svelte-172i2fj">Level</label> <input type="number" id="characterLevel" min="1" max="20" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterRace" class="svelte-172i2fj">Race</label> <input type="text" id="characterRace" placeholder="e.g., Human" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterBackground" class="svelte-172i2fj">Background</label> <input type="text" id="characterBackground" placeholder="e.g., Soldier" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterAlignment" class="svelte-172i2fj">Alignment</label> <input type="text" id="characterAlignment" placeholder="e.g., Lawful Good" class="svelte-172i2fj"/></div></div>'),ss=g('<section class="character-info svelte-172i2fj"><div class="header svelte-172i2fj"><h2 class="svelte-172i2fj">Character Info</h2> <button class="collapse-btn svelte-172i2fj"> </button></div> <!></section>');function ls(r,u){xt(u,!1);const a=()=>Je(Y,"$character",S),v=()=>Je(ht,"$collapsedStates",S),[S,C]=Ct(),D=A(),G=Ya();function h(ae){const ce=ae.target;Y.update(pe=>(pe.class=ce.value,pe.subclass="",pe))}function O(ae){const ce=ae.target;Y.update(pe=>(pe.subclass=ce.value,pe))}function oe(ae){const ce=ae.target;Y.update(pe=>(pe.level=parseInt(ce.value)||1,pe)),Ra()}function E(){ht.update(ae=>({...ae,characterInfo:!ae.characterInfo}))}Ye(()=>(a(),ma),()=>{n(D,a().class?ma(a().class):[])}),wt(),yt();var J=ss(),be=l(J),ne=t(l(be),2),ke=l(ne,!0);s(ne),s(be);var ge=t(be,2);{var B=ae=>{var ce=as(),pe=l(ce),z=t(l(pe),2);xe(z),s(pe);var W=t(pe,2),H=t(l(W),2),se=l(H);se.value=se.__value="";var te=t(se);ut(te,1,()=>G,gt,(fe,Pe)=>{var me=Za(),je=l(me,!0);s(me);var b={};M(()=>{y(je,(e(Pe),i(()=>e(Pe).name))),b!==(b=(e(Pe),i(()=>e(Pe).id)))&&(me.value=(me.__value=(e(Pe),i(()=>e(Pe).id)))??"")}),o(fe,me)}),s(H);var le;pa(H),s(W);var Me=t(W,2);{var $=fe=>{var Pe=ts(),me=t(l(Pe),2),je=l(me);je.value=je.__value="";var b=t(je);ut(b,1,()=>e(D),gt,(Ue,We)=>{var Ke=es(),Ze=l(Ke,!0);s(Ke);var m={};M(()=>{y(Ze,(e(We),i(()=>e(We).name))),m!==(m=(e(We),i(()=>e(We).id)))&&(Ke.value=(Ke.__value=(e(We),i(()=>e(We).id)))??"")}),o(Ue,Ke)}),s(me);var Ee;pa(me),s(Pe),M(()=>{Ee!==(Ee=(a(),i(()=>a().subclass)))&&(me.value=(me.__value=(a(),i(()=>a().subclass)))??"",Zt(me,(a(),i(()=>a().subclass))))}),F("change",me,O),o(fe,Pe)};k(Me,fe=>{e(D),i(()=>e(D).length>0)&&fe($)})}var Z=t(Me,2),ie=t(l(Z),2);xe(ie),s(Z);var _=t(Z,2),c=t(l(_),2);xe(c),s(_);var R=t(_,2),ve=t(l(R),2);xe(ve),s(R);var N=t(R,2),ue=t(l(N),2);xe(ue),s(N),s(ce),M(()=>{le!==(le=(a(),i(()=>a().class)))&&(H.value=(H.__value=(a(),i(()=>a().class)))??"",Zt(H,(a(),i(()=>a().class)))),ga(ie,(a(),i(()=>a().level)))}),Ie(z,()=>a().name,fe=>at(Y,i(a).name=fe,i(a))),F("change",H,h),F("change",ie,oe),Ie(c,()=>a().race,fe=>at(Y,i(a).race=fe,i(a))),Ie(ve,()=>a().background,fe=>at(Y,i(a).background=fe,i(a))),Ie(ue,()=>a().alignment,fe=>at(Y,i(a).alignment=fe,i(a))),o(ae,ce)};k(ge,ae=>{v(),i(()=>!v().characterInfo)&&ae(B)})}s(J),M(()=>{lt(ne,"aria-label",(v(),i(()=>v().characterInfo?"Expand":"Collapse"))),y(ke,(v(),i(()=>v().characterInfo?"â–¼":"â–²")))}),F("click",ne,E),o(r,J),kt(),C()}var is=g('<div class="ability-card svelte-bbv1xt"><h3 class="svelte-bbv1xt"> </h3> <input type="number" class="ability-score svelte-bbv1xt" min="1" max="30"/> <div class="ability-modifier svelte-bbv1xt"> </div> <button class="roll-btn svelte-bbv1xt">Check</button> <div class="save-row svelte-bbv1xt"><input type="checkbox" class="svelte-bbv1xt"/> <label class="svelte-bbv1xt">Save</label> <button class="roll-btn-small svelte-bbv1xt">Roll</button></div></div>'),rs=g('<div class="proficiency-bonus svelte-bbv1xt"><label for="profBonus">Proficiency Bonus</label> <input type="number" id="profBonus" class="prof-input svelte-bbv1xt"/></div> <div class="abilities-grid svelte-bbv1xt"></div>',1),ns=g('<section><div class="header svelte-bbv1xt"><h2 class="svelte-bbv1xt">Ability Scores</h2> <button class="collapse-btn svelte-bbv1xt"> </button></div> <!></section>');function os(r,u){xt(u,!1);const a=()=>Je(ta,"$abilityModifiers",D),v=()=>Je(Y,"$character",D),S=()=>Je(jt,"$searchFilter",D),C=()=>Je(ht,"$collapsedStates",D),[D,G]=Ct(),h=A(),O=A(),oe=Ut(),E=[{key:"strength",label:"Strength"},{key:"dexterity",label:"Dexterity"},{key:"constitution",label:"Constitution"},{key:"intelligence",label:"Intelligence"},{key:"wisdom",label:"Wisdom"},{key:"charisma",label:"Charisma"}];function J(){Ra()}function be(H){const se=a()[H],te=`1d20${se>=0?"+":""}${se}`;oe("roll",te)}function ne(H){const se=a()[H],te=v().saveProficiencies[H]?v().proficiencyBonus:0,le=se+te,Me=`1d20${le>=0?"+":""}${le}`;oe("roll",Me)}function ke(){ht.update(H=>({...H,abilityScores:!H.abilityScores}))}Ye(()=>S(),()=>{n(h,E.filter(({label:H})=>S()?H.toLowerCase().includes(S().toLowerCase()):!0))}),Ye(()=>(e(h),S()),()=>{n(O,e(h).length>0||!S()||S().toLowerCase().includes("proficiency"))}),wt(),yt();var ge=ns();let B;var ae=l(ge),ce=t(l(ae),2),pe=l(ce,!0);s(ce),s(ae);var z=t(ae,2);{var W=H=>{var se=rs(),te=ze(se),le=t(l(te),2);xe(le),s(te);var Me=t(te,2);ut(Me,5,()=>e(h),gt,($,Z)=>{let ie=()=>e(Z).key,_=()=>e(Z).label;var c=is(),R=l(c),ve=l(R,!0);s(R);var N=t(R,2);xe(N);var ue=t(N,2),fe=l(ue);s(ue);var Pe=t(ue,2),me=t(Pe,2),je=l(me);xe(je);var b=t(je,2),Ee=t(b,2);s(me),s(c),M(Ue=>{y(ve,Ue),y(fe,`${a(),ie(),i(()=>a()[ie()]>=0?"+":"")??""}${a(),ie(),i(()=>a()[ie()])??""}`),lt(je,"id",`${ie()}-save`),lt(b,"for",`${ie()}-save`)},[()=>(_(),i(()=>_().substring(0,3).toUpperCase()))]),Ie(N,()=>v().abilities[ie()],Ue=>at(Y,i(v).abilities[ie()]=Ue,i(v))),F("change",N,J),F("click",Pe,()=>be(ie())),ea(je,()=>v().saveProficiencies[ie()],Ue=>at(Y,i(v).saveProficiencies[ie()]=Ue,i(v))),F("click",Ee,()=>ne(ie())),o($,c)}),s(Me),Ie(le,()=>v().proficiencyBonus,$=>at(Y,i(v).proficiencyBonus=$,i(v))),o(H,se)};k(z,H=>{C(),i(()=>!C().abilityScores)&&H(W)})}s(ge),M(()=>{B=pt(ge,1,"ability-scores svelte-bbv1xt",null,B,{hidden:!e(O)}),lt(ce,"aria-label",(C(),i(()=>C().abilityScores?"Expand":"Collapse"))),y(pe,(C(),i(()=>C().abilityScores?"â–¼":"â–²")))}),F("click",ce,ke),o(r,ge),kt(),G()}var cs=g('<div class="stat-box svelte-1r5hyyb"><label for="spellSaveDC" class="svelte-1r5hyyb">Spell Save DC</label> <input type="number" id="spellSaveDC" class="stat-input svelte-1r5hyyb" readonly="" title="8 + Proficiency Bonus + Spellcasting Ability Modifier"/></div>'),vs=g('<span class="hit-dice-type"> </span>'),ds=g('<div class="stats-grid svelte-1r5hyyb"><div class="stat-box svelte-1r5hyyb"><label for="armorClass" class="svelte-1r5hyyb">Armor Class</label> <input type="number" id="armorClass" class="stat-input svelte-1r5hyyb"/></div> <div class="stat-box svelte-1r5hyyb"><label for="initiative" class="svelte-1r5hyyb">Initiative</label> <input type="number" id="initiative" class="stat-input svelte-1r5hyyb"/></div> <div class="stat-box svelte-1r5hyyb"><label for="speed" class="svelte-1r5hyyb">Speed</label> <input type="text" id="speed" class="stat-input svelte-1r5hyyb"/></div> <!></div> <div class="hp-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Points</h3> <div class="hp-display svelte-1r5hyyb"><div class="hp-inputs svelte-1r5hyyb"><input type="number" class="hp-current svelte-1r5hyyb" min="0"/> <span class="hp-separator svelte-1r5hyyb">/</span> <input type="number" class="hp-max svelte-1r5hyyb" min="0"/></div> <div class="hp-controls svelte-1r5hyyb"><button class="hp-btn svelte-1r5hyyb">âˆ’</button> <button class="hp-btn svelte-1r5hyyb">+</button> <button class="hp-btn svelte-1r5hyyb">âˆ’5</button> <button class="hp-btn svelte-1r5hyyb">+5</button></div></div> <div class="temp-hp svelte-1r5hyyb"><label for="tempHP" class="svelte-1r5hyyb">Temp HP</label> <input type="number" id="tempHP" min="0" class="svelte-1r5hyyb"/></div></div> <div class="hit-dice-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Dice</h3> <div class="hit-dice-display svelte-1r5hyyb"><input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <span>/</span> <input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <!></div> <div class="hit-dice-controls"><label for="hitDiceCount" class="svelte-1r5hyyb">Roll</label> <input type="number" id="hitDiceCount" class="hit-dice-count-input svelte-1r5hyyb" min="1" value="1"/> <button class="btn btn-primary roll-hit-dice use-enabled svelte-1r5hyyb">ðŸŽ² Roll</button></div></div>',1),us=g('<section><div class="header svelte-1r5hyyb"><h2 class="svelte-1r5hyyb">Combat Stats</h2> <button class="collapse-btn svelte-1r5hyyb"> </button></div> <!></section>');function ps(r,u){xt(u,!1);const a=()=>Je(Y,"$character",D),v=()=>Je(ta,"$abilityModifiers",D),S=()=>Je(jt,"$searchFilter",D),C=()=>Je(ht,"$collapsedStates",D),[D,G]=Ct(),h=A(),O=A(),oe=Ut();function E(z){Y.update(W=>(W.currentHP=Math.max(0,Math.min(W.maxHP,W.currentHP+z)),W))}function J(z=1){if(a().hitDice.current<=0){alert("No hit dice remaining!");return}if(!a().class){alert("Please select a class first!");return}const W=_t(a().class);if(!W){alert("Invalid class configuration!");return}const H=Math.min(z,a().hitDice.current),se=W.hitDice,te=v().constitution,le=te>=0?`+${te}`:`${te}`,Me=`${H}${se}${le}`;oe("rollHitDice",{notation:Me,hitDie:se,count:H})}function be(){ht.update(z=>({...z,combatStats:!z.combatStats}))}Ye(()=>(a(),v()),()=>{n(h,(()=>{if(!a().class)return null;const z=_t(a().class);if(!z||!z.spellcaster||!z.spellcastingAbility)return null;const W=v()[z.spellcastingAbility];return 8+a().proficiencyBonus+W})())}),Ye(()=>S(),()=>{n(O,!S()||"armor class".includes(S().toLowerCase())||"initiative".includes(S().toLowerCase())||"speed".includes(S().toLowerCase())||"hit points".includes(S().toLowerCase())||"hp".includes(S().toLowerCase())||"hit dice".includes(S().toLowerCase())||"spell save".includes(S().toLowerCase())||"combat".includes(S().toLowerCase()))}),wt(),yt();var ne=us();let ke;var ge=l(ne),B=t(l(ge),2),ae=l(B,!0);s(B),s(ge);var ce=t(ge,2);{var pe=z=>{var W=ds(),H=ze(W),se=l(H),te=t(l(se),2);xe(te),s(se);var le=t(se,2),Me=t(l(le),2);xe(Me),s(le);var $=t(le,2),Z=t(l($),2);xe(Z),s($);var ie=t($,2);{var _=U=>{var X=cs(),x=t(l(X),2);xe(x),s(X),M(()=>ga(x,e(h))),o(U,X)};k(ie,U=>{e(h)!==null&&U(_)})}s(H);var c=t(H,2),R=t(l(c),2),ve=l(R),N=l(ve);xe(N);var ue=t(N,4);xe(ue),s(ve);var fe=t(ve,2),Pe=l(fe),me=t(Pe,2),je=t(me,2),b=t(je,2);s(fe),s(R);var Ee=t(R,2),Ue=t(l(Ee),2);xe(Ue),s(Ee),s(c);var We=t(c,2),Ke=t(l(We),2),Ze=l(Ke);xe(Ze);var m=t(Ze,4);xe(m);var V=t(m,2);{var Q=U=>{const X=tt(()=>(I(_t),a(),i(()=>_t(a().class))));var x=nt(),Se=ze(x);{var he=Te=>{const Ne=tt(()=>(v(),i(()=>v().constitution)));var Ve=vs(),Ce=l(Ve);s(Ve),M(()=>y(Ce,`(${I(e(X)),i(()=>e(X).hitDice)??""}${(e(Ne)>=0?`+${e(Ne)}`:e(Ne))??""})`)),o(Te,Ve)};k(Se,Te=>{e(X)&&Te(he)})}o(U,x)};k(V,U=>{a(),i(()=>a().class)&&U(Q)})}s(Ke);var $e=t(Ke,2),Be=t(l($e),2),He=t(Be,2);s($e),s(We),M(()=>{lt(N,"max",(a(),i(()=>a().maxHP))),lt(Ze,"max",(a(),i(()=>a().hitDice.max))),lt(Be,"max",(a(),i(()=>a().hitDice.current))),He.disabled=(a(),i(()=>a().hitDice.current<=0||!a().class))}),Ie(te,()=>a().armorClass,U=>at(Y,i(a).armorClass=U,i(a))),Ie(Me,()=>a().initiative,U=>at(Y,i(a).initiative=U,i(a))),Ie(Z,()=>a().speed,U=>at(Y,i(a).speed=U,i(a))),Ie(N,()=>a().currentHP,U=>at(Y,i(a).currentHP=U,i(a))),Ie(ue,()=>a().maxHP,U=>at(Y,i(a).maxHP=U,i(a))),F("click",Pe,()=>E(-1)),F("click",me,()=>E(1)),F("click",je,()=>E(-5)),F("click",b,()=>E(5)),Ie(Ue,()=>a().tempHP,U=>at(Y,i(a).tempHP=U,i(a))),Ie(Ze,()=>a().hitDice.current,U=>at(Y,i(a).hitDice.current=U,i(a))),Ie(m,()=>a().hitDice.max,U=>at(Y,i(a).hitDice.max=U,i(a))),F("input",Be,U=>{const X=U.target,x=parseInt(X.value);x>a().hitDice.current&&(X.value=String(a().hitDice.current)),x<1&&(X.value="1")}),F("click",He,()=>{const U=document.getElementById("hitDiceCount"),X=parseInt(U?.value||"1");J(X)}),o(z,W)};k(ce,z=>{C(),i(()=>!C().combatStats)&&z(pe)})}s(ne),M(()=>{ke=pt(ne,1,"combat-stats svelte-1r5hyyb",null,ke,{hidden:!e(O)}),lt(B,"aria-label",(C(),i(()=>C().combatStats?"Expand":"Collapse"))),y(ae,(C(),i(()=>C().combatStats?"â–¼":"â–²")))}),F("click",B,be),o(r,ne),kt(),G()}const da={acrobatics:"dexterity",animalHandling:"wisdom",arcana:"intelligence",athletics:"strength",deception:"charisma",history:"intelligence",insight:"wisdom",intimidation:"charisma",investigation:"intelligence",medicine:"wisdom",nature:"intelligence",perception:"wisdom",performance:"charisma",persuasion:"charisma",religion:"intelligence",sleightOfHand:"dexterity",stealth:"dexterity",survival:"wisdom"};var fs=g('<div class="skill-row svelte-1f1pl16"><input type="checkbox" class="svelte-1f1pl16"/> <label class="svelte-1f1pl16"> <span class="ability-tag svelte-1f1pl16"> </span></label> <span class="skill-modifier svelte-1f1pl16"> </span> <button class="roll-btn svelte-1f1pl16">Roll</button></div>'),bs=g('<div class="skills-grid svelte-1f1pl16"></div>'),gs=g('<section><div class="header svelte-1f1pl16"><h2 class="svelte-1f1pl16">Skills</h2> <button class="collapse-btn svelte-1f1pl16"> </button></div> <!></section>');function hs(r,u){xt(u,!1);const a=()=>Je(ta,"$abilityModifiers",D),v=()=>Je(Y,"$character",D),S=()=>Je(jt,"$searchFilter",D),C=()=>Je(ht,"$collapsedStates",D),[D,G]=Ct(),h=A(),O=A(),oe=Ut(),E=[{key:"acrobatics",label:"Acrobatics"},{key:"animalHandling",label:"Animal Handling"},{key:"arcana",label:"Arcana"},{key:"athletics",label:"Athletics"},{key:"deception",label:"Deception"},{key:"history",label:"History"},{key:"insight",label:"Insight"},{key:"intimidation",label:"Intimidation"},{key:"investigation",label:"Investigation"},{key:"medicine",label:"Medicine"},{key:"nature",label:"Nature"},{key:"perception",label:"Perception"},{key:"performance",label:"Performance"},{key:"persuasion",label:"Persuasion"},{key:"religion",label:"Religion"},{key:"sleightOfHand",label:"Sleight of Hand"},{key:"stealth",label:"Stealth"},{key:"survival",label:"Survival"}];function J(W){const H=da[W],se=a()[H],te=v().skillProficiencies[W]?v().proficiencyBonus:0;return se+te}function be(W){const H=J(W),se=`1d20${H>=0?"+":""}${H}`;oe("roll",se)}function ne(){ht.update(W=>({...W,skills:!W.skills}))}Ye(()=>S(),()=>{n(h,E.filter(({label:W})=>S()?W.toLowerCase().includes(S().toLowerCase()):!0))}),Ye(()=>e(h),()=>{n(O,e(h).length>0)}),wt(),yt();var ke=gs();let ge;var B=l(ke),ae=t(l(B),2),ce=l(ae,!0);s(ae),s(B);var pe=t(B,2);{var z=W=>{var H=bs();ut(H,5,()=>e(h),gt,(se,te)=>{let le=()=>e(te).key,Me=()=>e(te).label;const $=tt(()=>(I(da),le(),i(()=>da[le()]))),Z=tt(()=>(le(),i(()=>J(le()))));var ie=fs(),_=l(ie);xe(_);var c=t(_,2),R=l(c),ve=t(R),N=l(ve);s(ve),s(c);var ue=t(c,2),fe=l(ue);s(ue);var Pe=t(ue,2);s(ie),M(me=>{lt(_,"id",le()),lt(c,"for",le()),y(R,`${Me()??""} `),y(N,`(${me??""})`),y(fe,`${e(Z)>=0?"+":""}${e(Z)??""}`)},[()=>(I(e($)),i(()=>e($).substring(0,3).toUpperCase()))]),ea(_,()=>v().skillProficiencies[le()],me=>at(Y,i(v).skillProficiencies[le()]=me,i(v))),F("click",Pe,()=>be(le())),o(se,ie)}),s(H),o(W,H)};k(pe,W=>{C(),i(()=>!C().skills)&&W(z)})}s(ke),M(()=>{ge=pt(ke,1,"skills svelte-1f1pl16",null,ge,{hidden:!e(O)}),lt(ae,"aria-label",(C(),i(()=>C().skills?"Expand":"Collapse"))),y(ce,(C(),i(()=>C().skills?"â–¼":"â–²")))}),F("click",ae,ne),o(r,ke),kt(),G()}let Qt=null,Xt=null;async function Ma(){if(Qt)return Qt;try{return Qt=await(await fetch(Ia("/data/spells.json"))).json(),Qt||[]}catch(r){return console.error("Failed to load spells:",r),[]}}async function ms(){if(Xt)return Xt;try{return Xt=await(await fetch(Ia("/data/feats.json"))).json(),Xt||[]}catch(r){return console.error("Failed to load feats:",r),[]}}function xa(r,u){if(!u.trim())return r;const a=u.toLowerCase();return r.filter(v=>v.name.toLowerCase().includes(a)||v.school.toLowerCase().includes(a)||v.classes.some(S=>S.toLowerCase().includes(a))||v.description.toLowerCase().includes(a))}function _s(r,u){return u===null?r:r.filter(a=>a.level===u)}function ys(r,u){if(!u.trim())return r;const a=u.toLowerCase();return r.filter(v=>v.name.toLowerCase().includes(a)||v.description.toLowerCase().includes(a))}var xs=g('<button class="btn-remove svelte-14o91c5">Ã—</button>'),ks=g('<div class="spell-info-loading svelte-14o91c5">Loading spell info...</div>'),$s=g('<div class="spell-notes svelte-14o91c5"><h4 class="svelte-14o91c5">General Notes</h4> <p> </p></div>'),Ss=g('<li class="svelte-14o91c5"><strong>At Higher Levels:</strong> </li>'),Cs=g('<ul class="svelte-14o91c5"><li class="svelte-14o91c5"><strong>Level:</strong> </li> <li class="svelte-14o91c5"><strong>Casting Time:</strong> </li> <li class="svelte-14o91c5"><strong>Range:</strong> </li> <li class="svelte-14o91c5"><strong>Components:</strong> <!></li> <li class="svelte-14o91c5"><strong>Duration:</strong> <!> </li> <li class="svelte-14o91c5"><strong>Description:</strong> </li> <!></ul>'),Ls=g("<option> </option>"),ws=g('<span class="scaled-damage svelte-14o91c5"><!> </span>'),Ds=g('<span class="scaled-damage svelte-14o91c5"> </span>'),js=g('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> Target is Fiend or Undead <!></label></div>'),Fs=g('<span class="scaled-damage svelte-14o91c5">(Half damage)</span>'),Rs=g('<span class="scaled-damage svelte-14o91c5">(No damage)</span>'),As=g('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> <!></label></div>'),Is=g('<div class="spell-level-selector svelte-14o91c5"><label class="svelte-14o91c5">Cast at Level:</label> <select class="spell-level-select use-enabled svelte-14o91c5"></select> <!></div> <!> <!>',1),Ms=g('<div class="spell-level-selector svelte-14o91c5"><span style="color: #dc3545; font-weight: bold;">No spell slots available!</span></div>'),Ps=g('<!> <div class="spell-info svelte-14o91c5"><div class="spell-info-header svelte-14o91c5" role="button" tabindex="0"><h4 class="svelte-14o91c5">Spell Info</h4> <button class="collapse-btn-small svelte-14o91c5"> </button></div> <!></div> <!>',1),Es=g('<div class="spell-info-missing svelte-14o91c5">Spell info not found.</div>'),Ts=g('<div class="attack-notes svelte-14o91c5"><label class="svelte-14o91c5">Notes</label> <textarea placeholder="e.g., DC 15 Dex save, Range 120 ft, Concentration" class="notes-input svelte-14o91c5" rows="2"></textarea></div>'),Hs=g('<button class="btn btn-primary">Roll Attack</button>'),Us=g('<button class="btn btn-secondary"><!></button>'),Bs=g('<button class="btn btn-secondary">Roll Damage</button>'),Ns=g('<div class="attack-card svelte-14o91c5"><div class="attack-header svelte-14o91c5"><input type="text" placeholder="Attack name" class="attack-name svelte-14o91c5"/> <!></div> <div class="attack-details svelte-14o91c5"><div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Bonus</label> <input type="number" class="attack-bonus svelte-14o91c5"/></div> <div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Damage</label> <input type="text" placeholder="e.g., 2d6+3" class="attack-damage svelte-14o91c5"/></div> <div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Type</label> <input type="text" placeholder="e.g., slashing" class="attack-type svelte-14o91c5"/></div></div> <!> <!> <div class="attack-actions svelte-14o91c5"><!> <!></div></div>'),Gs=g('<p class="no-attacks svelte-14o91c5">No attacks added yet. Click "Add Attack" to create one.</p>'),Os=g('<p class="no-attacks svelte-14o91c5">No attacks match your search.</p>'),qs=g('<button class="btn btn-secondary">Add Attack</button> <div class="attacks-list svelte-14o91c5"><!> <!></div>',1),zs=g('<section><div class="header svelte-14o91c5"><h2 class="svelte-14o91c5">Attacks & Spells</h2> <button class="collapse-btn svelte-14o91c5"> </button></div> <!></section>');function Ws(r,u){xt(u,!1);const a=()=>Je(Y,"$character",D),v=()=>Je(jt,"$searchFilter",D),S=()=>Je(ht,"$collapsedStates",D),C=()=>Je(Yt,"$isEditMode",D),[D,G]=Ct(),h=A(),O=A(),oe=Ut();let E=A({});function J(c){ja(E,e(E)[c]=!e(E)[c]),n(E,{...e(E)})}function be(c){return c.description.toLowerCase().includes("regain")&&(c.description.toLowerCase().includes("hit point")||c.description.toLowerCase().includes("hp"))}function ne(){Y.update(c=>(c.attacks=[...c.attacks,{id:crypto.randomUUID(),name:"",bonus:0,damage:"",damageType:"",notes:""}],c))}function ke(c){Y.update(R=>(R.attacks=R.attacks.filter(ve=>ve.id!==c),R))}function ge(c){let R=c.damage;if(c.spellRef){const N=z(c.spellRef);if(N&&N.level>0){const ue=c.castAtLevel||N.level;if(!W(ue)){alert(`No level ${ue} spell slots available!`);return}const Pe=N.savingThrow?.halfDamageOnSave&&c.targetSucceededSave;R=H(c,N,Pe)}}const ve=`1d20${c.bonus>=0?"+":""}${c.bonus}`;oe("roll",{notation:ve,damageNotation:R,attackName:c.name})}function B(c){if(!c.damage){alert(`${c.name}: No damage specified`);return}let R=c.damage;if(c.spellRef){const ve=z(c.spellRef);if(ve&&ve.level>0){const N=c.castAtLevel||ve.level;if(!W(N)){alert(`No level ${N} spell slots available!`);return}const fe=ve.savingThrow?.halfDamageOnSave&&c.targetSucceededSave;R=H(c,ve,fe)}}oe("roll",{notation:R,attackName:c.name})}function ae(){ht.update(c=>({...c,attacks:!c.attacks}))}let ce=A([]),pe=A(!1);Vt(async()=>{n(ce,await Ma()),n(pe,!0)});function z(c){return e(ce).find(R=>R.name===c)}function W(c){a().classFeatures.spellSlotsByLevel||at(Y,i(a).classFeatures.spellSlotsByLevel={},i(a)),a().classFeatures.spellSlotsByLevel[c]||at(Y,i(a).classFeatures.spellSlotsByLevel[c]=Array(2).fill(!1),i(a));const ve=a().classFeatures.spellSlotsByLevel[c].findIndex(N=>!N);return ve===-1?!1:(Y.update(N=>(N.classFeatures.spellSlotsByLevel||(N.classFeatures.spellSlotsByLevel={}),N.classFeatures.spellSlotsByLevel[c]||(N.classFeatures.spellSlotsByLevel[c]=Array(2).fill(!1)),N.classFeatures.spellSlotsByLevel[c][ve]=!0,N)),!0)}function H(c,R,ve=!1){let N=c.damage,ue=0;if(R.higherLevelSlot&&c.castAtLevel){const b=R.level,Ue=(c.castAtLevel||b)-b;if(Ue>0){const We=R.higherLevelSlot.match(/(\d+)d(\d+)\s+for\s+each.*?level\s+above/i);if(We){const[,Ke]=We;ue+=Ue*parseInt(Ke)}}}if(c.targetIsFiendOrUndead&&R.description.includes("Fiend or an Undead")){const b=R.description.match(/increases by (\d+)d(\d+) if.*?Fiend or.*?Undead/i);if(b){const[,Ee]=b;ue+=parseInt(Ee)}}const fe=N.match(/(\d+)d(\d+)/);if(!fe)return N;const[,Pe,me]=fe,je=parseInt(Pe)+ue;return ve?`(${je}d${me})/2`:`${je}d${me}`}function se(c){const R=[];for(let N=c.level;N<=9;N++){const ue=a().classFeatures.spellSlotsByLevel?.[N];ue&&ue.length>0&&R.push(N)}return R}Ye(()=>(a(),v()),()=>{n(h,a().attacks.filter(c=>{if(!v())return!0;const R=v().toLowerCase();return c.name.toLowerCase().includes(R)||c.damageType.toLowerCase().includes(R)}).sort((c,R)=>!c.spellRef&&R.spellRef?-1:c.spellRef&&!R.spellRef?1:0))}),Ye(()=>(v(),e(h)),()=>{n(O,!v()||e(h).length>0||"attack".includes(v().toLowerCase())||"spell".includes(v().toLowerCase()))}),wt(),yt();var te=zs();let le;var Me=l(te),$=t(l(Me),2),Z=l($,!0);s($),s(Me);var ie=t(Me,2);{var _=c=>{var R=qs(),ve=ze(R),N=t(ve,2),ue=l(N);ut(ue,1,()=>e(h),je=>je.id,(je,b,Ee)=>{var Ue=Ns(),We=l(Ue),Ke=l(We);xe(Ke);var Ze=t(Ke,2);{var m=P=>{var T=xs();F("click",T,()=>ke(e(b).id)),o(P,T)};k(Ze,P=>{C()&&P(m)})}s(We);var V=t(We,2),Q=l(V),$e=t(l(Q),2);xe($e),s(Q);var Be=t(Q,2),He=t(l(Be),2);xe(He),s(Be);var U=t(Be,2),X=t(l(U),2);xe(X),s(U),s(V);var x=t(V,2);{var Se=P=>{var T=nt(),d=ze(T);{var j=w=>{var p=ks();o(w,p)},K=w=>{const p=tt(()=>(e(b),i(()=>z(e(b).spellRef))));var de=nt(),we=ze(de);{var _e=f=>{var q=Ps(),L=ze(q);{var Fe=et=>{var st=$s(),ft=t(l(st),2),Ft=l(ft,!0);s(ft),s(st),M(()=>y(Ft,(e(b),i(()=>e(b).generalNotes)))),o(et,st)};k(L,et=>{e(b),i(()=>e(b).generalNotes)&&et(Fe)})}var ye=t(L,2),qe=l(ye),Re=t(l(qe),2),De=l(Re,!0);s(Re),s(qe);var Ae=t(qe,2);{var ot=et=>{var st=Cs(),ft=l(st),Ft=t(l(ft));s(ft);var Bt=t(ft,2),sa=t(l(Bt));s(Bt);var $t=t(Bt,2),Mt=t(l($t));s($t);var Rt=t($t,2),Nt=t(l(Rt)),At=t(Nt);{var la=Qe=>{var it=bt();M(()=>y(it,`(${I(e(p)),i(()=>e(p).material)??""})`)),o(Qe,it)};k(At,Qe=>{I(e(p)),i(()=>e(p).material)&&Qe(la)})}s(Rt);var Gt=t(Rt,2),Ot=t(l(Gt),2);{var ia=Qe=>{var it=bt("Concentration,");o(Qe,it)};k(Ot,Qe=>{I(e(p)),i(()=>e(p).concentration)&&Qe(ia)})}var ra=t(Ot,1,!0);s(Gt);var qt=t(Gt,2),ct=t(l(qt));s(qt);var vt=t(qt,2);{var dt=Qe=>{var it=Ss(),It=t(l(it));s(it),M(()=>y(It,` ${I(e(p)),i(()=>e(p).higherLevelSlot)??""}`)),o(Qe,it)};k(vt,Qe=>{I(e(p)),i(()=>e(p).higherLevelSlot)&&Qe(dt)})}s(st),M(Qe=>{y(Ft,` ${I(e(p)),i(()=>e(p).level)??""}`),y(sa,` ${I(e(p)),i(()=>e(p).castingTime||e(p).actionType)??""}`),y(Mt,` ${I(e(p)),i(()=>e(p).range)??""}`),y(Nt,` ${Qe??""}`),y(ra,(I(e(p)),i(()=>e(p).duration))),y(ct,` ${I(e(p)),i(()=>e(p).description)??""}`)},[()=>(I(e(p)),i(()=>e(p).components.join(", ")))]),o(et,st)};k(Ae,et=>{e(E),e(b),i(()=>!e(E)[e(b).id])&&et(ot)})}s(ye);var re=t(ye,2);{var Xe=et=>{const st=tt(()=>(I(e(p)),i(()=>se(e(p)))));var ft=nt(),Ft=ze(ft);{var Bt=$t=>{var Mt=Is(),Rt=ze(Mt),Nt=l(Rt),At=t(Nt,2);M(()=>{e(b),St(()=>{e(st)})}),ut(At,5,()=>e(st),gt,(ct,vt)=>{var dt=Ls(),Qe=l(dt);s(dt);var it={};M(()=>{y(Qe,`Level ${e(vt)??""}`),it!==(it=e(vt))&&(dt.value=(dt.__value=e(vt))??"")}),o(ct,dt)}),s(At);var la=t(At,2);{var Gt=ct=>{const vt=tt(()=>(I(e(p)),e(b),i(()=>e(p).savingThrow?.halfDamageOnSave&&e(b).targetSucceededSave))),dt=tt(()=>(e(b),I(e(p)),I(e(vt)),i(()=>H(e(b),e(p),e(vt)))));var Qe=ws(),it=l(Qe);{var It=rt=>{var mt=bt("Healing");o(rt,mt)},Lt=rt=>{var mt=bt("Damage");o(rt,mt)};k(it,rt=>{I(e(p)),i(()=>be(e(p)))?rt(It):rt(Lt,!1)})}var Pt=t(it);s(Qe),M(()=>y(Pt,` ${e(dt)??""}`)),o(ct,Qe)};k(la,ct=>{e(b),I(e(p)),i(()=>e(b).castAtLevel&&e(b).castAtLevel>e(p).level)&&ct(Gt)})}s(Rt);var Ot=t(Rt,2);{var ia=ct=>{var vt=js(),dt=l(vt),Qe=l(dt);xe(Qe);var it=t(Qe,2);{var It=Lt=>{const Pt=tt(()=>(I(e(p)),e(b),i(()=>e(p).savingThrow?.halfDamageOnSave&&e(b).targetSucceededSave))),rt=tt(()=>(e(b),I(e(p)),I(e(Pt)),i(()=>H(e(b),e(p),e(Pt)))));var mt=Ds(),na=l(mt);s(mt),M(()=>y(na,`(+1d8, total: ${e(rt)??""})`)),o(Lt,mt)};k(it,Lt=>{e(b),i(()=>e(b).targetIsFiendOrUndead)&&Lt(It)})}s(dt),s(vt),ea(Qe,()=>e(b).targetIsFiendOrUndead,Lt=>(e(b).targetIsFiendOrUndead=Lt,St(()=>(e(h),a(),v())))),o(ct,vt)};k(Ot,ct=>{I(e(p)),i(()=>e(p).description.includes("Fiend or an Undead"))&&ct(ia)})}var ra=t(Ot,2);{var qt=ct=>{var vt=As(),dt=l(vt),Qe=l(dt);xe(Qe);var it=t(Qe),It=t(it);{var Lt=rt=>{var mt=Fs();o(rt,mt)},Pt=rt=>{var mt=nt(),na=ze(mt);{var Pa=oa=>{var Ea=Rs();o(oa,Ea)};k(na,oa=>{e(b),I(e(p)),i(()=>e(b).targetSucceededSave&&!e(p).savingThrow.halfDamageOnSave)&&oa(Pa)},!0)}o(rt,mt)};k(It,rt=>{e(b),I(e(p)),i(()=>e(b).targetSucceededSave&&e(p).savingThrow.halfDamageOnSave)?rt(Lt):rt(Pt,!1)})}s(dt),s(vt),M(rt=>y(it,` Target succeeded on ${rt??""} save `),[()=>(I(e(p)),i(()=>e(p).savingThrow.ability.charAt(0).toUpperCase()+e(p).savingThrow.ability.slice(1)))]),ea(Qe,()=>e(b).targetSucceededSave,rt=>(e(b).targetSucceededSave=rt,St(()=>(e(h),a(),v())))),o(ct,vt)};k(ra,ct=>{I(e(p)),i(()=>e(p).savingThrow)&&ct(qt)})}M(()=>{lt(Nt,"for",`castLevel-${e(b),i(()=>e(b).id)??""}`),lt(At,"id",`castLevel-${e(b),i(()=>e(b).id)??""}`)}),Aa(At,()=>e(b).castAtLevel,ct=>(e(b).castAtLevel=ct,St(()=>(e(h),a(),v())))),o($t,Mt)},sa=$t=>{var Mt=Ms();o($t,Mt)};k(Ft,$t=>{I(e(st)),i(()=>e(st).length>0)?$t(Bt):$t(sa,!1)})}o(et,ft)};k(re,et=>{I(e(p)),i(()=>e(p).higherLevelSlot&&e(p).level>0)&&et(Xe)})}M(()=>{lt(Re,"aria-label",(e(E),e(b),i(()=>e(E)[e(b).id]?"Expand":"Collapse"))),y(De,(e(E),e(b),i(()=>e(E)[e(b).id]?"â–¼":"â–²")))}),F("click",qe,()=>J(e(b).id)),F("keydown",qe,et=>et.key==="Enter"&&J(e(b).id)),o(f,q)},Oe=f=>{var q=Es();o(f,q)};k(we,f=>{e(p)?f(_e):f(Oe,!1)})}o(w,de)};k(d,w=>{e(ce),i(()=>e(ce).length===0)?w(j):w(K,!1)})}o(P,T)};k(x,P=>{e(b),i(()=>e(b).spellRef)&&P(Se)})}var he=t(x,2);{var Te=P=>{var T=Ts(),d=t(l(T),2);Wt(d),s(T),Ie(d,()=>e(b).notes,j=>(e(b).notes=j,St(()=>(e(h),a(),v())))),o(P,T)};k(he,P=>{e(b),i(()=>!e(b).spellRef)&&P(Te)})}var Ne=t(he,2),Ve=l(Ne);{var Ce=P=>{var T=Hs();F("click",T,()=>ge(e(b))),o(P,T)};k(Ve,P=>{e(b),i(()=>e(b).bonus!==0||!e(b).spellRef)&&P(Ce)})}var ee=t(Ve,2);{var Le=P=>{const T=tt(()=>(e(b),i(()=>z(e(b).spellRef))));var d=Us(),j=l(d);{var K=p=>{var de=bt("Roll Healing");o(p,de)},w=p=>{var de=bt("Roll Damage");o(p,de)};k(j,p=>{I(e(T)),i(()=>e(T)&&be(e(T)))?p(K):p(w,!1)})}s(d),F("click",d,()=>B(e(b))),o(P,d)},Ge=P=>{var T=Bs();F("click",T,()=>B(e(b))),o(P,T)};k(ee,P=>{e(b),e(pe),i(()=>e(b).spellRef&&e(pe))?P(Le):P(Ge,!1)})}s(Ne),s(Ue),Ie(Ke,()=>e(b).name,P=>(e(b).name=P,St(()=>(e(h),a(),v())))),Ie($e,()=>e(b).bonus,P=>(e(b).bonus=P,St(()=>(e(h),a(),v())))),Ie(He,()=>e(b).damage,P=>(e(b).damage=P,St(()=>(e(h),a(),v())))),Ie(X,()=>e(b).damageType,P=>(e(b).damageType=P,St(()=>(e(h),a(),v())))),o(je,Ue)});var fe=t(ue,2);{var Pe=je=>{var b=Gs();o(je,b)},me=je=>{var b=nt(),Ee=ze(b);{var Ue=We=>{var Ke=Os();o(We,Ke)};k(Ee,We=>{e(h),i(()=>e(h).length===0)&&We(Ue)},!0)}o(je,b)};k(fe,je=>{a(),i(()=>a().attacks.length===0)?je(Pe):je(me,!1)})}s(N),F("click",ve,ne),o(c,R)};k(ie,c=>{S(),i(()=>!S().attacks)&&c(_)})}s(te),M(()=>{le=pt(te,1,"attacks svelte-14o91c5",null,le,{hidden:!e(O)}),lt($,"aria-label",(S(),i(()=>S().attacks?"Expand":"Collapse"))),y(Z,(S(),i(()=>S().attacks?"â–¼":"â–²")))}),F("click",$,ae),o(r,te),kt(),G()}var Ks=g('<p class="no-features svelte-1kpvv0n">Select a class to see available features</p>'),Js=g('<p class="no-features svelte-1kpvv0n">No class features available at this level</p>'),Vs=g('<input type="checkbox" class="slot-checkbox svelte-1kpvv0n"/>'),Qs=g('<div class="spell-slots svelte-1kpvv0n"><label class="svelte-1kpvv0n"> </label> <div class="slots-tracker svelte-1kpvv0n"></div></div>'),Xs=g('<div class="all-spell-slots"></div>'),Ys=g('<div class="feature-box spellcasting svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"> </h3> <div class="spell-stats svelte-1kpvv0n"><div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Spell Save DC</label> <div class="spell-value svelte-1kpvv0n"> </div></div> <div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <div class="spell-value svelte-1kpvv0n"> </div></div></div> <!> <div class="prepared-spells svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <textarea placeholder="List your prepared spells..." class="svelte-1kpvv0n"></textarea></div></div>'),Zs=g('<p class="unlimited svelte-1kpvv0n">Unlimited Uses</p>'),el=g('<p class="no-uses svelte-1kpvv0n">No uses remaining</p>'),tl=g('<div class="uses-with-button svelte-1kpvv0n"><button class="btn btn-primary use-enabled"> </button> <div class="uses-info svelte-1kpvv0n"><span class="uses-remaining svelte-1kpvv0n"> </span> <span class="reset-info svelte-1kpvv0n"> </span></div> <!></div>'),al=g('<div class="uses-tracker svelte-1kpvv0n"><!></div>'),sl=g('<div class="pool-tracker svelte-1kpvv0n"><input type="number" min="0" class="pool-input svelte-1kpvv0n"/> <span> </span> <button class="btn-small svelte-1kpvv0n"> </button></div>'),ll=g('<p class="no-uses svelte-1kpvv0n">No Channel Divinity uses remaining</p>'),il=g('<div class="channel-divinity-option svelte-1kpvv0n"><button class="btn btn-primary use-enabled svelte-1kpvv0n">Use Channel Divinity</button> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div> <!></div>'),rl=g('<div class="feature-box svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"><!> </h3> <p class="feature-description svelte-1kpvv0n"> </p> <!></div>'),nl=g('<div class="features-grid svelte-1kpvv0n"><!> <!></div>'),ol=g('<section><div class="header svelte-1kpvv0n"><h2 class="svelte-1kpvv0n">Class Features</h2> <button class="collapse-btn svelte-1kpvv0n"> </button></div> <!></section>');function cl(r,u){xt(u,!1);const a=()=>Je(Y,"$character",D),v=()=>Je(ta,"$abilityModifiers",D),S=()=>Je(jt,"$searchFilter",D),C=()=>Je(ht,"$collapsedStates",D),[D,G]=Ct(),h=A(),O=A(),oe=A(),E=A(),J=A(),be=A(),ne=A();let ke=A(0),ge=A(0);function B(_,c){Y.update(R=>(R.classFeatures.features[_]=c,R))}function ae(){Y.update(_=>(_.classFeatures.spellSlotsByLevel||(_.classFeatures.spellSlotsByLevel={}),e(E).forEach(({level:c,slots:R})=>{_.classFeatures.spellSlotsByLevel[c]||(_.classFeatures.spellSlotsByLevel[c]=Array(R).fill(!1))}),_))}function ce(_){if(typeof _.maxUses=="function"){if((_.name==="Divine Sense"||_.name==="War Priest")&&e(h)?.spellcastingAbility){const c=v()[e(h).spellcastingAbility];return _.maxUses(a().level,c)}return _.maxUses(a().level)}return _.maxUses||0}function pe(_){return typeof _.maxPool=="function"?_.maxPool(a().level):_.maxPool||0}function z(_){return typeof _.description=="function"?_.description(a().level):_.description}function W(){const _="ChannelDivinity";Y.update(c=>{const R=c.classFeatures.features[_];return typeof R=="number"&&R>0&&(c.classFeatures.features[_]=R-1),c})}function H(){ht.update(_=>({..._,classFeatures:!_.classFeatures}))}Ye(()=>(a(),_t),()=>{n(h,a().class?_t(a().class):null)}),Ye(()=>(a(),Ht),()=>{n(O,a().class?Ht(a().class,a().level,a().subclass):[])}),Ye(()=>(a(),_a),()=>{n(oe,a().class?_a(a().class,a().level):0)}),Ye(()=>(e(h),a()),()=>{n(E,(()=>{if(!e(h)?.spellcaster)return[];const _=a().level,c=[];return _>=1&&c.push({level:1,slots:Math.min(4,2+Math.floor(_/3))}),_>=3&&c.push({level:2,slots:Math.min(3,2+Math.floor((_-3)/4))}),_>=5&&c.push({level:3,slots:Math.min(3,2+Math.floor((_-5)/5))}),_>=7&&c.push({level:4,slots:Math.min(3,1+Math.floor((_-7)/6))}),_>=9&&c.push({level:5,slots:Math.min(2,1+Math.floor((_-9)/8))}),_>=11&&c.push({level:6,slots:1}),_>=13&&c.push({level:7,slots:1}),_>=15&&c.push({level:8,slots:1}),_>=17&&c.push({level:9,slots:1}),c})())}),Ye(()=>(e(h),v(),a(),ya),()=>{if(e(h)?.spellcaster&&e(h).spellcastingAbility){const _=v()[e(h).spellcastingAbility];n(ke,Xa(a().class,_,a().proficiencyBonus)||0),n(ge,ya(a().class,a().level,_))}}),Ye(()=>(a(),e(h),e(E)),()=>{a().class&&e(h)?.spellcaster&&e(E).length>0&&ae()}),Ye(()=>a(),()=>{n(J,(()=>{const c=a().classFeatures.features["ChannelDivinity"];return typeof c=="number"?c:0})())}),Ye(()=>(e(O),S()),()=>{n(be,e(O).filter(_=>{if(!S())return!0;const c=S().toLowerCase();return _.name.toLowerCase().includes(c)||z(_).toLowerCase().includes(c)}))}),Ye(()=>(S(),a(),e(be)),()=>{n(ne,!S()||a().class||"class features".includes(S().toLowerCase())||"spellcasting".includes(S().toLowerCase())||e(be).length>0)}),wt(),yt();var se=ol();let te;var le=l(se),Me=t(l(le),2),$=l(Me,!0);s(Me),s(le);var Z=t(le,2);{var ie=_=>{var c=nt(),R=ze(c);{var ve=ue=>{var fe=Ks();o(ue,fe)},N=ue=>{var fe=nt(),Pe=ze(fe);{var me=b=>{var Ee=Js();o(b,Ee)},je=b=>{var Ee=nl(),Ue=l(Ee);{var We=Ze=>{var m=Ys(),V=l(m),Q=l(V);s(V);var $e=t(V,2),Be=l($e),He=t(l(Be),2),U=l(He,!0);s(He),s(Be);var X=t(Be,2),x=t(l(X),2),Se=l(x,!0);s(x),s(X),s($e);var he=t($e,2);{var Te=Ce=>{var ee=Xs();ut(ee,5,()=>e(E),gt,(Le,Ge)=>{let P=()=>e(Ge).level,T=()=>e(Ge).slots;const d=tt(()=>(a(),P(),T(),i(()=>a().classFeatures.spellSlotsByLevel?.[P()]||Array(T()).fill(!1))));var j=Qs(),K=l(j),w=l(K);s(K);var p=t(K,2);ut(p,5,()=>(T(),i(()=>Array(T()))),gt,(de,we,_e)=>{var Oe=Vs();xe(Oe),M(()=>Ga(Oe,(I(e(d)),i(()=>e(d)[_e]||!1)))),F("change",Oe,f=>{Y.update(q=>(q.classFeatures.spellSlotsByLevel||(q.classFeatures.spellSlotsByLevel={}),q.classFeatures.spellSlotsByLevel[P()]||(q.classFeatures.spellSlotsByLevel[P()]=Array(T()).fill(!1)),q.classFeatures.spellSlotsByLevel[P()][_e]=f.currentTarget.checked,q))}),o(de,Oe)}),s(p),s(j),M(()=>y(w,`${P()===1?"1st":P()===2?"2nd":P()===3?"3rd":`${P()}th`} Level Spell Slots`)),o(Le,j)}),s(ee),o(Ce,ee)};k(he,Ce=>{e(E),i(()=>e(E).length>0)&&Ce(Te)})}var Ne=t(he,2),Ve=t(l(Ne),2);Wt(Ve),s(Ne),s(m),M(Ce=>{y(Q,`Spellcasting (${Ce??""})`),y(U,e(ke)),y(Se,e(ge))},[()=>(e(h),i(()=>e(h).spellcastingAbility?.toUpperCase()))]),Ie(Ve,()=>a().classFeatures.preparedSpells,Ce=>at(Y,i(a).classFeatures.preparedSpells=Ce,i(a))),o(Ze,m)};k(Ue,Ze=>{e(h),i(()=>e(h)?.spellcaster)&&Ze(We)})}var Ke=t(Ue,2);ut(Ke,1,()=>e(be),gt,(Ze,m)=>{const V=tt(()=>(e(m),i(()=>e(m).name.replace(/\s+/g,"")))),Q=tt(()=>(a(),I(e(V)),i(()=>a().classFeatures.features[e(V)]))),$e=tt(()=>(I(e(Q)),i(()=>Array.isArray(e(Q))))),Be=tt(()=>typeof e(Q)=="number");var He=rl(),U=l(He),X=l(U);{var x=ee=>{var Le=bt("Channel Divinity:");o(ee,Le)};k(X,ee=>{e(m),i(()=>e(m).type==="channelDivinity")&&ee(x)})}var Se=t(X);s(U);var he=t(U,2),Te=l(he,!0);s(he);var Ne=t(he,2);{var Ve=ee=>{const Le=tt(()=>(e(m),i(()=>ce(e(m))))),Ge=tt(()=>(I(e($e)),I(e(Le)),I(e(Q)),i(()=>e($e)?e(Q).filter(w=>!w).length:e(Le))));var P=al(),T=l(P);{var d=K=>{var w=Zs();o(K,w)},j=K=>{var w=tl(),p=l(w),de=l(p);s(p);var we=t(p,2),_e=l(we),Oe=l(_e);s(_e);var f=t(_e,2),q=l(f);s(f),s(we);var L=t(we,2);{var Fe=ye=>{var qe=el();o(ye,qe)};k(L,ye=>{e(Ge)<=0&&ye(Fe)})}s(w),M(()=>{p.disabled=e(Ge)<=0,y(de,`Use ${e(m),i(()=>e(m).name)??""}`),y(Oe,`${e(Ge)??""} / ${e(Le)??""} uses`),y(q,`Resets on ${e(m),i(()=>e(m).resetOn==="short"?"Short Rest":"Long Rest")??""}`)}),F("click",p,()=>{Y.update(ye=>{ye.classFeatures.features[e(V)]||(ye.classFeatures.features[e(V)]=Array(e(Le)).fill(!1));const qe=ye.classFeatures.features[e(V)],Re=qe.findIndex(De=>!De);return Re!==-1&&(qe[Re]=!0),ye})}),o(K,w)};k(T,K=>{e(Le)===1/0?K(d):K(j,!1)})}s(P),o(ee,P)},Ce=ee=>{var Le=nt(),Ge=ze(Le);{var P=d=>{const j=tt(()=>(e(m),i(()=>pe(e(m)))));var K=sl(),w=l(K);xe(w);var p=t(w,2),de=l(p);s(p);var we=t(p,2),_e=l(we,!0);s(we),s(K),M(()=>{ga(w,e(Be)&&e(Q)!==void 0?e(Q):e(j)),lt(w,"max",e(j)),y(de,`/ ${e(j)??""}`),y(_e,(e(m),i(()=>e(m).resetOn==="short"?"Short Rest":"Long Rest")))}),F("input",w,Oe=>{Y.update(f=>(f.classFeatures.features[e(V)]=parseInt(Oe.currentTarget.value)||0,f))}),F("click",we,()=>B(e(V),e(j))),o(d,K)},T=d=>{var j=nt(),K=ze(j);{var w=p=>{var de=il(),we=l(de),_e=t(we,2),Oe=l(_e),f=l(Oe);s(Oe),s(_e);var q=t(_e,2);{var L=Fe=>{var ye=ll();o(Fe,ye)};k(q,Fe=>{e(J)<=0&&Fe(L)})}s(de),M(()=>{we.disabled=e(J)<=0,y(f,`Resets on ${e(m),i(()=>e(m).resetOn==="short"?"Short Rest":"Long Rest")??""}`)}),F("click",we,W),o(p,de)};k(K,p=>{e(m),i(()=>e(m).type==="channelDivinity")&&p(w)},!0)}o(d,j)};k(Ge,d=>{e(m),i(()=>e(m).type==="pool")?d(P):d(T,!1)},!0)}o(ee,Le)};k(Ne,ee=>{e(m),i(()=>e(m).type==="uses")?ee(Ve):ee(Ce,!1)})}s(He),M(ee=>{y(Se,` ${e(m),i(()=>e(m).name)??""}`),y(Te,ee)},[()=>(e(m),i(()=>z(e(m))))]),o(Ze,He)}),s(Ee),o(b,Ee)};k(Pe,b=>{e(O),i(()=>e(O).length===0)?b(me):b(je,!1)},!0)}o(ue,fe)};k(R,ue=>{a(),i(()=>!a().class)?ue(ve):ue(N,!1)})}o(_,c)};k(Z,_=>{C(),i(()=>!C().classFeatures)&&_(ie)})}s(se),M(()=>{te=pt(se,1,"class-features svelte-1kpvv0n",null,te,{hidden:!e(ne)}),lt(Me,"aria-label",(C(),i(()=>C().classFeatures?"Expand":"Collapse"))),y($,(C(),i(()=>C().classFeatures?"â–¼":"â–²")))}),F("click",Me,H),o(r,se),kt(),G()}var vl=g('<textarea placeholder="Enter features, traits, and special abilities..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Equipment</h3> <textarea placeholder="List your equipment and inventory..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Notes</h3> <textarea placeholder="Additional notes..." class="svelte-wttn0l"></textarea>',1),dl=g('<section><div class="header svelte-wttn0l"><h2 class="svelte-wttn0l">Features & Traits</h2> <button class="collapse-btn svelte-wttn0l"> </button></div> <!></section>');function ul(r,u){xt(u,!1);const a=()=>Je(jt,"$searchFilter",C),v=()=>Je(Y,"$character",C),S=()=>Je(ht,"$collapsedStates",C),[C,D]=Ct(),G=A();function h(){ht.update(ge=>({...ge,notes:!ge.notes}))}Ye(()=>(a(),v()),()=>{n(G,!a()||"features".includes(a().toLowerCase())||"traits".includes(a().toLowerCase())||"equipment".includes(a().toLowerCase())||"notes".includes(a().toLowerCase())||v().features.toLowerCase().includes(a().toLowerCase())||v().equipment.toLowerCase().includes(a().toLowerCase())||v().notes.toLowerCase().includes(a().toLowerCase()))}),wt(),yt();var O=dl();let oe;var E=l(O),J=t(l(E),2),be=l(J,!0);s(J),s(E);var ne=t(E,2);{var ke=ge=>{var B=vl(),ae=ze(B);Wt(ae);var ce=t(ae,4);Wt(ce);var pe=t(ce,4);Wt(pe),Ie(ae,()=>v().features,z=>at(Y,i(v).features=z,i(v))),Ie(ce,()=>v().equipment,z=>at(Y,i(v).equipment=z,i(v))),Ie(pe,()=>v().notes,z=>at(Y,i(v).notes=z,i(v))),o(ge,B)};k(ne,ge=>{S(),i(()=>!S().notes)&&ge(ke)})}s(O),M(()=>{oe=pt(O,1,"notes svelte-wttn0l",null,oe,{hidden:!e(G)}),lt(J,"aria-label",(S(),i(()=>S().notes?"Expand":"Collapse"))),y(be,(S(),i(()=>S().notes?"â–¼":"â–²")))}),F("click",J,h),o(r,O),kt(),D()}var pl=g('<div class="color-picker-section svelte-1r90jgp"><h3 class="svelte-1r90jgp">Dice Colors</h3> <div class="color-inputs svelte-1r90jgp"><div class="color-input-group svelte-1r90jgp"><label for="dice-color" class="svelte-1r90jgp">Dice Color</label> <input type="color" id="dice-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="label-color" class="svelte-1r90jgp">Label Color</label> <input type="color" id="label-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="desk-color" class="svelte-1r90jgp">Background Color</label> <input type="color" id="desk-color" class="svelte-1r90jgp"/></div></div></div>'),fl=g('<div class="loading svelte-1r90jgp"><p class="svelte-1r90jgp">Loading 3D dice...</p></div>'),bl=g('<div class="custom-dice-selector svelte-1r90jgp"><h3 class="svelte-1r90jgp">Choose Dice to Roll</h3> <div class="dice-inputs svelte-1r90jgp"><div class="dice-input-group svelte-1r90jgp"><label for="d4" class="svelte-1r90jgp">d4</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d4" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d6" class="svelte-1r90jgp">d6</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d6" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d8" class="svelte-1r90jgp">d8</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d8" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d10" class="svelte-1r90jgp">d10</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d10" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d12" class="svelte-1r90jgp">d12</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d12" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d20" class="svelte-1r90jgp">d20</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d20" min="0" max="10"/></div></div> <div class="dice-controls svelte-1r90jgp"><button class="btn btn-primary use-enabled svelte-1r90jgp"> </button> <button class="btn btn-secondary use-enabled svelte-1r90jgp">Reset</button></div></div>'),gl=g('<span class="crit-badge svelte-1r90jgp">CRITICAL!</span>'),hl=g('<p class="svelte-1r90jgp"> </p>'),ml=g('<p class="modifier-text svelte-1r90jgp"> </p>'),_l=g('<button class="btn btn-follow-up svelte-1r90jgp"> </button>'),yl=g('<button class="btn btn-guided-strike svelte-1r90jgp">âš¡ Use Guided Strike (+10)</button>'),xl=g('<div class="follow-up-actions svelte-1r90jgp"><!> <!></div>'),kl=g('<div class="result-header svelte-1r90jgp"><h3 class="svelte-1r90jgp"> </h3> <!></div> <div class="result-total svelte-1r90jgp"> </div> <div class="result-details svelte-1r90jgp"><!> <!></div> <!>',1),$l=g('<div role="button" tabindex="-1"><div class="modal-content svelte-1r90jgp" role="dialog" tabindex="0"><div class="modal-header svelte-1r90jgp"><h2 class="svelte-1r90jgp">Dice Roller</h2> <div class="header-buttons svelte-1r90jgp"><button class="color-btn svelte-1r90jgp" title="Customize dice colors">ðŸŽ¨</button> <button class="close-btn svelte-1r90jgp">Ã—</button></div></div> <!> <!> <div class="dice-main-area svelte-1r90jgp"><div class="dice-container svelte-1r90jgp"></div> <!></div> <div><!></div></div></div>');function Sl(r,u){xt(u,!1);const a=()=>Je(Y,"$character",v),[v,S]=Ct(),C=A(),D=A(),G=A(),h=Ut();let O=Et(u,"notation",12,""),oe=Et(u,"visible",8,!1),E=Et(u,"damageNotation",12,""),J=Et(u,"attackName",12,""),be=null,ne=A(void 0),ke=A(!1),ge=A(""),B=A(null);function ae(){return e(B)?.resultTotal??null}let ce=A(0),pe=A(0),z=A(0),W=A(0),H=A(0),se=A(0),te=A(0),le=A([]),Me=A(!1),$=A("other"),Z=A(!1),ie=A("#051e0a"),_=A("#ffffff"),c=A("#3a2004"),R=A(!1);function ve(d){return d.length===9&&d.startsWith("#")?d.substring(0,7):d}function N(d,j="ff"){return d.length===7&&d.startsWith("#")?d+j:d}function ue(){if(window.DICE&&e(ne))try{be&&e(ne)&&ja(ne,e(ne).innerHTML="");const d=e(ne).clientWidth||500,j=e(ne).clientHeight||300;be=new window.DICE.dice_box(e(ne),{w:d,h:j}),n(ke,!0)}catch(d){console.error("Error initializing dice box:",d)}}Vt(()=>{const d=w=>new Promise((p,de)=>{if(document.querySelector(`script[src="${w}"]`)){console.log(`Script already loaded: ${w}`),p(null);return}const _e=document.createElement("script");_e.src=w,_e.onload=()=>{console.log(`Loaded: ${w}`),p(null)},_e.onerror=()=>{console.error(`Failed to load: ${w}`),de(new Error(`Failed to load ${w}`))},document.head.appendChild(_e)});setTimeout(()=>{d(`${zt}/libs/three.min.js`).then(()=>d(`${zt}/libs/cannon.min.js`)).then(()=>d(`${zt}/libs/teal.js`)).then(()=>d(`${zt}/dice.js`)).then(()=>{if(console.log("All scripts loaded, initializing dice box..."),console.log("DICE available:",!!window.DICE),console.log("Container available:",!!e(ne)),window.DICE){const w=window.DICE.getColors();n(ie,ve(w.dice_color)),n(_,ve(w.label_color)),n(c,ve(w.desk_color))}ue()}).catch(w=>{console.error("Failed to load dice libraries:",w)})},100);const j=()=>{e(ke)&&(console.log("Window resized, reinitializing dice box..."),ue())},K=w=>{oe()&&w.key==="Escape"&&Ke()};return window.addEventListener("resize",j),window.addEventListener("keydown",K),()=>{window.removeEventListener("resize",j),window.removeEventListener("keydown",K)}});function fe(d,j="other"){if(!be||!e(ke))return;console.log("Rolling dice:",d,"type:",j),n($,j),n(Z,!1),be.diceToRoll=d;const K=p=>(console.log("Before roll:",p),null),w=p=>{if(console.log("After roll:",p),console.log("Result:",p.resultTotal),n(B,p),j==="attack"||j==="check"||j==="save"){const de=p.results?.filter(we=>we.sides===20)||[];if(de.length>0){const we=de[0].value;n(Me,we===20)}}if(n(le,[]),j==="attack"&&E())if(e(Me)){const de=je(E());e(le).push({label:`Roll Critical Damage (${de})`,notation:de})}else e(le).push({label:`Roll Damage (${E()})`,notation:E()})};be.start_throw(K,w)}function Pe(){const d=[];e(ce)>0&&d.push(`${e(ce)}d4`),e(pe)>0&&d.push(`${e(pe)}d6`),e(z)>0&&d.push(`${e(z)}d8`),e(W)>0&&d.push(`${e(W)}d10`),e(H)>0&&d.push(`${e(H)}d12`),e(se)>0&&d.push(`${e(se)}d20`);let j=d.join("+")||"1d20";return e(te)!==0&&(j+=e(te)>=0?`+${e(te)}`:`${e(te)}`),j}function me(){const d=Pe();fe(d)}function je(d){return d.replace(/(\d+)d(\d+)/g,(j,K,w)=>`${parseInt(K)*2}d${w}`)}function b(){n(ce,0),n(pe,0),n(z,0),n(W,0),n(H,0),n(se,0),n(te,0),n(B,null),n(le,[]),n(Me,!1),n($,"other"),n(Z,!1)}function Ee(){window.DICE&&(window.DICE.setColors({dice_color:N(e(ie),"ff"),label_color:N(e(_),"ff"),desk_color:e(c)}),be&&(be.updateDeskColor(e(c)),be.updateDiceColors()))}function Ue(){n(R,!e(R))}function We(){!e(B)||e(D)<=0||e(Z)||(n(B,{...e(B),resultTotal:e(B).resultTotal+10,resultString:e(B).resultString+" + 10 (Guided Strike)"}),Y.update(d=>{const j="ChannelDivinity",K=d.classFeatures.features[j];return typeof K=="number"&&K>0&&(d.classFeatures.features[j]=K-1),d}),n(Z,!0))}function Ke(){h("close"),O(""),E(""),J(""),n(ge,""),n(B,null),n(Z,!1),b()}Ye(()=>(a(),Ht),()=>{n(C,a().class?Ht(a().class,a().level,a().subclass).some(j=>j.name==="Guided Strike"):!1)}),Ye(()=>a(),()=>{n(D,(()=>{const j=a().classFeatures.features["ChannelDivinity"];return typeof j=="number"?j:0})())}),Ye(()=>(e(ce),e(pe),e(z),e(W),e(H),e(se),e(te)),()=>{n(G,(()=>{const d=[];e(ce)>0&&d.push(`${e(ce)}d4`),e(pe)>0&&d.push(`${e(pe)}d6`),e(z)>0&&d.push(`${e(z)}d8`),e(W)>0&&d.push(`${e(W)}d10`),e(H)>0&&d.push(`${e(H)}d12`),e(se)>0&&d.push(`${e(se)}d20`);let j=d.join("+")||"1d20";return e(te)!==0&&(j+=e(te)>=0?`+${e(te)}`:`${e(te)}`),j})())}),Ye(()=>(I(O()),e(ke),I(oe()),e(ge),I(E()),I(J())),()=>{if(O()&&e(ke)&&oe()&&O()!==e(ge)){n(ge,O()),n(B,null),n(le,[]),n(Me,!1),n(Z,!1);const d=O().includes("1d20")?"attack":"other";console.log("Auto-roll triggered. notation:",O(),"damageNotation:",E(),"attackName:",J()),setTimeout(()=>fe(O(),d),200)}}),wt();var Ze={getLastRollTotal:ae};yt();var m=$l();let V;var Q=l(m),$e=l(Q),Be=t(l($e),2),He=l(Be),U=t(He,2);s(Be),s($e);var X=t($e,2);{var x=d=>{var j=pl(),K=t(l(j),2),w=l(K),p=t(l(w),2);xe(p),s(w);var de=t(w,2),we=t(l(de),2);xe(we),s(de);var _e=t(de,2),Oe=t(l(_e),2);xe(Oe),s(_e),s(K),s(j),Ie(p,()=>e(ie),f=>n(ie,f)),F("change",p,Ee),Ie(we,()=>e(_),f=>n(_,f)),F("change",we,Ee),Ie(Oe,()=>e(c),f=>n(c,f)),F("change",Oe,Ee),o(d,j)};k(X,d=>{e(R)&&d(x)})}var Se=t(X,2);{var he=d=>{var j=fl();o(d,j)};k(Se,d=>{e(ke)||d(he)})}var Te=t(Se,2),Ne=l(Te);ua(Ne,d=>n(ne,d),()=>e(ne));var Ve=t(Ne,2);{var Ce=d=>{var j=bl(),K=t(l(j),2),w=l(K),p=t(l(w),2);xe(p),s(w);var de=t(w,2),we=t(l(de),2);xe(we),s(de);var _e=t(de,2),Oe=t(l(_e),2);xe(Oe),s(_e);var f=t(_e,2),q=t(l(f),2);xe(q),s(f);var L=t(f,2),Fe=t(l(L),2);xe(Fe),s(L);var ye=t(L,2),qe=t(l(ye),2);xe(qe),s(ye),s(K);var Re=t(K,2),De=l(Re),Ae=l(De);s(De);var ot=t(De,2);s(Re),s(j),M(()=>{De.disabled=!e(ke),y(Ae,`Roll ${e(G)??""}`)}),Ie(p,()=>e(ce),re=>n(ce,re)),Ie(we,()=>e(pe),re=>n(pe,re)),Ie(Oe,()=>e(z),re=>n(z,re)),Ie(q,()=>e(W),re=>n(W,re)),Ie(Fe,()=>e(H),re=>n(H,re)),Ie(qe,()=>e(se),re=>n(se,re)),F("click",De,me),F("click",ot,b),o(d,j)};k(Ve,d=>{O()||d(Ce)})}s(Te);var ee=t(Te,2);let Le;var Ge=l(ee);{var P=d=>{var j=kl(),K=ze(j),w=l(K),p=l(w,!0);s(w);var de=t(w,2);{var we=De=>{var Ae=gl();o(De,Ae)};k(de,De=>{e(Me)&&De(we)})}s(K);var _e=t(K,2),Oe=l(_e,!0);s(_e);var f=t(_e,2),q=l(f);{var L=De=>{var Ae=hl(),ot=l(Ae,!0);s(Ae),M(()=>y(ot,(e(B),i(()=>e(B).resultString)))),o(De,Ae)};k(q,De=>{e(B),i(()=>e(B).resultString)&&De(L)})}var Fe=t(q,2);{var ye=De=>{var Ae=ml(),ot=l(Ae);s(Ae),M(()=>y(ot,`Modifier: ${e(B),i(()=>e(B).constant>=0?"+":"")??""}${e(B),i(()=>e(B).constant)??""}`)),o(De,Ae)};k(Fe,De=>{e(B),i(()=>e(B).constant)&&De(ye)})}s(f);var qe=t(f,2);{var Re=De=>{var Ae=xl(),ot=l(Ae);ut(ot,1,()=>e(le),gt,(et,st)=>{var ft=_l(),Ft=l(ft,!0);s(ft),M(()=>y(Ft,(e(st),i(()=>e(st).label)))),F("click",ft,()=>fe(e(st).notation,"damage")),o(et,ft)});var re=t(ot,2);{var Xe=et=>{var st=yl();M(()=>{st.disabled=e(D)<=0,lt(st,"title",e(D)<=0?"No Channel Divinity uses remaining":"Use Channel Divinity to add +10 to this attack roll")}),F("click",st,We),o(et,st)};k(re,et=>{e(C)&&e($)==="attack"&&!e(Z)&&et(Xe)})}s(Ae),o(De,Ae)};k(qe,De=>{e(le),e(C),e($),e(Z),i(()=>e(le).length>0||e(C)&&e($)==="attack"&&!e(Z))&&De(Re)})}M(()=>{y(p,J()?`${J()} - Result`:"Result"),y(Oe,(e(B),i(()=>e(B).resultTotal)))}),o(d,j)};k(Ge,d=>{e(B)&&d(P)})}s(ee),s(Q),s(m),M(()=>{V=pt(m,1,"modal-overlay svelte-1r90jgp",null,V,{hidden:!oe()}),Le=pt(ee,1,"roll-result svelte-1r90jgp",null,Le,{"has-result":e(B)})}),F("click",He,Ue),F("click",U,Ke),F("click",Q,ha(function(d){Tt.call(this,u,d)})),F("keydown",Q,function(d){Tt.call(this,u,d)}),F("click",m,Ke),F("keydown",m,d=>d.key==="Escape"&&Ke()),o(r,m),Va(u,"getLastRollTotal",ae);var T=kt(Ze);return S(),T}const aa="https://api.github.com/gists";async function Cl(r,u,a){if(!u)throw new Error("GitHub token is required");const v=JSON.stringify(r,null,2),S=`${r.name||"character"}_dnd.json`,C={description:a||`D&D Character: ${r.name}`,public:!1,files:{[S]:{content:v}}},D=await fetch(aa,{method:"POST",headers:{Authorization:`token ${u}`,"Content-Type":"application/json"},body:JSON.stringify(C)});if(!D.ok)throw new Error(`Failed to create gist: ${D.statusText}`);return(await D.json()).id}async function Ll(r,u,a){if(!u||!a)throw new Error("GitHub token and Gist ID are required");const v=JSON.stringify(r,null,2),C={files:{[`${r.name||"character"}_dnd.json`]:{content:v}}},D=await fetch(`${aa}/${a}`,{method:"PATCH",headers:{Authorization:`token ${u}`,"Content-Type":"application/json"},body:JSON.stringify(C)});if(!D.ok)throw new Error(`Failed to update gist: ${D.statusText}`)}async function wl(r,u){if(!r)throw new Error("Gist ID is required");const a={"Content-Type":"application/json"};u&&(a.Authorization=`token ${u}`);const v=await fetch(`${aa}/${r}`,{method:"GET",headers:a});if(!v.ok)throw new Error(`Failed to load gist: ${v.statusText}`);const S=await v.json(),C=Object.values(S.files);if(C.length===0)throw new Error("No files found in gist");const G=C[0].content;try{const h=JSON.parse(G);return h.attacks&&Array.isArray(h.attacks)&&(h.attacks=h.attacks.map(O=>({...O,id:O.id||crypto.randomUUID()}))),h.classFeatures?(h.classFeatures.features||(h.classFeatures.features={}),h.classFeatures.spellSlots||(h.classFeatures.spellSlots=[]),h.classFeatures.preparedSpells===void 0&&(h.classFeatures.preparedSpells="")):h.classFeatures={features:{},spellSlots:[],preparedSpells:""},h}catch{throw new Error("Invalid character data in gist")}}function ka(r){typeof window<"u"&&localStorage.setItem("dnd_gist_config",JSON.stringify(r))}function Dl(){if(typeof window<"u"){const r=localStorage.getItem("dnd_gist_config");if(r)return JSON.parse(r)}return{}}async function jl(r,u=30){if(!r)throw new Error("GitHub token is required to list gists");const a=await fetch(`${aa}?per_page=${u}`,{method:"GET",headers:{Authorization:`token ${r}`,"Content-Type":"application/json"}});if(!a.ok)throw new Error(`Failed to list gists: ${a.statusText}`);return await a.json()}var Fl=g('<div class="error-message svelte-1jb5ckg"> </div>'),Rl=g('<div class="toggle-container svelte-1jb5ckg"><button type="button" class="toggle-btn svelte-1jb5ckg"> </button></div>'),Al=g('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID (leave empty to create new)</label> <input type="text" id="gistId" placeholder="Optional: existing Gist ID to update" class="svelte-1jb5ckg"/></div>'),Il=g('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),Ml=g('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),Pl=g('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Update (or leave unselected to create new)</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),El=g('<div class="info-message svelte-1jb5ckg">No gists found. A new one will be created.</div>'),Tl=g('<!> <div class="form-group svelte-1jb5ckg"><label for="description" class="svelte-1jb5ckg"> </label> <input type="text" id="description" placeholder="D&amp;D Character Sheet" class="svelte-1jb5ckg"/></div>',1),Hl=g('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID *</label> <input type="text" id="gistId" placeholder="Enter Gist ID (for public or your private gists)" required class="svelte-1jb5ckg"/></div>'),Ul=g('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),Bl=g('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),Nl=g('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Load</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),Gl=g('<div class="info-message svelte-1jb5ckg">No gists found. Enter a Gist ID manually or create a new one in Save mode.</div>'),Ol=g('<div class="modal-overlay svelte-1jb5ckg" role="button" tabindex="-1"><div class="modal-content svelte-1jb5ckg" role="dialog" tabindex="0"><div class="modal-header svelte-1jb5ckg"><h2 class="svelte-1jb5ckg"> </h2> <button class="close-btn svelte-1jb5ckg">Ã—</button></div> <div class="modal-body svelte-1jb5ckg"><!> <div class="form-group svelte-1jb5ckg"><label for="token" class="svelte-1jb5ckg"> <a href="https://github.com/settings/tokens" target="_blank" rel="noopener" class="svelte-1jb5ckg">Get token</a></label> <input type="password" id="token" placeholder="ghp_xxxxxxxxxxxxx" class="svelte-1jb5ckg"/></div> <!> <!> <div class="modal-actions svelte-1jb5ckg"><button class="btn btn-primary svelte-1jb5ckg"><!></button> <button class="btn btn-secondary svelte-1jb5ckg">Cancel</button></div></div></div></div>');function ql(r,u){xt(u,!1);const a=()=>Je(Y,"$character",v),[v,S]=Ct(),C=Ut();let D=Et(u,"mode",8,"save"),G=A(""),h=A(""),O=A(""),oe=A(!1),E=A(""),J=A(!1),be=A(!1),ne=A([]),ke=A(null);const ge=Dl();ge.token&&n(G,ge.token),ge.gistId&&n(h,ge.gistId),Vt(async()=>{e(G)&&!e(J)&&await B()});async function B(){if(e(G)){n(be,!0),n(E,"");try{n(ne,await jl(e(G))),e(h)&&n(ke,e(ne).find(m=>m.id===e(h))||null)}catch(m){n(E,m.message||"Failed to load gists"),n(ne,[])}finally{n(be,!1)}}}function ae(m){n(ke,m),n(h,m.id)}function ce(){n(J,!e(J)),n(E,""),!e(J)&&e(G)&&B()}async function pe(){if(!e(G)){n(E,"GitHub token is required");return}const m=e(ke)?.id||e(h);n(oe,!0),n(E,"");try{if(m)await Ll(a(),e(G),m),n(h,m),Kt.add("Character updated in Gist successfully!","success");else{const V=await Cl(a(),e(G),e(O));n(h,V),Kt.add(`Character saved to Gist! ID: ${V}`,"success")}ka({token:e(G),gistId:e(h)}),C("close")}catch(V){n(E,V.message||"Failed to save to Gist")}finally{n(oe,!1)}}async function z(){const m=e(ke)?.id||e(h);if(!m){n(E,"Please select a gist or enter a Gist ID");return}n(oe,!0),n(E,"");try{const V=await wl(m,e(G)||void 0);Y.set(V),n(h,m),ka({token:e(G),gistId:e(h)}),Kt.add("Character loaded from Gist successfully!","success"),C("close")}catch(V){n(E,V.message||"Failed to load from Gist")}finally{n(oe,!1)}}function W(){C("close")}yt();var H=Ol(),se=l(H),te=l(se),le=l(te),Me=l(le,!0);s(le);var $=t(le,2);s(te);var Z=t(te,2),ie=l(Z);{var _=m=>{var V=Fl(),Q=l(V,!0);s(V),M(()=>y(Q,e(E))),o(m,V)};k(ie,m=>{e(E)&&m(_)})}var c=t(ie,2),R=l(c),ve=l(R);Fa(),s(R);var N=t(R,2);xe(N),s(c);var ue=t(c,2);{var fe=m=>{var V=Rl(),Q=l(V),$e=l(Q,!0);s(Q),s(V),M(()=>{Q.disabled=e(oe),y($e,e(J)?"ðŸ“‹ Show My Gists":"âœï¸ Enter Gist ID Manually")}),F("click",Q,ce),o(m,V)};k(ue,m=>{(D()==="load"||D()==="save"&&e(G))&&m(fe)})}var Pe=t(ue,2);{var me=m=>{var V=Tl(),Q=ze(V);{var $e=Se=>{var he=Al(),Te=t(l(he),2);xe(Te),s(he),M(()=>Te.disabled=e(oe)),Ie(Te,()=>e(h),Ne=>n(h,Ne)),o(Se,he)},Be=Se=>{var he=nt(),Te=ze(he);{var Ne=Ce=>{var ee=Il();o(Ce,ee)},Ve=Ce=>{var ee=nt(),Le=ze(ee);{var Ge=T=>{var d=Pl(),j=t(l(d),2);ut(j,5,()=>e(ne),gt,(K,w)=>{var p=Ml();let de;var we=l(p),_e=l(we),Oe=l(_e,!0);s(_e);var f=t(_e,2),q=l(f,!0);s(f),s(we);var L=t(we,2),Fe=l(L),ye=l(Fe);s(Fe);var qe=t(Fe,2),Re=l(qe);s(qe),s(L),s(p),M(De=>{de=pt(p,1,"gist-item svelte-1jb5ckg",null,de,{selected:e(ke)?.id===e(w).id}),p.disabled=e(oe),y(Oe,(e(w),i(()=>e(w).description||"Untitled"))),y(q,(e(w),i(()=>e(w).public?"ðŸŒ Public":"ðŸ”’ Private"))),y(ye,`ID: ${e(w),i(()=>e(w).id)??""}`),y(Re,`Updated: ${De??""}`)},[()=>(e(w),i(()=>new Date(e(w).updated_at).toLocaleDateString()))]),F("click",p,()=>ae(e(w))),o(K,p)}),s(j),s(d),o(T,d)},P=T=>{var d=nt(),j=ze(d);{var K=w=>{var p=El();o(w,p)};k(j,w=>{e(G)&&w(K)},!0)}o(T,d)};k(Le,T=>{e(ne),i(()=>e(ne).length>0)?T(Ge):T(P,!1)},!0)}o(Ce,ee)};k(Te,Ce=>{e(be)?Ce(Ne):Ce(Ve,!1)},!0)}o(Se,he)};k(Q,Se=>{e(J)||!e(G)?Se($e):Se(Be,!1)})}var He=t(Q,2),U=l(He),X=l(U);s(U);var x=t(U,2);xe(x),s(He),M(()=>{y(X,`Description ${e(h)?"(optional)":""}`),x.disabled=e(oe)}),Ie(x,()=>e(O),Se=>n(O,Se)),o(m,V)},je=m=>{var V=nt(),Q=ze(V);{var $e=He=>{var U=Hl(),X=t(l(U),2);xe(X),s(U),M(()=>X.disabled=e(oe)),Ie(X,()=>e(h),x=>n(h,x)),o(He,U)},Be=He=>{var U=nt(),X=ze(U);{var x=he=>{var Te=Ul();o(he,Te)},Se=he=>{var Te=nt(),Ne=ze(Te);{var Ve=ee=>{var Le=Nl(),Ge=t(l(Le),2);ut(Ge,5,()=>e(ne),gt,(P,T)=>{var d=Bl();let j;var K=l(d),w=l(K),p=l(w,!0);s(w);var de=t(w,2),we=l(de,!0);s(de),s(K);var _e=t(K,2),Oe=l(_e),f=l(Oe);s(Oe);var q=t(Oe,2),L=l(q);s(q),s(_e),s(d),M(Fe=>{j=pt(d,1,"gist-item svelte-1jb5ckg",null,j,{selected:e(ke)?.id===e(T).id}),d.disabled=e(oe),y(p,(e(T),i(()=>e(T).description||"Untitled"))),y(we,(e(T),i(()=>e(T).public?"ðŸŒ Public":"ðŸ”’ Private"))),y(f,`ID: ${e(T),i(()=>e(T).id)??""}`),y(L,`Updated: ${Fe??""}`)},[()=>(e(T),i(()=>new Date(e(T).updated_at).toLocaleDateString()))]),F("click",d,()=>ae(e(T))),o(P,d)}),s(Ge),s(Le),o(ee,Le)},Ce=ee=>{var Le=nt(),Ge=ze(Le);{var P=T=>{var d=Gl();o(T,d)};k(Ge,T=>{e(G)&&T(P)},!0)}o(ee,Le)};k(Ne,ee=>{e(ne),i(()=>e(ne).length>0)?ee(Ve):ee(Ce,!1)},!0)}o(he,Te)};k(X,he=>{e(be)?he(x):he(Se,!1)},!0)}o(He,U)};k(Q,He=>{e(J)||!e(G)?He($e):He(Be,!1)})}o(m,V)};k(Pe,m=>{D()==="save"?m(me):m(je,!1)})}var b=t(Pe,2),Ee=l(b),Ue=l(Ee);{var We=m=>{var V=bt();M(()=>y(V,D()==="save"?"Saving...":"Loading...")),o(m,V)},Ke=m=>{var V=bt();M(()=>y(V,D()==="save"?"Save":"Load")),o(m,V)};k(Ue,m=>{e(oe)?m(We):m(Ke,!1)})}s(Ee);var Ze=t(Ee,2);s(b),s(Z),s(se),s(H),M(()=>{y(Me,D()==="save"?"Save to GitHub Gist":"Load from GitHub Gist"),y(ve,`GitHub Token ${D()==="load"?"(optional for public gists)":"(required)"} `),N.disabled=e(oe),Ee.disabled=e(oe),Ze.disabled=e(oe)}),F("click",$,W),Ie(N,()=>e(G),m=>n(G,m)),F("blur",N,()=>{e(G)&&!e(J)&&B()}),F("click",Ee,function(...m){(D()==="save"?pe:z)?.apply(this,m)}),F("click",Ze,W),F("click",se,ha(function(m){Tt.call(this,u,m)})),F("keydown",se,function(m){Tt.call(this,u,m)}),F("click",H,W),F("keydown",H,m=>m.key==="Escape"&&W()),o(r,H),kt(),S()}var zl=g('<div class="loading svelte-1ngjemu">Loading D&D data...</div>'),Wl=g("<option> </option>"),Kl=g('<select class="level-filter svelte-1ngjemu"><option>All Levels</option><option>Cantrip</option><!></select>'),Jl=g('<div class="no-results svelte-1ngjemu"> </div>'),Vl=g('<div class="item-meta svelte-1ngjemu"> </div>'),Ql=g('<div class="item-meta svelte-1ngjemu"> </div>'),Xl=g('<button><div class="item-name svelte-1ngjemu"> </div> <!></button>'),Yl=g('<p class="higher-levels"><strong>At Higher Levels:</strong> </p>'),Zl=g('<p class="cantrip-upgrade"><strong>Cantrip Upgrade:</strong> </p>'),ei=g('<h3 class="svelte-1ngjemu"> </h3> <p class="spell-meta svelte-1ngjemu"><!> <!></p> <p class="spell-classes"><strong>Classes:</strong> </p> <div class="spell-stats svelte-1ngjemu"><div><strong>Casting Time:</strong> </div> <div><strong>Range:</strong> </div> <div><strong>Components:</strong> <!></div> <div><strong>Duration:</strong> <!> </div></div> <p class="description svelte-1ngjemu"> </p> <!> <!>',1),ti=g('<p class="prerequisite svelte-1ngjemu"><strong>Prerequisite:</strong> </p>'),ai=g('<h3 class="svelte-1ngjemu"> </h3> <!> <p class="description svelte-1ngjemu"> </p> <a target="_blank" rel="noopener" class="source-link svelte-1ngjemu">View Full Details â†’</a>',1),si=g('<div class="item-details svelte-1ngjemu"><!></div>'),li=g('<div class="controls svelte-1ngjemu"><div class="tabs svelte-1ngjemu"><button> </button> <button> </button></div> <div class="search-controls svelte-1ngjemu"><input type="text" placeholder="Search by name or description..." class="search-input svelte-1ngjemu"/> <!></div></div> <div class="content-container svelte-1ngjemu"><div class="items-list svelte-1ngjemu"><!></div> <!></div>',1),ii=g('<div class="modal-backdrop svelte-1ngjemu" role="presentation"><div class="modal svelte-1ngjemu" role="dialog" aria-modal="true" tabindex="-1"><div class="modal-header svelte-1ngjemu"><h2 class="svelte-1ngjemu">Browse D&D Spells & Feats</h2> <button class="close-btn svelte-1ngjemu" aria-label="Close">&times;</button></div> <div class="modal-body svelte-1ngjemu"><!></div> <div class="modal-footer svelte-1ngjemu"><button class="btn-secondary svelte-1ngjemu">Cancel</button> <button class="btn-primary svelte-1ngjemu">Add to Character Sheet</button></div></div></div>');function ri(r,u){xt(u,!1);const a=A(),v=A(),S=A();let C=Et(u,"onClose",8),D=A("spell"),G=A(!0),h=A(""),O=A(null),oe=A([]),E=A([]),J=A(null);Vt(async()=>{n(G,!0);try{n(oe,await Ma()),n(E,await ms())}catch($){console.error("Failed to load data:",$)}finally{n(G,!1)}});function be($){n(J,$)}function ne($){const Z=$.match(/(\d+d\d+(?:\s*\+\s*\d+)?)/i);return Z?Z[1]:""}function ke($){const Z=$.split(/\.( |$)/)[0].trim(),ie=Array.from($.matchAll(/\*\*(.*?)\*\*/g)).map(c=>c[1].replace(/\.$/,""));let _=Z;return ie.length&&(_+=" | Effects: "+ie.join(", ")),_}function ge(){if(e(J)){if(e(D)==="spell"){const $=e(J);Y.update(Z=>{const _=[];$.range&&_.push(`Range: ${$.range}`),$.castingTime&&_.push(`Cast: ${$.castingTime}`),$.duration&&_.push(`Duration: ${$.duration}`),$.actionType==="Save"&&_.push("Saving throw spell"),$.components&&$.components.length>0&&_.push(`Components: ${$.components.join(", ")}`),$.material&&_.push(`Material: ${$.material}`);const c=_.join(" | "),R=ke($.description),ve={id:crypto.randomUUID(),name:`${$.name}${$.concentration?" (C)":""}${$.ritual?" (R)":""}`,bonus:$.actionType==="Attack"?5:0,damage:ne($.description),damageType:`${$.school} (Lvl ${$.level})`,spellRef:$.name,infoNotes:c,generalNotes:R,castAtLevel:$.level};return Z.attacks=[...Z.attacks,ve],Z})}else if(e(D)==="feat"){const $=e(J);Y.update(Z=>{const ie=`${$.name}${$.prerequisite?` (Req: ${$.prerequisite})`:""}
${$.description}
`;return Z.features=Z.features?`${Z.features}
${ie}`:ie,Z})}n(J,null),C()()}}Ye(()=>(e(O),e(oe),e(h)),()=>{n(a,e(O)!==null?_s(xa(e(oe),e(h)),e(O)):xa(e(oe),e(h)))}),Ye(()=>(e(E),e(h)),()=>{n(v,ys(e(E),e(h)))}),Ye(()=>(e(D),e(a),e(v)),()=>{n(S,e(D)==="spell"?e(a):e(v))}),wt(),yt();var B=ii(),ae=l(B),ce=l(ae),pe=t(l(ce),2);s(ce);var z=t(ce,2),W=l(z);{var H=$=>{var Z=zl();o($,Z)},se=$=>{var Z=li(),ie=ze(Z),_=l(ie),c=l(_);let R;var ve=l(c);s(c);var N=t(c,2);let ue;var fe=l(N);s(N),s(_);var Pe=t(_,2),me=l(Pe);xe(me);var je=t(me,2);{var b=Q=>{var $e=Kl();M(()=>{e(O),St(()=>{})});var Be=l($e);Be.value=(Be.__value=null)??"";var He=t(Be);He.value=He.__value=0;var U=t(He);ut(U,0,()=>[1,2,3,4,5,6,7,8,9],gt,(X,x)=>{var Se=Wl(),he=l(Se);s(Se);var Te={};M(()=>{y(he,`Level ${x??""}`),Te!==(Te=x)&&(Se.value=(Se.__value=x)??"")}),o(X,Se)}),s($e),Aa($e,()=>e(O),X=>n(O,X)),o(Q,$e)};k(je,Q=>{e(D)==="spell"&&Q(b)})}s(Pe),s(ie);var Ee=t(ie,2),Ue=l(Ee),We=l(Ue);{var Ke=Q=>{var $e=Jl(),Be=l($e);s($e),M(()=>y(Be,`No ${e(D)??""}s found`)),o(Q,$e)},Ze=Q=>{var $e=nt(),Be=ze($e);ut(Be,1,()=>e(S),gt,(He,U)=>{var X=Xl();let x;var Se=l(X),he=l(Se,!0);s(Se);var Te=t(Se,2);{var Ne=Ce=>{const ee=tt(()=>e(U));var Le=Vl(),Ge=l(Le);s(Le),M(()=>y(Ge,`Level ${I(e(ee)),i(()=>e(ee).level)??""} â€¢ ${I(e(ee)),i(()=>e(ee).school)??""}`)),o(Ce,Le)},Ve=Ce=>{const ee=tt(()=>e(U));var Le=nt(),Ge=ze(Le);{var P=T=>{var d=Ql(),j=l(d,!0);s(d),M(()=>y(j,(I(e(ee)),i(()=>e(ee).prerequisite)))),o(T,d)};k(Ge,T=>{I(e(ee)),i(()=>e(ee).prerequisite)&&T(P)})}o(Ce,Le)};k(Te,Ce=>{e(D)==="spell"?Ce(Ne):Ce(Ve,!1)})}s(X),M(()=>{x=pt(X,1,"item-card svelte-1ngjemu",null,x,{selected:e(J)?.name===e(U).name}),y(he,(e(U),i(()=>e(U).name)))}),F("click",X,()=>be(e(U))),o(He,X)}),o(Q,$e)};k(We,Q=>{e(S),i(()=>e(S).length===0)?Q(Ke):Q(Ze,!1)})}s(Ue);var m=t(Ue,2);{var V=Q=>{var $e=si(),Be=l($e);{var He=X=>{const x=tt(()=>e(J));var Se=ei(),he=ze(Se),Te=l(he,!0);s(he);var Ne=t(he,2),Ve=l(Ne);{var Ce=re=>{var Xe=bt();M(()=>y(Xe,`${I(e(x)),i(()=>e(x).school)??""} cantrip`)),o(re,Xe)},ee=re=>{var Xe=bt();M(()=>y(Xe,`Level ${I(e(x)),i(()=>e(x).level)??""} ${I(e(x)),i(()=>e(x).school)??""}`)),o(re,Xe)};k(Ve,re=>{I(e(x)),i(()=>e(x).level===0)?re(Ce):re(ee,!1)})}var Le=t(Ve,2);{var Ge=re=>{var Xe=bt("(ritual)");o(re,Xe)};k(Le,re=>{I(e(x)),i(()=>e(x).ritual)&&re(Ge)})}s(Ne);var P=t(Ne,2),T=t(l(P));s(P);var d=t(P,2),j=l(d),K=t(l(j));s(j);var w=t(j,2),p=t(l(w));s(w);var de=t(w,2),we=t(l(de)),_e=t(we);{var Oe=re=>{var Xe=bt();M(()=>y(Xe,`(${I(e(x)),i(()=>e(x).material)??""})`)),o(re,Xe)};k(_e,re=>{I(e(x)),i(()=>e(x).material)&&re(Oe)})}s(de);var f=t(de,2),q=t(l(f),2);{var L=re=>{var Xe=bt("Concentration,");o(re,Xe)};k(q,re=>{I(e(x)),i(()=>e(x).concentration)&&re(L)})}var Fe=t(q,1,!0);s(f),s(d);var ye=t(d,2),qe=l(ye,!0);s(ye);var Re=t(ye,2);{var De=re=>{var Xe=Yl(),et=t(l(Xe));s(Xe),M(()=>y(et,` ${I(e(x)),i(()=>e(x).higherLevelSlot)??""}`)),o(re,Xe)};k(Re,re=>{I(e(x)),i(()=>e(x).higherLevelSlot)&&re(De)})}var Ae=t(Re,2);{var ot=re=>{var Xe=Zl(),et=t(l(Xe));s(Xe),M(()=>y(et,` ${I(e(x)),i(()=>e(x).cantripUpgrade)??""}`)),o(re,Xe)};k(Ae,re=>{I(e(x)),i(()=>e(x).cantripUpgrade)&&re(ot)})}M((re,Xe)=>{y(Te,(I(e(x)),i(()=>e(x).name))),y(T,` ${re??""}`),y(K,` ${I(e(x)),i(()=>e(x).castingTime||e(x).actionType)??""}`),y(p,` ${I(e(x)),i(()=>e(x).range)??""}`),y(we,` ${Xe??""}`),y(Fe,(I(e(x)),i(()=>e(x).duration))),y(qe,(I(e(x)),i(()=>e(x).description)))},[()=>(I(e(x)),i(()=>e(x).classes.join(", "))),()=>(I(e(x)),i(()=>e(x).components.join(", ").toUpperCase()))]),o(X,Se)},U=X=>{const x=tt(()=>e(J));var Se=ai(),he=ze(Se),Te=l(he,!0);s(he);var Ne=t(he,2);{var Ve=Ge=>{var P=ti(),T=t(l(P));s(P),M(()=>y(T,` ${I(e(x)),i(()=>e(x).prerequisite)??""}`)),o(Ge,P)};k(Ne,Ge=>{I(e(x)),i(()=>e(x).prerequisite)&&Ge(Ve)})}var Ce=t(Ne,2),ee=l(Ce,!0);s(Ce);var Le=t(Ce,2);M(()=>{y(Te,(I(e(x)),i(()=>e(x).name))),y(ee,(I(e(x)),i(()=>e(x).description))),lt(Le,"href",(I(e(x)),i(()=>e(x).source)))}),o(X,Se)};k(Be,X=>{e(D)==="spell"?X(He):X(U,!1)})}s($e),o(Q,$e)};k(m,Q=>{e(J)&&Q(V)})}s(Ee),M(()=>{R=pt(c,1,"tab svelte-1ngjemu",null,R,{active:e(D)==="spell"}),y(ve,`ðŸ“œ Spells (${e(oe),i(()=>e(oe).length)??""})`),ue=pt(N,1,"tab svelte-1ngjemu",null,ue,{active:e(D)==="feat"}),y(fe,`â­ Feats (${e(E),i(()=>e(E).length)??""})`)}),F("click",c,()=>{n(D,"spell"),n(J,null),n(h,"")}),F("click",N,()=>{n(D,"feat"),n(J,null),n(h,"")}),Ie(me,()=>e(h),Q=>n(h,Q)),o($,Z)};k(W,$=>{e(G)?$(H):$(se,!1)})}s(z);var te=t(z,2),le=l(te),Me=t(le,2);s(te),s(ae),s(B),M(()=>Me.disabled=!e(J)),F("click",pe,function(...$){C()?.apply(this,$)}),F("click",le,function(...$){C()?.apply(this,$)}),F("click",Me,ge),F("click",ae,ha(function($){Tt.call(this,u,$)})),F("keydown",ae,function($){Tt.call(this,u,$)}),F("click",B,function(...$){C()?.apply(this,$)}),F("keydown",B,$=>$.key==="Escape"&&C()()),o(r,B),kt()}var ni=g('<link rel="icon" type="image/png" href="/favicon.png"/> <meta name="viewport" content="width=device-width, initial-scale=1"/>',1),oi=g('<span class="character-name svelte-1uha8ag"> </span>'),ci=g("<span> </span>"),vi=g('<div class="spell-slots-header svelte-1uha8ag"></div>'),di=g('<div class="rest-menu svelte-1uha8ag"><button class="rest-option svelte-1uha8ag">â˜• Short Rest</button> <button class="rest-option svelte-1uha8ag">ðŸ›ï¸ Long Rest</button></div>'),ui=g('<div class="container svelte-1uha8ag"><header class="svelte-1uha8ag"><div class="header-top svelte-1uha8ag"><div class="header-title svelte-1uha8ag"><div class="title-row svelte-1uha8ag"><h1 class="svelte-1uha8ag">D&D Character Sheet</h1> <!></div> <!></div> <div class="header-right svelte-1uha8ag"><div class="header-controls svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">ðŸŽ²</span><span class="btn-text svelte-1uha8ag">Roll Dice</span></button> <div class="rest-button-container svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">ðŸ˜´</span><span class="btn-text svelte-1uha8ag">Rest</span></button> <!></div> <div class="mode-toggle"><button><span class="btn-icon svelte-1uha8ag"> </span><span class="btn-text svelte-1uha8ag"> </span></button></div></div> <div class="header-search svelte-1uha8ag"><input type="text" placeholder="ðŸ” Search..." class="search-input use-enabled svelte-1uha8ag"/></div></div></div> <div class="header-actions svelte-1uha8ag"><button class="btn btn-mode svelte-1uha8ag">ðŸ“š Browse Spells & Feats</button> <button class="btn btn-secondary">Save to Gist</button> <button class="btn btn-secondary">Load from Gist</button> <button class="btn btn-secondary">Export JSON</button> <button class="btn btn-secondary">Import JSON</button> <input type="file" accept=".json" style="display: none;"/></div></header> <main class="svelte-1uha8ag"><!> <!> <!> <!> <!> <!> <!></main></div> <!> <!> <!> <!>',1);function xi(r,u){xt(u,!1);const a=()=>Je(Y,"$character",C),v=()=>Je(Yt,"$isEditMode",C),S=()=>Je(jt,"$searchFilter",C),[C,D]=Ct();function G(){const f=[],q=a().classFeatures.spellSlotsByLevel||{};for(let L=1;L<=9;L++){const Fe=q[L];if(Fe&&Fe.length>0){const ye=Fe.length,qe=Fe.filter(Re=>Re).length;f.push({level:L,available:ye-qe,total:ye})}}return f}let h=A(!1),O=A(!1),oe=A(!1),E=A("save"),J=A(void 0),be=A(""),ne=A(""),ke=A(""),ge=A(),B=!1,ae=A(!1);function ce(){const f=[];Y.update(L=>{const Fe=L.hitDice.current;L.hitDice.current=Math.min(L.hitDice.max,L.hitDice.current+Math.max(1,Math.floor(L.hitDice.max/2)));const ye=L.hitDice.current-Fe;if(ye>0&&f.push(`${ye} hit ${ye===1?"die":"dice"}`),L.class){const qe=Ht(L.class,L.level,L.subclass);L.classFeatures.features||(L.classFeatures.features={}),qe.forEach(Re=>{if(Re.resetOn==="short"){const De=Re.name.replace(/\s+/g,"");if(Re.type==="uses"){const Ae=typeof Re.maxUses=="function"?Re.maxUses(L.level):Re.maxUses;L.classFeatures.features[De]=Array(Ae).fill(!1),f.push(Re.name)}else if(Re.type==="pool"){const Ae=typeof Re.maxPool=="function"?Re.maxPool(L.level):Re.maxPool;Ae!==void 0&&(L.classFeatures.features[De]=Ae,f.push(Re.name))}}})}return L}),n(ae,!1);const q=f.length>0?`Short rest taken! Restored: ${f.join(", ")}`:"Short rest taken!";Kt.add(q,"success")}function pe(){const f=[];Y.update(L=>{const Fe=L.maxHP-L.currentHP;Fe>0&&f.push(`${Fe} HP`),L.currentHP=L.maxHP,L.tempHP=0;const ye=L.hitDice.max-L.hitDice.current;ye>0&&f.push(`${ye} hit ${ye===1?"die":"dice"}`),L.hitDice.current=L.hitDice.max;let qe=0;if(L.classFeatures.spellSlotsByLevel&&Object.keys(L.classFeatures.spellSlotsByLevel).forEach(Re=>{const De=L.classFeatures.spellSlotsByLevel[parseInt(Re)];if(De){const Ae=De.filter(ot=>ot).length;qe+=Ae,L.classFeatures.spellSlotsByLevel[parseInt(Re)]=Array(De.length).fill(!1)}}),qe>0&&f.push(`${qe} spell ${qe===1?"slot":"slots"}`),L.class){const Re=Ht(L.class,L.level,L.subclass);L.classFeatures.features||(L.classFeatures.features={});let De=!1;Re.forEach(Ae=>{const ot=Ae.name.replace(/\s+/g,"");if(!(Ae.type==="info"||Ae.type==="channelDivinity")){if(Ae.type==="uses"){const re=typeof Ae.maxUses=="function"?Ae.maxUses(L.level):Ae.maxUses;L.classFeatures.features[ot]=Array(re).fill(!1),De=!0}else if(Ae.type==="pool"){const re=typeof Ae.maxPool=="function"?Ae.maxPool(L.level):Ae.maxPool;re!==void 0&&(L.classFeatures.features[ot]=re,De=!0)}}}),De&&f.push("all class features")}return L}),n(ae,!1);const q=f.length>0?`Long rest taken! Restored: ${f.join(", ")}`:"Long rest taken! Fully rested.";Kt.add(q,"success")}function z(f){n(be,""),n(ne,""),n(ke,""),B=!1,typeof f=="string"?n(be,f):(n(be,f.notation),n(ne,f.damageNotation||""),n(ke,f.attackName||"")),n(h,!0)}function W(f){const{notation:q}=f.detail;n(be,""),B=!0,setTimeout(()=>{n(be,q),n(ne,""),n(ke,"Hit Die")},0),n(h,!0)}function H(){if(n(h,!1),B&&e(ge)){const f=e(ge).getLastRollTotal();if(f!==null){const q=Math.max(1,f);Y.update(L=>(L.hitDice.current=Math.max(0,L.hitDice.current-1),L.currentHP=Math.min(L.maxHP,L.currentHP+q),L))}B=!1}}function se(){console.log("toggleMode called, current isEditMode:",v()),Yt.update(f=>(console.log("Updating isEditMode from",f,"to",!f),!f))}function te(f){f.target.closest(".rest-button-container")||n(ae,!1)}Vt(()=>{console.log("onMount - initial isEditMode:",v()),console.log("onMount - body classes:",document.body.className);const f=Yt.subscribe(q=>{console.log("isEditMode subscription triggered, value:",q),console.log("Body classes before:",document.body.className),q?(document.body.classList.remove("use-mode"),console.log("Removed use-mode class (Edit Mode)")):(document.body.classList.add("use-mode"),console.log("Added use-mode class (Use Mode)")),console.log("Body classes after:",document.body.className)});return document.addEventListener("click",te),()=>{f(),document.removeEventListener("click",te)}});function le(){za(a())}function Me(){e(J)?.click()}async function $(f){const L=f.target.files?.[0];if(L)try{const Fe=await Wa(L);Y.set(Fe),alert("Character imported successfully!")}catch{alert("Failed to import character file")}}yt();var Z=ui();Oa("1uha8ag",f=>{var q=ni();Fa(2),Ca(()=>{Na.title="D&D Character Sheet"}),o(f,q)});var ie=ze(Z),_=l(ie),c=l(_),R=l(c),ve=l(R),N=t(l(ve),2);{var ue=f=>{var q=oi(),L=l(q,!0);s(q),M(()=>y(L,a().name)),o(f,q)};k(N,f=>{a().name&&f(ue)})}s(ve);var fe=t(ve,2);{var Pe=f=>{var q=vi();ut(q,5,G,gt,(L,Fe)=>{var ye=ci();let qe;var Re=l(ye);s(ye),M(()=>{qe=pt(ye,1,"slot-badge svelte-1uha8ag",null,qe,{depleted:e(Fe).available===0}),y(Re,`Lv${e(Fe).level??""}: ${e(Fe).available??""}/${e(Fe).total??""}`)}),o(L,ye)}),s(q),o(f,q)};k(fe,f=>{G().length>0&&f(Pe)})}s(R);var me=t(R,2),je=l(me),b=l(je),Ee=t(b,2),Ue=l(Ee),We=t(Ue,2);{var Ke=f=>{var q=di(),L=l(q),Fe=t(L,2);s(q),F("click",L,ce),F("click",Fe,pe),o(f,q)};k(We,f=>{e(ae)&&f(Ke)})}s(Ee);var Ze=t(Ee,2),m=l(Ze);let V;var Q=l(m),$e=l(Q,!0);s(Q);var Be=t(Q),He=l(Be,!0);s(Be),s(m),s(Ze),s(je);var U=t(je,2),X=l(U);xe(X),s(U),s(me),s(c);var x=t(c,2),Se=l(x),he=t(Se,2),Te=t(he,2),Ne=t(Te,2),Ve=t(Ne,2),Ce=t(Ve,2);ua(Ce,f=>n(J,f),()=>e(J)),s(x),s(_);var ee=t(_,2),Le=l(ee);ls(Le,{});var Ge=t(Le,2);ps(Ge,{$$events:{rollHitDice:W}});var P=t(Ge,2);os(P,{$$events:{roll:f=>z(f.detail)}});var T=t(P,2);hs(T,{$$events:{roll:f=>z(f.detail)}});var d=t(T,2);Ws(d,{$$events:{roll:f=>z(f.detail)}});var j=t(d,2);cl(j,{});var K=t(j,2);ul(K,{}),s(ee),s(ie);var w=t(ie,2);ua(Sl(w,{get notation(){return e(be)},get damageNotation(){return e(ne)},get attackName(){return e(ke)},get visible(){return e(h)},$$events:{close:H},$$legacy:!0}),f=>n(ge,f),()=>e(ge));var p=t(w,2);{var de=f=>{ql(f,{get mode(){return e(E)},$$events:{close:()=>n(O,!1)}})};k(p,f=>{e(O)&&f(de)})}var we=t(p,2);{var _e=f=>{ri(f,{onClose:()=>n(oe,!1)})};k(we,f=>{e(oe)&&f(_e)})}var Oe=t(we,2);qa(Oe,{}),M(()=>{V=pt(m,1,"btn btn-mode svelte-1uha8ag",null,V,{"use-mode":!v()}),y($e,v()?"ðŸ“":"ðŸŽ²"),y(He,v()?"Edit Mode":"Use Mode")}),F("click",b,()=>n(h,!0)),F("click",Ue,()=>n(ae,!e(ae))),F("click",m,se),Ie(X,S,f=>Ka(jt,f)),F("click",Se,()=>n(oe,!0)),F("click",he,()=>{n(E,"save"),n(O,!0)}),F("click",Te,()=>{n(E,"load"),n(O,!0)}),F("click",Ne,le),F("click",Ve,Me),F("change",Ce,$),o(r,Z),kt(),D()}export{xi as component};
