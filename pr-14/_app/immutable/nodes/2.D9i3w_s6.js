import{f,e as A,a as v,s as y,c as nt,t as ft}from"../chunks/B7Yu7-pH.js";import{i as yt}from"../chunks/Pgj_Karr.js";import{c as Gt,o as Qt,a as za}from"../chunks/YW1J0937.js";import{a7 as Ia,i as Ma,aZ as Wa,a_ as Ka,a$ as $a,K as At,e as Pa,b0 as Ea,T as na,b1 as Ja,b2 as Va,q as Qa,b3 as Ya,b4 as Xa,b5 as Za,ab as es,d as i,r as Ta,g as ts,C as kt,b6 as et,b7 as jt,F as M,G as xt,s as o,a4 as R,H as r,J as a,I as l,f as e,E as We,m as rt,A as U,b8 as Ct,b9 as Kt,ba as Ha,ao as Ua,bb as as}from"../chunks/TSJapsqm.js";import{c as X,a as gt,e as vt,i as bt,u as Ba,s as Rt,b as dt,d as Yt,f as la,t as Jt,h as ss,T as ls,g as rs,j as is}from"../chunks/ptv-4LDw.js";import{i as C,s as Lt,a as Ke,b as tt,d as ns}from"../chunks/CsWWXapv.js";import{p as Et,b as _a}from"../chunks/CMWnilAD.js";import{b as Wt,r as os}from"../chunks/oM5cxlpc.js";function ra(s,n,t=!1){if(s.multiple){if(n==null)return;if(!Ma(n))return Wa();for(var c of s.options)c.selected=n.includes(Vt(c));return}for(c of s.options){var h=Vt(c);if(Ka(h,n)){c.selected=!0;return}}(!t||n!==void 0)&&(s.selectedIndex=-1)}function ya(s){var n=new MutationObserver(()=>{ra(s,s.__value)});n.observe(s,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Ia(()=>{n.disconnect()})}function Na(s,n,t=n){var c=new WeakSet,h=!0;$a(s,"change",x=>{var L=x?"[selected]":":checked",B;if(s.multiple)B=[].map.call(s.querySelectorAll(L),Vt);else{var _=s.querySelector(L)??s.querySelector("option:not([disabled])");B=_&&Vt(_)}t(B),At!==null&&c.add(At)}),Pa(()=>{var x=n();if(s===document.activeElement){var L=Ea??At;if(c.has(L))return}if(ra(s,x,h),h&&x===void 0){var B=s.querySelector(":checked");B!==null&&(x=Vt(B),t(x))}s.__value=x,h=!1}),ya(s)}function Vt(s){return"__value"in s?s.__value:s.value}const cs=Symbol("is custom element"),vs=Symbol("is html");function Ce(s){if(na){var n=!1,t=()=>{if(!n){if(n=!0,s.hasAttribute("value")){var c=s.value;at(s,"value",null),s.value=c}if(s.hasAttribute("checked")){var h=s.checked;at(s,"checked",null),s.checked=h}}};s.__on_r=t,Qa(t),Ya()}}function Sa(s,n){var t=Ca(s);t.value===(t.value=n??void 0)||s.value===n&&(n!==0||s.nodeName!=="PROGRESS")||(s.value=n??"")}function ds(s,n){var t=Ca(s);t.checked!==(t.checked=n??void 0)&&(s.checked=n)}function at(s,n,t,c){var h=Ca(s);na&&(h[n]=s.getAttribute(n),n==="src"||n==="srcset"||n==="href"&&s.nodeName==="LINK")||h[n]!==(h[n]=t)&&(n==="loading"&&(s[Xa]=t),t==null?s.removeAttribute(n):typeof t!="string"&&us(s).includes(n)?s[n]=t:s.setAttribute(n,t))}function Ca(s){return s.__attributes??={[cs]:s.nodeName.includes("-"),[vs]:s.namespaceURI===Ja}}var Da=new Map;function us(s){var n=s.getAttribute("is")||s.nodeName,t=Da.get(n);if(t)return t;Da.set(n,t=[]);for(var c,h=s,x=Element.prototype;x!==h;){c=Za(h);for(var L in c)c[L].set&&t.push(L);h=Va(h)}return t}function Ae(s,n,t=n){var c=new WeakSet;$a(s,"input",async h=>{var x=h?s.defaultValue:s.value;if(x=ga(s)?ha(x):x,t(x),At!==null&&c.add(At),await es(),x!==(x=n())){var L=s.selectionStart,B=s.selectionEnd,_=s.value.length;if(s.value=x??"",B!==null){var P=s.value.length;L===B&&B===_&&P>_?(s.selectionStart=P,s.selectionEnd=P):(s.selectionStart=L,s.selectionEnd=Math.min(B,P))}}}),(na&&s.defaultValue!==s.value||i(n)==null&&s.value)&&(t(ga(s)?ha(s.value):s.value),At!==null&&c.add(At)),Ta(()=>{var h=n();if(s===document.activeElement){var x=Ea??At;if(c.has(x))return}ga(s)&&h===ha(s.value)||s.type==="date"&&!h&&!s.value||h!==s.value&&(s.value=h??"")})}function ia(s,n,t=n){$a(s,"change",c=>{var h=c?s.defaultChecked:s.checked;t(h)}),(na&&s.defaultChecked!==s.checked||i(n)==null)&&t(s.checked),Ta(()=>{var c=n();s.checked=!!c})}function ga(s){var n=s.type;return n==="number"||n==="range"}function ha(s){return s===""?null:+s}function ps(s,n,t){var c=ts(s,n);c&&c.set&&(s[n]=t,Ia(()=>{s[n]=null}))}function La(s){return function(...n){var t=n[0];return t.stopPropagation(),s?.apply(this,n)}}function Bt(s,n){var t=s.$$events?.[n.type],c=Ma(t)?t.slice():t==null?[]:[t];for(var h of c)h.call(this,n)}const fs="";function Ga(...s){return Wt+fs+os(s[0],s[1])}const ka={paladin:{name:"Paladin",hitDice:"d10",spellcaster:!0,spellcastingAbility:"charisma",spellSlotsByLevel:{1:0,2:2,3:3,4:3,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Divine Sense",type:"uses",maxUses:(s,n=1)=>1+Math.max(1,n),resetOn:"long",description:"Detect celestials, fiends, and undead within 60 feet",minLevel:1},{name:"Lay on Hands",type:"pool",maxPool:s=>s*5,resetOn:"long",description:"Heal wounds or cure disease",minLevel:1},{name:"Divine Smite",type:"spellSlot",description:"Expend spell slot to deal extra radiant damage",minLevel:2,rollable:!0},{name:"Channel Divinity",type:"pool",maxPool:s=>s>=18?3:s>=6?2:1,resetOn:"short",description:"Sacred Weapon or Turn Undead",minLevel:3}]},fighter:{name:"Fighter",hitDice:"d10",spellcaster:!1,features:[{name:"Second Wind",type:"uses",maxUses:1,resetOn:"short",description:"Regain 1d10 + fighter level HP as bonus action",minLevel:1,rollable:!0,rollFormula:s=>`1d10+${s}`},{name:"Action Surge",type:"uses",maxUses:s=>s>=17?2:1,resetOn:"short",description:"Take one additional action on your turn",minLevel:2},{name:"Indomitable",type:"uses",maxUses:s=>s>=17?3:s>=13?2:1,resetOn:"long",description:"Reroll a failed saving throw",minLevel:9}],subclasses:{champion:{name:"Champion",features:[{name:"Improved Critical",type:"info",description:"Critical hit on 19-20",minLevel:3},{name:"Remarkable Athlete",type:"info",description:"Add half proficiency to STR/DEX/CON checks, increase long jump distance",minLevel:7},{name:"Additional Fighting Style",type:"info",description:"Choose a second fighting style",minLevel:10},{name:"Superior Critical",type:"info",description:"Critical hit on 18-20",minLevel:15},{name:"Survivor",type:"info",description:"Regain 5 + CON mod HP at start of turn if below half HP",minLevel:18}]},battlemaster:{name:"Battle Master",features:[{name:"Combat Superiority",type:"uses",maxUses:s=>s>=15?6:s>=7?5:4,resetOn:"short",description:s=>`Use superiority dice (${s>=18?"d12":s>=10?"d10":"d8"}) for maneuvers`,minLevel:3},{name:"Know Your Enemy",type:"info",description:"Learn capabilities of creatures you observe",minLevel:7},{name:"Improved Combat Superiority",type:"info",description:"Superiority dice become d10",minLevel:10},{name:"Relentless",type:"info",description:"Regain 1 superiority die if you have none at start of turn",minLevel:15}]}}},rogue:{name:"Rogue",hitDice:"d8",spellcaster:!1,features:[{name:"Sneak Attack",type:"info",description:s=>`Deal ${Math.ceil(s/2)}d6 extra damage once per turn with advantage or ally nearby`,minLevel:1,rollable:!0,rollFormula:s=>`${Math.ceil(s/2)}d6`},{name:"Cunning Action",type:"info",description:"Dash, Disengage, or Hide as a bonus action",minLevel:2},{name:"Uncanny Dodge",type:"info",description:"Use reaction to halve damage from an attack",minLevel:5},{name:"Evasion",type:"info",description:"Take no damage on successful Dex save (half on fail)",minLevel:7}]},wizard:{name:"Wizard",hitDice:"d6",spellcaster:!0,spellcastingAbility:"intelligence",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Arcane Recovery",type:"uses",maxUses:1,resetOn:"long",description:s=>`Recover spell slots totaling up to ${Math.ceil(s/2)} levels during short rest`,minLevel:1},{name:"Spell Mastery",type:"info",description:"Cast one 1st-level and one 2nd-level spell at will",minLevel:18}]},cleric:{name:"Cleric",hitDice:"d8",spellcaster:!0,spellcastingAbility:"wisdom",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Channel Divinity",type:"pool",maxPool:s=>s>=18?3:s>=6?2:1,resetOn:"short",description:"Turn Undead or domain-specific ability",minLevel:2},{name:"Destroy Undead",type:"info",description:s=>`Channel Divinity destroys undead of CR ${s>=17?4:s>=14?3:s>=11?2:s>=8?1:.5} or lower`,minLevel:5},{name:"Divine Intervention",type:"uses",maxUses:1,resetOn:"long",description:s=>`${s}% chance to succeed, implore deity for aid`,minLevel:10}],subclasses:{war:{name:"War Domain",features:[{name:"War Priest",type:"uses",maxUses:(s,n=1)=>Math.max(1,n),resetOn:"long",description:"Make one weapon attack as a bonus action",minLevel:1},{name:"Guided Strike",type:"channelDivinity",description:"Use your Channel Divinity to gain +10 to an attack roll. Make this choice after you see the roll, but before the DM says whether the attack hits or misses.",minLevel:2,resetOn:"short"},{name:"War God's Blessing",type:"channelDivinity",description:"Use reaction to grant +10 to an ally's attack roll within 30 feet. Consumes one use of Channel Divinity.",minLevel:6,resetOn:"short"},{name:"Divine Strike",type:"info",description:s=>`Deal extra ${s>=14?"2d8":"1d8"} weapon damage once per turn`,minLevel:8,rollable:!0,rollFormula:s=>s>=14?"2d8":"1d8"},{name:"Avatar of Battle",type:"info",description:"Gain resistance to nonmagical weapon damage",minLevel:17}]},life:{name:"Life Domain",features:[{name:"Disciple of Life",type:"info",description:"Healing spells restore additional 2 + spell level HP",minLevel:1},{name:"Preserve Life",type:"pool",maxPool:s=>s*5,resetOn:"short",description:"Restore HP to creatures within 30 feet",minLevel:2},{name:"Blessed Healer",type:"info",description:"Regain 2 + spell level HP when you cast healing spell",minLevel:6},{name:"Divine Strike",type:"info",description:s=>`Deal extra ${s>=14?"2d8":"1d8"} radiant damage once per turn`,minLevel:8,rollable:!0,rollFormula:s=>s>=14?"2d8":"1d8"},{name:"Supreme Healing",type:"info",description:"Maximize healing dice instead of rolling",minLevel:17}]}}},barbarian:{name:"Barbarian",hitDice:"d12",spellcaster:!1,features:[{name:"Rage",type:"uses",maxUses:s=>s>=20?1/0:s>=17?6:s>=12?5:s>=6?4:s>=3?3:2,resetOn:"long",description:s=>`+${s>=16?4:s>=9?3:2} damage, resistance to physical damage`,minLevel:1},{name:"Reckless Attack",type:"info",description:"Gain advantage on melee attacks, enemies get advantage on you",minLevel:2},{name:"Danger Sense",type:"info",description:"Advantage on Dex saves against effects you can see",minLevel:2}],subclasses:{berserker:{name:"Path of the Berserker",features:[{name:"Frenzy",type:"info",description:"While raging, make melee attack as bonus action (gain 1 exhaustion after rage)",minLevel:3},{name:"Mindless Rage",type:"info",description:"Cannot be charmed or frightened while raging",minLevel:6},{name:"Intimidating Presence",type:"info",description:"Use action to frighten creature within 30 feet",minLevel:10},{name:"Retaliation",type:"info",description:"When damaged by creature within 5 feet, make melee attack as reaction",minLevel:14}]}}}};function _t(s){const n=s.toLowerCase();return ka[n]||null}function Nt(s,n,t){const c=_t(s);if(!c)return[];const h=c.features.filter(x=>!x.minLevel||x.minLevel<=n);if(t&&c.subclasses&&c.subclasses[t]){const x=c.subclasses[t].features.filter(L=>!L.minLevel||L.minLevel<=n);return[...h,...x]}return h}function wa(s){const n=_t(s);return!n||!n.subclasses?[]:Object.keys(n.subclasses).map(t=>({id:t,name:n.subclasses[t].name}))}function ja(s,n){const t=_t(s);return!t||!t.spellcaster||!t.spellSlotsByLevel?0:t.spellSlotsByLevel[n]||0}function Fa(s,n,t){const c=_t(s);return!c||!c.spellcaster?0:Math.max(1,t+n)}function bs(s,n,t){const c=_t(s);return!c||!c.spellcaster?null:8+n+t}function gs(){return Object.keys(ka).map(s=>({id:s,name:ka[s].name}))}var hs=f("<option> </option>"),ms=f("<option> </option>"),_s=f('<div class="form-group svelte-172i2fj"><label for="characterSubclass" class="svelte-172i2fj">Subclass</label> <select id="characterSubclass" class="svelte-172i2fj"><option>Select Subclass</option><!></select></div>'),ys=f('<div class="info-grid svelte-172i2fj"><div class="form-group svelte-172i2fj"><label for="characterName" class="svelte-172i2fj">Character Name</label> <input type="text" id="characterName" placeholder="Enter name" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterClass" class="svelte-172i2fj">Class</label> <select id="characterClass" class="svelte-172i2fj"><option>Select Class</option><!></select></div> <!> <div class="form-group svelte-172i2fj"><label for="characterLevel" class="svelte-172i2fj">Level</label> <input type="number" id="characterLevel" min="1" max="20" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterRace" class="svelte-172i2fj">Race</label> <input type="text" id="characterRace" placeholder="e.g., Human" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterBackground" class="svelte-172i2fj">Background</label> <input type="text" id="characterBackground" placeholder="e.g., Soldier" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterAlignment" class="svelte-172i2fj">Alignment</label> <input type="text" id="characterAlignment" placeholder="e.g., Lawful Good" class="svelte-172i2fj"/></div></div>'),ks=f('<section class="character-info svelte-172i2fj"><div class="header svelte-172i2fj"><h2 class="svelte-172i2fj">Character Info</h2> <button class="collapse-btn svelte-172i2fj"> </button></div> <!></section>');function xs(s,n){kt(n,!1);const t=()=>Ke(X,"$character",h),c=()=>Ke(gt,"$collapsedStates",h),[h,x]=Lt(),L=R(),B=gs();function _(E){const be=E.target;X.update(de=>(de.class=be.value,de.subclass="",de))}function P(E){const be=E.target;X.update(de=>(de.subclass=be.value,de))}function re(E){const be=E.target;X.update(de=>(de.level=parseInt(be.value)||1,de)),Ba()}function K(){gt.update(E=>({...E,characterInfo:!E.characterInfo}))}et(()=>(t(),wa),()=>{o(L,t().class?wa(t().class):[])}),jt(),yt();var G=ks(),Re=r(G),ie=a(r(Re),2),fe=r(ie,!0);l(ie),l(Re);var ve=a(Re,2);{var Le=E=>{var be=ys(),de=r(be),oe=a(r(de),2);Ce(oe),l(de);var z=a(de,2),O=a(r(z),2),se=r(O);se.value=se.__value="";var ce=a(se);vt(ce,1,()=>B,bt,(Q,he)=>{var ue=hs(),Oe=r(ue,!0);l(ue);var De={};M(()=>{y(Oe,(e(he),i(()=>e(he).name))),De!==(De=(e(he),i(()=>e(he).id)))&&(ue.value=(ue.__value=(e(he),i(()=>e(he).id)))??"")}),v(Q,ue)}),l(O);var Z;ya(O),l(z);var Ie=a(z,2);{var $=Q=>{var he=_s(),ue=a(r(he),2),Oe=r(ue);Oe.value=Oe.__value="";var De=a(Oe);vt(De,1,()=>e(L),bt,(Pe,Je)=>{var Qe=ms(),Ze=r(Qe,!0);l(Qe);var H={};M(()=>{y(Ze,(e(Je),i(()=>e(Je).name))),H!==(H=(e(Je),i(()=>e(Je).id)))&&(Qe.value=(Qe.__value=(e(Je),i(()=>e(Je).id)))??"")}),v(Pe,Qe)}),l(ue);var g;ya(ue),l(he),M(()=>{g!==(g=(t(),i(()=>t().subclass)))&&(ue.value=(ue.__value=(t(),i(()=>t().subclass)))??"",ra(ue,(t(),i(()=>t().subclass))))}),A("change",ue,P),v(Q,he)};C(Ie,Q=>{e(L),i(()=>e(L).length>0)&&Q($)})}var le=a(Ie,2),ee=a(r(le),2);Ce(ee),l(le);var ge=a(le,2),b=a(r(ge),2);Ce(b),l(ge);var d=a(ge,2),j=a(r(d),2);Ce(j),l(d);var J=a(d,2),V=a(r(J),2);Ce(V),l(J),l(be),M(()=>{Z!==(Z=(t(),i(()=>t().class)))&&(O.value=(O.__value=(t(),i(()=>t().class)))??"",ra(O,(t(),i(()=>t().class)))),Sa(ee,(t(),i(()=>t().level)))}),Ae(oe,()=>t().name,Q=>tt(X,i(t).name=Q,i(t))),A("change",O,_),A("change",ee,re),Ae(b,()=>t().race,Q=>tt(X,i(t).race=Q,i(t))),Ae(j,()=>t().background,Q=>tt(X,i(t).background=Q,i(t))),Ae(V,()=>t().alignment,Q=>tt(X,i(t).alignment=Q,i(t))),v(E,be)};C(ve,E=>{c(),i(()=>!c().characterInfo)&&E(Le)})}l(G),M(()=>{at(ie,"aria-label",(c(),i(()=>c().characterInfo?"Expand":"Collapse"))),y(fe,(c(),i(()=>c().characterInfo?"â–¼":"â–²")))}),A("click",ie,K),v(s,G),xt(),x()}var $s=f('<div class="ability-card svelte-bbv1xt"><h3 class="svelte-bbv1xt"> </h3> <input type="number" class="ability-score svelte-bbv1xt" min="1" max="30"/> <div class="ability-modifier svelte-bbv1xt"> </div> <button class="roll-btn svelte-bbv1xt">Check</button> <div class="save-row svelte-bbv1xt"><input type="checkbox" class="svelte-bbv1xt"/> <label class="svelte-bbv1xt">Save</label> <button class="roll-btn-small svelte-bbv1xt">Roll</button></div></div>'),Ss=f('<div class="proficiency-bonus svelte-bbv1xt"><label for="profBonus">Proficiency Bonus</label> <input type="number" id="profBonus" class="prof-input svelte-bbv1xt"/></div> <div class="abilities-grid svelte-bbv1xt"></div>',1),Cs=f('<section><div class="header svelte-bbv1xt"><h2 class="svelte-bbv1xt">Ability Scores</h2> <button class="collapse-btn svelte-bbv1xt"> </button></div> <!></section>');function Ls(s,n){kt(n,!1);const t=()=>Ke(Yt,"$abilityModifiers",L),c=()=>Ke(X,"$character",L),h=()=>Ke(Rt,"$searchFilter",L),x=()=>Ke(gt,"$collapsedStates",L),[L,B]=Lt(),_=R(),P=R(),re=Gt(),K=[{key:"strength",label:"Strength"},{key:"dexterity",label:"Dexterity"},{key:"constitution",label:"Constitution"},{key:"intelligence",label:"Intelligence"},{key:"wisdom",label:"Wisdom"},{key:"charisma",label:"Charisma"}];function G(){Ba()}function Re(O){const se=t()[O],ce=`1d20${se>=0?"+":""}${se}`;re("roll",ce)}function ie(O){const se=t()[O],ce=c().saveProficiencies[O]?c().proficiencyBonus:0,Z=se+ce,Ie=`1d20${Z>=0?"+":""}${Z}`;re("roll",Ie)}function fe(){gt.update(O=>({...O,abilityScores:!O.abilityScores}))}et(()=>h(),()=>{o(_,K.filter(({label:O})=>h()?O.toLowerCase().includes(h().toLowerCase()):!0))}),et(()=>(e(_),h()),()=>{o(P,e(_).length>0||!h()||h().toLowerCase().includes("proficiency"))}),jt(),yt();var ve=Cs();let Le;var E=r(ve),be=a(r(E),2),de=r(be,!0);l(be),l(E);var oe=a(E,2);{var z=O=>{var se=Ss(),ce=We(se),Z=a(r(ce),2);Ce(Z),l(ce);var Ie=a(ce,2);vt(Ie,5,()=>e(_),bt,($,le)=>{let ee=()=>e(le).key,ge=()=>e(le).label;var b=$s(),d=r(b),j=r(d,!0);l(d);var J=a(d,2);Ce(J);var V=a(J,2),Q=r(V);l(V);var he=a(V,2),ue=a(he,2),Oe=r(ue);Ce(Oe);var De=a(Oe,2),g=a(De,2);l(ue),l(b),M(Pe=>{y(j,Pe),y(Q,`${t(),ee(),i(()=>t()[ee()]>=0?"+":"")??""}${t(),ee(),i(()=>t()[ee()])??""}`),at(Oe,"id",`${ee()}-save`),at(De,"for",`${ee()}-save`)},[()=>(ge(),i(()=>ge().substring(0,3).toUpperCase()))]),Ae(J,()=>c().abilities[ee()],Pe=>tt(X,i(c).abilities[ee()]=Pe,i(c))),A("change",J,G),A("click",he,()=>Re(ee())),ia(Oe,()=>c().saveProficiencies[ee()],Pe=>tt(X,i(c).saveProficiencies[ee()]=Pe,i(c))),A("click",g,()=>ie(ee())),v($,b)}),l(Ie),Ae(Z,()=>c().proficiencyBonus,$=>tt(X,i(c).proficiencyBonus=$,i(c))),v(O,se)};C(oe,O=>{x(),i(()=>!x().abilityScores)&&O(z)})}l(ve),M(()=>{Le=dt(ve,1,"ability-scores svelte-bbv1xt",null,Le,{hidden:!e(P)}),at(be,"aria-label",(x(),i(()=>x().abilityScores?"Expand":"Collapse"))),y(de,(x(),i(()=>x().abilityScores?"â–¼":"â–²")))}),A("click",be,fe),v(s,ve),xt(),B()}function xa(s,n){if(!s.class)return null;const t=_t(s.class);if(!t||!t.spellcaster||!t.spellcastingAbility)return null;const c=n[t.spellcastingAbility];return 8+s.proficiencyBonus+c}var Ds=f('<div class="stat-box svelte-1r5hyyb"><label for="spellSaveDC" class="svelte-1r5hyyb">Spell Save DC</label> <input type="number" id="spellSaveDC" class="stat-input svelte-1r5hyyb" readonly="" title="8 + Proficiency Bonus + Spellcasting Ability Modifier"/></div>'),ws=f('<span class="hit-dice-type"> </span>'),js=f('<div class="stats-grid svelte-1r5hyyb"><div class="stat-box svelte-1r5hyyb"><label for="armorClass" class="svelte-1r5hyyb">Armor Class</label> <input type="number" id="armorClass" class="stat-input svelte-1r5hyyb"/></div> <div class="stat-box svelte-1r5hyyb"><label for="initiative" class="svelte-1r5hyyb">Initiative</label> <input type="number" id="initiative" class="stat-input svelte-1r5hyyb"/></div> <div class="stat-box svelte-1r5hyyb"><label for="speed" class="svelte-1r5hyyb">Speed</label> <input type="text" id="speed" class="stat-input svelte-1r5hyyb"/></div> <!></div> <div class="hp-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Points</h3> <div class="hp-display svelte-1r5hyyb"><div class="hp-inputs svelte-1r5hyyb"><input type="number" class="hp-current svelte-1r5hyyb" min="0"/> <span class="hp-separator svelte-1r5hyyb">/</span> <input type="number" class="hp-max svelte-1r5hyyb" min="0"/></div> <div class="hp-controls svelte-1r5hyyb"><button class="hp-btn svelte-1r5hyyb">âˆ’</button> <button class="hp-btn svelte-1r5hyyb">+</button> <button class="hp-btn svelte-1r5hyyb">âˆ’5</button> <button class="hp-btn svelte-1r5hyyb">+5</button></div></div> <div class="temp-hp svelte-1r5hyyb"><label for="tempHP" class="svelte-1r5hyyb">Temp HP</label> <input type="number" id="tempHP" min="0" class="svelte-1r5hyyb"/></div></div> <div class="hit-dice-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Dice</h3> <div class="hit-dice-display svelte-1r5hyyb"><input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <span>/</span> <input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <!></div> <div class="hit-dice-controls"><label for="hitDiceCount" class="svelte-1r5hyyb">Roll</label> <input type="number" id="hitDiceCount" class="hit-dice-count-input svelte-1r5hyyb" min="1" value="1"/> <button class="btn btn-primary roll-hit-dice use-enabled svelte-1r5hyyb">ðŸŽ² Roll</button></div></div>',1),Fs=f('<section><div class="header svelte-1r5hyyb"><h2 class="svelte-1r5hyyb">Combat Stats</h2> <button class="collapse-btn svelte-1r5hyyb"> </button></div> <!></section>');function As(s,n){kt(n,!1);const t=()=>Ke(X,"$character",L),c=()=>Ke(Yt,"$abilityModifiers",L),h=()=>Ke(Rt,"$searchFilter",L),x=()=>Ke(gt,"$collapsedStates",L),[L,B]=Lt(),_=R(),P=R(),re=Gt();function K(oe){X.update(z=>(z.currentHP=Math.max(0,Math.min(z.maxHP,z.currentHP+oe)),z))}function G(oe=1){if(t().hitDice.current<=0){alert("No hit dice remaining!");return}if(!t().class){alert("Please select a class first!");return}const z=_t(t().class);if(!z){alert("Invalid class configuration!");return}const O=Math.min(oe,t().hitDice.current),se=z.hitDice,ce=c().constitution,Z=ce>=0?`+${ce}`:`${ce}`,Ie=`${O}${se}${Z}`;re("rollHitDice",{notation:Ie,hitDie:se,count:O})}function Re(){gt.update(oe=>({...oe,combatStats:!oe.combatStats}))}et(()=>(t(),c()),()=>{o(_,xa(t(),c()))}),et(()=>h(),()=>{o(P,!h()||"armor class".includes(h().toLowerCase())||"initiative".includes(h().toLowerCase())||"speed".includes(h().toLowerCase())||"hit points".includes(h().toLowerCase())||"hp".includes(h().toLowerCase())||"hit dice".includes(h().toLowerCase())||"spell save".includes(h().toLowerCase())||"combat".includes(h().toLowerCase()))}),jt(),yt();var ie=Fs();let fe;var ve=r(ie),Le=a(r(ve),2),E=r(Le,!0);l(Le),l(ve);var be=a(ve,2);{var de=oe=>{var z=js(),O=We(z),se=r(O),ce=a(r(se),2);Ce(ce),l(se);var Z=a(se,2),Ie=a(r(Z),2);Ce(Ie),l(Z);var $=a(Z,2),le=a(r($),2);Ce(le),l($);var ee=a($,2);{var ge=N=>{var ae=Ds(),k=a(r(ae),2);Ce(k),l(ae),M(()=>Sa(k,e(_))),v(N,ae)};C(ee,N=>{e(_)!==null&&N(ge)})}l(O);var b=a(O,2),d=a(r(b),2),j=r(d),J=r(j);Ce(J);var V=a(J,4);Ce(V),l(j);var Q=a(j,2),he=r(Q),ue=a(he,2),Oe=a(ue,2),De=a(Oe,2);l(Q),l(d);var g=a(d,2),Pe=a(r(g),2);Ce(Pe),l(g),l(b);var Je=a(b,2),Qe=a(r(Je),2),Ze=r(Qe);Ce(Ze);var H=a(Ze,4);Ce(H);var F=a(H,2);{var Y=N=>{const ae=rt(()=>(U(_t),t(),i(()=>_t(t().class))));var k=nt(),$e=We(k);{var Se=Ee=>{const qe=rt(()=>(c(),i(()=>c().constitution)));var Xe=ws(),Te=r(Xe);l(Xe),M(()=>y(Te,`(${U(e(ae)),i(()=>e(ae).hitDice)??""}${(e(qe)>=0?`+${e(qe)}`:e(qe))??""})`)),v(Ee,Xe)};C($e,Ee=>{e(ae)&&Ee(Se)})}v(N,k)};C(F,N=>{t(),i(()=>t().class)&&N(Y)})}l(Qe);var me=a(Qe,2),Ne=a(r(me),2),we=a(Ne,2);l(me),l(Je),M(()=>{at(J,"max",(t(),i(()=>t().maxHP))),at(Ze,"max",(t(),i(()=>t().hitDice.max))),at(Ne,"max",(t(),i(()=>t().hitDice.current))),we.disabled=(t(),i(()=>t().hitDice.current<=0||!t().class))}),Ae(ce,()=>t().armorClass,N=>tt(X,i(t).armorClass=N,i(t))),Ae(Ie,()=>t().initiative,N=>tt(X,i(t).initiative=N,i(t))),Ae(le,()=>t().speed,N=>tt(X,i(t).speed=N,i(t))),Ae(J,()=>t().currentHP,N=>tt(X,i(t).currentHP=N,i(t))),Ae(V,()=>t().maxHP,N=>tt(X,i(t).maxHP=N,i(t))),A("click",he,()=>K(-1)),A("click",ue,()=>K(1)),A("click",Oe,()=>K(-5)),A("click",De,()=>K(5)),Ae(Pe,()=>t().tempHP,N=>tt(X,i(t).tempHP=N,i(t))),Ae(Ze,()=>t().hitDice.current,N=>tt(X,i(t).hitDice.current=N,i(t))),Ae(H,()=>t().hitDice.max,N=>tt(X,i(t).hitDice.max=N,i(t))),A("input",Ne,N=>{const ae=N.target,k=parseInt(ae.value);k>t().hitDice.current&&(ae.value=String(t().hitDice.current)),k<1&&(ae.value="1")}),A("click",we,()=>{const N=document.getElementById("hitDiceCount"),ae=parseInt(N?.value||"1");G(ae)}),v(oe,z)};C(be,oe=>{x(),i(()=>!x().combatStats)&&oe(de)})}l(ie),M(()=>{fe=dt(ie,1,"combat-stats svelte-1r5hyyb",null,fe,{hidden:!e(P)}),at(Le,"aria-label",(x(),i(()=>x().combatStats?"Expand":"Collapse"))),y(E,(x(),i(()=>x().combatStats?"â–¼":"â–²")))}),A("click",Le,Re),v(s,ie),xt(),B()}const ma={acrobatics:"dexterity",animalHandling:"wisdom",arcana:"intelligence",athletics:"strength",deception:"charisma",history:"intelligence",insight:"wisdom",intimidation:"charisma",investigation:"intelligence",medicine:"wisdom",nature:"intelligence",perception:"wisdom",performance:"charisma",persuasion:"charisma",religion:"intelligence",sleightOfHand:"dexterity",stealth:"dexterity",survival:"wisdom"};var Rs=f('<div class="skill-row svelte-1f1pl16"><input type="checkbox" class="svelte-1f1pl16"/> <label class="svelte-1f1pl16"> <span class="ability-tag svelte-1f1pl16"> </span></label> <span class="skill-modifier svelte-1f1pl16"> </span> <button class="roll-btn svelte-1f1pl16">Roll</button></div>'),Is=f('<div class="skills-grid svelte-1f1pl16"></div>'),Ms=f('<section><div class="header svelte-1f1pl16"><h2 class="svelte-1f1pl16">Skills</h2> <button class="collapse-btn svelte-1f1pl16"> </button></div> <!></section>');function Ps(s,n){kt(n,!1);const t=()=>Ke(Yt,"$abilityModifiers",L),c=()=>Ke(X,"$character",L),h=()=>Ke(Rt,"$searchFilter",L),x=()=>Ke(gt,"$collapsedStates",L),[L,B]=Lt(),_=R(),P=R(),re=Gt(),K=[{key:"acrobatics",label:"Acrobatics"},{key:"animalHandling",label:"Animal Handling"},{key:"arcana",label:"Arcana"},{key:"athletics",label:"Athletics"},{key:"deception",label:"Deception"},{key:"history",label:"History"},{key:"insight",label:"Insight"},{key:"intimidation",label:"Intimidation"},{key:"investigation",label:"Investigation"},{key:"medicine",label:"Medicine"},{key:"nature",label:"Nature"},{key:"perception",label:"Perception"},{key:"performance",label:"Performance"},{key:"persuasion",label:"Persuasion"},{key:"religion",label:"Religion"},{key:"sleightOfHand",label:"Sleight of Hand"},{key:"stealth",label:"Stealth"},{key:"survival",label:"Survival"}];function G(z){const O=ma[z],se=t()[O],ce=c().skillProficiencies[z]?c().proficiencyBonus:0;return se+ce}function Re(z){const O=G(z),se=`1d20${O>=0?"+":""}${O}`;re("roll",se)}function ie(){gt.update(z=>({...z,skills:!z.skills}))}et(()=>h(),()=>{o(_,K.filter(({label:z})=>h()?z.toLowerCase().includes(h().toLowerCase()):!0))}),et(()=>e(_),()=>{o(P,e(_).length>0)}),jt(),yt();var fe=Ms();let ve;var Le=r(fe),E=a(r(Le),2),be=r(E,!0);l(E),l(Le);var de=a(Le,2);{var oe=z=>{var O=Is();vt(O,5,()=>e(_),bt,(se,ce)=>{let Z=()=>e(ce).key,Ie=()=>e(ce).label;const $=rt(()=>(U(ma),Z(),i(()=>ma[Z()]))),le=rt(()=>(Z(),i(()=>G(Z()))));var ee=Rs(),ge=r(ee);Ce(ge);var b=a(ge,2),d=r(b),j=a(d),J=r(j);l(j),l(b);var V=a(b,2),Q=r(V);l(V);var he=a(V,2);l(ee),M(ue=>{at(ge,"id",Z()),at(b,"for",Z()),y(d,`${Ie()??""} `),y(J,`(${ue??""})`),y(Q,`${e(le)>=0?"+":""}${e(le)??""}`)},[()=>(U(e($)),i(()=>e($).substring(0,3).toUpperCase()))]),ia(ge,()=>c().skillProficiencies[Z()],ue=>tt(X,i(c).skillProficiencies[Z()]=ue,i(c))),A("click",he,()=>Re(Z())),v(se,ee)}),l(O),v(z,O)};C(de,z=>{x(),i(()=>!x().skills)&&z(oe)})}l(fe),M(()=>{ve=dt(fe,1,"skills svelte-1f1pl16",null,ve,{hidden:!e(P)}),at(E,"aria-label",(x(),i(()=>x().skills?"Expand":"Collapse"))),y(be,(x(),i(()=>x().skills?"â–¼":"â–²")))}),A("click",E,ie),v(s,fe),xt(),B()}let ta=null,aa=null;async function Oa(){if(ta)return ta;try{return ta=await(await fetch(Ga("/data/spells.json"))).json(),ta||[]}catch(s){return console.error("Failed to load spells:",s),[]}}async function Es(){if(aa)return aa;try{return aa=await(await fetch(Ga("/data/feats.json"))).json(),aa||[]}catch(s){return console.error("Failed to load feats:",s),[]}}function Aa(s,n){if(!n.trim())return s;const t=n.toLowerCase();return s.filter(c=>c.name.toLowerCase().includes(t)||c.school.toLowerCase().includes(t)||c.classes.some(h=>h.toLowerCase().includes(t))||c.description.toLowerCase().includes(t))}function Ts(s,n){return n===null?s:s.filter(t=>t.level===n)}function Hs(s,n){if(!n.trim())return s;const t=n.toLowerCase();return s.filter(c=>c.name.toLowerCase().includes(t)||c.description.toLowerCase().includes(t))}function sa(s){const n=s.description,t=/\b(Strength|Dexterity|Constitution|Intelligence|Wisdom|Charisma)\s+saving\s+throw/i,c=n.match(t);if(!c)return null;const h=c[1].toLowerCase(),L=/half\s+(?:as\s+much\s+)?damage\s+on\s+a\s+successful(?:\s+save)?/i.test(n),_=/saving\s+throw\s+or\s+take.*?damage/i.test(n)&&!L;return{ability:h,halfDamageOnSave:L,noDamageOnSave:_}}var Us=f('<button class="btn-remove svelte-14o91c5">Ã—</button>'),Bs=f('<div class="spell-info-loading svelte-14o91c5">Loading spell info...</div>'),Ns=f('<div class="spell-notes svelte-14o91c5"><h4 class="svelte-14o91c5">General Notes</h4> <p> </p></div>'),Gs=f('<li class="svelte-14o91c5"><strong>At Higher Levels:</strong> </li>'),Os=f('<ul class="svelte-14o91c5"><li class="svelte-14o91c5"><strong>Level:</strong> </li> <li class="svelte-14o91c5"><strong>Casting Time:</strong> </li> <li class="svelte-14o91c5"><strong>Range:</strong> </li> <li class="svelte-14o91c5"><strong>Components:</strong> <!></li> <li class="svelte-14o91c5"><strong>Duration:</strong> <!> </li> <li class="svelte-14o91c5"><strong>Description:</strong> </li> <!></ul>'),qs=f("<option> </option>"),zs=f('<span class="scaled-damage svelte-14o91c5"><!> </span>'),Ws=f('<span class="scaled-damage svelte-14o91c5"> </span>'),Ks=f('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> Target is Fiend or Undead <!></label></div>'),Js=f('<span class="scaled-damage svelte-14o91c5" style="margin-left: 8px;"> </span>'),Vs=f('<span class="scaled-damage svelte-14o91c5">(Half damage)</span>'),Qs=f('<span class="scaled-damage svelte-14o91c5">(No damage)</span>'),Ys=f('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> <!> <!></label></div>'),Xs=f('<div class="spell-level-selector svelte-14o91c5"><label class="svelte-14o91c5">Cast at Level:</label> <select class="spell-level-select use-enabled svelte-14o91c5"></select> <!></div> <!> <!>',1),Zs=f('<div class="spell-level-selector svelte-14o91c5"><span style="color: #dc3545; font-weight: bold;">No spell slots available!</span></div>'),el=f('<!> <div class="spell-info svelte-14o91c5"><div class="spell-info-header svelte-14o91c5" role="button" tabindex="0"><h4 class="svelte-14o91c5">Spell Info</h4> <button class="collapse-btn-small svelte-14o91c5"> </button></div> <!></div> <!>',1),tl=f('<div class="spell-info-missing svelte-14o91c5">Spell info not found.</div>'),al=f('<div class="attack-notes svelte-14o91c5"><label class="svelte-14o91c5">Notes</label> <textarea placeholder="e.g., DC 15 Dex save, Range 120 ft, Concentration" class="notes-input svelte-14o91c5" rows="2"></textarea></div>'),sl=f('<button class="btn btn-primary">Roll Attack</button>'),ll=f('<button class="btn btn-secondary"><!></button>'),rl=f('<button class="btn btn-secondary">Roll Damage</button>'),il=f('<div class="attack-card svelte-14o91c5"><div class="attack-header svelte-14o91c5"><input type="text" placeholder="Attack name" class="attack-name svelte-14o91c5"/> <!></div> <div class="attack-details svelte-14o91c5"><div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Bonus</label> <input type="number" class="attack-bonus svelte-14o91c5"/></div> <div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Damage</label> <input type="text" placeholder="e.g., 2d6+3" class="attack-damage svelte-14o91c5"/></div> <div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Type</label> <input type="text" placeholder="e.g., slashing" class="attack-type svelte-14o91c5"/></div></div> <!> <!> <div class="attack-actions svelte-14o91c5"><!> <!></div></div>'),nl=f('<p class="no-attacks svelte-14o91c5">No attacks added yet. Click "Add Attack" to create one.</p>'),ol=f('<p class="no-attacks svelte-14o91c5">No attacks match your search.</p>'),cl=f('<button class="btn btn-secondary">Add Attack</button> <div class="attacks-list svelte-14o91c5"><!> <!></div>',1),vl=f('<section><div class="header svelte-14o91c5"><h2 class="svelte-14o91c5">Attacks & Spells</h2> <button class="collapse-btn svelte-14o91c5"> </button></div> <!></section>');function dl(s,n){kt(n,!1);const t=()=>Ke(X,"$character",B),c=()=>Ke(Rt,"$searchFilter",B),h=()=>Ke(gt,"$collapsedStates",B),x=()=>Ke(la,"$isEditMode",B),L=()=>Ke(Yt,"$abilityModifiers",B),[B,_]=Lt(),P=R(),re=R(),K=Gt();let G=R({});function Re(d){Ha(G,e(G)[d]=!e(G)[d]),o(G,{...e(G)})}function ie(d){return d.description.toLowerCase().includes("regain")&&(d.description.toLowerCase().includes("hit point")||d.description.toLowerCase().includes("hp"))}function fe(){X.update(d=>(d.attacks=[...d.attacks,{id:crypto.randomUUID(),name:"",bonus:0,damage:"",damageType:"",notes:""}],d))}function ve(d){X.update(j=>(j.attacks=j.attacks.filter(J=>J.id!==d),j))}function Le(d){let j=d.damage,J=!1;if(d.spellRef){const Q=z(d.spellRef);if(Q&&Q.level>0){const he=d.castAtLevel||Q.level;if(!O(he)){alert(`No level ${he} spell slots available!`);return}const Oe=sa(Q);Oe&&d.targetSucceededSave&&Oe.noDamageOnSave?j="0":(J=Oe?.halfDamageOnSave&&d.targetSucceededSave||!1,j=se(d,Q))}}const V=`1d20${d.bonus>=0?"+":""}${d.bonus}`;K("roll",{notation:V,damageNotation:j,attackName:d.name,applyHalfDamage:J})}function E(d){if(!d.damage){alert(`${d.name}: No damage specified`);return}let j=d.damage,J=!1;if(d.spellRef){const V=z(d.spellRef);if(V&&V.level>0){const Q=d.castAtLevel||V.level;if(!O(Q)){alert(`No level ${Q} spell slots available!`);return}const ue=sa(V);ue&&d.targetSucceededSave&&ue.noDamageOnSave?j="0":(J=ue?.halfDamageOnSave&&d.targetSucceededSave||!1,j=se(d,V))}}K("roll",{notation:j,attackName:d.name,applyHalfDamage:J})}function be(){gt.update(d=>({...d,attacks:!d.attacks}))}let de=R([]),oe=R(!1);Qt(async()=>{o(de,await Oa()),o(oe,!0)});function z(d){return e(de).find(j=>j.name===d)}function O(d){t().classFeatures.spellSlotsByLevel||tt(X,i(t).classFeatures.spellSlotsByLevel={},i(t)),t().classFeatures.spellSlotsByLevel[d]||tt(X,i(t).classFeatures.spellSlotsByLevel[d]=Array(2).fill(!1),i(t));const J=t().classFeatures.spellSlotsByLevel[d].findIndex(V=>!V);return J===-1?!1:(X.update(V=>(V.classFeatures.spellSlotsByLevel||(V.classFeatures.spellSlotsByLevel={}),V.classFeatures.spellSlotsByLevel[d]||(V.classFeatures.spellSlotsByLevel[d]=Array(2).fill(!1)),V.classFeatures.spellSlotsByLevel[d][J]=!0,V)),!0)}function se(d,j){let J=d.damage,V=0;if(j.higherLevelSlot&&d.castAtLevel){const De=j.level,Pe=(d.castAtLevel||De)-De;if(Pe>0){const Je=j.higherLevelSlot.match(/(\d+)d(\d+)\s+for\s+each.*?level\s+above/i);if(Je){const[,Qe]=Je;V+=Pe*parseInt(Qe)}}}if(d.targetIsFiendOrUndead&&j.description.includes("Fiend or an Undead")){const De=j.description.match(/increases by (\d+)d(\d+) if.*?Fiend or.*?Undead/i);if(De){const[,g]=De;V+=parseInt(g)}}const Q=J.match(/(\d+)d(\d+)/);if(!Q)return J;const[,he,ue]=Q;return`${parseInt(he)+V}d${ue}`}function ce(d){const j=[];for(let V=d.level;V<=9;V++){const Q=t().classFeatures.spellSlotsByLevel?.[V];Q&&Q.length>0&&j.push(V)}return j}et(()=>(t(),c()),()=>{o(P,t().attacks.filter(d=>{if(!c())return!0;const j=c().toLowerCase();return d.name.toLowerCase().includes(j)||d.damageType.toLowerCase().includes(j)}).sort((d,j)=>!d.spellRef&&j.spellRef?-1:d.spellRef&&!j.spellRef?1:0))}),et(()=>(c(),e(P)),()=>{o(re,!c()||e(P).length>0||"attack".includes(c().toLowerCase())||"spell".includes(c().toLowerCase()))}),jt(),yt();var Z=vl();let Ie;var $=r(Z),le=a(r($),2),ee=r(le,!0);l(le),l($);var ge=a($,2);{var b=d=>{var j=cl(),J=We(j),V=a(J,2),Q=r(V);vt(Q,1,()=>e(P),De=>De.id,(De,g,Pe)=>{var Je=il(),Qe=r(Je),Ze=r(Qe);Ce(Ze);var H=a(Ze,2);{var F=w=>{var q=Us();A("click",q,()=>ve(e(g).id)),v(w,q)};C(H,w=>{x()&&w(F)})}l(Qe);var Y=a(Qe,2),me=r(Y),Ne=a(r(me),2);Ce(Ne),l(me);var we=a(me,2),N=a(r(we),2);Ce(N),l(we);var ae=a(we,2),k=a(r(ae),2);Ce(k),l(ae),l(Y);var $e=a(Y,2);{var Se=w=>{var q=nt(),u=We(q);{var D=I=>{var m=Bs();v(I,m)},T=I=>{const m=rt(()=>(e(g),i(()=>z(e(g).spellRef))));var ne=nt(),je=We(ne);{var ye=p=>{var W=el(),S=We(W);{var xe=it=>{var st=Ns(),ut=a(r(st),2),Mt=r(ut,!0);l(ut),l(st),M(()=>y(Mt,(e(g),i(()=>e(g).generalNotes)))),v(it,st)};C(S,it=>{e(g),i(()=>e(g).generalNotes)&&it(xe)})}var Be=a(S,2),Ve=r(Be),He=a(r(Ve),2),Ue=r(He,!0);l(He),l(Ve);var Fe=a(Ve,2);{var pe=it=>{var st=Os(),ut=r(st),Mt=a(r(ut));l(ut);var Ot=a(ut,2),ca=a(r(Ot));l(Ot);var $t=a(Ot,2),ht=a(r($t));l($t);var Tt=a($t,2),Ht=a(r(Tt)),Xt=a(Ht);{var Pt=Ye=>{var lt=ft();M(()=>y(lt,`(${U(e(m)),i(()=>e(m).material)??""})`)),v(Ye,lt)};C(Xt,Ye=>{U(e(m)),i(()=>e(m).material)&&Ye(Pt)})}l(Tt);var qt=a(Tt,2),Zt=a(r(qt),2);{var ea=Ye=>{var lt=ft("Concentration,");v(Ye,lt)};C(Zt,Ye=>{U(e(m)),i(()=>e(m).concentration)&&Ye(ea)})}var va=a(Zt,1,!0);l(qt);var zt=a(qt,2),da=a(r(zt));l(zt);var ot=a(zt,2);{var ct=Ye=>{var lt=Gs(),mt=a(r(lt));l(lt),M(()=>y(mt,` ${U(e(m)),i(()=>e(m).higherLevelSlot)??""}`)),v(Ye,lt)};C(ot,Ye=>{U(e(m)),i(()=>e(m).higherLevelSlot)&&Ye(ct)})}l(st),M(Ye=>{y(Mt,` ${U(e(m)),i(()=>e(m).level)??""}`),y(ca,` ${U(e(m)),i(()=>e(m).castingTime||e(m).actionType)??""}`),y(ht,` ${U(e(m)),i(()=>e(m).range)??""}`),y(Ht,` ${Ye??""}`),y(va,(U(e(m)),i(()=>e(m).duration))),y(da,` ${U(e(m)),i(()=>e(m).description)??""}`)},[()=>(U(e(m)),i(()=>e(m).components.join(", ")))]),v(it,st)};C(Fe,it=>{e(G),e(g),i(()=>!e(G)[e(g).id])&&it(pe)})}l(Be);var ke=a(Be,2);{var It=it=>{const st=rt(()=>(U(e(m)),i(()=>ce(e(m)))));var ut=nt(),Mt=We(ut);{var Ot=$t=>{const ht=rt(()=>(U(sa),U(e(m)),i(()=>sa(e(m)))));var Tt=Xs(),Ht=We(Tt),Xt=r(Ht),Pt=a(Xt,2);M(()=>{e(g),Ct(()=>{e(st)})}),vt(Pt,5,()=>e(st),bt,(ot,ct)=>{var Ye=qs(),lt=r(Ye);l(Ye);var mt={};M(()=>{y(lt,`Level ${e(ct)??""}`),mt!==(mt=e(ct))&&(Ye.value=(Ye.__value=e(ct))??"")}),v(ot,Ye)}),l(Pt);var qt=a(Pt,2);{var Zt=ot=>{const ct=rt(()=>(e(g),U(e(m)),i(()=>se(e(g),e(m)))));var Ye=zs(),lt=r(Ye);{var mt=St=>{var wt=ft("Healing");v(St,wt)},Ut=St=>{var wt=ft("Damage");v(St,wt)};C(lt,St=>{U(e(m)),i(()=>ie(e(m)))?St(mt):St(Ut,!1)})}var Dt=a(lt);l(Ye),M(()=>y(Dt,` ${e(ct)??""}`)),v(ot,Ye)};C(qt,ot=>{e(g),U(e(m)),i(()=>e(g).castAtLevel&&e(g).castAtLevel>e(m).level)&&ot(Zt)})}l(Ht);var ea=a(Ht,2);{var va=ot=>{var ct=Ks(),Ye=r(ct),lt=r(Ye);Ce(lt);var mt=a(lt,2);{var Ut=Dt=>{const St=rt(()=>(e(g),U(e(m)),i(()=>se(e(g),e(m)))));var wt=Ws(),ua=r(wt);l(wt),M(()=>y(ua,`(+1d8, total: ${e(St)??""})`)),v(Dt,wt)};C(mt,Dt=>{e(g),i(()=>e(g).targetIsFiendOrUndead)&&Dt(Ut)})}l(Ye),l(ct),ia(lt,()=>e(g).targetIsFiendOrUndead,Dt=>(e(g).targetIsFiendOrUndead=Dt,Ct(()=>(e(P),t(),c())))),v(ot,ct)};C(ea,ot=>{U(e(m)),i(()=>e(m).description.includes("Fiend or an Undead"))&&ot(va)})}var zt=a(ea,2);{var da=ot=>{var ct=Ys(),Ye=r(ct),lt=r(Ye);Ce(lt);var mt=a(lt),Ut=a(mt);{var Dt=pt=>{var Ft=Js(),pa=r(Ft);l(Ft),M(fa=>y(pa,`(Spell Save DC: ${fa??""})`),[()=>(U(xa),t(),L(),i(()=>xa(t(),L())))]),v(pt,Ft)};C(Ut,pt=>{t(),i(()=>t().class)&&pt(Dt)})}var St=a(Ut,2);{var wt=pt=>{var Ft=Vs();v(pt,Ft)},ua=pt=>{var Ft=nt(),pa=We(Ft);{var fa=ba=>{var qa=Qs();v(ba,qa)};C(pa,ba=>{e(g),U(e(ht)),i(()=>e(g).targetSucceededSave&&e(ht).noDamageOnSave)&&ba(fa)},!0)}v(pt,Ft)};C(St,pt=>{e(g),U(e(ht)),i(()=>e(g).targetSucceededSave&&e(ht).halfDamageOnSave)?pt(wt):pt(ua,!1)})}l(Ye),l(ct),M(pt=>y(mt,` Target succeeded on ${pt??""} save `),[()=>(U(e(ht)),i(()=>e(ht).ability.charAt(0).toUpperCase()+e(ht).ability.slice(1)))]),ia(lt,()=>e(g).targetSucceededSave,pt=>(e(g).targetSucceededSave=pt,Ct(()=>(e(P),t(),c())))),v(ot,ct)};C(zt,ot=>{e(ht)&&ot(da)})}M(()=>{at(Xt,"for",`castLevel-${e(g),i(()=>e(g).id)??""}`),at(Pt,"id",`castLevel-${e(g),i(()=>e(g).id)??""}`)}),Na(Pt,()=>e(g).castAtLevel,ot=>(e(g).castAtLevel=ot,Ct(()=>(e(P),t(),c())))),v($t,Tt)},ca=$t=>{var ht=Zs();v($t,ht)};C(Mt,$t=>{U(e(st)),i(()=>e(st).length>0)?$t(Ot):$t(ca,!1)})}v(it,ut)};C(ke,it=>{U(e(m)),i(()=>e(m).higherLevelSlot&&e(m).level>0)&&it(It)})}M(()=>{at(He,"aria-label",(e(G),e(g),i(()=>e(G)[e(g).id]?"Expand":"Collapse"))),y(Ue,(e(G),e(g),i(()=>e(G)[e(g).id]?"â–¼":"â–²")))}),A("click",Ve,()=>Re(e(g).id)),A("keydown",Ve,it=>it.key==="Enter"&&Re(e(g).id)),v(p,W)},Me=p=>{var W=tl();v(p,W)};C(je,p=>{e(m)?p(ye):p(Me,!1)})}v(I,ne)};C(u,I=>{e(de),i(()=>e(de).length===0)?I(D):I(T,!1)})}v(w,q)};C($e,w=>{e(g),i(()=>e(g).spellRef)&&w(Se)})}var Ee=a($e,2);{var qe=w=>{var q=al(),u=a(r(q),2);Kt(u),l(q),Ae(u,()=>e(g).notes,D=>(e(g).notes=D,Ct(()=>(e(P),t(),c())))),v(w,q)};C(Ee,w=>{e(g),i(()=>!e(g).spellRef)&&w(qe)})}var Xe=a(Ee,2),Te=r(Xe);{var te=w=>{var q=sl();A("click",q,()=>Le(e(g))),v(w,q)};C(Te,w=>{e(g),i(()=>e(g).bonus!==0||!e(g).spellRef)&&w(te)})}var _e=a(Te,2);{var Ge=w=>{const q=rt(()=>(e(g),i(()=>z(e(g).spellRef))));var u=ll(),D=r(u);{var T=m=>{var ne=ft("Roll Healing");v(m,ne)},I=m=>{var ne=ft("Roll Damage");v(m,ne)};C(D,m=>{U(e(q)),i(()=>e(q)&&ie(e(q)))?m(T):m(I,!1)})}l(u),A("click",u,()=>E(e(g))),v(w,u)},ze=w=>{var q=rl();A("click",q,()=>E(e(g))),v(w,q)};C(_e,w=>{e(g),e(oe),i(()=>e(g).spellRef&&e(oe))?w(Ge):w(ze,!1)})}l(Xe),l(Je),Ae(Ze,()=>e(g).name,w=>(e(g).name=w,Ct(()=>(e(P),t(),c())))),Ae(Ne,()=>e(g).bonus,w=>(e(g).bonus=w,Ct(()=>(e(P),t(),c())))),Ae(N,()=>e(g).damage,w=>(e(g).damage=w,Ct(()=>(e(P),t(),c())))),Ae(k,()=>e(g).damageType,w=>(e(g).damageType=w,Ct(()=>(e(P),t(),c())))),v(De,Je)});var he=a(Q,2);{var ue=De=>{var g=nl();v(De,g)},Oe=De=>{var g=nt(),Pe=We(g);{var Je=Qe=>{var Ze=ol();v(Qe,Ze)};C(Pe,Qe=>{e(P),i(()=>e(P).length===0)&&Qe(Je)},!0)}v(De,g)};C(he,De=>{t(),i(()=>t().attacks.length===0)?De(ue):De(Oe,!1)})}l(V),A("click",J,fe),v(d,j)};C(ge,d=>{h(),i(()=>!h().attacks)&&d(b)})}l(Z),M(()=>{Ie=dt(Z,1,"attacks svelte-14o91c5",null,Ie,{hidden:!e(re)}),at(le,"aria-label",(h(),i(()=>h().attacks?"Expand":"Collapse"))),y(ee,(h(),i(()=>h().attacks?"â–¼":"â–²")))}),A("click",le,be),v(s,Z),xt(),_()}var ul=f('<p class="no-features svelte-1kpvv0n">Select a class to see available features</p>'),pl=f('<p class="no-features svelte-1kpvv0n">No class features available at this level</p>'),fl=f('<input type="checkbox" class="slot-checkbox svelte-1kpvv0n"/>'),bl=f('<div class="spell-slots svelte-1kpvv0n"><label class="svelte-1kpvv0n"> </label> <div class="slots-tracker svelte-1kpvv0n"></div></div>'),gl=f('<div class="all-spell-slots"></div>'),hl=f('<div class="feature-box spellcasting svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"> </h3> <div class="spell-stats svelte-1kpvv0n"><div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Spell Save DC</label> <div class="spell-value svelte-1kpvv0n"> </div></div> <div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <div class="spell-value svelte-1kpvv0n"> </div></div></div> <!> <div class="prepared-spells svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <textarea placeholder="List your prepared spells..." class="svelte-1kpvv0n"></textarea></div></div>'),ml=f('<p class="unlimited svelte-1kpvv0n">Unlimited Uses</p>'),_l=f('<p class="no-uses svelte-1kpvv0n">No uses remaining</p>'),yl=f('<div class="uses-with-button svelte-1kpvv0n"><button class="btn btn-primary use-enabled"> </button> <div class="uses-info svelte-1kpvv0n"><span class="uses-remaining svelte-1kpvv0n"> </span> <span class="reset-info svelte-1kpvv0n"> </span></div> <!></div>'),kl=f('<div class="uses-tracker svelte-1kpvv0n"><!></div>'),xl=f('<div class="pool-tracker svelte-1kpvv0n"><input type="number" min="0" class="pool-input svelte-1kpvv0n"/> <span> </span> <button class="btn-small svelte-1kpvv0n"> </button></div>'),$l=f('<p class="no-uses svelte-1kpvv0n">No Channel Divinity uses remaining</p>'),Sl=f('<div class="channel-divinity-option svelte-1kpvv0n"><button class="btn btn-primary use-enabled svelte-1kpvv0n">Use Channel Divinity</button> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div> <!></div>'),Cl=f('<div class="feature-box svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"><!> </h3> <p class="feature-description svelte-1kpvv0n"> </p> <!></div>'),Ll=f('<div class="features-grid svelte-1kpvv0n"><!> <!></div>'),Dl=f('<section><div class="header svelte-1kpvv0n"><h2 class="svelte-1kpvv0n">Class Features</h2> <button class="collapse-btn svelte-1kpvv0n"> </button></div> <!></section>');function wl(s,n){kt(n,!1);const t=()=>Ke(X,"$character",L),c=()=>Ke(Yt,"$abilityModifiers",L),h=()=>Ke(Rt,"$searchFilter",L),x=()=>Ke(gt,"$collapsedStates",L),[L,B]=Lt(),_=R(),P=R(),re=R(),K=R(),G=R(),Re=R(),ie=R();let fe=R(0),ve=R(0);function Le(b,d){X.update(j=>(j.classFeatures.features[b]=d,j))}function E(){X.update(b=>(b.classFeatures.spellSlotsByLevel||(b.classFeatures.spellSlotsByLevel={}),e(K).forEach(({level:d,slots:j})=>{b.classFeatures.spellSlotsByLevel[d]||(b.classFeatures.spellSlotsByLevel[d]=Array(j).fill(!1))}),b))}function be(b){if(typeof b.maxUses=="function"){if((b.name==="Divine Sense"||b.name==="War Priest")&&e(_)?.spellcastingAbility){const d=c()[e(_).spellcastingAbility];return b.maxUses(t().level,d)}return b.maxUses(t().level)}return b.maxUses||0}function de(b,d){X.update(j=>((!j.classFeatures.features[b]||!Array.isArray(j.classFeatures.features[b])||j.classFeatures.features[b].length!==d)&&(j.classFeatures.features[b]=Array(d).fill(!1)),j))}za(()=>{e(Re)&&t()&&t().classFeatures&&t().classFeatures.features&&e(Re).forEach(b=>{if(b.type==="uses"){const d=b.name.replace(/\s+/g,""),j=be(b),J=t().classFeatures.features[d];(!Array.isArray(J)||J.length!==j)&&de(d,j)}})});function oe(b){return typeof b.maxPool=="function"?b.maxPool(t().level):b.maxPool||0}function z(b){return typeof b.description=="function"?b.description(t().level):b.description}function O(){const b="ChannelDivinity";X.update(d=>{const j=d.classFeatures.features[b];return typeof j=="number"&&j>0&&(d.classFeatures.features[b]=j-1),d})}function se(){gt.update(b=>({...b,classFeatures:!b.classFeatures}))}et(()=>(t(),_t),()=>{o(_,t().class?_t(t().class):null)}),et(()=>(t(),Nt),()=>{o(P,t().class?Nt(t().class,t().level,t().subclass):[])}),et(()=>(t(),ja),()=>{o(re,t().class?ja(t().class,t().level):0)}),et(()=>(e(_),t()),()=>{o(K,(()=>{if(!e(_)?.spellcaster)return[];const b=t().level,d=[];return b>=1&&d.push({level:1,slots:Math.min(4,2+Math.floor(b/3))}),b>=3&&d.push({level:2,slots:Math.min(3,2+Math.floor((b-3)/4))}),b>=5&&d.push({level:3,slots:Math.min(3,2+Math.floor((b-5)/5))}),b>=7&&d.push({level:4,slots:Math.min(3,1+Math.floor((b-7)/6))}),b>=9&&d.push({level:5,slots:Math.min(2,1+Math.floor((b-9)/8))}),b>=11&&d.push({level:6,slots:1}),b>=13&&d.push({level:7,slots:1}),b>=15&&d.push({level:8,slots:1}),b>=17&&d.push({level:9,slots:1}),d})())}),et(()=>(e(_),c(),t(),Fa),()=>{if(e(_)?.spellcaster&&e(_).spellcastingAbility){const b=c()[e(_).spellcastingAbility];o(fe,bs(t().class,b,t().proficiencyBonus)||0),o(ve,Fa(t().class,t().level,b))}}),et(()=>(t(),e(_),e(K)),()=>{t().class&&e(_)?.spellcaster&&e(K).length>0&&E()}),et(()=>t(),()=>{o(G,(()=>{const d=t().classFeatures.features["ChannelDivinity"];return typeof d=="number"?d:0})())}),et(()=>(e(P),h()),()=>{o(Re,e(P).filter(b=>{if(!h())return!0;const d=h().toLowerCase();return b.name.toLowerCase().includes(d)||z(b).toLowerCase().includes(d)}))}),et(()=>(h(),t(),e(Re)),()=>{o(ie,!h()||t().class||"class features".includes(h().toLowerCase())||"spellcasting".includes(h().toLowerCase())||e(Re).length>0)}),jt(),yt();var ce=Dl();let Z;var Ie=r(ce),$=a(r(Ie),2),le=r($,!0);l($),l(Ie);var ee=a(Ie,2);{var ge=b=>{var d=nt(),j=We(d);{var J=Q=>{var he=ul();v(Q,he)},V=Q=>{var he=nt(),ue=We(he);{var Oe=g=>{var Pe=pl();v(g,Pe)},De=g=>{var Pe=Ll(),Je=r(Pe);{var Qe=H=>{var F=hl(),Y=r(F),me=r(Y);l(Y);var Ne=a(Y,2),we=r(Ne),N=a(r(we),2),ae=r(N,!0);l(N),l(we);var k=a(we,2),$e=a(r(k),2),Se=r($e,!0);l($e),l(k),l(Ne);var Ee=a(Ne,2);{var qe=te=>{var _e=gl();vt(_e,5,()=>e(K),bt,(Ge,ze)=>{let w=()=>e(ze).level,q=()=>e(ze).slots;const u=rt(()=>(t(),w(),q(),i(()=>t().classFeatures.spellSlotsByLevel?.[w()]||Array(q()).fill(!1))));var D=bl(),T=r(D),I=r(T);l(T);var m=a(T,2);vt(m,5,()=>e(u),bt,(ne,je,ye)=>{var Me=fl();Ce(Me),M(()=>ds(Me,(U(e(u)),i(()=>e(u)[ye]||!1)))),A("change",Me,p=>{X.update(W=>(W.classFeatures.spellSlotsByLevel||(W.classFeatures.spellSlotsByLevel={}),W.classFeatures.spellSlotsByLevel[w()]||(W.classFeatures.spellSlotsByLevel[w()]=Array(q()).fill(!1)),W.classFeatures.spellSlotsByLevel[w()][ye]=p.currentTarget.checked,W))}),v(ne,Me)}),l(m),l(D),M(()=>y(I,`${w()===1?"1st":w()===2?"2nd":w()===3?"3rd":`${w()}th`} Level Spell Slots`)),v(Ge,D)}),l(_e),v(te,_e)};C(Ee,te=>{e(K),i(()=>e(K).length>0)&&te(qe)})}var Xe=a(Ee,2),Te=a(r(Xe),2);Kt(Te),l(Xe),l(F),M(te=>{y(me,`Spellcasting (${te??""})`),y(ae,e(fe)),y(Se,e(ve))},[()=>(e(_),i(()=>e(_).spellcastingAbility?.toUpperCase()))]),Ae(Te,()=>t().classFeatures.preparedSpells,te=>tt(X,i(t).classFeatures.preparedSpells=te,i(t))),v(H,F)};C(Je,H=>{e(_),i(()=>e(_)?.spellcaster)&&H(Qe)})}var Ze=a(Je,2);vt(Ze,1,()=>e(Re),bt,(H,F)=>{const Y=rt(()=>(e(F),i(()=>e(F).name.replace(/\s+/g,"")))),me=rt(()=>(t(),U(e(Y)),i(()=>t().classFeatures.features[e(Y)]))),Ne=rt(()=>typeof e(me)=="number");var we=Cl(),N=r(we),ae=r(N);{var k=te=>{var _e=ft("Channel Divinity:");v(te,_e)};C(ae,te=>{e(F),i(()=>e(F).type==="channelDivinity")&&te(k)})}var $e=a(ae);l(N);var Se=a(N,2),Ee=r(Se,!0);l(Se);var qe=a(Se,2);{var Xe=te=>{const _e=rt(()=>(e(F),i(()=>be(e(F))))),Ge=rt(()=>(t(),U(e(Y)),U(e(_e)),i(()=>(()=>{const D=t().classFeatures.features[e(Y)];return Array.isArray(D)?D.filter(T=>!T).length:e(_e)})())));var ze=kl(),w=r(ze);{var q=D=>{var T=ml();v(D,T)},u=D=>{var T=yl(),I=r(T),m=r(I);l(I);var ne=a(I,2),je=r(ne),ye=r(je);l(je);var Me=a(je,2),p=r(Me);l(Me),l(ne);var W=a(ne,2);{var S=xe=>{var Be=_l();v(xe,Be)};C(W,xe=>{e(Ge)<=0&&xe(S)})}l(T),M(()=>{I.disabled=e(Ge)<=0,y(m,`Use ${e(F),i(()=>e(F).name)??""}`),y(ye,`${e(Ge)??""} / ${e(_e)??""} uses`),y(p,`Resets on ${e(F),i(()=>e(F).resetOn==="short"?"Short Rest":"Long Rest")??""}`)}),A("click",I,()=>{X.update(xe=>{xe.classFeatures.features[e(Y)]||(xe.classFeatures.features[e(Y)]=Array(e(_e)).fill(!1));const Be=xe.classFeatures.features[e(Y)],Ve=Be.findIndex(He=>!He);return Ve!==-1&&(Be[Ve]=!0),xe})}),v(D,T)};C(w,D=>{e(_e)===1/0?D(q):D(u,!1)})}l(ze),v(te,ze)},Te=te=>{var _e=nt(),Ge=We(_e);{var ze=q=>{const u=rt(()=>(e(F),i(()=>oe(e(F)))));var D=xl(),T=r(D);Ce(T);var I=a(T,2),m=r(I);l(I);var ne=a(I,2),je=r(ne,!0);l(ne),l(D),M(()=>{Sa(T,e(Ne)&&e(me)!==void 0?e(me):e(u)),at(T,"max",e(u)),y(m,`/ ${e(u)??""}`),y(je,(e(F),i(()=>e(F).resetOn==="short"?"Short Rest":"Long Rest")))}),A("input",T,ye=>{X.update(Me=>(Me.classFeatures.features[e(Y)]=parseInt(ye.currentTarget.value)||0,Me))}),A("click",ne,()=>Le(e(Y),e(u))),v(q,D)},w=q=>{var u=nt(),D=We(u);{var T=I=>{var m=Sl(),ne=r(m),je=a(ne,2),ye=r(je),Me=r(ye);l(ye),l(je);var p=a(je,2);{var W=S=>{var xe=$l();v(S,xe)};C(p,S=>{e(G)<=0&&S(W)})}l(m),M(()=>{ne.disabled=e(G)<=0,y(Me,`Resets on ${e(F),i(()=>e(F).resetOn==="short"?"Short Rest":"Long Rest")??""}`)}),A("click",ne,O),v(I,m)};C(D,I=>{e(F),i(()=>e(F).type==="channelDivinity")&&I(T)},!0)}v(q,u)};C(Ge,q=>{e(F),i(()=>e(F).type==="pool")?q(ze):q(w,!1)},!0)}v(te,_e)};C(qe,te=>{e(F),i(()=>e(F).type==="uses")?te(Xe):te(Te,!1)})}l(we),M(te=>{y($e,` ${e(F),i(()=>e(F).name)??""}`),y(Ee,te)},[()=>(e(F),i(()=>z(e(F))))]),v(H,we)}),l(Pe),v(g,Pe)};C(ue,g=>{e(P),i(()=>e(P).length===0)?g(Oe):g(De,!1)},!0)}v(Q,he)};C(j,Q=>{t(),i(()=>!t().class)?Q(J):Q(V,!1)})}v(b,d)};C(ee,b=>{x(),i(()=>!x().classFeatures)&&b(ge)})}l(ce),M(()=>{Z=dt(ce,1,"class-features svelte-1kpvv0n",null,Z,{hidden:!e(ie)}),at($,"aria-label",(x(),i(()=>x().classFeatures?"Expand":"Collapse"))),y(le,(x(),i(()=>x().classFeatures?"â–¼":"â–²")))}),A("click",$,se),v(s,ce),xt(),B()}var jl=f('<textarea placeholder="Enter features, traits, and special abilities..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Equipment</h3> <textarea placeholder="List your equipment and inventory..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Notes</h3> <textarea placeholder="Additional notes..." class="svelte-wttn0l"></textarea>',1),Fl=f('<section><div class="header svelte-wttn0l"><h2 class="svelte-wttn0l">Features & Traits</h2> <button class="collapse-btn svelte-wttn0l"> </button></div> <!></section>');function Al(s,n){kt(n,!1);const t=()=>Ke(Rt,"$searchFilter",x),c=()=>Ke(X,"$character",x),h=()=>Ke(gt,"$collapsedStates",x),[x,L]=Lt(),B=R();function _(){gt.update(ve=>({...ve,notes:!ve.notes}))}et(()=>(t(),c()),()=>{o(B,!t()||"features".includes(t().toLowerCase())||"traits".includes(t().toLowerCase())||"equipment".includes(t().toLowerCase())||"notes".includes(t().toLowerCase())||c().features.toLowerCase().includes(t().toLowerCase())||c().equipment.toLowerCase().includes(t().toLowerCase())||c().notes.toLowerCase().includes(t().toLowerCase()))}),jt(),yt();var P=Fl();let re;var K=r(P),G=a(r(K),2),Re=r(G,!0);l(G),l(K);var ie=a(K,2);{var fe=ve=>{var Le=jl(),E=We(Le);Kt(E);var be=a(E,4);Kt(be);var de=a(be,4);Kt(de),Ae(E,()=>c().features,oe=>tt(X,i(c).features=oe,i(c))),Ae(be,()=>c().equipment,oe=>tt(X,i(c).equipment=oe,i(c))),Ae(de,()=>c().notes,oe=>tt(X,i(c).notes=oe,i(c))),v(ve,Le)};C(ie,ve=>{h(),i(()=>!h().notes)&&ve(fe)})}l(P),M(()=>{re=dt(P,1,"notes svelte-wttn0l",null,re,{hidden:!e(B)}),at(G,"aria-label",(h(),i(()=>h().notes?"Expand":"Collapse"))),y(Re,(h(),i(()=>h().notes?"â–¼":"â–²")))}),A("click",G,_),v(s,P),xt(),L()}var Rl=f('<div class="color-picker-section svelte-1r90jgp"><h3 class="svelte-1r90jgp">Dice Colors</h3> <div class="color-inputs svelte-1r90jgp"><div class="color-input-group svelte-1r90jgp"><label for="dice-color" class="svelte-1r90jgp">Dice Color</label> <input type="color" id="dice-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="label-color" class="svelte-1r90jgp">Label Color</label> <input type="color" id="label-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="desk-color" class="svelte-1r90jgp">Background Color</label> <input type="color" id="desk-color" class="svelte-1r90jgp"/></div></div></div>'),Il=f('<div class="loading svelte-1r90jgp"><p class="svelte-1r90jgp">Loading 3D dice...</p></div>'),Ml=f('<div class="custom-dice-selector svelte-1r90jgp"><h3 class="svelte-1r90jgp">Choose Dice to Roll</h3> <div class="dice-inputs svelte-1r90jgp"><div class="dice-input-group svelte-1r90jgp"><label for="d4" class="svelte-1r90jgp">d4</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d4" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d6" class="svelte-1r90jgp">d6</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d6" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d8" class="svelte-1r90jgp">d8</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d8" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d10" class="svelte-1r90jgp">d10</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d10" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d12" class="svelte-1r90jgp">d12</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d12" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d20" class="svelte-1r90jgp">d20</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d20" min="0" max="10"/></div></div> <div class="dice-controls svelte-1r90jgp"><button class="btn btn-primary use-enabled svelte-1r90jgp"> </button> <button class="btn btn-secondary use-enabled svelte-1r90jgp">Reset</button></div></div>'),Pl=f('<span class="crit-badge svelte-1r90jgp">CRITICAL!</span>'),El=f('<p class="svelte-1r90jgp"> </p>'),Tl=f('<p class="modifier-text svelte-1r90jgp"> </p>'),Hl=f('<button class="btn btn-follow-up svelte-1r90jgp"> </button>'),Ul=f('<button class="btn btn-guided-strike svelte-1r90jgp">âš¡ Use Guided Strike (+10)</button>'),Bl=f('<div class="follow-up-actions svelte-1r90jgp"><!> <!></div>'),Nl=f('<div class="result-header svelte-1r90jgp"><h3 class="svelte-1r90jgp"> </h3> <!></div> <div class="result-total svelte-1r90jgp"> </div> <div class="result-details svelte-1r90jgp"><!> <!></div> <!>',1),Gl=f('<div role="button" tabindex="-1"><div class="modal-content svelte-1r90jgp" role="dialog" tabindex="0"><div class="modal-header svelte-1r90jgp"><h2 class="svelte-1r90jgp">Dice Roller</h2> <div class="header-buttons svelte-1r90jgp"><button class="color-btn svelte-1r90jgp" title="Customize dice colors">ðŸŽ¨</button> <button class="close-btn svelte-1r90jgp">Ã—</button></div></div> <!> <!> <div class="dice-main-area svelte-1r90jgp"><div class="dice-container svelte-1r90jgp"></div> <!></div> <div><!></div></div></div>');function Ol(s,n){kt(n,!1);const t=()=>Ke(X,"$character",c),[c,h]=Lt(),x=R(),L=R(),B=R(),_=Gt();let P=Et(n,"notation",12,""),re=Et(n,"visible",8,!1),K=Et(n,"damageNotation",12,""),G=Et(n,"attackName",12,""),Re=Et(n,"applyHalfDamage",8,!1),ie=null,fe=R(void 0),ve=R(!1),Le=R(""),E=R(null);function be(){return e(E)?.resultTotal??null}let de=R(0),oe=R(0),z=R(0),O=R(0),se=R(0),ce=R(0),Z=R(0),Ie=R([]),$=R(!1),le=R("other"),ee=R(!1),ge=R("#051e0a"),b=R("#ffffff"),d=R("#3a2004"),j=R(!1);function J(u){return u.length===9&&u.startsWith("#")?u.substring(0,7):u}function V(u,D="ff"){return u.length===7&&u.startsWith("#")?u+D:u}function Q(){if(window.DICE&&e(fe))try{ie&&e(fe)&&Ha(fe,e(fe).innerHTML="");const u=e(fe).clientWidth||500,D=e(fe).clientHeight||300;ie=new window.DICE.dice_box(e(fe),{w:u,h:D}),o(ve,!0)}catch(u){console.error("Error initializing dice box:",u)}}Qt(()=>{const u=I=>new Promise((m,ne)=>{if(document.querySelector(`script[src="${I}"]`)){console.log(`Script already loaded: ${I}`),m(null);return}const ye=document.createElement("script");ye.src=I,ye.onload=()=>{console.log(`Loaded: ${I}`),m(null)},ye.onerror=()=>{console.error(`Failed to load: ${I}`),ne(new Error(`Failed to load ${I}`))},document.head.appendChild(ye)});setTimeout(()=>{u(`${Wt}/libs/three.min.js`).then(()=>u(`${Wt}/libs/cannon.min.js`)).then(()=>u(`${Wt}/libs/teal.js`)).then(()=>u(`${Wt}/dice.js`)).then(()=>{if(console.log("All scripts loaded, initializing dice box..."),console.log("DICE available:",!!window.DICE),console.log("Container available:",!!e(fe)),window.DICE){const I=window.DICE.getColors();o(ge,J(I.dice_color)),o(b,J(I.label_color)),o(d,J(I.desk_color))}Q()}).catch(I=>{console.error("Failed to load dice libraries:",I)})},100);const D=()=>{e(ve)&&(console.log("Window resized, reinitializing dice box..."),Q())},T=I=>{re()&&I.key==="Escape"&&Ze()};return window.addEventListener("resize",D),window.addEventListener("keydown",T),()=>{window.removeEventListener("resize",D),window.removeEventListener("keydown",T)}});function he(u,D="other"){if(!ie||!e(ve))return;console.log("Rolling dice:",u,"type:",D),o(le,D),o(ee,!1),ie.diceToRoll=u;const T=m=>(console.log("Before roll:",m),null),I=m=>{console.log("After roll:",m);let ne=m.resultTotal,je=m.resultString;if(Re()&&(ne=Math.floor(ne/2),je=je+" (halved)"),o(E,{...m,resultTotal:ne,resultString:je}),D==="attack"||D==="check"||D==="save"){const ye=m.results?.filter(Me=>Me.sides===20)||[];if(ye.length>0){const Me=ye[0].value;o($,Me===20)}}if(o(Ie,[]),D==="attack"&&K())if(e($)){const ye=De(K());e(Ie).push({label:`Roll Critical Damage (${ye})`,notation:ye})}else e(Ie).push({label:`Roll Damage (${K()})`,notation:K()})};ie.start_throw(T,I)}function ue(){const u=[];e(de)>0&&u.push(`${e(de)}d4`),e(oe)>0&&u.push(`${e(oe)}d6`),e(z)>0&&u.push(`${e(z)}d8`),e(O)>0&&u.push(`${e(O)}d10`),e(se)>0&&u.push(`${e(se)}d12`),e(ce)>0&&u.push(`${e(ce)}d20`);let D=u.join("+")||"1d20";return e(Z)!==0&&(D+=e(Z)>=0?`+${e(Z)}`:`${e(Z)}`),D}function Oe(){const u=ue();he(u)}function De(u){return u.replace(/(\d+)d(\d+)/g,(D,T,I)=>`${parseInt(T)*2}d${I}`)}function g(){o(de,0),o(oe,0),o(z,0),o(O,0),o(se,0),o(ce,0),o(Z,0),o(E,null),o(Ie,[]),o($,!1),o(le,"other"),o(ee,!1)}function Pe(){window.DICE&&(window.DICE.setColors({dice_color:V(e(ge),"ff"),label_color:V(e(b),"ff"),desk_color:e(d)}),ie&&(ie.updateDeskColor(e(d)),ie.updateDiceColors()))}function Je(){o(j,!e(j))}function Qe(){!e(E)||e(L)<=0||e(ee)||(o(E,{...e(E),resultTotal:e(E).resultTotal+10,resultString:e(E).resultString+" + 10 (Guided Strike)"}),X.update(u=>{const D="ChannelDivinity",T=u.classFeatures.features[D];return typeof T=="number"&&T>0&&(u.classFeatures.features[D]=T-1),u}),o(ee,!0))}function Ze(){_("close"),P(""),K(""),G(""),o(Le,""),o(E,null),o(ee,!1),g()}et(()=>(t(),Nt),()=>{o(x,t().class?Nt(t().class,t().level,t().subclass).some(D=>D.name==="Guided Strike"):!1)}),et(()=>t(),()=>{o(L,(()=>{const D=t().classFeatures.features["ChannelDivinity"];return typeof D=="number"?D:0})())}),et(()=>(e(de),e(oe),e(z),e(O),e(se),e(ce),e(Z)),()=>{o(B,(()=>{const u=[];e(de)>0&&u.push(`${e(de)}d4`),e(oe)>0&&u.push(`${e(oe)}d6`),e(z)>0&&u.push(`${e(z)}d8`),e(O)>0&&u.push(`${e(O)}d10`),e(se)>0&&u.push(`${e(se)}d12`),e(ce)>0&&u.push(`${e(ce)}d20`);let D=u.join("+")||"1d20";return e(Z)!==0&&(D+=e(Z)>=0?`+${e(Z)}`:`${e(Z)}`),D})())}),et(()=>(U(P()),e(ve),U(re()),e(Le),U(K()),U(G())),()=>{if(P()&&e(ve)&&re()&&P()!==e(Le)){o(Le,P()),o(E,null),o(Ie,[]),o($,!1),o(ee,!1);const u=P().includes("1d20")?"attack":"other";console.log("Auto-roll triggered. notation:",P(),"damageNotation:",K(),"attackName:",G()),setTimeout(()=>he(P(),u),200)}}),jt();var H={getLastRollTotal:be};yt();var F=Gl();let Y;var me=r(F),Ne=r(me),we=a(r(Ne),2),N=r(we),ae=a(N,2);l(we),l(Ne);var k=a(Ne,2);{var $e=u=>{var D=Rl(),T=a(r(D),2),I=r(T),m=a(r(I),2);Ce(m),l(I);var ne=a(I,2),je=a(r(ne),2);Ce(je),l(ne);var ye=a(ne,2),Me=a(r(ye),2);Ce(Me),l(ye),l(T),l(D),Ae(m,()=>e(ge),p=>o(ge,p)),A("change",m,Pe),Ae(je,()=>e(b),p=>o(b,p)),A("change",je,Pe),Ae(Me,()=>e(d),p=>o(d,p)),A("change",Me,Pe),v(u,D)};C(k,u=>{e(j)&&u($e)})}var Se=a(k,2);{var Ee=u=>{var D=Il();v(u,D)};C(Se,u=>{e(ve)||u(Ee)})}var qe=a(Se,2),Xe=r(qe);_a(Xe,u=>o(fe,u),()=>e(fe));var Te=a(Xe,2);{var te=u=>{var D=Ml(),T=a(r(D),2),I=r(T),m=a(r(I),2);Ce(m),l(I);var ne=a(I,2),je=a(r(ne),2);Ce(je),l(ne);var ye=a(ne,2),Me=a(r(ye),2);Ce(Me),l(ye);var p=a(ye,2),W=a(r(p),2);Ce(W),l(p);var S=a(p,2),xe=a(r(S),2);Ce(xe),l(S);var Be=a(S,2),Ve=a(r(Be),2);Ce(Ve),l(Be),l(T);var He=a(T,2),Ue=r(He),Fe=r(Ue);l(Ue);var pe=a(Ue,2);l(He),l(D),M(()=>{Ue.disabled=!e(ve),y(Fe,`Roll ${e(B)??""}`)}),Ae(m,()=>e(de),ke=>o(de,ke)),Ae(je,()=>e(oe),ke=>o(oe,ke)),Ae(Me,()=>e(z),ke=>o(z,ke)),Ae(W,()=>e(O),ke=>o(O,ke)),Ae(xe,()=>e(se),ke=>o(se,ke)),Ae(Ve,()=>e(ce),ke=>o(ce,ke)),A("click",Ue,Oe),A("click",pe,g),v(u,D)};C(Te,u=>{P()||u(te)})}l(qe);var _e=a(qe,2);let Ge;var ze=r(_e);{var w=u=>{var D=Nl(),T=We(D),I=r(T),m=r(I,!0);l(I);var ne=a(I,2);{var je=Ue=>{var Fe=Pl();v(Ue,Fe)};C(ne,Ue=>{e($)&&Ue(je)})}l(T);var ye=a(T,2),Me=r(ye,!0);l(ye);var p=a(ye,2),W=r(p);{var S=Ue=>{var Fe=El(),pe=r(Fe,!0);l(Fe),M(()=>y(pe,(e(E),i(()=>e(E).resultString)))),v(Ue,Fe)};C(W,Ue=>{e(E),i(()=>e(E).resultString)&&Ue(S)})}var xe=a(W,2);{var Be=Ue=>{var Fe=Tl(),pe=r(Fe);l(Fe),M(()=>y(pe,`Modifier: ${e(E),i(()=>e(E).constant>=0?"+":"")??""}${e(E),i(()=>e(E).constant)??""}`)),v(Ue,Fe)};C(xe,Ue=>{e(E),i(()=>e(E).constant)&&Ue(Be)})}l(p);var Ve=a(p,2);{var He=Ue=>{var Fe=Bl(),pe=r(Fe);vt(pe,1,()=>e(Ie),bt,(it,st)=>{var ut=Hl(),Mt=r(ut,!0);l(ut),M(()=>y(Mt,(e(st),i(()=>e(st).label)))),A("click",ut,()=>he(e(st).notation,"damage")),v(it,ut)});var ke=a(pe,2);{var It=it=>{var st=Ul();M(()=>{st.disabled=e(L)<=0,at(st,"title",e(L)<=0?"No Channel Divinity uses remaining":"Use Channel Divinity to add +10 to this attack roll")}),A("click",st,Qe),v(it,st)};C(ke,it=>{e(x)&&e(le)==="attack"&&!e(ee)&&it(It)})}l(Fe),v(Ue,Fe)};C(Ve,Ue=>{e(Ie),e(x),e(le),e(ee),i(()=>e(Ie).length>0||e(x)&&e(le)==="attack"&&!e(ee))&&Ue(He)})}M(()=>{y(m,G()?`${G()} - Result`:"Result"),y(Me,(e(E),i(()=>e(E).resultTotal)))}),v(u,D)};C(ze,u=>{e(E)&&u(w)})}l(_e),l(me),l(F),M(()=>{Y=dt(F,1,"modal-overlay svelte-1r90jgp",null,Y,{hidden:!re()}),Ge=dt(_e,1,"roll-result svelte-1r90jgp",null,Ge,{"has-result":e(E)})}),A("click",N,Je),A("click",ae,Ze),A("click",me,La(function(u){Bt.call(this,n,u)})),A("keydown",me,function(u){Bt.call(this,n,u)}),A("click",F,Ze),A("keydown",F,u=>u.key==="Escape"&&Ze()),v(s,F),ps(n,"getLastRollTotal",be);var q=xt(H);return h(),q}const oa="https://api.github.com/gists";async function ql(s,n,t){if(!n)throw new Error("GitHub token is required");const c=JSON.stringify(s,null,2),h=`${s.name||"character"}_dnd.json`,x={description:t||`D&D Character: ${s.name}`,public:!1,files:{[h]:{content:c}}},L=await fetch(oa,{method:"POST",headers:{Authorization:`token ${n}`,"Content-Type":"application/json"},body:JSON.stringify(x)});if(!L.ok)throw new Error(`Failed to create gist: ${L.statusText}`);return(await L.json()).id}async function zl(s,n,t){if(!n||!t)throw new Error("GitHub token and Gist ID are required");const c=JSON.stringify(s,null,2),x={files:{[`${s.name||"character"}_dnd.json`]:{content:c}}},L=await fetch(`${oa}/${t}`,{method:"PATCH",headers:{Authorization:`token ${n}`,"Content-Type":"application/json"},body:JSON.stringify(x)});if(!L.ok)throw new Error(`Failed to update gist: ${L.statusText}`)}async function Wl(s,n){if(!s)throw new Error("Gist ID is required");const t={"Content-Type":"application/json"};n&&(t.Authorization=`token ${n}`);const c=await fetch(`${oa}/${s}`,{method:"GET",headers:t});if(!c.ok)throw new Error(`Failed to load gist: ${c.statusText}`);const h=await c.json(),x=Object.values(h.files);if(x.length===0)throw new Error("No files found in gist");const B=x[0].content;try{const _=JSON.parse(B);return _.attacks&&Array.isArray(_.attacks)&&(_.attacks=_.attacks.map(P=>({...P,id:P.id||crypto.randomUUID()}))),_.classFeatures?(_.classFeatures.features||(_.classFeatures.features={}),_.classFeatures.spellSlots||(_.classFeatures.spellSlots=[]),_.classFeatures.preparedSpells===void 0&&(_.classFeatures.preparedSpells="")):_.classFeatures={features:{},spellSlots:[],preparedSpells:""},_}catch{throw new Error("Invalid character data in gist")}}function Ra(s){typeof window<"u"&&localStorage.setItem("dnd_gist_config",JSON.stringify(s))}function Kl(){if(typeof window<"u"){const s=localStorage.getItem("dnd_gist_config");if(s)return JSON.parse(s)}return{}}async function Jl(s,n=30){if(!s)throw new Error("GitHub token is required to list gists");const t=await fetch(`${oa}?per_page=${n}`,{method:"GET",headers:{Authorization:`token ${s}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error(`Failed to list gists: ${t.statusText}`);return await t.json()}var Vl=f('<div class="error-message svelte-1jb5ckg"> </div>'),Ql=f('<div class="toggle-container svelte-1jb5ckg"><button type="button" class="toggle-btn svelte-1jb5ckg"> </button></div>'),Yl=f('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID (leave empty to create new)</label> <input type="text" id="gistId" placeholder="Optional: existing Gist ID to update" class="svelte-1jb5ckg"/></div>'),Xl=f('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),Zl=f('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),er=f('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Update (or leave unselected to create new)</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),tr=f('<div class="info-message svelte-1jb5ckg">No gists found. A new one will be created.</div>'),ar=f('<!> <div class="form-group svelte-1jb5ckg"><label for="description" class="svelte-1jb5ckg"> </label> <input type="text" id="description" placeholder="D&amp;D Character Sheet" class="svelte-1jb5ckg"/></div>',1),sr=f('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID *</label> <input type="text" id="gistId" placeholder="Enter Gist ID (for public or your private gists)" required class="svelte-1jb5ckg"/></div>'),lr=f('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),rr=f('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),ir=f('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Load</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),nr=f('<div class="info-message svelte-1jb5ckg">No gists found. Enter a Gist ID manually or create a new one in Save mode.</div>'),or=f('<div class="modal-overlay svelte-1jb5ckg" role="button" tabindex="-1"><div class="modal-content svelte-1jb5ckg" role="dialog" tabindex="0"><div class="modal-header svelte-1jb5ckg"><h2 class="svelte-1jb5ckg"> </h2> <button class="close-btn svelte-1jb5ckg">Ã—</button></div> <div class="modal-body svelte-1jb5ckg"><!> <div class="form-group svelte-1jb5ckg"><label for="token" class="svelte-1jb5ckg"> <a href="https://github.com/settings/tokens" target="_blank" rel="noopener" class="svelte-1jb5ckg">Get token</a></label> <input type="password" id="token" placeholder="ghp_xxxxxxxxxxxxx" class="svelte-1jb5ckg"/></div> <!> <!> <div class="modal-actions svelte-1jb5ckg"><button class="btn btn-primary svelte-1jb5ckg"><!></button> <button class="btn btn-secondary svelte-1jb5ckg">Cancel</button></div></div></div></div>');function cr(s,n){kt(n,!1);const t=()=>Ke(X,"$character",c),[c,h]=Lt(),x=Gt();let L=Et(n,"mode",8,"save"),B=R(""),_=R(""),P=R(""),re=R(!1),K=R(""),G=R(!1),Re=R(!1),ie=R([]),fe=R(null);const ve=Kl();ve.token&&o(B,ve.token),ve.gistId&&o(_,ve.gistId),Qt(async()=>{e(B)&&!e(G)&&await Le()});async function Le(){if(e(B)){o(Re,!0),o(K,"");try{o(ie,await Jl(e(B))),e(_)&&o(fe,e(ie).find(H=>H.id===e(_))||null)}catch(H){o(K,H.message||"Failed to load gists"),o(ie,[])}finally{o(Re,!1)}}}function E(H){o(fe,H),o(_,H.id)}function be(){o(G,!e(G)),o(K,""),!e(G)&&e(B)&&Le()}async function de(){if(!e(B)){o(K,"GitHub token is required");return}const H=e(fe)?.id||e(_);o(re,!0),o(K,"");try{if(H)await zl(t(),e(B),H),o(_,H),Jt.add("Character updated in Gist successfully!","success");else{const F=await ql(t(),e(B),e(P));o(_,F),Jt.add(`Character saved to Gist! ID: ${F}`,"success")}Ra({token:e(B),gistId:e(_)}),x("close")}catch(F){o(K,F.message||"Failed to save to Gist")}finally{o(re,!1)}}async function oe(){const H=e(fe)?.id||e(_);if(!H){o(K,"Please select a gist or enter a Gist ID");return}o(re,!0),o(K,"");try{const F=await Wl(H,e(B)||void 0);X.set(F),o(_,H),Ra({token:e(B),gistId:e(_)}),Jt.add("Character loaded from Gist successfully!","success"),x("close")}catch(F){o(K,F.message||"Failed to load from Gist")}finally{o(re,!1)}}function z(){x("close")}yt();var O=or(),se=r(O),ce=r(se),Z=r(ce),Ie=r(Z,!0);l(Z);var $=a(Z,2);l(ce);var le=a(ce,2),ee=r(le);{var ge=H=>{var F=Vl(),Y=r(F,!0);l(F),M(()=>y(Y,e(K))),v(H,F)};C(ee,H=>{e(K)&&H(ge)})}var b=a(ee,2),d=r(b),j=r(d);Ua(),l(d);var J=a(d,2);Ce(J),l(b);var V=a(b,2);{var Q=H=>{var F=Ql(),Y=r(F),me=r(Y,!0);l(Y),l(F),M(()=>{Y.disabled=e(re),y(me,e(G)?"ðŸ“‹ Show My Gists":"âœï¸ Enter Gist ID Manually")}),A("click",Y,be),v(H,F)};C(V,H=>{(L()==="load"||L()==="save"&&e(B))&&H(Q)})}var he=a(V,2);{var ue=H=>{var F=ar(),Y=We(F);{var me=$e=>{var Se=Yl(),Ee=a(r(Se),2);Ce(Ee),l(Se),M(()=>Ee.disabled=e(re)),Ae(Ee,()=>e(_),qe=>o(_,qe)),v($e,Se)},Ne=$e=>{var Se=nt(),Ee=We(Se);{var qe=Te=>{var te=Xl();v(Te,te)},Xe=Te=>{var te=nt(),_e=We(te);{var Ge=w=>{var q=er(),u=a(r(q),2);vt(u,5,()=>e(ie),bt,(D,T)=>{var I=Zl();let m;var ne=r(I),je=r(ne),ye=r(je,!0);l(je);var Me=a(je,2),p=r(Me,!0);l(Me),l(ne);var W=a(ne,2),S=r(W),xe=r(S);l(S);var Be=a(S,2),Ve=r(Be);l(Be),l(W),l(I),M(He=>{m=dt(I,1,"gist-item svelte-1jb5ckg",null,m,{selected:e(fe)?.id===e(T).id}),I.disabled=e(re),y(ye,(e(T),i(()=>e(T).description||"Untitled"))),y(p,(e(T),i(()=>e(T).public?"ðŸŒ Public":"ðŸ”’ Private"))),y(xe,`ID: ${e(T),i(()=>e(T).id)??""}`),y(Ve,`Updated: ${He??""}`)},[()=>(e(T),i(()=>new Date(e(T).updated_at).toLocaleDateString()))]),A("click",I,()=>E(e(T))),v(D,I)}),l(u),l(q),v(w,q)},ze=w=>{var q=nt(),u=We(q);{var D=T=>{var I=tr();v(T,I)};C(u,T=>{e(B)&&T(D)},!0)}v(w,q)};C(_e,w=>{e(ie),i(()=>e(ie).length>0)?w(Ge):w(ze,!1)},!0)}v(Te,te)};C(Ee,Te=>{e(Re)?Te(qe):Te(Xe,!1)},!0)}v($e,Se)};C(Y,$e=>{e(G)||!e(B)?$e(me):$e(Ne,!1)})}var we=a(Y,2),N=r(we),ae=r(N);l(N);var k=a(N,2);Ce(k),l(we),M(()=>{y(ae,`Description ${e(_)?"(optional)":""}`),k.disabled=e(re)}),Ae(k,()=>e(P),$e=>o(P,$e)),v(H,F)},Oe=H=>{var F=nt(),Y=We(F);{var me=we=>{var N=sr(),ae=a(r(N),2);Ce(ae),l(N),M(()=>ae.disabled=e(re)),Ae(ae,()=>e(_),k=>o(_,k)),v(we,N)},Ne=we=>{var N=nt(),ae=We(N);{var k=Se=>{var Ee=lr();v(Se,Ee)},$e=Se=>{var Ee=nt(),qe=We(Ee);{var Xe=te=>{var _e=ir(),Ge=a(r(_e),2);vt(Ge,5,()=>e(ie),bt,(ze,w)=>{var q=rr();let u;var D=r(q),T=r(D),I=r(T,!0);l(T);var m=a(T,2),ne=r(m,!0);l(m),l(D);var je=a(D,2),ye=r(je),Me=r(ye);l(ye);var p=a(ye,2),W=r(p);l(p),l(je),l(q),M(S=>{u=dt(q,1,"gist-item svelte-1jb5ckg",null,u,{selected:e(fe)?.id===e(w).id}),q.disabled=e(re),y(I,(e(w),i(()=>e(w).description||"Untitled"))),y(ne,(e(w),i(()=>e(w).public?"ðŸŒ Public":"ðŸ”’ Private"))),y(Me,`ID: ${e(w),i(()=>e(w).id)??""}`),y(W,`Updated: ${S??""}`)},[()=>(e(w),i(()=>new Date(e(w).updated_at).toLocaleDateString()))]),A("click",q,()=>E(e(w))),v(ze,q)}),l(Ge),l(_e),v(te,_e)},Te=te=>{var _e=nt(),Ge=We(_e);{var ze=w=>{var q=nr();v(w,q)};C(Ge,w=>{e(B)&&w(ze)},!0)}v(te,_e)};C(qe,te=>{e(ie),i(()=>e(ie).length>0)?te(Xe):te(Te,!1)},!0)}v(Se,Ee)};C(ae,Se=>{e(Re)?Se(k):Se($e,!1)},!0)}v(we,N)};C(Y,we=>{e(G)||!e(B)?we(me):we(Ne,!1)})}v(H,F)};C(he,H=>{L()==="save"?H(ue):H(Oe,!1)})}var De=a(he,2),g=r(De),Pe=r(g);{var Je=H=>{var F=ft();M(()=>y(F,L()==="save"?"Saving...":"Loading...")),v(H,F)},Qe=H=>{var F=ft();M(()=>y(F,L()==="save"?"Save":"Load")),v(H,F)};C(Pe,H=>{e(re)?H(Je):H(Qe,!1)})}l(g);var Ze=a(g,2);l(De),l(le),l(se),l(O),M(()=>{y(Ie,L()==="save"?"Save to GitHub Gist":"Load from GitHub Gist"),y(j,`GitHub Token ${L()==="load"?"(optional for public gists)":"(required)"} `),J.disabled=e(re),g.disabled=e(re),Ze.disabled=e(re)}),A("click",$,z),Ae(J,()=>e(B),H=>o(B,H)),A("blur",J,()=>{e(B)&&!e(G)&&Le()}),A("click",g,function(...H){(L()==="save"?de:oe)?.apply(this,H)}),A("click",Ze,z),A("click",se,La(function(H){Bt.call(this,n,H)})),A("keydown",se,function(H){Bt.call(this,n,H)}),A("click",O,z),A("keydown",O,H=>H.key==="Escape"&&z()),v(s,O),xt(),h()}var vr=f('<div class="loading svelte-1ngjemu">Loading D&D data...</div>'),dr=f("<option> </option>"),ur=f('<select class="level-filter svelte-1ngjemu"><option>All Levels</option><option>Cantrip</option><!></select>'),pr=f('<div class="no-results svelte-1ngjemu"> </div>'),fr=f('<div class="item-meta svelte-1ngjemu"> </div>'),br=f('<div class="item-meta svelte-1ngjemu"> </div>'),gr=f('<button><div class="item-name svelte-1ngjemu"> </div> <!></button>'),hr=f('<p class="higher-levels"><strong>At Higher Levels:</strong> </p>'),mr=f('<p class="cantrip-upgrade"><strong>Cantrip Upgrade:</strong> </p>'),_r=f('<h3 class="svelte-1ngjemu"> </h3> <p class="spell-meta svelte-1ngjemu"><!> <!></p> <p class="spell-classes"><strong>Classes:</strong> </p> <div class="spell-stats svelte-1ngjemu"><div><strong>Casting Time:</strong> </div> <div><strong>Range:</strong> </div> <div><strong>Components:</strong> <!></div> <div><strong>Duration:</strong> <!> </div></div> <p class="description svelte-1ngjemu"> </p> <!> <!>',1),yr=f('<p class="prerequisite svelte-1ngjemu"><strong>Prerequisite:</strong> </p>'),kr=f('<h3 class="svelte-1ngjemu"> </h3> <!> <p class="description svelte-1ngjemu"> </p> <a target="_blank" rel="noopener" class="source-link svelte-1ngjemu">View Full Details â†’</a>',1),xr=f('<div class="item-details svelte-1ngjemu"><!></div>'),$r=f('<div class="controls svelte-1ngjemu"><div class="tabs svelte-1ngjemu"><button> </button> <button> </button></div> <div class="search-controls svelte-1ngjemu"><input type="text" placeholder="Search by name or description..." class="search-input svelte-1ngjemu"/> <!></div></div> <div class="content-container svelte-1ngjemu"><div class="items-list svelte-1ngjemu"><!></div> <!></div>',1),Sr=f('<div class="modal-backdrop svelte-1ngjemu" role="presentation"><div class="modal svelte-1ngjemu" role="dialog" aria-modal="true" tabindex="-1"><div class="modal-header svelte-1ngjemu"><h2 class="svelte-1ngjemu">Browse D&D Spells & Feats</h2> <button class="close-btn svelte-1ngjemu" aria-label="Close">&times;</button></div> <div class="modal-body svelte-1ngjemu"><!></div> <div class="modal-footer svelte-1ngjemu"><button class="btn-secondary svelte-1ngjemu">Cancel</button> <button class="btn-primary svelte-1ngjemu">Add to Character Sheet</button></div></div></div>');function Cr(s,n){kt(n,!1);const t=R(),c=R(),h=R();let x=Et(n,"onClose",8),L=R("spell"),B=R(!0),_=R(""),P=R(null),re=R([]),K=R([]),G=R(null);Qt(async()=>{o(B,!0);try{o(re,await Oa()),o(K,await Es())}catch($){console.error("Failed to load data:",$)}finally{o(B,!1)}});function Re($){o(G,$)}function ie($){const le=$.match(/(\d+d\d+(?:\s*\+\s*\d+)?)/i);return le?le[1]:""}function fe($){const le=$.split(/\.( |$)/)[0].trim(),ee=Array.from($.matchAll(/\*\*(.*?)\*\*/g)).map(b=>b[1].replace(/\.$/,""));let ge=le;return ee.length&&(ge+=" | Effects: "+ee.join(", ")),ge}function ve(){if(e(G)){if(e(L)==="spell"){const $=e(G);X.update(le=>{const ge=[];$.range&&ge.push(`Range: ${$.range}`),$.castingTime&&ge.push(`Cast: ${$.castingTime}`),$.duration&&ge.push(`Duration: ${$.duration}`),$.actionType==="Save"&&ge.push("Saving throw spell"),$.components&&$.components.length>0&&ge.push(`Components: ${$.components.join(", ")}`),$.material&&ge.push(`Material: ${$.material}`);const b=ge.join(" | "),d=fe($.description),j={id:crypto.randomUUID(),name:`${$.name}${$.concentration?" (C)":""}${$.ritual?" (R)":""}`,bonus:$.actionType==="Attack"?5:0,damage:ie($.description),damageType:`${$.school} (Lvl ${$.level})`,spellRef:$.name,infoNotes:b,generalNotes:d,castAtLevel:$.level};return le.attacks=[...le.attacks,j],le})}else if(e(L)==="feat"){const $=e(G);X.update(le=>{const ee=`${$.name}${$.prerequisite?` (Req: ${$.prerequisite})`:""}
${$.description}
`;return le.features=le.features?`${le.features}
${ee}`:ee,le})}o(G,null),x()()}}et(()=>(e(P),e(re),e(_)),()=>{o(t,e(P)!==null?Ts(Aa(e(re),e(_)),e(P)):Aa(e(re),e(_)))}),et(()=>(e(K),e(_)),()=>{o(c,Hs(e(K),e(_)))}),et(()=>(e(L),e(t),e(c)),()=>{o(h,e(L)==="spell"?e(t):e(c))}),jt(),yt();var Le=Sr(),E=r(Le),be=r(E),de=a(r(be),2);l(be);var oe=a(be,2),z=r(oe);{var O=$=>{var le=vr();v($,le)},se=$=>{var le=$r(),ee=We(le),ge=r(ee),b=r(ge);let d;var j=r(b);l(b);var J=a(b,2);let V;var Q=r(J);l(J),l(ge);var he=a(ge,2),ue=r(he);Ce(ue);var Oe=a(ue,2);{var De=Y=>{var me=ur();M(()=>{e(P),Ct(()=>{})});var Ne=r(me);Ne.value=(Ne.__value=null)??"";var we=a(Ne);we.value=we.__value=0;var N=a(we);vt(N,0,()=>[1,2,3,4,5,6,7,8,9],bt,(ae,k)=>{var $e=dr(),Se=r($e);l($e);var Ee={};M(()=>{y(Se,`Level ${k??""}`),Ee!==(Ee=k)&&($e.value=($e.__value=k)??"")}),v(ae,$e)}),l(me),Na(me,()=>e(P),ae=>o(P,ae)),v(Y,me)};C(Oe,Y=>{e(L)==="spell"&&Y(De)})}l(he),l(ee);var g=a(ee,2),Pe=r(g),Je=r(Pe);{var Qe=Y=>{var me=pr(),Ne=r(me);l(me),M(()=>y(Ne,`No ${e(L)??""}s found`)),v(Y,me)},Ze=Y=>{var me=nt(),Ne=We(me);vt(Ne,1,()=>e(h),bt,(we,N)=>{var ae=gr();let k;var $e=r(ae),Se=r($e,!0);l($e);var Ee=a($e,2);{var qe=Te=>{const te=rt(()=>e(N));var _e=fr(),Ge=r(_e);l(_e),M(()=>y(Ge,`Level ${U(e(te)),i(()=>e(te).level)??""} â€¢ ${U(e(te)),i(()=>e(te).school)??""}`)),v(Te,_e)},Xe=Te=>{const te=rt(()=>e(N));var _e=nt(),Ge=We(_e);{var ze=w=>{var q=br(),u=r(q,!0);l(q),M(()=>y(u,(U(e(te)),i(()=>e(te).prerequisite)))),v(w,q)};C(Ge,w=>{U(e(te)),i(()=>e(te).prerequisite)&&w(ze)})}v(Te,_e)};C(Ee,Te=>{e(L)==="spell"?Te(qe):Te(Xe,!1)})}l(ae),M(()=>{k=dt(ae,1,"item-card svelte-1ngjemu",null,k,{selected:e(G)?.name===e(N).name}),y(Se,(e(N),i(()=>e(N).name)))}),A("click",ae,()=>Re(e(N))),v(we,ae)}),v(Y,me)};C(Je,Y=>{e(h),i(()=>e(h).length===0)?Y(Qe):Y(Ze,!1)})}l(Pe);var H=a(Pe,2);{var F=Y=>{var me=xr(),Ne=r(me);{var we=ae=>{const k=rt(()=>e(G));var $e=_r(),Se=We($e),Ee=r(Se,!0);l(Se);var qe=a(Se,2),Xe=r(qe);{var Te=pe=>{var ke=ft();M(()=>y(ke,`${U(e(k)),i(()=>e(k).school)??""} cantrip`)),v(pe,ke)},te=pe=>{var ke=ft();M(()=>y(ke,`Level ${U(e(k)),i(()=>e(k).level)??""} ${U(e(k)),i(()=>e(k).school)??""}`)),v(pe,ke)};C(Xe,pe=>{U(e(k)),i(()=>e(k).level===0)?pe(Te):pe(te,!1)})}var _e=a(Xe,2);{var Ge=pe=>{var ke=ft("(ritual)");v(pe,ke)};C(_e,pe=>{U(e(k)),i(()=>e(k).ritual)&&pe(Ge)})}l(qe);var ze=a(qe,2),w=a(r(ze));l(ze);var q=a(ze,2),u=r(q),D=a(r(u));l(u);var T=a(u,2),I=a(r(T));l(T);var m=a(T,2),ne=a(r(m)),je=a(ne);{var ye=pe=>{var ke=ft();M(()=>y(ke,`(${U(e(k)),i(()=>e(k).material)??""})`)),v(pe,ke)};C(je,pe=>{U(e(k)),i(()=>e(k).material)&&pe(ye)})}l(m);var Me=a(m,2),p=a(r(Me),2);{var W=pe=>{var ke=ft("Concentration,");v(pe,ke)};C(p,pe=>{U(e(k)),i(()=>e(k).concentration)&&pe(W)})}var S=a(p,1,!0);l(Me),l(q);var xe=a(q,2),Be=r(xe,!0);l(xe);var Ve=a(xe,2);{var He=pe=>{var ke=hr(),It=a(r(ke));l(ke),M(()=>y(It,` ${U(e(k)),i(()=>e(k).higherLevelSlot)??""}`)),v(pe,ke)};C(Ve,pe=>{U(e(k)),i(()=>e(k).higherLevelSlot)&&pe(He)})}var Ue=a(Ve,2);{var Fe=pe=>{var ke=mr(),It=a(r(ke));l(ke),M(()=>y(It,` ${U(e(k)),i(()=>e(k).cantripUpgrade)??""}`)),v(pe,ke)};C(Ue,pe=>{U(e(k)),i(()=>e(k).cantripUpgrade)&&pe(Fe)})}M((pe,ke)=>{y(Ee,(U(e(k)),i(()=>e(k).name))),y(w,` ${pe??""}`),y(D,` ${U(e(k)),i(()=>e(k).castingTime||e(k).actionType)??""}`),y(I,` ${U(e(k)),i(()=>e(k).range)??""}`),y(ne,` ${ke??""}`),y(S,(U(e(k)),i(()=>e(k).duration))),y(Be,(U(e(k)),i(()=>e(k).description)))},[()=>(U(e(k)),i(()=>e(k).classes.join(", "))),()=>(U(e(k)),i(()=>e(k).components.join(", ").toUpperCase()))]),v(ae,$e)},N=ae=>{const k=rt(()=>e(G));var $e=kr(),Se=We($e),Ee=r(Se,!0);l(Se);var qe=a(Se,2);{var Xe=Ge=>{var ze=yr(),w=a(r(ze));l(ze),M(()=>y(w,` ${U(e(k)),i(()=>e(k).prerequisite)??""}`)),v(Ge,ze)};C(qe,Ge=>{U(e(k)),i(()=>e(k).prerequisite)&&Ge(Xe)})}var Te=a(qe,2),te=r(Te,!0);l(Te);var _e=a(Te,2);M(()=>{y(Ee,(U(e(k)),i(()=>e(k).name))),y(te,(U(e(k)),i(()=>e(k).description))),at(_e,"href",(U(e(k)),i(()=>e(k).source)))}),v(ae,$e)};C(Ne,ae=>{e(L)==="spell"?ae(we):ae(N,!1)})}l(me),v(Y,me)};C(H,Y=>{e(G)&&Y(F)})}l(g),M(()=>{d=dt(b,1,"tab svelte-1ngjemu",null,d,{active:e(L)==="spell"}),y(j,`ðŸ“œ Spells (${e(re),i(()=>e(re).length)??""})`),V=dt(J,1,"tab svelte-1ngjemu",null,V,{active:e(L)==="feat"}),y(Q,`â­ Feats (${e(K),i(()=>e(K).length)??""})`)}),A("click",b,()=>{o(L,"spell"),o(G,null),o(_,"")}),A("click",J,()=>{o(L,"feat"),o(G,null),o(_,"")}),Ae(ue,()=>e(_),Y=>o(_,Y)),v($,le)};C(z,$=>{e(B)?$(O):$(se,!1)})}l(oe);var ce=a(oe,2),Z=r(ce),Ie=a(Z,2);l(ce),l(E),l(Le),M(()=>Ie.disabled=!e(G)),A("click",de,function(...$){x()?.apply(this,$)}),A("click",Z,function(...$){x()?.apply(this,$)}),A("click",Ie,ve),A("click",E,La(function($){Bt.call(this,n,$)})),A("keydown",E,function($){Bt.call(this,n,$)}),A("click",Le,function(...$){x()?.apply(this,$)}),A("keydown",Le,$=>$.key==="Escape"&&x()()),v(s,Le),xt()}var Lr=f('<link rel="icon" type="image/png" href="favicon4.png"/> <meta name="viewport" content="width=device-width, initial-scale=1"/>',1),Dr=f('<span class="character-name svelte-1uha8ag"> </span>'),wr=f("<span> </span>"),jr=f('<div class="spell-slots-header svelte-1uha8ag"></div>'),Fr=f('<div class="rest-menu svelte-1uha8ag"><button class="rest-option svelte-1uha8ag">â˜• Short Rest</button> <button class="rest-option svelte-1uha8ag">ðŸ›ï¸ Long Rest</button></div>'),Ar=f('<div class="container svelte-1uha8ag"><header class="svelte-1uha8ag"><div class="header-top svelte-1uha8ag"><div class="header-title svelte-1uha8ag"><div class="title-row svelte-1uha8ag"><h1 class="svelte-1uha8ag">D&D Character Sheet</h1> <!></div> <!></div> <div class="header-right svelte-1uha8ag"><div class="header-controls svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">ðŸŽ²</span><span class="btn-text svelte-1uha8ag">Roll Dice</span></button> <div class="rest-button-container svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">ðŸ˜´</span><span class="btn-text svelte-1uha8ag">Rest</span></button> <!></div> <div class="mode-toggle"><button><span class="btn-icon svelte-1uha8ag"> </span><span class="btn-text svelte-1uha8ag"> </span></button></div></div> <div class="header-search svelte-1uha8ag"><input type="text" placeholder="ðŸ” Search..." class="search-input use-enabled svelte-1uha8ag"/></div></div></div> <div class="header-actions svelte-1uha8ag"><button class="btn btn-mode svelte-1uha8ag">ðŸ“š Browse Spells & Feats</button> <button class="btn btn-secondary">Save to Gist</button> <button class="btn btn-secondary">Load from Gist</button> <button class="btn btn-secondary">Export JSON</button> <button class="btn btn-secondary">Import JSON</button> <input type="file" accept=".json" style="display: none;"/></div></header> <main class="svelte-1uha8ag"><!> <!> <!> <!> <!> <!> <!></main></div> <!> <!> <!> <!>',1);function Br(s,n){kt(n,!1);const t=()=>Ke(X,"$character",x),c=()=>Ke(la,"$isEditMode",x),h=()=>Ke(Rt,"$searchFilter",x),[x,L]=Lt();function B(){const p=[],W=t().classFeatures.spellSlotsByLevel||{};for(let S=1;S<=9;S++){const xe=W[S];if(xe&&xe.length>0){const Be=xe.length,Ve=xe.filter(He=>He).length;p.push({level:S,available:Be-Ve,total:Be})}}return p}let _=R(!1),P=R(!1),re=R(!1),K=R("save"),G=R(void 0),Re=R(""),ie=R(""),fe=R(""),ve=R(!1),Le=R(),E=!1,be=R(!1);function de(){const p=[];X.update(S=>{const xe=S.hitDice.current;S.hitDice.current=Math.min(S.hitDice.max,S.hitDice.current+Math.max(1,Math.floor(S.hitDice.max/2)));const Be=S.hitDice.current-xe;if(Be>0&&p.push(`${Be} hit ${Be===1?"die":"dice"}`),S.class){const Ve=Nt(S.class,S.level,S.subclass);S.classFeatures.features||(S.classFeatures.features={}),Ve.forEach(He=>{if(He.resetOn==="short"){const Ue=He.name.replace(/\s+/g,"");if(He.type==="uses"){const Fe=typeof He.maxUses=="function"?He.maxUses(S.level):He.maxUses;S.classFeatures.features[Ue]=Array(Fe).fill(!1),p.push(He.name)}else if(He.type==="pool"){const Fe=typeof He.maxPool=="function"?He.maxPool(S.level):He.maxPool;Fe!==void 0&&(S.classFeatures.features[Ue]=Fe,p.push(He.name))}}})}return S}),o(be,!1);const W=p.length>0?`Short rest taken! Restored: ${p.join(", ")}`:"Short rest taken!";Jt.add(W,"success")}function oe(){const p=[];X.update(S=>{const xe=S.maxHP-S.currentHP;xe>0&&p.push(`${xe} HP`),S.currentHP=S.maxHP,S.tempHP=0;const Be=S.hitDice.max-S.hitDice.current;Be>0&&p.push(`${Be} hit ${Be===1?"die":"dice"}`),S.hitDice.current=S.hitDice.max;let Ve=0;if(S.classFeatures.spellSlotsByLevel&&Object.keys(S.classFeatures.spellSlotsByLevel).forEach(He=>{const Ue=S.classFeatures.spellSlotsByLevel[parseInt(He)];if(Ue){const Fe=Ue.filter(pe=>pe).length;Ve+=Fe,S.classFeatures.spellSlotsByLevel[parseInt(He)]=Array(Ue.length).fill(!1)}}),Ve>0&&p.push(`${Ve} spell ${Ve===1?"slot":"slots"}`),S.class){const He=Nt(S.class,S.level,S.subclass);S.classFeatures.features||(S.classFeatures.features={});let Ue=!1;He.forEach(Fe=>{const pe=Fe.name.replace(/\s+/g,"");if(!(Fe.type==="info"||Fe.type==="channelDivinity")){if(Fe.type==="uses"){const ke=typeof Fe.maxUses=="function"?Fe.maxUses(S.level):Fe.maxUses;S.classFeatures.features[pe]=Array(ke).fill(!1),Ue=!0}else if(Fe.type==="pool"){const ke=typeof Fe.maxPool=="function"?Fe.maxPool(S.level):Fe.maxPool;ke!==void 0&&(S.classFeatures.features[pe]=ke,Ue=!0)}}}),Ue&&p.push("all class features")}return S}),o(be,!1);const W=p.length>0?`Long rest taken! Restored: ${p.join(", ")}`:"Long rest taken! Fully rested.";Jt.add(W,"success")}function z(p){o(Re,""),o(ie,""),o(fe,""),o(ve,!1),E=!1,typeof p=="string"?o(Re,p):(o(Re,p.notation),o(ie,p.damageNotation||""),o(fe,p.attackName||""),o(ve,!!p.applyHalfDamage)),o(_,!0)}function O(p){const{notation:W}=p.detail;o(Re,""),E=!0,setTimeout(()=>{o(Re,W),o(ie,""),o(fe,"Hit Die")},0),o(_,!0)}function se(){if(o(_,!1),E&&e(Le)){const p=e(Le).getLastRollTotal();if(p!==null){const W=Math.max(1,p);X.update(S=>(S.hitDice.current=Math.max(0,S.hitDice.current-1),S.currentHP=Math.min(S.maxHP,S.currentHP+W),S))}E=!1}}function ce(){console.log("toggleMode called, current isEditMode:",c()),la.update(p=>(console.log("Updating isEditMode from",p,"to",!p),!p))}function Z(p){p.target.closest(".rest-button-container")||o(be,!1)}Qt(()=>{console.log("onMount - initial isEditMode:",c()),console.log("onMount - body classes:",document.body.className);const p=la.subscribe(W=>{console.log("isEditMode subscription triggered, value:",W),console.log("Body classes before:",document.body.className),W?(document.body.classList.remove("use-mode"),console.log("Removed use-mode class (Edit Mode)")):(document.body.classList.add("use-mode"),console.log("Added use-mode class (Use Mode)")),console.log("Body classes after:",document.body.className)});return document.addEventListener("click",Z),()=>{p(),document.removeEventListener("click",Z)}});function Ie(){rs(t())}function $(){e(G)?.click()}async function le(p){const S=p.target.files?.[0];if(S)try{const xe=await is(S);X.set(xe),alert("Character imported successfully!")}catch{alert("Failed to import character file")}}yt();var ee=Ar();ss("1uha8ag",p=>{var W=Lr();Ua(2),Pa(()=>{as.title="D&D Character Sheet"}),v(p,W)});var ge=We(ee),b=r(ge),d=r(b),j=r(d),J=r(j),V=a(r(J),2);{var Q=p=>{var W=Dr(),S=r(W,!0);l(W),M(()=>y(S,t().name)),v(p,W)};C(V,p=>{t().name&&p(Q)})}l(J);var he=a(J,2);{var ue=p=>{var W=jr();vt(W,5,B,bt,(S,xe)=>{var Be=wr();let Ve;var He=r(Be);l(Be),M(()=>{Ve=dt(Be,1,"slot-badge svelte-1uha8ag",null,Ve,{depleted:e(xe).available===0}),y(He,`Lv${e(xe).level??""}: ${e(xe).available??""}/${e(xe).total??""}`)}),v(S,Be)}),l(W),v(p,W)};C(he,p=>{B().length>0&&p(ue)})}l(j);var Oe=a(j,2),De=r(Oe),g=r(De),Pe=a(g,2),Je=r(Pe),Qe=a(Je,2);{var Ze=p=>{var W=Fr(),S=r(W),xe=a(S,2);l(W),A("click",S,de),A("click",xe,oe),v(p,W)};C(Qe,p=>{e(be)&&p(Ze)})}l(Pe);var H=a(Pe,2),F=r(H);let Y;var me=r(F),Ne=r(me,!0);l(me);var we=a(me),N=r(we,!0);l(we),l(F),l(H),l(De);var ae=a(De,2),k=r(ae);Ce(k),l(ae),l(Oe),l(d);var $e=a(d,2),Se=r($e),Ee=a(Se,2),qe=a(Ee,2),Xe=a(qe,2),Te=a(Xe,2),te=a(Te,2);_a(te,p=>o(G,p),()=>e(G)),l($e),l(b);var _e=a(b,2),Ge=r(_e);xs(Ge,{});var ze=a(Ge,2);As(ze,{$$events:{rollHitDice:O}});var w=a(ze,2);Ls(w,{$$events:{roll:p=>z(p.detail)}});var q=a(w,2);Ps(q,{$$events:{roll:p=>z(p.detail)}});var u=a(q,2);dl(u,{$$events:{roll:p=>z(p.detail)}});var D=a(u,2);wl(D,{});var T=a(D,2);Al(T,{}),l(_e),l(ge);var I=a(ge,2);_a(Ol(I,{get notation(){return e(Re)},get damageNotation(){return e(ie)},get attackName(){return e(fe)},get applyHalfDamage(){return e(ve)},get visible(){return e(_)},$$events:{close:se},$$legacy:!0}),p=>o(Le,p),()=>e(Le));var m=a(I,2);{var ne=p=>{cr(p,{get mode(){return e(K)},$$events:{close:()=>o(P,!1)}})};C(m,p=>{e(P)&&p(ne)})}var je=a(m,2);{var ye=p=>{Cr(p,{onClose:()=>o(re,!1)})};C(je,p=>{e(re)&&p(ye)})}var Me=a(je,2);ls(Me,{}),M(()=>{Y=dt(F,1,"btn btn-mode svelte-1uha8ag",null,Y,{"use-mode":!c()}),y(Ne,c()?"ðŸ“":"ðŸŽ²"),y(N,c()?"Edit Mode":"Use Mode")}),A("click",g,()=>o(_,!0)),A("click",Je,()=>o(be,!e(be))),A("click",F,ce),Ae(k,h,p=>ns(Rt,p)),A("click",Se,()=>o(re,!0)),A("click",Ee,()=>{o(K,"save"),o(P,!0)}),A("click",qe,()=>{o(K,"load"),o(P,!0)}),A("click",Xe,Ie),A("click",Te,$),A("change",te,le),v(s,ee),xt(),L()}export{Br as component};
