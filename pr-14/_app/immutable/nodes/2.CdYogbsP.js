import{f as h,e as F,a as o,s as y,c as nt,t as ft}from"../chunks/BmKkCgmR.js";import{i as xt}from"../chunks/AFJ5q3G2.js";import{c as Gt,o as Qt}from"../chunks/BwhX61NF.js";import{a6 as La,i as Da,b1 as Ua,b2 as Ba,b3 as ma,J as Rt,e as wa,b4 as ja,aa as Na,b as i,r as Fa,R as Ra,g as Ga,B as kt,b5 as Ze,b6 as jt,E as P,F as $t,s as r,a3 as I,G as l,I as t,H as s,d as e,C as ze,k as Ye,z as A,b7 as Ct,b8 as Kt,b9 as Aa,an as Ia,ba as Oa}from"../chunks/CmcvLP-Y.js";import{s as it,c as Y,a as gt,r as xe,e as dt,i as bt,b as _a,u as Pa,d as At,f as ut,g as ia,j as aa,k as qa,t as Jt,h as za,T as Wa,l as Ka,m as Ja}from"../chunks/BH0g7pxY.js";import{i as $,s as Lt,a as Je,b as at,d as Va}from"../chunks/BibxXT0t.js";import{p as Ut,b as ba}from"../chunks/BNYf2NzH.js";import{b as Wt,r as Qa}from"../chunks/CV0WLlNm.js";function sa(n,u,a=!1){if(n.multiple){if(u==null)return;if(!Da(u))return Ua();for(var v of n.options)v.selected=u.includes(Vt(v));return}for(v of n.options){var k=Vt(v);if(Ba(k,u)){v.selected=!0;return}}(!a||u!==void 0)&&(n.selectedIndex=-1)}function ga(n){var u=new MutationObserver(()=>{sa(n,n.__value)});u.observe(n,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),La(()=>{u.disconnect()})}function Ma(n,u,a=u){var v=new WeakSet,k=!0;ma(n,"change",S=>{var w=S?"[selected]":":checked",N;if(n.multiple)N=[].map.call(n.querySelectorAll(w),Vt);else{var g=n.querySelector(w)??n.querySelector("option:not([disabled])");N=g&&Vt(g)}a(N),Rt!==null&&v.add(Rt)}),wa(()=>{var S=u();if(n===document.activeElement){var w=ja??Rt;if(v.has(w))return}if(sa(n,S,k),k&&S===void 0){var N=n.querySelector(":checked");N!==null&&(S=Vt(N),a(S))}n.__value=S,k=!1}),ga(n)}function Vt(n){return"__value"in n?n.__value:n.value}function Pe(n,u,a=u){var v=new WeakSet;ma(n,"input",async k=>{var S=k?n.defaultValue:n.value;if(S=ua(n)?pa(S):S,a(S),Rt!==null&&v.add(Rt),await Na(),S!==(S=u())){var w=n.selectionStart,N=n.selectionEnd,g=n.value.length;if(n.value=S??"",N!==null){var O=n.value.length;w===N&&N===g&&O>g?(n.selectionStart=O,n.selectionEnd=O):(n.selectionStart=w,n.selectionEnd=Math.min(N,O))}}}),(Ra&&n.defaultValue!==n.value||i(u)==null&&n.value)&&(a(ua(n)?pa(n.value):n.value),Rt!==null&&v.add(Rt)),Fa(()=>{var k=u();if(n===document.activeElement){var S=ja??Rt;if(v.has(S))return}ua(n)&&k===pa(n.value)||n.type==="date"&&!k&&!n.value||k!==n.value&&(n.value=k??"")})}function la(n,u,a=u){ma(n,"change",v=>{var k=v?n.defaultChecked:n.checked;a(k)}),(Ra&&n.defaultChecked!==n.checked||i(u)==null)&&a(n.checked),Fa(()=>{var v=u();n.checked=!!v})}function ua(n){var u=n.type;return u==="number"||u==="range"}function pa(n){return n===""?null:+n}function Xa(n,u,a){var v=Ga(n,u);v&&v.set&&(n[u]=a,La(()=>{n[u]=null}))}function ya(n){return function(...u){var a=u[0];return a.stopPropagation(),n?.apply(this,u)}}function Bt(n,u){var a=n.$$events?.[u.type],v=Da(a)?a.slice():a==null?[]:[a];for(var k of v)k.call(this,u)}const Ya="";function Ea(...n){return Wt+Ya+Qa(n[0],n[1])}const ha={paladin:{name:"Paladin",hitDice:"d10",spellcaster:!0,spellcastingAbility:"charisma",spellSlotsByLevel:{1:0,2:2,3:3,4:3,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Divine Sense",type:"uses",maxUses:(n,u=1)=>1+Math.max(1,u),resetOn:"long",description:"Detect celestials, fiends, and undead within 60 feet",minLevel:1},{name:"Lay on Hands",type:"pool",maxPool:n=>n*5,resetOn:"long",description:"Heal wounds or cure disease",minLevel:1},{name:"Divine Smite",type:"spellSlot",description:"Expend spell slot to deal extra radiant damage",minLevel:2,rollable:!0},{name:"Channel Divinity",type:"pool",maxPool:n=>n>=18?3:n>=6?2:1,resetOn:"short",description:"Sacred Weapon or Turn Undead",minLevel:3}]},fighter:{name:"Fighter",hitDice:"d10",spellcaster:!1,features:[{name:"Second Wind",type:"uses",maxUses:1,resetOn:"short",description:"Regain 1d10 + fighter level HP as bonus action",minLevel:1,rollable:!0,rollFormula:n=>`1d10+${n}`},{name:"Action Surge",type:"uses",maxUses:n=>n>=17?2:1,resetOn:"short",description:"Take one additional action on your turn",minLevel:2},{name:"Indomitable",type:"uses",maxUses:n=>n>=17?3:n>=13?2:1,resetOn:"long",description:"Reroll a failed saving throw",minLevel:9}],subclasses:{champion:{name:"Champion",features:[{name:"Improved Critical",type:"info",description:"Critical hit on 19-20",minLevel:3},{name:"Remarkable Athlete",type:"info",description:"Add half proficiency to STR/DEX/CON checks, increase long jump distance",minLevel:7},{name:"Additional Fighting Style",type:"info",description:"Choose a second fighting style",minLevel:10},{name:"Superior Critical",type:"info",description:"Critical hit on 18-20",minLevel:15},{name:"Survivor",type:"info",description:"Regain 5 + CON mod HP at start of turn if below half HP",minLevel:18}]},battlemaster:{name:"Battle Master",features:[{name:"Combat Superiority",type:"uses",maxUses:n=>n>=15?6:n>=7?5:4,resetOn:"short",description:n=>`Use superiority dice (${n>=18?"d12":n>=10?"d10":"d8"}) for maneuvers`,minLevel:3},{name:"Know Your Enemy",type:"info",description:"Learn capabilities of creatures you observe",minLevel:7},{name:"Improved Combat Superiority",type:"info",description:"Superiority dice become d10",minLevel:10},{name:"Relentless",type:"info",description:"Regain 1 superiority die if you have none at start of turn",minLevel:15}]}}},rogue:{name:"Rogue",hitDice:"d8",spellcaster:!1,features:[{name:"Sneak Attack",type:"info",description:n=>`Deal ${Math.ceil(n/2)}d6 extra damage once per turn with advantage or ally nearby`,minLevel:1,rollable:!0,rollFormula:n=>`${Math.ceil(n/2)}d6`},{name:"Cunning Action",type:"info",description:"Dash, Disengage, or Hide as a bonus action",minLevel:2},{name:"Uncanny Dodge",type:"info",description:"Use reaction to halve damage from an attack",minLevel:5},{name:"Evasion",type:"info",description:"Take no damage on successful Dex save (half on fail)",minLevel:7}]},wizard:{name:"Wizard",hitDice:"d6",spellcaster:!0,spellcastingAbility:"intelligence",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Arcane Recovery",type:"uses",maxUses:1,resetOn:"long",description:n=>`Recover spell slots totaling up to ${Math.ceil(n/2)} levels during short rest`,minLevel:1},{name:"Spell Mastery",type:"info",description:"Cast one 1st-level and one 2nd-level spell at will",minLevel:18}]},cleric:{name:"Cleric",hitDice:"d8",spellcaster:!0,spellcastingAbility:"wisdom",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Channel Divinity",type:"pool",maxPool:n=>n>=18?3:n>=6?2:1,resetOn:"short",description:"Turn Undead or domain-specific ability",minLevel:2},{name:"Destroy Undead",type:"info",description:n=>`Channel Divinity destroys undead of CR ${n>=17?4:n>=14?3:n>=11?2:n>=8?1:.5} or lower`,minLevel:5},{name:"Divine Intervention",type:"uses",maxUses:1,resetOn:"long",description:n=>`${n}% chance to succeed, implore deity for aid`,minLevel:10}],subclasses:{war:{name:"War Domain",features:[{name:"War Priest",type:"uses",maxUses:(n,u=1)=>Math.max(1,u),resetOn:"long",description:"Make one weapon attack as a bonus action",minLevel:1},{name:"Guided Strike",type:"channelDivinity",description:"Use your Channel Divinity to gain +10 to an attack roll. Make this choice after you see the roll, but before the DM says whether the attack hits or misses.",minLevel:2,resetOn:"short"},{name:"War God's Blessing",type:"channelDivinity",description:"Use reaction to grant +10 to an ally's attack roll within 30 feet. Consumes one use of Channel Divinity.",minLevel:6,resetOn:"short"},{name:"Divine Strike",type:"info",description:n=>`Deal extra ${n>=14?"2d8":"1d8"} weapon damage once per turn`,minLevel:8,rollable:!0,rollFormula:n=>n>=14?"2d8":"1d8"},{name:"Avatar of Battle",type:"info",description:"Gain resistance to nonmagical weapon damage",minLevel:17}]},life:{name:"Life Domain",features:[{name:"Disciple of Life",type:"info",description:"Healing spells restore additional 2 + spell level HP",minLevel:1},{name:"Preserve Life",type:"pool",maxPool:n=>n*5,resetOn:"short",description:"Restore HP to creatures within 30 feet",minLevel:2},{name:"Blessed Healer",type:"info",description:"Regain 2 + spell level HP when you cast healing spell",minLevel:6},{name:"Divine Strike",type:"info",description:n=>`Deal extra ${n>=14?"2d8":"1d8"} radiant damage once per turn`,minLevel:8,rollable:!0,rollFormula:n=>n>=14?"2d8":"1d8"},{name:"Supreme Healing",type:"info",description:"Maximize healing dice instead of rolling",minLevel:17}]}}},barbarian:{name:"Barbarian",hitDice:"d12",spellcaster:!1,features:[{name:"Rage",type:"uses",maxUses:n=>n>=20?1/0:n>=17?6:n>=12?5:n>=6?4:n>=3?3:2,resetOn:"long",description:n=>`+${n>=16?4:n>=9?3:2} damage, resistance to physical damage`,minLevel:1},{name:"Reckless Attack",type:"info",description:"Gain advantage on melee attacks, enemies get advantage on you",minLevel:2},{name:"Danger Sense",type:"info",description:"Advantage on Dex saves against effects you can see",minLevel:2}],subclasses:{berserker:{name:"Path of the Berserker",features:[{name:"Frenzy",type:"info",description:"While raging, make melee attack as bonus action (gain 1 exhaustion after rage)",minLevel:3},{name:"Mindless Rage",type:"info",description:"Cannot be charmed or frightened while raging",minLevel:6},{name:"Intimidating Presence",type:"info",description:"Use action to frighten creature within 30 feet",minLevel:10},{name:"Retaliation",type:"info",description:"When damaged by creature within 5 feet, make melee attack as reaction",minLevel:14}]}}}};function yt(n){const u=n.toLowerCase();return ha[u]||null}function Nt(n,u,a){const v=yt(n);if(!v)return[];const k=v.features.filter(S=>!S.minLevel||S.minLevel<=u);if(a&&v.subclasses&&v.subclasses[a]){const S=v.subclasses[a].features.filter(w=>!w.minLevel||w.minLevel<=u);return[...k,...S]}return k}function xa(n){const u=yt(n);return!u||!u.subclasses?[]:Object.keys(u.subclasses).map(a=>({id:a,name:u.subclasses[a].name}))}function ka(n,u){const a=yt(n);return!a||!a.spellcaster||!a.spellSlotsByLevel?0:a.spellSlotsByLevel[u]||0}function $a(n,u,a){const v=yt(n);return!v||!v.spellcaster?0:Math.max(1,a+u)}function Za(n,u,a){const v=yt(n);return!v||!v.spellcaster?null:8+u+a}function es(){return Object.keys(ha).map(n=>({id:n,name:ha[n].name}))}var ts=h("<option> </option>"),as=h("<option> </option>"),ss=h('<div class="form-group svelte-172i2fj"><label for="characterSubclass" class="svelte-172i2fj">Subclass</label> <select id="characterSubclass" class="svelte-172i2fj"><option>Select Subclass</option><!></select></div>'),ls=h('<div class="info-grid svelte-172i2fj"><div class="form-group svelte-172i2fj"><label for="characterName" class="svelte-172i2fj">Character Name</label> <input type="text" id="characterName" placeholder="Enter name" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterClass" class="svelte-172i2fj">Class</label> <select id="characterClass" class="svelte-172i2fj"><option>Select Class</option><!></select></div> <!> <div class="form-group svelte-172i2fj"><label for="characterLevel" class="svelte-172i2fj">Level</label> <input type="number" id="characterLevel" min="1" max="20" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterRace" class="svelte-172i2fj">Race</label> <input type="text" id="characterRace" placeholder="e.g., Human" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterBackground" class="svelte-172i2fj">Background</label> <input type="text" id="characterBackground" placeholder="e.g., Soldier" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterAlignment" class="svelte-172i2fj">Alignment</label> <input type="text" id="characterAlignment" placeholder="e.g., Lawful Good" class="svelte-172i2fj"/></div></div>'),is=h('<section class="character-info svelte-172i2fj"><div class="header svelte-172i2fj"><h2 class="svelte-172i2fj">Character Info</h2> <button class="collapse-btn svelte-172i2fj"> </button></div> <!></section>');function ns(n,u){kt(u,!1);const a=()=>Je(Y,"$character",k),v=()=>Je(gt,"$collapsedStates",k),[k,S]=Lt(),w=I(),N=es();function g(ae){const ce=ae.target;Y.update(fe=>(fe.class=ce.value,fe.subclass="",fe))}function O(ae){const ce=ae.target;Y.update(fe=>(fe.subclass=ce.value,fe))}function oe(ae){const ce=ae.target;Y.update(fe=>(fe.level=parseInt(ce.value)||1,fe)),Pa()}function E(){gt.update(ae=>({...ae,characterInfo:!ae.characterInfo}))}Ze(()=>(a(),xa),()=>{r(w,a().class?xa(a().class):[])}),jt(),xt();var J=is(),ge=l(J),re=t(l(ge),2),ke=l(re,!0);s(re),s(ge);var he=t(ge,2);{var B=ae=>{var ce=ls(),fe=l(ce),z=t(l(fe),2);xe(z),s(fe);var W=t(fe,2),T=t(l(W),2),se=l(T);se.value=se.__value="";var te=t(se);dt(te,1,()=>N,bt,(pe,$e)=>{var be=ts(),Fe=l(be,!0);s(be);var b={};P(()=>{y(Fe,(e($e),i(()=>e($e).name))),b!==(b=(e($e),i(()=>e($e).id)))&&(be.value=(be.__value=(e($e),i(()=>e($e).id)))??"")}),o(pe,be)}),s(T);var le;ga(T),s(W);var Me=t(W,2);{var C=pe=>{var $e=ss(),be=t(l($e),2),Fe=l(be);Fe.value=Fe.__value="";var b=t(Fe);dt(b,1,()=>e(w),bt,(Ue,We)=>{var Ke=as(),et=l(Ke,!0);s(Ke);var m={};P(()=>{y(et,(e(We),i(()=>e(We).name))),m!==(m=(e(We),i(()=>e(We).id)))&&(Ke.value=(Ke.__value=(e(We),i(()=>e(We).id)))??"")}),o(Ue,Ke)}),s(be);var Ee;ga(be),s($e),P(()=>{Ee!==(Ee=(a(),i(()=>a().subclass)))&&(be.value=(be.__value=(a(),i(()=>a().subclass)))??"",sa(be,(a(),i(()=>a().subclass))))}),F("change",be,O),o(pe,$e)};$(Me,pe=>{e(w),i(()=>e(w).length>0)&&pe(C)})}var Z=t(Me,2),ie=t(l(Z),2);xe(ie),s(Z);var _=t(Z,2),c=t(l(_),2);xe(c),s(_);var R=t(_,2),ve=t(l(R),2);xe(ve),s(R);var G=t(R,2),ue=t(l(G),2);xe(ue),s(G),s(ce),P(()=>{le!==(le=(a(),i(()=>a().class)))&&(T.value=(T.__value=(a(),i(()=>a().class)))??"",sa(T,(a(),i(()=>a().class)))),_a(ie,(a(),i(()=>a().level)))}),Pe(z,()=>a().name,pe=>at(Y,i(a).name=pe,i(a))),F("change",T,g),F("change",ie,oe),Pe(c,()=>a().race,pe=>at(Y,i(a).race=pe,i(a))),Pe(ve,()=>a().background,pe=>at(Y,i(a).background=pe,i(a))),Pe(ue,()=>a().alignment,pe=>at(Y,i(a).alignment=pe,i(a))),o(ae,ce)};$(he,ae=>{v(),i(()=>!v().characterInfo)&&ae(B)})}s(J),P(()=>{it(re,"aria-label",(v(),i(()=>v().characterInfo?"Expand":"Collapse"))),y(ke,(v(),i(()=>v().characterInfo?"â–¼":"â–²")))}),F("click",re,E),o(n,J),$t(),S()}var rs=h('<div class="ability-card svelte-bbv1xt"><h3 class="svelte-bbv1xt"> </h3> <input type="number" class="ability-score svelte-bbv1xt" min="1" max="30"/> <div class="ability-modifier svelte-bbv1xt"> </div> <button class="roll-btn svelte-bbv1xt">Check</button> <div class="save-row svelte-bbv1xt"><input type="checkbox" class="svelte-bbv1xt"/> <label class="svelte-bbv1xt">Save</label> <button class="roll-btn-small svelte-bbv1xt">Roll</button></div></div>'),os=h('<div class="proficiency-bonus svelte-bbv1xt"><label for="profBonus">Proficiency Bonus</label> <input type="number" id="profBonus" class="prof-input svelte-bbv1xt"/></div> <div class="abilities-grid svelte-bbv1xt"></div>',1),cs=h('<section><div class="header svelte-bbv1xt"><h2 class="svelte-bbv1xt">Ability Scores</h2> <button class="collapse-btn svelte-bbv1xt"> </button></div> <!></section>');function vs(n,u){kt(u,!1);const a=()=>Je(ia,"$abilityModifiers",w),v=()=>Je(Y,"$character",w),k=()=>Je(At,"$searchFilter",w),S=()=>Je(gt,"$collapsedStates",w),[w,N]=Lt(),g=I(),O=I(),oe=Gt(),E=[{key:"strength",label:"Strength"},{key:"dexterity",label:"Dexterity"},{key:"constitution",label:"Constitution"},{key:"intelligence",label:"Intelligence"},{key:"wisdom",label:"Wisdom"},{key:"charisma",label:"Charisma"}];function J(){Pa()}function ge(T){const se=a()[T],te=`1d20${se>=0?"+":""}${se}`;oe("roll",te)}function re(T){const se=a()[T],te=v().saveProficiencies[T]?v().proficiencyBonus:0,le=se+te,Me=`1d20${le>=0?"+":""}${le}`;oe("roll",Me)}function ke(){gt.update(T=>({...T,abilityScores:!T.abilityScores}))}Ze(()=>k(),()=>{r(g,E.filter(({label:T})=>k()?T.toLowerCase().includes(k().toLowerCase()):!0))}),Ze(()=>(e(g),k()),()=>{r(O,e(g).length>0||!k()||k().toLowerCase().includes("proficiency"))}),jt(),xt();var he=cs();let B;var ae=l(he),ce=t(l(ae),2),fe=l(ce,!0);s(ce),s(ae);var z=t(ae,2);{var W=T=>{var se=os(),te=ze(se),le=t(l(te),2);xe(le),s(te);var Me=t(te,2);dt(Me,5,()=>e(g),bt,(C,Z)=>{let ie=()=>e(Z).key,_=()=>e(Z).label;var c=rs(),R=l(c),ve=l(R,!0);s(R);var G=t(R,2);xe(G);var ue=t(G,2),pe=l(ue);s(ue);var $e=t(ue,2),be=t($e,2),Fe=l(be);xe(Fe);var b=t(Fe,2),Ee=t(b,2);s(be),s(c),P(Ue=>{y(ve,Ue),y(pe,`${a(),ie(),i(()=>a()[ie()]>=0?"+":"")??""}${a(),ie(),i(()=>a()[ie()])??""}`),it(Fe,"id",`${ie()}-save`),it(b,"for",`${ie()}-save`)},[()=>(_(),i(()=>_().substring(0,3).toUpperCase()))]),Pe(G,()=>v().abilities[ie()],Ue=>at(Y,i(v).abilities[ie()]=Ue,i(v))),F("change",G,J),F("click",$e,()=>ge(ie())),la(Fe,()=>v().saveProficiencies[ie()],Ue=>at(Y,i(v).saveProficiencies[ie()]=Ue,i(v))),F("click",Ee,()=>re(ie())),o(C,c)}),s(Me),Pe(le,()=>v().proficiencyBonus,C=>at(Y,i(v).proficiencyBonus=C,i(v))),o(T,se)};$(z,T=>{S(),i(()=>!S().abilityScores)&&T(W)})}s(he),P(()=>{B=ut(he,1,"ability-scores svelte-bbv1xt",null,B,{hidden:!e(O)}),it(ce,"aria-label",(S(),i(()=>S().abilityScores?"Expand":"Collapse"))),y(fe,(S(),i(()=>S().abilityScores?"â–¼":"â–²")))}),F("click",ce,ke),o(n,he),$t(),N()}var ds=h('<div class="stat-box svelte-1r5hyyb"><label for="spellSaveDC" class="svelte-1r5hyyb">Spell Save DC</label> <input type="number" id="spellSaveDC" class="stat-input svelte-1r5hyyb" readonly="" title="8 + Proficiency Bonus + Spellcasting Ability Modifier"/></div>'),us=h('<span class="hit-dice-type"> </span>'),ps=h('<div class="stats-grid svelte-1r5hyyb"><div class="stat-box svelte-1r5hyyb"><label for="armorClass" class="svelte-1r5hyyb">Armor Class</label> <input type="number" id="armorClass" class="stat-input svelte-1r5hyyb"/></div> <div class="stat-box svelte-1r5hyyb"><label for="initiative" class="svelte-1r5hyyb">Initiative</label> <input type="number" id="initiative" class="stat-input svelte-1r5hyyb"/></div> <div class="stat-box svelte-1r5hyyb"><label for="speed" class="svelte-1r5hyyb">Speed</label> <input type="text" id="speed" class="stat-input svelte-1r5hyyb"/></div> <!></div> <div class="hp-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Points</h3> <div class="hp-display svelte-1r5hyyb"><div class="hp-inputs svelte-1r5hyyb"><input type="number" class="hp-current svelte-1r5hyyb" min="0"/> <span class="hp-separator svelte-1r5hyyb">/</span> <input type="number" class="hp-max svelte-1r5hyyb" min="0"/></div> <div class="hp-controls svelte-1r5hyyb"><button class="hp-btn svelte-1r5hyyb">âˆ’</button> <button class="hp-btn svelte-1r5hyyb">+</button> <button class="hp-btn svelte-1r5hyyb">âˆ’5</button> <button class="hp-btn svelte-1r5hyyb">+5</button></div></div> <div class="temp-hp svelte-1r5hyyb"><label for="tempHP" class="svelte-1r5hyyb">Temp HP</label> <input type="number" id="tempHP" min="0" class="svelte-1r5hyyb"/></div></div> <div class="hit-dice-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Dice</h3> <div class="hit-dice-display svelte-1r5hyyb"><input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <span>/</span> <input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <!></div> <div class="hit-dice-controls"><label for="hitDiceCount" class="svelte-1r5hyyb">Roll</label> <input type="number" id="hitDiceCount" class="hit-dice-count-input svelte-1r5hyyb" min="1" value="1"/> <button class="btn btn-primary roll-hit-dice use-enabled svelte-1r5hyyb">ðŸŽ² Roll</button></div></div>',1),fs=h('<section><div class="header svelte-1r5hyyb"><h2 class="svelte-1r5hyyb">Combat Stats</h2> <button class="collapse-btn svelte-1r5hyyb"> </button></div> <!></section>');function bs(n,u){kt(u,!1);const a=()=>Je(Y,"$character",w),v=()=>Je(ia,"$abilityModifiers",w),k=()=>Je(At,"$searchFilter",w),S=()=>Je(gt,"$collapsedStates",w),[w,N]=Lt(),g=I(),O=I(),oe=Gt();function E(z){Y.update(W=>(W.currentHP=Math.max(0,Math.min(W.maxHP,W.currentHP+z)),W))}function J(z=1){if(a().hitDice.current<=0){alert("No hit dice remaining!");return}if(!a().class){alert("Please select a class first!");return}const W=yt(a().class);if(!W){alert("Invalid class configuration!");return}const T=Math.min(z,a().hitDice.current),se=W.hitDice,te=v().constitution,le=te>=0?`+${te}`:`${te}`,Me=`${T}${se}${le}`;oe("rollHitDice",{notation:Me,hitDie:se,count:T})}function ge(){gt.update(z=>({...z,combatStats:!z.combatStats}))}Ze(()=>(a(),v()),()=>{r(g,(()=>{if(!a().class)return null;const z=yt(a().class);if(!z||!z.spellcaster||!z.spellcastingAbility)return null;const W=v()[z.spellcastingAbility];return 8+a().proficiencyBonus+W})())}),Ze(()=>k(),()=>{r(O,!k()||"armor class".includes(k().toLowerCase())||"initiative".includes(k().toLowerCase())||"speed".includes(k().toLowerCase())||"hit points".includes(k().toLowerCase())||"hp".includes(k().toLowerCase())||"hit dice".includes(k().toLowerCase())||"spell save".includes(k().toLowerCase())||"combat".includes(k().toLowerCase()))}),jt(),xt();var re=fs();let ke;var he=l(re),B=t(l(he),2),ae=l(B,!0);s(B),s(he);var ce=t(he,2);{var fe=z=>{var W=ps(),T=ze(W),se=l(T),te=t(l(se),2);xe(te),s(se);var le=t(se,2),Me=t(l(le),2);xe(Me),s(le);var C=t(le,2),Z=t(l(C),2);xe(Z),s(C);var ie=t(C,2);{var _=U=>{var X=ds(),x=t(l(X),2);xe(x),s(X),P(()=>_a(x,e(g))),o(U,X)};$(ie,U=>{e(g)!==null&&U(_)})}s(T);var c=t(T,2),R=t(l(c),2),ve=l(R),G=l(ve);xe(G);var ue=t(G,4);xe(ue),s(ve);var pe=t(ve,2),$e=l(pe),be=t($e,2),Fe=t(be,2),b=t(Fe,2);s(pe),s(R);var Ee=t(R,2),Ue=t(l(Ee),2);xe(Ue),s(Ee),s(c);var We=t(c,2),Ke=t(l(We),2),et=l(Ke);xe(et);var m=t(et,4);xe(m);var V=t(m,2);{var Q=U=>{const X=Ye(()=>(A(yt),a(),i(()=>yt(a().class))));var x=nt(),Ce=ze(x);{var me=He=>{const Ne=Ye(()=>(v(),i(()=>v().constitution)));var Qe=us(),Le=l(Qe);s(Qe),P(()=>y(Le,`(${A(e(X)),i(()=>e(X).hitDice)??""}${(e(Ne)>=0?`+${e(Ne)}`:e(Ne))??""})`)),o(He,Qe)};$(Ce,He=>{e(X)&&He(me)})}o(U,x)};$(V,U=>{a(),i(()=>a().class)&&U(Q)})}s(Ke);var Se=t(Ke,2),Be=t(l(Se),2),Te=t(Be,2);s(Se),s(We),P(()=>{it(G,"max",(a(),i(()=>a().maxHP))),it(et,"max",(a(),i(()=>a().hitDice.max))),it(Be,"max",(a(),i(()=>a().hitDice.current))),Te.disabled=(a(),i(()=>a().hitDice.current<=0||!a().class))}),Pe(te,()=>a().armorClass,U=>at(Y,i(a).armorClass=U,i(a))),Pe(Me,()=>a().initiative,U=>at(Y,i(a).initiative=U,i(a))),Pe(Z,()=>a().speed,U=>at(Y,i(a).speed=U,i(a))),Pe(G,()=>a().currentHP,U=>at(Y,i(a).currentHP=U,i(a))),Pe(ue,()=>a().maxHP,U=>at(Y,i(a).maxHP=U,i(a))),F("click",$e,()=>E(-1)),F("click",be,()=>E(1)),F("click",Fe,()=>E(-5)),F("click",b,()=>E(5)),Pe(Ue,()=>a().tempHP,U=>at(Y,i(a).tempHP=U,i(a))),Pe(et,()=>a().hitDice.current,U=>at(Y,i(a).hitDice.current=U,i(a))),Pe(m,()=>a().hitDice.max,U=>at(Y,i(a).hitDice.max=U,i(a))),F("input",Be,U=>{const X=U.target,x=parseInt(X.value);x>a().hitDice.current&&(X.value=String(a().hitDice.current)),x<1&&(X.value="1")}),F("click",Te,()=>{const U=document.getElementById("hitDiceCount"),X=parseInt(U?.value||"1");J(X)}),o(z,W)};$(ce,z=>{S(),i(()=>!S().combatStats)&&z(fe)})}s(re),P(()=>{ke=ut(re,1,"combat-stats svelte-1r5hyyb",null,ke,{hidden:!e(O)}),it(B,"aria-label",(S(),i(()=>S().combatStats?"Expand":"Collapse"))),y(ae,(S(),i(()=>S().combatStats?"â–¼":"â–²")))}),F("click",B,ge),o(n,re),$t(),N()}const fa={acrobatics:"dexterity",animalHandling:"wisdom",arcana:"intelligence",athletics:"strength",deception:"charisma",history:"intelligence",insight:"wisdom",intimidation:"charisma",investigation:"intelligence",medicine:"wisdom",nature:"intelligence",perception:"wisdom",performance:"charisma",persuasion:"charisma",religion:"intelligence",sleightOfHand:"dexterity",stealth:"dexterity",survival:"wisdom"};var gs=h('<div class="skill-row svelte-1f1pl16"><input type="checkbox" class="svelte-1f1pl16"/> <label class="svelte-1f1pl16"> <span class="ability-tag svelte-1f1pl16"> </span></label> <span class="skill-modifier svelte-1f1pl16"> </span> <button class="roll-btn svelte-1f1pl16">Roll</button></div>'),hs=h('<div class="skills-grid svelte-1f1pl16"></div>'),ms=h('<section><div class="header svelte-1f1pl16"><h2 class="svelte-1f1pl16">Skills</h2> <button class="collapse-btn svelte-1f1pl16"> </button></div> <!></section>');function _s(n,u){kt(u,!1);const a=()=>Je(ia,"$abilityModifiers",w),v=()=>Je(Y,"$character",w),k=()=>Je(At,"$searchFilter",w),S=()=>Je(gt,"$collapsedStates",w),[w,N]=Lt(),g=I(),O=I(),oe=Gt(),E=[{key:"acrobatics",label:"Acrobatics"},{key:"animalHandling",label:"Animal Handling"},{key:"arcana",label:"Arcana"},{key:"athletics",label:"Athletics"},{key:"deception",label:"Deception"},{key:"history",label:"History"},{key:"insight",label:"Insight"},{key:"intimidation",label:"Intimidation"},{key:"investigation",label:"Investigation"},{key:"medicine",label:"Medicine"},{key:"nature",label:"Nature"},{key:"perception",label:"Perception"},{key:"performance",label:"Performance"},{key:"persuasion",label:"Persuasion"},{key:"religion",label:"Religion"},{key:"sleightOfHand",label:"Sleight of Hand"},{key:"stealth",label:"Stealth"},{key:"survival",label:"Survival"}];function J(W){const T=fa[W],se=a()[T],te=v().skillProficiencies[W]?v().proficiencyBonus:0;return se+te}function ge(W){const T=J(W),se=`1d20${T>=0?"+":""}${T}`;oe("roll",se)}function re(){gt.update(W=>({...W,skills:!W.skills}))}Ze(()=>k(),()=>{r(g,E.filter(({label:W})=>k()?W.toLowerCase().includes(k().toLowerCase()):!0))}),Ze(()=>e(g),()=>{r(O,e(g).length>0)}),jt(),xt();var ke=ms();let he;var B=l(ke),ae=t(l(B),2),ce=l(ae,!0);s(ae),s(B);var fe=t(B,2);{var z=W=>{var T=hs();dt(T,5,()=>e(g),bt,(se,te)=>{let le=()=>e(te).key,Me=()=>e(te).label;const C=Ye(()=>(A(fa),le(),i(()=>fa[le()]))),Z=Ye(()=>(le(),i(()=>J(le()))));var ie=gs(),_=l(ie);xe(_);var c=t(_,2),R=l(c),ve=t(R),G=l(ve);s(ve),s(c);var ue=t(c,2),pe=l(ue);s(ue);var $e=t(ue,2);s(ie),P(be=>{it(_,"id",le()),it(c,"for",le()),y(R,`${Me()??""} `),y(G,`(${be??""})`),y(pe,`${e(Z)>=0?"+":""}${e(Z)??""}`)},[()=>(A(e(C)),i(()=>e(C).substring(0,3).toUpperCase()))]),la(_,()=>v().skillProficiencies[le()],be=>at(Y,i(v).skillProficiencies[le()]=be,i(v))),F("click",$e,()=>ge(le())),o(se,ie)}),s(T),o(W,T)};$(fe,W=>{S(),i(()=>!S().skills)&&W(z)})}s(ke),P(()=>{he=ut(ke,1,"skills svelte-1f1pl16",null,he,{hidden:!e(O)}),it(ae,"aria-label",(S(),i(()=>S().skills?"Expand":"Collapse"))),y(ce,(S(),i(()=>S().skills?"â–¼":"â–²")))}),F("click",ae,re),o(n,ke),$t(),N()}let ea=null,ta=null;async function Ha(){if(ea)return ea;try{return ea=await(await fetch(Ea("/data/spells.json"))).json(),ea||[]}catch(n){return console.error("Failed to load spells:",n),[]}}async function ys(){if(ta)return ta;try{return ta=await(await fetch(Ea("/data/feats.json"))).json(),ta||[]}catch(n){return console.error("Failed to load feats:",n),[]}}function Sa(n,u){if(!u.trim())return n;const a=u.toLowerCase();return n.filter(v=>v.name.toLowerCase().includes(a)||v.school.toLowerCase().includes(a)||v.classes.some(k=>k.toLowerCase().includes(a))||v.description.toLowerCase().includes(a))}function xs(n,u){return u===null?n:n.filter(a=>a.level===u)}function ks(n,u){if(!u.trim())return n;const a=u.toLowerCase();return n.filter(v=>v.name.toLowerCase().includes(a)||v.description.toLowerCase().includes(a))}function Ft(n){const u=n.description,a=/\b(Strength|Dexterity|Constitution|Intelligence|Wisdom|Charisma)\s+saving\s+throw/i,v=u.match(a);if(!v)return null;const k=v[1].toLowerCase(),w=/half\s+(?:as\s+much\s+)?damage\s+on\s+a\s+successful(?:\s+save)?/i.test(u),g=/saving\s+throw\s+or\s+take.*?damage/i.test(u)&&!w;return{ability:k,halfDamageOnSave:w,noDamageOnSave:g}}var $s=h('<button class="btn-remove svelte-14o91c5">Ã—</button>'),Ss=h('<div class="spell-info-loading svelte-14o91c5">Loading spell info...</div>'),Cs=h('<div class="spell-notes svelte-14o91c5"><h4 class="svelte-14o91c5">General Notes</h4> <p> </p></div>'),Ls=h('<li class="svelte-14o91c5"><strong>At Higher Levels:</strong> </li>'),Ds=h('<ul class="svelte-14o91c5"><li class="svelte-14o91c5"><strong>Level:</strong> </li> <li class="svelte-14o91c5"><strong>Casting Time:</strong> </li> <li class="svelte-14o91c5"><strong>Range:</strong> </li> <li class="svelte-14o91c5"><strong>Components:</strong> <!></li> <li class="svelte-14o91c5"><strong>Duration:</strong> <!> </li> <li class="svelte-14o91c5"><strong>Description:</strong> </li> <!></ul>'),ws=h("<option> </option>"),js=h('<span class="scaled-damage svelte-14o91c5"><!> </span>'),Fs=h('<span class="scaled-damage svelte-14o91c5"> </span>'),Rs=h('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> Target is Fiend or Undead <!></label></div>'),As=h('<span class="scaled-damage svelte-14o91c5">(Half damage)</span>'),Is=h('<span class="scaled-damage svelte-14o91c5">(No damage)</span>'),Ps=h('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> <!></label></div>'),Ms=h('<div class="spell-level-selector svelte-14o91c5"><label class="svelte-14o91c5">Cast at Level:</label> <select class="spell-level-select use-enabled svelte-14o91c5"></select> <!></div> <!> <!>',1),Es=h('<div class="spell-level-selector svelte-14o91c5"><span style="color: #dc3545; font-weight: bold;">No spell slots available!</span></div>'),Hs=h('<!> <div class="spell-info svelte-14o91c5"><div class="spell-info-header svelte-14o91c5" role="button" tabindex="0"><h4 class="svelte-14o91c5">Spell Info</h4> <button class="collapse-btn-small svelte-14o91c5"> </button></div> <!></div> <!>',1),Ts=h('<div class="spell-info-missing svelte-14o91c5">Spell info not found.</div>'),Us=h('<div class="attack-notes svelte-14o91c5"><label class="svelte-14o91c5">Notes</label> <textarea placeholder="e.g., DC 15 Dex save, Range 120 ft, Concentration" class="notes-input svelte-14o91c5" rows="2"></textarea></div>'),Bs=h('<button class="btn btn-primary">Roll Attack</button>'),Ns=h('<button class="btn btn-secondary"><!></button>'),Gs=h('<button class="btn btn-secondary">Roll Damage</button>'),Os=h('<div class="attack-card svelte-14o91c5"><div class="attack-header svelte-14o91c5"><input type="text" placeholder="Attack name" class="attack-name svelte-14o91c5"/> <!></div> <div class="attack-details svelte-14o91c5"><div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Bonus</label> <input type="number" class="attack-bonus svelte-14o91c5"/></div> <div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Damage</label> <input type="text" placeholder="e.g., 2d6+3" class="attack-damage svelte-14o91c5"/></div> <div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Type</label> <input type="text" placeholder="e.g., slashing" class="attack-type svelte-14o91c5"/></div></div> <!> <!> <div class="attack-actions svelte-14o91c5"><!> <!></div></div>'),qs=h('<p class="no-attacks svelte-14o91c5">No attacks added yet. Click "Add Attack" to create one.</p>'),zs=h('<p class="no-attacks svelte-14o91c5">No attacks match your search.</p>'),Ws=h('<button class="btn btn-secondary">Add Attack</button> <div class="attacks-list svelte-14o91c5"><!> <!></div>',1),Ks=h('<section><div class="header svelte-14o91c5"><h2 class="svelte-14o91c5">Attacks & Spells</h2> <button class="collapse-btn svelte-14o91c5"> </button></div> <!></section>');function Js(n,u){kt(u,!1);const a=()=>Je(Y,"$character",w),v=()=>Je(At,"$searchFilter",w),k=()=>Je(gt,"$collapsedStates",w),S=()=>Je(aa,"$isEditMode",w),[w,N]=Lt(),g=I(),O=I(),oe=Gt();let E=I({});function J(c){Aa(E,e(E)[c]=!e(E)[c]),r(E,{...e(E)})}function ge(c){return c.description.toLowerCase().includes("regain")&&(c.description.toLowerCase().includes("hit point")||c.description.toLowerCase().includes("hp"))}function re(){Y.update(c=>(c.attacks=[...c.attacks,{id:crypto.randomUUID(),name:"",bonus:0,damage:"",damageType:"",notes:""}],c))}function ke(c){Y.update(R=>(R.attacks=R.attacks.filter(ve=>ve.id!==c),R))}function he(c){let R=c.damage;if(c.spellRef){const G=z(c.spellRef);if(G&&G.level>0){const ue=c.castAtLevel||G.level;if(!W(ue)){alert(`No level ${ue} spell slots available!`);return}const $e=Ft(G);if($e&&c.targetSucceededSave&&$e.noDamageOnSave)R="0";else{const be=$e?.halfDamageOnSave&&c.targetSucceededSave;R=T(c,G,be)}}}const ve=`1d20${c.bonus>=0?"+":""}${c.bonus}`;oe("roll",{notation:ve,damageNotation:R,attackName:c.name})}function B(c){if(!c.damage){alert(`${c.name}: No damage specified`);return}let R=c.damage;if(c.spellRef){const ve=z(c.spellRef);if(ve&&ve.level>0){const G=c.castAtLevel||ve.level;if(!W(G)){alert(`No level ${G} spell slots available!`);return}const pe=Ft(ve);if(pe&&c.targetSucceededSave&&pe.noDamageOnSave)R="0";else{const $e=pe?.halfDamageOnSave&&c.targetSucceededSave;R=T(c,ve,$e)}}}oe("roll",{notation:R,attackName:c.name})}function ae(){gt.update(c=>({...c,attacks:!c.attacks}))}let ce=I([]),fe=I(!1);Qt(async()=>{r(ce,await Ha()),r(fe,!0)});function z(c){return e(ce).find(R=>R.name===c)}function W(c){a().classFeatures.spellSlotsByLevel||at(Y,i(a).classFeatures.spellSlotsByLevel={},i(a)),a().classFeatures.spellSlotsByLevel[c]||at(Y,i(a).classFeatures.spellSlotsByLevel[c]=Array(2).fill(!1),i(a));const ve=a().classFeatures.spellSlotsByLevel[c].findIndex(G=>!G);return ve===-1?!1:(Y.update(G=>(G.classFeatures.spellSlotsByLevel||(G.classFeatures.spellSlotsByLevel={}),G.classFeatures.spellSlotsByLevel[c]||(G.classFeatures.spellSlotsByLevel[c]=Array(2).fill(!1)),G.classFeatures.spellSlotsByLevel[c][ve]=!0,G)),!0)}function T(c,R,ve=!1){let G=c.damage,ue=0;if(R.higherLevelSlot&&c.castAtLevel){const b=R.level,Ue=(c.castAtLevel||b)-b;if(Ue>0){const We=R.higherLevelSlot.match(/(\d+)d(\d+)\s+for\s+each.*?level\s+above/i);if(We){const[,Ke]=We;ue+=Ue*parseInt(Ke)}}}if(c.targetIsFiendOrUndead&&R.description.includes("Fiend or an Undead")){const b=R.description.match(/increases by (\d+)d(\d+) if.*?Fiend or.*?Undead/i);if(b){const[,Ee]=b;ue+=parseInt(Ee)}}const pe=G.match(/(\d+)d(\d+)/);if(!pe)return G;const[,$e,be]=pe,Fe=parseInt($e)+ue;return ve?`(${Fe}d${be})/2`:`${Fe}d${be}`}function se(c){const R=[];for(let G=c.level;G<=9;G++){const ue=a().classFeatures.spellSlotsByLevel?.[G];ue&&ue.length>0&&R.push(G)}return R}Ze(()=>(a(),v()),()=>{r(g,a().attacks.filter(c=>{if(!v())return!0;const R=v().toLowerCase();return c.name.toLowerCase().includes(R)||c.damageType.toLowerCase().includes(R)}).sort((c,R)=>!c.spellRef&&R.spellRef?-1:c.spellRef&&!R.spellRef?1:0))}),Ze(()=>(v(),e(g)),()=>{r(O,!v()||e(g).length>0||"attack".includes(v().toLowerCase())||"spell".includes(v().toLowerCase()))}),jt(),xt();var te=Ks();let le;var Me=l(te),C=t(l(Me),2),Z=l(C,!0);s(C),s(Me);var ie=t(Me,2);{var _=c=>{var R=Ws(),ve=ze(R),G=t(ve,2),ue=l(G);dt(ue,1,()=>e(g),Fe=>Fe.id,(Fe,b,Ee)=>{var Ue=Os(),We=l(Ue),Ke=l(We);xe(Ke);var et=t(Ke,2);{var m=M=>{var H=$s();F("click",H,()=>ke(e(b).id)),o(M,H)};$(et,M=>{S()&&M(m)})}s(We);var V=t(We,2),Q=l(V),Se=t(l(Q),2);xe(Se),s(Q);var Be=t(Q,2),Te=t(l(Be),2);xe(Te),s(Be);var U=t(Be,2),X=t(l(U),2);xe(X),s(U),s(V);var x=t(V,2);{var Ce=M=>{var H=nt(),d=ze(H);{var j=D=>{var f=Ss();o(D,f)},K=D=>{const f=Ye(()=>(e(b),i(()=>z(e(b).spellRef))));var de=nt(),we=ze(de);{var _e=p=>{var q=Hs(),L=ze(q);{var Re=tt=>{var st=Cs(),pt=t(l(st),2),It=l(pt,!0);s(pt),s(st),P(()=>y(It,(e(b),i(()=>e(b).generalNotes)))),o(tt,st)};$(L,tt=>{e(b),i(()=>e(b).generalNotes)&&tt(Re)})}var ye=t(L,2),qe=l(ye),Ae=t(l(qe),2),je=l(Ae,!0);s(Ae),s(qe);var Ie=t(qe,2);{var rt=tt=>{var st=Ds(),pt=l(st),It=t(l(pt));s(pt);var Ot=t(pt,2),ra=t(l(Ot));s(Ot);var St=t(Ot,2),_t=t(l(St));s(St);var Mt=t(St,2),Et=t(l(Mt)),Xt=t(Et);{var Pt=Ve=>{var lt=ft();P(()=>y(lt,`(${A(e(f)),i(()=>e(f).material)??""})`)),o(Ve,lt)};$(Xt,Ve=>{A(e(f)),i(()=>e(f).material)&&Ve(Pt)})}s(Mt);var qt=t(Mt,2),Yt=t(l(qt),2);{var Zt=Ve=>{var lt=ft("Concentration,");o(Ve,lt)};$(Yt,Ve=>{A(e(f)),i(()=>e(f).concentration)&&Ve(Zt)})}var oa=t(Yt,1,!0);s(qt);var zt=t(qt,2),ca=t(l(zt));s(zt);var ot=t(zt,2);{var ct=Ve=>{var lt=Ls(),ht=t(l(lt));s(lt),P(()=>y(ht,` ${A(e(f)),i(()=>e(f).higherLevelSlot)??""}`)),o(Ve,lt)};$(ot,Ve=>{A(e(f)),i(()=>e(f).higherLevelSlot)&&Ve(ct)})}s(st),P(Ve=>{y(It,` ${A(e(f)),i(()=>e(f).level)??""}`),y(ra,` ${A(e(f)),i(()=>e(f).castingTime||e(f).actionType)??""}`),y(_t,` ${A(e(f)),i(()=>e(f).range)??""}`),y(Et,` ${Ve??""}`),y(oa,(A(e(f)),i(()=>e(f).duration))),y(ca,` ${A(e(f)),i(()=>e(f).description)??""}`)},[()=>(A(e(f)),i(()=>e(f).components.join(", ")))]),o(tt,st)};$(Ie,tt=>{e(E),e(b),i(()=>!e(E)[e(b).id])&&tt(rt)})}s(ye);var ne=t(ye,2);{var Xe=tt=>{const st=Ye(()=>(A(e(f)),i(()=>se(e(f)))));var pt=nt(),It=ze(pt);{var Ot=St=>{const _t=Ye(()=>(A(Ft),A(e(f)),i(()=>Ft(e(f)))));var Mt=Ms(),Et=ze(Mt),Xt=l(Et),Pt=t(Xt,2);P(()=>{e(b),Ct(()=>{e(st)})}),dt(Pt,5,()=>e(st),bt,(ot,ct)=>{var Ve=ws(),lt=l(Ve);s(Ve);var ht={};P(()=>{y(lt,`Level ${e(ct)??""}`),ht!==(ht=e(ct))&&(Ve.value=(Ve.__value=e(ct))??"")}),o(ot,Ve)}),s(Pt);var qt=t(Pt,2);{var Yt=ot=>{const ct=Ye(()=>(A(Ft),A(e(f)),i(()=>Ft(e(f))))),Ve=Ye(()=>(A(e(ct)),e(b),i(()=>e(ct)?.halfDamageOnSave&&e(b).targetSucceededSave))),lt=Ye(()=>(e(b),A(e(f)),A(e(Ve)),i(()=>T(e(b),e(f),e(Ve)))));var ht=js(),Ht=l(ht);{var Dt=mt=>{var wt=ft("Healing");o(mt,wt)},Tt=mt=>{var wt=ft("Damage");o(mt,wt)};$(Ht,mt=>{A(e(f)),i(()=>ge(e(f)))?mt(Dt):mt(Tt,!1)})}var vt=t(Ht);s(ht),P(()=>y(vt,` ${e(lt)??""}`)),o(ot,ht)};$(qt,ot=>{e(b),A(e(f)),i(()=>e(b).castAtLevel&&e(b).castAtLevel>e(f).level)&&ot(Yt)})}s(Et);var Zt=t(Et,2);{var oa=ot=>{var ct=Rs(),Ve=l(ct),lt=l(Ve);xe(lt);var ht=t(lt,2);{var Ht=Dt=>{const Tt=Ye(()=>(A(Ft),A(e(f)),i(()=>Ft(e(f))))),vt=Ye(()=>(A(e(Tt)),e(b),i(()=>e(Tt)?.halfDamageOnSave&&e(b).targetSucceededSave))),mt=Ye(()=>(e(b),A(e(f)),A(e(vt)),i(()=>T(e(b),e(f),e(vt)))));var wt=Fs(),va=l(wt);s(wt),P(()=>y(va,`(+1d8, total: ${e(mt)??""})`)),o(Dt,wt)};$(ht,Dt=>{e(b),i(()=>e(b).targetIsFiendOrUndead)&&Dt(Ht)})}s(Ve),s(ct),la(lt,()=>e(b).targetIsFiendOrUndead,Dt=>(e(b).targetIsFiendOrUndead=Dt,Ct(()=>(e(g),a(),v())))),o(ot,ct)};$(Zt,ot=>{A(e(f)),i(()=>e(f).description.includes("Fiend or an Undead"))&&ot(oa)})}var zt=t(Zt,2);{var ca=ot=>{var ct=Ps(),Ve=l(ct),lt=l(Ve);xe(lt);var ht=t(lt),Ht=t(ht);{var Dt=vt=>{var mt=As();o(vt,mt)},Tt=vt=>{var mt=nt(),wt=ze(mt);{var va=da=>{var Ta=Is();o(da,Ta)};$(wt,da=>{e(b),A(e(_t)),i(()=>e(b).targetSucceededSave&&e(_t).noDamageOnSave)&&da(va)},!0)}o(vt,mt)};$(Ht,vt=>{e(b),A(e(_t)),i(()=>e(b).targetSucceededSave&&e(_t).halfDamageOnSave)?vt(Dt):vt(Tt,!1)})}s(Ve),s(ct),P(vt=>y(ht,` Target succeeded on ${vt??""} save `),[()=>(A(e(_t)),i(()=>e(_t).ability.charAt(0).toUpperCase()+e(_t).ability.slice(1)))]),la(lt,()=>e(b).targetSucceededSave,vt=>(e(b).targetSucceededSave=vt,Ct(()=>(e(g),a(),v())))),o(ot,ct)};$(zt,ot=>{e(_t)&&ot(ca)})}P(()=>{it(Xt,"for",`castLevel-${e(b),i(()=>e(b).id)??""}`),it(Pt,"id",`castLevel-${e(b),i(()=>e(b).id)??""}`)}),Ma(Pt,()=>e(b).castAtLevel,ot=>(e(b).castAtLevel=ot,Ct(()=>(e(g),a(),v())))),o(St,Mt)},ra=St=>{var _t=Es();o(St,_t)};$(It,St=>{A(e(st)),i(()=>e(st).length>0)?St(Ot):St(ra,!1)})}o(tt,pt)};$(ne,tt=>{A(e(f)),i(()=>e(f).higherLevelSlot&&e(f).level>0)&&tt(Xe)})}P(()=>{it(Ae,"aria-label",(e(E),e(b),i(()=>e(E)[e(b).id]?"Expand":"Collapse"))),y(je,(e(E),e(b),i(()=>e(E)[e(b).id]?"â–¼":"â–²")))}),F("click",qe,()=>J(e(b).id)),F("keydown",qe,tt=>tt.key==="Enter"&&J(e(b).id)),o(p,q)},Oe=p=>{var q=Ts();o(p,q)};$(we,p=>{e(f)?p(_e):p(Oe,!1)})}o(D,de)};$(d,D=>{e(ce),i(()=>e(ce).length===0)?D(j):D(K,!1)})}o(M,H)};$(x,M=>{e(b),i(()=>e(b).spellRef)&&M(Ce)})}var me=t(x,2);{var He=M=>{var H=Us(),d=t(l(H),2);Kt(d),s(H),Pe(d,()=>e(b).notes,j=>(e(b).notes=j,Ct(()=>(e(g),a(),v())))),o(M,H)};$(me,M=>{e(b),i(()=>!e(b).spellRef)&&M(He)})}var Ne=t(me,2),Qe=l(Ne);{var Le=M=>{var H=Bs();F("click",H,()=>he(e(b))),o(M,H)};$(Qe,M=>{e(b),i(()=>e(b).bonus!==0||!e(b).spellRef)&&M(Le)})}var ee=t(Qe,2);{var De=M=>{const H=Ye(()=>(e(b),i(()=>z(e(b).spellRef))));var d=Ns(),j=l(d);{var K=f=>{var de=ft("Roll Healing");o(f,de)},D=f=>{var de=ft("Roll Damage");o(f,de)};$(j,f=>{A(e(H)),i(()=>e(H)&&ge(e(H)))?f(K):f(D,!1)})}s(d),F("click",d,()=>B(e(b))),o(M,d)},Ge=M=>{var H=Gs();F("click",H,()=>B(e(b))),o(M,H)};$(ee,M=>{e(b),e(fe),i(()=>e(b).spellRef&&e(fe))?M(De):M(Ge,!1)})}s(Ne),s(Ue),Pe(Ke,()=>e(b).name,M=>(e(b).name=M,Ct(()=>(e(g),a(),v())))),Pe(Se,()=>e(b).bonus,M=>(e(b).bonus=M,Ct(()=>(e(g),a(),v())))),Pe(Te,()=>e(b).damage,M=>(e(b).damage=M,Ct(()=>(e(g),a(),v())))),Pe(X,()=>e(b).damageType,M=>(e(b).damageType=M,Ct(()=>(e(g),a(),v())))),o(Fe,Ue)});var pe=t(ue,2);{var $e=Fe=>{var b=qs();o(Fe,b)},be=Fe=>{var b=nt(),Ee=ze(b);{var Ue=We=>{var Ke=zs();o(We,Ke)};$(Ee,We=>{e(g),i(()=>e(g).length===0)&&We(Ue)},!0)}o(Fe,b)};$(pe,Fe=>{a(),i(()=>a().attacks.length===0)?Fe($e):Fe(be,!1)})}s(G),F("click",ve,re),o(c,R)};$(ie,c=>{k(),i(()=>!k().attacks)&&c(_)})}s(te),P(()=>{le=ut(te,1,"attacks svelte-14o91c5",null,le,{hidden:!e(O)}),it(C,"aria-label",(k(),i(()=>k().attacks?"Expand":"Collapse"))),y(Z,(k(),i(()=>k().attacks?"â–¼":"â–²")))}),F("click",C,ae),o(n,te),$t(),N()}var Vs=h('<p class="no-features svelte-1kpvv0n">Select a class to see available features</p>'),Qs=h('<p class="no-features svelte-1kpvv0n">No class features available at this level</p>'),Xs=h('<input type="checkbox" class="slot-checkbox svelte-1kpvv0n"/>'),Ys=h('<div class="spell-slots svelte-1kpvv0n"><label class="svelte-1kpvv0n"> </label> <div class="slots-tracker svelte-1kpvv0n"></div></div>'),Zs=h('<div class="all-spell-slots"></div>'),el=h('<div class="feature-box spellcasting svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"> </h3> <div class="spell-stats svelte-1kpvv0n"><div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Spell Save DC</label> <div class="spell-value svelte-1kpvv0n"> </div></div> <div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <div class="spell-value svelte-1kpvv0n"> </div></div></div> <!> <div class="prepared-spells svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <textarea placeholder="List your prepared spells..." class="svelte-1kpvv0n"></textarea></div></div>'),tl=h('<p class="unlimited svelte-1kpvv0n">Unlimited Uses</p>'),al=h('<p class="no-uses svelte-1kpvv0n">No uses remaining</p>'),sl=h('<div class="uses-with-button svelte-1kpvv0n"><button class="btn btn-primary use-enabled"> </button> <div class="uses-info svelte-1kpvv0n"><span class="uses-remaining svelte-1kpvv0n"> </span> <span class="reset-info svelte-1kpvv0n"> </span></div> <!></div>'),ll=h('<div class="uses-tracker svelte-1kpvv0n"><!></div>'),il=h('<div class="pool-tracker svelte-1kpvv0n"><input type="number" min="0" class="pool-input svelte-1kpvv0n"/> <span> </span> <button class="btn-small svelte-1kpvv0n"> </button></div>'),nl=h('<p class="no-uses svelte-1kpvv0n">No Channel Divinity uses remaining</p>'),rl=h('<div class="channel-divinity-option svelte-1kpvv0n"><button class="btn btn-primary use-enabled svelte-1kpvv0n">Use Channel Divinity</button> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div> <!></div>'),ol=h('<div class="feature-box svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"><!> </h3> <p class="feature-description svelte-1kpvv0n"> </p> <!></div>'),cl=h('<div class="features-grid svelte-1kpvv0n"><!> <!></div>'),vl=h('<section><div class="header svelte-1kpvv0n"><h2 class="svelte-1kpvv0n">Class Features</h2> <button class="collapse-btn svelte-1kpvv0n"> </button></div> <!></section>');function dl(n,u){kt(u,!1);const a=()=>Je(Y,"$character",w),v=()=>Je(ia,"$abilityModifiers",w),k=()=>Je(At,"$searchFilter",w),S=()=>Je(gt,"$collapsedStates",w),[w,N]=Lt(),g=I(),O=I(),oe=I(),E=I(),J=I(),ge=I(),re=I();let ke=I(0),he=I(0);function B(_,c){Y.update(R=>(R.classFeatures.features[_]=c,R))}function ae(){Y.update(_=>(_.classFeatures.spellSlotsByLevel||(_.classFeatures.spellSlotsByLevel={}),e(E).forEach(({level:c,slots:R})=>{_.classFeatures.spellSlotsByLevel[c]||(_.classFeatures.spellSlotsByLevel[c]=Array(R).fill(!1))}),_))}function ce(_){if(typeof _.maxUses=="function"){if((_.name==="Divine Sense"||_.name==="War Priest")&&e(g)?.spellcastingAbility){const c=v()[e(g).spellcastingAbility];return _.maxUses(a().level,c)}return _.maxUses(a().level)}return _.maxUses||0}function fe(_){return typeof _.maxPool=="function"?_.maxPool(a().level):_.maxPool||0}function z(_){return typeof _.description=="function"?_.description(a().level):_.description}function W(){const _="ChannelDivinity";Y.update(c=>{const R=c.classFeatures.features[_];return typeof R=="number"&&R>0&&(c.classFeatures.features[_]=R-1),c})}function T(){gt.update(_=>({..._,classFeatures:!_.classFeatures}))}Ze(()=>(a(),yt),()=>{r(g,a().class?yt(a().class):null)}),Ze(()=>(a(),Nt),()=>{r(O,a().class?Nt(a().class,a().level,a().subclass):[])}),Ze(()=>(a(),ka),()=>{r(oe,a().class?ka(a().class,a().level):0)}),Ze(()=>(e(g),a()),()=>{r(E,(()=>{if(!e(g)?.spellcaster)return[];const _=a().level,c=[];return _>=1&&c.push({level:1,slots:Math.min(4,2+Math.floor(_/3))}),_>=3&&c.push({level:2,slots:Math.min(3,2+Math.floor((_-3)/4))}),_>=5&&c.push({level:3,slots:Math.min(3,2+Math.floor((_-5)/5))}),_>=7&&c.push({level:4,slots:Math.min(3,1+Math.floor((_-7)/6))}),_>=9&&c.push({level:5,slots:Math.min(2,1+Math.floor((_-9)/8))}),_>=11&&c.push({level:6,slots:1}),_>=13&&c.push({level:7,slots:1}),_>=15&&c.push({level:8,slots:1}),_>=17&&c.push({level:9,slots:1}),c})())}),Ze(()=>(e(g),v(),a(),$a),()=>{if(e(g)?.spellcaster&&e(g).spellcastingAbility){const _=v()[e(g).spellcastingAbility];r(ke,Za(a().class,_,a().proficiencyBonus)||0),r(he,$a(a().class,a().level,_))}}),Ze(()=>(a(),e(g),e(E)),()=>{a().class&&e(g)?.spellcaster&&e(E).length>0&&ae()}),Ze(()=>a(),()=>{r(J,(()=>{const c=a().classFeatures.features["ChannelDivinity"];return typeof c=="number"?c:0})())}),Ze(()=>(e(O),k()),()=>{r(ge,e(O).filter(_=>{if(!k())return!0;const c=k().toLowerCase();return _.name.toLowerCase().includes(c)||z(_).toLowerCase().includes(c)}))}),Ze(()=>(k(),a(),e(ge)),()=>{r(re,!k()||a().class||"class features".includes(k().toLowerCase())||"spellcasting".includes(k().toLowerCase())||e(ge).length>0)}),jt(),xt();var se=vl();let te;var le=l(se),Me=t(l(le),2),C=l(Me,!0);s(Me),s(le);var Z=t(le,2);{var ie=_=>{var c=nt(),R=ze(c);{var ve=ue=>{var pe=Vs();o(ue,pe)},G=ue=>{var pe=nt(),$e=ze(pe);{var be=b=>{var Ee=Qs();o(b,Ee)},Fe=b=>{var Ee=cl(),Ue=l(Ee);{var We=et=>{var m=el(),V=l(m),Q=l(V);s(V);var Se=t(V,2),Be=l(Se),Te=t(l(Be),2),U=l(Te,!0);s(Te),s(Be);var X=t(Be,2),x=t(l(X),2),Ce=l(x,!0);s(x),s(X),s(Se);var me=t(Se,2);{var He=Le=>{var ee=Zs();dt(ee,5,()=>e(E),bt,(De,Ge)=>{let M=()=>e(Ge).level,H=()=>e(Ge).slots;const d=Ye(()=>(a(),M(),H(),i(()=>a().classFeatures.spellSlotsByLevel?.[M()]||Array(H()).fill(!1))));var j=Ys(),K=l(j),D=l(K);s(K);var f=t(K,2);dt(f,5,()=>(H(),i(()=>Array(H()))),bt,(de,we,_e)=>{var Oe=Xs();xe(Oe),P(()=>qa(Oe,(A(e(d)),i(()=>e(d)[_e]||!1)))),F("change",Oe,p=>{Y.update(q=>(q.classFeatures.spellSlotsByLevel||(q.classFeatures.spellSlotsByLevel={}),q.classFeatures.spellSlotsByLevel[M()]||(q.classFeatures.spellSlotsByLevel[M()]=Array(H()).fill(!1)),q.classFeatures.spellSlotsByLevel[M()][_e]=p.currentTarget.checked,q))}),o(de,Oe)}),s(f),s(j),P(()=>y(D,`${M()===1?"1st":M()===2?"2nd":M()===3?"3rd":`${M()}th`} Level Spell Slots`)),o(De,j)}),s(ee),o(Le,ee)};$(me,Le=>{e(E),i(()=>e(E).length>0)&&Le(He)})}var Ne=t(me,2),Qe=t(l(Ne),2);Kt(Qe),s(Ne),s(m),P(Le=>{y(Q,`Spellcasting (${Le??""})`),y(U,e(ke)),y(Ce,e(he))},[()=>(e(g),i(()=>e(g).spellcastingAbility?.toUpperCase()))]),Pe(Qe,()=>a().classFeatures.preparedSpells,Le=>at(Y,i(a).classFeatures.preparedSpells=Le,i(a))),o(et,m)};$(Ue,et=>{e(g),i(()=>e(g)?.spellcaster)&&et(We)})}var Ke=t(Ue,2);dt(Ke,1,()=>e(ge),bt,(et,m)=>{const V=Ye(()=>(e(m),i(()=>e(m).name.replace(/\s+/g,"")))),Q=Ye(()=>(a(),A(e(V)),i(()=>a().classFeatures.features[e(V)]))),Se=Ye(()=>(A(e(Q)),i(()=>Array.isArray(e(Q))))),Be=Ye(()=>typeof e(Q)=="number");var Te=ol(),U=l(Te),X=l(U);{var x=ee=>{var De=ft("Channel Divinity:");o(ee,De)};$(X,ee=>{e(m),i(()=>e(m).type==="channelDivinity")&&ee(x)})}var Ce=t(X);s(U);var me=t(U,2),He=l(me,!0);s(me);var Ne=t(me,2);{var Qe=ee=>{const De=Ye(()=>(e(m),i(()=>ce(e(m))))),Ge=Ye(()=>(A(e(Se)),A(e(De)),A(e(Q)),i(()=>e(Se)?e(Q).filter(D=>!D).length:e(De))));var M=ll(),H=l(M);{var d=K=>{var D=tl();o(K,D)},j=K=>{var D=sl(),f=l(D),de=l(f);s(f);var we=t(f,2),_e=l(we),Oe=l(_e);s(_e);var p=t(_e,2),q=l(p);s(p),s(we);var L=t(we,2);{var Re=ye=>{var qe=al();o(ye,qe)};$(L,ye=>{e(Ge)<=0&&ye(Re)})}s(D),P(()=>{f.disabled=e(Ge)<=0,y(de,`Use ${e(m),i(()=>e(m).name)??""}`),y(Oe,`${e(Ge)??""} / ${e(De)??""} uses`),y(q,`Resets on ${e(m),i(()=>e(m).resetOn==="short"?"Short Rest":"Long Rest")??""}`)}),F("click",f,()=>{Y.update(ye=>{ye.classFeatures.features[e(V)]||(ye.classFeatures.features[e(V)]=Array(e(De)).fill(!1));const qe=ye.classFeatures.features[e(V)],Ae=qe.findIndex(je=>!je);return Ae!==-1&&(qe[Ae]=!0),ye})}),o(K,D)};$(H,K=>{e(De)===1/0?K(d):K(j,!1)})}s(M),o(ee,M)},Le=ee=>{var De=nt(),Ge=ze(De);{var M=d=>{const j=Ye(()=>(e(m),i(()=>fe(e(m)))));var K=il(),D=l(K);xe(D);var f=t(D,2),de=l(f);s(f);var we=t(f,2),_e=l(we,!0);s(we),s(K),P(()=>{_a(D,e(Be)&&e(Q)!==void 0?e(Q):e(j)),it(D,"max",e(j)),y(de,`/ ${e(j)??""}`),y(_e,(e(m),i(()=>e(m).resetOn==="short"?"Short Rest":"Long Rest")))}),F("input",D,Oe=>{Y.update(p=>(p.classFeatures.features[e(V)]=parseInt(Oe.currentTarget.value)||0,p))}),F("click",we,()=>B(e(V),e(j))),o(d,K)},H=d=>{var j=nt(),K=ze(j);{var D=f=>{var de=rl(),we=l(de),_e=t(we,2),Oe=l(_e),p=l(Oe);s(Oe),s(_e);var q=t(_e,2);{var L=Re=>{var ye=nl();o(Re,ye)};$(q,Re=>{e(J)<=0&&Re(L)})}s(de),P(()=>{we.disabled=e(J)<=0,y(p,`Resets on ${e(m),i(()=>e(m).resetOn==="short"?"Short Rest":"Long Rest")??""}`)}),F("click",we,W),o(f,de)};$(K,f=>{e(m),i(()=>e(m).type==="channelDivinity")&&f(D)},!0)}o(d,j)};$(Ge,d=>{e(m),i(()=>e(m).type==="pool")?d(M):d(H,!1)},!0)}o(ee,De)};$(Ne,ee=>{e(m),i(()=>e(m).type==="uses")?ee(Qe):ee(Le,!1)})}s(Te),P(ee=>{y(Ce,` ${e(m),i(()=>e(m).name)??""}`),y(He,ee)},[()=>(e(m),i(()=>z(e(m))))]),o(et,Te)}),s(Ee),o(b,Ee)};$($e,b=>{e(O),i(()=>e(O).length===0)?b(be):b(Fe,!1)},!0)}o(ue,pe)};$(R,ue=>{a(),i(()=>!a().class)?ue(ve):ue(G,!1)})}o(_,c)};$(Z,_=>{S(),i(()=>!S().classFeatures)&&_(ie)})}s(se),P(()=>{te=ut(se,1,"class-features svelte-1kpvv0n",null,te,{hidden:!e(re)}),it(Me,"aria-label",(S(),i(()=>S().classFeatures?"Expand":"Collapse"))),y(C,(S(),i(()=>S().classFeatures?"â–¼":"â–²")))}),F("click",Me,T),o(n,se),$t(),N()}var ul=h('<textarea placeholder="Enter features, traits, and special abilities..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Equipment</h3> <textarea placeholder="List your equipment and inventory..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Notes</h3> <textarea placeholder="Additional notes..." class="svelte-wttn0l"></textarea>',1),pl=h('<section><div class="header svelte-wttn0l"><h2 class="svelte-wttn0l">Features & Traits</h2> <button class="collapse-btn svelte-wttn0l"> </button></div> <!></section>');function fl(n,u){kt(u,!1);const a=()=>Je(At,"$searchFilter",S),v=()=>Je(Y,"$character",S),k=()=>Je(gt,"$collapsedStates",S),[S,w]=Lt(),N=I();function g(){gt.update(he=>({...he,notes:!he.notes}))}Ze(()=>(a(),v()),()=>{r(N,!a()||"features".includes(a().toLowerCase())||"traits".includes(a().toLowerCase())||"equipment".includes(a().toLowerCase())||"notes".includes(a().toLowerCase())||v().features.toLowerCase().includes(a().toLowerCase())||v().equipment.toLowerCase().includes(a().toLowerCase())||v().notes.toLowerCase().includes(a().toLowerCase()))}),jt(),xt();var O=pl();let oe;var E=l(O),J=t(l(E),2),ge=l(J,!0);s(J),s(E);var re=t(E,2);{var ke=he=>{var B=ul(),ae=ze(B);Kt(ae);var ce=t(ae,4);Kt(ce);var fe=t(ce,4);Kt(fe),Pe(ae,()=>v().features,z=>at(Y,i(v).features=z,i(v))),Pe(ce,()=>v().equipment,z=>at(Y,i(v).equipment=z,i(v))),Pe(fe,()=>v().notes,z=>at(Y,i(v).notes=z,i(v))),o(he,B)};$(re,he=>{k(),i(()=>!k().notes)&&he(ke)})}s(O),P(()=>{oe=ut(O,1,"notes svelte-wttn0l",null,oe,{hidden:!e(N)}),it(J,"aria-label",(k(),i(()=>k().notes?"Expand":"Collapse"))),y(ge,(k(),i(()=>k().notes?"â–¼":"â–²")))}),F("click",J,g),o(n,O),$t(),w()}var bl=h('<div class="color-picker-section svelte-1r90jgp"><h3 class="svelte-1r90jgp">Dice Colors</h3> <div class="color-inputs svelte-1r90jgp"><div class="color-input-group svelte-1r90jgp"><label for="dice-color" class="svelte-1r90jgp">Dice Color</label> <input type="color" id="dice-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="label-color" class="svelte-1r90jgp">Label Color</label> <input type="color" id="label-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="desk-color" class="svelte-1r90jgp">Background Color</label> <input type="color" id="desk-color" class="svelte-1r90jgp"/></div></div></div>'),gl=h('<div class="loading svelte-1r90jgp"><p class="svelte-1r90jgp">Loading 3D dice...</p></div>'),hl=h('<div class="custom-dice-selector svelte-1r90jgp"><h3 class="svelte-1r90jgp">Choose Dice to Roll</h3> <div class="dice-inputs svelte-1r90jgp"><div class="dice-input-group svelte-1r90jgp"><label for="d4" class="svelte-1r90jgp">d4</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d4" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d6" class="svelte-1r90jgp">d6</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d6" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d8" class="svelte-1r90jgp">d8</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d8" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d10" class="svelte-1r90jgp">d10</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d10" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d12" class="svelte-1r90jgp">d12</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d12" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d20" class="svelte-1r90jgp">d20</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d20" min="0" max="10"/></div></div> <div class="dice-controls svelte-1r90jgp"><button class="btn btn-primary use-enabled svelte-1r90jgp"> </button> <button class="btn btn-secondary use-enabled svelte-1r90jgp">Reset</button></div></div>'),ml=h('<span class="crit-badge svelte-1r90jgp">CRITICAL!</span>'),_l=h('<p class="svelte-1r90jgp"> </p>'),yl=h('<p class="modifier-text svelte-1r90jgp"> </p>'),xl=h('<button class="btn btn-follow-up svelte-1r90jgp"> </button>'),kl=h('<button class="btn btn-guided-strike svelte-1r90jgp">âš¡ Use Guided Strike (+10)</button>'),$l=h('<div class="follow-up-actions svelte-1r90jgp"><!> <!></div>'),Sl=h('<div class="result-header svelte-1r90jgp"><h3 class="svelte-1r90jgp"> </h3> <!></div> <div class="result-total svelte-1r90jgp"> </div> <div class="result-details svelte-1r90jgp"><!> <!></div> <!>',1),Cl=h('<div role="button" tabindex="-1"><div class="modal-content svelte-1r90jgp" role="dialog" tabindex="0"><div class="modal-header svelte-1r90jgp"><h2 class="svelte-1r90jgp">Dice Roller</h2> <div class="header-buttons svelte-1r90jgp"><button class="color-btn svelte-1r90jgp" title="Customize dice colors">ðŸŽ¨</button> <button class="close-btn svelte-1r90jgp">Ã—</button></div></div> <!> <!> <div class="dice-main-area svelte-1r90jgp"><div class="dice-container svelte-1r90jgp"></div> <!></div> <div><!></div></div></div>');function Ll(n,u){kt(u,!1);const a=()=>Je(Y,"$character",v),[v,k]=Lt(),S=I(),w=I(),N=I(),g=Gt();let O=Ut(u,"notation",12,""),oe=Ut(u,"visible",8,!1),E=Ut(u,"damageNotation",12,""),J=Ut(u,"attackName",12,""),ge=null,re=I(void 0),ke=I(!1),he=I(""),B=I(null);function ae(){return e(B)?.resultTotal??null}let ce=I(0),fe=I(0),z=I(0),W=I(0),T=I(0),se=I(0),te=I(0),le=I([]),Me=I(!1),C=I("other"),Z=I(!1),ie=I("#051e0a"),_=I("#ffffff"),c=I("#3a2004"),R=I(!1);function ve(d){return d.length===9&&d.startsWith("#")?d.substring(0,7):d}function G(d,j="ff"){return d.length===7&&d.startsWith("#")?d+j:d}function ue(){if(window.DICE&&e(re))try{ge&&e(re)&&Aa(re,e(re).innerHTML="");const d=e(re).clientWidth||500,j=e(re).clientHeight||300;ge=new window.DICE.dice_box(e(re),{w:d,h:j}),r(ke,!0)}catch(d){console.error("Error initializing dice box:",d)}}Qt(()=>{const d=D=>new Promise((f,de)=>{if(document.querySelector(`script[src="${D}"]`)){console.log(`Script already loaded: ${D}`),f(null);return}const _e=document.createElement("script");_e.src=D,_e.onload=()=>{console.log(`Loaded: ${D}`),f(null)},_e.onerror=()=>{console.error(`Failed to load: ${D}`),de(new Error(`Failed to load ${D}`))},document.head.appendChild(_e)});setTimeout(()=>{d(`${Wt}/libs/three.min.js`).then(()=>d(`${Wt}/libs/cannon.min.js`)).then(()=>d(`${Wt}/libs/teal.js`)).then(()=>d(`${Wt}/dice.js`)).then(()=>{if(console.log("All scripts loaded, initializing dice box..."),console.log("DICE available:",!!window.DICE),console.log("Container available:",!!e(re)),window.DICE){const D=window.DICE.getColors();r(ie,ve(D.dice_color)),r(_,ve(D.label_color)),r(c,ve(D.desk_color))}ue()}).catch(D=>{console.error("Failed to load dice libraries:",D)})},100);const j=()=>{e(ke)&&(console.log("Window resized, reinitializing dice box..."),ue())},K=D=>{oe()&&D.key==="Escape"&&Ke()};return window.addEventListener("resize",j),window.addEventListener("keydown",K),()=>{window.removeEventListener("resize",j),window.removeEventListener("keydown",K)}});function pe(d,j="other"){if(!ge||!e(ke))return;console.log("Rolling dice:",d,"type:",j),r(C,j),r(Z,!1),ge.diceToRoll=d;const K=f=>(console.log("Before roll:",f),null),D=f=>{if(console.log("After roll:",f),console.log("Result:",f.resultTotal),r(B,f),j==="attack"||j==="check"||j==="save"){const de=f.results?.filter(we=>we.sides===20)||[];if(de.length>0){const we=de[0].value;r(Me,we===20)}}if(r(le,[]),j==="attack"&&E())if(e(Me)){const de=Fe(E());e(le).push({label:`Roll Critical Damage (${de})`,notation:de})}else e(le).push({label:`Roll Damage (${E()})`,notation:E()})};ge.start_throw(K,D)}function $e(){const d=[];e(ce)>0&&d.push(`${e(ce)}d4`),e(fe)>0&&d.push(`${e(fe)}d6`),e(z)>0&&d.push(`${e(z)}d8`),e(W)>0&&d.push(`${e(W)}d10`),e(T)>0&&d.push(`${e(T)}d12`),e(se)>0&&d.push(`${e(se)}d20`);let j=d.join("+")||"1d20";return e(te)!==0&&(j+=e(te)>=0?`+${e(te)}`:`${e(te)}`),j}function be(){const d=$e();pe(d)}function Fe(d){return d.replace(/(\d+)d(\d+)/g,(j,K,D)=>`${parseInt(K)*2}d${D}`)}function b(){r(ce,0),r(fe,0),r(z,0),r(W,0),r(T,0),r(se,0),r(te,0),r(B,null),r(le,[]),r(Me,!1),r(C,"other"),r(Z,!1)}function Ee(){window.DICE&&(window.DICE.setColors({dice_color:G(e(ie),"ff"),label_color:G(e(_),"ff"),desk_color:e(c)}),ge&&(ge.updateDeskColor(e(c)),ge.updateDiceColors()))}function Ue(){r(R,!e(R))}function We(){!e(B)||e(w)<=0||e(Z)||(r(B,{...e(B),resultTotal:e(B).resultTotal+10,resultString:e(B).resultString+" + 10 (Guided Strike)"}),Y.update(d=>{const j="ChannelDivinity",K=d.classFeatures.features[j];return typeof K=="number"&&K>0&&(d.classFeatures.features[j]=K-1),d}),r(Z,!0))}function Ke(){g("close"),O(""),E(""),J(""),r(he,""),r(B,null),r(Z,!1),b()}Ze(()=>(a(),Nt),()=>{r(S,a().class?Nt(a().class,a().level,a().subclass).some(j=>j.name==="Guided Strike"):!1)}),Ze(()=>a(),()=>{r(w,(()=>{const j=a().classFeatures.features["ChannelDivinity"];return typeof j=="number"?j:0})())}),Ze(()=>(e(ce),e(fe),e(z),e(W),e(T),e(se),e(te)),()=>{r(N,(()=>{const d=[];e(ce)>0&&d.push(`${e(ce)}d4`),e(fe)>0&&d.push(`${e(fe)}d6`),e(z)>0&&d.push(`${e(z)}d8`),e(W)>0&&d.push(`${e(W)}d10`),e(T)>0&&d.push(`${e(T)}d12`),e(se)>0&&d.push(`${e(se)}d20`);let j=d.join("+")||"1d20";return e(te)!==0&&(j+=e(te)>=0?`+${e(te)}`:`${e(te)}`),j})())}),Ze(()=>(A(O()),e(ke),A(oe()),e(he),A(E()),A(J())),()=>{if(O()&&e(ke)&&oe()&&O()!==e(he)){r(he,O()),r(B,null),r(le,[]),r(Me,!1),r(Z,!1);const d=O().includes("1d20")?"attack":"other";console.log("Auto-roll triggered. notation:",O(),"damageNotation:",E(),"attackName:",J()),setTimeout(()=>pe(O(),d),200)}}),jt();var et={getLastRollTotal:ae};xt();var m=Cl();let V;var Q=l(m),Se=l(Q),Be=t(l(Se),2),Te=l(Be),U=t(Te,2);s(Be),s(Se);var X=t(Se,2);{var x=d=>{var j=bl(),K=t(l(j),2),D=l(K),f=t(l(D),2);xe(f),s(D);var de=t(D,2),we=t(l(de),2);xe(we),s(de);var _e=t(de,2),Oe=t(l(_e),2);xe(Oe),s(_e),s(K),s(j),Pe(f,()=>e(ie),p=>r(ie,p)),F("change",f,Ee),Pe(we,()=>e(_),p=>r(_,p)),F("change",we,Ee),Pe(Oe,()=>e(c),p=>r(c,p)),F("change",Oe,Ee),o(d,j)};$(X,d=>{e(R)&&d(x)})}var Ce=t(X,2);{var me=d=>{var j=gl();o(d,j)};$(Ce,d=>{e(ke)||d(me)})}var He=t(Ce,2),Ne=l(He);ba(Ne,d=>r(re,d),()=>e(re));var Qe=t(Ne,2);{var Le=d=>{var j=hl(),K=t(l(j),2),D=l(K),f=t(l(D),2);xe(f),s(D);var de=t(D,2),we=t(l(de),2);xe(we),s(de);var _e=t(de,2),Oe=t(l(_e),2);xe(Oe),s(_e);var p=t(_e,2),q=t(l(p),2);xe(q),s(p);var L=t(p,2),Re=t(l(L),2);xe(Re),s(L);var ye=t(L,2),qe=t(l(ye),2);xe(qe),s(ye),s(K);var Ae=t(K,2),je=l(Ae),Ie=l(je);s(je);var rt=t(je,2);s(Ae),s(j),P(()=>{je.disabled=!e(ke),y(Ie,`Roll ${e(N)??""}`)}),Pe(f,()=>e(ce),ne=>r(ce,ne)),Pe(we,()=>e(fe),ne=>r(fe,ne)),Pe(Oe,()=>e(z),ne=>r(z,ne)),Pe(q,()=>e(W),ne=>r(W,ne)),Pe(Re,()=>e(T),ne=>r(T,ne)),Pe(qe,()=>e(se),ne=>r(se,ne)),F("click",je,be),F("click",rt,b),o(d,j)};$(Qe,d=>{O()||d(Le)})}s(He);var ee=t(He,2);let De;var Ge=l(ee);{var M=d=>{var j=Sl(),K=ze(j),D=l(K),f=l(D,!0);s(D);var de=t(D,2);{var we=je=>{var Ie=ml();o(je,Ie)};$(de,je=>{e(Me)&&je(we)})}s(K);var _e=t(K,2),Oe=l(_e,!0);s(_e);var p=t(_e,2),q=l(p);{var L=je=>{var Ie=_l(),rt=l(Ie,!0);s(Ie),P(()=>y(rt,(e(B),i(()=>e(B).resultString)))),o(je,Ie)};$(q,je=>{e(B),i(()=>e(B).resultString)&&je(L)})}var Re=t(q,2);{var ye=je=>{var Ie=yl(),rt=l(Ie);s(Ie),P(()=>y(rt,`Modifier: ${e(B),i(()=>e(B).constant>=0?"+":"")??""}${e(B),i(()=>e(B).constant)??""}`)),o(je,Ie)};$(Re,je=>{e(B),i(()=>e(B).constant)&&je(ye)})}s(p);var qe=t(p,2);{var Ae=je=>{var Ie=$l(),rt=l(Ie);dt(rt,1,()=>e(le),bt,(tt,st)=>{var pt=xl(),It=l(pt,!0);s(pt),P(()=>y(It,(e(st),i(()=>e(st).label)))),F("click",pt,()=>pe(e(st).notation,"damage")),o(tt,pt)});var ne=t(rt,2);{var Xe=tt=>{var st=kl();P(()=>{st.disabled=e(w)<=0,it(st,"title",e(w)<=0?"No Channel Divinity uses remaining":"Use Channel Divinity to add +10 to this attack roll")}),F("click",st,We),o(tt,st)};$(ne,tt=>{e(S)&&e(C)==="attack"&&!e(Z)&&tt(Xe)})}s(Ie),o(je,Ie)};$(qe,je=>{e(le),e(S),e(C),e(Z),i(()=>e(le).length>0||e(S)&&e(C)==="attack"&&!e(Z))&&je(Ae)})}P(()=>{y(f,J()?`${J()} - Result`:"Result"),y(Oe,(e(B),i(()=>e(B).resultTotal)))}),o(d,j)};$(Ge,d=>{e(B)&&d(M)})}s(ee),s(Q),s(m),P(()=>{V=ut(m,1,"modal-overlay svelte-1r90jgp",null,V,{hidden:!oe()}),De=ut(ee,1,"roll-result svelte-1r90jgp",null,De,{"has-result":e(B)})}),F("click",Te,Ue),F("click",U,Ke),F("click",Q,ya(function(d){Bt.call(this,u,d)})),F("keydown",Q,function(d){Bt.call(this,u,d)}),F("click",m,Ke),F("keydown",m,d=>d.key==="Escape"&&Ke()),o(n,m),Xa(u,"getLastRollTotal",ae);var H=$t(et);return k(),H}const na="https://api.github.com/gists";async function Dl(n,u,a){if(!u)throw new Error("GitHub token is required");const v=JSON.stringify(n,null,2),k=`${n.name||"character"}_dnd.json`,S={description:a||`D&D Character: ${n.name}`,public:!1,files:{[k]:{content:v}}},w=await fetch(na,{method:"POST",headers:{Authorization:`token ${u}`,"Content-Type":"application/json"},body:JSON.stringify(S)});if(!w.ok)throw new Error(`Failed to create gist: ${w.statusText}`);return(await w.json()).id}async function wl(n,u,a){if(!u||!a)throw new Error("GitHub token and Gist ID are required");const v=JSON.stringify(n,null,2),S={files:{[`${n.name||"character"}_dnd.json`]:{content:v}}},w=await fetch(`${na}/${a}`,{method:"PATCH",headers:{Authorization:`token ${u}`,"Content-Type":"application/json"},body:JSON.stringify(S)});if(!w.ok)throw new Error(`Failed to update gist: ${w.statusText}`)}async function jl(n,u){if(!n)throw new Error("Gist ID is required");const a={"Content-Type":"application/json"};u&&(a.Authorization=`token ${u}`);const v=await fetch(`${na}/${n}`,{method:"GET",headers:a});if(!v.ok)throw new Error(`Failed to load gist: ${v.statusText}`);const k=await v.json(),S=Object.values(k.files);if(S.length===0)throw new Error("No files found in gist");const N=S[0].content;try{const g=JSON.parse(N);return g.attacks&&Array.isArray(g.attacks)&&(g.attacks=g.attacks.map(O=>({...O,id:O.id||crypto.randomUUID()}))),g.classFeatures?(g.classFeatures.features||(g.classFeatures.features={}),g.classFeatures.spellSlots||(g.classFeatures.spellSlots=[]),g.classFeatures.preparedSpells===void 0&&(g.classFeatures.preparedSpells="")):g.classFeatures={features:{},spellSlots:[],preparedSpells:""},g}catch{throw new Error("Invalid character data in gist")}}function Ca(n){typeof window<"u"&&localStorage.setItem("dnd_gist_config",JSON.stringify(n))}function Fl(){if(typeof window<"u"){const n=localStorage.getItem("dnd_gist_config");if(n)return JSON.parse(n)}return{}}async function Rl(n,u=30){if(!n)throw new Error("GitHub token is required to list gists");const a=await fetch(`${na}?per_page=${u}`,{method:"GET",headers:{Authorization:`token ${n}`,"Content-Type":"application/json"}});if(!a.ok)throw new Error(`Failed to list gists: ${a.statusText}`);return await a.json()}var Al=h('<div class="error-message svelte-1jb5ckg"> </div>'),Il=h('<div class="toggle-container svelte-1jb5ckg"><button type="button" class="toggle-btn svelte-1jb5ckg"> </button></div>'),Pl=h('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID (leave empty to create new)</label> <input type="text" id="gistId" placeholder="Optional: existing Gist ID to update" class="svelte-1jb5ckg"/></div>'),Ml=h('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),El=h('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),Hl=h('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Update (or leave unselected to create new)</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),Tl=h('<div class="info-message svelte-1jb5ckg">No gists found. A new one will be created.</div>'),Ul=h('<!> <div class="form-group svelte-1jb5ckg"><label for="description" class="svelte-1jb5ckg"> </label> <input type="text" id="description" placeholder="D&amp;D Character Sheet" class="svelte-1jb5ckg"/></div>',1),Bl=h('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID *</label> <input type="text" id="gistId" placeholder="Enter Gist ID (for public or your private gists)" required class="svelte-1jb5ckg"/></div>'),Nl=h('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),Gl=h('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),Ol=h('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Load</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),ql=h('<div class="info-message svelte-1jb5ckg">No gists found. Enter a Gist ID manually or create a new one in Save mode.</div>'),zl=h('<div class="modal-overlay svelte-1jb5ckg" role="button" tabindex="-1"><div class="modal-content svelte-1jb5ckg" role="dialog" tabindex="0"><div class="modal-header svelte-1jb5ckg"><h2 class="svelte-1jb5ckg"> </h2> <button class="close-btn svelte-1jb5ckg">Ã—</button></div> <div class="modal-body svelte-1jb5ckg"><!> <div class="form-group svelte-1jb5ckg"><label for="token" class="svelte-1jb5ckg"> <a href="https://github.com/settings/tokens" target="_blank" rel="noopener" class="svelte-1jb5ckg">Get token</a></label> <input type="password" id="token" placeholder="ghp_xxxxxxxxxxxxx" class="svelte-1jb5ckg"/></div> <!> <!> <div class="modal-actions svelte-1jb5ckg"><button class="btn btn-primary svelte-1jb5ckg"><!></button> <button class="btn btn-secondary svelte-1jb5ckg">Cancel</button></div></div></div></div>');function Wl(n,u){kt(u,!1);const a=()=>Je(Y,"$character",v),[v,k]=Lt(),S=Gt();let w=Ut(u,"mode",8,"save"),N=I(""),g=I(""),O=I(""),oe=I(!1),E=I(""),J=I(!1),ge=I(!1),re=I([]),ke=I(null);const he=Fl();he.token&&r(N,he.token),he.gistId&&r(g,he.gistId),Qt(async()=>{e(N)&&!e(J)&&await B()});async function B(){if(e(N)){r(ge,!0),r(E,"");try{r(re,await Rl(e(N))),e(g)&&r(ke,e(re).find(m=>m.id===e(g))||null)}catch(m){r(E,m.message||"Failed to load gists"),r(re,[])}finally{r(ge,!1)}}}function ae(m){r(ke,m),r(g,m.id)}function ce(){r(J,!e(J)),r(E,""),!e(J)&&e(N)&&B()}async function fe(){if(!e(N)){r(E,"GitHub token is required");return}const m=e(ke)?.id||e(g);r(oe,!0),r(E,"");try{if(m)await wl(a(),e(N),m),r(g,m),Jt.add("Character updated in Gist successfully!","success");else{const V=await Dl(a(),e(N),e(O));r(g,V),Jt.add(`Character saved to Gist! ID: ${V}`,"success")}Ca({token:e(N),gistId:e(g)}),S("close")}catch(V){r(E,V.message||"Failed to save to Gist")}finally{r(oe,!1)}}async function z(){const m=e(ke)?.id||e(g);if(!m){r(E,"Please select a gist or enter a Gist ID");return}r(oe,!0),r(E,"");try{const V=await jl(m,e(N)||void 0);Y.set(V),r(g,m),Ca({token:e(N),gistId:e(g)}),Jt.add("Character loaded from Gist successfully!","success"),S("close")}catch(V){r(E,V.message||"Failed to load from Gist")}finally{r(oe,!1)}}function W(){S("close")}xt();var T=zl(),se=l(T),te=l(se),le=l(te),Me=l(le,!0);s(le);var C=t(le,2);s(te);var Z=t(te,2),ie=l(Z);{var _=m=>{var V=Al(),Q=l(V,!0);s(V),P(()=>y(Q,e(E))),o(m,V)};$(ie,m=>{e(E)&&m(_)})}var c=t(ie,2),R=l(c),ve=l(R);Ia(),s(R);var G=t(R,2);xe(G),s(c);var ue=t(c,2);{var pe=m=>{var V=Il(),Q=l(V),Se=l(Q,!0);s(Q),s(V),P(()=>{Q.disabled=e(oe),y(Se,e(J)?"ðŸ“‹ Show My Gists":"âœï¸ Enter Gist ID Manually")}),F("click",Q,ce),o(m,V)};$(ue,m=>{(w()==="load"||w()==="save"&&e(N))&&m(pe)})}var $e=t(ue,2);{var be=m=>{var V=Ul(),Q=ze(V);{var Se=Ce=>{var me=Pl(),He=t(l(me),2);xe(He),s(me),P(()=>He.disabled=e(oe)),Pe(He,()=>e(g),Ne=>r(g,Ne)),o(Ce,me)},Be=Ce=>{var me=nt(),He=ze(me);{var Ne=Le=>{var ee=Ml();o(Le,ee)},Qe=Le=>{var ee=nt(),De=ze(ee);{var Ge=H=>{var d=Hl(),j=t(l(d),2);dt(j,5,()=>e(re),bt,(K,D)=>{var f=El();let de;var we=l(f),_e=l(we),Oe=l(_e,!0);s(_e);var p=t(_e,2),q=l(p,!0);s(p),s(we);var L=t(we,2),Re=l(L),ye=l(Re);s(Re);var qe=t(Re,2),Ae=l(qe);s(qe),s(L),s(f),P(je=>{de=ut(f,1,"gist-item svelte-1jb5ckg",null,de,{selected:e(ke)?.id===e(D).id}),f.disabled=e(oe),y(Oe,(e(D),i(()=>e(D).description||"Untitled"))),y(q,(e(D),i(()=>e(D).public?"ðŸŒ Public":"ðŸ”’ Private"))),y(ye,`ID: ${e(D),i(()=>e(D).id)??""}`),y(Ae,`Updated: ${je??""}`)},[()=>(e(D),i(()=>new Date(e(D).updated_at).toLocaleDateString()))]),F("click",f,()=>ae(e(D))),o(K,f)}),s(j),s(d),o(H,d)},M=H=>{var d=nt(),j=ze(d);{var K=D=>{var f=Tl();o(D,f)};$(j,D=>{e(N)&&D(K)},!0)}o(H,d)};$(De,H=>{e(re),i(()=>e(re).length>0)?H(Ge):H(M,!1)},!0)}o(Le,ee)};$(He,Le=>{e(ge)?Le(Ne):Le(Qe,!1)},!0)}o(Ce,me)};$(Q,Ce=>{e(J)||!e(N)?Ce(Se):Ce(Be,!1)})}var Te=t(Q,2),U=l(Te),X=l(U);s(U);var x=t(U,2);xe(x),s(Te),P(()=>{y(X,`Description ${e(g)?"(optional)":""}`),x.disabled=e(oe)}),Pe(x,()=>e(O),Ce=>r(O,Ce)),o(m,V)},Fe=m=>{var V=nt(),Q=ze(V);{var Se=Te=>{var U=Bl(),X=t(l(U),2);xe(X),s(U),P(()=>X.disabled=e(oe)),Pe(X,()=>e(g),x=>r(g,x)),o(Te,U)},Be=Te=>{var U=nt(),X=ze(U);{var x=me=>{var He=Nl();o(me,He)},Ce=me=>{var He=nt(),Ne=ze(He);{var Qe=ee=>{var De=Ol(),Ge=t(l(De),2);dt(Ge,5,()=>e(re),bt,(M,H)=>{var d=Gl();let j;var K=l(d),D=l(K),f=l(D,!0);s(D);var de=t(D,2),we=l(de,!0);s(de),s(K);var _e=t(K,2),Oe=l(_e),p=l(Oe);s(Oe);var q=t(Oe,2),L=l(q);s(q),s(_e),s(d),P(Re=>{j=ut(d,1,"gist-item svelte-1jb5ckg",null,j,{selected:e(ke)?.id===e(H).id}),d.disabled=e(oe),y(f,(e(H),i(()=>e(H).description||"Untitled"))),y(we,(e(H),i(()=>e(H).public?"ðŸŒ Public":"ðŸ”’ Private"))),y(p,`ID: ${e(H),i(()=>e(H).id)??""}`),y(L,`Updated: ${Re??""}`)},[()=>(e(H),i(()=>new Date(e(H).updated_at).toLocaleDateString()))]),F("click",d,()=>ae(e(H))),o(M,d)}),s(Ge),s(De),o(ee,De)},Le=ee=>{var De=nt(),Ge=ze(De);{var M=H=>{var d=ql();o(H,d)};$(Ge,H=>{e(N)&&H(M)},!0)}o(ee,De)};$(Ne,ee=>{e(re),i(()=>e(re).length>0)?ee(Qe):ee(Le,!1)},!0)}o(me,He)};$(X,me=>{e(ge)?me(x):me(Ce,!1)},!0)}o(Te,U)};$(Q,Te=>{e(J)||!e(N)?Te(Se):Te(Be,!1)})}o(m,V)};$($e,m=>{w()==="save"?m(be):m(Fe,!1)})}var b=t($e,2),Ee=l(b),Ue=l(Ee);{var We=m=>{var V=ft();P(()=>y(V,w()==="save"?"Saving...":"Loading...")),o(m,V)},Ke=m=>{var V=ft();P(()=>y(V,w()==="save"?"Save":"Load")),o(m,V)};$(Ue,m=>{e(oe)?m(We):m(Ke,!1)})}s(Ee);var et=t(Ee,2);s(b),s(Z),s(se),s(T),P(()=>{y(Me,w()==="save"?"Save to GitHub Gist":"Load from GitHub Gist"),y(ve,`GitHub Token ${w()==="load"?"(optional for public gists)":"(required)"} `),G.disabled=e(oe),Ee.disabled=e(oe),et.disabled=e(oe)}),F("click",C,W),Pe(G,()=>e(N),m=>r(N,m)),F("blur",G,()=>{e(N)&&!e(J)&&B()}),F("click",Ee,function(...m){(w()==="save"?fe:z)?.apply(this,m)}),F("click",et,W),F("click",se,ya(function(m){Bt.call(this,u,m)})),F("keydown",se,function(m){Bt.call(this,u,m)}),F("click",T,W),F("keydown",T,m=>m.key==="Escape"&&W()),o(n,T),$t(),k()}var Kl=h('<div class="loading svelte-1ngjemu">Loading D&D data...</div>'),Jl=h("<option> </option>"),Vl=h('<select class="level-filter svelte-1ngjemu"><option>All Levels</option><option>Cantrip</option><!></select>'),Ql=h('<div class="no-results svelte-1ngjemu"> </div>'),Xl=h('<div class="item-meta svelte-1ngjemu"> </div>'),Yl=h('<div class="item-meta svelte-1ngjemu"> </div>'),Zl=h('<button><div class="item-name svelte-1ngjemu"> </div> <!></button>'),ei=h('<p class="higher-levels"><strong>At Higher Levels:</strong> </p>'),ti=h('<p class="cantrip-upgrade"><strong>Cantrip Upgrade:</strong> </p>'),ai=h('<h3 class="svelte-1ngjemu"> </h3> <p class="spell-meta svelte-1ngjemu"><!> <!></p> <p class="spell-classes"><strong>Classes:</strong> </p> <div class="spell-stats svelte-1ngjemu"><div><strong>Casting Time:</strong> </div> <div><strong>Range:</strong> </div> <div><strong>Components:</strong> <!></div> <div><strong>Duration:</strong> <!> </div></div> <p class="description svelte-1ngjemu"> </p> <!> <!>',1),si=h('<p class="prerequisite svelte-1ngjemu"><strong>Prerequisite:</strong> </p>'),li=h('<h3 class="svelte-1ngjemu"> </h3> <!> <p class="description svelte-1ngjemu"> </p> <a target="_blank" rel="noopener" class="source-link svelte-1ngjemu">View Full Details â†’</a>',1),ii=h('<div class="item-details svelte-1ngjemu"><!></div>'),ni=h('<div class="controls svelte-1ngjemu"><div class="tabs svelte-1ngjemu"><button> </button> <button> </button></div> <div class="search-controls svelte-1ngjemu"><input type="text" placeholder="Search by name or description..." class="search-input svelte-1ngjemu"/> <!></div></div> <div class="content-container svelte-1ngjemu"><div class="items-list svelte-1ngjemu"><!></div> <!></div>',1),ri=h('<div class="modal-backdrop svelte-1ngjemu" role="presentation"><div class="modal svelte-1ngjemu" role="dialog" aria-modal="true" tabindex="-1"><div class="modal-header svelte-1ngjemu"><h2 class="svelte-1ngjemu">Browse D&D Spells & Feats</h2> <button class="close-btn svelte-1ngjemu" aria-label="Close">&times;</button></div> <div class="modal-body svelte-1ngjemu"><!></div> <div class="modal-footer svelte-1ngjemu"><button class="btn-secondary svelte-1ngjemu">Cancel</button> <button class="btn-primary svelte-1ngjemu">Add to Character Sheet</button></div></div></div>');function oi(n,u){kt(u,!1);const a=I(),v=I(),k=I();let S=Ut(u,"onClose",8),w=I("spell"),N=I(!0),g=I(""),O=I(null),oe=I([]),E=I([]),J=I(null);Qt(async()=>{r(N,!0);try{r(oe,await Ha()),r(E,await ys())}catch(C){console.error("Failed to load data:",C)}finally{r(N,!1)}});function ge(C){r(J,C)}function re(C){const Z=C.match(/(\d+d\d+(?:\s*\+\s*\d+)?)/i);return Z?Z[1]:""}function ke(C){const Z=C.split(/\.( |$)/)[0].trim(),ie=Array.from(C.matchAll(/\*\*(.*?)\*\*/g)).map(c=>c[1].replace(/\.$/,""));let _=Z;return ie.length&&(_+=" | Effects: "+ie.join(", ")),_}function he(){if(e(J)){if(e(w)==="spell"){const C=e(J);Y.update(Z=>{const _=[];C.range&&_.push(`Range: ${C.range}`),C.castingTime&&_.push(`Cast: ${C.castingTime}`),C.duration&&_.push(`Duration: ${C.duration}`),C.actionType==="Save"&&_.push("Saving throw spell"),C.components&&C.components.length>0&&_.push(`Components: ${C.components.join(", ")}`),C.material&&_.push(`Material: ${C.material}`);const c=_.join(" | "),R=ke(C.description),ve={id:crypto.randomUUID(),name:`${C.name}${C.concentration?" (C)":""}${C.ritual?" (R)":""}`,bonus:C.actionType==="Attack"?5:0,damage:re(C.description),damageType:`${C.school} (Lvl ${C.level})`,spellRef:C.name,infoNotes:c,generalNotes:R,castAtLevel:C.level};return Z.attacks=[...Z.attacks,ve],Z})}else if(e(w)==="feat"){const C=e(J);Y.update(Z=>{const ie=`${C.name}${C.prerequisite?` (Req: ${C.prerequisite})`:""}
${C.description}
`;return Z.features=Z.features?`${Z.features}
${ie}`:ie,Z})}r(J,null),S()()}}Ze(()=>(e(O),e(oe),e(g)),()=>{r(a,e(O)!==null?xs(Sa(e(oe),e(g)),e(O)):Sa(e(oe),e(g)))}),Ze(()=>(e(E),e(g)),()=>{r(v,ks(e(E),e(g)))}),Ze(()=>(e(w),e(a),e(v)),()=>{r(k,e(w)==="spell"?e(a):e(v))}),jt(),xt();var B=ri(),ae=l(B),ce=l(ae),fe=t(l(ce),2);s(ce);var z=t(ce,2),W=l(z);{var T=C=>{var Z=Kl();o(C,Z)},se=C=>{var Z=ni(),ie=ze(Z),_=l(ie),c=l(_);let R;var ve=l(c);s(c);var G=t(c,2);let ue;var pe=l(G);s(G),s(_);var $e=t(_,2),be=l($e);xe(be);var Fe=t(be,2);{var b=Q=>{var Se=Vl();P(()=>{e(O),Ct(()=>{})});var Be=l(Se);Be.value=(Be.__value=null)??"";var Te=t(Be);Te.value=Te.__value=0;var U=t(Te);dt(U,0,()=>[1,2,3,4,5,6,7,8,9],bt,(X,x)=>{var Ce=Jl(),me=l(Ce);s(Ce);var He={};P(()=>{y(me,`Level ${x??""}`),He!==(He=x)&&(Ce.value=(Ce.__value=x)??"")}),o(X,Ce)}),s(Se),Ma(Se,()=>e(O),X=>r(O,X)),o(Q,Se)};$(Fe,Q=>{e(w)==="spell"&&Q(b)})}s($e),s(ie);var Ee=t(ie,2),Ue=l(Ee),We=l(Ue);{var Ke=Q=>{var Se=Ql(),Be=l(Se);s(Se),P(()=>y(Be,`No ${e(w)??""}s found`)),o(Q,Se)},et=Q=>{var Se=nt(),Be=ze(Se);dt(Be,1,()=>e(k),bt,(Te,U)=>{var X=Zl();let x;var Ce=l(X),me=l(Ce,!0);s(Ce);var He=t(Ce,2);{var Ne=Le=>{const ee=Ye(()=>e(U));var De=Xl(),Ge=l(De);s(De),P(()=>y(Ge,`Level ${A(e(ee)),i(()=>e(ee).level)??""} â€¢ ${A(e(ee)),i(()=>e(ee).school)??""}`)),o(Le,De)},Qe=Le=>{const ee=Ye(()=>e(U));var De=nt(),Ge=ze(De);{var M=H=>{var d=Yl(),j=l(d,!0);s(d),P(()=>y(j,(A(e(ee)),i(()=>e(ee).prerequisite)))),o(H,d)};$(Ge,H=>{A(e(ee)),i(()=>e(ee).prerequisite)&&H(M)})}o(Le,De)};$(He,Le=>{e(w)==="spell"?Le(Ne):Le(Qe,!1)})}s(X),P(()=>{x=ut(X,1,"item-card svelte-1ngjemu",null,x,{selected:e(J)?.name===e(U).name}),y(me,(e(U),i(()=>e(U).name)))}),F("click",X,()=>ge(e(U))),o(Te,X)}),o(Q,Se)};$(We,Q=>{e(k),i(()=>e(k).length===0)?Q(Ke):Q(et,!1)})}s(Ue);var m=t(Ue,2);{var V=Q=>{var Se=ii(),Be=l(Se);{var Te=X=>{const x=Ye(()=>e(J));var Ce=ai(),me=ze(Ce),He=l(me,!0);s(me);var Ne=t(me,2),Qe=l(Ne);{var Le=ne=>{var Xe=ft();P(()=>y(Xe,`${A(e(x)),i(()=>e(x).school)??""} cantrip`)),o(ne,Xe)},ee=ne=>{var Xe=ft();P(()=>y(Xe,`Level ${A(e(x)),i(()=>e(x).level)??""} ${A(e(x)),i(()=>e(x).school)??""}`)),o(ne,Xe)};$(Qe,ne=>{A(e(x)),i(()=>e(x).level===0)?ne(Le):ne(ee,!1)})}var De=t(Qe,2);{var Ge=ne=>{var Xe=ft("(ritual)");o(ne,Xe)};$(De,ne=>{A(e(x)),i(()=>e(x).ritual)&&ne(Ge)})}s(Ne);var M=t(Ne,2),H=t(l(M));s(M);var d=t(M,2),j=l(d),K=t(l(j));s(j);var D=t(j,2),f=t(l(D));s(D);var de=t(D,2),we=t(l(de)),_e=t(we);{var Oe=ne=>{var Xe=ft();P(()=>y(Xe,`(${A(e(x)),i(()=>e(x).material)??""})`)),o(ne,Xe)};$(_e,ne=>{A(e(x)),i(()=>e(x).material)&&ne(Oe)})}s(de);var p=t(de,2),q=t(l(p),2);{var L=ne=>{var Xe=ft("Concentration,");o(ne,Xe)};$(q,ne=>{A(e(x)),i(()=>e(x).concentration)&&ne(L)})}var Re=t(q,1,!0);s(p),s(d);var ye=t(d,2),qe=l(ye,!0);s(ye);var Ae=t(ye,2);{var je=ne=>{var Xe=ei(),tt=t(l(Xe));s(Xe),P(()=>y(tt,` ${A(e(x)),i(()=>e(x).higherLevelSlot)??""}`)),o(ne,Xe)};$(Ae,ne=>{A(e(x)),i(()=>e(x).higherLevelSlot)&&ne(je)})}var Ie=t(Ae,2);{var rt=ne=>{var Xe=ti(),tt=t(l(Xe));s(Xe),P(()=>y(tt,` ${A(e(x)),i(()=>e(x).cantripUpgrade)??""}`)),o(ne,Xe)};$(Ie,ne=>{A(e(x)),i(()=>e(x).cantripUpgrade)&&ne(rt)})}P((ne,Xe)=>{y(He,(A(e(x)),i(()=>e(x).name))),y(H,` ${ne??""}`),y(K,` ${A(e(x)),i(()=>e(x).castingTime||e(x).actionType)??""}`),y(f,` ${A(e(x)),i(()=>e(x).range)??""}`),y(we,` ${Xe??""}`),y(Re,(A(e(x)),i(()=>e(x).duration))),y(qe,(A(e(x)),i(()=>e(x).description)))},[()=>(A(e(x)),i(()=>e(x).classes.join(", "))),()=>(A(e(x)),i(()=>e(x).components.join(", ").toUpperCase()))]),o(X,Ce)},U=X=>{const x=Ye(()=>e(J));var Ce=li(),me=ze(Ce),He=l(me,!0);s(me);var Ne=t(me,2);{var Qe=Ge=>{var M=si(),H=t(l(M));s(M),P(()=>y(H,` ${A(e(x)),i(()=>e(x).prerequisite)??""}`)),o(Ge,M)};$(Ne,Ge=>{A(e(x)),i(()=>e(x).prerequisite)&&Ge(Qe)})}var Le=t(Ne,2),ee=l(Le,!0);s(Le);var De=t(Le,2);P(()=>{y(He,(A(e(x)),i(()=>e(x).name))),y(ee,(A(e(x)),i(()=>e(x).description))),it(De,"href",(A(e(x)),i(()=>e(x).source)))}),o(X,Ce)};$(Be,X=>{e(w)==="spell"?X(Te):X(U,!1)})}s(Se),o(Q,Se)};$(m,Q=>{e(J)&&Q(V)})}s(Ee),P(()=>{R=ut(c,1,"tab svelte-1ngjemu",null,R,{active:e(w)==="spell"}),y(ve,`ðŸ“œ Spells (${e(oe),i(()=>e(oe).length)??""})`),ue=ut(G,1,"tab svelte-1ngjemu",null,ue,{active:e(w)==="feat"}),y(pe,`â­ Feats (${e(E),i(()=>e(E).length)??""})`)}),F("click",c,()=>{r(w,"spell"),r(J,null),r(g,"")}),F("click",G,()=>{r(w,"feat"),r(J,null),r(g,"")}),Pe(be,()=>e(g),Q=>r(g,Q)),o(C,Z)};$(W,C=>{e(N)?C(T):C(se,!1)})}s(z);var te=t(z,2),le=l(te),Me=t(le,2);s(te),s(ae),s(B),P(()=>Me.disabled=!e(J)),F("click",fe,function(...C){S()?.apply(this,C)}),F("click",le,function(...C){S()?.apply(this,C)}),F("click",Me,he),F("click",ae,ya(function(C){Bt.call(this,u,C)})),F("keydown",ae,function(C){Bt.call(this,u,C)}),F("click",B,function(...C){S()?.apply(this,C)}),F("keydown",B,C=>C.key==="Escape"&&S()()),o(n,B),$t()}var ci=h('<link rel="icon" type="image/png" href="/favicon.png"/> <meta name="viewport" content="width=device-width, initial-scale=1"/>',1),vi=h('<span class="character-name svelte-1uha8ag"> </span>'),di=h("<span> </span>"),ui=h('<div class="spell-slots-header svelte-1uha8ag"></div>'),pi=h('<div class="rest-menu svelte-1uha8ag"><button class="rest-option svelte-1uha8ag">â˜• Short Rest</button> <button class="rest-option svelte-1uha8ag">ðŸ›ï¸ Long Rest</button></div>'),fi=h('<div class="container svelte-1uha8ag"><header class="svelte-1uha8ag"><div class="header-top svelte-1uha8ag"><div class="header-title svelte-1uha8ag"><div class="title-row svelte-1uha8ag"><h1 class="svelte-1uha8ag">D&D Character Sheet</h1> <!></div> <!></div> <div class="header-right svelte-1uha8ag"><div class="header-controls svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">ðŸŽ²</span><span class="btn-text svelte-1uha8ag">Roll Dice</span></button> <div class="rest-button-container svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">ðŸ˜´</span><span class="btn-text svelte-1uha8ag">Rest</span></button> <!></div> <div class="mode-toggle"><button><span class="btn-icon svelte-1uha8ag"> </span><span class="btn-text svelte-1uha8ag"> </span></button></div></div> <div class="header-search svelte-1uha8ag"><input type="text" placeholder="ðŸ” Search..." class="search-input use-enabled svelte-1uha8ag"/></div></div></div> <div class="header-actions svelte-1uha8ag"><button class="btn btn-mode svelte-1uha8ag">ðŸ“š Browse Spells & Feats</button> <button class="btn btn-secondary">Save to Gist</button> <button class="btn btn-secondary">Load from Gist</button> <button class="btn btn-secondary">Export JSON</button> <button class="btn btn-secondary">Import JSON</button> <input type="file" accept=".json" style="display: none;"/></div></header> <main class="svelte-1uha8ag"><!> <!> <!> <!> <!> <!> <!></main></div> <!> <!> <!> <!>',1);function $i(n,u){kt(u,!1);const a=()=>Je(Y,"$character",S),v=()=>Je(aa,"$isEditMode",S),k=()=>Je(At,"$searchFilter",S),[S,w]=Lt();function N(){const p=[],q=a().classFeatures.spellSlotsByLevel||{};for(let L=1;L<=9;L++){const Re=q[L];if(Re&&Re.length>0){const ye=Re.length,qe=Re.filter(Ae=>Ae).length;p.push({level:L,available:ye-qe,total:ye})}}return p}let g=I(!1),O=I(!1),oe=I(!1),E=I("save"),J=I(void 0),ge=I(""),re=I(""),ke=I(""),he=I(),B=!1,ae=I(!1);function ce(){const p=[];Y.update(L=>{const Re=L.hitDice.current;L.hitDice.current=Math.min(L.hitDice.max,L.hitDice.current+Math.max(1,Math.floor(L.hitDice.max/2)));const ye=L.hitDice.current-Re;if(ye>0&&p.push(`${ye} hit ${ye===1?"die":"dice"}`),L.class){const qe=Nt(L.class,L.level,L.subclass);L.classFeatures.features||(L.classFeatures.features={}),qe.forEach(Ae=>{if(Ae.resetOn==="short"){const je=Ae.name.replace(/\s+/g,"");if(Ae.type==="uses"){const Ie=typeof Ae.maxUses=="function"?Ae.maxUses(L.level):Ae.maxUses;L.classFeatures.features[je]=Array(Ie).fill(!1),p.push(Ae.name)}else if(Ae.type==="pool"){const Ie=typeof Ae.maxPool=="function"?Ae.maxPool(L.level):Ae.maxPool;Ie!==void 0&&(L.classFeatures.features[je]=Ie,p.push(Ae.name))}}})}return L}),r(ae,!1);const q=p.length>0?`Short rest taken! Restored: ${p.join(", ")}`:"Short rest taken!";Jt.add(q,"success")}function fe(){const p=[];Y.update(L=>{const Re=L.maxHP-L.currentHP;Re>0&&p.push(`${Re} HP`),L.currentHP=L.maxHP,L.tempHP=0;const ye=L.hitDice.max-L.hitDice.current;ye>0&&p.push(`${ye} hit ${ye===1?"die":"dice"}`),L.hitDice.current=L.hitDice.max;let qe=0;if(L.classFeatures.spellSlotsByLevel&&Object.keys(L.classFeatures.spellSlotsByLevel).forEach(Ae=>{const je=L.classFeatures.spellSlotsByLevel[parseInt(Ae)];if(je){const Ie=je.filter(rt=>rt).length;qe+=Ie,L.classFeatures.spellSlotsByLevel[parseInt(Ae)]=Array(je.length).fill(!1)}}),qe>0&&p.push(`${qe} spell ${qe===1?"slot":"slots"}`),L.class){const Ae=Nt(L.class,L.level,L.subclass);L.classFeatures.features||(L.classFeatures.features={});let je=!1;Ae.forEach(Ie=>{const rt=Ie.name.replace(/\s+/g,"");if(!(Ie.type==="info"||Ie.type==="channelDivinity")){if(Ie.type==="uses"){const ne=typeof Ie.maxUses=="function"?Ie.maxUses(L.level):Ie.maxUses;L.classFeatures.features[rt]=Array(ne).fill(!1),je=!0}else if(Ie.type==="pool"){const ne=typeof Ie.maxPool=="function"?Ie.maxPool(L.level):Ie.maxPool;ne!==void 0&&(L.classFeatures.features[rt]=ne,je=!0)}}}),je&&p.push("all class features")}return L}),r(ae,!1);const q=p.length>0?`Long rest taken! Restored: ${p.join(", ")}`:"Long rest taken! Fully rested.";Jt.add(q,"success")}function z(p){r(ge,""),r(re,""),r(ke,""),B=!1,typeof p=="string"?r(ge,p):(r(ge,p.notation),r(re,p.damageNotation||""),r(ke,p.attackName||"")),r(g,!0)}function W(p){const{notation:q}=p.detail;r(ge,""),B=!0,setTimeout(()=>{r(ge,q),r(re,""),r(ke,"Hit Die")},0),r(g,!0)}function T(){if(r(g,!1),B&&e(he)){const p=e(he).getLastRollTotal();if(p!==null){const q=Math.max(1,p);Y.update(L=>(L.hitDice.current=Math.max(0,L.hitDice.current-1),L.currentHP=Math.min(L.maxHP,L.currentHP+q),L))}B=!1}}function se(){console.log("toggleMode called, current isEditMode:",v()),aa.update(p=>(console.log("Updating isEditMode from",p,"to",!p),!p))}function te(p){p.target.closest(".rest-button-container")||r(ae,!1)}Qt(()=>{console.log("onMount - initial isEditMode:",v()),console.log("onMount - body classes:",document.body.className);const p=aa.subscribe(q=>{console.log("isEditMode subscription triggered, value:",q),console.log("Body classes before:",document.body.className),q?(document.body.classList.remove("use-mode"),console.log("Removed use-mode class (Edit Mode)")):(document.body.classList.add("use-mode"),console.log("Added use-mode class (Use Mode)")),console.log("Body classes after:",document.body.className)});return document.addEventListener("click",te),()=>{p(),document.removeEventListener("click",te)}});function le(){Ka(a())}function Me(){e(J)?.click()}async function C(p){const L=p.target.files?.[0];if(L)try{const Re=await Ja(L);Y.set(Re),alert("Character imported successfully!")}catch{alert("Failed to import character file")}}xt();var Z=fi();za("1uha8ag",p=>{var q=ci();Ia(2),wa(()=>{Oa.title="D&D Character Sheet"}),o(p,q)});var ie=ze(Z),_=l(ie),c=l(_),R=l(c),ve=l(R),G=t(l(ve),2);{var ue=p=>{var q=vi(),L=l(q,!0);s(q),P(()=>y(L,a().name)),o(p,q)};$(G,p=>{a().name&&p(ue)})}s(ve);var pe=t(ve,2);{var $e=p=>{var q=ui();dt(q,5,N,bt,(L,Re)=>{var ye=di();let qe;var Ae=l(ye);s(ye),P(()=>{qe=ut(ye,1,"slot-badge svelte-1uha8ag",null,qe,{depleted:e(Re).available===0}),y(Ae,`Lv${e(Re).level??""}: ${e(Re).available??""}/${e(Re).total??""}`)}),o(L,ye)}),s(q),o(p,q)};$(pe,p=>{N().length>0&&p($e)})}s(R);var be=t(R,2),Fe=l(be),b=l(Fe),Ee=t(b,2),Ue=l(Ee),We=t(Ue,2);{var Ke=p=>{var q=pi(),L=l(q),Re=t(L,2);s(q),F("click",L,ce),F("click",Re,fe),o(p,q)};$(We,p=>{e(ae)&&p(Ke)})}s(Ee);var et=t(Ee,2),m=l(et);let V;var Q=l(m),Se=l(Q,!0);s(Q);var Be=t(Q),Te=l(Be,!0);s(Be),s(m),s(et),s(Fe);var U=t(Fe,2),X=l(U);xe(X),s(U),s(be),s(c);var x=t(c,2),Ce=l(x),me=t(Ce,2),He=t(me,2),Ne=t(He,2),Qe=t(Ne,2),Le=t(Qe,2);ba(Le,p=>r(J,p),()=>e(J)),s(x),s(_);var ee=t(_,2),De=l(ee);ns(De,{});var Ge=t(De,2);bs(Ge,{$$events:{rollHitDice:W}});var M=t(Ge,2);vs(M,{$$events:{roll:p=>z(p.detail)}});var H=t(M,2);_s(H,{$$events:{roll:p=>z(p.detail)}});var d=t(H,2);Js(d,{$$events:{roll:p=>z(p.detail)}});var j=t(d,2);dl(j,{});var K=t(j,2);fl(K,{}),s(ee),s(ie);var D=t(ie,2);ba(Ll(D,{get notation(){return e(ge)},get damageNotation(){return e(re)},get attackName(){return e(ke)},get visible(){return e(g)},$$events:{close:T},$$legacy:!0}),p=>r(he,p),()=>e(he));var f=t(D,2);{var de=p=>{Wl(p,{get mode(){return e(E)},$$events:{close:()=>r(O,!1)}})};$(f,p=>{e(O)&&p(de)})}var we=t(f,2);{var _e=p=>{oi(p,{onClose:()=>r(oe,!1)})};$(we,p=>{e(oe)&&p(_e)})}var Oe=t(we,2);Wa(Oe,{}),P(()=>{V=ut(m,1,"btn btn-mode svelte-1uha8ag",null,V,{"use-mode":!v()}),y(Se,v()?"ðŸ“":"ðŸŽ²"),y(Te,v()?"Edit Mode":"Use Mode")}),F("click",b,()=>r(g,!0)),F("click",Ue,()=>r(ae,!e(ae))),F("click",m,se),Pe(X,k,p=>Va(At,p)),F("click",Ce,()=>r(oe,!0)),F("click",me,()=>{r(E,"save"),r(O,!0)}),F("click",He,()=>{r(E,"load"),r(O,!0)}),F("click",Ne,le),F("click",Qe,Me),F("change",Le,C),o(n,Z),$t(),w()}export{$i as component};
