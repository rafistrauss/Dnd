import{f,e as j,a as v,s as k,c as nt,t as ft}from"../chunks/Bvl623tb.js";import{i as yt}from"../chunks/BkeYosbO.js";import{c as Gt,o as Qt}from"../chunks/C8IfgfH8.js";import{a6 as Ia,i as Ma,aY as za,aZ as Wa,a_ as $a,J as At,e as Pa,a$ as Ea,R as na,b0 as Ka,b1 as Ja,q as Va,b2 as Qa,b3 as Ya,b4 as Xa,aa as Za,b as r,r as Ha,g as es,B as kt,b5 as et,b6 as jt,E as M,F as xt,s as o,a3 as F,G as i,I as a,H as l,d as e,C as We,k as tt,z as T,b7 as Ct,b8 as Kt,b9 as Ta,an as Ua,ba as ts}from"../chunks/AJ6jX9JW.js";import{c as Y,a as gt,e as vt,i as bt,u as Ba,s as Rt,b as dt,d as Yt,f as la,t as Jt,h as as,T as ss,g as ls,j as is}from"../chunks/CWnLr2JQ.js";import{i as C,s as Lt,a as Ke,b as at,d as rs}from"../chunks/950rBGDg.js";import{p as Et,b as _a}from"../chunks/CArcKT0m.js";import{b as Wt,r as ns}from"../chunks/BZE4UN1v.js";function ia(s,n,t=!1){if(s.multiple){if(n==null)return;if(!Ma(n))return za();for(var c of s.options)c.selected=n.includes(Vt(c));return}for(c of s.options){var g=Vt(c);if(Wa(g,n)){c.selected=!0;return}}(!t||n!==void 0)&&(s.selectedIndex=-1)}function ya(s){var n=new MutationObserver(()=>{ia(s,s.__value)});n.observe(s,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Ia(()=>{n.disconnect()})}function Na(s,n,t=n){var c=new WeakSet,g=!0;$a(s,"change",$=>{var D=$?"[selected]":":checked",U;if(s.multiple)U=[].map.call(s.querySelectorAll(D),Vt);else{var y=s.querySelector(D)??s.querySelector("option:not([disabled])");U=y&&Vt(y)}t(U),At!==null&&c.add(At)}),Pa(()=>{var $=n();if(s===document.activeElement){var D=Ea??At;if(c.has(D))return}if(ia(s,$,g),g&&$===void 0){var U=s.querySelector(":checked");U!==null&&($=Vt(U),t($))}s.__value=$,g=!1}),ya(s)}function Vt(s){return"__value"in s?s.__value:s.value}const os=Symbol("is custom element"),cs=Symbol("is html");function Ce(s){if(na){var n=!1,t=()=>{if(!n){if(n=!0,s.hasAttribute("value")){var c=s.value;st(s,"value",null),s.value=c}if(s.hasAttribute("checked")){var g=s.checked;st(s,"checked",null),s.checked=g}}};s.__on_r=t,Va(t),Qa()}}function Sa(s,n){var t=Ca(s);t.value===(t.value=n??void 0)||s.value===n&&(n!==0||s.nodeName!=="PROGRESS")||(s.value=n??"")}function vs(s,n){var t=Ca(s);t.checked!==(t.checked=n??void 0)&&(s.checked=n)}function st(s,n,t,c){var g=Ca(s);na&&(g[n]=s.getAttribute(n),n==="src"||n==="srcset"||n==="href"&&s.nodeName==="LINK")||g[n]!==(g[n]=t)&&(n==="loading"&&(s[Ya]=t),t==null?s.removeAttribute(n):typeof t!="string"&&ds(s).includes(n)?s[n]=t:s.setAttribute(n,t))}function Ca(s){return s.__attributes??={[os]:s.nodeName.includes("-"),[cs]:s.namespaceURI===Ka}}var Da=new Map;function ds(s){var n=s.getAttribute("is")||s.nodeName,t=Da.get(n);if(t)return t;Da.set(n,t=[]);for(var c,g=s,$=Element.prototype;$!==g;){c=Xa(g);for(var D in c)c[D].set&&t.push(D);g=Ja(g)}return t}function Ie(s,n,t=n){var c=new WeakSet;$a(s,"input",async g=>{var $=g?s.defaultValue:s.value;if($=ga(s)?ha($):$,t($),At!==null&&c.add(At),await Za(),$!==($=n())){var D=s.selectionStart,U=s.selectionEnd,y=s.value.length;if(s.value=$??"",U!==null){var P=s.value.length;D===U&&U===y&&P>y?(s.selectionStart=P,s.selectionEnd=P):(s.selectionStart=D,s.selectionEnd=Math.min(U,P))}}}),(na&&s.defaultValue!==s.value||r(n)==null&&s.value)&&(t(ga(s)?ha(s.value):s.value),At!==null&&c.add(At)),Ha(()=>{var g=n();if(s===document.activeElement){var $=Ea??At;if(c.has($))return}ga(s)&&g===ha(s.value)||s.type==="date"&&!g&&!s.value||g!==s.value&&(s.value=g??"")})}function ra(s,n,t=n){$a(s,"change",c=>{var g=c?s.defaultChecked:s.checked;t(g)}),(na&&s.defaultChecked!==s.checked||r(n)==null)&&t(s.checked),Ha(()=>{var c=n();s.checked=!!c})}function ga(s){var n=s.type;return n==="number"||n==="range"}function ha(s){return s===""?null:+s}function us(s,n,t){var c=es(s,n);c&&c.set&&(s[n]=t,Ia(()=>{s[n]=null}))}function La(s){return function(...n){var t=n[0];return t.stopPropagation(),s?.apply(this,n)}}function Bt(s,n){var t=s.$$events?.[n.type],c=Ma(t)?t.slice():t==null?[]:[t];for(var g of c)g.call(this,n)}const ps="";function Ga(...s){return Wt+ps+ns(s[0],s[1])}const ka={paladin:{name:"Paladin",hitDice:"d10",spellcaster:!0,spellcastingAbility:"charisma",spellSlotsByLevel:{1:0,2:2,3:3,4:3,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Divine Sense",type:"uses",maxUses:(s,n=1)=>1+Math.max(1,n),resetOn:"long",description:"Detect celestials, fiends, and undead within 60 feet",minLevel:1},{name:"Lay on Hands",type:"pool",maxPool:s=>s*5,resetOn:"long",description:"Heal wounds or cure disease",minLevel:1},{name:"Divine Smite",type:"spellSlot",description:"Expend spell slot to deal extra radiant damage",minLevel:2,rollable:!0},{name:"Channel Divinity",type:"pool",maxPool:s=>s>=18?3:s>=6?2:1,resetOn:"short",description:"Sacred Weapon or Turn Undead",minLevel:3}]},fighter:{name:"Fighter",hitDice:"d10",spellcaster:!1,features:[{name:"Second Wind",type:"uses",maxUses:1,resetOn:"short",description:"Regain 1d10 + fighter level HP as bonus action",minLevel:1,rollable:!0,rollFormula:s=>`1d10+${s}`},{name:"Action Surge",type:"uses",maxUses:s=>s>=17?2:1,resetOn:"short",description:"Take one additional action on your turn",minLevel:2},{name:"Indomitable",type:"uses",maxUses:s=>s>=17?3:s>=13?2:1,resetOn:"long",description:"Reroll a failed saving throw",minLevel:9}],subclasses:{champion:{name:"Champion",features:[{name:"Improved Critical",type:"info",description:"Critical hit on 19-20",minLevel:3},{name:"Remarkable Athlete",type:"info",description:"Add half proficiency to STR/DEX/CON checks, increase long jump distance",minLevel:7},{name:"Additional Fighting Style",type:"info",description:"Choose a second fighting style",minLevel:10},{name:"Superior Critical",type:"info",description:"Critical hit on 18-20",minLevel:15},{name:"Survivor",type:"info",description:"Regain 5 + CON mod HP at start of turn if below half HP",minLevel:18}]},battlemaster:{name:"Battle Master",features:[{name:"Combat Superiority",type:"uses",maxUses:s=>s>=15?6:s>=7?5:4,resetOn:"short",description:s=>`Use superiority dice (${s>=18?"d12":s>=10?"d10":"d8"}) for maneuvers`,minLevel:3},{name:"Know Your Enemy",type:"info",description:"Learn capabilities of creatures you observe",minLevel:7},{name:"Improved Combat Superiority",type:"info",description:"Superiority dice become d10",minLevel:10},{name:"Relentless",type:"info",description:"Regain 1 superiority die if you have none at start of turn",minLevel:15}]}}},rogue:{name:"Rogue",hitDice:"d8",spellcaster:!1,features:[{name:"Sneak Attack",type:"info",description:s=>`Deal ${Math.ceil(s/2)}d6 extra damage once per turn with advantage or ally nearby`,minLevel:1,rollable:!0,rollFormula:s=>`${Math.ceil(s/2)}d6`},{name:"Cunning Action",type:"info",description:"Dash, Disengage, or Hide as a bonus action",minLevel:2},{name:"Uncanny Dodge",type:"info",description:"Use reaction to halve damage from an attack",minLevel:5},{name:"Evasion",type:"info",description:"Take no damage on successful Dex save (half on fail)",minLevel:7}]},wizard:{name:"Wizard",hitDice:"d6",spellcaster:!0,spellcastingAbility:"intelligence",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Arcane Recovery",type:"uses",maxUses:1,resetOn:"long",description:s=>`Recover spell slots totaling up to ${Math.ceil(s/2)} levels during short rest`,minLevel:1},{name:"Spell Mastery",type:"info",description:"Cast one 1st-level and one 2nd-level spell at will",minLevel:18}]},cleric:{name:"Cleric",hitDice:"d8",spellcaster:!0,spellcastingAbility:"wisdom",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Channel Divinity",type:"pool",maxPool:s=>s>=18?3:s>=6?2:1,resetOn:"short",description:"Turn Undead or domain-specific ability",minLevel:2},{name:"Destroy Undead",type:"info",description:s=>`Channel Divinity destroys undead of CR ${s>=17?4:s>=14?3:s>=11?2:s>=8?1:.5} or lower`,minLevel:5},{name:"Divine Intervention",type:"uses",maxUses:1,resetOn:"long",description:s=>`${s}% chance to succeed, implore deity for aid`,minLevel:10}],subclasses:{war:{name:"War Domain",features:[{name:"War Priest",type:"uses",maxUses:(s,n=1)=>Math.max(1,n),resetOn:"long",description:"Make one weapon attack as a bonus action",minLevel:1},{name:"Guided Strike",type:"channelDivinity",description:"Use your Channel Divinity to gain +10 to an attack roll. Make this choice after you see the roll, but before the DM says whether the attack hits or misses.",minLevel:2,resetOn:"short"},{name:"War God's Blessing",type:"channelDivinity",description:"Use reaction to grant +10 to an ally's attack roll within 30 feet. Consumes one use of Channel Divinity.",minLevel:6,resetOn:"short"},{name:"Divine Strike",type:"info",description:s=>`Deal extra ${s>=14?"2d8":"1d8"} weapon damage once per turn`,minLevel:8,rollable:!0,rollFormula:s=>s>=14?"2d8":"1d8"},{name:"Avatar of Battle",type:"info",description:"Gain resistance to nonmagical weapon damage",minLevel:17}]},life:{name:"Life Domain",features:[{name:"Disciple of Life",type:"info",description:"Healing spells restore additional 2 + spell level HP",minLevel:1},{name:"Preserve Life",type:"pool",maxPool:s=>s*5,resetOn:"short",description:"Restore HP to creatures within 30 feet",minLevel:2},{name:"Blessed Healer",type:"info",description:"Regain 2 + spell level HP when you cast healing spell",minLevel:6},{name:"Divine Strike",type:"info",description:s=>`Deal extra ${s>=14?"2d8":"1d8"} radiant damage once per turn`,minLevel:8,rollable:!0,rollFormula:s=>s>=14?"2d8":"1d8"},{name:"Supreme Healing",type:"info",description:"Maximize healing dice instead of rolling",minLevel:17}]}}},barbarian:{name:"Barbarian",hitDice:"d12",spellcaster:!1,features:[{name:"Rage",type:"uses",maxUses:s=>s>=20?1/0:s>=17?6:s>=12?5:s>=6?4:s>=3?3:2,resetOn:"long",description:s=>`+${s>=16?4:s>=9?3:2} damage, resistance to physical damage`,minLevel:1},{name:"Reckless Attack",type:"info",description:"Gain advantage on melee attacks, enemies get advantage on you",minLevel:2},{name:"Danger Sense",type:"info",description:"Advantage on Dex saves against effects you can see",minLevel:2}],subclasses:{berserker:{name:"Path of the Berserker",features:[{name:"Frenzy",type:"info",description:"While raging, make melee attack as bonus action (gain 1 exhaustion after rage)",minLevel:3},{name:"Mindless Rage",type:"info",description:"Cannot be charmed or frightened while raging",minLevel:6},{name:"Intimidating Presence",type:"info",description:"Use action to frighten creature within 30 feet",minLevel:10},{name:"Retaliation",type:"info",description:"When damaged by creature within 5 feet, make melee attack as reaction",minLevel:14}]}}}};function _t(s){const n=s.toLowerCase();return ka[n]||null}function Nt(s,n,t){const c=_t(s);if(!c)return[];const g=c.features.filter($=>!$.minLevel||$.minLevel<=n);if(t&&c.subclasses&&c.subclasses[t]){const $=c.subclasses[t].features.filter(D=>!D.minLevel||D.minLevel<=n);return[...g,...$]}return g}function wa(s){const n=_t(s);return!n||!n.subclasses?[]:Object.keys(n.subclasses).map(t=>({id:t,name:n.subclasses[t].name}))}function ja(s,n){const t=_t(s);return!t||!t.spellcaster||!t.spellSlotsByLevel?0:t.spellSlotsByLevel[n]||0}function Fa(s,n,t){const c=_t(s);return!c||!c.spellcaster?0:Math.max(1,t+n)}function fs(s,n,t){const c=_t(s);return!c||!c.spellcaster?null:8+n+t}function bs(){return Object.keys(ka).map(s=>({id:s,name:ka[s].name}))}var gs=f("<option> </option>"),hs=f("<option> </option>"),ms=f('<div class="form-group svelte-172i2fj"><label for="characterSubclass" class="svelte-172i2fj">Subclass</label> <select id="characterSubclass" class="svelte-172i2fj"><option>Select Subclass</option><!></select></div>'),_s=f('<div class="info-grid svelte-172i2fj"><div class="form-group svelte-172i2fj"><label for="characterName" class="svelte-172i2fj">Character Name</label> <input type="text" id="characterName" placeholder="Enter name" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterClass" class="svelte-172i2fj">Class</label> <select id="characterClass" class="svelte-172i2fj"><option>Select Class</option><!></select></div> <!> <div class="form-group svelte-172i2fj"><label for="characterLevel" class="svelte-172i2fj">Level</label> <input type="number" id="characterLevel" min="1" max="20" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterRace" class="svelte-172i2fj">Race</label> <input type="text" id="characterRace" placeholder="e.g., Human" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterBackground" class="svelte-172i2fj">Background</label> <input type="text" id="characterBackground" placeholder="e.g., Soldier" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterAlignment" class="svelte-172i2fj">Alignment</label> <input type="text" id="characterAlignment" placeholder="e.g., Lawful Good" class="svelte-172i2fj"/></div></div>'),ys=f('<section class="character-info svelte-172i2fj"><div class="header svelte-172i2fj"><h2 class="svelte-172i2fj">Character Info</h2> <button class="collapse-btn svelte-172i2fj"> </button></div> <!></section>');function ks(s,n){kt(n,!1);const t=()=>Ke(Y,"$character",g),c=()=>Ke(gt,"$collapsedStates",g),[g,$]=Lt(),D=F(),U=bs();function y(E){const ye=E.target;Y.update(ue=>(ue.class=ye.value,ue.subclass="",ue))}function P(E){const ye=E.target;Y.update(ue=>(ue.subclass=ye.value,ue))}function re(E){const ye=E.target;Y.update(ue=>(ue.level=parseInt(ye.value)||1,ue)),Ba()}function J(){gt.update(E=>({...E,characterInfo:!E.characterInfo}))}et(()=>(t(),wa),()=>{o(D,t().class?wa(t().class):[])}),jt(),yt();var B=ys(),He=i(B),ne=a(i(He),2),me=i(ne,!0);l(ne),l(He);var de=a(He,2);{var Le=E=>{var ye=_s(),ue=i(ye),oe=a(i(ue),2);Ce(oe),l(ue);var K=a(ue,2),G=a(i(K),2),X=i(G);X.value=X.__value="";var pe=a(X);vt(pe,1,()=>U,bt,(ee,De)=>{var fe=gs(),ze=i(fe,!0);l(fe);var be={};M(()=>{k(ze,(e(De),r(()=>e(De).name))),be!==(be=(e(De),r(()=>e(De).id)))&&(fe.value=(fe.__value=(e(De),r(()=>e(De).id)))??"")}),v(ee,fe)}),l(G);var V;ya(G),l(K);var Fe=a(K,2);{var L=ee=>{var De=ms(),fe=a(i(De),2),ze=i(fe);ze.value=ze.__value="";var be=a(ze);vt(be,1,()=>e(D),bt,(Ne,Qe)=>{var Ye=hs(),Je=i(Ye,!0);l(Ye);var _={};M(()=>{k(Je,(e(Qe),r(()=>e(Qe).name))),_!==(_=(e(Qe),r(()=>e(Qe).id)))&&(Ye.value=(Ye.__value=(e(Qe),r(()=>e(Qe).id)))??"")}),v(Ne,Ye)}),l(fe);var b;ya(fe),l(De),M(()=>{b!==(b=(t(),r(()=>t().subclass)))&&(fe.value=(fe.__value=(t(),r(()=>t().subclass)))??"",ia(fe,(t(),r(()=>t().subclass))))}),j("change",fe,P),v(ee,De)};C(Fe,ee=>{e(D),r(()=>e(D).length>0)&&ee(L)})}var le=a(Fe,2),Q=a(i(le),2);Ce(Q),l(le);var h=a(le,2),I=a(i(h),2);Ce(I),l(h);var p=a(h,2),q=a(i(p),2);Ce(q),l(p);var Z=a(p,2),z=a(i(Z),2);Ce(z),l(Z),l(ye),M(()=>{V!==(V=(t(),r(()=>t().class)))&&(G.value=(G.__value=(t(),r(()=>t().class)))??"",ia(G,(t(),r(()=>t().class)))),Sa(Q,(t(),r(()=>t().level)))}),Ie(oe,()=>t().name,ee=>at(Y,r(t).name=ee,r(t))),j("change",G,y),j("change",Q,re),Ie(I,()=>t().race,ee=>at(Y,r(t).race=ee,r(t))),Ie(q,()=>t().background,ee=>at(Y,r(t).background=ee,r(t))),Ie(z,()=>t().alignment,ee=>at(Y,r(t).alignment=ee,r(t))),v(E,ye)};C(de,E=>{c(),r(()=>!c().characterInfo)&&E(Le)})}l(B),M(()=>{st(ne,"aria-label",(c(),r(()=>c().characterInfo?"Expand":"Collapse"))),k(me,(c(),r(()=>c().characterInfo?"â–¼":"â–²")))}),j("click",ne,J),v(s,B),xt(),$()}var xs=f('<div class="ability-card svelte-bbv1xt"><h3 class="svelte-bbv1xt"> </h3> <input type="number" class="ability-score svelte-bbv1xt" min="1" max="30"/> <div class="ability-modifier svelte-bbv1xt"> </div> <button class="roll-btn svelte-bbv1xt">Check</button> <div class="save-row svelte-bbv1xt"><input type="checkbox" class="svelte-bbv1xt"/> <label class="svelte-bbv1xt">Save</label> <button class="roll-btn-small svelte-bbv1xt">Roll</button></div></div>'),$s=f('<div class="proficiency-bonus svelte-bbv1xt"><label for="profBonus">Proficiency Bonus</label> <input type="number" id="profBonus" class="prof-input svelte-bbv1xt"/></div> <div class="abilities-grid svelte-bbv1xt"></div>',1),Ss=f('<section><div class="header svelte-bbv1xt"><h2 class="svelte-bbv1xt">Ability Scores</h2> <button class="collapse-btn svelte-bbv1xt"> </button></div> <!></section>');function Cs(s,n){kt(n,!1);const t=()=>Ke(Yt,"$abilityModifiers",D),c=()=>Ke(Y,"$character",D),g=()=>Ke(Rt,"$searchFilter",D),$=()=>Ke(gt,"$collapsedStates",D),[D,U]=Lt(),y=F(),P=F(),re=Gt(),J=[{key:"strength",label:"Strength"},{key:"dexterity",label:"Dexterity"},{key:"constitution",label:"Constitution"},{key:"intelligence",label:"Intelligence"},{key:"wisdom",label:"Wisdom"},{key:"charisma",label:"Charisma"}];function B(){Ba()}function He(G){const X=t()[G],pe=`1d20${X>=0?"+":""}${X}`;re("roll",pe)}function ne(G){const X=t()[G],pe=c().saveProficiencies[G]?c().proficiencyBonus:0,V=X+pe,Fe=`1d20${V>=0?"+":""}${V}`;re("roll",Fe)}function me(){gt.update(G=>({...G,abilityScores:!G.abilityScores}))}et(()=>g(),()=>{o(y,J.filter(({label:G})=>g()?G.toLowerCase().includes(g().toLowerCase()):!0))}),et(()=>(e(y),g()),()=>{o(P,e(y).length>0||!g()||g().toLowerCase().includes("proficiency"))}),jt(),yt();var de=Ss();let Le;var E=i(de),ye=a(i(E),2),ue=i(ye,!0);l(ye),l(E);var oe=a(E,2);{var K=G=>{var X=$s(),pe=We(X),V=a(i(pe),2);Ce(V),l(pe);var Fe=a(pe,2);vt(Fe,5,()=>e(y),bt,(L,le)=>{let Q=()=>e(le).key,h=()=>e(le).label;var I=xs(),p=i(I),q=i(p,!0);l(p);var Z=a(p,2);Ce(Z);var z=a(Z,2),ee=i(z);l(z);var De=a(z,2),fe=a(De,2),ze=i(fe);Ce(ze);var be=a(ze,2),b=a(be,2);l(fe),l(I),M(Ne=>{k(q,Ne),k(ee,`${t(),Q(),r(()=>t()[Q()]>=0?"+":"")??""}${t(),Q(),r(()=>t()[Q()])??""}`),st(ze,"id",`${Q()}-save`),st(be,"for",`${Q()}-save`)},[()=>(h(),r(()=>h().substring(0,3).toUpperCase()))]),Ie(Z,()=>c().abilities[Q()],Ne=>at(Y,r(c).abilities[Q()]=Ne,r(c))),j("change",Z,B),j("click",De,()=>He(Q())),ra(ze,()=>c().saveProficiencies[Q()],Ne=>at(Y,r(c).saveProficiencies[Q()]=Ne,r(c))),j("click",b,()=>ne(Q())),v(L,I)}),l(Fe),Ie(V,()=>c().proficiencyBonus,L=>at(Y,r(c).proficiencyBonus=L,r(c))),v(G,X)};C(oe,G=>{$(),r(()=>!$().abilityScores)&&G(K)})}l(de),M(()=>{Le=dt(de,1,"ability-scores svelte-bbv1xt",null,Le,{hidden:!e(P)}),st(ye,"aria-label",($(),r(()=>$().abilityScores?"Expand":"Collapse"))),k(ue,($(),r(()=>$().abilityScores?"â–¼":"â–²")))}),j("click",ye,me),v(s,de),xt(),U()}function xa(s,n){if(!s.class)return null;const t=_t(s.class);if(!t||!t.spellcaster||!t.spellcastingAbility)return null;const c=n[t.spellcastingAbility];return 8+s.proficiencyBonus+c}var Ls=f('<div class="stat-box svelte-1r5hyyb"><label for="spellSaveDC" class="svelte-1r5hyyb">Spell Save DC</label> <input type="number" id="spellSaveDC" class="stat-input svelte-1r5hyyb" readonly="" title="8 + Proficiency Bonus + Spellcasting Ability Modifier"/></div>'),Ds=f('<span class="hit-dice-type"> </span>'),ws=f('<div class="stats-grid svelte-1r5hyyb"><div class="stat-box svelte-1r5hyyb"><label for="armorClass" class="svelte-1r5hyyb">Armor Class</label> <input type="number" id="armorClass" class="stat-input svelte-1r5hyyb"/></div> <div class="stat-box svelte-1r5hyyb"><label for="initiative" class="svelte-1r5hyyb">Initiative</label> <input type="number" id="initiative" class="stat-input svelte-1r5hyyb"/></div> <div class="stat-box svelte-1r5hyyb"><label for="speed" class="svelte-1r5hyyb">Speed</label> <input type="text" id="speed" class="stat-input svelte-1r5hyyb"/></div> <!></div> <div class="hp-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Points</h3> <div class="hp-display svelte-1r5hyyb"><div class="hp-inputs svelte-1r5hyyb"><input type="number" class="hp-current svelte-1r5hyyb" min="0"/> <span class="hp-separator svelte-1r5hyyb">/</span> <input type="number" class="hp-max svelte-1r5hyyb" min="0"/></div> <div class="hp-controls svelte-1r5hyyb"><button class="hp-btn svelte-1r5hyyb">âˆ’</button> <button class="hp-btn svelte-1r5hyyb">+</button> <button class="hp-btn svelte-1r5hyyb">âˆ’5</button> <button class="hp-btn svelte-1r5hyyb">+5</button></div></div> <div class="temp-hp svelte-1r5hyyb"><label for="tempHP" class="svelte-1r5hyyb">Temp HP</label> <input type="number" id="tempHP" min="0" class="svelte-1r5hyyb"/></div></div> <div class="hit-dice-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Dice</h3> <div class="hit-dice-display svelte-1r5hyyb"><input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <span>/</span> <input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <!></div> <div class="hit-dice-controls"><label for="hitDiceCount" class="svelte-1r5hyyb">Roll</label> <input type="number" id="hitDiceCount" class="hit-dice-count-input svelte-1r5hyyb" min="1" value="1"/> <button class="btn btn-primary roll-hit-dice use-enabled svelte-1r5hyyb">ðŸŽ² Roll</button></div></div>',1),js=f('<section><div class="header svelte-1r5hyyb"><h2 class="svelte-1r5hyyb">Combat Stats</h2> <button class="collapse-btn svelte-1r5hyyb"> </button></div> <!></section>');function Fs(s,n){kt(n,!1);const t=()=>Ke(Y,"$character",D),c=()=>Ke(Yt,"$abilityModifiers",D),g=()=>Ke(Rt,"$searchFilter",D),$=()=>Ke(gt,"$collapsedStates",D),[D,U]=Lt(),y=F(),P=F(),re=Gt();function J(oe){Y.update(K=>(K.currentHP=Math.max(0,Math.min(K.maxHP,K.currentHP+oe)),K))}function B(oe=1){if(t().hitDice.current<=0){alert("No hit dice remaining!");return}if(!t().class){alert("Please select a class first!");return}const K=_t(t().class);if(!K){alert("Invalid class configuration!");return}const G=Math.min(oe,t().hitDice.current),X=K.hitDice,pe=c().constitution,V=pe>=0?`+${pe}`:`${pe}`,Fe=`${G}${X}${V}`;re("rollHitDice",{notation:Fe,hitDie:X,count:G})}function He(){gt.update(oe=>({...oe,combatStats:!oe.combatStats}))}et(()=>(t(),c()),()=>{o(y,xa(t(),c()))}),et(()=>g(),()=>{o(P,!g()||"armor class".includes(g().toLowerCase())||"initiative".includes(g().toLowerCase())||"speed".includes(g().toLowerCase())||"hit points".includes(g().toLowerCase())||"hp".includes(g().toLowerCase())||"hit dice".includes(g().toLowerCase())||"spell save".includes(g().toLowerCase())||"combat".includes(g().toLowerCase()))}),jt(),yt();var ne=js();let me;var de=i(ne),Le=a(i(de),2),E=i(Le,!0);l(Le),l(de);var ye=a(de,2);{var ue=oe=>{var K=ws(),G=We(K),X=i(G),pe=a(i(X),2);Ce(pe),l(X);var V=a(X,2),Fe=a(i(V),2);Ce(Fe),l(V);var L=a(V,2),le=a(i(L),2);Ce(le),l(L);var Q=a(L,2);{var h=N=>{var te=Ls(),x=a(i(te),2);Ce(x),l(te),M(()=>Sa(x,e(y))),v(N,te)};C(Q,N=>{e(y)!==null&&N(h)})}l(G);var I=a(G,2),p=a(i(I),2),q=i(p),Z=i(q);Ce(Z);var z=a(Z,4);Ce(z),l(q);var ee=a(q,2),De=i(ee),fe=a(De,2),ze=a(fe,2),be=a(ze,2);l(ee),l(p);var b=a(p,2),Ne=a(i(b),2);Ce(Ne),l(b),l(I);var Qe=a(I,2),Ye=a(i(Qe),2),Je=i(Ye);Ce(Je);var _=a(Je,4);Ce(_);var W=a(_,2);{var ae=N=>{const te=tt(()=>(T(_t),t(),r(()=>_t(t().class))));var x=nt(),we=We(x);{var ke=Te=>{const qe=tt(()=>(c(),r(()=>c().constitution)));var Ze=Ds(),$e=i(Ze);l(Ze),M(()=>k($e,`(${T(e(te)),r(()=>e(te).hitDice)??""}${(e(qe)>=0?`+${e(qe)}`:e(qe))??""})`)),v(Te,Ze)};C(we,Te=>{e(te)&&Te(ke)})}v(N,x)};C(W,N=>{t(),r(()=>t().class)&&N(ae)})}l(Ye);var ge=a(Ye,2),Oe=a(i(ge),2),Me=a(Oe,2);l(ge),l(Qe),M(()=>{st(Z,"max",(t(),r(()=>t().maxHP))),st(Je,"max",(t(),r(()=>t().hitDice.max))),st(Oe,"max",(t(),r(()=>t().hitDice.current))),Me.disabled=(t(),r(()=>t().hitDice.current<=0||!t().class))}),Ie(pe,()=>t().armorClass,N=>at(Y,r(t).armorClass=N,r(t))),Ie(Fe,()=>t().initiative,N=>at(Y,r(t).initiative=N,r(t))),Ie(le,()=>t().speed,N=>at(Y,r(t).speed=N,r(t))),Ie(Z,()=>t().currentHP,N=>at(Y,r(t).currentHP=N,r(t))),Ie(z,()=>t().maxHP,N=>at(Y,r(t).maxHP=N,r(t))),j("click",De,()=>J(-1)),j("click",fe,()=>J(1)),j("click",ze,()=>J(-5)),j("click",be,()=>J(5)),Ie(Ne,()=>t().tempHP,N=>at(Y,r(t).tempHP=N,r(t))),Ie(Je,()=>t().hitDice.current,N=>at(Y,r(t).hitDice.current=N,r(t))),Ie(_,()=>t().hitDice.max,N=>at(Y,r(t).hitDice.max=N,r(t))),j("input",Oe,N=>{const te=N.target,x=parseInt(te.value);x>t().hitDice.current&&(te.value=String(t().hitDice.current)),x<1&&(te.value="1")}),j("click",Me,()=>{const N=document.getElementById("hitDiceCount"),te=parseInt(N?.value||"1");B(te)}),v(oe,K)};C(ye,oe=>{$(),r(()=>!$().combatStats)&&oe(ue)})}l(ne),M(()=>{me=dt(ne,1,"combat-stats svelte-1r5hyyb",null,me,{hidden:!e(P)}),st(Le,"aria-label",($(),r(()=>$().combatStats?"Expand":"Collapse"))),k(E,($(),r(()=>$().combatStats?"â–¼":"â–²")))}),j("click",Le,He),v(s,ne),xt(),U()}const ma={acrobatics:"dexterity",animalHandling:"wisdom",arcana:"intelligence",athletics:"strength",deception:"charisma",history:"intelligence",insight:"wisdom",intimidation:"charisma",investigation:"intelligence",medicine:"wisdom",nature:"intelligence",perception:"wisdom",performance:"charisma",persuasion:"charisma",religion:"intelligence",sleightOfHand:"dexterity",stealth:"dexterity",survival:"wisdom"};var As=f('<div class="skill-row svelte-1f1pl16"><input type="checkbox" class="svelte-1f1pl16"/> <label class="svelte-1f1pl16"> <span class="ability-tag svelte-1f1pl16"> </span></label> <span class="skill-modifier svelte-1f1pl16"> </span> <button class="roll-btn svelte-1f1pl16">Roll</button></div>'),Rs=f('<div class="skills-grid svelte-1f1pl16"></div>'),Is=f('<section><div class="header svelte-1f1pl16"><h2 class="svelte-1f1pl16">Skills</h2> <button class="collapse-btn svelte-1f1pl16"> </button></div> <!></section>');function Ms(s,n){kt(n,!1);const t=()=>Ke(Yt,"$abilityModifiers",D),c=()=>Ke(Y,"$character",D),g=()=>Ke(Rt,"$searchFilter",D),$=()=>Ke(gt,"$collapsedStates",D),[D,U]=Lt(),y=F(),P=F(),re=Gt(),J=[{key:"acrobatics",label:"Acrobatics"},{key:"animalHandling",label:"Animal Handling"},{key:"arcana",label:"Arcana"},{key:"athletics",label:"Athletics"},{key:"deception",label:"Deception"},{key:"history",label:"History"},{key:"insight",label:"Insight"},{key:"intimidation",label:"Intimidation"},{key:"investigation",label:"Investigation"},{key:"medicine",label:"Medicine"},{key:"nature",label:"Nature"},{key:"perception",label:"Perception"},{key:"performance",label:"Performance"},{key:"persuasion",label:"Persuasion"},{key:"religion",label:"Religion"},{key:"sleightOfHand",label:"Sleight of Hand"},{key:"stealth",label:"Stealth"},{key:"survival",label:"Survival"}];function B(K){const G=ma[K],X=t()[G],pe=c().skillProficiencies[K]?c().proficiencyBonus:0;return X+pe}function He(K){const G=B(K),X=`1d20${G>=0?"+":""}${G}`;re("roll",X)}function ne(){gt.update(K=>({...K,skills:!K.skills}))}et(()=>g(),()=>{o(y,J.filter(({label:K})=>g()?K.toLowerCase().includes(g().toLowerCase()):!0))}),et(()=>e(y),()=>{o(P,e(y).length>0)}),jt(),yt();var me=Is();let de;var Le=i(me),E=a(i(Le),2),ye=i(E,!0);l(E),l(Le);var ue=a(Le,2);{var oe=K=>{var G=Rs();vt(G,5,()=>e(y),bt,(X,pe)=>{let V=()=>e(pe).key,Fe=()=>e(pe).label;const L=tt(()=>(T(ma),V(),r(()=>ma[V()]))),le=tt(()=>(V(),r(()=>B(V()))));var Q=As(),h=i(Q);Ce(h);var I=a(h,2),p=i(I),q=a(p),Z=i(q);l(q),l(I);var z=a(I,2),ee=i(z);l(z);var De=a(z,2);l(Q),M(fe=>{st(h,"id",V()),st(I,"for",V()),k(p,`${Fe()??""} `),k(Z,`(${fe??""})`),k(ee,`${e(le)>=0?"+":""}${e(le)??""}`)},[()=>(T(e(L)),r(()=>e(L).substring(0,3).toUpperCase()))]),ra(h,()=>c().skillProficiencies[V()],fe=>at(Y,r(c).skillProficiencies[V()]=fe,r(c))),j("click",De,()=>He(V())),v(X,Q)}),l(G),v(K,G)};C(ue,K=>{$(),r(()=>!$().skills)&&K(oe)})}l(me),M(()=>{de=dt(me,1,"skills svelte-1f1pl16",null,de,{hidden:!e(P)}),st(E,"aria-label",($(),r(()=>$().skills?"Expand":"Collapse"))),k(ye,($(),r(()=>$().skills?"â–¼":"â–²")))}),j("click",E,ne),v(s,me),xt(),U()}let ta=null,aa=null;async function Oa(){if(ta)return ta;try{return ta=await(await fetch(Ga("/data/spells.json"))).json(),ta||[]}catch(s){return console.error("Failed to load spells:",s),[]}}async function Ps(){if(aa)return aa;try{return aa=await(await fetch(Ga("/data/feats.json"))).json(),aa||[]}catch(s){return console.error("Failed to load feats:",s),[]}}function Aa(s,n){if(!n.trim())return s;const t=n.toLowerCase();return s.filter(c=>c.name.toLowerCase().includes(t)||c.school.toLowerCase().includes(t)||c.classes.some(g=>g.toLowerCase().includes(t))||c.description.toLowerCase().includes(t))}function Es(s,n){return n===null?s:s.filter(t=>t.level===n)}function Hs(s,n){if(!n.trim())return s;const t=n.toLowerCase();return s.filter(c=>c.name.toLowerCase().includes(t)||c.description.toLowerCase().includes(t))}function sa(s){const n=s.description,t=/\b(Strength|Dexterity|Constitution|Intelligence|Wisdom|Charisma)\s+saving\s+throw/i,c=n.match(t);if(!c)return null;const g=c[1].toLowerCase(),D=/half\s+(?:as\s+much\s+)?damage\s+on\s+a\s+successful(?:\s+save)?/i.test(n),y=/saving\s+throw\s+or\s+take.*?damage/i.test(n)&&!D;return{ability:g,halfDamageOnSave:D,noDamageOnSave:y}}var Ts=f('<button class="btn-remove svelte-14o91c5">Ã—</button>'),Us=f('<div class="spell-info-loading svelte-14o91c5">Loading spell info...</div>'),Bs=f('<div class="spell-notes svelte-14o91c5"><h4 class="svelte-14o91c5">General Notes</h4> <p> </p></div>'),Ns=f('<li class="svelte-14o91c5"><strong>At Higher Levels:</strong> </li>'),Gs=f('<ul class="svelte-14o91c5"><li class="svelte-14o91c5"><strong>Level:</strong> </li> <li class="svelte-14o91c5"><strong>Casting Time:</strong> </li> <li class="svelte-14o91c5"><strong>Range:</strong> </li> <li class="svelte-14o91c5"><strong>Components:</strong> <!></li> <li class="svelte-14o91c5"><strong>Duration:</strong> <!> </li> <li class="svelte-14o91c5"><strong>Description:</strong> </li> <!></ul>'),Os=f("<option> </option>"),qs=f('<span class="scaled-damage svelte-14o91c5"><!> </span>'),zs=f('<span class="scaled-damage svelte-14o91c5"> </span>'),Ws=f('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> Target is Fiend or Undead <!></label></div>'),Ks=f('<span class="scaled-damage svelte-14o91c5" style="margin-left: 8px;"> </span>'),Js=f('<span class="scaled-damage svelte-14o91c5">(Half damage)</span>'),Vs=f('<span class="scaled-damage svelte-14o91c5">(No damage)</span>'),Qs=f('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> <!> <!></label></div>'),Ys=f('<div class="spell-level-selector svelte-14o91c5"><label class="svelte-14o91c5">Cast at Level:</label> <select class="spell-level-select use-enabled svelte-14o91c5"></select> <!></div> <!> <!>',1),Xs=f('<div class="spell-level-selector svelte-14o91c5"><span style="color: #dc3545; font-weight: bold;">No spell slots available!</span></div>'),Zs=f('<!> <div class="spell-info svelte-14o91c5"><div class="spell-info-header svelte-14o91c5" role="button" tabindex="0"><h4 class="svelte-14o91c5">Spell Info</h4> <button class="collapse-btn-small svelte-14o91c5"> </button></div> <!></div> <!>',1),el=f('<div class="spell-info-missing svelte-14o91c5">Spell info not found.</div>'),tl=f('<div class="attack-notes svelte-14o91c5"><label class="svelte-14o91c5">Notes</label> <textarea placeholder="e.g., DC 15 Dex save, Range 120 ft, Concentration" class="notes-input svelte-14o91c5" rows="2"></textarea></div>'),al=f('<button class="btn btn-primary">Roll Attack</button>'),sl=f('<button class="btn btn-secondary"><!></button>'),ll=f('<button class="btn btn-secondary">Roll Damage</button>'),il=f('<div class="attack-card svelte-14o91c5"><div class="attack-header svelte-14o91c5"><input type="text" placeholder="Attack name" class="attack-name svelte-14o91c5"/> <!></div> <div class="attack-details svelte-14o91c5"><div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Bonus</label> <input type="number" class="attack-bonus svelte-14o91c5"/></div> <div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Damage</label> <input type="text" placeholder="e.g., 2d6+3" class="attack-damage svelte-14o91c5"/></div> <div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Type</label> <input type="text" placeholder="e.g., slashing" class="attack-type svelte-14o91c5"/></div></div> <!> <!> <div class="attack-actions svelte-14o91c5"><!> <!></div></div>'),rl=f('<p class="no-attacks svelte-14o91c5">No attacks added yet. Click "Add Attack" to create one.</p>'),nl=f('<p class="no-attacks svelte-14o91c5">No attacks match your search.</p>'),ol=f('<button class="btn btn-secondary">Add Attack</button> <div class="attacks-list svelte-14o91c5"><!> <!></div>',1),cl=f('<section><div class="header svelte-14o91c5"><h2 class="svelte-14o91c5">Attacks & Spells</h2> <button class="collapse-btn svelte-14o91c5"> </button></div> <!></section>');function vl(s,n){kt(n,!1);const t=()=>Ke(Y,"$character",U),c=()=>Ke(Rt,"$searchFilter",U),g=()=>Ke(gt,"$collapsedStates",U),$=()=>Ke(la,"$isEditMode",U),D=()=>Ke(Yt,"$abilityModifiers",U),[U,y]=Lt(),P=F(),re=F(),J=Gt();let B=F({});function He(p){Ta(B,e(B)[p]=!e(B)[p]),o(B,{...e(B)})}function ne(p){return p.description.toLowerCase().includes("regain")&&(p.description.toLowerCase().includes("hit point")||p.description.toLowerCase().includes("hp"))}function me(){Y.update(p=>(p.attacks=[...p.attacks,{id:crypto.randomUUID(),name:"",bonus:0,damage:"",damageType:"",notes:""}],p))}function de(p){Y.update(q=>(q.attacks=q.attacks.filter(Z=>Z.id!==p),q))}function Le(p){let q=p.damage,Z=!1;if(p.spellRef){const ee=K(p.spellRef);if(ee&&ee.level>0){const De=p.castAtLevel||ee.level;if(!G(De)){alert(`No level ${De} spell slots available!`);return}const ze=sa(ee);ze&&p.targetSucceededSave&&ze.noDamageOnSave?q="0":(Z=ze?.halfDamageOnSave&&p.targetSucceededSave||!1,q=X(p,ee))}}const z=`1d20${p.bonus>=0?"+":""}${p.bonus}`;J("roll",{notation:z,damageNotation:q,attackName:p.name,applyHalfDamage:Z})}function E(p){if(!p.damage){alert(`${p.name}: No damage specified`);return}let q=p.damage,Z=!1;if(p.spellRef){const z=K(p.spellRef);if(z&&z.level>0){const ee=p.castAtLevel||z.level;if(!G(ee)){alert(`No level ${ee} spell slots available!`);return}const fe=sa(z);fe&&p.targetSucceededSave&&fe.noDamageOnSave?q="0":(Z=fe?.halfDamageOnSave&&p.targetSucceededSave||!1,q=X(p,z))}}J("roll",{notation:q,attackName:p.name,applyHalfDamage:Z})}function ye(){gt.update(p=>({...p,attacks:!p.attacks}))}let ue=F([]),oe=F(!1);Qt(async()=>{o(ue,await Oa()),o(oe,!0)});function K(p){return e(ue).find(q=>q.name===p)}function G(p){t().classFeatures.spellSlotsByLevel||at(Y,r(t).classFeatures.spellSlotsByLevel={},r(t)),t().classFeatures.spellSlotsByLevel[p]||at(Y,r(t).classFeatures.spellSlotsByLevel[p]=Array(2).fill(!1),r(t));const Z=t().classFeatures.spellSlotsByLevel[p].findIndex(z=>!z);return Z===-1?!1:(Y.update(z=>(z.classFeatures.spellSlotsByLevel||(z.classFeatures.spellSlotsByLevel={}),z.classFeatures.spellSlotsByLevel[p]||(z.classFeatures.spellSlotsByLevel[p]=Array(2).fill(!1)),z.classFeatures.spellSlotsByLevel[p][Z]=!0,z)),!0)}function X(p,q){let Z=p.damage,z=0;if(q.higherLevelSlot&&p.castAtLevel){const be=q.level,Ne=(p.castAtLevel||be)-be;if(Ne>0){const Qe=q.higherLevelSlot.match(/(\d+)d(\d+)\s+for\s+each.*?level\s+above/i);if(Qe){const[,Ye]=Qe;z+=Ne*parseInt(Ye)}}}if(p.targetIsFiendOrUndead&&q.description.includes("Fiend or an Undead")){const be=q.description.match(/increases by (\d+)d(\d+) if.*?Fiend or.*?Undead/i);if(be){const[,b]=be;z+=parseInt(b)}}const ee=Z.match(/(\d+)d(\d+)/);if(!ee)return Z;const[,De,fe]=ee;return`${parseInt(De)+z}d${fe}`}function pe(p){const q=[];for(let z=p.level;z<=9;z++){const ee=t().classFeatures.spellSlotsByLevel?.[z];ee&&ee.length>0&&q.push(z)}return q}et(()=>(t(),c()),()=>{o(P,t().attacks.filter(p=>{if(!c())return!0;const q=c().toLowerCase();return p.name.toLowerCase().includes(q)||p.damageType.toLowerCase().includes(q)}).sort((p,q)=>!p.spellRef&&q.spellRef?-1:p.spellRef&&!q.spellRef?1:0))}),et(()=>(c(),e(P)),()=>{o(re,!c()||e(P).length>0||"attack".includes(c().toLowerCase())||"spell".includes(c().toLowerCase()))}),jt(),yt();var V=cl();let Fe;var L=i(V),le=a(i(L),2),Q=i(le,!0);l(le),l(L);var h=a(L,2);{var I=p=>{var q=ol(),Z=We(q),z=a(Z,2),ee=i(z);vt(ee,1,()=>e(P),be=>be.id,(be,b,Ne)=>{var Qe=il(),Ye=i(Qe),Je=i(Ye);Ce(Je);var _=a(Je,2);{var W=A=>{var O=Ts();j("click",O,()=>de(e(b).id)),v(A,O)};C(_,A=>{$()&&A(W)})}l(Ye);var ae=a(Ye,2),ge=i(ae),Oe=a(i(ge),2);Ce(Oe),l(ge);var Me=a(ge,2),N=a(i(Me),2);Ce(N),l(Me);var te=a(Me,2),x=a(i(te),2);Ce(x),l(te),l(ae);var we=a(ae,2);{var ke=A=>{var O=nt(),d=We(O);{var w=R=>{var m=Us();v(R,m)},H=R=>{const m=tt(()=>(e(b),r(()=>K(e(b).spellRef))));var ce=nt(),je=We(ce);{var ve=u=>{var se=Zs(),S=We(se);{var xe=rt=>{var lt=Bs(),ut=a(i(lt),2),Mt=i(ut,!0);l(ut),l(lt),M(()=>k(Mt,(e(b),r(()=>e(b).generalNotes)))),v(rt,lt)};C(S,rt=>{e(b),r(()=>e(b).generalNotes)&&rt(xe)})}var Be=a(S,2),Ve=i(Be),Pe=a(i(Ve),2),Ee=i(Pe,!0);l(Pe),l(Ve);var Re=a(Ve,2);{var he=rt=>{var lt=Gs(),ut=i(lt),Mt=a(i(ut));l(ut);var Ot=a(ut,2),ca=a(i(Ot));l(Ot);var $t=a(Ot,2),ht=a(i($t));l($t);var Ht=a($t,2),Tt=a(i(Ht)),Xt=a(Tt);{var Pt=Xe=>{var it=ft();M(()=>k(it,`(${T(e(m)),r(()=>e(m).material)??""})`)),v(Xe,it)};C(Xt,Xe=>{T(e(m)),r(()=>e(m).material)&&Xe(Pt)})}l(Ht);var qt=a(Ht,2),Zt=a(i(qt),2);{var ea=Xe=>{var it=ft("Concentration,");v(Xe,it)};C(Zt,Xe=>{T(e(m)),r(()=>e(m).concentration)&&Xe(ea)})}var va=a(Zt,1,!0);l(qt);var zt=a(qt,2),da=a(i(zt));l(zt);var ot=a(zt,2);{var ct=Xe=>{var it=Ns(),mt=a(i(it));l(it),M(()=>k(mt,` ${T(e(m)),r(()=>e(m).higherLevelSlot)??""}`)),v(Xe,it)};C(ot,Xe=>{T(e(m)),r(()=>e(m).higherLevelSlot)&&Xe(ct)})}l(lt),M(Xe=>{k(Mt,` ${T(e(m)),r(()=>e(m).level)??""}`),k(ca,` ${T(e(m)),r(()=>e(m).castingTime||e(m).actionType)??""}`),k(ht,` ${T(e(m)),r(()=>e(m).range)??""}`),k(Tt,` ${Xe??""}`),k(va,(T(e(m)),r(()=>e(m).duration))),k(da,` ${T(e(m)),r(()=>e(m).description)??""}`)},[()=>(T(e(m)),r(()=>e(m).components.join(", ")))]),v(rt,lt)};C(Re,rt=>{e(B),e(b),r(()=>!e(B)[e(b).id])&&rt(he)})}l(Be);var _e=a(Be,2);{var It=rt=>{const lt=tt(()=>(T(e(m)),r(()=>pe(e(m)))));var ut=nt(),Mt=We(ut);{var Ot=$t=>{const ht=tt(()=>(T(sa),T(e(m)),r(()=>sa(e(m)))));var Ht=Ys(),Tt=We(Ht),Xt=i(Tt),Pt=a(Xt,2);M(()=>{e(b),Ct(()=>{e(lt)})}),vt(Pt,5,()=>e(lt),bt,(ot,ct)=>{var Xe=Os(),it=i(Xe);l(Xe);var mt={};M(()=>{k(it,`Level ${e(ct)??""}`),mt!==(mt=e(ct))&&(Xe.value=(Xe.__value=e(ct))??"")}),v(ot,Xe)}),l(Pt);var qt=a(Pt,2);{var Zt=ot=>{const ct=tt(()=>(e(b),T(e(m)),r(()=>X(e(b),e(m)))));var Xe=qs(),it=i(Xe);{var mt=St=>{var wt=ft("Healing");v(St,wt)},Ut=St=>{var wt=ft("Damage");v(St,wt)};C(it,St=>{T(e(m)),r(()=>ne(e(m)))?St(mt):St(Ut,!1)})}var Dt=a(it);l(Xe),M(()=>k(Dt,` ${e(ct)??""}`)),v(ot,Xe)};C(qt,ot=>{e(b),T(e(m)),r(()=>e(b).castAtLevel&&e(b).castAtLevel>e(m).level)&&ot(Zt)})}l(Tt);var ea=a(Tt,2);{var va=ot=>{var ct=Ws(),Xe=i(ct),it=i(Xe);Ce(it);var mt=a(it,2);{var Ut=Dt=>{const St=tt(()=>(e(b),T(e(m)),r(()=>X(e(b),e(m)))));var wt=zs(),ua=i(wt);l(wt),M(()=>k(ua,`(+1d8, total: ${e(St)??""})`)),v(Dt,wt)};C(mt,Dt=>{e(b),r(()=>e(b).targetIsFiendOrUndead)&&Dt(Ut)})}l(Xe),l(ct),ra(it,()=>e(b).targetIsFiendOrUndead,Dt=>(e(b).targetIsFiendOrUndead=Dt,Ct(()=>(e(P),t(),c())))),v(ot,ct)};C(ea,ot=>{T(e(m)),r(()=>e(m).description.includes("Fiend or an Undead"))&&ot(va)})}var zt=a(ea,2);{var da=ot=>{var ct=Qs(),Xe=i(ct),it=i(Xe);Ce(it);var mt=a(it),Ut=a(mt);{var Dt=pt=>{var Ft=Ks(),pa=i(Ft);l(Ft),M(fa=>k(pa,`(Spell Save DC: ${fa??""})`),[()=>(T(xa),t(),D(),r(()=>xa(t(),D())))]),v(pt,Ft)};C(Ut,pt=>{t(),r(()=>t().class)&&pt(Dt)})}var St=a(Ut,2);{var wt=pt=>{var Ft=Js();v(pt,Ft)},ua=pt=>{var Ft=nt(),pa=We(Ft);{var fa=ba=>{var qa=Vs();v(ba,qa)};C(pa,ba=>{e(b),T(e(ht)),r(()=>e(b).targetSucceededSave&&e(ht).noDamageOnSave)&&ba(fa)},!0)}v(pt,Ft)};C(St,pt=>{e(b),T(e(ht)),r(()=>e(b).targetSucceededSave&&e(ht).halfDamageOnSave)?pt(wt):pt(ua,!1)})}l(Xe),l(ct),M(pt=>k(mt,` Target succeeded on ${pt??""} save `),[()=>(T(e(ht)),r(()=>e(ht).ability.charAt(0).toUpperCase()+e(ht).ability.slice(1)))]),ra(it,()=>e(b).targetSucceededSave,pt=>(e(b).targetSucceededSave=pt,Ct(()=>(e(P),t(),c())))),v(ot,ct)};C(zt,ot=>{e(ht)&&ot(da)})}M(()=>{st(Xt,"for",`castLevel-${e(b),r(()=>e(b).id)??""}`),st(Pt,"id",`castLevel-${e(b),r(()=>e(b).id)??""}`)}),Na(Pt,()=>e(b).castAtLevel,ot=>(e(b).castAtLevel=ot,Ct(()=>(e(P),t(),c())))),v($t,Ht)},ca=$t=>{var ht=Xs();v($t,ht)};C(Mt,$t=>{T(e(lt)),r(()=>e(lt).length>0)?$t(Ot):$t(ca,!1)})}v(rt,ut)};C(_e,rt=>{T(e(m)),r(()=>e(m).higherLevelSlot&&e(m).level>0)&&rt(It)})}M(()=>{st(Pe,"aria-label",(e(B),e(b),r(()=>e(B)[e(b).id]?"Expand":"Collapse"))),k(Ee,(e(B),e(b),r(()=>e(B)[e(b).id]?"â–¼":"â–²")))}),j("click",Ve,()=>He(e(b).id)),j("keydown",Ve,rt=>rt.key==="Enter"&&He(e(b).id)),v(u,se)},Ue=u=>{var se=el();v(u,se)};C(je,u=>{e(m)?u(ve):u(Ue,!1)})}v(R,ce)};C(d,R=>{e(ue),r(()=>e(ue).length===0)?R(w):R(H,!1)})}v(A,O)};C(we,A=>{e(b),r(()=>e(b).spellRef)&&A(ke)})}var Te=a(we,2);{var qe=A=>{var O=tl(),d=a(i(O),2);Kt(d),l(O),Ie(d,()=>e(b).notes,w=>(e(b).notes=w,Ct(()=>(e(P),t(),c())))),v(A,O)};C(Te,A=>{e(b),r(()=>!e(b).spellRef)&&A(qe)})}var Ze=a(Te,2),$e=i(Ze);{var ie=A=>{var O=al();j("click",O,()=>Le(e(b))),v(A,O)};C($e,A=>{e(b),r(()=>e(b).bonus!==0||!e(b).spellRef)&&A(ie)})}var Se=a($e,2);{var Ge=A=>{const O=tt(()=>(e(b),r(()=>K(e(b).spellRef))));var d=sl(),w=i(d);{var H=m=>{var ce=ft("Roll Healing");v(m,ce)},R=m=>{var ce=ft("Roll Damage");v(m,ce)};C(w,m=>{T(e(O)),r(()=>e(O)&&ne(e(O)))?m(H):m(R,!1)})}l(d),j("click",d,()=>E(e(b))),v(A,d)},Ae=A=>{var O=ll();j("click",O,()=>E(e(b))),v(A,O)};C(Se,A=>{e(b),e(oe),r(()=>e(b).spellRef&&e(oe))?A(Ge):A(Ae,!1)})}l(Ze),l(Qe),Ie(Je,()=>e(b).name,A=>(e(b).name=A,Ct(()=>(e(P),t(),c())))),Ie(Oe,()=>e(b).bonus,A=>(e(b).bonus=A,Ct(()=>(e(P),t(),c())))),Ie(N,()=>e(b).damage,A=>(e(b).damage=A,Ct(()=>(e(P),t(),c())))),Ie(x,()=>e(b).damageType,A=>(e(b).damageType=A,Ct(()=>(e(P),t(),c())))),v(be,Qe)});var De=a(ee,2);{var fe=be=>{var b=rl();v(be,b)},ze=be=>{var b=nt(),Ne=We(b);{var Qe=Ye=>{var Je=nl();v(Ye,Je)};C(Ne,Ye=>{e(P),r(()=>e(P).length===0)&&Ye(Qe)},!0)}v(be,b)};C(De,be=>{t(),r(()=>t().attacks.length===0)?be(fe):be(ze,!1)})}l(z),j("click",Z,me),v(p,q)};C(h,p=>{g(),r(()=>!g().attacks)&&p(I)})}l(V),M(()=>{Fe=dt(V,1,"attacks svelte-14o91c5",null,Fe,{hidden:!e(re)}),st(le,"aria-label",(g(),r(()=>g().attacks?"Expand":"Collapse"))),k(Q,(g(),r(()=>g().attacks?"â–¼":"â–²")))}),j("click",le,ye),v(s,V),xt(),y()}var dl=f('<p class="no-features svelte-1kpvv0n">Select a class to see available features</p>'),ul=f('<p class="no-features svelte-1kpvv0n">No class features available at this level</p>'),pl=f('<input type="checkbox" class="slot-checkbox svelte-1kpvv0n"/>'),fl=f('<div class="spell-slots svelte-1kpvv0n"><label class="svelte-1kpvv0n"> </label> <div class="slots-tracker svelte-1kpvv0n"></div></div>'),bl=f('<div class="all-spell-slots"></div>'),gl=f('<div class="feature-box spellcasting svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"> </h3> <div class="spell-stats svelte-1kpvv0n"><div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Spell Save DC</label> <div class="spell-value svelte-1kpvv0n"> </div></div> <div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <div class="spell-value svelte-1kpvv0n"> </div></div></div> <!> <div class="prepared-spells svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <textarea placeholder="List your prepared spells..." class="svelte-1kpvv0n"></textarea></div></div>'),hl=f('<p class="unlimited svelte-1kpvv0n">Unlimited Uses</p>'),ml=f('<p class="no-uses svelte-1kpvv0n">No uses remaining</p>'),_l=f('<div class="uses-with-button svelte-1kpvv0n"><button class="btn btn-primary use-enabled"> </button> <div class="uses-info svelte-1kpvv0n"><span class="uses-remaining svelte-1kpvv0n"> </span> <span class="reset-info svelte-1kpvv0n"> </span></div> <!></div>'),yl=f('<div class="uses-tracker svelte-1kpvv0n"><!></div>'),kl=f('<div class="pool-tracker svelte-1kpvv0n"><input type="number" min="0" class="pool-input svelte-1kpvv0n"/> <span> </span> <button class="btn-small svelte-1kpvv0n"> </button></div>'),xl=f('<p class="no-uses svelte-1kpvv0n">No Channel Divinity uses remaining</p>'),$l=f('<div class="channel-divinity-option svelte-1kpvv0n"><button class="btn btn-primary use-enabled svelte-1kpvv0n">Use Channel Divinity</button> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div> <!></div>'),Sl=f('<div class="feature-box svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"><!> </h3> <p class="feature-description svelte-1kpvv0n"> </p> <!></div>'),Cl=f('<div class="features-grid svelte-1kpvv0n"><!> <!></div>'),Ll=f('<section><div class="header svelte-1kpvv0n"><h2 class="svelte-1kpvv0n">Class Features</h2> <button class="collapse-btn svelte-1kpvv0n"> </button></div> <!></section>');function Dl(s,n){kt(n,!1);const t=()=>Ke(Y,"$character",D),c=()=>Ke(Yt,"$abilityModifiers",D),g=()=>Ke(Rt,"$searchFilter",D),$=()=>Ke(gt,"$collapsedStates",D),[D,U]=Lt(),y=F(),P=F(),re=F(),J=F(),B=F(),He=F(),ne=F();let me=F(0),de=F(0);function Le(h,I){Y.update(p=>(p.classFeatures.features[h]=I,p))}function E(){Y.update(h=>(h.classFeatures.spellSlotsByLevel||(h.classFeatures.spellSlotsByLevel={}),e(J).forEach(({level:I,slots:p})=>{h.classFeatures.spellSlotsByLevel[I]||(h.classFeatures.spellSlotsByLevel[I]=Array(p).fill(!1))}),h))}function ye(h){if(typeof h.maxUses=="function"){if((h.name==="Divine Sense"||h.name==="War Priest")&&e(y)?.spellcastingAbility){const I=c()[e(y).spellcastingAbility];return h.maxUses(t().level,I)}return h.maxUses(t().level)}return h.maxUses||0}function ue(h){return typeof h.maxPool=="function"?h.maxPool(t().level):h.maxPool||0}function oe(h){return typeof h.description=="function"?h.description(t().level):h.description}function K(){const h="ChannelDivinity";Y.update(I=>{const p=I.classFeatures.features[h];return typeof p=="number"&&p>0&&(I.classFeatures.features[h]=p-1),I})}function G(){gt.update(h=>({...h,classFeatures:!h.classFeatures}))}et(()=>(t(),_t),()=>{o(y,t().class?_t(t().class):null)}),et(()=>(t(),Nt),()=>{o(P,t().class?Nt(t().class,t().level,t().subclass):[])}),et(()=>(t(),ja),()=>{o(re,t().class?ja(t().class,t().level):0)}),et(()=>(e(y),t()),()=>{o(J,(()=>{if(!e(y)?.spellcaster)return[];const h=t().level,I=[];return h>=1&&I.push({level:1,slots:Math.min(4,2+Math.floor(h/3))}),h>=3&&I.push({level:2,slots:Math.min(3,2+Math.floor((h-3)/4))}),h>=5&&I.push({level:3,slots:Math.min(3,2+Math.floor((h-5)/5))}),h>=7&&I.push({level:4,slots:Math.min(3,1+Math.floor((h-7)/6))}),h>=9&&I.push({level:5,slots:Math.min(2,1+Math.floor((h-9)/8))}),h>=11&&I.push({level:6,slots:1}),h>=13&&I.push({level:7,slots:1}),h>=15&&I.push({level:8,slots:1}),h>=17&&I.push({level:9,slots:1}),I})())}),et(()=>(e(y),c(),t(),Fa),()=>{if(e(y)?.spellcaster&&e(y).spellcastingAbility){const h=c()[e(y).spellcastingAbility];o(me,fs(t().class,h,t().proficiencyBonus)||0),o(de,Fa(t().class,t().level,h))}}),et(()=>(t(),e(y),e(J)),()=>{t().class&&e(y)?.spellcaster&&e(J).length>0&&E()}),et(()=>t(),()=>{o(B,(()=>{const I=t().classFeatures.features["ChannelDivinity"];return typeof I=="number"?I:0})())}),et(()=>(e(P),g()),()=>{o(He,e(P).filter(h=>{if(!g())return!0;const I=g().toLowerCase();return h.name.toLowerCase().includes(I)||oe(h).toLowerCase().includes(I)}))}),et(()=>(g(),t(),e(He)),()=>{o(ne,!g()||t().class||"class features".includes(g().toLowerCase())||"spellcasting".includes(g().toLowerCase())||e(He).length>0)}),jt(),yt();var X=Ll();let pe;var V=i(X),Fe=a(i(V),2),L=i(Fe,!0);l(Fe),l(V);var le=a(V,2);{var Q=h=>{var I=nt(),p=We(I);{var q=z=>{var ee=dl();v(z,ee)},Z=z=>{var ee=nt(),De=We(ee);{var fe=be=>{var b=ul();v(be,b)},ze=be=>{var b=Cl(),Ne=i(b);{var Qe=Je=>{var _=gl(),W=i(_),ae=i(W);l(W);var ge=a(W,2),Oe=i(ge),Me=a(i(Oe),2),N=i(Me,!0);l(Me),l(Oe);var te=a(Oe,2),x=a(i(te),2),we=i(x,!0);l(x),l(te),l(ge);var ke=a(ge,2);{var Te=$e=>{var ie=bl();vt(ie,5,()=>e(J),bt,(Se,Ge)=>{let Ae=()=>e(Ge).level,A=()=>e(Ge).slots;const O=tt(()=>(t(),Ae(),A(),r(()=>t().classFeatures.spellSlotsByLevel?.[Ae()]||Array(A()).fill(!1))));var d=fl(),w=i(d),H=i(w);l(w);var R=a(w,2);vt(R,5,()=>e(O),bt,(m,ce,je)=>{var ve=pl();Ce(ve),M(()=>vs(ve,(T(e(O)),r(()=>e(O)[je]||!1)))),j("change",ve,Ue=>{Y.update(u=>(u.classFeatures.spellSlotsByLevel||(u.classFeatures.spellSlotsByLevel={}),u.classFeatures.spellSlotsByLevel[Ae()]||(u.classFeatures.spellSlotsByLevel[Ae()]=Array(A()).fill(!1)),u.classFeatures.spellSlotsByLevel[Ae()][je]=Ue.currentTarget.checked,u))}),v(m,ve)}),l(R),l(d),M(()=>k(H,`${Ae()===1?"1st":Ae()===2?"2nd":Ae()===3?"3rd":`${Ae()}th`} Level Spell Slots`)),v(Se,d)}),l(ie),v($e,ie)};C(ke,$e=>{e(J),r(()=>e(J).length>0)&&$e(Te)})}var qe=a(ke,2),Ze=a(i(qe),2);Kt(Ze),l(qe),l(_),M($e=>{k(ae,`Spellcasting (${$e??""})`),k(N,e(me)),k(we,e(de))},[()=>(e(y),r(()=>e(y).spellcastingAbility?.toUpperCase()))]),Ie(Ze,()=>t().classFeatures.preparedSpells,$e=>at(Y,r(t).classFeatures.preparedSpells=$e,r(t))),v(Je,_)};C(Ne,Je=>{e(y),r(()=>e(y)?.spellcaster)&&Je(Qe)})}var Ye=a(Ne,2);vt(Ye,1,()=>e(He),bt,(Je,_)=>{const W=tt(()=>(e(_),r(()=>e(_).name.replace(/\s+/g,"")))),ae=tt(()=>(t(),T(e(W)),r(()=>t().classFeatures.features[e(W)]))),ge=tt(()=>(T(e(ae)),r(()=>Array.isArray(e(ae))))),Oe=tt(()=>typeof e(ae)=="number");var Me=Sl(),N=i(Me),te=i(N);{var x=ie=>{var Se=ft("Channel Divinity:");v(ie,Se)};C(te,ie=>{e(_),r(()=>e(_).type==="channelDivinity")&&ie(x)})}var we=a(te);l(N);var ke=a(N,2),Te=i(ke,!0);l(ke);var qe=a(ke,2);{var Ze=ie=>{const Se=tt(()=>(e(_),r(()=>ye(e(_))))),Ge=tt(()=>(T(e(ge)),T(e(Se)),T(e(ae)),r(()=>e(ge)?e(ae).filter(H=>!H).length:e(Se))));var Ae=yl(),A=i(Ae);{var O=w=>{var H=hl();v(w,H)},d=w=>{var H=_l(),R=i(H),m=i(R);l(R);var ce=a(R,2),je=i(ce),ve=i(je);l(je);var Ue=a(je,2),u=i(Ue);l(Ue),l(ce);var se=a(ce,2);{var S=xe=>{var Be=ml();v(xe,Be)};C(se,xe=>{e(Ge)<=0&&xe(S)})}l(H),M(()=>{R.disabled=e(Ge)<=0,k(m,`Use ${e(_),r(()=>e(_).name)??""}`),k(ve,`${e(Ge)??""} / ${e(Se)??""} uses`),k(u,`Resets on ${e(_),r(()=>e(_).resetOn==="short"?"Short Rest":"Long Rest")??""}`)}),j("click",R,()=>{Y.update(xe=>{xe.classFeatures.features[e(W)]||(xe.classFeatures.features[e(W)]=Array(e(Se)).fill(!1));const Be=xe.classFeatures.features[e(W)],Ve=Be.findIndex(Pe=>!Pe);return Ve!==-1&&(Be[Ve]=!0),xe})}),v(w,H)};C(A,w=>{e(Se)===1/0?w(O):w(d,!1)})}l(Ae),v(ie,Ae)},$e=ie=>{var Se=nt(),Ge=We(Se);{var Ae=O=>{const d=tt(()=>(e(_),r(()=>ue(e(_)))));var w=kl(),H=i(w);Ce(H);var R=a(H,2),m=i(R);l(R);var ce=a(R,2),je=i(ce,!0);l(ce),l(w),M(()=>{Sa(H,e(Oe)&&e(ae)!==void 0?e(ae):e(d)),st(H,"max",e(d)),k(m,`/ ${e(d)??""}`),k(je,(e(_),r(()=>e(_).resetOn==="short"?"Short Rest":"Long Rest")))}),j("input",H,ve=>{Y.update(Ue=>(Ue.classFeatures.features[e(W)]=parseInt(ve.currentTarget.value)||0,Ue))}),j("click",ce,()=>Le(e(W),e(d))),v(O,w)},A=O=>{var d=nt(),w=We(d);{var H=R=>{var m=$l(),ce=i(m),je=a(ce,2),ve=i(je),Ue=i(ve);l(ve),l(je);var u=a(je,2);{var se=S=>{var xe=xl();v(S,xe)};C(u,S=>{e(B)<=0&&S(se)})}l(m),M(()=>{ce.disabled=e(B)<=0,k(Ue,`Resets on ${e(_),r(()=>e(_).resetOn==="short"?"Short Rest":"Long Rest")??""}`)}),j("click",ce,K),v(R,m)};C(w,R=>{e(_),r(()=>e(_).type==="channelDivinity")&&R(H)},!0)}v(O,d)};C(Ge,O=>{e(_),r(()=>e(_).type==="pool")?O(Ae):O(A,!1)},!0)}v(ie,Se)};C(qe,ie=>{e(_),r(()=>e(_).type==="uses")?ie(Ze):ie($e,!1)})}l(Me),M(ie=>{k(we,` ${e(_),r(()=>e(_).name)??""}`),k(Te,ie)},[()=>(e(_),r(()=>oe(e(_))))]),v(Je,Me)}),l(b),v(be,b)};C(De,be=>{e(P),r(()=>e(P).length===0)?be(fe):be(ze,!1)},!0)}v(z,ee)};C(p,z=>{t(),r(()=>!t().class)?z(q):z(Z,!1)})}v(h,I)};C(le,h=>{$(),r(()=>!$().classFeatures)&&h(Q)})}l(X),M(()=>{pe=dt(X,1,"class-features svelte-1kpvv0n",null,pe,{hidden:!e(ne)}),st(Fe,"aria-label",($(),r(()=>$().classFeatures?"Expand":"Collapse"))),k(L,($(),r(()=>$().classFeatures?"â–¼":"â–²")))}),j("click",Fe,G),v(s,X),xt(),U()}var wl=f('<textarea placeholder="Enter features, traits, and special abilities..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Equipment</h3> <textarea placeholder="List your equipment and inventory..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Notes</h3> <textarea placeholder="Additional notes..." class="svelte-wttn0l"></textarea>',1),jl=f('<section><div class="header svelte-wttn0l"><h2 class="svelte-wttn0l">Features & Traits</h2> <button class="collapse-btn svelte-wttn0l"> </button></div> <!></section>');function Fl(s,n){kt(n,!1);const t=()=>Ke(Rt,"$searchFilter",$),c=()=>Ke(Y,"$character",$),g=()=>Ke(gt,"$collapsedStates",$),[$,D]=Lt(),U=F();function y(){gt.update(de=>({...de,notes:!de.notes}))}et(()=>(t(),c()),()=>{o(U,!t()||"features".includes(t().toLowerCase())||"traits".includes(t().toLowerCase())||"equipment".includes(t().toLowerCase())||"notes".includes(t().toLowerCase())||c().features.toLowerCase().includes(t().toLowerCase())||c().equipment.toLowerCase().includes(t().toLowerCase())||c().notes.toLowerCase().includes(t().toLowerCase()))}),jt(),yt();var P=jl();let re;var J=i(P),B=a(i(J),2),He=i(B,!0);l(B),l(J);var ne=a(J,2);{var me=de=>{var Le=wl(),E=We(Le);Kt(E);var ye=a(E,4);Kt(ye);var ue=a(ye,4);Kt(ue),Ie(E,()=>c().features,oe=>at(Y,r(c).features=oe,r(c))),Ie(ye,()=>c().equipment,oe=>at(Y,r(c).equipment=oe,r(c))),Ie(ue,()=>c().notes,oe=>at(Y,r(c).notes=oe,r(c))),v(de,Le)};C(ne,de=>{g(),r(()=>!g().notes)&&de(me)})}l(P),M(()=>{re=dt(P,1,"notes svelte-wttn0l",null,re,{hidden:!e(U)}),st(B,"aria-label",(g(),r(()=>g().notes?"Expand":"Collapse"))),k(He,(g(),r(()=>g().notes?"â–¼":"â–²")))}),j("click",B,y),v(s,P),xt(),D()}var Al=f('<div class="color-picker-section svelte-1r90jgp"><h3 class="svelte-1r90jgp">Dice Colors</h3> <div class="color-inputs svelte-1r90jgp"><div class="color-input-group svelte-1r90jgp"><label for="dice-color" class="svelte-1r90jgp">Dice Color</label> <input type="color" id="dice-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="label-color" class="svelte-1r90jgp">Label Color</label> <input type="color" id="label-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="desk-color" class="svelte-1r90jgp">Background Color</label> <input type="color" id="desk-color" class="svelte-1r90jgp"/></div></div></div>'),Rl=f('<div class="loading svelte-1r90jgp"><p class="svelte-1r90jgp">Loading 3D dice...</p></div>'),Il=f('<div class="custom-dice-selector svelte-1r90jgp"><h3 class="svelte-1r90jgp">Choose Dice to Roll</h3> <div class="dice-inputs svelte-1r90jgp"><div class="dice-input-group svelte-1r90jgp"><label for="d4" class="svelte-1r90jgp">d4</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d4" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d6" class="svelte-1r90jgp">d6</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d6" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d8" class="svelte-1r90jgp">d8</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d8" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d10" class="svelte-1r90jgp">d10</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d10" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d12" class="svelte-1r90jgp">d12</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d12" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d20" class="svelte-1r90jgp">d20</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d20" min="0" max="10"/></div></div> <div class="dice-controls svelte-1r90jgp"><button class="btn btn-primary use-enabled svelte-1r90jgp"> </button> <button class="btn btn-secondary use-enabled svelte-1r90jgp">Reset</button></div></div>'),Ml=f('<span class="crit-badge svelte-1r90jgp">CRITICAL!</span>'),Pl=f('<p class="svelte-1r90jgp"> </p>'),El=f('<p class="modifier-text svelte-1r90jgp"> </p>'),Hl=f('<button class="btn btn-follow-up svelte-1r90jgp"> </button>'),Tl=f('<button class="btn btn-guided-strike svelte-1r90jgp">âš¡ Use Guided Strike (+10)</button>'),Ul=f('<div class="follow-up-actions svelte-1r90jgp"><!> <!></div>'),Bl=f('<div class="result-header svelte-1r90jgp"><h3 class="svelte-1r90jgp"> </h3> <!></div> <div class="result-total svelte-1r90jgp"> </div> <div class="result-details svelte-1r90jgp"><!> <!></div> <!>',1),Nl=f('<div role="button" tabindex="-1"><div class="modal-content svelte-1r90jgp" role="dialog" tabindex="0"><div class="modal-header svelte-1r90jgp"><h2 class="svelte-1r90jgp">Dice Roller</h2> <div class="header-buttons svelte-1r90jgp"><button class="color-btn svelte-1r90jgp" title="Customize dice colors">ðŸŽ¨</button> <button class="close-btn svelte-1r90jgp">Ã—</button></div></div> <!> <!> <div class="dice-main-area svelte-1r90jgp"><div class="dice-container svelte-1r90jgp"></div> <!></div> <div><!></div></div></div>');function Gl(s,n){kt(n,!1);const t=()=>Ke(Y,"$character",c),[c,g]=Lt(),$=F(),D=F(),U=F(),y=Gt();let P=Et(n,"notation",12,""),re=Et(n,"visible",8,!1),J=Et(n,"damageNotation",12,""),B=Et(n,"attackName",12,""),He=Et(n,"applyHalfDamage",8,!1),ne=null,me=F(void 0),de=F(!1),Le=F(""),E=F(null);function ye(){return e(E)?.resultTotal??null}let ue=F(0),oe=F(0),K=F(0),G=F(0),X=F(0),pe=F(0),V=F(0),Fe=F([]),L=F(!1),le=F("other"),Q=F(!1),h=F("#051e0a"),I=F("#ffffff"),p=F("#3a2004"),q=F(!1);function Z(d){return d.length===9&&d.startsWith("#")?d.substring(0,7):d}function z(d,w="ff"){return d.length===7&&d.startsWith("#")?d+w:d}function ee(){if(window.DICE&&e(me))try{ne&&e(me)&&Ta(me,e(me).innerHTML="");const d=e(me).clientWidth||500,w=e(me).clientHeight||300;ne=new window.DICE.dice_box(e(me),{w:d,h:w}),o(de,!0)}catch(d){console.error("Error initializing dice box:",d)}}Qt(()=>{const d=R=>new Promise((m,ce)=>{if(document.querySelector(`script[src="${R}"]`)){console.log(`Script already loaded: ${R}`),m(null);return}const ve=document.createElement("script");ve.src=R,ve.onload=()=>{console.log(`Loaded: ${R}`),m(null)},ve.onerror=()=>{console.error(`Failed to load: ${R}`),ce(new Error(`Failed to load ${R}`))},document.head.appendChild(ve)});setTimeout(()=>{d(`${Wt}/libs/three.min.js`).then(()=>d(`${Wt}/libs/cannon.min.js`)).then(()=>d(`${Wt}/libs/teal.js`)).then(()=>d(`${Wt}/dice.js`)).then(()=>{if(console.log("All scripts loaded, initializing dice box..."),console.log("DICE available:",!!window.DICE),console.log("Container available:",!!e(me)),window.DICE){const R=window.DICE.getColors();o(h,Z(R.dice_color)),o(I,Z(R.label_color)),o(p,Z(R.desk_color))}ee()}).catch(R=>{console.error("Failed to load dice libraries:",R)})},100);const w=()=>{e(de)&&(console.log("Window resized, reinitializing dice box..."),ee())},H=R=>{re()&&R.key==="Escape"&&Je()};return window.addEventListener("resize",w),window.addEventListener("keydown",H),()=>{window.removeEventListener("resize",w),window.removeEventListener("keydown",H)}});function De(d,w="other"){if(!ne||!e(de))return;console.log("Rolling dice:",d,"type:",w),o(le,w),o(Q,!1),ne.diceToRoll=d;const H=m=>(console.log("Before roll:",m),null),R=m=>{console.log("After roll:",m);let ce=m.resultTotal,je=m.resultString;if(He()&&(ce=Math.floor(ce/2),je=je+" (halved)"),o(E,{...m,resultTotal:ce,resultString:je}),w==="attack"||w==="check"||w==="save"){const ve=m.results?.filter(Ue=>Ue.sides===20)||[];if(ve.length>0){const Ue=ve[0].value;o(L,Ue===20)}}if(o(Fe,[]),w==="attack"&&J())if(e(L)){const ve=be(J());e(Fe).push({label:`Roll Critical Damage (${ve})`,notation:ve})}else e(Fe).push({label:`Roll Damage (${J()})`,notation:J()})};ne.start_throw(H,R)}function fe(){const d=[];e(ue)>0&&d.push(`${e(ue)}d4`),e(oe)>0&&d.push(`${e(oe)}d6`),e(K)>0&&d.push(`${e(K)}d8`),e(G)>0&&d.push(`${e(G)}d10`),e(X)>0&&d.push(`${e(X)}d12`),e(pe)>0&&d.push(`${e(pe)}d20`);let w=d.join("+")||"1d20";return e(V)!==0&&(w+=e(V)>=0?`+${e(V)}`:`${e(V)}`),w}function ze(){const d=fe();De(d)}function be(d){return d.replace(/(\d+)d(\d+)/g,(w,H,R)=>`${parseInt(H)*2}d${R}`)}function b(){o(ue,0),o(oe,0),o(K,0),o(G,0),o(X,0),o(pe,0),o(V,0),o(E,null),o(Fe,[]),o(L,!1),o(le,"other"),o(Q,!1)}function Ne(){window.DICE&&(window.DICE.setColors({dice_color:z(e(h),"ff"),label_color:z(e(I),"ff"),desk_color:e(p)}),ne&&(ne.updateDeskColor(e(p)),ne.updateDiceColors()))}function Qe(){o(q,!e(q))}function Ye(){!e(E)||e(D)<=0||e(Q)||(o(E,{...e(E),resultTotal:e(E).resultTotal+10,resultString:e(E).resultString+" + 10 (Guided Strike)"}),Y.update(d=>{const w="ChannelDivinity",H=d.classFeatures.features[w];return typeof H=="number"&&H>0&&(d.classFeatures.features[w]=H-1),d}),o(Q,!0))}function Je(){y("close"),P(""),J(""),B(""),o(Le,""),o(E,null),o(Q,!1),b()}et(()=>(t(),Nt),()=>{o($,t().class?Nt(t().class,t().level,t().subclass).some(w=>w.name==="Guided Strike"):!1)}),et(()=>t(),()=>{o(D,(()=>{const w=t().classFeatures.features["ChannelDivinity"];return typeof w=="number"?w:0})())}),et(()=>(e(ue),e(oe),e(K),e(G),e(X),e(pe),e(V)),()=>{o(U,(()=>{const d=[];e(ue)>0&&d.push(`${e(ue)}d4`),e(oe)>0&&d.push(`${e(oe)}d6`),e(K)>0&&d.push(`${e(K)}d8`),e(G)>0&&d.push(`${e(G)}d10`),e(X)>0&&d.push(`${e(X)}d12`),e(pe)>0&&d.push(`${e(pe)}d20`);let w=d.join("+")||"1d20";return e(V)!==0&&(w+=e(V)>=0?`+${e(V)}`:`${e(V)}`),w})())}),et(()=>(T(P()),e(de),T(re()),e(Le),T(J()),T(B())),()=>{if(P()&&e(de)&&re()&&P()!==e(Le)){o(Le,P()),o(E,null),o(Fe,[]),o(L,!1),o(Q,!1);const d=P().includes("1d20")?"attack":"other";console.log("Auto-roll triggered. notation:",P(),"damageNotation:",J(),"attackName:",B()),setTimeout(()=>De(P(),d),200)}}),jt();var _={getLastRollTotal:ye};yt();var W=Nl();let ae;var ge=i(W),Oe=i(ge),Me=a(i(Oe),2),N=i(Me),te=a(N,2);l(Me),l(Oe);var x=a(Oe,2);{var we=d=>{var w=Al(),H=a(i(w),2),R=i(H),m=a(i(R),2);Ce(m),l(R);var ce=a(R,2),je=a(i(ce),2);Ce(je),l(ce);var ve=a(ce,2),Ue=a(i(ve),2);Ce(Ue),l(ve),l(H),l(w),Ie(m,()=>e(h),u=>o(h,u)),j("change",m,Ne),Ie(je,()=>e(I),u=>o(I,u)),j("change",je,Ne),Ie(Ue,()=>e(p),u=>o(p,u)),j("change",Ue,Ne),v(d,w)};C(x,d=>{e(q)&&d(we)})}var ke=a(x,2);{var Te=d=>{var w=Rl();v(d,w)};C(ke,d=>{e(de)||d(Te)})}var qe=a(ke,2),Ze=i(qe);_a(Ze,d=>o(me,d),()=>e(me));var $e=a(Ze,2);{var ie=d=>{var w=Il(),H=a(i(w),2),R=i(H),m=a(i(R),2);Ce(m),l(R);var ce=a(R,2),je=a(i(ce),2);Ce(je),l(ce);var ve=a(ce,2),Ue=a(i(ve),2);Ce(Ue),l(ve);var u=a(ve,2),se=a(i(u),2);Ce(se),l(u);var S=a(u,2),xe=a(i(S),2);Ce(xe),l(S);var Be=a(S,2),Ve=a(i(Be),2);Ce(Ve),l(Be),l(H);var Pe=a(H,2),Ee=i(Pe),Re=i(Ee);l(Ee);var he=a(Ee,2);l(Pe),l(w),M(()=>{Ee.disabled=!e(de),k(Re,`Roll ${e(U)??""}`)}),Ie(m,()=>e(ue),_e=>o(ue,_e)),Ie(je,()=>e(oe),_e=>o(oe,_e)),Ie(Ue,()=>e(K),_e=>o(K,_e)),Ie(se,()=>e(G),_e=>o(G,_e)),Ie(xe,()=>e(X),_e=>o(X,_e)),Ie(Ve,()=>e(pe),_e=>o(pe,_e)),j("click",Ee,ze),j("click",he,b),v(d,w)};C($e,d=>{P()||d(ie)})}l(qe);var Se=a(qe,2);let Ge;var Ae=i(Se);{var A=d=>{var w=Bl(),H=We(w),R=i(H),m=i(R,!0);l(R);var ce=a(R,2);{var je=Ee=>{var Re=Ml();v(Ee,Re)};C(ce,Ee=>{e(L)&&Ee(je)})}l(H);var ve=a(H,2),Ue=i(ve,!0);l(ve);var u=a(ve,2),se=i(u);{var S=Ee=>{var Re=Pl(),he=i(Re,!0);l(Re),M(()=>k(he,(e(E),r(()=>e(E).resultString)))),v(Ee,Re)};C(se,Ee=>{e(E),r(()=>e(E).resultString)&&Ee(S)})}var xe=a(se,2);{var Be=Ee=>{var Re=El(),he=i(Re);l(Re),M(()=>k(he,`Modifier: ${e(E),r(()=>e(E).constant>=0?"+":"")??""}${e(E),r(()=>e(E).constant)??""}`)),v(Ee,Re)};C(xe,Ee=>{e(E),r(()=>e(E).constant)&&Ee(Be)})}l(u);var Ve=a(u,2);{var Pe=Ee=>{var Re=Ul(),he=i(Re);vt(he,1,()=>e(Fe),bt,(rt,lt)=>{var ut=Hl(),Mt=i(ut,!0);l(ut),M(()=>k(Mt,(e(lt),r(()=>e(lt).label)))),j("click",ut,()=>De(e(lt).notation,"damage")),v(rt,ut)});var _e=a(he,2);{var It=rt=>{var lt=Tl();M(()=>{lt.disabled=e(D)<=0,st(lt,"title",e(D)<=0?"No Channel Divinity uses remaining":"Use Channel Divinity to add +10 to this attack roll")}),j("click",lt,Ye),v(rt,lt)};C(_e,rt=>{e($)&&e(le)==="attack"&&!e(Q)&&rt(It)})}l(Re),v(Ee,Re)};C(Ve,Ee=>{e(Fe),e($),e(le),e(Q),r(()=>e(Fe).length>0||e($)&&e(le)==="attack"&&!e(Q))&&Ee(Pe)})}M(()=>{k(m,B()?`${B()} - Result`:"Result"),k(Ue,(e(E),r(()=>e(E).resultTotal)))}),v(d,w)};C(Ae,d=>{e(E)&&d(A)})}l(Se),l(ge),l(W),M(()=>{ae=dt(W,1,"modal-overlay svelte-1r90jgp",null,ae,{hidden:!re()}),Ge=dt(Se,1,"roll-result svelte-1r90jgp",null,Ge,{"has-result":e(E)})}),j("click",N,Qe),j("click",te,Je),j("click",ge,La(function(d){Bt.call(this,n,d)})),j("keydown",ge,function(d){Bt.call(this,n,d)}),j("click",W,Je),j("keydown",W,d=>d.key==="Escape"&&Je()),v(s,W),us(n,"getLastRollTotal",ye);var O=xt(_);return g(),O}const oa="https://api.github.com/gists";async function Ol(s,n,t){if(!n)throw new Error("GitHub token is required");const c=JSON.stringify(s,null,2),g=`${s.name||"character"}_dnd.json`,$={description:t||`D&D Character: ${s.name}`,public:!1,files:{[g]:{content:c}}},D=await fetch(oa,{method:"POST",headers:{Authorization:`token ${n}`,"Content-Type":"application/json"},body:JSON.stringify($)});if(!D.ok)throw new Error(`Failed to create gist: ${D.statusText}`);return(await D.json()).id}async function ql(s,n,t){if(!n||!t)throw new Error("GitHub token and Gist ID are required");const c=JSON.stringify(s,null,2),$={files:{[`${s.name||"character"}_dnd.json`]:{content:c}}},D=await fetch(`${oa}/${t}`,{method:"PATCH",headers:{Authorization:`token ${n}`,"Content-Type":"application/json"},body:JSON.stringify($)});if(!D.ok)throw new Error(`Failed to update gist: ${D.statusText}`)}async function zl(s,n){if(!s)throw new Error("Gist ID is required");const t={"Content-Type":"application/json"};n&&(t.Authorization=`token ${n}`);const c=await fetch(`${oa}/${s}`,{method:"GET",headers:t});if(!c.ok)throw new Error(`Failed to load gist: ${c.statusText}`);const g=await c.json(),$=Object.values(g.files);if($.length===0)throw new Error("No files found in gist");const U=$[0].content;try{const y=JSON.parse(U);return y.attacks&&Array.isArray(y.attacks)&&(y.attacks=y.attacks.map(P=>({...P,id:P.id||crypto.randomUUID()}))),y.classFeatures?(y.classFeatures.features||(y.classFeatures.features={}),y.classFeatures.spellSlots||(y.classFeatures.spellSlots=[]),y.classFeatures.preparedSpells===void 0&&(y.classFeatures.preparedSpells="")):y.classFeatures={features:{},spellSlots:[],preparedSpells:""},y}catch{throw new Error("Invalid character data in gist")}}function Ra(s){typeof window<"u"&&localStorage.setItem("dnd_gist_config",JSON.stringify(s))}function Wl(){if(typeof window<"u"){const s=localStorage.getItem("dnd_gist_config");if(s)return JSON.parse(s)}return{}}async function Kl(s,n=30){if(!s)throw new Error("GitHub token is required to list gists");const t=await fetch(`${oa}?per_page=${n}`,{method:"GET",headers:{Authorization:`token ${s}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error(`Failed to list gists: ${t.statusText}`);return await t.json()}var Jl=f('<div class="error-message svelte-1jb5ckg"> </div>'),Vl=f('<div class="toggle-container svelte-1jb5ckg"><button type="button" class="toggle-btn svelte-1jb5ckg"> </button></div>'),Ql=f('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID (leave empty to create new)</label> <input type="text" id="gistId" placeholder="Optional: existing Gist ID to update" class="svelte-1jb5ckg"/></div>'),Yl=f('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),Xl=f('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),Zl=f('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Update (or leave unselected to create new)</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),ei=f('<div class="info-message svelte-1jb5ckg">No gists found. A new one will be created.</div>'),ti=f('<!> <div class="form-group svelte-1jb5ckg"><label for="description" class="svelte-1jb5ckg"> </label> <input type="text" id="description" placeholder="D&amp;D Character Sheet" class="svelte-1jb5ckg"/></div>',1),ai=f('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID *</label> <input type="text" id="gistId" placeholder="Enter Gist ID (for public or your private gists)" required class="svelte-1jb5ckg"/></div>'),si=f('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),li=f('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),ii=f('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Load</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),ri=f('<div class="info-message svelte-1jb5ckg">No gists found. Enter a Gist ID manually or create a new one in Save mode.</div>'),ni=f('<div class="modal-overlay svelte-1jb5ckg" role="button" tabindex="-1"><div class="modal-content svelte-1jb5ckg" role="dialog" tabindex="0"><div class="modal-header svelte-1jb5ckg"><h2 class="svelte-1jb5ckg"> </h2> <button class="close-btn svelte-1jb5ckg">Ã—</button></div> <div class="modal-body svelte-1jb5ckg"><!> <div class="form-group svelte-1jb5ckg"><label for="token" class="svelte-1jb5ckg"> <a href="https://github.com/settings/tokens" target="_blank" rel="noopener" class="svelte-1jb5ckg">Get token</a></label> <input type="password" id="token" placeholder="ghp_xxxxxxxxxxxxx" class="svelte-1jb5ckg"/></div> <!> <!> <div class="modal-actions svelte-1jb5ckg"><button class="btn btn-primary svelte-1jb5ckg"><!></button> <button class="btn btn-secondary svelte-1jb5ckg">Cancel</button></div></div></div></div>');function oi(s,n){kt(n,!1);const t=()=>Ke(Y,"$character",c),[c,g]=Lt(),$=Gt();let D=Et(n,"mode",8,"save"),U=F(""),y=F(""),P=F(""),re=F(!1),J=F(""),B=F(!1),He=F(!1),ne=F([]),me=F(null);const de=Wl();de.token&&o(U,de.token),de.gistId&&o(y,de.gistId),Qt(async()=>{e(U)&&!e(B)&&await Le()});async function Le(){if(e(U)){o(He,!0),o(J,"");try{o(ne,await Kl(e(U))),e(y)&&o(me,e(ne).find(_=>_.id===e(y))||null)}catch(_){o(J,_.message||"Failed to load gists"),o(ne,[])}finally{o(He,!1)}}}function E(_){o(me,_),o(y,_.id)}function ye(){o(B,!e(B)),o(J,""),!e(B)&&e(U)&&Le()}async function ue(){if(!e(U)){o(J,"GitHub token is required");return}const _=e(me)?.id||e(y);o(re,!0),o(J,"");try{if(_)await ql(t(),e(U),_),o(y,_),Jt.add("Character updated in Gist successfully!","success");else{const W=await Ol(t(),e(U),e(P));o(y,W),Jt.add(`Character saved to Gist! ID: ${W}`,"success")}Ra({token:e(U),gistId:e(y)}),$("close")}catch(W){o(J,W.message||"Failed to save to Gist")}finally{o(re,!1)}}async function oe(){const _=e(me)?.id||e(y);if(!_){o(J,"Please select a gist or enter a Gist ID");return}o(re,!0),o(J,"");try{const W=await zl(_,e(U)||void 0);Y.set(W),o(y,_),Ra({token:e(U),gistId:e(y)}),Jt.add("Character loaded from Gist successfully!","success"),$("close")}catch(W){o(J,W.message||"Failed to load from Gist")}finally{o(re,!1)}}function K(){$("close")}yt();var G=ni(),X=i(G),pe=i(X),V=i(pe),Fe=i(V,!0);l(V);var L=a(V,2);l(pe);var le=a(pe,2),Q=i(le);{var h=_=>{var W=Jl(),ae=i(W,!0);l(W),M(()=>k(ae,e(J))),v(_,W)};C(Q,_=>{e(J)&&_(h)})}var I=a(Q,2),p=i(I),q=i(p);Ua(),l(p);var Z=a(p,2);Ce(Z),l(I);var z=a(I,2);{var ee=_=>{var W=Vl(),ae=i(W),ge=i(ae,!0);l(ae),l(W),M(()=>{ae.disabled=e(re),k(ge,e(B)?"ðŸ“‹ Show My Gists":"âœï¸ Enter Gist ID Manually")}),j("click",ae,ye),v(_,W)};C(z,_=>{(D()==="load"||D()==="save"&&e(U))&&_(ee)})}var De=a(z,2);{var fe=_=>{var W=ti(),ae=We(W);{var ge=we=>{var ke=Ql(),Te=a(i(ke),2);Ce(Te),l(ke),M(()=>Te.disabled=e(re)),Ie(Te,()=>e(y),qe=>o(y,qe)),v(we,ke)},Oe=we=>{var ke=nt(),Te=We(ke);{var qe=$e=>{var ie=Yl();v($e,ie)},Ze=$e=>{var ie=nt(),Se=We(ie);{var Ge=A=>{var O=Zl(),d=a(i(O),2);vt(d,5,()=>e(ne),bt,(w,H)=>{var R=Xl();let m;var ce=i(R),je=i(ce),ve=i(je,!0);l(je);var Ue=a(je,2),u=i(Ue,!0);l(Ue),l(ce);var se=a(ce,2),S=i(se),xe=i(S);l(S);var Be=a(S,2),Ve=i(Be);l(Be),l(se),l(R),M(Pe=>{m=dt(R,1,"gist-item svelte-1jb5ckg",null,m,{selected:e(me)?.id===e(H).id}),R.disabled=e(re),k(ve,(e(H),r(()=>e(H).description||"Untitled"))),k(u,(e(H),r(()=>e(H).public?"ðŸŒ Public":"ðŸ”’ Private"))),k(xe,`ID: ${e(H),r(()=>e(H).id)??""}`),k(Ve,`Updated: ${Pe??""}`)},[()=>(e(H),r(()=>new Date(e(H).updated_at).toLocaleDateString()))]),j("click",R,()=>E(e(H))),v(w,R)}),l(d),l(O),v(A,O)},Ae=A=>{var O=nt(),d=We(O);{var w=H=>{var R=ei();v(H,R)};C(d,H=>{e(U)&&H(w)},!0)}v(A,O)};C(Se,A=>{e(ne),r(()=>e(ne).length>0)?A(Ge):A(Ae,!1)},!0)}v($e,ie)};C(Te,$e=>{e(He)?$e(qe):$e(Ze,!1)},!0)}v(we,ke)};C(ae,we=>{e(B)||!e(U)?we(ge):we(Oe,!1)})}var Me=a(ae,2),N=i(Me),te=i(N);l(N);var x=a(N,2);Ce(x),l(Me),M(()=>{k(te,`Description ${e(y)?"(optional)":""}`),x.disabled=e(re)}),Ie(x,()=>e(P),we=>o(P,we)),v(_,W)},ze=_=>{var W=nt(),ae=We(W);{var ge=Me=>{var N=ai(),te=a(i(N),2);Ce(te),l(N),M(()=>te.disabled=e(re)),Ie(te,()=>e(y),x=>o(y,x)),v(Me,N)},Oe=Me=>{var N=nt(),te=We(N);{var x=ke=>{var Te=si();v(ke,Te)},we=ke=>{var Te=nt(),qe=We(Te);{var Ze=ie=>{var Se=ii(),Ge=a(i(Se),2);vt(Ge,5,()=>e(ne),bt,(Ae,A)=>{var O=li();let d;var w=i(O),H=i(w),R=i(H,!0);l(H);var m=a(H,2),ce=i(m,!0);l(m),l(w);var je=a(w,2),ve=i(je),Ue=i(ve);l(ve);var u=a(ve,2),se=i(u);l(u),l(je),l(O),M(S=>{d=dt(O,1,"gist-item svelte-1jb5ckg",null,d,{selected:e(me)?.id===e(A).id}),O.disabled=e(re),k(R,(e(A),r(()=>e(A).description||"Untitled"))),k(ce,(e(A),r(()=>e(A).public?"ðŸŒ Public":"ðŸ”’ Private"))),k(Ue,`ID: ${e(A),r(()=>e(A).id)??""}`),k(se,`Updated: ${S??""}`)},[()=>(e(A),r(()=>new Date(e(A).updated_at).toLocaleDateString()))]),j("click",O,()=>E(e(A))),v(Ae,O)}),l(Ge),l(Se),v(ie,Se)},$e=ie=>{var Se=nt(),Ge=We(Se);{var Ae=A=>{var O=ri();v(A,O)};C(Ge,A=>{e(U)&&A(Ae)},!0)}v(ie,Se)};C(qe,ie=>{e(ne),r(()=>e(ne).length>0)?ie(Ze):ie($e,!1)},!0)}v(ke,Te)};C(te,ke=>{e(He)?ke(x):ke(we,!1)},!0)}v(Me,N)};C(ae,Me=>{e(B)||!e(U)?Me(ge):Me(Oe,!1)})}v(_,W)};C(De,_=>{D()==="save"?_(fe):_(ze,!1)})}var be=a(De,2),b=i(be),Ne=i(b);{var Qe=_=>{var W=ft();M(()=>k(W,D()==="save"?"Saving...":"Loading...")),v(_,W)},Ye=_=>{var W=ft();M(()=>k(W,D()==="save"?"Save":"Load")),v(_,W)};C(Ne,_=>{e(re)?_(Qe):_(Ye,!1)})}l(b);var Je=a(b,2);l(be),l(le),l(X),l(G),M(()=>{k(Fe,D()==="save"?"Save to GitHub Gist":"Load from GitHub Gist"),k(q,`GitHub Token ${D()==="load"?"(optional for public gists)":"(required)"} `),Z.disabled=e(re),b.disabled=e(re),Je.disabled=e(re)}),j("click",L,K),Ie(Z,()=>e(U),_=>o(U,_)),j("blur",Z,()=>{e(U)&&!e(B)&&Le()}),j("click",b,function(..._){(D()==="save"?ue:oe)?.apply(this,_)}),j("click",Je,K),j("click",X,La(function(_){Bt.call(this,n,_)})),j("keydown",X,function(_){Bt.call(this,n,_)}),j("click",G,K),j("keydown",G,_=>_.key==="Escape"&&K()),v(s,G),xt(),g()}var ci=f('<div class="loading svelte-1ngjemu">Loading D&D data...</div>'),vi=f("<option> </option>"),di=f('<select class="level-filter svelte-1ngjemu"><option>All Levels</option><option>Cantrip</option><!></select>'),ui=f('<div class="no-results svelte-1ngjemu"> </div>'),pi=f('<div class="item-meta svelte-1ngjemu"> </div>'),fi=f('<div class="item-meta svelte-1ngjemu"> </div>'),bi=f('<button><div class="item-name svelte-1ngjemu"> </div> <!></button>'),gi=f('<p class="higher-levels"><strong>At Higher Levels:</strong> </p>'),hi=f('<p class="cantrip-upgrade"><strong>Cantrip Upgrade:</strong> </p>'),mi=f('<h3 class="svelte-1ngjemu"> </h3> <p class="spell-meta svelte-1ngjemu"><!> <!></p> <p class="spell-classes"><strong>Classes:</strong> </p> <div class="spell-stats svelte-1ngjemu"><div><strong>Casting Time:</strong> </div> <div><strong>Range:</strong> </div> <div><strong>Components:</strong> <!></div> <div><strong>Duration:</strong> <!> </div></div> <p class="description svelte-1ngjemu"> </p> <!> <!>',1),_i=f('<p class="prerequisite svelte-1ngjemu"><strong>Prerequisite:</strong> </p>'),yi=f('<h3 class="svelte-1ngjemu"> </h3> <!> <p class="description svelte-1ngjemu"> </p> <a target="_blank" rel="noopener" class="source-link svelte-1ngjemu">View Full Details â†’</a>',1),ki=f('<div class="item-details svelte-1ngjemu"><!></div>'),xi=f('<div class="controls svelte-1ngjemu"><div class="tabs svelte-1ngjemu"><button> </button> <button> </button></div> <div class="search-controls svelte-1ngjemu"><input type="text" placeholder="Search by name or description..." class="search-input svelte-1ngjemu"/> <!></div></div> <div class="content-container svelte-1ngjemu"><div class="items-list svelte-1ngjemu"><!></div> <!></div>',1),$i=f('<div class="modal-backdrop svelte-1ngjemu" role="presentation"><div class="modal svelte-1ngjemu" role="dialog" aria-modal="true" tabindex="-1"><div class="modal-header svelte-1ngjemu"><h2 class="svelte-1ngjemu">Browse D&D Spells & Feats</h2> <button class="close-btn svelte-1ngjemu" aria-label="Close">&times;</button></div> <div class="modal-body svelte-1ngjemu"><!></div> <div class="modal-footer svelte-1ngjemu"><button class="btn-secondary svelte-1ngjemu">Cancel</button> <button class="btn-primary svelte-1ngjemu">Add to Character Sheet</button></div></div></div>');function Si(s,n){kt(n,!1);const t=F(),c=F(),g=F();let $=Et(n,"onClose",8),D=F("spell"),U=F(!0),y=F(""),P=F(null),re=F([]),J=F([]),B=F(null);Qt(async()=>{o(U,!0);try{o(re,await Oa()),o(J,await Ps())}catch(L){console.error("Failed to load data:",L)}finally{o(U,!1)}});function He(L){o(B,L)}function ne(L){const le=L.match(/(\d+d\d+(?:\s*\+\s*\d+)?)/i);return le?le[1]:""}function me(L){const le=L.split(/\.( |$)/)[0].trim(),Q=Array.from(L.matchAll(/\*\*(.*?)\*\*/g)).map(I=>I[1].replace(/\.$/,""));let h=le;return Q.length&&(h+=" | Effects: "+Q.join(", ")),h}function de(){if(e(B)){if(e(D)==="spell"){const L=e(B);Y.update(le=>{const h=[];L.range&&h.push(`Range: ${L.range}`),L.castingTime&&h.push(`Cast: ${L.castingTime}`),L.duration&&h.push(`Duration: ${L.duration}`),L.actionType==="Save"&&h.push("Saving throw spell"),L.components&&L.components.length>0&&h.push(`Components: ${L.components.join(", ")}`),L.material&&h.push(`Material: ${L.material}`);const I=h.join(" | "),p=me(L.description),q={id:crypto.randomUUID(),name:`${L.name}${L.concentration?" (C)":""}${L.ritual?" (R)":""}`,bonus:L.actionType==="Attack"?5:0,damage:ne(L.description),damageType:`${L.school} (Lvl ${L.level})`,spellRef:L.name,infoNotes:I,generalNotes:p,castAtLevel:L.level};return le.attacks=[...le.attacks,q],le})}else if(e(D)==="feat"){const L=e(B);Y.update(le=>{const Q=`${L.name}${L.prerequisite?` (Req: ${L.prerequisite})`:""}
${L.description}
`;return le.features=le.features?`${le.features}
${Q}`:Q,le})}o(B,null),$()()}}et(()=>(e(P),e(re),e(y)),()=>{o(t,e(P)!==null?Es(Aa(e(re),e(y)),e(P)):Aa(e(re),e(y)))}),et(()=>(e(J),e(y)),()=>{o(c,Hs(e(J),e(y)))}),et(()=>(e(D),e(t),e(c)),()=>{o(g,e(D)==="spell"?e(t):e(c))}),jt(),yt();var Le=$i(),E=i(Le),ye=i(E),ue=a(i(ye),2);l(ye);var oe=a(ye,2),K=i(oe);{var G=L=>{var le=ci();v(L,le)},X=L=>{var le=xi(),Q=We(le),h=i(Q),I=i(h);let p;var q=i(I);l(I);var Z=a(I,2);let z;var ee=i(Z);l(Z),l(h);var De=a(h,2),fe=i(De);Ce(fe);var ze=a(fe,2);{var be=ae=>{var ge=di();M(()=>{e(P),Ct(()=>{})});var Oe=i(ge);Oe.value=(Oe.__value=null)??"";var Me=a(Oe);Me.value=Me.__value=0;var N=a(Me);vt(N,0,()=>[1,2,3,4,5,6,7,8,9],bt,(te,x)=>{var we=vi(),ke=i(we);l(we);var Te={};M(()=>{k(ke,`Level ${x??""}`),Te!==(Te=x)&&(we.value=(we.__value=x)??"")}),v(te,we)}),l(ge),Na(ge,()=>e(P),te=>o(P,te)),v(ae,ge)};C(ze,ae=>{e(D)==="spell"&&ae(be)})}l(De),l(Q);var b=a(Q,2),Ne=i(b),Qe=i(Ne);{var Ye=ae=>{var ge=ui(),Oe=i(ge);l(ge),M(()=>k(Oe,`No ${e(D)??""}s found`)),v(ae,ge)},Je=ae=>{var ge=nt(),Oe=We(ge);vt(Oe,1,()=>e(g),bt,(Me,N)=>{var te=bi();let x;var we=i(te),ke=i(we,!0);l(we);var Te=a(we,2);{var qe=$e=>{const ie=tt(()=>e(N));var Se=pi(),Ge=i(Se);l(Se),M(()=>k(Ge,`Level ${T(e(ie)),r(()=>e(ie).level)??""} â€¢ ${T(e(ie)),r(()=>e(ie).school)??""}`)),v($e,Se)},Ze=$e=>{const ie=tt(()=>e(N));var Se=nt(),Ge=We(Se);{var Ae=A=>{var O=fi(),d=i(O,!0);l(O),M(()=>k(d,(T(e(ie)),r(()=>e(ie).prerequisite)))),v(A,O)};C(Ge,A=>{T(e(ie)),r(()=>e(ie).prerequisite)&&A(Ae)})}v($e,Se)};C(Te,$e=>{e(D)==="spell"?$e(qe):$e(Ze,!1)})}l(te),M(()=>{x=dt(te,1,"item-card svelte-1ngjemu",null,x,{selected:e(B)?.name===e(N).name}),k(ke,(e(N),r(()=>e(N).name)))}),j("click",te,()=>He(e(N))),v(Me,te)}),v(ae,ge)};C(Qe,ae=>{e(g),r(()=>e(g).length===0)?ae(Ye):ae(Je,!1)})}l(Ne);var _=a(Ne,2);{var W=ae=>{var ge=ki(),Oe=i(ge);{var Me=te=>{const x=tt(()=>e(B));var we=mi(),ke=We(we),Te=i(ke,!0);l(ke);var qe=a(ke,2),Ze=i(qe);{var $e=he=>{var _e=ft();M(()=>k(_e,`${T(e(x)),r(()=>e(x).school)??""} cantrip`)),v(he,_e)},ie=he=>{var _e=ft();M(()=>k(_e,`Level ${T(e(x)),r(()=>e(x).level)??""} ${T(e(x)),r(()=>e(x).school)??""}`)),v(he,_e)};C(Ze,he=>{T(e(x)),r(()=>e(x).level===0)?he($e):he(ie,!1)})}var Se=a(Ze,2);{var Ge=he=>{var _e=ft("(ritual)");v(he,_e)};C(Se,he=>{T(e(x)),r(()=>e(x).ritual)&&he(Ge)})}l(qe);var Ae=a(qe,2),A=a(i(Ae));l(Ae);var O=a(Ae,2),d=i(O),w=a(i(d));l(d);var H=a(d,2),R=a(i(H));l(H);var m=a(H,2),ce=a(i(m)),je=a(ce);{var ve=he=>{var _e=ft();M(()=>k(_e,`(${T(e(x)),r(()=>e(x).material)??""})`)),v(he,_e)};C(je,he=>{T(e(x)),r(()=>e(x).material)&&he(ve)})}l(m);var Ue=a(m,2),u=a(i(Ue),2);{var se=he=>{var _e=ft("Concentration,");v(he,_e)};C(u,he=>{T(e(x)),r(()=>e(x).concentration)&&he(se)})}var S=a(u,1,!0);l(Ue),l(O);var xe=a(O,2),Be=i(xe,!0);l(xe);var Ve=a(xe,2);{var Pe=he=>{var _e=gi(),It=a(i(_e));l(_e),M(()=>k(It,` ${T(e(x)),r(()=>e(x).higherLevelSlot)??""}`)),v(he,_e)};C(Ve,he=>{T(e(x)),r(()=>e(x).higherLevelSlot)&&he(Pe)})}var Ee=a(Ve,2);{var Re=he=>{var _e=hi(),It=a(i(_e));l(_e),M(()=>k(It,` ${T(e(x)),r(()=>e(x).cantripUpgrade)??""}`)),v(he,_e)};C(Ee,he=>{T(e(x)),r(()=>e(x).cantripUpgrade)&&he(Re)})}M((he,_e)=>{k(Te,(T(e(x)),r(()=>e(x).name))),k(A,` ${he??""}`),k(w,` ${T(e(x)),r(()=>e(x).castingTime||e(x).actionType)??""}`),k(R,` ${T(e(x)),r(()=>e(x).range)??""}`),k(ce,` ${_e??""}`),k(S,(T(e(x)),r(()=>e(x).duration))),k(Be,(T(e(x)),r(()=>e(x).description)))},[()=>(T(e(x)),r(()=>e(x).classes.join(", "))),()=>(T(e(x)),r(()=>e(x).components.join(", ").toUpperCase()))]),v(te,we)},N=te=>{const x=tt(()=>e(B));var we=yi(),ke=We(we),Te=i(ke,!0);l(ke);var qe=a(ke,2);{var Ze=Ge=>{var Ae=_i(),A=a(i(Ae));l(Ae),M(()=>k(A,` ${T(e(x)),r(()=>e(x).prerequisite)??""}`)),v(Ge,Ae)};C(qe,Ge=>{T(e(x)),r(()=>e(x).prerequisite)&&Ge(Ze)})}var $e=a(qe,2),ie=i($e,!0);l($e);var Se=a($e,2);M(()=>{k(Te,(T(e(x)),r(()=>e(x).name))),k(ie,(T(e(x)),r(()=>e(x).description))),st(Se,"href",(T(e(x)),r(()=>e(x).source)))}),v(te,we)};C(Oe,te=>{e(D)==="spell"?te(Me):te(N,!1)})}l(ge),v(ae,ge)};C(_,ae=>{e(B)&&ae(W)})}l(b),M(()=>{p=dt(I,1,"tab svelte-1ngjemu",null,p,{active:e(D)==="spell"}),k(q,`ðŸ“œ Spells (${e(re),r(()=>e(re).length)??""})`),z=dt(Z,1,"tab svelte-1ngjemu",null,z,{active:e(D)==="feat"}),k(ee,`â­ Feats (${e(J),r(()=>e(J).length)??""})`)}),j("click",I,()=>{o(D,"spell"),o(B,null),o(y,"")}),j("click",Z,()=>{o(D,"feat"),o(B,null),o(y,"")}),Ie(fe,()=>e(y),ae=>o(y,ae)),v(L,le)};C(K,L=>{e(U)?L(G):L(X,!1)})}l(oe);var pe=a(oe,2),V=i(pe),Fe=a(V,2);l(pe),l(E),l(Le),M(()=>Fe.disabled=!e(B)),j("click",ue,function(...L){$()?.apply(this,L)}),j("click",V,function(...L){$()?.apply(this,L)}),j("click",Fe,de),j("click",E,La(function(L){Bt.call(this,n,L)})),j("keydown",E,function(L){Bt.call(this,n,L)}),j("click",Le,function(...L){$()?.apply(this,L)}),j("keydown",Le,L=>L.key==="Escape"&&$()()),v(s,Le),xt()}var Ci=f('<link rel="icon" type="image/png" href="favicon4.png"/> <meta name="viewport" content="width=device-width, initial-scale=1"/>',1),Li=f('<span class="character-name svelte-1uha8ag"> </span>'),Di=f("<span> </span>"),wi=f('<div class="spell-slots-header svelte-1uha8ag"></div>'),ji=f('<div class="rest-menu svelte-1uha8ag"><button class="rest-option svelte-1uha8ag">â˜• Short Rest</button> <button class="rest-option svelte-1uha8ag">ðŸ›ï¸ Long Rest</button></div>'),Fi=f('<div class="container svelte-1uha8ag"><header class="svelte-1uha8ag"><div class="header-top svelte-1uha8ag"><div class="header-title svelte-1uha8ag"><div class="title-row svelte-1uha8ag"><h1 class="svelte-1uha8ag">D&D Character Sheet</h1> <!></div> <!></div> <div class="header-right svelte-1uha8ag"><div class="header-controls svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">ðŸŽ²</span><span class="btn-text svelte-1uha8ag">Roll Dice</span></button> <div class="rest-button-container svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">ðŸ˜´</span><span class="btn-text svelte-1uha8ag">Rest</span></button> <!></div> <div class="mode-toggle"><button><span class="btn-icon svelte-1uha8ag"> </span><span class="btn-text svelte-1uha8ag"> </span></button></div></div> <div class="header-search svelte-1uha8ag"><input type="text" placeholder="ðŸ” Search..." class="search-input use-enabled svelte-1uha8ag"/></div></div></div> <div class="header-actions svelte-1uha8ag"><button class="btn btn-mode svelte-1uha8ag">ðŸ“š Browse Spells & Feats</button> <button class="btn btn-secondary">Save to Gist</button> <button class="btn btn-secondary">Load from Gist</button> <button class="btn btn-secondary">Export JSON</button> <button class="btn btn-secondary">Import JSON</button> <input type="file" accept=".json" style="display: none;"/></div></header> <main class="svelte-1uha8ag"><!> <!> <!> <!> <!> <!> <!></main></div> <!> <!> <!> <!>',1);function Ui(s,n){kt(n,!1);const t=()=>Ke(Y,"$character",$),c=()=>Ke(la,"$isEditMode",$),g=()=>Ke(Rt,"$searchFilter",$),[$,D]=Lt();function U(){const u=[],se=t().classFeatures.spellSlotsByLevel||{};for(let S=1;S<=9;S++){const xe=se[S];if(xe&&xe.length>0){const Be=xe.length,Ve=xe.filter(Pe=>Pe).length;u.push({level:S,available:Be-Ve,total:Be})}}return u}let y=F(!1),P=F(!1),re=F(!1),J=F("save"),B=F(void 0),He=F(""),ne=F(""),me=F(""),de=F(!1),Le=F(),E=!1,ye=F(!1);function ue(){const u=[];Y.update(S=>{const xe=S.hitDice.current;S.hitDice.current=Math.min(S.hitDice.max,S.hitDice.current+Math.max(1,Math.floor(S.hitDice.max/2)));const Be=S.hitDice.current-xe;if(Be>0&&u.push(`${Be} hit ${Be===1?"die":"dice"}`),S.class){const Ve=Nt(S.class,S.level,S.subclass);S.classFeatures.features||(S.classFeatures.features={}),Ve.forEach(Pe=>{if(Pe.resetOn==="short"){const Ee=Pe.name.replace(/\s+/g,"");if(Pe.type==="uses"){const Re=typeof Pe.maxUses=="function"?Pe.maxUses(S.level):Pe.maxUses;S.classFeatures.features[Ee]=Array(Re).fill(!1),u.push(Pe.name)}else if(Pe.type==="pool"){const Re=typeof Pe.maxPool=="function"?Pe.maxPool(S.level):Pe.maxPool;Re!==void 0&&(S.classFeatures.features[Ee]=Re,u.push(Pe.name))}}})}return S}),o(ye,!1);const se=u.length>0?`Short rest taken! Restored: ${u.join(", ")}`:"Short rest taken!";Jt.add(se,"success")}function oe(){const u=[];Y.update(S=>{const xe=S.maxHP-S.currentHP;xe>0&&u.push(`${xe} HP`),S.currentHP=S.maxHP,S.tempHP=0;const Be=S.hitDice.max-S.hitDice.current;Be>0&&u.push(`${Be} hit ${Be===1?"die":"dice"}`),S.hitDice.current=S.hitDice.max;let Ve=0;if(S.classFeatures.spellSlotsByLevel&&Object.keys(S.classFeatures.spellSlotsByLevel).forEach(Pe=>{const Ee=S.classFeatures.spellSlotsByLevel[parseInt(Pe)];if(Ee){const Re=Ee.filter(he=>he).length;Ve+=Re,S.classFeatures.spellSlotsByLevel[parseInt(Pe)]=Array(Ee.length).fill(!1)}}),Ve>0&&u.push(`${Ve} spell ${Ve===1?"slot":"slots"}`),S.class){const Pe=Nt(S.class,S.level,S.subclass);S.classFeatures.features||(S.classFeatures.features={});let Ee=!1;Pe.forEach(Re=>{const he=Re.name.replace(/\s+/g,"");if(!(Re.type==="info"||Re.type==="channelDivinity")){if(Re.type==="uses"){const _e=typeof Re.maxUses=="function"?Re.maxUses(S.level):Re.maxUses;S.classFeatures.features[he]=Array(_e).fill(!1),Ee=!0}else if(Re.type==="pool"){const _e=typeof Re.maxPool=="function"?Re.maxPool(S.level):Re.maxPool;_e!==void 0&&(S.classFeatures.features[he]=_e,Ee=!0)}}}),Ee&&u.push("all class features")}return S}),o(ye,!1);const se=u.length>0?`Long rest taken! Restored: ${u.join(", ")}`:"Long rest taken! Fully rested.";Jt.add(se,"success")}function K(u){o(He,""),o(ne,""),o(me,""),o(de,!1),E=!1,typeof u=="string"?o(He,u):(o(He,u.notation),o(ne,u.damageNotation||""),o(me,u.attackName||""),o(de,!!u.applyHalfDamage)),o(y,!0)}function G(u){const{notation:se}=u.detail;o(He,""),E=!0,setTimeout(()=>{o(He,se),o(ne,""),o(me,"Hit Die")},0),o(y,!0)}function X(){if(o(y,!1),E&&e(Le)){const u=e(Le).getLastRollTotal();if(u!==null){const se=Math.max(1,u);Y.update(S=>(S.hitDice.current=Math.max(0,S.hitDice.current-1),S.currentHP=Math.min(S.maxHP,S.currentHP+se),S))}E=!1}}function pe(){console.log("toggleMode called, current isEditMode:",c()),la.update(u=>(console.log("Updating isEditMode from",u,"to",!u),!u))}function V(u){u.target.closest(".rest-button-container")||o(ye,!1)}Qt(()=>{console.log("onMount - initial isEditMode:",c()),console.log("onMount - body classes:",document.body.className);const u=la.subscribe(se=>{console.log("isEditMode subscription triggered, value:",se),console.log("Body classes before:",document.body.className),se?(document.body.classList.remove("use-mode"),console.log("Removed use-mode class (Edit Mode)")):(document.body.classList.add("use-mode"),console.log("Added use-mode class (Use Mode)")),console.log("Body classes after:",document.body.className)});return document.addEventListener("click",V),()=>{u(),document.removeEventListener("click",V)}});function Fe(){ls(t())}function L(){e(B)?.click()}async function le(u){const S=u.target.files?.[0];if(S)try{const xe=await is(S);Y.set(xe),alert("Character imported successfully!")}catch{alert("Failed to import character file")}}yt();var Q=Fi();as("1uha8ag",u=>{var se=Ci();Ua(2),Pa(()=>{ts.title="D&D Character Sheet"}),v(u,se)});var h=We(Q),I=i(h),p=i(I),q=i(p),Z=i(q),z=a(i(Z),2);{var ee=u=>{var se=Li(),S=i(se,!0);l(se),M(()=>k(S,t().name)),v(u,se)};C(z,u=>{t().name&&u(ee)})}l(Z);var De=a(Z,2);{var fe=u=>{var se=wi();vt(se,5,U,bt,(S,xe)=>{var Be=Di();let Ve;var Pe=i(Be);l(Be),M(()=>{Ve=dt(Be,1,"slot-badge svelte-1uha8ag",null,Ve,{depleted:e(xe).available===0}),k(Pe,`Lv${e(xe).level??""}: ${e(xe).available??""}/${e(xe).total??""}`)}),v(S,Be)}),l(se),v(u,se)};C(De,u=>{U().length>0&&u(fe)})}l(q);var ze=a(q,2),be=i(ze),b=i(be),Ne=a(b,2),Qe=i(Ne),Ye=a(Qe,2);{var Je=u=>{var se=ji(),S=i(se),xe=a(S,2);l(se),j("click",S,ue),j("click",xe,oe),v(u,se)};C(Ye,u=>{e(ye)&&u(Je)})}l(Ne);var _=a(Ne,2),W=i(_);let ae;var ge=i(W),Oe=i(ge,!0);l(ge);var Me=a(ge),N=i(Me,!0);l(Me),l(W),l(_),l(be);var te=a(be,2),x=i(te);Ce(x),l(te),l(ze),l(p);var we=a(p,2),ke=i(we),Te=a(ke,2),qe=a(Te,2),Ze=a(qe,2),$e=a(Ze,2),ie=a($e,2);_a(ie,u=>o(B,u),()=>e(B)),l(we),l(I);var Se=a(I,2),Ge=i(Se);ks(Ge,{});var Ae=a(Ge,2);Fs(Ae,{$$events:{rollHitDice:G}});var A=a(Ae,2);Cs(A,{$$events:{roll:u=>K(u.detail)}});var O=a(A,2);Ms(O,{$$events:{roll:u=>K(u.detail)}});var d=a(O,2);vl(d,{$$events:{roll:u=>K(u.detail)}});var w=a(d,2);Dl(w,{});var H=a(w,2);Fl(H,{}),l(Se),l(h);var R=a(h,2);_a(Gl(R,{get notation(){return e(He)},get damageNotation(){return e(ne)},get attackName(){return e(me)},get applyHalfDamage(){return e(de)},get visible(){return e(y)},$$events:{close:X},$$legacy:!0}),u=>o(Le,u),()=>e(Le));var m=a(R,2);{var ce=u=>{oi(u,{get mode(){return e(J)},$$events:{close:()=>o(P,!1)}})};C(m,u=>{e(P)&&u(ce)})}var je=a(m,2);{var ve=u=>{Si(u,{onClose:()=>o(re,!1)})};C(je,u=>{e(re)&&u(ve)})}var Ue=a(je,2);ss(Ue,{}),M(()=>{ae=dt(W,1,"btn btn-mode svelte-1uha8ag",null,ae,{"use-mode":!c()}),k(Oe,c()?"ðŸ“":"ðŸŽ²"),k(N,c()?"Edit Mode":"Use Mode")}),j("click",b,()=>o(y,!0)),j("click",Qe,()=>o(ye,!e(ye))),j("click",W,pe),Ie(x,g,u=>rs(Rt,u)),j("click",ke,()=>o(re,!0)),j("click",Te,()=>{o(J,"save"),o(P,!0)}),j("click",qe,()=>{o(J,"load"),o(P,!0)}),j("click",Ze,Fe),j("click",$e,L),j("change",ie,le),v(s,Q),xt(),D()}export{Ui as component};
