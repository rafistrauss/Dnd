import{f,e as A,a as v,s as $,c as nt,t as bt}from"../chunks/B7Yu7-pH.js";import{i as _t}from"../chunks/Pgj_Karr.js";import{c as Tt,o as Yt,a as Wa}from"../chunks/YW1J0937.js";import{a7 as Ma,i as Ea,aZ as Ka,a_ as Ja,a$ as $a,K as Rt,e as Pa,b0 as Ta,T as na,b1 as Va,b2 as Qa,q as Ya,b3 as Xa,b4 as Za,b5 as es,ab as ts,d as i,r as Ha,g as as,C as yt,b6 as et,b7 as Ft,F as E,G as kt,s as o,a4 as R,H as r,J as s,I as l,f as e,E as qe,m as at,A as N,b8 as Dt,b9 as Kt,ba as Ua,ao as Na,bb as ss}from"../chunks/TSJapsqm.js";import{c as Y,a as ht,e as vt,i as ut,u as Ba,s as It,b as ct,d as Xt,f as Jt,t as Vt,h as ls,T as rs,g as is,j as ns}from"../chunks/ptv-4LDw.js";import{i as C,s as St,a as ze,b as st,d as os}from"../chunks/CsWWXapv.js";import{p as mt,b as _a}from"../chunks/CMWnilAD.js";import{b as Wt,r as cs}from"../chunks/D40WlrWJ.js";function ra(a,n,t=!1){if(a.multiple){if(n==null)return;if(!Ea(n))return Ka();for(var c of a.options)c.selected=n.includes(Qt(c));return}for(c of a.options){var g=Qt(c);if(Ja(g,n)){c.selected=!0;return}}(!t||n!==void 0)&&(a.selectedIndex=-1)}function ya(a){var n=new MutationObserver(()=>{ra(a,a.__value)});n.observe(a,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Ma(()=>{n.disconnect()})}function Ga(a,n,t=n){var c=new WeakSet,g=!0;$a(a,"change",y=>{var L=y?"[selected]":":checked",B;if(a.multiple)B=[].map.call(a.querySelectorAll(L),Qt);else{var _=a.querySelector(L)??a.querySelector("option:not([disabled])");B=_&&Qt(_)}t(B),Rt!==null&&c.add(Rt)}),Pa(()=>{var y=n();if(a===document.activeElement){var L=Ta??Rt;if(c.has(L))return}if(ra(a,y,g),g&&y===void 0){var B=a.querySelector(":checked");B!==null&&(y=Qt(B),t(y))}a.__value=y,g=!1}),ya(a)}function Qt(a){return"__value"in a?a.__value:a.value}const vs=Symbol("is custom element"),ds=Symbol("is html");function Le(a){if(na){var n=!1,t=()=>{if(!n){if(n=!0,a.hasAttribute("value")){var c=a.value;tt(a,"value",null),a.value=c}if(a.hasAttribute("checked")){var g=a.checked;tt(a,"checked",null),a.checked=g}}};a.__on_r=t,Ya(t),Xa()}}function Sa(a,n){var t=Ca(a);t.value===(t.value=n??void 0)||a.value===n&&(n!==0||a.nodeName!=="PROGRESS")||(a.value=n??"")}function us(a,n){var t=Ca(a);t.checked!==(t.checked=n??void 0)&&(a.checked=n)}function tt(a,n,t,c){var g=Ca(a);na&&(g[n]=a.getAttribute(n),n==="src"||n==="srcset"||n==="href"&&a.nodeName==="LINK")||g[n]!==(g[n]=t)&&(n==="loading"&&(a[Za]=t),t==null?a.removeAttribute(n):typeof t!="string"&&ps(a).includes(n)?a[n]=t:a.setAttribute(n,t))}function Ca(a){return a.__attributes??={[vs]:a.nodeName.includes("-"),[ds]:a.namespaceURI===Va}}var Da=new Map;function ps(a){var n=a.getAttribute("is")||a.nodeName,t=Da.get(n);if(t)return t;Da.set(n,t=[]);for(var c,g=a,y=Element.prototype;y!==g;){c=es(g);for(var L in c)c[L].set&&t.push(L);g=Qa(g)}return t}function Ae(a,n,t=n){var c=new WeakSet;$a(a,"input",async g=>{var y=g?a.defaultValue:a.value;if(y=ha(a)?ga(y):y,t(y),Rt!==null&&c.add(Rt),await ts(),y!==(y=n())){var L=a.selectionStart,B=a.selectionEnd,_=a.value.length;if(a.value=y??"",B!==null){var I=a.value.length;L===B&&B===_&&I>_?(a.selectionStart=I,a.selectionEnd=I):(a.selectionStart=L,a.selectionEnd=Math.min(B,I))}}}),(na&&a.defaultValue!==a.value||i(n)==null&&a.value)&&(t(ha(a)?ga(a.value):a.value),Rt!==null&&c.add(Rt)),Ha(()=>{var g=n();if(a===document.activeElement){var y=Ta??Rt;if(c.has(y))return}ha(a)&&g===ga(a.value)||a.type==="date"&&!g&&!a.value||g!==a.value&&(a.value=g??"")})}function ia(a,n,t=n){$a(a,"change",c=>{var g=c?a.defaultChecked:a.checked;t(g)}),(na&&a.defaultChecked!==a.checked||i(n)==null)&&t(a.checked),Ha(()=>{var c=n();a.checked=!!c})}function ha(a){var n=a.type;return n==="number"||n==="range"}function ga(a){return a===""?null:+a}function fs(a,n,t){var c=as(a,n);c&&c.set&&(a[n]=t,Ma(()=>{a[n]=null}))}function La(a){return function(...n){var t=n[0];return t.stopPropagation(),a?.apply(this,n)}}function Bt(a,n){var t=a.$$events?.[n.type],c=Ea(t)?t.slice():t==null?[]:[t];for(var g of c)g.call(this,n)}const bs="";function Oa(...a){return Wt+bs+cs(a[0],a[1])}const ka={paladin:{name:"Paladin",hitDice:"d10",spellcaster:!0,spellcastingAbility:"charisma",spellSlotsByLevel:{1:0,2:2,3:3,4:3,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Divine Sense",type:"uses",maxUses:(a,n=1)=>1+Math.max(1,n),resetOn:"long",description:"Detect celestials, fiends, and undead within 60 feet",minLevel:1},{name:"Lay on Hands",type:"pool",maxPool:a=>a*5,resetOn:"long",description:"Heal wounds or cure disease",minLevel:1},{name:"Divine Smite",type:"spellSlot",description:"Expend spell slot to deal extra radiant damage",minLevel:2,rollable:!0},{name:"Channel Divinity",type:"pool",maxPool:a=>a>=18?3:a>=6?2:1,resetOn:"short",description:"Sacred Weapon or Turn Undead",minLevel:3}]},fighter:{name:"Fighter",hitDice:"d10",spellcaster:!1,features:[{name:"Second Wind",type:"uses",maxUses:1,resetOn:"short",description:"Regain 1d10 + fighter level HP as bonus action",minLevel:1,rollable:!0,rollFormula:a=>`1d10+${a}`},{name:"Action Surge",type:"uses",maxUses:a=>a>=17?2:1,resetOn:"short",description:"Take one additional action on your turn",minLevel:2},{name:"Indomitable",type:"uses",maxUses:a=>a>=17?3:a>=13?2:1,resetOn:"long",description:"Reroll a failed saving throw",minLevel:9}],subclasses:{champion:{name:"Champion",features:[{name:"Improved Critical",type:"info",description:"Critical hit on 19-20",minLevel:3},{name:"Remarkable Athlete",type:"info",description:"Add half proficiency to STR/DEX/CON checks, increase long jump distance",minLevel:7},{name:"Additional Fighting Style",type:"info",description:"Choose a second fighting style",minLevel:10},{name:"Superior Critical",type:"info",description:"Critical hit on 18-20",minLevel:15},{name:"Survivor",type:"info",description:"Regain 5 + CON mod HP at start of turn if below half HP",minLevel:18}]},battlemaster:{name:"Battle Master",features:[{name:"Combat Superiority",type:"uses",maxUses:a=>a>=15?6:a>=7?5:4,resetOn:"short",description:a=>`Use superiority dice (${a>=18?"d12":a>=10?"d10":"d8"}) for maneuvers`,minLevel:3},{name:"Know Your Enemy",type:"info",description:"Learn capabilities of creatures you observe",minLevel:7},{name:"Improved Combat Superiority",type:"info",description:"Superiority dice become d10",minLevel:10},{name:"Relentless",type:"info",description:"Regain 1 superiority die if you have none at start of turn",minLevel:15}]}}},rogue:{name:"Rogue",hitDice:"d8",spellcaster:!1,features:[{name:"Sneak Attack",type:"info",description:a=>`Deal ${Math.ceil(a/2)}d6 extra damage once per turn with advantage or ally nearby`,minLevel:1,rollable:!0,rollFormula:a=>`${Math.ceil(a/2)}d6`},{name:"Cunning Action",type:"info",description:"Dash, Disengage, or Hide as a bonus action",minLevel:2},{name:"Uncanny Dodge",type:"info",description:"Use reaction to halve damage from an attack",minLevel:5},{name:"Evasion",type:"info",description:"Take no damage on successful Dex save (half on fail)",minLevel:7}]},wizard:{name:"Wizard",hitDice:"d6",spellcaster:!0,spellcastingAbility:"intelligence",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Arcane Recovery",type:"uses",maxUses:1,resetOn:"long",description:a=>`Recover spell slots totaling up to ${Math.ceil(a/2)} levels during short rest`,minLevel:1},{name:"Spell Mastery",type:"info",description:"Cast one 1st-level and one 2nd-level spell at will",minLevel:18}]},cleric:{name:"Cleric",hitDice:"d8",spellcaster:!0,spellcastingAbility:"wisdom",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Channel Divinity",type:"pool",maxPool:a=>a>=18?3:a>=6?2:1,resetOn:"short",description:"Turn Undead or domain-specific ability",minLevel:2},{name:"Destroy Undead",type:"info",description:a=>`Channel Divinity destroys undead of CR ${a>=17?4:a>=14?3:a>=11?2:a>=8?1:.5} or lower`,minLevel:5},{name:"Divine Intervention",type:"uses",maxUses:1,resetOn:"long",description:a=>`${a}% chance to succeed, implore deity for aid`,minLevel:10}],subclasses:{war:{name:"War Domain",features:[{name:"War Priest",type:"uses",maxUses:(a,n=1)=>Math.max(1,n),resetOn:"long",description:"Make one weapon attack as a bonus action",minLevel:1},{name:"Guided Strike",type:"channelDivinity",description:"Use your Channel Divinity to gain +10 to an attack roll. Make this choice after you see the roll, but before the DM says whether the attack hits or misses.",minLevel:2,resetOn:"short"},{name:"War God's Blessing",type:"channelDivinity",description:"Use reaction to grant +10 to an ally's attack roll within 30 feet. Consumes one use of Channel Divinity.",minLevel:6,resetOn:"short"},{name:"Divine Strike",type:"info",description:a=>`Deal extra ${a>=14?"2d8":"1d8"} weapon damage once per turn`,minLevel:8,rollable:!0,rollFormula:a=>a>=14?"2d8":"1d8"},{name:"Avatar of Battle",type:"info",description:"Gain resistance to nonmagical weapon damage",minLevel:17}]},life:{name:"Life Domain",features:[{name:"Disciple of Life",type:"info",description:"Healing spells restore additional 2 + spell level HP",minLevel:1},{name:"Preserve Life",type:"pool",maxPool:a=>a*5,resetOn:"short",description:"Restore HP to creatures within 30 feet",minLevel:2},{name:"Blessed Healer",type:"info",description:"Regain 2 + spell level HP when you cast healing spell",minLevel:6},{name:"Divine Strike",type:"info",description:a=>`Deal extra ${a>=14?"2d8":"1d8"} radiant damage once per turn`,minLevel:8,rollable:!0,rollFormula:a=>a>=14?"2d8":"1d8"},{name:"Supreme Healing",type:"info",description:"Maximize healing dice instead of rolling",minLevel:17}]}}},barbarian:{name:"Barbarian",hitDice:"d12",spellcaster:!1,features:[{name:"Rage",type:"uses",maxUses:a=>a>=20?1/0:a>=17?6:a>=12?5:a>=6?4:a>=3?3:2,resetOn:"long",description:a=>`+${a>=16?4:a>=9?3:2} damage, resistance to physical damage`,minLevel:1},{name:"Reckless Attack",type:"info",description:"Gain advantage on melee attacks, enemies get advantage on you",minLevel:2},{name:"Danger Sense",type:"info",description:"Advantage on Dex saves against effects you can see",minLevel:2}],subclasses:{berserker:{name:"Path of the Berserker",features:[{name:"Frenzy",type:"info",description:"While raging, make melee attack as bonus action (gain 1 exhaustion after rage)",minLevel:3},{name:"Mindless Rage",type:"info",description:"Cannot be charmed or frightened while raging",minLevel:6},{name:"Intimidating Presence",type:"info",description:"Use action to frighten creature within 30 feet",minLevel:10},{name:"Retaliation",type:"info",description:"When damaged by creature within 5 feet, make melee attack as reaction",minLevel:14}]}}}};function $t(a){const n=a.toLowerCase();return ka[n]||null}function Gt(a,n,t){const c=$t(a);if(!c)return[];const g=c.features.filter(y=>!y.minLevel||y.minLevel<=n);if(t&&c.subclasses&&c.subclasses[t]){const y=c.subclasses[t].features.filter(L=>!L.minLevel||L.minLevel<=n);return[...g,...y]}return g}function wa(a){const n=$t(a);return!n||!n.subclasses?[]:Object.keys(n.subclasses).map(t=>({id:t,name:n.subclasses[t].name}))}function ja(a,n){const t=$t(a);return!t||!t.spellcaster||!t.spellSlotsByLevel?0:t.spellSlotsByLevel[n]||0}function Fa(a,n,t){const c=$t(a);return!c||!c.spellcaster?0:Math.max(1,t+n)}function hs(a,n,t){const c=$t(a);return!c||!c.spellcaster?null:8+n+t}function gs(){return Object.keys(ka).map(a=>({id:a,name:ka[a].name}))}var ms=f("<option> </option>"),_s=f("<option> </option>"),ys=f('<div class="form-group svelte-172i2fj"><label for="characterSubclass" class="svelte-172i2fj">Subclass</label> <select id="characterSubclass" class="svelte-172i2fj"><option>Select Subclass</option><!></select></div>'),ks=f('<div class="info-grid svelte-172i2fj"><div class="form-group svelte-172i2fj"><label for="characterName" class="svelte-172i2fj">Character Name</label> <input type="text" id="characterName" placeholder="Enter name" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterClass" class="svelte-172i2fj">Class</label> <select id="characterClass" class="svelte-172i2fj"><option>Select Class</option><!></select></div> <!> <div class="form-group svelte-172i2fj"><label for="characterLevel" class="svelte-172i2fj">Level</label> <input type="number" id="characterLevel" min="1" max="20" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterRace" class="svelte-172i2fj">Race</label> <input type="text" id="characterRace" placeholder="e.g., Human" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterBackground" class="svelte-172i2fj">Background</label> <input type="text" id="characterBackground" placeholder="e.g., Soldier" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterAlignment" class="svelte-172i2fj">Alignment</label> <input type="text" id="characterAlignment" placeholder="e.g., Lawful Good" class="svelte-172i2fj"/></div></div>'),xs=f('<section class="character-info svelte-172i2fj"><div class="header svelte-172i2fj"><h2 class="svelte-172i2fj">Character Info</h2> <button class="collapse-btn svelte-172i2fj"> </button></div> <!></section>');function $s(a,n){yt(n,!1);const t=()=>ze(Y,"$character",g),c=()=>ze(ht,"$collapsedStates",g),[g,y]=St(),L=R(),B=gs();function _(M){const _e=M.target;Y.update(be=>(be.class=_e.value,be.subclass="",be))}function I(M){const _e=M.target;Y.update(be=>(be.subclass=_e.value,be))}function le(M){const _e=M.target;Y.update(be=>(be.level=parseInt(_e.value)||1,be)),Ba()}function K(){ht.update(M=>({...M,characterInfo:!M.characterInfo}))}et(()=>(t(),wa),()=>{o(L,t().class?wa(t().class):[])}),Ft(),_t();var T=xs(),pe=r(T),ae=s(r(pe),2),fe=r(ae,!0);l(ae),l(pe);var oe=s(pe,2);{var ce=M=>{var _e=ks(),be=r(_e),ve=s(r(be),2);Le(ve),l(be);var W=s(be,2),q=s(r(W),2),re=r(q);re.value=re.__value="";var de=s(re);vt(de,1,()=>B,ut,(X,ke)=>{var he=ms(),We=r(he,!0);l(he);var De={};E(()=>{$(We,(e(ke),i(()=>e(ke).name))),De!==(De=(e(ke),i(()=>e(ke).id)))&&(he.value=(he.__value=(e(ke),i(()=>e(ke).id)))??"")}),v(X,he)}),l(q);var Z;ya(q),l(W);var Re=s(W,2);{var S=X=>{var ke=ys(),he=s(r(ke),2),We=r(he);We.value=We.__value="";var De=s(We);vt(De,1,()=>e(L),ut,(Ie,Ve)=>{var Qe=_s(),Ze=r(Qe,!0);l(Qe);var H={};E(()=>{$(Ze,(e(Ve),i(()=>e(Ve).name))),H!==(H=(e(Ve),i(()=>e(Ve).id)))&&(Qe.value=(Qe.__value=(e(Ve),i(()=>e(Ve).id)))??"")}),v(Ie,Qe)}),l(he);var h;ya(he),l(ke),E(()=>{h!==(h=(t(),i(()=>t().subclass)))&&(he.value=(he.__value=(t(),i(()=>t().subclass)))??"",ra(he,(t(),i(()=>t().subclass))))}),A("change",he,I),v(X,ke)};C(Re,X=>{e(L),i(()=>e(L).length>0)&&X(S)})}var ie=s(Re,2),ee=s(r(ie),2);Le(ee),l(ie);var ye=s(ie,2),b=s(r(ye),2);Le(b),l(ye);var d=s(ye,2),w=s(r(d),2);Le(w),l(d);var J=s(d,2),V=s(r(J),2);Le(V),l(J),l(_e),E(()=>{Z!==(Z=(t(),i(()=>t().class)))&&(q.value=(q.__value=(t(),i(()=>t().class)))??"",ra(q,(t(),i(()=>t().class)))),Sa(ee,(t(),i(()=>t().level)))}),Ae(ve,()=>t().name,X=>st(Y,i(t).name=X,i(t))),A("change",q,_),A("change",ee,le),Ae(b,()=>t().race,X=>st(Y,i(t).race=X,i(t))),Ae(w,()=>t().background,X=>st(Y,i(t).background=X,i(t))),Ae(V,()=>t().alignment,X=>st(Y,i(t).alignment=X,i(t))),v(M,_e)};C(oe,M=>{c(),i(()=>!c().characterInfo)&&M(ce)})}l(T),E(()=>{tt(ae,"aria-label",(c(),i(()=>c().characterInfo?"Expand":"Collapse"))),$(fe,(c(),i(()=>c().characterInfo?"â–¼":"â–²")))}),A("click",ae,K),v(a,T),kt(),y()}var Ss=f('<div class="ability-card svelte-bbv1xt"><h3 class="svelte-bbv1xt"> </h3> <input type="number" class="ability-score svelte-bbv1xt" min="1" max="30"/> <div class="ability-modifier svelte-bbv1xt"> </div> <button class="roll-btn svelte-bbv1xt">Check</button> <div class="save-row svelte-bbv1xt"><input type="checkbox" class="svelte-bbv1xt"/> <label class="svelte-bbv1xt">Save</label> <button class="roll-btn-small svelte-bbv1xt">Roll</button></div></div>'),Cs=f('<div class="proficiency-bonus svelte-bbv1xt"><label for="profBonus">Proficiency Bonus</label> <input type="number" id="profBonus" class="prof-input svelte-bbv1xt"/></div> <div class="abilities-grid svelte-bbv1xt"></div>',1),Ls=f('<section><div class="header svelte-bbv1xt"><h2 class="svelte-bbv1xt">Ability Scores</h2> <button class="collapse-btn svelte-bbv1xt"> </button></div> <!></section>');function Ds(a,n){yt(n,!1);const t=()=>ze(Xt,"$abilityModifiers",L),c=()=>ze(Y,"$character",L),g=()=>ze(It,"$searchFilter",L),y=()=>ze(ht,"$collapsedStates",L),[L,B]=St(),_=R(),I=R(),le=Tt(),K=[{key:"strength",label:"Strength"},{key:"dexterity",label:"Dexterity"},{key:"constitution",label:"Constitution"},{key:"intelligence",label:"Intelligence"},{key:"wisdom",label:"Wisdom"},{key:"charisma",label:"Charisma"}];function T(){Ba()}function pe(q){const re=t()[q],de=`1d20${re>=0?"+":""}${re}`;le("roll",de)}function ae(q){const re=t()[q],de=c().saveProficiencies[q]?c().proficiencyBonus:0,Z=re+de,Re=`1d20${Z>=0?"+":""}${Z}`;le("roll",Re)}function fe(){ht.update(q=>({...q,abilityScores:!q.abilityScores}))}et(()=>g(),()=>{o(_,K.filter(({label:q})=>g()?q.toLowerCase().includes(g().toLowerCase()):!0))}),et(()=>(e(_),g()),()=>{o(I,e(_).length>0||!g()||g().toLowerCase().includes("proficiency"))}),Ft(),_t();var oe=Ls();let ce;var M=r(oe),_e=s(r(M),2),be=r(_e,!0);l(_e),l(M);var ve=s(M,2);{var W=q=>{var re=Cs(),de=qe(re),Z=s(r(de),2);Le(Z),l(de);var Re=s(de,2);vt(Re,5,()=>e(_),ut,(S,ie)=>{let ee=()=>e(ie).key,ye=()=>e(ie).label;var b=Ss(),d=r(b),w=r(d,!0);l(d);var J=s(d,2);Le(J);var V=s(J,2),X=r(V);l(V);var ke=s(V,2),he=s(ke,2),We=r(he);Le(We);var De=s(We,2),h=s(De,2);l(he),l(b),E(Ie=>{$(w,Ie),$(X,`${t(),ee(),i(()=>t()[ee()]>=0?"+":"")??""}${t(),ee(),i(()=>t()[ee()])??""}`),tt(We,"id",`${ee()}-save`),tt(De,"for",`${ee()}-save`)},[()=>(ye(),i(()=>ye().substring(0,3).toUpperCase()))]),Ae(J,()=>c().abilities[ee()],Ie=>st(Y,i(c).abilities[ee()]=Ie,i(c))),A("change",J,T),A("click",ke,()=>pe(ee())),ia(We,()=>c().saveProficiencies[ee()],Ie=>st(Y,i(c).saveProficiencies[ee()]=Ie,i(c))),A("click",h,()=>ae(ee())),v(S,b)}),l(Re),Ae(Z,()=>c().proficiencyBonus,S=>st(Y,i(c).proficiencyBonus=S,i(c))),v(q,re)};C(ve,q=>{y(),i(()=>!y().abilityScores)&&q(W)})}l(oe),E(()=>{ce=ct(oe,1,"ability-scores svelte-bbv1xt",null,ce,{hidden:!e(I)}),tt(_e,"aria-label",(y(),i(()=>y().abilityScores?"Expand":"Collapse"))),$(be,(y(),i(()=>y().abilityScores?"â–¼":"â–²")))}),A("click",_e,fe),v(a,oe),kt(),B()}function xa(a,n){if(!a.class)return null;const t=$t(a.class);if(!t||!t.spellcaster||!t.spellcastingAbility)return null;const c=n[t.spellcastingAbility];return 8+a.proficiencyBonus+c}var ws=f('<div class="stat-box svelte-1r5hyyb"><label for="spellSaveDC" class="svelte-1r5hyyb">Spell Save DC</label> <input type="number" id="spellSaveDC" class="stat-input svelte-1r5hyyb" readonly="" title="8 + Proficiency Bonus + Spellcasting Ability Modifier"/></div>'),js=f('<span class="hit-dice-type"> </span>'),Fs=f('<div class="stats-grid svelte-1r5hyyb"><div class="stat-box svelte-1r5hyyb"><label for="armorClass" class="svelte-1r5hyyb">Armor Class</label> <input type="number" id="armorClass" class="stat-input svelte-1r5hyyb"/></div> <div class="stat-box svelte-1r5hyyb"><label for="initiative" class="svelte-1r5hyyb">Initiative</label> <input type="number" id="initiative" class="stat-input svelte-1r5hyyb"/></div> <div class="stat-box svelte-1r5hyyb"><label for="speed" class="svelte-1r5hyyb">Speed</label> <input type="text" id="speed" class="stat-input svelte-1r5hyyb"/></div> <!></div> <div class="hp-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Points</h3> <div class="hp-display svelte-1r5hyyb"><div class="hp-inputs svelte-1r5hyyb"><input type="number" class="hp-current svelte-1r5hyyb" min="0"/> <span class="hp-separator svelte-1r5hyyb">/</span> <input type="number" class="hp-max svelte-1r5hyyb" min="0"/></div> <div class="hp-controls svelte-1r5hyyb"><button class="hp-btn svelte-1r5hyyb">âˆ’</button> <button class="hp-btn svelte-1r5hyyb">+</button> <button class="hp-btn svelte-1r5hyyb">âˆ’5</button> <button class="hp-btn svelte-1r5hyyb">+5</button></div></div> <div class="temp-hp svelte-1r5hyyb"><label for="tempHP" class="svelte-1r5hyyb">Temp HP</label> <input type="number" id="tempHP" min="0" class="svelte-1r5hyyb"/></div></div> <div class="hit-dice-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Dice</h3> <div class="hit-dice-display svelte-1r5hyyb"><input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <span>/</span> <input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <!></div> <div class="hit-dice-controls"><label for="hitDiceCount" class="svelte-1r5hyyb">Roll</label> <input type="number" id="hitDiceCount" class="hit-dice-count-input svelte-1r5hyyb" min="1" value="1"/> <button class="btn btn-primary roll-hit-dice use-enabled svelte-1r5hyyb">ðŸŽ² Roll</button></div></div>',1),As=f('<section><div class="header svelte-1r5hyyb"><h2 class="svelte-1r5hyyb">Combat Stats</h2> <button class="collapse-btn svelte-1r5hyyb"> </button></div> <!></section>');function Rs(a,n){yt(n,!1);const t=()=>ze(Y,"$character",L),c=()=>ze(Xt,"$abilityModifiers",L),g=()=>ze(It,"$searchFilter",L),y=()=>ze(ht,"$collapsedStates",L),[L,B]=St(),_=R(),I=R(),le=Tt();function K(ve){Y.update(W=>(W.currentHP=Math.max(0,Math.min(W.maxHP,W.currentHP+ve)),W))}function T(ve=1){if(t().hitDice.current<=0){alert("No hit dice remaining!");return}if(!t().class){alert("Please select a class first!");return}const W=$t(t().class);if(!W){alert("Invalid class configuration!");return}const q=Math.min(ve,t().hitDice.current),re=W.hitDice,de=c().constitution,Z=de>=0?`+${de}`:`${de}`,Re=`${q}${re}${Z}`;le("rollHitDice",{notation:Re,hitDie:re,count:q})}function pe(){ht.update(ve=>({...ve,combatStats:!ve.combatStats}))}et(()=>(t(),c()),()=>{o(_,xa(t(),c()))}),et(()=>g(),()=>{o(I,!g()||"armor class".includes(g().toLowerCase())||"initiative".includes(g().toLowerCase())||"speed".includes(g().toLowerCase())||"hit points".includes(g().toLowerCase())||"hp".includes(g().toLowerCase())||"hit dice".includes(g().toLowerCase())||"spell save".includes(g().toLowerCase())||"combat".includes(g().toLowerCase()))}),Ft(),_t();var ae=As();let fe;var oe=r(ae),ce=s(r(oe),2),M=r(ce,!0);l(ce),l(oe);var _e=s(oe,2);{var be=ve=>{var W=Fs(),q=qe(W),re=r(q),de=s(r(re),2);Le(de),l(re);var Z=s(re,2),Re=s(r(Z),2);Le(Re),l(Z);var S=s(Z,2),ie=s(r(S),2);Le(ie),l(S);var ee=s(S,2);{var ye=O=>{var se=ws(),x=s(r(se),2);Le(x),l(se),E(()=>Sa(x,e(_))),v(O,se)};C(ee,O=>{e(_)!==null&&O(ye)})}l(q);var b=s(q,2),d=s(r(b),2),w=r(d),J=r(w);Le(J);var V=s(J,4);Le(V),l(w);var X=s(w,2),ke=r(X),he=s(ke,2),We=s(he,2),De=s(We,2);l(X),l(d);var h=s(d,2),Ie=s(r(h),2);Le(Ie),l(h),l(b);var Ve=s(b,2),Qe=s(r(Ve),2),Ze=r(Qe);Le(Ze);var H=s(Ze,4);Le(H);var j=s(H,2);{var Q=O=>{const se=at(()=>(N($t),t(),i(()=>$t(t().class))));var x=nt(),Se=qe(x);{var Ce=Me=>{const Ke=at(()=>(c(),i(()=>c().constitution)));var Xe=js(),Ee=r(Xe);l(Xe),E(()=>$(Ee,`(${N(e(se)),i(()=>e(se).hitDice)??""}${(e(Ke)>=0?`+${e(Ke)}`:e(Ke))??""})`)),v(Me,Xe)};C(Se,Me=>{e(se)&&Me(Ce)})}v(O,x)};C(j,O=>{t(),i(()=>t().class)&&O(Q)})}l(Qe);var ue=s(Qe,2),Be=s(r(ue),2),je=s(Be,2);l(ue),l(Ve),E(()=>{tt(J,"max",(t(),i(()=>t().maxHP))),tt(Ze,"max",(t(),i(()=>t().hitDice.max))),tt(Be,"max",(t(),i(()=>t().hitDice.current))),je.disabled=(t(),i(()=>t().hitDice.current<=0||!t().class))}),Ae(de,()=>t().armorClass,O=>st(Y,i(t).armorClass=O,i(t))),Ae(Re,()=>t().initiative,O=>st(Y,i(t).initiative=O,i(t))),Ae(ie,()=>t().speed,O=>st(Y,i(t).speed=O,i(t))),Ae(J,()=>t().currentHP,O=>st(Y,i(t).currentHP=O,i(t))),Ae(V,()=>t().maxHP,O=>st(Y,i(t).maxHP=O,i(t))),A("click",ke,()=>K(-1)),A("click",he,()=>K(1)),A("click",We,()=>K(-5)),A("click",De,()=>K(5)),Ae(Ie,()=>t().tempHP,O=>st(Y,i(t).tempHP=O,i(t))),Ae(Ze,()=>t().hitDice.current,O=>st(Y,i(t).hitDice.current=O,i(t))),Ae(H,()=>t().hitDice.max,O=>st(Y,i(t).hitDice.max=O,i(t))),A("input",Be,O=>{const se=O.target,x=parseInt(se.value);x>t().hitDice.current&&(se.value=String(t().hitDice.current)),x<1&&(se.value="1")}),A("click",je,()=>{const O=document.getElementById("hitDiceCount"),se=parseInt(O?.value||"1");T(se)}),v(ve,W)};C(_e,ve=>{y(),i(()=>!y().combatStats)&&ve(be)})}l(ae),E(()=>{fe=ct(ae,1,"combat-stats svelte-1r5hyyb",null,fe,{hidden:!e(I)}),tt(ce,"aria-label",(y(),i(()=>y().combatStats?"Expand":"Collapse"))),$(M,(y(),i(()=>y().combatStats?"â–¼":"â–²")))}),A("click",ce,pe),v(a,ae),kt(),B()}const ma={acrobatics:"dexterity",animalHandling:"wisdom",arcana:"intelligence",athletics:"strength",deception:"charisma",history:"intelligence",insight:"wisdom",intimidation:"charisma",investigation:"intelligence",medicine:"wisdom",nature:"intelligence",perception:"wisdom",performance:"charisma",persuasion:"charisma",religion:"intelligence",sleightOfHand:"dexterity",stealth:"dexterity",survival:"wisdom"};var Is=f('<div class="skill-row svelte-1f1pl16"><input type="checkbox" class="svelte-1f1pl16"/> <label class="svelte-1f1pl16"> <span class="ability-tag svelte-1f1pl16"> </span></label> <span class="skill-modifier svelte-1f1pl16"> </span> <button class="roll-btn svelte-1f1pl16">Roll</button></div>'),Ms=f('<div class="skills-grid svelte-1f1pl16"></div>'),Es=f('<section><div class="header svelte-1f1pl16"><h2 class="svelte-1f1pl16">Skills</h2> <button class="collapse-btn svelte-1f1pl16"> </button></div> <!></section>');function Ps(a,n){yt(n,!1);const t=()=>ze(Xt,"$abilityModifiers",L),c=()=>ze(Y,"$character",L),g=()=>ze(It,"$searchFilter",L),y=()=>ze(ht,"$collapsedStates",L),[L,B]=St(),_=R(),I=R(),le=Tt(),K=[{key:"acrobatics",label:"Acrobatics"},{key:"animalHandling",label:"Animal Handling"},{key:"arcana",label:"Arcana"},{key:"athletics",label:"Athletics"},{key:"deception",label:"Deception"},{key:"history",label:"History"},{key:"insight",label:"Insight"},{key:"intimidation",label:"Intimidation"},{key:"investigation",label:"Investigation"},{key:"medicine",label:"Medicine"},{key:"nature",label:"Nature"},{key:"perception",label:"Perception"},{key:"performance",label:"Performance"},{key:"persuasion",label:"Persuasion"},{key:"religion",label:"Religion"},{key:"sleightOfHand",label:"Sleight of Hand"},{key:"stealth",label:"Stealth"},{key:"survival",label:"Survival"}];function T(W){const q=ma[W],re=t()[q],de=c().skillProficiencies[W]?c().proficiencyBonus:0;return re+de}function pe(W){const q=T(W),re=`1d20${q>=0?"+":""}${q}`;le("roll",re)}function ae(){ht.update(W=>({...W,skills:!W.skills}))}et(()=>g(),()=>{o(_,K.filter(({label:W})=>g()?W.toLowerCase().includes(g().toLowerCase()):!0))}),et(()=>e(_),()=>{o(I,e(_).length>0)}),Ft(),_t();var fe=Es();let oe;var ce=r(fe),M=s(r(ce),2),_e=r(M,!0);l(M),l(ce);var be=s(ce,2);{var ve=W=>{var q=Ms();vt(q,5,()=>e(_),ut,(re,de)=>{let Z=()=>e(de).key,Re=()=>e(de).label;const S=at(()=>(N(ma),Z(),i(()=>ma[Z()]))),ie=at(()=>(Z(),i(()=>T(Z()))));var ee=Is(),ye=r(ee);Le(ye);var b=s(ye,2),d=r(b),w=s(d),J=r(w);l(w),l(b);var V=s(b,2),X=r(V);l(V);var ke=s(V,2);l(ee),E(he=>{tt(ye,"id",Z()),tt(b,"for",Z()),$(d,`${Re()??""} `),$(J,`(${he??""})`),$(X,`${e(ie)>=0?"+":""}${e(ie)??""}`)},[()=>(N(e(S)),i(()=>e(S).substring(0,3).toUpperCase()))]),ia(ye,()=>c().skillProficiencies[Z()],he=>st(Y,i(c).skillProficiencies[Z()]=he,i(c))),A("click",ke,()=>pe(Z())),v(re,ee)}),l(q),v(W,q)};C(be,W=>{y(),i(()=>!y().skills)&&W(ve)})}l(fe),E(()=>{oe=ct(fe,1,"skills svelte-1f1pl16",null,oe,{hidden:!e(I)}),tt(M,"aria-label",(y(),i(()=>y().skills?"Expand":"Collapse"))),$(_e,(y(),i(()=>y().skills?"â–¼":"â–²")))}),A("click",M,ae),v(a,fe),kt(),B()}let aa=null,sa=null;async function qa(){if(aa)return aa;try{return aa=await(await fetch(Oa("/data/spells.json"))).json(),aa||[]}catch(a){return console.error("Failed to load spells:",a),[]}}async function Ts(){if(sa)return sa;try{return sa=await(await fetch(Oa("/data/feats.json"))).json(),sa||[]}catch(a){return console.error("Failed to load feats:",a),[]}}function Aa(a,n){if(!n.trim())return a;const t=n.toLowerCase();return a.filter(c=>c.name.toLowerCase().includes(t)||c.school.toLowerCase().includes(t)||c.classes.some(g=>g.toLowerCase().includes(t))||c.description.toLowerCase().includes(t))}function Hs(a,n){return n===null?a:a.filter(t=>t.level===n)}function Us(a,n){if(!n.trim())return a;const t=n.toLowerCase();return a.filter(c=>c.name.toLowerCase().includes(t)||c.description.toLowerCase().includes(t))}function la(a){const n=a.description,t=/\b(Strength|Dexterity|Constitution|Intelligence|Wisdom|Charisma)\s+saving\s+throw/i,c=n.match(t);if(!c)return null;const g=c[1].toLowerCase(),L=/half\s+(?:as\s+much\s+)?damage\s+on\s+a\s+successful(?:\s+save)?/i.test(n),_=/saving\s+throw\s+or\s+take.*?damage/i.test(n)&&!L;return{ability:g,halfDamageOnSave:L,noDamageOnSave:_}}var Ns=f('<button class="btn-remove svelte-14o91c5">Ã—</button>'),Bs=f('<div class="spell-info-loading svelte-14o91c5">Loading spell info...</div>'),Gs=f('<div class="spell-notes svelte-14o91c5"><h4 class="svelte-14o91c5">General Notes</h4> <p> </p></div>'),Os=f('<li class="svelte-14o91c5"><strong>At Higher Levels:</strong> </li>'),qs=f('<ul class="svelte-14o91c5"><li class="svelte-14o91c5"><strong>Level:</strong> </li> <li class="svelte-14o91c5"><strong>Casting Time:</strong> </li> <li class="svelte-14o91c5"><strong>Range:</strong> </li> <li class="svelte-14o91c5"><strong>Components:</strong> <!></li> <li class="svelte-14o91c5"><strong>Duration:</strong> <!> </li> <li class="svelte-14o91c5"><strong>Description:</strong> </li> <!></ul>'),zs=f("<option> </option>"),Ws=f('<span class="scaled-damage svelte-14o91c5"><!> </span>'),Ks=f('<span class="scaled-damage svelte-14o91c5"> </span>'),Js=f('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> Target is Fiend or Undead <!></label></div>'),Vs=f('<span class="scaled-damage svelte-14o91c5" style="margin-left: 8px;"> </span>'),Qs=f('<span class="scaled-damage svelte-14o91c5">(Half damage)</span>'),Ys=f('<span class="scaled-damage svelte-14o91c5">(No damage)</span>'),Xs=f('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> <!> <!></label></div>'),Zs=f('<div class="spell-level-selector svelte-14o91c5"><label class="svelte-14o91c5">Cast at Level:</label> <select class="spell-level-select use-enabled svelte-14o91c5"></select> <!></div> <!> <!>',1),el=f('<div class="spell-level-selector svelte-14o91c5"><span style="color: #dc3545; font-weight: bold;">No spell slots available!</span></div>'),tl=f('<!> <div class="spell-info svelte-14o91c5"><div class="spell-info-header svelte-14o91c5" role="button" tabindex="0"><h4 class="svelte-14o91c5">Spell Info</h4> <button class="collapse-btn-small svelte-14o91c5"> </button></div> <!></div> <!>',1),al=f('<div class="spell-info-missing svelte-14o91c5">Spell info not found.</div>'),sl=f('<div class="attack-notes svelte-14o91c5"><label class="svelte-14o91c5">Notes</label> <textarea placeholder="e.g., DC 15 Dex save, Range 120 ft, Concentration" class="notes-input svelte-14o91c5" rows="2"></textarea></div>'),ll=f('<button class="btn btn-primary">Roll Attack</button>'),rl=f('<button class="btn btn-secondary"><!></button>'),il=f('<button class="btn btn-secondary">Roll Damage</button>'),nl=f('<div class="attack-card svelte-14o91c5"><div class="attack-header svelte-14o91c5"><input type="text" placeholder="Attack name" class="attack-name svelte-14o91c5"/> <!></div> <div class="attack-details svelte-14o91c5"><div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Bonus</label> <input type="number" class="attack-bonus svelte-14o91c5"/></div> <div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Damage</label> <input type="text" placeholder="e.g., 2d6+3" class="attack-damage svelte-14o91c5"/></div> <div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Type</label> <input type="text" placeholder="e.g., slashing" class="attack-type svelte-14o91c5"/></div></div> <!> <!> <div class="attack-actions svelte-14o91c5"><!> <!></div></div>'),ol=f('<p class="no-attacks svelte-14o91c5">No attacks added yet. Click "Add Attack" to create one.</p>'),cl=f('<p class="no-attacks svelte-14o91c5">No attacks match your search.</p>'),vl=f('<button class="btn btn-secondary">Add Attack</button> <div class="attacks-list svelte-14o91c5"><!> <!></div>',1),dl=f('<section><div class="header svelte-14o91c5"><h2 class="svelte-14o91c5">Attacks & Spells</h2> <button class="collapse-btn svelte-14o91c5"> </button></div> <!></section>');function ul(a,n){yt(n,!1);const t=()=>ze(Y,"$character",B),c=()=>ze(It,"$searchFilter",B),g=()=>ze(ht,"$collapsedStates",B),y=()=>ze(Jt,"$isEditMode",B),L=()=>ze(Xt,"$abilityModifiers",B),[B,_]=St(),I=R(),le=R(),K=Tt();let T=R({});function pe(d){Ua(T,e(T)[d]=!e(T)[d]),o(T,{...e(T)})}function ae(d){return d.description.toLowerCase().includes("regain")&&(d.description.toLowerCase().includes("hit point")||d.description.toLowerCase().includes("hp"))}function fe(){Y.update(d=>(d.attacks=[...d.attacks,{id:crypto.randomUUID(),name:"",bonus:0,damage:"",damageType:"",notes:""}],d))}function oe(d){Y.update(w=>(w.attacks=w.attacks.filter(J=>J.id!==d),w))}function ce(d){let w=d.damage,J=!1;if(d.spellRef){const X=W(d.spellRef);if(X&&X.level>0){const ke=d.castAtLevel||X.level;if(!q(ke)){alert(`No level ${ke} spell slots available!`);return}const We=la(X);We&&d.targetSucceededSave&&We.noDamageOnSave?w="0":(J=We?.halfDamageOnSave&&d.targetSucceededSave||!1,w=re(d,X))}}const V=`1d20${d.bonus>=0?"+":""}${d.bonus}`;K("roll",{notation:V,damageNotation:w,attackName:d.name,applyHalfDamage:J})}function M(d){if(!d.damage){alert(`${d.name}: No damage specified`);return}let w=d.damage,J=!1;if(d.spellRef){const V=W(d.spellRef);if(V&&V.level>0){const X=d.castAtLevel||V.level;if(!q(X)){alert(`No level ${X} spell slots available!`);return}const he=la(V);he&&d.targetSucceededSave&&he.noDamageOnSave?w="0":(J=he?.halfDamageOnSave&&d.targetSucceededSave||!1,w=re(d,V))}}K("roll",{notation:w,attackName:d.name,applyHalfDamage:J})}function _e(){ht.update(d=>({...d,attacks:!d.attacks}))}let be=R([]),ve=R(!1);Yt(async()=>{o(be,await qa()),o(ve,!0)});function W(d){return e(be).find(w=>w.name===d)}function q(d){t().classFeatures.spellSlotsByLevel||st(Y,i(t).classFeatures.spellSlotsByLevel={},i(t)),t().classFeatures.spellSlotsByLevel[d]||st(Y,i(t).classFeatures.spellSlotsByLevel[d]=Array(2).fill(!1),i(t));const J=t().classFeatures.spellSlotsByLevel[d].findIndex(V=>!V);return J===-1?!1:(Y.update(V=>(V.classFeatures.spellSlotsByLevel||(V.classFeatures.spellSlotsByLevel={}),V.classFeatures.spellSlotsByLevel[d]||(V.classFeatures.spellSlotsByLevel[d]=Array(2).fill(!1)),V.classFeatures.spellSlotsByLevel[d][J]=!0,V)),!0)}function re(d,w){let J=d.damage,V=0;if(w.higherLevelSlot&&d.castAtLevel){const De=w.level,Ie=(d.castAtLevel||De)-De;if(Ie>0){const Ve=w.higherLevelSlot.match(/(\d+)d(\d+)\s+for\s+each.*?level\s+above/i);if(Ve){const[,Qe]=Ve;V+=Ie*parseInt(Qe)}}}if(d.targetIsFiendOrUndead&&w.description.includes("Fiend or an Undead")){const De=w.description.match(/increases by (\d+)d(\d+) if.*?Fiend or.*?Undead/i);if(De){const[,h]=De;V+=parseInt(h)}}const X=J.match(/(\d+)d(\d+)/);if(!X)return J;const[,ke,he]=X;return`${parseInt(ke)+V}d${he}`}function de(d){const w=[];for(let V=d.level;V<=9;V++){const X=t().classFeatures.spellSlotsByLevel?.[V];X&&X.length>0&&w.push(V)}return w}et(()=>(t(),c()),()=>{o(I,t().attacks.filter(d=>{if(!c())return!0;const w=c().toLowerCase();return d.name.toLowerCase().includes(w)||d.damageType.toLowerCase().includes(w)}).sort((d,w)=>!d.spellRef&&w.spellRef?-1:d.spellRef&&!w.spellRef?1:0))}),et(()=>(c(),e(I)),()=>{o(le,!c()||e(I).length>0||"attack".includes(c().toLowerCase())||"spell".includes(c().toLowerCase()))}),Ft(),_t();var Z=dl();let Re;var S=r(Z),ie=s(r(S),2),ee=r(ie,!0);l(ie),l(S);var ye=s(S,2);{var b=d=>{var w=vl(),J=qe(w),V=s(J,2),X=r(V);vt(X,1,()=>e(I),De=>De.id,(De,h,Ie)=>{var Ve=nl(),Qe=r(Ve),Ze=r(Qe);Le(Ze);var H=s(Ze,2);{var j=D=>{var z=Ns();A("click",z,()=>oe(e(h).id)),v(D,z)};C(H,D=>{y()&&D(j)})}l(Qe);var Q=s(Qe,2),ue=r(Q),Be=s(r(ue),2);Le(Be),l(ue);var je=s(ue,2),O=s(r(je),2);Le(O),l(je);var se=s(je,2),x=s(r(se),2);Le(x),l(se),l(Q);var Se=s(Q,2);{var Ce=D=>{var z=nt(),u=qe(z);{var F=P=>{var m=Bs();v(P,m)},U=P=>{const m=at(()=>(e(h),i(()=>W(e(h).spellRef))));var ne=nt(),Pe=qe(ne);{var ge=p=>{var G=tl(),k=qe(G);{var we=it=>{var lt=Gs(),pt=s(r(lt),2),Et=r(pt,!0);l(pt),l(lt),E(()=>$(Et,(e(h),i(()=>e(h).generalNotes)))),v(it,lt)};C(k,it=>{e(h),i(()=>e(h).generalNotes)&&it(we)})}var Ne=s(k,2),Oe=r(Ne),Ue=s(r(Oe),2),Te=r(Ue,!0);l(Ue),l(Oe);var Fe=s(Oe,2);{var me=it=>{var lt=qs(),pt=r(lt),Et=s(r(pt));l(pt);var Ot=s(pt,2),ca=s(r(Ot));l(Ot);var Ct=s(Ot,2),gt=s(r(Ct));l(Ct);var Ht=s(Ct,2),Ut=s(r(Ht)),Zt=s(Ut);{var Pt=Ye=>{var rt=bt();E(()=>$(rt,`(${N(e(m)),i(()=>e(m).material)??""})`)),v(Ye,rt)};C(Zt,Ye=>{N(e(m)),i(()=>e(m).material)&&Ye(Pt)})}l(Ht);var qt=s(Ht,2),ea=s(r(qt),2);{var ta=Ye=>{var rt=bt("Concentration,");v(Ye,rt)};C(ea,Ye=>{N(e(m)),i(()=>e(m).concentration)&&Ye(ta)})}var va=s(ea,1,!0);l(qt);var zt=s(qt,2),da=s(r(zt));l(zt);var ot=s(zt,2);{var dt=Ye=>{var rt=Os(),xt=s(r(rt));l(rt),E(()=>$(xt,` ${N(e(m)),i(()=>e(m).higherLevelSlot)??""}`)),v(Ye,rt)};C(ot,Ye=>{N(e(m)),i(()=>e(m).higherLevelSlot)&&Ye(dt)})}l(lt),E(Ye=>{$(Et,` ${N(e(m)),i(()=>e(m).level)??""}`),$(ca,` ${N(e(m)),i(()=>e(m).castingTime||e(m).actionType)??""}`),$(gt,` ${N(e(m)),i(()=>e(m).range)??""}`),$(Ut,` ${Ye??""}`),$(va,(N(e(m)),i(()=>e(m).duration))),$(da,` ${N(e(m)),i(()=>e(m).description)??""}`)},[()=>(N(e(m)),i(()=>e(m).components.join(", ")))]),v(it,lt)};C(Fe,it=>{e(T),e(h),i(()=>!e(T)[e(h).id])&&it(me)})}l(Ne);var $e=s(Ne,2);{var Mt=it=>{const lt=at(()=>(N(e(m)),i(()=>de(e(m)))));var pt=nt(),Et=qe(pt);{var Ot=Ct=>{const gt=at(()=>(N(la),N(e(m)),i(()=>la(e(m)))));var Ht=Zs(),Ut=qe(Ht),Zt=r(Ut),Pt=s(Zt,2);E(()=>{e(h),Dt(()=>{e(lt)})}),vt(Pt,5,()=>e(lt),ut,(ot,dt)=>{var Ye=zs(),rt=r(Ye);l(Ye);var xt={};E(()=>{$(rt,`Level ${e(dt)??""}`),xt!==(xt=e(dt))&&(Ye.value=(Ye.__value=e(dt))??"")}),v(ot,Ye)}),l(Pt);var qt=s(Pt,2);{var ea=ot=>{const dt=at(()=>(e(h),N(e(m)),i(()=>re(e(h),e(m)))));var Ye=Ws(),rt=r(Ye);{var xt=Lt=>{var jt=bt("Healing");v(Lt,jt)},Nt=Lt=>{var jt=bt("Damage");v(Lt,jt)};C(rt,Lt=>{N(e(m)),i(()=>ae(e(m)))?Lt(xt):Lt(Nt,!1)})}var wt=s(rt);l(Ye),E(()=>$(wt,` ${e(dt)??""}`)),v(ot,Ye)};C(qt,ot=>{e(h),N(e(m)),i(()=>e(h).castAtLevel&&e(h).castAtLevel>e(m).level)&&ot(ea)})}l(Ut);var ta=s(Ut,2);{var va=ot=>{var dt=Js(),Ye=r(dt),rt=r(Ye);Le(rt);var xt=s(rt,2);{var Nt=wt=>{const Lt=at(()=>(e(h),N(e(m)),i(()=>re(e(h),e(m)))));var jt=Ks(),ua=r(jt);l(jt),E(()=>$(ua,`(+1d8, total: ${e(Lt)??""})`)),v(wt,jt)};C(xt,wt=>{e(h),i(()=>e(h).targetIsFiendOrUndead)&&wt(Nt)})}l(Ye),l(dt),ia(rt,()=>e(h).targetIsFiendOrUndead,wt=>(e(h).targetIsFiendOrUndead=wt,Dt(()=>(e(I),t(),c())))),v(ot,dt)};C(ta,ot=>{N(e(m)),i(()=>e(m).description.includes("Fiend or an Undead"))&&ot(va)})}var zt=s(ta,2);{var da=ot=>{var dt=Xs(),Ye=r(dt),rt=r(Ye);Le(rt);var xt=s(rt),Nt=s(xt);{var wt=ft=>{var At=Vs(),pa=r(At);l(At),E(fa=>$(pa,`(Spell Save DC: ${fa??""})`),[()=>(N(xa),t(),L(),i(()=>xa(t(),L())))]),v(ft,At)};C(Nt,ft=>{t(),i(()=>t().class)&&ft(wt)})}var Lt=s(Nt,2);{var jt=ft=>{var At=Qs();v(ft,At)},ua=ft=>{var At=nt(),pa=qe(At);{var fa=ba=>{var za=Ys();v(ba,za)};C(pa,ba=>{e(h),N(e(gt)),i(()=>e(h).targetSucceededSave&&e(gt).noDamageOnSave)&&ba(fa)},!0)}v(ft,At)};C(Lt,ft=>{e(h),N(e(gt)),i(()=>e(h).targetSucceededSave&&e(gt).halfDamageOnSave)?ft(jt):ft(ua,!1)})}l(Ye),l(dt),E(ft=>$(xt,` Target succeeded on ${ft??""} save `),[()=>(N(e(gt)),i(()=>e(gt).ability.charAt(0).toUpperCase()+e(gt).ability.slice(1)))]),ia(rt,()=>e(h).targetSucceededSave,ft=>(e(h).targetSucceededSave=ft,Dt(()=>(e(I),t(),c())))),v(ot,dt)};C(zt,ot=>{e(gt)&&ot(da)})}E(()=>{tt(Zt,"for",`castLevel-${e(h),i(()=>e(h).id)??""}`),tt(Pt,"id",`castLevel-${e(h),i(()=>e(h).id)??""}`)}),Ga(Pt,()=>e(h).castAtLevel,ot=>(e(h).castAtLevel=ot,Dt(()=>(e(I),t(),c())))),v(Ct,Ht)},ca=Ct=>{var gt=el();v(Ct,gt)};C(Et,Ct=>{N(e(lt)),i(()=>e(lt).length>0)?Ct(Ot):Ct(ca,!1)})}v(it,pt)};C($e,it=>{N(e(m)),i(()=>e(m).higherLevelSlot&&e(m).level>0)&&it(Mt)})}E(()=>{tt(Ue,"aria-label",(e(T),e(h),i(()=>e(T)[e(h).id]?"Expand":"Collapse"))),$(Te,(e(T),e(h),i(()=>e(T)[e(h).id]?"â–¼":"â–²")))}),A("click",Oe,()=>pe(e(h).id)),A("keydown",Oe,it=>it.key==="Enter"&&pe(e(h).id)),v(p,G)},He=p=>{var G=al();v(p,G)};C(Pe,p=>{e(m)?p(ge):p(He,!1)})}v(P,ne)};C(u,P=>{e(be),i(()=>e(be).length===0)?P(F):P(U,!1)})}v(D,z)};C(Se,D=>{e(h),i(()=>e(h).spellRef)&&D(Ce)})}var Me=s(Se,2);{var Ke=D=>{var z=sl(),u=s(r(z),2);Kt(u),l(z),Ae(u,()=>e(h).notes,F=>(e(h).notes=F,Dt(()=>(e(I),t(),c())))),v(D,z)};C(Me,D=>{e(h),i(()=>!e(h).spellRef)&&D(Ke)})}var Xe=s(Me,2),Ee=r(Xe);{var te=D=>{var z=ll();A("click",z,()=>ce(e(h))),v(D,z)};C(Ee,D=>{e(h),i(()=>e(h).bonus!==0||!e(h).spellRef)&&D(te)})}var xe=s(Ee,2);{var Ge=D=>{const z=at(()=>(e(h),i(()=>W(e(h).spellRef))));var u=rl(),F=r(u);{var U=m=>{var ne=bt("Roll Healing");v(m,ne)},P=m=>{var ne=bt("Roll Damage");v(m,ne)};C(F,m=>{N(e(z)),i(()=>e(z)&&ae(e(z)))?m(U):m(P,!1)})}l(u),A("click",u,()=>M(e(h))),v(D,u)},Je=D=>{var z=il();A("click",z,()=>M(e(h))),v(D,z)};C(xe,D=>{e(h),e(ve),i(()=>e(h).spellRef&&e(ve))?D(Ge):D(Je,!1)})}l(Xe),l(Ve),Ae(Ze,()=>e(h).name,D=>(e(h).name=D,Dt(()=>(e(I),t(),c())))),Ae(Be,()=>e(h).bonus,D=>(e(h).bonus=D,Dt(()=>(e(I),t(),c())))),Ae(O,()=>e(h).damage,D=>(e(h).damage=D,Dt(()=>(e(I),t(),c())))),Ae(x,()=>e(h).damageType,D=>(e(h).damageType=D,Dt(()=>(e(I),t(),c())))),v(De,Ve)});var ke=s(X,2);{var he=De=>{var h=ol();v(De,h)},We=De=>{var h=nt(),Ie=qe(h);{var Ve=Qe=>{var Ze=cl();v(Qe,Ze)};C(Ie,Qe=>{e(I),i(()=>e(I).length===0)&&Qe(Ve)},!0)}v(De,h)};C(ke,De=>{t(),i(()=>t().attacks.length===0)?De(he):De(We,!1)})}l(V),A("click",J,fe),v(d,w)};C(ye,d=>{g(),i(()=>!g().attacks)&&d(b)})}l(Z),E(()=>{Re=ct(Z,1,"attacks svelte-14o91c5",null,Re,{hidden:!e(le)}),tt(ie,"aria-label",(g(),i(()=>g().attacks?"Expand":"Collapse"))),$(ee,(g(),i(()=>g().attacks?"â–¼":"â–²")))}),A("click",ie,_e),v(a,Z),kt(),_()}var pl=f('<span class="slot-checkbox-x svelte-serp1j">&#8212;</span>'),fl=f('<label><input type="checkbox" class="slot-checkbox-input svelte-serp1j"/> <span><!></span></label>');function Ra(a,n){yt(n,!1);const t=()=>ze(Jt,"$isEditMode",c),[c,g]=St();let y=mt(n,"checked",8,!1),L=mt(n,"disabled",8,!1),B=mt(n,"className",8,""),_=mt(n,"index",8,void 0),I=mt(n,"ariaLabel",8,void 0);const le=Tt();function K(ce){le("change",{checked:ce.currentTarget.checked,index:_()})}_t();var T=fl(),pe=r(T);Le(pe);var ae=s(pe,2),fe=r(ae);{var oe=ce=>{var M=pl();v(ce,M)};C(fe,ce=>{y()&&ce(oe)})}l(ae),l(T),E(()=>{ct(T,1,"slot-checkbox-label "+B()+(t()?"":" not-editable"),"svelte-serp1j"),us(pe,y()),pe.disabled=L()||!t(),tt(pe,"aria-label",I()),tt(pe,"tabindex",t()?0:-1),ct(ae,1,`slot-checkbox-custom ${y()?"used":""} ${t()?"":"readonly"}`,"svelte-serp1j")}),A("change",pe,K),v(a,T),kt(),g()}var bl=f('<p class="no-features svelte-1kpvv0n">Select a class to see available features</p>'),hl=f('<p class="no-features svelte-1kpvv0n">No class features available at this level</p>'),gl=f('<div class="spell-slots svelte-1kpvv0n"><label class="svelte-1kpvv0n"> </label> <div class="slots-tracker svelte-1kpvv0n"></div></div>'),ml=f('<div class="all-spell-slots"></div>'),_l=f('<div class="feature-box spellcasting svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"> </h3> <div class="spell-stats svelte-1kpvv0n"><div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Spell Save DC</label> <div class="spell-value svelte-1kpvv0n"> </div></div> <div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <div class="spell-value svelte-1kpvv0n"> </div></div></div> <!> <div class="prepared-spells svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <textarea placeholder="List your prepared spells..." class="svelte-1kpvv0n"></textarea></div></div>'),yl=f('<p class="unlimited svelte-1kpvv0n">Unlimited Uses</p>'),kl=f('<div class="slots-tracker svelte-1kpvv0n"></div> <div class="uses-actions-row"><button class="btn btn-primary use-enabled"> </button></div> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div>',1),xl=f('<div class="uses-tracker svelte-1kpvv0n"><!></div>'),$l=f('<div class="pool-tracker svelte-1kpvv0n"><input type="number" min="0" class="pool-input svelte-1kpvv0n"/> <span> </span> <button class="btn-small svelte-1kpvv0n"> </button></div>'),Sl=f('<p class="no-uses svelte-1kpvv0n">No Channel Divinity uses remaining</p>'),Cl=f('<div class="channel-divinity-option svelte-1kpvv0n"><button class="btn btn-primary use-enabled svelte-1kpvv0n">Use Channel Divinity</button> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div> <!></div>'),Ll=f('<div class="feature-box svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"><!> </h3> <p class="feature-description svelte-1kpvv0n"> </p> <!></div>'),Dl=f('<div class="features-grid svelte-1kpvv0n"><!> <!></div>'),wl=f('<section><div class="header svelte-1kpvv0n"><h2 class="svelte-1kpvv0n">Class Features</h2> <button class="collapse-btn svelte-1kpvv0n"> </button></div> <!></section>');function jl(a,n){yt(n,!1);const t=()=>ze(Y,"$character",L),c=()=>ze(Xt,"$abilityModifiers",L),g=()=>ze(It,"$searchFilter",L),y=()=>ze(ht,"$collapsedStates",L),[L,B]=St(),_=R(),I=R(),le=R(),K=R(),T=R(),pe=R(),ae=R();let fe=R(0),oe=R(0);function ce(b,d){Y.update(w=>(w.classFeatures.features[b]=d,w))}function M(){Y.update(b=>(b.classFeatures.spellSlotsByLevel||(b.classFeatures.spellSlotsByLevel={}),e(K).forEach(({level:d,slots:w})=>{b.classFeatures.spellSlotsByLevel[d]||(b.classFeatures.spellSlotsByLevel[d]=Array(w).fill(!1))}),b))}function _e(b){if(typeof b.maxUses=="function"){if((b.name==="Divine Sense"||b.name==="War Priest")&&e(_)?.spellcastingAbility){const d=c()[e(_).spellcastingAbility];return b.maxUses(t().level,d)}return b.maxUses(t().level)}return b.maxUses||0}function be(b,d){Y.update(w=>((!w.classFeatures.features[b]||!Array.isArray(w.classFeatures.features[b])||w.classFeatures.features[b].length!==d)&&(w.classFeatures.features[b]=Array(d).fill(!1)),w))}Wa(()=>{e(pe)&&t()&&t().classFeatures&&t().classFeatures.features&&e(pe).forEach(b=>{if(b.type==="uses"){const d=b.name.replace(/\s+/g,""),w=_e(b),J=t().classFeatures.features[d];(!Array.isArray(J)||J.length!==w)&&be(d,w)}})});function ve(b){return typeof b.maxPool=="function"?b.maxPool(t().level):b.maxPool||0}function W(b){return typeof b.description=="function"?b.description(t().level):b.description}function q(){const b="ChannelDivinity";Y.update(d=>{const w=d.classFeatures.features[b];return typeof w=="number"&&w>0&&(d.classFeatures.features[b]=w-1),d})}function re(){ht.update(b=>({...b,classFeatures:!b.classFeatures}))}et(()=>(t(),$t),()=>{o(_,t().class?$t(t().class):null)}),et(()=>(t(),Gt),()=>{o(I,t().class?Gt(t().class,t().level,t().subclass):[])}),et(()=>(t(),ja),()=>{o(le,t().class?ja(t().class,t().level):0)}),et(()=>(e(_),t()),()=>{o(K,(()=>{if(!e(_)?.spellcaster)return[];const b=t().level,d=[];return b>=1&&d.push({level:1,slots:Math.min(4,2+Math.floor(b/3))}),b>=3&&d.push({level:2,slots:Math.min(3,2+Math.floor((b-3)/4))}),b>=5&&d.push({level:3,slots:Math.min(3,2+Math.floor((b-5)/5))}),b>=7&&d.push({level:4,slots:Math.min(3,1+Math.floor((b-7)/6))}),b>=9&&d.push({level:5,slots:Math.min(2,1+Math.floor((b-9)/8))}),b>=11&&d.push({level:6,slots:1}),b>=13&&d.push({level:7,slots:1}),b>=15&&d.push({level:8,slots:1}),b>=17&&d.push({level:9,slots:1}),d})())}),et(()=>(e(_),c(),t(),Fa),()=>{if(e(_)?.spellcaster&&e(_).spellcastingAbility){const b=c()[e(_).spellcastingAbility];o(fe,hs(t().class,b,t().proficiencyBonus)||0),o(oe,Fa(t().class,t().level,b))}}),et(()=>(t(),e(_),e(K)),()=>{t().class&&e(_)?.spellcaster&&e(K).length>0&&M()}),et(()=>t(),()=>{o(T,(()=>{const d=t().classFeatures.features["ChannelDivinity"];return typeof d=="number"?d:0})())}),et(()=>(e(I),g()),()=>{o(pe,e(I).filter(b=>{if(!g())return!0;const d=g().toLowerCase();return b.name.toLowerCase().includes(d)||W(b).toLowerCase().includes(d)}))}),et(()=>(g(),t(),e(pe)),()=>{o(ae,!g()||t().class||"class features".includes(g().toLowerCase())||"spellcasting".includes(g().toLowerCase())||e(pe).length>0)}),Ft(),_t();var de=wl();let Z;var Re=r(de),S=s(r(Re),2),ie=r(S,!0);l(S),l(Re);var ee=s(Re,2);{var ye=b=>{var d=nt(),w=qe(d);{var J=X=>{var ke=bl();v(X,ke)},V=X=>{var ke=nt(),he=qe(ke);{var We=h=>{var Ie=hl();v(h,Ie)},De=h=>{var Ie=Dl(),Ve=r(Ie);{var Qe=H=>{var j=_l(),Q=r(j),ue=r(Q);l(Q);var Be=s(Q,2),je=r(Be),O=s(r(je),2),se=r(O,!0);l(O),l(je);var x=s(je,2),Se=s(r(x),2),Ce=r(Se,!0);l(Se),l(x),l(Be);var Me=s(Be,2);{var Ke=te=>{var xe=ml();vt(xe,5,()=>e(K),ut,(Ge,Je)=>{let D=()=>e(Je).level,z=()=>e(Je).slots;const u=at(()=>(t(),D(),z(),i(()=>t().classFeatures.spellSlotsByLevel?.[D()]||Array(z()).fill(!1))));var F=gl(),U=r(F),P=r(U);l(U);var m=s(U,2);vt(m,5,()=>e(u),ut,(ne,Pe,ge)=>{{let He=at(()=>(N(e(u)),i(()=>e(u)[ge]||!1)));Ra(ne,{get checked(){return e(He)},$$events:{change:p=>{Y.update(G=>(G.classFeatures.spellSlotsByLevel||(G.classFeatures.spellSlotsByLevel={}),G.classFeatures.spellSlotsByLevel[D()]||(G.classFeatures.spellSlotsByLevel[D()]=Array(z()).fill(!1)),G.classFeatures.spellSlotsByLevel[D()][ge]=p.detail.checked,G))}}})}}),l(m),l(F),E(()=>$(P,`${D()===1?"1st":D()===2?"2nd":D()===3?"3rd":`${D()}th`} Level Spell Slots`)),v(Ge,F)}),l(xe),v(te,xe)};C(Me,te=>{e(K),i(()=>e(K).length>0)&&te(Ke)})}var Xe=s(Me,2),Ee=s(r(Xe),2);Kt(Ee),l(Xe),l(j),E(te=>{$(ue,`Spellcasting (${te??""})`),$(se,e(fe)),$(Ce,e(oe))},[()=>(e(_),i(()=>e(_).spellcastingAbility?.toUpperCase()))]),Ae(Ee,()=>t().classFeatures.preparedSpells,te=>st(Y,i(t).classFeatures.preparedSpells=te,i(t))),v(H,j)};C(Ve,H=>{e(_),i(()=>e(_)?.spellcaster)&&H(Qe)})}var Ze=s(Ve,2);vt(Ze,1,()=>e(pe),ut,(H,j)=>{const Q=at(()=>(e(j),i(()=>e(j).name.replace(/\s+/g,"")))),ue=at(()=>(t(),N(e(Q)),i(()=>t().classFeatures.features[e(Q)]))),Be=at(()=>typeof e(ue)=="number");var je=Ll(),O=r(je),se=r(O);{var x=te=>{var xe=bt("Channel Divinity:");v(te,xe)};C(se,te=>{e(j),i(()=>e(j).type==="channelDivinity")&&te(x)})}var Se=s(se);l(O);var Ce=s(O,2),Me=r(Ce,!0);l(Ce);var Ke=s(Ce,2);{var Xe=te=>{const xe=at(()=>(e(j),i(()=>_e(e(j))))),Ge=at(()=>(N(e(ue)),N(e(xe)),i(()=>Array.isArray(e(ue))?e(ue):Array(e(xe)).fill(!1))));var Je=xl(),D=r(Je);{var z=F=>{var U=yl();v(F,U)},u=F=>{var U=kl(),P=qe(U);vt(P,5,()=>e(Ge),ut,(G,k,we)=>{Ra(G,{get checked(){return e(k)},index:we,$$events:{change:Ne=>{Y.update(Oe=>(Oe.classFeatures.features[e(Q)]||(Oe.classFeatures.features[e(Q)]=Array(e(xe)).fill(!1)),Oe.classFeatures.features[e(Q)][we]=Ne.detail.checked,Oe))}}})}),l(P);var m=s(P,2),ne=r(m),Pe=r(ne);l(ne),l(m);var ge=s(m,2),He=r(ge),p=r(He);l(He),l(ge),E(G=>{ne.disabled=G,$(Pe,`Use ${e(j),i(()=>e(j).name)??""}`),$(p,`Resets on ${e(j),i(()=>e(j).resetOn==="short"?"Short Rest":"Long Rest")??""}`)},[()=>(N(e(Ge)),i(()=>e(Ge).filter(G=>!G).length<=0))]),A("click",ne,()=>{Y.update(G=>{G.classFeatures.features[e(Q)]||(G.classFeatures.features[e(Q)]=Array(e(xe)).fill(!1));const k=G.classFeatures.features[e(Q)],we=k.findIndex(Ne=>!Ne);return we!==-1&&(k[we]=!0),G})}),v(F,U)};C(D,F=>{e(xe)===1/0?F(z):F(u,!1)})}l(Je),v(te,Je)},Ee=te=>{var xe=nt(),Ge=qe(xe);{var Je=z=>{const u=at(()=>(e(j),i(()=>ve(e(j)))));var F=$l(),U=r(F);Le(U);var P=s(U,2),m=r(P);l(P);var ne=s(P,2),Pe=r(ne,!0);l(ne),l(F),E(()=>{Sa(U,e(Be)&&e(ue)!==void 0?e(ue):e(u)),tt(U,"max",e(u)),$(m,`/ ${e(u)??""}`),$(Pe,(e(j),i(()=>e(j).resetOn==="short"?"Short Rest":"Long Rest")))}),A("input",U,ge=>{Y.update(He=>(He.classFeatures.features[e(Q)]=parseInt(ge.currentTarget.value)||0,He))}),A("click",ne,()=>ce(e(Q),e(u))),v(z,F)},D=z=>{var u=nt(),F=qe(u);{var U=P=>{var m=Cl(),ne=r(m),Pe=s(ne,2),ge=r(Pe),He=r(ge);l(ge),l(Pe);var p=s(Pe,2);{var G=k=>{var we=Sl();v(k,we)};C(p,k=>{e(T)<=0&&k(G)})}l(m),E(()=>{ne.disabled=e(T)<=0,$(He,`Resets on ${e(j),i(()=>e(j).resetOn==="short"?"Short Rest":"Long Rest")??""}`)}),A("click",ne,q),v(P,m)};C(F,P=>{e(j),i(()=>e(j).type==="channelDivinity")&&P(U)},!0)}v(z,u)};C(Ge,z=>{e(j),i(()=>e(j).type==="pool")?z(Je):z(D,!1)},!0)}v(te,xe)};C(Ke,te=>{e(j),i(()=>e(j).type==="uses")?te(Xe):te(Ee,!1)})}l(je),E(te=>{$(Se,` ${e(j),i(()=>e(j).name)??""}`),$(Me,te)},[()=>(e(j),i(()=>W(e(j))))]),v(H,je)}),l(Ie),v(h,Ie)};C(he,h=>{e(I),i(()=>e(I).length===0)?h(We):h(De,!1)},!0)}v(X,ke)};C(w,X=>{t(),i(()=>!t().class)?X(J):X(V,!1)})}v(b,d)};C(ee,b=>{y(),i(()=>!y().classFeatures)&&b(ye)})}l(de),E(()=>{Z=ct(de,1,"class-features svelte-1kpvv0n",null,Z,{hidden:!e(ae)}),tt(S,"aria-label",(y(),i(()=>y().classFeatures?"Expand":"Collapse"))),$(ie,(y(),i(()=>y().classFeatures?"â–¼":"â–²")))}),A("click",S,re),v(a,de),kt(),B()}var Fl=f('<textarea placeholder="Enter features, traits, and special abilities..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Equipment</h3> <textarea placeholder="List your equipment and inventory..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Notes</h3> <textarea placeholder="Additional notes..." class="svelte-wttn0l"></textarea>',1),Al=f('<section><div class="header svelte-wttn0l"><h2 class="svelte-wttn0l">Features & Traits</h2> <button class="collapse-btn svelte-wttn0l"> </button></div> <!></section>');function Rl(a,n){yt(n,!1);const t=()=>ze(It,"$searchFilter",y),c=()=>ze(Y,"$character",y),g=()=>ze(ht,"$collapsedStates",y),[y,L]=St(),B=R();function _(){ht.update(oe=>({...oe,notes:!oe.notes}))}et(()=>(t(),c()),()=>{o(B,!t()||"features".includes(t().toLowerCase())||"traits".includes(t().toLowerCase())||"equipment".includes(t().toLowerCase())||"notes".includes(t().toLowerCase())||c().features.toLowerCase().includes(t().toLowerCase())||c().equipment.toLowerCase().includes(t().toLowerCase())||c().notes.toLowerCase().includes(t().toLowerCase()))}),Ft(),_t();var I=Al();let le;var K=r(I),T=s(r(K),2),pe=r(T,!0);l(T),l(K);var ae=s(K,2);{var fe=oe=>{var ce=Fl(),M=qe(ce);Kt(M);var _e=s(M,4);Kt(_e);var be=s(_e,4);Kt(be),Ae(M,()=>c().features,ve=>st(Y,i(c).features=ve,i(c))),Ae(_e,()=>c().equipment,ve=>st(Y,i(c).equipment=ve,i(c))),Ae(be,()=>c().notes,ve=>st(Y,i(c).notes=ve,i(c))),v(oe,ce)};C(ae,oe=>{g(),i(()=>!g().notes)&&oe(fe)})}l(I),E(()=>{le=ct(I,1,"notes svelte-wttn0l",null,le,{hidden:!e(B)}),tt(T,"aria-label",(g(),i(()=>g().notes?"Expand":"Collapse"))),$(pe,(g(),i(()=>g().notes?"â–¼":"â–²")))}),A("click",T,_),v(a,I),kt(),L()}var Il=f('<div class="color-picker-section svelte-1r90jgp"><h3 class="svelte-1r90jgp">Dice Colors</h3> <div class="color-inputs svelte-1r90jgp"><div class="color-input-group svelte-1r90jgp"><label for="dice-color" class="svelte-1r90jgp">Dice Color</label> <input type="color" id="dice-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="label-color" class="svelte-1r90jgp">Label Color</label> <input type="color" id="label-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="desk-color" class="svelte-1r90jgp">Background Color</label> <input type="color" id="desk-color" class="svelte-1r90jgp"/></div></div></div>'),Ml=f('<div class="loading svelte-1r90jgp"><p class="svelte-1r90jgp">Loading 3D dice...</p></div>'),El=f('<div class="custom-dice-selector svelte-1r90jgp"><h3 class="svelte-1r90jgp">Choose Dice to Roll</h3> <div class="dice-inputs svelte-1r90jgp"><div class="dice-input-group svelte-1r90jgp"><label for="d4" class="svelte-1r90jgp">d4</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d4" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d6" class="svelte-1r90jgp">d6</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d6" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d8" class="svelte-1r90jgp">d8</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d8" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d10" class="svelte-1r90jgp">d10</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d10" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d12" class="svelte-1r90jgp">d12</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d12" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d20" class="svelte-1r90jgp">d20</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d20" min="0" max="10"/></div></div> <div class="dice-controls svelte-1r90jgp"><button class="btn btn-primary use-enabled svelte-1r90jgp"> </button> <button class="btn btn-secondary use-enabled svelte-1r90jgp">Reset</button></div></div>'),Pl=f('<span class="crit-badge svelte-1r90jgp">CRITICAL!</span>'),Tl=f('<p class="svelte-1r90jgp"> </p>'),Hl=f('<p class="modifier-text svelte-1r90jgp"> </p>'),Ul=f('<button class="btn btn-follow-up svelte-1r90jgp"> </button>'),Nl=f('<button class="btn btn-guided-strike svelte-1r90jgp">âš¡ Use Guided Strike (+10)</button>'),Bl=f('<div class="follow-up-actions svelte-1r90jgp"><!> <!></div>'),Gl=f('<div class="result-header svelte-1r90jgp"><h3 class="svelte-1r90jgp"> </h3> <!></div> <div class="result-total svelte-1r90jgp"> </div> <div class="result-details svelte-1r90jgp"><!> <!></div> <!>',1),Ol=f('<div role="button" tabindex="-1"><div class="modal-content svelte-1r90jgp" role="dialog" tabindex="0"><div class="modal-header svelte-1r90jgp"><h2 class="svelte-1r90jgp">Dice Roller</h2> <div class="header-buttons svelte-1r90jgp"><button class="color-btn svelte-1r90jgp" title="Customize dice colors">ðŸŽ¨</button> <button class="close-btn svelte-1r90jgp">Ã—</button></div></div> <!> <!> <div class="dice-main-area svelte-1r90jgp"><div class="dice-container svelte-1r90jgp"></div> <!></div> <div><!></div></div></div>');function ql(a,n){yt(n,!1);const t=()=>ze(Y,"$character",c),[c,g]=St(),y=R(),L=R(),B=R(),_=Tt();let I=mt(n,"notation",12,""),le=mt(n,"visible",8,!1),K=mt(n,"damageNotation",12,""),T=mt(n,"attackName",12,""),pe=mt(n,"applyHalfDamage",8,!1),ae=null,fe=R(void 0),oe=R(!1),ce=R(""),M=R(null);function _e(){return e(M)?.resultTotal??null}let be=R(0),ve=R(0),W=R(0),q=R(0),re=R(0),de=R(0),Z=R(0),Re=R([]),S=R(!1),ie=R("other"),ee=R(!1),ye=R("#051e0a"),b=R("#ffffff"),d=R("#3a2004"),w=R(!1);function J(u){return u.length===9&&u.startsWith("#")?u.substring(0,7):u}function V(u,F="ff"){return u.length===7&&u.startsWith("#")?u+F:u}function X(){if(window.DICE&&e(fe))try{ae&&e(fe)&&Ua(fe,e(fe).innerHTML="");const u=e(fe).clientWidth||500,F=e(fe).clientHeight||300;ae=new window.DICE.dice_box(e(fe),{w:u,h:F}),o(oe,!0)}catch(u){console.error("Error initializing dice box:",u)}}Yt(()=>{const u=P=>new Promise((m,ne)=>{if(document.querySelector(`script[src="${P}"]`)){console.log(`Script already loaded: ${P}`),m(null);return}const ge=document.createElement("script");ge.src=P,ge.onload=()=>{console.log(`Loaded: ${P}`),m(null)},ge.onerror=()=>{console.error(`Failed to load: ${P}`),ne(new Error(`Failed to load ${P}`))},document.head.appendChild(ge)});setTimeout(()=>{u(`${Wt}/libs/three.min.js`).then(()=>u(`${Wt}/libs/cannon.min.js`)).then(()=>u(`${Wt}/libs/teal.js`)).then(()=>u(`${Wt}/dice.js`)).then(()=>{if(console.log("All scripts loaded, initializing dice box..."),console.log("DICE available:",!!window.DICE),console.log("Container available:",!!e(fe)),window.DICE){const P=window.DICE.getColors();o(ye,J(P.dice_color)),o(b,J(P.label_color)),o(d,J(P.desk_color))}X()}).catch(P=>{console.error("Failed to load dice libraries:",P)})},100);const F=()=>{e(oe)&&(console.log("Window resized, reinitializing dice box..."),X())},U=P=>{le()&&P.key==="Escape"&&Ze()};return window.addEventListener("resize",F),window.addEventListener("keydown",U),()=>{window.removeEventListener("resize",F),window.removeEventListener("keydown",U)}});function ke(u,F="other"){if(!ae||!e(oe))return;console.log("Rolling dice:",u,"type:",F),o(ie,F),o(ee,!1),ae.diceToRoll=u;const U=m=>(console.log("Before roll:",m),null),P=m=>{console.log("After roll:",m);let ne=m.resultTotal,Pe=m.resultString;if(pe()&&(ne=Math.floor(ne/2),Pe=Pe+" (halved)"),o(M,{...m,resultTotal:ne,resultString:Pe}),F==="attack"||F==="check"||F==="save"){const ge=m.results?.filter(He=>He.sides===20)||[];if(ge.length>0){const He=ge[0].value;o(S,He===20)}}if(o(Re,[]),F==="attack"&&K())if(e(S)){const ge=De(K());e(Re).push({label:`Roll Critical Damage (${ge})`,notation:ge})}else e(Re).push({label:`Roll Damage (${K()})`,notation:K()})};ae.start_throw(U,P)}function he(){const u=[];e(be)>0&&u.push(`${e(be)}d4`),e(ve)>0&&u.push(`${e(ve)}d6`),e(W)>0&&u.push(`${e(W)}d8`),e(q)>0&&u.push(`${e(q)}d10`),e(re)>0&&u.push(`${e(re)}d12`),e(de)>0&&u.push(`${e(de)}d20`);let F=u.join("+")||"1d20";return e(Z)!==0&&(F+=e(Z)>=0?`+${e(Z)}`:`${e(Z)}`),F}function We(){const u=he();ke(u)}function De(u){return u.replace(/(\d+)d(\d+)/g,(F,U,P)=>`${parseInt(U)*2}d${P}`)}function h(){o(be,0),o(ve,0),o(W,0),o(q,0),o(re,0),o(de,0),o(Z,0),o(M,null),o(Re,[]),o(S,!1),o(ie,"other"),o(ee,!1)}function Ie(){window.DICE&&(window.DICE.setColors({dice_color:V(e(ye),"ff"),label_color:V(e(b),"ff"),desk_color:e(d)}),ae&&(ae.updateDeskColor(e(d)),ae.updateDiceColors()))}function Ve(){o(w,!e(w))}function Qe(){!e(M)||e(L)<=0||e(ee)||(o(M,{...e(M),resultTotal:e(M).resultTotal+10,resultString:e(M).resultString+" + 10 (Guided Strike)"}),Y.update(u=>{const F="ChannelDivinity",U=u.classFeatures.features[F];return typeof U=="number"&&U>0&&(u.classFeatures.features[F]=U-1),u}),o(ee,!0))}function Ze(){_("close"),I(""),K(""),T(""),o(ce,""),o(M,null),o(ee,!1),h()}et(()=>(t(),Gt),()=>{o(y,t().class?Gt(t().class,t().level,t().subclass).some(F=>F.name==="Guided Strike"):!1)}),et(()=>t(),()=>{o(L,(()=>{const F=t().classFeatures.features["ChannelDivinity"];return typeof F=="number"?F:0})())}),et(()=>(e(be),e(ve),e(W),e(q),e(re),e(de),e(Z)),()=>{o(B,(()=>{const u=[];e(be)>0&&u.push(`${e(be)}d4`),e(ve)>0&&u.push(`${e(ve)}d6`),e(W)>0&&u.push(`${e(W)}d8`),e(q)>0&&u.push(`${e(q)}d10`),e(re)>0&&u.push(`${e(re)}d12`),e(de)>0&&u.push(`${e(de)}d20`);let F=u.join("+")||"1d20";return e(Z)!==0&&(F+=e(Z)>=0?`+${e(Z)}`:`${e(Z)}`),F})())}),et(()=>(N(I()),e(oe),N(le()),e(ce),N(K()),N(T())),()=>{if(I()&&e(oe)&&le()&&I()!==e(ce)){o(ce,I()),o(M,null),o(Re,[]),o(S,!1),o(ee,!1);const u=I().includes("1d20")?"attack":"other";console.log("Auto-roll triggered. notation:",I(),"damageNotation:",K(),"attackName:",T()),setTimeout(()=>ke(I(),u),200)}}),Ft();var H={getLastRollTotal:_e};_t();var j=Ol();let Q;var ue=r(j),Be=r(ue),je=s(r(Be),2),O=r(je),se=s(O,2);l(je),l(Be);var x=s(Be,2);{var Se=u=>{var F=Il(),U=s(r(F),2),P=r(U),m=s(r(P),2);Le(m),l(P);var ne=s(P,2),Pe=s(r(ne),2);Le(Pe),l(ne);var ge=s(ne,2),He=s(r(ge),2);Le(He),l(ge),l(U),l(F),Ae(m,()=>e(ye),p=>o(ye,p)),A("change",m,Ie),Ae(Pe,()=>e(b),p=>o(b,p)),A("change",Pe,Ie),Ae(He,()=>e(d),p=>o(d,p)),A("change",He,Ie),v(u,F)};C(x,u=>{e(w)&&u(Se)})}var Ce=s(x,2);{var Me=u=>{var F=Ml();v(u,F)};C(Ce,u=>{e(oe)||u(Me)})}var Ke=s(Ce,2),Xe=r(Ke);_a(Xe,u=>o(fe,u),()=>e(fe));var Ee=s(Xe,2);{var te=u=>{var F=El(),U=s(r(F),2),P=r(U),m=s(r(P),2);Le(m),l(P);var ne=s(P,2),Pe=s(r(ne),2);Le(Pe),l(ne);var ge=s(ne,2),He=s(r(ge),2);Le(He),l(ge);var p=s(ge,2),G=s(r(p),2);Le(G),l(p);var k=s(p,2),we=s(r(k),2);Le(we),l(k);var Ne=s(k,2),Oe=s(r(Ne),2);Le(Oe),l(Ne),l(U);var Ue=s(U,2),Te=r(Ue),Fe=r(Te);l(Te);var me=s(Te,2);l(Ue),l(F),E(()=>{Te.disabled=!e(oe),$(Fe,`Roll ${e(B)??""}`)}),Ae(m,()=>e(be),$e=>o(be,$e)),Ae(Pe,()=>e(ve),$e=>o(ve,$e)),Ae(He,()=>e(W),$e=>o(W,$e)),Ae(G,()=>e(q),$e=>o(q,$e)),Ae(we,()=>e(re),$e=>o(re,$e)),Ae(Oe,()=>e(de),$e=>o(de,$e)),A("click",Te,We),A("click",me,h),v(u,F)};C(Ee,u=>{I()||u(te)})}l(Ke);var xe=s(Ke,2);let Ge;var Je=r(xe);{var D=u=>{var F=Gl(),U=qe(F),P=r(U),m=r(P,!0);l(P);var ne=s(P,2);{var Pe=Te=>{var Fe=Pl();v(Te,Fe)};C(ne,Te=>{e(S)&&Te(Pe)})}l(U);var ge=s(U,2),He=r(ge,!0);l(ge);var p=s(ge,2),G=r(p);{var k=Te=>{var Fe=Tl(),me=r(Fe,!0);l(Fe),E(()=>$(me,(e(M),i(()=>e(M).resultString)))),v(Te,Fe)};C(G,Te=>{e(M),i(()=>e(M).resultString)&&Te(k)})}var we=s(G,2);{var Ne=Te=>{var Fe=Hl(),me=r(Fe);l(Fe),E(()=>$(me,`Modifier: ${e(M),i(()=>e(M).constant>=0?"+":"")??""}${e(M),i(()=>e(M).constant)??""}`)),v(Te,Fe)};C(we,Te=>{e(M),i(()=>e(M).constant)&&Te(Ne)})}l(p);var Oe=s(p,2);{var Ue=Te=>{var Fe=Bl(),me=r(Fe);vt(me,1,()=>e(Re),ut,(it,lt)=>{var pt=Ul(),Et=r(pt,!0);l(pt),E(()=>$(Et,(e(lt),i(()=>e(lt).label)))),A("click",pt,()=>ke(e(lt).notation,"damage")),v(it,pt)});var $e=s(me,2);{var Mt=it=>{var lt=Nl();E(()=>{lt.disabled=e(L)<=0,tt(lt,"title",e(L)<=0?"No Channel Divinity uses remaining":"Use Channel Divinity to add +10 to this attack roll")}),A("click",lt,Qe),v(it,lt)};C($e,it=>{e(y)&&e(ie)==="attack"&&!e(ee)&&it(Mt)})}l(Fe),v(Te,Fe)};C(Oe,Te=>{e(Re),e(y),e(ie),e(ee),i(()=>e(Re).length>0||e(y)&&e(ie)==="attack"&&!e(ee))&&Te(Ue)})}E(()=>{$(m,T()?`${T()} - Result`:"Result"),$(He,(e(M),i(()=>e(M).resultTotal)))}),v(u,F)};C(Je,u=>{e(M)&&u(D)})}l(xe),l(ue),l(j),E(()=>{Q=ct(j,1,"modal-overlay svelte-1r90jgp",null,Q,{hidden:!le()}),Ge=ct(xe,1,"roll-result svelte-1r90jgp",null,Ge,{"has-result":e(M)})}),A("click",O,Ve),A("click",se,Ze),A("click",ue,La(function(u){Bt.call(this,n,u)})),A("keydown",ue,function(u){Bt.call(this,n,u)}),A("click",j,Ze),A("keydown",j,u=>u.key==="Escape"&&Ze()),v(a,j),fs(n,"getLastRollTotal",_e);var z=kt(H);return g(),z}const oa="https://api.github.com/gists";async function zl(a,n,t){if(!n)throw new Error("GitHub token is required");const c=JSON.stringify(a,null,2),g=`${a.name||"character"}_dnd.json`,y={description:t||`D&D Character: ${a.name}`,public:!1,files:{[g]:{content:c}}},L=await fetch(oa,{method:"POST",headers:{Authorization:`token ${n}`,"Content-Type":"application/json"},body:JSON.stringify(y)});if(!L.ok)throw new Error(`Failed to create gist: ${L.statusText}`);return(await L.json()).id}async function Wl(a,n,t){if(!n||!t)throw new Error("GitHub token and Gist ID are required");const c=JSON.stringify(a,null,2),y={files:{[`${a.name||"character"}_dnd.json`]:{content:c}}},L=await fetch(`${oa}/${t}`,{method:"PATCH",headers:{Authorization:`token ${n}`,"Content-Type":"application/json"},body:JSON.stringify(y)});if(!L.ok)throw new Error(`Failed to update gist: ${L.statusText}`)}async function Kl(a,n){if(!a)throw new Error("Gist ID is required");const t={"Content-Type":"application/json"};n&&(t.Authorization=`token ${n}`);const c=await fetch(`${oa}/${a}`,{method:"GET",headers:t});if(!c.ok)throw new Error(`Failed to load gist: ${c.statusText}`);const g=await c.json(),y=Object.values(g.files);if(y.length===0)throw new Error("No files found in gist");const B=y[0].content;try{const _=JSON.parse(B);return _.attacks&&Array.isArray(_.attacks)&&(_.attacks=_.attacks.map(I=>({...I,id:I.id||crypto.randomUUID()}))),_.classFeatures?(_.classFeatures.features||(_.classFeatures.features={}),_.classFeatures.spellSlots||(_.classFeatures.spellSlots=[]),_.classFeatures.preparedSpells===void 0&&(_.classFeatures.preparedSpells="")):_.classFeatures={features:{},spellSlots:[],preparedSpells:""},_}catch{throw new Error("Invalid character data in gist")}}function Ia(a){typeof window<"u"&&localStorage.setItem("dnd_gist_config",JSON.stringify(a))}function Jl(){if(typeof window<"u"){const a=localStorage.getItem("dnd_gist_config");if(a)return JSON.parse(a)}return{}}async function Vl(a,n=30){if(!a)throw new Error("GitHub token is required to list gists");const t=await fetch(`${oa}?per_page=${n}`,{method:"GET",headers:{Authorization:`token ${a}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error(`Failed to list gists: ${t.statusText}`);return await t.json()}var Ql=f('<div class="error-message svelte-1jb5ckg"> </div>'),Yl=f('<div class="toggle-container svelte-1jb5ckg"><button type="button" class="toggle-btn svelte-1jb5ckg"> </button></div>'),Xl=f('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID (leave empty to create new)</label> <input type="text" id="gistId" placeholder="Optional: existing Gist ID to update" class="svelte-1jb5ckg"/></div>'),Zl=f('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),er=f('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),tr=f('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Update (or leave unselected to create new)</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),ar=f('<div class="info-message svelte-1jb5ckg">No gists found. A new one will be created.</div>'),sr=f('<!> <div class="form-group svelte-1jb5ckg"><label for="description" class="svelte-1jb5ckg"> </label> <input type="text" id="description" placeholder="D&amp;D Character Sheet" class="svelte-1jb5ckg"/></div>',1),lr=f('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID *</label> <input type="text" id="gistId" placeholder="Enter Gist ID (for public or your private gists)" required class="svelte-1jb5ckg"/></div>'),rr=f('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),ir=f('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),nr=f('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Load</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),or=f('<div class="info-message svelte-1jb5ckg">No gists found. Enter a Gist ID manually or create a new one in Save mode.</div>'),cr=f('<div class="modal-overlay svelte-1jb5ckg" role="button" tabindex="-1"><div class="modal-content svelte-1jb5ckg" role="dialog" tabindex="0"><div class="modal-header svelte-1jb5ckg"><h2 class="svelte-1jb5ckg"> </h2> <button class="close-btn svelte-1jb5ckg">Ã—</button></div> <div class="modal-body svelte-1jb5ckg"><!> <div class="form-group svelte-1jb5ckg"><label for="token" class="svelte-1jb5ckg"> <a href="https://github.com/settings/tokens" target="_blank" rel="noopener" class="svelte-1jb5ckg">Get token</a></label> <input type="password" id="token" placeholder="ghp_xxxxxxxxxxxxx" class="svelte-1jb5ckg"/></div> <!> <!> <div class="modal-actions svelte-1jb5ckg"><button class="btn btn-primary svelte-1jb5ckg"><!></button> <button class="btn btn-secondary svelte-1jb5ckg">Cancel</button></div></div></div></div>');function vr(a,n){yt(n,!1);const t=()=>ze(Y,"$character",c),[c,g]=St(),y=Tt();let L=mt(n,"mode",8,"save"),B=R(""),_=R(""),I=R(""),le=R(!1),K=R(""),T=R(!1),pe=R(!1),ae=R([]),fe=R(null);const oe=Jl();oe.token&&o(B,oe.token),oe.gistId&&o(_,oe.gistId),Yt(async()=>{e(B)&&!e(T)&&await ce()});async function ce(){if(e(B)){o(pe,!0),o(K,"");try{o(ae,await Vl(e(B))),e(_)&&o(fe,e(ae).find(H=>H.id===e(_))||null)}catch(H){o(K,H.message||"Failed to load gists"),o(ae,[])}finally{o(pe,!1)}}}function M(H){o(fe,H),o(_,H.id)}function _e(){o(T,!e(T)),o(K,""),!e(T)&&e(B)&&ce()}async function be(){if(!e(B)){o(K,"GitHub token is required");return}const H=e(fe)?.id||e(_);o(le,!0),o(K,"");try{if(H)await Wl(t(),e(B),H),o(_,H),Vt.add("Character updated in Gist successfully!","success");else{const j=await zl(t(),e(B),e(I));o(_,j),Vt.add(`Character saved to Gist! ID: ${j}`,"success")}Ia({token:e(B),gistId:e(_)}),y("close")}catch(j){o(K,j.message||"Failed to save to Gist")}finally{o(le,!1)}}async function ve(){const H=e(fe)?.id||e(_);if(!H){o(K,"Please select a gist or enter a Gist ID");return}o(le,!0),o(K,"");try{const j=await Kl(H,e(B)||void 0);Y.set(j),o(_,H),Ia({token:e(B),gistId:e(_)}),Vt.add("Character loaded from Gist successfully!","success"),y("close")}catch(j){o(K,j.message||"Failed to load from Gist")}finally{o(le,!1)}}function W(){y("close")}_t();var q=cr(),re=r(q),de=r(re),Z=r(de),Re=r(Z,!0);l(Z);var S=s(Z,2);l(de);var ie=s(de,2),ee=r(ie);{var ye=H=>{var j=Ql(),Q=r(j,!0);l(j),E(()=>$(Q,e(K))),v(H,j)};C(ee,H=>{e(K)&&H(ye)})}var b=s(ee,2),d=r(b),w=r(d);Na(),l(d);var J=s(d,2);Le(J),l(b);var V=s(b,2);{var X=H=>{var j=Yl(),Q=r(j),ue=r(Q,!0);l(Q),l(j),E(()=>{Q.disabled=e(le),$(ue,e(T)?"ðŸ“‹ Show My Gists":"âœï¸ Enter Gist ID Manually")}),A("click",Q,_e),v(H,j)};C(V,H=>{(L()==="load"||L()==="save"&&e(B))&&H(X)})}var ke=s(V,2);{var he=H=>{var j=sr(),Q=qe(j);{var ue=Se=>{var Ce=Xl(),Me=s(r(Ce),2);Le(Me),l(Ce),E(()=>Me.disabled=e(le)),Ae(Me,()=>e(_),Ke=>o(_,Ke)),v(Se,Ce)},Be=Se=>{var Ce=nt(),Me=qe(Ce);{var Ke=Ee=>{var te=Zl();v(Ee,te)},Xe=Ee=>{var te=nt(),xe=qe(te);{var Ge=D=>{var z=tr(),u=s(r(z),2);vt(u,5,()=>e(ae),ut,(F,U)=>{var P=er();let m;var ne=r(P),Pe=r(ne),ge=r(Pe,!0);l(Pe);var He=s(Pe,2),p=r(He,!0);l(He),l(ne);var G=s(ne,2),k=r(G),we=r(k);l(k);var Ne=s(k,2),Oe=r(Ne);l(Ne),l(G),l(P),E(Ue=>{m=ct(P,1,"gist-item svelte-1jb5ckg",null,m,{selected:e(fe)?.id===e(U).id}),P.disabled=e(le),$(ge,(e(U),i(()=>e(U).description||"Untitled"))),$(p,(e(U),i(()=>e(U).public?"ðŸŒ Public":"ðŸ”’ Private"))),$(we,`ID: ${e(U),i(()=>e(U).id)??""}`),$(Oe,`Updated: ${Ue??""}`)},[()=>(e(U),i(()=>new Date(e(U).updated_at).toLocaleDateString()))]),A("click",P,()=>M(e(U))),v(F,P)}),l(u),l(z),v(D,z)},Je=D=>{var z=nt(),u=qe(z);{var F=U=>{var P=ar();v(U,P)};C(u,U=>{e(B)&&U(F)},!0)}v(D,z)};C(xe,D=>{e(ae),i(()=>e(ae).length>0)?D(Ge):D(Je,!1)},!0)}v(Ee,te)};C(Me,Ee=>{e(pe)?Ee(Ke):Ee(Xe,!1)},!0)}v(Se,Ce)};C(Q,Se=>{e(T)||!e(B)?Se(ue):Se(Be,!1)})}var je=s(Q,2),O=r(je),se=r(O);l(O);var x=s(O,2);Le(x),l(je),E(()=>{$(se,`Description ${e(_)?"(optional)":""}`),x.disabled=e(le)}),Ae(x,()=>e(I),Se=>o(I,Se)),v(H,j)},We=H=>{var j=nt(),Q=qe(j);{var ue=je=>{var O=lr(),se=s(r(O),2);Le(se),l(O),E(()=>se.disabled=e(le)),Ae(se,()=>e(_),x=>o(_,x)),v(je,O)},Be=je=>{var O=nt(),se=qe(O);{var x=Ce=>{var Me=rr();v(Ce,Me)},Se=Ce=>{var Me=nt(),Ke=qe(Me);{var Xe=te=>{var xe=nr(),Ge=s(r(xe),2);vt(Ge,5,()=>e(ae),ut,(Je,D)=>{var z=ir();let u;var F=r(z),U=r(F),P=r(U,!0);l(U);var m=s(U,2),ne=r(m,!0);l(m),l(F);var Pe=s(F,2),ge=r(Pe),He=r(ge);l(ge);var p=s(ge,2),G=r(p);l(p),l(Pe),l(z),E(k=>{u=ct(z,1,"gist-item svelte-1jb5ckg",null,u,{selected:e(fe)?.id===e(D).id}),z.disabled=e(le),$(P,(e(D),i(()=>e(D).description||"Untitled"))),$(ne,(e(D),i(()=>e(D).public?"ðŸŒ Public":"ðŸ”’ Private"))),$(He,`ID: ${e(D),i(()=>e(D).id)??""}`),$(G,`Updated: ${k??""}`)},[()=>(e(D),i(()=>new Date(e(D).updated_at).toLocaleDateString()))]),A("click",z,()=>M(e(D))),v(Je,z)}),l(Ge),l(xe),v(te,xe)},Ee=te=>{var xe=nt(),Ge=qe(xe);{var Je=D=>{var z=or();v(D,z)};C(Ge,D=>{e(B)&&D(Je)},!0)}v(te,xe)};C(Ke,te=>{e(ae),i(()=>e(ae).length>0)?te(Xe):te(Ee,!1)},!0)}v(Ce,Me)};C(se,Ce=>{e(pe)?Ce(x):Ce(Se,!1)},!0)}v(je,O)};C(Q,je=>{e(T)||!e(B)?je(ue):je(Be,!1)})}v(H,j)};C(ke,H=>{L()==="save"?H(he):H(We,!1)})}var De=s(ke,2),h=r(De),Ie=r(h);{var Ve=H=>{var j=bt();E(()=>$(j,L()==="save"?"Saving...":"Loading...")),v(H,j)},Qe=H=>{var j=bt();E(()=>$(j,L()==="save"?"Save":"Load")),v(H,j)};C(Ie,H=>{e(le)?H(Ve):H(Qe,!1)})}l(h);var Ze=s(h,2);l(De),l(ie),l(re),l(q),E(()=>{$(Re,L()==="save"?"Save to GitHub Gist":"Load from GitHub Gist"),$(w,`GitHub Token ${L()==="load"?"(optional for public gists)":"(required)"} `),J.disabled=e(le),h.disabled=e(le),Ze.disabled=e(le)}),A("click",S,W),Ae(J,()=>e(B),H=>o(B,H)),A("blur",J,()=>{e(B)&&!e(T)&&ce()}),A("click",h,function(...H){(L()==="save"?be:ve)?.apply(this,H)}),A("click",Ze,W),A("click",re,La(function(H){Bt.call(this,n,H)})),A("keydown",re,function(H){Bt.call(this,n,H)}),A("click",q,W),A("keydown",q,H=>H.key==="Escape"&&W()),v(a,q),kt(),g()}var dr=f('<div class="loading svelte-1ngjemu">Loading D&D data...</div>'),ur=f("<option> </option>"),pr=f('<select class="level-filter svelte-1ngjemu"><option>All Levels</option><option>Cantrip</option><!></select>'),fr=f('<div class="no-results svelte-1ngjemu"> </div>'),br=f('<div class="item-meta svelte-1ngjemu"> </div>'),hr=f('<div class="item-meta svelte-1ngjemu"> </div>'),gr=f('<button><div class="item-name svelte-1ngjemu"> </div> <!></button>'),mr=f('<p class="higher-levels"><strong>At Higher Levels:</strong> </p>'),_r=f('<p class="cantrip-upgrade"><strong>Cantrip Upgrade:</strong> </p>'),yr=f('<h3 class="svelte-1ngjemu"> </h3> <p class="spell-meta svelte-1ngjemu"><!> <!></p> <p class="spell-classes"><strong>Classes:</strong> </p> <div class="spell-stats svelte-1ngjemu"><div><strong>Casting Time:</strong> </div> <div><strong>Range:</strong> </div> <div><strong>Components:</strong> <!></div> <div><strong>Duration:</strong> <!> </div></div> <p class="description svelte-1ngjemu"> </p> <!> <!>',1),kr=f('<p class="prerequisite svelte-1ngjemu"><strong>Prerequisite:</strong> </p>'),xr=f('<h3 class="svelte-1ngjemu"> </h3> <!> <p class="description svelte-1ngjemu"> </p> <a target="_blank" rel="noopener" class="source-link svelte-1ngjemu">View Full Details â†’</a>',1),$r=f('<div class="item-details svelte-1ngjemu"><!></div>'),Sr=f('<div class="controls svelte-1ngjemu"><div class="tabs svelte-1ngjemu"><button> </button> <button> </button></div> <div class="search-controls svelte-1ngjemu"><input type="text" placeholder="Search by name or description..." class="search-input svelte-1ngjemu"/> <!></div></div> <div class="content-container svelte-1ngjemu"><div class="items-list svelte-1ngjemu"><!></div> <!></div>',1),Cr=f('<div class="modal-backdrop svelte-1ngjemu" role="presentation"><div class="modal svelte-1ngjemu" role="dialog" aria-modal="true" tabindex="-1"><div class="modal-header svelte-1ngjemu"><h2 class="svelte-1ngjemu">Browse D&D Spells & Feats</h2> <button class="close-btn svelte-1ngjemu" aria-label="Close">&times;</button></div> <div class="modal-body svelte-1ngjemu"><!></div> <div class="modal-footer svelte-1ngjemu"><button class="btn-secondary svelte-1ngjemu">Cancel</button> <button class="btn-primary svelte-1ngjemu">Add to Character Sheet</button></div></div></div>');function Lr(a,n){yt(n,!1);const t=R(),c=R(),g=R();let y=mt(n,"onClose",8),L=R("spell"),B=R(!0),_=R(""),I=R(null),le=R([]),K=R([]),T=R(null);Yt(async()=>{o(B,!0);try{o(le,await qa()),o(K,await Ts())}catch(S){console.error("Failed to load data:",S)}finally{o(B,!1)}});function pe(S){o(T,S)}function ae(S){const ie=S.match(/(\d+d\d+(?:\s*\+\s*\d+)?)/i);return ie?ie[1]:""}function fe(S){const ie=S.split(/\.( |$)/)[0].trim(),ee=Array.from(S.matchAll(/\*\*(.*?)\*\*/g)).map(b=>b[1].replace(/\.$/,""));let ye=ie;return ee.length&&(ye+=" | Effects: "+ee.join(", ")),ye}function oe(){if(e(T)){if(e(L)==="spell"){const S=e(T);Y.update(ie=>{const ye=[];S.range&&ye.push(`Range: ${S.range}`),S.castingTime&&ye.push(`Cast: ${S.castingTime}`),S.duration&&ye.push(`Duration: ${S.duration}`),S.actionType==="Save"&&ye.push("Saving throw spell"),S.components&&S.components.length>0&&ye.push(`Components: ${S.components.join(", ")}`),S.material&&ye.push(`Material: ${S.material}`);const b=ye.join(" | "),d=fe(S.description),w={id:crypto.randomUUID(),name:`${S.name}${S.concentration?" (C)":""}${S.ritual?" (R)":""}`,bonus:S.actionType==="Attack"?5:0,damage:ae(S.description),damageType:`${S.school} (Lvl ${S.level})`,spellRef:S.name,infoNotes:b,generalNotes:d,castAtLevel:S.level};return ie.attacks=[...ie.attacks,w],ie})}else if(e(L)==="feat"){const S=e(T);Y.update(ie=>{const ee=`${S.name}${S.prerequisite?` (Req: ${S.prerequisite})`:""}
${S.description}
`;return ie.features=ie.features?`${ie.features}
${ee}`:ee,ie})}o(T,null),y()()}}et(()=>(e(I),e(le),e(_)),()=>{o(t,e(I)!==null?Hs(Aa(e(le),e(_)),e(I)):Aa(e(le),e(_)))}),et(()=>(e(K),e(_)),()=>{o(c,Us(e(K),e(_)))}),et(()=>(e(L),e(t),e(c)),()=>{o(g,e(L)==="spell"?e(t):e(c))}),Ft(),_t();var ce=Cr(),M=r(ce),_e=r(M),be=s(r(_e),2);l(_e);var ve=s(_e,2),W=r(ve);{var q=S=>{var ie=dr();v(S,ie)},re=S=>{var ie=Sr(),ee=qe(ie),ye=r(ee),b=r(ye);let d;var w=r(b);l(b);var J=s(b,2);let V;var X=r(J);l(J),l(ye);var ke=s(ye,2),he=r(ke);Le(he);var We=s(he,2);{var De=Q=>{var ue=pr();E(()=>{e(I),Dt(()=>{})});var Be=r(ue);Be.value=(Be.__value=null)??"";var je=s(Be);je.value=je.__value=0;var O=s(je);vt(O,0,()=>[1,2,3,4,5,6,7,8,9],ut,(se,x)=>{var Se=ur(),Ce=r(Se);l(Se);var Me={};E(()=>{$(Ce,`Level ${x??""}`),Me!==(Me=x)&&(Se.value=(Se.__value=x)??"")}),v(se,Se)}),l(ue),Ga(ue,()=>e(I),se=>o(I,se)),v(Q,ue)};C(We,Q=>{e(L)==="spell"&&Q(De)})}l(ke),l(ee);var h=s(ee,2),Ie=r(h),Ve=r(Ie);{var Qe=Q=>{var ue=fr(),Be=r(ue);l(ue),E(()=>$(Be,`No ${e(L)??""}s found`)),v(Q,ue)},Ze=Q=>{var ue=nt(),Be=qe(ue);vt(Be,1,()=>e(g),ut,(je,O)=>{var se=gr();let x;var Se=r(se),Ce=r(Se,!0);l(Se);var Me=s(Se,2);{var Ke=Ee=>{const te=at(()=>e(O));var xe=br(),Ge=r(xe);l(xe),E(()=>$(Ge,`Level ${N(e(te)),i(()=>e(te).level)??""} â€¢ ${N(e(te)),i(()=>e(te).school)??""}`)),v(Ee,xe)},Xe=Ee=>{const te=at(()=>e(O));var xe=nt(),Ge=qe(xe);{var Je=D=>{var z=hr(),u=r(z,!0);l(z),E(()=>$(u,(N(e(te)),i(()=>e(te).prerequisite)))),v(D,z)};C(Ge,D=>{N(e(te)),i(()=>e(te).prerequisite)&&D(Je)})}v(Ee,xe)};C(Me,Ee=>{e(L)==="spell"?Ee(Ke):Ee(Xe,!1)})}l(se),E(()=>{x=ct(se,1,"item-card svelte-1ngjemu",null,x,{selected:e(T)?.name===e(O).name}),$(Ce,(e(O),i(()=>e(O).name)))}),A("click",se,()=>pe(e(O))),v(je,se)}),v(Q,ue)};C(Ve,Q=>{e(g),i(()=>e(g).length===0)?Q(Qe):Q(Ze,!1)})}l(Ie);var H=s(Ie,2);{var j=Q=>{var ue=$r(),Be=r(ue);{var je=se=>{const x=at(()=>e(T));var Se=yr(),Ce=qe(Se),Me=r(Ce,!0);l(Ce);var Ke=s(Ce,2),Xe=r(Ke);{var Ee=me=>{var $e=bt();E(()=>$($e,`${N(e(x)),i(()=>e(x).school)??""} cantrip`)),v(me,$e)},te=me=>{var $e=bt();E(()=>$($e,`Level ${N(e(x)),i(()=>e(x).level)??""} ${N(e(x)),i(()=>e(x).school)??""}`)),v(me,$e)};C(Xe,me=>{N(e(x)),i(()=>e(x).level===0)?me(Ee):me(te,!1)})}var xe=s(Xe,2);{var Ge=me=>{var $e=bt("(ritual)");v(me,$e)};C(xe,me=>{N(e(x)),i(()=>e(x).ritual)&&me(Ge)})}l(Ke);var Je=s(Ke,2),D=s(r(Je));l(Je);var z=s(Je,2),u=r(z),F=s(r(u));l(u);var U=s(u,2),P=s(r(U));l(U);var m=s(U,2),ne=s(r(m)),Pe=s(ne);{var ge=me=>{var $e=bt();E(()=>$($e,`(${N(e(x)),i(()=>e(x).material)??""})`)),v(me,$e)};C(Pe,me=>{N(e(x)),i(()=>e(x).material)&&me(ge)})}l(m);var He=s(m,2),p=s(r(He),2);{var G=me=>{var $e=bt("Concentration,");v(me,$e)};C(p,me=>{N(e(x)),i(()=>e(x).concentration)&&me(G)})}var k=s(p,1,!0);l(He),l(z);var we=s(z,2),Ne=r(we,!0);l(we);var Oe=s(we,2);{var Ue=me=>{var $e=mr(),Mt=s(r($e));l($e),E(()=>$(Mt,` ${N(e(x)),i(()=>e(x).higherLevelSlot)??""}`)),v(me,$e)};C(Oe,me=>{N(e(x)),i(()=>e(x).higherLevelSlot)&&me(Ue)})}var Te=s(Oe,2);{var Fe=me=>{var $e=_r(),Mt=s(r($e));l($e),E(()=>$(Mt,` ${N(e(x)),i(()=>e(x).cantripUpgrade)??""}`)),v(me,$e)};C(Te,me=>{N(e(x)),i(()=>e(x).cantripUpgrade)&&me(Fe)})}E((me,$e)=>{$(Me,(N(e(x)),i(()=>e(x).name))),$(D,` ${me??""}`),$(F,` ${N(e(x)),i(()=>e(x).castingTime||e(x).actionType)??""}`),$(P,` ${N(e(x)),i(()=>e(x).range)??""}`),$(ne,` ${$e??""}`),$(k,(N(e(x)),i(()=>e(x).duration))),$(Ne,(N(e(x)),i(()=>e(x).description)))},[()=>(N(e(x)),i(()=>e(x).classes.join(", "))),()=>(N(e(x)),i(()=>e(x).components.join(", ").toUpperCase()))]),v(se,Se)},O=se=>{const x=at(()=>e(T));var Se=xr(),Ce=qe(Se),Me=r(Ce,!0);l(Ce);var Ke=s(Ce,2);{var Xe=Ge=>{var Je=kr(),D=s(r(Je));l(Je),E(()=>$(D,` ${N(e(x)),i(()=>e(x).prerequisite)??""}`)),v(Ge,Je)};C(Ke,Ge=>{N(e(x)),i(()=>e(x).prerequisite)&&Ge(Xe)})}var Ee=s(Ke,2),te=r(Ee,!0);l(Ee);var xe=s(Ee,2);E(()=>{$(Me,(N(e(x)),i(()=>e(x).name))),$(te,(N(e(x)),i(()=>e(x).description))),tt(xe,"href",(N(e(x)),i(()=>e(x).source)))}),v(se,Se)};C(Be,se=>{e(L)==="spell"?se(je):se(O,!1)})}l(ue),v(Q,ue)};C(H,Q=>{e(T)&&Q(j)})}l(h),E(()=>{d=ct(b,1,"tab svelte-1ngjemu",null,d,{active:e(L)==="spell"}),$(w,`ðŸ“œ Spells (${e(le),i(()=>e(le).length)??""})`),V=ct(J,1,"tab svelte-1ngjemu",null,V,{active:e(L)==="feat"}),$(X,`â­ Feats (${e(K),i(()=>e(K).length)??""})`)}),A("click",b,()=>{o(L,"spell"),o(T,null),o(_,"")}),A("click",J,()=>{o(L,"feat"),o(T,null),o(_,"")}),Ae(he,()=>e(_),Q=>o(_,Q)),v(S,ie)};C(W,S=>{e(B)?S(q):S(re,!1)})}l(ve);var de=s(ve,2),Z=r(de),Re=s(Z,2);l(de),l(M),l(ce),E(()=>Re.disabled=!e(T)),A("click",be,function(...S){y()?.apply(this,S)}),A("click",Z,function(...S){y()?.apply(this,S)}),A("click",Re,oe),A("click",M,La(function(S){Bt.call(this,n,S)})),A("keydown",M,function(S){Bt.call(this,n,S)}),A("click",ce,function(...S){y()?.apply(this,S)}),A("keydown",ce,S=>S.key==="Escape"&&y()()),v(a,ce),kt()}var Dr=f('<link rel="icon" type="image/png" href="favicon4.png"/> <meta name="viewport" content="width=device-width, initial-scale=1"/>',1),wr=f('<span class="character-name svelte-1uha8ag"> </span>'),jr=f("<span> </span>"),Fr=f('<div class="spell-slots-header svelte-1uha8ag"></div>'),Ar=f('<div class="rest-menu svelte-1uha8ag"><button class="rest-option svelte-1uha8ag">â˜• Short Rest</button> <button class="rest-option svelte-1uha8ag">ðŸ›ï¸ Long Rest</button></div>'),Rr=f('<div class="container svelte-1uha8ag"><header class="svelte-1uha8ag"><div class="header-top svelte-1uha8ag"><div class="header-title svelte-1uha8ag"><div class="title-row svelte-1uha8ag"><h1 class="svelte-1uha8ag">D&D Character Sheet</h1> <!></div> <!></div> <div class="header-right svelte-1uha8ag"><div class="header-controls svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">ðŸŽ²</span><span class="btn-text svelte-1uha8ag">Roll Dice</span></button> <div class="rest-button-container svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">ðŸ˜´</span><span class="btn-text svelte-1uha8ag">Rest</span></button> <!></div> <div class="mode-toggle"><button><span class="btn-icon svelte-1uha8ag"> </span><span class="btn-text svelte-1uha8ag"> </span></button></div></div> <div class="header-search svelte-1uha8ag"><input type="text" placeholder="ðŸ” Search..." class="search-input use-enabled svelte-1uha8ag"/></div></div></div> <div class="header-actions svelte-1uha8ag"><button class="btn btn-mode svelte-1uha8ag">ðŸ“š Browse Spells & Feats</button> <button class="btn btn-secondary">Save to Gist</button> <button class="btn btn-secondary">Load from Gist</button> <button class="btn btn-secondary">Export JSON</button> <button class="btn btn-secondary">Import JSON</button> <input type="file" accept=".json" style="display: none;"/></div></header> <main class="svelte-1uha8ag"><!> <!> <!> <!> <!> <!> <!></main></div> <!> <!> <!> <!>',1);function Br(a,n){yt(n,!1);const t=()=>ze(Y,"$character",y),c=()=>ze(Jt,"$isEditMode",y),g=()=>ze(It,"$searchFilter",y),[y,L]=St();function B(){const p=[],G=t().classFeatures.spellSlotsByLevel||{};for(let k=1;k<=9;k++){const we=G[k];if(we&&we.length>0){const Ne=we.length,Oe=we.filter(Ue=>Ue).length;p.push({level:k,available:Ne-Oe,total:Ne})}}return p}let _=R(!1),I=R(!1),le=R(!1),K=R("save"),T=R(void 0),pe=R(""),ae=R(""),fe=R(""),oe=R(!1),ce=R(),M=!1,_e=R(!1);function be(){const p=[];Y.update(k=>{const we=k.hitDice.current;k.hitDice.current=Math.min(k.hitDice.max,k.hitDice.current+Math.max(1,Math.floor(k.hitDice.max/2)));const Ne=k.hitDice.current-we;if(Ne>0&&p.push(`${Ne} hit ${Ne===1?"die":"dice"}`),k.class){const Oe=Gt(k.class,k.level,k.subclass);k.classFeatures.features||(k.classFeatures.features={}),Oe.forEach(Ue=>{if(Ue.resetOn==="short"){const Te=Ue.name.replace(/\s+/g,"");if(Ue.type==="uses"){const Fe=typeof Ue.maxUses=="function"?Ue.maxUses(k.level):Ue.maxUses;k.classFeatures.features[Te]=Array(Fe).fill(!1),p.push(Ue.name)}else if(Ue.type==="pool"){const Fe=typeof Ue.maxPool=="function"?Ue.maxPool(k.level):Ue.maxPool;Fe!==void 0&&(k.classFeatures.features[Te]=Fe,p.push(Ue.name))}}})}return k}),o(_e,!1);const G=p.length>0?`Short rest taken! Restored: ${p.join(", ")}`:"Short rest taken!";Vt.add(G,"success")}function ve(){const p=[];Y.update(k=>{const we=k.maxHP-k.currentHP;we>0&&p.push(`${we} HP`),k.currentHP=k.maxHP,k.tempHP=0;const Ne=k.hitDice.max-k.hitDice.current;Ne>0&&p.push(`${Ne} hit ${Ne===1?"die":"dice"}`),k.hitDice.current=k.hitDice.max;let Oe=0;if(k.classFeatures.spellSlotsByLevel&&Object.keys(k.classFeatures.spellSlotsByLevel).forEach(Ue=>{const Te=k.classFeatures.spellSlotsByLevel[parseInt(Ue)];if(Te){const Fe=Te.filter(me=>me).length;Oe+=Fe,k.classFeatures.spellSlotsByLevel[parseInt(Ue)]=Array(Te.length).fill(!1)}}),Oe>0&&p.push(`${Oe} spell ${Oe===1?"slot":"slots"}`),k.class){const Ue=Gt(k.class,k.level,k.subclass);k.classFeatures.features||(k.classFeatures.features={});let Te=!1;Ue.forEach(Fe=>{const me=Fe.name.replace(/\s+/g,"");if(!(Fe.type==="info"||Fe.type==="channelDivinity")){if(Fe.type==="uses"){const $e=typeof Fe.maxUses=="function"?Fe.maxUses(k.level):Fe.maxUses;k.classFeatures.features[me]=Array($e).fill(!1),Te=!0}else if(Fe.type==="pool"){const $e=typeof Fe.maxPool=="function"?Fe.maxPool(k.level):Fe.maxPool;$e!==void 0&&(k.classFeatures.features[me]=$e,Te=!0)}}}),Te&&p.push("all class features")}return k}),o(_e,!1);const G=p.length>0?`Long rest taken! Restored: ${p.join(", ")}`:"Long rest taken! Fully rested.";Vt.add(G,"success")}function W(p){o(pe,""),o(ae,""),o(fe,""),o(oe,!1),M=!1,typeof p=="string"?o(pe,p):(o(pe,p.notation),o(ae,p.damageNotation||""),o(fe,p.attackName||""),o(oe,!!p.applyHalfDamage)),o(_,!0)}function q(p){const{notation:G}=p.detail;o(pe,""),M=!0,setTimeout(()=>{o(pe,G),o(ae,""),o(fe,"Hit Die")},0),o(_,!0)}function re(){if(o(_,!1),M&&e(ce)){const p=e(ce).getLastRollTotal();if(p!==null){const G=Math.max(1,p);Y.update(k=>(k.hitDice.current=Math.max(0,k.hitDice.current-1),k.currentHP=Math.min(k.maxHP,k.currentHP+G),k))}M=!1}}function de(){console.log("toggleMode called, current isEditMode:",c()),Jt.update(p=>(console.log("Updating isEditMode from",p,"to",!p),!p))}function Z(p){p.target.closest(".rest-button-container")||o(_e,!1)}Yt(()=>{console.log("onMount - initial isEditMode:",c()),console.log("onMount - body classes:",document.body.className);const p=Jt.subscribe(G=>{console.log("isEditMode subscription triggered, value:",G),console.log("Body classes before:",document.body.className),G?(document.body.classList.remove("use-mode"),console.log("Removed use-mode class (Edit Mode)")):(document.body.classList.add("use-mode"),console.log("Added use-mode class (Use Mode)")),console.log("Body classes after:",document.body.className)});return document.addEventListener("click",Z),()=>{p(),document.removeEventListener("click",Z)}});function Re(){is(t())}function S(){e(T)?.click()}async function ie(p){const k=p.target.files?.[0];if(k)try{const we=await ns(k);Y.set(we),alert("Character imported successfully!")}catch{alert("Failed to import character file")}}_t();var ee=Rr();ls("1uha8ag",p=>{var G=Dr();Na(2),Pa(()=>{ss.title="D&D Character Sheet"}),v(p,G)});var ye=qe(ee),b=r(ye),d=r(b),w=r(d),J=r(w),V=s(r(J),2);{var X=p=>{var G=wr(),k=r(G,!0);l(G),E(()=>$(k,t().name)),v(p,G)};C(V,p=>{t().name&&p(X)})}l(J);var ke=s(J,2);{var he=p=>{var G=Fr();vt(G,5,B,ut,(k,we)=>{var Ne=jr();let Oe;var Ue=r(Ne);l(Ne),E(()=>{Oe=ct(Ne,1,"slot-badge svelte-1uha8ag",null,Oe,{depleted:e(we).available===0}),$(Ue,`Lv${e(we).level??""}: ${e(we).available??""}/${e(we).total??""}`)}),v(k,Ne)}),l(G),v(p,G)};C(ke,p=>{B().length>0&&p(he)})}l(w);var We=s(w,2),De=r(We),h=r(De),Ie=s(h,2),Ve=r(Ie),Qe=s(Ve,2);{var Ze=p=>{var G=Ar(),k=r(G),we=s(k,2);l(G),A("click",k,be),A("click",we,ve),v(p,G)};C(Qe,p=>{e(_e)&&p(Ze)})}l(Ie);var H=s(Ie,2),j=r(H);let Q;var ue=r(j),Be=r(ue,!0);l(ue);var je=s(ue),O=r(je,!0);l(je),l(j),l(H),l(De);var se=s(De,2),x=r(se);Le(x),l(se),l(We),l(d);var Se=s(d,2),Ce=r(Se),Me=s(Ce,2),Ke=s(Me,2),Xe=s(Ke,2),Ee=s(Xe,2),te=s(Ee,2);_a(te,p=>o(T,p),()=>e(T)),l(Se),l(b);var xe=s(b,2),Ge=r(xe);$s(Ge,{});var Je=s(Ge,2);Rs(Je,{$$events:{rollHitDice:q}});var D=s(Je,2);Ds(D,{$$events:{roll:p=>W(p.detail)}});var z=s(D,2);Ps(z,{$$events:{roll:p=>W(p.detail)}});var u=s(z,2);ul(u,{$$events:{roll:p=>W(p.detail)}});var F=s(u,2);jl(F,{});var U=s(F,2);Rl(U,{}),l(xe),l(ye);var P=s(ye,2);_a(ql(P,{get notation(){return e(pe)},get damageNotation(){return e(ae)},get attackName(){return e(fe)},get applyHalfDamage(){return e(oe)},get visible(){return e(_)},$$events:{close:re},$$legacy:!0}),p=>o(ce,p),()=>e(ce));var m=s(P,2);{var ne=p=>{vr(p,{get mode(){return e(K)},$$events:{close:()=>o(I,!1)}})};C(m,p=>{e(I)&&p(ne)})}var Pe=s(m,2);{var ge=p=>{Lr(p,{onClose:()=>o(le,!1)})};C(Pe,p=>{e(le)&&p(ge)})}var He=s(Pe,2);rs(He,{}),E(()=>{Q=ct(j,1,"btn btn-mode svelte-1uha8ag",null,Q,{"use-mode":!c()}),$(Be,c()?"ðŸ“":"ðŸŽ²"),$(O,c()?"Edit Mode":"Use Mode")}),A("click",h,()=>o(_,!0)),A("click",Ve,()=>o(_e,!e(_e))),A("click",j,de),Ae(x,g,p=>os(It,p)),A("click",Ce,()=>o(le,!0)),A("click",Me,()=>{o(K,"save"),o(I,!0)}),A("click",Ke,()=>{o(K,"load"),o(I,!0)}),A("click",Xe,Re),A("click",Ee,S),A("change",te,ie),v(a,ee),kt(),L()}export{Br as component};
