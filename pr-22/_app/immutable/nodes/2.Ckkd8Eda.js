import{d as Ka,g as hs,f as g,e as T,a as v,s as L,c as nt,t as Pt}from"../chunks/BESELRjb.js";import{i as Ht}from"../chunks/JMgyEzd3.js";import{c as ca,o as pa,a as bs,b as _s}from"../chunks/CtPH092J.js";import{F as B,T as Qt,Y as Ea,j as ys,aZ as xs,U as Va,ag as Ss,aD as ks,aK as $s,aE as Cs,a1 as ws,av as ka,a7 as Ga,i as ns,a_ as Ds,a$ as rs,b0 as Aa,K as aa,e as os,b1 as cs,b2 as Ls,b3 as js,b4 as As,q as Ha,b5 as Bs,b6 as Ms,ab as Fs,d as n,r as qa,g as Ts,C as Nt,G as Ut,H as i,I as l,J as s,b7 as Qe,b8 as Zt,s as o,a4 as w,f as e,m as ot,E as Ue,b9 as jt,ao as oa,A as P,ba as ra,bb as ma,bc as Rs}from"../chunks/DyJ43TGI.js";import{t as Is,c as Et,a as se,e as kt,i as wt,u as vs,s as la,b as yt,d as xa,f as sa,g as Ps,j as Kt,h as Es,T as Hs,k as Ns,l as Us}from"../chunks/D6-WMxVZ.js";import{i as k,s as Vt,a as Ze,b as _t,d as fa,e as Os}from"../chunks/CCL4udNy.js";import{p as St,b as ya}from"../chunks/iXw84bXb.js";import{b as ga,r as Gs}from"../chunks/O-Mz9Wri.js";function qs(a,r,t=!1,c=!1,d=!1){var p=a,h="";B(()=>{var $=ys;if(h===(h=r()??"")){Qt&&Ea();return}if($.nodes_start!==null&&(xs($.nodes_start,$.nodes_end),$.nodes_start=$.nodes_end=null),h!==""){if(Qt){Va.data;for(var x=Ea(),y=x;x!==null&&(x.nodeType!==Ss||x.data!=="");)y=x,x=ks(x);if(x===null)throw $s(),Cs;Ka(Va,y),p=ws(x);return}var V=h+"";t?V=`<svg>${V}</svg>`:c&&(V=`<math>${V}</math>`);var U=hs(V);if((t||c)&&(U=ka(U)),Ka(ka(U),U.lastChild),t||c)for(;ka(U);)p.before(ka(U));else p.before(U)}})}function Ws(a,r,t,c,d){Qt&&Ea();var p=r.$$slots?.[t],h=!1;p===!0&&(p=r[t],h=!0),p===void 0?d!==null&&d(a):p(a,h?()=>c:c)}function zs(a,r,t,c){var d=a.__style;if(Qt||d!==r){var p=Is(r);(!Qt||p!==a.getAttribute("style"))&&(p==null?a.removeAttribute("style"):a.style.cssText=p),a.__style=r}return c}function La(a,r,t=!1){if(a.multiple){if(r==null)return;if(!ns(r))return Ds();for(var c of a.options)c.selected=r.includes(ha(c));return}for(c of a.options){var d=ha(c);if(rs(d,r)){c.selected=!0;return}}(!t||r!==void 0)&&(a.selectedIndex=-1)}function Na(a){var r=new MutationObserver(()=>{La(a,a.__value)});r.observe(a,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Ga(()=>{r.disconnect()})}function ja(a,r,t=r){var c=new WeakSet,d=!0;Aa(a,"change",p=>{var h=p?"[selected]":":checked",$;if(a.multiple)$=[].map.call(a.querySelectorAll(h),ha);else{var x=a.querySelector(h)??a.querySelector("option:not([disabled])");$=x&&ha(x)}t($),aa!==null&&c.add(aa)}),os(()=>{var p=r();if(a===document.activeElement){var h=cs??aa;if(c.has(h))return}if(La(a,p,d),d&&p===void 0){var $=a.querySelector(":checked");$!==null&&(p=ha($),t(p))}a.__value=p,d=!1}),Na(a)}function ha(a){return"__value"in a?a.__value:a.value}const Ks=Symbol("is custom element"),Vs=Symbol("is html");function Ce(a){if(Qt){var r=!1,t=()=>{if(!r){if(r=!0,a.hasAttribute("value")){var c=a.value;Ve(a,"value",null),a.value=c}if(a.hasAttribute("checked")){var d=a.checked;Ve(a,"checked",null),a.checked=d}}};a.__on_r=t,Ha(t),Bs()}}function ba(a,r){var t=Wa(a);t.value===(t.value=r??void 0)||a.value===r&&(r!==0||a.nodeName!=="PROGRESS")||(a.value=r??"")}function ds(a,r){var t=Wa(a);t.checked!==(t.checked=r??void 0)&&(a.checked=r)}function Ve(a,r,t,c){var d=Wa(a);Qt&&(d[r]=a.getAttribute(r),r==="src"||r==="srcset"||r==="href"&&a.nodeName==="LINK")||d[r]!==(d[r]=t)&&(r==="loading"&&(a[Ls]=t),t==null?a.removeAttribute(r):typeof t!="string"&&Js(a).includes(r)?a[r]=t:a.setAttribute(r,t))}function Wa(a){return a.__attributes??={[Ks]:a.nodeName.includes("-"),[Vs]:a.namespaceURI===js}}var Ja=new Map;function Js(a){var r=a.getAttribute("is")||a.nodeName,t=Ja.get(r);if(t)return t;Ja.set(r,t=[]);for(var c,d=a,p=Element.prototype;p!==d;){c=Ms(d);for(var h in c)c[h].set&&t.push(h);d=As(d)}return t}function Je(a,r,t=r){var c=new WeakSet;Aa(a,"input",async d=>{var p=d?a.defaultValue:a.value;if(p=Fa(a)?Ta(p):p,t(p),aa!==null&&c.add(aa),await Fs(),p!==(p=r())){var h=a.selectionStart,$=a.selectionEnd,x=a.value.length;if(a.value=p??"",$!==null){var y=a.value.length;h===$&&$===x&&y>x?(a.selectionStart=y,a.selectionEnd=y):(a.selectionStart=h,a.selectionEnd=Math.min($,y))}}}),(Qt&&a.defaultValue!==a.value||n(r)==null&&a.value)&&(t(Fa(a)?Ta(a.value):a.value),aa!==null&&c.add(aa)),qa(()=>{var d=r();if(a===document.activeElement){var p=cs??aa;if(c.has(p))return}Fa(a)&&d===Ta(a.value)||a.type==="date"&&!d&&!a.value||d!==a.value&&(a.value=d??"")})}const Ma=new Set;function Ya(a,r,t,c,d=c){var p=t.getAttribute("type")==="checkbox",h=a;let $=!1;if(r!==null)for(var x of r)h=h[x]??=[];h.push(t),Aa(t,"change",()=>{var y=t.__value;p&&(y=Qa(h,y,t.checked)),d(y)},()=>d(p?[]:null)),qa(()=>{var y=c();if(Qt&&t.defaultChecked!==t.checked){$=!0;return}p?(y=y||[],t.checked=y.includes(t.__value)):t.checked=rs(t.__value,y)}),Ga(()=>{var y=h.indexOf(t);y!==-1&&h.splice(y,1)}),Ma.has(h)||(Ma.add(h),Ha(()=>{h.sort((y,V)=>y.compareDocumentPosition(V)===4?-1:1),Ma.delete(h)})),Ha(()=>{if($){var y;if(p)y=Qa(h,y,t.checked);else{var V=h.find(U=>U.checked);y=V?.__value}d(y)}})}function _a(a,r,t=r){Aa(a,"change",c=>{var d=c?a.defaultChecked:a.checked;t(d)}),(Qt&&a.defaultChecked!==a.checked||n(r)==null)&&t(a.checked),qa(()=>{var c=r();a.checked=!!c})}function Qa(a,r,t){for(var c=new Set,d=0;d<a.length;d+=1)a[d].checked&&c.add(a[d].__value);return t||c.delete(r),Array.from(c)}function Fa(a){var r=a.type;return r==="number"||r==="range"}function Ta(a){return a===""?null:+a}function Ys(a,r,t){var c=Ts(a,r);c&&c.set&&(a[r]=t,Ga(()=>{a[r]=null}))}function za(a){return function(...r){var t=r[0];return t.stopPropagation(),a?.apply(this,r)}}function da(a,r){var t=a.$$events?.[r.type],c=ns(t)?t.slice():t==null?[]:[t];for(var d of c)d.call(this,r)}const Qs="";function us(...a){return ga+Qs+Gs(a[0],a[1])}const Ua={paladin:{name:"Paladin",hitDice:"d10",spellcaster:!0,spellcastingAbility:"charisma",spellSlotsByLevel:{1:0,2:2,3:3,4:3,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Divine Sense",type:"uses",maxUses:(a,r=1)=>1+Math.max(1,r),resetOn:"long",description:"Detect celestials, fiends, and undead within 60 feet",minLevel:1},{name:"Lay on Hands",type:"pool",maxPool:a=>a*5,resetOn:"long",description:"Heal wounds or cure disease",minLevel:1},{name:"Divine Smite",type:"spellSlot",description:"Expend spell slot to deal extra radiant damage",minLevel:2,rollable:!0},{name:"Channel Divinity",type:"pool",maxPool:a=>a>=18?3:a>=6?2:1,resetOn:"short",description:"Sacred Weapon or Turn Undead",minLevel:3}]},fighter:{name:"Fighter",hitDice:"d10",spellcaster:!1,features:[{name:"Second Wind",type:"uses",maxUses:1,resetOn:"short",description:"Regain 1d10 + fighter level HP as bonus action",minLevel:1,rollable:!0,rollFormula:a=>`1d10+${a}`},{name:"Action Surge",type:"uses",maxUses:a=>a>=17?2:1,resetOn:"short",description:"Take one additional action on your turn",minLevel:2},{name:"Indomitable",type:"uses",maxUses:a=>a>=17?3:a>=13?2:1,resetOn:"long",description:"Reroll a failed saving throw",minLevel:9}],subclasses:{champion:{name:"Champion",features:[{name:"Improved Critical",type:"info",description:"Critical hit on 19-20",minLevel:3},{name:"Remarkable Athlete",type:"info",description:"Add half proficiency to STR/DEX/CON checks, increase long jump distance",minLevel:7},{name:"Additional Fighting Style",type:"info",description:"Choose a second fighting style",minLevel:10},{name:"Superior Critical",type:"info",description:"Critical hit on 18-20",minLevel:15},{name:"Survivor",type:"info",description:"Regain 5 + CON mod HP at start of turn if below half HP",minLevel:18}]},battlemaster:{name:"Battle Master",features:[{name:"Combat Superiority",type:"uses",maxUses:a=>a>=15?6:a>=7?5:4,resetOn:"short",description:a=>`Use superiority dice (${a>=18?"d12":a>=10?"d10":"d8"}) for maneuvers`,minLevel:3},{name:"Know Your Enemy",type:"info",description:"Learn capabilities of creatures you observe",minLevel:7},{name:"Improved Combat Superiority",type:"info",description:"Superiority dice become d10",minLevel:10},{name:"Relentless",type:"info",description:"Regain 1 superiority die if you have none at start of turn",minLevel:15}]}}},rogue:{name:"Rogue",hitDice:"d8",spellcaster:!1,features:[{name:"Sneak Attack",type:"info",description:a=>`Deal ${Math.ceil(a/2)}d6 extra damage once per turn with advantage or ally nearby`,minLevel:1,rollable:!0,rollFormula:a=>`${Math.ceil(a/2)}d6`},{name:"Cunning Action",type:"info",description:"Dash, Disengage, or Hide as a bonus action",minLevel:2},{name:"Uncanny Dodge",type:"info",description:"Use reaction to halve damage from an attack",minLevel:5},{name:"Evasion",type:"info",description:"Take no damage on successful Dex save (half on fail)",minLevel:7}]},wizard:{name:"Wizard",hitDice:"d6",spellcaster:!0,spellcastingAbility:"intelligence",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Arcane Recovery",type:"uses",maxUses:1,resetOn:"long",description:a=>`Recover spell slots totaling up to ${Math.ceil(a/2)} levels during short rest`,minLevel:1},{name:"Spell Mastery",type:"info",description:"Cast one 1st-level and one 2nd-level spell at will",minLevel:18}]},cleric:{name:"Cleric",hitDice:"d8",spellcaster:!0,spellcastingAbility:"wisdom",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Channel Divinity",type:"pool",maxPool:a=>a>=18?3:a>=6?2:1,resetOn:"short",description:"Turn Undead or domain-specific ability",minLevel:2},{name:"Destroy Undead",type:"info",description:a=>`Channel Divinity destroys undead of CR ${a>=17?4:a>=14?3:a>=11?2:a>=8?1:.5} or lower`,minLevel:5},{name:"Divine Intervention",type:"uses",maxUses:1,resetOn:"long",description:a=>`${a}% chance to succeed, implore deity for aid`,minLevel:10}],subclasses:{war:{name:"War Domain",features:[{name:"War Priest",type:"uses",maxUses:(a,r=1)=>Math.max(1,r),resetOn:"long",description:"Make one weapon attack as a bonus action",minLevel:1},{name:"Guided Strike",type:"channelDivinity",description:"Use your Channel Divinity to gain +10 to an attack roll. Make this choice after you see the roll, but before the DM says whether the attack hits or misses.",minLevel:2,resetOn:"short"},{name:"War God's Blessing",type:"channelDivinity",description:"Use reaction to grant +10 to an ally's attack roll within 30 feet. Consumes one use of Channel Divinity.",minLevel:6,resetOn:"short"},{name:"Divine Strike",type:"info",description:a=>`Deal extra ${a>=14?"2d8":"1d8"} weapon damage once per turn`,minLevel:8,rollable:!0,rollFormula:a=>a>=14?"2d8":"1d8"},{name:"Avatar of Battle",type:"info",description:"Gain resistance to nonmagical weapon damage",minLevel:17}]},life:{name:"Life Domain",features:[{name:"Disciple of Life",type:"info",description:"Healing spells restore additional 2 + spell level HP",minLevel:1},{name:"Preserve Life",type:"pool",maxPool:a=>a*5,resetOn:"short",description:"Restore HP to creatures within 30 feet",minLevel:2},{name:"Blessed Healer",type:"info",description:"Regain 2 + spell level HP when you cast healing spell",minLevel:6},{name:"Divine Strike",type:"info",description:a=>`Deal extra ${a>=14?"2d8":"1d8"} radiant damage once per turn`,minLevel:8,rollable:!0,rollFormula:a=>a>=14?"2d8":"1d8"},{name:"Supreme Healing",type:"info",description:"Maximize healing dice instead of rolling",minLevel:17}]}}},barbarian:{name:"Barbarian",hitDice:"d12",spellcaster:!1,features:[{name:"Rage",type:"uses",maxUses:a=>a>=20?1/0:a>=17?6:a>=12?5:a>=6?4:a>=3?3:2,resetOn:"long",description:a=>`+${a>=16?4:a>=9?3:2} damage, resistance to physical damage`,minLevel:1},{name:"Reckless Attack",type:"info",description:"Gain advantage on melee attacks, enemies get advantage on you",minLevel:2},{name:"Danger Sense",type:"info",description:"Advantage on Dex saves against effects you can see",minLevel:2}],subclasses:{berserker:{name:"Path of the Berserker",features:[{name:"Frenzy",type:"info",description:"While raging, make melee attack as bonus action (gain 1 exhaustion after rage)",minLevel:3},{name:"Mindless Rage",type:"info",description:"Cannot be charmed or frightened while raging",minLevel:6},{name:"Intimidating Presence",type:"info",description:"Use action to frighten creature within 30 feet",minLevel:10},{name:"Retaliation",type:"info",description:"When damaged by creature within 5 feet, make melee attack as reaction",minLevel:14}]}}}};function Wt(a){const r=a.toLowerCase();return Ua[r]||null}function ua(a,r,t){const c=Wt(a);if(!c)return[];const d=c.features.filter(p=>!p.minLevel||p.minLevel<=r);if(t&&c.subclasses&&c.subclasses[t]){const p=c.subclasses[t].features.filter(h=>!h.minLevel||h.minLevel<=r);return[...d,...p]}return d}function Xa(a){const r=Wt(a);return!r||!r.subclasses?[]:Object.keys(r.subclasses).map(t=>({id:t,name:r.subclasses[t].name}))}function Za(a,r){const t=Wt(a);return!t||!t.spellcaster||!t.spellSlotsByLevel?0:t.spellSlotsByLevel[r]||0}function es(a,r,t){const c=Wt(a);return!c||!c.spellcaster?0:Math.max(1,t+r)}function Xs(a,r,t){const c=Wt(a);return!c||!c.spellcaster?null:8+r+t}function Zs(){return Object.keys(Ua).map(a=>({id:a,name:Ua[a].name}))}var el=g('<div class="section-header svelte-ls99y2" role="button" tabindex="0"><h2 class="svelte-ls99y2"> </h2> <span class="collapse-btn svelte-ls99y2"> </span></div>');function va(a,r){Nt(r,!1);let t=St(r,"title",8),c=St(r,"collapsed",8),d=St(r,"ariaLabel",8,""),p=St(r,"onToggle",8);Ht();var h=el(),$=i(h),x=i($,!0);l($);var y=s($,2),V=i(y,!0);l(y),l(h),B(()=>{Ve(h,"aria-expanded",!c()),Ve(h,"aria-label",d()),L(x,t()),L(V,c()?"‚ñº":"‚ñ≤")}),T("click",h,function(...U){p()?.apply(this,U)}),T("keydown",h,U=>{(U.key==="Enter"||U.key===" ")&&p()()}),v(a,h),Ut()}var tl=g("<option> </option>"),al=g("<option> </option>"),sl=g('<div class="form-group svelte-172i2fj"><label for="characterSubclass" class="svelte-172i2fj">Subclass</label> <select id="characterSubclass" class="svelte-172i2fj"><option>Select Subclass</option><!></select></div>'),ll=g('<div class="info-grid svelte-172i2fj"><div class="form-group svelte-172i2fj"><label for="characterName" class="svelte-172i2fj">Character Name</label> <input type="text" id="characterName" placeholder="Enter name" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterClass" class="svelte-172i2fj">Class</label> <select id="characterClass" class="svelte-172i2fj"><option>Select Class</option><!></select></div> <!> <div class="form-group svelte-172i2fj"><label for="characterLevel" class="svelte-172i2fj">Level</label> <input type="number" id="characterLevel" min="1" max="20" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterRace" class="svelte-172i2fj">Race</label> <input type="text" id="characterRace" placeholder="e.g., Human" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterBackground" class="svelte-172i2fj">Background</label> <input type="text" id="characterBackground" placeholder="e.g., Soldier" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterAlignment" class="svelte-172i2fj">Alignment</label> <input type="text" id="characterAlignment" placeholder="e.g., Lawful Good" class="svelte-172i2fj"/></div></div>'),il=g('<section class="character-info svelte-172i2fj"><!> <!></section>');function nl(a,r){Nt(r,!1);const t=()=>Ze(se,"$character",d),c=()=>Ze(Et,"$collapsedStates",d),[d,p]=Vt(),h=w(),$=Zs();function x(be){const ge=be.target;se.update(G=>(G.class=ge.value,G.subclass="",G))}function y(be){const ge=be.target;se.update(G=>(G.subclass=ge.value,G))}function V(be){const ge=be.target;se.update(G=>(G.level=parseInt(ge.value)||1,G)),vs()}Qe(()=>(t(),Xa),()=>{o(h,t().class?Xa(t().class):[])}),Zt(),Ht();var U=il(),re=i(U);{let be=ot(()=>(c(),n(()=>c().characterInfo?"Expand":"Collapse")));va(re,{title:"Character Info",get collapsed(){return c(),n(()=>c().characterInfo)},get ariaLabel(){return e(be)},onToggle:()=>Et.update(ge=>({...ge,characterInfo:!ge.characterInfo}))})}var Z=s(re,2);{var ee=be=>{var ge=ll(),G=i(ge),je=s(i(G),2);Ce(je),l(G);var Ke=s(G,2),oe=s(i(Ke),2),Fe=i(oe);Fe.value=Fe.__value="";var Oe=s(Fe);kt(Oe,1,()=>$,wt,(qe,we)=>{var m=tl(),E=i(m,!0);l(m);var Q={};B(()=>{L(E,(e(we),n(()=>e(we).name))),Q!==(Q=(e(we),n(()=>e(we).id)))&&(m.value=(m.__value=(e(we),n(()=>e(we).id)))??"")}),v(qe,m)}),l(oe);var le;Na(oe),l(Ke);var _e=s(Ke,2);{var Pe=qe=>{var we=sl(),m=s(i(we),2),E=i(m);E.value=E.__value="";var Q=s(E);kt(Q,1,()=>e(h),wt,(Y,ye)=>{var Ae=al(),tt=i(Ae,!0);l(Ae);var xe={};B(()=>{L(tt,(e(ye),n(()=>e(ye).name))),xe!==(xe=(e(ye),n(()=>e(ye).id)))&&(Ae.value=(Ae.__value=(e(ye),n(()=>e(ye).id)))??"")}),v(Y,Ae)}),l(m);var ne;Na(m),l(we),B(()=>{ne!==(ne=(t(),n(()=>t().subclass)))&&(m.value=(m.__value=(t(),n(()=>t().subclass)))??"",La(m,(t(),n(()=>t().subclass))))}),T("change",m,y),v(qe,we)};k(_e,qe=>{e(h),n(()=>e(h).length>0)&&qe(Pe)})}var C=s(_e,2),R=s(i(C),2);Ce(R),l(C);var S=s(C,2),W=s(i(S),2);Ce(W),l(S);var b=s(S,2),j=s(i(b),2);Ce(j),l(b);var ae=s(b,2),Ge=s(i(ae),2);Ce(Ge),l(ae),l(ge),B(()=>{le!==(le=(t(),n(()=>t().class)))&&(oe.value=(oe.__value=(t(),n(()=>t().class)))??"",La(oe,(t(),n(()=>t().class)))),ba(R,(t(),n(()=>t().level)))}),Je(je,()=>t().name,qe=>_t(se,n(t).name=qe,n(t))),T("change",oe,x),T("change",R,V),Je(W,()=>t().race,qe=>_t(se,n(t).race=qe,n(t))),Je(j,()=>t().background,qe=>_t(se,n(t).background=qe,n(t))),Je(Ge,()=>t().alignment,qe=>_t(se,n(t).alignment=qe,n(t))),v(be,ge)};k(Z,be=>{c(),n(()=>!c().characterInfo)&&be(ee)})}l(U),v(a,U),Ut(),p()}var rl=g('<div class="ability-card svelte-bbv1xt"><h3 class="svelte-bbv1xt"> </h3> <input type="number" class="ability-score svelte-bbv1xt" min="1" max="30"/> <div class="ability-modifier svelte-bbv1xt"> </div> <div class="roll-buttons svelte-bbv1xt"><button class="roll-btn svelte-bbv1xt">Check</button> <button class="roll-btn svelte-bbv1xt">Save</button></div> <div class="save-proficiency svelte-bbv1xt"><input type="checkbox" class="svelte-bbv1xt"/> <label class="svelte-bbv1xt">Save Prof.</label></div></div>'),ol=g('<div class="proficiency-bonus svelte-bbv1xt"><label for="profBonus">Proficiency Bonus</label> <input type="number" id="profBonus" class="prof-input svelte-bbv1xt"/></div> <div class="abilities-grid svelte-bbv1xt"></div>',1),cl=g("<section><!> <!></section>");function vl(a,r){Nt(r,!1);const t=()=>Ze(xa,"$abilityModifiers",$),c=()=>Ze(se,"$character",$),d=()=>Ze(la,"$searchFilter",$),p=()=>Ze(Et,"$collapsedStates",$),h=()=>Ze(sa,"$isEditMode",$),[$,x]=Vt(),y=w(),V=w(),U=ca(),re=[{key:"strength",label:"Strength"},{key:"dexterity",label:"Dexterity"},{key:"constitution",label:"Constitution"},{key:"intelligence",label:"Intelligence"},{key:"wisdom",label:"Wisdom"},{key:"charisma",label:"Charisma"}];function Z(){vs()}function ee(Fe){const Oe=t()[Fe],le=`1d20${Oe>=0?"+":""}${Oe}`,_e=[];_e.push({value:"1d20",source:"base die"}),Oe!==0&&_e.push({value:Oe,source:Fe}),U("roll",{notation:le,rollType:"check",bonusBreakdown:_e})}function be(Fe){const Oe=t()[Fe],le=c().saveProficiencies[Fe]?c().proficiencyBonus:0,_e=Oe+le,Pe=`1d20${_e>=0?"+":""}${_e}`,C=[];C.push({value:"1d20",source:"base die"}),Oe!==0&&C.push({value:Oe,source:Fe}),le!==0&&C.push({value:le,source:"proficiency"}),U("roll",{notation:Pe,rollType:"save",bonusBreakdown:C})}Qe(()=>d(),()=>{o(y,re.filter(({label:Fe})=>d()?Fe.toLowerCase().includes(d().toLowerCase()):!0))}),Qe(()=>(e(y),d()),()=>{o(V,e(y).length>0||!d()||d().toLowerCase().includes("proficiency"))}),Zt(),Ht();var ge=cl();let G;var je=i(ge);va(je,{title:"Ability Scores",get collapsed(){return p(),n(()=>p().abilityScores)},ariaLabel:"Toggle Ability Scores Section",onToggle:()=>Et.update(Fe=>({...Fe,abilityScores:!Fe.abilityScores}))});var Ke=s(je,2);{var oe=Fe=>{var Oe=ol(),le=Ue(Oe),_e=s(i(le),2);Ce(_e),l(le);var Pe=s(le,2);kt(Pe,5,()=>e(y),wt,(C,R)=>{let S=()=>e(R).key,W=()=>e(R).label;var b=rl(),j=i(b),ae=i(j,!0);l(j);var Ge=s(j,2);Ce(Ge);var qe=s(Ge,2),we=i(qe);l(qe);var m=s(qe,2),E=i(m),Q=s(E,2);l(m);var ne=s(m,2),Y=i(ne);Ce(Y);var ye=s(Y,2);l(ne),l(b),B(Ae=>{L(ae,Ae),L(we,`${t(),S(),n(()=>t()[S()]>=0?"+":"")??""}${t(),S(),n(()=>t()[S()])??""}`),Y.disabled=!h(),Ve(Y,"id",`${S()}-save`),Ve(ye,"for",`${S()}-save`)},[()=>(W(),n(()=>W().substring(0,3).toUpperCase()))]),Je(Ge,()=>c().abilities[S()],Ae=>_t(se,n(c).abilities[S()]=Ae,n(c))),T("change",Ge,Z),T("click",E,()=>ee(S())),T("click",Q,()=>be(S())),_a(Y,()=>c().saveProficiencies[S()],Ae=>_t(se,n(c).saveProficiencies[S()]=Ae,n(c))),v(C,b)}),l(Pe),Je(_e,()=>c().proficiencyBonus,C=>_t(se,n(c).proficiencyBonus=C,n(c))),v(Fe,Oe)};k(Ke,Fe=>{p(),n(()=>!p().abilityScores)&&Fe(oe)})}l(ge),B(()=>G=yt(ge,1,"ability-scores svelte-bbv1xt",null,G,{hidden:!e(V)})),v(a,ge),Ut(),x()}const ps=[{name:"Unarmored",type:"none",baseAC:10},{name:"Padded",type:"light",baseAC:11},{name:"Leather",type:"light",baseAC:11},{name:"Studded Leather",type:"light",baseAC:12},{name:"Hide",type:"medium",baseAC:12,maxDexBonus:2},{name:"Chain Shirt",type:"medium",baseAC:13,maxDexBonus:2},{name:"Scale Mail",type:"medium",baseAC:14,maxDexBonus:2},{name:"Breastplate",type:"medium",baseAC:14,maxDexBonus:2},{name:"Half Plate",type:"medium",baseAC:15,maxDexBonus:2},{name:"Ring Mail",type:"heavy",baseAC:14,maxDexBonus:0},{name:"Chain Mail",type:"heavy",baseAC:16,maxDexBonus:0},{name:"Splint",type:"heavy",baseAC:17,maxDexBonus:0},{name:"Plate",type:"heavy",baseAC:18,maxDexBonus:0}];function fs(a){return ps.find(r=>r.name===a)}function dl(a,r,t){if(!a)return 10+r+(t?2:0);const c=fs(a);if(!c)return 10+r+(t?2:0);let d=c.baseAC;return c.maxDexBonus===void 0?d+=r:c.maxDexBonus>0&&(d+=Math.min(r,c.maxDexBonus)),t&&(d+=2),d}function Sa(a){return Math.floor((a-10)/2)}function Oa(a,r){if(!a.class)return null;const t=Wt(a.class);if(!t||!t.spellcaster||!t.spellcastingAbility)return null;const c=Sa(r[t.spellcastingAbility]);return 8+a.proficiencyBonus+c}function ts(a,r){if(!a.class)return 0;const t=Wt(a.class);return!t||!t.spellcaster||!t.spellcastingAbility?0:Sa(r[t.spellcastingAbility])}function ul(a,r){const t=[],c=Sa(r.dexterity),d=a.armorName?fs(a.armorName):void 0;if(d){if(d.type==="none")t.push("Unarmored"),t.push("Base: 10"),t.push(`Dexterity: ${c>=0?"+":""}${c}`);else if(d.type==="light")t.push(`${d.name}: ${d.baseAC}`),t.push(`Dexterity: ${c>=0?"+":""}${c}`);else if(d.type==="medium"){const p=Math.min(2,c);t.push(`${d.name}: ${d.baseAC}`),t.push(`Dexterity: ${p>=0?"+":""}${p} (max +2)`)}else d.type==="heavy"&&(t.push(`${d.name}: ${d.baseAC}`),t.push("Dexterity: +0 (heavy armor)"));a.shieldEquipped&&t.push("Shield: +2")}else{t.push("Base: 10"),c!==0&&t.push(`Dexterity: ${c>=0?"+":""}${c}`);const p=10+c,h=a.armorClass-p;h!==0&&t.push(`Other: ${h>=0?"+":""}${h}`)}return a.activeStates&&a.activeStates.length>0&&a.activeStates.forEach(p=>{typeof p.acBonus=="number"&&p.acBonus!==0&&(!p.target||p.target==="self")&&t.push(`${p.name}: ${p.acBonus>=0?"+":""}${p.acBonus}`)}),t.join(`
`)}function pl(a,r){const t=[],c=Sa(r.dexterity);t.push(`Dexterity: ${c>=0?"+":""}${c}`);const d=a.initiative-c;return d!==0&&t.push(`Other Bonuses: ${d>=0?"+":""}${d}`),t.join(`
`)}function fl(a,r){if(!a.class)return"";const t=Wt(a.class);if(!t||!t.spellcaster||!t.spellcastingAbility)return"";const c=[],d=Sa(r[t.spellcastingAbility]),p=t.spellcastingAbility.charAt(0).toUpperCase()+t.spellcastingAbility.slice(1);return c.push("Base: 8"),c.push(`Proficiency: +${a.proficiencyBonus}`),c.push(`${p}: ${d>=0?"+":""}${d}`),c.join(`
`)}var gl=g('<button class="info-icon svelte-1o8ci7b" type="button">‚ÑπÔ∏è</button>'),ml=g('<button class="info-icon svelte-1o8ci7b" type="button">‚ÑπÔ∏è</button>'),hl=g("<div><!></div>"),bl=g('<div class="tooltip-wrapper svelte-1o8ci7b"><!> <!></div>');function Ra(a,r){Nt(r,!1);let t=St(r,"tooltipContent",8),c=St(r,"ariaLabel",8,"Show information"),d=w(!1),p=w(),h=w(!1),$=w(null),x=w(!1),y=w(!1),V=w("");const U=Math.random().toString(36).slice(2);function re(){window.dispatchEvent(new CustomEvent("tooltip-open",{detail:U}))}function Z(C){C.detail!==U&&(o(d,!1),o(x,!1))}function ee(){o(h,window.matchMedia("(pointer: coarse)").matches||"ontouchstart"in window)}function be(){if(!e($)||!e(p))return;const C=e(p).getBoundingClientRect(),R=e($).getBoundingClientRect();let S=C.bottom+5,W=C.left;o(x,!1),W+R.width>window.innerWidth-8&&(W=C.right-R.width,o(x,!0),W<8&&(W=8)),W<8&&(W=8),S+R.height>window.innerHeight-8&&(S=C.top-R.height-5),o(V,`position:fixed;top:${S}px;left:${W}px;z-index:1000;`),o(y,!0)}function ge(){re(),o(d,!1),o(y,!1),requestAnimationFrame(()=>{o(d,!0),o(y,!1),setTimeout(be,0)})}function G(){o(d,!1),o(x,!1)}function je(C){C.stopPropagation(),e(d)?(o(d,!1),o(x,!1),o(y,!1)):(re(),o(d,!1),o(y,!1),requestAnimationFrame(()=>{o(d,!0),o(y,!1),setTimeout(be,0)}))}function Ke(C){e(p)&&!e(p).contains(C.target)&&(o(d,!1),o(x,!1))}pa(()=>{ee(),document.addEventListener("click",Ke),window.addEventListener("tooltip-open",Z)}),bs(()=>{document.removeEventListener("click",Ke),window.removeEventListener("tooltip-open",Z)}),Ht();var oe=bl(),Fe=i(oe);{var Oe=C=>{var R=gl();B(()=>Ve(R,"aria-label",c())),T("click",R,je),v(C,R)},le=C=>{var R=ml();B(()=>Ve(R,"aria-label",c())),T("mouseenter",R,ge),T("mouseleave",R,G),v(C,R)};k(Fe,C=>{e(h)?C(Oe):C(le,!1)})}var _e=s(Fe,2);{var Pe=C=>{var R=hl(),S=i(R);Ws(S,r,"content",{},W=>{var b=nt(),j=Ue(b);qs(j,t),v(W,b)}),l(R),ya(R,W=>o($,W),()=>e($)),B(()=>{yt(R,1,`tooltip-popup ${e(x)?"right-align":""}`,"svelte-1o8ci7b"),zs(R,e(y)?e(V)+"opacity:1;pointer-events:auto;":"opacity:0;pointer-events:none;position:fixed;top:0;left:0;z-index:1000;")}),v(C,R)};k(_e,C=>{e(d)&&C(Pe)})}l(oe),ya(oe,C=>o(p,C),()=>e(p)),v(a,oe),Ut()}var _l=g("<option> </option>"),yl=g('<div class="armor-config svelte-1r5hyyb"><h4 class="svelte-1r5hyyb">Armor Configuration</h4> <div class="armor-controls svelte-1r5hyyb"><div class="armor-field svelte-1r5hyyb"><label for="armorName" class="svelte-1r5hyyb">Armor</label> <select id="armorName" class="armor-select svelte-1r5hyyb"><option>None (Unarmored)</option><!></select></div> <div class="armor-field svelte-1r5hyyb"><label class="shield-label svelte-1r5hyyb"><input type="checkbox" class="shield-checkbox svelte-1r5hyyb"/> Shield Equipped (+2 AC)</label></div></div></div>'),xl=g('<div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="spellSaveDC" class="svelte-1r5hyyb">Spell Save DC</label> <!></div> <input type="number" id="spellSaveDC" class="stat-input svelte-1r5hyyb" readonly=""/></div>'),Sl=g('<span class="hit-dice-type"> </span>'),kl=g('<!> <div class="stats-grid svelte-1r5hyyb"><div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="armorClass" class="svelte-1r5hyyb">Armor Class</label> <!></div> <input type="text" id="armorClass" readonly=""/></div> <div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="initiative" class="svelte-1r5hyyb">Initiative</label> <!></div> <input type="text" id="initiative" class="stat-input svelte-1r5hyyb" readonly=""/></div> <div class="stat-box svelte-1r5hyyb"><label for="speed" class="svelte-1r5hyyb">Speed</label> <input type="text" id="speed" class="stat-input svelte-1r5hyyb"/></div> <!></div> <div class="hp-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Points</h3> <div><div class="hp-inputs svelte-1r5hyyb"><input type="number" class="hp-current svelte-1r5hyyb" min="0"/> <span class="hp-separator svelte-1r5hyyb">/</span> <input type="number" class="hp-max svelte-1r5hyyb" min="0"/></div> <div class="hp-controls svelte-1r5hyyb"><button class="hp-btn svelte-1r5hyyb">‚àí</button> <button class="hp-btn svelte-1r5hyyb">+</button> <button class="hp-btn svelte-1r5hyyb">‚àí5</button> <button class="hp-btn svelte-1r5hyyb">+5</button></div></div> <div class="temp-hp svelte-1r5hyyb"><label for="tempHP" class="svelte-1r5hyyb">Temp HP</label> <input type="number" id="tempHP" min="0" class="svelte-1r5hyyb"/></div></div> <div class="hit-dice-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Dice</h3> <div class="hit-dice-display svelte-1r5hyyb"><input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <span>/</span> <input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <!></div> <div class="hit-dice-controls svelte-1r5hyyb"><label for="hitDiceCount" class="svelte-1r5hyyb">Roll</label> <div class="hit-dice-count-controls svelte-1r5hyyb"><button class="hit-dice-btn svelte-1r5hyyb">‚àí</button> <input type="number" id="hitDiceCount" class="hit-dice-count-input svelte-1r5hyyb" min="1"/> <button class="hit-dice-btn svelte-1r5hyyb">+</button></div> <button class="btn btn-primary roll-hit-dice use-enabled svelte-1r5hyyb">üé≤ Roll</button></div></div>',1),$l=g("<section><!> <!></section>");function Cl(a,r){Nt(r,!1);const t=()=>Ze(se,"$character",$),c=()=>Ze(xa,"$abilityModifiers",$),d=()=>Ze(la,"$searchFilter",$),p=()=>Ze(Et,"$collapsedStates",$),h=()=>Ze(sa,"$isEditMode",$),[$,x]=Vt(),y=w(),V=w(),U=w(),re=w(),Z=w(),ee=w(),be=w(),ge=ca();let G=w(1);function je(C){se.update(R=>(R.currentHP=Math.max(0,Math.min(R.maxHP,R.currentHP+C)),R))}function Ke(C){const R=e(G)+C,S=t().hitDice.current;o(G,Math.max(1,Math.min(S,R)))}function oe(C=1){if(t().hitDice.current<=0){alert("No hit dice remaining!");return}if(!t().class){alert("Please select a class first!");return}const R=Wt(t().class);if(!R){alert("Invalid class configuration!");return}const S=Math.min(C,t().hitDice.current),W=R.hitDice,b=c().constitution,j=b*S,ae=j>=0?`+${j}`:`${j}`,Ge=`${S}${W}${ae}`,qe=[];if(qe.push({value:`${S}${W}`,source:"hit dice"}),b!==0)for(let we=0;we<S;we++)qe.push({value:b,source:"constitution"});ge("rollHitDice",{notation:Ge,hitDie:W,count:S,bonusBreakdown:qe})}Qe(()=>(t(),c(),se),()=>{if(t().armorName!==void 0||t().shieldEquipped!==void 0){const C=c().dexterity,R=dl(t().armorName,C,t().shieldEquipped||!1);t().armorClass!==R&&se.update(S=>({...S,armorClass:R}))}}),Qe(()=>(c(),t(),se),()=>{const C=c().dexterity;t().initiative!==C&&se.update(R=>({...R,initiative:C}))}),Qe(()=>t(),()=>{o(y,Oa(t(),t().abilities))}),Qe(()=>t(),()=>{o(V,ul(t(),t().abilities))}),Qe(()=>t(),()=>{o(U,pl(t(),t().abilities))}),Qe(()=>t(),()=>{o(re,fl(t(),t().abilities))}),Qe(()=>(t(),e(G)),()=>{const C=t().hitDice.current;C>0&&e(G)>C&&o(G,C)}),Qe(()=>t(),()=>{o(Z,t().activeStates&&t().activeStates.length>0?t().activeStates.reduce((C,R)=>C+(R.acBonus||0),0):0)}),Qe(()=>t(),()=>{o(ee,t().activeStates&&t().activeStates.length>0?t().activeStates.some(C=>C.name==="Aid"&&C.target==="self"):!1)}),Qe(()=>d(),()=>{o(be,!d()||"armor class".includes(d().toLowerCase())||"initiative".includes(d().toLowerCase())||"speed".includes(d().toLowerCase())||"hit points".includes(d().toLowerCase())||"hp".includes(d().toLowerCase())||"hit dice".includes(d().toLowerCase())||"spell save".includes(d().toLowerCase())||"combat".includes(d().toLowerCase()))}),Zt(),Ht();var Fe=$l();let Oe;var le=i(Fe);{let C=ot(()=>(p(),n(()=>p().combatStats?"Expand":"Collapse")));va(le,{title:"Combat Stats",get collapsed(){return p(),n(()=>p().combatStats)},get ariaLabel(){return e(C)},onToggle:()=>Et.update(R=>({...R,combatStats:!R.combatStats}))})}var _e=s(le,2);{var Pe=C=>{var R=kl(),S=Ue(R);{var W=J=>{var De=yl(),de=s(i(De),2),_=i(de),N=s(i(_),2);B(()=>{t(),jt(()=>{})});var te=i(N);te.value=(te.__value=void 0)??"";var X=s(te);kt(X,1,()=>ps,wt,(z,fe)=>{var Le=nt(),st=Ue(Le);{var K=ct=>{var gt=_l(),bt=i(gt);l(gt);var f={};B(()=>{L(bt,`${e(fe),n(()=>e(fe).name)??""} (AC ${e(fe),n(()=>e(fe).baseAC)??""})`),f!==(f=(e(fe),n(()=>e(fe).name)))&&(gt.value=(gt.__value=(e(fe),n(()=>e(fe).name)))??"")}),v(ct,gt)};k(st,ct=>{e(fe),n(()=>e(fe).name!=="Unarmored")&&ct(K)})}v(z,Le)}),l(N),l(_);var ie=s(_,2),D=i(ie),H=i(D);Ce(H),oa(),l(D),l(ie),l(de),l(De),ja(N,()=>t().armorName,z=>_t(se,n(t).armorName=z,n(t))),_a(H,()=>t().shieldEquipped,z=>_t(se,n(t).shieldEquipped=z,n(t))),v(J,De)};k(S,J=>{h()&&J(W)})}var b=s(S,2),j=i(b),ae=i(j),Ge=s(i(ae),2);Ra(Ge,{get tooltipContent(){return e(V)},ariaLabel:"Show AC breakdown"}),l(ae);var qe=s(ae,2);Ce(qe),l(j);var we=s(j,2),m=i(we),E=s(i(m),2);Ra(E,{get tooltipContent(){return e(U)},ariaLabel:"Show Initiative breakdown"}),l(m);var Q=s(m,2);Ce(Q),l(we);var ne=s(we,2),Y=s(i(ne),2);Ce(Y),l(ne);var ye=s(ne,2);{var Ae=J=>{var De=xl(),de=i(De),_=s(i(de),2);Ra(_,{get tooltipContent(){return e(re)},ariaLabel:"Show Spell Save DC breakdown"}),l(de);var N=s(de,2);Ce(N),l(De),B(()=>ba(N,e(y))),v(J,De)};k(ye,J=>{e(y)!==null&&J(Ae)})}l(b);var tt=s(b,2),xe=s(i(tt),2);let We;var M=i(xe),A=i(M);Ce(A);var ce=s(A,4);Ce(ce),l(M);var ke=s(M,2),q=i(ke),u=s(q,2),ze=s(u,2),me=s(ze,2);l(ke),l(xe);var pe=s(xe,2),I=s(i(pe),2);Ce(I),l(pe),l(tt);var Te=s(tt,2),Re=s(i(Te),2),Xe=i(Re);Ce(Xe);var at=s(Xe,4);Ce(at);var Ie=s(at,2);{var $e=J=>{const De=ot(()=>(P(Wt),t(),n(()=>Wt(t().class))));var de=nt(),_=Ue(de);{var N=te=>{const X=ot(()=>(c(),n(()=>c().constitution)));var ie=Sl(),D=i(ie);l(ie),B(()=>L(D,`(${P(e(De)),n(()=>e(De).hitDice)??""}${(e(X)>=0?`+${e(X)}`:e(X))??""})`)),v(te,ie)};k(_,te=>{e(De)&&te(N)})}v(J,de)};k(Ie,J=>{t(),n(()=>t().class)&&J($e)})}l(Re);var Be=s(Re,2),Ee=s(i(Be),2),He=i(Ee),Ne=s(He,2);Ce(Ne);var ve=s(Ne,2);l(Ee);var he=s(Ee,2);l(Be),l(Te),B(()=>{ba(qe,(e(Z),t(),n(()=>e(Z)!==0?`${t().armorClass} ‚Üí ${t().armorClass+e(Z)}`:`${t().armorClass}`))),yt(qe,1,Ps(e(Z)!==0?"stat-input ac-enhanced":"stat-input"),"svelte-1r5hyyb"),ba(Q,(t(),n(()=>t().initiative))),We=yt(xe,1,"hp-display svelte-1r5hyyb",null,We,{"aid-active":e(ee)}),Ve(A,"max",(t(),n(()=>t().maxHP))),Ve(Xe,"max",(t(),n(()=>t().hitDice.max))),He.disabled=e(G)<=1,Ve(Ne,"max",(t(),n(()=>t().hitDice.current))),ve.disabled=(e(G),t(),n(()=>e(G)>=t().hitDice.current)),he.disabled=(t(),n(()=>t().hitDice.current<=0||!t().class))}),Je(Y,()=>t().speed,J=>_t(se,n(t).speed=J,n(t))),Je(A,()=>t().currentHP,J=>_t(se,n(t).currentHP=J,n(t))),Je(ce,()=>t().maxHP,J=>_t(se,n(t).maxHP=J,n(t))),T("click",q,()=>je(-1)),T("click",u,()=>je(1)),T("click",ze,()=>je(-5)),T("click",me,()=>je(5)),Je(I,()=>t().tempHP,J=>_t(se,n(t).tempHP=J,n(t))),Je(Xe,()=>t().hitDice.current,J=>_t(se,n(t).hitDice.current=J,n(t))),Je(at,()=>t().hitDice.max,J=>_t(se,n(t).hitDice.max=J,n(t))),T("click",He,()=>Ke(-1)),Je(Ne,()=>e(G),J=>o(G,J)),T("input",Ne,J=>{const De=J.target,de=parseInt(De.value);de>t().hitDice.current&&o(G,t().hitDice.current),de<1&&o(G,1)}),T("click",ve,()=>Ke(1)),T("click",he,()=>oe(e(G))),v(C,R)};k(_e,C=>{p(),n(()=>!p().combatStats)&&C(Pe)})}l(Fe),B(()=>Oe=yt(Fe,1,"combat-stats svelte-1r5hyyb",null,Oe,{hidden:!e(be)})),v(a,Fe),Ut(),x()}const $a={acrobatics:"dexterity",animalHandling:"wisdom",arcana:"intelligence",athletics:"strength",deception:"charisma",history:"intelligence",insight:"wisdom",intimidation:"charisma",investigation:"intelligence",medicine:"wisdom",nature:"intelligence",perception:"wisdom",performance:"charisma",persuasion:"charisma",religion:"intelligence",sleightOfHand:"dexterity",stealth:"dexterity",survival:"wisdom"};var wl=g('<div class="skill-row svelte-1f1pl16"><input type="checkbox" class="svelte-1f1pl16"/> <label class="svelte-1f1pl16"> <span class="ability-tag svelte-1f1pl16"> </span></label> <span class="skill-modifier svelte-1f1pl16"> </span> <button class="roll-btn svelte-1f1pl16">Roll</button></div>'),Dl=g('<div class="skills-grid svelte-1f1pl16"></div>'),Ll=g("<section><!> <!></section>");function jl(a,r){Nt(r,!1);const t=()=>Ze(se,"$character",$),c=()=>Ze(xa,"$abilityModifiers",$),d=()=>Ze(la,"$searchFilter",$),p=()=>Ze(Et,"$collapsedStates",$),h=()=>Ze(sa,"$isEditMode",$),[$,x]=Vt(),y=w(),V=w(),U=w(),re=w(),Z=w(),ee=w(),be=ca(),ge=[{key:"acrobatics",label:"Acrobatics"},{key:"animalHandling",label:"Animal Handling"},{key:"arcana",label:"Arcana"},{key:"athletics",label:"Athletics"},{key:"deception",label:"Deception"},{key:"history",label:"History"},{key:"insight",label:"Insight"},{key:"intimidation",label:"Intimidation"},{key:"investigation",label:"Investigation"},{key:"medicine",label:"Medicine"},{key:"nature",label:"Nature"},{key:"perception",label:"Perception"},{key:"performance",label:"Performance"},{key:"persuasion",label:"Persuasion"},{key:"religion",label:"Religion"},{key:"sleightOfHand",label:"Sleight of Hand"},{key:"stealth",label:"Stealth"},{key:"survival",label:"Survival"}];function G(le){const _e=$a[le],Pe=c()[_e],C=t().skillProficiencies[le]?t().proficiencyBonus:0,R=e(y)[le],S=`1d20${R>=0?"+":""}${R}`,W=[];W.push({value:"1d20",source:"base die"}),Pe!==0&&W.push({value:Pe,source:_e}),C!==0&&W.push({value:C,source:"proficiency"}),be("roll",{notation:S,rollType:"check",bonusBreakdown:W})}Qe(()=>{},()=>{o(y,{})}),Qe(()=>t(),()=>{o(V,t().skillProficiencies)}),Qe(()=>t(),()=>{o(U,t().proficiencyBonus)}),Qe(()=>c(),()=>{o(re,c())}),Qe(()=>(e(re),e(V),e(U)),()=>{for(const{key:le}of ge){const _e=$a[le],Pe=e(re)[_e],C=e(V)[le]?e(U):0;ra(y,e(y)[le]=Pe+C)}}),Qe(()=>d(),()=>{o(Z,ge.filter(({label:le})=>d()?le.toLowerCase().includes(d().toLowerCase()):!0))}),Qe(()=>e(Z),()=>{o(ee,e(Z).length>0)}),Zt(),Ht();var je=Ll();let Ke;var oe=i(je);{let le=ot(()=>(p(),n(()=>p().skills?"Expand":"Collapse")));va(oe,{title:"Skills",get collapsed(){return p(),n(()=>p().skills)},get ariaLabel(){return e(le)},onToggle:()=>Et.update(_e=>({..._e,skills:!_e.skills}))})}var Fe=s(oe,2);{var Oe=le=>{var _e=Dl();kt(_e,5,()=>e(Z),wt,(Pe,C)=>{let R=()=>e(C).key,S=()=>e(C).label;var W=wl(),b=i(W);Ce(b);var j=s(b,2),ae=i(j),Ge=s(ae),qe=i(Ge);l(Ge),l(j);var we=s(j,2),m=i(we);l(we);var E=s(we,2);l(W),B(Q=>{ds(b,(e(V),R(),n(()=>e(V)[R()]))),b.disabled=!h(),Ve(b,"id",R()),Ve(j,"for",R()),L(ae,`${S()??""} `),L(qe,`(${Q??""})`),L(m,`${e(y),R(),n(()=>e(y)[R()]>=0?"+":"")??""}${e(y),R(),n(()=>e(y)[R()])??""}`)},[()=>(P($a),R(),n(()=>$a[R()].substring(0,3).toUpperCase()))]),T("change",b,Q=>{console.log("Skill proficiency changed:",R(),Q.target.checked),se.update(ne=>({...ne,skillProficiencies:{...ne.skillProficiencies,[R()]:Q.target.checked}}))}),T("click",E,()=>G(R())),v(Pe,W)}),l(_e),v(le,_e)};k(Fe,le=>{p(),n(()=>!p().skills)&&le(Oe)})}l(je),B(()=>Ke=yt(je,1,"skills svelte-1f1pl16",null,Ke,{hidden:!e(ee)})),v(a,je),Ut(),x()}let Ca=null,wa=null;async function gs(){if(Ca)return Ca;try{return Ca=await(await fetch(us("/data/spells.json"))).json(),Ca||[]}catch(a){return console.error("Failed to load spells:",a),[]}}async function Al(){if(wa)return wa;try{return wa=await(await fetch(us("/data/feats.json"))).json(),wa||[]}catch(a){return console.error("Failed to load feats:",a),[]}}function as(a,r){if(!r.trim())return a;const t=r.toLowerCase();return a.filter(c=>c.name.toLowerCase().includes(t)||c.school.toLowerCase().includes(t)||c.classes.some(d=>d.toLowerCase().includes(t))||c.description.toLowerCase().includes(t))}function Bl(a,r){return r===null?a:a.filter(t=>t.level===r)}function Ml(a,r){if(!r.trim())return a;const t=r.toLowerCase();return a.filter(c=>c.name.toLowerCase().includes(t)||c.description.toLowerCase().includes(t))}function Da(a){const r=a.description,t=/\b(Strength|Dexterity|Constitution|Intelligence|Wisdom|Charisma)\s+saving\s+throw/i,c=r.match(t);if(!c)return null;const d=c[1].toLowerCase(),h=/half\s+(?:as\s+much\s+)?damage\s+on\s+a\s+successful(?:\s+save)?/i.test(r),x=/saving\s+throw\s+or\s+take.*?damage/i.test(r)&&!h;return{ability:d,halfDamageOnSave:h,noDamageOnSave:x}}function Fl(a){const r=a.description;return/(plus|add)\s+your\s+spellcasting\s+(ability\s+)?modifier/i.test(r)}function Ia(a){const r=a.description.toLowerCase();return r.includes("ranged spell attack")||r.includes("melee spell attack")}function ss(a){const r=a.description.toLowerCase();if(["Divine Favor","Bless","Aid","Command"].includes(a.name))return!0;const d=["takes","take","deals","deal","damage equal to","force damage","fire damage","cold damage","lightning damage","thunder damage","acid damage","poison damage","necrotic damage","radiant damage","psychic damage","regain","regains","hit point"].some($=>r.includes($));return["bonus to attack","bonus to damage","bonus to ac","gains a +","gain a +","+1 bonus","+2 bonus","+3 bonus","advantage on","becomes a magic weapon"].some($=>r.includes($))&&!d}function Tl(a){const r=a.description;let t=0,c=0,d=0,p="";const h=r.match(/\+(\d+)\s+bonus\s+to\s+attack\s+rolls\s+and\s+damage\s+rolls/i);if(h){const x=parseInt(h[1]);t=x,c=x,p=`+${x} to attack and damage rolls`}if(a.name==="Bless"&&(p="Add 1d4 to attack rolls and saves",t="1d4"),a.name==="Aid")return p="+5 HP (max and current) for 8 hours",{attackBonus:0,damageBonus:0,acBonus:0,hpBonus:5,description:p,name:a.name};a.name==="Divine Favor"&&(p="Your weapon attacks deal an extra 1d4 radiant damage on a hit.",c="1d4");const $=r.match(/\+(\d+)\s+bonus\s+to\s+AC/i);return $&&(d=parseInt($[1]),p=`+${d} to AC`),a.name==="Haste"&&(p="+2 AC, doubled speed, extra action",d=2),p||t!==0||c!==0||d!==0?{attackBonus:t,damageBonus:c,acBonus:d,description:p||a.description.substring(0,100),name:a.name}:null}function Pa(a){const r=a.description,t=/takes?\s+(\d+d\d+)\s+\w+\s+damage[^.]*\.\s*If\s+the\s+target\s+is\s+missing.*?instead\s+takes?\s+(\d+d\d+)/is,c=r.match(t);return c?{baseDamage:c[1],alternateDamage:c[2]}:null}var Rl=g('<button class="btn btn-secondary">Add Attack</button>'),Il=g('<input type="text" placeholder="Attack name" class="attack-name svelte-14o91c5"/>'),Pl=g('<h4 class="attack-name-display svelte-14o91c5"> </h4>'),El=g('<button class="btn-remove svelte-14o91c5">√ó</button>'),Hl=g('<div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Bonus</label> <input type="number" class="attack-bonus svelte-14o91c5"/></div>'),Nl=g('<div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Damage</label> <input type="text" placeholder="e.g., 2d6+3" class="attack-damage svelte-14o91c5"/></div>'),Ul=g('<div class="spell-info-loading svelte-14o91c5">Loading spell info...</div>'),Ol=g('<li class="svelte-14o91c5"><strong>At Higher Levels:</strong> </li>'),Gl=g('<ul class="svelte-14o91c5"><li class="svelte-14o91c5"><strong>Level:</strong> </li> <li class="svelte-14o91c5"><strong>Casting Time:</strong> </li> <li class="svelte-14o91c5"><strong>Range:</strong> </li> <li class="svelte-14o91c5"><strong>Components:</strong> <!></li> <li class="svelte-14o91c5"><strong>Duration:</strong> <!> </li> <li class="svelte-14o91c5"><strong>Description:</strong> </li> <!></ul>'),ql=g('<span class="scaled-damage svelte-14o91c5" style="margin-left: 8px;"> </span>'),Wl=g('<span class="scaled-damage svelte-14o91c5">(Half damage)</span>'),zl=g('<span class="scaled-damage svelte-14o91c5">(No damage)</span>'),Kl=g('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> <!> <!></label></div>'),Vl=g('<span class="scaled-damage svelte-14o91c5"> </span>'),Jl=g('<span class="scaled-damage svelte-14o91c5"> </span>'),Yl=g('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> Target is missing HP <!></label></div>'),Ql=g("<option> </option>"),Xl=g('<span class="scaled-damage svelte-14o91c5"><!> </span>'),Zl=g('<span class="scaled-damage svelte-14o91c5"> </span>'),ei=g('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> Target is Fiend or Undead <!></label></div>'),ti=g('<div class="spell-level-selector svelte-14o91c5"><label class="svelte-14o91c5">Cast at Level:</label> <select class="spell-level-select use-enabled svelte-14o91c5"></select> <!></div> <!>',1),ai=g('<div class="spell-level-selector svelte-14o91c5"><span style="color: #dc3545; font-weight: bold;">No spell slots available!</span></div>'),si=g('<div class="spell-info svelte-14o91c5"><div class="spell-info-header svelte-14o91c5" role="button" tabindex="0"><h4 class="svelte-14o91c5">Spell Info</h4> <button class="collapse-btn-small svelte-14o91c5"> </button></div> <!></div> <!> <!> <!>',1),li=g('<div class="spell-info-missing svelte-14o91c5">Spell info not found.</div>'),ii=g('<div class="attack-notes svelte-14o91c5"><label class="svelte-14o91c5">Notes</label> <textarea placeholder="e.g., DC 15 Dex save, Range 120 ft, Concentration" class="notes-input svelte-14o91c5" rows="2"></textarea></div>'),ni=g('<button class="btn btn-primary">Roll Attack</button>'),ri=g('<div class="buff-target-selection svelte-14o91c5"><div class="target-options svelte-14o91c5"><label class="target-option svelte-14o91c5"><input type="radio" class="svelte-14o91c5"/> Self</label> <label class="target-option svelte-14o91c5"><input type="radio" class="svelte-14o91c5"/> Other</label></div> <button class="btn btn-info"> </button></div>'),oi=g('<button class="btn btn-info">Cast Spell</button>'),ci=g("<button><!></button>"),vi=g('<button class="btn btn-info">Cast Spell</button>'),di=g('<button class="btn btn-secondary">Roll Damage</button>'),ui=g('<button class="btn btn-primary">Roll Attack</button> <!>',1),pi=g('<div class="attack-card svelte-14o91c5"><div class="attack-header svelte-14o91c5"><!> <!></div> <div class="attack-details svelte-14o91c5"><!> <!> <div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Type</label> <input type="text" placeholder="e.g., slashing" class="attack-type svelte-14o91c5"/></div></div> <!> <!> <div class="attack-actions svelte-14o91c5"><!></div></div>'),fi=g('<p class="no-attacks svelte-14o91c5">No attacks added yet. Click "Add Attack" to create one.</p>'),gi=g('<p class="no-attacks svelte-14o91c5">No attacks match your search.</p>'),mi=g('<button class="btn-remove svelte-14o91c5">√ó</button>'),hi=g('<div class="state-card svelte-14o91c5"><div class="state-header svelte-14o91c5"><input type="text" placeholder="Effect name (e.g., Magic Weapon)" class="state-name svelte-14o91c5"/> <!></div> <div class="state-details svelte-14o91c5"><div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Attack Bonus</label> <input type="number" class="state-bonus svelte-14o91c5"/></div> <div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Damage Bonus</label> <input type="text" class="state-bonus svelte-14o91c5"/></div> <div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Target</label> <select class="state-bonus svelte-14o91c5"><option>Self</option><option>Other</option></select></div></div> <div class="state-description svelte-14o91c5"><label class="svelte-14o91c5">Description</label> <input type="text" placeholder="e.g., +1 to attack and damage rolls (Magic Weapon)" class="state-desc-input svelte-14o91c5"/></div></div>'),bi=g('<div class="states-list svelte-14o91c5"></div>'),_i=g('<p class="no-states svelte-14o91c5">No active effects. Add spell effects that modify your attacks.</p>'),yi=g('<!> <div class="attacks-list svelte-14o91c5"><!> <!></div> <div class="active-states-section svelte-14o91c5"><h3 class="svelte-14o91c5">Active Spell Effects</h3> <p class="section-description svelte-14o91c5">Effects that modify attack and damage rolls (e.g., Magic Weapon, Bless)</p> <button class="btn btn-secondary">Add Effect</button> <!></div>',1),xi=g("<section><!> <!></section>");function Si(a,r){Nt(r,!1);const t=()=>Ze(se,"$character",$),c=()=>Ze(xa,"$abilityModifiers",$),d=()=>Ze(la,"$searchFilter",$),p=()=>Ze(Et,"$collapsedStates",$),h=()=>Ze(sa,"$isEditMode",$),[$,x]=Vt(),y=w(),V=w(),U=[],re=ca();let Z=w({}),ee=w({});function be(m){ra(Z,e(Z)[m]=!e(Z)[m]),o(Z,{...e(Z)})}function ge(m){return m.description.toLowerCase().includes("regain")&&(m.description.toLowerCase().includes("hit point")||m.description.toLowerCase().includes("hp"))}function G(m){return["Shield of Faith","Bless","Aid","Magic Weapon"].includes(m)}function je(){se.update(m=>(m.attacks=[...m.attacks,{id:crypto.randomUUID(),name:"",bonus:0,damage:"",damageType:"",notes:""}],m))}function Ke(m){se.update(E=>(E.attacks=E.attacks.filter(Q=>Q.id!==m),E))}function oe(m){let E=m.damage,Q=!1,ne=!1;if(m.spellRef){const xe=_e(m.spellRef);if(xe&&(ne=Ia(xe),xe.level>0)){const We=m.castAtLevel||xe.level;if(!Pe(We)){Kt.add(`No level ${We} spell slots available!`,"error");return}const A=Da(xe);A&&m.targetSucceededSave&&A.noDamageOnSave?E="0":(Q=A?.halfDamageOnSave&&m.targetSucceededSave||!1,E=C(m,xe))}}else if(t().activeStates&&t().activeStates.length>0){let xe=0,We=[];for(const M of t().activeStates)M.target!=="other"&&(typeof M.damageBonus=="string"?We.push(M.damageBonus):typeof M.damageBonus=="number"&&(xe+=M.damageBonus));if((xe!==0||We.length>0)&&E){const M=E.match(/(\d+d\d+)([+-]\d+)?/);if(M){const[,A,ce]=M,q=(ce?parseInt(ce):0)+xe;let u=`${A}`;q!==0&&(u+=`${q>=0?"+":""}${q}`),We.length>0&&(u+=" + "+We.join(" + ")),E=u}}}const Y=[];let ye=0;if(ne){const xe=ts(t(),c()),We=t().proficiencyBonus||0;Y.push({value:We,source:"proficiency"}),Y.push({value:xe,source:"spellcasting"}),ye=We+xe}else m.bonus!==0&&Y.push({value:m.bonus,source:"base"}),ye=m.bonus;let Ae=[];if(t().activeStates)for(const xe of t().activeStates)xe.target!=="other"&&(typeof xe.attackBonus=="number"&&xe.attackBonus!==0?(Y.push({value:xe.attackBonus,source:xe.name.toLowerCase()}),ye+=xe.attackBonus):typeof xe.attackBonus=="string"&&xe.attackBonus&&(Ae.push(xe.attackBonus),Y.push({value:xe.attackBonus,source:xe.name.toLowerCase()})));let tt=`1d20${ye>=0?"+":""}${ye}`;Ae.length>0&&(tt+="+"+Ae.join("+")),re("roll",{notation:tt,damageNotation:E,attackName:m.name,applyHalfDamage:Q,bonusBreakdown:Y,rollType:"attack"})}function Fe(m){if(!m.damage){Kt.add(`${m.name}: No damage specified`,"error");return}let E=m.damage,Q=!1;const ne=[];if(m.spellRef){const Y=_e(m.spellRef);if(Y&&Y.level>0){const ye=m.castAtLevel||Y.level;if(!Pe(ye)){Kt.add(`No level ${ye} spell slots available!`,"error");return}const tt=Da(Y);tt&&m.targetSucceededSave&&tt.noDamageOnSave?E="0":(Q=tt?.halfDamageOnSave&&m.targetSucceededSave||!1,E=C(m,Y))}}else{const Y=E.match(/(\d+d\d+)([+-]\d+)?/);if(Y){const[,ye,Ae]=Y,tt=Ae?parseInt(Ae):0;if(tt!==0&&ne.push({value:tt,source:"base"}),t().activeStates&&t().activeStates.length>0){let xe=0,We=[];for(const M of t().activeStates)M.target!=="other"&&(typeof M.damageBonus=="string"?We.push(M.damageBonus):typeof M.damageBonus=="number"&&M.damageBonus!==0&&(ne.push({value:M.damageBonus,source:M.name.toLowerCase()}),xe+=M.damageBonus));if(xe!==0||We.length>0){const M=tt+xe;let A=`${ye}`;M!==0&&(A+=`${M>=0?"+":""}${M}`),We.length>0&&(A+=" + "+We.join(" + ")),E=A}}}}re("roll",{notation:E,attackName:m.name,applyHalfDamage:Q,bonusBreakdown:ne})}let Oe=w([]),le=w(!1);pa(async()=>{o(Oe,await gs()),o(le,!0)});function _e(m){return e(Oe).find(E=>E.name===m)}function Pe(m){t().classFeatures.spellSlotsByLevel||_t(se,n(t).classFeatures.spellSlotsByLevel={},n(t)),t().classFeatures.spellSlotsByLevel[m]||_t(se,n(t).classFeatures.spellSlotsByLevel[m]=Array(2).fill(!1),n(t));const Q=t().classFeatures.spellSlotsByLevel[m].findIndex(ne=>!ne);return Q===-1?!1:(se.update(ne=>(ne.classFeatures.spellSlotsByLevel||(ne.classFeatures.spellSlotsByLevel={}),ne.classFeatures.spellSlotsByLevel[m]||(ne.classFeatures.spellSlotsByLevel[m]=Array(2).fill(!1)),ne.classFeatures.spellSlotsByLevel[m][Q]=!0,ne)),!0)}function C(m,E){let Q=m.damage,ne=0,Y=0;const ye=Pa(E);if(ye&&m.targetIsDamaged&&(Q=ye.alternateDamage),Fl(E)&&(Y+=ts(t(),c())),t().activeStates)for(const q of t().activeStates)q.target!=="other"&&typeof q.damageBonus=="number"&&(Y+=q.damageBonus);if(E.higherLevelSlot&&m.castAtLevel){const q=E.level,ze=(m.castAtLevel||q)-q;if(ze>0){const me=E.higherLevelSlot.match(/(\d+)d(\d+)\s+for\s+each.*?level\s+above/i);if(me){const[,pe]=me;ne+=ze*parseInt(pe)}}}if(m.targetIsFiendOrUndead&&E.description.includes("Fiend or an Undead")){const q=E.description.match(/increases by (\d+)d(\d+) if.*?Fiend or.*?Undead/i);if(q){const[,u]=q;ne+=parseInt(u)}}const Ae=Q.match(/(\d+)d(\d+)([+-]\d+)?/);if(!Ae)return Y!==0?Y>=0?`${Y}`:`${Y}`:Q||"0";const[,tt,xe,We]=Ae,M=parseInt(tt)+ne,ce=(We?parseInt(We):0)+Y;let ke=`${M}d${xe}`;return ce!==0&&(ke+=ce>=0?`+${ce}`:`${ce}`),ke}function R(m){const E=[];for(let ne=m.level;ne<=9;ne++){const Y=t().classFeatures.spellSlotsByLevel?.[ne];Y&&Y.length>0&&E.push(ne)}return E}function S(){se.update(m=>(m.activeStates||(m.activeStates=[]),m.activeStates=[...m.activeStates,{name:"",attackBonus:0,damageBonus:0,description:"",target:"self"}],m))}function W(m){se.update(E=>{if(E.activeStates){const Q=E.activeStates[m];Q?.hpBonus&&Q.target!=="other"&&(E.maxHP-=Q.hpBonus,E.currentHP=Math.max(1,Math.min(E.currentHP-Q.hpBonus,E.maxHP))),E.activeStates=E.activeStates.filter((ne,Y)=>Y!==m)}return E})}function b(m,E="self"){const Q=_e(m.spellRef);if(!Q){Kt.add("Spell not found","error");return}const ne=m.castAtLevel||Q.level;if(ne>0&&!Pe(ne)){Kt.add(`No level ${ne} spell slots available!`,"error");return}const Y=Tl(Q);if(!Y){Kt.add(`${Q.name} cast! Check spell description for effects.`,"info");return}let ye=Y.hpBonus||0,Ae=Y.description;Q.name==="Aid"&&ne>Q.level&&(ye=5+(ne-Q.level)*5,Ae=`+${ye} HP (max and current) for 8 hours`);const xe=["Shield of Faith","Bless","Aid","Magic Weapon"].includes(Q.name);se.update(M=>{M.activeStates||(M.activeStates=[]);const A=M.activeStates.find(ce=>ce.name===Q.name);return A&&A.hpBonus&&A.target!=="other"&&(M.maxHP-=A.hpBonus,M.currentHP=Math.max(1,Math.min(M.currentHP-A.hpBonus,M.maxHP))),M.activeStates=M.activeStates.filter(ce=>ce.name!==Q.name),ye>0&&E==="self"&&(M.maxHP+=ye,M.currentHP+=ye),M.activeStates=[...M.activeStates,{name:Q.name,attackBonus:Y.attackBonus,damageBonus:Y.damageBonus,acBonus:Y.acBonus,description:Ae,target:E,hpBonus:ye}],M});const We=E==="self"?" on self":" on other";Kt.add(`${Q.name} cast${xe?We:""}! Effect added to Active Spell Effects.`,"success")}Qe(()=>(t(),e(Z),e(ee)),()=>{if(t()&&t().attacks)for(const m of t().attacks)m.spellRef&&e(Z)[m.id]===void 0&&ra(Z,e(Z)[m.id]=!0),m.spellRef&&e(ee)[m.id]===void 0&&ra(ee,e(ee)[m.id]="self")}),Qe(()=>(t(),d()),()=>{o(y,t().attacks.filter(m=>{if(!d())return!0;const E=d().toLowerCase();return m.name.toLowerCase().includes(E)||m.damageType.toLowerCase().includes(E)}).sort((m,E)=>!m.spellRef&&E.spellRef?-1:m.spellRef&&!E.spellRef?1:0))}),Qe(()=>(d(),e(y)),()=>{o(V,!d()||e(y).length>0||"attack".includes(d().toLowerCase())||"spell".includes(d().toLowerCase()))}),Zt(),Ht();var j=xi();let ae;var Ge=i(j);{let m=ot(()=>(p(),n(()=>p().attacks?"Expand":"Collapse")));va(Ge,{title:"Attacks & Spells",get collapsed(){return p(),n(()=>p().attacks)},get ariaLabel(){return e(m)},onToggle:()=>Et.update(E=>({...E,attacks:!E.attacks}))})}var qe=s(Ge,2);{var we=m=>{var E=yi(),Q=Ue(E);{var ne=q=>{var u=Rl();T("click",u,je),v(q,u)};k(Q,q=>{h()&&q(ne)})}var Y=s(Q,2),ye=i(Y);kt(ye,1,()=>e(y),q=>q.id,(q,u,ze)=>{var me=pi(),pe=i(me),I=i(pe);{var Te=D=>{var H=Il();Ce(H),Je(H,()=>e(u).name,z=>(e(u).name=z,jt(()=>(e(y),t(),d())))),v(D,H)},Re=D=>{var H=Pl(),z=i(H,!0);l(H),B(()=>L(z,(e(u),n(()=>e(u).name||"(Unnamed Attack)")))),v(D,H)};k(I,D=>{h()?D(Te):D(Re,!1)})}var Xe=s(I,2);{var at=D=>{var H=El();T("click",H,()=>Ke(e(u).id)),v(D,H)};k(Xe,D=>{h()&&D(at)})}l(pe);var Ie=s(pe,2),$e=i(Ie);{var Be=D=>{var H=Hl(),z=i(H),fe=s(z,2);Ce(fe),l(H),B(()=>{Ve(z,"for",`attack-bonus-${e(u),n(()=>e(u).id)??""}`),Ve(fe,"id",`attack-bonus-${e(u),n(()=>e(u).id)??""}`)}),Je(fe,()=>e(u).bonus,Le=>(e(u).bonus=Le,jt(()=>(e(y),t(),d())))),v(D,H)};k($e,D=>{e(u),n(()=>e(u).bonus!==0&&e(u).bonus!==void 0)&&D(Be)})}var Ee=s($e,2);{var He=D=>{var H=Nl(),z=i(H),fe=s(z,2);Ce(fe),l(H),B(()=>{Ve(z,"for",`attack-damage-${e(u),n(()=>e(u).id)??""}`),Ve(fe,"id",`attack-damage-${e(u),n(()=>e(u).id)??""}`)}),Je(fe,()=>e(u).damage,Le=>(e(u).damage=Le,jt(()=>(e(y),t(),d())))),v(D,H)};k(Ee,D=>{e(u),n(()=>e(u).damage&&e(u).damage.trim()!=="")&&D(He)})}var Ne=s(Ee,2),ve=i(Ne),he=s(ve,2);Ce(he),l(Ne),l(Ie);var J=s(Ie,2);{var De=D=>{var H=nt(),z=Ue(H);{var fe=st=>{var K=Ul();v(st,K)},Le=st=>{const K=ot(()=>(e(u),n(()=>_e(e(u).spellRef))));var ct=nt(),gt=Ue(ct);{var bt=O=>{const F=ot(()=>(P(Da),P(e(K)),n(()=>Da(e(K))))),Se=ot(()=>(P(Pa),P(e(K)),n(()=>Pa(e(K)))));var ue=si(),et=Ue(ue),Me=i(et),ut=s(i(Me),2),Ye=i(ut,!0);l(ut),l(Me);var rt=s(Me,2);{var lt=dt=>{var xt=Gl(),Dt=i(xt),Ot=s(i(Dt));l(Dt);var Lt=s(Dt,2),Ft=s(i(Lt));l(Lt);var $t=s(Lt,2),Ct=s(i($t));l($t);var Tt=s($t,2),Gt=s(i(Tt)),ft=s(Gt);{var zt=Bt=>{var Mt=Pt();B(()=>L(Mt,`(${P(e(K)),n(()=>e(K).material)??""})`)),v(Bt,Mt)};k(ft,Bt=>{P(e(K)),n(()=>e(K).material)&&Bt(zt)})}l(Tt);var Xt=s(Tt,2),ea=s(i(Xt),2);{var ia=Bt=>{var Mt=Pt("Concentration,");v(Bt,Mt)};k(ea,Bt=>{P(e(K)),n(()=>e(K).concentration)&&Bt(ia)})}var Rt=s(ea,1,!0);l(Xt);var qt=s(Xt,2),It=s(i(qt));l(qt);var Jt=s(qt,2);{var ta=Bt=>{var Mt=Ol(),Yt=s(i(Mt));l(Mt),B(()=>L(Yt,` ${P(e(K)),n(()=>e(K).higherLevelSlot)??""}`)),v(Bt,Mt)};k(Jt,Bt=>{P(e(K)),n(()=>e(K).higherLevelSlot)&&Bt(ta)})}l(xt),B(Bt=>{L(Ot,` ${P(e(K)),n(()=>e(K).level)??""}`),L(Ft,` ${P(e(K)),n(()=>e(K).castingTime||e(K).actionType)??""}`),L(Ct,` ${P(e(K)),n(()=>e(K).range)??""}`),L(Gt,` ${Bt??""}`),L(Rt,(P(e(K)),n(()=>e(K).duration))),L(It,` ${P(e(K)),n(()=>e(K).description)??""}`)},[()=>(P(e(K)),n(()=>e(K).components.join(", ")))]),v(dt,xt)};k(rt,dt=>{e(Z),e(u),n(()=>!e(Z)[e(u).id])&&dt(lt)})}l(et);var it=s(et,2);{var mt=dt=>{var xt=Kl(),Dt=i(xt),Ot=i(Dt);Ce(Ot);var Lt=s(Ot),Ft=s(Lt);{var $t=ft=>{var zt=ql(),Xt=i(zt);l(zt),B(ea=>L(Xt,`(Spell Save DC: ${ea??""})`),[()=>(P(Oa),t(),c(),n(()=>Oa(t(),c())))]),v(ft,zt)};k(Ft,ft=>{t(),n(()=>t().class)&&ft($t)})}var Ct=s(Ft,2);{var Tt=ft=>{var zt=Wl();v(ft,zt)},Gt=ft=>{var zt=nt(),Xt=Ue(zt);{var ea=ia=>{var Rt=zl();v(ia,Rt)};k(Xt,ia=>{e(u),P(e(F)),n(()=>e(u).targetSucceededSave&&e(F).noDamageOnSave)&&ia(ea)},!0)}v(ft,zt)};k(Ct,ft=>{e(u),P(e(F)),n(()=>e(u).targetSucceededSave&&e(F).halfDamageOnSave)?ft(Tt):ft(Gt,!1)})}l(Dt),l(xt),B(ft=>L(Lt,` Target succeeded on ${ft??""} save `),[()=>(P(e(F)),n(()=>e(F).ability.charAt(0).toUpperCase()+e(F).ability.slice(1)))]),_a(Ot,()=>e(u).targetSucceededSave,ft=>(e(u).targetSucceededSave=ft,jt(()=>(e(y),t(),d())))),v(dt,xt)};k(it,dt=>{e(F)&&dt(mt)})}var pt=s(it,2);{var vt=dt=>{var xt=Yl(),Dt=i(xt),Ot=i(Dt);Ce(Ot);var Lt=s(Ot,2);{var Ft=Ct=>{const Tt=ot(()=>(e(u),P(e(K)),n(()=>C(e(u),e(K)))));var Gt=Vl(),ft=i(Gt);l(Gt),B(()=>L(ft,`(${P(e(Se)),n(()=>e(Se).alternateDamage)??""}, total: ${e(Tt)??""})`)),v(Ct,Gt)},$t=Ct=>{var Tt=Jl(),Gt=i(Tt);l(Tt),B(()=>L(Gt,`(${P(e(Se)),n(()=>e(Se).baseDamage)??""})`)),v(Ct,Tt)};k(Lt,Ct=>{e(u),n(()=>e(u).targetIsDamaged)?Ct(Ft):Ct($t,!1)})}l(Dt),l(xt),_a(Ot,()=>e(u).targetIsDamaged,Ct=>(e(u).targetIsDamaged=Ct,jt(()=>(e(y),t(),d())))),v(dt,xt)};k(pt,dt=>{e(Se)&&dt(vt)})}var ht=s(pt,2);{var At=dt=>{const xt=ot(()=>(P(e(K)),n(()=>R(e(K)))));var Dt=nt(),Ot=Ue(Dt);{var Lt=$t=>{var Ct=ti(),Tt=Ue(Ct),Gt=i(Tt),ft=s(Gt,2);B(()=>{e(u),jt(()=>{e(xt)})}),kt(ft,5,()=>e(xt),wt,(Rt,qt)=>{var It=Ql(),Jt=i(It);l(It);var ta={};B(()=>{L(Jt,`Level ${e(qt)??""}`),ta!==(ta=e(qt))&&(It.value=(It.__value=e(qt))??"")}),v(Rt,It)}),l(ft);var zt=s(ft,2);{var Xt=Rt=>{const qt=ot(()=>(e(u),P(e(K)),n(()=>C(e(u),e(K)))));var It=Xl(),Jt=i(It);{var ta=Yt=>{var na=Pt("Healing");v(Yt,na)},Bt=Yt=>{var na=Pt("Damage");v(Yt,na)};k(Jt,Yt=>{P(e(K)),n(()=>ge(e(K)))?Yt(ta):Yt(Bt,!1)})}var Mt=s(Jt);l(It),B(()=>L(Mt,` ${e(qt)??""}`)),v(Rt,It)};k(zt,Rt=>{e(u),P(e(K)),n(()=>e(u).castAtLevel&&e(u).castAtLevel>e(K).level)&&Rt(Xt)})}l(Tt);var ea=s(Tt,2);{var ia=Rt=>{var qt=ei(),It=i(qt),Jt=i(It);Ce(Jt);var ta=s(Jt,2);{var Bt=Mt=>{const Yt=ot(()=>(e(u),P(e(K)),n(()=>C(e(u),e(K)))));var na=Zl(),ms=i(na);l(na),B(()=>L(ms,`(+1d8, total: ${e(Yt)??""})`)),v(Mt,na)};k(ta,Mt=>{e(u),n(()=>e(u).targetIsFiendOrUndead)&&Mt(Bt)})}l(It),l(qt),_a(Jt,()=>e(u).targetIsFiendOrUndead,Mt=>(e(u).targetIsFiendOrUndead=Mt,jt(()=>(e(y),t(),d())))),v(Rt,qt)};k(ea,Rt=>{P(e(K)),n(()=>e(K).description.includes("Fiend or an Undead"))&&Rt(ia)})}B(()=>{Ve(Gt,"for",`castLevel-${e(u),n(()=>e(u).id)??""}`),Ve(ft,"id",`castLevel-${e(u),n(()=>e(u).id)??""}`)}),ja(ft,()=>e(u).castAtLevel,Rt=>(e(u).castAtLevel=Rt,jt(()=>(e(y),t(),d())))),v($t,Ct)},Ft=$t=>{var Ct=ai();v($t,Ct)};k(Ot,$t=>{P(e(xt)),n(()=>e(xt).length>0)?$t(Lt):$t(Ft,!1)})}v(dt,Dt)};k(ht,dt=>{P(e(K)),n(()=>e(K).higherLevelSlot&&e(K).level>0)&&dt(At)})}B(()=>{Ve(ut,"aria-label",(e(Z),e(u),n(()=>e(Z)[e(u).id]?"Expand":"Collapse"))),L(Ye,(e(Z),e(u),n(()=>e(Z)[e(u).id]?"‚ñº":"‚ñ≤")))}),T("click",Me,()=>be(e(u).id)),T("keydown",Me,dt=>dt.key==="Enter"&&be(e(u).id)),v(O,ue)},f=O=>{var F=li();v(O,F)};k(gt,O=>{e(K)?O(bt):O(f,!1)})}v(st,ct)};k(z,st=>{e(Oe),n(()=>e(Oe).length===0)?st(fe):st(Le,!1)})}v(D,H)};k(J,D=>{e(u),n(()=>e(u).spellRef)&&D(De)})}var de=s(J,2);{var _=D=>{var H=ii(),z=i(H),fe=s(z,2);ma(fe),l(H),B(()=>{Ve(z,"for",`attack-notes-${e(u),n(()=>e(u).id)??""}`),Ve(fe,"id",`attack-notes-${e(u),n(()=>e(u).id)??""}`)}),Je(fe,()=>e(u).notes,Le=>(e(u).notes=Le,jt(()=>(e(y),t(),d())))),v(D,H)};k(de,D=>{e(u),n(()=>!e(u).spellRef)&&D(_)})}var N=s(de,2),te=i(N);{var X=D=>{const H=ot(()=>(e(u),n(()=>_e(e(u).spellRef))));var z=nt(),fe=Ue(z);{var Le=st=>{var K=nt(),ct=Ue(K);{var gt=f=>{var O=ni();T("click",O,()=>oe(e(u))),v(f,O)},bt=f=>{var O=nt(),F=Ue(O);{var Se=et=>{var Me=nt(),ut=Ue(Me);{var Ye=lt=>{var it=ri(),mt=i(it),pt=i(mt),vt=i(pt);Ce(vt),vt.value=vt.__value="self",oa(),l(pt);var ht=s(pt,2),At=i(ht);Ce(At),At.value=At.__value="other",oa(),l(ht),l(mt);var dt=s(mt,2),xt=i(dt);l(dt),l(it),B(()=>{Ve(vt,"name",`target-${e(u),n(()=>e(u).id)??""}`),Ve(At,"name",`target-${e(u),n(()=>e(u).id)??""}`),L(xt,`Cast ${P(e(H)),n(()=>e(H).name)??""}`)}),Ya(U,[ze],vt,()=>e(ee)[e(u).id],Dt=>ra(ee,e(ee)[e(u).id]=Dt)),Ya(U,[ze],At,()=>e(ee)[e(u).id],Dt=>ra(ee,e(ee)[e(u).id]=Dt)),T("click",dt,()=>b(e(u),e(ee)[e(u).id])),v(lt,it)},rt=lt=>{var it=oi();T("click",it,()=>b(e(u),"self")),v(lt,it)};k(ut,lt=>{P(e(H)),n(()=>G(e(H).name))?lt(Ye):lt(rt,!1)})}v(et,Me)},ue=et=>{var Me=nt(),ut=Ue(Me);{var Ye=lt=>{var it=ci(),mt=i(it);{var pt=ht=>{var At=Pt("Roll Healing");v(ht,At)},vt=ht=>{var At=Pt("Roll Damage");v(ht,At)};k(mt,ht=>{P(e(H)),n(()=>ge(e(H)))?ht(pt):ht(vt,!1)})}l(it),B(ht=>yt(it,1,`btn ${ht??""}`),[()=>(P(e(H)),n(()=>ge(e(H))?"btn-success":"btn-secondary"))]),T("click",it,()=>Fe(e(u))),v(lt,it)},rt=lt=>{var it=vi();T("click",it,()=>b(e(u),"self")),v(lt,it)};k(ut,lt=>{e(u),n(()=>e(u).damage&&e(u).damage.trim()!=="")?lt(Ye):lt(rt,!1)})}v(et,Me)};k(F,et=>{P(ss),P(e(H)),n(()=>ss(e(H)))?et(Se):et(ue,!1)},!0)}v(f,O)};k(ct,f=>{P(Ia),P(e(H)),n(()=>Ia(e(H)))?f(gt):f(bt,!1)})}v(st,K)};k(fe,st=>{e(H)&&st(Le)})}v(D,z)},ie=D=>{var H=nt(),z=Ue(H);{var fe=Le=>{var st=ui(),K=Ue(st),ct=s(K,2);{var gt=bt=>{var f=di();T("click",f,()=>Fe(e(u))),v(bt,f)};k(ct,bt=>{e(u),n(()=>e(u).damage&&e(u).damage.trim()!=="")&&bt(gt)})}T("click",K,()=>oe(e(u))),v(Le,st)};k(z,Le=>{e(u),n(()=>!e(u).spellRef)&&Le(fe)},!0)}v(D,H)};k(te,D=>{e(u),e(le),n(()=>e(u).spellRef&&e(le))?D(X):D(ie,!1)})}l(N),l(me),B(()=>{Ve(ve,"for",`attack-type-${e(u),n(()=>e(u).id)??""}`),Ve(he,"id",`attack-type-${e(u),n(()=>e(u).id)??""}`)}),Je(he,()=>e(u).damageType,D=>(e(u).damageType=D,jt(()=>(e(y),t(),d())))),v(q,me)});var Ae=s(ye,2);{var tt=q=>{var u=fi();v(q,u)},xe=q=>{var u=nt(),ze=Ue(u);{var me=pe=>{var I=gi();v(pe,I)};k(ze,pe=>{e(y),n(()=>e(y).length===0)&&pe(me)},!0)}v(q,u)};k(Ae,q=>{t(),n(()=>t().attacks.length===0)?q(tt):q(xe,!1)})}l(Y);var We=s(Y,2),M=s(i(We),4),A=s(M,2);{var ce=q=>{var u=bi();kt(u,5,()=>(t(),n(()=>t().activeStates)),wt,(ze,me,pe)=>{var I=hi(),Te=i(I),Re=i(Te);Ce(Re);var Xe=s(Re,2);{var at=ie=>{var D=mi();T("click",D,()=>W(pe)),v(ie,D)};k(Xe,ie=>{h()&&ie(at)})}l(Te);var Ie=s(Te,2),$e=i(Ie),Be=i($e);Ve(Be,"for",`state-attack-bonus-${pe}`);var Ee=s(Be,2);Ce(Ee),Ve(Ee,"id",`state-attack-bonus-${pe}`),l($e);var He=s($e,2),Ne=i(He);Ve(Ne,"for",`state-damage-bonus-${pe}`);var ve=s(Ne,2);Ce(ve),Ve(ve,"id",`state-damage-bonus-${pe}`),l(He);var he=s(He,2),J=i(he);Ve(J,"for",`state-target-${pe}`);var De=s(J,2);B(()=>{e(me),jt(()=>{})}),Ve(De,"id",`state-target-${pe}`);var de=i(De);de.value=de.__value="self";var _=s(de);_.value=_.__value="other",l(De),l(he),l(Ie);var N=s(Ie,2),te=i(N);Ve(te,"for",`state-desc-${pe}`);var X=s(te,2);Ce(X),Ve(X,"id",`state-desc-${pe}`),l(N),l(I),Je(Re,()=>e(me).name,ie=>(e(me).name=ie,jt(()=>t()),fa($,"$character"))),Je(Ee,()=>e(me).attackBonus,ie=>(e(me).attackBonus=ie,jt(()=>t()),fa($,"$character"))),Je(ve,()=>e(me).damageBonus,ie=>(e(me).damageBonus=ie,jt(()=>t()),fa($,"$character"))),ja(De,()=>e(me).target,ie=>(e(me).target=ie,jt(()=>t()),fa($,"$character"))),Je(X,()=>e(me).description,ie=>(e(me).description=ie,jt(()=>t()),fa($,"$character"))),v(ze,I)}),l(u),v(q,u)},ke=q=>{var u=_i();v(q,u)};k(A,q=>{t(),n(()=>t().activeStates&&t().activeStates.length>0)?q(ce):q(ke,!1)})}l(We),T("click",M,S),v(m,E)};k(qe,m=>{p(),n(()=>!p().attacks)&&m(we)})}l(j),B(()=>ae=yt(j,1,"attacks svelte-14o91c5",null,ae,{hidden:!e(V)})),v(a,j),Ut(),x()}var ki=g('<span class="slot-checkbox-x svelte-serp1j">&#8212;</span>'),$i=g('<label><input type="checkbox" class="slot-checkbox-input svelte-serp1j"/> <span><!></span></label>');function ls(a,r){Nt(r,!1);const t=()=>Ze(sa,"$isEditMode",c),[c,d]=Vt();let p=St(r,"checked",8,!1),h=St(r,"disabled",8,!1),$=St(r,"className",8,""),x=St(r,"index",8,void 0),y=St(r,"ariaLabel",8,void 0);const V=ca();function U(G){V("change",{checked:G.currentTarget.checked,index:x()})}Ht();var re=$i(),Z=i(re);Ce(Z);var ee=s(Z,2),be=i(ee);{var ge=G=>{var je=ki();v(G,je)};k(be,G=>{p()&&G(ge)})}l(ee),l(re),B(()=>{yt(re,1,"slot-checkbox-label "+$()+(t()?"":" not-editable"),"svelte-serp1j"),ds(Z,p()),Z.disabled=h()||!t(),Ve(Z,"aria-label",y()),Ve(Z,"tabindex",t()?0:-1),yt(ee,1,`slot-checkbox-custom ${p()?"used":""} ${t()?"":"readonly"}`,"svelte-serp1j")}),T("change",Z,U),v(a,re),Ut(),d()}var Ci=g('<p class="no-features svelte-1kpvv0n">Select a class to see available features</p>'),wi=g('<p class="no-features svelte-1kpvv0n">No class features available at this level</p>'),Di=g('<div class="spell-slots svelte-1kpvv0n"><label class="svelte-1kpvv0n"> </label> <div class="slots-tracker svelte-1kpvv0n"></div></div>'),Li=g('<div class="all-spell-slots"></div>'),ji=g('<div class="feature-box spellcasting svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"> </h3> <div class="spell-stats svelte-1kpvv0n"><div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Spell Save DC</label> <div class="spell-value svelte-1kpvv0n"> </div></div> <div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <div class="spell-value svelte-1kpvv0n"> </div></div></div> <!> <div class="prepared-spells svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <textarea placeholder="List your prepared spells..." class="svelte-1kpvv0n"></textarea></div></div>'),Ai=g('<p class="unlimited svelte-1kpvv0n">Unlimited Uses</p>'),Bi=g('<div class="slots-tracker svelte-1kpvv0n"></div> <div class="uses-actions-row"><button class="btn btn-primary use-enabled"> </button></div> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div>',1),Mi=g('<div class="uses-tracker svelte-1kpvv0n"><!></div>'),Fi=g('<div class="pool-tracker svelte-1kpvv0n"><input type="number" min="0" class="pool-input svelte-1kpvv0n"/> <span> </span> <button class="btn-small svelte-1kpvv0n"> </button></div>'),Ti=g('<p class="no-uses svelte-1kpvv0n">No Channel Divinity uses remaining</p>'),Ri=g('<div class="channel-divinity-option svelte-1kpvv0n"><button class="btn btn-primary use-enabled svelte-1kpvv0n">Use Channel Divinity</button> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div> <!></div>'),Ii=g('<div class="feature-box svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"><!> </h3> <p class="feature-description svelte-1kpvv0n"> </p> <!></div>'),Pi=g('<div class="features-grid svelte-1kpvv0n"><!> <!></div>'),Ei=g("<section><!> <!></section>");function Hi(a,r){Nt(r,!1);const t=()=>Ze(se,"$character",h),c=()=>Ze(xa,"$abilityModifiers",h),d=()=>Ze(la,"$searchFilter",h),p=()=>Ze(Et,"$collapsedStates",h),[h,$]=Vt(),x=w(),y=w(),V=w(),U=w(),re=w(),Z=w(),ee=w();let be=w(0),ge=w(0);function G(b,j){se.update(ae=>(ae.classFeatures.features[b]=j,ae))}function je(){se.update(b=>(b.classFeatures.spellSlotsByLevel||(b.classFeatures.spellSlotsByLevel={}),e(U).forEach(({level:j,slots:ae})=>{b.classFeatures.spellSlotsByLevel[j]||(b.classFeatures.spellSlotsByLevel[j]=Array(ae).fill(!1))}),b))}function Ke(b){if(typeof b.maxUses=="function"){if((b.name==="Divine Sense"||b.name==="War Priest")&&e(x)?.spellcastingAbility){const j=c()[e(x).spellcastingAbility];return b.maxUses(t().level,j)}return b.maxUses(t().level)}return b.maxUses||0}function oe(b,j){se.update(ae=>((!ae.classFeatures.features[b]||!Array.isArray(ae.classFeatures.features[b])||ae.classFeatures.features[b].length!==j)&&(ae.classFeatures.features[b]=Array(j).fill(!1)),ae))}_s(()=>{e(Z)&&t()&&t().classFeatures&&t().classFeatures.features&&e(Z).forEach(b=>{if(b.type==="uses"){const j=b.name.replace(/\s+/g,""),ae=Ke(b),Ge=t().classFeatures.features[j];(!Array.isArray(Ge)||Ge.length!==ae)&&oe(j,ae)}})});function Fe(b){return typeof b.maxPool=="function"?b.maxPool(t().level):b.maxPool||0}function Oe(b){return typeof b.description=="function"?b.description(t().level):b.description}function le(){const b="ChannelDivinity";se.update(j=>{const ae=j.classFeatures.features[b];return typeof ae=="number"&&ae>0&&(j.classFeatures.features[b]=ae-1),j})}function _e(){Et.update(b=>({...b,classFeatures:!b.classFeatures}))}Qe(()=>(t(),Wt),()=>{o(x,t().class?Wt(t().class):null)}),Qe(()=>(t(),ua),()=>{o(y,t().class?ua(t().class,t().level,t().subclass):[])}),Qe(()=>(t(),Za),()=>{o(V,t().class?Za(t().class,t().level):0)}),Qe(()=>(e(x),t()),()=>{o(U,(()=>{if(!e(x)?.spellcaster)return[];const b=t().level,j=[];return b>=1&&j.push({level:1,slots:Math.min(4,2+Math.floor(b/3))}),b>=3&&j.push({level:2,slots:Math.min(3,2+Math.floor((b-3)/4))}),b>=5&&j.push({level:3,slots:Math.min(3,2+Math.floor((b-5)/5))}),b>=7&&j.push({level:4,slots:Math.min(3,1+Math.floor((b-7)/6))}),b>=9&&j.push({level:5,slots:Math.min(2,1+Math.floor((b-9)/8))}),b>=11&&j.push({level:6,slots:1}),b>=13&&j.push({level:7,slots:1}),b>=15&&j.push({level:8,slots:1}),b>=17&&j.push({level:9,slots:1}),j})())}),Qe(()=>(e(x),c(),t(),es),()=>{if(e(x)?.spellcaster&&e(x).spellcastingAbility){const b=c()[e(x).spellcastingAbility];o(be,Xs(t().class,b,t().proficiencyBonus)||0),o(ge,es(t().class,t().level,b))}}),Qe(()=>(t(),e(x),e(U)),()=>{t().class&&e(x)?.spellcaster&&e(U).length>0&&je()}),Qe(()=>t(),()=>{o(re,(()=>{const j=t().classFeatures.features["ChannelDivinity"];return typeof j=="number"?j:0})())}),Qe(()=>(e(y),d()),()=>{o(Z,e(y).filter(b=>{if(!d())return!0;const j=d().toLowerCase();return b.name.toLowerCase().includes(j)||Oe(b).toLowerCase().includes(j)}))}),Qe(()=>(d(),t(),e(Z)),()=>{o(ee,!d()||t().class||"class features".includes(d().toLowerCase())||"spellcasting".includes(d().toLowerCase())||e(Z).length>0)}),Zt(),Ht();var Pe=Ei();let C;var R=i(Pe);{let b=ot(()=>(p(),n(()=>p().classFeatures?"Expand":"Collapse")));va(R,{title:"Class Features",get collapsed(){return p(),n(()=>p().classFeatures)},get ariaLabel(){return e(b)},onToggle:_e})}var S=s(R,2);{var W=b=>{var j=nt(),ae=Ue(j);{var Ge=we=>{var m=Ci();v(we,m)},qe=we=>{var m=nt(),E=Ue(m);{var Q=Y=>{var ye=wi();v(Y,ye)},ne=Y=>{var ye=Pi(),Ae=i(ye);{var tt=We=>{var M=ji(),A=i(M),ce=i(A);l(A);var ke=s(A,2),q=i(ke),u=s(i(q),2),ze=i(u,!0);l(u),l(q);var me=s(q,2),pe=s(i(me),2),I=i(pe,!0);l(pe),l(me),l(ke);var Te=s(ke,2);{var Re=Ie=>{var $e=Li();kt($e,5,()=>e(U),wt,(Be,Ee)=>{let He=()=>e(Ee).level,Ne=()=>e(Ee).slots;const ve=ot(()=>(t(),He(),Ne(),n(()=>t().classFeatures.spellSlotsByLevel?.[He()]||Array(Ne()).fill(!1))));var he=Di(),J=i(he),De=i(J);l(J);var de=s(J,2);kt(de,5,()=>e(ve),wt,(_,N,te)=>{{let X=ot(()=>(P(e(ve)),n(()=>e(ve)[te]||!1)));ls(_,{get checked(){return e(X)},$$events:{change:ie=>{se.update(D=>(D.classFeatures.spellSlotsByLevel||(D.classFeatures.spellSlotsByLevel={}),D.classFeatures.spellSlotsByLevel[He()]||(D.classFeatures.spellSlotsByLevel[He()]=Array(Ne()).fill(!1)),D.classFeatures.spellSlotsByLevel[He()][te]=ie.detail.checked,D))}}})}}),l(de),l(he),B(()=>L(De,`${He()===1?"1st":He()===2?"2nd":He()===3?"3rd":`${He()}th`} Level Spell Slots`)),v(Be,he)}),l($e),v(Ie,$e)};k(Te,Ie=>{e(U),n(()=>e(U).length>0)&&Ie(Re)})}var Xe=s(Te,2),at=s(i(Xe),2);ma(at),l(Xe),l(M),B(Ie=>{L(ce,`Spellcasting (${Ie??""})`),L(ze,e(be)),L(I,e(ge))},[()=>(e(x),n(()=>e(x).spellcastingAbility?.toUpperCase()))]),Je(at,()=>t().classFeatures.preparedSpells,Ie=>_t(se,n(t).classFeatures.preparedSpells=Ie,n(t))),v(We,M)};k(Ae,We=>{e(x),n(()=>e(x)?.spellcaster)&&We(tt)})}var xe=s(Ae,2);kt(xe,1,()=>e(Z),wt,(We,M)=>{const A=ot(()=>(e(M),n(()=>e(M).name.replace(/\s+/g,"")))),ce=ot(()=>(t(),P(e(A)),n(()=>t().classFeatures.features[e(A)]))),ke=ot(()=>typeof e(ce)=="number");var q=Ii(),u=i(q),ze=i(u);{var me=Ie=>{var $e=Pt("Channel Divinity:");v(Ie,$e)};k(ze,Ie=>{e(M),n(()=>e(M).type==="channelDivinity")&&Ie(me)})}var pe=s(ze);l(u);var I=s(u,2),Te=i(I,!0);l(I);var Re=s(I,2);{var Xe=Ie=>{const $e=ot(()=>(e(M),n(()=>Ke(e(M))))),Be=ot(()=>(P(e(ce)),P(e($e)),n(()=>Array.isArray(e(ce))?e(ce):Array(e($e)).fill(!1))));var Ee=Mi(),He=i(Ee);{var Ne=he=>{var J=Ai();v(he,J)},ve=he=>{var J=Bi(),De=Ue(J);kt(De,5,()=>e(Be),wt,(D,H,z)=>{ls(D,{get checked(){return e(H)},index:z,$$events:{change:fe=>{se.update(Le=>(Le.classFeatures.features[e(A)]||(Le.classFeatures.features[e(A)]=Array(e($e)).fill(!1)),Le.classFeatures.features[e(A)][z]=fe.detail.checked,Le))}}})}),l(De);var de=s(De,2),_=i(de),N=i(_);l(_),l(de);var te=s(de,2),X=i(te),ie=i(X);l(X),l(te),B(D=>{_.disabled=D,L(N,`Use ${e(M),n(()=>e(M).name)??""}`),L(ie,`Resets on ${e(M),n(()=>e(M).resetOn==="short"?"Short Rest":"Long Rest")??""}`)},[()=>(P(e(Be)),n(()=>e(Be).filter(D=>!D).length<=0))]),T("click",_,()=>{se.update(D=>{D.classFeatures.features[e(A)]||(D.classFeatures.features[e(A)]=Array(e($e)).fill(!1));const H=D.classFeatures.features[e(A)],z=H.findIndex(fe=>!fe);return z!==-1&&(H[z]=!0),D})}),v(he,J)};k(He,he=>{e($e)===1/0?he(Ne):he(ve,!1)})}l(Ee),v(Ie,Ee)},at=Ie=>{var $e=nt(),Be=Ue($e);{var Ee=Ne=>{const ve=ot(()=>(e(M),n(()=>Fe(e(M)))));var he=Fi(),J=i(he);Ce(J);var De=s(J,2),de=i(De);l(De);var _=s(De,2),N=i(_,!0);l(_),l(he),B(()=>{ba(J,e(ke)&&e(ce)!==void 0?e(ce):e(ve)),Ve(J,"max",e(ve)),L(de,`/ ${e(ve)??""}`),L(N,(e(M),n(()=>e(M).resetOn==="short"?"Short Rest":"Long Rest")))}),T("input",J,te=>{se.update(X=>(X.classFeatures.features[e(A)]=parseInt(te.currentTarget.value)||0,X))}),T("click",_,()=>G(e(A),e(ve))),v(Ne,he)},He=Ne=>{var ve=nt(),he=Ue(ve);{var J=De=>{var de=Ri(),_=i(de),N=s(_,2),te=i(N),X=i(te);l(te),l(N);var ie=s(N,2);{var D=H=>{var z=Ti();v(H,z)};k(ie,H=>{e(re)<=0&&H(D)})}l(de),B(()=>{_.disabled=e(re)<=0,L(X,`Resets on ${e(M),n(()=>e(M).resetOn==="short"?"Short Rest":"Long Rest")??""}`)}),T("click",_,le),v(De,de)};k(he,De=>{e(M),n(()=>e(M).type==="channelDivinity")&&De(J)},!0)}v(Ne,ve)};k(Be,Ne=>{e(M),n(()=>e(M).type==="pool")?Ne(Ee):Ne(He,!1)},!0)}v(Ie,$e)};k(Re,Ie=>{e(M),n(()=>e(M).type==="uses")?Ie(Xe):Ie(at,!1)})}l(q),B(Ie=>{L(pe,` ${e(M),n(()=>e(M).name)??""}`),L(Te,Ie)},[()=>(e(M),n(()=>Oe(e(M))))]),v(We,q)}),l(ye),v(Y,ye)};k(E,Y=>{e(y),n(()=>e(y).length===0)?Y(Q):Y(ne,!1)},!0)}v(we,m)};k(ae,we=>{t(),n(()=>!t().class)?we(Ge):we(qe,!1)})}v(b,j)};k(S,b=>{p(),n(()=>!p().classFeatures)&&b(W)})}l(Pe),B(()=>C=yt(Pe,1,"class-features svelte-1kpvv0n",null,C,{hidden:!e(ee)})),v(a,Pe),Ut(),$()}var Ni=g('<textarea placeholder="Enter features, traits, and special abilities..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Equipment</h3> <textarea placeholder="List your equipment and inventory..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Notes</h3> <textarea placeholder="Additional notes..." class="svelte-wttn0l"></textarea>',1),Ui=g("<section><!> <!></section>");function Oi(a,r){Nt(r,!1);const t=()=>Ze(la,"$searchFilter",p),c=()=>Ze(se,"$character",p),d=()=>Ze(Et,"$collapsedStates",p),[p,h]=Vt(),$=w();function x(){Et.update(ee=>({...ee,notes:!ee.notes}))}Qe(()=>(t(),c()),()=>{o($,!t()||"features".includes(t().toLowerCase())||"traits".includes(t().toLowerCase())||"equipment".includes(t().toLowerCase())||"notes".includes(t().toLowerCase())||c().features.toLowerCase().includes(t().toLowerCase())||c().equipment.toLowerCase().includes(t().toLowerCase())||c().notes.toLowerCase().includes(t().toLowerCase()))}),Zt(),Ht();var y=Ui();let V;var U=i(y);{let ee=ot(()=>(d(),n(()=>d().notes?"Expand":"Collapse")));va(U,{title:"Features & Traits",get collapsed(){return d(),n(()=>d().notes)},get ariaLabel(){return e(ee)},onToggle:x})}var re=s(U,2);{var Z=ee=>{var be=Ni(),ge=Ue(be);ma(ge);var G=s(ge,4);ma(G);var je=s(G,4);ma(je),Je(ge,()=>c().features,Ke=>_t(se,n(c).features=Ke,n(c))),Je(G,()=>c().equipment,Ke=>_t(se,n(c).equipment=Ke,n(c))),Je(je,()=>c().notes,Ke=>_t(se,n(c).notes=Ke,n(c))),v(ee,be)};k(re,ee=>{d(),n(()=>!d().notes)&&ee(Z)})}l(y),B(()=>V=yt(y,1,"notes svelte-wttn0l",null,V,{hidden:!e($)})),v(a,y),Ut(),h()}var Gi=g('<div class="color-picker-section svelte-1r90jgp"><h3 class="svelte-1r90jgp">Dice Colors</h3> <div class="color-inputs svelte-1r90jgp"><div class="color-input-group svelte-1r90jgp"><label for="dice-color" class="svelte-1r90jgp">Dice Color</label> <input type="color" id="dice-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="label-color" class="svelte-1r90jgp">Label Color</label> <input type="color" id="label-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="desk-color" class="svelte-1r90jgp">Background Color</label> <input type="color" id="desk-color" class="svelte-1r90jgp"/></div></div></div>'),qi=g('<div class="loading svelte-1r90jgp"><p class="svelte-1r90jgp">Loading 3D dice...</p></div>'),Wi=g('<div class="custom-dice-selector svelte-1r90jgp"><h3 class="svelte-1r90jgp">Choose Dice to Roll</h3> <div class="dice-inputs svelte-1r90jgp"><div class="dice-input-group svelte-1r90jgp"><label for="d4" class="svelte-1r90jgp">d4</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d4" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d6" class="svelte-1r90jgp">d6</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d6" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d8" class="svelte-1r90jgp">d8</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d8" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d10" class="svelte-1r90jgp">d10</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d10" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d12" class="svelte-1r90jgp">d12</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d12" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d20" class="svelte-1r90jgp">d20</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d20" min="0" max="10"/></div></div> <div class="dice-controls svelte-1r90jgp"><button class="btn btn-primary use-enabled svelte-1r90jgp"> </button> <button class="btn btn-secondary use-enabled svelte-1r90jgp">Reset</button></div></div>'),zi=g('<span class="crit-badge svelte-1r90jgp">CRITICAL HIT!</span>'),Ki=g('<span class="crit-badge crit-fail svelte-1r90jgp">CRITICAL MISS!</span>'),Vi=g('<div class="bonus-item svelte-1r90jgp"><span class="bonus-value svelte-1r90jgp"> </span> <span class="bonus-source svelte-1r90jgp"> </span></div>'),Ji=g('<div class="bonus-breakdown svelte-1r90jgp"></div>'),Yi=g('<p class="modifier-text svelte-1r90jgp"> </p>'),Qi=g('<div class="svelte-1r90jgp"><em class="svelte-1r90jgp">No damage is dealt on a critical miss.</em></div>'),Xi=g('<button class="btn btn-follow-up svelte-1r90jgp"> </button>'),Zi=g('<button class="btn btn-guided-strike svelte-1r90jgp">‚ö° Use Guided Strike (+10)</button>'),en=g('<div class="follow-up-actions svelte-1r90jgp"><!> <!></div>'),tn=g('<div class="result-header svelte-1r90jgp"><h3 class="svelte-1r90jgp"> </h3> <!> <!></div> <div class="result-total svelte-1r90jgp"> </div> <div class="result-details svelte-1r90jgp"><!></div> <!> <!>',1),an=g('<div role="button" tabindex="-1"><div class="modal-content svelte-1r90jgp" role="dialog" tabindex="0"><div class="modal-header svelte-1r90jgp"><h2 class="svelte-1r90jgp">Dice Roller</h2> <div class="header-buttons svelte-1r90jgp"><button class="color-btn svelte-1r90jgp" title="Customize dice colors">üé®</button> <button class="close-btn svelte-1r90jgp">√ó</button></div></div> <!> <!> <div class="dice-main-area svelte-1r90jgp"><div class="dice-container svelte-1r90jgp"></div> <!></div> <div><!></div></div></div>');function sn(a,r){Nt(r,!1);const t=()=>Ze(se,"$character",c),[c,d]=Vt(),p=w(),h=w(),$=w(),x=ca();let y=St(r,"notation",12,""),V=St(r,"visible",8,!1),U=St(r,"damageNotation",12,""),re=St(r,"attackName",12,""),Z=St(r,"applyHalfDamage",8,!1),ee=St(r,"bonusBreakdown",28,()=>[]),be=St(r,"rollType",12,"other"),ge=null,G=w(void 0),je=w(!1),Ke=w(""),oe=w(null);function Fe(){return e(oe)?.resultTotal??null}function Oe(_,N,te){const X=[];if(!_||!_.result)return X;const ie=N.match(/([+-]?\d*d\d+|[+-]?\d+)/g)||[];let D=0;const H=new Set;for(const z of ie){const fe=z.trim();if(!fe)continue;const Le=fe.match(/([+-]?)(\d*)d(\d+)/);if(Le){const st=parseInt(Le[2]||"1"),K=`${st}d${Le[3]}`,ct=te.findIndex((f,O)=>!H.has(O)&&typeof f.value=="string"&&f.value===K),gt=[];for(let f=0;f<st&&D<_.result.length;f++)gt.push(_.result[D++]);const bt=ct>=0?te[ct].source:"base die";ct>=0&&H.add(ct);for(const f of gt)X.push({display:`${f}`,source:bt})}}for(let z=0;z<te.length;z++)if(!H.has(z)&&typeof te[z].value=="number"){const fe=te[z].value;X.push({display:fe>=0?`+${fe}`:`${fe}`,source:te[z].source})}return X}let le=w(0),_e=w(0),Pe=w(0),C=w(0),R=w(0),S=w(0),W=w(0),b=w([]),j=w(!1),ae=w(!1),Ge=w(!1),qe=w("#051e0a"),we=w("#ffffff"),m=w("#3a2004"),E=w(!1);function Q(_){return _.length===9&&_.startsWith("#")?_.substring(0,7):_}function ne(_,N="ff"){return _.length===7&&_.startsWith("#")?_+N:_}function Y(){if(window.DICE&&e(G))try{ge&&e(G)&&ra(G,e(G).innerHTML="");const _=e(G).clientWidth||500,N=e(G).clientHeight||300;ge=new window.DICE.dice_box(e(G),{w:_,h:N}),o(je,!0)}catch(_){console.error("Error initializing dice box:",_)}}pa(()=>{const _=X=>new Promise((ie,D)=>{if(document.querySelector(`script[src="${X}"]`)){ie(null);return}const z=document.createElement("script");z.src=X,z.onload=()=>{ie(null)},z.onerror=()=>{console.error(`Failed to load: ${X}`),D(new Error(`Failed to load ${X}`))},document.head.appendChild(z)});setTimeout(()=>{_(`${ga}/libs/three.min.js`).then(()=>_(`${ga}/libs/cannon.min.js`)).then(()=>_(`${ga}/libs/teal.js`)).then(()=>_(`${ga}/dice.js`)).then(()=>{if(window.DICE){const X=window.DICE.getColors();o(qe,Q(X.dice_color)),o(we,Q(X.label_color)),o(m,Q(X.desk_color))}Y()}).catch(X=>{console.error("Failed to load dice libraries:",X)})},100);const N=()=>{e(je)&&Y()},te=X=>{V()&&X.key==="Escape"&&ke()};return window.addEventListener("resize",N),window.addEventListener("keydown",te),()=>{window.removeEventListener("resize",N),window.removeEventListener("keydown",te)}});function ye(_,N="other"){if(!ge||!e(je))return;o(oe,null),o(b,[]),o(j,!1),o(ae,!1),N==="damage"&&ee([]),be(N),o(Ge,!1),ge.diceToRoll=_;const te=ie=>null,X=ie=>{let D=ie.resultTotal,H=ie.resultString;if(Z()&&(D=Math.floor(D/2),H=H+" (halved)"),o(oe,{...ie,resultTotal:D,resultString:H}),console.log("Final roll result:",e(oe)),console.log({type:N}),N==="attack"&&ie.result&&ie.result.length>0){const z=ie.result[0];o(j,z===20),o(ae,z===1)}if(o(b,[]),console.log("Setting up follow-up actions. Type:",N,"damageNotation:",U(),"isCriticalSuccess:",e(j),"isCriticalFail:",e(ae)),N==="attack"&&U())if(e(j)){const z=xe(U());e(b).push({label:`Roll Critical Damage (${z})`,notation:z})}else e(ae)||e(b).push({label:`Roll Damage (${U()})`,notation:U()})};ge.start_throw(te,X)}function Ae(){const _=[];e(le)>0&&_.push(`${e(le)}d4`),e(_e)>0&&_.push(`${e(_e)}d6`),e(Pe)>0&&_.push(`${e(Pe)}d8`),e(C)>0&&_.push(`${e(C)}d10`),e(R)>0&&_.push(`${e(R)}d12`),e(S)>0&&_.push(`${e(S)}d20`);let N=_.join("+")||"1d20";return e(W)!==0&&(N+=e(W)>=0?`+${e(W)}`:`${e(W)}`),N}function tt(){const _=Ae();ye(_)}function xe(_){return _.replace(/(\d+)d(\d+)/g,(N,te,X)=>`${parseInt(te)*2}d${X}`)}function We(){o(le,0),o(_e,0),o(Pe,0),o(C,0),o(R,0),o(S,0),o(W,0),o(oe,null),o(b,[]),o(j,!1),o(ae,!1),be("other"),o(Ge,!1)}function M(){window.DICE&&(window.DICE.setColors({dice_color:ne(e(qe),"ff"),label_color:ne(e(we),"ff"),desk_color:e(m)}),ge&&(ge.updateDeskColor(e(m)),ge.updateDiceColors()))}function A(){o(E,!e(E))}function ce(){!e(oe)||e(h)<=0||e(Ge)||(o(oe,{...e(oe),resultTotal:e(oe).resultTotal+10,resultString:e(oe).resultString+" + 10 (Guided Strike)"}),se.update(_=>{const N="ChannelDivinity",te=_.classFeatures.features[N];return typeof te=="number"&&te>0&&(_.classFeatures.features[N]=te-1),_}),o(Ge,!0))}function ke(){x("close"),y(""),U(""),re(""),o(Ke,""),o(oe,null),o(Ge,!1),o(j,!1),o(ae,!1),We()}Qe(()=>(t(),ua),()=>{o(p,t().class?ua(t().class,t().level,t().subclass).some(N=>N.name==="Guided Strike"):!1)}),Qe(()=>t(),()=>{o(h,(()=>{const N=t().classFeatures.features["ChannelDivinity"];return typeof N=="number"?N:0})())}),Qe(()=>(e(le),e(_e),e(Pe),e(C),e(R),e(S),e(W)),()=>{o($,(()=>{const _=[];e(le)>0&&_.push(`${e(le)}d4`),e(_e)>0&&_.push(`${e(_e)}d6`),e(Pe)>0&&_.push(`${e(Pe)}d8`),e(C)>0&&_.push(`${e(C)}d10`),e(R)>0&&_.push(`${e(R)}d12`),e(S)>0&&_.push(`${e(S)}d20`);let N=_.join("+")||"1d20";return e(W)!==0&&(N+=e(W)>=0?`+${e(W)}`:`${e(W)}`),N})())}),Qe(()=>(P(y()),e(je),P(V()),e(Ke),P(U()),P(re()),P(be())),()=>{y()&&e(je)&&V()&&y()!==e(Ke)&&(o(Ke,y()),o(oe,null),o(b,[]),o(j,!1),o(ae,!1),o(Ge,!1),console.log("Auto-roll triggered. notation:",y(),"damageNotation:",U(),"attackName:",re(),"rollType:",be()),setTimeout(()=>ye(y(),be()),200))}),Zt();var q={getLastRollTotal:Fe};Ht();var u=an();let ze;var me=i(u),pe=i(me),I=s(i(pe),2),Te=i(I),Re=s(Te,2);l(I),l(pe);var Xe=s(pe,2);{var at=_=>{var N=Gi(),te=s(i(N),2),X=i(te),ie=s(i(X),2);Ce(ie),l(X);var D=s(X,2),H=s(i(D),2);Ce(H),l(D);var z=s(D,2),fe=s(i(z),2);Ce(fe),l(z),l(te),l(N),Je(ie,()=>e(qe),Le=>o(qe,Le)),T("change",ie,M),Je(H,()=>e(we),Le=>o(we,Le)),T("change",H,M),Je(fe,()=>e(m),Le=>o(m,Le)),T("change",fe,M),v(_,N)};k(Xe,_=>{e(E)&&_(at)})}var Ie=s(Xe,2);{var $e=_=>{var N=qi();v(_,N)};k(Ie,_=>{e(je)||_($e)})}var Be=s(Ie,2),Ee=i(Be);ya(Ee,_=>o(G,_),()=>e(G));var He=s(Ee,2);{var Ne=_=>{var N=Wi(),te=s(i(N),2),X=i(te),ie=s(i(X),2);Ce(ie),l(X);var D=s(X,2),H=s(i(D),2);Ce(H),l(D);var z=s(D,2),fe=s(i(z),2);Ce(fe),l(z);var Le=s(z,2),st=s(i(Le),2);Ce(st),l(Le);var K=s(Le,2),ct=s(i(K),2);Ce(ct),l(K);var gt=s(K,2),bt=s(i(gt),2);Ce(bt),l(gt),l(te);var f=s(te,2),O=i(f),F=i(O);l(O);var Se=s(O,2);l(f),l(N),B(()=>{O.disabled=!e(je),L(F,`Roll ${e($)??""}`)}),Je(ie,()=>e(le),ue=>o(le,ue)),Je(H,()=>e(_e),ue=>o(_e,ue)),Je(fe,()=>e(Pe),ue=>o(Pe,ue)),Je(st,()=>e(C),ue=>o(C,ue)),Je(ct,()=>e(R),ue=>o(R,ue)),Je(bt,()=>e(S),ue=>o(S,ue)),T("click",O,tt),T("click",Se,We),v(_,N)};k(He,_=>{y()||_(Ne)})}l(Be);var ve=s(Be,2);let he;var J=i(ve);{var De=_=>{var N=tn(),te=Ue(N),X=i(te),ie=i(X,!0);l(X);var D=s(X,2);{var H=Se=>{var ue=zi();v(Se,ue)};k(D,Se=>{e(j)&&Se(H)})}var z=s(D,2);{var fe=Se=>{var ue=Ki();v(Se,ue)};k(z,Se=>{e(ae)&&Se(fe)})}l(te);var Le=s(te,2),st=i(Le,!0);l(Le);var K=s(Le,2),ct=i(K);{var gt=Se=>{var ue=nt(),et=Ue(ue);{var Me=Ye=>{var rt=Ji();kt(rt,5,()=>(e(oe),P(y()),P(ee()),n(()=>Oe(e(oe),y(),ee()))),wt,(lt,it)=>{var mt=Vi(),pt=i(mt),vt=i(pt,!0);l(pt);var ht=s(pt,2),At=i(ht);l(ht),l(mt),B(()=>{L(vt,(e(it),n(()=>e(it).display))),L(At,`(${e(it),n(()=>e(it).source)??""})`)}),v(lt,mt)}),l(rt),v(Ye,rt)},ut=Ye=>{var rt=nt(),lt=Ue(rt);{var it=mt=>{var pt=Yi(),vt=i(pt);l(pt),B(()=>L(vt,`Modifier: ${e(oe),n(()=>e(oe).constant>=0?"+":"")??""}${e(oe),n(()=>e(oe).constant)??""}`)),v(mt,pt)};k(lt,mt=>{e(oe),n(()=>e(oe).constant)&&mt(it)},!0)}v(Ye,rt)};k(et,Ye=>{P(ee()),n(()=>ee().length>0)?Ye(Me):Ye(ut,!1)})}v(Se,ue)};k(ct,Se=>{e(oe),P(ee()),n(()=>e(oe).constant||ee().length>0)&&Se(gt)})}l(K);var bt=s(K,2);{var f=Se=>{var ue=Qi();v(Se,ue)};k(bt,Se=>{e(ae)&&Se(f)})}var O=s(bt,2);{var F=Se=>{var ue=en(),et=i(ue);kt(et,1,()=>e(b),wt,(Ye,rt)=>{var lt=Xi(),it=i(lt,!0);l(lt),B(()=>L(it,(e(rt),n(()=>e(rt).label)))),T("click",lt,()=>ye(e(rt).notation,"damage")),v(Ye,lt)});var Me=s(et,2);{var ut=Ye=>{var rt=Zi();B(()=>{rt.disabled=e(h)<=0,Ve(rt,"title",e(h)<=0?"No Channel Divinity uses remaining":"Use Channel Divinity to add +10 to this attack roll")}),T("click",rt,ce),v(Ye,rt)};k(Me,Ye=>{e(p)&&be()==="attack"&&!e(Ge)&&e(h)>0&&!e(ae)&&Ye(ut)})}l(ue),v(Se,ue)};k(O,Se=>{e(b),e(p),P(be()),e(Ge),e(h),n(()=>e(b).length>0||e(p)&&be()==="attack"&&!e(Ge)&&e(h)>0)&&Se(F)})}B(()=>{L(ie,re()?`${re()} - Result`:"Result"),L(st,(e(oe),n(()=>e(oe).resultTotal)))}),v(_,N)};k(J,_=>{e(oe)&&_(De)})}l(ve),l(me),l(u),B(()=>{ze=yt(u,1,"modal-overlay svelte-1r90jgp",null,ze,{hidden:!V()}),he=yt(ve,1,"roll-result svelte-1r90jgp",null,he,{"has-result":e(oe)})}),T("click",Te,A),T("click",Re,ke),T("click",me,za(function(_){da.call(this,r,_)})),T("keydown",me,function(_){da.call(this,r,_)}),T("click",u,ke),T("keydown",u,_=>_.key==="Escape"&&ke()),v(a,u),Ys(r,"getLastRollTotal",Fe);var de=Ut(q);return d(),de}const Ba="https://api.github.com/gists";async function ln(a,r,t){if(!r)throw new Error("GitHub token is required");const c=JSON.stringify(a,null,2),d=`${a.name||"character"}_dnd.json`,p={description:t||`D&D Character: ${a.name}`,public:!1,files:{[d]:{content:c}}},h=await fetch(Ba,{method:"POST",headers:{Authorization:`token ${r}`,"Content-Type":"application/json"},body:JSON.stringify(p)});if(!h.ok)throw new Error(`Failed to create gist: ${h.statusText}`);return(await h.json()).id}async function nn(a,r,t){if(!r||!t)throw new Error("GitHub token and Gist ID are required");const c=JSON.stringify(a,null,2),p={files:{[`${a.name||"character"}_dnd.json`]:{content:c}}},h=await fetch(`${Ba}/${t}`,{method:"PATCH",headers:{Authorization:`token ${r}`,"Content-Type":"application/json"},body:JSON.stringify(p)});if(!h.ok)throw new Error(`Failed to update gist: ${h.statusText}`)}async function rn(a,r){if(!a)throw new Error("Gist ID is required");const t={"Content-Type":"application/json"};r&&(t.Authorization=`token ${r}`);const c=await fetch(`${Ba}/${a}`,{method:"GET",headers:t});if(!c.ok)throw new Error(`Failed to load gist: ${c.statusText}`);const d=await c.json(),p=Object.values(d.files);if(p.length===0)throw new Error("No files found in gist");const $=p[0].content;try{const x=JSON.parse($);return x.attacks&&Array.isArray(x.attacks)&&(x.attacks=x.attacks.map(y=>({...y,id:y.id||crypto.randomUUID()}))),x.classFeatures?(x.classFeatures.features||(x.classFeatures.features={}),x.classFeatures.spellSlots||(x.classFeatures.spellSlots=[]),x.classFeatures.preparedSpells===void 0&&(x.classFeatures.preparedSpells="")):x.classFeatures={features:{},spellSlots:[],preparedSpells:""},x}catch{throw new Error("Invalid character data in gist")}}function is(a){typeof window<"u"&&localStorage.setItem("dnd_gist_config",JSON.stringify(a))}function on(){if(typeof window<"u"){const a=localStorage.getItem("dnd_gist_config");if(a)return JSON.parse(a)}return{}}async function cn(a,r=30){if(!a)throw new Error("GitHub token is required to list gists");const t=await fetch(`${Ba}?per_page=${r}`,{method:"GET",headers:{Authorization:`token ${a}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error(`Failed to list gists: ${t.statusText}`);return await t.json()}var vn=g('<div class="error-message svelte-1jb5ckg"> </div>'),dn=g('<div class="toggle-container svelte-1jb5ckg"><button type="button" class="toggle-btn svelte-1jb5ckg"> </button></div>'),un=g('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID (leave empty to create new)</label> <input type="text" id="gistId" placeholder="Optional: existing Gist ID to update" class="svelte-1jb5ckg"/></div>'),pn=g('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),fn=g('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),gn=g('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Update (or leave unselected to create new)</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),mn=g('<div class="info-message svelte-1jb5ckg">No gists found. A new one will be created.</div>'),hn=g('<!> <div class="form-group svelte-1jb5ckg"><label for="description" class="svelte-1jb5ckg"> </label> <input type="text" id="description" placeholder="D&amp;D Character Sheet" class="svelte-1jb5ckg"/></div>',1),bn=g('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID *</label> <input type="text" id="gistId" placeholder="Enter Gist ID (for public or your private gists)" required class="svelte-1jb5ckg"/></div>'),_n=g('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),yn=g('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),xn=g('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Load</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),Sn=g('<div class="info-message svelte-1jb5ckg">No gists found. Enter a Gist ID manually or create a new one in Save mode.</div>'),kn=g('<div class="modal-overlay svelte-1jb5ckg" role="button" tabindex="-1"><div class="modal-content svelte-1jb5ckg" role="dialog" tabindex="0"><div class="modal-header svelte-1jb5ckg"><h2 class="svelte-1jb5ckg"> </h2> <button class="close-btn svelte-1jb5ckg">√ó</button></div> <div class="modal-body svelte-1jb5ckg"><!> <div class="form-group svelte-1jb5ckg"><label for="token" class="svelte-1jb5ckg"> <a href="https://github.com/settings/tokens" target="_blank" rel="noopener" class="svelte-1jb5ckg">Get token</a></label> <input type="password" id="token" placeholder="ghp_xxxxxxxxxxxxx" class="svelte-1jb5ckg"/></div> <!> <!> <div class="modal-actions svelte-1jb5ckg"><button class="btn btn-primary svelte-1jb5ckg"><!></button> <button class="btn btn-secondary svelte-1jb5ckg">Cancel</button></div></div></div></div>');function $n(a,r){Nt(r,!1);const t=()=>Ze(se,"$character",c),[c,d]=Vt(),p=ca();let h=St(r,"mode",8,"save"),$=w(""),x=w(""),y=w(""),V=w(!1),U=w(""),re=w(!1),Z=w(!1),ee=w([]),be=w(null);const ge=on();ge.token&&o($,ge.token),ge.gistId&&o(x,ge.gistId),pa(async()=>{e($)&&!e(re)&&await G()});async function G(){if(e($)){o(Z,!0),o(U,"");try{o(ee,await cn(e($))),e(x)&&o(be,e(ee).find(A=>A.id===e(x))||null)}catch(A){o(U,A.message||"Failed to load gists"),o(ee,[])}finally{o(Z,!1)}}}function je(A){o(be,A),o(x,A.id)}function Ke(){o(re,!e(re)),o(U,""),!e(re)&&e($)&&G()}async function oe(){if(!e($)){o(U,"GitHub token is required");return}const A=e(be)?.id||e(x);o(V,!0),o(U,"");try{if(A)await nn(t(),e($),A),o(x,A),Kt.add("Character updated in Gist successfully!","success");else{const ce=await ln(t(),e($),e(y));o(x,ce),Kt.add(`Character saved to Gist! ID: ${ce}`,"success")}is({token:e($),gistId:e(x)}),p("close")}catch(ce){o(U,ce.message||"Failed to save to Gist")}finally{o(V,!1)}}async function Fe(){const A=e(be)?.id||e(x);if(!A){o(U,"Please select a gist or enter a Gist ID");return}o(V,!0),o(U,"");try{const ce=await rn(A,e($)||void 0);se.set(ce),o(x,A),is({token:e($),gistId:e(x)}),Kt.add("Character loaded from Gist successfully!","success"),p("close")}catch(ce){o(U,ce.message||"Failed to load from Gist")}finally{o(V,!1)}}function Oe(){p("close")}Ht();var le=kn(),_e=i(le),Pe=i(_e),C=i(Pe),R=i(C,!0);l(C);var S=s(C,2);l(Pe);var W=s(Pe,2),b=i(W);{var j=A=>{var ce=vn(),ke=i(ce,!0);l(ce),B(()=>L(ke,e(U))),v(A,ce)};k(b,A=>{e(U)&&A(j)})}var ae=s(b,2),Ge=i(ae),qe=i(Ge);oa(),l(Ge);var we=s(Ge,2);Ce(we),l(ae);var m=s(ae,2);{var E=A=>{var ce=dn(),ke=i(ce),q=i(ke,!0);l(ke),l(ce),B(()=>{ke.disabled=e(V),L(q,e(re)?"üìã Show My Gists":"‚úèÔ∏è Enter Gist ID Manually")}),T("click",ke,Ke),v(A,ce)};k(m,A=>{(h()==="load"||h()==="save"&&e($))&&A(E)})}var Q=s(m,2);{var ne=A=>{var ce=hn(),ke=Ue(ce);{var q=Te=>{var Re=un(),Xe=s(i(Re),2);Ce(Xe),l(Re),B(()=>Xe.disabled=e(V)),Je(Xe,()=>e(x),at=>o(x,at)),v(Te,Re)},u=Te=>{var Re=nt(),Xe=Ue(Re);{var at=$e=>{var Be=pn();v($e,Be)},Ie=$e=>{var Be=nt(),Ee=Ue(Be);{var He=ve=>{var he=gn(),J=s(i(he),2);kt(J,5,()=>e(ee),wt,(De,de)=>{var _=fn();let N;var te=i(_),X=i(te),ie=i(X,!0);l(X);var D=s(X,2),H=i(D,!0);l(D),l(te);var z=s(te,2),fe=i(z),Le=i(fe);l(fe);var st=s(fe,2),K=i(st);l(st),l(z),l(_),B(ct=>{N=yt(_,1,"gist-item svelte-1jb5ckg",null,N,{selected:e(be)?.id===e(de).id}),_.disabled=e(V),L(ie,(e(de),n(()=>e(de).description||"Untitled"))),L(H,(e(de),n(()=>e(de).public?"üåê Public":"üîí Private"))),L(Le,`ID: ${e(de),n(()=>e(de).id)??""}`),L(K,`Updated: ${ct??""}`)},[()=>(e(de),n(()=>new Date(e(de).updated_at).toLocaleDateString()))]),T("click",_,()=>je(e(de))),v(De,_)}),l(J),l(he),v(ve,he)},Ne=ve=>{var he=nt(),J=Ue(he);{var De=de=>{var _=mn();v(de,_)};k(J,de=>{e($)&&de(De)},!0)}v(ve,he)};k(Ee,ve=>{e(ee),n(()=>e(ee).length>0)?ve(He):ve(Ne,!1)},!0)}v($e,Be)};k(Xe,$e=>{e(Z)?$e(at):$e(Ie,!1)},!0)}v(Te,Re)};k(ke,Te=>{e(re)||!e($)?Te(q):Te(u,!1)})}var ze=s(ke,2),me=i(ze),pe=i(me);l(me);var I=s(me,2);Ce(I),l(ze),B(()=>{L(pe,`Description ${e(x)?"(optional)":""}`),I.disabled=e(V)}),Je(I,()=>e(y),Te=>o(y,Te)),v(A,ce)},Y=A=>{var ce=nt(),ke=Ue(ce);{var q=ze=>{var me=bn(),pe=s(i(me),2);Ce(pe),l(me),B(()=>pe.disabled=e(V)),Je(pe,()=>e(x),I=>o(x,I)),v(ze,me)},u=ze=>{var me=nt(),pe=Ue(me);{var I=Re=>{var Xe=_n();v(Re,Xe)},Te=Re=>{var Xe=nt(),at=Ue(Xe);{var Ie=Be=>{var Ee=xn(),He=s(i(Ee),2);kt(He,5,()=>e(ee),wt,(Ne,ve)=>{var he=yn();let J;var De=i(he),de=i(De),_=i(de,!0);l(de);var N=s(de,2),te=i(N,!0);l(N),l(De);var X=s(De,2),ie=i(X),D=i(ie);l(ie);var H=s(ie,2),z=i(H);l(H),l(X),l(he),B(fe=>{J=yt(he,1,"gist-item svelte-1jb5ckg",null,J,{selected:e(be)?.id===e(ve).id}),he.disabled=e(V),L(_,(e(ve),n(()=>e(ve).description||"Untitled"))),L(te,(e(ve),n(()=>e(ve).public?"üåê Public":"üîí Private"))),L(D,`ID: ${e(ve),n(()=>e(ve).id)??""}`),L(z,`Updated: ${fe??""}`)},[()=>(e(ve),n(()=>new Date(e(ve).updated_at).toLocaleDateString()))]),T("click",he,()=>je(e(ve))),v(Ne,he)}),l(He),l(Ee),v(Be,Ee)},$e=Be=>{var Ee=nt(),He=Ue(Ee);{var Ne=ve=>{var he=Sn();v(ve,he)};k(He,ve=>{e($)&&ve(Ne)},!0)}v(Be,Ee)};k(at,Be=>{e(ee),n(()=>e(ee).length>0)?Be(Ie):Be($e,!1)},!0)}v(Re,Xe)};k(pe,Re=>{e(Z)?Re(I):Re(Te,!1)},!0)}v(ze,me)};k(ke,ze=>{e(re)||!e($)?ze(q):ze(u,!1)},!0)}v(A,ce)};k(Q,A=>{h()==="save"?A(ne):A(Y,!1)})}var ye=s(Q,2),Ae=i(ye),tt=i(Ae);{var xe=A=>{var ce=Pt();B(()=>L(ce,h()==="save"?"Saving...":"Loading...")),v(A,ce)},We=A=>{var ce=Pt();B(()=>L(ce,h()==="save"?"Save":"Load")),v(A,ce)};k(tt,A=>{e(V)?A(xe):A(We,!1)})}l(Ae);var M=s(Ae,2);l(ye),l(W),l(_e),l(le),B(()=>{L(R,h()==="save"?"Save to GitHub Gist":"Load from GitHub Gist"),L(qe,`GitHub Token ${h()==="load"?"(optional for public gists)":"(required)"} `),we.disabled=e(V),Ae.disabled=e(V),M.disabled=e(V)}),T("click",S,Oe),Je(we,()=>e($),A=>o($,A)),T("blur",we,()=>{e($)&&!e(re)&&G()}),T("click",Ae,function(...A){(h()==="save"?oe:Fe)?.apply(this,A)}),T("click",M,Oe),T("click",_e,za(function(A){da.call(this,r,A)})),T("keydown",_e,function(A){da.call(this,r,A)}),T("click",le,Oe),T("keydown",le,A=>A.key==="Escape"&&Oe()),v(a,le),Ut(),d()}var Cn=g('<div class="loading svelte-1ngjemu">Loading D&D data...</div>'),wn=g("<option> </option>"),Dn=g('<select class="level-filter svelte-1ngjemu"><option>All Levels</option><option>Cantrip</option><!></select>'),Ln=g('<div class="no-results svelte-1ngjemu"> </div>'),jn=g('<div class="item-meta svelte-1ngjemu"> </div>'),An=g('<div class="item-meta svelte-1ngjemu"> </div>'),Bn=g('<button><div class="item-name svelte-1ngjemu"> </div> <!></button>'),Mn=g('<p class="higher-levels"><strong>At Higher Levels:</strong> </p>'),Fn=g('<p class="cantrip-upgrade"><strong>Cantrip Upgrade:</strong> </p>'),Tn=g('<h3 class="svelte-1ngjemu"> </h3> <p class="spell-meta svelte-1ngjemu"><!> <!></p> <p class="spell-classes"><strong>Classes:</strong> </p> <div class="spell-stats svelte-1ngjemu"><div><strong>Casting Time:</strong> </div> <div><strong>Range:</strong> </div> <div><strong>Components:</strong> <!></div> <div><strong>Duration:</strong> <!> </div></div> <p class="description svelte-1ngjemu"> </p> <!> <!>',1),Rn=g('<p class="prerequisite svelte-1ngjemu"><strong>Prerequisite:</strong> </p>'),In=g('<h3 class="svelte-1ngjemu"> </h3> <!> <p class="description svelte-1ngjemu"> </p> <a target="_blank" rel="noopener" class="source-link svelte-1ngjemu">View Full Details ‚Üí</a>',1),Pn=g('<div class="item-details svelte-1ngjemu"><!></div>'),En=g('<div class="controls svelte-1ngjemu"><div class="tabs svelte-1ngjemu"><button> </button> <button> </button></div> <div class="search-controls svelte-1ngjemu"><input type="text" placeholder="Search by name or description..." class="search-input svelte-1ngjemu"/> <!></div></div> <div class="content-container svelte-1ngjemu"><div class="items-list svelte-1ngjemu"><!></div> <!></div>',1),Hn=g('<div class="modal-backdrop svelte-1ngjemu" role="presentation"><div class="modal svelte-1ngjemu" role="dialog" aria-modal="true" tabindex="-1"><div class="modal-header svelte-1ngjemu"><h2 class="svelte-1ngjemu">Browse D&D Spells & Feats</h2> <button class="close-btn svelte-1ngjemu" aria-label="Close">&times;</button></div> <div class="modal-body svelte-1ngjemu"><!></div> <div class="modal-footer svelte-1ngjemu"><button class="btn-secondary svelte-1ngjemu">Cancel</button> <button class="btn-primary svelte-1ngjemu">Add to Character Sheet</button></div></div></div>');function Nn(a,r){Nt(r,!1);const t=w(),c=w(),d=w();let p=St(r,"onClose",8),h=w("spell"),$=w(!0),x=w(""),y=w(null),V=w([]),U=w([]),re=w(null);pa(async()=>{o($,!0);try{o(V,await gs()),o(U,await Al())}catch(S){console.error("Failed to load data:",S)}finally{o($,!1)}});function Z(S){o(re,S)}function ee(S){const W=S.match(/(\d+d\d+(?:\s*\+\s*\d+)?)/i);return W?W[1]:""}function be(S){const W=S.split(/\.( |$)/)[0].trim(),b=Array.from(S.matchAll(/\*\*(.*?)\*\*/g)).map(ae=>ae[1].replace(/\.$/,""));let j=W;return b.length&&(j+=" | Effects: "+b.join(", ")),j}function ge(){if(e(re)){if(e(h)==="spell"){const S=e(re);se.update(W=>{const j=[];S.range&&j.push(`Range: ${S.range}`),S.castingTime&&j.push(`Cast: ${S.castingTime}`),S.duration&&j.push(`Duration: ${S.duration}`),S.actionType==="Save"&&j.push("Saving throw spell"),S.components&&S.components.length>0&&j.push(`Components: ${S.components.join(", ")}`),S.material&&j.push(`Material: ${S.material}`);const ae=j.join(" | "),Ge=be(S.description),qe={id:crypto.randomUUID(),name:`${S.name}${S.concentration?" (C)":""}${S.ritual?" (R)":""}`,bonus:S.actionType==="Attack"?5:0,damage:ee(S.description),damageType:`${S.school} (Lvl ${S.level})`,spellRef:S.name,infoNotes:ae,generalNotes:Ge,castAtLevel:S.level};return W.attacks=[...W.attacks,qe],W})}else if(e(h)==="feat"){const S=e(re);se.update(W=>{const b=`${S.name}${S.prerequisite?` (Req: ${S.prerequisite})`:""}
${S.description}
`;return W.features=W.features?`${W.features}
${b}`:b,W})}o(re,null),p()()}}Qe(()=>(e(y),e(V),e(x)),()=>{o(t,e(y)!==null?Bl(as(e(V),e(x)),e(y)):as(e(V),e(x)))}),Qe(()=>(e(U),e(x)),()=>{o(c,Ml(e(U),e(x)))}),Qe(()=>(e(h),e(t),e(c)),()=>{o(d,e(h)==="spell"?e(t):e(c))}),Zt(),Ht();var G=Hn(),je=i(G),Ke=i(je),oe=s(i(Ke),2);l(Ke);var Fe=s(Ke,2),Oe=i(Fe);{var le=S=>{var W=Cn();v(S,W)},_e=S=>{var W=En(),b=Ue(W),j=i(b),ae=i(j);let Ge;var qe=i(ae);l(ae);var we=s(ae,2);let m;var E=i(we);l(we),l(j);var Q=s(j,2),ne=i(Q);Ce(ne);var Y=s(ne,2);{var ye=ke=>{var q=Dn();B(()=>{e(y),jt(()=>{})});var u=i(q);u.value=(u.__value=null)??"";var ze=s(u);ze.value=ze.__value=0;var me=s(ze);kt(me,0,()=>[1,2,3,4,5,6,7,8,9],wt,(pe,I)=>{var Te=wn(),Re=i(Te);l(Te);var Xe={};B(()=>{L(Re,`Level ${I??""}`),Xe!==(Xe=I)&&(Te.value=(Te.__value=I)??"")}),v(pe,Te)}),l(q),ja(q,()=>e(y),pe=>o(y,pe)),v(ke,q)};k(Y,ke=>{e(h)==="spell"&&ke(ye)})}l(Q),l(b);var Ae=s(b,2),tt=i(Ae),xe=i(tt);{var We=ke=>{var q=Ln(),u=i(q);l(q),B(()=>L(u,`No ${e(h)??""}s found`)),v(ke,q)},M=ke=>{var q=nt(),u=Ue(q);kt(u,1,()=>e(d),wt,(ze,me)=>{var pe=Bn();let I;var Te=i(pe),Re=i(Te,!0);l(Te);var Xe=s(Te,2);{var at=$e=>{const Be=ot(()=>e(me));var Ee=jn(),He=i(Ee);l(Ee),B(()=>L(He,`Level ${P(e(Be)),n(()=>e(Be).level)??""} ‚Ä¢ ${P(e(Be)),n(()=>e(Be).school)??""}`)),v($e,Ee)},Ie=$e=>{const Be=ot(()=>e(me));var Ee=nt(),He=Ue(Ee);{var Ne=ve=>{var he=An(),J=i(he,!0);l(he),B(()=>L(J,(P(e(Be)),n(()=>e(Be).prerequisite)))),v(ve,he)};k(He,ve=>{P(e(Be)),n(()=>e(Be).prerequisite)&&ve(Ne)})}v($e,Ee)};k(Xe,$e=>{e(h)==="spell"?$e(at):$e(Ie,!1)})}l(pe),B(()=>{I=yt(pe,1,"item-card svelte-1ngjemu",null,I,{selected:e(re)?.name===e(me).name}),L(Re,(e(me),n(()=>e(me).name)))}),T("click",pe,()=>Z(e(me))),v(ze,pe)}),v(ke,q)};k(xe,ke=>{e(d),n(()=>e(d).length===0)?ke(We):ke(M,!1)})}l(tt);var A=s(tt,2);{var ce=ke=>{var q=Pn(),u=i(q);{var ze=pe=>{const I=ot(()=>e(re));var Te=Tn(),Re=Ue(Te),Xe=i(Re,!0);l(Re);var at=s(Re,2),Ie=i(at);{var $e=f=>{var O=Pt();B(()=>L(O,`${P(e(I)),n(()=>e(I).school)??""} cantrip`)),v(f,O)},Be=f=>{var O=Pt();B(()=>L(O,`Level ${P(e(I)),n(()=>e(I).level)??""} ${P(e(I)),n(()=>e(I).school)??""}`)),v(f,O)};k(Ie,f=>{P(e(I)),n(()=>e(I).level===0)?f($e):f(Be,!1)})}var Ee=s(Ie,2);{var He=f=>{var O=Pt("(ritual)");v(f,O)};k(Ee,f=>{P(e(I)),n(()=>e(I).ritual)&&f(He)})}l(at);var Ne=s(at,2),ve=s(i(Ne));l(Ne);var he=s(Ne,2),J=i(he),De=s(i(J));l(J);var de=s(J,2),_=s(i(de));l(de);var N=s(de,2),te=s(i(N)),X=s(te);{var ie=f=>{var O=Pt();B(()=>L(O,`(${P(e(I)),n(()=>e(I).material)??""})`)),v(f,O)};k(X,f=>{P(e(I)),n(()=>e(I).material)&&f(ie)})}l(N);var D=s(N,2),H=s(i(D),2);{var z=f=>{var O=Pt("Concentration,");v(f,O)};k(H,f=>{P(e(I)),n(()=>e(I).concentration)&&f(z)})}var fe=s(H,1,!0);l(D),l(he);var Le=s(he,2),st=i(Le,!0);l(Le);var K=s(Le,2);{var ct=f=>{var O=Mn(),F=s(i(O));l(O),B(()=>L(F,` ${P(e(I)),n(()=>e(I).higherLevelSlot)??""}`)),v(f,O)};k(K,f=>{P(e(I)),n(()=>e(I).higherLevelSlot)&&f(ct)})}var gt=s(K,2);{var bt=f=>{var O=Fn(),F=s(i(O));l(O),B(()=>L(F,` ${P(e(I)),n(()=>e(I).cantripUpgrade)??""}`)),v(f,O)};k(gt,f=>{P(e(I)),n(()=>e(I).cantripUpgrade)&&f(bt)})}B((f,O)=>{L(Xe,(P(e(I)),n(()=>e(I).name))),L(ve,` ${f??""}`),L(De,` ${P(e(I)),n(()=>e(I).castingTime||e(I).actionType)??""}`),L(_,` ${P(e(I)),n(()=>e(I).range)??""}`),L(te,` ${O??""}`),L(fe,(P(e(I)),n(()=>e(I).duration))),L(st,(P(e(I)),n(()=>e(I).description)))},[()=>(P(e(I)),n(()=>e(I).classes.join(", "))),()=>(P(e(I)),n(()=>e(I).components.join(", ").toUpperCase()))]),v(pe,Te)},me=pe=>{const I=ot(()=>e(re));var Te=In(),Re=Ue(Te),Xe=i(Re,!0);l(Re);var at=s(Re,2);{var Ie=He=>{var Ne=Rn(),ve=s(i(Ne));l(Ne),B(()=>L(ve,` ${P(e(I)),n(()=>e(I).prerequisite)??""}`)),v(He,Ne)};k(at,He=>{P(e(I)),n(()=>e(I).prerequisite)&&He(Ie)})}var $e=s(at,2),Be=i($e,!0);l($e);var Ee=s($e,2);B(()=>{L(Xe,(P(e(I)),n(()=>e(I).name))),L(Be,(P(e(I)),n(()=>e(I).description))),Ve(Ee,"href",(P(e(I)),n(()=>e(I).source)))}),v(pe,Te)};k(u,pe=>{e(h)==="spell"?pe(ze):pe(me,!1)})}l(q),v(ke,q)};k(A,ke=>{e(re)&&ke(ce)})}l(Ae),B(()=>{Ge=yt(ae,1,"tab svelte-1ngjemu",null,Ge,{active:e(h)==="spell"}),L(qe,`üìú Spells (${e(V),n(()=>e(V).length)??""})`),m=yt(we,1,"tab svelte-1ngjemu",null,m,{active:e(h)==="feat"}),L(E,`‚≠ê Feats (${e(U),n(()=>e(U).length)??""})`)}),T("click",ae,()=>{o(h,"spell"),o(re,null),o(x,"")}),T("click",we,()=>{o(h,"feat"),o(re,null),o(x,"")}),Je(ne,()=>e(x),ke=>o(x,ke)),v(S,W)};k(Oe,S=>{e($)?S(le):S(_e,!1)})}l(Fe);var Pe=s(Fe,2),C=i(Pe),R=s(C,2);l(Pe),l(je),l(G),B(()=>R.disabled=!e(re)),T("click",oe,function(...S){p()?.apply(this,S)}),T("click",C,function(...S){p()?.apply(this,S)}),T("click",R,ge),T("click",je,za(function(S){da.call(this,r,S)})),T("keydown",je,function(S){da.call(this,r,S)}),T("click",G,function(...S){p()?.apply(this,S)}),T("keydown",G,S=>S.key==="Escape"&&p()()),v(a,G),Ut()}var Un=g('<link rel="icon" type="image/png" href="favicon4.png"/> <meta name="viewport" content="width=device-width, initial-scale=1"/>',1),On=g('<span class="character-name svelte-1uha8ag"> </span>'),Gn=g("<span> </span>"),qn=g('<div class="spell-slots-header svelte-1uha8ag"></div>'),Wn=g("<span> </span><br/>",1),zn=g("<span> </span>"),Kn=g('<span class="effect-tooltip"><strong> </strong><br/> <br/> <!> <!></span>'),Vn=g('<button class="effect-remove-btn svelte-1uha8ag">√ó</button>'),Jn=g('<span class="effect-badge svelte-1uha8ag" tabindex="0"> <!> <!></span>'),Yn=g(`<div class="active-effects-header svelte-1uha8ag"></div> <style>.effect-badge {
              position: relative;
            }
            .effect-tooltip {
              position: absolute;
              top: 120%;
              left: 50%;
              transform: translateX(-50%);
              background: #fff;
              color: #222;
              border: 1px solid #a5b4fc;
              border-radius: 6px;
              padding: 8px 12px;
              font-size: 0.95em;
              box-shadow: 0 2px 8px rgba(0, 0, 0, 0.12);
              z-index: 10;
              min-width: 180px;
              max-width: 260px;
              white-space: normal;
              pointer-events: none;
              opacity: 1;
              transition: opacity 0.15s;
            }</style>`,1),Qn=g('<div class="rest-menu svelte-1uha8ag"><button class="rest-option svelte-1uha8ag">‚òï Short Rest</button> <button class="rest-option svelte-1uha8ag">üõèÔ∏è Long Rest</button></div>'),Xn=g('<div class="container svelte-1uha8ag"><header class="svelte-1uha8ag"><div class="header-top svelte-1uha8ag"><div class="header-title svelte-1uha8ag"><div class="title-row svelte-1uha8ag"><h1 class="svelte-1uha8ag">D&D Character Sheet</h1> <!></div> <!> <!></div> <div class="header-right svelte-1uha8ag"><div class="header-controls svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">üé≤</span><span class="btn-text svelte-1uha8ag">Roll Dice</span></button> <div class="rest-button-container svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">üò¥</span><span class="btn-text svelte-1uha8ag">Rest</span></button> <!></div> <div class="mode-toggle"><button><span class="btn-icon svelte-1uha8ag"> </span><span class="btn-text svelte-1uha8ag"> </span></button></div></div> <div class="header-search svelte-1uha8ag"><input type="text" placeholder="üîç Search..." class="search-input use-enabled svelte-1uha8ag"/></div></div></div> <div class="header-actions svelte-1uha8ag"><button class="btn btn-mode svelte-1uha8ag">üìö Browse Spells & Feats</button> <button class="btn btn-secondary">Save to Gist</button> <button class="btn btn-secondary">Load from Gist</button> <button class="btn btn-secondary">Export JSON</button> <button class="btn btn-secondary">Import JSON</button> <input type="file" accept=".json" style="display: none;"/></div></header> <main class="svelte-1uha8ag"><!> <!> <!> <!> <!> <!> <!></main></div> <!> <!> <!> <!>',1);function rr(a,r){Nt(r,!1);const t=()=>Ze(se,"$character",p),c=()=>Ze(sa,"$isEditMode",p),d=()=>Ze(la,"$searchFilter",p),[p,h]=Vt();function $(){const f=[],O=t().classFeatures.spellSlotsByLevel||{};for(let F=1;F<=9;F++){const Se=O[F];if(Se&&Se.length>0){const ue=Se.length,et=Se.filter(Me=>Me).length;f.push({level:F,available:ue-et,total:ue})}}return f}let x=w(!1),y=w(!1),V=w(!1),U=w("save"),re=w(void 0),Z=w(""),ee=w(""),be=w(""),ge=w(!1),G=w([]),je=w("other"),Ke=w(),oe=!1,Fe=1,Oe=w(!1),le=w(null);function _e(f){o(le,f)}function Pe(){o(le,null)}function C(f){o(le,e(le)===f?null:f)}function R(){const f=[];se.update(F=>{const Se=F.hitDice.current;F.hitDice.current=Math.min(F.hitDice.max,F.hitDice.current+Math.max(1,Math.floor(F.hitDice.max/2)));const ue=F.hitDice.current-Se;if(ue>0&&f.push(`${ue} hit ${ue===1?"die":"dice"}`),F.class){const et=ua(F.class,F.level,F.subclass);F.classFeatures.features||(F.classFeatures.features={}),et.forEach(Me=>{if(Me.resetOn==="short"){const ut=Me.name.replace(/\s+/g,"");if(Me.type==="uses"){const Ye=typeof Me.maxUses=="function"?Me.maxUses(F.level):Me.maxUses;F.classFeatures.features[ut]=Array(Ye).fill(!1),f.push(Me.name)}else if(Me.type==="pool"){const Ye=typeof Me.maxPool=="function"?Me.maxPool(F.level):Me.maxPool;Ye!==void 0&&(F.classFeatures.features[ut]=Ye,f.push(Me.name))}}})}return F}),o(Oe,!1);const O=f.length>0?`Short rest taken! Restored: ${f.join(", ")}`:"Short rest taken!";Kt.add(O,"success")}function S(){const f=[];se.update(F=>{const Se=F.maxHP-F.currentHP;Se>0&&f.push(`${Se} HP`),F.currentHP=F.maxHP,F.tempHP=0;const ue=F.hitDice.max-F.hitDice.current;ue>0&&f.push(`${ue} hit ${ue===1?"die":"dice"}`),F.hitDice.current=F.hitDice.max;let et=0;if(F.classFeatures.spellSlotsByLevel&&Object.keys(F.classFeatures.spellSlotsByLevel).forEach(Me=>{const ut=F.classFeatures.spellSlotsByLevel[parseInt(Me)];if(ut){const Ye=ut.filter(rt=>rt).length;et+=Ye,F.classFeatures.spellSlotsByLevel[parseInt(Me)]=Array(ut.length).fill(!1)}}),et>0&&f.push(`${et} spell ${et===1?"slot":"slots"}`),F.class){const Me=ua(F.class,F.level,F.subclass);F.classFeatures.features||(F.classFeatures.features={});let ut=!1;Me.forEach(Ye=>{const rt=Ye.name.replace(/\s+/g,"");if(!(Ye.type==="info"||Ye.type==="channelDivinity")){if(Ye.type==="uses"){const lt=typeof Ye.maxUses=="function"?Ye.maxUses(F.level):Ye.maxUses;F.classFeatures.features[rt]=Array(lt).fill(!1),ut=!0}else if(Ye.type==="pool"){const lt=typeof Ye.maxPool=="function"?Ye.maxPool(F.level):Ye.maxPool;lt!==void 0&&(F.classFeatures.features[rt]=lt,ut=!0)}}}),ut&&f.push("all class features")}return F}),o(Oe,!1);const O=f.length>0?`Long rest taken! Restored: ${f.join(", ")}`:"Long rest taken! Fully rested.";Kt.add(O,"success")}function W(f){o(Z,""),o(ee,""),o(be,""),o(ge,!1),o(G,[]),o(je,"other"),oe=!1,typeof f=="string"?o(Z,f):(o(Z,f.notation),o(ee,f.damageNotation||""),o(be,f.attackName||""),o(ge,!!f.applyHalfDamage),o(G,f.bonusBreakdown||[]),o(je,f.rollType||"other")),o(x,!0)}function b(f){const{notation:O,count:F,bonusBreakdown:Se}=f.detail;o(Z,""),oe=!0,Fe=F||1,setTimeout(()=>{o(Z,O),o(ee,""),o(be,"Hit Die"),o(G,Se||[]),o(je,"other")},0),o(x,!0)}function j(){if(o(x,!1),oe&&e(Ke)){const f=e(Ke).getLastRollTotal();if(f!==null){const O=Math.max(1,f);se.update(F=>(F.hitDice.current=Math.max(0,F.hitDice.current-Fe),F.currentHP=Math.min(F.maxHP,F.currentHP+O),F))}oe=!1}}function ae(){sa.update(f=>!f)}function Ge(f){f.target.closest(".rest-button-container")||o(Oe,!1)}pa(()=>{const f=sa.subscribe(O=>{O?document.body.classList.remove("use-mode"):document.body.classList.add("use-mode")});return document.addEventListener("click",Ge),()=>{f(),document.removeEventListener("click",Ge)}});function qe(){Ns(t())}function we(){e(re)?.click()}async function m(f){const F=f.target.files?.[0];if(F)try{const Se=await Us(F);se.set(Se),alert("Character imported successfully!")}catch{alert("Failed to import character file")}}Ht();var E=Xn();Es("1uha8ag",f=>{var O=Un();oa(2),os(()=>{Rs.title="D&D Character Sheet"}),v(f,O)});var Q=Ue(E),ne=i(Q),Y=i(ne),ye=i(Y),Ae=i(ye),tt=s(i(Ae),2);{var xe=f=>{var O=On(),F=i(O);l(O),B(()=>L(F,`${t().name??""} (${t().level??""})`)),v(f,O)};k(tt,f=>{t().name&&f(xe)})}l(Ae);var We=s(Ae,2);{var M=f=>{var O=qn();kt(O,5,$,wt,(F,Se)=>{var ue=Gn();let et;var Me=i(ue);l(ue),B(()=>{et=yt(ue,1,"slot-badge svelte-1uha8ag",null,et,{depleted:e(Se).available===0}),L(Me,`Lv${e(Se).level??""}: ${e(Se).available??""}/${e(Se).total??""}`)}),v(F,ue)}),l(O),v(f,O)};k(We,f=>{$().length>0&&f(M)})}var A=s(We,2);{var ce=f=>{var O=Yn(),F=Ue(O);kt(F,5,()=>t().activeStates,wt,(Se,ue,et)=>{var Me=Jn(),ut=i(Me),Ye=s(ut);{var rt=mt=>{var pt=Kn(),vt=i(pt),ht=i(vt,!0);l(vt);var At=s(vt,2),dt=s(At,3);{var xt=Lt=>{var Ft=Wn(),$t=Ue(Ft),Ct=i($t);l($t),oa(),B(()=>L(Ct,`Attack Bonus: ${typeof e(ue).attackBonus=="number"&&e(ue).attackBonus>0?"+":""}${e(ue).attackBonus??""}`)),v(Lt,Ft)};k(dt,Lt=>{e(ue).attackBonus&&Lt(xt)})}var Dt=s(dt,2);{var Ot=Lt=>{var Ft=zn(),$t=i(Ft);l(Ft),B(()=>L($t,`Damage Bonus: ${typeof e(ue).damageBonus=="number"&&e(ue).damageBonus>0?"+":""}${e(ue).damageBonus??""}`)),v(Lt,Ft)};k(Dt,Lt=>{e(ue).damageBonus&&Lt(Ot)})}l(pt),B(()=>{L(ht,e(ue).name),L(At,` ${e(ue).description??""}`)}),v(mt,pt)};k(Ye,mt=>{e(le)===et&&mt(rt)})}var lt=s(Ye,2);{var it=mt=>{var pt=Vn();B(()=>Ve(pt,"title",`End ${e(ue).name??""}`)),T("click",pt,()=>{se.update(vt=>{if(vt.activeStates){const ht=vt.activeStates[et];ht?.hpBonus&&ht.target!=="other"&&(vt.maxHP-=ht.hpBonus,vt.currentHP=Math.max(1,Math.min(vt.currentHP-ht.hpBonus,vt.maxHP))),vt.activeStates=vt.activeStates.filter((At,dt)=>dt!==et)}return vt})}),v(mt,pt)};k(lt,mt=>{c()||mt(it)})}l(Me),B(()=>{Ve(Me,"aria-label",e(ue).name),L(ut,`‚ú® ${e(ue).name??""} `)}),T("mouseenter",Me,()=>_e(et)),T("mouseleave",Me,Pe),T("focus",Me,()=>_e(et)),T("blur",Me,Pe),T("click",Me,()=>C(et)),v(Se,Me)}),l(F),oa(2),v(f,O)};k(A,f=>{t().activeStates&&t().activeStates.length>0&&f(ce)})}l(ye);var ke=s(ye,2),q=i(ke),u=i(q),ze=s(u,2),me=i(ze),pe=s(me,2);{var I=f=>{var O=Qn(),F=i(O),Se=s(F,2);l(O),T("click",F,R),T("click",Se,S),v(f,O)};k(pe,f=>{e(Oe)&&f(I)})}l(ze);var Te=s(ze,2),Re=i(Te);let Xe;var at=i(Re),Ie=i(at,!0);l(at);var $e=s(at),Be=i($e,!0);l($e),l(Re),l(Te),l(q);var Ee=s(q,2),He=i(Ee);Ce(He),l(Ee),l(ke),l(Y);var Ne=s(Y,2),ve=i(Ne),he=s(ve,2),J=s(he,2),De=s(J,2),de=s(De,2),_=s(de,2);ya(_,f=>o(re,f),()=>e(re)),l(Ne),l(ne);var N=s(ne,2),te=i(N);nl(te,{});var X=s(te,2);vl(X,{$$events:{roll:f=>W(f.detail)}});var ie=s(X,2);jl(ie,{$$events:{roll:f=>W(f.detail)}});var D=s(ie,2);Cl(D,{$$events:{rollHitDice:b}});var H=s(D,2);Si(H,{$$events:{roll:f=>W(f.detail)}});var z=s(H,2);Hi(z,{});var fe=s(z,2);Oi(fe,{}),l(N),l(Q);var Le=s(Q,2);ya(sn(Le,{get notation(){return e(Z)},get damageNotation(){return e(ee)},get attackName(){return e(be)},get applyHalfDamage(){return e(ge)},get bonusBreakdown(){return e(G)},get rollType(){return e(je)},get visible(){return e(x)},$$events:{close:j},$$legacy:!0}),f=>o(Ke,f),()=>e(Ke));var st=s(Le,2);{var K=f=>{$n(f,{get mode(){return e(U)},$$events:{close:()=>o(y,!1)}})};k(st,f=>{e(y)&&f(K)})}var ct=s(st,2);{var gt=f=>{Nn(f,{onClose:()=>o(V,!1)})};k(ct,f=>{e(V)&&f(gt)})}var bt=s(ct,2);Hs(bt,{}),B(()=>{Xe=yt(Re,1,"btn btn-mode svelte-1uha8ag",null,Xe,{"use-mode":!c()}),L(Ie,c()?"üìù":"üé≤"),L(Be,c()?"Edit Mode":"Use Mode")}),T("click",u,()=>{o(G,[]),o(x,!0)}),T("click",me,()=>o(Oe,!e(Oe))),T("click",Re,ae),Je(He,d,f=>Os(la,f)),T("click",ve,()=>o(V,!0)),T("click",he,()=>{o(U,"save"),o(y,!0)}),T("click",J,()=>{o(U,"load"),o(y,!0)}),T("click",De,qe),T("click",de,we),T("change",_,m),v(a,E),Ut(),h()}export{rr as component};
