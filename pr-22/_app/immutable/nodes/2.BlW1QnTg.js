import{d as Va,g as bs,f as g,e as T,a as v,s as L,c as ot,t as Rt}from"../chunks/BESELRjb.js";import{i as Pt}from"../chunks/JMgyEzd3.js";import{c as na,o as va,a as _s,b as ys}from"../chunks/CtPH092J.js";import{F as B,T as Vt,Y as Ha,j as xs,aZ as Ss,U as Ja,ag as ks,aD as $s,aK as Cs,aE as ws,a1 as Ds,av as ka,a7 as qa,i as rs,a_ as Ls,a$ as os,b0 as Aa,K as ea,e as cs,b1 as vs,b2 as js,b3 as As,b4 as Bs,q as Na,b5 as Ms,b6 as Fs,ab as Ts,d as n,r as Wa,g as Rs,C as Et,G as Ht,H as i,I as l,J as s,b7 as Qe,b8 as Qt,s as o,a4 as w,f as e,m as dt,E as Ue,b9 as Dt,ao as ia,A as P,ba as la,bb as ma,bc as Is}from"../chunks/DyJ43TGI.js";import{t as Ps,c as It,a as se,e as $t,i as wt,u as ds,s as aa,b as St,d as xa,f as ta,g as Es,j as Wt,h as Hs,T as Ns,k as Us,l as Os}from"../chunks/D6-WMxVZ.js";import{i as k,s as zt,a as tt,b as xt,d as fa,e as Gs}from"../chunks/CCL4udNy.js";import{p as kt,b as ya}from"../chunks/iXw84bXb.js";import{b as ga,r as qs}from"../chunks/mQAGc0Pr.js";function Ws(a,r,t=!1,c=!1,d=!1){var p=a,h="";B(()=>{var $=xs;if(h===(h=r()??"")){Vt&&Ha();return}if($.nodes_start!==null&&(Ss($.nodes_start,$.nodes_end),$.nodes_start=$.nodes_end=null),h!==""){if(Vt){Ja.data;for(var x=Ha(),y=x;x!==null&&(x.nodeType!==ks||x.data!=="");)y=x,x=$s(x);if(x===null)throw Cs(),ws;Va(Ja,y),p=Ds(x);return}var V=h+"";t?V=`<svg>${V}</svg>`:c&&(V=`<math>${V}</math>`);var U=bs(V);if((t||c)&&(U=ka(U)),Va(ka(U),U.lastChild),t||c)for(;ka(U);)p.before(ka(U));else p.before(U)}})}function zs(a,r,t,c,d){Vt&&Ha();var p=r.$$slots?.[t],h=!1;p===!0&&(p=r[t],h=!0),p===void 0?d!==null&&d(a):p(a,h?()=>c:c)}function Ks(a,r,t,c){var d=a.__style;if(Vt||d!==r){var p=Ps(r);(!Vt||p!==a.getAttribute("style"))&&(p==null?a.removeAttribute("style"):a.style.cssText=p),a.__style=r}return c}function La(a,r,t=!1){if(a.multiple){if(r==null)return;if(!rs(r))return Ls();for(var c of a.options)c.selected=r.includes(ha(c));return}for(c of a.options){var d=ha(c);if(os(d,r)){c.selected=!0;return}}(!t||r!==void 0)&&(a.selectedIndex=-1)}function Ua(a){var r=new MutationObserver(()=>{La(a,a.__value)});r.observe(a,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),qa(()=>{r.disconnect()})}function ja(a,r,t=r){var c=new WeakSet,d=!0;Aa(a,"change",p=>{var h=p?"[selected]":":checked",$;if(a.multiple)$=[].map.call(a.querySelectorAll(h),ha);else{var x=a.querySelector(h)??a.querySelector("option:not([disabled])");$=x&&ha(x)}t($),ea!==null&&c.add(ea)}),cs(()=>{var p=r();if(a===document.activeElement){var h=vs??ea;if(c.has(h))return}if(La(a,p,d),d&&p===void 0){var $=a.querySelector(":checked");$!==null&&(p=ha($),t(p))}a.__value=p,d=!1}),Ua(a)}function ha(a){return"__value"in a?a.__value:a.value}const Vs=Symbol("is custom element"),Js=Symbol("is html");function $e(a){if(Vt){var r=!1,t=()=>{if(!r){if(r=!0,a.hasAttribute("value")){var c=a.value;Ve(a,"value",null),a.value=c}if(a.hasAttribute("checked")){var d=a.checked;Ve(a,"checked",null),a.checked=d}}};a.__on_r=t,Na(t),Ms()}}function ba(a,r){var t=za(a);t.value===(t.value=r??void 0)||a.value===r&&(r!==0||a.nodeName!=="PROGRESS")||(a.value=r??"")}function us(a,r){var t=za(a);t.checked!==(t.checked=r??void 0)&&(a.checked=r)}function Ve(a,r,t,c){var d=za(a);Vt&&(d[r]=a.getAttribute(r),r==="src"||r==="srcset"||r==="href"&&a.nodeName==="LINK")||d[r]!==(d[r]=t)&&(r==="loading"&&(a[js]=t),t==null?a.removeAttribute(r):typeof t!="string"&&Ys(a).includes(r)?a[r]=t:a.setAttribute(r,t))}function za(a){return a.__attributes??={[Vs]:a.nodeName.includes("-"),[Js]:a.namespaceURI===As}}var Ya=new Map;function Ys(a){var r=a.getAttribute("is")||a.nodeName,t=Ya.get(r);if(t)return t;Ya.set(r,t=[]);for(var c,d=a,p=Element.prototype;p!==d;){c=Fs(d);for(var h in c)c[h].set&&t.push(h);d=Bs(d)}return t}function Je(a,r,t=r){var c=new WeakSet;Aa(a,"input",async d=>{var p=d?a.defaultValue:a.value;if(p=Ta(a)?Ra(p):p,t(p),ea!==null&&c.add(ea),await Ts(),p!==(p=r())){var h=a.selectionStart,$=a.selectionEnd,x=a.value.length;if(a.value=p??"",$!==null){var y=a.value.length;h===$&&$===x&&y>x?(a.selectionStart=y,a.selectionEnd=y):(a.selectionStart=h,a.selectionEnd=Math.min($,y))}}}),(Vt&&a.defaultValue!==a.value||n(r)==null&&a.value)&&(t(Ta(a)?Ra(a.value):a.value),ea!==null&&c.add(ea)),Wa(()=>{var d=r();if(a===document.activeElement){var p=vs??ea;if(c.has(p))return}Ta(a)&&d===Ra(a.value)||a.type==="date"&&!d&&!a.value||d!==a.value&&(a.value=d??"")})}const Fa=new Set;function Qa(a,r,t,c,d=c){var p=t.getAttribute("type")==="checkbox",h=a;let $=!1;if(r!==null)for(var x of r)h=h[x]??=[];h.push(t),Aa(t,"change",()=>{var y=t.__value;p&&(y=Xa(h,y,t.checked)),d(y)},()=>d(p?[]:null)),Wa(()=>{var y=c();if(Vt&&t.defaultChecked!==t.checked){$=!0;return}p?(y=y||[],t.checked=y.includes(t.__value)):t.checked=os(t.__value,y)}),qa(()=>{var y=h.indexOf(t);y!==-1&&h.splice(y,1)}),Fa.has(h)||(Fa.add(h),Na(()=>{h.sort((y,V)=>y.compareDocumentPosition(V)===4?-1:1),Fa.delete(h)})),Na(()=>{if($){var y;if(p)y=Xa(h,y,t.checked);else{var V=h.find(U=>U.checked);y=V?.__value}d(y)}})}function _a(a,r,t=r){Aa(a,"change",c=>{var d=c?a.defaultChecked:a.checked;t(d)}),(Vt&&a.defaultChecked!==a.checked||n(r)==null)&&t(a.checked),Wa(()=>{var c=r();a.checked=!!c})}function Xa(a,r,t){for(var c=new Set,d=0;d<a.length;d+=1)a[d].checked&&c.add(a[d].__value);return t||c.delete(r),Array.from(c)}function Ta(a){var r=a.type;return r==="number"||r==="range"}function Ra(a){return a===""?null:+a}function Qs(a,r,t){var c=Rs(a,r);c&&c.set&&(a[r]=t,qa(()=>{a[r]=null}))}function Ka(a){return function(...r){var t=r[0];return t.stopPropagation(),a?.apply(this,r)}}function oa(a,r){var t=a.$$events?.[r.type],c=rs(t)?t.slice():t==null?[]:[t];for(var d of c)d.call(this,r)}const Xs="";function ps(...a){return ga+Xs+qs(a[0],a[1])}const Oa={paladin:{name:"Paladin",hitDice:"d10",spellcaster:!0,spellcastingAbility:"charisma",spellSlotsByLevel:{1:0,2:2,3:3,4:3,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Divine Sense",type:"uses",maxUses:(a,r=1)=>1+Math.max(1,r),resetOn:"long",description:"Detect celestials, fiends, and undead within 60 feet",minLevel:1},{name:"Lay on Hands",type:"pool",maxPool:a=>a*5,resetOn:"long",description:"Heal wounds or cure disease",minLevel:1},{name:"Divine Smite",type:"spellSlot",description:"Expend spell slot to deal extra radiant damage",minLevel:2,rollable:!0},{name:"Channel Divinity",type:"pool",maxPool:a=>a>=18?3:a>=6?2:1,resetOn:"short",description:"Sacred Weapon or Turn Undead",minLevel:3}]},fighter:{name:"Fighter",hitDice:"d10",spellcaster:!1,features:[{name:"Second Wind",type:"uses",maxUses:1,resetOn:"short",description:"Regain 1d10 + fighter level HP as bonus action",minLevel:1,rollable:!0,rollFormula:a=>`1d10+${a}`},{name:"Action Surge",type:"uses",maxUses:a=>a>=17?2:1,resetOn:"short",description:"Take one additional action on your turn",minLevel:2},{name:"Indomitable",type:"uses",maxUses:a=>a>=17?3:a>=13?2:1,resetOn:"long",description:"Reroll a failed saving throw",minLevel:9}],subclasses:{champion:{name:"Champion",features:[{name:"Improved Critical",type:"info",description:"Critical hit on 19-20",minLevel:3},{name:"Remarkable Athlete",type:"info",description:"Add half proficiency to STR/DEX/CON checks, increase long jump distance",minLevel:7},{name:"Additional Fighting Style",type:"info",description:"Choose a second fighting style",minLevel:10},{name:"Superior Critical",type:"info",description:"Critical hit on 18-20",minLevel:15},{name:"Survivor",type:"info",description:"Regain 5 + CON mod HP at start of turn if below half HP",minLevel:18}]},battlemaster:{name:"Battle Master",features:[{name:"Combat Superiority",type:"uses",maxUses:a=>a>=15?6:a>=7?5:4,resetOn:"short",description:a=>`Use superiority dice (${a>=18?"d12":a>=10?"d10":"d8"}) for maneuvers`,minLevel:3},{name:"Know Your Enemy",type:"info",description:"Learn capabilities of creatures you observe",minLevel:7},{name:"Improved Combat Superiority",type:"info",description:"Superiority dice become d10",minLevel:10},{name:"Relentless",type:"info",description:"Regain 1 superiority die if you have none at start of turn",minLevel:15}]}}},rogue:{name:"Rogue",hitDice:"d8",spellcaster:!1,features:[{name:"Sneak Attack",type:"info",description:a=>`Deal ${Math.ceil(a/2)}d6 extra damage once per turn with advantage or ally nearby`,minLevel:1,rollable:!0,rollFormula:a=>`${Math.ceil(a/2)}d6`},{name:"Cunning Action",type:"info",description:"Dash, Disengage, or Hide as a bonus action",minLevel:2},{name:"Uncanny Dodge",type:"info",description:"Use reaction to halve damage from an attack",minLevel:5},{name:"Evasion",type:"info",description:"Take no damage on successful Dex save (half on fail)",minLevel:7}]},wizard:{name:"Wizard",hitDice:"d6",spellcaster:!0,spellcastingAbility:"intelligence",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Arcane Recovery",type:"uses",maxUses:1,resetOn:"long",description:a=>`Recover spell slots totaling up to ${Math.ceil(a/2)} levels during short rest`,minLevel:1},{name:"Spell Mastery",type:"info",description:"Cast one 1st-level and one 2nd-level spell at will",minLevel:18}]},cleric:{name:"Cleric",hitDice:"d8",spellcaster:!0,spellcastingAbility:"wisdom",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Channel Divinity",type:"pool",maxPool:a=>a>=18?3:a>=6?2:1,resetOn:"short",description:"Turn Undead or domain-specific ability",minLevel:2},{name:"Destroy Undead",type:"info",description:a=>`Channel Divinity destroys undead of CR ${a>=17?4:a>=14?3:a>=11?2:a>=8?1:.5} or lower`,minLevel:5},{name:"Divine Intervention",type:"uses",maxUses:1,resetOn:"long",description:a=>`${a}% chance to succeed, implore deity for aid`,minLevel:10}],subclasses:{war:{name:"War Domain",features:[{name:"War Priest",type:"uses",maxUses:(a,r=1)=>Math.max(1,r),resetOn:"long",description:"Make one weapon attack as a bonus action",minLevel:1},{name:"Guided Strike",type:"channelDivinity",description:"Use your Channel Divinity to gain +10 to an attack roll. Make this choice after you see the roll, but before the DM says whether the attack hits or misses.",minLevel:2,resetOn:"short"},{name:"War God's Blessing",type:"channelDivinity",description:"Use reaction to grant +10 to an ally's attack roll within 30 feet. Consumes one use of Channel Divinity.",minLevel:6,resetOn:"short"},{name:"Divine Strike",type:"info",description:a=>`Deal extra ${a>=14?"2d8":"1d8"} weapon damage once per turn`,minLevel:8,rollable:!0,rollFormula:a=>a>=14?"2d8":"1d8"},{name:"Avatar of Battle",type:"info",description:"Gain resistance to nonmagical weapon damage",minLevel:17}]},life:{name:"Life Domain",features:[{name:"Disciple of Life",type:"info",description:"Healing spells restore additional 2 + spell level HP",minLevel:1},{name:"Preserve Life",type:"pool",maxPool:a=>a*5,resetOn:"short",description:"Restore HP to creatures within 30 feet",minLevel:2},{name:"Blessed Healer",type:"info",description:"Regain 2 + spell level HP when you cast healing spell",minLevel:6},{name:"Divine Strike",type:"info",description:a=>`Deal extra ${a>=14?"2d8":"1d8"} radiant damage once per turn`,minLevel:8,rollable:!0,rollFormula:a=>a>=14?"2d8":"1d8"},{name:"Supreme Healing",type:"info",description:"Maximize healing dice instead of rolling",minLevel:17}]}}},barbarian:{name:"Barbarian",hitDice:"d12",spellcaster:!1,features:[{name:"Rage",type:"uses",maxUses:a=>a>=20?1/0:a>=17?6:a>=12?5:a>=6?4:a>=3?3:2,resetOn:"long",description:a=>`+${a>=16?4:a>=9?3:2} damage, resistance to physical damage`,minLevel:1},{name:"Reckless Attack",type:"info",description:"Gain advantage on melee attacks, enemies get advantage on you",minLevel:2},{name:"Danger Sense",type:"info",description:"Advantage on Dex saves against effects you can see",minLevel:2}],subclasses:{berserker:{name:"Path of the Berserker",features:[{name:"Frenzy",type:"info",description:"While raging, make melee attack as bonus action (gain 1 exhaustion after rage)",minLevel:3},{name:"Mindless Rage",type:"info",description:"Cannot be charmed or frightened while raging",minLevel:6},{name:"Intimidating Presence",type:"info",description:"Use action to frighten creature within 30 feet",minLevel:10},{name:"Retaliation",type:"info",description:"When damaged by creature within 5 feet, make melee attack as reaction",minLevel:14}]}}}};function Ot(a){const r=a.toLowerCase();return Oa[r]||null}function ca(a,r,t){const c=Ot(a);if(!c)return[];const d=c.features.filter(p=>!p.minLevel||p.minLevel<=r);if(t&&c.subclasses&&c.subclasses[t]){const p=c.subclasses[t].features.filter(h=>!h.minLevel||h.minLevel<=r);return[...d,...p]}return d}function Za(a){const r=Ot(a);return!r||!r.subclasses?[]:Object.keys(r.subclasses).map(t=>({id:t,name:r.subclasses[t].name}))}function es(a,r){const t=Ot(a);return!t||!t.spellcaster||!t.spellSlotsByLevel?0:t.spellSlotsByLevel[r]||0}function ts(a,r,t){const c=Ot(a);return!c||!c.spellcaster?0:Math.max(1,t+r)}function Zs(a,r,t){const c=Ot(a);return!c||!c.spellcaster?null:8+r+t}function el(){return Object.keys(Oa).map(a=>({id:a,name:Oa[a].name}))}var tl=g('<div class="section-header svelte-ls99y2" role="button" tabindex="0"><h2 class="svelte-ls99y2"> </h2> <span class="collapse-btn svelte-ls99y2"> </span></div>');function ra(a,r){Et(r,!1);let t=kt(r,"title",8),c=kt(r,"collapsed",8),d=kt(r,"ariaLabel",8,""),p=kt(r,"onToggle",8);Pt();var h=tl(),$=i(h),x=i($,!0);l($);var y=s($,2),V=i(y,!0);l(y),l(h),B(()=>{Ve(h,"aria-expanded",!c()),Ve(h,"aria-label",d()),L(x,t()),L(V,c()?"‚ñº":"‚ñ≤")}),T("click",h,function(...U){p()?.apply(this,U)}),T("keydown",h,U=>{(U.key==="Enter"||U.key===" ")&&p()()}),v(a,h),Ht()}var al=g("<option> </option>"),sl=g("<option> </option>"),ll=g('<div class="form-group svelte-172i2fj"><label for="characterSubclass" class="svelte-172i2fj">Subclass</label> <select id="characterSubclass" class="svelte-172i2fj"><option>Select Subclass</option><!></select></div>'),il=g('<div class="info-grid svelte-172i2fj"><div class="form-group svelte-172i2fj"><label for="characterName" class="svelte-172i2fj">Character Name</label> <input type="text" id="characterName" placeholder="Enter name" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterClass" class="svelte-172i2fj">Class</label> <select id="characterClass" class="svelte-172i2fj"><option>Select Class</option><!></select></div> <!> <div class="form-group svelte-172i2fj"><label for="characterLevel" class="svelte-172i2fj">Level</label> <input type="number" id="characterLevel" min="1" max="20" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterRace" class="svelte-172i2fj">Race</label> <input type="text" id="characterRace" placeholder="e.g., Human" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterBackground" class="svelte-172i2fj">Background</label> <input type="text" id="characterBackground" placeholder="e.g., Soldier" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterAlignment" class="svelte-172i2fj">Alignment</label> <input type="text" id="characterAlignment" placeholder="e.g., Lawful Good" class="svelte-172i2fj"/></div></div>'),nl=g('<section class="character-info svelte-172i2fj"><!> <!></section>');function rl(a,r){Et(r,!1);const t=()=>tt(se,"$character",d),c=()=>tt(It,"$collapsedStates",d),[d,p]=zt(),h=w(),$=el();function x(be){const ge=be.target;se.update(G=>(G.class=ge.value,G.subclass="",G))}function y(be){const ge=be.target;se.update(G=>(G.subclass=ge.value,G))}function V(be){const ge=be.target;se.update(G=>(G.level=parseInt(ge.value)||1,G)),ds()}Qe(()=>(t(),Za),()=>{o(h,t().class?Za(t().class):[])}),Qt(),Pt();var U=nl(),re=i(U);{let be=dt(()=>(c(),n(()=>c().characterInfo?"Expand":"Collapse")));ra(re,{title:"Character Info",get collapsed(){return c(),n(()=>c().characterInfo)},get ariaLabel(){return e(be)},onToggle:()=>It.update(ge=>({...ge,characterInfo:!ge.characterInfo}))})}var Z=s(re,2);{var ee=be=>{var ge=il(),G=i(ge),je=s(i(G),2);$e(je),l(G);var Ke=s(G,2),oe=s(i(Ke),2),Me=i(oe);Me.value=Me.__value="";var Oe=s(Me);$t(Oe,1,()=>$,wt,(qe,Ce)=>{var m=al(),E=i(m,!0);l(m);var Q={};B(()=>{L(E,(e(Ce),n(()=>e(Ce).name))),Q!==(Q=(e(Ce),n(()=>e(Ce).id)))&&(m.value=(m.__value=(e(Ce),n(()=>e(Ce).id)))??"")}),v(qe,m)}),l(oe);var le;Ua(oe),l(Ke);var _e=s(Ke,2);{var Ie=qe=>{var Ce=ll(),m=s(i(Ce),2),E=i(m);E.value=E.__value="";var Q=s(E);$t(Q,1,()=>e(h),wt,(Y,ye)=>{var Ae=sl(),st=i(Ae,!0);l(Ae);var xe={};B(()=>{L(st,(e(ye),n(()=>e(ye).name))),xe!==(xe=(e(ye),n(()=>e(ye).id)))&&(Ae.value=(Ae.__value=(e(ye),n(()=>e(ye).id)))??"")}),v(Y,Ae)}),l(m);var ne;Ua(m),l(Ce),B(()=>{ne!==(ne=(t(),n(()=>t().subclass)))&&(m.value=(m.__value=(t(),n(()=>t().subclass)))??"",La(m,(t(),n(()=>t().subclass))))}),T("change",m,y),v(qe,Ce)};k(_e,qe=>{e(h),n(()=>e(h).length>0)&&qe(Ie)})}var C=s(_e,2),R=s(i(C),2);$e(R),l(C);var S=s(C,2),W=s(i(S),2);$e(W),l(S);var b=s(S,2),j=s(i(b),2);$e(j),l(b);var ae=s(b,2),Ge=s(i(ae),2);$e(Ge),l(ae),l(ge),B(()=>{le!==(le=(t(),n(()=>t().class)))&&(oe.value=(oe.__value=(t(),n(()=>t().class)))??"",La(oe,(t(),n(()=>t().class)))),ba(R,(t(),n(()=>t().level)))}),Je(je,()=>t().name,qe=>xt(se,n(t).name=qe,n(t))),T("change",oe,x),T("change",R,V),Je(W,()=>t().race,qe=>xt(se,n(t).race=qe,n(t))),Je(j,()=>t().background,qe=>xt(se,n(t).background=qe,n(t))),Je(Ge,()=>t().alignment,qe=>xt(se,n(t).alignment=qe,n(t))),v(be,ge)};k(Z,be=>{c(),n(()=>!c().characterInfo)&&be(ee)})}l(U),v(a,U),Ht(),p()}var ol=g('<div class="ability-card svelte-bbv1xt"><h3 class="svelte-bbv1xt"> </h3> <input type="number" class="ability-score svelte-bbv1xt" min="1" max="30"/> <div class="ability-modifier svelte-bbv1xt"> </div> <div class="roll-buttons svelte-bbv1xt"><button class="roll-btn svelte-bbv1xt">Check</button> <button class="roll-btn svelte-bbv1xt">Save</button></div> <div class="save-proficiency svelte-bbv1xt"><input type="checkbox" class="svelte-bbv1xt"/> <label class="svelte-bbv1xt">Save Prof.</label></div></div>'),cl=g('<div class="proficiency-bonus svelte-bbv1xt"><label for="profBonus">Proficiency Bonus</label> <input type="number" id="profBonus" class="prof-input svelte-bbv1xt"/></div> <div class="abilities-grid svelte-bbv1xt"></div>',1),vl=g("<section><!> <!></section>");function dl(a,r){Et(r,!1);const t=()=>tt(xa,"$abilityModifiers",$),c=()=>tt(se,"$character",$),d=()=>tt(aa,"$searchFilter",$),p=()=>tt(It,"$collapsedStates",$),h=()=>tt(ta,"$isEditMode",$),[$,x]=zt(),y=w(),V=w(),U=na(),re=[{key:"strength",label:"Strength"},{key:"dexterity",label:"Dexterity"},{key:"constitution",label:"Constitution"},{key:"intelligence",label:"Intelligence"},{key:"wisdom",label:"Wisdom"},{key:"charisma",label:"Charisma"}];function Z(){ds()}function ee(Me){const Oe=t()[Me],le=`1d20${Oe>=0?"+":""}${Oe}`,_e=[];_e.push({value:"1d20",source:"base die"}),Oe!==0&&_e.push({value:Oe,source:Me}),U("roll",{notation:le,rollType:"check",bonusBreakdown:_e})}function be(Me){const Oe=t()[Me],le=c().saveProficiencies[Me]?c().proficiencyBonus:0,_e=Oe+le,Ie=`1d20${_e>=0?"+":""}${_e}`,C=[];C.push({value:"1d20",source:"base die"}),Oe!==0&&C.push({value:Oe,source:Me}),le!==0&&C.push({value:le,source:"proficiency"}),U("roll",{notation:Ie,rollType:"save",bonusBreakdown:C})}Qe(()=>d(),()=>{o(y,re.filter(({label:Me})=>d()?Me.toLowerCase().includes(d().toLowerCase()):!0))}),Qe(()=>(e(y),d()),()=>{o(V,e(y).length>0||!d()||d().toLowerCase().includes("proficiency"))}),Qt(),Pt();var ge=vl();let G;var je=i(ge);ra(je,{title:"Ability Scores",get collapsed(){return p(),n(()=>p().abilityScores)},ariaLabel:"Toggle Ability Scores Section",onToggle:()=>It.update(Me=>({...Me,abilityScores:!Me.abilityScores}))});var Ke=s(je,2);{var oe=Me=>{var Oe=cl(),le=Ue(Oe),_e=s(i(le),2);$e(_e),l(le);var Ie=s(le,2);$t(Ie,5,()=>e(y),wt,(C,R)=>{let S=()=>e(R).key,W=()=>e(R).label;var b=ol(),j=i(b),ae=i(j,!0);l(j);var Ge=s(j,2);$e(Ge);var qe=s(Ge,2),Ce=i(qe);l(qe);var m=s(qe,2),E=i(m),Q=s(E,2);l(m);var ne=s(m,2),Y=i(ne);$e(Y);var ye=s(Y,2);l(ne),l(b),B(Ae=>{L(ae,Ae),L(Ce,`${t(),S(),n(()=>t()[S()]>=0?"+":"")??""}${t(),S(),n(()=>t()[S()])??""}`),Y.disabled=!h(),Ve(Y,"id",`${S()}-save`),Ve(ye,"for",`${S()}-save`)},[()=>(W(),n(()=>W().substring(0,3).toUpperCase()))]),Je(Ge,()=>c().abilities[S()],Ae=>xt(se,n(c).abilities[S()]=Ae,n(c))),T("change",Ge,Z),T("click",E,()=>ee(S())),T("click",Q,()=>be(S())),_a(Y,()=>c().saveProficiencies[S()],Ae=>xt(se,n(c).saveProficiencies[S()]=Ae,n(c))),v(C,b)}),l(Ie),Je(_e,()=>c().proficiencyBonus,C=>xt(se,n(c).proficiencyBonus=C,n(c))),v(Me,Oe)};k(Ke,Me=>{p(),n(()=>!p().abilityScores)&&Me(oe)})}l(ge),B(()=>G=St(ge,1,"ability-scores svelte-bbv1xt",null,G,{hidden:!e(V)})),v(a,ge),Ht(),x()}const fs=[{name:"Unarmored",type:"none",baseAC:10},{name:"Padded",type:"light",baseAC:11},{name:"Leather",type:"light",baseAC:11},{name:"Studded Leather",type:"light",baseAC:12},{name:"Hide",type:"medium",baseAC:12,maxDexBonus:2},{name:"Chain Shirt",type:"medium",baseAC:13,maxDexBonus:2},{name:"Scale Mail",type:"medium",baseAC:14,maxDexBonus:2},{name:"Breastplate",type:"medium",baseAC:14,maxDexBonus:2},{name:"Half Plate",type:"medium",baseAC:15,maxDexBonus:2},{name:"Ring Mail",type:"heavy",baseAC:14,maxDexBonus:0},{name:"Chain Mail",type:"heavy",baseAC:16,maxDexBonus:0},{name:"Splint",type:"heavy",baseAC:17,maxDexBonus:0},{name:"Plate",type:"heavy",baseAC:18,maxDexBonus:0}];function gs(a){return fs.find(r=>r.name===a)}function ul(a,r,t){if(!a)return 10+r+(t?2:0);const c=gs(a);if(!c)return 10+r+(t?2:0);let d=c.baseAC;return c.maxDexBonus===void 0?d+=r:c.maxDexBonus>0&&(d+=Math.min(r,c.maxDexBonus)),t&&(d+=2),d}function Sa(a){return Math.floor((a-10)/2)}function Ga(a,r){if(!a.class)return null;const t=Ot(a.class);if(!t||!t.spellcaster||!t.spellcastingAbility)return null;const c=Sa(r[t.spellcastingAbility]);return 8+a.proficiencyBonus+c}function as(a,r){if(!a.class)return 0;const t=Ot(a.class);return!t||!t.spellcaster||!t.spellcastingAbility?0:Sa(r[t.spellcastingAbility])}function pl(a,r){const t=[],c=Sa(r.dexterity),d=a.armorName?gs(a.armorName):void 0;if(d){if(d.type==="none")t.push("Unarmored"),t.push("Base: 10"),t.push(`Dexterity: ${c>=0?"+":""}${c}`);else if(d.type==="light")t.push(`${d.name}: ${d.baseAC}`),t.push(`Dexterity: ${c>=0?"+":""}${c}`);else if(d.type==="medium"){const p=Math.min(2,c);t.push(`${d.name}: ${d.baseAC}`),t.push(`Dexterity: ${p>=0?"+":""}${p} (max +2)`)}else d.type==="heavy"&&(t.push(`${d.name}: ${d.baseAC}`),t.push("Dexterity: +0 (heavy armor)"));a.shieldEquipped&&t.push("Shield: +2")}else{t.push("Base: 10"),c!==0&&t.push(`Dexterity: ${c>=0?"+":""}${c}`);const p=10+c,h=a.armorClass-p;h!==0&&t.push(`Other: ${h>=0?"+":""}${h}`)}return a.activeStates&&a.activeStates.length>0&&a.activeStates.forEach(p=>{typeof p.acBonus=="number"&&p.acBonus!==0&&(!p.target||p.target==="self")&&t.push(`${p.name}: ${p.acBonus>=0?"+":""}${p.acBonus}`)}),t.join(`
`)}function fl(a,r){const t=[],c=Sa(r.dexterity);t.push(`Dexterity: ${c>=0?"+":""}${c}`);const d=a.initiative-c;return d!==0&&t.push(`Other Bonuses: ${d>=0?"+":""}${d}`),t.join(`
`)}function gl(a,r){if(!a.class)return"";const t=Ot(a.class);if(!t||!t.spellcaster||!t.spellcastingAbility)return"";const c=[],d=Sa(r[t.spellcastingAbility]),p=t.spellcastingAbility.charAt(0).toUpperCase()+t.spellcastingAbility.slice(1);return c.push("Base: 8"),c.push(`Proficiency: +${a.proficiencyBonus}`),c.push(`${p}: ${d>=0?"+":""}${d}`),c.join(`
`)}var ml=g('<button class="info-icon svelte-1o8ci7b" type="button">‚ÑπÔ∏è</button>'),hl=g('<button class="info-icon svelte-1o8ci7b" type="button">‚ÑπÔ∏è</button>'),bl=g("<div><!></div>"),_l=g('<div class="tooltip-wrapper svelte-1o8ci7b"><!> <!></div>');function Ia(a,r){Et(r,!1);let t=kt(r,"tooltipContent",8),c=kt(r,"ariaLabel",8,"Show information"),d=w(!1),p=w(),h=w(!1),$=w(null),x=w(!1),y=w(!1),V=w("");const U=Math.random().toString(36).slice(2);function re(){window.dispatchEvent(new CustomEvent("tooltip-open",{detail:U}))}function Z(C){C.detail!==U&&(o(d,!1),o(x,!1))}function ee(){o(h,window.matchMedia("(pointer: coarse)").matches||"ontouchstart"in window)}function be(){if(!e($)||!e(p))return;const C=e(p).getBoundingClientRect(),R=e($).getBoundingClientRect();let S=C.bottom+5,W=C.left;o(x,!1),W+R.width>window.innerWidth-8&&(W=C.right-R.width,o(x,!0),W<8&&(W=8)),W<8&&(W=8),S+R.height>window.innerHeight-8&&(S=C.top-R.height-5),o(V,`position:fixed;top:${S}px;left:${W}px;z-index:1000;`),o(y,!0)}function ge(){re(),o(d,!1),o(y,!1),requestAnimationFrame(()=>{o(d,!0),o(y,!1),setTimeout(be,0)})}function G(){o(d,!1),o(x,!1)}function je(C){C.stopPropagation(),e(d)?(o(d,!1),o(x,!1),o(y,!1)):(re(),o(d,!1),o(y,!1),requestAnimationFrame(()=>{o(d,!0),o(y,!1),setTimeout(be,0)}))}function Ke(C){e(p)&&!e(p).contains(C.target)&&(o(d,!1),o(x,!1))}va(()=>{ee(),document.addEventListener("click",Ke),window.addEventListener("tooltip-open",Z)}),_s(()=>{document.removeEventListener("click",Ke),window.removeEventListener("tooltip-open",Z)}),Pt();var oe=_l(),Me=i(oe);{var Oe=C=>{var R=ml();B(()=>Ve(R,"aria-label",c())),T("click",R,je),v(C,R)},le=C=>{var R=hl();B(()=>Ve(R,"aria-label",c())),T("mouseenter",R,ge),T("mouseleave",R,G),v(C,R)};k(Me,C=>{e(h)?C(Oe):C(le,!1)})}var _e=s(Me,2);{var Ie=C=>{var R=bl(),S=i(R);zs(S,r,"content",{},W=>{var b=ot(),j=Ue(b);Ws(j,t),v(W,b)}),l(R),ya(R,W=>o($,W),()=>e($)),B(()=>{St(R,1,`tooltip-popup ${e(x)?"right-align":""}`,"svelte-1o8ci7b"),Ks(R,e(y)?e(V)+"opacity:1;pointer-events:auto;":"opacity:0;pointer-events:none;position:fixed;top:0;left:0;z-index:1000;")}),v(C,R)};k(_e,C=>{e(d)&&C(Ie)})}l(oe),ya(oe,C=>o(p,C),()=>e(p)),v(a,oe),Ht()}var yl=g("<option> </option>"),xl=g('<div class="armor-config svelte-1r5hyyb"><h4 class="svelte-1r5hyyb">Armor Configuration</h4> <div class="armor-controls svelte-1r5hyyb"><div class="armor-field svelte-1r5hyyb"><label for="armorName" class="svelte-1r5hyyb">Armor</label> <select id="armorName" class="armor-select svelte-1r5hyyb"><option>None (Unarmored)</option><!></select></div> <div class="armor-field svelte-1r5hyyb"><label class="shield-label svelte-1r5hyyb"><input type="checkbox" class="shield-checkbox svelte-1r5hyyb"/> Shield Equipped (+2 AC)</label></div></div></div>'),Sl=g('<div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="spellSaveDC" class="svelte-1r5hyyb">Spell Save DC</label> <!></div> <input type="number" id="spellSaveDC" class="stat-input svelte-1r5hyyb" readonly=""/></div>'),kl=g('<span class="hit-dice-type"> </span>'),$l=g('<!> <div class="stats-grid svelte-1r5hyyb"><div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="armorClass" class="svelte-1r5hyyb">Armor Class</label> <!></div> <input type="text" id="armorClass" readonly=""/></div> <div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="initiative" class="svelte-1r5hyyb">Initiative</label> <!></div> <input type="text" id="initiative" class="stat-input svelte-1r5hyyb" readonly=""/></div> <div class="stat-box svelte-1r5hyyb"><label for="speed" class="svelte-1r5hyyb">Speed</label> <input type="text" id="speed" class="stat-input svelte-1r5hyyb"/></div> <!></div> <div class="hp-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Points</h3> <div><div class="hp-inputs svelte-1r5hyyb"><input type="number" class="hp-current svelte-1r5hyyb" min="0"/> <span class="hp-separator svelte-1r5hyyb">/</span> <input type="number" class="hp-max svelte-1r5hyyb" min="0"/></div> <div class="hp-controls svelte-1r5hyyb"><button class="hp-btn svelte-1r5hyyb">‚àí</button> <button class="hp-btn svelte-1r5hyyb">+</button> <button class="hp-btn svelte-1r5hyyb">‚àí5</button> <button class="hp-btn svelte-1r5hyyb">+5</button></div></div> <div class="temp-hp svelte-1r5hyyb"><label for="tempHP" class="svelte-1r5hyyb">Temp HP</label> <input type="number" id="tempHP" min="0" class="svelte-1r5hyyb"/></div></div> <div class="hit-dice-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Dice</h3> <div class="hit-dice-display svelte-1r5hyyb"><input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <span>/</span> <input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <!></div> <div class="hit-dice-controls svelte-1r5hyyb"><label for="hitDiceCount" class="svelte-1r5hyyb">Roll</label> <div class="hit-dice-count-controls svelte-1r5hyyb"><button class="hit-dice-btn svelte-1r5hyyb">‚àí</button> <input type="number" id="hitDiceCount" class="hit-dice-count-input svelte-1r5hyyb" min="1"/> <button class="hit-dice-btn svelte-1r5hyyb">+</button></div> <button class="btn btn-primary roll-hit-dice use-enabled svelte-1r5hyyb">üé≤ Roll</button></div></div>',1),Cl=g("<section><!> <!></section>");function wl(a,r){Et(r,!1);const t=()=>tt(se,"$character",$),c=()=>tt(xa,"$abilityModifiers",$),d=()=>tt(aa,"$searchFilter",$),p=()=>tt(It,"$collapsedStates",$),h=()=>tt(ta,"$isEditMode",$),[$,x]=zt(),y=w(),V=w(),U=w(),re=w(),Z=w(),ee=w(),be=w(),ge=na();let G=w(1);function je(C){se.update(R=>(R.currentHP=Math.max(0,Math.min(R.maxHP,R.currentHP+C)),R))}function Ke(C){const R=e(G)+C,S=t().hitDice.current;o(G,Math.max(1,Math.min(S,R)))}function oe(C=1){if(t().hitDice.current<=0){alert("No hit dice remaining!");return}if(!t().class){alert("Please select a class first!");return}const R=Ot(t().class);if(!R){alert("Invalid class configuration!");return}const S=Math.min(C,t().hitDice.current),W=R.hitDice,b=c().constitution,j=b*S,ae=j>=0?`+${j}`:`${j}`,Ge=`${S}${W}${ae}`,qe=[];if(qe.push({value:`${S}${W}`,source:"hit dice"}),b!==0)for(let Ce=0;Ce<S;Ce++)qe.push({value:b,source:"constitution"});ge("rollHitDice",{notation:Ge,hitDie:W,count:S,bonusBreakdown:qe})}Qe(()=>(t(),c(),se),()=>{if(t().armorName!==void 0||t().shieldEquipped!==void 0){const C=c().dexterity,R=ul(t().armorName,C,t().shieldEquipped||!1);t().armorClass!==R&&se.update(S=>({...S,armorClass:R}))}}),Qe(()=>(c(),t(),se),()=>{const C=c().dexterity;t().initiative!==C&&se.update(R=>({...R,initiative:C}))}),Qe(()=>t(),()=>{o(y,Ga(t(),t().abilities))}),Qe(()=>t(),()=>{o(V,pl(t(),t().abilities))}),Qe(()=>t(),()=>{o(U,fl(t(),t().abilities))}),Qe(()=>t(),()=>{o(re,gl(t(),t().abilities))}),Qe(()=>(t(),e(G)),()=>{const C=t().hitDice.current;C>0&&e(G)>C&&o(G,C)}),Qe(()=>t(),()=>{o(Z,t().activeStates&&t().activeStates.length>0?t().activeStates.reduce((C,R)=>C+(R.acBonus||0),0):0)}),Qe(()=>t(),()=>{o(ee,t().activeStates&&t().activeStates.length>0?t().activeStates.some(C=>C.name==="Aid"&&C.target==="self"):!1)}),Qe(()=>d(),()=>{o(be,!d()||"armor class".includes(d().toLowerCase())||"initiative".includes(d().toLowerCase())||"speed".includes(d().toLowerCase())||"hit points".includes(d().toLowerCase())||"hp".includes(d().toLowerCase())||"hit dice".includes(d().toLowerCase())||"spell save".includes(d().toLowerCase())||"combat".includes(d().toLowerCase()))}),Qt(),Pt();var Me=Cl();let Oe;var le=i(Me);{let C=dt(()=>(p(),n(()=>p().combatStats?"Expand":"Collapse")));ra(le,{title:"Combat Stats",get collapsed(){return p(),n(()=>p().combatStats)},get ariaLabel(){return e(C)},onToggle:()=>It.update(R=>({...R,combatStats:!R.combatStats}))})}var _e=s(le,2);{var Ie=C=>{var R=$l(),S=Ue(R);{var W=J=>{var we=xl(),de=s(i(we),2),_=i(de),N=s(i(_),2);B(()=>{t(),Dt(()=>{})});var te=i(N);te.value=(te.__value=void 0)??"";var X=s(te);$t(X,1,()=>fs,wt,(z,fe)=>{var Le=ot(),nt=Ue(Le);{var K=ut=>{var ft=yl(),bt=i(ft);l(ft);var f={};B(()=>{L(bt,`${e(fe),n(()=>e(fe).name)??""} (AC ${e(fe),n(()=>e(fe).baseAC)??""})`),f!==(f=(e(fe),n(()=>e(fe).name)))&&(ft.value=(ft.__value=(e(fe),n(()=>e(fe).name)))??"")}),v(ut,ft)};k(nt,ut=>{e(fe),n(()=>e(fe).name!=="Unarmored")&&ut(K)})}v(z,Le)}),l(N),l(_);var ie=s(_,2),D=i(ie),H=i(D);$e(H),ia(),l(D),l(ie),l(de),l(we),ja(N,()=>t().armorName,z=>xt(se,n(t).armorName=z,n(t))),_a(H,()=>t().shieldEquipped,z=>xt(se,n(t).shieldEquipped=z,n(t))),v(J,we)};k(S,J=>{h()&&J(W)})}var b=s(S,2),j=i(b),ae=i(j),Ge=s(i(ae),2);Ia(Ge,{get tooltipContent(){return e(V)},ariaLabel:"Show AC breakdown"}),l(ae);var qe=s(ae,2);$e(qe),l(j);var Ce=s(j,2),m=i(Ce),E=s(i(m),2);Ia(E,{get tooltipContent(){return e(U)},ariaLabel:"Show Initiative breakdown"}),l(m);var Q=s(m,2);$e(Q),l(Ce);var ne=s(Ce,2),Y=s(i(ne),2);$e(Y),l(ne);var ye=s(ne,2);{var Ae=J=>{var we=Sl(),de=i(we),_=s(i(de),2);Ia(_,{get tooltipContent(){return e(re)},ariaLabel:"Show Spell Save DC breakdown"}),l(de);var N=s(de,2);$e(N),l(we),B(()=>ba(N,e(y))),v(J,we)};k(ye,J=>{e(y)!==null&&J(Ae)})}l(b);var st=s(b,2),xe=s(i(st),2);let We;var M=i(xe),A=i(M);$e(A);var ce=s(A,4);$e(ce),l(M);var Se=s(M,2),q=i(Se),u=s(q,2),ze=s(u,2),me=s(ze,2);l(Se),l(xe);var pe=s(xe,2),I=s(i(pe),2);$e(I),l(pe),l(st);var Fe=s(st,2),Te=s(i(Fe),2),Xe=i(Te);$e(Xe);var lt=s(Xe,4);$e(lt);var Re=s(lt,2);{var ke=J=>{const we=dt(()=>(P(Ot),t(),n(()=>Ot(t().class))));var de=ot(),_=Ue(de);{var N=te=>{const X=dt(()=>(c(),n(()=>c().constitution)));var ie=kl(),D=i(ie);l(ie),B(()=>L(D,`(${P(e(we)),n(()=>e(we).hitDice)??""}${(e(X)>=0?`+${e(X)}`:e(X))??""})`)),v(te,ie)};k(_,te=>{e(we)&&te(N)})}v(J,de)};k(Re,J=>{t(),n(()=>t().class)&&J(ke)})}l(Te);var Be=s(Te,2),Pe=s(i(Be),2),Ee=i(Pe),He=s(Ee,2);$e(He);var ve=s(He,2);l(Pe);var he=s(Pe,2);l(Be),l(Fe),B(()=>{ba(qe,(e(Z),t(),n(()=>e(Z)!==0?`${t().armorClass} ‚Üí ${t().armorClass+e(Z)}`:`${t().armorClass}`))),St(qe,1,Es(e(Z)!==0?"stat-input ac-enhanced":"stat-input"),"svelte-1r5hyyb"),ba(Q,(t(),n(()=>t().initiative))),We=St(xe,1,"hp-display svelte-1r5hyyb",null,We,{"aid-active":e(ee)}),Ve(A,"max",(t(),n(()=>t().maxHP))),Ve(Xe,"max",(t(),n(()=>t().hitDice.max))),Ee.disabled=e(G)<=1,Ve(He,"max",(t(),n(()=>t().hitDice.current))),ve.disabled=(e(G),t(),n(()=>e(G)>=t().hitDice.current)),he.disabled=(t(),n(()=>t().hitDice.current<=0||!t().class))}),Je(Y,()=>t().speed,J=>xt(se,n(t).speed=J,n(t))),Je(A,()=>t().currentHP,J=>xt(se,n(t).currentHP=J,n(t))),Je(ce,()=>t().maxHP,J=>xt(se,n(t).maxHP=J,n(t))),T("click",q,()=>je(-1)),T("click",u,()=>je(1)),T("click",ze,()=>je(-5)),T("click",me,()=>je(5)),Je(I,()=>t().tempHP,J=>xt(se,n(t).tempHP=J,n(t))),Je(Xe,()=>t().hitDice.current,J=>xt(se,n(t).hitDice.current=J,n(t))),Je(lt,()=>t().hitDice.max,J=>xt(se,n(t).hitDice.max=J,n(t))),T("click",Ee,()=>Ke(-1)),Je(He,()=>e(G),J=>o(G,J)),T("input",He,J=>{const we=J.target,de=parseInt(we.value);de>t().hitDice.current&&o(G,t().hitDice.current),de<1&&o(G,1)}),T("click",ve,()=>Ke(1)),T("click",he,()=>oe(e(G))),v(C,R)};k(_e,C=>{p(),n(()=>!p().combatStats)&&C(Ie)})}l(Me),B(()=>Oe=St(Me,1,"combat-stats svelte-1r5hyyb",null,Oe,{hidden:!e(be)})),v(a,Me),Ht(),x()}const $a={acrobatics:"dexterity",animalHandling:"wisdom",arcana:"intelligence",athletics:"strength",deception:"charisma",history:"intelligence",insight:"wisdom",intimidation:"charisma",investigation:"intelligence",medicine:"wisdom",nature:"intelligence",perception:"wisdom",performance:"charisma",persuasion:"charisma",religion:"intelligence",sleightOfHand:"dexterity",stealth:"dexterity",survival:"wisdom"};var Dl=g('<div class="skill-row svelte-1f1pl16"><input type="checkbox" class="svelte-1f1pl16"/> <label class="svelte-1f1pl16"> <span class="ability-tag svelte-1f1pl16"> </span></label> <span class="skill-modifier svelte-1f1pl16"> </span> <button class="roll-btn svelte-1f1pl16">Roll</button></div>'),Ll=g('<div class="skills-grid svelte-1f1pl16"></div>'),jl=g("<section><!> <!></section>");function Al(a,r){Et(r,!1);const t=()=>tt(se,"$character",$),c=()=>tt(xa,"$abilityModifiers",$),d=()=>tt(aa,"$searchFilter",$),p=()=>tt(It,"$collapsedStates",$),h=()=>tt(ta,"$isEditMode",$),[$,x]=zt(),y=w(),V=w(),U=w(),re=w(),Z=w(),ee=w(),be=na(),ge=[{key:"acrobatics",label:"Acrobatics"},{key:"animalHandling",label:"Animal Handling"},{key:"arcana",label:"Arcana"},{key:"athletics",label:"Athletics"},{key:"deception",label:"Deception"},{key:"history",label:"History"},{key:"insight",label:"Insight"},{key:"intimidation",label:"Intimidation"},{key:"investigation",label:"Investigation"},{key:"medicine",label:"Medicine"},{key:"nature",label:"Nature"},{key:"perception",label:"Perception"},{key:"performance",label:"Performance"},{key:"persuasion",label:"Persuasion"},{key:"religion",label:"Religion"},{key:"sleightOfHand",label:"Sleight of Hand"},{key:"stealth",label:"Stealth"},{key:"survival",label:"Survival"}];function G(le){const _e=$a[le],Ie=c()[_e],C=t().skillProficiencies[le]?t().proficiencyBonus:0,R=e(y)[le],S=`1d20${R>=0?"+":""}${R}`,W=[];W.push({value:"1d20",source:"base die"}),Ie!==0&&W.push({value:Ie,source:_e}),C!==0&&W.push({value:C,source:"proficiency"}),be("roll",{notation:S,rollType:"check",bonusBreakdown:W})}Qe(()=>{},()=>{o(y,{})}),Qe(()=>t(),()=>{o(V,t().skillProficiencies)}),Qe(()=>t(),()=>{o(U,t().proficiencyBonus)}),Qe(()=>c(),()=>{o(re,c())}),Qe(()=>(e(re),e(V),e(U)),()=>{for(const{key:le}of ge){const _e=$a[le],Ie=e(re)[_e],C=e(V)[le]?e(U):0;la(y,e(y)[le]=Ie+C)}}),Qe(()=>d(),()=>{o(Z,ge.filter(({label:le})=>d()?le.toLowerCase().includes(d().toLowerCase()):!0))}),Qe(()=>e(Z),()=>{o(ee,e(Z).length>0)}),Qt(),Pt();var je=jl();let Ke;var oe=i(je);{let le=dt(()=>(p(),n(()=>p().skills?"Expand":"Collapse")));ra(oe,{title:"Skills",get collapsed(){return p(),n(()=>p().skills)},get ariaLabel(){return e(le)},onToggle:()=>It.update(_e=>({..._e,skills:!_e.skills}))})}var Me=s(oe,2);{var Oe=le=>{var _e=Ll();$t(_e,5,()=>e(Z),wt,(Ie,C)=>{let R=()=>e(C).key,S=()=>e(C).label;var W=Dl(),b=i(W);$e(b);var j=s(b,2),ae=i(j),Ge=s(ae),qe=i(Ge);l(Ge),l(j);var Ce=s(j,2),m=i(Ce);l(Ce);var E=s(Ce,2);l(W),B(Q=>{us(b,(e(V),R(),n(()=>e(V)[R()]))),b.disabled=!h(),Ve(b,"id",R()),Ve(j,"for",R()),L(ae,`${S()??""} `),L(qe,`(${Q??""})`),L(m,`${e(y),R(),n(()=>e(y)[R()]>=0?"+":"")??""}${e(y),R(),n(()=>e(y)[R()])??""}`)},[()=>(P($a),R(),n(()=>$a[R()].substring(0,3).toUpperCase()))]),T("change",b,Q=>{console.log("Skill proficiency changed:",R(),Q.target.checked),se.update(ne=>({...ne,skillProficiencies:{...ne.skillProficiencies,[R()]:Q.target.checked}}))}),T("click",E,()=>G(R())),v(Ie,W)}),l(_e),v(le,_e)};k(Me,le=>{p(),n(()=>!p().skills)&&le(Oe)})}l(je),B(()=>Ke=St(je,1,"skills svelte-1f1pl16",null,Ke,{hidden:!e(ee)})),v(a,je),Ht(),x()}let Ca=null,wa=null;async function ms(){if(Ca)return Ca;try{return Ca=await(await fetch(ps("/data/spells.json"))).json(),Ca||[]}catch(a){return console.error("Failed to load spells:",a),[]}}async function Bl(){if(wa)return wa;try{return wa=await(await fetch(ps("/data/feats.json"))).json(),wa||[]}catch(a){return console.error("Failed to load feats:",a),[]}}function ss(a,r){if(!r.trim())return a;const t=r.toLowerCase();return a.filter(c=>c.name.toLowerCase().includes(t)||c.school.toLowerCase().includes(t)||c.classes.some(d=>d.toLowerCase().includes(t))||c.description.toLowerCase().includes(t))}function Ml(a,r){return r===null?a:a.filter(t=>t.level===r)}function Fl(a,r){if(!r.trim())return a;const t=r.toLowerCase();return a.filter(c=>c.name.toLowerCase().includes(t)||c.description.toLowerCase().includes(t))}function Da(a){const r=a.description,t=/\b(Strength|Dexterity|Constitution|Intelligence|Wisdom|Charisma)\s+saving\s+throw/i,c=r.match(t);if(!c)return null;const d=c[1].toLowerCase(),h=/half\s+(?:as\s+much\s+)?damage\s+on\s+a\s+successful(?:\s+save)?/i.test(r),x=/saving\s+throw\s+or\s+take.*?damage/i.test(r)&&!h;return{ability:d,halfDamageOnSave:h,noDamageOnSave:x}}function Tl(a){const r=a.description;return/(plus|add)\s+your\s+spellcasting\s+(ability\s+)?modifier/i.test(r)}function Pa(a){const r=a.description.toLowerCase();return r.includes("ranged spell attack")||r.includes("melee spell attack")}function ls(a){const r=a.description.toLowerCase();if(["Divine Favor","Bless","Aid","Command"].includes(a.name))return!0;const d=["takes","take","deals","deal","damage equal to","force damage","fire damage","cold damage","lightning damage","thunder damage","acid damage","poison damage","necrotic damage","radiant damage","psychic damage","regain","regains","hit point"].some($=>r.includes($));return["bonus to attack","bonus to damage","bonus to ac","gains a +","gain a +","+1 bonus","+2 bonus","+3 bonus","advantage on","becomes a magic weapon"].some($=>r.includes($))&&!d}function Rl(a){const r=a.description;let t=0,c=0,d=0,p="";const h=r.match(/\+(\d+)\s+bonus\s+to\s+attack\s+rolls\s+and\s+damage\s+rolls/i);if(h){const x=parseInt(h[1]);t=x,c=x,p=`+${x} to attack and damage rolls`}if(a.name==="Bless"&&(p="Add 1d4 to attack rolls and saves",t="1d4"),a.name==="Aid")return p="+5 HP (max and current) for 8 hours",{attackBonus:0,damageBonus:0,acBonus:0,hpBonus:5,description:p,name:a.name};a.name==="Divine Favor"&&(p="Your weapon attacks deal an extra 1d4 radiant damage on a hit.",c="1d4");const $=r.match(/\+(\d+)\s+bonus\s+to\s+AC/i);return $&&(d=parseInt($[1]),p=`+${d} to AC`),a.name==="Haste"&&(p="+2 AC, doubled speed, extra action",d=2),p||t!==0||c!==0||d!==0?{attackBonus:t,damageBonus:c,acBonus:d,description:p||a.description.substring(0,100),name:a.name}:null}function Ea(a){const r=a.description,t=/takes?\s+(\d+d\d+)\s+\w+\s+damage[^.]*\.\s*If\s+the\s+target\s+is\s+missing.*?instead\s+takes?\s+(\d+d\d+)/is,c=r.match(t);return c?{baseDamage:c[1],alternateDamage:c[2]}:null}var Il=g('<button class="btn btn-secondary">Add Attack</button>'),Pl=g('<input type="text" placeholder="Attack name" class="attack-name svelte-14o91c5"/>'),El=g('<h4 class="attack-name-display svelte-14o91c5"> </h4>'),Hl=g('<button class="btn-remove svelte-14o91c5">√ó</button>'),Nl=g('<div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Bonus</label> <input type="number" class="attack-bonus svelte-14o91c5"/></div>'),Ul=g('<div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Damage</label> <input type="text" placeholder="e.g., 2d6+3" class="attack-damage svelte-14o91c5"/></div>'),Ol=g('<div class="spell-info-loading svelte-14o91c5">Loading spell info...</div>'),Gl=g('<li class="svelte-14o91c5"><strong>At Higher Levels:</strong> </li>'),ql=g('<ul class="svelte-14o91c5"><li class="svelte-14o91c5"><strong>Level:</strong> </li> <li class="svelte-14o91c5"><strong>Casting Time:</strong> </li> <li class="svelte-14o91c5"><strong>Range:</strong> </li> <li class="svelte-14o91c5"><strong>Components:</strong> <!></li> <li class="svelte-14o91c5"><strong>Duration:</strong> <!> </li> <li class="svelte-14o91c5"><strong>Description:</strong> </li> <!></ul>'),Wl=g('<span class="scaled-damage svelte-14o91c5" style="margin-left: 8px;"> </span>'),zl=g('<span class="scaled-damage svelte-14o91c5">(Half damage)</span>'),Kl=g('<span class="scaled-damage svelte-14o91c5">(No damage)</span>'),Vl=g('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> <!> <!></label></div>'),Jl=g("<option> </option>"),Yl=g('<span class="scaled-damage svelte-14o91c5"><!> </span>'),Ql=g('<span class="scaled-damage svelte-14o91c5"> </span>'),Xl=g('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> Target is Fiend or Undead <!></label></div>'),Zl=g('<span class="scaled-damage svelte-14o91c5"> </span>'),ei=g('<span class="scaled-damage svelte-14o91c5"> </span>'),ti=g('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> Target is missing HP <!></label></div>'),ai=g('<div class="spell-level-selector svelte-14o91c5"><label class="svelte-14o91c5">Cast at Level:</label> <select class="spell-level-select use-enabled svelte-14o91c5"></select> <!></div> <!> <!>',1),si=g('<div class="spell-level-selector svelte-14o91c5"><span style="color: #dc3545; font-weight: bold;">No spell slots available!</span></div>'),li=g('<div class="spell-info svelte-14o91c5"><div class="spell-info-header svelte-14o91c5" role="button" tabindex="0"><h4 class="svelte-14o91c5">Spell Info</h4> <button class="collapse-btn-small svelte-14o91c5"> </button></div> <!></div> <!> <!>',1),ii=g('<div class="spell-info-missing svelte-14o91c5">Spell info not found.</div>'),ni=g('<div class="attack-notes svelte-14o91c5"><label class="svelte-14o91c5">Notes</label> <textarea placeholder="e.g., DC 15 Dex save, Range 120 ft, Concentration" class="notes-input svelte-14o91c5" rows="2"></textarea></div>'),ri=g('<button class="btn btn-primary">Roll Attack</button>'),oi=g('<div class="buff-target-selection svelte-14o91c5"><div class="target-options svelte-14o91c5"><label class="target-option svelte-14o91c5"><input type="radio" class="svelte-14o91c5"/> Self</label> <label class="target-option svelte-14o91c5"><input type="radio" class="svelte-14o91c5"/> Other</label></div> <button class="btn btn-info"> </button></div>'),ci=g('<button class="btn btn-info">Cast Spell</button>'),vi=g("<button><!></button>"),di=g('<button class="btn btn-info">Cast Spell</button>'),ui=g('<button class="btn btn-secondary">Roll Damage</button>'),pi=g('<button class="btn btn-primary">Roll Attack</button> <!>',1),fi=g('<div class="attack-card svelte-14o91c5"><div class="attack-header svelte-14o91c5"><!> <!></div> <div class="attack-details svelte-14o91c5"><!> <!> <div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Type</label> <input type="text" placeholder="e.g., slashing" class="attack-type svelte-14o91c5"/></div></div> <!> <!> <div class="attack-actions svelte-14o91c5"><!></div></div>'),gi=g('<p class="no-attacks svelte-14o91c5">No attacks added yet. Click "Add Attack" to create one.</p>'),mi=g('<p class="no-attacks svelte-14o91c5">No attacks match your search.</p>'),hi=g('<button class="btn-remove svelte-14o91c5">√ó</button>'),bi=g('<div class="state-card svelte-14o91c5"><div class="state-header svelte-14o91c5"><input type="text" placeholder="Effect name (e.g., Magic Weapon)" class="state-name svelte-14o91c5"/> <!></div> <div class="state-details svelte-14o91c5"><div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Attack Bonus</label> <input type="number" class="state-bonus svelte-14o91c5"/></div> <div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Damage Bonus</label> <input type="text" class="state-bonus svelte-14o91c5"/></div> <div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Target</label> <select class="state-bonus svelte-14o91c5"><option>Self</option><option>Other</option></select></div></div> <div class="state-description svelte-14o91c5"><label class="svelte-14o91c5">Description</label> <input type="text" placeholder="e.g., +1 to attack and damage rolls (Magic Weapon)" class="state-desc-input svelte-14o91c5"/></div></div>'),_i=g('<div class="states-list svelte-14o91c5"></div>'),yi=g('<p class="no-states svelte-14o91c5">No active effects. Add spell effects that modify your attacks.</p>'),xi=g('<!> <div class="attacks-list svelte-14o91c5"><!> <!></div> <div class="active-states-section svelte-14o91c5"><h3 class="svelte-14o91c5">Active Spell Effects</h3> <p class="section-description svelte-14o91c5">Effects that modify attack and damage rolls (e.g., Magic Weapon, Bless)</p> <button class="btn btn-secondary">Add Effect</button> <!></div>',1),Si=g("<section><!> <!></section>");function ki(a,r){Et(r,!1);const t=()=>tt(se,"$character",$),c=()=>tt(xa,"$abilityModifiers",$),d=()=>tt(aa,"$searchFilter",$),p=()=>tt(It,"$collapsedStates",$),h=()=>tt(ta,"$isEditMode",$),[$,x]=zt(),y=w(),V=w(),U=[],re=na();let Z=w({}),ee=w({});function be(m){la(Z,e(Z)[m]=!e(Z)[m]),o(Z,{...e(Z)})}function ge(m){return m.description.toLowerCase().includes("regain")&&(m.description.toLowerCase().includes("hit point")||m.description.toLowerCase().includes("hp"))}function G(m){return["Shield of Faith","Bless","Aid","Magic Weapon"].includes(m)}function je(){se.update(m=>(m.attacks=[...m.attacks,{id:crypto.randomUUID(),name:"",bonus:0,damage:"",damageType:"",notes:""}],m))}function Ke(m){se.update(E=>(E.attacks=E.attacks.filter(Q=>Q.id!==m),E))}function oe(m){let E=m.damage,Q=!1,ne=!1;if(m.spellRef){const xe=_e(m.spellRef);if(xe&&(ne=Pa(xe),xe.level>0)){const We=m.castAtLevel||xe.level;if(!Ie(We)){Wt.add(`No level ${We} spell slots available!`,"error");return}const A=Da(xe);A&&m.targetSucceededSave&&A.noDamageOnSave?E="0":(Q=A?.halfDamageOnSave&&m.targetSucceededSave||!1,E=C(m,xe))}}else if(t().activeStates&&t().activeStates.length>0){let xe=0,We=[];for(const M of t().activeStates)M.target!=="other"&&(typeof M.damageBonus=="string"?We.push(M.damageBonus):typeof M.damageBonus=="number"&&(xe+=M.damageBonus));if((xe!==0||We.length>0)&&E){const M=E.match(/(\d+d\d+)([+-]\d+)?/);if(M){const[,A,ce]=M,q=(ce?parseInt(ce):0)+xe;let u=`${A}`;q!==0&&(u+=`${q>=0?"+":""}${q}`),We.length>0&&(u+=" + "+We.join(" + ")),E=u}}}const Y=[];let ye=0;if(ne){const xe=as(t(),c()),We=t().proficiencyBonus||0;Y.push({value:We,source:"proficiency"}),Y.push({value:xe,source:"spellcasting"}),ye=We+xe}else m.bonus!==0&&Y.push({value:m.bonus,source:"base"}),ye=m.bonus;let Ae=[];if(t().activeStates)for(const xe of t().activeStates)xe.target!=="other"&&(typeof xe.attackBonus=="number"&&xe.attackBonus!==0?(Y.push({value:xe.attackBonus,source:xe.name.toLowerCase()}),ye+=xe.attackBonus):typeof xe.attackBonus=="string"&&xe.attackBonus&&(Ae.push(xe.attackBonus),Y.push({value:xe.attackBonus,source:xe.name.toLowerCase()})));let st=`1d20${ye>=0?"+":""}${ye}`;Ae.length>0&&(st+="+"+Ae.join("+")),re("roll",{notation:st,damageNotation:E,attackName:m.name,applyHalfDamage:Q,bonusBreakdown:Y,rollType:"attack"})}function Me(m){if(!m.damage){Wt.add(`${m.name}: No damage specified`,"error");return}let E=m.damage,Q=!1;const ne=[];if(m.spellRef){const Y=_e(m.spellRef);if(Y&&Y.level>0){const ye=m.castAtLevel||Y.level;if(!Ie(ye)){Wt.add(`No level ${ye} spell slots available!`,"error");return}const st=Da(Y);st&&m.targetSucceededSave&&st.noDamageOnSave?E="0":(Q=st?.halfDamageOnSave&&m.targetSucceededSave||!1,E=C(m,Y))}}else{const Y=E.match(/(\d+d\d+)([+-]\d+)?/);if(Y){const[,ye,Ae]=Y,st=Ae?parseInt(Ae):0;if(st!==0&&ne.push({value:st,source:"base"}),t().activeStates&&t().activeStates.length>0){let xe=0,We=[];for(const M of t().activeStates)M.target!=="other"&&(typeof M.damageBonus=="string"?We.push(M.damageBonus):typeof M.damageBonus=="number"&&M.damageBonus!==0&&(ne.push({value:M.damageBonus,source:M.name.toLowerCase()}),xe+=M.damageBonus));if(xe!==0||We.length>0){const M=st+xe;let A=`${ye}`;M!==0&&(A+=`${M>=0?"+":""}${M}`),We.length>0&&(A+=" + "+We.join(" + ")),E=A}}}}re("roll",{notation:E,attackName:m.name,applyHalfDamage:Q,bonusBreakdown:ne})}let Oe=w([]),le=w(!1);va(async()=>{o(Oe,await ms()),o(le,!0)});function _e(m){return e(Oe).find(E=>E.name===m)}function Ie(m){t().classFeatures.spellSlotsByLevel||xt(se,n(t).classFeatures.spellSlotsByLevel={},n(t)),t().classFeatures.spellSlotsByLevel[m]||xt(se,n(t).classFeatures.spellSlotsByLevel[m]=Array(2).fill(!1),n(t));const Q=t().classFeatures.spellSlotsByLevel[m].findIndex(ne=>!ne);return Q===-1?!1:(se.update(ne=>(ne.classFeatures.spellSlotsByLevel||(ne.classFeatures.spellSlotsByLevel={}),ne.classFeatures.spellSlotsByLevel[m]||(ne.classFeatures.spellSlotsByLevel[m]=Array(2).fill(!1)),ne.classFeatures.spellSlotsByLevel[m][Q]=!0,ne)),!0)}function C(m,E){let Q=m.damage,ne=0,Y=0;const ye=Ea(E);if(ye&&m.targetIsDamaged&&(Q=ye.alternateDamage),Tl(E)&&(Y+=as(t(),c())),t().activeStates)for(const q of t().activeStates)q.target!=="other"&&typeof q.damageBonus=="number"&&(Y+=q.damageBonus);if(E.higherLevelSlot&&m.castAtLevel){const q=E.level,ze=(m.castAtLevel||q)-q;if(ze>0){const me=E.higherLevelSlot.match(/(\d+)d(\d+)\s+for\s+each.*?level\s+above/i);if(me){const[,pe]=me;ne+=ze*parseInt(pe)}}}if(m.targetIsFiendOrUndead&&E.description.includes("Fiend or an Undead")){const q=E.description.match(/increases by (\d+)d(\d+) if.*?Fiend or.*?Undead/i);if(q){const[,u]=q;ne+=parseInt(u)}}const Ae=Q.match(/(\d+)d(\d+)([+-]\d+)?/);if(!Ae)return Y!==0?Y>=0?`${Y}`:`${Y}`:Q||"0";const[,st,xe,We]=Ae,M=parseInt(st)+ne,ce=(We?parseInt(We):0)+Y;let Se=`${M}d${xe}`;return ce!==0&&(Se+=ce>=0?`+${ce}`:`${ce}`),Se}function R(m){const E=[];for(let ne=m.level;ne<=9;ne++){const Y=t().classFeatures.spellSlotsByLevel?.[ne];Y&&Y.length>0&&E.push(ne)}return E}function S(){se.update(m=>(m.activeStates||(m.activeStates=[]),m.activeStates=[...m.activeStates,{name:"",attackBonus:0,damageBonus:0,description:"",target:"self"}],m))}function W(m){se.update(E=>{if(E.activeStates){const Q=E.activeStates[m];Q?.hpBonus&&Q.target!=="other"&&(E.maxHP-=Q.hpBonus,E.currentHP=Math.max(1,Math.min(E.currentHP-Q.hpBonus,E.maxHP))),E.activeStates=E.activeStates.filter((ne,Y)=>Y!==m)}return E})}function b(m,E="self"){const Q=_e(m.spellRef);if(!Q){Wt.add("Spell not found","error");return}const ne=m.castAtLevel||Q.level;if(ne>0&&!Ie(ne)){Wt.add(`No level ${ne} spell slots available!`,"error");return}const Y=Rl(Q);if(!Y){Wt.add(`${Q.name} cast! Check spell description for effects.`,"info");return}let ye=Y.hpBonus||0,Ae=Y.description;Q.name==="Aid"&&ne>Q.level&&(ye=5+(ne-Q.level)*5,Ae=`+${ye} HP (max and current) for 8 hours`);const xe=["Shield of Faith","Bless","Aid","Magic Weapon"].includes(Q.name);se.update(M=>{M.activeStates||(M.activeStates=[]);const A=M.activeStates.find(ce=>ce.name===Q.name);return A&&A.hpBonus&&A.target!=="other"&&(M.maxHP-=A.hpBonus,M.currentHP=Math.max(1,Math.min(M.currentHP-A.hpBonus,M.maxHP))),M.activeStates=M.activeStates.filter(ce=>ce.name!==Q.name),ye>0&&E==="self"&&(M.maxHP+=ye,M.currentHP+=ye),M.activeStates=[...M.activeStates,{name:Q.name,attackBonus:Y.attackBonus,damageBonus:Y.damageBonus,acBonus:Y.acBonus,description:Ae,target:E,hpBonus:ye}],M});const We=E==="self"?" on self":" on other";Wt.add(`${Q.name} cast${xe?We:""}! Effect added to Active Spell Effects.`,"success")}Qe(()=>(t(),e(Z),e(ee)),()=>{if(t()&&t().attacks)for(const m of t().attacks)m.spellRef&&e(Z)[m.id]===void 0&&la(Z,e(Z)[m.id]=!0),m.spellRef&&e(ee)[m.id]===void 0&&la(ee,e(ee)[m.id]="self")}),Qe(()=>(t(),d()),()=>{o(y,t().attacks.filter(m=>{if(!d())return!0;const E=d().toLowerCase();return m.name.toLowerCase().includes(E)||m.damageType.toLowerCase().includes(E)}).sort((m,E)=>!m.spellRef&&E.spellRef?-1:m.spellRef&&!E.spellRef?1:0))}),Qe(()=>(d(),e(y)),()=>{o(V,!d()||e(y).length>0||"attack".includes(d().toLowerCase())||"spell".includes(d().toLowerCase()))}),Qt(),Pt();var j=Si();let ae;var Ge=i(j);{let m=dt(()=>(p(),n(()=>p().attacks?"Expand":"Collapse")));ra(Ge,{title:"Attacks & Spells",get collapsed(){return p(),n(()=>p().attacks)},get ariaLabel(){return e(m)},onToggle:()=>It.update(E=>({...E,attacks:!E.attacks}))})}var qe=s(Ge,2);{var Ce=m=>{var E=xi(),Q=Ue(E);{var ne=q=>{var u=Il();T("click",u,je),v(q,u)};k(Q,q=>{h()&&q(ne)})}var Y=s(Q,2),ye=i(Y);$t(ye,1,()=>e(y),q=>q.id,(q,u,ze)=>{var me=fi(),pe=i(me),I=i(pe);{var Fe=D=>{var H=Pl();$e(H),Je(H,()=>e(u).name,z=>(e(u).name=z,Dt(()=>(e(y),t(),d())))),v(D,H)},Te=D=>{var H=El(),z=i(H,!0);l(H),B(()=>L(z,(e(u),n(()=>e(u).name||"(Unnamed Attack)")))),v(D,H)};k(I,D=>{h()?D(Fe):D(Te,!1)})}var Xe=s(I,2);{var lt=D=>{var H=Hl();T("click",H,()=>Ke(e(u).id)),v(D,H)};k(Xe,D=>{h()&&D(lt)})}l(pe);var Re=s(pe,2),ke=i(Re);{var Be=D=>{var H=Nl(),z=i(H),fe=s(z,2);$e(fe),l(H),B(()=>{Ve(z,"for",`attack-bonus-${e(u),n(()=>e(u).id)??""}`),Ve(fe,"id",`attack-bonus-${e(u),n(()=>e(u).id)??""}`)}),Je(fe,()=>e(u).bonus,Le=>(e(u).bonus=Le,Dt(()=>(e(y),t(),d())))),v(D,H)};k(ke,D=>{e(u),n(()=>e(u).bonus!==0&&e(u).bonus!==void 0)&&D(Be)})}var Pe=s(ke,2);{var Ee=D=>{var H=Ul(),z=i(H),fe=s(z,2);$e(fe),l(H),B(()=>{Ve(z,"for",`attack-damage-${e(u),n(()=>e(u).id)??""}`),Ve(fe,"id",`attack-damage-${e(u),n(()=>e(u).id)??""}`)}),Je(fe,()=>e(u).damage,Le=>(e(u).damage=Le,Dt(()=>(e(y),t(),d())))),v(D,H)};k(Pe,D=>{e(u),n(()=>e(u).damage&&e(u).damage.trim()!=="")&&D(Ee)})}var He=s(Pe,2),ve=i(He),he=s(ve,2);$e(he),l(He),l(Re);var J=s(Re,2);{var we=D=>{var H=ot(),z=Ue(H);{var fe=nt=>{var K=Ol();v(nt,K)},Le=nt=>{const K=dt(()=>(e(u),n(()=>_e(e(u).spellRef))));var ut=ot(),ft=Ue(ut);{var bt=O=>{const F=dt(()=>(P(Da),P(e(K)),n(()=>Da(e(K)))));var De=li(),ue=Ue(De),et=i(ue),Ne=s(i(et),2),gt=i(Ne,!0);l(Ne),l(et);var Ye=s(et,2);{var ct=Ze=>{var at=ql(),pt=i(at),At=s(i(pt));l(pt);var Gt=s(pt,2),qt=s(i(Gt));l(Gt);var Tt=s(Gt,2),Ct=s(i(Tt));l(Tt);var Mt=s(Tt,2),Nt=s(i(Mt)),_t=s(Nt);{var Bt=rt=>{var yt=Rt();B(()=>L(yt,`(${P(e(K)),n(()=>e(K).material)??""})`)),v(rt,yt)};k(_t,rt=>{P(e(K)),n(()=>e(K).material)&&rt(Bt)})}l(Mt);var Jt=s(Mt,2),Xt=s(i(Jt),2);{var Zt=rt=>{var yt=Rt("Concentration,");v(rt,yt)};k(Xt,rt=>{P(e(K)),n(()=>e(K).concentration)&&rt(Zt)})}var da=s(Xt,1,!0);l(Jt);var ua=s(Jt,2),Ma=s(i(ua));l(ua);var Lt=s(ua,2);{var Ft=rt=>{var yt=Gl(),Kt=s(i(yt));l(yt),B(()=>L(Kt,` ${P(e(K)),n(()=>e(K).higherLevelSlot)??""}`)),v(rt,yt)};k(Lt,rt=>{P(e(K)),n(()=>e(K).higherLevelSlot)&&rt(Ft)})}l(at),B(rt=>{L(At,` ${P(e(K)),n(()=>e(K).level)??""}`),L(qt,` ${P(e(K)),n(()=>e(K).castingTime||e(K).actionType)??""}`),L(Ct,` ${P(e(K)),n(()=>e(K).range)??""}`),L(Nt,` ${rt??""}`),L(da,(P(e(K)),n(()=>e(K).duration))),L(Ma,` ${P(e(K)),n(()=>e(K).description)??""}`)},[()=>(P(e(K)),n(()=>e(K).components.join(", ")))]),v(Ze,at)};k(Ye,Ze=>{e(Z),e(u),n(()=>!e(Z)[e(u).id])&&Ze(ct)})}l(ue);var it=s(ue,2);{var vt=Ze=>{var at=Vl(),pt=i(at),At=i(pt);$e(At);var Gt=s(At),qt=s(Gt);{var Tt=_t=>{var Bt=Wl(),Jt=i(Bt);l(Bt),B(Xt=>L(Jt,`(Spell Save DC: ${Xt??""})`),[()=>(P(Ga),t(),c(),n(()=>Ga(t(),c())))]),v(_t,Bt)};k(qt,_t=>{t(),n(()=>t().class)&&_t(Tt)})}var Ct=s(qt,2);{var Mt=_t=>{var Bt=zl();v(_t,Bt)},Nt=_t=>{var Bt=ot(),Jt=Ue(Bt);{var Xt=Zt=>{var da=Kl();v(Zt,da)};k(Jt,Zt=>{e(u),P(e(F)),n(()=>e(u).targetSucceededSave&&e(F).noDamageOnSave)&&Zt(Xt)},!0)}v(_t,Bt)};k(Ct,_t=>{e(u),P(e(F)),n(()=>e(u).targetSucceededSave&&e(F).halfDamageOnSave)?_t(Mt):_t(Nt,!1)})}l(pt),l(at),B(_t=>L(Gt,` Target succeeded on ${_t??""} save `),[()=>(P(e(F)),n(()=>e(F).ability.charAt(0).toUpperCase()+e(F).ability.slice(1)))]),_a(At,()=>e(u).targetSucceededSave,_t=>(e(u).targetSucceededSave=_t,Dt(()=>(e(y),t(),d())))),v(Ze,at)};k(it,Ze=>{e(F)&&Ze(vt)})}var mt=s(it,2);{var ht=Ze=>{const at=dt(()=>(P(e(K)),n(()=>R(e(K)))));var pt=ot(),At=Ue(pt);{var Gt=Tt=>{const Ct=dt(()=>(P(Ea),P(e(K)),n(()=>Ea(e(K)))));var Mt=ai(),Nt=Ue(Mt),_t=i(Nt),Bt=s(_t,2);B(()=>{e(u),Dt(()=>{e(at)})}),$t(Bt,5,()=>e(at),wt,(Lt,Ft)=>{var rt=Jl(),yt=i(rt);l(rt);var Kt={};B(()=>{L(yt,`Level ${e(Ft)??""}`),Kt!==(Kt=e(Ft))&&(rt.value=(rt.__value=e(Ft))??"")}),v(Lt,rt)}),l(Bt);var Jt=s(Bt,2);{var Xt=Lt=>{const Ft=dt(()=>(e(u),P(e(K)),n(()=>C(e(u),e(K)))));var rt=Yl(),yt=i(rt);{var Kt=jt=>{var Ut=Rt("Healing");v(jt,Ut)},pa=jt=>{var Ut=Rt("Damage");v(jt,Ut)};k(yt,jt=>{P(e(K)),n(()=>ge(e(K)))?jt(Kt):jt(pa,!1)})}var Yt=s(yt);l(rt),B(()=>L(Yt,` ${e(Ft)??""}`)),v(Lt,rt)};k(Jt,Lt=>{e(u),P(e(K)),n(()=>e(u).castAtLevel&&e(u).castAtLevel>e(K).level)&&Lt(Xt)})}l(Nt);var Zt=s(Nt,2);{var da=Lt=>{var Ft=Xl(),rt=i(Ft),yt=i(rt);$e(yt);var Kt=s(yt,2);{var pa=Yt=>{const jt=dt(()=>(e(u),P(e(K)),n(()=>C(e(u),e(K)))));var Ut=Ql(),sa=i(Ut);l(Ut),B(()=>L(sa,`(+1d8, total: ${e(jt)??""})`)),v(Yt,Ut)};k(Kt,Yt=>{e(u),n(()=>e(u).targetIsFiendOrUndead)&&Yt(pa)})}l(rt),l(Ft),_a(yt,()=>e(u).targetIsFiendOrUndead,Yt=>(e(u).targetIsFiendOrUndead=Yt,Dt(()=>(e(y),t(),d())))),v(Lt,Ft)};k(Zt,Lt=>{P(e(K)),n(()=>e(K).description.includes("Fiend or an Undead"))&&Lt(da)})}var ua=s(Zt,2);{var Ma=Lt=>{var Ft=ti(),rt=i(Ft),yt=i(rt);$e(yt);var Kt=s(yt,2);{var pa=jt=>{const Ut=dt(()=>(e(u),P(e(K)),n(()=>C(e(u),e(K)))));var sa=Zl(),hs=i(sa);l(sa),B(()=>L(hs,`(${P(e(Ct)),n(()=>e(Ct).alternateDamage)??""}, total: ${e(Ut)??""})`)),v(jt,sa)},Yt=jt=>{var Ut=ei(),sa=i(Ut);l(Ut),B(()=>L(sa,`(${P(e(Ct)),n(()=>e(Ct).baseDamage)??""})`)),v(jt,Ut)};k(Kt,jt=>{e(u),n(()=>e(u).targetIsDamaged)?jt(pa):jt(Yt,!1)})}l(rt),l(Ft),_a(yt,()=>e(u).targetIsDamaged,jt=>(e(u).targetIsDamaged=jt,Dt(()=>(e(y),t(),d())))),v(Lt,Ft)};k(ua,Lt=>{e(Ct)&&Lt(Ma)})}B(()=>{Ve(_t,"for",`castLevel-${e(u),n(()=>e(u).id)??""}`),Ve(Bt,"id",`castLevel-${e(u),n(()=>e(u).id)??""}`)}),ja(Bt,()=>e(u).castAtLevel,Lt=>(e(u).castAtLevel=Lt,Dt(()=>(e(y),t(),d())))),v(Tt,Mt)},qt=Tt=>{var Ct=si();v(Tt,Ct)};k(At,Tt=>{P(e(at)),n(()=>e(at).length>0)?Tt(Gt):Tt(qt,!1)})}v(Ze,pt)};k(mt,Ze=>{P(e(K)),n(()=>e(K).higherLevelSlot&&e(K).level>0)&&Ze(ht)})}B(()=>{Ve(Ne,"aria-label",(e(Z),e(u),n(()=>e(Z)[e(u).id]?"Expand":"Collapse"))),L(gt,(e(Z),e(u),n(()=>e(Z)[e(u).id]?"‚ñº":"‚ñ≤")))}),T("click",et,()=>be(e(u).id)),T("keydown",et,Ze=>Ze.key==="Enter"&&be(e(u).id)),v(O,De)},f=O=>{var F=ii();v(O,F)};k(ft,O=>{e(K)?O(bt):O(f,!1)})}v(nt,ut)};k(z,nt=>{e(Oe),n(()=>e(Oe).length===0)?nt(fe):nt(Le,!1)})}v(D,H)};k(J,D=>{e(u),n(()=>e(u).spellRef)&&D(we)})}var de=s(J,2);{var _=D=>{var H=ni(),z=i(H),fe=s(z,2);ma(fe),l(H),B(()=>{Ve(z,"for",`attack-notes-${e(u),n(()=>e(u).id)??""}`),Ve(fe,"id",`attack-notes-${e(u),n(()=>e(u).id)??""}`)}),Je(fe,()=>e(u).notes,Le=>(e(u).notes=Le,Dt(()=>(e(y),t(),d())))),v(D,H)};k(de,D=>{e(u),n(()=>!e(u).spellRef)&&D(_)})}var N=s(de,2),te=i(N);{var X=D=>{const H=dt(()=>(e(u),n(()=>_e(e(u).spellRef))));var z=ot(),fe=Ue(z);{var Le=nt=>{var K=ot(),ut=Ue(K);{var ft=f=>{var O=ri();T("click",O,()=>oe(e(u))),v(f,O)},bt=f=>{var O=ot(),F=Ue(O);{var De=et=>{var Ne=ot(),gt=Ue(Ne);{var Ye=it=>{var vt=oi(),mt=i(vt),ht=i(mt),Ze=i(ht);$e(Ze),Ze.value=Ze.__value="self",ia(),l(ht);var at=s(ht,2),pt=i(at);$e(pt),pt.value=pt.__value="other",ia(),l(at),l(mt);var At=s(mt,2),Gt=i(At);l(At),l(vt),B(()=>{Ve(Ze,"name",`target-${e(u),n(()=>e(u).id)??""}`),Ve(pt,"name",`target-${e(u),n(()=>e(u).id)??""}`),L(Gt,`Cast ${P(e(H)),n(()=>e(H).name)??""}`)}),Qa(U,[ze],Ze,()=>e(ee)[e(u).id],qt=>la(ee,e(ee)[e(u).id]=qt)),Qa(U,[ze],pt,()=>e(ee)[e(u).id],qt=>la(ee,e(ee)[e(u).id]=qt)),T("click",At,()=>b(e(u),e(ee)[e(u).id])),v(it,vt)},ct=it=>{var vt=ci();T("click",vt,()=>b(e(u),"self")),v(it,vt)};k(gt,it=>{P(e(H)),n(()=>G(e(H).name))?it(Ye):it(ct,!1)})}v(et,Ne)},ue=et=>{var Ne=ot(),gt=Ue(Ne);{var Ye=it=>{var vt=vi(),mt=i(vt);{var ht=at=>{var pt=Rt("Roll Healing");v(at,pt)},Ze=at=>{var pt=Rt("Roll Damage");v(at,pt)};k(mt,at=>{P(e(H)),n(()=>ge(e(H)))?at(ht):at(Ze,!1)})}l(vt),B(at=>St(vt,1,`btn ${at??""}`),[()=>(P(e(H)),n(()=>ge(e(H))?"btn-success":"btn-secondary"))]),T("click",vt,()=>Me(e(u))),v(it,vt)},ct=it=>{var vt=di();T("click",vt,()=>b(e(u),"self")),v(it,vt)};k(gt,it=>{e(u),n(()=>e(u).damage&&e(u).damage.trim()!=="")?it(Ye):it(ct,!1)})}v(et,Ne)};k(F,et=>{P(ls),P(e(H)),n(()=>ls(e(H)))?et(De):et(ue,!1)},!0)}v(f,O)};k(ut,f=>{P(Pa),P(e(H)),n(()=>Pa(e(H)))?f(ft):f(bt,!1)})}v(nt,K)};k(fe,nt=>{e(H)&&nt(Le)})}v(D,z)},ie=D=>{var H=ot(),z=Ue(H);{var fe=Le=>{var nt=pi(),K=Ue(nt),ut=s(K,2);{var ft=bt=>{var f=ui();T("click",f,()=>Me(e(u))),v(bt,f)};k(ut,bt=>{e(u),n(()=>e(u).damage&&e(u).damage.trim()!=="")&&bt(ft)})}T("click",K,()=>oe(e(u))),v(Le,nt)};k(z,Le=>{e(u),n(()=>!e(u).spellRef)&&Le(fe)},!0)}v(D,H)};k(te,D=>{e(u),e(le),n(()=>e(u).spellRef&&e(le))?D(X):D(ie,!1)})}l(N),l(me),B(()=>{Ve(ve,"for",`attack-type-${e(u),n(()=>e(u).id)??""}`),Ve(he,"id",`attack-type-${e(u),n(()=>e(u).id)??""}`)}),Je(he,()=>e(u).damageType,D=>(e(u).damageType=D,Dt(()=>(e(y),t(),d())))),v(q,me)});var Ae=s(ye,2);{var st=q=>{var u=gi();v(q,u)},xe=q=>{var u=ot(),ze=Ue(u);{var me=pe=>{var I=mi();v(pe,I)};k(ze,pe=>{e(y),n(()=>e(y).length===0)&&pe(me)},!0)}v(q,u)};k(Ae,q=>{t(),n(()=>t().attacks.length===0)?q(st):q(xe,!1)})}l(Y);var We=s(Y,2),M=s(i(We),4),A=s(M,2);{var ce=q=>{var u=_i();$t(u,5,()=>(t(),n(()=>t().activeStates)),wt,(ze,me,pe)=>{var I=bi(),Fe=i(I),Te=i(Fe);$e(Te);var Xe=s(Te,2);{var lt=ie=>{var D=hi();T("click",D,()=>W(pe)),v(ie,D)};k(Xe,ie=>{h()&&ie(lt)})}l(Fe);var Re=s(Fe,2),ke=i(Re),Be=i(ke);Ve(Be,"for",`state-attack-bonus-${pe}`);var Pe=s(Be,2);$e(Pe),Ve(Pe,"id",`state-attack-bonus-${pe}`),l(ke);var Ee=s(ke,2),He=i(Ee);Ve(He,"for",`state-damage-bonus-${pe}`);var ve=s(He,2);$e(ve),Ve(ve,"id",`state-damage-bonus-${pe}`),l(Ee);var he=s(Ee,2),J=i(he);Ve(J,"for",`state-target-${pe}`);var we=s(J,2);B(()=>{e(me),Dt(()=>{})}),Ve(we,"id",`state-target-${pe}`);var de=i(we);de.value=de.__value="self";var _=s(de);_.value=_.__value="other",l(we),l(he),l(Re);var N=s(Re,2),te=i(N);Ve(te,"for",`state-desc-${pe}`);var X=s(te,2);$e(X),Ve(X,"id",`state-desc-${pe}`),l(N),l(I),Je(Te,()=>e(me).name,ie=>(e(me).name=ie,Dt(()=>t()),fa($,"$character"))),Je(Pe,()=>e(me).attackBonus,ie=>(e(me).attackBonus=ie,Dt(()=>t()),fa($,"$character"))),Je(ve,()=>e(me).damageBonus,ie=>(e(me).damageBonus=ie,Dt(()=>t()),fa($,"$character"))),ja(we,()=>e(me).target,ie=>(e(me).target=ie,Dt(()=>t()),fa($,"$character"))),Je(X,()=>e(me).description,ie=>(e(me).description=ie,Dt(()=>t()),fa($,"$character"))),v(ze,I)}),l(u),v(q,u)},Se=q=>{var u=yi();v(q,u)};k(A,q=>{t(),n(()=>t().activeStates&&t().activeStates.length>0)?q(ce):q(Se,!1)})}l(We),T("click",M,S),v(m,E)};k(qe,m=>{p(),n(()=>!p().attacks)&&m(Ce)})}l(j),B(()=>ae=St(j,1,"attacks svelte-14o91c5",null,ae,{hidden:!e(V)})),v(a,j),Ht(),x()}var $i=g('<span class="slot-checkbox-x svelte-serp1j">&#8212;</span>'),Ci=g('<label><input type="checkbox" class="slot-checkbox-input svelte-serp1j"/> <span><!></span></label>');function is(a,r){Et(r,!1);const t=()=>tt(ta,"$isEditMode",c),[c,d]=zt();let p=kt(r,"checked",8,!1),h=kt(r,"disabled",8,!1),$=kt(r,"className",8,""),x=kt(r,"index",8,void 0),y=kt(r,"ariaLabel",8,void 0);const V=na();function U(G){V("change",{checked:G.currentTarget.checked,index:x()})}Pt();var re=Ci(),Z=i(re);$e(Z);var ee=s(Z,2),be=i(ee);{var ge=G=>{var je=$i();v(G,je)};k(be,G=>{p()&&G(ge)})}l(ee),l(re),B(()=>{St(re,1,"slot-checkbox-label "+$()+(t()?"":" not-editable"),"svelte-serp1j"),us(Z,p()),Z.disabled=h()||!t(),Ve(Z,"aria-label",y()),Ve(Z,"tabindex",t()?0:-1),St(ee,1,`slot-checkbox-custom ${p()?"used":""} ${t()?"":"readonly"}`,"svelte-serp1j")}),T("change",Z,U),v(a,re),Ht(),d()}var wi=g('<p class="no-features svelte-1kpvv0n">Select a class to see available features</p>'),Di=g('<p class="no-features svelte-1kpvv0n">No class features available at this level</p>'),Li=g('<div class="spell-slots svelte-1kpvv0n"><label class="svelte-1kpvv0n"> </label> <div class="slots-tracker svelte-1kpvv0n"></div></div>'),ji=g('<div class="all-spell-slots"></div>'),Ai=g('<div class="feature-box spellcasting svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"> </h3> <div class="spell-stats svelte-1kpvv0n"><div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Spell Save DC</label> <div class="spell-value svelte-1kpvv0n"> </div></div> <div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <div class="spell-value svelte-1kpvv0n"> </div></div></div> <!> <div class="prepared-spells svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <textarea placeholder="List your prepared spells..." class="svelte-1kpvv0n"></textarea></div></div>'),Bi=g('<p class="unlimited svelte-1kpvv0n">Unlimited Uses</p>'),Mi=g('<div class="slots-tracker svelte-1kpvv0n"></div> <div class="uses-actions-row"><button class="btn btn-primary use-enabled"> </button></div> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div>',1),Fi=g('<div class="uses-tracker svelte-1kpvv0n"><!></div>'),Ti=g('<div class="pool-tracker svelte-1kpvv0n"><input type="number" min="0" class="pool-input svelte-1kpvv0n"/> <span> </span> <button class="btn-small svelte-1kpvv0n"> </button></div>'),Ri=g('<p class="no-uses svelte-1kpvv0n">No Channel Divinity uses remaining</p>'),Ii=g('<div class="channel-divinity-option svelte-1kpvv0n"><button class="btn btn-primary use-enabled svelte-1kpvv0n">Use Channel Divinity</button> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div> <!></div>'),Pi=g('<div class="feature-box svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"><!> </h3> <p class="feature-description svelte-1kpvv0n"> </p> <!></div>'),Ei=g('<div class="features-grid svelte-1kpvv0n"><!> <!></div>'),Hi=g("<section><!> <!></section>");function Ni(a,r){Et(r,!1);const t=()=>tt(se,"$character",h),c=()=>tt(xa,"$abilityModifiers",h),d=()=>tt(aa,"$searchFilter",h),p=()=>tt(It,"$collapsedStates",h),[h,$]=zt(),x=w(),y=w(),V=w(),U=w(),re=w(),Z=w(),ee=w();let be=w(0),ge=w(0);function G(b,j){se.update(ae=>(ae.classFeatures.features[b]=j,ae))}function je(){se.update(b=>(b.classFeatures.spellSlotsByLevel||(b.classFeatures.spellSlotsByLevel={}),e(U).forEach(({level:j,slots:ae})=>{b.classFeatures.spellSlotsByLevel[j]||(b.classFeatures.spellSlotsByLevel[j]=Array(ae).fill(!1))}),b))}function Ke(b){if(typeof b.maxUses=="function"){if((b.name==="Divine Sense"||b.name==="War Priest")&&e(x)?.spellcastingAbility){const j=c()[e(x).spellcastingAbility];return b.maxUses(t().level,j)}return b.maxUses(t().level)}return b.maxUses||0}function oe(b,j){se.update(ae=>((!ae.classFeatures.features[b]||!Array.isArray(ae.classFeatures.features[b])||ae.classFeatures.features[b].length!==j)&&(ae.classFeatures.features[b]=Array(j).fill(!1)),ae))}ys(()=>{e(Z)&&t()&&t().classFeatures&&t().classFeatures.features&&e(Z).forEach(b=>{if(b.type==="uses"){const j=b.name.replace(/\s+/g,""),ae=Ke(b),Ge=t().classFeatures.features[j];(!Array.isArray(Ge)||Ge.length!==ae)&&oe(j,ae)}})});function Me(b){return typeof b.maxPool=="function"?b.maxPool(t().level):b.maxPool||0}function Oe(b){return typeof b.description=="function"?b.description(t().level):b.description}function le(){const b="ChannelDivinity";se.update(j=>{const ae=j.classFeatures.features[b];return typeof ae=="number"&&ae>0&&(j.classFeatures.features[b]=ae-1),j})}function _e(){It.update(b=>({...b,classFeatures:!b.classFeatures}))}Qe(()=>(t(),Ot),()=>{o(x,t().class?Ot(t().class):null)}),Qe(()=>(t(),ca),()=>{o(y,t().class?ca(t().class,t().level,t().subclass):[])}),Qe(()=>(t(),es),()=>{o(V,t().class?es(t().class,t().level):0)}),Qe(()=>(e(x),t()),()=>{o(U,(()=>{if(!e(x)?.spellcaster)return[];const b=t().level,j=[];return b>=1&&j.push({level:1,slots:Math.min(4,2+Math.floor(b/3))}),b>=3&&j.push({level:2,slots:Math.min(3,2+Math.floor((b-3)/4))}),b>=5&&j.push({level:3,slots:Math.min(3,2+Math.floor((b-5)/5))}),b>=7&&j.push({level:4,slots:Math.min(3,1+Math.floor((b-7)/6))}),b>=9&&j.push({level:5,slots:Math.min(2,1+Math.floor((b-9)/8))}),b>=11&&j.push({level:6,slots:1}),b>=13&&j.push({level:7,slots:1}),b>=15&&j.push({level:8,slots:1}),b>=17&&j.push({level:9,slots:1}),j})())}),Qe(()=>(e(x),c(),t(),ts),()=>{if(e(x)?.spellcaster&&e(x).spellcastingAbility){const b=c()[e(x).spellcastingAbility];o(be,Zs(t().class,b,t().proficiencyBonus)||0),o(ge,ts(t().class,t().level,b))}}),Qe(()=>(t(),e(x),e(U)),()=>{t().class&&e(x)?.spellcaster&&e(U).length>0&&je()}),Qe(()=>t(),()=>{o(re,(()=>{const j=t().classFeatures.features["ChannelDivinity"];return typeof j=="number"?j:0})())}),Qe(()=>(e(y),d()),()=>{o(Z,e(y).filter(b=>{if(!d())return!0;const j=d().toLowerCase();return b.name.toLowerCase().includes(j)||Oe(b).toLowerCase().includes(j)}))}),Qe(()=>(d(),t(),e(Z)),()=>{o(ee,!d()||t().class||"class features".includes(d().toLowerCase())||"spellcasting".includes(d().toLowerCase())||e(Z).length>0)}),Qt(),Pt();var Ie=Hi();let C;var R=i(Ie);{let b=dt(()=>(p(),n(()=>p().classFeatures?"Expand":"Collapse")));ra(R,{title:"Class Features",get collapsed(){return p(),n(()=>p().classFeatures)},get ariaLabel(){return e(b)},onToggle:_e})}var S=s(R,2);{var W=b=>{var j=ot(),ae=Ue(j);{var Ge=Ce=>{var m=wi();v(Ce,m)},qe=Ce=>{var m=ot(),E=Ue(m);{var Q=Y=>{var ye=Di();v(Y,ye)},ne=Y=>{var ye=Ei(),Ae=i(ye);{var st=We=>{var M=Ai(),A=i(M),ce=i(A);l(A);var Se=s(A,2),q=i(Se),u=s(i(q),2),ze=i(u,!0);l(u),l(q);var me=s(q,2),pe=s(i(me),2),I=i(pe,!0);l(pe),l(me),l(Se);var Fe=s(Se,2);{var Te=Re=>{var ke=ji();$t(ke,5,()=>e(U),wt,(Be,Pe)=>{let Ee=()=>e(Pe).level,He=()=>e(Pe).slots;const ve=dt(()=>(t(),Ee(),He(),n(()=>t().classFeatures.spellSlotsByLevel?.[Ee()]||Array(He()).fill(!1))));var he=Li(),J=i(he),we=i(J);l(J);var de=s(J,2);$t(de,5,()=>e(ve),wt,(_,N,te)=>{{let X=dt(()=>(P(e(ve)),n(()=>e(ve)[te]||!1)));is(_,{get checked(){return e(X)},$$events:{change:ie=>{se.update(D=>(D.classFeatures.spellSlotsByLevel||(D.classFeatures.spellSlotsByLevel={}),D.classFeatures.spellSlotsByLevel[Ee()]||(D.classFeatures.spellSlotsByLevel[Ee()]=Array(He()).fill(!1)),D.classFeatures.spellSlotsByLevel[Ee()][te]=ie.detail.checked,D))}}})}}),l(de),l(he),B(()=>L(we,`${Ee()===1?"1st":Ee()===2?"2nd":Ee()===3?"3rd":`${Ee()}th`} Level Spell Slots`)),v(Be,he)}),l(ke),v(Re,ke)};k(Fe,Re=>{e(U),n(()=>e(U).length>0)&&Re(Te)})}var Xe=s(Fe,2),lt=s(i(Xe),2);ma(lt),l(Xe),l(M),B(Re=>{L(ce,`Spellcasting (${Re??""})`),L(ze,e(be)),L(I,e(ge))},[()=>(e(x),n(()=>e(x).spellcastingAbility?.toUpperCase()))]),Je(lt,()=>t().classFeatures.preparedSpells,Re=>xt(se,n(t).classFeatures.preparedSpells=Re,n(t))),v(We,M)};k(Ae,We=>{e(x),n(()=>e(x)?.spellcaster)&&We(st)})}var xe=s(Ae,2);$t(xe,1,()=>e(Z),wt,(We,M)=>{const A=dt(()=>(e(M),n(()=>e(M).name.replace(/\s+/g,"")))),ce=dt(()=>(t(),P(e(A)),n(()=>t().classFeatures.features[e(A)]))),Se=dt(()=>typeof e(ce)=="number");var q=Pi(),u=i(q),ze=i(u);{var me=Re=>{var ke=Rt("Channel Divinity:");v(Re,ke)};k(ze,Re=>{e(M),n(()=>e(M).type==="channelDivinity")&&Re(me)})}var pe=s(ze);l(u);var I=s(u,2),Fe=i(I,!0);l(I);var Te=s(I,2);{var Xe=Re=>{const ke=dt(()=>(e(M),n(()=>Ke(e(M))))),Be=dt(()=>(P(e(ce)),P(e(ke)),n(()=>Array.isArray(e(ce))?e(ce):Array(e(ke)).fill(!1))));var Pe=Fi(),Ee=i(Pe);{var He=he=>{var J=Bi();v(he,J)},ve=he=>{var J=Mi(),we=Ue(J);$t(we,5,()=>e(Be),wt,(D,H,z)=>{is(D,{get checked(){return e(H)},index:z,$$events:{change:fe=>{se.update(Le=>(Le.classFeatures.features[e(A)]||(Le.classFeatures.features[e(A)]=Array(e(ke)).fill(!1)),Le.classFeatures.features[e(A)][z]=fe.detail.checked,Le))}}})}),l(we);var de=s(we,2),_=i(de),N=i(_);l(_),l(de);var te=s(de,2),X=i(te),ie=i(X);l(X),l(te),B(D=>{_.disabled=D,L(N,`Use ${e(M),n(()=>e(M).name)??""}`),L(ie,`Resets on ${e(M),n(()=>e(M).resetOn==="short"?"Short Rest":"Long Rest")??""}`)},[()=>(P(e(Be)),n(()=>e(Be).filter(D=>!D).length<=0))]),T("click",_,()=>{se.update(D=>{D.classFeatures.features[e(A)]||(D.classFeatures.features[e(A)]=Array(e(ke)).fill(!1));const H=D.classFeatures.features[e(A)],z=H.findIndex(fe=>!fe);return z!==-1&&(H[z]=!0),D})}),v(he,J)};k(Ee,he=>{e(ke)===1/0?he(He):he(ve,!1)})}l(Pe),v(Re,Pe)},lt=Re=>{var ke=ot(),Be=Ue(ke);{var Pe=He=>{const ve=dt(()=>(e(M),n(()=>Me(e(M)))));var he=Ti(),J=i(he);$e(J);var we=s(J,2),de=i(we);l(we);var _=s(we,2),N=i(_,!0);l(_),l(he),B(()=>{ba(J,e(Se)&&e(ce)!==void 0?e(ce):e(ve)),Ve(J,"max",e(ve)),L(de,`/ ${e(ve)??""}`),L(N,(e(M),n(()=>e(M).resetOn==="short"?"Short Rest":"Long Rest")))}),T("input",J,te=>{se.update(X=>(X.classFeatures.features[e(A)]=parseInt(te.currentTarget.value)||0,X))}),T("click",_,()=>G(e(A),e(ve))),v(He,he)},Ee=He=>{var ve=ot(),he=Ue(ve);{var J=we=>{var de=Ii(),_=i(de),N=s(_,2),te=i(N),X=i(te);l(te),l(N);var ie=s(N,2);{var D=H=>{var z=Ri();v(H,z)};k(ie,H=>{e(re)<=0&&H(D)})}l(de),B(()=>{_.disabled=e(re)<=0,L(X,`Resets on ${e(M),n(()=>e(M).resetOn==="short"?"Short Rest":"Long Rest")??""}`)}),T("click",_,le),v(we,de)};k(he,we=>{e(M),n(()=>e(M).type==="channelDivinity")&&we(J)},!0)}v(He,ve)};k(Be,He=>{e(M),n(()=>e(M).type==="pool")?He(Pe):He(Ee,!1)},!0)}v(Re,ke)};k(Te,Re=>{e(M),n(()=>e(M).type==="uses")?Re(Xe):Re(lt,!1)})}l(q),B(Re=>{L(pe,` ${e(M),n(()=>e(M).name)??""}`),L(Fe,Re)},[()=>(e(M),n(()=>Oe(e(M))))]),v(We,q)}),l(ye),v(Y,ye)};k(E,Y=>{e(y),n(()=>e(y).length===0)?Y(Q):Y(ne,!1)},!0)}v(Ce,m)};k(ae,Ce=>{t(),n(()=>!t().class)?Ce(Ge):Ce(qe,!1)})}v(b,j)};k(S,b=>{p(),n(()=>!p().classFeatures)&&b(W)})}l(Ie),B(()=>C=St(Ie,1,"class-features svelte-1kpvv0n",null,C,{hidden:!e(ee)})),v(a,Ie),Ht(),$()}var Ui=g('<textarea placeholder="Enter features, traits, and special abilities..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Equipment</h3> <textarea placeholder="List your equipment and inventory..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Notes</h3> <textarea placeholder="Additional notes..." class="svelte-wttn0l"></textarea>',1),Oi=g("<section><!> <!></section>");function Gi(a,r){Et(r,!1);const t=()=>tt(aa,"$searchFilter",p),c=()=>tt(se,"$character",p),d=()=>tt(It,"$collapsedStates",p),[p,h]=zt(),$=w();function x(){It.update(ee=>({...ee,notes:!ee.notes}))}Qe(()=>(t(),c()),()=>{o($,!t()||"features".includes(t().toLowerCase())||"traits".includes(t().toLowerCase())||"equipment".includes(t().toLowerCase())||"notes".includes(t().toLowerCase())||c().features.toLowerCase().includes(t().toLowerCase())||c().equipment.toLowerCase().includes(t().toLowerCase())||c().notes.toLowerCase().includes(t().toLowerCase()))}),Qt(),Pt();var y=Oi();let V;var U=i(y);{let ee=dt(()=>(d(),n(()=>d().notes?"Expand":"Collapse")));ra(U,{title:"Features & Traits",get collapsed(){return d(),n(()=>d().notes)},get ariaLabel(){return e(ee)},onToggle:x})}var re=s(U,2);{var Z=ee=>{var be=Ui(),ge=Ue(be);ma(ge);var G=s(ge,4);ma(G);var je=s(G,4);ma(je),Je(ge,()=>c().features,Ke=>xt(se,n(c).features=Ke,n(c))),Je(G,()=>c().equipment,Ke=>xt(se,n(c).equipment=Ke,n(c))),Je(je,()=>c().notes,Ke=>xt(se,n(c).notes=Ke,n(c))),v(ee,be)};k(re,ee=>{d(),n(()=>!d().notes)&&ee(Z)})}l(y),B(()=>V=St(y,1,"notes svelte-wttn0l",null,V,{hidden:!e($)})),v(a,y),Ht(),h()}var qi=g('<div class="color-picker-section svelte-1r90jgp"><h3 class="svelte-1r90jgp">Dice Colors</h3> <div class="color-inputs svelte-1r90jgp"><div class="color-input-group svelte-1r90jgp"><label for="dice-color" class="svelte-1r90jgp">Dice Color</label> <input type="color" id="dice-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="label-color" class="svelte-1r90jgp">Label Color</label> <input type="color" id="label-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="desk-color" class="svelte-1r90jgp">Background Color</label> <input type="color" id="desk-color" class="svelte-1r90jgp"/></div></div></div>'),Wi=g('<div class="loading svelte-1r90jgp"><p class="svelte-1r90jgp">Loading 3D dice...</p></div>'),zi=g('<div class="custom-dice-selector svelte-1r90jgp"><h3 class="svelte-1r90jgp">Choose Dice to Roll</h3> <div class="dice-inputs svelte-1r90jgp"><div class="dice-input-group svelte-1r90jgp"><label for="d4" class="svelte-1r90jgp">d4</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d4" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d6" class="svelte-1r90jgp">d6</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d6" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d8" class="svelte-1r90jgp">d8</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d8" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d10" class="svelte-1r90jgp">d10</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d10" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d12" class="svelte-1r90jgp">d12</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d12" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d20" class="svelte-1r90jgp">d20</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d20" min="0" max="10"/></div></div> <div class="dice-controls svelte-1r90jgp"><button class="btn btn-primary use-enabled svelte-1r90jgp"> </button> <button class="btn btn-secondary use-enabled svelte-1r90jgp">Reset</button></div></div>'),Ki=g('<span class="crit-badge svelte-1r90jgp">CRITICAL HIT!</span>'),Vi=g('<span class="crit-badge crit-fail svelte-1r90jgp">CRITICAL MISS!</span>'),Ji=g('<div class="bonus-item svelte-1r90jgp"><span class="bonus-value svelte-1r90jgp"> </span> <span class="bonus-source svelte-1r90jgp"> </span></div>'),Yi=g('<div class="bonus-breakdown svelte-1r90jgp"></div>'),Qi=g('<p class="modifier-text svelte-1r90jgp"> </p>'),Xi=g('<div class="svelte-1r90jgp"><em class="svelte-1r90jgp">No damage is dealt on a critical miss.</em></div>'),Zi=g('<button class="btn btn-follow-up svelte-1r90jgp"> </button>'),en=g('<button class="btn btn-guided-strike svelte-1r90jgp">‚ö° Use Guided Strike (+10)</button>'),tn=g('<div class="follow-up-actions svelte-1r90jgp"><!> <!></div>'),an=g('<div class="result-header svelte-1r90jgp"><h3 class="svelte-1r90jgp"> </h3> <!> <!></div> <div class="result-total svelte-1r90jgp"> </div> <div class="result-details svelte-1r90jgp"><!></div> <!> <!>',1),sn=g('<div role="button" tabindex="-1"><div class="modal-content svelte-1r90jgp" role="dialog" tabindex="0"><div class="modal-header svelte-1r90jgp"><h2 class="svelte-1r90jgp">Dice Roller</h2> <div class="header-buttons svelte-1r90jgp"><button class="color-btn svelte-1r90jgp" title="Customize dice colors">üé®</button> <button class="close-btn svelte-1r90jgp">√ó</button></div></div> <!> <!> <div class="dice-main-area svelte-1r90jgp"><div class="dice-container svelte-1r90jgp"></div> <!></div> <div><!></div></div></div>');function ln(a,r){Et(r,!1);const t=()=>tt(se,"$character",c),[c,d]=zt(),p=w(),h=w(),$=w(),x=na();let y=kt(r,"notation",12,""),V=kt(r,"visible",8,!1),U=kt(r,"damageNotation",12,""),re=kt(r,"attackName",12,""),Z=kt(r,"applyHalfDamage",8,!1),ee=kt(r,"bonusBreakdown",28,()=>[]),be=kt(r,"rollType",12,"other"),ge=null,G=w(void 0),je=w(!1),Ke=w(""),oe=w(null);function Me(){return e(oe)?.resultTotal??null}function Oe(_,N,te){const X=[];if(!_||!_.result)return X;const ie=N.match(/([+-]?\d*d\d+|[+-]?\d+)/g)||[];let D=0;const H=new Set;for(const z of ie){const fe=z.trim();if(!fe)continue;const Le=fe.match(/([+-]?)(\d*)d(\d+)/);if(Le){const nt=parseInt(Le[2]||"1"),K=`${nt}d${Le[3]}`,ut=te.findIndex((f,O)=>!H.has(O)&&typeof f.value=="string"&&f.value===K),ft=[];for(let f=0;f<nt&&D<_.result.length;f++)ft.push(_.result[D++]);const bt=ut>=0?te[ut].source:"base die";ut>=0&&H.add(ut);for(const f of ft)X.push({display:`${f}`,source:bt})}}for(let z=0;z<te.length;z++)if(!H.has(z)&&typeof te[z].value=="number"){const fe=te[z].value;X.push({display:fe>=0?`+${fe}`:`${fe}`,source:te[z].source})}return X}let le=w(0),_e=w(0),Ie=w(0),C=w(0),R=w(0),S=w(0),W=w(0),b=w([]),j=w(!1),ae=w(!1),Ge=w(!1),qe=w("#051e0a"),Ce=w("#ffffff"),m=w("#3a2004"),E=w(!1);function Q(_){return _.length===9&&_.startsWith("#")?_.substring(0,7):_}function ne(_,N="ff"){return _.length===7&&_.startsWith("#")?_+N:_}function Y(){if(window.DICE&&e(G))try{ge&&e(G)&&la(G,e(G).innerHTML="");const _=e(G).clientWidth||500,N=e(G).clientHeight||300;ge=new window.DICE.dice_box(e(G),{w:_,h:N}),o(je,!0)}catch(_){console.error("Error initializing dice box:",_)}}va(()=>{const _=X=>new Promise((ie,D)=>{if(document.querySelector(`script[src="${X}"]`)){ie(null);return}const z=document.createElement("script");z.src=X,z.onload=()=>{ie(null)},z.onerror=()=>{console.error(`Failed to load: ${X}`),D(new Error(`Failed to load ${X}`))},document.head.appendChild(z)});setTimeout(()=>{_(`${ga}/libs/three.min.js`).then(()=>_(`${ga}/libs/cannon.min.js`)).then(()=>_(`${ga}/libs/teal.js`)).then(()=>_(`${ga}/dice.js`)).then(()=>{if(window.DICE){const X=window.DICE.getColors();o(qe,Q(X.dice_color)),o(Ce,Q(X.label_color)),o(m,Q(X.desk_color))}Y()}).catch(X=>{console.error("Failed to load dice libraries:",X)})},100);const N=()=>{e(je)&&Y()},te=X=>{V()&&X.key==="Escape"&&Se()};return window.addEventListener("resize",N),window.addEventListener("keydown",te),()=>{window.removeEventListener("resize",N),window.removeEventListener("keydown",te)}});function ye(_,N="other"){if(!ge||!e(je))return;o(oe,null),o(b,[]),o(j,!1),o(ae,!1),N==="damage"&&ee([]),be(N),o(Ge,!1),ge.diceToRoll=_;const te=ie=>null,X=ie=>{let D=ie.resultTotal,H=ie.resultString;if(Z()&&(D=Math.floor(D/2),H=H+" (halved)"),o(oe,{...ie,resultTotal:D,resultString:H}),console.log("Final roll result:",e(oe)),console.log({type:N}),N==="attack"&&ie.result&&ie.result.length>0){const z=ie.result[0];o(j,z===20),o(ae,z===1)}if(o(b,[]),console.log("Setting up follow-up actions. Type:",N,"damageNotation:",U(),"isCriticalSuccess:",e(j),"isCriticalFail:",e(ae)),N==="attack"&&U())if(e(j)){const z=xe(U());e(b).push({label:`Roll Critical Damage (${z})`,notation:z})}else e(ae)||e(b).push({label:`Roll Damage (${U()})`,notation:U()})};ge.start_throw(te,X)}function Ae(){const _=[];e(le)>0&&_.push(`${e(le)}d4`),e(_e)>0&&_.push(`${e(_e)}d6`),e(Ie)>0&&_.push(`${e(Ie)}d8`),e(C)>0&&_.push(`${e(C)}d10`),e(R)>0&&_.push(`${e(R)}d12`),e(S)>0&&_.push(`${e(S)}d20`);let N=_.join("+")||"1d20";return e(W)!==0&&(N+=e(W)>=0?`+${e(W)}`:`${e(W)}`),N}function st(){const _=Ae();ye(_)}function xe(_){return _.replace(/(\d+)d(\d+)/g,(N,te,X)=>`${parseInt(te)*2}d${X}`)}function We(){o(le,0),o(_e,0),o(Ie,0),o(C,0),o(R,0),o(S,0),o(W,0),o(oe,null),o(b,[]),o(j,!1),o(ae,!1),be("other"),o(Ge,!1)}function M(){window.DICE&&(window.DICE.setColors({dice_color:ne(e(qe),"ff"),label_color:ne(e(Ce),"ff"),desk_color:e(m)}),ge&&(ge.updateDeskColor(e(m)),ge.updateDiceColors()))}function A(){o(E,!e(E))}function ce(){!e(oe)||e(h)<=0||e(Ge)||(o(oe,{...e(oe),resultTotal:e(oe).resultTotal+10,resultString:e(oe).resultString+" + 10 (Guided Strike)"}),se.update(_=>{const N="ChannelDivinity",te=_.classFeatures.features[N];return typeof te=="number"&&te>0&&(_.classFeatures.features[N]=te-1),_}),o(Ge,!0))}function Se(){x("close"),y(""),U(""),re(""),o(Ke,""),o(oe,null),o(Ge,!1),o(j,!1),o(ae,!1),We()}Qe(()=>(t(),ca),()=>{o(p,t().class?ca(t().class,t().level,t().subclass).some(N=>N.name==="Guided Strike"):!1)}),Qe(()=>t(),()=>{o(h,(()=>{const N=t().classFeatures.features["ChannelDivinity"];return typeof N=="number"?N:0})())}),Qe(()=>(e(le),e(_e),e(Ie),e(C),e(R),e(S),e(W)),()=>{o($,(()=>{const _=[];e(le)>0&&_.push(`${e(le)}d4`),e(_e)>0&&_.push(`${e(_e)}d6`),e(Ie)>0&&_.push(`${e(Ie)}d8`),e(C)>0&&_.push(`${e(C)}d10`),e(R)>0&&_.push(`${e(R)}d12`),e(S)>0&&_.push(`${e(S)}d20`);let N=_.join("+")||"1d20";return e(W)!==0&&(N+=e(W)>=0?`+${e(W)}`:`${e(W)}`),N})())}),Qe(()=>(P(y()),e(je),P(V()),e(Ke),P(U()),P(re()),P(be())),()=>{y()&&e(je)&&V()&&y()!==e(Ke)&&(o(Ke,y()),o(oe,null),o(b,[]),o(j,!1),o(ae,!1),o(Ge,!1),console.log("Auto-roll triggered. notation:",y(),"damageNotation:",U(),"attackName:",re(),"rollType:",be()),setTimeout(()=>ye(y(),be()),200))}),Qt();var q={getLastRollTotal:Me};Pt();var u=sn();let ze;var me=i(u),pe=i(me),I=s(i(pe),2),Fe=i(I),Te=s(Fe,2);l(I),l(pe);var Xe=s(pe,2);{var lt=_=>{var N=qi(),te=s(i(N),2),X=i(te),ie=s(i(X),2);$e(ie),l(X);var D=s(X,2),H=s(i(D),2);$e(H),l(D);var z=s(D,2),fe=s(i(z),2);$e(fe),l(z),l(te),l(N),Je(ie,()=>e(qe),Le=>o(qe,Le)),T("change",ie,M),Je(H,()=>e(Ce),Le=>o(Ce,Le)),T("change",H,M),Je(fe,()=>e(m),Le=>o(m,Le)),T("change",fe,M),v(_,N)};k(Xe,_=>{e(E)&&_(lt)})}var Re=s(Xe,2);{var ke=_=>{var N=Wi();v(_,N)};k(Re,_=>{e(je)||_(ke)})}var Be=s(Re,2),Pe=i(Be);ya(Pe,_=>o(G,_),()=>e(G));var Ee=s(Pe,2);{var He=_=>{var N=zi(),te=s(i(N),2),X=i(te),ie=s(i(X),2);$e(ie),l(X);var D=s(X,2),H=s(i(D),2);$e(H),l(D);var z=s(D,2),fe=s(i(z),2);$e(fe),l(z);var Le=s(z,2),nt=s(i(Le),2);$e(nt),l(Le);var K=s(Le,2),ut=s(i(K),2);$e(ut),l(K);var ft=s(K,2),bt=s(i(ft),2);$e(bt),l(ft),l(te);var f=s(te,2),O=i(f),F=i(O);l(O);var De=s(O,2);l(f),l(N),B(()=>{O.disabled=!e(je),L(F,`Roll ${e($)??""}`)}),Je(ie,()=>e(le),ue=>o(le,ue)),Je(H,()=>e(_e),ue=>o(_e,ue)),Je(fe,()=>e(Ie),ue=>o(Ie,ue)),Je(nt,()=>e(C),ue=>o(C,ue)),Je(ut,()=>e(R),ue=>o(R,ue)),Je(bt,()=>e(S),ue=>o(S,ue)),T("click",O,st),T("click",De,We),v(_,N)};k(Ee,_=>{y()||_(He)})}l(Be);var ve=s(Be,2);let he;var J=i(ve);{var we=_=>{var N=an(),te=Ue(N),X=i(te),ie=i(X,!0);l(X);var D=s(X,2);{var H=De=>{var ue=Ki();v(De,ue)};k(D,De=>{e(j)&&De(H)})}var z=s(D,2);{var fe=De=>{var ue=Vi();v(De,ue)};k(z,De=>{e(ae)&&De(fe)})}l(te);var Le=s(te,2),nt=i(Le,!0);l(Le);var K=s(Le,2),ut=i(K);{var ft=De=>{var ue=ot(),et=Ue(ue);{var Ne=Ye=>{var ct=Yi();$t(ct,5,()=>(e(oe),P(y()),P(ee()),n(()=>Oe(e(oe),y(),ee()))),wt,(it,vt)=>{var mt=Ji(),ht=i(mt),Ze=i(ht,!0);l(ht);var at=s(ht,2),pt=i(at);l(at),l(mt),B(()=>{L(Ze,(e(vt),n(()=>e(vt).display))),L(pt,`(${e(vt),n(()=>e(vt).source)??""})`)}),v(it,mt)}),l(ct),v(Ye,ct)},gt=Ye=>{var ct=ot(),it=Ue(ct);{var vt=mt=>{var ht=Qi(),Ze=i(ht);l(ht),B(()=>L(Ze,`Modifier: ${e(oe),n(()=>e(oe).constant>=0?"+":"")??""}${e(oe),n(()=>e(oe).constant)??""}`)),v(mt,ht)};k(it,mt=>{e(oe),n(()=>e(oe).constant)&&mt(vt)},!0)}v(Ye,ct)};k(et,Ye=>{P(ee()),n(()=>ee().length>0)?Ye(Ne):Ye(gt,!1)})}v(De,ue)};k(ut,De=>{e(oe),P(ee()),n(()=>e(oe).constant||ee().length>0)&&De(ft)})}l(K);var bt=s(K,2);{var f=De=>{var ue=Xi();v(De,ue)};k(bt,De=>{e(ae)&&De(f)})}var O=s(bt,2);{var F=De=>{var ue=tn(),et=i(ue);$t(et,1,()=>e(b),wt,(Ye,ct)=>{var it=Zi(),vt=i(it,!0);l(it),B(()=>L(vt,(e(ct),n(()=>e(ct).label)))),T("click",it,()=>ye(e(ct).notation,"damage")),v(Ye,it)});var Ne=s(et,2);{var gt=Ye=>{var ct=en();B(()=>{ct.disabled=e(h)<=0,Ve(ct,"title",e(h)<=0?"No Channel Divinity uses remaining":"Use Channel Divinity to add +10 to this attack roll")}),T("click",ct,ce),v(Ye,ct)};k(Ne,Ye=>{e(p)&&be()==="attack"&&!e(Ge)&&e(h)>0&&!e(ae)&&Ye(gt)})}l(ue),v(De,ue)};k(O,De=>{e(b),e(p),P(be()),e(Ge),e(h),n(()=>e(b).length>0||e(p)&&be()==="attack"&&!e(Ge)&&e(h)>0)&&De(F)})}B(()=>{L(ie,re()?`${re()} - Result`:"Result"),L(nt,(e(oe),n(()=>e(oe).resultTotal)))}),v(_,N)};k(J,_=>{e(oe)&&_(we)})}l(ve),l(me),l(u),B(()=>{ze=St(u,1,"modal-overlay svelte-1r90jgp",null,ze,{hidden:!V()}),he=St(ve,1,"roll-result svelte-1r90jgp",null,he,{"has-result":e(oe)})}),T("click",Fe,A),T("click",Te,Se),T("click",me,Ka(function(_){oa.call(this,r,_)})),T("keydown",me,function(_){oa.call(this,r,_)}),T("click",u,Se),T("keydown",u,_=>_.key==="Escape"&&Se()),v(a,u),Qs(r,"getLastRollTotal",Me);var de=Ht(q);return d(),de}const Ba="https://api.github.com/gists";async function nn(a,r,t){if(!r)throw new Error("GitHub token is required");const c=JSON.stringify(a,null,2),d=`${a.name||"character"}_dnd.json`,p={description:t||`D&D Character: ${a.name}`,public:!1,files:{[d]:{content:c}}},h=await fetch(Ba,{method:"POST",headers:{Authorization:`token ${r}`,"Content-Type":"application/json"},body:JSON.stringify(p)});if(!h.ok)throw new Error(`Failed to create gist: ${h.statusText}`);return(await h.json()).id}async function rn(a,r,t){if(!r||!t)throw new Error("GitHub token and Gist ID are required");const c=JSON.stringify(a,null,2),p={files:{[`${a.name||"character"}_dnd.json`]:{content:c}}},h=await fetch(`${Ba}/${t}`,{method:"PATCH",headers:{Authorization:`token ${r}`,"Content-Type":"application/json"},body:JSON.stringify(p)});if(!h.ok)throw new Error(`Failed to update gist: ${h.statusText}`)}async function on(a,r){if(!a)throw new Error("Gist ID is required");const t={"Content-Type":"application/json"};r&&(t.Authorization=`token ${r}`);const c=await fetch(`${Ba}/${a}`,{method:"GET",headers:t});if(!c.ok)throw new Error(`Failed to load gist: ${c.statusText}`);const d=await c.json(),p=Object.values(d.files);if(p.length===0)throw new Error("No files found in gist");const $=p[0].content;try{const x=JSON.parse($);return x.attacks&&Array.isArray(x.attacks)&&(x.attacks=x.attacks.map(y=>({...y,id:y.id||crypto.randomUUID()}))),x.classFeatures?(x.classFeatures.features||(x.classFeatures.features={}),x.classFeatures.spellSlots||(x.classFeatures.spellSlots=[]),x.classFeatures.preparedSpells===void 0&&(x.classFeatures.preparedSpells="")):x.classFeatures={features:{},spellSlots:[],preparedSpells:""},x}catch{throw new Error("Invalid character data in gist")}}function ns(a){typeof window<"u"&&localStorage.setItem("dnd_gist_config",JSON.stringify(a))}function cn(){if(typeof window<"u"){const a=localStorage.getItem("dnd_gist_config");if(a)return JSON.parse(a)}return{}}async function vn(a,r=30){if(!a)throw new Error("GitHub token is required to list gists");const t=await fetch(`${Ba}?per_page=${r}`,{method:"GET",headers:{Authorization:`token ${a}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error(`Failed to list gists: ${t.statusText}`);return await t.json()}var dn=g('<div class="error-message svelte-1jb5ckg"> </div>'),un=g('<div class="toggle-container svelte-1jb5ckg"><button type="button" class="toggle-btn svelte-1jb5ckg"> </button></div>'),pn=g('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID (leave empty to create new)</label> <input type="text" id="gistId" placeholder="Optional: existing Gist ID to update" class="svelte-1jb5ckg"/></div>'),fn=g('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),gn=g('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),mn=g('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Update (or leave unselected to create new)</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),hn=g('<div class="info-message svelte-1jb5ckg">No gists found. A new one will be created.</div>'),bn=g('<!> <div class="form-group svelte-1jb5ckg"><label for="description" class="svelte-1jb5ckg"> </label> <input type="text" id="description" placeholder="D&amp;D Character Sheet" class="svelte-1jb5ckg"/></div>',1),_n=g('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID *</label> <input type="text" id="gistId" placeholder="Enter Gist ID (for public or your private gists)" required class="svelte-1jb5ckg"/></div>'),yn=g('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),xn=g('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),Sn=g('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Load</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),kn=g('<div class="info-message svelte-1jb5ckg">No gists found. Enter a Gist ID manually or create a new one in Save mode.</div>'),$n=g('<div class="modal-overlay svelte-1jb5ckg" role="button" tabindex="-1"><div class="modal-content svelte-1jb5ckg" role="dialog" tabindex="0"><div class="modal-header svelte-1jb5ckg"><h2 class="svelte-1jb5ckg"> </h2> <button class="close-btn svelte-1jb5ckg">√ó</button></div> <div class="modal-body svelte-1jb5ckg"><!> <div class="form-group svelte-1jb5ckg"><label for="token" class="svelte-1jb5ckg"> <a href="https://github.com/settings/tokens" target="_blank" rel="noopener" class="svelte-1jb5ckg">Get token</a></label> <input type="password" id="token" placeholder="ghp_xxxxxxxxxxxxx" class="svelte-1jb5ckg"/></div> <!> <!> <div class="modal-actions svelte-1jb5ckg"><button class="btn btn-primary svelte-1jb5ckg"><!></button> <button class="btn btn-secondary svelte-1jb5ckg">Cancel</button></div></div></div></div>');function Cn(a,r){Et(r,!1);const t=()=>tt(se,"$character",c),[c,d]=zt(),p=na();let h=kt(r,"mode",8,"save"),$=w(""),x=w(""),y=w(""),V=w(!1),U=w(""),re=w(!1),Z=w(!1),ee=w([]),be=w(null);const ge=cn();ge.token&&o($,ge.token),ge.gistId&&o(x,ge.gistId),va(async()=>{e($)&&!e(re)&&await G()});async function G(){if(e($)){o(Z,!0),o(U,"");try{o(ee,await vn(e($))),e(x)&&o(be,e(ee).find(A=>A.id===e(x))||null)}catch(A){o(U,A.message||"Failed to load gists"),o(ee,[])}finally{o(Z,!1)}}}function je(A){o(be,A),o(x,A.id)}function Ke(){o(re,!e(re)),o(U,""),!e(re)&&e($)&&G()}async function oe(){if(!e($)){o(U,"GitHub token is required");return}const A=e(be)?.id||e(x);o(V,!0),o(U,"");try{if(A)await rn(t(),e($),A),o(x,A),Wt.add("Character updated in Gist successfully!","success");else{const ce=await nn(t(),e($),e(y));o(x,ce),Wt.add(`Character saved to Gist! ID: ${ce}`,"success")}ns({token:e($),gistId:e(x)}),p("close")}catch(ce){o(U,ce.message||"Failed to save to Gist")}finally{o(V,!1)}}async function Me(){const A=e(be)?.id||e(x);if(!A){o(U,"Please select a gist or enter a Gist ID");return}o(V,!0),o(U,"");try{const ce=await on(A,e($)||void 0);se.set(ce),o(x,A),ns({token:e($),gistId:e(x)}),Wt.add("Character loaded from Gist successfully!","success"),p("close")}catch(ce){o(U,ce.message||"Failed to load from Gist")}finally{o(V,!1)}}function Oe(){p("close")}Pt();var le=$n(),_e=i(le),Ie=i(_e),C=i(Ie),R=i(C,!0);l(C);var S=s(C,2);l(Ie);var W=s(Ie,2),b=i(W);{var j=A=>{var ce=dn(),Se=i(ce,!0);l(ce),B(()=>L(Se,e(U))),v(A,ce)};k(b,A=>{e(U)&&A(j)})}var ae=s(b,2),Ge=i(ae),qe=i(Ge);ia(),l(Ge);var Ce=s(Ge,2);$e(Ce),l(ae);var m=s(ae,2);{var E=A=>{var ce=un(),Se=i(ce),q=i(Se,!0);l(Se),l(ce),B(()=>{Se.disabled=e(V),L(q,e(re)?"üìã Show My Gists":"‚úèÔ∏è Enter Gist ID Manually")}),T("click",Se,Ke),v(A,ce)};k(m,A=>{(h()==="load"||h()==="save"&&e($))&&A(E)})}var Q=s(m,2);{var ne=A=>{var ce=bn(),Se=Ue(ce);{var q=Fe=>{var Te=pn(),Xe=s(i(Te),2);$e(Xe),l(Te),B(()=>Xe.disabled=e(V)),Je(Xe,()=>e(x),lt=>o(x,lt)),v(Fe,Te)},u=Fe=>{var Te=ot(),Xe=Ue(Te);{var lt=ke=>{var Be=fn();v(ke,Be)},Re=ke=>{var Be=ot(),Pe=Ue(Be);{var Ee=ve=>{var he=mn(),J=s(i(he),2);$t(J,5,()=>e(ee),wt,(we,de)=>{var _=gn();let N;var te=i(_),X=i(te),ie=i(X,!0);l(X);var D=s(X,2),H=i(D,!0);l(D),l(te);var z=s(te,2),fe=i(z),Le=i(fe);l(fe);var nt=s(fe,2),K=i(nt);l(nt),l(z),l(_),B(ut=>{N=St(_,1,"gist-item svelte-1jb5ckg",null,N,{selected:e(be)?.id===e(de).id}),_.disabled=e(V),L(ie,(e(de),n(()=>e(de).description||"Untitled"))),L(H,(e(de),n(()=>e(de).public?"üåê Public":"üîí Private"))),L(Le,`ID: ${e(de),n(()=>e(de).id)??""}`),L(K,`Updated: ${ut??""}`)},[()=>(e(de),n(()=>new Date(e(de).updated_at).toLocaleDateString()))]),T("click",_,()=>je(e(de))),v(we,_)}),l(J),l(he),v(ve,he)},He=ve=>{var he=ot(),J=Ue(he);{var we=de=>{var _=hn();v(de,_)};k(J,de=>{e($)&&de(we)},!0)}v(ve,he)};k(Pe,ve=>{e(ee),n(()=>e(ee).length>0)?ve(Ee):ve(He,!1)},!0)}v(ke,Be)};k(Xe,ke=>{e(Z)?ke(lt):ke(Re,!1)},!0)}v(Fe,Te)};k(Se,Fe=>{e(re)||!e($)?Fe(q):Fe(u,!1)})}var ze=s(Se,2),me=i(ze),pe=i(me);l(me);var I=s(me,2);$e(I),l(ze),B(()=>{L(pe,`Description ${e(x)?"(optional)":""}`),I.disabled=e(V)}),Je(I,()=>e(y),Fe=>o(y,Fe)),v(A,ce)},Y=A=>{var ce=ot(),Se=Ue(ce);{var q=ze=>{var me=_n(),pe=s(i(me),2);$e(pe),l(me),B(()=>pe.disabled=e(V)),Je(pe,()=>e(x),I=>o(x,I)),v(ze,me)},u=ze=>{var me=ot(),pe=Ue(me);{var I=Te=>{var Xe=yn();v(Te,Xe)},Fe=Te=>{var Xe=ot(),lt=Ue(Xe);{var Re=Be=>{var Pe=Sn(),Ee=s(i(Pe),2);$t(Ee,5,()=>e(ee),wt,(He,ve)=>{var he=xn();let J;var we=i(he),de=i(we),_=i(de,!0);l(de);var N=s(de,2),te=i(N,!0);l(N),l(we);var X=s(we,2),ie=i(X),D=i(ie);l(ie);var H=s(ie,2),z=i(H);l(H),l(X),l(he),B(fe=>{J=St(he,1,"gist-item svelte-1jb5ckg",null,J,{selected:e(be)?.id===e(ve).id}),he.disabled=e(V),L(_,(e(ve),n(()=>e(ve).description||"Untitled"))),L(te,(e(ve),n(()=>e(ve).public?"üåê Public":"üîí Private"))),L(D,`ID: ${e(ve),n(()=>e(ve).id)??""}`),L(z,`Updated: ${fe??""}`)},[()=>(e(ve),n(()=>new Date(e(ve).updated_at).toLocaleDateString()))]),T("click",he,()=>je(e(ve))),v(He,he)}),l(Ee),l(Pe),v(Be,Pe)},ke=Be=>{var Pe=ot(),Ee=Ue(Pe);{var He=ve=>{var he=kn();v(ve,he)};k(Ee,ve=>{e($)&&ve(He)},!0)}v(Be,Pe)};k(lt,Be=>{e(ee),n(()=>e(ee).length>0)?Be(Re):Be(ke,!1)},!0)}v(Te,Xe)};k(pe,Te=>{e(Z)?Te(I):Te(Fe,!1)},!0)}v(ze,me)};k(Se,ze=>{e(re)||!e($)?ze(q):ze(u,!1)},!0)}v(A,ce)};k(Q,A=>{h()==="save"?A(ne):A(Y,!1)})}var ye=s(Q,2),Ae=i(ye),st=i(Ae);{var xe=A=>{var ce=Rt();B(()=>L(ce,h()==="save"?"Saving...":"Loading...")),v(A,ce)},We=A=>{var ce=Rt();B(()=>L(ce,h()==="save"?"Save":"Load")),v(A,ce)};k(st,A=>{e(V)?A(xe):A(We,!1)})}l(Ae);var M=s(Ae,2);l(ye),l(W),l(_e),l(le),B(()=>{L(R,h()==="save"?"Save to GitHub Gist":"Load from GitHub Gist"),L(qe,`GitHub Token ${h()==="load"?"(optional for public gists)":"(required)"} `),Ce.disabled=e(V),Ae.disabled=e(V),M.disabled=e(V)}),T("click",S,Oe),Je(Ce,()=>e($),A=>o($,A)),T("blur",Ce,()=>{e($)&&!e(re)&&G()}),T("click",Ae,function(...A){(h()==="save"?oe:Me)?.apply(this,A)}),T("click",M,Oe),T("click",_e,Ka(function(A){oa.call(this,r,A)})),T("keydown",_e,function(A){oa.call(this,r,A)}),T("click",le,Oe),T("keydown",le,A=>A.key==="Escape"&&Oe()),v(a,le),Ht(),d()}var wn=g('<div class="loading svelte-1ngjemu">Loading D&D data...</div>'),Dn=g("<option> </option>"),Ln=g('<select class="level-filter svelte-1ngjemu"><option>All Levels</option><option>Cantrip</option><!></select>'),jn=g('<div class="no-results svelte-1ngjemu"> </div>'),An=g('<div class="item-meta svelte-1ngjemu"> </div>'),Bn=g('<div class="item-meta svelte-1ngjemu"> </div>'),Mn=g('<button><div class="item-name svelte-1ngjemu"> </div> <!></button>'),Fn=g('<p class="higher-levels"><strong>At Higher Levels:</strong> </p>'),Tn=g('<p class="cantrip-upgrade"><strong>Cantrip Upgrade:</strong> </p>'),Rn=g('<h3 class="svelte-1ngjemu"> </h3> <p class="spell-meta svelte-1ngjemu"><!> <!></p> <p class="spell-classes"><strong>Classes:</strong> </p> <div class="spell-stats svelte-1ngjemu"><div><strong>Casting Time:</strong> </div> <div><strong>Range:</strong> </div> <div><strong>Components:</strong> <!></div> <div><strong>Duration:</strong> <!> </div></div> <p class="description svelte-1ngjemu"> </p> <!> <!>',1),In=g('<p class="prerequisite svelte-1ngjemu"><strong>Prerequisite:</strong> </p>'),Pn=g('<h3 class="svelte-1ngjemu"> </h3> <!> <p class="description svelte-1ngjemu"> </p> <a target="_blank" rel="noopener" class="source-link svelte-1ngjemu">View Full Details ‚Üí</a>',1),En=g('<div class="item-details svelte-1ngjemu"><!></div>'),Hn=g('<div class="controls svelte-1ngjemu"><div class="tabs svelte-1ngjemu"><button> </button> <button> </button></div> <div class="search-controls svelte-1ngjemu"><input type="text" placeholder="Search by name or description..." class="search-input svelte-1ngjemu"/> <!></div></div> <div class="content-container svelte-1ngjemu"><div class="items-list svelte-1ngjemu"><!></div> <!></div>',1),Nn=g('<div class="modal-backdrop svelte-1ngjemu" role="presentation"><div class="modal svelte-1ngjemu" role="dialog" aria-modal="true" tabindex="-1"><div class="modal-header svelte-1ngjemu"><h2 class="svelte-1ngjemu">Browse D&D Spells & Feats</h2> <button class="close-btn svelte-1ngjemu" aria-label="Close">&times;</button></div> <div class="modal-body svelte-1ngjemu"><!></div> <div class="modal-footer svelte-1ngjemu"><button class="btn-secondary svelte-1ngjemu">Cancel</button> <button class="btn-primary svelte-1ngjemu">Add to Character Sheet</button></div></div></div>');function Un(a,r){Et(r,!1);const t=w(),c=w(),d=w();let p=kt(r,"onClose",8),h=w("spell"),$=w(!0),x=w(""),y=w(null),V=w([]),U=w([]),re=w(null);va(async()=>{o($,!0);try{o(V,await ms()),o(U,await Bl())}catch(S){console.error("Failed to load data:",S)}finally{o($,!1)}});function Z(S){o(re,S)}function ee(S){const W=S.match(/(\d+d\d+(?:\s*\+\s*\d+)?)/i);return W?W[1]:""}function be(S){const W=S.split(/\.( |$)/)[0].trim(),b=Array.from(S.matchAll(/\*\*(.*?)\*\*/g)).map(ae=>ae[1].replace(/\.$/,""));let j=W;return b.length&&(j+=" | Effects: "+b.join(", ")),j}function ge(){if(e(re)){if(e(h)==="spell"){const S=e(re);se.update(W=>{const j=[];S.range&&j.push(`Range: ${S.range}`),S.castingTime&&j.push(`Cast: ${S.castingTime}`),S.duration&&j.push(`Duration: ${S.duration}`),S.actionType==="Save"&&j.push("Saving throw spell"),S.components&&S.components.length>0&&j.push(`Components: ${S.components.join(", ")}`),S.material&&j.push(`Material: ${S.material}`);const ae=j.join(" | "),Ge=be(S.description),qe={id:crypto.randomUUID(),name:`${S.name}${S.concentration?" (C)":""}${S.ritual?" (R)":""}`,bonus:S.actionType==="Attack"?5:0,damage:ee(S.description),damageType:`${S.school} (Lvl ${S.level})`,spellRef:S.name,infoNotes:ae,generalNotes:Ge,castAtLevel:S.level};return W.attacks=[...W.attacks,qe],W})}else if(e(h)==="feat"){const S=e(re);se.update(W=>{const b=`${S.name}${S.prerequisite?` (Req: ${S.prerequisite})`:""}
${S.description}
`;return W.features=W.features?`${W.features}
${b}`:b,W})}o(re,null),p()()}}Qe(()=>(e(y),e(V),e(x)),()=>{o(t,e(y)!==null?Ml(ss(e(V),e(x)),e(y)):ss(e(V),e(x)))}),Qe(()=>(e(U),e(x)),()=>{o(c,Fl(e(U),e(x)))}),Qe(()=>(e(h),e(t),e(c)),()=>{o(d,e(h)==="spell"?e(t):e(c))}),Qt(),Pt();var G=Nn(),je=i(G),Ke=i(je),oe=s(i(Ke),2);l(Ke);var Me=s(Ke,2),Oe=i(Me);{var le=S=>{var W=wn();v(S,W)},_e=S=>{var W=Hn(),b=Ue(W),j=i(b),ae=i(j);let Ge;var qe=i(ae);l(ae);var Ce=s(ae,2);let m;var E=i(Ce);l(Ce),l(j);var Q=s(j,2),ne=i(Q);$e(ne);var Y=s(ne,2);{var ye=Se=>{var q=Ln();B(()=>{e(y),Dt(()=>{})});var u=i(q);u.value=(u.__value=null)??"";var ze=s(u);ze.value=ze.__value=0;var me=s(ze);$t(me,0,()=>[1,2,3,4,5,6,7,8,9],wt,(pe,I)=>{var Fe=Dn(),Te=i(Fe);l(Fe);var Xe={};B(()=>{L(Te,`Level ${I??""}`),Xe!==(Xe=I)&&(Fe.value=(Fe.__value=I)??"")}),v(pe,Fe)}),l(q),ja(q,()=>e(y),pe=>o(y,pe)),v(Se,q)};k(Y,Se=>{e(h)==="spell"&&Se(ye)})}l(Q),l(b);var Ae=s(b,2),st=i(Ae),xe=i(st);{var We=Se=>{var q=jn(),u=i(q);l(q),B(()=>L(u,`No ${e(h)??""}s found`)),v(Se,q)},M=Se=>{var q=ot(),u=Ue(q);$t(u,1,()=>e(d),wt,(ze,me)=>{var pe=Mn();let I;var Fe=i(pe),Te=i(Fe,!0);l(Fe);var Xe=s(Fe,2);{var lt=ke=>{const Be=dt(()=>e(me));var Pe=An(),Ee=i(Pe);l(Pe),B(()=>L(Ee,`Level ${P(e(Be)),n(()=>e(Be).level)??""} ‚Ä¢ ${P(e(Be)),n(()=>e(Be).school)??""}`)),v(ke,Pe)},Re=ke=>{const Be=dt(()=>e(me));var Pe=ot(),Ee=Ue(Pe);{var He=ve=>{var he=Bn(),J=i(he,!0);l(he),B(()=>L(J,(P(e(Be)),n(()=>e(Be).prerequisite)))),v(ve,he)};k(Ee,ve=>{P(e(Be)),n(()=>e(Be).prerequisite)&&ve(He)})}v(ke,Pe)};k(Xe,ke=>{e(h)==="spell"?ke(lt):ke(Re,!1)})}l(pe),B(()=>{I=St(pe,1,"item-card svelte-1ngjemu",null,I,{selected:e(re)?.name===e(me).name}),L(Te,(e(me),n(()=>e(me).name)))}),T("click",pe,()=>Z(e(me))),v(ze,pe)}),v(Se,q)};k(xe,Se=>{e(d),n(()=>e(d).length===0)?Se(We):Se(M,!1)})}l(st);var A=s(st,2);{var ce=Se=>{var q=En(),u=i(q);{var ze=pe=>{const I=dt(()=>e(re));var Fe=Rn(),Te=Ue(Fe),Xe=i(Te,!0);l(Te);var lt=s(Te,2),Re=i(lt);{var ke=f=>{var O=Rt();B(()=>L(O,`${P(e(I)),n(()=>e(I).school)??""} cantrip`)),v(f,O)},Be=f=>{var O=Rt();B(()=>L(O,`Level ${P(e(I)),n(()=>e(I).level)??""} ${P(e(I)),n(()=>e(I).school)??""}`)),v(f,O)};k(Re,f=>{P(e(I)),n(()=>e(I).level===0)?f(ke):f(Be,!1)})}var Pe=s(Re,2);{var Ee=f=>{var O=Rt("(ritual)");v(f,O)};k(Pe,f=>{P(e(I)),n(()=>e(I).ritual)&&f(Ee)})}l(lt);var He=s(lt,2),ve=s(i(He));l(He);var he=s(He,2),J=i(he),we=s(i(J));l(J);var de=s(J,2),_=s(i(de));l(de);var N=s(de,2),te=s(i(N)),X=s(te);{var ie=f=>{var O=Rt();B(()=>L(O,`(${P(e(I)),n(()=>e(I).material)??""})`)),v(f,O)};k(X,f=>{P(e(I)),n(()=>e(I).material)&&f(ie)})}l(N);var D=s(N,2),H=s(i(D),2);{var z=f=>{var O=Rt("Concentration,");v(f,O)};k(H,f=>{P(e(I)),n(()=>e(I).concentration)&&f(z)})}var fe=s(H,1,!0);l(D),l(he);var Le=s(he,2),nt=i(Le,!0);l(Le);var K=s(Le,2);{var ut=f=>{var O=Fn(),F=s(i(O));l(O),B(()=>L(F,` ${P(e(I)),n(()=>e(I).higherLevelSlot)??""}`)),v(f,O)};k(K,f=>{P(e(I)),n(()=>e(I).higherLevelSlot)&&f(ut)})}var ft=s(K,2);{var bt=f=>{var O=Tn(),F=s(i(O));l(O),B(()=>L(F,` ${P(e(I)),n(()=>e(I).cantripUpgrade)??""}`)),v(f,O)};k(ft,f=>{P(e(I)),n(()=>e(I).cantripUpgrade)&&f(bt)})}B((f,O)=>{L(Xe,(P(e(I)),n(()=>e(I).name))),L(ve,` ${f??""}`),L(we,` ${P(e(I)),n(()=>e(I).castingTime||e(I).actionType)??""}`),L(_,` ${P(e(I)),n(()=>e(I).range)??""}`),L(te,` ${O??""}`),L(fe,(P(e(I)),n(()=>e(I).duration))),L(nt,(P(e(I)),n(()=>e(I).description)))},[()=>(P(e(I)),n(()=>e(I).classes.join(", "))),()=>(P(e(I)),n(()=>e(I).components.join(", ").toUpperCase()))]),v(pe,Fe)},me=pe=>{const I=dt(()=>e(re));var Fe=Pn(),Te=Ue(Fe),Xe=i(Te,!0);l(Te);var lt=s(Te,2);{var Re=Ee=>{var He=In(),ve=s(i(He));l(He),B(()=>L(ve,` ${P(e(I)),n(()=>e(I).prerequisite)??""}`)),v(Ee,He)};k(lt,Ee=>{P(e(I)),n(()=>e(I).prerequisite)&&Ee(Re)})}var ke=s(lt,2),Be=i(ke,!0);l(ke);var Pe=s(ke,2);B(()=>{L(Xe,(P(e(I)),n(()=>e(I).name))),L(Be,(P(e(I)),n(()=>e(I).description))),Ve(Pe,"href",(P(e(I)),n(()=>e(I).source)))}),v(pe,Fe)};k(u,pe=>{e(h)==="spell"?pe(ze):pe(me,!1)})}l(q),v(Se,q)};k(A,Se=>{e(re)&&Se(ce)})}l(Ae),B(()=>{Ge=St(ae,1,"tab svelte-1ngjemu",null,Ge,{active:e(h)==="spell"}),L(qe,`üìú Spells (${e(V),n(()=>e(V).length)??""})`),m=St(Ce,1,"tab svelte-1ngjemu",null,m,{active:e(h)==="feat"}),L(E,`‚≠ê Feats (${e(U),n(()=>e(U).length)??""})`)}),T("click",ae,()=>{o(h,"spell"),o(re,null),o(x,"")}),T("click",Ce,()=>{o(h,"feat"),o(re,null),o(x,"")}),Je(ne,()=>e(x),Se=>o(x,Se)),v(S,W)};k(Oe,S=>{e($)?S(le):S(_e,!1)})}l(Me);var Ie=s(Me,2),C=i(Ie),R=s(C,2);l(Ie),l(je),l(G),B(()=>R.disabled=!e(re)),T("click",oe,function(...S){p()?.apply(this,S)}),T("click",C,function(...S){p()?.apply(this,S)}),T("click",R,ge),T("click",je,Ka(function(S){oa.call(this,r,S)})),T("keydown",je,function(S){oa.call(this,r,S)}),T("click",G,function(...S){p()?.apply(this,S)}),T("keydown",G,S=>S.key==="Escape"&&p()()),v(a,G),Ht()}var On=g('<link rel="icon" type="image/png" href="favicon4.png"/> <meta name="viewport" content="width=device-width, initial-scale=1"/>',1),Gn=g('<span class="character-name svelte-1uha8ag"> </span>'),qn=g("<span> </span>"),Wn=g('<div class="spell-slots-header svelte-1uha8ag"></div>'),zn=g("<span> </span><br/>",1),Kn=g("<span> </span>"),Vn=g('<span class="effect-tooltip"><strong> </strong><br/> <br/> <!> <!></span>'),Jn=g('<button class="effect-remove-btn svelte-1uha8ag">√ó</button>'),Yn=g('<span class="effect-badge svelte-1uha8ag" tabindex="0"> <!> <!></span>'),Qn=g(`<div class="active-effects-header svelte-1uha8ag"></div> <style>.effect-badge {
              position: relative;
            }
            .effect-tooltip {
              position: absolute;
              top: 120%;
              left: 50%;
              transform: translateX(-50%);
              background: #fff;
              color: #222;
              border: 1px solid #a5b4fc;
              border-radius: 6px;
              padding: 8px 12px;
              font-size: 0.95em;
              box-shadow: 0 2px 8px rgba(0, 0, 0, 0.12);
              z-index: 10;
              min-width: 180px;
              max-width: 260px;
              white-space: normal;
              pointer-events: none;
              opacity: 1;
              transition: opacity 0.15s;
            }</style>`,1),Xn=g('<div class="rest-menu svelte-1uha8ag"><button class="rest-option svelte-1uha8ag">‚òï Short Rest</button> <button class="rest-option svelte-1uha8ag">üõèÔ∏è Long Rest</button></div>'),Zn=g('<div class="container svelte-1uha8ag"><header class="svelte-1uha8ag"><div class="header-top svelte-1uha8ag"><div class="header-title svelte-1uha8ag"><div class="title-row svelte-1uha8ag"><h1 class="svelte-1uha8ag">D&D Character Sheet</h1> <!></div> <!> <!></div> <div class="header-right svelte-1uha8ag"><div class="header-controls svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">üé≤</span><span class="btn-text svelte-1uha8ag">Roll Dice</span></button> <div class="rest-button-container svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">üò¥</span><span class="btn-text svelte-1uha8ag">Rest</span></button> <!></div> <div class="mode-toggle"><button><span class="btn-icon svelte-1uha8ag"> </span><span class="btn-text svelte-1uha8ag"> </span></button></div></div> <div class="header-search svelte-1uha8ag"><input type="text" placeholder="üîç Search..." class="search-input use-enabled svelte-1uha8ag"/></div></div></div> <div class="header-actions svelte-1uha8ag"><button class="btn btn-mode svelte-1uha8ag">üìö Browse Spells & Feats</button> <button class="btn btn-secondary">Save to Gist</button> <button class="btn btn-secondary">Load from Gist</button> <button class="btn btn-secondary">Export JSON</button> <button class="btn btn-secondary">Import JSON</button> <input type="file" accept=".json" style="display: none;"/></div></header> <main class="svelte-1uha8ag"><!> <!> <!> <!> <!> <!> <!></main></div> <!> <!> <!> <!>',1);function or(a,r){Et(r,!1);const t=()=>tt(se,"$character",p),c=()=>tt(ta,"$isEditMode",p),d=()=>tt(aa,"$searchFilter",p),[p,h]=zt();function $(){const f=[],O=t().classFeatures.spellSlotsByLevel||{};for(let F=1;F<=9;F++){const De=O[F];if(De&&De.length>0){const ue=De.length,et=De.filter(Ne=>Ne).length;f.push({level:F,available:ue-et,total:ue})}}return f}let x=w(!1),y=w(!1),V=w(!1),U=w("save"),re=w(void 0),Z=w(""),ee=w(""),be=w(""),ge=w(!1),G=w([]),je=w("other"),Ke=w(),oe=!1,Me=1,Oe=w(!1),le=w(null);function _e(f){o(le,f)}function Ie(){o(le,null)}function C(f){o(le,e(le)===f?null:f)}function R(){const f=[];se.update(F=>{const De=F.hitDice.current;F.hitDice.current=Math.min(F.hitDice.max,F.hitDice.current+Math.max(1,Math.floor(F.hitDice.max/2)));const ue=F.hitDice.current-De;if(ue>0&&f.push(`${ue} hit ${ue===1?"die":"dice"}`),F.class){const et=ca(F.class,F.level,F.subclass);F.classFeatures.features||(F.classFeatures.features={}),et.forEach(Ne=>{if(Ne.resetOn==="short"){const gt=Ne.name.replace(/\s+/g,"");if(Ne.type==="uses"){const Ye=typeof Ne.maxUses=="function"?Ne.maxUses(F.level):Ne.maxUses;F.classFeatures.features[gt]=Array(Ye).fill(!1),f.push(Ne.name)}else if(Ne.type==="pool"){const Ye=typeof Ne.maxPool=="function"?Ne.maxPool(F.level):Ne.maxPool;Ye!==void 0&&(F.classFeatures.features[gt]=Ye,f.push(Ne.name))}}})}return F}),o(Oe,!1);const O=f.length>0?`Short rest taken! Restored: ${f.join(", ")}`:"Short rest taken!";Wt.add(O,"success")}function S(){const f=[];se.update(F=>{const De=F.maxHP-F.currentHP;De>0&&f.push(`${De} HP`),F.currentHP=F.maxHP,F.tempHP=0;const ue=F.hitDice.max-F.hitDice.current;ue>0&&f.push(`${ue} hit ${ue===1?"die":"dice"}`),F.hitDice.current=F.hitDice.max;let et=0;if(F.classFeatures.spellSlotsByLevel&&Object.keys(F.classFeatures.spellSlotsByLevel).forEach(Ne=>{const gt=F.classFeatures.spellSlotsByLevel[parseInt(Ne)];if(gt){const Ye=gt.filter(ct=>ct).length;et+=Ye,F.classFeatures.spellSlotsByLevel[parseInt(Ne)]=Array(gt.length).fill(!1)}}),et>0&&f.push(`${et} spell ${et===1?"slot":"slots"}`),F.class){const Ne=ca(F.class,F.level,F.subclass);F.classFeatures.features||(F.classFeatures.features={});let gt=!1;Ne.forEach(Ye=>{const ct=Ye.name.replace(/\s+/g,"");if(!(Ye.type==="info"||Ye.type==="channelDivinity")){if(Ye.type==="uses"){const it=typeof Ye.maxUses=="function"?Ye.maxUses(F.level):Ye.maxUses;F.classFeatures.features[ct]=Array(it).fill(!1),gt=!0}else if(Ye.type==="pool"){const it=typeof Ye.maxPool=="function"?Ye.maxPool(F.level):Ye.maxPool;it!==void 0&&(F.classFeatures.features[ct]=it,gt=!0)}}}),gt&&f.push("all class features")}return F}),o(Oe,!1);const O=f.length>0?`Long rest taken! Restored: ${f.join(", ")}`:"Long rest taken! Fully rested.";Wt.add(O,"success")}function W(f){o(Z,""),o(ee,""),o(be,""),o(ge,!1),o(G,[]),o(je,"other"),oe=!1,typeof f=="string"?o(Z,f):(o(Z,f.notation),o(ee,f.damageNotation||""),o(be,f.attackName||""),o(ge,!!f.applyHalfDamage),o(G,f.bonusBreakdown||[]),o(je,f.rollType||"other")),o(x,!0)}function b(f){const{notation:O,count:F,bonusBreakdown:De}=f.detail;o(Z,""),oe=!0,Me=F||1,setTimeout(()=>{o(Z,O),o(ee,""),o(be,"Hit Die"),o(G,De||[]),o(je,"other")},0),o(x,!0)}function j(){if(o(x,!1),oe&&e(Ke)){const f=e(Ke).getLastRollTotal();if(f!==null){const O=Math.max(1,f);se.update(F=>(F.hitDice.current=Math.max(0,F.hitDice.current-Me),F.currentHP=Math.min(F.maxHP,F.currentHP+O),F))}oe=!1}}function ae(){ta.update(f=>!f)}function Ge(f){f.target.closest(".rest-button-container")||o(Oe,!1)}va(()=>{const f=ta.subscribe(O=>{O?document.body.classList.remove("use-mode"):document.body.classList.add("use-mode")});return document.addEventListener("click",Ge),()=>{f(),document.removeEventListener("click",Ge)}});function qe(){Us(t())}function Ce(){e(re)?.click()}async function m(f){const F=f.target.files?.[0];if(F)try{const De=await Os(F);se.set(De),alert("Character imported successfully!")}catch{alert("Failed to import character file")}}Pt();var E=Zn();Hs("1uha8ag",f=>{var O=On();ia(2),cs(()=>{Is.title="D&D Character Sheet"}),v(f,O)});var Q=Ue(E),ne=i(Q),Y=i(ne),ye=i(Y),Ae=i(ye),st=s(i(Ae),2);{var xe=f=>{var O=Gn(),F=i(O);l(O),B(()=>L(F,`${t().name??""} (${t().level??""})`)),v(f,O)};k(st,f=>{t().name&&f(xe)})}l(Ae);var We=s(Ae,2);{var M=f=>{var O=Wn();$t(O,5,$,wt,(F,De)=>{var ue=qn();let et;var Ne=i(ue);l(ue),B(()=>{et=St(ue,1,"slot-badge svelte-1uha8ag",null,et,{depleted:e(De).available===0}),L(Ne,`Lv${e(De).level??""}: ${e(De).available??""}/${e(De).total??""}`)}),v(F,ue)}),l(O),v(f,O)};k(We,f=>{$().length>0&&f(M)})}var A=s(We,2);{var ce=f=>{var O=Qn(),F=Ue(O);$t(F,5,()=>t().activeStates,wt,(De,ue,et)=>{var Ne=Yn(),gt=i(Ne),Ye=s(gt);{var ct=mt=>{var ht=Vn(),Ze=i(ht),at=i(Ze,!0);l(Ze);var pt=s(Ze,2),At=s(pt,3);{var Gt=Ct=>{var Mt=zn(),Nt=Ue(Mt),_t=i(Nt);l(Nt),ia(),B(()=>L(_t,`Attack Bonus: ${typeof e(ue).attackBonus=="number"&&e(ue).attackBonus>0?"+":""}${e(ue).attackBonus??""}`)),v(Ct,Mt)};k(At,Ct=>{e(ue).attackBonus&&Ct(Gt)})}var qt=s(At,2);{var Tt=Ct=>{var Mt=Kn(),Nt=i(Mt);l(Mt),B(()=>L(Nt,`Damage Bonus: ${typeof e(ue).damageBonus=="number"&&e(ue).damageBonus>0?"+":""}${e(ue).damageBonus??""}`)),v(Ct,Mt)};k(qt,Ct=>{e(ue).damageBonus&&Ct(Tt)})}l(ht),B(()=>{L(at,e(ue).name),L(pt,` ${e(ue).description??""}`)}),v(mt,ht)};k(Ye,mt=>{e(le)===et&&mt(ct)})}var it=s(Ye,2);{var vt=mt=>{var ht=Jn();B(()=>Ve(ht,"title",`End ${e(ue).name??""}`)),T("click",ht,()=>{se.update(Ze=>{if(Ze.activeStates){const at=Ze.activeStates[et];at?.hpBonus&&at.target!=="other"&&(Ze.maxHP-=at.hpBonus,Ze.currentHP=Math.max(1,Math.min(Ze.currentHP-at.hpBonus,Ze.maxHP))),Ze.activeStates=Ze.activeStates.filter((pt,At)=>At!==et)}return Ze})}),v(mt,ht)};k(it,mt=>{c()||mt(vt)})}l(Ne),B(()=>{Ve(Ne,"aria-label",e(ue).name),L(gt,`‚ú® ${e(ue).name??""} `)}),T("mouseenter",Ne,()=>_e(et)),T("mouseleave",Ne,Ie),T("focus",Ne,()=>_e(et)),T("blur",Ne,Ie),T("click",Ne,()=>C(et)),v(De,Ne)}),l(F),ia(2),v(f,O)};k(A,f=>{t().activeStates&&t().activeStates.length>0&&f(ce)})}l(ye);var Se=s(ye,2),q=i(Se),u=i(q),ze=s(u,2),me=i(ze),pe=s(me,2);{var I=f=>{var O=Xn(),F=i(O),De=s(F,2);l(O),T("click",F,R),T("click",De,S),v(f,O)};k(pe,f=>{e(Oe)&&f(I)})}l(ze);var Fe=s(ze,2),Te=i(Fe);let Xe;var lt=i(Te),Re=i(lt,!0);l(lt);var ke=s(lt),Be=i(ke,!0);l(ke),l(Te),l(Fe),l(q);var Pe=s(q,2),Ee=i(Pe);$e(Ee),l(Pe),l(Se),l(Y);var He=s(Y,2),ve=i(He),he=s(ve,2),J=s(he,2),we=s(J,2),de=s(we,2),_=s(de,2);ya(_,f=>o(re,f),()=>e(re)),l(He),l(ne);var N=s(ne,2),te=i(N);rl(te,{});var X=s(te,2);dl(X,{$$events:{roll:f=>W(f.detail)}});var ie=s(X,2);Al(ie,{$$events:{roll:f=>W(f.detail)}});var D=s(ie,2);wl(D,{$$events:{rollHitDice:b}});var H=s(D,2);ki(H,{$$events:{roll:f=>W(f.detail)}});var z=s(H,2);Ni(z,{});var fe=s(z,2);Gi(fe,{}),l(N),l(Q);var Le=s(Q,2);ya(ln(Le,{get notation(){return e(Z)},get damageNotation(){return e(ee)},get attackName(){return e(be)},get applyHalfDamage(){return e(ge)},get bonusBreakdown(){return e(G)},get rollType(){return e(je)},get visible(){return e(x)},$$events:{close:j},$$legacy:!0}),f=>o(Ke,f),()=>e(Ke));var nt=s(Le,2);{var K=f=>{Cn(f,{get mode(){return e(U)},$$events:{close:()=>o(y,!1)}})};k(nt,f=>{e(y)&&f(K)})}var ut=s(nt,2);{var ft=f=>{Un(f,{onClose:()=>o(V,!1)})};k(ut,f=>{e(V)&&f(ft)})}var bt=s(ut,2);Ns(bt,{}),B(()=>{Xe=St(Te,1,"btn btn-mode svelte-1uha8ag",null,Xe,{"use-mode":!c()}),L(Re,c()?"üìù":"üé≤"),L(Be,c()?"Edit Mode":"Use Mode")}),T("click",u,()=>{o(G,[]),o(x,!0)}),T("click",me,()=>o(Oe,!e(Oe))),T("click",Te,ae),Je(Ee,d,f=>Gs(aa,f)),T("click",ve,()=>o(V,!0)),T("click",he,()=>{o(U,"save"),o(y,!0)}),T("click",J,()=>{o(U,"load"),o(y,!0)}),T("click",we,qe),T("click",de,Ce),T("change",_,m),v(a,E),Ht(),h()}export{or as component};
