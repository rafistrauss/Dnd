import{d as $s,g as Ks,f as u,e as A,a as o,s as k,c as wt,t as Tt}from"../chunks/BESELRjb.js";import{i as Jt}from"../chunks/JMgyEzd3.js";import{c as xa,o as Ca,a as Js,b as Vs}from"../chunks/CtPH092J.js";import{F as D,T as ya,Y as us,j as Ys,aZ as Qs,U as ks,ag as Xs,aD as Zs,aK as el,aE as tl,a1 as al,av as Ga,a7 as hs,i as Ps,a_ as sl,a$ as Is,b0 as Qa,K as ka,e as Es,b1 as Ns,b2 as ll,b3 as rl,b4 as il,q as fs,b5 as nl,b6 as ol,ab as cl,d as i,r as _s,g as vl,C as Vt,G as Yt,H as l,I as s,J as a,b7 as et,b8 as ga,s as n,a4 as S,f as e,m as xt,E as De,b9 as Kt,ao as ta,A as E,ba as _a,bb as wa,bc as dl}from"../chunks/DyJ43TGI.js";import{t as ul,c as la,a as fe,e as Lt,i as Rt,u as Us,s as $a,b as Et,d as Xa,f as Sa,g as Va,j as fl,k as Ht,l as pl,m as ws,n as rs,o as ml,h as gl,T as bl,p as hl,r as Ss,q as Cs}from"../chunks/B3ppLN4c.js";import{i as g,s as fa,a as _t,b as Ot,d as Pa,e as _l}from"../chunks/CCL4udNy.js";import{p as Bt,b as Na}from"../chunks/iXw84bXb.js";import{b as Ia,r as yl}from"../chunks/BlT3z3GO.js";function ps(r,c,t=!1,v=!1,f=!1){var p=r,m="";D(()=>{var w=Ys;if(m===(m=c()??"")){ya&&us();return}if(w.nodes_start!==null&&(Qs(w.nodes_start,w.nodes_end),w.nodes_start=w.nodes_end=null),m!==""){if(ya){ks.data;for(var h=us(),_=h;h!==null&&(h.nodeType!==Xs||h.data!=="");)_=h,h=Zs(h);if(h===null)throw el(),tl;$s(ks,_),p=al(h);return}var G=m+"";t?G=`<svg>${G}</svg>`:v&&(G=`<math>${G}</math>`);var F=Ks(G);if((t||v)&&(F=Ga(F)),$s(Ga(F),F.lastChild),t||v)for(;Ga(F);)p.before(Ga(F));else p.before(F)}})}function xl(r,c,t,v,f){ya&&us();var p=c.$$slots?.[t],m=!1;p===!0&&(p=c[t],m=!0),p===void 0?f!==null&&f(r):p(r,m?()=>v:v)}function $l(r,c,t,v){var f=r.__style;if(ya||f!==c){var p=ul(c);(!ya||p!==r.getAttribute("style"))&&(p==null?r.removeAttribute("style"):r.style.cssText=p),r.__style=c}return v}function Ya(r,c,t=!1){if(r.multiple){if(c==null)return;if(!Ps(c))return sl();for(var v of r.options)v.selected=c.includes(Ea(v));return}for(v of r.options){var f=Ea(v);if(Is(f,c)){v.selected=!0;return}}(!t||c!==void 0)&&(r.selectedIndex=-1)}function ms(r){var c=new MutationObserver(()=>{Ya(r,r.__value)});c.observe(r,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),hs(()=>{c.disconnect()})}function Ua(r,c,t=c){var v=new WeakSet,f=!0;Qa(r,"change",p=>{var m=p?"[selected]":":checked",w;if(r.multiple)w=[].map.call(r.querySelectorAll(m),Ea);else{var h=r.querySelector(m)??r.querySelector("option:not([disabled])");w=h&&Ea(h)}t(w),ka!==null&&v.add(ka)}),Es(()=>{var p=c();if(r===document.activeElement){var m=Ns??ka;if(v.has(m))return}if(Ya(r,p,f),f&&p===void 0){var w=r.querySelector(":checked");w!==null&&(p=Ea(w),t(p))}r.__value=p,f=!1}),ms(r)}function Ea(r){return"__value"in r?r.__value:r.value}const kl=Symbol("is custom element"),wl=Symbol("is html");function Ce(r){if(ya){var c=!1,t=()=>{if(!c){if(c=!0,r.hasAttribute("value")){var v=r.value;ct(r,"value",null),r.value=v}if(r.hasAttribute("checked")){var f=r.checked;ct(r,"checked",null),r.checked=f}}};r.__on_r=t,fs(t),nl()}}function Ra(r,c){var t=ys(r);t.value===(t.value=c??void 0)||r.value===c&&(c!==0||r.nodeName!=="PROGRESS")||(r.value=c??"")}function Hs(r,c){var t=ys(r);t.checked!==(t.checked=c??void 0)&&(r.checked=c)}function ct(r,c,t,v){var f=ys(r);ya&&(f[c]=r.getAttribute(c),c==="src"||c==="srcset"||c==="href"&&r.nodeName==="LINK")||f[c]!==(f[c]=t)&&(c==="loading"&&(r[ll]=t),t==null?r.removeAttribute(c):typeof t!="string"&&Sl(r).includes(c)?r[c]=t:r.setAttribute(c,t))}function ys(r){return r.__attributes??={[kl]:r.nodeName.includes("-"),[wl]:r.namespaceURI===rl}}var Ds=new Map;function Sl(r){var c=r.getAttribute("is")||r.nodeName,t=Ds.get(c);if(t)return t;Ds.set(c,t=[]);for(var v,f=r,p=Element.prototype;p!==f;){v=ol(f);for(var m in v)v[m].set&&t.push(m);f=il(f)}return t}function We(r,c,t=c){var v=new WeakSet;Qa(r,"input",async f=>{var p=f?r.defaultValue:r.value;if(p=ns(r)?os(p):p,t(p),ka!==null&&v.add(ka),await cl(),p!==(p=c())){var m=r.selectionStart,w=r.selectionEnd,h=r.value.length;if(r.value=p??"",w!==null){var _=r.value.length;m===w&&w===h&&_>h?(r.selectionStart=_,r.selectionEnd=_):(r.selectionStart=m,r.selectionEnd=Math.min(w,_))}}}),(ya&&r.defaultValue!==r.value||i(c)==null&&r.value)&&(t(ns(r)?os(r.value):r.value),ka!==null&&v.add(ka)),_s(()=>{var f=c();if(r===document.activeElement){var p=Ns??ka;if(v.has(p))return}ns(r)&&f===os(r.value)||r.type==="date"&&!f&&!r.value||f!==r.value&&(r.value=f??"")})}const is=new Set;function Ls(r,c,t,v,f=v){var p=t.getAttribute("type")==="checkbox",m=r;let w=!1;if(c!==null)for(var h of c)m=m[h]??=[];m.push(t),Qa(t,"change",()=>{var _=t.__value;p&&(_=As(m,_,t.checked)),f(_)},()=>f(p?[]:null)),_s(()=>{var _=v();if(ya&&t.defaultChecked!==t.checked){w=!0;return}p?(_=_||[],t.checked=_.includes(t.__value)):t.checked=Is(t.__value,_)}),hs(()=>{var _=m.indexOf(t);_!==-1&&m.splice(_,1)}),is.has(m)||(is.add(m),fs(()=>{m.sort((_,G)=>_.compareDocumentPosition(G)===4?-1:1),is.delete(m)})),fs(()=>{if(w){var _;if(p)_=As(m,_,t.checked);else{var G=m.find(F=>F.checked);_=G?.__value}f(_)}})}function ja(r,c,t=c){Qa(r,"change",v=>{var f=v?r.defaultChecked:r.checked;t(f)}),(ya&&r.defaultChecked!==r.checked||i(c)==null)&&t(r.checked),_s(()=>{var v=c();r.checked=!!v})}function As(r,c,t){for(var v=new Set,f=0;f<r.length;f+=1)r[f].checked&&v.add(r[f].__value);return t||v.delete(c),Array.from(v)}function ns(r){var c=r.type;return c==="number"||c==="range"}function os(r){return r===""?null:+r}function Cl(r,c,t){var v=vl(r,c);v&&v.set&&(r[c]=t,hs(()=>{r[c]=null}))}function xs(r){return function(...c){var t=c[0];return t.stopPropagation(),r?.apply(this,c)}}function Ma(r,c){var t=r.$$events?.[c.type],v=Ps(t)?t.slice():t==null?[]:[t];for(var f of v)f.call(this,c)}const Dl="";function Os(...r){return Ia+Dl+yl(r[0],r[1])}const gs={paladin:{name:"Paladin",hitDice:"d10",spellcaster:!0,spellcastingAbility:"charisma",spellSlotsByLevel:{1:0,2:2,3:3,4:3,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Divine Sense",type:"uses",maxUses:(r,c=1)=>1+Math.max(1,c),resetOn:"long",description:"Detect celestials, fiends, and undead within 60 feet",minLevel:1},{name:"Lay on Hands",type:"pool",maxPool:r=>r*5,resetOn:"long",description:"Heal wounds or cure disease",minLevel:1},{name:"Divine Smite",type:"spellSlot",description:"Expend spell slot to deal extra radiant damage",minLevel:2,rollable:!0},{name:"Channel Divinity",type:"pool",maxPool:r=>r>=18?3:r>=6?2:1,resetOn:"short",description:"Sacred Weapon or Turn Undead",minLevel:3}]},fighter:{name:"Fighter",hitDice:"d10",spellcaster:!1,features:[{name:"Second Wind",type:"uses",maxUses:1,resetOn:"short",description:"Regain 1d10 + fighter level HP as bonus action",minLevel:1,rollable:!0,rollFormula:r=>`1d10+${r}`},{name:"Action Surge",type:"uses",maxUses:r=>r>=17?2:1,resetOn:"short",description:"Take one additional action on your turn",minLevel:2},{name:"Indomitable",type:"uses",maxUses:r=>r>=17?3:r>=13?2:1,resetOn:"long",description:"Reroll a failed saving throw",minLevel:9}],subclasses:{champion:{name:"Champion",features:[{name:"Improved Critical",type:"info",description:"Critical hit on 19-20",minLevel:3},{name:"Remarkable Athlete",type:"info",description:"Add half proficiency to STR/DEX/CON checks, increase long jump distance",minLevel:7},{name:"Additional Fighting Style",type:"info",description:"Choose a second fighting style",minLevel:10},{name:"Superior Critical",type:"info",description:"Critical hit on 18-20",minLevel:15},{name:"Survivor",type:"info",description:"Regain 5 + CON mod HP at start of turn if below half HP",minLevel:18}]},battlemaster:{name:"Battle Master",features:[{name:"Combat Superiority",type:"uses",maxUses:r=>r>=15?6:r>=7?5:4,resetOn:"short",description:r=>`Use superiority dice (${r>=18?"d12":r>=10?"d10":"d8"}) for maneuvers`,minLevel:3},{name:"Know Your Enemy",type:"info",description:"Learn capabilities of creatures you observe",minLevel:7},{name:"Improved Combat Superiority",type:"info",description:"Superiority dice become d10",minLevel:10},{name:"Relentless",type:"info",description:"Regain 1 superiority die if you have none at start of turn",minLevel:15}]}}},rogue:{name:"Rogue",hitDice:"d8",spellcaster:!1,features:[{name:"Sneak Attack",type:"info",description:r=>`Deal ${Math.ceil(r/2)}d6 extra damage once per turn with advantage or ally nearby`,minLevel:1,rollable:!0,rollFormula:r=>`${Math.ceil(r/2)}d6`},{name:"Cunning Action",type:"info",description:"Dash, Disengage, or Hide as a bonus action",minLevel:2},{name:"Uncanny Dodge",type:"info",description:"Use reaction to halve damage from an attack",minLevel:5},{name:"Evasion",type:"info",description:"Take no damage on successful Dex save (half on fail)",minLevel:7}]},wizard:{name:"Wizard",hitDice:"d6",spellcaster:!0,spellcastingAbility:"intelligence",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Arcane Recovery",type:"uses",maxUses:1,resetOn:"long",description:r=>`Recover spell slots totaling up to ${Math.ceil(r/2)} levels during short rest`,minLevel:1},{name:"Spell Mastery",type:"info",description:"Cast one 1st-level and one 2nd-level spell at will",minLevel:18}]},cleric:{name:"Cleric",hitDice:"d8",spellcaster:!0,spellcastingAbility:"wisdom",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Channel Divinity",type:"pool",maxPool:r=>r>=18?4:r>=6?3:2,resetOn:"short",description:"Turn Undead or domain-specific ability",minLevel:2},{name:r=>r>=5?"Sear Undead":"Turn Undead",subName:r=>r>=5?"Improved Turn Undead":null,type:"channelDivinity",description:(r,c=1)=>{let t="As a Magic action, you present your Holy Symbol and censure Undead creatures. Each Undead of your choice within 30 feet of you must make a Wisdom saving throw. If the creature fails its save, it has the Frightened and Incapacitated conditions for 1 minute. For that duration, it tries to move as far from you as it can on its turns. This effect ends early on the creature if it takes any damage, if you have the Incapacitated condition, or if you die.";if(r>=5){const v=Math.max(1,c);t+=` <br /><br />
            
          With Sear Undead, roll ${v}d8 radiant damage to turned undead.`}return t},minLevel:2,rollable:!0,rollFormula:(r,c=1)=>r>=5?`${Math.max(1,c)}d8`:""},{name:"Divine Intervention",type:"uses",maxUses:1,resetOn:"long",description:r=>`${r}% chance to succeed, implore deity for aid`,minLevel:10}],subclasses:{war:{name:"War Domain",features:[{name:"War Priest",type:"uses",maxUses:(r,c=1)=>Math.max(1,c),resetOn:"long",description:"Make one weapon attack as a bonus action",minLevel:1},{name:"Channel Divinity",type:"info",description:"Additional Channel Divinity options from War Domain",minLevel:2,subFeatures:[{name:"Guided Strike",type:"channelDivinity",description:"Use your Channel Divinity to gain +10 to an attack roll. Make this choice after you see the roll, but before the DM says whether the attack hits or misses.",minLevel:2},{name:"War God's Blessing",type:"channelDivinity",description:"Use reaction to grant +10 to an ally's attack roll within 30 feet. Consumes one use of Channel Divinity.",minLevel:6,resetOn:"short"}]},{name:"Divine Strike",type:"info",description:r=>`Deal extra ${r>=14?"2d8":"1d8"} weapon damage once per turn`,minLevel:8,rollable:!0,rollFormula:r=>r>=14?"2d8":"1d8"},{name:"Avatar of Battle",type:"info",description:"Gain resistance to nonmagical weapon damage",minLevel:17}]},life:{name:"Life Domain",features:[{name:"Disciple of Life",type:"info",description:"Healing spells restore additional 2 + spell level HP",minLevel:1},{name:"Preserve Life",type:"pool",maxPool:r=>r*5,resetOn:"short",description:"Restore HP to creatures within 30 feet",minLevel:2},{name:"Blessed Healer",type:"info",description:"Regain 2 + spell level HP when you cast healing spell",minLevel:6},{name:"Divine Strike",type:"info",description:r=>`Deal extra ${r>=14?"2d8":"1d8"} radiant damage once per turn`,minLevel:8,rollable:!0,rollFormula:r=>r>=14?"2d8":"1d8"},{name:"Supreme Healing",type:"info",description:"Maximize healing dice instead of rolling",minLevel:17}]}}},barbarian:{name:"Barbarian",hitDice:"d12",spellcaster:!1,features:[{name:"Rage",type:"uses",maxUses:r=>r>=20?1/0:r>=17?6:r>=12?5:r>=6?4:r>=3?3:2,resetOn:"long",description:r=>`+${r>=16?4:r>=9?3:2} damage, resistance to physical damage`,minLevel:1},{name:"Reckless Attack",type:"info",description:"Gain advantage on melee attacks, enemies get advantage on you",minLevel:2},{name:"Danger Sense",type:"info",description:"Advantage on Dex saves against effects you can see",minLevel:2}],subclasses:{berserker:{name:"Path of the Berserker",features:[{name:"Frenzy",type:"info",description:"While raging, make melee attack as bonus action (gain 1 exhaustion after rage)",minLevel:3},{name:"Mindless Rage",type:"info",description:"Cannot be charmed or frightened while raging",minLevel:6},{name:"Intimidating Presence",type:"info",description:"Use action to frighten creature within 30 feet",minLevel:10},{name:"Retaliation",type:"info",description:"When damaged by creature within 5 feet, make melee attack as reaction",minLevel:14}]}}}};function ua(r){const c=r.toLowerCase();return gs[c]||null}function Ta(r,c,t){const v=ua(r);if(!v)return[];const f=v.features.filter(p=>!p.minLevel||p.minLevel<=c);if(t&&v.subclasses&&v.subclasses[t]){const p=v.subclasses[t].features.filter(m=>!m.minLevel||m.minLevel<=c);return[...f,...p]}return f}function js(r){const c=ua(r);return!c||!c.subclasses?[]:Object.keys(c.subclasses).map(t=>({id:t,name:c.subclasses[t].name}))}function Bs(r,c){const t=ua(r);return!t||!t.spellcaster||!t.spellSlotsByLevel?0:t.spellSlotsByLevel[c]||0}function Rs(r,c,t){const v=ua(r);return!v||!v.spellcaster?0:Math.max(1,t+c)}function Ll(r,c,t){const v=ua(r);return!v||!v.spellcaster?null:8+c+t}function Al(){return Object.keys(gs).map(r=>({id:r,name:gs[r].name}))}var jl=u('<div class="section-header svelte-ls99y2" role="button" tabindex="0"><h2 class="svelte-ls99y2"> </h2> <span class="collapse-btn svelte-ls99y2"> </span></div>');function Da(r,c){Vt(c,!1);let t=Bt(c,"title",8),v=Bt(c,"collapsed",8),f=Bt(c,"ariaLabel",8,""),p=Bt(c,"onToggle",8);Jt();var m=jl(),w=l(m),h=l(w,!0);s(w);var _=a(w,2),G=l(_,!0);s(_),s(m),D(()=>{ct(m,"aria-expanded",!v()),ct(m,"aria-label",f()),k(h,t()),k(G,v()?"‚ñº":"‚ñ≤")}),A("click",m,function(...F){p()?.apply(this,F)}),A("keydown",m,F=>{(F.key==="Enter"||F.key===" ")&&p()()}),o(r,m),Yt()}var Bl=u("<option> </option>"),Rl=u("<option> </option>"),Ml=u('<div class="form-group svelte-172i2fj"><label for="characterSubclass" class="svelte-172i2fj">Subclass</label> <select id="characterSubclass" class="svelte-172i2fj"><option>Select Subclass</option><!></select></div>'),Tl=u('<div class="info-grid svelte-172i2fj"><div class="form-group svelte-172i2fj"><label for="characterName" class="svelte-172i2fj">Character Name</label> <input type="text" id="characterName" placeholder="Enter name" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterClass" class="svelte-172i2fj">Class</label> <select id="characterClass" class="svelte-172i2fj"><option>Select Class</option><!></select></div> <!> <div class="form-group svelte-172i2fj"><label for="characterLevel" class="svelte-172i2fj">Level</label> <input type="number" id="characterLevel" min="1" max="20" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterRace" class="svelte-172i2fj">Race</label> <input type="text" id="characterRace" placeholder="e.g., Human" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterBackground" class="svelte-172i2fj">Background</label> <input type="text" id="characterBackground" placeholder="e.g., Soldier" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterAlignment" class="svelte-172i2fj">Alignment</label> <input type="text" id="characterAlignment" placeholder="e.g., Lawful Good" class="svelte-172i2fj"/></div></div>'),Fl=u('<section class="character-info svelte-172i2fj"><!> <!></section>');function Pl(r,c){Vt(c,!1);const t=()=>_t(fe,"$character",f),v=()=>_t(la,"$collapsedStates",f),[f,p]=fa(),m=S(),w=Al();function h(N){const R=N.target;fe.update(P=>(P.class=R.value,P.subclass="",P))}function _(N){const R=N.target;fe.update(P=>(P.subclass=R.value,P))}function G(N){const R=N.target;fe.update(P=>(P.level=parseInt(R.value)||1,P)),Us()}et(()=>(t(),js),()=>{n(m,t().class?js(t().class):[])}),ga(),Jt();var F=Fl(),Z=l(F);{let N=xt(()=>(v(),i(()=>v().characterInfo?"Expand":"Collapse")));Da(Z,{title:"Character Info",get collapsed(){return v(),i(()=>v().characterInfo)},get ariaLabel(){return e(N)},onToggle:()=>la.update(R=>({...R,characterInfo:!R.characterInfo}))})}var K=a(Z,2);{var Y=N=>{var R=Tl(),P=l(R),re=a(l(P),2);Ce(re),s(P);var pe=a(P,2),Ue=a(l(pe),2),ne=l(Ue);ne.value=ne.__value="";var ie=a(ne);Lt(ie,1,()=>w,Rt,(_e,me)=>{var we=Bl(),y=l(we,!0);s(we);var q={};D(()=>{k(y,(e(me),i(()=>e(me).name))),q!==(q=(e(me),i(()=>e(me).id)))&&(we.value=(we.__value=(e(me),i(()=>e(me).id)))??"")}),o(_e,we)}),s(Ue);var J;ms(Ue),s(pe);var ye=a(pe,2);{var Fe=_e=>{var me=Ml(),we=a(l(me),2),y=l(we);y.value=y.__value="";var q=a(y);Lt(q,1,()=>e(m),Rt,(ft,ut)=>{var yt=Rl(),St=l(yt,!0);s(yt);var Ct={};D(()=>{k(St,(e(ut),i(()=>e(ut).name))),Ct!==(Ct=(e(ut),i(()=>e(ut).id)))&&(yt.value=(yt.__value=(e(ut),i(()=>e(ut).id)))??"")}),o(ft,yt)}),s(we);var Pe;ms(we),s(me),D(()=>{Pe!==(Pe=(t(),i(()=>t().subclass)))&&(we.value=(we.__value=(t(),i(()=>t().subclass)))??"",Ya(we,(t(),i(()=>t().subclass))))}),A("change",we,_),o(_e,me)};g(ye,_e=>{e(m),i(()=>e(m).length>0)&&_e(Fe)})}var M=a(ye,2),T=a(l(M),2);Ce(T),s(M);var x=a(M,2),Q=a(l(x),2);Ce(Q),s(x);var z=a(x,2),he=a(l(z),2);Ce(he),s(z);var $e=a(z,2),ke=a(l($e),2);Ce(ke),s($e),s(R),D(()=>{J!==(J=(t(),i(()=>t().class)))&&(Ue.value=(Ue.__value=(t(),i(()=>t().class)))??"",Ya(Ue,(t(),i(()=>t().class)))),Ra(T,(t(),i(()=>t().level)))}),We(re,()=>t().name,_e=>Ot(fe,i(t).name=_e,i(t))),A("change",Ue,h),A("change",T,G),We(Q,()=>t().race,_e=>Ot(fe,i(t).race=_e,i(t))),We(he,()=>t().background,_e=>Ot(fe,i(t).background=_e,i(t))),We(ke,()=>t().alignment,_e=>Ot(fe,i(t).alignment=_e,i(t))),o(N,R)};g(K,N=>{v(),i(()=>!v().characterInfo)&&N(Y)})}s(F),o(r,F),Yt(),p()}var Il=u('<div class="ability-card svelte-bbv1xt"><h3 class="svelte-bbv1xt"> </h3> <input type="number" class="ability-score svelte-bbv1xt" min="1" max="30"/> <div class="ability-modifier svelte-bbv1xt"> </div> <div class="roll-buttons svelte-bbv1xt"><button class="roll-btn svelte-bbv1xt">Check</button> <button class="roll-btn svelte-bbv1xt">Save</button></div> <div class="save-proficiency svelte-bbv1xt"><input type="checkbox" class="svelte-bbv1xt"/> <label class="svelte-bbv1xt">Save Prof.</label></div></div>'),El=u('<div class="proficiency-bonus svelte-bbv1xt"><label for="profBonus">Proficiency Bonus</label> <input type="number" id="profBonus" class="prof-input svelte-bbv1xt"/></div> <div class="abilities-grid svelte-bbv1xt"></div>',1),Nl=u("<section><!> <!></section>");function Ul(r,c){Vt(c,!1);const t=()=>_t(Xa,"$abilityModifiers",w),v=()=>_t(fe,"$character",w),f=()=>_t($a,"$searchFilter",w),p=()=>_t(la,"$collapsedStates",w),m=()=>_t(Sa,"$isEditMode",w),[w,h]=fa(),_=S(),G=S(),F=xa(),Z=[{key:"strength",label:"Strength"},{key:"dexterity",label:"Dexterity"},{key:"constitution",label:"Constitution"},{key:"intelligence",label:"Intelligence"},{key:"wisdom",label:"Wisdom"},{key:"charisma",label:"Charisma"}];function K(){Us()}function Y(ne){const ie=t()[ne],J=`1d20${ie>=0?"+":""}${ie}`,ye=[];ye.push({value:"1d20",source:"base die"}),ie!==0&&ye.push({value:ie,source:ne}),F("roll",{notation:J,rollType:"check",bonusBreakdown:ye})}function N(ne){const ie=t()[ne],J=v().saveProficiencies[ne]?v().proficiencyBonus:0,ye=ie+J,Fe=`1d20${ye>=0?"+":""}${ye}`,M=[];M.push({value:"1d20",source:"base die"}),ie!==0&&M.push({value:ie,source:ne}),J!==0&&M.push({value:J,source:"proficiency"}),F("roll",{notation:Fe,rollType:"save",bonusBreakdown:M})}et(()=>f(),()=>{n(_,Z.filter(({label:ne})=>f()?ne.toLowerCase().includes(f().toLowerCase()):!0))}),et(()=>(e(_),f()),()=>{n(G,e(_).length>0||!f()||f().toLowerCase().includes("proficiency"))}),ga(),Jt();var R=Nl();let P;var re=l(R);Da(re,{title:"Ability Scores",get collapsed(){return p(),i(()=>p().abilityScores)},ariaLabel:"Toggle Ability Scores Section",onToggle:()=>la.update(ne=>({...ne,abilityScores:!ne.abilityScores}))});var pe=a(re,2);{var Ue=ne=>{var ie=El(),J=De(ie),ye=a(l(J),2);Ce(ye),s(J);var Fe=a(J,2);Lt(Fe,5,()=>e(_),Rt,(M,T)=>{let x=()=>e(T).key,Q=()=>e(T).label;var z=Il(),he=l(z),$e=l(he,!0);s(he);var ke=a(he,2);Ce(ke);var _e=a(ke,2),me=l(_e);s(_e);var we=a(_e,2),y=l(we),q=a(y,2);s(we);var Pe=a(we,2),ft=l(Pe);Ce(ft);var ut=a(ft,2);s(Pe),s(z),D(yt=>{k($e,yt),k(me,`${t(),x(),i(()=>t()[x()]>=0?"+":"")??""}${t(),x(),i(()=>t()[x()])??""}`),ft.disabled=!m(),ct(ft,"id",`${x()}-save`),ct(ut,"for",`${x()}-save`)},[()=>(Q(),i(()=>Q().substring(0,3).toUpperCase()))]),We(ke,()=>v().abilities[x()],yt=>Ot(fe,i(v).abilities[x()]=yt,i(v))),A("change",ke,K),A("click",y,()=>Y(x())),A("click",q,()=>N(x())),ja(ft,()=>v().saveProficiencies[x()],yt=>Ot(fe,i(v).saveProficiencies[x()]=yt,i(v))),o(M,z)}),s(Fe),We(ye,()=>v().proficiencyBonus,M=>Ot(fe,i(v).proficiencyBonus=M,i(v))),o(ne,ie)};g(pe,ne=>{p(),i(()=>!p().abilityScores)&&ne(Ue)})}s(R),D(()=>P=Et(R,1,"ability-scores svelte-bbv1xt",null,P,{hidden:!e(G)})),o(r,R),Yt(),h()}const Gs=[{name:"Unarmored",type:"none",baseAC:10},{name:"Padded",type:"light",baseAC:11},{name:"Leather",type:"light",baseAC:11},{name:"Studded Leather",type:"light",baseAC:12},{name:"Hide",type:"medium",baseAC:12,maxDexBonus:2},{name:"Chain Shirt",type:"medium",baseAC:13,maxDexBonus:2},{name:"Scale Mail",type:"medium",baseAC:14,maxDexBonus:2},{name:"Breastplate",type:"medium",baseAC:14,maxDexBonus:2},{name:"Half Plate",type:"medium",baseAC:15,maxDexBonus:2},{name:"Ring Mail",type:"heavy",baseAC:14,maxDexBonus:0},{name:"Chain Mail",type:"heavy",baseAC:16,maxDexBonus:0},{name:"Splint",type:"heavy",baseAC:17,maxDexBonus:0},{name:"Plate",type:"heavy",baseAC:18,maxDexBonus:0}];function qs(r){return Gs.find(c=>c.name===r)}function Hl(r,c,t){if(!r)return 10+c+(t?2:0);const v=qs(r);if(!v)return 10+c+(t?2:0);let f=v.baseAC;return v.maxDexBonus===void 0?f+=c:v.maxDexBonus>0&&(f+=Math.min(c,v.maxDexBonus)),t&&(f+=2),f}function Ha(r){return Math.floor((r-10)/2)}function bs(r,c){if(!r.class)return null;const t=ua(r.class);if(!t||!t.spellcaster||!t.spellcastingAbility)return null;const v=Ha(c[t.spellcastingAbility]);return 8+r.proficiencyBonus+v}function cs(r,c){if(!r.class)return 0;const t=ua(r.class);return!t||!t.spellcaster||!t.spellcastingAbility?0:Ha(c[t.spellcastingAbility])}function Ol(r,c){const t=[],v=Ha(c.dexterity),f=r.armorName?qs(r.armorName):void 0;if(f){if(f.type==="none")t.push("Unarmored"),t.push("Base: 10"),t.push(`Dexterity: ${v>=0?"+":""}${v}`);else if(f.type==="light")t.push(`${f.name}: ${f.baseAC}`),t.push(`Dexterity: ${v>=0?"+":""}${v}`);else if(f.type==="medium"){const p=Math.min(2,v);t.push(`${f.name}: ${f.baseAC}`),t.push(`Dexterity: ${p>=0?"+":""}${p} (max +2)`)}else f.type==="heavy"&&(t.push(`${f.name}: ${f.baseAC}`),t.push("Dexterity: +0 (heavy armor)"));r.shieldEquipped&&t.push("Shield: +2")}else{t.push("Base: 10"),v!==0&&t.push(`Dexterity: ${v>=0?"+":""}${v}`);const p=10+v,m=r.armorClass-p;m!==0&&t.push(`Other: ${m>=0?"+":""}${m}`)}return r.activeStates&&r.activeStates.length>0&&r.activeStates.forEach(p=>{typeof p.acBonus=="number"&&p.acBonus!==0&&(!p.target||p.target==="self")&&t.push(`${p.name}: ${p.acBonus>=0?"+":""}${p.acBonus}`)}),t.join(`
`)}function Gl(r,c){const t=[],v=Ha(c.dexterity);t.push(`Dexterity: ${v>=0?"+":""}${v}`);const f=r.initiative-v;return f!==0&&t.push(`Other Bonuses: ${f>=0?"+":""}${f}`),t.join(`
`)}function ql(r,c){if(!r.class)return"";const t=ua(r.class);if(!t||!t.spellcaster||!t.spellcastingAbility)return"";const v=[],f=Ha(c[t.spellcastingAbility]),p=t.spellcastingAbility.charAt(0).toUpperCase()+t.spellcastingAbility.slice(1);return v.push("Base: 8"),v.push(`Proficiency: +${r.proficiencyBonus}`),v.push(`${p}: ${f>=0?"+":""}${f}`),v.join(`
`)}function zl(r,c,t){const v=[];let f=r;const p=c.toLowerCase().trim();if(t.activeStates){for(const w of t.activeStates)if(w.immunities&&w.immunities.length>0&&w.immunities.some(_=>_.toLowerCase().trim()===p))return v.push(`Immune to ${c} (${w.name})`),{finalDamage:0,adjustments:v}}let m=!1;if(t.activeStates){for(const w of t.activeStates)if(w.resistances&&w.resistances.length>0&&w.resistances.some(_=>_.toLowerCase().trim()===p)){const _=Math.floor(f/2);v.push(`Resistant to ${c} (${w.name}): ${f} ‚Üí ${_}`),f=_,m=!0;break}}if(!m&&t.race){const w=Va(t.race);if(w){for(const h of w.traits)if(h.resistances&&h.resistances.some(_=>_.toLowerCase().trim()===p)){const _=Math.floor(f/2);v.push(`Resistant to ${c} (racial trait): ${f} ‚Üí ${_}`),f=_,m=!0;break}}}return v.length===0&&v.push(`No adjustments for ${c}`),{finalDamage:f,adjustments:v}}function Wl(r,c){const t={...r};if(t.tempHP>0){if(c<=t.tempHP)return t.tempHP-=c,t;c-=t.tempHP,t.tempHP=0}return t.currentHP=Math.max(0,t.currentHP-c),t}var Kl=u('<button class="info-icon svelte-1o8ci7b" type="button">‚ÑπÔ∏è</button>'),Jl=u('<button class="info-icon svelte-1o8ci7b" type="button">‚ÑπÔ∏è</button>'),Vl=u("<div><!></div>"),Yl=u('<div class="tooltip-wrapper svelte-1o8ci7b"><!> <!></div>');function vs(r,c){Vt(c,!1);let t=Bt(c,"tooltipContent",8),v=Bt(c,"ariaLabel",8,"Show information"),f=S(!1),p=S(),m=S(!1),w=S(null),h=S(!1),_=S(!1),G=S("");const F=Math.random().toString(36).slice(2);function Z(){window.dispatchEvent(new CustomEvent("tooltip-open",{detail:F}))}function K(M){M.detail!==F&&(n(f,!1),n(h,!1))}function Y(){n(m,window.matchMedia("(pointer: coarse)").matches||"ontouchstart"in window)}function N(){if(!e(w)||!e(p))return;const M=e(p).getBoundingClientRect(),T=e(w).getBoundingClientRect();let x=M.bottom+5,Q=M.left;n(h,!1),Q+T.width>window.innerWidth-8&&(Q=M.right-T.width,n(h,!0),Q<8&&(Q=8)),Q<8&&(Q=8),x+T.height>window.innerHeight-8&&(x=M.top-T.height-5),n(G,`position:fixed;top:${x}px;left:${Q}px;z-index:1000;`),n(_,!0)}function R(){Z(),n(f,!1),n(_,!1),requestAnimationFrame(()=>{n(f,!0),n(_,!1),setTimeout(N,0)})}function P(){n(f,!1),n(h,!1)}function re(M){M.stopPropagation(),e(f)?(n(f,!1),n(h,!1),n(_,!1)):(Z(),n(f,!1),n(_,!1),requestAnimationFrame(()=>{n(f,!0),n(_,!1),setTimeout(N,0)}))}function pe(M){e(p)&&!e(p).contains(M.target)&&(n(f,!1),n(h,!1))}Ca(()=>{Y(),document.addEventListener("click",pe),window.addEventListener("tooltip-open",K)}),Js(()=>{document.removeEventListener("click",pe),window.removeEventListener("tooltip-open",K)}),Jt();var Ue=Yl(),ne=l(Ue);{var ie=M=>{var T=Kl();D(()=>ct(T,"aria-label",v())),A("click",T,re),o(M,T)},J=M=>{var T=Jl();D(()=>ct(T,"aria-label",v())),A("mouseenter",T,R),A("mouseleave",T,P),o(M,T)};g(ne,M=>{e(m)?M(ie):M(J,!1)})}var ye=a(ne,2);{var Fe=M=>{var T=Vl(),x=l(T);xl(x,c,"content",{},Q=>{var z=wt(),he=De(z);ps(he,t),o(Q,z)}),s(T),Na(T,Q=>n(w,Q),()=>e(w)),D(()=>{Et(T,1,`tooltip-popup ${e(h)?"right-align":""}`,"svelte-1o8ci7b"),$l(T,e(_)?e(G)+"opacity:1;pointer-events:auto;":"opacity:0;pointer-events:none;position:fixed;top:0;left:0;z-index:1000;")}),o(M,T)};g(ye,M=>{e(f)&&M(Fe)})}s(Ue),Na(Ue,M=>n(p,M),()=>e(p)),o(r,Ue),Yt()}var Ql=u("<option> </option>"),Xl=u('<div class="armor-config svelte-1r5hyyb"><h4 class="svelte-1r5hyyb">Armor Configuration</h4> <div class="armor-controls svelte-1r5hyyb"><div class="armor-field svelte-1r5hyyb"><label for="armorName" class="svelte-1r5hyyb">Armor</label> <select id="armorName" class="armor-select svelte-1r5hyyb"><option>None (Unarmored)</option><!></select></div> <div class="armor-field svelte-1r5hyyb"><label class="shield-label svelte-1r5hyyb"><input type="checkbox" class="shield-checkbox svelte-1r5hyyb"/> Shield Equipped (+2 AC)</label></div></div></div>'),Zl=u('<div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="spellSaveDC" class="svelte-1r5hyyb">Spell Save DC</label> <!></div> <input type="number" id="spellSaveDC" class="stat-input svelte-1r5hyyb" readonly=""/></div>'),er=u('<span class="hit-dice-type"> </span>'),tr=u('<!> <div class="stats-grid svelte-1r5hyyb"><div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="armorClass" class="svelte-1r5hyyb">Armor Class</label> <!></div> <input type="text" id="armorClass" readonly=""/></div> <div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="initiative" class="svelte-1r5hyyb">Initiative</label> <!></div> <input type="text" id="initiative" class="stat-input svelte-1r5hyyb" readonly=""/></div> <div class="stat-box svelte-1r5hyyb"><label for="speed" class="svelte-1r5hyyb">Speed</label> <input type="text" id="speed" class="stat-input svelte-1r5hyyb"/></div> <!></div> <div class="hp-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Points</h3> <div><div class="hp-inputs svelte-1r5hyyb"><input type="number" class="hp-current svelte-1r5hyyb" min="0"/> <span class="hp-separator svelte-1r5hyyb">/</span> <input type="number" class="hp-max svelte-1r5hyyb" min="0"/></div> <div class="hp-controls svelte-1r5hyyb"><button class="hp-btn svelte-1r5hyyb">‚àí</button> <button class="hp-btn svelte-1r5hyyb">+</button> <button class="hp-btn svelte-1r5hyyb">‚àí5</button> <button class="hp-btn svelte-1r5hyyb">+5</button></div></div> <div class="temp-hp svelte-1r5hyyb"><label for="tempHP" class="svelte-1r5hyyb">Temp HP</label> <input type="number" id="tempHP" min="0" class="svelte-1r5hyyb"/></div></div> <div class="hit-dice-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Dice</h3> <div class="hit-dice-display svelte-1r5hyyb"><input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <span>/</span> <input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <!></div> <div class="hit-dice-controls svelte-1r5hyyb"><label for="hitDiceCount" class="svelte-1r5hyyb">Roll</label> <div class="hit-dice-count-controls svelte-1r5hyyb"><button class="hit-dice-btn svelte-1r5hyyb">‚àí</button> <input type="number" id="hitDiceCount" class="hit-dice-count-input svelte-1r5hyyb" min="1"/> <button class="hit-dice-btn svelte-1r5hyyb">+</button></div> <button class="btn btn-primary roll-hit-dice use-enabled svelte-1r5hyyb">üé≤ Roll</button></div></div>',1),ar=u("<section><!> <!></section>");function sr(r,c){Vt(c,!1);const t=()=>_t(fe,"$character",w),v=()=>_t(Xa,"$abilityModifiers",w),f=()=>_t($a,"$searchFilter",w),p=()=>_t(la,"$collapsedStates",w),m=()=>_t(Sa,"$isEditMode",w),[w,h]=fa(),_=S(),G=S(),F=S(),Z=S(),K=S(),Y=S(),N=S(),R=xa();let P=S(1);function re(M){fe.update(T=>(T.currentHP=Math.max(0,Math.min(T.maxHP,T.currentHP+M)),T))}function pe(M){const T=e(P)+M,x=t().hitDice.current;n(P,Math.max(1,Math.min(x,T)))}function Ue(M=1){if(t().hitDice.current<=0){alert("No hit dice remaining!");return}if(!t().class){alert("Please select a class first!");return}const T=ua(t().class);if(!T){alert("Invalid class configuration!");return}const x=Math.min(M,t().hitDice.current),Q=T.hitDice,z=v().constitution,he=z*x,$e=he>=0?`+${he}`:`${he}`,ke=`${x}${Q}${$e}`,_e=[];if(_e.push({value:`${x}${Q}`,source:"hit dice"}),z!==0)for(let me=0;me<x;me++)_e.push({value:z,source:"constitution"});R("rollHitDice",{notation:ke,hitDie:Q,count:x,bonusBreakdown:_e})}et(()=>(t(),v(),fe),()=>{if(t().armorName!==void 0||t().shieldEquipped!==void 0){const M=v().dexterity,T=Hl(t().armorName,M,t().shieldEquipped||!1);t().armorClass!==T&&fe.update(x=>({...x,armorClass:T}))}}),et(()=>(v(),t(),fe),()=>{const M=v().dexterity;t().initiative!==M&&fe.update(T=>({...T,initiative:M}))}),et(()=>t(),()=>{n(_,bs(t(),t().abilities))}),et(()=>t(),()=>{n(G,Ol(t(),t().abilities))}),et(()=>t(),()=>{n(F,Gl(t(),t().abilities))}),et(()=>t(),()=>{n(Z,ql(t(),t().abilities))}),et(()=>(t(),e(P)),()=>{const M=t().hitDice.current;M>0&&e(P)>M&&n(P,M)}),et(()=>t(),()=>{n(K,t().activeStates&&t().activeStates.length>0?t().activeStates.reduce((M,T)=>M+(T.acBonus||0),0):0)}),et(()=>t(),()=>{n(Y,t().activeStates&&t().activeStates.length>0?t().activeStates.some(M=>M.name==="Aid"&&M.target==="self"):!1)}),et(()=>f(),()=>{n(N,!f()||"armor class".includes(f().toLowerCase())||"initiative".includes(f().toLowerCase())||"speed".includes(f().toLowerCase())||"hit points".includes(f().toLowerCase())||"hp".includes(f().toLowerCase())||"hit dice".includes(f().toLowerCase())||"spell save".includes(f().toLowerCase())||"combat".includes(f().toLowerCase()))}),ga(),Jt();var ne=ar();let ie;var J=l(ne);{let M=xt(()=>(p(),i(()=>p().combatStats?"Expand":"Collapse")));Da(J,{title:"Combat Stats",get collapsed(){return p(),i(()=>p().combatStats)},get ariaLabel(){return e(M)},onToggle:()=>la.update(T=>({...T,combatStats:!T.combatStats}))})}var ye=a(J,2);{var Fe=M=>{var T=tr(),x=De(T);{var Q=de=>{var Xe=Xl(),Ne=a(l(Xe),2),tt=l(Ne),qe=a(l(tt),2);D(()=>{t(),Kt(()=>{})});var Ke=l(qe);Ke.value=(Ke.__value=void 0)??"";var gt=a(Ke);Lt(gt,1,()=>Gs,Rt,(b,I)=>{var oe=wt(),ce=De(oe);{var ue=Re=>{var Je=Ql(),Oe=l(Je);s(Je);var ve={};D(()=>{k(Oe,`${e(I),i(()=>e(I).name)??""} (AC ${e(I),i(()=>e(I).baseAC)??""})`),ve!==(ve=(e(I),i(()=>e(I).name)))&&(Je.value=(Je.__value=(e(I),i(()=>e(I).name)))??"")}),o(Re,Je)};g(ce,Re=>{e(I),i(()=>e(I).name!=="Unarmored")&&Re(ue)})}o(b,oe)}),s(qe),s(tt);var X=a(tt,2),Qe=l(X),mt=l(Qe);Ce(mt),ta(),s(Qe),s(X),s(Ne),s(Xe),Ua(qe,()=>t().armorName,b=>Ot(fe,i(t).armorName=b,i(t))),ja(mt,()=>t().shieldEquipped,b=>Ot(fe,i(t).shieldEquipped=b,i(t))),o(de,Xe)};g(x,de=>{m()&&de(Q)})}var z=a(x,2),he=l(z),$e=l(he),ke=a(l($e),2);vs(ke,{get tooltipContent(){return e(G)},ariaLabel:"Show AC breakdown"}),s($e);var _e=a($e,2);Ce(_e),s(he);var me=a(he,2),we=l(me),y=a(l(we),2);vs(y,{get tooltipContent(){return e(F)},ariaLabel:"Show Initiative breakdown"}),s(we);var q=a(we,2);Ce(q),s(me);var Pe=a(me,2),ft=a(l(Pe),2);Ce(ft),s(Pe);var ut=a(Pe,2);{var yt=de=>{var Xe=Zl(),Ne=l(Xe),tt=a(l(Ne),2);vs(tt,{get tooltipContent(){return e(Z)},ariaLabel:"Show Spell Save DC breakdown"}),s(Ne);var qe=a(Ne,2);Ce(qe),s(Xe),D(()=>Ra(qe,e(_))),o(de,Xe)};g(ut,de=>{e(_)!==null&&de(yt)})}s(z);var St=a(z,2),Ct=a(l(St),2);let C;var W=l(Ct),j=l(W);Ce(j);var U=a(j,4);Ce(U),s(W);var ee=a(W,2),be=l(ee),He=a(be,2),Ee=a(He,2),Ge=a(Ee,2);s(ee),s(Ct);var Ie=a(Ct,2),$=a(l(Ie),2);Ce($),s(Ie),s(St);var te=a(St,2),H=a(l(te),2),Le=l(H);Ce(Le);var Se=a(Le,4);Ce(Se);var vt=a(Se,2);{var Ae=de=>{const Xe=xt(()=>(E(ua),t(),i(()=>ua(t().class))));var Ne=wt(),tt=De(Ne);{var qe=Ke=>{const gt=xt(()=>(v(),i(()=>v().constitution)));var X=er(),Qe=l(X);s(X),D(()=>k(Qe,`(${E(e(Xe)),i(()=>e(Xe).hitDice)??""}${(e(gt)>=0?`+${e(gt)}`:e(gt))??""})`)),o(Ke,X)};g(tt,Ke=>{e(Xe)&&Ke(qe)})}o(de,Ne)};g(vt,de=>{t(),i(()=>t().class)&&de(Ae)})}s(H);var ae=a(H,2),d=a(l(ae),2),Ye=l(d),Me=a(Ye,2);Ce(Me);var O=a(Me,2);s(d);var Be=a(d,2);s(ae),s(te),D(()=>{Ra(_e,(e(K),t(),i(()=>e(K)!==0?`${t().armorClass} ‚Üí ${t().armorClass+e(K)}`:`${t().armorClass}`))),Et(_e,1,fl(e(K)!==0?"stat-input ac-enhanced":"stat-input"),"svelte-1r5hyyb"),Ra(q,(t(),i(()=>t().initiative))),C=Et(Ct,1,"hp-display svelte-1r5hyyb",null,C,{"aid-active":e(Y)}),ct(j,"max",(t(),i(()=>t().maxHP))),ct(Le,"max",(t(),i(()=>t().hitDice.max))),Ye.disabled=e(P)<=1,ct(Me,"max",(t(),i(()=>t().hitDice.current))),O.disabled=(e(P),t(),i(()=>e(P)>=t().hitDice.current)),Be.disabled=(t(),i(()=>t().hitDice.current<=0||!t().class))}),We(ft,()=>t().speed,de=>Ot(fe,i(t).speed=de,i(t))),We(j,()=>t().currentHP,de=>Ot(fe,i(t).currentHP=de,i(t))),We(U,()=>t().maxHP,de=>Ot(fe,i(t).maxHP=de,i(t))),A("click",be,()=>re(-1)),A("click",He,()=>re(1)),A("click",Ee,()=>re(-5)),A("click",Ge,()=>re(5)),We($,()=>t().tempHP,de=>Ot(fe,i(t).tempHP=de,i(t))),We(Le,()=>t().hitDice.current,de=>Ot(fe,i(t).hitDice.current=de,i(t))),We(Se,()=>t().hitDice.max,de=>Ot(fe,i(t).hitDice.max=de,i(t))),A("click",Ye,()=>pe(-1)),We(Me,()=>e(P),de=>n(P,de)),A("input",Me,de=>{const Xe=de.target,Ne=parseInt(Xe.value);Ne>t().hitDice.current&&n(P,t().hitDice.current),Ne<1&&n(P,1)}),A("click",O,()=>pe(1)),A("click",Be,()=>Ue(e(P))),o(M,T)};g(ye,M=>{p(),i(()=>!p().combatStats)&&M(Fe)})}s(ne),D(()=>ie=Et(ne,1,"combat-stats svelte-1r5hyyb",null,ie,{hidden:!e(N)})),o(r,ne),Yt(),h()}const qa={acrobatics:"dexterity",animalHandling:"wisdom",arcana:"intelligence",athletics:"strength",deception:"charisma",history:"intelligence",insight:"wisdom",intimidation:"charisma",investigation:"intelligence",medicine:"wisdom",nature:"intelligence",perception:"wisdom",performance:"charisma",persuasion:"charisma",religion:"intelligence",sleightOfHand:"dexterity",stealth:"dexterity",survival:"wisdom"};var lr=u('<div class="skill-row svelte-1f1pl16"><input type="checkbox" class="svelte-1f1pl16"/> <label class="svelte-1f1pl16"> <span class="ability-tag svelte-1f1pl16"> </span></label> <span class="skill-modifier svelte-1f1pl16"> </span> <button class="roll-btn svelte-1f1pl16">Roll</button></div>'),rr=u('<div class="skills-grid svelte-1f1pl16"></div>'),ir=u("<section><!> <!></section>");function nr(r,c){Vt(c,!1);const t=()=>_t(fe,"$character",w),v=()=>_t(Xa,"$abilityModifiers",w),f=()=>_t($a,"$searchFilter",w),p=()=>_t(la,"$collapsedStates",w),m=()=>_t(Sa,"$isEditMode",w),[w,h]=fa(),_=S(),G=S(),F=S(),Z=S(),K=S(),Y=S(),N=xa(),R=[{key:"acrobatics",label:"Acrobatics"},{key:"animalHandling",label:"Animal Handling"},{key:"arcana",label:"Arcana"},{key:"athletics",label:"Athletics"},{key:"deception",label:"Deception"},{key:"history",label:"History"},{key:"insight",label:"Insight"},{key:"intimidation",label:"Intimidation"},{key:"investigation",label:"Investigation"},{key:"medicine",label:"Medicine"},{key:"nature",label:"Nature"},{key:"perception",label:"Perception"},{key:"performance",label:"Performance"},{key:"persuasion",label:"Persuasion"},{key:"religion",label:"Religion"},{key:"sleightOfHand",label:"Sleight of Hand"},{key:"stealth",label:"Stealth"},{key:"survival",label:"Survival"}];function P(J){const ye=qa[J],Fe=v()[ye],M=t().skillProficiencies[J]?t().proficiencyBonus:0,T=e(_)[J],x=`1d20${T>=0?"+":""}${T}`,Q=[];Q.push({value:"1d20",source:"base die"}),Fe!==0&&Q.push({value:Fe,source:ye}),M!==0&&Q.push({value:M,source:"proficiency"}),N("roll",{notation:x,rollType:"check",bonusBreakdown:Q})}et(()=>{},()=>{n(_,{})}),et(()=>t(),()=>{n(G,t().skillProficiencies)}),et(()=>t(),()=>{n(F,t().proficiencyBonus)}),et(()=>v(),()=>{n(Z,v())}),et(()=>(e(Z),e(G),e(F)),()=>{for(const{key:J}of R){const ye=qa[J],Fe=e(Z)[ye],M=e(G)[J]?e(F):0;_a(_,e(_)[J]=Fe+M)}}),et(()=>f(),()=>{n(K,R.filter(({label:J})=>f()?J.toLowerCase().includes(f().toLowerCase()):!0))}),et(()=>e(K),()=>{n(Y,e(K).length>0)}),ga(),Jt();var re=ir();let pe;var Ue=l(re);{let J=xt(()=>(p(),i(()=>p().skills?"Expand":"Collapse")));Da(Ue,{title:"Skills",get collapsed(){return p(),i(()=>p().skills)},get ariaLabel(){return e(J)},onToggle:()=>la.update(ye=>({...ye,skills:!ye.skills}))})}var ne=a(Ue,2);{var ie=J=>{var ye=rr();Lt(ye,5,()=>e(K),Rt,(Fe,M)=>{let T=()=>e(M).key,x=()=>e(M).label;var Q=lr(),z=l(Q);Ce(z);var he=a(z,2),$e=l(he),ke=a($e),_e=l(ke);s(ke),s(he);var me=a(he,2),we=l(me);s(me);var y=a(me,2);s(Q),D(q=>{Hs(z,(e(G),T(),i(()=>e(G)[T()]))),z.disabled=!m(),ct(z,"id",T()),ct(he,"for",T()),k($e,`${x()??""} `),k(_e,`(${q??""})`),k(we,`${e(_),T(),i(()=>e(_)[T()]>=0?"+":"")??""}${e(_),T(),i(()=>e(_)[T()])??""}`)},[()=>(E(qa),T(),i(()=>qa[T()].substring(0,3).toUpperCase()))]),A("change",z,q=>{console.log("Skill proficiency changed:",T(),q.target.checked),fe.update(Pe=>({...Pe,skillProficiencies:{...Pe.skillProficiencies,[T()]:q.target.checked}}))}),A("click",y,()=>P(T())),o(Fe,Q)}),s(ye),o(J,ye)};g(ne,J=>{p(),i(()=>!p().skills)&&J(ie)})}s(re),D(()=>pe=Et(re,1,"skills svelte-1f1pl16",null,pe,{hidden:!e(Y)})),o(r,re),Yt(),h()}var or=u('<p class="empty-message svelte-1123ljy">No attacks or spells to reorder.</p>'),cr=u('<li class="reorder-item svelte-1123ljy"><span class="attack-name svelte-1123ljy"> </span> <div class="reorder-buttons svelte-1123ljy"><button class="btn-move svelte-1123ljy" aria-label="Move up">‚ñ≤</button> <button class="btn-move svelte-1123ljy" aria-label="Move down">‚ñº</button></div></li>'),vr=u('<ul class="reorder-list svelte-1123ljy"></ul>'),dr=u('<div class="modal-backdrop svelte-1123ljy" role="presentation"><div class="modal-content svelte-1123ljy" role="dialog" aria-modal="true" aria-labelledby="modal-title"><div class="modal-header svelte-1123ljy"><h3 id="modal-title" class="svelte-1123ljy">Reorder Attacks & Spells</h3> <button class="btn-close svelte-1123ljy" aria-label="Close">√ó</button></div> <div class="modal-body svelte-1123ljy"><!></div> <div class="modal-footer svelte-1123ljy"><button class="btn btn-secondary svelte-1123ljy">Cancel</button> <button class="btn btn-primary svelte-1123ljy">Save Order</button></div></div></div>');function ur(r,c){Vt(c,!1);let t=Bt(c,"show",8,!1),v=Bt(c,"attacks",24,()=>[]),f=Bt(c,"onSave",8),p=Bt(c,"onCancel",8),m=S([]);function w(R,P){const re=e(m)[R];_a(m,e(m)[R]=e(m)[P]),_a(m,e(m)[P]=re),n(m,[...e(m)])}function h(R){R>0&&w(R,R-1)}function _(R){R<e(m).length-1&&w(R,R+1)}function G(){f()(e(m))}function F(){p()()}function Z(R){R.target===R.currentTarget&&F()}et(()=>(E(t()),E(v())),()=>{t()&&n(m,[...v()])}),ga(),Jt();var K=wt(),Y=De(K);{var N=R=>{var P=dr(),re=l(P),pe=l(re),Ue=a(l(pe),2);s(pe);var ne=a(pe,2),ie=l(ne);{var J=x=>{var Q=or();o(x,Q)},ye=x=>{var Q=vr();Lt(Q,7,()=>e(m),z=>z.id,(z,he,$e)=>{var ke=cr(),_e=l(ke),me=l(_e,!0);s(_e);var we=a(_e,2),y=l(we),q=a(y,2);s(we),s(ke),D(()=>{k(me,(e(he),i(()=>e(he).name||"(Unnamed attack or spell)"))),y.disabled=e($e)===0,q.disabled=(E(e($e)),e(m),i(()=>e($e)===e(m).length-1))}),A("click",y,()=>h(e($e))),A("click",q,()=>_(e($e))),o(z,ke)}),s(Q),o(x,Q)};g(ie,x=>{e(m),i(()=>e(m).length===0)?x(J):x(ye,!1)})}s(ne);var Fe=a(ne,2),M=l(Fe),T=a(M,2);s(Fe),s(re),s(P),A("click",Ue,F),A("click",M,F),A("click",T,G),A("click",P,Z),o(R,P)};g(Y,R=>{t()&&R(N)})}o(r,K),Yt()}let za=null,Wa=null;async function zs(){if(za)return za;try{return za=await(await fetch(Os("/data/spells.json"))).json(),za||[]}catch(r){return console.error("Failed to load spells:",r),[]}}async function fr(){if(Wa)return Wa;try{return Wa=await(await fetch(Os("/data/feats.json"))).json(),Wa||[]}catch(r){return console.error("Failed to load feats:",r),[]}}function Ms(r,c){if(!c.trim())return r;const t=c.toLowerCase();return r.filter(v=>v.name.toLowerCase().includes(t)||v.school.toLowerCase().includes(t)||v.classes.some(f=>f.toLowerCase().includes(t))||v.description.toLowerCase().includes(t))}function pr(r,c){return c===null?r:r.filter(t=>t.level===c)}function mr(r,c){if(!c.trim())return r;const t=c.toLowerCase();return r.filter(v=>v.name.toLowerCase().includes(t)||v.description.toLowerCase().includes(t))}function Ka(r){const c=r.description,t=/\b(Strength|Dexterity|Constitution|Intelligence|Wisdom|Charisma)\s+saving\s+throw/i,v=c.match(t);if(!v)return null;const f=v[1].toLowerCase(),m=/half\s+(?:as\s+much\s+)?damage\s+on\s+a\s+successful(?:\s+save)?|on\s+a\s+successful(?:\s+save)?[^.]*half\s+(?:as\s+much\s+)?damage/i.test(c),h=/saving\s+throw\s+or\s+take.*?damage/i.test(c)&&!m;return{ability:f,halfDamageOnSave:m,noDamageOnSave:h}}function gr(r){const c=r.description;return/(plus|add)\s+your\s+spellcasting\s+(ability\s+)?modifier/i.test(c)}function Aa(r){const c=r.description.toLowerCase();return c.includes("ranged spell attack")||c.includes("melee spell attack")}function Ja(r){const c=r.description.toLowerCase();if(["Divine Favor","Bless","Aid","Command","Crusader's Mantle"].includes(r.name))return!0;const f=["takes","take","deals","deal","damage equal to","force damage","fire damage","cold damage","lightning damage","thunder damage","acid damage","poison damage","necrotic damage","radiant damage","psychic damage","regain","regains","hit point"].some(w=>c.includes(w));return["bonus to attack","bonus to damage","bonus to ac","gains a +","gain a +","+1 bonus","+2 bonus","+3 bonus","advantage on","becomes a magic weapon"].some(w=>c.includes(w))&&!f}function br(r){const c=r.description;let t=0,v=0,f=0,p="";const m=c.match(/\+(\d+)\s+bonus\s+to\s+attack\s+rolls\s+and\s+damage\s+rolls/i);if(m){const h=parseInt(m[1]);t=h,v=h,p=`+${h} to attack and damage rolls`}if(r.name==="Bless"&&(p="Add 1d4 to attack rolls and saves",t="1d4"),r.name==="Aid")return p="+5 HP (max and current) for 8 hours",{attackBonus:0,damageBonus:0,acBonus:0,hpBonus:5,description:p,name:r.name};r.name==="Divine Favor"&&(p="Your weapon attacks deal an extra 1d4 radiant damage on a hit.",v="1d4");const w=c.match(/\+(\d+)\s+bonus\s+to\s+AC/i);return w&&(f=parseInt(w[1]),p=`+${f} to AC`),r.name==="Haste"&&(p="+2 AC, doubled speed, extra action",f=2),r.name==="Crusader's Mantle"&&(p="Your weapon attacks deal an extra 1d4 radiant damage on a hit.",v="1d4"),p||t!==0||v!==0||f!==0?{attackBonus:t,damageBonus:v,acBonus:f,description:p||r.description.substring(0,100),name:r.name}:null}function ds(r){const c=r.description,t=/takes?\s+(\d+d\d+)\s+\w+\s+damage[^.]*\.\s*If\s+the\s+target\s+is\s+missing.*?instead\s+takes?\s+(\d+d\d+)/is,v=c.match(t);return v?{baseDamage:v[1],alternateDamage:v[2]}:null}var hr=u('<button class="btn btn-secondary">Reorder</button>'),_r=u('<div class="edit-buttons svelte-14o91c5"><button class="btn btn-secondary">Add Attack</button> <!></div>'),yr=u('<input type="text" placeholder="Attack name" class="attack-name svelte-14o91c5"/>'),xr=u('<h4 class="attack-name-display svelte-14o91c5"> </h4>'),$r=u('<button class="btn-remove svelte-14o91c5">√ó</button>'),kr=u('<div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Bonus</label> <input type="number" class="attack-bonus svelte-14o91c5"/></div>'),wr=u('<div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Damage</label> <input type="text" placeholder="e.g., 2d6+3" class="attack-damage svelte-14o91c5"/></div>'),Sr=u('<div class="spell-info-loading svelte-14o91c5">Loading spell info...</div>'),Cr=u('<li class="svelte-14o91c5"><strong>At Higher Levels:</strong> </li>'),Dr=u('<li style="color: #007bff;" class="svelte-14o91c5"><strong>Special:</strong> Mage Hand is invisible when cast via Githyanki Psionics.</li>'),Lr=u('<li style="color: #007bff;" class="svelte-14o91c5"><strong>Cast via:</strong> </li>'),Ar=u("<!> <!>",1),jr=u('<ul class="svelte-14o91c5"><li class="svelte-14o91c5"><strong>Level:</strong> </li> <li class="svelte-14o91c5"><strong>Casting Time:</strong> </li> <li class="svelte-14o91c5"><strong>Range:</strong> </li> <li class="svelte-14o91c5"><strong>Components:</strong> <!></li> <li class="svelte-14o91c5"><strong>Duration:</strong> <!> </li> <li class="svelte-14o91c5"><strong>Description:</strong> </li> <!> <!></ul>'),Br=u('<span class="scaled-damage svelte-14o91c5" style="margin-left: 8px;"> </span>'),Rr=u('<span class="scaled-damage svelte-14o91c5">(Half damage)</span>'),Mr=u('<span class="scaled-damage svelte-14o91c5">(No damage)</span>'),Tr=u('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> <!> <!></label></div>'),Fr=u('<span class="scaled-damage svelte-14o91c5"> </span>'),Pr=u('<span class="scaled-damage svelte-14o91c5"> </span>'),Ir=u('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> Target is missing HP <!></label></div>'),Er=u("<option> </option>"),Nr=u('<span class="scaled-damage svelte-14o91c5"><!> </span>'),Ur=u('<span class="scaled-damage svelte-14o91c5"> </span>'),Hr=u('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> Target is Fiend or Undead <!></label></div>'),Or=u('<div class="spell-level-selector svelte-14o91c5"><label class="svelte-14o91c5">Cast at Level:</label> <select class="spell-level-select use-enabled svelte-14o91c5"></select> <!></div> <!>',1),Gr=u('<div class="spell-info svelte-14o91c5"><div class="spell-info-header svelte-14o91c5" role="button" tabindex="0"><h4 class="svelte-14o91c5">Spell Info</h4> <button class="collapse-btn-small svelte-14o91c5"> </button></div> <!></div> <!> <!> <!>',1),qr=u('<div class="spell-info-missing svelte-14o91c5">Spell info not found.</div>'),zr=u('<div class="attack-notes svelte-14o91c5"><label class="svelte-14o91c5">Notes</label> <textarea placeholder="e.g., DC 15 Dex save, Range 120 ft, Concentration" class="notes-input svelte-14o91c5" rows="2"></textarea></div>'),Wr=u('<div style="margin-bottom: 0.5em;"><label style="font-size:0.95em;"><input type="checkbox" class="svelte-14o91c5"/> Use Racial Trait <span style="color:#007bff; font-size:0.95em; margin-left:0.5em;"> </span></label></div>'),Kr=u('<button class="btn btn-primary">Roll Attack (Spell Slot)</button>'),Jr=u('<button class="btn btn-primary" disabled>No spell slots available</button>'),Vr=u('<button class="btn btn-primary">Roll Attack (Racial Trait)</button>'),Yr=u('<button class="btn btn-primary" disabled>No racial uses left</button>'),Qr=u('<div class="buff-target-selection svelte-14o91c5"><div class="target-options svelte-14o91c5"><label class="target-option svelte-14o91c5"><input type="radio" class="svelte-14o91c5"/> Self</label> <label class="target-option svelte-14o91c5"><input type="radio" class="svelte-14o91c5"/> Other</label></div> <button class="btn btn-info"> </button></div>'),Xr=u('<button class="btn btn-info">Cast Spell</button>'),Zr=u("<button><!></button>"),ei=u('<button class="btn btn-info">Cast Spell</button>'),ti=u("<!> <!> <!> <!>",1),ai=u('<button class="btn btn-secondary">Roll Damage</button>'),si=u('<button class="btn btn-primary">Roll Attack</button> <!>',1),li=u('<div class="attack-card svelte-14o91c5"><div class="attack-header svelte-14o91c5"><!> <!></div> <div class="attack-details svelte-14o91c5"><!> <!> <div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Type</label> <input type="text" placeholder="e.g., slashing" class="attack-type svelte-14o91c5"/></div></div> <!> <!> <div class="attack-actions svelte-14o91c5"><!> <!></div></div>'),ri=u('<p class="no-attacks svelte-14o91c5">No attacks added yet. Click "Add Attack" to create one.</p>'),ii=u('<p class="no-attacks svelte-14o91c5">No attacks match your search.</p>'),ni=u('<span class="ability-uses svelte-14o91c5"> <!></span>'),oi=u('<span class="ability-reaction svelte-14o91c5">‚ö° Reaction</span>'),ci=u('<button class="btn btn-ability svelte-14o91c5">Use Ability</button>'),vi=u('<div class="ability-card svelte-14o91c5"><div class="ability-header svelte-14o91c5"><h4 class="ability-name svelte-14o91c5"> </h4> <span class="ability-source svelte-14o91c5"> </span></div> <p class="ability-description svelte-14o91c5"> </p> <div class="ability-footer svelte-14o91c5"><!> <!> <!></div></div>'),di=u('<div class="condition-abilities-section svelte-14o91c5"><h3 class="abilities-header svelte-14o91c5">Condition Abilities</h3> <p class="section-description svelte-14o91c5">Special actions granted by active conditions (e.g., Flicker of Deceit)</p> <div class="abilities-list svelte-14o91c5"></div></div>'),ui=u('<button class="btn-remove svelte-14o91c5">√ó</button>'),fi=u('<div class="state-card svelte-14o91c5"><div class="state-header svelte-14o91c5"><input type="text" placeholder="Effect name (e.g., Magic Weapon)" class="state-name svelte-14o91c5"/> <!></div> <div class="state-details svelte-14o91c5"><div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Attack Bonus</label> <input type="text" class="state-bonus svelte-14o91c5" placeholder="0 or 1d4"/></div> <div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Damage Bonus</label> <input type="text" class="state-bonus svelte-14o91c5"/></div> <div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Target</label> <select class="state-bonus svelte-14o91c5"><option>Self</option><option>Other</option></select></div></div> <div class="state-description svelte-14o91c5"><label class="svelte-14o91c5">Description</label> <input type="text" placeholder="e.g., +1 to attack and damage rolls (Magic Weapon)" class="state-desc-input svelte-14o91c5"/></div></div>'),pi=u('<div class="states-list svelte-14o91c5"></div>'),mi=u('<p class="no-states svelte-14o91c5">No active effects. Add spell effects that modify your attacks.</p>'),gi=u('<!> <div class="attacks-list svelte-14o91c5"><!> <!> <!></div> <!> <div class="active-states-section svelte-14o91c5"><h3 class="svelte-14o91c5">Active Spell Effects</h3> <p class="section-description svelte-14o91c5">Effects that modify attack and damage rolls (e.g., Magic Weapon, Bless)</p> <button class="btn btn-secondary">Add Effect</button> <!></div>',1),bi=u("<section><!> <!></section> <!>",1);function hi(r,c){Vt(c,!1);const t=()=>_t(fe,"$character",m),v=()=>_t($a,"$searchFilter",m),f=()=>_t(la,"$collapsedStates",m),p=()=>_t(Sa,"$isEditMode",m),[m,w]=fa(),h=S(),_=S(),G=S(),F=[];let Z=S({});function K(C,W){fe.update(j=>{if(!j.activeStates)return j;const U=j.activeStates.findIndex(Ee=>Ee.name===C);if(U===-1)return j;const ee=j.activeStates[U];if(!ee.abilities)return j;const be=ee.abilities.findIndex(Ee=>Ee.name===W);if(be===-1)return j;const He=ee.abilities[be];return He.currentUses!==void 0&&He.currentUses>0&&(He.currentUses-=1,He.usesPerRest!==void 0?Ht.add(`Used ${W} (${He.currentUses}/${He.usesPerRest} remaining)`,"info"):Ht.add(`Used ${W}`,"info")),j})}const Y=xa();let N=S({}),R=S({}),P=S(!1);function re(C){_a(N,e(N)[C]=!e(N)[C]),n(N,{...e(N)})}function pe(C){return C.description.toLowerCase().includes("regain")&&(C.description.toLowerCase().includes("hit point")||C.description.toLowerCase().includes("hp"))}function Ue(C){return["Shield of Faith","Bless","Aid","Magic Weapon"].includes(C)}function ne(){fe.update(C=>(C.attacks=[...C.attacks,{id:crypto.randomUUID(),name:"",bonus:0,damage:"",damageType:"",notes:""}],C))}function ie(C){fe.update(W=>(W.attacks=W.attacks.filter(j=>j.id!==C),W))}function J(){n(P,!0)}function ye(){n(P,!1)}function Fe(C){fe.update(W=>(W.attacks=C,W)),n(P,!1),Ht.add("Attack order updated successfully!","success")}function M(C,W){let j=C.damage,U=!1,ee=!1;const be=[];if(C.spellRef){const $=z(C.spellRef);if($&&(ee=Aa($),$.level>0)){const te=C.castAtLevel||$.level;let H=!1;if(W||C.source==="racial"){if(H=$e(C.name),!H){Ht.add(`No uses of ${C.name} remaining!`,"error");return}}else if(H=he(te),!H){Ht.add(`No level ${te} spell slots available!`,"error");return}const Se=Ka($);Se&&C.targetSucceededSave&&Se.noDamageOnSave?j="0":(U=Se?.halfDamageOnSave&&C.targetSucceededSave||!1,j=ke(C,$))}}else if(j){const $=j.match(/(\d+d\d+)([+-]?\d+)?/);if($){const[,te,H]=$,Le=H?parseInt(H):0;if(Le!==0&&be.push({value:Le,source:"base"}),t().activeStates&&t().activeStates.length>0){let Se=0,vt=[];for(const Ae of t().activeStates)Ae.target!=="other"&&(typeof Ae.damageBonus=="string"?(vt.push(Ae.damageBonus),be.push({value:Ae.damageBonus,source:Ae.name})):typeof Ae.damageBonus=="number"&&Ae.damageBonus!==0&&(Se+=Ae.damageBonus,be.push({value:Ae.damageBonus,source:Ae.name})));if(Se!==0||vt.length>0){const Ae=Le+Se;let ae=`${te}`;Ae!==0&&(ae+=`${Ae>=0?"+":""}${Ae}`),vt.length>0&&(ae+=" + "+vt.join(" + ")),j=ae}}}}const He=[];let Ee=0;if(ee){const $=cs(t(),t().abilities),te=t().proficiencyBonus||0;He.push({value:te,source:"proficiency"}),He.push({value:$,source:"spellcasting"}),Ee=te+$}else C.bonus!==0&&He.push({value:C.bonus,source:"base"}),Ee=C.bonus;let Ge=[];if(t().activeStates)for(const $ of t().activeStates)$.target!=="other"&&(typeof $.attackBonus=="number"&&$.attackBonus!==0?(He.push({value:$.attackBonus,source:$.name}),Ee+=$.attackBonus):typeof $.attackBonus=="string"&&$.attackBonus&&(Ge.push($.attackBonus),He.push({value:$.attackBonus,source:$.name})));let Ie=`1d20${Ee>=0?"+":""}${Ee}`;Ge.length>0&&(Ie+="+"+Ge.join("+")),Y("roll",{notation:Ie,damageNotation:j,attackName:C.name,applyHalfDamage:U,bonusBreakdown:He,damageBreakdown:be,rollType:"attack"})}function T(C){if(!C.damage){Ht.add(`${C.name}: No damage specified`,"error");return}let W=C.damage,j=!1;const U=[];let ee=C.damageType||"";if(C.spellRef){const be=z(C.spellRef);if(be){const He=pe(be);if(He){const Ee=cs(t(),t().abilities),Ge=W.match(/^(\d+d\d+)/);Ge&&(W=Ge[1],Ee>0&&(W+=`+${Ee}`,U.push({value:Ee,source:"spellcasting"}))),ee="Healing"}if(be.level>0){const Ee=C.castAtLevel||be.level;let Ge=!1;if(C.source==="racial"){if(Ge=$e(C.name),!Ge){Ht.add(`No uses of ${C.name} remaining!`,"error");return}}else if(Ge=he(Ee),!Ge){Ht.add(`No level ${Ee} spell slots available!`,"error");return}const Ie=Ka(be);Ie&&C.targetSucceededSave&&Ie.noDamageOnSave?W="0":(j=Ie?.halfDamageOnSave&&C.targetSucceededSave||!1,He||(W=ke(C,be)))}}}else{const be=W.match(/(\d+d\d+)([+-]\d+)?/);if(be){const[,He,Ee]=be,Ge=Ee?parseInt(Ee):0;if(Ge!==0&&U.push({value:Ge,source:"base"}),t().activeStates&&t().activeStates.length>0){let Ie=0,$=[];for(const te of t().activeStates)te.target!=="other"&&(typeof te.damageBonus=="string"?($.push(te.damageBonus),U.push({value:te.damageBonus,source:te.name})):typeof te.damageBonus=="number"&&te.damageBonus!==0&&(U.push({value:te.damageBonus,source:te.name}),Ie+=te.damageBonus));if(Ie!==0||$.length>0){const te=Ge+Ie;let H=`${He}`;te!==0&&(H+=`${te>=0?"+":""}${te}`),$.length>0&&(H+=" + "+$.join(" + ")),W=H}}}}Y("roll",{notation:W,attackName:C.name,applyHalfDamage:j,bonusBreakdown:U,damageType:ee})}let x=S([]),Q=S(!1);Ca(async()=>{n(x,await zs()),n(Q,!0)});function z(C){return e(x).find(W=>W.name===C)}function he(C){t().classFeatures.spellSlotsByLevel||Ot(fe,i(t).classFeatures.spellSlotsByLevel={},i(t)),t().classFeatures.spellSlotsByLevel[C]||Ot(fe,i(t).classFeatures.spellSlotsByLevel[C]=Array(2).fill(!1),i(t));const j=t().classFeatures.spellSlotsByLevel[C].findIndex(U=>!U);return j===-1?!1:(fe.update(U=>(U.classFeatures.spellSlotsByLevel||(U.classFeatures.spellSlotsByLevel={}),U.classFeatures.spellSlotsByLevel[C]||(U.classFeatures.spellSlotsByLevel[C]=Array(2).fill(!1)),U.classFeatures.spellSlotsByLevel[C][j]=!0,U)),!0)}function $e(C){return!t().racialTraits||!t().racialTraits.uses[C]?!0:t().racialTraits.uses[C].currentUses<=0?!1:(pl(C),!0)}function ke(C,W){let j=C.damage,U=0,ee=0;const be=ds(W);if(be&&C.targetIsDamaged&&(j=be.alternateDamage),gr(W)&&(ee+=cs(t(),t().abilities)),t().activeStates)for(const Se of t().activeStates)Se.target!=="other"&&typeof Se.damageBonus=="number"&&(ee+=Se.damageBonus);if(W.higherLevelSlot&&C.castAtLevel){const Se=W.level,Ae=(C.castAtLevel||Se)-Se;if(Ae>0){const ae=W.higherLevelSlot.match(/(\d+)d(\d+)\s+for\s+each.*?level\s+above/i);if(ae){const[,d]=ae;U+=Ae*parseInt(d)}}}if(C.targetIsFiendOrUndead&&W.description.includes("Fiend or an Undead")){const Se=W.description.match(/increases by (\d+)d(\d+) if.*?Fiend or.*?Undead/i);if(Se){const[,vt]=Se;U+=parseInt(vt)}}const He=j.match(/(\d+)d(\d+)([+-]\d+)?/);if(!He)return ee!==0?ee>=0?`${ee}`:`${ee}`:j||"0";const[,Ee,Ge,Ie]=He,$=parseInt(Ee)+U,H=(Ie?parseInt(Ie):0)+ee;let Le=`${$}d${Ge}`;return H!==0&&(Le+=H>=0?`+${H}`:`${H}`),Le}function _e(C){const W=[];for(let U=C.level;U<=9;U++){const ee=t().classFeatures.spellSlotsByLevel?.[U];ee&&ee.length>0&&W.push(U)}return W}function me(){fe.update(C=>(C.activeStates||(C.activeStates=[]),C.activeStates=[...C.activeStates,{name:"",attackBonus:0,damageBonus:0,description:"",target:"self"}],C))}function we(C){fe.update(W=>{if(W.activeStates){const j=W.activeStates[C];j?.hpBonus&&j.target!=="other"&&(W.maxHP-=j.hpBonus,W.currentHP=Math.max(1,Math.min(W.currentHP-j.hpBonus,W.maxHP))),W.activeStates=W.activeStates.filter((U,ee)=>ee!==C)}return W})}function y(C,W="self"){const j=z(C.spellRef);if(!j){Ht.add("Spell not found","error");return}const U=C.castAtLevel||j.level;if(U>0){let $=!1;if(C.source==="racial"){if($=$e(C.name),!$){Ht.add(`No uses of ${C.name} remaining!`,"error");return}}else if($=he(U),!$){Ht.add(`No level ${U} spell slots available!`,"error");return}}const ee=br(j);if(!ee){Ht.add(`${j.name} cast! Check spell description for effects.`,"info");return}let be=ee.hpBonus||0,He=ee.description;j.name==="Aid"&&U>j.level&&(be=5+(U-j.level)*5,He=`+${be} HP (max and current) for 8 hours`);const Ge=["Shield of Faith","Bless","Aid","Magic Weapon"].includes(j.name);fe.update($=>{$.activeStates||($.activeStates=[]);const te=$.activeStates.find(H=>H.name===j.name);return te&&te.hpBonus&&te.target!=="other"&&($.maxHP-=te.hpBonus,$.currentHP=Math.max(1,Math.min($.currentHP-te.hpBonus,$.maxHP))),$.activeStates=$.activeStates.filter(H=>H.name!==j.name),be>0&&W==="self"&&($.maxHP+=be,$.currentHP+=be),$.activeStates=[...$.activeStates,{name:j.name,attackBonus:ee.attackBonus,damageBonus:ee.damageBonus,acBonus:ee.acBonus,description:He,target:W,hpBonus:be}],$});const Ie=W==="self"?" on self":" on other";Ht.add(`${j.name} cast${Ge?Ie:""}! Effect added to Active Spell Effects.`,"success")}et(()=>t(),()=>{n(h,t().activeStates?t().activeStates.filter(C=>C.abilities&&C.abilities.length>0).flatMap(C=>C.abilities.map(W=>({...W,conditionName:C.name}))):[])}),et(()=>(t(),e(N),e(R)),()=>{if(t()&&t().attacks)for(const C of t().attacks)C.spellRef&&e(N)[C.id]===void 0&&_a(N,e(N)[C.id]=!0),C.spellRef&&e(R)[C.id]===void 0&&_a(R,e(R)[C.id]="self")}),et(()=>(t(),v()),()=>{n(_,t().attacks.filter(C=>{if(!v())return!0;const W=v().toLowerCase();return C.name.toLowerCase().includes(W)||C.damageType.toLowerCase().includes(W)}).sort((C,W)=>!C.spellRef&&W.spellRef?-1:C.spellRef&&!W.spellRef?1:0))}),et(()=>(v(),e(_)),()=>{n(G,!v()||e(_).length>0||"attack".includes(v().toLowerCase())||"spell".includes(v().toLowerCase()))}),ga(),Jt();var q=bi(),Pe=De(q);let ft;var ut=l(Pe);{let C=xt(()=>(f(),i(()=>f().attacks?"Expand":"Collapse")));Da(ut,{title:"Attacks & Spells",get collapsed(){return f(),i(()=>f().attacks)},get ariaLabel(){return e(C)},onToggle:()=>la.update(W=>({...W,attacks:!W.attacks}))})}var yt=a(ut,2);{var St=C=>{var W=gi(),j=De(W);{var U=ae=>{var d=_r(),Ye=l(d),Me=a(Ye,2);{var O=Be=>{var de=hr();A("click",de,J),o(Be,de)};g(Me,Be=>{t(),i(()=>t().attacks.length>0)&&Be(O)})}s(d),A("click",Ye,ne),o(ae,d)};g(j,ae=>{p()&&ae(U)})}var ee=a(j,2),be=l(ee);Lt(be,1,()=>e(_),ae=>ae.id,(ae,d,Ye)=>{var Me=li(),O=l(Me),Be=l(O);{var de=xe=>{var se=yr();Ce(se),We(se,()=>e(d).name,ge=>(e(d).name=ge,Kt(()=>(e(_),t(),v())))),o(xe,se)},Xe=xe=>{var se=xr(),ge=l(se,!0);s(se),D(()=>k(ge,(e(d),i(()=>e(d).name||"(Unnamed Attack)")))),o(xe,se)};g(Be,xe=>{p()?xe(de):xe(Xe,!1)})}var Ne=a(Be,2);{var tt=xe=>{var se=$r();A("click",se,()=>ie(e(d).id)),o(xe,se)};g(Ne,xe=>{p()&&xe(tt)})}s(O);var qe=a(O,2),Ke=l(qe);{var gt=xe=>{var se=kr(),ge=l(se),Ze=a(ge,2);Ce(Ze),s(se),D(()=>{ct(ge,"for",`attack-bonus-${e(d),i(()=>e(d).id)??""}`),ct(Ze,"id",`attack-bonus-${e(d),i(()=>e(d).id)??""}`)}),We(Ze,()=>e(d).bonus,$t=>(e(d).bonus=$t,Kt(()=>(e(_),t(),v())))),o(xe,se)};g(Ke,xe=>{e(d),i(()=>e(d).bonus!==0&&e(d).bonus!==void 0)&&xe(gt)})}var X=a(Ke,2);{var Qe=xe=>{var se=wr(),ge=l(se),Ze=a(ge,2);Ce(Ze),s(se),D(()=>{ct(ge,"for",`attack-damage-${e(d),i(()=>e(d).id)??""}`),ct(Ze,"id",`attack-damage-${e(d),i(()=>e(d).id)??""}`)}),We(Ze,()=>e(d).damage,$t=>(e(d).damage=$t,Kt(()=>(e(_),t(),v())))),o(xe,se)};g(X,xe=>{e(d),i(()=>e(d).damage&&e(d).damage.trim()!=="")&&xe(Qe)})}var mt=a(X,2),b=l(mt),I=a(b,2);Ce(I),s(mt),s(qe);var oe=a(qe,2);{var ce=xe=>{var se=wt(),ge=De(se);{var Ze=nt=>{var le=Sr();o(nt,le)},$t=nt=>{const le=xt(()=>(e(d),i(()=>z(e(d).spellRef))));var Gt=wt(),Te=De(Gt);{var kt=sa=>{const B=xt(()=>(E(Ka),E(e(le)),i(()=>Ka(e(le))))),je=xt(()=>(E(ds),E(e(le)),i(()=>ds(e(le)))));var ze=Gr(),bt=De(ze),L=l(bt),dt=a(l(L),2),st=l(dt,!0);s(dt),s(L);var ht=a(L,2);{var at=rt=>{var Pt=jr(),qt=l(Pt),Zt=a(l(qt));s(qt);var va=a(qt,2),pa=a(l(va));s(va);var da=a(va,2),Qt=a(l(da));s(da);var ea=a(da,2),Xt=a(l(ea)),It=a(Xt);{var na=jt=>{var ia=Tt();D(()=>k(ia,`(${E(e(le)),i(()=>e(le).material)??""})`)),o(jt,ia)};g(It,jt=>{E(e(le)),i(()=>e(le).material)&&jt(na)})}s(ea);var ma=a(ea,2),ha=a(l(ma),2);{var zt=jt=>{var ia=Tt("Concentration,");o(jt,ia)};g(ha,jt=>{E(e(le)),i(()=>e(le).concentration)&&jt(zt)})}var ra=a(ha,1,!0);s(ma);var ot=a(ma,2),Dt=a(l(ot));s(ot);var At=a(ot,2);{var Wt=jt=>{var ia=Cr(),La=a(l(ia));s(ia),D(()=>k(La,` ${E(e(le)),i(()=>e(le).higherLevelSlot)??""}`)),o(jt,ia)};g(At,jt=>{E(e(le)),i(()=>e(le).higherLevelSlot)&&jt(Wt)})}var Ut=a(At,2);{var oa=jt=>{var ia=Ar(),La=De(ia);{var es=ca=>{var ba=Dr();o(ca,ba)};g(La,ca=>{e(d),E(e(le)),i(()=>e(d).racialTraitName==="Githyanki Psionics"&&e(le).name==="Mage Hand")&&ca(es)})}var ts=a(La,2);{var as=ca=>{var ba=Lr(),Ba=a(l(ba));s(ba),D(()=>k(Ba,` ${e(d),i(()=>e(d).racialTraitName)??""}`)),o(ca,ba)};g(ts,ca=>{e(d),i(()=>e(d).racialTraitName)&&ca(as)})}o(jt,ia)};g(Ut,jt=>{e(d),i(()=>e(d).source==="racial")&&jt(oa)})}s(Pt),D(jt=>{k(Zt,` ${E(e(le)),i(()=>e(le).level)??""}`),k(pa,` ${E(e(le)),i(()=>e(le).castingTime||e(le).actionType)??""}`),k(Qt,` ${E(e(le)),i(()=>e(le).range)??""}`),k(Xt,` ${jt??""}`),k(ra,(E(e(le)),i(()=>e(le).duration))),k(Dt,` ${E(e(le)),i(()=>e(le).description)??""}`)},[()=>(E(e(le)),i(()=>e(le).components.join(", ")))]),o(rt,Pt)};g(ht,rt=>{e(N),e(d),i(()=>!e(N)[e(d).id])&&rt(at)})}s(bt);var lt=a(bt,2);{var Ve=rt=>{var Pt=Tr(),qt=l(Pt),Zt=l(qt);Ce(Zt);var va=a(Zt),pa=a(va);{var da=It=>{var na=Br(),ma=l(na);s(na),D(ha=>k(ma,`(Spell Save DC: ${ha??""})`),[()=>(E(bs),t(),i(()=>bs(t(),t().abilities)))]),o(It,na)};g(pa,It=>{t(),i(()=>t().class)&&It(da)})}var Qt=a(pa,2);{var ea=It=>{var na=Rr();o(It,na)},Xt=It=>{var na=wt(),ma=De(na);{var ha=zt=>{var ra=Mr();o(zt,ra)};g(ma,zt=>{e(d),E(e(B)),i(()=>e(d).targetSucceededSave&&e(B).noDamageOnSave)&&zt(ha)},!0)}o(It,na)};g(Qt,It=>{e(d),E(e(B)),i(()=>e(d).targetSucceededSave&&e(B).halfDamageOnSave)?It(ea):It(Xt,!1)})}s(qt),s(Pt),D(It=>k(va,` Target succeeded on ${It??""} save `),[()=>(E(e(B)),i(()=>e(B).ability.charAt(0).toUpperCase()+e(B).ability.slice(1)))]),ja(Zt,()=>e(d).targetSucceededSave,It=>(e(d).targetSucceededSave=It,Kt(()=>(e(_),t(),v())))),o(rt,Pt)};g(lt,rt=>{e(B)&&rt(Ve)})}var Ft=a(lt,2);{var Nt=rt=>{var Pt=Ir(),qt=l(Pt),Zt=l(qt);Ce(Zt);var va=a(Zt,2);{var pa=Qt=>{const ea=xt(()=>(e(d),E(e(le)),i(()=>ke(e(d),e(le)))));var Xt=Fr(),It=l(Xt);s(Xt),D(()=>k(It,`(${E(e(je)),i(()=>e(je).alternateDamage)??""}, total: ${e(ea)??""})`)),o(Qt,Xt)},da=Qt=>{var ea=Pr(),Xt=l(ea);s(ea),D(()=>k(Xt,`(${E(e(je)),i(()=>e(je).baseDamage)??""})`)),o(Qt,ea)};g(va,Qt=>{e(d),i(()=>e(d).targetIsDamaged)?Qt(pa):Qt(da,!1)})}s(qt),s(Pt),ja(Zt,()=>e(d).targetIsDamaged,Qt=>(e(d).targetIsDamaged=Qt,Kt(()=>(e(_),t(),v())))),o(rt,Pt)};g(Ft,rt=>{e(je)&&rt(Nt)})}var Mt=a(Ft,2);{var pt=rt=>{const Pt=xt(()=>(E(e(le)),i(()=>_e(e(le)))));var qt=wt(),Zt=De(qt);{var va=pa=>{var da=Or(),Qt=De(da),ea=l(Qt),Xt=a(ea,2);D(()=>{e(d),Kt(()=>{e(Pt)})}),Lt(Xt,5,()=>e(Pt),Rt,(zt,ra)=>{var ot=Er(),Dt=l(ot);s(ot);var At={};D(()=>{k(Dt,`Level ${e(ra)??""}`),At!==(At=e(ra))&&(ot.value=(ot.__value=e(ra))??"")}),o(zt,ot)}),s(Xt);var It=a(Xt,2);{var na=zt=>{const ra=xt(()=>(e(d),E(e(le)),i(()=>ke(e(d),e(le)))));var ot=Nr(),Dt=l(ot);{var At=oa=>{var jt=Tt("Healing");o(oa,jt)},Wt=oa=>{var jt=Tt("Damage");o(oa,jt)};g(Dt,oa=>{E(e(le)),i(()=>pe(e(le)))?oa(At):oa(Wt,!1)})}var Ut=a(Dt);s(ot),D(()=>k(Ut,` ${e(ra)??""}`)),o(zt,ot)};g(It,zt=>{e(d),E(e(le)),i(()=>e(d).castAtLevel&&e(d).castAtLevel>e(le).level)&&zt(na)})}s(Qt);var ma=a(Qt,2);{var ha=zt=>{var ra=Hr(),ot=l(ra),Dt=l(ot);Ce(Dt);var At=a(Dt,2);{var Wt=Ut=>{const oa=xt(()=>(e(d),E(e(le)),i(()=>ke(e(d),e(le)))));var jt=Ur(),ia=l(jt);s(jt),D(()=>k(ia,`(+1d8, total: ${e(oa)??""})`)),o(Ut,jt)};g(At,Ut=>{e(d),i(()=>e(d).targetIsFiendOrUndead)&&Ut(Wt)})}s(ot),s(ra),ja(Dt,()=>e(d).targetIsFiendOrUndead,Ut=>(e(d).targetIsFiendOrUndead=Ut,Kt(()=>(e(_),t(),v())))),o(zt,ra)};g(ma,zt=>{E(e(le)),i(()=>e(le).description.includes("Fiend or an Undead"))&&zt(ha)})}D(()=>{ct(ea,"for",`castLevel-${e(d),i(()=>e(d).id)??""}`),ct(Xt,"id",`castLevel-${e(d),i(()=>e(d).id)??""}`)}),Ua(Xt,()=>e(d).castAtLevel,zt=>(e(d).castAtLevel=zt,Kt(()=>(e(_),t(),v())))),o(pa,da)};g(Zt,pa=>{E(e(Pt)),e(Z),e(d),i(()=>e(Pt).length>0&&!e(Z)[e(d).id])&&pa(va)})}o(rt,qt)};g(Mt,rt=>{E(e(le)),i(()=>e(le).higherLevelSlot&&e(le).level>0)&&rt(pt)})}D(()=>{ct(dt,"aria-label",(e(N),e(d),i(()=>e(N)[e(d).id]?"Expand":"Collapse"))),k(st,(e(N),e(d),i(()=>e(N)[e(d).id]?"‚ñº":"‚ñ≤")))}),A("click",L,()=>re(e(d).id)),A("keydown",L,rt=>rt.key==="Enter"&&re(e(d).id)),o(sa,ze)},aa=sa=>{var B=qr();o(sa,B)};g(Te,sa=>{e(le)?sa(kt):sa(aa,!1)})}o(nt,Gt)};g(ge,nt=>{e(x),i(()=>e(x).length===0)?nt(Ze):nt($t,!1)})}o(xe,se)};g(oe,xe=>{e(d),i(()=>e(d).spellRef)&&xe(ce)})}var ue=a(oe,2);{var Re=xe=>{var se=wt(),ge=De(se);{var Ze=$t=>{var nt=zr(),le=l(nt),Gt=a(le,2);wa(Gt),s(nt),D(()=>{ct(le,"for",`attack-notes-${e(d),i(()=>e(d).id)??""}`),ct(Gt,"id",`attack-notes-${e(d),i(()=>e(d).id)??""}`)}),We(Gt,()=>e(d).notes,Te=>(e(d).notes=Te,Kt(()=>(e(_),t(),v())))),o($t,nt)};g(ge,$t=>{e(d),i(()=>e(d).notes&&e(d).notes.trim()!=="")&&$t(Ze)})}o(xe,se)};g(ue,xe=>{e(d),i(()=>!e(d).spellRef)&&xe(Re)})}var Je=a(ue,2),Oe=l(Je);{var ve=xe=>{const se=xt(()=>(e(d),i(()=>z(e(d).spellRef))));var ge=wt(),Ze=De(ge);{var $t=nt=>{const le=xt(()=>(t(),e(d),i(()=>t().racialTraits&&t().racialTraits.uses[e(d).name])));var Gt=ti(),Te=De(Gt);{var kt=L=>{var dt=Wr(),st=l(dt),ht=l(st);Ce(ht);var at=a(ht,2),lt=l(at);s(at),s(st),s(dt),D(()=>k(lt,`(${E(e(le)),i(()=>e(le).currentUses)??""}/${E(e(le)),i(()=>e(le).maxUses)??""} uses left)`)),ja(ht,()=>e(Z)[e(d).id],Ve=>_a(Z,e(Z)[e(d).id]=Ve)),A("change",ht,()=>{n(Z,{...e(Z)})}),o(L,dt)};g(Te,L=>{e(d),E(e(le)),i(()=>e(d).source==="racial"&&e(le))&&L(kt)})}var aa=a(Te,2);{var sa=L=>{var dt=wt(),st=De(dt);{var ht=lt=>{var Ve=wt(),Ft=De(Ve);{var Nt=pt=>{var rt=Kr();A("click",rt,()=>M(e(d),!1)),o(pt,rt)},Mt=pt=>{var rt=Jr();o(pt,rt)};g(Ft,pt=>{t(),E(e(se)),i(()=>t().classFeatures&&t().classFeatures.spellSlotsByLevel&&t().classFeatures.spellSlotsByLevel[e(se).level]?.some(rt=>!rt))?pt(Nt):pt(Mt,!1)})}o(lt,Ve)},at=lt=>{var Ve=wt(),Ft=De(Ve);{var Nt=pt=>{var rt=Vr();A("click",rt,()=>M(e(d),!0)),o(pt,rt)},Mt=pt=>{var rt=Yr();o(pt,rt)};g(Ft,pt=>{E(e(le)),i(()=>e(le)&&e(le).currentUses>0)?pt(Nt):pt(Mt,!1)})}o(lt,Ve)};g(st,lt=>{e(Z),e(d),i(()=>!e(Z)[e(d).id])?lt(ht):lt(at,!1)})}o(L,dt)};g(aa,L=>{E(Aa),E(e(se)),i(()=>Aa(e(se)))&&L(sa)})}var B=a(aa,2);{var je=L=>{var dt=wt(),st=De(dt);{var ht=lt=>{var Ve=Qr(),Ft=l(Ve),Nt=l(Ft),Mt=l(Nt);Ce(Mt),Mt.value=Mt.__value="self",ta(),s(Nt);var pt=a(Nt,2),rt=l(pt);Ce(rt),rt.value=rt.__value="other",ta(),s(pt),s(Ft);var Pt=a(Ft,2),qt=l(Pt);s(Pt),s(Ve),D(()=>{ct(Mt,"name",`target-${e(d),i(()=>e(d).id)??""}`),ct(rt,"name",`target-${e(d),i(()=>e(d).id)??""}`),k(qt,`Cast ${E(e(se)),i(()=>e(se).name)??""}`)}),Ls(F,[Ye],Mt,()=>e(R)[e(d).id],Zt=>_a(R,e(R)[e(d).id]=Zt)),Ls(F,[Ye],rt,()=>e(R)[e(d).id],Zt=>_a(R,e(R)[e(d).id]=Zt)),A("click",Pt,()=>y(e(d),e(R)[e(d).id])),o(lt,Ve)},at=lt=>{var Ve=Xr();A("click",Ve,()=>y(e(d),"self")),o(lt,Ve)};g(st,lt=>{E(e(se)),i(()=>Ue(e(se).name))?lt(ht):lt(at,!1)})}o(L,dt)};g(B,L=>{E(Aa),E(e(se)),E(Ja),i(()=>!Aa(e(se))&&Ja(e(se)))&&L(je)})}var ze=a(B,2);{var bt=L=>{var dt=wt(),st=De(dt);{var ht=lt=>{var Ve=Zr(),Ft=l(Ve);{var Nt=pt=>{var rt=Tt("Roll Healing");o(pt,rt)},Mt=pt=>{var rt=Tt("Roll Damage");o(pt,rt)};g(Ft,pt=>{E(e(se)),i(()=>pe(e(se)))?pt(Nt):pt(Mt,!1)})}s(Ve),D(pt=>Et(Ve,1,`btn ${pt??""}`),[()=>(E(e(se)),i(()=>pe(e(se))?"btn-success":"btn-secondary"))]),A("click",Ve,()=>T(e(d))),o(lt,Ve)},at=lt=>{var Ve=ei();A("click",Ve,()=>y(e(d),"self")),o(lt,Ve)};g(st,lt=>{e(d),i(()=>e(d).damage&&e(d).damage.trim()!=="")?lt(ht):lt(at,!1)})}o(L,dt)};g(ze,L=>{E(Aa),E(e(se)),E(Ja),i(()=>!Aa(e(se))&&!Ja(e(se)))&&L(bt)})}o(nt,Gt)};g(Ze,nt=>{e(se)&&nt($t)})}o(xe,ge)};g(Oe,xe=>{e(d),e(Q),i(()=>e(d).spellRef&&e(Q))&&xe(ve)})}var V=a(Oe,2);{var it=xe=>{var se=si(),ge=De(se),Ze=a(ge,2);{var $t=nt=>{var le=ai();A("click",le,()=>T(e(d))),o(nt,le)};g(Ze,nt=>{e(d),i(()=>e(d).damage&&e(d).damage.trim()!=="")&&nt($t)})}A("click",ge,()=>M(e(d))),o(xe,se)};g(V,xe=>{e(d),i(()=>!e(d).spellRef)&&xe(it)})}s(Je),s(Me),D(()=>{ct(b,"for",`attack-type-${e(d),i(()=>e(d).id)??""}`),ct(I,"id",`attack-type-${e(d),i(()=>e(d).id)??""}`)}),We(I,()=>e(d).damageType,xe=>(e(d).damageType=xe,Kt(()=>(e(_),t(),v())))),o(ae,Me)});var He=a(be,2);{var Ee=ae=>{var d=ri();o(ae,d)};g(He,ae=>{t(),i(()=>t().attacks.length===0)&&ae(Ee)})}var Ge=a(He,2);{var Ie=ae=>{var d=ii();o(ae,d)};g(Ge,ae=>{e(_),t(),i(()=>e(_).length===0&&t().attacks.length>0)&&ae(Ie)})}s(ee);var $=a(ee,2);{var te=ae=>{var d=di(),Ye=a(l(d),4);Lt(Ye,5,()=>e(h),Rt,(Me,O)=>{var Be=vi(),de=l(Be),Xe=l(de),Ne=l(Xe,!0);s(Xe);var tt=a(Xe,2),qe=l(tt);s(tt),s(de);var Ke=a(de,2),gt=l(Ke,!0);s(Ke);var X=a(Ke,2),Qe=l(X);{var mt=ue=>{var Re=ni(),Je=l(Re),Oe=a(Je);{var ve=V=>{var it=Tt();D(()=>k(it,`per ${e(O),i(()=>e(O).restType)??""} rest`)),o(V,it)};g(Oe,V=>{e(O),i(()=>e(O).restType)&&V(ve)})}s(Re),D(()=>k(Je,`${e(O),i(()=>e(O).currentUses??e(O).usesPerRest)??""}/${e(O),i(()=>e(O).usesPerRest)??""} uses `)),o(ue,Re)};g(Qe,ue=>{e(O),i(()=>e(O).usesPerRest)&&ue(mt)})}var b=a(Qe,2);{var I=ue=>{var Re=oi();o(ue,Re)};g(b,ue=>{e(O),i(()=>e(O).requiresReaction)&&ue(I)})}var oe=a(b,2);{var ce=ue=>{var Re=ci();D(()=>Re.disabled=(e(O),i(()=>e(O).currentUses===void 0||e(O).currentUses===0))),A("click",Re,()=>K(e(O).conditionName,e(O).name)),o(ue,Re)};g(oe,ue=>{p(),e(O),i(()=>!p()&&e(O).usesPerRest)&&ue(ce)})}s(X),s(Be),D(()=>{k(Ne,(e(O),i(()=>e(O).name))),k(qe,`(${e(O),i(()=>e(O).conditionName)??""})`),k(gt,(e(O),i(()=>e(O).description)))}),o(Me,Be)}),s(Ye),s(d),o(ae,d)};g($,ae=>{e(h),i(()=>e(h).length>0)&&ae(te)})}var H=a($,2),Le=a(l(H),4),Se=a(Le,2);{var vt=ae=>{var d=pi();Lt(d,5,()=>(t(),i(()=>t().activeStates)),Rt,(Ye,Me,O)=>{var Be=fi(),de=l(Be),Xe=l(de);Ce(Xe);var Ne=a(Xe,2);{var tt=V=>{var it=ui();A("click",it,()=>we(O)),o(V,it)};g(Ne,V=>{p()&&V(tt)})}s(de);var qe=a(de,2),Ke=l(qe),gt=l(Ke);ct(gt,"for",`state-attack-bonus-${O}`);var X=a(gt,2);Ce(X),ct(X,"id",`state-attack-bonus-${O}`),s(Ke);var Qe=a(Ke,2),mt=l(Qe);ct(mt,"for",`state-damage-bonus-${O}`);var b=a(mt,2);Ce(b),ct(b,"id",`state-damage-bonus-${O}`),s(Qe);var I=a(Qe,2),oe=l(I);ct(oe,"for",`state-target-${O}`);var ce=a(oe,2);D(()=>{e(Me),Kt(()=>{})}),ct(ce,"id",`state-target-${O}`);var ue=l(ce);ue.value=ue.__value="self";var Re=a(ue);Re.value=Re.__value="other",s(ce),s(I),s(qe);var Je=a(qe,2),Oe=l(Je);ct(Oe,"for",`state-desc-${O}`);var ve=a(Oe,2);Ce(ve),ct(ve,"id",`state-desc-${O}`),s(Je),s(Be),We(Xe,()=>e(Me).name,V=>(e(Me).name=V,Kt(()=>t()),Pa(m,"$character"))),We(X,()=>e(Me).attackBonus,V=>(e(Me).attackBonus=V,Kt(()=>t()),Pa(m,"$character"))),We(b,()=>e(Me).damageBonus,V=>(e(Me).damageBonus=V,Kt(()=>t()),Pa(m,"$character"))),Ua(ce,()=>e(Me).target,V=>(e(Me).target=V,Kt(()=>t()),Pa(m,"$character"))),We(ve,()=>e(Me).description,V=>(e(Me).description=V,Kt(()=>t()),Pa(m,"$character"))),o(Ye,Be)}),s(d),o(ae,d)},Ae=ae=>{var d=mi();o(ae,d)};g(Se,ae=>{t(),i(()=>t().activeStates&&t().activeStates.length>0)?ae(vt):ae(Ae,!1)})}s(H),A("click",Le,me),o(C,W)};g(yt,C=>{f(),i(()=>!f().attacks)&&C(St)})}s(Pe);var Ct=a(Pe,2);ur(Ct,{get show(){return e(P)},get attacks(){return t(),i(()=>t().attacks)},onSave:Fe,onCancel:ye}),D(()=>ft=Et(Pe,1,"attacks svelte-14o91c5",null,ft,{hidden:!e(G)})),o(r,q),Yt(),w()}var _i=u('<span class="slot-checkbox-x svelte-serp1j">&#8212;</span>'),yi=u('<label><input type="checkbox" class="slot-checkbox-input svelte-serp1j"/> <span><!></span></label>');function Ts(r,c){Vt(c,!1);const t=()=>_t(Sa,"$isEditMode",v),[v,f]=fa();let p=Bt(c,"checked",8,!1),m=Bt(c,"disabled",8,!1),w=Bt(c,"className",8,""),h=Bt(c,"index",8,void 0),_=Bt(c,"ariaLabel",8,void 0);const G=xa();function F(P){G("change",{checked:P.currentTarget.checked,index:h()})}Jt();var Z=yi(),K=l(Z);Ce(K);var Y=a(K,2),N=l(Y);{var R=P=>{var re=_i();o(P,re)};g(N,P=>{p()&&P(R)})}s(Y),s(Z),D(()=>{Et(Z,1,"slot-checkbox-label "+w()+(t()?"":" not-editable"),"svelte-serp1j"),Hs(K,p()),K.disabled=m()||!t(),ct(K,"aria-label",_()),ct(K,"tabindex",t()?0:-1),Et(Y,1,`slot-checkbox-custom ${p()?"used":""} ${t()?"":"readonly"}`,"svelte-serp1j")}),A("change",K,F),o(r,Z),Yt(),f()}var xi=u('<span style="color:#007bff; margin-left:0.5em;"> </span>'),$i=u("<li><strong> </strong> <!></li>"),ki=u('<div class="racial-traits"><h4>Racial Traits</h4> <ul></ul></div>'),wi=u("<li> </li>"),Si=u('<div class="racial-resistances"><h4>Racial Resistances</h4> <ul></ul></div>'),Ci=u("<!> <!>",1);function Di(r,c){Vt(c,!1);const t=()=>_t(fe,"$character",v),[v,f]=fa(),p=S(),m=S();let w=S(),h=S();Ca(()=>{t().race&&t().level&&(ws(),rs(),n(w,t().race),n(h,t().level))}),et(()=>(t(),e(w),e(h),rs),()=>{t().race&&t().level&&(t().race!==e(w)||t().level!==e(h))&&(ws(),rs(),n(w,t().race),n(h,t().level))}),et(()=>(t(),Va),()=>{n(p,(()=>{const Y=t().activeStates?t().activeStates.filter(P=>P.name&&P.name.toLowerCase().includes("racial")).flatMap(P=>P.resistances||[]):[],N=Va(t().race||""),R=N?N.traits.flatMap(P=>P.resistances||[]):[];return Array.from(new Set([...Y,...R]))})())}),et(()=>t(),()=>{n(m,(()=>{const Y=Va(t().race||"");return Y?Y.traits:[]})())}),ga(),Jt();var _=Ci(),G=De(_);{var F=Y=>{var N=ki(),R=a(l(N),2);Lt(R,5,()=>e(m),Rt,(P,re)=>{var pe=$i(),Ue=l(pe),ne=l(Ue);s(Ue);var ie=a(Ue),J=a(ie);{var ye=Fe=>{var M=xi(),T=l(M);s(M),D(x=>k(T,`(Resistances: ${x??""})`),[()=>(e(re),i(()=>e(re).resistances.map(x=>x.charAt(0).toUpperCase()+x.slice(1)).join(", ")))]),o(Fe,M)};g(J,Fe=>{e(re),i(()=>e(re).resistances&&e(re).resistances.length>0)&&Fe(ye)})}s(pe),D(()=>{k(ne,`${e(re),i(()=>e(re).name)??""}:`),k(ie,` ${e(re),i(()=>e(re).description)??""} `)}),o(P,pe)}),s(R),s(N),o(Y,N)};g(G,Y=>{e(m),i(()=>e(m).length>0)&&Y(F)})}var Z=a(G,2);{var K=Y=>{var N=Si(),R=a(l(N),2);Lt(R,5,()=>e(p),Rt,(P,re)=>{var pe=wi(),Ue=l(pe,!0);s(pe),D(ne=>k(Ue,ne),[()=>(e(re),i(()=>e(re).charAt(0).toUpperCase()+e(re).slice(1)))]),o(P,pe)}),s(R),s(N),o(Y,N)};g(Z,Y=>{e(p),i(()=>e(p).length>0)&&Y(K)})}o(r,_),Yt(),f()}var Li=u('<p class="no-features svelte-1kpvv0n">Select a class to see available features</p>'),Ai=u('<p class="no-features svelte-1kpvv0n">No class features available at this level</p>'),ji=u('<h5 class="svelte-1kpvv0n"> </h5>'),Bi=u('<p class="no-uses svelte-1kpvv0n">No Channel Divinity uses remaining</p>'),Ri=u('<div class="channel-divinity-option svelte-1kpvv0n"><button class="btn btn-primary use-enabled svelte-1kpvv0n"><!></button> <!></div>'),Mi=u('<div class="sub-feature-box svelte-1kpvv0n"><h4 class="svelte-1kpvv0n"> </h4> <!> <p class="feature-description svelte-1kpvv0n"><!></p> <!></div>'),Ti=u('<div class="sub-features-grid svelte-1kpvv0n"></div>'),Fi=u('<div class="feature-box channel-divinity-main svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"> </h3> <p class="feature-description svelte-1kpvv0n"><!></p> <div class="pool-tracker svelte-1kpvv0n"><input type="number" min="0" class="pool-input svelte-1kpvv0n"/> <span> </span> <button class="btn-small svelte-1kpvv0n"> </button></div> <!></div>'),Pi=u('<div class="spell-slots svelte-1kpvv0n"><label class="svelte-1kpvv0n"> </label> <div class="slots-tracker svelte-1kpvv0n"></div></div>'),Ii=u('<div class="all-spell-slots"></div>'),Ei=u('<div class="feature-box spellcasting svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"> </h3> <div class="spell-stats svelte-1kpvv0n"><div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Spell Save DC</label> <div class="spell-value svelte-1kpvv0n"> </div></div> <div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <div class="spell-value svelte-1kpvv0n"> </div></div></div> <!> <div class="prepared-spells svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <textarea placeholder="List your prepared spells..." class="svelte-1kpvv0n"></textarea></div></div>'),Ni=u('<p class="unlimited svelte-1kpvv0n">Unlimited Uses</p>'),Ui=u('<div class="slots-tracker svelte-1kpvv0n"></div> <div class="uses-actions-row"><button class="btn btn-primary use-enabled"> </button></div> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div>',1),Hi=u('<div class="uses-tracker svelte-1kpvv0n"><!></div>'),Oi=u('<div class="pool-tracker svelte-1kpvv0n"><input type="number" min="0" class="pool-input svelte-1kpvv0n"/> <span> </span> <button class="btn-small svelte-1kpvv0n"> </button></div>'),Gi=u('<div class="feature-box svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"><!> </h3> <p class="feature-description svelte-1kpvv0n"> </p> <!></div>'),qi=u('<!> <div class="features-grid svelte-1kpvv0n"><!> <!></div>',1),zi=u("<!> <!>",1),Wi=u("<section><!> <!></section>");function Ki(r,c){Vt(c,!1);const t=()=>_t(fe,"$character",m),v=()=>_t(Xa,"$abilityModifiers",m),f=()=>_t($a,"$searchFilter",m),p=()=>_t(la,"$collapsedStates",m),[m,w]=fa(),h=S(),_=S(),G=S(),F=S(),Z=S(),K=S(),Y=S(),N=S(),R=S(),P=S(),re=xa();let pe=S(0),Ue=S(0);function ne(y,q){fe.update(Pe=>(Pe.classFeatures.features[y]=q,Pe))}function ie(){fe.update(y=>(y.classFeatures.spellSlotsByLevel||(y.classFeatures.spellSlotsByLevel={}),e(F).forEach(({level:q,slots:Pe})=>{y.classFeatures.spellSlotsByLevel[q]||(y.classFeatures.spellSlotsByLevel[q]=Array(Pe).fill(!1))}),y))}function J(y){if(typeof y.maxUses=="function"){if((y.name==="Divine Sense"||y.name==="War Priest")&&e(h)?.spellcastingAbility){const q=v()[e(h).spellcastingAbility];return y.maxUses(t().level,q)}return y.maxUses(t().level)}return y.maxUses||0}function ye(y,q){fe.update(Pe=>((!Pe.classFeatures.features[y]||!Array.isArray(Pe.classFeatures.features[y])||Pe.classFeatures.features[y].length!==q)&&(Pe.classFeatures.features[y]=Array(q).fill(!1)),Pe))}Vs(()=>{e(K)&&t()&&t().classFeatures&&t().classFeatures.features&&e(K).forEach(y=>{if(y.type==="uses"){const Pe=T(y).replace(/\s+/g,""),ft=J(y),ut=t().classFeatures.features[Pe];(!Array.isArray(ut)||ut.length!==ft)&&ye(Pe,ft)}})});function Fe(y){return typeof y.maxPool=="function"?y.maxPool(t().level):y.maxPool||0}function M(y){if(typeof y.description=="function"){if(e(h)?.spellcastingAbility){const q=v()[e(h).spellcastingAbility];return y.description(t().level,q)}return y.description(t().level)}return y.description}function T(y){if(typeof y.name=="function"){if(e(h)?.spellcastingAbility){const q=v()[e(h).spellcastingAbility];return y.name(t().level,q)}return y.name(t().level)}return y.name}function x(y){if(typeof y.subName=="function"){if(e(h)?.spellcastingAbility){const q=v()[e(h).spellcastingAbility];return y.subName(t().level,q)}return y.subName(t().level)}return y.subName||null}function Q(y){if(typeof y.rollFormula=="function"){if(e(h)?.spellcastingAbility){const q=v()[e(h).spellcastingAbility];return y.rollFormula(t().level,q)}return y.rollFormula(t().level)}return y.rollFormula||""}function z(y){const q="ChannelDivinity",Pe=t().classFeatures.features[q];if(typeof Pe=="number"&&Pe>0){fe.update(ut=>(ut.classFeatures.features[q]=Pe-1,ut));const ft=T(y);if(y.rollable&&y.rollFormula){const ut=Q(y);ut?re("roll",{notation:ut,attackName:ft,rollType:"other"}):Ht.add(`Used ${ft}`,"info")}else Ht.add(`Used ${ft}`,"info")}}function he(){la.update(y=>({...y,classFeatures:!y.classFeatures}))}et(()=>(t(),ua),()=>{n(h,t().class?ua(t().class):null)}),et(()=>(t(),Ta),()=>{n(_,t().class?Ta(t().class,t().level,t().subclass):[])}),et(()=>(t(),Bs),()=>{n(G,t().class?Bs(t().class,t().level):0)}),et(()=>(e(h),t()),()=>{n(F,(()=>{if(!e(h)?.spellcaster)return[];const y=t().level,q=[];return y>=1&&q.push({level:1,slots:Math.min(4,2+Math.floor(y/3))}),y>=3&&q.push({level:2,slots:Math.min(3,2+Math.floor((y-3)/4))}),y>=5&&q.push({level:3,slots:Math.min(3,2+Math.floor((y-5)/5))}),y>=7&&q.push({level:4,slots:Math.min(3,1+Math.floor((y-7)/6))}),y>=9&&q.push({level:5,slots:Math.min(2,1+Math.floor((y-9)/8))}),y>=11&&q.push({level:6,slots:1}),y>=13&&q.push({level:7,slots:1}),y>=15&&q.push({level:8,slots:1}),y>=17&&q.push({level:9,slots:1}),q})())}),et(()=>(e(h),v(),t(),Rs),()=>{if(e(h)?.spellcaster&&e(h).spellcastingAbility){const y=v()[e(h).spellcastingAbility];n(pe,Ll(t().class,y,t().proficiencyBonus)||0),n(Ue,Rs(t().class,t().level,y))}}),et(()=>(t(),e(h),e(F)),()=>{t().class&&e(h)?.spellcaster&&e(F).length>0&&ie()}),et(()=>t(),()=>{n(Z,(()=>{const q=t().classFeatures.features["ChannelDivinity"];return typeof q=="number"?q:0})())}),et(()=>(e(_),f()),()=>{n(K,e(_).filter(y=>{if(!f())return!0;const q=f().toLowerCase();return T(y).toLowerCase().includes(q)||M(y).toLowerCase().includes(q)}))}),et(()=>e(K),()=>{n(Y,e(K).find(y=>y.type==="pool"&&T(y)==="Channel Divinity"))}),et(()=>e(K),()=>{n(N,e(K).flatMap(y=>{const q=[];return y.subFeatures&&q.push(...y.subFeatures),y.type==="channelDivinity"&&q.push(y),q}))}),et(()=>e(K),()=>{n(R,e(K).filter(y=>{const q=T(y);return!(y.type==="pool"&&q==="Channel Divinity"||y.type==="channelDivinity"||q==="Channel Divinity"&&y.subFeatures)}))}),et(()=>(f(),t(),e(K)),()=>{n(P,!f()||t().class||"class features".includes(f().toLowerCase())||"spellcasting".includes(f().toLowerCase())||e(K).length>0)}),ga(),Jt();var $e=Wi();let ke;var _e=l($e);{let y=xt(()=>(p(),i(()=>p().classFeatures?"Expand":"Collapse")));Da(_e,{title:"Class Features",get collapsed(){return p(),i(()=>p().classFeatures)},get ariaLabel(){return e(y)},onToggle:he})}var me=a(_e,2);{var we=y=>{var q=zi(),Pe=De(q);Di(Pe,{});var ft=a(Pe,2);{var ut=St=>{var Ct=Li();o(St,Ct)},yt=St=>{var Ct=wt(),C=De(Ct);{var W=U=>{var ee=Ai();o(U,ee)},j=U=>{var ee=qi(),be=De(ee);{var He=te=>{const H=xt(()=>(e(Y),i(()=>T(e(Y))))),Le=xt(()=>(E(e(H)),i(()=>e(H).replace(/\s+/g,"")))),Se=xt(()=>(t(),E(e(Le)),i(()=>t().classFeatures.features[e(Le)]))),vt=xt(()=>typeof e(Se)=="number"),Ae=xt(()=>(e(Y),i(()=>Fe(e(Y)))));var ae=Fi(),d=l(ae),Ye=l(d,!0);s(d);var Me=a(d,2),O=l(Me);ps(O,()=>(e(Y),i(()=>M(e(Y))))),s(Me);var Be=a(Me,2),de=l(Be);Ce(de);var Xe=a(de,2),Ne=l(Xe);s(Xe);var tt=a(Xe,2),qe=l(tt,!0);s(tt),s(Be);var Ke=a(Be,2);{var gt=X=>{var Qe=Ti();Lt(Qe,5,()=>e(N),Rt,(mt,b)=>{const I=xt(()=>(e(b),i(()=>T(e(b)))));var oe=Mi(),ce=l(oe),ue=l(ce,!0);s(ce);var Re=a(ce,2);{var Je=xe=>{var se=ji(),ge=l(se,!0);s(se),D(Ze=>k(ge,Ze),[()=>(e(b),i(()=>x(e(b))))]),o(xe,se)};g(Re,xe=>{e(b),i(()=>e(b).subName)&&xe(Je)})}var Oe=a(Re,2),ve=l(Oe);ps(ve,()=>(e(b),i(()=>M(e(b))))),s(Oe);var V=a(Oe,2);{var it=xe=>{var se=Ri(),ge=l(se),Ze=l(ge);{var $t=Te=>{var kt=Tt();D(()=>k(kt,`Roll ${e(I)??""}`)),o(Te,kt)},nt=Te=>{var kt=Tt();D(()=>k(kt,`Use ${e(I)??""}`)),o(Te,kt)};g(Ze,Te=>{e(b),i(()=>e(b).rollable&&Q(e(b)))?Te($t):Te(nt,!1)})}s(ge);var le=a(ge,2);{var Gt=Te=>{var kt=Bi();o(Te,kt)};g(le,Te=>{e(Z)<=0&&Te(Gt)})}s(se),D(()=>ge.disabled=e(Z)<=0),A("click",ge,()=>z(e(b))),o(xe,se)};g(V,xe=>{e(b),i(()=>e(b).type==="channelDivinity")&&xe(it)})}s(oe),D(()=>k(ue,e(I))),o(mt,oe)}),s(Qe),o(X,Qe)};g(Ke,X=>{e(N),i(()=>e(N).length>0)&&X(gt)})}s(ae),D(()=>{k(Ye,e(H)),Ra(de,e(vt)&&e(Se)!==void 0?e(Se):e(Ae)),ct(de,"max",e(Ae)),k(Ne,`/ ${e(Ae)??""}`),k(qe,(e(Y),i(()=>e(Y).resetOn==="short"?"Short Rest":"Long Rest")))}),A("input",de,X=>{fe.update(Qe=>(Qe.classFeatures.features[e(Le)]=parseInt(X.currentTarget.value)||0,Qe))}),A("click",tt,()=>ne(e(Le),e(Ae))),o(te,ae)};g(be,te=>{e(Y)&&te(He)})}var Ee=a(be,2),Ge=l(Ee);{var Ie=te=>{var H=Ei(),Le=l(H),Se=l(Le);s(Le);var vt=a(Le,2),Ae=l(vt),ae=a(l(Ae),2),d=l(ae,!0);s(ae),s(Ae);var Ye=a(Ae,2),Me=a(l(Ye),2),O=l(Me,!0);s(Me),s(Ye),s(vt);var Be=a(vt,2);{var de=tt=>{var qe=Ii();Lt(qe,5,()=>e(F),Rt,(Ke,gt)=>{let X=()=>e(gt).level,Qe=()=>e(gt).slots;const mt=xt(()=>(t(),X(),Qe(),i(()=>t().classFeatures.spellSlotsByLevel?.[X()]||Array(Qe()).fill(!1))));var b=Pi(),I=l(b),oe=l(I);s(I);var ce=a(I,2);Lt(ce,5,()=>e(mt),Rt,(ue,Re,Je)=>{{let Oe=xt(()=>(E(e(mt)),i(()=>e(mt)[Je]||!1)));Ts(ue,{get checked(){return e(Oe)},$$events:{change:ve=>{fe.update(V=>(V.classFeatures.spellSlotsByLevel||(V.classFeatures.spellSlotsByLevel={}),V.classFeatures.spellSlotsByLevel[X()]||(V.classFeatures.spellSlotsByLevel[X()]=Array(Qe()).fill(!1)),V.classFeatures.spellSlotsByLevel[X()][Je]=ve.detail.checked,V))}}})}}),s(ce),s(b),D(()=>k(oe,`${X()===1?"1st":X()===2?"2nd":X()===3?"3rd":`${X()}th`} Level Spell Slots`)),o(Ke,b)}),s(qe),o(tt,qe)};g(Be,tt=>{e(F),i(()=>e(F).length>0)&&tt(de)})}var Xe=a(Be,2),Ne=a(l(Xe),2);wa(Ne),s(Xe),s(H),D(tt=>{k(Se,`Spellcasting (${tt??""})`),k(d,e(pe)),k(O,e(Ue))},[()=>(e(h),i(()=>e(h).spellcastingAbility?.toUpperCase()))]),We(Ne,()=>t().classFeatures.preparedSpells,tt=>Ot(fe,i(t).classFeatures.preparedSpells=tt,i(t))),o(te,H)};g(Ge,te=>{e(h),i(()=>e(h)?.spellcaster)&&te(Ie)})}var $=a(Ge,2);Lt($,1,()=>e(R),Rt,(te,H)=>{const Le=xt(()=>(e(H),i(()=>T(e(H))))),Se=xt(()=>(E(e(Le)),i(()=>e(Le).replace(/\s+/g,"")))),vt=xt(()=>(t(),E(e(Se)),i(()=>t().classFeatures.features[e(Se)]))),Ae=xt(()=>typeof e(vt)=="number");var ae=Gi(),d=l(ae),Ye=l(d);{var Me=qe=>{var Ke=Tt("Channel Divinity:");o(qe,Ke)};g(Ye,qe=>{e(H),i(()=>e(H).type==="channelDivinity")&&qe(Me)})}var O=a(Ye);s(d);var Be=a(d,2),de=l(Be,!0);s(Be);var Xe=a(Be,2);{var Ne=qe=>{const Ke=xt(()=>(e(H),i(()=>J(e(H))))),gt=xt(()=>(E(e(vt)),E(e(Ke)),i(()=>Array.isArray(e(vt))?e(vt):Array(e(Ke)).fill(!1))));var X=Hi(),Qe=l(X);{var mt=I=>{var oe=Ni();o(I,oe)},b=I=>{var oe=Ui(),ce=De(oe);Lt(ce,5,()=>e(gt),Rt,(it,xe,se)=>{Ts(it,{get checked(){return e(xe)},index:se,$$events:{change:ge=>{fe.update(Ze=>(Ze.classFeatures.features[e(Se)]||(Ze.classFeatures.features[e(Se)]=Array(e(Ke)).fill(!1)),Ze.classFeatures.features[e(Se)][se]=ge.detail.checked,Ze))}}})}),s(ce);var ue=a(ce,2),Re=l(ue),Je=l(Re);s(Re),s(ue);var Oe=a(ue,2),ve=l(Oe),V=l(ve);s(ve),s(Oe),D(it=>{Re.disabled=it,k(Je,`Use ${e(Le)??""}`),k(V,`Resets on ${e(H),i(()=>e(H).resetOn==="short"?"Short Rest":"Long Rest")??""}`)},[()=>(E(e(gt)),i(()=>e(gt).filter(it=>!it).length<=0))]),A("click",Re,()=>{fe.update(it=>{it.classFeatures.features[e(Se)]||(it.classFeatures.features[e(Se)]=Array(e(Ke)).fill(!1));const xe=it.classFeatures.features[e(Se)],se=xe.findIndex(ge=>!ge);return se!==-1&&(xe[se]=!0),it})}),o(I,oe)};g(Qe,I=>{e(Ke)===1/0?I(mt):I(b,!1)})}s(X),o(qe,X)},tt=qe=>{var Ke=wt(),gt=De(Ke);{var X=Qe=>{const mt=xt(()=>(e(H),i(()=>Fe(e(H)))));var b=Oi(),I=l(b);Ce(I);var oe=a(I,2),ce=l(oe);s(oe);var ue=a(oe,2),Re=l(ue,!0);s(ue),s(b),D(()=>{Ra(I,e(Ae)&&e(vt)!==void 0?e(vt):e(mt)),ct(I,"max",e(mt)),k(ce,`/ ${e(mt)??""}`),k(Re,(e(H),i(()=>e(H).resetOn==="short"?"Short Rest":"Long Rest")))}),A("input",I,Je=>{fe.update(Oe=>(Oe.classFeatures.features[e(Se)]=parseInt(Je.currentTarget.value)||0,Oe))}),A("click",ue,()=>ne(e(Se),e(mt))),o(Qe,b)};g(gt,Qe=>{e(H),i(()=>e(H).type==="pool")&&Qe(X)},!0)}o(qe,Ke)};g(Xe,qe=>{e(H),i(()=>e(H).type==="uses")?qe(Ne):qe(tt,!1)})}s(ae),D(qe=>{k(O,` ${e(Le)??""}`),k(de,qe)},[()=>(e(H),i(()=>M(e(H))))]),o(te,ae)}),s(Ee),o(U,ee)};g(C,U=>{e(_),i(()=>e(_).length===0)?U(W):U(j,!1)},!0)}o(St,Ct)};g(ft,St=>{t(),i(()=>!t().class)?St(ut):St(yt,!1)})}o(y,q)};g(me,y=>{p(),i(()=>!p().classFeatures)&&y(we)})}s($e),D(()=>ke=Et($e,1,"class-features svelte-1kpvv0n",null,ke,{hidden:!e(P)})),o(r,$e),Yt(),w()}var Ji=u('<textarea placeholder="Enter features, traits, and special abilities..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Equipment</h3> <textarea placeholder="List your equipment and inventory..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Notes</h3> <textarea placeholder="Additional notes..." class="svelte-wttn0l"></textarea>',1),Vi=u("<section><!> <!></section>");function Yi(r,c){Vt(c,!1);const t=()=>_t($a,"$searchFilter",p),v=()=>_t(fe,"$character",p),f=()=>_t(la,"$collapsedStates",p),[p,m]=fa(),w=S();function h(){la.update(Y=>({...Y,notes:!Y.notes}))}et(()=>(t(),v()),()=>{n(w,!t()||"features".includes(t().toLowerCase())||"traits".includes(t().toLowerCase())||"equipment".includes(t().toLowerCase())||"notes".includes(t().toLowerCase())||v().features.toLowerCase().includes(t().toLowerCase())||v().equipment.toLowerCase().includes(t().toLowerCase())||v().notes.toLowerCase().includes(t().toLowerCase()))}),ga(),Jt();var _=Vi();let G;var F=l(_);{let Y=xt(()=>(f(),i(()=>f().notes?"Expand":"Collapse")));Da(F,{title:"Features & Traits",get collapsed(){return f(),i(()=>f().notes)},get ariaLabel(){return e(Y)},onToggle:h})}var Z=a(F,2);{var K=Y=>{var N=Ji(),R=De(N);wa(R);var P=a(R,4);wa(P);var re=a(P,4);wa(re),We(R,()=>v().features,pe=>Ot(fe,i(v).features=pe,i(v))),We(P,()=>v().equipment,pe=>Ot(fe,i(v).equipment=pe,i(v))),We(re,()=>v().notes,pe=>Ot(fe,i(v).notes=pe,i(v))),o(Y,N)};g(Z,Y=>{f(),i(()=>!f().notes)&&Y(K)})}s(_),D(()=>G=Et(_,1,"notes svelte-wttn0l",null,G,{hidden:!e(w)})),o(r,_),Yt(),m()}var Qi=u(" <!> <!> <!> <!> <!>",1),Xi=u('<div class="color-picker-section svelte-1r90jgp"><h3 class="svelte-1r90jgp">Dice Colors</h3> <div class="color-inputs svelte-1r90jgp"><div class="color-input-group svelte-1r90jgp"><label for="dice-color" class="svelte-1r90jgp">Dice Color</label> <input type="color" id="dice-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="label-color" class="svelte-1r90jgp">Label Color</label> <input type="color" id="label-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="desk-color" class="svelte-1r90jgp">Background Color</label> <input type="color" id="desk-color" class="svelte-1r90jgp"/></div></div></div>'),Zi=u('<div class="loading svelte-1r90jgp"><p class="svelte-1r90jgp">Loading 3D dice...</p></div>'),en=u('<div class="custom-dice-selector svelte-1r90jgp"><h3 class="svelte-1r90jgp">Choose Dice to Roll</h3> <div class="dice-inputs svelte-1r90jgp"><div class="dice-input-group svelte-1r90jgp"><label for="d4" class="svelte-1r90jgp">d4</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d4" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d6" class="svelte-1r90jgp">d6</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d6" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d8" class="svelte-1r90jgp">d8</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d8" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d10" class="svelte-1r90jgp">d10</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d10" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d12" class="svelte-1r90jgp">d12</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d12" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d20" class="svelte-1r90jgp">d20</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d20" min="0" max="10"/></div></div> <div class="dice-controls svelte-1r90jgp"><button class="btn btn-primary use-enabled svelte-1r90jgp"> </button> <button class="btn btn-secondary use-enabled svelte-1r90jgp">Reset</button></div></div>'),tn=u('<h3 class="svelte-1r90jgp"> </h3>'),an=u('<h3 class="svelte-1r90jgp"> </h3>'),sn=u('<h3 class="svelte-1r90jgp"> </h3>'),ln=u('<h3 class="svelte-1r90jgp"> </h3>'),rn=u('<span class="crit-badge svelte-1r90jgp">CRITICAL HIT!</span>'),nn=u('<span class="crit-badge crit-fail svelte-1r90jgp">CRITICAL MISS!</span>'),on=u('<div class="bonus-item svelte-1r90jgp"><span class="bonus-value svelte-1r90jgp"> </span> <span class="bonus-source svelte-1r90jgp"> </span></div>'),cn=u('<div class="bonus-breakdown svelte-1r90jgp"></div>'),vn=u('<p class="modifier-text svelte-1r90jgp"> </p>'),dn=u('<div class="svelte-1r90jgp"><em class="svelte-1r90jgp">No damage is dealt on a critical miss.</em></div>'),un=u('<button class="btn btn-follow-up svelte-1r90jgp"> </button>'),fn=u('<button class="btn btn-guided-strike svelte-1r90jgp">‚ö° Use Guided Strike (+10)</button>'),pn=u('<div class="follow-up-actions svelte-1r90jgp"><!> <!></div>'),mn=u('<div class="result-header svelte-1r90jgp"><!> <!> <!></div> <div class="result-total svelte-1r90jgp"> </div> <div class="result-details svelte-1r90jgp"><!></div> <!> <!>',1),gn=u('<div role="button" tabindex="-1"><div class="modal-content svelte-1r90jgp" role="dialog" tabindex="0"><div class="modal-header svelte-1r90jgp"><h2 class="svelte-1r90jgp"><!></h2> <div class="header-buttons svelte-1r90jgp"><button class="color-btn svelte-1r90jgp" title="Customize dice colors">üé®</button> <button class="close-btn svelte-1r90jgp">√ó</button></div></div> <!> <!> <div class="dice-main-area svelte-1r90jgp"><div class="dice-container svelte-1r90jgp"></div> <!></div> <div><!></div></div></div>');function bn(r,c){Vt(c,!1);const t=()=>_t(fe,"$character",v),[v,f]=fa(),p=S(),m=S(),w=S(),h=xa();let _=Bt(c,"notation",12,""),G=Bt(c,"visible",8,!1),F=Bt(c,"damageNotation",12,""),Z=Bt(c,"damageType",8,""),K=Bt(c,"attackName",12,""),Y=Bt(c,"applyHalfDamage",8,!1),N=Bt(c,"bonusBreakdown",28,()=>[]),R=Bt(c,"rollType",12,"other"),P=Bt(c,"damageBreakdown",24,()=>[]),re=null,pe=S(void 0),Ue=S(!1),ne=S(""),ie=S(null),J=S("");function ye(){return e(ie)?.resultTotal??null}function Fe(b,I,oe){const ce=[];if(!b||!b.result)return ce;const ue=I.match(/([+-]?\d*d\d+|[+-]?\d+)/g)||[];let Re=0;const Je=new Set;let Oe=!0;for(const ve of ue){const V=ve.trim();if(!V)continue;const it=V.match(/([+-]?)(\d*)d(\d+)/);if(it){const xe=parseInt(it[2]||"1"),se=`${xe}d${it[3]}`,ge=oe.findIndex((nt,le)=>!Je.has(le)&&typeof nt.value=="string"&&nt.value===se),Ze=[];for(let nt=0;nt<xe&&Re<b.result.length;nt++)Ze.push(b.result[Re++]);let $t;ge>=0?($t=oe[ge].source,Je.add(ge)):$t="base";for(const nt of Ze)ce.push({display:`${nt}`,source:$t});Oe=!1}}for(let ve=0;ve<oe.length;ve++)if(!Je.has(ve)&&typeof oe[ve].value=="number"){const V=oe[ve].value;ce.push({display:V>=0?`+${V}`:`${V}`,source:oe[ve].source})}return ce}let M=S(0),T=S(0),x=S(0),Q=S(0),z=S(0),he=S(0),$e=S(0),ke=S([]),_e=S(!1),me=S(!1),we=S(!1),y=S("#051e0a"),q=S("#ffffff"),Pe=S("#3a2004"),ft=S(!1);function ut(b){return b.length===9&&b.startsWith("#")?b.substring(0,7):b}function yt(b,I="ff"){return b.length===7&&b.startsWith("#")?b+I:b}function St(){if(window.DICE&&e(pe))try{re&&e(pe)&&_a(pe,e(pe).innerHTML="");const b=e(pe).clientWidth||500,I=e(pe).clientHeight||300;re=new window.DICE.dice_box(e(pe),{w:b,h:I}),n(Ue,!0)}catch(b){console.error("Error initializing dice box:",b)}}Ca(()=>{const b=ce=>new Promise((ue,Re)=>{if(document.querySelector(`script[src="${ce}"]`)){ue(null);return}const Oe=document.createElement("script");Oe.src=ce,Oe.onload=()=>{ue(null)},Oe.onerror=()=>{console.error(`Failed to load: ${ce}`),Re(new Error(`Failed to load ${ce}`))},document.head.appendChild(Oe)});setTimeout(()=>{b(`${Ia}/libs/three.min.js`).then(()=>b(`${Ia}/libs/cannon.min.js`)).then(()=>b(`${Ia}/libs/teal.js`)).then(()=>b(`${Ia}/dice.js`)).then(()=>{if(window.DICE){const ce=window.DICE.getColors();n(y,ut(ce.dice_color)),n(q,ut(ce.label_color)),n(Pe,ut(ce.desk_color))}St()}).catch(ce=>{console.error("Failed to load dice libraries:",ce)})},100);const I=()=>{e(Ue)&&St()},oe=ce=>{G()&&ce.key==="Escape"&&Ee()};return window.addEventListener("resize",I),window.addEventListener("keydown",oe),()=>{window.removeEventListener("resize",I),window.removeEventListener("keydown",oe)}});function Ct(b,I="other"){if(!re||!e(Ue))return;n(ie,null),n(ke,[]),n(_e,!1),n(me,!1),R(I),n(we,!1),n(J,b),re.diceToRoll=b;const oe=ue=>null,ce=ue=>{let Re=ue.resultTotal,Je=ue.resultString;if(Y()&&(Re=Math.floor(Re/2),Je=Je+" (halved)"),n(ie,{...ue,resultTotal:Re,resultString:Je}),I==="attack"&&ue.result&&ue.result.length>0){const Oe=ue.result[0];n(_e,Oe===20),n(me,Oe===1)}if(n(ke,[]),I==="attack"&&F())if(e(_e)){const Oe=j(F()),ve=P().map(V=>{if(typeof V.value=="string"&&V.value.match(/^\d+d\d+$/)){const it=j(V.value);return{...V,value:it}}return V});e(ke).push({label:`Roll Critical Damage (${Oe})`,notation:Oe,breakdown:ve})}else e(me)||e(ke).push({label:`Roll Damage (${F()})`,notation:F(),breakdown:P()})};re.start_throw(oe,ce)}function C(){const b=[];e(M)>0&&b.push(`${e(M)}d4`),e(T)>0&&b.push(`${e(T)}d6`),e(x)>0&&b.push(`${e(x)}d8`),e(Q)>0&&b.push(`${e(Q)}d10`),e(z)>0&&b.push(`${e(z)}d12`),e(he)>0&&b.push(`${e(he)}d20`);let I=b.join("+")||"1d20";return e($e)!==0&&(I+=e($e)>=0?`+${e($e)}`:`${e($e)}`),I}function W(){const b=C();Ct(b)}function j(b){return b.replace(/(\d+)d(\d+)/g,(I,oe,ce)=>`${parseInt(oe)*2}d${ce}`)}function U(){n(M,0),n(T,0),n(x,0),n(Q,0),n(z,0),n(he,0),n($e,0),n(ie,null),n(ke,[]),n(_e,!1),n(me,!1),R("other"),n(we,!1)}function ee(){window.DICE&&(window.DICE.setColors({dice_color:yt(e(y),"ff"),label_color:yt(e(q),"ff"),desk_color:e(Pe)}),re&&(re.updateDeskColor(e(Pe)),re.updateDiceColors()))}function be(){n(ft,!e(ft))}function He(){!e(ie)||e(m)<=0||e(we)||(n(ie,{...e(ie),resultTotal:e(ie).resultTotal+10,resultString:e(ie).resultString+" + 10 (Guided Strike)"}),N([...N(),{value:10,source:"Guided Strike"}]),fe.update(b=>{const I="ChannelDivinity",oe=b.classFeatures.features[I];return typeof oe=="number"&&oe>0&&(b.classFeatures.features[I]=oe-1),b}),n(we,!0))}function Ee(){h("close"),_(""),F(""),K(""),n(ne,""),n(ie,null),n(we,!1),n(_e,!1),n(me,!1),U()}et(()=>(t(),Ta),()=>{n(p,t().class?Ta(t().class,t().level,t().subclass).some(I=>I.name==="Guided Strike"):!1)}),et(()=>t(),()=>{n(m,(()=>{const I=t().classFeatures.features["ChannelDivinity"];return typeof I=="number"?I:0})())}),et(()=>(e(M),e(T),e(x),e(Q),e(z),e(he),e($e)),()=>{n(w,(()=>{const b=[];e(M)>0&&b.push(`${e(M)}d4`),e(T)>0&&b.push(`${e(T)}d6`),e(x)>0&&b.push(`${e(x)}d8`),e(Q)>0&&b.push(`${e(Q)}d10`),e(z)>0&&b.push(`${e(z)}d12`),e(he)>0&&b.push(`${e(he)}d20`);let I=b.join("+")||"1d20";return e($e)!==0&&(I+=e($e)>=0?`+${e($e)}`:`${e($e)}`),I})())}),et(()=>(E(_()),e(Ue),E(G()),e(ne),E(R())),()=>{_()&&e(Ue)&&G()&&_()!==e(ne)&&(n(ne,_()),n(ie,null),n(ke,[]),n(_e,!1),n(me,!1),n(we,!1),setTimeout(()=>Ct(_(),R()),200))}),ga();var Ge={getLastRollTotal:ye};Jt();var Ie=gn();let $;var te=l(Ie),H=l(te),Le=l(H),Se=l(Le);{var vt=b=>{var I=Qi(),oe=De(I),ce=a(oe);{var ue=ge=>{var Ze=Tt("- Attack Roll");o(ge,Ze)};g(ce,ge=>{R()==="attack"&&ge(ue)})}var Re=a(ce,2);{var Je=ge=>{var Ze=Tt("- Damage Roll");o(ge,Ze)};g(Re,ge=>{R()==="damage"&&ge(Je)})}var Oe=a(Re,2);{var ve=ge=>{var Ze=Tt("- Healing Roll");o(ge,Ze)};g(Oe,ge=>{R()==="healing"&&ge(ve)})}var V=a(Oe,2);{var it=ge=>{var Ze=Tt("- Ability Check");o(ge,Ze)};g(V,ge=>{R()==="check"&&ge(it)})}var xe=a(V,2);{var se=ge=>{var Ze=Tt("- Saving Throw");o(ge,Ze)};g(xe,ge=>{R()==="save"&&ge(se)})}D(()=>k(oe,`${K()??""} `)),o(b,I)},Ae=b=>{var I=Tt("Dice Roller");o(b,I)};g(Se,b=>{K()?b(vt):b(Ae,!1)})}s(Le);var ae=a(Le,2),d=l(ae),Ye=a(d,2);s(ae),s(H);var Me=a(H,2);{var O=b=>{var I=Xi(),oe=a(l(I),2),ce=l(oe),ue=a(l(ce),2);Ce(ue),s(ce);var Re=a(ce,2),Je=a(l(Re),2);Ce(Je),s(Re);var Oe=a(Re,2),ve=a(l(Oe),2);Ce(ve),s(Oe),s(oe),s(I),We(ue,()=>e(y),V=>n(y,V)),A("change",ue,ee),We(Je,()=>e(q),V=>n(q,V)),A("change",Je,ee),We(ve,()=>e(Pe),V=>n(Pe,V)),A("change",ve,ee),o(b,I)};g(Me,b=>{e(ft)&&b(O)})}var Be=a(Me,2);{var de=b=>{var I=Zi();o(b,I)};g(Be,b=>{e(Ue)||b(de)})}var Xe=a(Be,2),Ne=l(Xe);Na(Ne,b=>n(pe,b),()=>e(pe));var tt=a(Ne,2);{var qe=b=>{var I=en(),oe=a(l(I),2),ce=l(oe),ue=a(l(ce),2);Ce(ue),s(ce);var Re=a(ce,2),Je=a(l(Re),2);Ce(Je),s(Re);var Oe=a(Re,2),ve=a(l(Oe),2);Ce(ve),s(Oe);var V=a(Oe,2),it=a(l(V),2);Ce(it),s(V);var xe=a(V,2),se=a(l(xe),2);Ce(se),s(xe);var ge=a(xe,2),Ze=a(l(ge),2);Ce(Ze),s(ge),s(oe);var $t=a(oe,2),nt=l($t),le=l(nt);s(nt);var Gt=a(nt,2);s($t),s(I),D(()=>{nt.disabled=!e(Ue),k(le,`Roll ${e(w)??""}`)}),We(ue,()=>e(M),Te=>n(M,Te)),We(Je,()=>e(T),Te=>n(T,Te)),We(ve,()=>e(x),Te=>n(x,Te)),We(it,()=>e(Q),Te=>n(Q,Te)),We(se,()=>e(z),Te=>n(z,Te)),We(Ze,()=>e(he),Te=>n(he,Te)),A("click",nt,W),A("click",Gt,U),o(b,I)};g(tt,b=>{_()||b(qe)})}s(Xe);var Ke=a(Xe,2);let gt;var X=l(Ke);{var Qe=b=>{var I=mn(),oe=De(I),ce=l(oe);{var ue=Te=>{var kt=tn(),aa=l(kt,!0);s(kt),D(()=>k(aa,K()?`${K()} - Healing`:"Healing")),o(Te,kt)},Re=Te=>{var kt=wt(),aa=De(kt);{var sa=je=>{var ze=an(),bt=l(ze,!0);s(ze),D(()=>k(bt,K()?`${K()} - ${Z()} Damage`:`${Z()} Damage`)),o(je,ze)},B=je=>{var ze=wt(),bt=De(ze);{var L=st=>{var ht=sn(),at=l(ht,!0);s(ht),D(()=>k(at,K()?`${K()} - Damage`:"Damage")),o(st,ht)},dt=st=>{var ht=ln(),at=l(ht,!0);s(ht),D(()=>k(at,K()?`${K()} - Result`:"Result")),o(st,ht)};g(bt,st=>{R()==="damage"?st(L):st(dt,!1)},!0)}o(je,ze)};g(aa,je=>{R()==="damage"&&Z()?je(sa):je(B,!1)},!0)}o(Te,kt)};g(ce,Te=>{R()==="damage"&&Z()==="Healing"?Te(ue):Te(Re,!1)})}var Je=a(ce,2);{var Oe=Te=>{var kt=rn();o(Te,kt)};g(Je,Te=>{e(_e)&&Te(Oe)})}var ve=a(Je,2);{var V=Te=>{var kt=nn();o(Te,kt)};g(ve,Te=>{e(me)&&Te(V)})}s(oe);var it=a(oe,2),xe=l(it,!0);s(it);var se=a(it,2),ge=l(se);{var Ze=Te=>{var kt=wt(),aa=De(kt);{var sa=je=>{var ze=cn();Lt(ze,5,()=>(e(ie),e(J),E(N()),i(()=>Fe(e(ie),e(J),N()))),Rt,(bt,L)=>{var dt=on(),st=l(dt),ht=l(st,!0);s(st);var at=a(st,2),lt=l(at);s(at),s(dt),D(()=>{k(ht,(e(L),i(()=>e(L).display))),k(lt,`(${e(L),i(()=>e(L).source)??""})`)}),o(bt,dt)}),s(ze),o(je,ze)},B=je=>{var ze=wt(),bt=De(ze);{var L=dt=>{var st=vn(),ht=l(st);s(st),D(()=>k(ht,`Modifier: ${e(ie),i(()=>e(ie).constant>=0?"+":"")??""}${e(ie),i(()=>e(ie).constant)??""}`)),o(dt,st)};g(bt,dt=>{e(ie),i(()=>e(ie).constant)&&dt(L)},!0)}o(je,ze)};g(aa,je=>{E(N()),i(()=>N().length>0)?je(sa):je(B,!1)})}o(Te,kt)};g(ge,Te=>{e(ie),E(N()),i(()=>e(ie).constant||N().length>0)&&Te(Ze)})}s(se);var $t=a(se,2);{var nt=Te=>{var kt=dn();o(Te,kt)};g($t,Te=>{e(me)&&Te(nt)})}var le=a($t,2);{var Gt=Te=>{var kt=pn(),aa=l(kt);Lt(aa,1,()=>e(ke),Rt,(je,ze)=>{var bt=un(),L=l(bt,!0);s(bt),D(()=>k(L,(e(ze),i(()=>e(ze).label)))),A("click",bt,()=>{N(e(ze).breakdown||[]),Ct(e(ze).notation,"damage")}),o(je,bt)});var sa=a(aa,2);{var B=je=>{var ze=fn();D(()=>{ze.disabled=e(m)<=0,ct(ze,"title",e(m)<=0?"No Channel Divinity uses remaining":"Use Channel Divinity to add +10 to this attack roll")}),A("click",ze,He),o(je,ze)};g(sa,je=>{e(p)&&R()==="attack"&&!e(we)&&e(m)>0&&!e(me)&&je(B)})}s(kt),o(Te,kt)};g(le,Te=>{e(ke),e(p),E(R()),e(we),e(m),i(()=>e(ke).length>0||e(p)&&R()==="attack"&&!e(we)&&e(m)>0)&&Te(Gt)})}D(()=>k(xe,(e(ie),i(()=>e(ie).resultTotal)))),o(b,I)};g(X,b=>{e(ie)&&b(Qe)})}s(Ke),s(te),s(Ie),D(()=>{$=Et(Ie,1,"modal-overlay svelte-1r90jgp",null,$,{hidden:!G()}),gt=Et(Ke,1,"roll-result svelte-1r90jgp",null,gt,{"has-result":e(ie)})}),A("click",d,be),A("click",Ye,Ee),A("click",te,xs(function(b){Ma.call(this,c,b)})),A("keydown",te,function(b){Ma.call(this,c,b)}),A("click",Ie,Ee),A("keydown",Ie,b=>b.key==="Escape"&&Ee()),o(r,Ie),Cl(c,"getLastRollTotal",ye);var mt=Yt(Ge);return f(),mt}const Za="https://api.github.com/gists";async function hn(r,c,t){if(!c)throw new Error("GitHub token is required");const v=JSON.stringify(r,null,2),f=`${r.name||"character"}_dnd.json`,p={description:t||`D&D Character: ${r.name}`,public:!1,files:{[f]:{content:v}}},m=await fetch(Za,{method:"POST",headers:{Authorization:`token ${c}`,"Content-Type":"application/json"},body:JSON.stringify(p)});if(!m.ok)throw new Error(`Failed to create gist: ${m.statusText}`);return(await m.json()).id}async function _n(r,c,t){if(!c||!t)throw new Error("GitHub token and Gist ID are required");const v=JSON.stringify(r,null,2),p={files:{[`${r.name||"character"}_dnd.json`]:{content:v}}},m=await fetch(`${Za}/${t}`,{method:"PATCH",headers:{Authorization:`token ${c}`,"Content-Type":"application/json"},body:JSON.stringify(p)});if(!m.ok)throw new Error(`Failed to update gist: ${m.statusText}`)}async function yn(r,c){if(!r)throw new Error("Gist ID is required");const t={"Content-Type":"application/json"};c&&(t.Authorization=`token ${c}`);const v=await fetch(`${Za}/${r}`,{method:"GET",headers:t});if(!v.ok)throw new Error(`Failed to load gist: ${v.statusText}`);const f=await v.json(),p=Object.values(f.files);if(p.length===0)throw new Error("No files found in gist");const w=p[0].content;try{const h=JSON.parse(w);return h.attacks&&Array.isArray(h.attacks)&&(h.attacks=h.attacks.map(_=>({..._,id:_.id||crypto.randomUUID()}))),h.classFeatures?(h.classFeatures.features||(h.classFeatures.features={}),h.classFeatures.spellSlots||(h.classFeatures.spellSlots=[]),h.classFeatures.preparedSpells===void 0&&(h.classFeatures.preparedSpells="")):h.classFeatures={features:{},spellSlots:[],preparedSpells:""},h}catch{throw new Error("Invalid character data in gist")}}function Fs(r){typeof window<"u"&&localStorage.setItem("dnd_gist_config",JSON.stringify(r))}function xn(){if(typeof window<"u"){const r=localStorage.getItem("dnd_gist_config");if(r)return JSON.parse(r)}return{}}async function $n(r,c=30){if(!r)throw new Error("GitHub token is required to list gists");const t=await fetch(`${Za}?per_page=${c}`,{method:"GET",headers:{Authorization:`token ${r}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error(`Failed to list gists: ${t.statusText}`);return await t.json()}var kn=u('<div class="error-message svelte-1jb5ckg"> </div>'),wn=u('<div class="toggle-container svelte-1jb5ckg"><button type="button" class="toggle-btn svelte-1jb5ckg"> </button></div>'),Sn=u('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID (leave empty to create new)</label> <input type="text" id="gistId" placeholder="Optional: existing Gist ID to update" class="svelte-1jb5ckg"/></div>'),Cn=u('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),Dn=u('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),Ln=u('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Update (or leave unselected to create new)</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),An=u('<div class="info-message svelte-1jb5ckg">No gists found. A new one will be created.</div>'),jn=u('<!> <div class="form-group svelte-1jb5ckg"><label for="description" class="svelte-1jb5ckg"> </label> <input type="text" id="description" placeholder="D&amp;D Character Sheet" class="svelte-1jb5ckg"/></div>',1),Bn=u('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID *</label> <input type="text" id="gistId" placeholder="Enter Gist ID (for public or your private gists)" required class="svelte-1jb5ckg"/></div>'),Rn=u('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),Mn=u('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),Tn=u('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Load</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),Fn=u('<div class="info-message svelte-1jb5ckg">No gists found. Enter a Gist ID manually or create a new one in Save mode.</div>'),Pn=u('<div class="modal-overlay svelte-1jb5ckg" role="button" tabindex="-1"><div class="modal-content svelte-1jb5ckg" role="dialog" tabindex="0"><div class="modal-header svelte-1jb5ckg"><h2 class="svelte-1jb5ckg"> </h2> <button class="close-btn svelte-1jb5ckg">√ó</button></div> <div class="modal-body svelte-1jb5ckg"><!> <div class="form-group svelte-1jb5ckg"><label for="token" class="svelte-1jb5ckg"> <a href="https://github.com/settings/tokens" target="_blank" rel="noopener" class="svelte-1jb5ckg">Get token</a></label> <input type="password" id="token" placeholder="ghp_xxxxxxxxxxxxx" class="svelte-1jb5ckg"/></div> <!> <!> <div class="modal-actions svelte-1jb5ckg"><button class="btn btn-primary svelte-1jb5ckg"><!></button> <button class="btn btn-secondary svelte-1jb5ckg">Cancel</button></div></div></div></div>');function In(r,c){Vt(c,!1);const t=()=>_t(fe,"$character",v),[v,f]=fa(),p=xa();let m=Bt(c,"mode",8,"save"),w=S(""),h=S(""),_=S(""),G=S(!1),F=S(""),Z=S(!1),K=S(!1),Y=S([]),N=S(null);const R=xn();R.token&&n(w,R.token),R.gistId&&n(h,R.gistId),Ca(async()=>{e(w)&&!e(Z)&&await P()});async function P(){if(e(w)){n(K,!0),n(F,"");try{n(Y,await $n(e(w))),e(h)&&n(N,e(Y).find(j=>j.id===e(h))||null)}catch(j){n(F,j.message||"Failed to load gists"),n(Y,[])}finally{n(K,!1)}}}function re(j){e(N)?.id===j.id?(n(N,null),n(h,"")):(n(N,j),n(h,j.id))}function pe(){n(Z,!e(Z)),n(F,""),!e(Z)&&e(w)&&P()}async function Ue(){if(!e(w)){n(F,"GitHub token is required");return}const j=e(N)?.id||e(h);n(G,!0),n(F,"");try{if(j)await _n(t(),e(w),j),n(h,j),Ht.add("Character updated in Gist successfully!","success");else{const U=await hn(t(),e(w),e(_));n(h,U),Ht.add(`Character saved to Gist! ID: ${U}`,"success")}Fs({token:e(w),gistId:e(h)}),p("close")}catch(U){n(F,U.message||"Failed to save to Gist")}finally{n(G,!1)}}async function ne(){const j=e(N)?.id||e(h);if(!j){n(F,"Please select a gist or enter a Gist ID");return}n(G,!0),n(F,"");try{const U=await yn(j,e(w)||void 0);fe.set(U),n(h,j),Fs({token:e(w),gistId:e(h)}),Ht.add("Character loaded from Gist successfully!","success"),p("close")}catch(U){n(F,U.message||"Failed to load from Gist")}finally{n(G,!1)}}function ie(){p("close")}Jt();var J=Pn(),ye=l(J),Fe=l(ye),M=l(Fe),T=l(M,!0);s(M);var x=a(M,2);s(Fe);var Q=a(Fe,2),z=l(Q);{var he=j=>{var U=kn(),ee=l(U,!0);s(U),D(()=>k(ee,e(F))),o(j,U)};g(z,j=>{e(F)&&j(he)})}var $e=a(z,2),ke=l($e),_e=l(ke);ta(),s(ke);var me=a(ke,2);Ce(me),s($e);var we=a($e,2);{var y=j=>{var U=wn(),ee=l(U),be=l(ee,!0);s(ee),s(U),D(()=>{ee.disabled=e(G),k(be,e(Z)?"üìã Show My Gists":"‚úèÔ∏è Enter Gist ID Manually")}),A("click",ee,pe),o(j,U)};g(we,j=>{(m()==="load"||m()==="save"&&e(w))&&j(y)})}var q=a(we,2);{var Pe=j=>{var U=jn(),ee=De(U);{var be=te=>{var H=Sn(),Le=a(l(H),2);Ce(Le),s(H),D(()=>Le.disabled=e(G)),We(Le,()=>e(h),Se=>n(h,Se)),o(te,H)},He=te=>{var H=wt(),Le=De(H);{var Se=Ae=>{var ae=Cn();o(Ae,ae)},vt=Ae=>{var ae=wt(),d=De(ae);{var Ye=O=>{var Be=Ln(),de=a(l(Be),2);Lt(de,5,()=>e(Y),Rt,(Xe,Ne)=>{var tt=Dn();let qe;var Ke=l(tt),gt=l(Ke),X=l(gt,!0);s(gt);var Qe=a(gt,2),mt=l(Qe,!0);s(Qe),s(Ke);var b=a(Ke,2),I=l(b),oe=l(I);s(I);var ce=a(I,2),ue=l(ce);s(ce),s(b),s(tt),D(Re=>{qe=Et(tt,1,"gist-item svelte-1jb5ckg",null,qe,{selected:e(N)?.id===e(Ne).id}),tt.disabled=e(G),k(X,(e(Ne),i(()=>e(Ne).description||"Untitled"))),k(mt,(e(Ne),i(()=>e(Ne).public?"üåê Public":"üîí Private"))),k(oe,`ID: ${e(Ne),i(()=>e(Ne).id)??""}`),k(ue,`Updated: ${Re??""}`)},[()=>(e(Ne),i(()=>new Date(e(Ne).updated_at).toLocaleDateString()))]),A("click",tt,()=>re(e(Ne))),o(Xe,tt)}),s(de),s(Be),o(O,Be)},Me=O=>{var Be=wt(),de=De(Be);{var Xe=Ne=>{var tt=An();o(Ne,tt)};g(de,Ne=>{e(w)&&Ne(Xe)},!0)}o(O,Be)};g(d,O=>{e(Y),i(()=>e(Y).length>0)?O(Ye):O(Me,!1)},!0)}o(Ae,ae)};g(Le,Ae=>{e(K)?Ae(Se):Ae(vt,!1)},!0)}o(te,H)};g(ee,te=>{e(Z)||!e(w)?te(be):te(He,!1)})}var Ee=a(ee,2),Ge=l(Ee),Ie=l(Ge);s(Ge);var $=a(Ge,2);Ce($),s(Ee),D(()=>{k(Ie,`Description ${e(h)?"(optional)":""}`),$.disabled=e(G)}),We($,()=>e(_),te=>n(_,te)),o(j,U)},ft=j=>{var U=wt(),ee=De(U);{var be=Ee=>{var Ge=Bn(),Ie=a(l(Ge),2);Ce(Ie),s(Ge),D(()=>Ie.disabled=e(G)),We(Ie,()=>e(h),$=>n(h,$)),o(Ee,Ge)},He=Ee=>{var Ge=wt(),Ie=De(Ge);{var $=H=>{var Le=Rn();o(H,Le)},te=H=>{var Le=wt(),Se=De(Le);{var vt=ae=>{var d=Tn(),Ye=a(l(d),2);Lt(Ye,5,()=>e(Y),Rt,(Me,O)=>{var Be=Mn();let de;var Xe=l(Be),Ne=l(Xe),tt=l(Ne,!0);s(Ne);var qe=a(Ne,2),Ke=l(qe,!0);s(qe),s(Xe);var gt=a(Xe,2),X=l(gt),Qe=l(X);s(X);var mt=a(X,2),b=l(mt);s(mt),s(gt),s(Be),D(I=>{de=Et(Be,1,"gist-item svelte-1jb5ckg",null,de,{selected:e(N)?.id===e(O).id}),Be.disabled=e(G),k(tt,(e(O),i(()=>e(O).description||"Untitled"))),k(Ke,(e(O),i(()=>e(O).public?"üåê Public":"üîí Private"))),k(Qe,`ID: ${e(O),i(()=>e(O).id)??""}`),k(b,`Updated: ${I??""}`)},[()=>(e(O),i(()=>new Date(e(O).updated_at).toLocaleDateString()))]),A("click",Be,()=>re(e(O))),o(Me,Be)}),s(Ye),s(d),o(ae,d)},Ae=ae=>{var d=wt(),Ye=De(d);{var Me=O=>{var Be=Fn();o(O,Be)};g(Ye,O=>{e(w)&&O(Me)},!0)}o(ae,d)};g(Se,ae=>{e(Y),i(()=>e(Y).length>0)?ae(vt):ae(Ae,!1)},!0)}o(H,Le)};g(Ie,H=>{e(K)?H($):H(te,!1)},!0)}o(Ee,Ge)};g(ee,Ee=>{e(Z)||!e(w)?Ee(be):Ee(He,!1)},!0)}o(j,U)};g(q,j=>{m()==="save"?j(Pe):j(ft,!1)})}var ut=a(q,2),yt=l(ut),St=l(yt);{var Ct=j=>{var U=Tt();D(()=>k(U,m()==="save"?"Saving...":"Loading...")),o(j,U)},C=j=>{var U=Tt();D(()=>k(U,m()==="save"?"Save":"Load")),o(j,U)};g(St,j=>{e(G)?j(Ct):j(C,!1)})}s(yt);var W=a(yt,2);s(ut),s(Q),s(ye),s(J),D(()=>{k(T,m()==="save"?"Save to GitHub Gist":"Load from GitHub Gist"),k(_e,`GitHub Token ${m()==="load"?"(optional for public gists)":"(required)"} `),me.disabled=e(G),yt.disabled=e(G),W.disabled=e(G)}),A("click",x,ie),We(me,()=>e(w),j=>n(w,j)),A("blur",me,()=>{e(w)&&!e(Z)&&P()}),A("click",yt,function(...j){(m()==="save"?Ue:ne)?.apply(this,j)}),A("click",W,ie),A("click",ye,xs(function(j){Ma.call(this,c,j)})),A("keydown",ye,function(j){Ma.call(this,c,j)}),A("click",J,ie),A("keydown",J,j=>j.key==="Escape"&&ie()),o(r,J),Yt(),f()}var En=u('<div class="loading svelte-1ngjemu">Loading D&D data...</div>'),Nn=u("<option> </option>"),Un=u('<select class="level-filter svelte-1ngjemu"><option>All Levels</option><option>Cantrip</option><!></select>'),Hn=u('<div class="no-results svelte-1ngjemu"> </div>'),On=u('<div class="item-meta svelte-1ngjemu"> </div>'),Gn=u('<div class="item-meta svelte-1ngjemu"> </div>'),qn=u('<button><div class="item-name svelte-1ngjemu"> </div> <!></button>'),zn=u('<p class="higher-levels"><strong>At Higher Levels:</strong> </p>'),Wn=u('<p class="cantrip-upgrade"><strong>Cantrip Upgrade:</strong> </p>'),Kn=u('<h3 class="svelte-1ngjemu"> </h3> <p class="spell-meta svelte-1ngjemu"><!> <!></p> <p class="spell-classes"><strong>Classes:</strong> </p> <div class="spell-stats svelte-1ngjemu"><div><strong>Casting Time:</strong> </div> <div><strong>Range:</strong> </div> <div><strong>Components:</strong> <!></div> <div><strong>Duration:</strong> <!> </div></div> <p class="description svelte-1ngjemu"> </p> <!> <!>',1),Jn=u('<p class="prerequisite svelte-1ngjemu"><strong>Prerequisite:</strong> </p>'),Vn=u('<h3 class="svelte-1ngjemu"> </h3> <!> <p class="description svelte-1ngjemu"> </p> <a target="_blank" rel="noopener" class="source-link svelte-1ngjemu">View Full Details ‚Üí</a>',1),Yn=u('<div class="item-details svelte-1ngjemu"><!></div>'),Qn=u('<div class="controls svelte-1ngjemu"><div class="tabs svelte-1ngjemu"><button> </button> <button> </button></div> <div class="search-controls svelte-1ngjemu"><input type="text" placeholder="Search by name or description..." class="search-input svelte-1ngjemu"/> <!></div></div> <div class="content-container svelte-1ngjemu"><div class="items-list svelte-1ngjemu"><!></div> <!></div>',1),Xn=u('<div class="modal-backdrop svelte-1ngjemu" role="presentation"><div class="modal svelte-1ngjemu" role="dialog" aria-modal="true" tabindex="-1"><div class="modal-header svelte-1ngjemu"><h2 class="svelte-1ngjemu">Browse D&D Spells & Feats</h2> <button class="close-btn svelte-1ngjemu" aria-label="Close">&times;</button></div> <div class="modal-body svelte-1ngjemu"><!></div> <div class="modal-footer svelte-1ngjemu"><button class="btn-secondary svelte-1ngjemu">Cancel</button> <button class="btn-primary svelte-1ngjemu">Add to Character Sheet</button></div></div></div>');function Zn(r,c){Vt(c,!1);const t=S(),v=S(),f=S();let p=Bt(c,"onClose",8),m=S("spell"),w=S(!0),h=S(""),_=S(null),G=S([]),F=S([]),Z=S(null);Ca(async()=>{n(w,!0);try{n(G,await zs()),n(F,await fr())}catch(x){console.error("Failed to load data:",x)}finally{n(w,!1)}});function K(x){n(Z,x)}function Y(x){const Q=x.match(/(\d+d\d+(?:\s*\+\s*\d+)?)/i);return Q?Q[1]:""}function N(x){const Q=x.split(/\.( |$)/)[0].trim(),z=Array.from(x.matchAll(/\*\*(.*?)\*\*/g)).map($e=>$e[1].replace(/\.$/,""));let he=Q;return z.length&&(he+=" | Effects: "+z.join(", ")),he}function R(){if(e(Z)){if(e(m)==="spell"){const x=e(Z);fe.update(Q=>{const he=[];x.range&&he.push(`Range: ${x.range}`),x.castingTime&&he.push(`Cast: ${x.castingTime}`),x.duration&&he.push(`Duration: ${x.duration}`),x.actionType==="Save"&&he.push("Saving throw spell"),x.components&&x.components.length>0&&he.push(`Components: ${x.components.join(", ")}`),x.material&&he.push(`Material: ${x.material}`);const $e=he.join(" | "),ke=N(x.description),_e={id:crypto.randomUUID(),name:`${x.name}${x.concentration?" (C)":""}${x.ritual?" (R)":""}`,bonus:x.actionType==="Attack"?5:0,damage:Y(x.description),damageType:`${x.school} (Lvl ${x.level})`,spellRef:x.name,infoNotes:$e,generalNotes:ke,castAtLevel:x.level};return Q.attacks=[...Q.attacks,_e],Q})}else if(e(m)==="feat"){const x=e(Z);fe.update(Q=>{const z=`${x.name}${x.prerequisite?` (Req: ${x.prerequisite})`:""}
${x.description}
`;return Q.features=Q.features?`${Q.features}
${z}`:z,Q})}n(Z,null),p()()}}et(()=>(e(_),e(G),e(h)),()=>{n(t,e(_)!==null?pr(Ms(e(G),e(h)),e(_)):Ms(e(G),e(h)))}),et(()=>(e(F),e(h)),()=>{n(v,mr(e(F),e(h)))}),et(()=>(e(m),e(t),e(v)),()=>{n(f,e(m)==="spell"?e(t):e(v))}),ga(),Jt();var P=Xn(),re=l(P),pe=l(re),Ue=a(l(pe),2);s(pe);var ne=a(pe,2),ie=l(ne);{var J=x=>{var Q=En();o(x,Q)},ye=x=>{var Q=Qn(),z=De(Q),he=l(z),$e=l(he);let ke;var _e=l($e);s($e);var me=a($e,2);let we;var y=l(me);s(me),s(he);var q=a(he,2),Pe=l(q);Ce(Pe);var ft=a(Pe,2);{var ut=ee=>{var be=Un();D(()=>{e(_),Kt(()=>{})});var He=l(be);He.value=(He.__value=null)??"";var Ee=a(He);Ee.value=Ee.__value=0;var Ge=a(Ee);Lt(Ge,0,()=>[1,2,3,4,5,6,7,8,9],Rt,(Ie,$)=>{var te=Nn(),H=l(te);s(te);var Le={};D(()=>{k(H,`Level ${$??""}`),Le!==(Le=$)&&(te.value=(te.__value=$)??"")}),o(Ie,te)}),s(be),Ua(be,()=>e(_),Ie=>n(_,Ie)),o(ee,be)};g(ft,ee=>{e(m)==="spell"&&ee(ut)})}s(q),s(z);var yt=a(z,2),St=l(yt),Ct=l(St);{var C=ee=>{var be=Hn(),He=l(be);s(be),D(()=>k(He,`No ${e(m)??""}s found`)),o(ee,be)},W=ee=>{var be=wt(),He=De(be);Lt(He,1,()=>e(f),Rt,(Ee,Ge)=>{var Ie=qn();let $;var te=l(Ie),H=l(te,!0);s(te);var Le=a(te,2);{var Se=Ae=>{const ae=xt(()=>e(Ge));var d=On(),Ye=l(d);s(d),D(()=>k(Ye,`Level ${E(e(ae)),i(()=>e(ae).level)??""} ‚Ä¢ ${E(e(ae)),i(()=>e(ae).school)??""}`)),o(Ae,d)},vt=Ae=>{const ae=xt(()=>e(Ge));var d=wt(),Ye=De(d);{var Me=O=>{var Be=Gn(),de=l(Be,!0);s(Be),D(()=>k(de,(E(e(ae)),i(()=>e(ae).prerequisite)))),o(O,Be)};g(Ye,O=>{E(e(ae)),i(()=>e(ae).prerequisite)&&O(Me)})}o(Ae,d)};g(Le,Ae=>{e(m)==="spell"?Ae(Se):Ae(vt,!1)})}s(Ie),D(()=>{$=Et(Ie,1,"item-card svelte-1ngjemu",null,$,{selected:e(Z)?.name===e(Ge).name}),k(H,(e(Ge),i(()=>e(Ge).name)))}),A("click",Ie,()=>K(e(Ge))),o(Ee,Ie)}),o(ee,be)};g(Ct,ee=>{e(f),i(()=>e(f).length===0)?ee(C):ee(W,!1)})}s(St);var j=a(St,2);{var U=ee=>{var be=Yn(),He=l(be);{var Ee=Ie=>{const $=xt(()=>e(Z));var te=Kn(),H=De(te),Le=l(H,!0);s(H);var Se=a(H,2),vt=l(Se);{var Ae=ve=>{var V=Tt();D(()=>k(V,`${E(e($)),i(()=>e($).school)??""} cantrip`)),o(ve,V)},ae=ve=>{var V=Tt();D(()=>k(V,`Level ${E(e($)),i(()=>e($).level)??""} ${E(e($)),i(()=>e($).school)??""}`)),o(ve,V)};g(vt,ve=>{E(e($)),i(()=>e($).level===0)?ve(Ae):ve(ae,!1)})}var d=a(vt,2);{var Ye=ve=>{var V=Tt("(ritual)");o(ve,V)};g(d,ve=>{E(e($)),i(()=>e($).ritual)&&ve(Ye)})}s(Se);var Me=a(Se,2),O=a(l(Me));s(Me);var Be=a(Me,2),de=l(Be),Xe=a(l(de));s(de);var Ne=a(de,2),tt=a(l(Ne));s(Ne);var qe=a(Ne,2),Ke=a(l(qe)),gt=a(Ke);{var X=ve=>{var V=Tt();D(()=>k(V,`(${E(e($)),i(()=>e($).material)??""})`)),o(ve,V)};g(gt,ve=>{E(e($)),i(()=>e($).material)&&ve(X)})}s(qe);var Qe=a(qe,2),mt=a(l(Qe),2);{var b=ve=>{var V=Tt("Concentration,");o(ve,V)};g(mt,ve=>{E(e($)),i(()=>e($).concentration)&&ve(b)})}var I=a(mt,1,!0);s(Qe),s(Be);var oe=a(Be,2),ce=l(oe,!0);s(oe);var ue=a(oe,2);{var Re=ve=>{var V=zn(),it=a(l(V));s(V),D(()=>k(it,` ${E(e($)),i(()=>e($).higherLevelSlot)??""}`)),o(ve,V)};g(ue,ve=>{E(e($)),i(()=>e($).higherLevelSlot)&&ve(Re)})}var Je=a(ue,2);{var Oe=ve=>{var V=Wn(),it=a(l(V));s(V),D(()=>k(it,` ${E(e($)),i(()=>e($).cantripUpgrade)??""}`)),o(ve,V)};g(Je,ve=>{E(e($)),i(()=>e($).cantripUpgrade)&&ve(Oe)})}D((ve,V)=>{k(Le,(E(e($)),i(()=>e($).name))),k(O,` ${ve??""}`),k(Xe,` ${E(e($)),i(()=>e($).castingTime||e($).actionType)??""}`),k(tt,` ${E(e($)),i(()=>e($).range)??""}`),k(Ke,` ${V??""}`),k(I,(E(e($)),i(()=>e($).duration))),k(ce,(E(e($)),i(()=>e($).description)))},[()=>(E(e($)),i(()=>e($).classes.join(", "))),()=>(E(e($)),i(()=>e($).components.join(", ").toUpperCase()))]),o(Ie,te)},Ge=Ie=>{const $=xt(()=>e(Z));var te=Vn(),H=De(te),Le=l(H,!0);s(H);var Se=a(H,2);{var vt=Ye=>{var Me=Jn(),O=a(l(Me));s(Me),D(()=>k(O,` ${E(e($)),i(()=>e($).prerequisite)??""}`)),o(Ye,Me)};g(Se,Ye=>{E(e($)),i(()=>e($).prerequisite)&&Ye(vt)})}var Ae=a(Se,2),ae=l(Ae,!0);s(Ae);var d=a(Ae,2);D(()=>{k(Le,(E(e($)),i(()=>e($).name))),k(ae,(E(e($)),i(()=>e($).description))),ct(d,"href",(E(e($)),i(()=>e($).source)))}),o(Ie,te)};g(He,Ie=>{e(m)==="spell"?Ie(Ee):Ie(Ge,!1)})}s(be),o(ee,be)};g(j,ee=>{e(Z)&&ee(U)})}s(yt),D(()=>{ke=Et($e,1,"tab svelte-1ngjemu",null,ke,{active:e(m)==="spell"}),k(_e,`üìú Spells (${e(G),i(()=>e(G).length)??""})`),we=Et(me,1,"tab svelte-1ngjemu",null,we,{active:e(m)==="feat"}),k(y,`‚≠ê Feats (${e(F),i(()=>e(F).length)??""})`)}),A("click",$e,()=>{n(m,"spell"),n(Z,null),n(h,"")}),A("click",me,()=>{n(m,"feat"),n(Z,null),n(h,"")}),We(Pe,()=>e(h),ee=>n(h,ee)),o(x,Q)};g(ie,x=>{e(w)?x(J):x(ye,!1)})}s(ne);var Fe=a(ne,2),M=l(Fe),T=a(M,2);s(Fe),s(re),s(P),D(()=>T.disabled=!e(Z)),A("click",Ue,function(...x){p()?.apply(this,x)}),A("click",M,function(...x){p()?.apply(this,x)}),A("click",T,R),A("click",re,xs(function(x){Ma.call(this,c,x)})),A("keydown",re,function(x){Ma.call(this,c,x)}),A("click",P,function(...x){p()?.apply(this,x)}),A("keydown",P,x=>x.key==="Escape"&&p()()),o(r,P),Yt()}var eo=u('<span class="resistance-tag svelte-gdwwx1"> <button type="button" class="tag-remove svelte-gdwwx1">√ó</button></span>'),to=u('<div class="resistance-list svelte-gdwwx1"></div>'),ao=u('<p class="ability-meta svelte-gdwwx1"> <!></p>'),so=u('<p class="ability-meta svelte-gdwwx1">Requires Reaction</p>'),lo=u('<div class="ability-card svelte-gdwwx1"><div class="ability-header svelte-gdwwx1"><strong class="svelte-gdwwx1"> </strong> <button type="button" class="ability-remove svelte-gdwwx1">√ó</button></div> <p class="ability-description svelte-gdwwx1"> </p> <!></div>'),ro=u('<div class="abilities-list svelte-gdwwx1"></div>'),io=u(`<div class="modal-backdrop svelte-gdwwx1" role="presentation"><div class="modal-content svelte-gdwwx1" role="dialog" aria-modal="true" aria-labelledby="modal-title"><div class="modal-header svelte-gdwwx1"><h3 id="modal-title" class="svelte-gdwwx1">Add Custom Condition</h3> <button class="btn-close svelte-gdwwx1" aria-label="Close">√ó</button></div> <div class="modal-body svelte-gdwwx1"><div class="form-group svelte-gdwwx1"><label for="conditionName" class="svelte-gdwwx1">Condition Name*</label> <input type="text" id="conditionName" placeholder="e.g., Cazna's Mark" class="svelte-gdwwx1"/></div> <div class="form-group svelte-gdwwx1"><label for="description" class="svelte-gdwwx1">Description</label> <textarea id="description" placeholder="Describe the condition..." rows="3" class="svelte-gdwwx1"></textarea></div> <div class="form-row svelte-gdwwx1"><div class="form-group svelte-gdwwx1"><label for="attackBonus" class="svelte-gdwwx1">Attack Bonus</label> <input type="text" id="attackBonus" placeholder="0 or 1d4" class="svelte-gdwwx1"/></div> <div class="form-group svelte-gdwwx1"><label for="damageBonus" class="svelte-gdwwx1">Damage Bonus</label> <input type="text" id="damageBonus" placeholder="0 or 1d6" class="svelte-gdwwx1"/></div> <div class="form-group svelte-gdwwx1"><label for="acBonus" class="svelte-gdwwx1">AC Bonus</label> <input type="number" id="acBonus" placeholder="0" class="svelte-gdwwx1"/></div></div> <div class="form-group svelte-gdwwx1"><label for="darkvision" class="svelte-gdwwx1">Darkvision (feet)</label> <input type="number" id="darkvision" placeholder="0" min="0" step="30" class="svelte-gdwwx1"/> <small class="help-text svelte-gdwwx1">Grant or extend darkvision (e.g., 60 for 60 feet)</small></div> <div class="form-group svelte-gdwwx1"><label class="svelte-gdwwx1">Damage Resistances</label> <div class="resistance-input-group svelte-gdwwx1"><input type="text" placeholder="e.g., cold, fire, poison" class="svelte-gdwwx1"/> <button type="button" class="btn-add svelte-gdwwx1">Add</button></div> <!></div> <div class="form-group svelte-gdwwx1"><label class="svelte-gdwwx1">Special Abilities</label> <div class="ability-form svelte-gdwwx1"><input type="text" placeholder="Ability name (e.g., Flicker of Deceit)" class="ability-name-input svelte-gdwwx1"/> <textarea placeholder="Ability description..." rows="2" class="ability-desc-input svelte-gdwwx1"></textarea> <div class="ability-options svelte-gdwwx1"><div class="ability-option svelte-gdwwx1"><label for="abilityUses" class="svelte-gdwwx1">Uses per rest</label> <input type="number" id="abilityUses" min="0" class="svelte-gdwwx1"/></div> <div class="ability-option svelte-gdwwx1"><label for="restType" class="svelte-gdwwx1">Rest type</label> <select id="restType" class="svelte-gdwwx1"><option>Short</option><option>Long</option></select></div> <div class="ability-option svelte-gdwwx1"><label class="svelte-gdwwx1"><input type="checkbox" class="svelte-gdwwx1"/> Requires Reaction</label></div></div> <button type="button" class="btn-add svelte-gdwwx1">Add Ability</button></div> <!></div></div> <div class="modal-footer svelte-gdwwx1"><button class="btn btn-secondary svelte-gdwwx1">Cancel</button> <button class="btn btn-primary svelte-gdwwx1">Add Condition</button></div></div></div>`);function no(r,c){Vt(c,!1);let t=Bt(c,"show",8,!1),v=Bt(c,"onSave",8),f=Bt(c,"onCancel",8),p=S(""),m=S(""),w=S(0),h=S(0),_=S(0),G=S(0),F=S([]),Z=S(""),K=S([]),Y=S(""),N=S(""),R=S(0),P=S("short"),re=S(!1);function pe(){n(p,""),n(m,""),n(w,0),n(h,0),n(_,0),n(G,0),n(F,[]),n(Z,""),n(K,[]),n(Y,""),n(N,""),n(R,0),n(P,"short"),n(re,!1)}function Ue(){e(Z).trim()&&(n(F,[...e(F),e(Z).trim()]),n(Z,""))}function ne(z){n(F,e(F).filter((he,$e)=>$e!==z))}function ie(){if(e(Y).trim()&&e(N).trim()){const z={name:e(Y).trim(),description:e(N).trim(),requiresReaction:e(re)};e(R)>0&&(z.usesPerRest=e(R),z.currentUses=e(R),z.restType=e(P)),n(K,[...e(K),z]),n(Y,""),n(N,""),n(R,0),n(P,"short"),n(re,!1)}}function J(z){n(K,e(K).filter((he,$e)=>$e!==z))}function ye(){if(!e(p).trim()){alert("Please enter a condition name");return}const z={name:e(p).trim(),description:e(m).trim()||"Custom condition",attackBonus:e(w)||0,damageBonus:e(h)||0,target:"self"};e(_)!==0&&(z.acBonus=e(_)),e(G)>0&&(z.darkvision=e(G)),e(F).length>0&&(z.resistances=e(F)),e(K).length>0&&(z.abilities=e(K)),v()(z),pe()}function Fe(){pe(),f()()}function M(z){z.target===z.currentTarget&&Fe()}Jt();var T=wt(),x=De(T);{var Q=z=>{var he=io(),$e=l(he),ke=l($e),_e=a(l(ke),2);s(ke);var me=a(ke,2),we=l(me),y=a(l(we),2);Ce(y),s(we);var q=a(we,2),Pe=a(l(q),2);wa(Pe),s(q);var ft=a(q,2),ut=l(ft),yt=a(l(ut),2);Ce(yt),s(ut);var St=a(ut,2),Ct=a(l(St),2);Ce(Ct),s(St);var C=a(St,2),W=a(l(C),2);Ce(W),s(C),s(ft);var j=a(ft,2),U=a(l(j),2);Ce(U),ta(2),s(j);var ee=a(j,2),be=a(l(ee),2),He=l(be);Ce(He);var Ee=a(He,2);s(be);var Ge=a(be,2);{var Ie=X=>{var Qe=to();Lt(Qe,5,()=>e(F),Rt,(mt,b,I)=>{var oe=eo(),ce=l(oe),ue=a(ce);s(oe),D(()=>{k(ce,`${e(b)??""} `),ct(ue,"aria-label",`Remove ${e(b)??""}`)}),A("click",ue,()=>ne(I)),o(mt,oe)}),s(Qe),o(X,Qe)};g(Ge,X=>{e(F),i(()=>e(F).length>0)&&X(Ie)})}s(ee);var $=a(ee,2),te=a(l($),2),H=l(te);Ce(H);var Le=a(H,2);wa(Le);var Se=a(Le,2),vt=l(Se),Ae=a(l(vt),2);Ce(Ae),s(vt);var ae=a(vt,2),d=a(l(ae),2);D(()=>{e(P),Kt(()=>{})});var Ye=l(d);Ye.value=Ye.__value="short";var Me=a(Ye);Me.value=Me.__value="long",s(d),s(ae);var O=a(ae,2),Be=l(O),de=l(Be);Ce(de),ta(),s(Be),s(O),s(Se);var Xe=a(Se,2);s(te);var Ne=a(te,2);{var tt=X=>{var Qe=ro();Lt(Qe,5,()=>e(K),Rt,(mt,b,I)=>{var oe=lo(),ce=l(oe),ue=l(ce),Re=l(ue,!0);s(ue);var Je=a(ue,2);s(ce);var Oe=a(ce,2),ve=l(Oe,!0);s(Oe);var V=a(Oe,2);{var it=se=>{var ge=ao(),Ze=l(ge),$t=a(Ze);{var nt=le=>{var Gt=Tt("‚Ä¢ Requires Reaction");o(le,Gt)};g($t,le=>{e(b),i(()=>e(b).requiresReaction)&&le(nt)})}s(ge),D(()=>k(Ze,`${e(b),i(()=>e(b).usesPerRest)??""} use${e(b),i(()=>e(b).usesPerRest>1?"s":"")??""} per ${e(b),i(()=>e(b).restType)??""}
                      rest `)),o(se,ge)},xe=se=>{var ge=wt(),Ze=De(ge);{var $t=nt=>{var le=so();o(nt,le)};g(Ze,nt=>{e(b),i(()=>e(b).requiresReaction)&&nt($t)},!0)}o(se,ge)};g(V,se=>{e(b),i(()=>e(b).usesPerRest)?se(it):se(xe,!1)})}s(oe),D(()=>{k(Re,(e(b),i(()=>e(b).name))),ct(Je,"aria-label",`Remove ${e(b),i(()=>e(b).name)??""}`),k(ve,(e(b),i(()=>e(b).description)))}),A("click",Je,()=>J(I)),o(mt,oe)}),s(Qe),o(X,Qe)};g(Ne,X=>{e(K),i(()=>e(K).length>0)&&X(tt)})}s($),s(me);var qe=a(me,2),Ke=l(qe),gt=a(Ke,2);s(qe),s($e),s(he),A("click",_e,Fe),We(y,()=>e(p),X=>n(p,X)),We(Pe,()=>e(m),X=>n(m,X)),We(yt,()=>e(w),X=>n(w,X)),We(Ct,()=>e(h),X=>n(h,X)),We(W,()=>e(_),X=>n(_,X)),We(U,()=>e(G),X=>n(G,X)),We(He,()=>e(Z),X=>n(Z,X)),A("keydown",He,X=>X.key==="Enter"&&Ue()),A("click",Ee,Ue),We(H,()=>e(Y),X=>n(Y,X)),We(Le,()=>e(N),X=>n(N,X)),We(Ae,()=>e(R),X=>n(R,X)),Ua(d,()=>e(P),X=>n(P,X)),ja(de,()=>e(re),X=>n(re,X)),A("click",Xe,ie),A("click",Ke,Fe),A("click",gt,ye),A("click",he,M),o(z,he)};g(x,z=>{t()&&z(Q)})}o(r,T),Yt()}var oo=u("<option></option>"),co=u("<button> </button>"),vo=u('<div class="adjustment-msg svelte-uvfntf"> </div>'),uo=u('<div class="calculation-result svelte-uvfntf"><div class="result-header svelte-uvfntf"><h4 class="svelte-uvfntf">Damage Calculation</h4></div> <div class="result-content svelte-uvfntf"><div class="damage-breakdown svelte-uvfntf"><div class="damage-row svelte-uvfntf"><span class="label svelte-uvfntf">Original Damage:</span> <span class="value svelte-uvfntf"> </span></div> <div class="adjustments svelte-uvfntf"></div> <div class="damage-row final svelte-uvfntf"><span class="label svelte-uvfntf">Final Damage:</span> <span class="value damage-value svelte-uvfntf"> </span></div></div></div> <div class="result-actions svelte-uvfntf"><button class="btn btn-primary apply-btn use-enabled svelte-uvfntf">Apply Damage</button> <button class="btn btn-secondary cancel-btn use-enabled svelte-uvfntf">Cancel</button></div></div>'),fo=u('<div class="damage-form svelte-uvfntf"><div class="input-group svelte-uvfntf"><div class="input-field svelte-uvfntf"><label for="damageAmount" class="svelte-uvfntf">Damage Amount</label> <input type="number" id="damageAmount" min="0" placeholder="0" class="damage-input-field use-enabled svelte-uvfntf"/></div> <div class="input-field svelte-uvfntf"><label for="damageType" class="svelte-uvfntf">Damage Type</label> <input type="text" id="damageType" list="damageTypes" placeholder="e.g., fire, cold" class="damage-input-field use-enabled svelte-uvfntf"/> <datalist id="damageTypes"></datalist></div></div> <div class="quick-types svelte-uvfntf"><span class="quick-types-label svelte-uvfntf">Quick Select:</span> <!></div> <!></div>'),po=u("<section><!> <!></section>");function mo(r,c){Vt(c,!1);const t=()=>_t(fe,"$character",p),v=()=>_t($a,"$searchFilter",p),f=()=>_t(la,"$collapsedStates",p),[p,m]=fa(),w=S();xa();let h=S(0),_=S(""),G=S(0),F=S([]);const Z=["slashing","piercing","bludgeoning","fire","cold","lightning","thunder","acid","poison","necrotic","radiant","psychic","force"],K={slashing:"üó°Ô∏è",piercing:"üèπ",bludgeoning:"üî®",fire:"üî•",cold:"‚ùÑÔ∏è",lightning:"‚ö°",thunder:"üí•",acid:"üß™",poison:"‚ò†Ô∏è",necrotic:"üíÄ",radiant:"‚ú®",psychic:"üß†",force:"üå™Ô∏è"};function Y(){fe.update(ne=>Wl(ne,e(G))),Ht.add(`Applied ${e(G)} damage to character (${e(_)})`,"info"),n(h,0),n(_,""),n(G,0),n(F,[])}function N(){n(h,0),n(_,""),n(G,0),n(F,[])}et(()=>(e(h),e(_),t()),()=>{if(e(h)>=0&&e(_).trim()){const ne=zl(e(h),e(_),t());n(G,ne.finalDamage),n(F,ne.adjustments)}else n(G,0),n(F,[])}),et(()=>v(),()=>{n(w,!v()||"damage".includes(v().toLowerCase())||"resistance".includes(v().toLowerCase())||"immune".includes(v().toLowerCase()))}),ga(),Jt();var R=po();let P;var re=l(R);{let ne=xt(()=>(f(),i(()=>f().damageInput?"Expand":"Collapse")));Da(re,{title:"Apply Damage",get collapsed(){return f(),i(()=>f().damageInput)},get ariaLabel(){return e(ne)},onToggle:()=>la.update(ie=>({...ie,damageInput:!ie.damageInput}))})}var pe=a(re,2);{var Ue=ne=>{var ie=fo(),J=l(ie),ye=l(J),Fe=a(l(ye),2);Ce(Fe),s(ye);var M=a(ye,2),T=a(l(M),2);Ce(T);var x=a(T,2);Lt(x,5,()=>Z,Rt,(ke,_e)=>{var me=oo(),we={};D(()=>{we!==(we=e(_e))&&(me.value=(me.__value=e(_e))??"")}),o(ke,me)}),s(x),s(M),s(J);var Q=a(J,2),z=a(l(Q),2);Lt(z,1,()=>Z,Rt,(ke,_e)=>{var me=co();let we;var y=l(me);s(me),D(()=>{we=Et(me,1,"quick-type-btn use-enabled svelte-uvfntf",null,we,{active:e(_)===e(_e)}),k(y,`${e(_e),i(()=>K[e(_e)])??""} ${e(_e)??""}`)}),A("click",me,()=>n(_,e(_e))),o(ke,me)}),s(Q);var he=a(Q,2);{var $e=ke=>{var _e=uo(),me=a(l(_e),2),we=l(me),y=l(we),q=a(l(y),2),Pe=l(q);s(q),s(y);var ft=a(y,2);Lt(ft,5,()=>e(F),Rt,(j,U)=>{var ee=vo(),be=l(ee,!0);s(ee),D(()=>k(be,e(U))),o(j,ee)}),s(ft);var ut=a(ft,2),yt=a(l(ut),2),St=l(yt,!0);s(yt),s(ut),s(we),s(me);var Ct=a(me,2),C=l(Ct),W=a(C,2);s(Ct),s(_e),D(()=>{k(Pe,`${e(h)??""} ${e(_),i(()=>K[e(_)]||"")??""} ${e(_)??""}`),k(St,e(G))}),A("click",C,Y),A("click",W,N),o(ke,_e)};g(he,ke=>{e(h),e(_),i(()=>e(h)>=0&&e(_).trim())&&ke($e)})}s(ie),We(Fe,()=>e(h),ke=>n(h,ke)),We(T,()=>e(_),ke=>n(_,ke)),o(ne,ie)};g(pe,ne=>{f(),i(()=>!f().damageInput)&&ne(Ue)})}s(R),D(()=>P=Et(R,1,"damage-input svelte-uvfntf",null,P,{hidden:!e(w)})),o(r,R),Yt(),m()}var go=u('<div class="error-message svelte-1ahnz8y"> </div>'),bo=u('<div class="modal svelte-1ahnz8y" role="dialog" aria-modal="true" aria-labelledby="importModalTitle"><div class="modal-content svelte-1ahnz8y"><button class="close svelte-1ahnz8y">&times;</button> <h3 id="importModalTitle" class="svelte-1ahnz8y">Import Character JSON</h3> <p class="svelte-1ahnz8y">Paste your character JSON data below or <button class="link-button svelte-1ahnz8y">select a file</button>:</p> <textarea placeholder="Paste JSON here..." rows="15" class="json-textarea svelte-1ahnz8y" aria-label="Character JSON data"></textarea> <!> <div class="modal-actions svelte-1ahnz8y"><button class="btn btn-primary svelte-1ahnz8y">Import</button> <button class="btn btn-secondary svelte-1ahnz8y">Cancel</button></div> <input type="file" accept=".json" style="display: none;"/></div></div>');function ho(r,c){Vt(c,!1);const t=xa();let v=S(""),f=S(""),p=S();function m(){t("close")}function w(){e(p)?.click()}async function h(J){const ye=J.target,Fe=ye.files?.[0];if(Fe){try{const M=await ml(Fe);fe.set(M),t("close"),alert("Character imported successfully!")}catch{n(f,"Failed to import character file. Please ensure the JSON is valid.")}ye.value=""}}async function _(){if(!e(v).trim()){n(f,"Please paste JSON data or select a file.");return}try{const J=JSON.parse(e(v)),ye={...J,attacks:J.attacks?.map(Fe=>({...Fe,id:Fe.id||crypto.randomUUID()}))||[],classFeatures:J.classFeatures||{features:{},spellSlots:[],spellSlotsByLevel:{},preparedSpells:""},racialTraits:J.racialTraits||{uses:{}}};fe.set(ye),t("close"),alert("Character imported successfully!")}catch{n(f,"Error importing character. Please ensure the JSON is valid.")}}function G(J){J.target===J.currentTarget&&m()}Jt();var F=bo(),Z=l(F),K=l(Z),Y=a(K,4),N=a(l(Y));ta(),s(Y);var R=a(Y,2);wa(R);var P=a(R,2);{var re=J=>{var ye=go(),Fe=l(ye,!0);s(ye),D(()=>k(Fe,e(f))),o(J,ye)};g(P,J=>{e(f)&&J(re)})}var pe=a(P,2),Ue=l(pe),ne=a(Ue,2);s(pe);var ie=a(pe,2);Na(ie,J=>n(p,J),()=>e(p)),s(Z),s(F),A("click",K,m),A("click",N,w),We(R,()=>e(v),J=>n(v,J)),A("click",Ue,_),A("click",ne,m),A("change",ie,h),A("click",F,G),A("keydown",F,J=>J.key==="Escape"&&m()),o(r,F),Yt()}var _o=u('<link rel="icon" type="image/png" href="favicon4.png"/> <meta name="viewport" content="width=device-width, initial-scale=1"/>',1),yo=u('<span class="character-name svelte-1uha8ag"> </span>'),xo=u("<span> </span>"),$o=u('<div class="spell-slots-header svelte-1uha8ag"></div>'),ko=u("<span> </span><br/>",1),wo=u("<span> </span><br/>",1),So=u("<span> </span><br/>",1),Co=u("<span> </span><br/>",1),Do=u("<span> </span><br/>",1),Lo=u("<span> </span><br/>",1),Ao=u("<br/><em> <!>)</em>",1),jo=u("<br/><em>(requires reaction)</em>",1),Bo=u('<div class="ability-detail"><strong> </strong> <!></div>'),Ro=u('<div class="abilities-section"><strong>Abilities:</strong><br/> <!></div>'),Mo=u('<span class="effect-tooltip"><strong> </strong><br/> <br/> <!> <!> <!> <!> <!> <!> <!></span>'),To=u('<button class="effect-remove-btn svelte-1uha8ag">√ó</button>'),Fo=u('<span class="effect-badge svelte-1uha8ag" tabindex="0"> <!> <!></span>'),Po=u(`<div class="active-effects-header svelte-1uha8ag"></div> <style>.effect-badge {
              position: relative;
            }
            .effect-tooltip {
              position: absolute;
              top: 120%;
              left: 50%;
              transform: translateX(-50%);
              background: #fff;
              color: #222;
              border: 1px solid #a5b4fc;
              border-radius: 6px;
              padding: 8px 12px;
              font-size: 0.95em;
              box-shadow: 0 2px 8px rgba(0, 0, 0, 0.12);
              z-index: 10;
              min-width: 180px;
              max-width: 300px;
              white-space: normal;
              pointer-events: none;
              opacity: 1;
              transition: opacity 0.15s;
            }

            .abilities-section {
              margin-top: 8px;
              padding-top: 8px;
              border-top: 1px solid #e5e7eb;
            }

            .ability-detail {
              margin-top: 6px;
              padding: 4px;
              background: #f9fafb;
              border-radius: 4px;
              font-size: 0.9em;
            }

            .ability-detail strong {
              color: #6366f1;
            }

            .ability-detail em {
              font-size: 0.85em;
              color: #6b7280;
            }</style>`,1),Io=u('<div class="rest-menu svelte-1uha8ag"><button class="rest-option svelte-1uha8ag">‚òï Short Rest</button> <button class="rest-option svelte-1uha8ag">üõèÔ∏è Long Rest</button></div>'),Eo=u('<div class="container svelte-1uha8ag"><header class="svelte-1uha8ag"><div class="header-top svelte-1uha8ag"><div class="header-title svelte-1uha8ag"><div class="title-row svelte-1uha8ag"><h1 class="svelte-1uha8ag">D&D Character Sheet</h1> <!></div> <!> <!></div> <div class="header-right svelte-1uha8ag"><div class="header-controls svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">üé≤</span><span class="btn-text svelte-1uha8ag">Roll Dice</span></button> <div class="rest-button-container svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">üò¥</span><span class="btn-text svelte-1uha8ag">Rest</span></button> <!></div> <button class="btn btn-secondary use-enabled" title="Add custom condition with effects"><span class="btn-icon svelte-1uha8ag">‚ú®</span><span class="btn-text svelte-1uha8ag">Add Condition</span></button> <div class="mode-toggle"><button><span class="btn-icon svelte-1uha8ag"> </span><span class="btn-text svelte-1uha8ag"> </span></button> <button class="btn btn-mode svelte-1uha8ag" title="Toggle dark mode"><span class="btn-icon svelte-1uha8ag"> </span> <span class="btn-text svelte-1uha8ag"> </span></button></div></div> <div class="header-search svelte-1uha8ag"><input type="text" placeholder="üîç Search..." class="search-input use-enabled svelte-1uha8ag"/></div></div></div> <div class="header-actions svelte-1uha8ag"><button class="btn btn-mode svelte-1uha8ag">üìö Browse Spells & Feats</button> <button class="btn btn-secondary">Save to Gist</button> <button class="btn btn-secondary">Load from Gist</button> <button class="btn btn-secondary">Export JSON</button> <button class="btn btn-secondary">Import JSON</button></div></header> <main class="svelte-1uha8ag"><!> <!> <!> <!> <!> <!> <!> <!></main></div> <!> <!> <!> <!> <!> <!>',1);function Ko(r,c){Vt(c,!1);const t=()=>_t(fe,"$character",p),v=()=>_t(Sa,"$isEditMode",p),f=()=>_t($a,"$searchFilter",p),[p,m]=fa();let w=S(!1);function h(B){n(w,B),B?document.body.classList.add("dark-mode"):document.body.classList.remove("dark-mode"),localStorage.setItem("dnd-dark-mode",B?"true":"false")}function _(){h(!e(w))}Ca(()=>{const B=localStorage.getItem("dnd-dark-mode");h(B==="true")});function G(){const B=[],je=t().classFeatures.spellSlotsByLevel||{};for(let ze=1;ze<=9;ze++){const bt=je[ze];if(bt&&bt.length>0){const L=bt.length,dt=bt.filter(st=>st).length;B.push({level:ze,available:L-dt,total:L})}}return B}let F=S(!1),Z=S(!1),K=S(!1),Y=S(!1),N=S(!1),R=S("save"),P=S(""),re=S(""),pe=S(""),Ue=S(!1),ne=S([]),ie=S([]),J=S("other"),ye=S(),Fe=!1,M=1,T=S(!1),x=S(null);function Q(B){n(x,B)}function z(){n(x,null)}function he(B){n(x,e(x)===B?null:B)}function $e(B){fe.update(je=>(je.activeStates||(je.activeStates=[]),je.activeStates=[...je.activeStates,B],je)),n(Y,!1),Ht.add(`Added condition: ${B.name}`,"success")}function ke(){n(Y,!1)}function _e(){const B=[];fe.update(L=>{const dt=L.hitDice.current;L.hitDice.current=Math.min(L.hitDice.max,L.hitDice.current+Math.max(1,Math.floor(L.hitDice.max/2)));const st=L.hitDice.current-dt;if(st>0&&B.push(`${st} hit ${st===1?"die":"dice"}`),L.class){const ht=Ta(L.class,L.level,L.subclass);L.classFeatures.features||(L.classFeatures.features={}),ht.forEach(at=>{if(at.resetOn==="short"){const lt=typeof at.name=="function"?at.name(L.level):at.name,Ve=lt.replace(/\s+/g,"");if(at.type==="uses"){const Ft=typeof at.maxUses=="function"?at.maxUses(L.level):at.maxUses;L.classFeatures.features[Ve]=Array(Ft).fill(!1),B.push(lt)}else if(at.type==="pool"){const Ft=typeof at.maxPool=="function"?at.maxPool(L.level):at.maxPool;Ft!==void 0&&(L.classFeatures.features[Ve]=Ft,B.push(lt))}}})}return L.activeStates&&L.activeStates.forEach(ht=>{ht.abilities&&ht.abilities.forEach(at=>{if(at.restType==="short"&&at.usesPerRest){const lt=at.usesPerRest-(at.currentUses||0)>0;at.currentUses=at.usesPerRest,lt&&B.push(`${ht.name}: ${at.name}`)}})}),L}),Ss("short"),Cs(t().race,t().level).some(L=>L.restType==="short"&&L.usesPerRest)&&B.push("racial traits"),n(T,!1);const bt=B.length>0?`Short rest taken! Restored: ${B.join(", ")}`:"Short rest taken!";Ht.add(bt,"success")}function me(){const B=[];fe.update(L=>{const dt=L.maxHP-L.currentHP;dt>0&&B.push(`${dt} HP`),L.currentHP=L.maxHP,L.tempHP=0;const st=L.hitDice.max-L.hitDice.current;st>0&&B.push(`${st} hit ${st===1?"die":"dice"}`),L.hitDice.current=L.hitDice.max;let ht=0;if(L.classFeatures.spellSlotsByLevel&&Object.keys(L.classFeatures.spellSlotsByLevel).forEach(at=>{const lt=L.classFeatures.spellSlotsByLevel[parseInt(at)];if(lt){const Ve=lt.filter(Ft=>Ft).length;ht+=Ve,L.classFeatures.spellSlotsByLevel[parseInt(at)]=Array(lt.length).fill(!1)}}),ht>0&&B.push(`${ht} spell ${ht===1?"slot":"slots"}`),L.class){const at=Ta(L.class,L.level,L.subclass);L.classFeatures.features||(L.classFeatures.features={});let lt=!1;at.forEach(Ve=>{const Nt=(typeof Ve.name=="function"?Ve.name(L.level):Ve.name).replace(/\s+/g,"");if(!(Ve.type==="info"||Ve.type==="channelDivinity")){if(Ve.type==="uses"){const Mt=typeof Ve.maxUses=="function"?Ve.maxUses(L.level):Ve.maxUses;L.classFeatures.features[Nt]=Array(Mt).fill(!1),lt=!0}else if(Ve.type==="pool"){const Mt=typeof Ve.maxPool=="function"?Ve.maxPool(L.level):Ve.maxPool;Mt!==void 0&&(L.classFeatures.features[Nt]=Mt,lt=!0)}}}),lt&&B.push("all class features")}if(L.activeStates){let at=!1;L.activeStates.forEach(lt=>{lt.abilities&&lt.abilities.forEach(Ve=>{if(Ve.usesPerRest){const Ft=(Ve.currentUses||0)<Ve.usesPerRest;Ve.currentUses=Ve.usesPerRest,Ft&&(at=!0)}})}),at&&B.push("condition abilities")}return L}),Ss("long"),Cs(t().race,t().level).some(L=>L.usesPerRest)&&B.push("racial traits"),n(T,!1);const bt=B.length>0?`Long rest taken! Restored: ${B.join(", ")}`:"Long rest taken! Fully rested.";Ht.add(bt,"success")}function we(B){n(P,""),n(re,""),n(pe,""),n(Ue,!1),n(ne,[]),n(ie,[]),n(J,"other"),Fe=!1,typeof B=="string"?n(P,B):(n(P,B.notation),n(re,B.damageNotation||""),n(pe,B.attackName||""),n(Ue,!!B.applyHalfDamage),n(ne,B.bonusBreakdown||[]),n(ie,B.damageBreakdown||[]),n(J,B.rollType||"other")),n(F,!0)}function y(B){const{notation:je,count:ze,bonusBreakdown:bt}=B.detail;n(P,""),Fe=!0,M=ze||1,setTimeout(()=>{n(P,je),n(re,""),n(pe,"Hit Die"),n(ne,bt||[]),n(J,"other")},0),n(F,!0)}function q(){if(n(F,!1),Fe&&e(ye)){const B=e(ye).getLastRollTotal();if(B!==null){const je=Math.max(1,B);fe.update(ze=>(ze.hitDice.current=Math.max(0,ze.hitDice.current-M),ze.currentHP=Math.min(ze.maxHP,ze.currentHP+je),ze))}Fe=!1}}function Pe(){Sa.update(B=>!B)}function ft(B){B.target.closest(".rest-button-container")||n(T,!1)}Ca(()=>{const B=Sa.subscribe(je=>{je?document.body.classList.remove("use-mode"):document.body.classList.add("use-mode")});return document.addEventListener("click",ft),()=>{B(),document.removeEventListener("click",ft)}});function ut(){hl(t())}function yt(){n(N,!0)}Jt();var St=Eo();gl("1uha8ag",B=>{var je=_o();ta(2),Es(()=>{dl.title="D&D Character Sheet"}),o(B,je)});var Ct=De(St),C=l(Ct),W=l(C),j=l(W),U=l(j),ee=a(l(U),2);{var be=B=>{var je=yo(),ze=l(je);s(je),D(()=>k(ze,`${t().name??""} (${t().level??""})`)),o(B,je)};g(ee,B=>{t().name&&B(be)})}s(U);var He=a(U,2);{var Ee=B=>{var je=$o();Lt(je,5,G,Rt,(ze,bt)=>{var L=xo();let dt;var st=l(L);s(L),D(()=>{dt=Et(L,1,"slot-badge svelte-1uha8ag",null,dt,{depleted:e(bt).available===0}),k(st,`Lv${e(bt).level??""}: ${e(bt).available??""}/${e(bt).total??""}`)}),o(ze,L)}),s(je),o(B,je)};g(He,B=>{G().length>0&&B(Ee)})}var Ge=a(He,2);{var Ie=B=>{var je=Po(),ze=De(je);Lt(ze,5,()=>t().activeStates,Rt,(bt,L,dt)=>{var st=Fo(),ht=l(st),at=a(ht);{var lt=Nt=>{var Mt=Mo(),pt=l(Mt),rt=l(pt,!0);s(pt);var Pt=a(pt,2),qt=a(Pt,3);{var Zt=ot=>{var Dt=ko(),At=De(Dt),Wt=l(At);s(At),ta(),D(()=>k(Wt,`Attack Bonus: ${typeof e(L).attackBonus=="number"&&e(L).attackBonus>0?"+":""}${e(L).attackBonus??""}`)),o(ot,Dt)};g(qt,ot=>{e(L).attackBonus&&ot(Zt)})}var va=a(qt,2);{var pa=ot=>{var Dt=wo(),At=De(Dt),Wt=l(At);s(At),ta(),D(()=>k(Wt,`Damage Bonus: ${typeof e(L).damageBonus=="number"&&e(L).damageBonus>0?"+":""}${e(L).damageBonus??""}`)),o(ot,Dt)};g(va,ot=>{e(L).damageBonus&&ot(pa)})}var da=a(va,2);{var Qt=ot=>{var Dt=So(),At=De(Dt),Wt=l(At);s(At),ta(),D(()=>k(Wt,`AC Bonus: ${e(L).acBonus>0?"+":""}${e(L).acBonus??""}`)),o(ot,Dt)};g(da,ot=>{e(L).acBonus&&ot(Qt)})}var ea=a(da,2);{var Xt=ot=>{var Dt=Co(),At=De(Dt),Wt=l(At);s(At),ta(),D(()=>k(Wt,`Darkvision: ${e(L).darkvision??""} feet`)),o(ot,Dt)};g(ea,ot=>{e(L).darkvision&&ot(Xt)})}var It=a(ea,2);{var na=ot=>{var Dt=Do(),At=De(Dt),Wt=l(At);s(At),ta(),D(Ut=>k(Wt,`Resistances: ${Ut??""}`),[()=>e(L).resistances.join(", ")]),o(ot,Dt)};g(It,ot=>{e(L).resistances&&e(L).resistances.length>0&&ot(na)})}var ma=a(It,2);{var ha=ot=>{var Dt=Lo(),At=De(Dt),Wt=l(At);s(At),ta(),D(Ut=>k(Wt,`Immunities: ${Ut??""}`),[()=>e(L).immunities.join(", ")]),o(ot,Dt)};g(ma,ot=>{e(L).immunities&&e(L).immunities.length>0&&ot(ha)})}var zt=a(ma,2);{var ra=ot=>{var Dt=Ro(),At=a(l(Dt),3);Lt(At,1,()=>e(L).abilities,Rt,(Wt,Ut)=>{var oa=Bo(),jt=l(oa),ia=l(jt);s(jt);var La=a(jt),es=a(La);{var ts=ca=>{var ba=Ao(),Ba=a(De(ba)),Oa=l(Ba),Fa=a(Oa);{var ss=ls=>{var Ws=Tt(", requires reaction");o(ls,Ws)};g(Fa,ls=>{e(Ut).requiresReaction&&ls(ss)})}ta(),s(Ba),D(()=>k(Oa,`(${(e(Ut).currentUses||0)??""}/${e(Ut).usesPerRest??""} uses per ${e(Ut).restType??""}
                                rest`)),o(ca,ba)},as=ca=>{var ba=wt(),Ba=De(ba);{var Oa=Fa=>{var ss=jo();ta(),o(Fa,ss)};g(Ba,Fa=>{e(Ut).requiresReaction&&Fa(Oa)},!0)}o(ca,ba)};g(es,ca=>{e(Ut).usesPerRest?ca(ts):ca(as,!1)})}s(oa),D(()=>{k(ia,`${e(Ut).name??""}:`),k(La,` ${e(Ut).description??""} `)}),o(Wt,oa)}),s(Dt),o(ot,Dt)};g(zt,ot=>{e(L).abilities&&e(L).abilities.length>0&&ot(ra)})}s(Mt),D(()=>{k(rt,e(L).name),k(Pt,` ${e(L).description??""}`)}),o(Nt,Mt)};g(at,Nt=>{e(x)===dt&&Nt(lt)})}var Ve=a(at,2);{var Ft=Nt=>{var Mt=To();D(()=>ct(Mt,"title",`End ${e(L).name??""}`)),A("click",Mt,()=>{fe.update(pt=>{if(pt.activeStates){const rt=pt.activeStates[dt];rt?.hpBonus&&rt.target!=="other"&&(pt.maxHP-=rt.hpBonus,pt.currentHP=Math.max(1,Math.min(pt.currentHP-rt.hpBonus,pt.maxHP))),pt.activeStates=pt.activeStates.filter((Pt,qt)=>qt!==dt)}return pt})}),o(Nt,Mt)};g(Ve,Nt=>{v()||Nt(Ft)})}s(st),D(()=>{ct(st,"aria-label",e(L).name),k(ht,`‚ú® ${e(L).name??""} `)}),A("mouseenter",st,()=>Q(dt)),A("mouseleave",st,z),A("focus",st,()=>Q(dt)),A("blur",st,z),A("click",st,()=>he(dt)),o(bt,st)}),s(ze),ta(2),o(B,je)};g(Ge,B=>{t().activeStates&&t().activeStates.length>0&&B(Ie)})}s(j);var $=a(j,2),te=l($),H=l(te),Le=a(H,2),Se=l(Le),vt=a(Se,2);{var Ae=B=>{var je=Io(),ze=l(je),bt=a(ze,2);s(je),A("click",ze,_e),A("click",bt,me),o(B,je)};g(vt,B=>{e(T)&&B(Ae)})}s(Le);var ae=a(Le,2),d=a(ae,2),Ye=l(d);let Me;var O=l(Ye),Be=l(O,!0);s(O);var de=a(O),Xe=l(de,!0);s(de),s(Ye);var Ne=a(Ye,2),tt=l(Ne),qe=l(tt,!0);s(tt);var Ke=a(tt,2),gt=l(Ke,!0);s(Ke),s(Ne),s(d),s(te);var X=a(te,2),Qe=l(X);Ce(Qe),s(X),s($),s(W);var mt=a(W,2),b=l(mt),I=a(b,2),oe=a(I,2),ce=a(oe,2),ue=a(ce,2);s(mt),s(C);var Re=a(C,2),Je=l(Re);Pl(Je,{});var Oe=a(Je,2);Ul(Oe,{$$events:{roll:B=>we(B.detail)}});var ve=a(Oe,2);nr(ve,{$$events:{roll:B=>we(B.detail)}});var V=a(ve,2);sr(V,{$$events:{rollHitDice:y}});var it=a(V,2);mo(it,{});var xe=a(it,2);hi(xe,{$$events:{roll:B=>we(B.detail)}});var se=a(xe,2);Ki(se,{$$events:{roll:B=>we(B.detail)}});var ge=a(se,2);Yi(ge,{}),s(Re),s(Ct);var Ze=a(Ct,2);Na(bn(Ze,{get notation(){return e(P)},get damageNotation(){return e(re)},get attackName(){return e(pe)},get applyHalfDamage(){return e(Ue)},get bonusBreakdown(){return e(ne)},get damageBreakdown(){return e(ie)},get rollType(){return e(J)},get visible(){return e(F)},$$events:{close:q},$$legacy:!0}),B=>n(ye,B),()=>e(ye));var $t=a(Ze,2);{var nt=B=>{In(B,{get mode(){return e(R)},$$events:{close:()=>n(Z,!1)}})};g($t,B=>{e(Z)&&B(nt)})}var le=a($t,2);{var Gt=B=>{Zn(B,{onClose:()=>n(K,!1)})};g(le,B=>{e(K)&&B(Gt)})}var Te=a(le,2);{var kt=B=>{ho(B,{$$events:{close:()=>n(N,!1)}})};g(Te,B=>{e(N)&&B(kt)})}var aa=a(Te,2);no(aa,{get show(){return e(Y)},onSave:$e,onCancel:ke});var sa=a(aa,2);bl(sa,{}),D(()=>{Me=Et(Ye,1,"btn btn-mode svelte-1uha8ag",null,Me,{"use-mode":!v()}),k(Be,v()?"üìù":"üé≤"),k(Xe,v()?"Edit Mode":"Use Mode"),k(qe,e(w)?"‚òÄÔ∏è":"üåô"),k(gt,e(w)?"Light Mode":"Dark Mode")}),A("click",H,()=>{n(ne,[]),n(F,!0)}),A("click",Se,()=>n(T,!e(T))),A("click",ae,()=>n(Y,!0)),A("click",Ye,Pe),A("click",Ne,_),We(Qe,f,B=>_l($a,B)),A("click",b,()=>n(K,!0)),A("click",I,()=>{n(R,"save"),n(Z,!0)}),A("click",oe,()=>{n(R,"load"),n(Z,!0)}),A("click",ce,ut),A("click",ue,yt),o(r,St),Yt(),m()}export{Ko as component};
