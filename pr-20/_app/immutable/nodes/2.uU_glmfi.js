import{f as p,e as F,a as c,s as w,c as ot,t as Mt}from"../chunks/DBs_ODQp.js";import{i as It}from"../chunks/BbaRvQ4Z.js";import{c as la,o as pa,a as rs}from"../chunks/CHX4V4AM.js";import{a7 as Ra,i as Qa,aZ as is,a_ as Ya,a$ as Sa,K as Xt,e as Xa,b0 as Za,T as fa,b1 as ns,b2 as os,b3 as cs,q as Da,b4 as vs,b5 as ds,ab as us,d as i,r as Ia,g as ps,C as Tt,F as R,G as Et,H as r,I as l,J as s,b6 as et,b7 as Jt,s as o,a4 as P,f as e,m as ct,E as Ne,A as E,b8 as sa,b9 as jt,ba as da,ao as ia,bb as fs}from"../chunks/DwmZeGF1.js";import{c as Pt,a as ie,e as yt,i as St,u as es,s as ea,b as mt,d as ga,f as Zt,g as gs,t as Ot,h as bs,T as hs,j as ms,k as _s}from"../chunks/DQJFtNtV.js";import{i as _,s as Wt,a as tt,b as ht,d as ca,e as ys}from"../chunks/0ovU14Ao.js";import{p as kt,b as ja}from"../chunks/CFUzmRYW.js";import{b as va,r as ks}from"../chunks/DE8adfkJ.js";function ya(a,n,t=!1){if(a.multiple){if(n==null)return;if(!Qa(n))return is();for(var d of a.options)d.selected=n.includes(ua(d));return}for(d of a.options){var f=ua(d);if(Ya(f,n)){d.selected=!0;return}}(!t||n!==void 0)&&(a.selectedIndex=-1)}function Ba(a){var n=new MutationObserver(()=>{ya(a,a.__value)});n.observe(a,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Ra(()=>{n.disconnect()})}function Aa(a,n,t=n){var d=new WeakSet,f=!0;Sa(a,"change",h=>{var y=h?"[selected]":":checked",x;if(a.multiple)x=[].map.call(a.querySelectorAll(y),ua);else{var $=a.querySelector(y)??a.querySelector("option:not([disabled])");x=$&&ua($)}t(x),Xt!==null&&d.add(Xt)}),Xa(()=>{var h=n();if(a===document.activeElement){var y=Za??Xt;if(d.has(y))return}if(ya(a,h,f),f&&h===void 0){var x=a.querySelector(":checked");x!==null&&(h=ua(x),t(h))}a.__value=h,f=!1}),Ba(a)}function ua(a){return"__value"in a?a.__value:a.value}const Ss=Symbol("is custom element"),xs=Symbol("is html");function Ce(a){if(fa){var n=!1,t=()=>{if(!n){if(n=!0,a.hasAttribute("value")){var d=a.value;Je(a,"value",null),a.value=d}if(a.hasAttribute("checked")){var f=a.checked;Je(a,"checked",null),a.checked=f}}};a.__on_r=t,Da(t),vs()}}function ka(a,n){var t=Ta(a);t.value===(t.value=n??void 0)||a.value===n&&(n!==0||a.nodeName!=="PROGRESS")||(a.value=n??"")}function ts(a,n){var t=Ta(a);t.checked!==(t.checked=n??void 0)&&(a.checked=n)}function Je(a,n,t,d){var f=Ta(a);fa&&(f[n]=a.getAttribute(n),n==="src"||n==="srcset"||n==="href"&&a.nodeName==="LINK")||f[n]!==(f[n]=t)&&(n==="loading"&&(a[ns]=t),t==null?a.removeAttribute(n):typeof t!="string"&&$s(a).includes(n)?a[n]=t:a.setAttribute(n,t))}function Ta(a){return a.__attributes??={[Ss]:a.nodeName.includes("-"),[xs]:a.namespaceURI===os}}var Ha=new Map;function $s(a){var n=a.getAttribute("is")||a.nodeName,t=Ha.get(n);if(t)return t;Ha.set(n,t=[]);for(var d,f=a,h=Element.prototype;h!==f;){d=ds(f);for(var y in d)d[y].set&&t.push(y);f=cs(f)}return t}function Ge(a,n,t=n){var d=new WeakSet;Sa(a,"input",async f=>{var h=f?a.defaultValue:a.value;if(h=Ca(a)?La(h):h,t(h),Xt!==null&&d.add(Xt),await us(),h!==(h=n())){var y=a.selectionStart,x=a.selectionEnd,$=a.value.length;if(a.value=h??"",x!==null){var k=a.value.length;y===x&&x===$&&k>$?(a.selectionStart=k,a.selectionEnd=k):(a.selectionStart=y,a.selectionEnd=Math.min(x,k))}}}),(fa&&a.defaultValue!==a.value||i(n)==null&&a.value)&&(t(Ca(a)?La(a.value):a.value),Xt!==null&&d.add(Xt)),Ia(()=>{var f=n();if(a===document.activeElement){var h=Za??Xt;if(d.has(h))return}Ca(a)&&f===La(a.value)||a.type==="date"&&!f&&!a.value||f!==a.value&&(a.value=f??"")})}const $a=new Set;function Ua(a,n,t,d,f=d){var h=t.getAttribute("type")==="checkbox",y=a;let x=!1;if(n!==null)for(var $ of n)y=y[$]??=[];y.push(t),Sa(t,"change",()=>{var k=t.__value;h&&(k=Na(y,k,t.checked)),f(k)},()=>f(h?[]:null)),Ia(()=>{var k=d();if(fa&&t.defaultChecked!==t.checked){x=!0;return}h?(k=k||[],t.checked=k.includes(t.__value)):t.checked=Ya(t.__value,k)}),Ra(()=>{var k=y.indexOf(t);k!==-1&&y.splice(k,1)}),$a.has(y)||($a.add(y),Da(()=>{y.sort((k,Q)=>k.compareDocumentPosition(Q)===4?-1:1),$a.delete(y)})),Da(()=>{if(x){var k;if(h)k=Na(y,k,t.checked);else{var Q=y.find(z=>z.checked);k=Q?.__value}f(k)}})}function Fa(a,n,t=n){Sa(a,"change",d=>{var f=d?a.defaultChecked:a.checked;t(f)}),(fa&&a.defaultChecked!==a.checked||i(n)==null)&&t(a.checked),Ia(()=>{var d=n();a.checked=!!d})}function Na(a,n,t){for(var d=new Set,f=0;f<a.length;f+=1)a[f].checked&&d.add(a[f].__value);return t||d.delete(n),Array.from(d)}function Ca(a){var n=a.type;return n==="number"||n==="range"}function La(a){return a===""?null:+a}function Cs(a,n,t){var d=ps(a,n);d&&d.set&&(a[n]=t,Ra(()=>{a[n]=null}))}function Ea(a){return function(...n){var t=n[0];return t.stopPropagation(),a?.apply(this,n)}}function na(a,n){var t=a.$$events?.[n.type],d=Qa(t)?t.slice():t==null?[]:[t];for(var f of d)f.call(this,n)}const Ls="";function as(...a){return va+Ls+ks(a[0],a[1])}const Ma={paladin:{name:"Paladin",hitDice:"d10",spellcaster:!0,spellcastingAbility:"charisma",spellSlotsByLevel:{1:0,2:2,3:3,4:3,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Divine Sense",type:"uses",maxUses:(a,n=1)=>1+Math.max(1,n),resetOn:"long",description:"Detect celestials, fiends, and undead within 60 feet",minLevel:1},{name:"Lay on Hands",type:"pool",maxPool:a=>a*5,resetOn:"long",description:"Heal wounds or cure disease",minLevel:1},{name:"Divine Smite",type:"spellSlot",description:"Expend spell slot to deal extra radiant damage",minLevel:2,rollable:!0},{name:"Channel Divinity",type:"pool",maxPool:a=>a>=18?3:a>=6?2:1,resetOn:"short",description:"Sacred Weapon or Turn Undead",minLevel:3}]},fighter:{name:"Fighter",hitDice:"d10",spellcaster:!1,features:[{name:"Second Wind",type:"uses",maxUses:1,resetOn:"short",description:"Regain 1d10 + fighter level HP as bonus action",minLevel:1,rollable:!0,rollFormula:a=>`1d10+${a}`},{name:"Action Surge",type:"uses",maxUses:a=>a>=17?2:1,resetOn:"short",description:"Take one additional action on your turn",minLevel:2},{name:"Indomitable",type:"uses",maxUses:a=>a>=17?3:a>=13?2:1,resetOn:"long",description:"Reroll a failed saving throw",minLevel:9}],subclasses:{champion:{name:"Champion",features:[{name:"Improved Critical",type:"info",description:"Critical hit on 19-20",minLevel:3},{name:"Remarkable Athlete",type:"info",description:"Add half proficiency to STR/DEX/CON checks, increase long jump distance",minLevel:7},{name:"Additional Fighting Style",type:"info",description:"Choose a second fighting style",minLevel:10},{name:"Superior Critical",type:"info",description:"Critical hit on 18-20",minLevel:15},{name:"Survivor",type:"info",description:"Regain 5 + CON mod HP at start of turn if below half HP",minLevel:18}]},battlemaster:{name:"Battle Master",features:[{name:"Combat Superiority",type:"uses",maxUses:a=>a>=15?6:a>=7?5:4,resetOn:"short",description:a=>`Use superiority dice (${a>=18?"d12":a>=10?"d10":"d8"}) for maneuvers`,minLevel:3},{name:"Know Your Enemy",type:"info",description:"Learn capabilities of creatures you observe",minLevel:7},{name:"Improved Combat Superiority",type:"info",description:"Superiority dice become d10",minLevel:10},{name:"Relentless",type:"info",description:"Regain 1 superiority die if you have none at start of turn",minLevel:15}]}}},rogue:{name:"Rogue",hitDice:"d8",spellcaster:!1,features:[{name:"Sneak Attack",type:"info",description:a=>`Deal ${Math.ceil(a/2)}d6 extra damage once per turn with advantage or ally nearby`,minLevel:1,rollable:!0,rollFormula:a=>`${Math.ceil(a/2)}d6`},{name:"Cunning Action",type:"info",description:"Dash, Disengage, or Hide as a bonus action",minLevel:2},{name:"Uncanny Dodge",type:"info",description:"Use reaction to halve damage from an attack",minLevel:5},{name:"Evasion",type:"info",description:"Take no damage on successful Dex save (half on fail)",minLevel:7}]},wizard:{name:"Wizard",hitDice:"d6",spellcaster:!0,spellcastingAbility:"intelligence",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Arcane Recovery",type:"uses",maxUses:1,resetOn:"long",description:a=>`Recover spell slots totaling up to ${Math.ceil(a/2)} levels during short rest`,minLevel:1},{name:"Spell Mastery",type:"info",description:"Cast one 1st-level and one 2nd-level spell at will",minLevel:18}]},cleric:{name:"Cleric",hitDice:"d8",spellcaster:!0,spellcastingAbility:"wisdom",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Channel Divinity",type:"pool",maxPool:a=>a>=18?3:a>=6?2:1,resetOn:"short",description:"Turn Undead or domain-specific ability",minLevel:2},{name:"Destroy Undead",type:"info",description:a=>`Channel Divinity destroys undead of CR ${a>=17?4:a>=14?3:a>=11?2:a>=8?1:.5} or lower`,minLevel:5},{name:"Divine Intervention",type:"uses",maxUses:1,resetOn:"long",description:a=>`${a}% chance to succeed, implore deity for aid`,minLevel:10}],subclasses:{war:{name:"War Domain",features:[{name:"War Priest",type:"uses",maxUses:(a,n=1)=>Math.max(1,n),resetOn:"long",description:"Make one weapon attack as a bonus action",minLevel:1},{name:"Guided Strike",type:"channelDivinity",description:"Use your Channel Divinity to gain +10 to an attack roll. Make this choice after you see the roll, but before the DM says whether the attack hits or misses.",minLevel:2,resetOn:"short"},{name:"War God's Blessing",type:"channelDivinity",description:"Use reaction to grant +10 to an ally's attack roll within 30 feet. Consumes one use of Channel Divinity.",minLevel:6,resetOn:"short"},{name:"Divine Strike",type:"info",description:a=>`Deal extra ${a>=14?"2d8":"1d8"} weapon damage once per turn`,minLevel:8,rollable:!0,rollFormula:a=>a>=14?"2d8":"1d8"},{name:"Avatar of Battle",type:"info",description:"Gain resistance to nonmagical weapon damage",minLevel:17}]},life:{name:"Life Domain",features:[{name:"Disciple of Life",type:"info",description:"Healing spells restore additional 2 + spell level HP",minLevel:1},{name:"Preserve Life",type:"pool",maxPool:a=>a*5,resetOn:"short",description:"Restore HP to creatures within 30 feet",minLevel:2},{name:"Blessed Healer",type:"info",description:"Regain 2 + spell level HP when you cast healing spell",minLevel:6},{name:"Divine Strike",type:"info",description:a=>`Deal extra ${a>=14?"2d8":"1d8"} radiant damage once per turn`,minLevel:8,rollable:!0,rollFormula:a=>a>=14?"2d8":"1d8"},{name:"Supreme Healing",type:"info",description:"Maximize healing dice instead of rolling",minLevel:17}]}}},barbarian:{name:"Barbarian",hitDice:"d12",spellcaster:!1,features:[{name:"Rage",type:"uses",maxUses:a=>a>=20?1/0:a>=17?6:a>=12?5:a>=6?4:a>=3?3:2,resetOn:"long",description:a=>`+${a>=16?4:a>=9?3:2} damage, resistance to physical damage`,minLevel:1},{name:"Reckless Attack",type:"info",description:"Gain advantage on melee attacks, enemies get advantage on you",minLevel:2},{name:"Danger Sense",type:"info",description:"Advantage on Dex saves against effects you can see",minLevel:2}],subclasses:{berserker:{name:"Path of the Berserker",features:[{name:"Frenzy",type:"info",description:"While raging, make melee attack as bonus action (gain 1 exhaustion after rage)",minLevel:3},{name:"Mindless Rage",type:"info",description:"Cannot be charmed or frightened while raging",minLevel:6},{name:"Intimidating Presence",type:"info",description:"Use action to frighten creature within 30 feet",minLevel:10},{name:"Retaliation",type:"info",description:"When damaged by creature within 5 feet, make melee attack as reaction",minLevel:14}]}}}};function qt(a){const n=a.toLowerCase();return Ma[n]||null}function oa(a,n,t){const d=qt(a);if(!d)return[];const f=d.features.filter(h=>!h.minLevel||h.minLevel<=n);if(t&&d.subclasses&&d.subclasses[t]){const h=d.subclasses[t].features.filter(y=>!y.minLevel||y.minLevel<=n);return[...f,...h]}return f}function Ga(a){const n=qt(a);return!n||!n.subclasses?[]:Object.keys(n.subclasses).map(t=>({id:t,name:n.subclasses[t].name}))}function Oa(a,n){const t=qt(a);return!t||!t.spellcaster||!t.spellSlotsByLevel?0:t.spellSlotsByLevel[n]||0}function qa(a,n,t){const d=qt(a);return!d||!d.spellcaster?0:Math.max(1,t+n)}function ws(a,n,t){const d=qt(a);return!d||!d.spellcaster?null:8+n+t}function Ds(){return Object.keys(Ma).map(a=>({id:a,name:Ma[a].name}))}var js=p('<div class="section-header svelte-ls99y2" role="button" tabindex="0"><h2 class="svelte-ls99y2"> </h2> <span class="collapse-btn svelte-ls99y2"> </span></div>');function ra(a,n){Tt(n,!1);let t=kt(n,"title",8),d=kt(n,"collapsed",8),f=kt(n,"ariaLabel",8,""),h=kt(n,"onToggle",8);It();var y=js(),x=r(y),$=r(x,!0);l(x);var k=s(x,2),Q=r(k,!0);l(k),l(y),R(()=>{Je(y,"aria-expanded",!d()),Je(y,"aria-label",f()),w($,t()),w(Q,d()?"â–¼":"â–²")}),F("click",y,function(...z){h()?.apply(this,z)}),F("keydown",y,z=>{(z.key==="Enter"||z.key===" ")&&h()()}),c(a,y),Et()}var Bs=p("<option> </option>"),As=p("<option> </option>"),Fs=p('<div class="form-group svelte-172i2fj"><label for="characterSubclass" class="svelte-172i2fj">Subclass</label> <select id="characterSubclass" class="svelte-172i2fj"><option>Select Subclass</option><!></select></div>'),Ms=p('<div class="info-grid svelte-172i2fj"><div class="form-group svelte-172i2fj"><label for="characterName" class="svelte-172i2fj">Character Name</label> <input type="text" id="characterName" placeholder="Enter name" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterClass" class="svelte-172i2fj">Class</label> <select id="characterClass" class="svelte-172i2fj"><option>Select Class</option><!></select></div> <!> <div class="form-group svelte-172i2fj"><label for="characterLevel" class="svelte-172i2fj">Level</label> <input type="number" id="characterLevel" min="1" max="20" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterRace" class="svelte-172i2fj">Race</label> <input type="text" id="characterRace" placeholder="e.g., Human" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterBackground" class="svelte-172i2fj">Background</label> <input type="text" id="characterBackground" placeholder="e.g., Soldier" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterAlignment" class="svelte-172i2fj">Alignment</label> <input type="text" id="characterAlignment" placeholder="e.g., Lawful Good" class="svelte-172i2fj"/></div></div>'),Ps=p('<section class="character-info svelte-172i2fj"><!> <!></section>');function Rs(a,n){Tt(n,!1);const t=()=>tt(ie,"$character",f),d=()=>tt(Pt,"$collapsedStates",f),[f,h]=Wt(),y=P(),x=Ds();function $(he){const de=he.target;ie.update(ae=>(ae.class=de.value,ae.subclass="",ae))}function k(he){const de=he.target;ie.update(ae=>(ae.subclass=de.value,ae))}function Q(he){const de=he.target;ie.update(ae=>(ae.level=parseInt(de.value)||1,ae)),es()}et(()=>(t(),Ga),()=>{o(y,t().class?Ga(t().class):[])}),Jt(),It();var z=Ps(),ce=r(z);{let he=ct(()=>(d(),i(()=>d().characterInfo?"Expand":"Collapse")));ra(ce,{title:"Character Info",get collapsed(){return d(),i(()=>d().characterInfo)},get ariaLabel(){return e(he)},onToggle:()=>Pt.update(de=>({...de,characterInfo:!de.characterInfo}))})}var le=s(ce,2);{var N=he=>{var de=Ms(),ae=r(de),Me=s(r(ae),2);Ce(Me),l(ae);var Qe=s(ae,2),ue=s(r(Qe),2),ze=r(ue);ze.value=ze.__value="";var Oe=s(ze);yt(Oe,1,()=>x,St,(Ye,Te)=>{var g=Bs(),M=r(g,!0);l(g);var K={};R(()=>{w(M,(e(Te),i(()=>e(Te).name))),K!==(K=(e(Te),i(()=>e(Te).id)))&&(g.value=(g.__value=(e(Te),i(()=>e(Te).id)))??"")}),c(Ye,g)}),l(ue);var H;Ba(ue),l(Qe);var q=s(Qe,2);{var ye=Ye=>{var Te=Fs(),g=s(r(Te),2),M=r(g);M.value=M.__value="";var K=s(M);yt(K,1,()=>e(y),St,(O,_e)=>{var Le=As(),at=r(Le,!0);l(Le);var ke={};R(()=>{w(at,(e(_e),i(()=>e(_e).name))),ke!==(ke=(e(_e),i(()=>e(_e).id)))&&(Le.value=(Le.__value=(e(_e),i(()=>e(_e).id)))??"")}),c(O,Le)}),l(g);var Z;Ba(g),l(Te),R(()=>{Z!==(Z=(t(),i(()=>t().subclass)))&&(g.value=(g.__value=(t(),i(()=>t().subclass)))??"",ya(g,(t(),i(()=>t().subclass))))}),F("change",g,k),c(Ye,Te)};_(q,Ye=>{e(y),i(()=>e(y).length>0)&&Ye(ye)})}var me=s(q,2),xe=s(r(me),2);Ce(xe),l(me);var S=s(me,2),re=s(r(S),2);Ce(re),l(S);var b=s(S,2),j=s(r(b),2);Ce(j),l(b);var Y=s(b,2),Ee=s(r(Y),2);Ce(Ee),l(Y),l(de),R(()=>{H!==(H=(t(),i(()=>t().class)))&&(ue.value=(ue.__value=(t(),i(()=>t().class)))??"",ya(ue,(t(),i(()=>t().class)))),ka(xe,(t(),i(()=>t().level)))}),Ge(Me,()=>t().name,Ye=>ht(ie,i(t).name=Ye,i(t))),F("change",ue,$),F("change",xe,Q),Ge(re,()=>t().race,Ye=>ht(ie,i(t).race=Ye,i(t))),Ge(j,()=>t().background,Ye=>ht(ie,i(t).background=Ye,i(t))),Ge(Ee,()=>t().alignment,Ye=>ht(ie,i(t).alignment=Ye,i(t))),c(he,de)};_(le,he=>{d(),i(()=>!d().characterInfo)&&he(N)})}l(z),c(a,z),Et(),h()}var Is=p('<div class="ability-card svelte-bbv1xt"><h3 class="svelte-bbv1xt"> </h3> <input type="number" class="ability-score svelte-bbv1xt" min="1" max="30"/> <div class="ability-modifier svelte-bbv1xt"> </div> <div class="roll-buttons svelte-bbv1xt"><button class="roll-btn svelte-bbv1xt">Check</button> <button class="roll-btn svelte-bbv1xt">Save</button></div> <div class="save-proficiency svelte-bbv1xt"><input type="checkbox" class="svelte-bbv1xt"/> <label class="svelte-bbv1xt">Save Prof.</label></div></div>'),Ts=p('<div class="proficiency-bonus svelte-bbv1xt"><label for="profBonus">Proficiency Bonus</label> <input type="number" id="profBonus" class="prof-input svelte-bbv1xt"/></div> <div class="abilities-grid svelte-bbv1xt"></div>',1),Es=p("<section><!> <!></section>");function Hs(a,n){Tt(n,!1);const t=()=>tt(ga,"$abilityModifiers",x),d=()=>tt(ie,"$character",x),f=()=>tt(ea,"$searchFilter",x),h=()=>tt(Pt,"$collapsedStates",x),y=()=>tt(Zt,"$isEditMode",x),[x,$]=Wt(),k=P(),Q=P(),z=la(),ce=[{key:"strength",label:"Strength"},{key:"dexterity",label:"Dexterity"},{key:"constitution",label:"Constitution"},{key:"intelligence",label:"Intelligence"},{key:"wisdom",label:"Wisdom"},{key:"charisma",label:"Charisma"}];function le(){es()}function N(ze){const Oe=t()[ze],H=`1d20${Oe>=0?"+":""}${Oe}`,q=[];q.push({value:"1d20",source:"base die"}),Oe!==0&&q.push({value:Oe,source:ze}),z("roll",{notation:H,rollType:"check",bonusBreakdown:q})}function he(ze){const Oe=t()[ze],H=d().saveProficiencies[ze]?d().proficiencyBonus:0,q=Oe+H,ye=`1d20${q>=0?"+":""}${q}`,me=[];me.push({value:"1d20",source:"base die"}),Oe!==0&&me.push({value:Oe,source:ze}),H!==0&&me.push({value:H,source:"proficiency"}),z("roll",{notation:ye,rollType:"save",bonusBreakdown:me})}et(()=>f(),()=>{o(k,ce.filter(({label:ze})=>f()?ze.toLowerCase().includes(f().toLowerCase()):!0))}),et(()=>(e(k),f()),()=>{o(Q,e(k).length>0||!f()||f().toLowerCase().includes("proficiency"))}),Jt(),It();var de=Es();let ae;var Me=r(de);ra(Me,{title:"Ability Scores",get collapsed(){return h(),i(()=>h().abilityScores)},ariaLabel:"Toggle Ability Scores Section",onToggle:()=>Pt.update(ze=>({...ze,abilityScores:!ze.abilityScores}))});var Qe=s(Me,2);{var ue=ze=>{var Oe=Ts(),H=Ne(Oe),q=s(r(H),2);Ce(q),l(H);var ye=s(H,2);yt(ye,5,()=>e(k),St,(me,xe)=>{let S=()=>e(xe).key,re=()=>e(xe).label;var b=Is(),j=r(b),Y=r(j,!0);l(j);var Ee=s(j,2);Ce(Ee);var Ye=s(Ee,2),Te=r(Ye);l(Ye);var g=s(Ye,2),M=r(g),K=s(M,2);l(g);var Z=s(g,2),O=r(Z);Ce(O);var _e=s(O,2);l(Z),l(b),R(Le=>{w(Y,Le),w(Te,`${t(),S(),i(()=>t()[S()]>=0?"+":"")??""}${t(),S(),i(()=>t()[S()])??""}`),O.disabled=!y(),Je(O,"id",`${S()}-save`),Je(_e,"for",`${S()}-save`)},[()=>(re(),i(()=>re().substring(0,3).toUpperCase()))]),Ge(Ee,()=>d().abilities[S()],Le=>ht(ie,i(d).abilities[S()]=Le,i(d))),F("change",Ee,le),F("click",M,()=>N(S())),F("click",K,()=>he(S())),Fa(O,()=>d().saveProficiencies[S()],Le=>ht(ie,i(d).saveProficiencies[S()]=Le,i(d))),c(me,b)}),l(ye),Ge(q,()=>d().proficiencyBonus,me=>ht(ie,i(d).proficiencyBonus=me,i(d))),c(ze,Oe)};_(Qe,ze=>{h(),i(()=>!h().abilityScores)&&ze(ue)})}l(de),R(()=>ae=mt(de,1,"ability-scores svelte-bbv1xt",null,ae,{hidden:!e(Q)})),c(a,de),Et(),$()}function Pa(a,n){if(!a.class)return null;const t=qt(a.class);if(!t||!t.spellcaster||!t.spellcastingAbility)return null;const d=n[t.spellcastingAbility];return 8+a.proficiencyBonus+d}function Wa(a,n){if(!a.class)return 0;const t=qt(a.class);return!t||!t.spellcaster||!t.spellcastingAbility?0:n[t.spellcastingAbility]}var Us=p('<input type="number" id="armorClass" class="stat-input svelte-1r5hyyb"/>'),Ns=p('<input type="text" id="armorClass" readonly=""/>'),Gs=p('<div class="stat-box svelte-1r5hyyb"><label for="spellSaveDC" class="svelte-1r5hyyb">Spell Save DC</label> <input type="number" id="spellSaveDC" class="stat-input svelte-1r5hyyb" readonly="" title="8 + Proficiency Bonus + Spellcasting Ability Modifier"/></div>'),Os=p('<span class="hit-dice-type"> </span>'),qs=p('<div class="stats-grid svelte-1r5hyyb"><div class="stat-box svelte-1r5hyyb"><label for="armorClass" class="svelte-1r5hyyb">Armor Class</label> <!></div> <div class="stat-box svelte-1r5hyyb"><label for="initiative" class="svelte-1r5hyyb">Initiative</label> <input type="number" id="initiative" class="stat-input svelte-1r5hyyb"/></div> <div class="stat-box svelte-1r5hyyb"><label for="speed" class="svelte-1r5hyyb">Speed</label> <input type="text" id="speed" class="stat-input svelte-1r5hyyb"/></div> <!></div> <div class="hp-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Points</h3> <div><div class="hp-inputs svelte-1r5hyyb"><input type="number" class="hp-current svelte-1r5hyyb" min="0"/> <span class="hp-separator svelte-1r5hyyb">/</span> <input type="number" class="hp-max svelte-1r5hyyb" min="0"/></div> <div class="hp-controls svelte-1r5hyyb"><button class="hp-btn svelte-1r5hyyb">âˆ’</button> <button class="hp-btn svelte-1r5hyyb">+</button> <button class="hp-btn svelte-1r5hyyb">âˆ’5</button> <button class="hp-btn svelte-1r5hyyb">+5</button></div></div> <div class="temp-hp svelte-1r5hyyb"><label for="tempHP" class="svelte-1r5hyyb">Temp HP</label> <input type="number" id="tempHP" min="0" class="svelte-1r5hyyb"/></div></div> <div class="hit-dice-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Dice</h3> <div class="hit-dice-display svelte-1r5hyyb"><input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <span>/</span> <input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <!></div> <div class="hit-dice-controls svelte-1r5hyyb"><label for="hitDiceCount" class="svelte-1r5hyyb">Roll</label> <div class="hit-dice-count-controls svelte-1r5hyyb"><button class="hit-dice-btn svelte-1r5hyyb">âˆ’</button> <input type="number" id="hitDiceCount" class="hit-dice-count-input svelte-1r5hyyb" min="1"/> <button class="hit-dice-btn svelte-1r5hyyb">+</button></div> <button class="btn btn-primary roll-hit-dice use-enabled svelte-1r5hyyb">ðŸŽ² Roll</button></div></div>',1),Ws=p("<section><!> <!></section>");function zs(a,n){Tt(n,!1);const t=()=>tt(ie,"$character",x),d=()=>tt(ga,"$abilityModifiers",x),f=()=>tt(ea,"$searchFilter",x),h=()=>tt(Pt,"$collapsedStates",x),y=()=>tt(Zt,"$isEditMode",x),[x,$]=Wt(),k=P(),Q=P(),z=P(),ce=P(),le=la();let N=P(1);function he(H){ie.update(q=>(q.currentHP=Math.max(0,Math.min(q.maxHP,q.currentHP+H)),q))}function de(H){const q=e(N)+H,ye=t().hitDice.current;o(N,Math.max(1,Math.min(ye,q)))}function ae(H=1){if(t().hitDice.current<=0){alert("No hit dice remaining!");return}if(!t().class){alert("Please select a class first!");return}const q=qt(t().class);if(!q){alert("Invalid class configuration!");return}const ye=Math.min(H,t().hitDice.current),me=q.hitDice,xe=d().constitution,S=xe*ye,re=S>=0?`+${S}`:`${S}`,b=`${ye}${me}${re}`,j=[];if(j.push({value:`${ye}${me}`,source:"hit dice"}),xe!==0)for(let Y=0;Y<ye;Y++)j.push({value:xe,source:"constitution"});le("rollHitDice",{notation:b,hitDie:me,count:ye,bonusBreakdown:j})}et(()=>(t(),d()),()=>{o(k,Pa(t(),d()))}),et(()=>(t(),e(N)),()=>{const H=t().hitDice.current;H>0&&e(N)>H&&o(N,H)}),et(()=>t(),()=>{o(Q,t().activeStates&&t().activeStates.length>0?t().activeStates.reduce((H,q)=>H+(q.acBonus||0),0):0)}),et(()=>t(),()=>{o(z,t().activeStates&&t().activeStates.length>0?t().activeStates.some(H=>H.name==="Aid"&&H.target==="self"):!1)}),et(()=>f(),()=>{o(ce,!f()||"armor class".includes(f().toLowerCase())||"initiative".includes(f().toLowerCase())||"speed".includes(f().toLowerCase())||"hit points".includes(f().toLowerCase())||"hp".includes(f().toLowerCase())||"hit dice".includes(f().toLowerCase())||"spell save".includes(f().toLowerCase())||"combat".includes(f().toLowerCase()))}),Jt(),It();var Me=Ws();let Qe;var ue=r(Me);{let H=ct(()=>(h(),i(()=>h().combatStats?"Expand":"Collapse")));ra(ue,{title:"Combat Stats",get collapsed(){return h(),i(()=>h().combatStats)},get ariaLabel(){return e(H)},onToggle:()=>Pt.update(q=>({...q,combatStats:!q.combatStats}))})}var ze=s(ue,2);{var Oe=H=>{var q=qs(),ye=Ne(q),me=r(ye),xe=s(r(me),2);{var S=I=>{var X=Us();Ce(X),Ge(X,()=>t().armorClass,Se=>ht(ie,i(t).armorClass=Se,i(t))),c(I,X)},re=I=>{var X=Ns();Ce(X),R(()=>{ka(X,(e(Q),t(),i(()=>e(Q)!==0?`${t().armorClass} â†’ ${t().armorClass+e(Q)}`:`${t().armorClass}`))),mt(X,1,gs(e(Q)!==0?"stat-input ac-enhanced":"stat-input"),"svelte-1r5hyyb"),Je(X,"title",e(Q)!==0?"Base AC plus active effect bonuses":"Base Armor Class")}),c(I,X)};_(xe,I=>{y()?I(S):I(re,!1)})}l(me);var b=s(me,2),j=s(r(b),2);Ce(j),l(b);var Y=s(b,2),Ee=s(r(Y),2);Ce(Ee),l(Y);var Ye=s(Y,2);{var Te=I=>{var X=Gs(),Se=s(r(X),2);Ce(Se),l(X),R(()=>ka(Se,e(k))),c(I,X)};_(Ye,I=>{e(k)!==null&&I(Te)})}l(ye);var g=s(ye,2),M=s(r(g),2);let K;var Z=r(M),O=r(Z);Ce(O);var _e=s(O,4);Ce(_e),l(Z);var Le=s(Z,2),at=r(Le),ke=s(at,2),qe=s(ke,2),A=s(qe,2);l(Le),l(M);var C=s(M,2),ne=s(r(C),2);Ce(ne),l(C),l(g);var oe=s(g,2),W=s(r(oe),2),v=r(W);Ce(v);var He=s(v,4);Ce(He);var pe=s(He,2);{var ge=I=>{const X=ct(()=>(E(qt),t(),i(()=>qt(t().class))));var Se=ot(),Ue=Ne(Se);{var We=ee=>{const ve=ct(()=>(d(),i(()=>d().constitution)));var Pe=Os(),Xe=r(Pe);l(Pe),R(()=>w(Xe,`(${E(e(X)),i(()=>e(X).hitDice)??""}${(e(ve)>=0?`+${e(ve)}`:e(ve))??""})`)),c(ee,Pe)};_(Ue,ee=>{e(X)&&ee(We)})}c(I,Se)};_(pe,I=>{t(),i(()=>t().class)&&I(ge)})}l(W);var B=s(W,2),we=s(r(B),2),Ae=r(we),Ke=s(Ae,2);Ce(Ke);var st=s(Ke,2);l(we);var De=s(we,2);l(B),l(oe),R(()=>{K=mt(M,1,"hp-display svelte-1r5hyyb",null,K,{"aid-active":e(z)}),Je(O,"max",(t(),i(()=>t().maxHP))),Je(v,"max",(t(),i(()=>t().hitDice.max))),Ae.disabled=e(N)<=1,Je(Ke,"max",(t(),i(()=>t().hitDice.current))),st.disabled=(e(N),t(),i(()=>e(N)>=t().hitDice.current)),De.disabled=(t(),i(()=>t().hitDice.current<=0||!t().class))}),Ge(j,()=>t().initiative,I=>ht(ie,i(t).initiative=I,i(t))),Ge(Ee,()=>t().speed,I=>ht(ie,i(t).speed=I,i(t))),Ge(O,()=>t().currentHP,I=>ht(ie,i(t).currentHP=I,i(t))),Ge(_e,()=>t().maxHP,I=>ht(ie,i(t).maxHP=I,i(t))),F("click",at,()=>he(-1)),F("click",ke,()=>he(1)),F("click",qe,()=>he(-5)),F("click",A,()=>he(5)),Ge(ne,()=>t().tempHP,I=>ht(ie,i(t).tempHP=I,i(t))),Ge(v,()=>t().hitDice.current,I=>ht(ie,i(t).hitDice.current=I,i(t))),Ge(He,()=>t().hitDice.max,I=>ht(ie,i(t).hitDice.max=I,i(t))),F("click",Ae,()=>de(-1)),Ge(Ke,()=>e(N),I=>o(N,I)),F("input",Ke,I=>{const X=I.target,Se=parseInt(X.value);Se>t().hitDice.current&&o(N,t().hitDice.current),Se<1&&o(N,1)}),F("click",st,()=>de(1)),F("click",De,()=>ae(e(N))),c(H,q)};_(ze,H=>{h(),i(()=>!h().combatStats)&&H(Oe)})}l(Me),R(()=>Qe=mt(Me,1,"combat-stats svelte-1r5hyyb",null,Qe,{hidden:!e(ce)})),c(a,Me),Et(),$()}const ba={acrobatics:"dexterity",animalHandling:"wisdom",arcana:"intelligence",athletics:"strength",deception:"charisma",history:"intelligence",insight:"wisdom",intimidation:"charisma",investigation:"intelligence",medicine:"wisdom",nature:"intelligence",perception:"wisdom",performance:"charisma",persuasion:"charisma",religion:"intelligence",sleightOfHand:"dexterity",stealth:"dexterity",survival:"wisdom"};var Ks=p('<div class="skill-row svelte-1f1pl16"><input type="checkbox" class="svelte-1f1pl16"/> <label class="svelte-1f1pl16"> <span class="ability-tag svelte-1f1pl16"> </span></label> <span class="skill-modifier svelte-1f1pl16"> </span> <button class="roll-btn svelte-1f1pl16">Roll</button></div>'),Vs=p('<div class="skills-grid svelte-1f1pl16"></div>'),Js=p("<section><!> <!></section>");function Qs(a,n){Tt(n,!1);const t=()=>tt(ie,"$character",x),d=()=>tt(ga,"$abilityModifiers",x),f=()=>tt(ea,"$searchFilter",x),h=()=>tt(Pt,"$collapsedStates",x),y=()=>tt(Zt,"$isEditMode",x),[x,$]=Wt(),k=P(),Q=P(),z=P(),ce=P(),le=P(),N=P(),he=la(),de=[{key:"acrobatics",label:"Acrobatics"},{key:"animalHandling",label:"Animal Handling"},{key:"arcana",label:"Arcana"},{key:"athletics",label:"Athletics"},{key:"deception",label:"Deception"},{key:"history",label:"History"},{key:"insight",label:"Insight"},{key:"intimidation",label:"Intimidation"},{key:"investigation",label:"Investigation"},{key:"medicine",label:"Medicine"},{key:"nature",label:"Nature"},{key:"perception",label:"Perception"},{key:"performance",label:"Performance"},{key:"persuasion",label:"Persuasion"},{key:"religion",label:"Religion"},{key:"sleightOfHand",label:"Sleight of Hand"},{key:"stealth",label:"Stealth"},{key:"survival",label:"Survival"}];function ae(H){const q=ba[H],ye=d()[q],me=t().skillProficiencies[H]?t().proficiencyBonus:0,xe=e(k)[H],S=`1d20${xe>=0?"+":""}${xe}`,re=[];re.push({value:"1d20",source:"base die"}),ye!==0&&re.push({value:ye,source:q}),me!==0&&re.push({value:me,source:"proficiency"}),he("roll",{notation:S,rollType:"check",bonusBreakdown:re})}et(()=>{},()=>{o(k,{})}),et(()=>t(),()=>{o(Q,t().skillProficiencies)}),et(()=>t(),()=>{o(z,t().proficiencyBonus)}),et(()=>d(),()=>{o(ce,d())}),et(()=>(e(ce),e(Q),e(z)),()=>{for(const{key:H}of de){const q=ba[H],ye=e(ce)[q],me=e(Q)[H]?e(z):0;sa(k,e(k)[H]=ye+me)}}),et(()=>f(),()=>{o(le,de.filter(({label:H})=>f()?H.toLowerCase().includes(f().toLowerCase()):!0))}),et(()=>e(le),()=>{o(N,e(le).length>0)}),Jt(),It();var Me=Js();let Qe;var ue=r(Me);{let H=ct(()=>(h(),i(()=>h().skills?"Expand":"Collapse")));ra(ue,{title:"Skills",get collapsed(){return h(),i(()=>h().skills)},get ariaLabel(){return e(H)},onToggle:()=>Pt.update(q=>({...q,skills:!q.skills}))})}var ze=s(ue,2);{var Oe=H=>{var q=Vs();yt(q,5,()=>e(le),St,(ye,me)=>{let xe=()=>e(me).key,S=()=>e(me).label;var re=Ks(),b=r(re);Ce(b);var j=s(b,2),Y=r(j),Ee=s(Y),Ye=r(Ee);l(Ee),l(j);var Te=s(j,2),g=r(Te);l(Te);var M=s(Te,2);l(re),R(K=>{ts(b,(e(Q),xe(),i(()=>e(Q)[xe()]))),b.disabled=!y(),Je(b,"id",xe()),Je(j,"for",xe()),w(Y,`${S()??""} `),w(Ye,`(${K??""})`),w(g,`${e(k),xe(),i(()=>e(k)[xe()]>=0?"+":"")??""}${e(k),xe(),i(()=>e(k)[xe()])??""}`)},[()=>(E(ba),xe(),i(()=>ba[xe()].substring(0,3).toUpperCase()))]),F("change",b,K=>{console.log("Skill proficiency changed:",xe(),K.target.checked),ie.update(Z=>({...Z,skillProficiencies:{...Z.skillProficiencies,[xe()]:K.target.checked}}))}),F("click",M,()=>ae(xe())),c(ye,re)}),l(q),c(H,q)};_(ze,H=>{h(),i(()=>!h().skills)&&H(Oe)})}l(Me),R(()=>Qe=mt(Me,1,"skills svelte-1f1pl16",null,Qe,{hidden:!e(N)})),c(a,Me),Et(),$()}let ha=null,ma=null;async function ss(){if(ha)return ha;try{return ha=await(await fetch(as("/data/spells.json"))).json(),ha||[]}catch(a){return console.error("Failed to load spells:",a),[]}}async function Ys(){if(ma)return ma;try{return ma=await(await fetch(as("/data/feats.json"))).json(),ma||[]}catch(a){return console.error("Failed to load feats:",a),[]}}function za(a,n){if(!n.trim())return a;const t=n.toLowerCase();return a.filter(d=>d.name.toLowerCase().includes(t)||d.school.toLowerCase().includes(t)||d.classes.some(f=>f.toLowerCase().includes(t))||d.description.toLowerCase().includes(t))}function Xs(a,n){return n===null?a:a.filter(t=>t.level===n)}function Zs(a,n){if(!n.trim())return a;const t=n.toLowerCase();return a.filter(d=>d.name.toLowerCase().includes(t)||d.description.toLowerCase().includes(t))}function _a(a){const n=a.description,t=/\b(Strength|Dexterity|Constitution|Intelligence|Wisdom|Charisma)\s+saving\s+throw/i,d=n.match(t);if(!d)return null;const f=d[1].toLowerCase(),y=/half\s+(?:as\s+much\s+)?damage\s+on\s+a\s+successful(?:\s+save)?/i.test(n),$=/saving\s+throw\s+or\s+take.*?damage/i.test(n)&&!y;return{ability:f,halfDamageOnSave:y,noDamageOnSave:$}}function el(a){const n=a.description;return/(plus|add)\s+your\s+spellcasting\s+(ability\s+)?modifier/i.test(n)}function wa(a){const n=a.description.toLowerCase();return n.includes("ranged spell attack")||n.includes("melee spell attack")}function Ka(a){const n=a.description.toLowerCase();if(["Divine Favor","Bless","Aid","Command"].includes(a.name))return!0;const f=["takes","take","deals","deal","damage equal to","force damage","fire damage","cold damage","lightning damage","thunder damage","acid damage","poison damage","necrotic damage","radiant damage","psychic damage","regain","regains","hit point"].some(x=>n.includes(x));return["bonus to attack","bonus to damage","bonus to ac","gains a +","gain a +","+1 bonus","+2 bonus","+3 bonus","advantage on","becomes a magic weapon"].some(x=>n.includes(x))&&!f}function tl(a){const n=a.description;let t=0,d=0,f=0,h="";const y=n.match(/\+(\d+)\s+bonus\s+to\s+attack\s+rolls\s+and\s+damage\s+rolls/i);if(y){const $=parseInt(y[1]);t=$,d=$,h=`+${$} to attack and damage rolls`}if(a.name==="Bless"&&(h="Add 1d4 to attack rolls and saves",t="1d4"),a.name==="Aid")return h="+5 HP (max and current) for 8 hours",{attackBonus:0,damageBonus:0,acBonus:0,hpBonus:5,description:h,name:a.name};a.name==="Divine Favor"&&(h="Your weapon attacks deal an extra 1d4 radiant damage on a hit.",d="1d4");const x=n.match(/\+(\d+)\s+bonus\s+to\s+AC/i);return x&&(f=parseInt(x[1]),h=`+${f} to AC`),a.name==="Haste"&&(h="+2 AC, doubled speed, extra action",f=2),h||t!==0||d!==0||f!==0?{attackBonus:t,damageBonus:d,acBonus:f,description:h||a.description.substring(0,100),name:a.name}:null}var al=p('<button class="btn btn-secondary">Add Attack</button>'),sl=p('<input type="text" placeholder="Attack name" class="attack-name svelte-14o91c5"/>'),ll=p('<h4 class="attack-name-display svelte-14o91c5"> </h4>'),rl=p('<button class="btn-remove svelte-14o91c5">Ã—</button>'),il=p('<div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Bonus</label> <input type="number" class="attack-bonus svelte-14o91c5"/></div>'),nl=p('<div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Damage</label> <input type="text" placeholder="e.g., 2d6+3" class="attack-damage svelte-14o91c5"/></div>'),ol=p('<div class="spell-info-loading svelte-14o91c5">Loading spell info...</div>'),cl=p('<li class="svelte-14o91c5"><strong>At Higher Levels:</strong> </li>'),vl=p('<ul class="svelte-14o91c5"><li class="svelte-14o91c5"><strong>Level:</strong> </li> <li class="svelte-14o91c5"><strong>Casting Time:</strong> </li> <li class="svelte-14o91c5"><strong>Range:</strong> </li> <li class="svelte-14o91c5"><strong>Components:</strong> <!></li> <li class="svelte-14o91c5"><strong>Duration:</strong> <!> </li> <li class="svelte-14o91c5"><strong>Description:</strong> </li> <!></ul>'),dl=p('<span class="scaled-damage svelte-14o91c5" style="margin-left: 8px;"> </span>'),ul=p('<span class="scaled-damage svelte-14o91c5">(Half damage)</span>'),pl=p('<span class="scaled-damage svelte-14o91c5">(No damage)</span>'),fl=p('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> <!> <!></label></div>'),gl=p("<option> </option>"),bl=p('<span class="scaled-damage svelte-14o91c5"><!> </span>'),hl=p('<span class="scaled-damage svelte-14o91c5"> </span>'),ml=p('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> Target is Fiend or Undead <!></label></div>'),_l=p('<div class="spell-level-selector svelte-14o91c5"><label class="svelte-14o91c5">Cast at Level:</label> <select class="spell-level-select use-enabled svelte-14o91c5"></select> <!></div> <!>',1),yl=p('<div class="spell-level-selector svelte-14o91c5"><span style="color: #dc3545; font-weight: bold;">No spell slots available!</span></div>'),kl=p('<div class="spell-info svelte-14o91c5"><div class="spell-info-header svelte-14o91c5" role="button" tabindex="0"><h4 class="svelte-14o91c5">Spell Info</h4> <button class="collapse-btn-small svelte-14o91c5"> </button></div> <!></div> <!> <!>',1),Sl=p('<div class="spell-info-missing svelte-14o91c5">Spell info not found.</div>'),xl=p('<div class="attack-notes svelte-14o91c5"><label class="svelte-14o91c5">Notes</label> <textarea placeholder="e.g., DC 15 Dex save, Range 120 ft, Concentration" class="notes-input svelte-14o91c5" rows="2"></textarea></div>'),$l=p('<button class="btn btn-primary">Roll Attack</button>'),Cl=p('<div class="buff-target-selection svelte-14o91c5"><div class="target-options svelte-14o91c5"><label class="target-option svelte-14o91c5"><input type="radio" class="svelte-14o91c5"/> Self</label> <label class="target-option svelte-14o91c5"><input type="radio" class="svelte-14o91c5"/> Other</label></div> <button class="btn btn-info"> </button></div>'),Ll=p('<button class="btn btn-info">Cast Spell</button>'),wl=p("<button><!></button>"),Dl=p('<button class="btn btn-secondary">Roll Damage</button>'),jl=p('<button class="btn btn-primary">Roll Attack</button> <!>',1),Bl=p('<div class="attack-card svelte-14o91c5"><div class="attack-header svelte-14o91c5"><!> <!></div> <div class="attack-details svelte-14o91c5"><!> <!> <div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Type</label> <input type="text" placeholder="e.g., slashing" class="attack-type svelte-14o91c5"/></div></div> <!> <!> <div class="attack-actions svelte-14o91c5"><!></div></div>'),Al=p('<p class="no-attacks svelte-14o91c5">No attacks added yet. Click "Add Attack" to create one.</p>'),Fl=p('<p class="no-attacks svelte-14o91c5">No attacks match your search.</p>'),Ml=p('<button class="btn-remove svelte-14o91c5">Ã—</button>'),Pl=p('<div class="state-card svelte-14o91c5"><div class="state-header svelte-14o91c5"><input type="text" placeholder="Effect name (e.g., Magic Weapon)" class="state-name svelte-14o91c5"/> <!></div> <div class="state-details svelte-14o91c5"><div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Attack Bonus</label> <input type="number" class="state-bonus svelte-14o91c5"/></div> <div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Damage Bonus</label> <input type="text" class="state-bonus svelte-14o91c5"/></div> <div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Target</label> <select class="state-bonus svelte-14o91c5"><option>Self</option><option>Other</option></select></div></div> <div class="state-description svelte-14o91c5"><label class="svelte-14o91c5">Description</label> <input type="text" placeholder="e.g., +1 to attack and damage rolls (Magic Weapon)" class="state-desc-input svelte-14o91c5"/></div></div>'),Rl=p('<div class="states-list svelte-14o91c5"></div>'),Il=p('<p class="no-states svelte-14o91c5">No active effects. Add spell effects that modify your attacks.</p>'),Tl=p('<!> <div class="attacks-list svelte-14o91c5"><!> <!></div> <div class="active-states-section svelte-14o91c5"><h3 class="svelte-14o91c5">Active Spell Effects</h3> <p class="section-description svelte-14o91c5">Effects that modify attack and damage rolls (e.g., Magic Weapon, Bless)</p> <button class="btn btn-secondary">Add Effect</button> <!></div>',1),El=p("<section><!> <!></section>");function Hl(a,n){Tt(n,!1);const t=()=>tt(ie,"$character",x),d=()=>tt(ga,"$abilityModifiers",x),f=()=>tt(ea,"$searchFilter",x),h=()=>tt(Pt,"$collapsedStates",x),y=()=>tt(Zt,"$isEditMode",x),[x,$]=Wt(),k=P(),Q=P(),z=[],ce=la();let le=P({}),N=P({});function he(g){sa(le,e(le)[g]=!e(le)[g]),o(le,{...e(le)})}function de(g){return g.description.toLowerCase().includes("regain")&&(g.description.toLowerCase().includes("hit point")||g.description.toLowerCase().includes("hp"))}function ae(g){return["Shield of Faith","Bless","Aid","Magic Weapon"].includes(g)}function Me(){ie.update(g=>(g.attacks=[...g.attacks,{id:crypto.randomUUID(),name:"",bonus:0,damage:"",damageType:"",notes:""}],g))}function Qe(g){ie.update(M=>(M.attacks=M.attacks.filter(K=>K.id!==g),M))}function ue(g){let M=g.damage,K=!1,Z=!1;if(g.spellRef){const ke=q(g.spellRef);if(ke&&(Z=wa(ke),ke.level>0)){const qe=g.castAtLevel||ke.level;if(!ye(qe)){Ot.add(`No level ${qe} spell slots available!`,"error");return}const C=_a(ke);C&&g.targetSucceededSave&&C.noDamageOnSave?M="0":(K=C?.halfDamageOnSave&&g.targetSucceededSave||!1,M=me(g,ke))}}else if(t().activeStates&&t().activeStates.length>0){let ke=0,qe=[];for(const A of t().activeStates)A.target!=="other"&&(typeof A.damageBonus=="string"?qe.push(A.damageBonus):typeof A.damageBonus=="number"&&(ke+=A.damageBonus));if((ke!==0||qe.length>0)&&M){const A=M.match(/(\d+d\d+)([+-]\d+)?/);if(A){const[,C,ne]=A,W=(ne?parseInt(ne):0)+ke;let v=`${C}`;W!==0&&(v+=`${W>=0?"+":""}${W}`),qe.length>0&&(v+=" + "+qe.join(" + ")),M=v}}}const O=[];let _e=0;if(Z){const ke=Wa(t(),d()),qe=t().proficiencyBonus||0;O.push({value:qe,source:"proficiency"}),O.push({value:ke,source:"spellcasting"}),_e=qe+ke}else g.bonus!==0&&O.push({value:g.bonus,source:"base"}),_e=g.bonus;let Le=[];if(t().activeStates)for(const ke of t().activeStates)ke.target!=="other"&&(typeof ke.attackBonus=="number"&&ke.attackBonus!==0?(O.push({value:ke.attackBonus,source:ke.name.toLowerCase()}),_e+=ke.attackBonus):typeof ke.attackBonus=="string"&&ke.attackBonus&&(Le.push(ke.attackBonus),O.push({value:ke.attackBonus,source:ke.name.toLowerCase()})));let at=`1d20${_e>=0?"+":""}${_e}`;Le.length>0&&(at+="+"+Le.join("+")),ce("roll",{notation:at,damageNotation:M,attackName:g.name,applyHalfDamage:K,bonusBreakdown:O,rollType:"attack"})}function ze(g){if(!g.damage){Ot.add(`${g.name}: No damage specified`,"error");return}let M=g.damage,K=!1;const Z=[];if(g.spellRef){const O=q(g.spellRef);if(O&&O.level>0){const _e=g.castAtLevel||O.level;if(!ye(_e)){Ot.add(`No level ${_e} spell slots available!`,"error");return}const at=_a(O);at&&g.targetSucceededSave&&at.noDamageOnSave?M="0":(K=at?.halfDamageOnSave&&g.targetSucceededSave||!1,M=me(g,O))}}else{const O=M.match(/(\d+d\d+)([+-]\d+)?/);if(O){const[,_e,Le]=O,at=Le?parseInt(Le):0;if(at!==0&&Z.push({value:at,source:"base"}),t().activeStates&&t().activeStates.length>0){let ke=0,qe=[];for(const A of t().activeStates)A.target!=="other"&&(typeof A.damageBonus=="string"?qe.push(A.damageBonus):typeof A.damageBonus=="number"&&A.damageBonus!==0&&(Z.push({value:A.damageBonus,source:A.name.toLowerCase()}),ke+=A.damageBonus));if(ke!==0||qe.length>0){const A=at+ke;let C=`${_e}`;A!==0&&(C+=`${A>=0?"+":""}${A}`),qe.length>0&&(C+=" + "+qe.join(" + ")),M=C}}}}ce("roll",{notation:M,attackName:g.name,applyHalfDamage:K,bonusBreakdown:Z})}let Oe=P([]),H=P(!1);pa(async()=>{o(Oe,await ss()),o(H,!0)});function q(g){return e(Oe).find(M=>M.name===g)}function ye(g){t().classFeatures.spellSlotsByLevel||ht(ie,i(t).classFeatures.spellSlotsByLevel={},i(t)),t().classFeatures.spellSlotsByLevel[g]||ht(ie,i(t).classFeatures.spellSlotsByLevel[g]=Array(2).fill(!1),i(t));const K=t().classFeatures.spellSlotsByLevel[g].findIndex(Z=>!Z);return K===-1?!1:(ie.update(Z=>(Z.classFeatures.spellSlotsByLevel||(Z.classFeatures.spellSlotsByLevel={}),Z.classFeatures.spellSlotsByLevel[g]||(Z.classFeatures.spellSlotsByLevel[g]=Array(2).fill(!1)),Z.classFeatures.spellSlotsByLevel[g][K]=!0,Z)),!0)}function me(g,M){let K=g.damage,Z=0,O=0;if(el(M)&&(O+=Wa(t(),d())),t().activeStates)for(const oe of t().activeStates)oe.target!=="other"&&typeof oe.damageBonus=="number"&&(O+=oe.damageBonus);if(M.higherLevelSlot&&g.castAtLevel){const oe=M.level,v=(g.castAtLevel||oe)-oe;if(v>0){const He=M.higherLevelSlot.match(/(\d+)d(\d+)\s+for\s+each.*?level\s+above/i);if(He){const[,pe]=He;Z+=v*parseInt(pe)}}}if(g.targetIsFiendOrUndead&&M.description.includes("Fiend or an Undead")){const oe=M.description.match(/increases by (\d+)d(\d+) if.*?Fiend or.*?Undead/i);if(oe){const[,W]=oe;Z+=parseInt(W)}}const _e=K.match(/(\d+)d(\d+)([+-]\d+)?/);if(!_e)return O!==0?O>=0?`${O}`:`${O}`:K||"0";const[,Le,at,ke]=_e,qe=parseInt(Le)+Z,C=(ke?parseInt(ke):0)+O;let ne=`${qe}d${at}`;return C!==0&&(ne+=C>=0?`+${C}`:`${C}`),ne}function xe(g){const M=[];for(let Z=g.level;Z<=9;Z++){const O=t().classFeatures.spellSlotsByLevel?.[Z];O&&O.length>0&&M.push(Z)}return M}function S(){ie.update(g=>(g.activeStates||(g.activeStates=[]),g.activeStates=[...g.activeStates,{name:"",attackBonus:0,damageBonus:0,description:"",target:"self"}],g))}function re(g){ie.update(M=>{if(M.activeStates){const K=M.activeStates[g];K?.hpBonus&&K.target!=="other"&&(M.maxHP-=K.hpBonus,M.currentHP=Math.max(1,Math.min(M.currentHP-K.hpBonus,M.maxHP))),M.activeStates=M.activeStates.filter((Z,O)=>O!==g)}return M})}function b(g,M="self"){const K=q(g.spellRef);if(!K){Ot.add("Spell not found","error");return}const Z=g.castAtLevel||K.level;if(Z>0&&!ye(Z)){Ot.add(`No level ${Z} spell slots available!`,"error");return}const O=tl(K);if(!O){Ot.add(`${K.name} cast! Check spell description for effects.`,"info");return}let _e=O.hpBonus||0,Le=O.description;K.name==="Aid"&&Z>K.level&&(_e=5+(Z-K.level)*5,Le=`+${_e} HP (max and current) for 8 hours`);const ke=["Shield of Faith","Bless","Aid","Magic Weapon"].includes(K.name);ie.update(A=>{A.activeStates||(A.activeStates=[]);const C=A.activeStates.find(ne=>ne.name===K.name);return C&&C.hpBonus&&C.target!=="other"&&(A.maxHP-=C.hpBonus,A.currentHP=Math.max(1,Math.min(A.currentHP-C.hpBonus,A.maxHP))),A.activeStates=A.activeStates.filter(ne=>ne.name!==K.name),_e>0&&M==="self"&&(A.maxHP+=_e,A.currentHP+=_e),A.activeStates=[...A.activeStates,{name:K.name,attackBonus:O.attackBonus,damageBonus:O.damageBonus,acBonus:O.acBonus,description:Le,target:M,hpBonus:_e}],A});const qe=M==="self"?" on self":" on other";Ot.add(`${K.name} cast${ke?qe:""}! Effect added to Active Spell Effects.`,"success")}et(()=>(t(),e(le),e(N)),()=>{if(t()&&t().attacks)for(const g of t().attacks)g.spellRef&&e(le)[g.id]===void 0&&sa(le,e(le)[g.id]=!0),g.spellRef&&e(N)[g.id]===void 0&&sa(N,e(N)[g.id]="self")}),et(()=>(t(),f()),()=>{o(k,t().attacks.filter(g=>{if(!f())return!0;const M=f().toLowerCase();return g.name.toLowerCase().includes(M)||g.damageType.toLowerCase().includes(M)}).sort((g,M)=>!g.spellRef&&M.spellRef?-1:g.spellRef&&!M.spellRef?1:0))}),et(()=>(f(),e(k)),()=>{o(Q,!f()||e(k).length>0||"attack".includes(f().toLowerCase())||"spell".includes(f().toLowerCase()))}),Jt(),It();var j=El();let Y;var Ee=r(j);{let g=ct(()=>(h(),i(()=>h().attacks?"Expand":"Collapse")));ra(Ee,{title:"Attacks & Spells",get collapsed(){return h(),i(()=>h().attacks)},get ariaLabel(){return e(g)},onToggle:()=>Pt.update(M=>({...M,attacks:!M.attacks}))})}var Ye=s(Ee,2);{var Te=g=>{var M=Tl(),K=Ne(M);{var Z=W=>{var v=al();F("click",v,Me),c(W,v)};_(K,W=>{y()&&W(Z)})}var O=s(K,2),_e=r(O);yt(_e,1,()=>e(k),W=>W.id,(W,v,He)=>{var pe=Bl(),ge=r(pe),B=r(ge);{var we=D=>{var T=sl();Ce(T),Ge(T,()=>e(v).name,V=>(e(v).name=V,jt(()=>(e(k),t(),f())))),c(D,T)},Ae=D=>{var T=ll(),V=r(T,!0);l(T),R(()=>w(V,(e(v),i(()=>e(v).name||"(Unnamed Attack)")))),c(D,T)};_(B,D=>{y()?D(we):D(Ae,!1)})}var Ke=s(B,2);{var st=D=>{var T=rl();F("click",T,()=>Qe(e(v).id)),c(D,T)};_(Ke,D=>{y()&&D(st)})}l(ge);var De=s(ge,2),I=r(De);{var X=D=>{var T=il(),V=r(T),Be=s(V,2);Ce(Be),l(T),R(()=>{Je(V,"for",`attack-bonus-${e(v),i(()=>e(v).id)??""}`),Je(Be,"id",`attack-bonus-${e(v),i(()=>e(v).id)??""}`)}),Ge(Be,()=>e(v).bonus,Re=>(e(v).bonus=Re,jt(()=>(e(k),t(),f())))),c(D,T)};_(I,D=>{e(v),i(()=>e(v).bonus!==0&&e(v).bonus!==void 0)&&D(X)})}var Se=s(I,2);{var Ue=D=>{var T=nl(),V=r(T),Be=s(V,2);Ce(Be),l(T),R(()=>{Je(V,"for",`attack-damage-${e(v),i(()=>e(v).id)??""}`),Je(Be,"id",`attack-damage-${e(v),i(()=>e(v).id)??""}`)}),Ge(Be,()=>e(v).damage,Re=>(e(v).damage=Re,jt(()=>(e(k),t(),f())))),c(D,T)};_(Se,D=>{e(v),i(()=>e(v).damage&&e(v).damage.trim()!=="")&&D(Ue)})}var We=s(Se,2),ee=r(We),ve=s(ee,2);Ce(ve),l(We),l(De);var Pe=s(De,2);{var Xe=D=>{var T=ot(),V=Ne(T);{var Be=it=>{var J=ol();c(it,J)},Re=it=>{const J=ct(()=>(e(v),i(()=>q(e(v).spellRef))));var dt=ot(),xt=Ne(dt);{var _t=U=>{const L=ct(()=>(E(_a),E(e(J)),i(()=>_a(e(J)))));var $e=kl(),se=Ne($e),Ze=r(se),Ie=s(r(Ze),2),ut=r(Ie,!0);l(Ie),l(Ze);var Ve=s(Ze,2);{var rt=Fe=>{var nt=vl(),bt=r(nt),Ct=s(r(bt));l(bt);var Ht=s(bt,2),Ut=s(r(Ht));l(Ht);var At=s(Ht,2),Lt=s(r(At));l(At);var wt=s(At,2),Nt=s(r(wt)),vt=s(Nt);{var Gt=$t=>{var Dt=Mt();R(()=>w(Dt,`(${E(e(J)),i(()=>e(J).material)??""})`)),c($t,Dt)};_(vt,$t=>{E(e(J)),i(()=>e(J).material)&&$t(Gt)})}l(wt);var Vt=s(wt,2),Qt=s(r(Vt),2);{var ta=$t=>{var Dt=Mt("Concentration,");c($t,Dt)};_(Qt,$t=>{E(e(J)),i(()=>e(J).concentration)&&$t(ta)})}var Bt=s(Qt,1,!0);l(Vt);var Rt=s(Vt,2),Ft=s(r(Rt));l(Rt);var zt=s(Rt,2);{var Yt=$t=>{var Dt=cl(),Kt=s(r(Dt));l(Dt),R(()=>w(Kt,` ${E(e(J)),i(()=>e(J).higherLevelSlot)??""}`)),c($t,Dt)};_(zt,$t=>{E(e(J)),i(()=>e(J).higherLevelSlot)&&$t(Yt)})}l(nt),R($t=>{w(Ct,` ${E(e(J)),i(()=>e(J).level)??""}`),w(Ut,` ${E(e(J)),i(()=>e(J).castingTime||e(J).actionType)??""}`),w(Lt,` ${E(e(J)),i(()=>e(J).range)??""}`),w(Nt,` ${$t??""}`),w(Bt,(E(e(J)),i(()=>e(J).duration))),w(Ft,` ${E(e(J)),i(()=>e(J).description)??""}`)},[()=>(E(e(J)),i(()=>e(J).components.join(", ")))]),c(Fe,nt)};_(Ve,Fe=>{e(le),e(v),i(()=>!e(le)[e(v).id])&&Fe(rt)})}l(se);var lt=s(se,2);{var gt=Fe=>{var nt=fl(),bt=r(nt),Ct=r(bt);Ce(Ct);var Ht=s(Ct),Ut=s(Ht);{var At=vt=>{var Gt=dl(),Vt=r(Gt);l(Gt),R(Qt=>w(Vt,`(Spell Save DC: ${Qt??""})`),[()=>(E(Pa),t(),d(),i(()=>Pa(t(),d())))]),c(vt,Gt)};_(Ut,vt=>{t(),i(()=>t().class)&&vt(At)})}var Lt=s(Ut,2);{var wt=vt=>{var Gt=ul();c(vt,Gt)},Nt=vt=>{var Gt=ot(),Vt=Ne(Gt);{var Qt=ta=>{var Bt=pl();c(ta,Bt)};_(Vt,ta=>{e(v),E(e(L)),i(()=>e(v).targetSucceededSave&&e(L).noDamageOnSave)&&ta(Qt)},!0)}c(vt,Gt)};_(Lt,vt=>{e(v),E(e(L)),i(()=>e(v).targetSucceededSave&&e(L).halfDamageOnSave)?vt(wt):vt(Nt,!1)})}l(bt),l(nt),R(vt=>w(Ht,` Target succeeded on ${vt??""} save `),[()=>(E(e(L)),i(()=>e(L).ability.charAt(0).toUpperCase()+e(L).ability.slice(1)))]),Fa(Ct,()=>e(v).targetSucceededSave,vt=>(e(v).targetSucceededSave=vt,jt(()=>(e(k),t(),f())))),c(Fe,nt)};_(lt,Fe=>{e(L)&&Fe(gt)})}var pt=s(lt,2);{var ft=Fe=>{const nt=ct(()=>(E(e(J)),i(()=>xe(e(J)))));var bt=ot(),Ct=Ne(bt);{var Ht=At=>{var Lt=_l(),wt=Ne(Lt),Nt=r(wt),vt=s(Nt,2);R(()=>{e(v),jt(()=>{e(nt)})}),yt(vt,5,()=>e(nt),St,(Bt,Rt)=>{var Ft=gl(),zt=r(Ft);l(Ft);var Yt={};R(()=>{w(zt,`Level ${e(Rt)??""}`),Yt!==(Yt=e(Rt))&&(Ft.value=(Ft.__value=e(Rt))??"")}),c(Bt,Ft)}),l(vt);var Gt=s(vt,2);{var Vt=Bt=>{const Rt=ct(()=>(e(v),E(e(J)),i(()=>me(e(v),e(J)))));var Ft=bl(),zt=r(Ft);{var Yt=Kt=>{var aa=Mt("Healing");c(Kt,aa)},$t=Kt=>{var aa=Mt("Damage");c(Kt,aa)};_(zt,Kt=>{E(e(J)),i(()=>de(e(J)))?Kt(Yt):Kt($t,!1)})}var Dt=s(zt);l(Ft),R(()=>w(Dt,` ${e(Rt)??""}`)),c(Bt,Ft)};_(Gt,Bt=>{e(v),E(e(J)),i(()=>e(v).castAtLevel&&e(v).castAtLevel>e(J).level)&&Bt(Vt)})}l(wt);var Qt=s(wt,2);{var ta=Bt=>{var Rt=ml(),Ft=r(Rt),zt=r(Ft);Ce(zt);var Yt=s(zt,2);{var $t=Dt=>{const Kt=ct(()=>(e(v),E(e(J)),i(()=>me(e(v),e(J)))));var aa=hl(),ls=r(aa);l(aa),R(()=>w(ls,`(+1d8, total: ${e(Kt)??""})`)),c(Dt,aa)};_(Yt,Dt=>{e(v),i(()=>e(v).targetIsFiendOrUndead)&&Dt($t)})}l(Ft),l(Rt),Fa(zt,()=>e(v).targetIsFiendOrUndead,Dt=>(e(v).targetIsFiendOrUndead=Dt,jt(()=>(e(k),t(),f())))),c(Bt,Rt)};_(Qt,Bt=>{E(e(J)),i(()=>e(J).description.includes("Fiend or an Undead"))&&Bt(ta)})}R(()=>{Je(Nt,"for",`castLevel-${e(v),i(()=>e(v).id)??""}`),Je(vt,"id",`castLevel-${e(v),i(()=>e(v).id)??""}`)}),Aa(vt,()=>e(v).castAtLevel,Bt=>(e(v).castAtLevel=Bt,jt(()=>(e(k),t(),f())))),c(At,Lt)},Ut=At=>{var Lt=yl();c(At,Lt)};_(Ct,At=>{E(e(nt)),i(()=>e(nt).length>0)?At(Ht):At(Ut,!1)})}c(Fe,bt)};_(pt,Fe=>{E(e(J)),i(()=>e(J).higherLevelSlot&&e(J).level>0)&&Fe(ft)})}R(()=>{Je(Ie,"aria-label",(e(le),e(v),i(()=>e(le)[e(v).id]?"Expand":"Collapse"))),w(ut,(e(le),e(v),i(()=>e(le)[e(v).id]?"â–¼":"â–²")))}),F("click",Ze,()=>he(e(v).id)),F("keydown",Ze,Fe=>Fe.key==="Enter"&&he(e(v).id)),c(U,$e)},u=U=>{var L=Sl();c(U,L)};_(xt,U=>{e(J)?U(_t):U(u,!1)})}c(it,dt)};_(V,it=>{e(Oe),i(()=>e(Oe).length===0)?it(Be):it(Re,!1)})}c(D,T)};_(Pe,D=>{e(v),i(()=>e(v).spellRef)&&D(Xe)})}var je=s(Pe,2);{var m=D=>{var T=xl(),V=r(T),Be=s(V,2);da(Be),l(T),R(()=>{Je(V,"for",`attack-notes-${e(v),i(()=>e(v).id)??""}`),Je(Be,"id",`attack-notes-${e(v),i(()=>e(v).id)??""}`)}),Ge(Be,()=>e(v).notes,Re=>(e(v).notes=Re,jt(()=>(e(k),t(),f())))),c(D,T)};_(je,D=>{e(v),i(()=>!e(v).spellRef)&&D(m)})}var G=s(je,2),fe=r(G);{var te=D=>{const T=ct(()=>(e(v),i(()=>q(e(v).spellRef))));var V=ot(),Be=Ne(V);{var Re=it=>{var J=ot(),dt=Ne(J);{var xt=u=>{var U=$l();F("click",U,()=>ue(e(v))),c(u,U)},_t=u=>{var U=ot(),L=Ne(U);{var $e=Ze=>{var Ie=ot(),ut=Ne(Ie);{var Ve=lt=>{var gt=Cl(),pt=r(gt),ft=r(pt),Fe=r(ft);Ce(Fe),Fe.value=Fe.__value="self",ia(),l(ft);var nt=s(ft,2),bt=r(nt);Ce(bt),bt.value=bt.__value="other",ia(),l(nt),l(pt);var Ct=s(pt,2),Ht=r(Ct);l(Ct),l(gt),R(()=>{Je(Fe,"name",`target-${e(v),i(()=>e(v).id)??""}`),Je(bt,"name",`target-${e(v),i(()=>e(v).id)??""}`),w(Ht,`Cast ${E(e(T)),i(()=>e(T).name)??""}`)}),Ua(z,[He],Fe,()=>e(N)[e(v).id],Ut=>sa(N,e(N)[e(v).id]=Ut)),Ua(z,[He],bt,()=>e(N)[e(v).id],Ut=>sa(N,e(N)[e(v).id]=Ut)),F("click",Ct,()=>b(e(v),e(N)[e(v).id])),c(lt,gt)},rt=lt=>{var gt=Ll();F("click",gt,()=>b(e(v),"self")),c(lt,gt)};_(ut,lt=>{E(e(T)),i(()=>ae(e(T).name))?lt(Ve):lt(rt,!1)})}c(Ze,Ie)},se=Ze=>{var Ie=ot(),ut=Ne(Ie);{var Ve=rt=>{var lt=wl(),gt=r(lt);{var pt=Fe=>{var nt=Mt("Roll Healing");c(Fe,nt)},ft=Fe=>{var nt=Mt("Roll Damage");c(Fe,nt)};_(gt,Fe=>{E(e(T)),i(()=>de(e(T)))?Fe(pt):Fe(ft,!1)})}l(lt),R(Fe=>mt(lt,1,`btn ${Fe??""}`),[()=>(E(e(T)),i(()=>de(e(T))?"btn-success":"btn-secondary"))]),F("click",lt,()=>ze(e(v))),c(rt,lt)};_(ut,rt=>{e(v),i(()=>e(v).damage&&e(v).damage.trim()!=="")&&rt(Ve)})}c(Ze,Ie)};_(L,Ze=>{E(Ka),E(e(T)),i(()=>Ka(e(T)))?Ze($e):Ze(se,!1)},!0)}c(u,U)};_(dt,u=>{E(wa),E(e(T)),i(()=>wa(e(T)))?u(xt):u(_t,!1)})}c(it,J)};_(Be,it=>{e(T)&&it(Re)})}c(D,V)},be=D=>{var T=ot(),V=Ne(T);{var Be=Re=>{var it=jl(),J=Ne(it),dt=s(J,2);{var xt=_t=>{var u=Dl();F("click",u,()=>ze(e(v))),c(_t,u)};_(dt,_t=>{e(v),i(()=>e(v).damage&&e(v).damage.trim()!=="")&&_t(xt)})}F("click",J,()=>ue(e(v))),c(Re,it)};_(V,Re=>{e(v),i(()=>!e(v).spellRef)&&Re(Be)},!0)}c(D,T)};_(fe,D=>{e(v),e(H),i(()=>e(v).spellRef&&e(H))?D(te):D(be,!1)})}l(G),l(pe),R(()=>{Je(ee,"for",`attack-type-${e(v),i(()=>e(v).id)??""}`),Je(ve,"id",`attack-type-${e(v),i(()=>e(v).id)??""}`)}),Ge(ve,()=>e(v).damageType,D=>(e(v).damageType=D,jt(()=>(e(k),t(),f())))),c(W,pe)});var Le=s(_e,2);{var at=W=>{var v=Al();c(W,v)},ke=W=>{var v=ot(),He=Ne(v);{var pe=ge=>{var B=Fl();c(ge,B)};_(He,ge=>{e(k),i(()=>e(k).length===0)&&ge(pe)},!0)}c(W,v)};_(Le,W=>{t(),i(()=>t().attacks.length===0)?W(at):W(ke,!1)})}l(O);var qe=s(O,2),A=s(r(qe),4),C=s(A,2);{var ne=W=>{var v=Rl();yt(v,5,()=>(t(),i(()=>t().activeStates)),St,(He,pe,ge)=>{var B=Pl(),we=r(B),Ae=r(we);Ce(Ae);var Ke=s(Ae,2);{var st=be=>{var D=Ml();F("click",D,()=>re(ge)),c(be,D)};_(Ke,be=>{y()&&be(st)})}l(we);var De=s(we,2),I=r(De),X=r(I);Je(X,"for",`state-attack-bonus-${ge}`);var Se=s(X,2);Ce(Se),Je(Se,"id",`state-attack-bonus-${ge}`),l(I);var Ue=s(I,2),We=r(Ue);Je(We,"for",`state-damage-bonus-${ge}`);var ee=s(We,2);Ce(ee),Je(ee,"id",`state-damage-bonus-${ge}`),l(Ue);var ve=s(Ue,2),Pe=r(ve);Je(Pe,"for",`state-target-${ge}`);var Xe=s(Pe,2);R(()=>{e(pe),jt(()=>{})}),Je(Xe,"id",`state-target-${ge}`);var je=r(Xe);je.value=je.__value="self";var m=s(je);m.value=m.__value="other",l(Xe),l(ve),l(De);var G=s(De,2),fe=r(G);Je(fe,"for",`state-desc-${ge}`);var te=s(fe,2);Ce(te),Je(te,"id",`state-desc-${ge}`),l(G),l(B),Ge(Ae,()=>e(pe).name,be=>(e(pe).name=be,jt(()=>t()),ca(x,"$character"))),Ge(Se,()=>e(pe).attackBonus,be=>(e(pe).attackBonus=be,jt(()=>t()),ca(x,"$character"))),Ge(ee,()=>e(pe).damageBonus,be=>(e(pe).damageBonus=be,jt(()=>t()),ca(x,"$character"))),Aa(Xe,()=>e(pe).target,be=>(e(pe).target=be,jt(()=>t()),ca(x,"$character"))),Ge(te,()=>e(pe).description,be=>(e(pe).description=be,jt(()=>t()),ca(x,"$character"))),c(He,B)}),l(v),c(W,v)},oe=W=>{var v=Il();c(W,v)};_(C,W=>{t(),i(()=>t().activeStates&&t().activeStates.length>0)?W(ne):W(oe,!1)})}l(qe),F("click",A,S),c(g,M)};_(Ye,g=>{h(),i(()=>!h().attacks)&&g(Te)})}l(j),R(()=>Y=mt(j,1,"attacks svelte-14o91c5",null,Y,{hidden:!e(Q)})),c(a,j),Et(),$()}var Ul=p('<span class="slot-checkbox-x svelte-serp1j">&#8212;</span>'),Nl=p('<label><input type="checkbox" class="slot-checkbox-input svelte-serp1j"/> <span><!></span></label>');function Va(a,n){Tt(n,!1);const t=()=>tt(Zt,"$isEditMode",d),[d,f]=Wt();let h=kt(n,"checked",8,!1),y=kt(n,"disabled",8,!1),x=kt(n,"className",8,""),$=kt(n,"index",8,void 0),k=kt(n,"ariaLabel",8,void 0);const Q=la();function z(ae){Q("change",{checked:ae.currentTarget.checked,index:$()})}It();var ce=Nl(),le=r(ce);Ce(le);var N=s(le,2),he=r(N);{var de=ae=>{var Me=Ul();c(ae,Me)};_(he,ae=>{h()&&ae(de)})}l(N),l(ce),R(()=>{mt(ce,1,"slot-checkbox-label "+x()+(t()?"":" not-editable"),"svelte-serp1j"),ts(le,h()),le.disabled=y()||!t(),Je(le,"aria-label",k()),Je(le,"tabindex",t()?0:-1),mt(N,1,`slot-checkbox-custom ${h()?"used":""} ${t()?"":"readonly"}`,"svelte-serp1j")}),F("change",le,z),c(a,ce),Et(),f()}var Gl=p('<p class="no-features svelte-1kpvv0n">Select a class to see available features</p>'),Ol=p('<p class="no-features svelte-1kpvv0n">No class features available at this level</p>'),ql=p('<div class="spell-slots svelte-1kpvv0n"><label class="svelte-1kpvv0n"> </label> <div class="slots-tracker svelte-1kpvv0n"></div></div>'),Wl=p('<div class="all-spell-slots"></div>'),zl=p('<div class="feature-box spellcasting svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"> </h3> <div class="spell-stats svelte-1kpvv0n"><div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Spell Save DC</label> <div class="spell-value svelte-1kpvv0n"> </div></div> <div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <div class="spell-value svelte-1kpvv0n"> </div></div></div> <!> <div class="prepared-spells svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <textarea placeholder="List your prepared spells..." class="svelte-1kpvv0n"></textarea></div></div>'),Kl=p('<p class="unlimited svelte-1kpvv0n">Unlimited Uses</p>'),Vl=p('<div class="slots-tracker svelte-1kpvv0n"></div> <div class="uses-actions-row"><button class="btn btn-primary use-enabled"> </button></div> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div>',1),Jl=p('<div class="uses-tracker svelte-1kpvv0n"><!></div>'),Ql=p('<div class="pool-tracker svelte-1kpvv0n"><input type="number" min="0" class="pool-input svelte-1kpvv0n"/> <span> </span> <button class="btn-small svelte-1kpvv0n"> </button></div>'),Yl=p('<p class="no-uses svelte-1kpvv0n">No Channel Divinity uses remaining</p>'),Xl=p('<div class="channel-divinity-option svelte-1kpvv0n"><button class="btn btn-primary use-enabled svelte-1kpvv0n">Use Channel Divinity</button> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div> <!></div>'),Zl=p('<div class="feature-box svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"><!> </h3> <p class="feature-description svelte-1kpvv0n"> </p> <!></div>'),er=p('<div class="features-grid svelte-1kpvv0n"><!> <!></div>'),tr=p("<section><!> <!></section>");function ar(a,n){Tt(n,!1);const t=()=>tt(ie,"$character",y),d=()=>tt(ga,"$abilityModifiers",y),f=()=>tt(ea,"$searchFilter",y),h=()=>tt(Pt,"$collapsedStates",y),[y,x]=Wt(),$=P(),k=P(),Q=P(),z=P(),ce=P(),le=P(),N=P();let he=P(0),de=P(0);function ae(b,j){ie.update(Y=>(Y.classFeatures.features[b]=j,Y))}function Me(){ie.update(b=>(b.classFeatures.spellSlotsByLevel||(b.classFeatures.spellSlotsByLevel={}),e(z).forEach(({level:j,slots:Y})=>{b.classFeatures.spellSlotsByLevel[j]||(b.classFeatures.spellSlotsByLevel[j]=Array(Y).fill(!1))}),b))}function Qe(b){if(typeof b.maxUses=="function"){if((b.name==="Divine Sense"||b.name==="War Priest")&&e($)?.spellcastingAbility){const j=d()[e($).spellcastingAbility];return b.maxUses(t().level,j)}return b.maxUses(t().level)}return b.maxUses||0}function ue(b,j){ie.update(Y=>((!Y.classFeatures.features[b]||!Array.isArray(Y.classFeatures.features[b])||Y.classFeatures.features[b].length!==j)&&(Y.classFeatures.features[b]=Array(j).fill(!1)),Y))}rs(()=>{e(le)&&t()&&t().classFeatures&&t().classFeatures.features&&e(le).forEach(b=>{if(b.type==="uses"){const j=b.name.replace(/\s+/g,""),Y=Qe(b),Ee=t().classFeatures.features[j];(!Array.isArray(Ee)||Ee.length!==Y)&&ue(j,Y)}})});function ze(b){return typeof b.maxPool=="function"?b.maxPool(t().level):b.maxPool||0}function Oe(b){return typeof b.description=="function"?b.description(t().level):b.description}function H(){const b="ChannelDivinity";ie.update(j=>{const Y=j.classFeatures.features[b];return typeof Y=="number"&&Y>0&&(j.classFeatures.features[b]=Y-1),j})}function q(){Pt.update(b=>({...b,classFeatures:!b.classFeatures}))}et(()=>(t(),qt),()=>{o($,t().class?qt(t().class):null)}),et(()=>(t(),oa),()=>{o(k,t().class?oa(t().class,t().level,t().subclass):[])}),et(()=>(t(),Oa),()=>{o(Q,t().class?Oa(t().class,t().level):0)}),et(()=>(e($),t()),()=>{o(z,(()=>{if(!e($)?.spellcaster)return[];const b=t().level,j=[];return b>=1&&j.push({level:1,slots:Math.min(4,2+Math.floor(b/3))}),b>=3&&j.push({level:2,slots:Math.min(3,2+Math.floor((b-3)/4))}),b>=5&&j.push({level:3,slots:Math.min(3,2+Math.floor((b-5)/5))}),b>=7&&j.push({level:4,slots:Math.min(3,1+Math.floor((b-7)/6))}),b>=9&&j.push({level:5,slots:Math.min(2,1+Math.floor((b-9)/8))}),b>=11&&j.push({level:6,slots:1}),b>=13&&j.push({level:7,slots:1}),b>=15&&j.push({level:8,slots:1}),b>=17&&j.push({level:9,slots:1}),j})())}),et(()=>(e($),d(),t(),qa),()=>{if(e($)?.spellcaster&&e($).spellcastingAbility){const b=d()[e($).spellcastingAbility];o(he,ws(t().class,b,t().proficiencyBonus)||0),o(de,qa(t().class,t().level,b))}}),et(()=>(t(),e($),e(z)),()=>{t().class&&e($)?.spellcaster&&e(z).length>0&&Me()}),et(()=>t(),()=>{o(ce,(()=>{const j=t().classFeatures.features["ChannelDivinity"];return typeof j=="number"?j:0})())}),et(()=>(e(k),f()),()=>{o(le,e(k).filter(b=>{if(!f())return!0;const j=f().toLowerCase();return b.name.toLowerCase().includes(j)||Oe(b).toLowerCase().includes(j)}))}),et(()=>(f(),t(),e(le)),()=>{o(N,!f()||t().class||"class features".includes(f().toLowerCase())||"spellcasting".includes(f().toLowerCase())||e(le).length>0)}),Jt(),It();var ye=tr();let me;var xe=r(ye);{let b=ct(()=>(h(),i(()=>h().classFeatures?"Expand":"Collapse")));ra(xe,{title:"Class Features",get collapsed(){return h(),i(()=>h().classFeatures)},get ariaLabel(){return e(b)},onToggle:q})}var S=s(xe,2);{var re=b=>{var j=ot(),Y=Ne(j);{var Ee=Te=>{var g=Gl();c(Te,g)},Ye=Te=>{var g=ot(),M=Ne(g);{var K=O=>{var _e=Ol();c(O,_e)},Z=O=>{var _e=er(),Le=r(_e);{var at=qe=>{var A=zl(),C=r(A),ne=r(C);l(C);var oe=s(C,2),W=r(oe),v=s(r(W),2),He=r(v,!0);l(v),l(W);var pe=s(W,2),ge=s(r(pe),2),B=r(ge,!0);l(ge),l(pe),l(oe);var we=s(oe,2);{var Ae=De=>{var I=Wl();yt(I,5,()=>e(z),St,(X,Se)=>{let Ue=()=>e(Se).level,We=()=>e(Se).slots;const ee=ct(()=>(t(),Ue(),We(),i(()=>t().classFeatures.spellSlotsByLevel?.[Ue()]||Array(We()).fill(!1))));var ve=ql(),Pe=r(ve),Xe=r(Pe);l(Pe);var je=s(Pe,2);yt(je,5,()=>e(ee),St,(m,G,fe)=>{{let te=ct(()=>(E(e(ee)),i(()=>e(ee)[fe]||!1)));Va(m,{get checked(){return e(te)},$$events:{change:be=>{ie.update(D=>(D.classFeatures.spellSlotsByLevel||(D.classFeatures.spellSlotsByLevel={}),D.classFeatures.spellSlotsByLevel[Ue()]||(D.classFeatures.spellSlotsByLevel[Ue()]=Array(We()).fill(!1)),D.classFeatures.spellSlotsByLevel[Ue()][fe]=be.detail.checked,D))}}})}}),l(je),l(ve),R(()=>w(Xe,`${Ue()===1?"1st":Ue()===2?"2nd":Ue()===3?"3rd":`${Ue()}th`} Level Spell Slots`)),c(X,ve)}),l(I),c(De,I)};_(we,De=>{e(z),i(()=>e(z).length>0)&&De(Ae)})}var Ke=s(we,2),st=s(r(Ke),2);da(st),l(Ke),l(A),R(De=>{w(ne,`Spellcasting (${De??""})`),w(He,e(he)),w(B,e(de))},[()=>(e($),i(()=>e($).spellcastingAbility?.toUpperCase()))]),Ge(st,()=>t().classFeatures.preparedSpells,De=>ht(ie,i(t).classFeatures.preparedSpells=De,i(t))),c(qe,A)};_(Le,qe=>{e($),i(()=>e($)?.spellcaster)&&qe(at)})}var ke=s(Le,2);yt(ke,1,()=>e(le),St,(qe,A)=>{const C=ct(()=>(e(A),i(()=>e(A).name.replace(/\s+/g,"")))),ne=ct(()=>(t(),E(e(C)),i(()=>t().classFeatures.features[e(C)]))),oe=ct(()=>typeof e(ne)=="number");var W=Zl(),v=r(W),He=r(v);{var pe=De=>{var I=Mt("Channel Divinity:");c(De,I)};_(He,De=>{e(A),i(()=>e(A).type==="channelDivinity")&&De(pe)})}var ge=s(He);l(v);var B=s(v,2),we=r(B,!0);l(B);var Ae=s(B,2);{var Ke=De=>{const I=ct(()=>(e(A),i(()=>Qe(e(A))))),X=ct(()=>(E(e(ne)),E(e(I)),i(()=>Array.isArray(e(ne))?e(ne):Array(e(I)).fill(!1))));var Se=Jl(),Ue=r(Se);{var We=ve=>{var Pe=Kl();c(ve,Pe)},ee=ve=>{var Pe=Vl(),Xe=Ne(Pe);yt(Xe,5,()=>e(X),St,(D,T,V)=>{Va(D,{get checked(){return e(T)},index:V,$$events:{change:Be=>{ie.update(Re=>(Re.classFeatures.features[e(C)]||(Re.classFeatures.features[e(C)]=Array(e(I)).fill(!1)),Re.classFeatures.features[e(C)][V]=Be.detail.checked,Re))}}})}),l(Xe);var je=s(Xe,2),m=r(je),G=r(m);l(m),l(je);var fe=s(je,2),te=r(fe),be=r(te);l(te),l(fe),R(D=>{m.disabled=D,w(G,`Use ${e(A),i(()=>e(A).name)??""}`),w(be,`Resets on ${e(A),i(()=>e(A).resetOn==="short"?"Short Rest":"Long Rest")??""}`)},[()=>(E(e(X)),i(()=>e(X).filter(D=>!D).length<=0))]),F("click",m,()=>{ie.update(D=>{D.classFeatures.features[e(C)]||(D.classFeatures.features[e(C)]=Array(e(I)).fill(!1));const T=D.classFeatures.features[e(C)],V=T.findIndex(Be=>!Be);return V!==-1&&(T[V]=!0),D})}),c(ve,Pe)};_(Ue,ve=>{e(I)===1/0?ve(We):ve(ee,!1)})}l(Se),c(De,Se)},st=De=>{var I=ot(),X=Ne(I);{var Se=We=>{const ee=ct(()=>(e(A),i(()=>ze(e(A)))));var ve=Ql(),Pe=r(ve);Ce(Pe);var Xe=s(Pe,2),je=r(Xe);l(Xe);var m=s(Xe,2),G=r(m,!0);l(m),l(ve),R(()=>{ka(Pe,e(oe)&&e(ne)!==void 0?e(ne):e(ee)),Je(Pe,"max",e(ee)),w(je,`/ ${e(ee)??""}`),w(G,(e(A),i(()=>e(A).resetOn==="short"?"Short Rest":"Long Rest")))}),F("input",Pe,fe=>{ie.update(te=>(te.classFeatures.features[e(C)]=parseInt(fe.currentTarget.value)||0,te))}),F("click",m,()=>ae(e(C),e(ee))),c(We,ve)},Ue=We=>{var ee=ot(),ve=Ne(ee);{var Pe=Xe=>{var je=Xl(),m=r(je),G=s(m,2),fe=r(G),te=r(fe);l(fe),l(G);var be=s(G,2);{var D=T=>{var V=Yl();c(T,V)};_(be,T=>{e(ce)<=0&&T(D)})}l(je),R(()=>{m.disabled=e(ce)<=0,w(te,`Resets on ${e(A),i(()=>e(A).resetOn==="short"?"Short Rest":"Long Rest")??""}`)}),F("click",m,H),c(Xe,je)};_(ve,Xe=>{e(A),i(()=>e(A).type==="channelDivinity")&&Xe(Pe)},!0)}c(We,ee)};_(X,We=>{e(A),i(()=>e(A).type==="pool")?We(Se):We(Ue,!1)},!0)}c(De,I)};_(Ae,De=>{e(A),i(()=>e(A).type==="uses")?De(Ke):De(st,!1)})}l(W),R(De=>{w(ge,` ${e(A),i(()=>e(A).name)??""}`),w(we,De)},[()=>(e(A),i(()=>Oe(e(A))))]),c(qe,W)}),l(_e),c(O,_e)};_(M,O=>{e(k),i(()=>e(k).length===0)?O(K):O(Z,!1)},!0)}c(Te,g)};_(Y,Te=>{t(),i(()=>!t().class)?Te(Ee):Te(Ye,!1)})}c(b,j)};_(S,b=>{h(),i(()=>!h().classFeatures)&&b(re)})}l(ye),R(()=>me=mt(ye,1,"class-features svelte-1kpvv0n",null,me,{hidden:!e(N)})),c(a,ye),Et(),x()}var sr=p('<textarea placeholder="Enter features, traits, and special abilities..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Equipment</h3> <textarea placeholder="List your equipment and inventory..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Notes</h3> <textarea placeholder="Additional notes..." class="svelte-wttn0l"></textarea>',1),lr=p("<section><!> <!></section>");function rr(a,n){Tt(n,!1);const t=()=>tt(ea,"$searchFilter",h),d=()=>tt(ie,"$character",h),f=()=>tt(Pt,"$collapsedStates",h),[h,y]=Wt(),x=P();function $(){Pt.update(N=>({...N,notes:!N.notes}))}et(()=>(t(),d()),()=>{o(x,!t()||"features".includes(t().toLowerCase())||"traits".includes(t().toLowerCase())||"equipment".includes(t().toLowerCase())||"notes".includes(t().toLowerCase())||d().features.toLowerCase().includes(t().toLowerCase())||d().equipment.toLowerCase().includes(t().toLowerCase())||d().notes.toLowerCase().includes(t().toLowerCase()))}),Jt(),It();var k=lr();let Q;var z=r(k);{let N=ct(()=>(f(),i(()=>f().notes?"Expand":"Collapse")));ra(z,{title:"Features & Traits",get collapsed(){return f(),i(()=>f().notes)},get ariaLabel(){return e(N)},onToggle:$})}var ce=s(z,2);{var le=N=>{var he=sr(),de=Ne(he);da(de);var ae=s(de,4);da(ae);var Me=s(ae,4);da(Me),Ge(de,()=>d().features,Qe=>ht(ie,i(d).features=Qe,i(d))),Ge(ae,()=>d().equipment,Qe=>ht(ie,i(d).equipment=Qe,i(d))),Ge(Me,()=>d().notes,Qe=>ht(ie,i(d).notes=Qe,i(d))),c(N,he)};_(ce,N=>{f(),i(()=>!f().notes)&&N(le)})}l(k),R(()=>Q=mt(k,1,"notes svelte-wttn0l",null,Q,{hidden:!e(x)})),c(a,k),Et(),y()}var ir=p('<div class="color-picker-section svelte-1r90jgp"><h3 class="svelte-1r90jgp">Dice Colors</h3> <div class="color-inputs svelte-1r90jgp"><div class="color-input-group svelte-1r90jgp"><label for="dice-color" class="svelte-1r90jgp">Dice Color</label> <input type="color" id="dice-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="label-color" class="svelte-1r90jgp">Label Color</label> <input type="color" id="label-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="desk-color" class="svelte-1r90jgp">Background Color</label> <input type="color" id="desk-color" class="svelte-1r90jgp"/></div></div></div>'),nr=p('<div class="loading svelte-1r90jgp"><p class="svelte-1r90jgp">Loading 3D dice...</p></div>'),or=p('<div class="custom-dice-selector svelte-1r90jgp"><h3 class="svelte-1r90jgp">Choose Dice to Roll</h3> <div class="dice-inputs svelte-1r90jgp"><div class="dice-input-group svelte-1r90jgp"><label for="d4" class="svelte-1r90jgp">d4</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d4" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d6" class="svelte-1r90jgp">d6</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d6" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d8" class="svelte-1r90jgp">d8</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d8" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d10" class="svelte-1r90jgp">d10</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d10" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d12" class="svelte-1r90jgp">d12</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d12" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d20" class="svelte-1r90jgp">d20</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d20" min="0" max="10"/></div></div> <div class="dice-controls svelte-1r90jgp"><button class="btn btn-primary use-enabled svelte-1r90jgp"> </button> <button class="btn btn-secondary use-enabled svelte-1r90jgp">Reset</button></div></div>'),cr=p('<span class="crit-badge svelte-1r90jgp">CRITICAL HIT!</span>'),vr=p('<span class="crit-badge crit-fail svelte-1r90jgp">CRITICAL MISS!</span>'),dr=p('<div class="bonus-item svelte-1r90jgp"><span class="bonus-value svelte-1r90jgp"> </span> <span class="bonus-source svelte-1r90jgp"> </span></div>'),ur=p('<div class="bonus-breakdown svelte-1r90jgp"></div>'),pr=p('<p class="modifier-text svelte-1r90jgp"> </p>'),fr=p('<div class="svelte-1r90jgp"><em class="svelte-1r90jgp">No damage is dealt on a critical miss.</em></div>'),gr=p('<button class="btn btn-follow-up svelte-1r90jgp"> </button>'),br=p('<button class="btn btn-guided-strike svelte-1r90jgp">âš¡ Use Guided Strike (+10)</button>'),hr=p('<div class="follow-up-actions svelte-1r90jgp"><!> <!></div>'),mr=p('<div class="result-header svelte-1r90jgp"><h3 class="svelte-1r90jgp"> </h3> <!> <!></div> <div class="result-total svelte-1r90jgp"> </div> <div class="result-details svelte-1r90jgp"><!></div> <!> <!>',1),_r=p('<div role="button" tabindex="-1"><div class="modal-content svelte-1r90jgp" role="dialog" tabindex="0"><div class="modal-header svelte-1r90jgp"><h2 class="svelte-1r90jgp">Dice Roller</h2> <div class="header-buttons svelte-1r90jgp"><button class="color-btn svelte-1r90jgp" title="Customize dice colors">ðŸŽ¨</button> <button class="close-btn svelte-1r90jgp">Ã—</button></div></div> <!> <!> <div class="dice-main-area svelte-1r90jgp"><div class="dice-container svelte-1r90jgp"></div> <!></div> <div><!></div></div></div>');function yr(a,n){Tt(n,!1);const t=()=>tt(ie,"$character",d),[d,f]=Wt(),h=P(),y=P(),x=P(),$=la();let k=kt(n,"notation",12,""),Q=kt(n,"visible",8,!1),z=kt(n,"damageNotation",12,""),ce=kt(n,"attackName",12,""),le=kt(n,"applyHalfDamage",8,!1),N=kt(n,"bonusBreakdown",28,()=>[]),he=kt(n,"rollType",12,"other"),de=null,ae=P(void 0),Me=P(!1),Qe=P(""),ue=P(null);function ze(){return e(ue)?.resultTotal??null}function Oe(m,G,fe){const te=[];if(!m||!m.result)return te;const be=G.match(/([+-]?\d*d\d+|[+-]?\d+)/g)||[];let D=0;const T=new Set;for(const V of be){const Be=V.trim();if(!Be)continue;const Re=Be.match(/([+-]?)(\d*)d(\d+)/);if(Re){const it=parseInt(Re[2]||"1"),J=`${it}d${Re[3]}`,dt=fe.findIndex((u,U)=>!T.has(U)&&typeof u.value=="string"&&u.value===J),xt=[];for(let u=0;u<it&&D<m.result.length;u++)xt.push(m.result[D++]);const _t=dt>=0?fe[dt].source:"base die";dt>=0&&T.add(dt);for(const u of xt)te.push({display:`${u}`,source:_t})}}for(let V=0;V<fe.length;V++)if(!T.has(V)&&typeof fe[V].value=="number"){const Be=fe[V].value;te.push({display:Be>=0?`+${Be}`:`${Be}`,source:fe[V].source})}return te}let H=P(0),q=P(0),ye=P(0),me=P(0),xe=P(0),S=P(0),re=P(0),b=P([]),j=P(!1),Y=P(!1),Ee=P(!1),Ye=P("#051e0a"),Te=P("#ffffff"),g=P("#3a2004"),M=P(!1);function K(m){return m.length===9&&m.startsWith("#")?m.substring(0,7):m}function Z(m,G="ff"){return m.length===7&&m.startsWith("#")?m+G:m}function O(){if(window.DICE&&e(ae))try{de&&e(ae)&&sa(ae,e(ae).innerHTML="");const m=e(ae).clientWidth||500,G=e(ae).clientHeight||300;de=new window.DICE.dice_box(e(ae),{w:m,h:G}),o(Me,!0)}catch(m){console.error("Error initializing dice box:",m)}}pa(()=>{const m=te=>new Promise((be,D)=>{if(document.querySelector(`script[src="${te}"]`)){be(null);return}const V=document.createElement("script");V.src=te,V.onload=()=>{be(null)},V.onerror=()=>{console.error(`Failed to load: ${te}`),D(new Error(`Failed to load ${te}`))},document.head.appendChild(V)});setTimeout(()=>{m(`${va}/libs/three.min.js`).then(()=>m(`${va}/libs/cannon.min.js`)).then(()=>m(`${va}/libs/teal.js`)).then(()=>m(`${va}/dice.js`)).then(()=>{if(window.DICE){const te=window.DICE.getColors();o(Ye,K(te.dice_color)),o(Te,K(te.label_color)),o(g,K(te.desk_color))}O()}).catch(te=>{console.error("Failed to load dice libraries:",te)})},100);const G=()=>{e(Me)&&O()},fe=te=>{Q()&&te.key==="Escape"&&oe()};return window.addEventListener("resize",G),window.addEventListener("keydown",fe),()=>{window.removeEventListener("resize",G),window.removeEventListener("keydown",fe)}});function _e(m,G="other"){if(!de||!e(Me))return;o(ue,null),o(b,[]),o(j,!1),o(Y,!1),G==="damage"&&N([]),he(G),o(Ee,!1),de.diceToRoll=m;const fe=be=>null,te=be=>{let D=be.resultTotal,T=be.resultString;if(le()&&(D=Math.floor(D/2),T=T+" (halved)"),o(ue,{...be,resultTotal:D,resultString:T}),console.log("Final roll result:",e(ue)),console.log({type:G}),G==="attack"&&be.result&&be.result.length>0){const V=be.result[0];o(j,V===20),o(Y,V===1)}if(o(b,[]),console.log("Setting up follow-up actions. Type:",G,"damageNotation:",z(),"isCriticalSuccess:",e(j),"isCriticalFail:",e(Y)),G==="attack"&&z())if(e(j)){const V=ke(z());e(b).push({label:`Roll Critical Damage (${V})`,notation:V})}else e(Y)||e(b).push({label:`Roll Damage (${z()})`,notation:z()})};de.start_throw(fe,te)}function Le(){const m=[];e(H)>0&&m.push(`${e(H)}d4`),e(q)>0&&m.push(`${e(q)}d6`),e(ye)>0&&m.push(`${e(ye)}d8`),e(me)>0&&m.push(`${e(me)}d10`),e(xe)>0&&m.push(`${e(xe)}d12`),e(S)>0&&m.push(`${e(S)}d20`);let G=m.join("+")||"1d20";return e(re)!==0&&(G+=e(re)>=0?`+${e(re)}`:`${e(re)}`),G}function at(){const m=Le();_e(m)}function ke(m){return m.replace(/(\d+)d(\d+)/g,(G,fe,te)=>`${parseInt(fe)*2}d${te}`)}function qe(){o(H,0),o(q,0),o(ye,0),o(me,0),o(xe,0),o(S,0),o(re,0),o(ue,null),o(b,[]),o(j,!1),o(Y,!1),he("other"),o(Ee,!1)}function A(){window.DICE&&(window.DICE.setColors({dice_color:Z(e(Ye),"ff"),label_color:Z(e(Te),"ff"),desk_color:e(g)}),de&&(de.updateDeskColor(e(g)),de.updateDiceColors()))}function C(){o(M,!e(M))}function ne(){!e(ue)||e(y)<=0||e(Ee)||(o(ue,{...e(ue),resultTotal:e(ue).resultTotal+10,resultString:e(ue).resultString+" + 10 (Guided Strike)"}),ie.update(m=>{const G="ChannelDivinity",fe=m.classFeatures.features[G];return typeof fe=="number"&&fe>0&&(m.classFeatures.features[G]=fe-1),m}),o(Ee,!0))}function oe(){$("close"),k(""),z(""),ce(""),o(Qe,""),o(ue,null),o(Ee,!1),o(j,!1),o(Y,!1),qe()}et(()=>(t(),oa),()=>{o(h,t().class?oa(t().class,t().level,t().subclass).some(G=>G.name==="Guided Strike"):!1)}),et(()=>t(),()=>{o(y,(()=>{const G=t().classFeatures.features["ChannelDivinity"];return typeof G=="number"?G:0})())}),et(()=>(e(H),e(q),e(ye),e(me),e(xe),e(S),e(re)),()=>{o(x,(()=>{const m=[];e(H)>0&&m.push(`${e(H)}d4`),e(q)>0&&m.push(`${e(q)}d6`),e(ye)>0&&m.push(`${e(ye)}d8`),e(me)>0&&m.push(`${e(me)}d10`),e(xe)>0&&m.push(`${e(xe)}d12`),e(S)>0&&m.push(`${e(S)}d20`);let G=m.join("+")||"1d20";return e(re)!==0&&(G+=e(re)>=0?`+${e(re)}`:`${e(re)}`),G})())}),et(()=>(E(k()),e(Me),E(Q()),e(Qe),E(z()),E(ce()),E(he())),()=>{k()&&e(Me)&&Q()&&k()!==e(Qe)&&(o(Qe,k()),o(ue,null),o(b,[]),o(j,!1),o(Y,!1),o(Ee,!1),console.log("Auto-roll triggered. notation:",k(),"damageNotation:",z(),"attackName:",ce(),"rollType:",he()),setTimeout(()=>_e(k(),he()),200))}),Jt();var W={getLastRollTotal:ze};It();var v=_r();let He;var pe=r(v),ge=r(pe),B=s(r(ge),2),we=r(B),Ae=s(we,2);l(B),l(ge);var Ke=s(ge,2);{var st=m=>{var G=ir(),fe=s(r(G),2),te=r(fe),be=s(r(te),2);Ce(be),l(te);var D=s(te,2),T=s(r(D),2);Ce(T),l(D);var V=s(D,2),Be=s(r(V),2);Ce(Be),l(V),l(fe),l(G),Ge(be,()=>e(Ye),Re=>o(Ye,Re)),F("change",be,A),Ge(T,()=>e(Te),Re=>o(Te,Re)),F("change",T,A),Ge(Be,()=>e(g),Re=>o(g,Re)),F("change",Be,A),c(m,G)};_(Ke,m=>{e(M)&&m(st)})}var De=s(Ke,2);{var I=m=>{var G=nr();c(m,G)};_(De,m=>{e(Me)||m(I)})}var X=s(De,2),Se=r(X);ja(Se,m=>o(ae,m),()=>e(ae));var Ue=s(Se,2);{var We=m=>{var G=or(),fe=s(r(G),2),te=r(fe),be=s(r(te),2);Ce(be),l(te);var D=s(te,2),T=s(r(D),2);Ce(T),l(D);var V=s(D,2),Be=s(r(V),2);Ce(Be),l(V);var Re=s(V,2),it=s(r(Re),2);Ce(it),l(Re);var J=s(Re,2),dt=s(r(J),2);Ce(dt),l(J);var xt=s(J,2),_t=s(r(xt),2);Ce(_t),l(xt),l(fe);var u=s(fe,2),U=r(u),L=r(U);l(U);var $e=s(U,2);l(u),l(G),R(()=>{U.disabled=!e(Me),w(L,`Roll ${e(x)??""}`)}),Ge(be,()=>e(H),se=>o(H,se)),Ge(T,()=>e(q),se=>o(q,se)),Ge(Be,()=>e(ye),se=>o(ye,se)),Ge(it,()=>e(me),se=>o(me,se)),Ge(dt,()=>e(xe),se=>o(xe,se)),Ge(_t,()=>e(S),se=>o(S,se)),F("click",U,at),F("click",$e,qe),c(m,G)};_(Ue,m=>{k()||m(We)})}l(X);var ee=s(X,2);let ve;var Pe=r(ee);{var Xe=m=>{var G=mr(),fe=Ne(G),te=r(fe),be=r(te,!0);l(te);var D=s(te,2);{var T=$e=>{var se=cr();c($e,se)};_(D,$e=>{e(j)&&$e(T)})}var V=s(D,2);{var Be=$e=>{var se=vr();c($e,se)};_(V,$e=>{e(Y)&&$e(Be)})}l(fe);var Re=s(fe,2),it=r(Re,!0);l(Re);var J=s(Re,2),dt=r(J);{var xt=$e=>{var se=ot(),Ze=Ne(se);{var Ie=Ve=>{var rt=ur();yt(rt,5,()=>(e(ue),E(k()),E(N()),i(()=>Oe(e(ue),k(),N()))),St,(lt,gt)=>{var pt=dr(),ft=r(pt),Fe=r(ft,!0);l(ft);var nt=s(ft,2),bt=r(nt);l(nt),l(pt),R(()=>{w(Fe,(e(gt),i(()=>e(gt).display))),w(bt,`(${e(gt),i(()=>e(gt).source)??""})`)}),c(lt,pt)}),l(rt),c(Ve,rt)},ut=Ve=>{var rt=ot(),lt=Ne(rt);{var gt=pt=>{var ft=pr(),Fe=r(ft);l(ft),R(()=>w(Fe,`Modifier: ${e(ue),i(()=>e(ue).constant>=0?"+":"")??""}${e(ue),i(()=>e(ue).constant)??""}`)),c(pt,ft)};_(lt,pt=>{e(ue),i(()=>e(ue).constant)&&pt(gt)},!0)}c(Ve,rt)};_(Ze,Ve=>{E(N()),i(()=>N().length>0)?Ve(Ie):Ve(ut,!1)})}c($e,se)};_(dt,$e=>{e(ue),E(N()),i(()=>e(ue).constant||N().length>0)&&$e(xt)})}l(J);var _t=s(J,2);{var u=$e=>{var se=fr();c($e,se)};_(_t,$e=>{e(Y)&&$e(u)})}var U=s(_t,2);{var L=$e=>{var se=hr(),Ze=r(se);yt(Ze,1,()=>e(b),St,(Ve,rt)=>{var lt=gr(),gt=r(lt,!0);l(lt),R(()=>w(gt,(e(rt),i(()=>e(rt).label)))),F("click",lt,()=>_e(e(rt).notation,"damage")),c(Ve,lt)});var Ie=s(Ze,2);{var ut=Ve=>{var rt=br();R(()=>{rt.disabled=e(y)<=0,Je(rt,"title",e(y)<=0?"No Channel Divinity uses remaining":"Use Channel Divinity to add +10 to this attack roll")}),F("click",rt,ne),c(Ve,rt)};_(Ie,Ve=>{e(h)&&he()==="attack"&&!e(Ee)&&e(y)>0&&!e(Y)&&Ve(ut)})}l(se),c($e,se)};_(U,$e=>{e(b),e(h),E(he()),e(Ee),e(y),i(()=>e(b).length>0||e(h)&&he()==="attack"&&!e(Ee)&&e(y)>0)&&$e(L)})}R(()=>{w(be,ce()?`${ce()} - Result`:"Result"),w(it,(e(ue),i(()=>e(ue).resultTotal)))}),c(m,G)};_(Pe,m=>{e(ue)&&m(Xe)})}l(ee),l(pe),l(v),R(()=>{He=mt(v,1,"modal-overlay svelte-1r90jgp",null,He,{hidden:!Q()}),ve=mt(ee,1,"roll-result svelte-1r90jgp",null,ve,{"has-result":e(ue)})}),F("click",we,C),F("click",Ae,oe),F("click",pe,Ea(function(m){na.call(this,n,m)})),F("keydown",pe,function(m){na.call(this,n,m)}),F("click",v,oe),F("keydown",v,m=>m.key==="Escape"&&oe()),c(a,v),Cs(n,"getLastRollTotal",ze);var je=Et(W);return f(),je}const xa="https://api.github.com/gists";async function kr(a,n,t){if(!n)throw new Error("GitHub token is required");const d=JSON.stringify(a,null,2),f=`${a.name||"character"}_dnd.json`,h={description:t||`D&D Character: ${a.name}`,public:!1,files:{[f]:{content:d}}},y=await fetch(xa,{method:"POST",headers:{Authorization:`token ${n}`,"Content-Type":"application/json"},body:JSON.stringify(h)});if(!y.ok)throw new Error(`Failed to create gist: ${y.statusText}`);return(await y.json()).id}async function Sr(a,n,t){if(!n||!t)throw new Error("GitHub token and Gist ID are required");const d=JSON.stringify(a,null,2),h={files:{[`${a.name||"character"}_dnd.json`]:{content:d}}},y=await fetch(`${xa}/${t}`,{method:"PATCH",headers:{Authorization:`token ${n}`,"Content-Type":"application/json"},body:JSON.stringify(h)});if(!y.ok)throw new Error(`Failed to update gist: ${y.statusText}`)}async function xr(a,n){if(!a)throw new Error("Gist ID is required");const t={"Content-Type":"application/json"};n&&(t.Authorization=`token ${n}`);const d=await fetch(`${xa}/${a}`,{method:"GET",headers:t});if(!d.ok)throw new Error(`Failed to load gist: ${d.statusText}`);const f=await d.json(),h=Object.values(f.files);if(h.length===0)throw new Error("No files found in gist");const x=h[0].content;try{const $=JSON.parse(x);return $.attacks&&Array.isArray($.attacks)&&($.attacks=$.attacks.map(k=>({...k,id:k.id||crypto.randomUUID()}))),$.classFeatures?($.classFeatures.features||($.classFeatures.features={}),$.classFeatures.spellSlots||($.classFeatures.spellSlots=[]),$.classFeatures.preparedSpells===void 0&&($.classFeatures.preparedSpells="")):$.classFeatures={features:{},spellSlots:[],preparedSpells:""},$}catch{throw new Error("Invalid character data in gist")}}function Ja(a){typeof window<"u"&&localStorage.setItem("dnd_gist_config",JSON.stringify(a))}function $r(){if(typeof window<"u"){const a=localStorage.getItem("dnd_gist_config");if(a)return JSON.parse(a)}return{}}async function Cr(a,n=30){if(!a)throw new Error("GitHub token is required to list gists");const t=await fetch(`${xa}?per_page=${n}`,{method:"GET",headers:{Authorization:`token ${a}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error(`Failed to list gists: ${t.statusText}`);return await t.json()}var Lr=p('<div class="error-message svelte-1jb5ckg"> </div>'),wr=p('<div class="toggle-container svelte-1jb5ckg"><button type="button" class="toggle-btn svelte-1jb5ckg"> </button></div>'),Dr=p('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID (leave empty to create new)</label> <input type="text" id="gistId" placeholder="Optional: existing Gist ID to update" class="svelte-1jb5ckg"/></div>'),jr=p('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),Br=p('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),Ar=p('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Update (or leave unselected to create new)</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),Fr=p('<div class="info-message svelte-1jb5ckg">No gists found. A new one will be created.</div>'),Mr=p('<!> <div class="form-group svelte-1jb5ckg"><label for="description" class="svelte-1jb5ckg"> </label> <input type="text" id="description" placeholder="D&amp;D Character Sheet" class="svelte-1jb5ckg"/></div>',1),Pr=p('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID *</label> <input type="text" id="gistId" placeholder="Enter Gist ID (for public or your private gists)" required class="svelte-1jb5ckg"/></div>'),Rr=p('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),Ir=p('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),Tr=p('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Load</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),Er=p('<div class="info-message svelte-1jb5ckg">No gists found. Enter a Gist ID manually or create a new one in Save mode.</div>'),Hr=p('<div class="modal-overlay svelte-1jb5ckg" role="button" tabindex="-1"><div class="modal-content svelte-1jb5ckg" role="dialog" tabindex="0"><div class="modal-header svelte-1jb5ckg"><h2 class="svelte-1jb5ckg"> </h2> <button class="close-btn svelte-1jb5ckg">Ã—</button></div> <div class="modal-body svelte-1jb5ckg"><!> <div class="form-group svelte-1jb5ckg"><label for="token" class="svelte-1jb5ckg"> <a href="https://github.com/settings/tokens" target="_blank" rel="noopener" class="svelte-1jb5ckg">Get token</a></label> <input type="password" id="token" placeholder="ghp_xxxxxxxxxxxxx" class="svelte-1jb5ckg"/></div> <!> <!> <div class="modal-actions svelte-1jb5ckg"><button class="btn btn-primary svelte-1jb5ckg"><!></button> <button class="btn btn-secondary svelte-1jb5ckg">Cancel</button></div></div></div></div>');function Ur(a,n){Tt(n,!1);const t=()=>tt(ie,"$character",d),[d,f]=Wt(),h=la();let y=kt(n,"mode",8,"save"),x=P(""),$=P(""),k=P(""),Q=P(!1),z=P(""),ce=P(!1),le=P(!1),N=P([]),he=P(null);const de=$r();de.token&&o(x,de.token),de.gistId&&o($,de.gistId),pa(async()=>{e(x)&&!e(ce)&&await ae()});async function ae(){if(e(x)){o(le,!0),o(z,"");try{o(N,await Cr(e(x))),e($)&&o(he,e(N).find(C=>C.id===e($))||null)}catch(C){o(z,C.message||"Failed to load gists"),o(N,[])}finally{o(le,!1)}}}function Me(C){o(he,C),o($,C.id)}function Qe(){o(ce,!e(ce)),o(z,""),!e(ce)&&e(x)&&ae()}async function ue(){if(!e(x)){o(z,"GitHub token is required");return}const C=e(he)?.id||e($);o(Q,!0),o(z,"");try{if(C)await Sr(t(),e(x),C),o($,C),Ot.add("Character updated in Gist successfully!","success");else{const ne=await kr(t(),e(x),e(k));o($,ne),Ot.add(`Character saved to Gist! ID: ${ne}`,"success")}Ja({token:e(x),gistId:e($)}),h("close")}catch(ne){o(z,ne.message||"Failed to save to Gist")}finally{o(Q,!1)}}async function ze(){const C=e(he)?.id||e($);if(!C){o(z,"Please select a gist or enter a Gist ID");return}o(Q,!0),o(z,"");try{const ne=await xr(C,e(x)||void 0);ie.set(ne),o($,C),Ja({token:e(x),gistId:e($)}),Ot.add("Character loaded from Gist successfully!","success"),h("close")}catch(ne){o(z,ne.message||"Failed to load from Gist")}finally{o(Q,!1)}}function Oe(){h("close")}It();var H=Hr(),q=r(H),ye=r(q),me=r(ye),xe=r(me,!0);l(me);var S=s(me,2);l(ye);var re=s(ye,2),b=r(re);{var j=C=>{var ne=Lr(),oe=r(ne,!0);l(ne),R(()=>w(oe,e(z))),c(C,ne)};_(b,C=>{e(z)&&C(j)})}var Y=s(b,2),Ee=r(Y),Ye=r(Ee);ia(),l(Ee);var Te=s(Ee,2);Ce(Te),l(Y);var g=s(Y,2);{var M=C=>{var ne=wr(),oe=r(ne),W=r(oe,!0);l(oe),l(ne),R(()=>{oe.disabled=e(Q),w(W,e(ce)?"ðŸ“‹ Show My Gists":"âœï¸ Enter Gist ID Manually")}),F("click",oe,Qe),c(C,ne)};_(g,C=>{(y()==="load"||y()==="save"&&e(x))&&C(M)})}var K=s(g,2);{var Z=C=>{var ne=Mr(),oe=Ne(ne);{var W=we=>{var Ae=Dr(),Ke=s(r(Ae),2);Ce(Ke),l(Ae),R(()=>Ke.disabled=e(Q)),Ge(Ke,()=>e($),st=>o($,st)),c(we,Ae)},v=we=>{var Ae=ot(),Ke=Ne(Ae);{var st=I=>{var X=jr();c(I,X)},De=I=>{var X=ot(),Se=Ne(X);{var Ue=ee=>{var ve=Ar(),Pe=s(r(ve),2);yt(Pe,5,()=>e(N),St,(Xe,je)=>{var m=Br();let G;var fe=r(m),te=r(fe),be=r(te,!0);l(te);var D=s(te,2),T=r(D,!0);l(D),l(fe);var V=s(fe,2),Be=r(V),Re=r(Be);l(Be);var it=s(Be,2),J=r(it);l(it),l(V),l(m),R(dt=>{G=mt(m,1,"gist-item svelte-1jb5ckg",null,G,{selected:e(he)?.id===e(je).id}),m.disabled=e(Q),w(be,(e(je),i(()=>e(je).description||"Untitled"))),w(T,(e(je),i(()=>e(je).public?"ðŸŒ Public":"ðŸ”’ Private"))),w(Re,`ID: ${e(je),i(()=>e(je).id)??""}`),w(J,`Updated: ${dt??""}`)},[()=>(e(je),i(()=>new Date(e(je).updated_at).toLocaleDateString()))]),F("click",m,()=>Me(e(je))),c(Xe,m)}),l(Pe),l(ve),c(ee,ve)},We=ee=>{var ve=ot(),Pe=Ne(ve);{var Xe=je=>{var m=Fr();c(je,m)};_(Pe,je=>{e(x)&&je(Xe)},!0)}c(ee,ve)};_(Se,ee=>{e(N),i(()=>e(N).length>0)?ee(Ue):ee(We,!1)},!0)}c(I,X)};_(Ke,I=>{e(le)?I(st):I(De,!1)},!0)}c(we,Ae)};_(oe,we=>{e(ce)||!e(x)?we(W):we(v,!1)})}var He=s(oe,2),pe=r(He),ge=r(pe);l(pe);var B=s(pe,2);Ce(B),l(He),R(()=>{w(ge,`Description ${e($)?"(optional)":""}`),B.disabled=e(Q)}),Ge(B,()=>e(k),we=>o(k,we)),c(C,ne)},O=C=>{var ne=ot(),oe=Ne(ne);{var W=He=>{var pe=Pr(),ge=s(r(pe),2);Ce(ge),l(pe),R(()=>ge.disabled=e(Q)),Ge(ge,()=>e($),B=>o($,B)),c(He,pe)},v=He=>{var pe=ot(),ge=Ne(pe);{var B=Ae=>{var Ke=Rr();c(Ae,Ke)},we=Ae=>{var Ke=ot(),st=Ne(Ke);{var De=X=>{var Se=Tr(),Ue=s(r(Se),2);yt(Ue,5,()=>e(N),St,(We,ee)=>{var ve=Ir();let Pe;var Xe=r(ve),je=r(Xe),m=r(je,!0);l(je);var G=s(je,2),fe=r(G,!0);l(G),l(Xe);var te=s(Xe,2),be=r(te),D=r(be);l(be);var T=s(be,2),V=r(T);l(T),l(te),l(ve),R(Be=>{Pe=mt(ve,1,"gist-item svelte-1jb5ckg",null,Pe,{selected:e(he)?.id===e(ee).id}),ve.disabled=e(Q),w(m,(e(ee),i(()=>e(ee).description||"Untitled"))),w(fe,(e(ee),i(()=>e(ee).public?"ðŸŒ Public":"ðŸ”’ Private"))),w(D,`ID: ${e(ee),i(()=>e(ee).id)??""}`),w(V,`Updated: ${Be??""}`)},[()=>(e(ee),i(()=>new Date(e(ee).updated_at).toLocaleDateString()))]),F("click",ve,()=>Me(e(ee))),c(We,ve)}),l(Ue),l(Se),c(X,Se)},I=X=>{var Se=ot(),Ue=Ne(Se);{var We=ee=>{var ve=Er();c(ee,ve)};_(Ue,ee=>{e(x)&&ee(We)},!0)}c(X,Se)};_(st,X=>{e(N),i(()=>e(N).length>0)?X(De):X(I,!1)},!0)}c(Ae,Ke)};_(ge,Ae=>{e(le)?Ae(B):Ae(we,!1)},!0)}c(He,pe)};_(oe,He=>{e(ce)||!e(x)?He(W):He(v,!1)},!0)}c(C,ne)};_(K,C=>{y()==="save"?C(Z):C(O,!1)})}var _e=s(K,2),Le=r(_e),at=r(Le);{var ke=C=>{var ne=Mt();R(()=>w(ne,y()==="save"?"Saving...":"Loading...")),c(C,ne)},qe=C=>{var ne=Mt();R(()=>w(ne,y()==="save"?"Save":"Load")),c(C,ne)};_(at,C=>{e(Q)?C(ke):C(qe,!1)})}l(Le);var A=s(Le,2);l(_e),l(re),l(q),l(H),R(()=>{w(xe,y()==="save"?"Save to GitHub Gist":"Load from GitHub Gist"),w(Ye,`GitHub Token ${y()==="load"?"(optional for public gists)":"(required)"} `),Te.disabled=e(Q),Le.disabled=e(Q),A.disabled=e(Q)}),F("click",S,Oe),Ge(Te,()=>e(x),C=>o(x,C)),F("blur",Te,()=>{e(x)&&!e(ce)&&ae()}),F("click",Le,function(...C){(y()==="save"?ue:ze)?.apply(this,C)}),F("click",A,Oe),F("click",q,Ea(function(C){na.call(this,n,C)})),F("keydown",q,function(C){na.call(this,n,C)}),F("click",H,Oe),F("keydown",H,C=>C.key==="Escape"&&Oe()),c(a,H),Et(),f()}var Nr=p('<div class="loading svelte-1ngjemu">Loading D&D data...</div>'),Gr=p("<option> </option>"),Or=p('<select class="level-filter svelte-1ngjemu"><option>All Levels</option><option>Cantrip</option><!></select>'),qr=p('<div class="no-results svelte-1ngjemu"> </div>'),Wr=p('<div class="item-meta svelte-1ngjemu"> </div>'),zr=p('<div class="item-meta svelte-1ngjemu"> </div>'),Kr=p('<button><div class="item-name svelte-1ngjemu"> </div> <!></button>'),Vr=p('<p class="higher-levels"><strong>At Higher Levels:</strong> </p>'),Jr=p('<p class="cantrip-upgrade"><strong>Cantrip Upgrade:</strong> </p>'),Qr=p('<h3 class="svelte-1ngjemu"> </h3> <p class="spell-meta svelte-1ngjemu"><!> <!></p> <p class="spell-classes"><strong>Classes:</strong> </p> <div class="spell-stats svelte-1ngjemu"><div><strong>Casting Time:</strong> </div> <div><strong>Range:</strong> </div> <div><strong>Components:</strong> <!></div> <div><strong>Duration:</strong> <!> </div></div> <p class="description svelte-1ngjemu"> </p> <!> <!>',1),Yr=p('<p class="prerequisite svelte-1ngjemu"><strong>Prerequisite:</strong> </p>'),Xr=p('<h3 class="svelte-1ngjemu"> </h3> <!> <p class="description svelte-1ngjemu"> </p> <a target="_blank" rel="noopener" class="source-link svelte-1ngjemu">View Full Details â†’</a>',1),Zr=p('<div class="item-details svelte-1ngjemu"><!></div>'),ei=p('<div class="controls svelte-1ngjemu"><div class="tabs svelte-1ngjemu"><button> </button> <button> </button></div> <div class="search-controls svelte-1ngjemu"><input type="text" placeholder="Search by name or description..." class="search-input svelte-1ngjemu"/> <!></div></div> <div class="content-container svelte-1ngjemu"><div class="items-list svelte-1ngjemu"><!></div> <!></div>',1),ti=p('<div class="modal-backdrop svelte-1ngjemu" role="presentation"><div class="modal svelte-1ngjemu" role="dialog" aria-modal="true" tabindex="-1"><div class="modal-header svelte-1ngjemu"><h2 class="svelte-1ngjemu">Browse D&D Spells & Feats</h2> <button class="close-btn svelte-1ngjemu" aria-label="Close">&times;</button></div> <div class="modal-body svelte-1ngjemu"><!></div> <div class="modal-footer svelte-1ngjemu"><button class="btn-secondary svelte-1ngjemu">Cancel</button> <button class="btn-primary svelte-1ngjemu">Add to Character Sheet</button></div></div></div>');function ai(a,n){Tt(n,!1);const t=P(),d=P(),f=P();let h=kt(n,"onClose",8),y=P("spell"),x=P(!0),$=P(""),k=P(null),Q=P([]),z=P([]),ce=P(null);pa(async()=>{o(x,!0);try{o(Q,await ss()),o(z,await Ys())}catch(S){console.error("Failed to load data:",S)}finally{o(x,!1)}});function le(S){o(ce,S)}function N(S){const re=S.match(/(\d+d\d+(?:\s*\+\s*\d+)?)/i);return re?re[1]:""}function he(S){const re=S.split(/\.( |$)/)[0].trim(),b=Array.from(S.matchAll(/\*\*(.*?)\*\*/g)).map(Y=>Y[1].replace(/\.$/,""));let j=re;return b.length&&(j+=" | Effects: "+b.join(", ")),j}function de(){if(e(ce)){if(e(y)==="spell"){const S=e(ce);ie.update(re=>{const j=[];S.range&&j.push(`Range: ${S.range}`),S.castingTime&&j.push(`Cast: ${S.castingTime}`),S.duration&&j.push(`Duration: ${S.duration}`),S.actionType==="Save"&&j.push("Saving throw spell"),S.components&&S.components.length>0&&j.push(`Components: ${S.components.join(", ")}`),S.material&&j.push(`Material: ${S.material}`);const Y=j.join(" | "),Ee=he(S.description),Ye={id:crypto.randomUUID(),name:`${S.name}${S.concentration?" (C)":""}${S.ritual?" (R)":""}`,bonus:S.actionType==="Attack"?5:0,damage:N(S.description),damageType:`${S.school} (Lvl ${S.level})`,spellRef:S.name,infoNotes:Y,generalNotes:Ee,castAtLevel:S.level};return re.attacks=[...re.attacks,Ye],re})}else if(e(y)==="feat"){const S=e(ce);ie.update(re=>{const b=`${S.name}${S.prerequisite?` (Req: ${S.prerequisite})`:""}
${S.description}
`;return re.features=re.features?`${re.features}
${b}`:b,re})}o(ce,null),h()()}}et(()=>(e(k),e(Q),e($)),()=>{o(t,e(k)!==null?Xs(za(e(Q),e($)),e(k)):za(e(Q),e($)))}),et(()=>(e(z),e($)),()=>{o(d,Zs(e(z),e($)))}),et(()=>(e(y),e(t),e(d)),()=>{o(f,e(y)==="spell"?e(t):e(d))}),Jt(),It();var ae=ti(),Me=r(ae),Qe=r(Me),ue=s(r(Qe),2);l(Qe);var ze=s(Qe,2),Oe=r(ze);{var H=S=>{var re=Nr();c(S,re)},q=S=>{var re=ei(),b=Ne(re),j=r(b),Y=r(j);let Ee;var Ye=r(Y);l(Y);var Te=s(Y,2);let g;var M=r(Te);l(Te),l(j);var K=s(j,2),Z=r(K);Ce(Z);var O=s(Z,2);{var _e=oe=>{var W=Or();R(()=>{e(k),jt(()=>{})});var v=r(W);v.value=(v.__value=null)??"";var He=s(v);He.value=He.__value=0;var pe=s(He);yt(pe,0,()=>[1,2,3,4,5,6,7,8,9],St,(ge,B)=>{var we=Gr(),Ae=r(we);l(we);var Ke={};R(()=>{w(Ae,`Level ${B??""}`),Ke!==(Ke=B)&&(we.value=(we.__value=B)??"")}),c(ge,we)}),l(W),Aa(W,()=>e(k),ge=>o(k,ge)),c(oe,W)};_(O,oe=>{e(y)==="spell"&&oe(_e)})}l(K),l(b);var Le=s(b,2),at=r(Le),ke=r(at);{var qe=oe=>{var W=qr(),v=r(W);l(W),R(()=>w(v,`No ${e(y)??""}s found`)),c(oe,W)},A=oe=>{var W=ot(),v=Ne(W);yt(v,1,()=>e(f),St,(He,pe)=>{var ge=Kr();let B;var we=r(ge),Ae=r(we,!0);l(we);var Ke=s(we,2);{var st=I=>{const X=ct(()=>e(pe));var Se=Wr(),Ue=r(Se);l(Se),R(()=>w(Ue,`Level ${E(e(X)),i(()=>e(X).level)??""} â€¢ ${E(e(X)),i(()=>e(X).school)??""}`)),c(I,Se)},De=I=>{const X=ct(()=>e(pe));var Se=ot(),Ue=Ne(Se);{var We=ee=>{var ve=zr(),Pe=r(ve,!0);l(ve),R(()=>w(Pe,(E(e(X)),i(()=>e(X).prerequisite)))),c(ee,ve)};_(Ue,ee=>{E(e(X)),i(()=>e(X).prerequisite)&&ee(We)})}c(I,Se)};_(Ke,I=>{e(y)==="spell"?I(st):I(De,!1)})}l(ge),R(()=>{B=mt(ge,1,"item-card svelte-1ngjemu",null,B,{selected:e(ce)?.name===e(pe).name}),w(Ae,(e(pe),i(()=>e(pe).name)))}),F("click",ge,()=>le(e(pe))),c(He,ge)}),c(oe,W)};_(ke,oe=>{e(f),i(()=>e(f).length===0)?oe(qe):oe(A,!1)})}l(at);var C=s(at,2);{var ne=oe=>{var W=Zr(),v=r(W);{var He=ge=>{const B=ct(()=>e(ce));var we=Qr(),Ae=Ne(we),Ke=r(Ae,!0);l(Ae);var st=s(Ae,2),De=r(st);{var I=u=>{var U=Mt();R(()=>w(U,`${E(e(B)),i(()=>e(B).school)??""} cantrip`)),c(u,U)},X=u=>{var U=Mt();R(()=>w(U,`Level ${E(e(B)),i(()=>e(B).level)??""} ${E(e(B)),i(()=>e(B).school)??""}`)),c(u,U)};_(De,u=>{E(e(B)),i(()=>e(B).level===0)?u(I):u(X,!1)})}var Se=s(De,2);{var Ue=u=>{var U=Mt("(ritual)");c(u,U)};_(Se,u=>{E(e(B)),i(()=>e(B).ritual)&&u(Ue)})}l(st);var We=s(st,2),ee=s(r(We));l(We);var ve=s(We,2),Pe=r(ve),Xe=s(r(Pe));l(Pe);var je=s(Pe,2),m=s(r(je));l(je);var G=s(je,2),fe=s(r(G)),te=s(fe);{var be=u=>{var U=Mt();R(()=>w(U,`(${E(e(B)),i(()=>e(B).material)??""})`)),c(u,U)};_(te,u=>{E(e(B)),i(()=>e(B).material)&&u(be)})}l(G);var D=s(G,2),T=s(r(D),2);{var V=u=>{var U=Mt("Concentration,");c(u,U)};_(T,u=>{E(e(B)),i(()=>e(B).concentration)&&u(V)})}var Be=s(T,1,!0);l(D),l(ve);var Re=s(ve,2),it=r(Re,!0);l(Re);var J=s(Re,2);{var dt=u=>{var U=Vr(),L=s(r(U));l(U),R(()=>w(L,` ${E(e(B)),i(()=>e(B).higherLevelSlot)??""}`)),c(u,U)};_(J,u=>{E(e(B)),i(()=>e(B).higherLevelSlot)&&u(dt)})}var xt=s(J,2);{var _t=u=>{var U=Jr(),L=s(r(U));l(U),R(()=>w(L,` ${E(e(B)),i(()=>e(B).cantripUpgrade)??""}`)),c(u,U)};_(xt,u=>{E(e(B)),i(()=>e(B).cantripUpgrade)&&u(_t)})}R((u,U)=>{w(Ke,(E(e(B)),i(()=>e(B).name))),w(ee,` ${u??""}`),w(Xe,` ${E(e(B)),i(()=>e(B).castingTime||e(B).actionType)??""}`),w(m,` ${E(e(B)),i(()=>e(B).range)??""}`),w(fe,` ${U??""}`),w(Be,(E(e(B)),i(()=>e(B).duration))),w(it,(E(e(B)),i(()=>e(B).description)))},[()=>(E(e(B)),i(()=>e(B).classes.join(", "))),()=>(E(e(B)),i(()=>e(B).components.join(", ").toUpperCase()))]),c(ge,we)},pe=ge=>{const B=ct(()=>e(ce));var we=Xr(),Ae=Ne(we),Ke=r(Ae,!0);l(Ae);var st=s(Ae,2);{var De=Ue=>{var We=Yr(),ee=s(r(We));l(We),R(()=>w(ee,` ${E(e(B)),i(()=>e(B).prerequisite)??""}`)),c(Ue,We)};_(st,Ue=>{E(e(B)),i(()=>e(B).prerequisite)&&Ue(De)})}var I=s(st,2),X=r(I,!0);l(I);var Se=s(I,2);R(()=>{w(Ke,(E(e(B)),i(()=>e(B).name))),w(X,(E(e(B)),i(()=>e(B).description))),Je(Se,"href",(E(e(B)),i(()=>e(B).source)))}),c(ge,we)};_(v,ge=>{e(y)==="spell"?ge(He):ge(pe,!1)})}l(W),c(oe,W)};_(C,oe=>{e(ce)&&oe(ne)})}l(Le),R(()=>{Ee=mt(Y,1,"tab svelte-1ngjemu",null,Ee,{active:e(y)==="spell"}),w(Ye,`ðŸ“œ Spells (${e(Q),i(()=>e(Q).length)??""})`),g=mt(Te,1,"tab svelte-1ngjemu",null,g,{active:e(y)==="feat"}),w(M,`â­ Feats (${e(z),i(()=>e(z).length)??""})`)}),F("click",Y,()=>{o(y,"spell"),o(ce,null),o($,"")}),F("click",Te,()=>{o(y,"feat"),o(ce,null),o($,"")}),Ge(Z,()=>e($),oe=>o($,oe)),c(S,re)};_(Oe,S=>{e(x)?S(H):S(q,!1)})}l(ze);var ye=s(ze,2),me=r(ye),xe=s(me,2);l(ye),l(Me),l(ae),R(()=>xe.disabled=!e(ce)),F("click",ue,function(...S){h()?.apply(this,S)}),F("click",me,function(...S){h()?.apply(this,S)}),F("click",xe,de),F("click",Me,Ea(function(S){na.call(this,n,S)})),F("keydown",Me,function(S){na.call(this,n,S)}),F("click",ae,function(...S){h()?.apply(this,S)}),F("keydown",ae,S=>S.key==="Escape"&&h()()),c(a,ae),Et()}var si=p('<link rel="icon" type="image/png" href="favicon4.png"/> <meta name="viewport" content="width=device-width, initial-scale=1"/>',1),li=p('<span class="character-name svelte-1uha8ag"> </span>'),ri=p("<span> </span>"),ii=p('<div class="spell-slots-header svelte-1uha8ag"></div>'),ni=p("<span> </span><br/>",1),oi=p("<span> </span>"),ci=p('<span class="effect-tooltip"><strong> </strong><br/> <br/> <!> <!></span>'),vi=p('<button class="effect-remove-btn svelte-1uha8ag">Ã—</button>'),di=p('<span class="effect-badge svelte-1uha8ag" tabindex="0"> <!> <!></span>'),ui=p(`<div class="active-effects-header svelte-1uha8ag"></div> <style>.effect-badge {
              position: relative;
            }
            .effect-tooltip {
              position: absolute;
              top: 120%;
              left: 50%;
              transform: translateX(-50%);
              background: #fff;
              color: #222;
              border: 1px solid #a5b4fc;
              border-radius: 6px;
              padding: 8px 12px;
              font-size: 0.95em;
              box-shadow: 0 2px 8px rgba(0, 0, 0, 0.12);
              z-index: 10;
              min-width: 180px;
              max-width: 260px;
              white-space: normal;
              pointer-events: none;
              opacity: 1;
              transition: opacity 0.15s;
            }</style>`,1),pi=p('<div class="rest-menu svelte-1uha8ag"><button class="rest-option svelte-1uha8ag">â˜• Short Rest</button> <button class="rest-option svelte-1uha8ag">ðŸ›ï¸ Long Rest</button></div>'),fi=p('<div class="container svelte-1uha8ag"><header class="svelte-1uha8ag"><div class="header-top svelte-1uha8ag"><div class="header-title svelte-1uha8ag"><div class="title-row svelte-1uha8ag"><h1 class="svelte-1uha8ag">D&D Character Sheet</h1> <!></div> <!> <!></div> <div class="header-right svelte-1uha8ag"><div class="header-controls svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">ðŸŽ²</span><span class="btn-text svelte-1uha8ag">Roll Dice</span></button> <div class="rest-button-container svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">ðŸ˜´</span><span class="btn-text svelte-1uha8ag">Rest</span></button> <!></div> <div class="mode-toggle"><button><span class="btn-icon svelte-1uha8ag"> </span><span class="btn-text svelte-1uha8ag"> </span></button></div></div> <div class="header-search svelte-1uha8ag"><input type="text" placeholder="ðŸ” Search..." class="search-input use-enabled svelte-1uha8ag"/></div></div></div> <div class="header-actions svelte-1uha8ag"><button class="btn btn-mode svelte-1uha8ag">ðŸ“š Browse Spells & Feats</button> <button class="btn btn-secondary">Save to Gist</button> <button class="btn btn-secondary">Load from Gist</button> <button class="btn btn-secondary">Export JSON</button> <button class="btn btn-secondary">Import JSON</button> <input type="file" accept=".json" style="display: none;"/></div></header> <main class="svelte-1uha8ag"><!> <!> <!> <!> <!> <!> <!></main></div> <!> <!> <!> <!>',1);function xi(a,n){Tt(n,!1);const t=()=>tt(ie,"$character",h),d=()=>tt(Zt,"$isEditMode",h),f=()=>tt(ea,"$searchFilter",h),[h,y]=Wt();function x(){const u=[],U=t().classFeatures.spellSlotsByLevel||{};for(let L=1;L<=9;L++){const $e=U[L];if($e&&$e.length>0){const se=$e.length,Ze=$e.filter(Ie=>Ie).length;u.push({level:L,available:se-Ze,total:se})}}return u}let $=P(!1),k=P(!1),Q=P(!1),z=P("save"),ce=P(void 0),le=P(""),N=P(""),he=P(""),de=P(!1),ae=P([]),Me=P("other"),Qe=P(),ue=!1,ze=1,Oe=P(!1),H=P(null);function q(u){o(H,u)}function ye(){o(H,null)}function me(u){o(H,e(H)===u?null:u)}function xe(){const u=[];ie.update(L=>{const $e=L.hitDice.current;L.hitDice.current=Math.min(L.hitDice.max,L.hitDice.current+Math.max(1,Math.floor(L.hitDice.max/2)));const se=L.hitDice.current-$e;if(se>0&&u.push(`${se} hit ${se===1?"die":"dice"}`),L.class){const Ze=oa(L.class,L.level,L.subclass);L.classFeatures.features||(L.classFeatures.features={}),Ze.forEach(Ie=>{if(Ie.resetOn==="short"){const ut=Ie.name.replace(/\s+/g,"");if(Ie.type==="uses"){const Ve=typeof Ie.maxUses=="function"?Ie.maxUses(L.level):Ie.maxUses;L.classFeatures.features[ut]=Array(Ve).fill(!1),u.push(Ie.name)}else if(Ie.type==="pool"){const Ve=typeof Ie.maxPool=="function"?Ie.maxPool(L.level):Ie.maxPool;Ve!==void 0&&(L.classFeatures.features[ut]=Ve,u.push(Ie.name))}}})}return L}),o(Oe,!1);const U=u.length>0?`Short rest taken! Restored: ${u.join(", ")}`:"Short rest taken!";Ot.add(U,"success")}function S(){const u=[];ie.update(L=>{const $e=L.maxHP-L.currentHP;$e>0&&u.push(`${$e} HP`),L.currentHP=L.maxHP,L.tempHP=0;const se=L.hitDice.max-L.hitDice.current;se>0&&u.push(`${se} hit ${se===1?"die":"dice"}`),L.hitDice.current=L.hitDice.max;let Ze=0;if(L.classFeatures.spellSlotsByLevel&&Object.keys(L.classFeatures.spellSlotsByLevel).forEach(Ie=>{const ut=L.classFeatures.spellSlotsByLevel[parseInt(Ie)];if(ut){const Ve=ut.filter(rt=>rt).length;Ze+=Ve,L.classFeatures.spellSlotsByLevel[parseInt(Ie)]=Array(ut.length).fill(!1)}}),Ze>0&&u.push(`${Ze} spell ${Ze===1?"slot":"slots"}`),L.class){const Ie=oa(L.class,L.level,L.subclass);L.classFeatures.features||(L.classFeatures.features={});let ut=!1;Ie.forEach(Ve=>{const rt=Ve.name.replace(/\s+/g,"");if(!(Ve.type==="info"||Ve.type==="channelDivinity")){if(Ve.type==="uses"){const lt=typeof Ve.maxUses=="function"?Ve.maxUses(L.level):Ve.maxUses;L.classFeatures.features[rt]=Array(lt).fill(!1),ut=!0}else if(Ve.type==="pool"){const lt=typeof Ve.maxPool=="function"?Ve.maxPool(L.level):Ve.maxPool;lt!==void 0&&(L.classFeatures.features[rt]=lt,ut=!0)}}}),ut&&u.push("all class features")}return L}),o(Oe,!1);const U=u.length>0?`Long rest taken! Restored: ${u.join(", ")}`:"Long rest taken! Fully rested.";Ot.add(U,"success")}function re(u){o(le,""),o(N,""),o(he,""),o(de,!1),o(ae,[]),o(Me,"other"),ue=!1,typeof u=="string"?o(le,u):(o(le,u.notation),o(N,u.damageNotation||""),o(he,u.attackName||""),o(de,!!u.applyHalfDamage),o(ae,u.bonusBreakdown||[]),o(Me,u.rollType||"other")),o($,!0)}function b(u){const{notation:U,count:L,bonusBreakdown:$e}=u.detail;o(le,""),ue=!0,ze=L||1,setTimeout(()=>{o(le,U),o(N,""),o(he,"Hit Die"),o(ae,$e||[]),o(Me,"other")},0),o($,!0)}function j(){if(o($,!1),ue&&e(Qe)){const u=e(Qe).getLastRollTotal();if(u!==null){const U=Math.max(1,u);ie.update(L=>(L.hitDice.current=Math.max(0,L.hitDice.current-ze),L.currentHP=Math.min(L.maxHP,L.currentHP+U),L))}ue=!1}}function Y(){Zt.update(u=>!u)}function Ee(u){u.target.closest(".rest-button-container")||o(Oe,!1)}pa(()=>{const u=Zt.subscribe(U=>{U?document.body.classList.remove("use-mode"):document.body.classList.add("use-mode")});return document.addEventListener("click",Ee),()=>{u(),document.removeEventListener("click",Ee)}});function Ye(){ms(t())}function Te(){e(ce)?.click()}async function g(u){const L=u.target.files?.[0];if(L)try{const $e=await _s(L);ie.set($e),alert("Character imported successfully!")}catch{alert("Failed to import character file")}}It();var M=fi();bs("1uha8ag",u=>{var U=si();ia(2),Xa(()=>{fs.title="D&D Character Sheet"}),c(u,U)});var K=Ne(M),Z=r(K),O=r(Z),_e=r(O),Le=r(_e),at=s(r(Le),2);{var ke=u=>{var U=li(),L=r(U);l(U),R(()=>w(L,`${t().name??""} (${t().level??""})`)),c(u,U)};_(at,u=>{t().name&&u(ke)})}l(Le);var qe=s(Le,2);{var A=u=>{var U=ii();yt(U,5,x,St,(L,$e)=>{var se=ri();let Ze;var Ie=r(se);l(se),R(()=>{Ze=mt(se,1,"slot-badge svelte-1uha8ag",null,Ze,{depleted:e($e).available===0}),w(Ie,`Lv${e($e).level??""}: ${e($e).available??""}/${e($e).total??""}`)}),c(L,se)}),l(U),c(u,U)};_(qe,u=>{x().length>0&&u(A)})}var C=s(qe,2);{var ne=u=>{var U=ui(),L=Ne(U);yt(L,5,()=>t().activeStates,St,($e,se,Ze)=>{var Ie=di(),ut=r(Ie),Ve=s(ut);{var rt=pt=>{var ft=ci(),Fe=r(ft),nt=r(Fe,!0);l(Fe);var bt=s(Fe,2),Ct=s(bt,3);{var Ht=Lt=>{var wt=ni(),Nt=Ne(wt),vt=r(Nt);l(Nt),ia(),R(()=>w(vt,`Attack Bonus: ${typeof e(se).attackBonus=="number"&&e(se).attackBonus>0?"+":""}${e(se).attackBonus??""}`)),c(Lt,wt)};_(Ct,Lt=>{e(se).attackBonus&&Lt(Ht)})}var Ut=s(Ct,2);{var At=Lt=>{var wt=oi(),Nt=r(wt);l(wt),R(()=>w(Nt,`Damage Bonus: ${typeof e(se).damageBonus=="number"&&e(se).damageBonus>0?"+":""}${e(se).damageBonus??""}`)),c(Lt,wt)};_(Ut,Lt=>{e(se).damageBonus&&Lt(At)})}l(ft),R(()=>{w(nt,e(se).name),w(bt,` ${e(se).description??""}`)}),c(pt,ft)};_(Ve,pt=>{e(H)===Ze&&pt(rt)})}var lt=s(Ve,2);{var gt=pt=>{var ft=vi();R(()=>Je(ft,"title",`End ${e(se).name??""}`)),F("click",ft,()=>{ie.update(Fe=>{if(Fe.activeStates){const nt=Fe.activeStates[Ze];nt?.hpBonus&&nt.target!=="other"&&(Fe.maxHP-=nt.hpBonus,Fe.currentHP=Math.max(1,Math.min(Fe.currentHP-nt.hpBonus,Fe.maxHP))),Fe.activeStates=Fe.activeStates.filter((bt,Ct)=>Ct!==Ze)}return Fe})}),c(pt,ft)};_(lt,pt=>{d()||pt(gt)})}l(Ie),R(()=>{Je(Ie,"aria-label",e(se).name),w(ut,`âœ¨ ${e(se).name??""} `)}),F("mouseenter",Ie,()=>q(Ze)),F("mouseleave",Ie,ye),F("focus",Ie,()=>q(Ze)),F("blur",Ie,ye),F("click",Ie,()=>me(Ze)),c($e,Ie)}),l(L),ia(2),c(u,U)};_(C,u=>{t().activeStates&&t().activeStates.length>0&&u(ne)})}l(_e);var oe=s(_e,2),W=r(oe),v=r(W),He=s(v,2),pe=r(He),ge=s(pe,2);{var B=u=>{var U=pi(),L=r(U),$e=s(L,2);l(U),F("click",L,xe),F("click",$e,S),c(u,U)};_(ge,u=>{e(Oe)&&u(B)})}l(He);var we=s(He,2),Ae=r(we);let Ke;var st=r(Ae),De=r(st,!0);l(st);var I=s(st),X=r(I,!0);l(I),l(Ae),l(we),l(W);var Se=s(W,2),Ue=r(Se);Ce(Ue),l(Se),l(oe),l(O);var We=s(O,2),ee=r(We),ve=s(ee,2),Pe=s(ve,2),Xe=s(Pe,2),je=s(Xe,2),m=s(je,2);ja(m,u=>o(ce,u),()=>e(ce)),l(We),l(Z);var G=s(Z,2),fe=r(G);Rs(fe,{});var te=s(fe,2);Hs(te,{$$events:{roll:u=>re(u.detail)}});var be=s(te,2);Qs(be,{$$events:{roll:u=>re(u.detail)}});var D=s(be,2);zs(D,{$$events:{rollHitDice:b}});var T=s(D,2);Hl(T,{$$events:{roll:u=>re(u.detail)}});var V=s(T,2);ar(V,{});var Be=s(V,2);rr(Be,{}),l(G),l(K);var Re=s(K,2);ja(yr(Re,{get notation(){return e(le)},get damageNotation(){return e(N)},get attackName(){return e(he)},get applyHalfDamage(){return e(de)},get bonusBreakdown(){return e(ae)},get rollType(){return e(Me)},get visible(){return e($)},$$events:{close:j},$$legacy:!0}),u=>o(Qe,u),()=>e(Qe));var it=s(Re,2);{var J=u=>{Ur(u,{get mode(){return e(z)},$$events:{close:()=>o(k,!1)}})};_(it,u=>{e(k)&&u(J)})}var dt=s(it,2);{var xt=u=>{ai(u,{onClose:()=>o(Q,!1)})};_(dt,u=>{e(Q)&&u(xt)})}var _t=s(dt,2);hs(_t,{}),R(()=>{Ke=mt(Ae,1,"btn btn-mode svelte-1uha8ag",null,Ke,{"use-mode":!d()}),w(De,d()?"ðŸ“":"ðŸŽ²"),w(X,d()?"Edit Mode":"Use Mode")}),F("click",v,()=>{o(ae,[]),o($,!0)}),F("click",pe,()=>o(Oe,!e(Oe))),F("click",Ae,Y),Ge(Ue,f,u=>ys(ea,u)),F("click",ee,()=>o(Q,!0)),F("click",ve,()=>{o(z,"save"),o(k,!0)}),F("click",Pe,()=>{o(z,"load"),o(k,!0)}),F("click",Xe,Ye),F("click",je,Te),F("change",m,g),c(a,M),Et(),y()}export{xi as component};
