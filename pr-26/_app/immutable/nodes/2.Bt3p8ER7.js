import{d as os,g as Rs,f,e as L,a as c,s as D,c as dt,t as Gt}from"../chunks/BESELRjb.js";import{i as qt}from"../chunks/JMgyEzd3.js";import{c as _a,o as Ca,a as Ms,b as Fs}from"../chunks/CtPH092J.js";import{F as j,T as fa,Y as Za,j as Ps,aZ as Ts,U as cs,ag as Is,aD as Es,aK as Hs,aE as Us,a1 as Ns,av as Ia,a7 as ls,i as xs,a_ as Os,a$ as ks,b0 as Ga,K as ba,e as ws,b1 as $s,b2 as Gs,b3 as qs,b4 as Ws,q as es,b5 as zs,b6 as Ks,ab as Vs,d as n,r as is,g as Js,C as Wt,G as zt,H as l,I as s,J as a,b7 as Xe,b8 as va,s as r,a4 as S,f as e,m as gt,E as Ae,b9 as Tt,ao as Jt,A as W,ba as ma,bb as xa,bc as Ys}from"../chunks/DyJ43TGI.js";import{t as Qs,c as Yt,a as ue,e as _t,i as kt,u as Ss,s as ga,b as St,d as Fa,f as ha,g as Xs,j as It,h as Zs,T as el,k as tl,l as al}from"../chunks/ByvjJ_Au.js";import{i as h,s as ra,a as st,b as Lt,d as La,e as sl}from"../chunks/CCL4udNy.js";import{p as xt,b as Ra}from"../chunks/iXw84bXb.js";import{b as ja,r as ll}from"../chunks/9sxnxQHY.js";function il(i,o,t=!1,v=!1,d=!1){var p=i,m="";j(()=>{var w=Ps;if(m===(m=o()??"")){fa&&Za();return}if(w.nodes_start!==null&&(Ts(w.nodes_start,w.nodes_end),w.nodes_start=w.nodes_end=null),m!==""){if(fa){cs.data;for(var _=Za(),k=_;_!==null&&(_.nodeType!==Is||_.data!=="");)k=_,_=Es(_);if(_===null)throw Hs(),Us;os(cs,k),p=Ns(_);return}var E=m+"";t?E=`<svg>${E}</svg>`:v&&(E=`<math>${E}</math>`);var M=Rs(E);if((t||v)&&(M=Ia(M)),os(Ia(M),M.lastChild),t||v)for(;Ia(M);)p.before(Ia(M));else p.before(M)}})}function nl(i,o,t,v,d){fa&&Za();var p=o.$$slots?.[t],m=!1;p===!0&&(p=o[t],m=!0),p===void 0?d!==null&&d(i):p(i,m?()=>v:v)}function rl(i,o,t,v){var d=i.__style;if(fa||d!==o){var p=Qs(o);(!fa||p!==i.getAttribute("style"))&&(p==null?i.removeAttribute("style"):i.style.cssText=p),i.__style=o}return v}function Oa(i,o,t=!1){if(i.multiple){if(o==null)return;if(!xs(o))return Os();for(var v of i.options)v.selected=o.includes(Aa(v));return}for(v of i.options){var d=Aa(v);if(ks(d,o)){v.selected=!0;return}}(!t||o!==void 0)&&(i.selectedIndex=-1)}function ts(i){var o=new MutationObserver(()=>{Oa(i,i.__value)});o.observe(i,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),ls(()=>{o.disconnect()})}function Ma(i,o,t=o){var v=new WeakSet,d=!0;Ga(i,"change",p=>{var m=p?"[selected]":":checked",w;if(i.multiple)w=[].map.call(i.querySelectorAll(m),Aa);else{var _=i.querySelector(m)??i.querySelector("option:not([disabled])");w=_&&Aa(_)}t(w),ba!==null&&v.add(ba)}),ws(()=>{var p=o();if(i===document.activeElement){var m=$s??ba;if(v.has(m))return}if(Oa(i,p,d),d&&p===void 0){var w=i.querySelector(":checked");w!==null&&(p=Aa(w),t(p))}i.__value=p,d=!1}),ts(i)}function Aa(i){return"__value"in i?i.__value:i.value}const ol=Symbol("is custom element"),cl=Symbol("is html");function De(i){if(fa){var o=!1,t=()=>{if(!o){if(o=!0,i.hasAttribute("value")){var v=i.value;Qe(i,"value",null),i.value=v}if(i.hasAttribute("checked")){var d=i.checked;Qe(i,"checked",null),i.checked=d}}};i.__on_r=t,es(t),zs()}}function Ba(i,o){var t=ns(i);t.value===(t.value=o??void 0)||i.value===o&&(o!==0||i.nodeName!=="PROGRESS")||(i.value=o??"")}function Cs(i,o){var t=ns(i);t.checked!==(t.checked=o??void 0)&&(i.checked=o)}function Qe(i,o,t,v){var d=ns(i);fa&&(d[o]=i.getAttribute(o),o==="src"||o==="srcset"||o==="href"&&i.nodeName==="LINK")||d[o]!==(d[o]=t)&&(o==="loading"&&(i[Gs]=t),t==null?i.removeAttribute(o):typeof t!="string"&&vl(i).includes(o)?i[o]=t:i.setAttribute(o,t))}function ns(i){return i.__attributes??={[ol]:i.nodeName.includes("-"),[cl]:i.namespaceURI===qs}}var vs=new Map;function vl(i){var o=i.getAttribute("is")||i.nodeName,t=vs.get(o);if(t)return t;vs.set(o,t=[]);for(var v,d=i,p=Element.prototype;p!==d;){v=Ks(d);for(var m in v)v[m].set&&t.push(m);d=Ws(d)}return t}function Ie(i,o,t=o){var v=new WeakSet;Ga(i,"input",async d=>{var p=d?i.defaultValue:i.value;if(p=Va(i)?Ja(p):p,t(p),ba!==null&&v.add(ba),await Vs(),p!==(p=o())){var m=i.selectionStart,w=i.selectionEnd,_=i.value.length;if(i.value=p??"",w!==null){var k=i.value.length;m===w&&w===_&&k>_?(i.selectionStart=k,i.selectionEnd=k):(i.selectionStart=m,i.selectionEnd=Math.min(w,k))}}}),(fa&&i.defaultValue!==i.value||n(o)==null&&i.value)&&(t(Va(i)?Ja(i.value):i.value),ba!==null&&v.add(ba)),is(()=>{var d=o();if(i===document.activeElement){var p=$s??ba;if(v.has(p))return}Va(i)&&d===Ja(i.value)||i.type==="date"&&!d&&!i.value||d!==i.value&&(i.value=d??"")})}const Ka=new Set;function ds(i,o,t,v,d=v){var p=t.getAttribute("type")==="checkbox",m=i;let w=!1;if(o!==null)for(var _ of o)m=m[_]??=[];m.push(t),Ga(t,"change",()=>{var k=t.__value;p&&(k=us(m,k,t.checked)),d(k)},()=>d(p?[]:null)),is(()=>{var k=v();if(fa&&t.defaultChecked!==t.checked){w=!0;return}p?(k=k||[],t.checked=k.includes(t.__value)):t.checked=ks(t.__value,k)}),ls(()=>{var k=m.indexOf(t);k!==-1&&m.splice(k,1)}),Ka.has(m)||(Ka.add(m),es(()=>{m.sort((k,E)=>k.compareDocumentPosition(E)===4?-1:1),Ka.delete(m)})),es(()=>{if(w){var k;if(p)k=us(m,k,t.checked);else{var E=m.find(M=>M.checked);k=E?.__value}d(k)}})}function wa(i,o,t=o){Ga(i,"change",v=>{var d=v?i.defaultChecked:i.checked;t(d)}),(fa&&i.defaultChecked!==i.checked||n(o)==null)&&t(i.checked),is(()=>{var v=o();i.checked=!!v})}function us(i,o,t){for(var v=new Set,d=0;d<i.length;d+=1)i[d].checked&&v.add(i[d].__value);return t||v.delete(o),Array.from(v)}function Va(i){var o=i.type;return o==="number"||o==="range"}function Ja(i){return i===""?null:+i}function dl(i,o,t){var v=Js(i,o);v&&v.set&&(i[o]=t,ls(()=>{i[o]=null}))}function rs(i){return function(...o){var t=o[0];return t.stopPropagation(),i?.apply(this,o)}}function $a(i,o){var t=i.$$events?.[o.type],v=xs(t)?t.slice():t==null?[]:[t];for(var d of v)d.call(this,o)}const ul="";function Ds(...i){return ja+ul+ll(i[0],i[1])}const as={paladin:{name:"Paladin",hitDice:"d10",spellcaster:!0,spellcastingAbility:"charisma",spellSlotsByLevel:{1:0,2:2,3:3,4:3,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Divine Sense",type:"uses",maxUses:(i,o=1)=>1+Math.max(1,o),resetOn:"long",description:"Detect celestials, fiends, and undead within 60 feet",minLevel:1},{name:"Lay on Hands",type:"pool",maxPool:i=>i*5,resetOn:"long",description:"Heal wounds or cure disease",minLevel:1},{name:"Divine Smite",type:"spellSlot",description:"Expend spell slot to deal extra radiant damage",minLevel:2,rollable:!0},{name:"Channel Divinity",type:"pool",maxPool:i=>i>=18?3:i>=6?2:1,resetOn:"short",description:"Sacred Weapon or Turn Undead",minLevel:3}]},fighter:{name:"Fighter",hitDice:"d10",spellcaster:!1,features:[{name:"Second Wind",type:"uses",maxUses:1,resetOn:"short",description:"Regain 1d10 + fighter level HP as bonus action",minLevel:1,rollable:!0,rollFormula:i=>`1d10+${i}`},{name:"Action Surge",type:"uses",maxUses:i=>i>=17?2:1,resetOn:"short",description:"Take one additional action on your turn",minLevel:2},{name:"Indomitable",type:"uses",maxUses:i=>i>=17?3:i>=13?2:1,resetOn:"long",description:"Reroll a failed saving throw",minLevel:9}],subclasses:{champion:{name:"Champion",features:[{name:"Improved Critical",type:"info",description:"Critical hit on 19-20",minLevel:3},{name:"Remarkable Athlete",type:"info",description:"Add half proficiency to STR/DEX/CON checks, increase long jump distance",minLevel:7},{name:"Additional Fighting Style",type:"info",description:"Choose a second fighting style",minLevel:10},{name:"Superior Critical",type:"info",description:"Critical hit on 18-20",minLevel:15},{name:"Survivor",type:"info",description:"Regain 5 + CON mod HP at start of turn if below half HP",minLevel:18}]},battlemaster:{name:"Battle Master",features:[{name:"Combat Superiority",type:"uses",maxUses:i=>i>=15?6:i>=7?5:4,resetOn:"short",description:i=>`Use superiority dice (${i>=18?"d12":i>=10?"d10":"d8"}) for maneuvers`,minLevel:3},{name:"Know Your Enemy",type:"info",description:"Learn capabilities of creatures you observe",minLevel:7},{name:"Improved Combat Superiority",type:"info",description:"Superiority dice become d10",minLevel:10},{name:"Relentless",type:"info",description:"Regain 1 superiority die if you have none at start of turn",minLevel:15}]}}},rogue:{name:"Rogue",hitDice:"d8",spellcaster:!1,features:[{name:"Sneak Attack",type:"info",description:i=>`Deal ${Math.ceil(i/2)}d6 extra damage once per turn with advantage or ally nearby`,minLevel:1,rollable:!0,rollFormula:i=>`${Math.ceil(i/2)}d6`},{name:"Cunning Action",type:"info",description:"Dash, Disengage, or Hide as a bonus action",minLevel:2},{name:"Uncanny Dodge",type:"info",description:"Use reaction to halve damage from an attack",minLevel:5},{name:"Evasion",type:"info",description:"Take no damage on successful Dex save (half on fail)",minLevel:7}]},wizard:{name:"Wizard",hitDice:"d6",spellcaster:!0,spellcastingAbility:"intelligence",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Arcane Recovery",type:"uses",maxUses:1,resetOn:"long",description:i=>`Recover spell slots totaling up to ${Math.ceil(i/2)} levels during short rest`,minLevel:1},{name:"Spell Mastery",type:"info",description:"Cast one 1st-level and one 2nd-level spell at will",minLevel:18}]},cleric:{name:"Cleric",hitDice:"d8",spellcaster:!0,spellcastingAbility:"wisdom",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Channel Divinity",type:"pool",maxPool:i=>i>=18?3:i>=6?2:1,resetOn:"short",description:"Turn Undead or domain-specific ability",minLevel:2},{name:"Destroy Undead",type:"info",description:i=>`Channel Divinity destroys undead of CR ${i>=17?4:i>=14?3:i>=11?2:i>=8?1:.5} or lower`,minLevel:5},{name:"Divine Intervention",type:"uses",maxUses:1,resetOn:"long",description:i=>`${i}% chance to succeed, implore deity for aid`,minLevel:10}],subclasses:{war:{name:"War Domain",features:[{name:"War Priest",type:"uses",maxUses:(i,o=1)=>Math.max(1,o),resetOn:"long",description:"Make one weapon attack as a bonus action",minLevel:1},{name:"Guided Strike",type:"channelDivinity",description:"Use your Channel Divinity to gain +10 to an attack roll. Make this choice after you see the roll, but before the DM says whether the attack hits or misses.",minLevel:2,resetOn:"short"},{name:"War God's Blessing",type:"channelDivinity",description:"Use reaction to grant +10 to an ally's attack roll within 30 feet. Consumes one use of Channel Divinity.",minLevel:6,resetOn:"short"},{name:"Divine Strike",type:"info",description:i=>`Deal extra ${i>=14?"2d8":"1d8"} weapon damage once per turn`,minLevel:8,rollable:!0,rollFormula:i=>i>=14?"2d8":"1d8"},{name:"Avatar of Battle",type:"info",description:"Gain resistance to nonmagical weapon damage",minLevel:17}]},life:{name:"Life Domain",features:[{name:"Disciple of Life",type:"info",description:"Healing spells restore additional 2 + spell level HP",minLevel:1},{name:"Preserve Life",type:"pool",maxPool:i=>i*5,resetOn:"short",description:"Restore HP to creatures within 30 feet",minLevel:2},{name:"Blessed Healer",type:"info",description:"Regain 2 + spell level HP when you cast healing spell",minLevel:6},{name:"Divine Strike",type:"info",description:i=>`Deal extra ${i>=14?"2d8":"1d8"} radiant damage once per turn`,minLevel:8,rollable:!0,rollFormula:i=>i>=14?"2d8":"1d8"},{name:"Supreme Healing",type:"info",description:"Maximize healing dice instead of rolling",minLevel:17}]}}},barbarian:{name:"Barbarian",hitDice:"d12",spellcaster:!1,features:[{name:"Rage",type:"uses",maxUses:i=>i>=20?1/0:i>=17?6:i>=12?5:i>=6?4:i>=3?3:2,resetOn:"long",description:i=>`+${i>=16?4:i>=9?3:2} damage, resistance to physical damage`,minLevel:1},{name:"Reckless Attack",type:"info",description:"Gain advantage on melee attacks, enemies get advantage on you",minLevel:2},{name:"Danger Sense",type:"info",description:"Advantage on Dex saves against effects you can see",minLevel:2}],subclasses:{berserker:{name:"Path of the Berserker",features:[{name:"Frenzy",type:"info",description:"While raging, make melee attack as bonus action (gain 1 exhaustion after rage)",minLevel:3},{name:"Mindless Rage",type:"info",description:"Cannot be charmed or frightened while raging",minLevel:6},{name:"Intimidating Presence",type:"info",description:"Use action to frighten creature within 30 feet",minLevel:10},{name:"Retaliation",type:"info",description:"When damaged by creature within 5 feet, make melee attack as reaction",minLevel:14}]}}}};function na(i){const o=i.toLowerCase();return as[o]||null}function Sa(i,o,t){const v=na(i);if(!v)return[];const d=v.features.filter(p=>!p.minLevel||p.minLevel<=o);if(t&&v.subclasses&&v.subclasses[t]){const p=v.subclasses[t].features.filter(m=>!m.minLevel||m.minLevel<=o);return[...d,...p]}return d}function fs(i){const o=na(i);return!o||!o.subclasses?[]:Object.keys(o.subclasses).map(t=>({id:t,name:o.subclasses[t].name}))}function ps(i,o){const t=na(i);return!t||!t.spellcaster||!t.spellSlotsByLevel?0:t.spellSlotsByLevel[o]||0}function ms(i,o,t){const v=na(i);return!v||!v.spellcaster?0:Math.max(1,t+o)}function fl(i,o,t){const v=na(i);return!v||!v.spellcaster?null:8+o+t}function pl(){return Object.keys(as).map(i=>({id:i,name:as[i].name}))}var ml=f('<div class="section-header svelte-ls99y2" role="button" tabindex="0"><h2 class="svelte-ls99y2"> </h2> <span class="collapse-btn svelte-ls99y2"> </span></div>');function ya(i,o){Wt(o,!1);let t=xt(o,"title",8),v=xt(o,"collapsed",8),d=xt(o,"ariaLabel",8,""),p=xt(o,"onToggle",8);qt();var m=ml(),w=l(m),_=l(w,!0);s(w);var k=a(w,2),E=l(k,!0);s(k),s(m),j(()=>{Qe(m,"aria-expanded",!v()),Qe(m,"aria-label",d()),D(_,t()),D(E,v()?"‚ñº":"‚ñ≤")}),L("click",m,function(...M){p()?.apply(this,M)}),L("keydown",m,M=>{(M.key==="Enter"||M.key===" ")&&p()()}),c(i,m),zt()}var gl=f("<option> </option>"),bl=f("<option> </option>"),hl=f('<div class="form-group svelte-172i2fj"><label for="characterSubclass" class="svelte-172i2fj">Subclass</label> <select id="characterSubclass" class="svelte-172i2fj"><option>Select Subclass</option><!></select></div>'),_l=f('<div class="info-grid svelte-172i2fj"><div class="form-group svelte-172i2fj"><label for="characterName" class="svelte-172i2fj">Character Name</label> <input type="text" id="characterName" placeholder="Enter name" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterClass" class="svelte-172i2fj">Class</label> <select id="characterClass" class="svelte-172i2fj"><option>Select Class</option><!></select></div> <!> <div class="form-group svelte-172i2fj"><label for="characterLevel" class="svelte-172i2fj">Level</label> <input type="number" id="characterLevel" min="1" max="20" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterRace" class="svelte-172i2fj">Race</label> <input type="text" id="characterRace" placeholder="e.g., Human" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterBackground" class="svelte-172i2fj">Background</label> <input type="text" id="characterBackground" placeholder="e.g., Soldier" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterAlignment" class="svelte-172i2fj">Alignment</label> <input type="text" id="characterAlignment" placeholder="e.g., Lawful Good" class="svelte-172i2fj"/></div></div>'),yl=f('<section class="character-info svelte-172i2fj"><!> <!></section>');function xl(i,o){Wt(o,!1);const t=()=>st(ue,"$character",d),v=()=>st(Yt,"$collapsedStates",d),[d,p]=ra(),m=S(),w=pl();function _(Q){const U=Q.target;ue.update(H=>(H.class=U.value,H.subclass="",H))}function k(Q){const U=Q.target;ue.update(H=>(H.subclass=U.value,H))}function E(Q){const U=Q.target;ue.update(H=>(H.level=parseInt(U.value)||1,H)),Ss()}Xe(()=>(t(),fs),()=>{r(m,t().class?fs(t().class):[])}),va(),qt();var M=yl(),ee=l(M);{let Q=gt(()=>(v(),n(()=>v().characterInfo?"Expand":"Collapse")));ya(ee,{title:"Character Info",get collapsed(){return v(),n(()=>v().characterInfo)},get ariaLabel(){return e(Q)},onToggle:()=>Yt.update(U=>({...U,characterInfo:!U.characterInfo}))})}var fe=a(ee,2);{var ce=Q=>{var U=_l(),H=l(U),_e=a(l(H),2);De(_e),s(H);var Pe=a(H,2),pe=a(l(Pe),2),Be=l(pe);Be.value=Be.__value="";var Ee=a(Be);_t(Ee,1,()=>w,kt,(Ue,oe)=>{var ve=gl(),ze=l(ve,!0);s(ve);var We={};j(()=>{D(ze,(e(oe),n(()=>e(oe).name))),We!==(We=(e(oe),n(()=>e(oe).id)))&&(ve.value=(ve.__value=(e(oe),n(()=>e(oe).id)))??"")}),c(Ue,ve)}),s(pe);var ae;ts(pe),s(Pe);var ke=a(Pe,2);{var Re=Ue=>{var oe=hl(),ve=a(l(oe),2),ze=l(ve);ze.value=ze.__value="";var We=a(ze);_t(We,1,()=>e(m),kt,(it,nt)=>{var et=bl(),bt=l(et,!0);s(et);var $={};j(()=>{D(bt,(e(nt),n(()=>e(nt).name))),$!==($=(e(nt),n(()=>e(nt).id)))&&(et.value=(et.__value=(e(nt),n(()=>e(nt).id)))??"")}),c(it,et)}),s(ve);var lt;ts(ve),s(oe),j(()=>{lt!==(lt=(t(),n(()=>t().subclass)))&&(ve.value=(ve.__value=(t(),n(()=>t().subclass)))??"",Oa(ve,(t(),n(()=>t().subclass))))}),L("change",ve,k),c(Ue,oe)};h(ke,Ue=>{e(m),n(()=>e(m).length>0)&&Ue(Re)})}var B=a(ke,2),P=a(l(B),2);De(P),s(B);var y=a(B,2),K=a(l(y),2);De(K),s(y);var g=a(y,2),R=a(l(g),2);De(R),s(g);var J=a(g,2),He=a(l(J),2);De(He),s(J),s(U),j(()=>{ae!==(ae=(t(),n(()=>t().class)))&&(pe.value=(pe.__value=(t(),n(()=>t().class)))??"",Oa(pe,(t(),n(()=>t().class)))),Ba(P,(t(),n(()=>t().level)))}),Ie(_e,()=>t().name,Ue=>Lt(ue,n(t).name=Ue,n(t))),L("change",pe,_),L("change",P,E),Ie(K,()=>t().race,Ue=>Lt(ue,n(t).race=Ue,n(t))),Ie(R,()=>t().background,Ue=>Lt(ue,n(t).background=Ue,n(t))),Ie(He,()=>t().alignment,Ue=>Lt(ue,n(t).alignment=Ue,n(t))),c(Q,U)};h(fe,Q=>{v(),n(()=>!v().characterInfo)&&Q(ce)})}s(M),c(i,M),zt(),p()}var kl=f('<div class="ability-card svelte-bbv1xt"><h3 class="svelte-bbv1xt"> </h3> <input type="number" class="ability-score svelte-bbv1xt" min="1" max="30"/> <div class="ability-modifier svelte-bbv1xt"> </div> <div class="roll-buttons svelte-bbv1xt"><button class="roll-btn svelte-bbv1xt">Check</button> <button class="roll-btn svelte-bbv1xt">Save</button></div> <div class="save-proficiency svelte-bbv1xt"><input type="checkbox" class="svelte-bbv1xt"/> <label class="svelte-bbv1xt">Save Prof.</label></div></div>'),wl=f('<div class="proficiency-bonus svelte-bbv1xt"><label for="profBonus">Proficiency Bonus</label> <input type="number" id="profBonus" class="prof-input svelte-bbv1xt"/></div> <div class="abilities-grid svelte-bbv1xt"></div>',1),$l=f("<section><!> <!></section>");function Sl(i,o){Wt(o,!1);const t=()=>st(Fa,"$abilityModifiers",w),v=()=>st(ue,"$character",w),d=()=>st(ga,"$searchFilter",w),p=()=>st(Yt,"$collapsedStates",w),m=()=>st(ha,"$isEditMode",w),[w,_]=ra(),k=S(),E=S(),M=_a(),ee=[{key:"strength",label:"Strength"},{key:"dexterity",label:"Dexterity"},{key:"constitution",label:"Constitution"},{key:"intelligence",label:"Intelligence"},{key:"wisdom",label:"Wisdom"},{key:"charisma",label:"Charisma"}];function fe(){Ss()}function ce(Be){const Ee=t()[Be],ae=`1d20${Ee>=0?"+":""}${Ee}`,ke=[];ke.push({value:"1d20",source:"base die"}),Ee!==0&&ke.push({value:Ee,source:Be}),M("roll",{notation:ae,rollType:"check",bonusBreakdown:ke})}function Q(Be){const Ee=t()[Be],ae=v().saveProficiencies[Be]?v().proficiencyBonus:0,ke=Ee+ae,Re=`1d20${ke>=0?"+":""}${ke}`,B=[];B.push({value:"1d20",source:"base die"}),Ee!==0&&B.push({value:Ee,source:Be}),ae!==0&&B.push({value:ae,source:"proficiency"}),M("roll",{notation:Re,rollType:"save",bonusBreakdown:B})}Xe(()=>d(),()=>{r(k,ee.filter(({label:Be})=>d()?Be.toLowerCase().includes(d().toLowerCase()):!0))}),Xe(()=>(e(k),d()),()=>{r(E,e(k).length>0||!d()||d().toLowerCase().includes("proficiency"))}),va(),qt();var U=$l();let H;var _e=l(U);ya(_e,{title:"Ability Scores",get collapsed(){return p(),n(()=>p().abilityScores)},ariaLabel:"Toggle Ability Scores Section",onToggle:()=>Yt.update(Be=>({...Be,abilityScores:!Be.abilityScores}))});var Pe=a(_e,2);{var pe=Be=>{var Ee=wl(),ae=Ae(Ee),ke=a(l(ae),2);De(ke),s(ae);var Re=a(ae,2);_t(Re,5,()=>e(k),kt,(B,P)=>{let y=()=>e(P).key,K=()=>e(P).label;var g=kl(),R=l(g),J=l(R,!0);s(R);var He=a(R,2);De(He);var Ue=a(He,2),oe=l(Ue);s(Ue);var ve=a(Ue,2),ze=l(ve),We=a(ze,2);s(ve);var lt=a(ve,2),it=l(lt);De(it);var nt=a(it,2);s(lt),s(g),j(et=>{D(J,et),D(oe,`${t(),y(),n(()=>t()[y()]>=0?"+":"")??""}${t(),y(),n(()=>t()[y()])??""}`),it.disabled=!m(),Qe(it,"id",`${y()}-save`),Qe(nt,"for",`${y()}-save`)},[()=>(K(),n(()=>K().substring(0,3).toUpperCase()))]),Ie(He,()=>v().abilities[y()],et=>Lt(ue,n(v).abilities[y()]=et,n(v))),L("change",He,fe),L("click",ze,()=>ce(y())),L("click",We,()=>Q(y())),wa(it,()=>v().saveProficiencies[y()],et=>Lt(ue,n(v).saveProficiencies[y()]=et,n(v))),c(B,g)}),s(Re),Ie(ke,()=>v().proficiencyBonus,B=>Lt(ue,n(v).proficiencyBonus=B,n(v))),c(Be,Ee)};h(Pe,Be=>{p(),n(()=>!p().abilityScores)&&Be(pe)})}s(U),j(()=>H=St(U,1,"ability-scores svelte-bbv1xt",null,H,{hidden:!e(E)})),c(i,U),zt(),_()}const Ls=[{name:"Unarmored",type:"none",baseAC:10},{name:"Padded",type:"light",baseAC:11},{name:"Leather",type:"light",baseAC:11},{name:"Studded Leather",type:"light",baseAC:12},{name:"Hide",type:"medium",baseAC:12,maxDexBonus:2},{name:"Chain Shirt",type:"medium",baseAC:13,maxDexBonus:2},{name:"Scale Mail",type:"medium",baseAC:14,maxDexBonus:2},{name:"Breastplate",type:"medium",baseAC:14,maxDexBonus:2},{name:"Half Plate",type:"medium",baseAC:15,maxDexBonus:2},{name:"Ring Mail",type:"heavy",baseAC:14,maxDexBonus:0},{name:"Chain Mail",type:"heavy",baseAC:16,maxDexBonus:0},{name:"Splint",type:"heavy",baseAC:17,maxDexBonus:0},{name:"Plate",type:"heavy",baseAC:18,maxDexBonus:0}];function js(i){return Ls.find(o=>o.name===i)}function Cl(i,o,t){if(!i)return 10+o+(t?2:0);const v=js(i);if(!v)return 10+o+(t?2:0);let d=v.baseAC;return v.maxDexBonus===void 0?d+=o:v.maxDexBonus>0&&(d+=Math.min(o,v.maxDexBonus)),t&&(d+=2),d}function Pa(i){return Math.floor((i-10)/2)}function ss(i,o){if(!i.class)return null;const t=na(i.class);if(!t||!t.spellcaster||!t.spellcastingAbility)return null;const v=Pa(o[t.spellcastingAbility]);return 8+i.proficiencyBonus+v}function gs(i,o){if(!i.class)return 0;const t=na(i.class);return!t||!t.spellcaster||!t.spellcastingAbility?0:Pa(o[t.spellcastingAbility])}function Dl(i,o){const t=[],v=Pa(o.dexterity),d=i.armorName?js(i.armorName):void 0;if(d){if(d.type==="none")t.push("Unarmored"),t.push("Base: 10"),t.push(`Dexterity: ${v>=0?"+":""}${v}`);else if(d.type==="light")t.push(`${d.name}: ${d.baseAC}`),t.push(`Dexterity: ${v>=0?"+":""}${v}`);else if(d.type==="medium"){const p=Math.min(2,v);t.push(`${d.name}: ${d.baseAC}`),t.push(`Dexterity: ${p>=0?"+":""}${p} (max +2)`)}else d.type==="heavy"&&(t.push(`${d.name}: ${d.baseAC}`),t.push("Dexterity: +0 (heavy armor)"));i.shieldEquipped&&t.push("Shield: +2")}else{t.push("Base: 10"),v!==0&&t.push(`Dexterity: ${v>=0?"+":""}${v}`);const p=10+v,m=i.armorClass-p;m!==0&&t.push(`Other: ${m>=0?"+":""}${m}`)}return i.activeStates&&i.activeStates.length>0&&i.activeStates.forEach(p=>{typeof p.acBonus=="number"&&p.acBonus!==0&&(!p.target||p.target==="self")&&t.push(`${p.name}: ${p.acBonus>=0?"+":""}${p.acBonus}`)}),t.join(`
`)}function Ll(i,o){const t=[],v=Pa(o.dexterity);t.push(`Dexterity: ${v>=0?"+":""}${v}`);const d=i.initiative-v;return d!==0&&t.push(`Other Bonuses: ${d>=0?"+":""}${d}`),t.join(`
`)}function jl(i,o){if(!i.class)return"";const t=na(i.class);if(!t||!t.spellcaster||!t.spellcastingAbility)return"";const v=[],d=Pa(o[t.spellcastingAbility]),p=t.spellcastingAbility.charAt(0).toUpperCase()+t.spellcastingAbility.slice(1);return v.push("Base: 8"),v.push(`Proficiency: +${i.proficiencyBonus}`),v.push(`${p}: ${d>=0?"+":""}${d}`),v.join(`
`)}function Al(i,o,t){const v=[];let d=i;const p=o.toLowerCase().trim();if(t.activeStates){for(const m of t.activeStates)if(m.immunities&&m.immunities.length>0&&m.immunities.some(_=>_.toLowerCase().trim()===p))return v.push(`Immune to ${o} (${m.name})`),{finalDamage:0,adjustments:v}}if(t.activeStates){for(const m of t.activeStates)if(m.resistances&&m.resistances.length>0&&m.resistances.some(_=>_.toLowerCase().trim()===p)){const _=Math.floor(d/2);v.push(`Resistant to ${o} (${m.name}): ${d} ‚Üí ${_}`),d=_;break}}return v.length===0&&v.push(`No adjustments for ${o}`),{finalDamage:d,adjustments:v}}function Bl(i,o){const t={...i};if(t.tempHP>0){if(o<=t.tempHP)return t.tempHP-=o,t;o-=t.tempHP,t.tempHP=0}return t.currentHP=Math.max(0,t.currentHP-o),t}var Rl=f('<button class="info-icon svelte-1o8ci7b" type="button">‚ÑπÔ∏è</button>'),Ml=f('<button class="info-icon svelte-1o8ci7b" type="button">‚ÑπÔ∏è</button>'),Fl=f("<div><!></div>"),Pl=f('<div class="tooltip-wrapper svelte-1o8ci7b"><!> <!></div>');function Ya(i,o){Wt(o,!1);let t=xt(o,"tooltipContent",8),v=xt(o,"ariaLabel",8,"Show information"),d=S(!1),p=S(),m=S(!1),w=S(null),_=S(!1),k=S(!1),E=S("");const M=Math.random().toString(36).slice(2);function ee(){window.dispatchEvent(new CustomEvent("tooltip-open",{detail:M}))}function fe(B){B.detail!==M&&(r(d,!1),r(_,!1))}function ce(){r(m,window.matchMedia("(pointer: coarse)").matches||"ontouchstart"in window)}function Q(){if(!e(w)||!e(p))return;const B=e(p).getBoundingClientRect(),P=e(w).getBoundingClientRect();let y=B.bottom+5,K=B.left;r(_,!1),K+P.width>window.innerWidth-8&&(K=B.right-P.width,r(_,!0),K<8&&(K=8)),K<8&&(K=8),y+P.height>window.innerHeight-8&&(y=B.top-P.height-5),r(E,`position:fixed;top:${y}px;left:${K}px;z-index:1000;`),r(k,!0)}function U(){ee(),r(d,!1),r(k,!1),requestAnimationFrame(()=>{r(d,!0),r(k,!1),setTimeout(Q,0)})}function H(){r(d,!1),r(_,!1)}function _e(B){B.stopPropagation(),e(d)?(r(d,!1),r(_,!1),r(k,!1)):(ee(),r(d,!1),r(k,!1),requestAnimationFrame(()=>{r(d,!0),r(k,!1),setTimeout(Q,0)}))}function Pe(B){e(p)&&!e(p).contains(B.target)&&(r(d,!1),r(_,!1))}Ca(()=>{ce(),document.addEventListener("click",Pe),window.addEventListener("tooltip-open",fe)}),Ms(()=>{document.removeEventListener("click",Pe),window.removeEventListener("tooltip-open",fe)}),qt();var pe=Pl(),Be=l(pe);{var Ee=B=>{var P=Rl();j(()=>Qe(P,"aria-label",v())),L("click",P,_e),c(B,P)},ae=B=>{var P=Ml();j(()=>Qe(P,"aria-label",v())),L("mouseenter",P,U),L("mouseleave",P,H),c(B,P)};h(Be,B=>{e(m)?B(Ee):B(ae,!1)})}var ke=a(Be,2);{var Re=B=>{var P=Fl(),y=l(P);nl(y,o,"content",{},K=>{var g=dt(),R=Ae(g);il(R,t),c(K,g)}),s(P),Ra(P,K=>r(w,K),()=>e(w)),j(()=>{St(P,1,`tooltip-popup ${e(_)?"right-align":""}`,"svelte-1o8ci7b"),rl(P,e(k)?e(E)+"opacity:1;pointer-events:auto;":"opacity:0;pointer-events:none;position:fixed;top:0;left:0;z-index:1000;")}),c(B,P)};h(ke,B=>{e(d)&&B(Re)})}s(pe),Ra(pe,B=>r(p,B),()=>e(p)),c(i,pe),zt()}var Tl=f("<option> </option>"),Il=f('<div class="armor-config svelte-1r5hyyb"><h4 class="svelte-1r5hyyb">Armor Configuration</h4> <div class="armor-controls svelte-1r5hyyb"><div class="armor-field svelte-1r5hyyb"><label for="armorName" class="svelte-1r5hyyb">Armor</label> <select id="armorName" class="armor-select svelte-1r5hyyb"><option>None (Unarmored)</option><!></select></div> <div class="armor-field svelte-1r5hyyb"><label class="shield-label svelte-1r5hyyb"><input type="checkbox" class="shield-checkbox svelte-1r5hyyb"/> Shield Equipped (+2 AC)</label></div></div></div>'),El=f('<div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="spellSaveDC" class="svelte-1r5hyyb">Spell Save DC</label> <!></div> <input type="number" id="spellSaveDC" class="stat-input svelte-1r5hyyb" readonly=""/></div>'),Hl=f('<span class="hit-dice-type"> </span>'),Ul=f('<!> <div class="stats-grid svelte-1r5hyyb"><div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="armorClass" class="svelte-1r5hyyb">Armor Class</label> <!></div> <input type="text" id="armorClass" readonly=""/></div> <div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="initiative" class="svelte-1r5hyyb">Initiative</label> <!></div> <input type="text" id="initiative" class="stat-input svelte-1r5hyyb" readonly=""/></div> <div class="stat-box svelte-1r5hyyb"><label for="speed" class="svelte-1r5hyyb">Speed</label> <input type="text" id="speed" class="stat-input svelte-1r5hyyb"/></div> <!></div> <div class="hp-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Points</h3> <div><div class="hp-inputs svelte-1r5hyyb"><input type="number" class="hp-current svelte-1r5hyyb" min="0"/> <span class="hp-separator svelte-1r5hyyb">/</span> <input type="number" class="hp-max svelte-1r5hyyb" min="0"/></div> <div class="hp-controls svelte-1r5hyyb"><button class="hp-btn svelte-1r5hyyb">‚àí</button> <button class="hp-btn svelte-1r5hyyb">+</button> <button class="hp-btn svelte-1r5hyyb">‚àí5</button> <button class="hp-btn svelte-1r5hyyb">+5</button></div></div> <div class="temp-hp svelte-1r5hyyb"><label for="tempHP" class="svelte-1r5hyyb">Temp HP</label> <input type="number" id="tempHP" min="0" class="svelte-1r5hyyb"/></div></div> <div class="hit-dice-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Dice</h3> <div class="hit-dice-display svelte-1r5hyyb"><input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <span>/</span> <input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <!></div> <div class="hit-dice-controls svelte-1r5hyyb"><label for="hitDiceCount" class="svelte-1r5hyyb">Roll</label> <div class="hit-dice-count-controls svelte-1r5hyyb"><button class="hit-dice-btn svelte-1r5hyyb">‚àí</button> <input type="number" id="hitDiceCount" class="hit-dice-count-input svelte-1r5hyyb" min="1"/> <button class="hit-dice-btn svelte-1r5hyyb">+</button></div> <button class="btn btn-primary roll-hit-dice use-enabled svelte-1r5hyyb">üé≤ Roll</button></div></div>',1),Nl=f("<section><!> <!></section>");function Ol(i,o){Wt(o,!1);const t=()=>st(ue,"$character",w),v=()=>st(Fa,"$abilityModifiers",w),d=()=>st(ga,"$searchFilter",w),p=()=>st(Yt,"$collapsedStates",w),m=()=>st(ha,"$isEditMode",w),[w,_]=ra(),k=S(),E=S(),M=S(),ee=S(),fe=S(),ce=S(),Q=S(),U=_a();let H=S(1);function _e(B){ue.update(P=>(P.currentHP=Math.max(0,Math.min(P.maxHP,P.currentHP+B)),P))}function Pe(B){const P=e(H)+B,y=t().hitDice.current;r(H,Math.max(1,Math.min(y,P)))}function pe(B=1){if(t().hitDice.current<=0){alert("No hit dice remaining!");return}if(!t().class){alert("Please select a class first!");return}const P=na(t().class);if(!P){alert("Invalid class configuration!");return}const y=Math.min(B,t().hitDice.current),K=P.hitDice,g=v().constitution,R=g*y,J=R>=0?`+${R}`:`${R}`,He=`${y}${K}${J}`,Ue=[];if(Ue.push({value:`${y}${K}`,source:"hit dice"}),g!==0)for(let oe=0;oe<y;oe++)Ue.push({value:g,source:"constitution"});U("rollHitDice",{notation:He,hitDie:K,count:y,bonusBreakdown:Ue})}Xe(()=>(t(),v(),ue),()=>{if(t().armorName!==void 0||t().shieldEquipped!==void 0){const B=v().dexterity,P=Cl(t().armorName,B,t().shieldEquipped||!1);t().armorClass!==P&&ue.update(y=>({...y,armorClass:P}))}}),Xe(()=>(v(),t(),ue),()=>{const B=v().dexterity;t().initiative!==B&&ue.update(P=>({...P,initiative:B}))}),Xe(()=>t(),()=>{r(k,ss(t(),t().abilities))}),Xe(()=>t(),()=>{r(E,Dl(t(),t().abilities))}),Xe(()=>t(),()=>{r(M,Ll(t(),t().abilities))}),Xe(()=>t(),()=>{r(ee,jl(t(),t().abilities))}),Xe(()=>(t(),e(H)),()=>{const B=t().hitDice.current;B>0&&e(H)>B&&r(H,B)}),Xe(()=>t(),()=>{r(fe,t().activeStates&&t().activeStates.length>0?t().activeStates.reduce((B,P)=>B+(P.acBonus||0),0):0)}),Xe(()=>t(),()=>{r(ce,t().activeStates&&t().activeStates.length>0?t().activeStates.some(B=>B.name==="Aid"&&B.target==="self"):!1)}),Xe(()=>d(),()=>{r(Q,!d()||"armor class".includes(d().toLowerCase())||"initiative".includes(d().toLowerCase())||"speed".includes(d().toLowerCase())||"hit points".includes(d().toLowerCase())||"hp".includes(d().toLowerCase())||"hit dice".includes(d().toLowerCase())||"spell save".includes(d().toLowerCase())||"combat".includes(d().toLowerCase()))}),va(),qt();var Be=Nl();let Ee;var ae=l(Be);{let B=gt(()=>(p(),n(()=>p().combatStats?"Expand":"Collapse")));ya(ae,{title:"Combat Stats",get collapsed(){return p(),n(()=>p().combatStats)},get ariaLabel(){return e(B)},onToggle:()=>Yt.update(P=>({...P,combatStats:!P.combatStats}))})}var ke=a(ae,2);{var Re=B=>{var P=Ul(),y=Ae(P);{var K=le=>{var Ge=Il(),he=a(l(Ge),2),x=l(he),V=a(l(x),2);j(()=>{t(),Tt(()=>{})});var ie=l(V);ie.value=(ie.__value=void 0)??"";var ne=a(ie);_t(ne,1,()=>Ls,kt,(Y,Fe)=>{var Ce=dt(),tt=Ae(Ce);{var ot=ft=>{var ht=Tl(),at=l(ht);s(ht);var O={};j(()=>{D(at,`${e(Fe),n(()=>e(Fe).name)??""} (AC ${e(Fe),n(()=>e(Fe).baseAC)??""})`),O!==(O=(e(Fe),n(()=>e(Fe).name)))&&(ht.value=(ht.__value=(e(Fe),n(()=>e(Fe).name)))??"")}),c(ft,ht)};h(tt,ft=>{e(Fe),n(()=>e(Fe).name!=="Unarmored")&&ft(ot)})}c(Y,Ce)}),s(V),s(x);var q=a(x,2),te=l(q),Te=l(te);De(Te),Jt(),s(te),s(q),s(he),s(Ge),Ma(V,()=>t().armorName,Y=>Lt(ue,n(t).armorName=Y,n(t))),wa(Te,()=>t().shieldEquipped,Y=>Lt(ue,n(t).shieldEquipped=Y,n(t))),c(le,Ge)};h(y,le=>{m()&&le(K)})}var g=a(y,2),R=l(g),J=l(R),He=a(l(J),2);Ya(He,{get tooltipContent(){return e(E)},ariaLabel:"Show AC breakdown"}),s(J);var Ue=a(J,2);De(Ue),s(R);var oe=a(R,2),ve=l(oe),ze=a(l(ve),2);Ya(ze,{get tooltipContent(){return e(M)},ariaLabel:"Show Initiative breakdown"}),s(ve);var We=a(ve,2);De(We),s(oe);var lt=a(oe,2),it=a(l(lt),2);De(it),s(lt);var nt=a(lt,2);{var et=le=>{var Ge=El(),he=l(Ge),x=a(l(he),2);Ya(x,{get tooltipContent(){return e(ee)},ariaLabel:"Show Spell Save DC breakdown"}),s(he);var V=a(he,2);De(V),s(Ge),j(()=>Ba(V,e(k))),c(le,Ge)};h(nt,le=>{e(k)!==null&&le(et)})}s(g);var bt=a(g,2),$=a(l(bt),2);let N;var T=l($),C=l(T);De(C);var I=a(C,4);De(I),s(T);var Z=a(T,2),ge=l(Z),Se=a(ge,2),re=a(Se,2),ye=a(re,2);s(Z),s($);var z=a($,2),A=a(l(z),2);De(A),s(z),s(bt);var Le=a(bt,2),Ve=a(l(Le),2),Me=l(Ve);De(Me);var Ze=a(Me,4);De(Ze);var se=a(Ze,2);{var u=le=>{const Ge=gt(()=>(W(na),t(),n(()=>na(t().class))));var he=dt(),x=Ae(he);{var V=ie=>{const ne=gt(()=>(v(),n(()=>v().constitution)));var q=Hl(),te=l(q);s(q),j(()=>D(te,`(${W(e(Ge)),n(()=>e(Ge).hitDice)??""}${(e(ne)>=0?`+${e(ne)}`:e(ne))??""})`)),c(ie,q)};h(x,ie=>{e(Ge)&&ie(V)})}c(le,he)};h(se,le=>{t(),n(()=>t().class)&&le(u)})}s(Ve);var we=a(Ve,2),be=a(l(we),2),G=l(be),je=a(G,2);De(je);var de=a(je,2);s(be);var $e=a(be,2);s(we),s(Le),j(()=>{Ba(Ue,(e(fe),t(),n(()=>e(fe)!==0?`${t().armorClass} ‚Üí ${t().armorClass+e(fe)}`:`${t().armorClass}`))),St(Ue,1,Xs(e(fe)!==0?"stat-input ac-enhanced":"stat-input"),"svelte-1r5hyyb"),Ba(We,(t(),n(()=>t().initiative))),N=St($,1,"hp-display svelte-1r5hyyb",null,N,{"aid-active":e(ce)}),Qe(C,"max",(t(),n(()=>t().maxHP))),Qe(Me,"max",(t(),n(()=>t().hitDice.max))),G.disabled=e(H)<=1,Qe(je,"max",(t(),n(()=>t().hitDice.current))),de.disabled=(e(H),t(),n(()=>e(H)>=t().hitDice.current)),$e.disabled=(t(),n(()=>t().hitDice.current<=0||!t().class))}),Ie(it,()=>t().speed,le=>Lt(ue,n(t).speed=le,n(t))),Ie(C,()=>t().currentHP,le=>Lt(ue,n(t).currentHP=le,n(t))),Ie(I,()=>t().maxHP,le=>Lt(ue,n(t).maxHP=le,n(t))),L("click",ge,()=>_e(-1)),L("click",Se,()=>_e(1)),L("click",re,()=>_e(-5)),L("click",ye,()=>_e(5)),Ie(A,()=>t().tempHP,le=>Lt(ue,n(t).tempHP=le,n(t))),Ie(Me,()=>t().hitDice.current,le=>Lt(ue,n(t).hitDice.current=le,n(t))),Ie(Ze,()=>t().hitDice.max,le=>Lt(ue,n(t).hitDice.max=le,n(t))),L("click",G,()=>Pe(-1)),Ie(je,()=>e(H),le=>r(H,le)),L("input",je,le=>{const Ge=le.target,he=parseInt(Ge.value);he>t().hitDice.current&&r(H,t().hitDice.current),he<1&&r(H,1)}),L("click",de,()=>Pe(1)),L("click",$e,()=>pe(e(H))),c(B,P)};h(ke,B=>{p(),n(()=>!p().combatStats)&&B(Re)})}s(Be),j(()=>Ee=St(Be,1,"combat-stats svelte-1r5hyyb",null,Ee,{hidden:!e(Q)})),c(i,Be),zt(),_()}const Ea={acrobatics:"dexterity",animalHandling:"wisdom",arcana:"intelligence",athletics:"strength",deception:"charisma",history:"intelligence",insight:"wisdom",intimidation:"charisma",investigation:"intelligence",medicine:"wisdom",nature:"intelligence",perception:"wisdom",performance:"charisma",persuasion:"charisma",religion:"intelligence",sleightOfHand:"dexterity",stealth:"dexterity",survival:"wisdom"};var Gl=f('<div class="skill-row svelte-1f1pl16"><input type="checkbox" class="svelte-1f1pl16"/> <label class="svelte-1f1pl16"> <span class="ability-tag svelte-1f1pl16"> </span></label> <span class="skill-modifier svelte-1f1pl16"> </span> <button class="roll-btn svelte-1f1pl16">Roll</button></div>'),ql=f('<div class="skills-grid svelte-1f1pl16"></div>'),Wl=f("<section><!> <!></section>");function zl(i,o){Wt(o,!1);const t=()=>st(ue,"$character",w),v=()=>st(Fa,"$abilityModifiers",w),d=()=>st(ga,"$searchFilter",w),p=()=>st(Yt,"$collapsedStates",w),m=()=>st(ha,"$isEditMode",w),[w,_]=ra(),k=S(),E=S(),M=S(),ee=S(),fe=S(),ce=S(),Q=_a(),U=[{key:"acrobatics",label:"Acrobatics"},{key:"animalHandling",label:"Animal Handling"},{key:"arcana",label:"Arcana"},{key:"athletics",label:"Athletics"},{key:"deception",label:"Deception"},{key:"history",label:"History"},{key:"insight",label:"Insight"},{key:"intimidation",label:"Intimidation"},{key:"investigation",label:"Investigation"},{key:"medicine",label:"Medicine"},{key:"nature",label:"Nature"},{key:"perception",label:"Perception"},{key:"performance",label:"Performance"},{key:"persuasion",label:"Persuasion"},{key:"religion",label:"Religion"},{key:"sleightOfHand",label:"Sleight of Hand"},{key:"stealth",label:"Stealth"},{key:"survival",label:"Survival"}];function H(ae){const ke=Ea[ae],Re=v()[ke],B=t().skillProficiencies[ae]?t().proficiencyBonus:0,P=e(k)[ae],y=`1d20${P>=0?"+":""}${P}`,K=[];K.push({value:"1d20",source:"base die"}),Re!==0&&K.push({value:Re,source:ke}),B!==0&&K.push({value:B,source:"proficiency"}),Q("roll",{notation:y,rollType:"check",bonusBreakdown:K})}Xe(()=>{},()=>{r(k,{})}),Xe(()=>t(),()=>{r(E,t().skillProficiencies)}),Xe(()=>t(),()=>{r(M,t().proficiencyBonus)}),Xe(()=>v(),()=>{r(ee,v())}),Xe(()=>(e(ee),e(E),e(M)),()=>{for(const{key:ae}of U){const ke=Ea[ae],Re=e(ee)[ke],B=e(E)[ae]?e(M):0;ma(k,e(k)[ae]=Re+B)}}),Xe(()=>d(),()=>{r(fe,U.filter(({label:ae})=>d()?ae.toLowerCase().includes(d().toLowerCase()):!0))}),Xe(()=>e(fe),()=>{r(ce,e(fe).length>0)}),va(),qt();var _e=Wl();let Pe;var pe=l(_e);{let ae=gt(()=>(p(),n(()=>p().skills?"Expand":"Collapse")));ya(pe,{title:"Skills",get collapsed(){return p(),n(()=>p().skills)},get ariaLabel(){return e(ae)},onToggle:()=>Yt.update(ke=>({...ke,skills:!ke.skills}))})}var Be=a(pe,2);{var Ee=ae=>{var ke=ql();_t(ke,5,()=>e(fe),kt,(Re,B)=>{let P=()=>e(B).key,y=()=>e(B).label;var K=Gl(),g=l(K);De(g);var R=a(g,2),J=l(R),He=a(J),Ue=l(He);s(He),s(R);var oe=a(R,2),ve=l(oe);s(oe);var ze=a(oe,2);s(K),j(We=>{Cs(g,(e(E),P(),n(()=>e(E)[P()]))),g.disabled=!m(),Qe(g,"id",P()),Qe(R,"for",P()),D(J,`${y()??""} `),D(Ue,`(${We??""})`),D(ve,`${e(k),P(),n(()=>e(k)[P()]>=0?"+":"")??""}${e(k),P(),n(()=>e(k)[P()])??""}`)},[()=>(W(Ea),P(),n(()=>Ea[P()].substring(0,3).toUpperCase()))]),L("change",g,We=>{console.log("Skill proficiency changed:",P(),We.target.checked),ue.update(lt=>({...lt,skillProficiencies:{...lt.skillProficiencies,[P()]:We.target.checked}}))}),L("click",ze,()=>H(P())),c(Re,K)}),s(ke),c(ae,ke)};h(Be,ae=>{p(),n(()=>!p().skills)&&ae(Ee)})}s(_e),j(()=>Pe=St(_e,1,"skills svelte-1f1pl16",null,Pe,{hidden:!e(ce)})),c(i,_e),zt(),_()}var Kl=f('<p class="empty-message svelte-1123ljy">No attacks or spells to reorder.</p>'),Vl=f('<li class="reorder-item svelte-1123ljy"><span class="attack-name svelte-1123ljy"> </span> <div class="reorder-buttons svelte-1123ljy"><button class="btn-move svelte-1123ljy" aria-label="Move up">‚ñ≤</button> <button class="btn-move svelte-1123ljy" aria-label="Move down">‚ñº</button></div></li>'),Jl=f('<ul class="reorder-list svelte-1123ljy"></ul>'),Yl=f('<div class="modal-backdrop svelte-1123ljy" role="presentation"><div class="modal-content svelte-1123ljy" role="dialog" aria-modal="true" aria-labelledby="modal-title"><div class="modal-header svelte-1123ljy"><h3 id="modal-title" class="svelte-1123ljy">Reorder Attacks & Spells</h3> <button class="btn-close svelte-1123ljy" aria-label="Close">√ó</button></div> <div class="modal-body svelte-1123ljy"><!></div> <div class="modal-footer svelte-1123ljy"><button class="btn btn-secondary svelte-1123ljy">Cancel</button> <button class="btn btn-primary svelte-1123ljy">Save Order</button></div></div></div>');function Ql(i,o){Wt(o,!1);let t=xt(o,"show",8,!1),v=xt(o,"attacks",24,()=>[]),d=xt(o,"onSave",8),p=xt(o,"onCancel",8),m=S([]);function w(U,H){const _e=e(m)[U];ma(m,e(m)[U]=e(m)[H]),ma(m,e(m)[H]=_e),r(m,[...e(m)])}function _(U){U>0&&w(U,U-1)}function k(U){U<e(m).length-1&&w(U,U+1)}function E(){d()(e(m))}function M(){p()()}function ee(U){U.target===U.currentTarget&&M()}Xe(()=>(W(t()),W(v())),()=>{t()&&r(m,[...v()])}),va(),qt();var fe=dt(),ce=Ae(fe);{var Q=U=>{var H=Yl(),_e=l(H),Pe=l(_e),pe=a(l(Pe),2);s(Pe);var Be=a(Pe,2),Ee=l(Be);{var ae=y=>{var K=Kl();c(y,K)},ke=y=>{var K=Jl();_t(K,7,()=>e(m),g=>g.id,(g,R,J)=>{var He=Vl(),Ue=l(He),oe=l(Ue,!0);s(Ue);var ve=a(Ue,2),ze=l(ve),We=a(ze,2);s(ve),s(He),j(()=>{D(oe,(e(R),n(()=>e(R).name||"(Unnamed attack or spell)"))),ze.disabled=e(J)===0,We.disabled=(W(e(J)),e(m),n(()=>e(J)===e(m).length-1))}),L("click",ze,()=>_(e(J))),L("click",We,()=>k(e(J))),c(g,He)}),s(K),c(y,K)};h(Ee,y=>{e(m),n(()=>e(m).length===0)?y(ae):y(ke,!1)})}s(Be);var Re=a(Be,2),B=l(Re),P=a(B,2);s(Re),s(_e),s(H),L("click",pe,M),L("click",B,M),L("click",P,E),L("click",H,ee),c(U,H)};h(ce,U=>{t()&&U(Q)})}c(i,fe),zt()}let Ha=null,Ua=null;async function As(){if(Ha)return Ha;try{return Ha=await(await fetch(Ds("/data/spells.json"))).json(),Ha||[]}catch(i){return console.error("Failed to load spells:",i),[]}}async function Xl(){if(Ua)return Ua;try{return Ua=await(await fetch(Ds("/data/feats.json"))).json(),Ua||[]}catch(i){return console.error("Failed to load feats:",i),[]}}function bs(i,o){if(!o.trim())return i;const t=o.toLowerCase();return i.filter(v=>v.name.toLowerCase().includes(t)||v.school.toLowerCase().includes(t)||v.classes.some(d=>d.toLowerCase().includes(t))||v.description.toLowerCase().includes(t))}function Zl(i,o){return o===null?i:i.filter(t=>t.level===o)}function ei(i,o){if(!o.trim())return i;const t=o.toLowerCase();return i.filter(v=>v.name.toLowerCase().includes(t)||v.description.toLowerCase().includes(t))}function Na(i){const o=i.description,t=/\b(Strength|Dexterity|Constitution|Intelligence|Wisdom|Charisma)\s+saving\s+throw/i,v=o.match(t);if(!v)return null;const d=v[1].toLowerCase(),m=/half\s+(?:as\s+much\s+)?damage\s+on\s+a\s+successful(?:\s+save)?/i.test(o),_=/saving\s+throw\s+or\s+take.*?damage/i.test(o)&&!m;return{ability:d,halfDamageOnSave:m,noDamageOnSave:_}}function ti(i){const o=i.description;return/(plus|add)\s+your\s+spellcasting\s+(ability\s+)?modifier/i.test(o)}function Qa(i){const o=i.description.toLowerCase();return o.includes("ranged spell attack")||o.includes("melee spell attack")}function hs(i){const o=i.description.toLowerCase();if(["Divine Favor","Bless","Aid","Command"].includes(i.name))return!0;const d=["takes","take","deals","deal","damage equal to","force damage","fire damage","cold damage","lightning damage","thunder damage","acid damage","poison damage","necrotic damage","radiant damage","psychic damage","regain","regains","hit point"].some(w=>o.includes(w));return["bonus to attack","bonus to damage","bonus to ac","gains a +","gain a +","+1 bonus","+2 bonus","+3 bonus","advantage on","becomes a magic weapon"].some(w=>o.includes(w))&&!d}function ai(i){const o=i.description;let t=0,v=0,d=0,p="";const m=o.match(/\+(\d+)\s+bonus\s+to\s+attack\s+rolls\s+and\s+damage\s+rolls/i);if(m){const _=parseInt(m[1]);t=_,v=_,p=`+${_} to attack and damage rolls`}if(i.name==="Bless"&&(p="Add 1d4 to attack rolls and saves",t="1d4"),i.name==="Aid")return p="+5 HP (max and current) for 8 hours",{attackBonus:0,damageBonus:0,acBonus:0,hpBonus:5,description:p,name:i.name};i.name==="Divine Favor"&&(p="Your weapon attacks deal an extra 1d4 radiant damage on a hit.",v="1d4");const w=o.match(/\+(\d+)\s+bonus\s+to\s+AC/i);return w&&(d=parseInt(w[1]),p=`+${d} to AC`),i.name==="Haste"&&(p="+2 AC, doubled speed, extra action",d=2),p||t!==0||v!==0||d!==0?{attackBonus:t,damageBonus:v,acBonus:d,description:p||i.description.substring(0,100),name:i.name}:null}function Xa(i){const o=i.description,t=/takes?\s+(\d+d\d+)\s+\w+\s+damage[^.]*\.\s*If\s+the\s+target\s+is\s+missing.*?instead\s+takes?\s+(\d+d\d+)/is,v=o.match(t);return v?{baseDamage:v[1],alternateDamage:v[2]}:null}var si=f('<button class="btn btn-secondary">Reorder</button>'),li=f('<div class="edit-buttons svelte-14o91c5"><button class="btn btn-secondary">Add Attack</button> <!></div>'),ii=f('<input type="text" placeholder="Attack name" class="attack-name svelte-14o91c5"/>'),ni=f('<h4 class="attack-name-display svelte-14o91c5"> </h4>'),ri=f('<button class="btn-remove svelte-14o91c5">√ó</button>'),oi=f('<div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Bonus</label> <input type="number" class="attack-bonus svelte-14o91c5"/></div>'),ci=f('<div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Damage</label> <input type="text" placeholder="e.g., 2d6+3" class="attack-damage svelte-14o91c5"/></div>'),vi=f('<div class="spell-info-loading svelte-14o91c5">Loading spell info...</div>'),di=f('<li class="svelte-14o91c5"><strong>At Higher Levels:</strong> </li>'),ui=f('<ul class="svelte-14o91c5"><li class="svelte-14o91c5"><strong>Level:</strong> </li> <li class="svelte-14o91c5"><strong>Casting Time:</strong> </li> <li class="svelte-14o91c5"><strong>Range:</strong> </li> <li class="svelte-14o91c5"><strong>Components:</strong> <!></li> <li class="svelte-14o91c5"><strong>Duration:</strong> <!> </li> <li class="svelte-14o91c5"><strong>Description:</strong> </li> <!></ul>'),fi=f('<span class="scaled-damage svelte-14o91c5" style="margin-left: 8px;"> </span>'),pi=f('<span class="scaled-damage svelte-14o91c5">(Half damage)</span>'),mi=f('<span class="scaled-damage svelte-14o91c5">(No damage)</span>'),gi=f('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> <!> <!></label></div>'),bi=f('<span class="scaled-damage svelte-14o91c5"> </span>'),hi=f('<span class="scaled-damage svelte-14o91c5"> </span>'),_i=f('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> Target is missing HP <!></label></div>'),yi=f("<option> </option>"),xi=f('<span class="scaled-damage svelte-14o91c5"><!> </span>'),ki=f('<span class="scaled-damage svelte-14o91c5"> </span>'),wi=f('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> Target is Fiend or Undead <!></label></div>'),$i=f('<div class="spell-level-selector svelte-14o91c5"><label class="svelte-14o91c5">Cast at Level:</label> <select class="spell-level-select use-enabled svelte-14o91c5"></select> <!></div> <!>',1),Si=f('<div class="spell-level-selector svelte-14o91c5"><span style="color: #dc3545; font-weight: bold;">No spell slots available!</span></div>'),Ci=f('<div class="spell-info svelte-14o91c5"><div class="spell-info-header svelte-14o91c5" role="button" tabindex="0"><h4 class="svelte-14o91c5">Spell Info</h4> <button class="collapse-btn-small svelte-14o91c5"> </button></div> <!></div> <!> <!> <!>',1),Di=f('<div class="spell-info-missing svelte-14o91c5">Spell info not found.</div>'),Li=f('<div class="attack-notes svelte-14o91c5"><label class="svelte-14o91c5">Notes</label> <textarea placeholder="e.g., DC 15 Dex save, Range 120 ft, Concentration" class="notes-input svelte-14o91c5" rows="2"></textarea></div>'),ji=f('<button class="btn btn-primary">Roll Attack</button>'),Ai=f('<div class="buff-target-selection svelte-14o91c5"><div class="target-options svelte-14o91c5"><label class="target-option svelte-14o91c5"><input type="radio" class="svelte-14o91c5"/> Self</label> <label class="target-option svelte-14o91c5"><input type="radio" class="svelte-14o91c5"/> Other</label></div> <button class="btn btn-info"> </button></div>'),Bi=f('<button class="btn btn-info">Cast Spell</button>'),Ri=f("<button><!></button>"),Mi=f('<button class="btn btn-info">Cast Spell</button>'),Fi=f('<button class="btn btn-secondary">Roll Damage</button>'),Pi=f('<button class="btn btn-primary">Roll Attack</button> <!>',1),Ti=f('<div class="attack-card svelte-14o91c5"><div class="attack-header svelte-14o91c5"><!> <!></div> <div class="attack-details svelte-14o91c5"><!> <!> <div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Type</label> <input type="text" placeholder="e.g., slashing" class="attack-type svelte-14o91c5"/></div></div> <!> <!> <div class="attack-actions svelte-14o91c5"><!></div></div>'),Ii=f('<p class="no-attacks svelte-14o91c5">No attacks added yet. Click "Add Attack" to create one.</p>'),Ei=f('<p class="no-attacks svelte-14o91c5">No attacks match your search.</p>'),Hi=f('<span class="ability-uses svelte-14o91c5"> <!></span>'),Ui=f('<span class="ability-reaction svelte-14o91c5">‚ö° Reaction</span>'),Ni=f('<button class="btn btn-ability svelte-14o91c5">Use Ability</button>'),Oi=f('<div class="ability-card svelte-14o91c5"><div class="ability-header svelte-14o91c5"><h4 class="ability-name svelte-14o91c5"> </h4> <span class="ability-source svelte-14o91c5"> </span></div> <p class="ability-description svelte-14o91c5"> </p> <div class="ability-footer svelte-14o91c5"><!> <!> <!></div></div>'),Gi=f('<div class="condition-abilities-section svelte-14o91c5"><h3 class="abilities-header svelte-14o91c5">Condition Abilities</h3> <p class="section-description svelte-14o91c5">Special actions granted by active conditions (e.g., Flicker of Deceit)</p> <div class="abilities-list svelte-14o91c5"></div></div>'),qi=f('<button class="btn-remove svelte-14o91c5">√ó</button>'),Wi=f('<div class="state-card svelte-14o91c5"><div class="state-header svelte-14o91c5"><input type="text" placeholder="Effect name (e.g., Magic Weapon)" class="state-name svelte-14o91c5"/> <!></div> <div class="state-details svelte-14o91c5"><div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Attack Bonus</label> <input type="number" class="state-bonus svelte-14o91c5"/></div> <div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Damage Bonus</label> <input type="text" class="state-bonus svelte-14o91c5"/></div> <div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Target</label> <select class="state-bonus svelte-14o91c5"><option>Self</option><option>Other</option></select></div></div> <div class="state-description svelte-14o91c5"><label class="svelte-14o91c5">Description</label> <input type="text" placeholder="e.g., +1 to attack and damage rolls (Magic Weapon)" class="state-desc-input svelte-14o91c5"/></div></div>'),zi=f('<div class="states-list svelte-14o91c5"></div>'),Ki=f('<p class="no-states svelte-14o91c5">No active effects. Add spell effects that modify your attacks.</p>'),Vi=f('<!> <div class="attacks-list svelte-14o91c5"><!> <!></div> <!> <div class="active-states-section svelte-14o91c5"><h3 class="svelte-14o91c5">Active Spell Effects</h3> <p class="section-description svelte-14o91c5">Effects that modify attack and damage rolls (e.g., Magic Weapon, Bless)</p> <button class="btn btn-secondary">Add Effect</button> <!></div>',1),Ji=f("<section><!> <!></section> <!>",1);function Yi(i,o){Wt(o,!1);const t=()=>st(ue,"$character",w),v=()=>st(Fa,"$abilityModifiers",w),d=()=>st(ga,"$searchFilter",w),p=()=>st(Yt,"$collapsedStates",w),m=()=>st(ha,"$isEditMode",w),[w,_]=ra(),k=S(),E=S(),M=S(),ee=[];function fe($,N){ue.update(T=>{if(!T.activeStates)return T;const C=T.activeStates.findIndex(Se=>Se.name===$);if(C===-1)return T;const I=T.activeStates[C];if(!I.abilities)return T;const Z=I.abilities.findIndex(Se=>Se.name===N);if(Z===-1)return T;const ge=I.abilities[Z];return ge.currentUses!==void 0&&ge.currentUses>0&&(ge.currentUses-=1,ge.usesPerRest!==void 0?It.add(`Used ${N} (${ge.currentUses}/${ge.usesPerRest} remaining)`,"info"):It.add(`Used ${N}`,"info")),T})}const ce=_a();let Q=S({}),U=S({}),H=S(!1);function _e($){ma(Q,e(Q)[$]=!e(Q)[$]),r(Q,{...e(Q)})}function Pe($){return $.description.toLowerCase().includes("regain")&&($.description.toLowerCase().includes("hit point")||$.description.toLowerCase().includes("hp"))}function pe($){return["Shield of Faith","Bless","Aid","Magic Weapon"].includes($)}function Be(){ue.update($=>($.attacks=[...$.attacks,{id:crypto.randomUUID(),name:"",bonus:0,damage:"",damageType:"",notes:""}],$))}function Ee($){ue.update(N=>(N.attacks=N.attacks.filter(T=>T.id!==$),N))}function ae(){r(H,!0)}function ke(){r(H,!1)}function Re($){ue.update(N=>(N.attacks=$,N)),r(H,!1),It.add("Attack order updated successfully!","success")}function B($){let N=$.damage,T=!1,C=!1;if($.spellRef){const re=g($.spellRef);if(re&&(C=Qa(re),re.level>0)){const ye=$.castAtLevel||re.level;if(!R(ye)){It.add(`No level ${ye} spell slots available!`,"error");return}const A=Na(re);A&&$.targetSucceededSave&&A.noDamageOnSave?N="0":(T=A?.halfDamageOnSave&&$.targetSucceededSave||!1,N=J($,re))}}else if(t().activeStates&&t().activeStates.length>0){let re=0,ye=[];for(const z of t().activeStates)z.target!=="other"&&(typeof z.damageBonus=="string"?ye.push(z.damageBonus):typeof z.damageBonus=="number"&&(re+=z.damageBonus));if((re!==0||ye.length>0)&&N){const z=N.match(/(\d+d\d+)([+-]\d+)?/);if(z){const[,A,Le]=z,Me=(Le?parseInt(Le):0)+re;let Ze=`${A}`;Me!==0&&(Ze+=`${Me>=0?"+":""}${Me}`),ye.length>0&&(Ze+=" + "+ye.join(" + ")),N=Ze}}}const I=[];let Z=0;if(C){const re=gs(t(),v()),ye=t().proficiencyBonus||0;I.push({value:ye,source:"proficiency"}),I.push({value:re,source:"spellcasting"}),Z=ye+re}else $.bonus!==0&&I.push({value:$.bonus,source:"base"}),Z=$.bonus;let ge=[];if(t().activeStates)for(const re of t().activeStates)re.target!=="other"&&(typeof re.attackBonus=="number"&&re.attackBonus!==0?(I.push({value:re.attackBonus,source:re.name.toLowerCase()}),Z+=re.attackBonus):typeof re.attackBonus=="string"&&re.attackBonus&&(ge.push(re.attackBonus),I.push({value:re.attackBonus,source:re.name.toLowerCase()})));let Se=`1d20${Z>=0?"+":""}${Z}`;ge.length>0&&(Se+="+"+ge.join("+")),ce("roll",{notation:Se,damageNotation:N,attackName:$.name,applyHalfDamage:T,bonusBreakdown:I,rollType:"attack"})}function P($){if(!$.damage){It.add(`${$.name}: No damage specified`,"error");return}let N=$.damage,T=!1;const C=[];if($.spellRef){const I=g($.spellRef);if(I&&I.level>0){const Z=$.castAtLevel||I.level;if(!R(Z)){It.add(`No level ${Z} spell slots available!`,"error");return}const Se=Na(I);Se&&$.targetSucceededSave&&Se.noDamageOnSave?N="0":(T=Se?.halfDamageOnSave&&$.targetSucceededSave||!1,N=J($,I))}}else{const I=N.match(/(\d+d\d+)([+-]\d+)?/);if(I){const[,Z,ge]=I,Se=ge?parseInt(ge):0;if(Se!==0&&C.push({value:Se,source:"base"}),t().activeStates&&t().activeStates.length>0){let re=0,ye=[];for(const z of t().activeStates)z.target!=="other"&&(typeof z.damageBonus=="string"?ye.push(z.damageBonus):typeof z.damageBonus=="number"&&z.damageBonus!==0&&(C.push({value:z.damageBonus,source:z.name.toLowerCase()}),re+=z.damageBonus));if(re!==0||ye.length>0){const z=Se+re;let A=`${Z}`;z!==0&&(A+=`${z>=0?"+":""}${z}`),ye.length>0&&(A+=" + "+ye.join(" + ")),N=A}}}}ce("roll",{notation:N,attackName:$.name,applyHalfDamage:T,bonusBreakdown:C})}let y=S([]),K=S(!1);Ca(async()=>{r(y,await As()),r(K,!0)});function g($){return e(y).find(N=>N.name===$)}function R($){t().classFeatures.spellSlotsByLevel||Lt(ue,n(t).classFeatures.spellSlotsByLevel={},n(t)),t().classFeatures.spellSlotsByLevel[$]||Lt(ue,n(t).classFeatures.spellSlotsByLevel[$]=Array(2).fill(!1),n(t));const T=t().classFeatures.spellSlotsByLevel[$].findIndex(C=>!C);return T===-1?!1:(ue.update(C=>(C.classFeatures.spellSlotsByLevel||(C.classFeatures.spellSlotsByLevel={}),C.classFeatures.spellSlotsByLevel[$]||(C.classFeatures.spellSlotsByLevel[$]=Array(2).fill(!1)),C.classFeatures.spellSlotsByLevel[$][T]=!0,C)),!0)}function J($,N){let T=$.damage,C=0,I=0;const Z=Xa(N);if(Z&&$.targetIsDamaged&&(T=Z.alternateDamage),ti(N)&&(I+=gs(t(),v())),t().activeStates)for(const Me of t().activeStates)Me.target!=="other"&&typeof Me.damageBonus=="number"&&(I+=Me.damageBonus);if(N.higherLevelSlot&&$.castAtLevel){const Me=N.level,se=($.castAtLevel||Me)-Me;if(se>0){const u=N.higherLevelSlot.match(/(\d+)d(\d+)\s+for\s+each.*?level\s+above/i);if(u){const[,we]=u;C+=se*parseInt(we)}}}if($.targetIsFiendOrUndead&&N.description.includes("Fiend or an Undead")){const Me=N.description.match(/increases by (\d+)d(\d+) if.*?Fiend or.*?Undead/i);if(Me){const[,Ze]=Me;C+=parseInt(Ze)}}const ge=T.match(/(\d+)d(\d+)([+-]\d+)?/);if(!ge)return I!==0?I>=0?`${I}`:`${I}`:T||"0";const[,Se,re,ye]=ge,z=parseInt(Se)+C,Le=(ye?parseInt(ye):0)+I;let Ve=`${z}d${re}`;return Le!==0&&(Ve+=Le>=0?`+${Le}`:`${Le}`),Ve}function He($){const N=[];for(let C=$.level;C<=9;C++){const I=t().classFeatures.spellSlotsByLevel?.[C];I&&I.length>0&&N.push(C)}return N}function Ue(){ue.update($=>($.activeStates||($.activeStates=[]),$.activeStates=[...$.activeStates,{name:"",attackBonus:0,damageBonus:0,description:"",target:"self"}],$))}function oe($){ue.update(N=>{if(N.activeStates){const T=N.activeStates[$];T?.hpBonus&&T.target!=="other"&&(N.maxHP-=T.hpBonus,N.currentHP=Math.max(1,Math.min(N.currentHP-T.hpBonus,N.maxHP))),N.activeStates=N.activeStates.filter((C,I)=>I!==$)}return N})}function ve($,N="self"){const T=g($.spellRef);if(!T){It.add("Spell not found","error");return}const C=$.castAtLevel||T.level;if(C>0&&!R(C)){It.add(`No level ${C} spell slots available!`,"error");return}const I=ai(T);if(!I){It.add(`${T.name} cast! Check spell description for effects.`,"info");return}let Z=I.hpBonus||0,ge=I.description;T.name==="Aid"&&C>T.level&&(Z=5+(C-T.level)*5,ge=`+${Z} HP (max and current) for 8 hours`);const re=["Shield of Faith","Bless","Aid","Magic Weapon"].includes(T.name);ue.update(z=>{z.activeStates||(z.activeStates=[]);const A=z.activeStates.find(Le=>Le.name===T.name);return A&&A.hpBonus&&A.target!=="other"&&(z.maxHP-=A.hpBonus,z.currentHP=Math.max(1,Math.min(z.currentHP-A.hpBonus,z.maxHP))),z.activeStates=z.activeStates.filter(Le=>Le.name!==T.name),Z>0&&N==="self"&&(z.maxHP+=Z,z.currentHP+=Z),z.activeStates=[...z.activeStates,{name:T.name,attackBonus:I.attackBonus,damageBonus:I.damageBonus,acBonus:I.acBonus,description:ge,target:N,hpBonus:Z}],z});const ye=N==="self"?" on self":" on other";It.add(`${T.name} cast${re?ye:""}! Effect added to Active Spell Effects.`,"success")}Xe(()=>t(),()=>{r(k,t().activeStates?t().activeStates.filter($=>$.abilities&&$.abilities.length>0).flatMap($=>$.abilities.map(N=>({...N,conditionName:$.name}))):[])}),Xe(()=>(t(),e(Q),e(U)),()=>{if(t()&&t().attacks)for(const $ of t().attacks)$.spellRef&&e(Q)[$.id]===void 0&&ma(Q,e(Q)[$.id]=!0),$.spellRef&&e(U)[$.id]===void 0&&ma(U,e(U)[$.id]="self")}),Xe(()=>(t(),d()),()=>{r(E,t().attacks.filter($=>{if(!d())return!0;const N=d().toLowerCase();return $.name.toLowerCase().includes(N)||$.damageType.toLowerCase().includes(N)}).sort(($,N)=>!$.spellRef&&N.spellRef?-1:$.spellRef&&!N.spellRef?1:0))}),Xe(()=>(d(),e(E)),()=>{r(M,!d()||e(E).length>0||"attack".includes(d().toLowerCase())||"spell".includes(d().toLowerCase()))}),va(),qt();var ze=Ji(),We=Ae(ze);let lt;var it=l(We);{let $=gt(()=>(p(),n(()=>p().attacks?"Expand":"Collapse")));ya(it,{title:"Attacks & Spells",get collapsed(){return p(),n(()=>p().attacks)},get ariaLabel(){return e($)},onToggle:()=>Yt.update(N=>({...N,attacks:!N.attacks}))})}var nt=a(it,2);{var et=$=>{var N=Vi(),T=Ae(N);{var C=se=>{var u=li(),we=l(u),be=a(we,2);{var G=je=>{var de=si();L("click",de,ae),c(je,de)};h(be,je=>{t(),n(()=>t().attacks.length>0)&&je(G)})}s(u),L("click",we,Be),c(se,u)};h(T,se=>{m()&&se(C)})}var I=a(T,2),Z=l(I);_t(Z,1,()=>e(E),se=>se.id,(se,u,we)=>{var be=Ti(),G=l(be),je=l(G);{var de=O=>{var X=ii();De(X),Ie(X,()=>e(u).name,ut=>(e(u).name=ut,Tt(()=>(e(E),t(),d())))),c(O,X)},$e=O=>{var X=ni(),ut=l(X,!0);s(X),j(()=>D(ut,(e(u),n(()=>e(u).name||"(Unnamed Attack)")))),c(O,X)};h(je,O=>{m()?O(de):O($e,!1)})}var le=a(je,2);{var Ge=O=>{var X=ri();L("click",X,()=>Ee(e(u).id)),c(O,X)};h(le,O=>{m()&&O(Ge)})}s(G);var he=a(G,2),x=l(he);{var V=O=>{var X=oi(),ut=l(X),Ye=a(ut,2);De(Ye),s(X),j(()=>{Qe(ut,"for",`attack-bonus-${e(u),n(()=>e(u).id)??""}`),Qe(Ye,"id",`attack-bonus-${e(u),n(()=>e(u).id)??""}`)}),Ie(Ye,()=>e(u).bonus,Ke=>(e(u).bonus=Ke,Tt(()=>(e(E),t(),d())))),c(O,X)};h(x,O=>{e(u),n(()=>e(u).bonus!==0&&e(u).bonus!==void 0)&&O(V)})}var ie=a(x,2);{var ne=O=>{var X=ci(),ut=l(X),Ye=a(ut,2);De(Ye),s(X),j(()=>{Qe(ut,"for",`attack-damage-${e(u),n(()=>e(u).id)??""}`),Qe(Ye,"id",`attack-damage-${e(u),n(()=>e(u).id)??""}`)}),Ie(Ye,()=>e(u).damage,Ke=>(e(u).damage=Ke,Tt(()=>(e(E),t(),d())))),c(O,X)};h(ie,O=>{e(u),n(()=>e(u).damage&&e(u).damage.trim()!=="")&&O(ne)})}var q=a(ie,2),te=l(q),Te=a(te,2);De(Te),s(q),s(he);var Y=a(he,2);{var Fe=O=>{var X=dt(),ut=Ae(X);{var Ye=yt=>{var b=vi();c(yt,b)},Ke=yt=>{const b=gt(()=>(e(u),n(()=>g(e(u).spellRef))));var qe=dt(),F=Ae(qe);{var Ne=Je=>{const xe=gt(()=>(W(Na),W(e(b)),n(()=>Na(e(b))))),ct=gt(()=>(W(Xa),W(e(b)),n(()=>Xa(e(b)))));var rt=Ci(),Ct=Ae(rt),jt=l(Ct),pa=a(l(jt),2),Xt=l(pa,!0);s(pa),s(jt);var Zt=a(jt,2);{var pt=$t=>{var At=ui(),Rt=l(At),aa=a(l(Rt));s(Rt);var sa=a(Rt,2),da=a(l(sa));s(sa);var Ht=a(sa,2),Mt=a(l(Ht));s(Ht);var Ut=a(Ht,2),Qt=a(l(Ut)),Oe=a(Qt);{var vt=Pt=>{var Et=Gt();j(()=>D(Et,`(${W(e(b)),n(()=>e(b).material)??""})`)),c(Pt,Et)};h(Oe,Pt=>{W(e(b)),n(()=>e(b).material)&&Pt(vt)})}s(Ut);var mt=a(Ut,2),Dt=a(l(mt),2);{var Bt=Pt=>{var Et=Gt("Concentration,");c(Pt,Et)};h(Dt,Pt=>{W(e(b)),n(()=>e(b).concentration)&&Pt(Bt)})}var Ft=a(Dt,1,!0);s(mt);var Nt=a(mt,2),Vt=a(l(Nt));s(Nt);var la=a(Nt,2);{var ua=Pt=>{var Et=di(),Ot=a(l(Et));s(Et),j(()=>D(Ot,` ${W(e(b)),n(()=>e(b).higherLevelSlot)??""}`)),c(Pt,Et)};h(la,Pt=>{W(e(b)),n(()=>e(b).higherLevelSlot)&&Pt(ua)})}s(At),j(Pt=>{D(aa,` ${W(e(b)),n(()=>e(b).level)??""}`),D(da,` ${W(e(b)),n(()=>e(b).castingTime||e(b).actionType)??""}`),D(Mt,` ${W(e(b)),n(()=>e(b).range)??""}`),D(Qt,` ${Pt??""}`),D(Ft,(W(e(b)),n(()=>e(b).duration))),D(Vt,` ${W(e(b)),n(()=>e(b).description)??""}`)},[()=>(W(e(b)),n(()=>e(b).components.join(", ")))]),c($t,At)};h(Zt,$t=>{e(Q),e(u),n(()=>!e(Q)[e(u).id])&&$t(pt)})}s(Ct);var wt=a(Ct,2);{var oa=$t=>{var At=gi(),Rt=l(At),aa=l(Rt);De(aa);var sa=a(aa),da=a(sa);{var Ht=Oe=>{var vt=fi(),mt=l(vt);s(vt),j(Dt=>D(mt,`(Spell Save DC: ${Dt??""})`),[()=>(W(ss),t(),v(),n(()=>ss(t(),v())))]),c(Oe,vt)};h(da,Oe=>{t(),n(()=>t().class)&&Oe(Ht)})}var Mt=a(da,2);{var Ut=Oe=>{var vt=pi();c(Oe,vt)},Qt=Oe=>{var vt=dt(),mt=Ae(vt);{var Dt=Bt=>{var Ft=mi();c(Bt,Ft)};h(mt,Bt=>{e(u),W(e(xe)),n(()=>e(u).targetSucceededSave&&e(xe).noDamageOnSave)&&Bt(Dt)},!0)}c(Oe,vt)};h(Mt,Oe=>{e(u),W(e(xe)),n(()=>e(u).targetSucceededSave&&e(xe).halfDamageOnSave)?Oe(Ut):Oe(Qt,!1)})}s(Rt),s(At),j(Oe=>D(sa,` Target succeeded on ${Oe??""} save `),[()=>(W(e(xe)),n(()=>e(xe).ability.charAt(0).toUpperCase()+e(xe).ability.slice(1)))]),wa(aa,()=>e(u).targetSucceededSave,Oe=>(e(u).targetSucceededSave=Oe,Tt(()=>(e(E),t(),d())))),c($t,At)};h(wt,$t=>{e(xe)&&$t(oa)})}var ea=a(wt,2);{var ca=$t=>{var At=_i(),Rt=l(At),aa=l(Rt);De(aa);var sa=a(aa,2);{var da=Mt=>{const Ut=gt(()=>(e(u),W(e(b)),n(()=>J(e(u),e(b)))));var Qt=bi(),Oe=l(Qt);s(Qt),j(()=>D(Oe,`(${W(e(ct)),n(()=>e(ct).alternateDamage)??""}, total: ${e(Ut)??""})`)),c(Mt,Qt)},Ht=Mt=>{var Ut=hi(),Qt=l(Ut);s(Ut),j(()=>D(Qt,`(${W(e(ct)),n(()=>e(ct).baseDamage)??""})`)),c(Mt,Ut)};h(sa,Mt=>{e(u),n(()=>e(u).targetIsDamaged)?Mt(da):Mt(Ht,!1)})}s(Rt),s(At),wa(aa,()=>e(u).targetIsDamaged,Mt=>(e(u).targetIsDamaged=Mt,Tt(()=>(e(E),t(),d())))),c($t,At)};h(ea,$t=>{e(ct)&&$t(ca)})}var Kt=a(ea,2);{var ta=$t=>{const At=gt(()=>(W(e(b)),n(()=>He(e(b)))));var Rt=dt(),aa=Ae(Rt);{var sa=Ht=>{var Mt=$i(),Ut=Ae(Mt),Qt=l(Ut),Oe=a(Qt,2);j(()=>{e(u),Tt(()=>{e(At)})}),_t(Oe,5,()=>e(At),kt,(Ft,Nt)=>{var Vt=yi(),la=l(Vt);s(Vt);var ua={};j(()=>{D(la,`Level ${e(Nt)??""}`),ua!==(ua=e(Nt))&&(Vt.value=(Vt.__value=e(Nt))??"")}),c(Ft,Vt)}),s(Oe);var vt=a(Oe,2);{var mt=Ft=>{const Nt=gt(()=>(e(u),W(e(b)),n(()=>J(e(u),e(b)))));var Vt=xi(),la=l(Vt);{var ua=Ot=>{var ia=Gt("Healing");c(Ot,ia)},Pt=Ot=>{var ia=Gt("Damage");c(Ot,ia)};h(la,Ot=>{W(e(b)),n(()=>Pe(e(b)))?Ot(ua):Ot(Pt,!1)})}var Et=a(la);s(Vt),j(()=>D(Et,` ${e(Nt)??""}`)),c(Ft,Vt)};h(vt,Ft=>{e(u),W(e(b)),n(()=>e(u).castAtLevel&&e(u).castAtLevel>e(b).level)&&Ft(mt)})}s(Ut);var Dt=a(Ut,2);{var Bt=Ft=>{var Nt=wi(),Vt=l(Nt),la=l(Vt);De(la);var ua=a(la,2);{var Pt=Et=>{const Ot=gt(()=>(e(u),W(e(b)),n(()=>J(e(u),e(b)))));var ia=ki(),ka=l(ia);s(ia),j(()=>D(ka,`(+1d8, total: ${e(Ot)??""})`)),c(Et,ia)};h(ua,Et=>{e(u),n(()=>e(u).targetIsFiendOrUndead)&&Et(Pt)})}s(Vt),s(Nt),wa(la,()=>e(u).targetIsFiendOrUndead,Et=>(e(u).targetIsFiendOrUndead=Et,Tt(()=>(e(E),t(),d())))),c(Ft,Nt)};h(Dt,Ft=>{W(e(b)),n(()=>e(b).description.includes("Fiend or an Undead"))&&Ft(Bt)})}j(()=>{Qe(Qt,"for",`castLevel-${e(u),n(()=>e(u).id)??""}`),Qe(Oe,"id",`castLevel-${e(u),n(()=>e(u).id)??""}`)}),Ma(Oe,()=>e(u).castAtLevel,Ft=>(e(u).castAtLevel=Ft,Tt(()=>(e(E),t(),d())))),c(Ht,Mt)},da=Ht=>{var Mt=Si();c(Ht,Mt)};h(aa,Ht=>{W(e(At)),n(()=>e(At).length>0)?Ht(sa):Ht(da,!1)})}c($t,Rt)};h(Kt,$t=>{W(e(b)),n(()=>e(b).higherLevelSlot&&e(b).level>0)&&$t(ta)})}j(()=>{Qe(pa,"aria-label",(e(Q),e(u),n(()=>e(Q)[e(u).id]?"Expand":"Collapse"))),D(Xt,(e(Q),e(u),n(()=>e(Q)[e(u).id]?"‚ñº":"‚ñ≤")))}),L("click",jt,()=>_e(e(u).id)),L("keydown",jt,$t=>$t.key==="Enter"&&_e(e(u).id)),c(Je,rt)},me=Je=>{var xe=Di();c(Je,xe)};h(F,Je=>{e(b)?Je(Ne):Je(me,!1)})}c(yt,qe)};h(ut,yt=>{e(y),n(()=>e(y).length===0)?yt(Ye):yt(Ke,!1)})}c(O,X)};h(Y,O=>{e(u),n(()=>e(u).spellRef)&&O(Fe)})}var Ce=a(Y,2);{var tt=O=>{var X=Li(),ut=l(X),Ye=a(ut,2);xa(Ye),s(X),j(()=>{Qe(ut,"for",`attack-notes-${e(u),n(()=>e(u).id)??""}`),Qe(Ye,"id",`attack-notes-${e(u),n(()=>e(u).id)??""}`)}),Ie(Ye,()=>e(u).notes,Ke=>(e(u).notes=Ke,Tt(()=>(e(E),t(),d())))),c(O,X)};h(Ce,O=>{e(u),n(()=>!e(u).spellRef)&&O(tt)})}var ot=a(Ce,2),ft=l(ot);{var ht=O=>{const X=gt(()=>(e(u),n(()=>g(e(u).spellRef))));var ut=dt(),Ye=Ae(ut);{var Ke=yt=>{var b=dt(),qe=Ae(b);{var F=me=>{var Je=ji();L("click",Je,()=>B(e(u))),c(me,Je)},Ne=me=>{var Je=dt(),xe=Ae(Je);{var ct=Ct=>{var jt=dt(),pa=Ae(jt);{var Xt=pt=>{var wt=Ai(),oa=l(wt),ea=l(oa),ca=l(ea);De(ca),ca.value=ca.__value="self",Jt(),s(ea);var Kt=a(ea,2),ta=l(Kt);De(ta),ta.value=ta.__value="other",Jt(),s(Kt),s(oa);var $t=a(oa,2),At=l($t);s($t),s(wt),j(()=>{Qe(ca,"name",`target-${e(u),n(()=>e(u).id)??""}`),Qe(ta,"name",`target-${e(u),n(()=>e(u).id)??""}`),D(At,`Cast ${W(e(X)),n(()=>e(X).name)??""}`)}),ds(ee,[we],ca,()=>e(U)[e(u).id],Rt=>ma(U,e(U)[e(u).id]=Rt)),ds(ee,[we],ta,()=>e(U)[e(u).id],Rt=>ma(U,e(U)[e(u).id]=Rt)),L("click",$t,()=>ve(e(u),e(U)[e(u).id])),c(pt,wt)},Zt=pt=>{var wt=Bi();L("click",wt,()=>ve(e(u),"self")),c(pt,wt)};h(pa,pt=>{W(e(X)),n(()=>pe(e(X).name))?pt(Xt):pt(Zt,!1)})}c(Ct,jt)},rt=Ct=>{var jt=dt(),pa=Ae(jt);{var Xt=pt=>{var wt=Ri(),oa=l(wt);{var ea=Kt=>{var ta=Gt("Roll Healing");c(Kt,ta)},ca=Kt=>{var ta=Gt("Roll Damage");c(Kt,ta)};h(oa,Kt=>{W(e(X)),n(()=>Pe(e(X)))?Kt(ea):Kt(ca,!1)})}s(wt),j(Kt=>St(wt,1,`btn ${Kt??""}`),[()=>(W(e(X)),n(()=>Pe(e(X))?"btn-success":"btn-secondary"))]),L("click",wt,()=>P(e(u))),c(pt,wt)},Zt=pt=>{var wt=Mi();L("click",wt,()=>ve(e(u),"self")),c(pt,wt)};h(pa,pt=>{e(u),n(()=>e(u).damage&&e(u).damage.trim()!=="")?pt(Xt):pt(Zt,!1)})}c(Ct,jt)};h(xe,Ct=>{W(hs),W(e(X)),n(()=>hs(e(X)))?Ct(ct):Ct(rt,!1)},!0)}c(me,Je)};h(qe,me=>{W(Qa),W(e(X)),n(()=>Qa(e(X)))?me(F):me(Ne,!1)})}c(yt,b)};h(Ye,yt=>{e(X)&&yt(Ke)})}c(O,ut)},at=O=>{var X=dt(),ut=Ae(X);{var Ye=Ke=>{var yt=Pi(),b=Ae(yt),qe=a(b,2);{var F=Ne=>{var me=Fi();L("click",me,()=>P(e(u))),c(Ne,me)};h(qe,Ne=>{e(u),n(()=>e(u).damage&&e(u).damage.trim()!=="")&&Ne(F)})}L("click",b,()=>B(e(u))),c(Ke,yt)};h(ut,Ke=>{e(u),n(()=>!e(u).spellRef)&&Ke(Ye)},!0)}c(O,X)};h(ft,O=>{e(u),e(K),n(()=>e(u).spellRef&&e(K))?O(ht):O(at,!1)})}s(ot),s(be),j(()=>{Qe(te,"for",`attack-type-${e(u),n(()=>e(u).id)??""}`),Qe(Te,"id",`attack-type-${e(u),n(()=>e(u).id)??""}`)}),Ie(Te,()=>e(u).damageType,O=>(e(u).damageType=O,Tt(()=>(e(E),t(),d())))),c(se,be)});var ge=a(Z,2);{var Se=se=>{var u=Ii();c(se,u)},re=se=>{var u=dt(),we=Ae(u);{var be=G=>{var je=Ei();c(G,je)};h(we,G=>{e(E),n(()=>e(E).length===0)&&G(be)},!0)}c(se,u)};h(ge,se=>{t(),n(()=>t().attacks.length===0)?se(Se):se(re,!1)})}s(I);var ye=a(I,2);{var z=se=>{var u=Gi(),we=a(l(u),4);_t(we,5,()=>e(k),kt,(be,G)=>{var je=Oi(),de=l(je),$e=l(de),le=l($e,!0);s($e);var Ge=a($e,2),he=l(Ge);s(Ge),s(de);var x=a(de,2),V=l(x,!0);s(x);var ie=a(x,2),ne=l(ie);{var q=Ce=>{var tt=Hi(),ot=l(tt),ft=a(ot);{var ht=at=>{var O=Gt();j(()=>D(O,`per ${e(G),n(()=>e(G).restType)??""} rest`)),c(at,O)};h(ft,at=>{e(G),n(()=>e(G).restType)&&at(ht)})}s(tt),j(()=>D(ot,`${e(G),n(()=>e(G).currentUses??e(G).usesPerRest)??""}/${e(G),n(()=>e(G).usesPerRest)??""} uses `)),c(Ce,tt)};h(ne,Ce=>{e(G),n(()=>e(G).usesPerRest)&&Ce(q)})}var te=a(ne,2);{var Te=Ce=>{var tt=Ui();c(Ce,tt)};h(te,Ce=>{e(G),n(()=>e(G).requiresReaction)&&Ce(Te)})}var Y=a(te,2);{var Fe=Ce=>{var tt=Ni();j(()=>tt.disabled=(e(G),n(()=>e(G).currentUses===void 0||e(G).currentUses===0))),L("click",tt,()=>fe(e(G).conditionName,e(G).name)),c(Ce,tt)};h(Y,Ce=>{m(),e(G),n(()=>!m()&&e(G).usesPerRest)&&Ce(Fe)})}s(ie),s(je),j(()=>{D(le,(e(G),n(()=>e(G).name))),D(he,`(${e(G),n(()=>e(G).conditionName)??""})`),D(V,(e(G),n(()=>e(G).description)))}),c(be,je)}),s(we),s(u),c(se,u)};h(ye,se=>{e(k),n(()=>e(k).length>0)&&se(z)})}var A=a(ye,2),Le=a(l(A),4),Ve=a(Le,2);{var Me=se=>{var u=zi();_t(u,5,()=>(t(),n(()=>t().activeStates)),kt,(we,be,G)=>{var je=Wi(),de=l(je),$e=l(de);De($e);var le=a($e,2);{var Ge=at=>{var O=qi();L("click",O,()=>oe(G)),c(at,O)};h(le,at=>{m()&&at(Ge)})}s(de);var he=a(de,2),x=l(he),V=l(x);Qe(V,"for",`state-attack-bonus-${G}`);var ie=a(V,2);De(ie),Qe(ie,"id",`state-attack-bonus-${G}`),s(x);var ne=a(x,2),q=l(ne);Qe(q,"for",`state-damage-bonus-${G}`);var te=a(q,2);De(te),Qe(te,"id",`state-damage-bonus-${G}`),s(ne);var Te=a(ne,2),Y=l(Te);Qe(Y,"for",`state-target-${G}`);var Fe=a(Y,2);j(()=>{e(be),Tt(()=>{})}),Qe(Fe,"id",`state-target-${G}`);var Ce=l(Fe);Ce.value=Ce.__value="self";var tt=a(Ce);tt.value=tt.__value="other",s(Fe),s(Te),s(he);var ot=a(he,2),ft=l(ot);Qe(ft,"for",`state-desc-${G}`);var ht=a(ft,2);De(ht),Qe(ht,"id",`state-desc-${G}`),s(ot),s(je),Ie($e,()=>e(be).name,at=>(e(be).name=at,Tt(()=>t()),La(w,"$character"))),Ie(ie,()=>e(be).attackBonus,at=>(e(be).attackBonus=at,Tt(()=>t()),La(w,"$character"))),Ie(te,()=>e(be).damageBonus,at=>(e(be).damageBonus=at,Tt(()=>t()),La(w,"$character"))),Ma(Fe,()=>e(be).target,at=>(e(be).target=at,Tt(()=>t()),La(w,"$character"))),Ie(ht,()=>e(be).description,at=>(e(be).description=at,Tt(()=>t()),La(w,"$character"))),c(we,je)}),s(u),c(se,u)},Ze=se=>{var u=Ki();c(se,u)};h(Ve,se=>{t(),n(()=>t().activeStates&&t().activeStates.length>0)?se(Me):se(Ze,!1)})}s(A),L("click",Le,Ue),c($,N)};h(nt,$=>{p(),n(()=>!p().attacks)&&$(et)})}s(We);var bt=a(We,2);Ql(bt,{get show(){return e(H)},get attacks(){return t(),n(()=>t().attacks)},onSave:Re,onCancel:ke}),j(()=>lt=St(We,1,"attacks svelte-14o91c5",null,lt,{hidden:!e(M)})),c(i,ze),zt(),_()}var Qi=f('<span class="slot-checkbox-x svelte-serp1j">&#8212;</span>'),Xi=f('<label><input type="checkbox" class="slot-checkbox-input svelte-serp1j"/> <span><!></span></label>');function _s(i,o){Wt(o,!1);const t=()=>st(ha,"$isEditMode",v),[v,d]=ra();let p=xt(o,"checked",8,!1),m=xt(o,"disabled",8,!1),w=xt(o,"className",8,""),_=xt(o,"index",8,void 0),k=xt(o,"ariaLabel",8,void 0);const E=_a();function M(H){E("change",{checked:H.currentTarget.checked,index:_()})}qt();var ee=Xi(),fe=l(ee);De(fe);var ce=a(fe,2),Q=l(ce);{var U=H=>{var _e=Qi();c(H,_e)};h(Q,H=>{p()&&H(U)})}s(ce),s(ee),j(()=>{St(ee,1,"slot-checkbox-label "+w()+(t()?"":" not-editable"),"svelte-serp1j"),Cs(fe,p()),fe.disabled=m()||!t(),Qe(fe,"aria-label",k()),Qe(fe,"tabindex",t()?0:-1),St(ce,1,`slot-checkbox-custom ${p()?"used":""} ${t()?"":"readonly"}`,"svelte-serp1j")}),L("change",fe,M),c(i,ee),zt(),d()}var Zi=f('<p class="no-features svelte-1kpvv0n">Select a class to see available features</p>'),en=f('<p class="no-features svelte-1kpvv0n">No class features available at this level</p>'),tn=f('<div class="spell-slots svelte-1kpvv0n"><label class="svelte-1kpvv0n"> </label> <div class="slots-tracker svelte-1kpvv0n"></div></div>'),an=f('<div class="all-spell-slots"></div>'),sn=f('<div class="feature-box spellcasting svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"> </h3> <div class="spell-stats svelte-1kpvv0n"><div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Spell Save DC</label> <div class="spell-value svelte-1kpvv0n"> </div></div> <div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <div class="spell-value svelte-1kpvv0n"> </div></div></div> <!> <div class="prepared-spells svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <textarea placeholder="List your prepared spells..." class="svelte-1kpvv0n"></textarea></div></div>'),ln=f('<p class="unlimited svelte-1kpvv0n">Unlimited Uses</p>'),nn=f('<div class="slots-tracker svelte-1kpvv0n"></div> <div class="uses-actions-row"><button class="btn btn-primary use-enabled"> </button></div> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div>',1),rn=f('<div class="uses-tracker svelte-1kpvv0n"><!></div>'),on=f('<div class="pool-tracker svelte-1kpvv0n"><input type="number" min="0" class="pool-input svelte-1kpvv0n"/> <span> </span> <button class="btn-small svelte-1kpvv0n"> </button></div>'),cn=f('<p class="no-uses svelte-1kpvv0n">No Channel Divinity uses remaining</p>'),vn=f('<div class="channel-divinity-option svelte-1kpvv0n"><button class="btn btn-primary use-enabled svelte-1kpvv0n">Use Channel Divinity</button> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div> <!></div>'),dn=f('<div class="feature-box svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"><!> </h3> <p class="feature-description svelte-1kpvv0n"> </p> <!></div>'),un=f('<div class="features-grid svelte-1kpvv0n"><!> <!></div>'),fn=f("<section><!> <!></section>");function pn(i,o){Wt(o,!1);const t=()=>st(ue,"$character",m),v=()=>st(Fa,"$abilityModifiers",m),d=()=>st(ga,"$searchFilter",m),p=()=>st(Yt,"$collapsedStates",m),[m,w]=ra(),_=S(),k=S(),E=S(),M=S(),ee=S(),fe=S(),ce=S();let Q=S(0),U=S(0);function H(g,R){ue.update(J=>(J.classFeatures.features[g]=R,J))}function _e(){ue.update(g=>(g.classFeatures.spellSlotsByLevel||(g.classFeatures.spellSlotsByLevel={}),e(M).forEach(({level:R,slots:J})=>{g.classFeatures.spellSlotsByLevel[R]||(g.classFeatures.spellSlotsByLevel[R]=Array(J).fill(!1))}),g))}function Pe(g){if(typeof g.maxUses=="function"){if((g.name==="Divine Sense"||g.name==="War Priest")&&e(_)?.spellcastingAbility){const R=v()[e(_).spellcastingAbility];return g.maxUses(t().level,R)}return g.maxUses(t().level)}return g.maxUses||0}function pe(g,R){ue.update(J=>((!J.classFeatures.features[g]||!Array.isArray(J.classFeatures.features[g])||J.classFeatures.features[g].length!==R)&&(J.classFeatures.features[g]=Array(R).fill(!1)),J))}Fs(()=>{e(fe)&&t()&&t().classFeatures&&t().classFeatures.features&&e(fe).forEach(g=>{if(g.type==="uses"){const R=g.name.replace(/\s+/g,""),J=Pe(g),He=t().classFeatures.features[R];(!Array.isArray(He)||He.length!==J)&&pe(R,J)}})});function Be(g){return typeof g.maxPool=="function"?g.maxPool(t().level):g.maxPool||0}function Ee(g){return typeof g.description=="function"?g.description(t().level):g.description}function ae(){const g="ChannelDivinity";ue.update(R=>{const J=R.classFeatures.features[g];return typeof J=="number"&&J>0&&(R.classFeatures.features[g]=J-1),R})}function ke(){Yt.update(g=>({...g,classFeatures:!g.classFeatures}))}Xe(()=>(t(),na),()=>{r(_,t().class?na(t().class):null)}),Xe(()=>(t(),Sa),()=>{r(k,t().class?Sa(t().class,t().level,t().subclass):[])}),Xe(()=>(t(),ps),()=>{r(E,t().class?ps(t().class,t().level):0)}),Xe(()=>(e(_),t()),()=>{r(M,(()=>{if(!e(_)?.spellcaster)return[];const g=t().level,R=[];return g>=1&&R.push({level:1,slots:Math.min(4,2+Math.floor(g/3))}),g>=3&&R.push({level:2,slots:Math.min(3,2+Math.floor((g-3)/4))}),g>=5&&R.push({level:3,slots:Math.min(3,2+Math.floor((g-5)/5))}),g>=7&&R.push({level:4,slots:Math.min(3,1+Math.floor((g-7)/6))}),g>=9&&R.push({level:5,slots:Math.min(2,1+Math.floor((g-9)/8))}),g>=11&&R.push({level:6,slots:1}),g>=13&&R.push({level:7,slots:1}),g>=15&&R.push({level:8,slots:1}),g>=17&&R.push({level:9,slots:1}),R})())}),Xe(()=>(e(_),v(),t(),ms),()=>{if(e(_)?.spellcaster&&e(_).spellcastingAbility){const g=v()[e(_).spellcastingAbility];r(Q,fl(t().class,g,t().proficiencyBonus)||0),r(U,ms(t().class,t().level,g))}}),Xe(()=>(t(),e(_),e(M)),()=>{t().class&&e(_)?.spellcaster&&e(M).length>0&&_e()}),Xe(()=>t(),()=>{r(ee,(()=>{const R=t().classFeatures.features["ChannelDivinity"];return typeof R=="number"?R:0})())}),Xe(()=>(e(k),d()),()=>{r(fe,e(k).filter(g=>{if(!d())return!0;const R=d().toLowerCase();return g.name.toLowerCase().includes(R)||Ee(g).toLowerCase().includes(R)}))}),Xe(()=>(d(),t(),e(fe)),()=>{r(ce,!d()||t().class||"class features".includes(d().toLowerCase())||"spellcasting".includes(d().toLowerCase())||e(fe).length>0)}),va(),qt();var Re=fn();let B;var P=l(Re);{let g=gt(()=>(p(),n(()=>p().classFeatures?"Expand":"Collapse")));ya(P,{title:"Class Features",get collapsed(){return p(),n(()=>p().classFeatures)},get ariaLabel(){return e(g)},onToggle:ke})}var y=a(P,2);{var K=g=>{var R=dt(),J=Ae(R);{var He=oe=>{var ve=Zi();c(oe,ve)},Ue=oe=>{var ve=dt(),ze=Ae(ve);{var We=it=>{var nt=en();c(it,nt)},lt=it=>{var nt=un(),et=l(nt);{var bt=N=>{var T=sn(),C=l(T),I=l(C);s(C);var Z=a(C,2),ge=l(Z),Se=a(l(ge),2),re=l(Se,!0);s(Se),s(ge);var ye=a(ge,2),z=a(l(ye),2),A=l(z,!0);s(z),s(ye),s(Z);var Le=a(Z,2);{var Ve=se=>{var u=an();_t(u,5,()=>e(M),kt,(we,be)=>{let G=()=>e(be).level,je=()=>e(be).slots;const de=gt(()=>(t(),G(),je(),n(()=>t().classFeatures.spellSlotsByLevel?.[G()]||Array(je()).fill(!1))));var $e=tn(),le=l($e),Ge=l(le);s(le);var he=a(le,2);_t(he,5,()=>e(de),kt,(x,V,ie)=>{{let ne=gt(()=>(W(e(de)),n(()=>e(de)[ie]||!1)));_s(x,{get checked(){return e(ne)},$$events:{change:q=>{ue.update(te=>(te.classFeatures.spellSlotsByLevel||(te.classFeatures.spellSlotsByLevel={}),te.classFeatures.spellSlotsByLevel[G()]||(te.classFeatures.spellSlotsByLevel[G()]=Array(je()).fill(!1)),te.classFeatures.spellSlotsByLevel[G()][ie]=q.detail.checked,te))}}})}}),s(he),s($e),j(()=>D(Ge,`${G()===1?"1st":G()===2?"2nd":G()===3?"3rd":`${G()}th`} Level Spell Slots`)),c(we,$e)}),s(u),c(se,u)};h(Le,se=>{e(M),n(()=>e(M).length>0)&&se(Ve)})}var Me=a(Le,2),Ze=a(l(Me),2);xa(Ze),s(Me),s(T),j(se=>{D(I,`Spellcasting (${se??""})`),D(re,e(Q)),D(A,e(U))},[()=>(e(_),n(()=>e(_).spellcastingAbility?.toUpperCase()))]),Ie(Ze,()=>t().classFeatures.preparedSpells,se=>Lt(ue,n(t).classFeatures.preparedSpells=se,n(t))),c(N,T)};h(et,N=>{e(_),n(()=>e(_)?.spellcaster)&&N(bt)})}var $=a(et,2);_t($,1,()=>e(fe),kt,(N,T)=>{const C=gt(()=>(e(T),n(()=>e(T).name.replace(/\s+/g,"")))),I=gt(()=>(t(),W(e(C)),n(()=>t().classFeatures.features[e(C)]))),Z=gt(()=>typeof e(I)=="number");var ge=dn(),Se=l(ge),re=l(Se);{var ye=se=>{var u=Gt("Channel Divinity:");c(se,u)};h(re,se=>{e(T),n(()=>e(T).type==="channelDivinity")&&se(ye)})}var z=a(re);s(Se);var A=a(Se,2),Le=l(A,!0);s(A);var Ve=a(A,2);{var Me=se=>{const u=gt(()=>(e(T),n(()=>Pe(e(T))))),we=gt(()=>(W(e(I)),W(e(u)),n(()=>Array.isArray(e(I))?e(I):Array(e(u)).fill(!1))));var be=rn(),G=l(be);{var je=$e=>{var le=ln();c($e,le)},de=$e=>{var le=nn(),Ge=Ae(le);_t(Ge,5,()=>e(we),kt,(te,Te,Y)=>{_s(te,{get checked(){return e(Te)},index:Y,$$events:{change:Fe=>{ue.update(Ce=>(Ce.classFeatures.features[e(C)]||(Ce.classFeatures.features[e(C)]=Array(e(u)).fill(!1)),Ce.classFeatures.features[e(C)][Y]=Fe.detail.checked,Ce))}}})}),s(Ge);var he=a(Ge,2),x=l(he),V=l(x);s(x),s(he);var ie=a(he,2),ne=l(ie),q=l(ne);s(ne),s(ie),j(te=>{x.disabled=te,D(V,`Use ${e(T),n(()=>e(T).name)??""}`),D(q,`Resets on ${e(T),n(()=>e(T).resetOn==="short"?"Short Rest":"Long Rest")??""}`)},[()=>(W(e(we)),n(()=>e(we).filter(te=>!te).length<=0))]),L("click",x,()=>{ue.update(te=>{te.classFeatures.features[e(C)]||(te.classFeatures.features[e(C)]=Array(e(u)).fill(!1));const Te=te.classFeatures.features[e(C)],Y=Te.findIndex(Fe=>!Fe);return Y!==-1&&(Te[Y]=!0),te})}),c($e,le)};h(G,$e=>{e(u)===1/0?$e(je):$e(de,!1)})}s(be),c(se,be)},Ze=se=>{var u=dt(),we=Ae(u);{var be=je=>{const de=gt(()=>(e(T),n(()=>Be(e(T)))));var $e=on(),le=l($e);De(le);var Ge=a(le,2),he=l(Ge);s(Ge);var x=a(Ge,2),V=l(x,!0);s(x),s($e),j(()=>{Ba(le,e(Z)&&e(I)!==void 0?e(I):e(de)),Qe(le,"max",e(de)),D(he,`/ ${e(de)??""}`),D(V,(e(T),n(()=>e(T).resetOn==="short"?"Short Rest":"Long Rest")))}),L("input",le,ie=>{ue.update(ne=>(ne.classFeatures.features[e(C)]=parseInt(ie.currentTarget.value)||0,ne))}),L("click",x,()=>H(e(C),e(de))),c(je,$e)},G=je=>{var de=dt(),$e=Ae(de);{var le=Ge=>{var he=vn(),x=l(he),V=a(x,2),ie=l(V),ne=l(ie);s(ie),s(V);var q=a(V,2);{var te=Te=>{var Y=cn();c(Te,Y)};h(q,Te=>{e(ee)<=0&&Te(te)})}s(he),j(()=>{x.disabled=e(ee)<=0,D(ne,`Resets on ${e(T),n(()=>e(T).resetOn==="short"?"Short Rest":"Long Rest")??""}`)}),L("click",x,ae),c(Ge,he)};h($e,Ge=>{e(T),n(()=>e(T).type==="channelDivinity")&&Ge(le)},!0)}c(je,de)};h(we,je=>{e(T),n(()=>e(T).type==="pool")?je(be):je(G,!1)},!0)}c(se,u)};h(Ve,se=>{e(T),n(()=>e(T).type==="uses")?se(Me):se(Ze,!1)})}s(ge),j(se=>{D(z,` ${e(T),n(()=>e(T).name)??""}`),D(Le,se)},[()=>(e(T),n(()=>Ee(e(T))))]),c(N,ge)}),s(nt),c(it,nt)};h(ze,it=>{e(k),n(()=>e(k).length===0)?it(We):it(lt,!1)},!0)}c(oe,ve)};h(J,oe=>{t(),n(()=>!t().class)?oe(He):oe(Ue,!1)})}c(g,R)};h(y,g=>{p(),n(()=>!p().classFeatures)&&g(K)})}s(Re),j(()=>B=St(Re,1,"class-features svelte-1kpvv0n",null,B,{hidden:!e(ce)})),c(i,Re),zt(),w()}var mn=f('<textarea placeholder="Enter features, traits, and special abilities..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Equipment</h3> <textarea placeholder="List your equipment and inventory..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Notes</h3> <textarea placeholder="Additional notes..." class="svelte-wttn0l"></textarea>',1),gn=f("<section><!> <!></section>");function bn(i,o){Wt(o,!1);const t=()=>st(ga,"$searchFilter",p),v=()=>st(ue,"$character",p),d=()=>st(Yt,"$collapsedStates",p),[p,m]=ra(),w=S();function _(){Yt.update(ce=>({...ce,notes:!ce.notes}))}Xe(()=>(t(),v()),()=>{r(w,!t()||"features".includes(t().toLowerCase())||"traits".includes(t().toLowerCase())||"equipment".includes(t().toLowerCase())||"notes".includes(t().toLowerCase())||v().features.toLowerCase().includes(t().toLowerCase())||v().equipment.toLowerCase().includes(t().toLowerCase())||v().notes.toLowerCase().includes(t().toLowerCase()))}),va(),qt();var k=gn();let E;var M=l(k);{let ce=gt(()=>(d(),n(()=>d().notes?"Expand":"Collapse")));ya(M,{title:"Features & Traits",get collapsed(){return d(),n(()=>d().notes)},get ariaLabel(){return e(ce)},onToggle:_})}var ee=a(M,2);{var fe=ce=>{var Q=mn(),U=Ae(Q);xa(U);var H=a(U,4);xa(H);var _e=a(H,4);xa(_e),Ie(U,()=>v().features,Pe=>Lt(ue,n(v).features=Pe,n(v))),Ie(H,()=>v().equipment,Pe=>Lt(ue,n(v).equipment=Pe,n(v))),Ie(_e,()=>v().notes,Pe=>Lt(ue,n(v).notes=Pe,n(v))),c(ce,Q)};h(ee,ce=>{d(),n(()=>!d().notes)&&ce(fe)})}s(k),j(()=>E=St(k,1,"notes svelte-wttn0l",null,E,{hidden:!e(w)})),c(i,k),zt(),m()}var hn=f('<div class="color-picker-section svelte-1r90jgp"><h3 class="svelte-1r90jgp">Dice Colors</h3> <div class="color-inputs svelte-1r90jgp"><div class="color-input-group svelte-1r90jgp"><label for="dice-color" class="svelte-1r90jgp">Dice Color</label> <input type="color" id="dice-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="label-color" class="svelte-1r90jgp">Label Color</label> <input type="color" id="label-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="desk-color" class="svelte-1r90jgp">Background Color</label> <input type="color" id="desk-color" class="svelte-1r90jgp"/></div></div></div>'),_n=f('<div class="loading svelte-1r90jgp"><p class="svelte-1r90jgp">Loading 3D dice...</p></div>'),yn=f('<div class="custom-dice-selector svelte-1r90jgp"><h3 class="svelte-1r90jgp">Choose Dice to Roll</h3> <div class="dice-inputs svelte-1r90jgp"><div class="dice-input-group svelte-1r90jgp"><label for="d4" class="svelte-1r90jgp">d4</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d4" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d6" class="svelte-1r90jgp">d6</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d6" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d8" class="svelte-1r90jgp">d8</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d8" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d10" class="svelte-1r90jgp">d10</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d10" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d12" class="svelte-1r90jgp">d12</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d12" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d20" class="svelte-1r90jgp">d20</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d20" min="0" max="10"/></div></div> <div class="dice-controls svelte-1r90jgp"><button class="btn btn-primary use-enabled svelte-1r90jgp"> </button> <button class="btn btn-secondary use-enabled svelte-1r90jgp">Reset</button></div></div>'),xn=f('<span class="crit-badge svelte-1r90jgp">CRITICAL HIT!</span>'),kn=f('<span class="crit-badge crit-fail svelte-1r90jgp">CRITICAL MISS!</span>'),wn=f('<div class="bonus-item svelte-1r90jgp"><span class="bonus-value svelte-1r90jgp"> </span> <span class="bonus-source svelte-1r90jgp"> </span></div>'),$n=f('<div class="bonus-breakdown svelte-1r90jgp"></div>'),Sn=f('<p class="modifier-text svelte-1r90jgp"> </p>'),Cn=f('<div class="svelte-1r90jgp"><em class="svelte-1r90jgp">No damage is dealt on a critical miss.</em></div>'),Dn=f('<button class="btn btn-follow-up svelte-1r90jgp"> </button>'),Ln=f('<button class="btn btn-guided-strike svelte-1r90jgp">‚ö° Use Guided Strike (+10)</button>'),jn=f('<div class="follow-up-actions svelte-1r90jgp"><!> <!></div>'),An=f('<div class="result-header svelte-1r90jgp"><h3 class="svelte-1r90jgp"> </h3> <!> <!></div> <div class="result-total svelte-1r90jgp"> </div> <div class="result-details svelte-1r90jgp"><!></div> <!> <!>',1),Bn=f('<div role="button" tabindex="-1"><div class="modal-content svelte-1r90jgp" role="dialog" tabindex="0"><div class="modal-header svelte-1r90jgp"><h2 class="svelte-1r90jgp">Dice Roller</h2> <div class="header-buttons svelte-1r90jgp"><button class="color-btn svelte-1r90jgp" title="Customize dice colors">üé®</button> <button class="close-btn svelte-1r90jgp">√ó</button></div></div> <!> <!> <div class="dice-main-area svelte-1r90jgp"><div class="dice-container svelte-1r90jgp"></div> <!></div> <div><!></div></div></div>');function Rn(i,o){Wt(o,!1);const t=()=>st(ue,"$character",v),[v,d]=ra(),p=S(),m=S(),w=S(),_=_a();let k=xt(o,"notation",12,""),E=xt(o,"visible",8,!1),M=xt(o,"damageNotation",12,""),ee=xt(o,"attackName",12,""),fe=xt(o,"applyHalfDamage",8,!1),ce=xt(o,"bonusBreakdown",28,()=>[]),Q=xt(o,"rollType",12,"other"),U=null,H=S(void 0),_e=S(!1),Pe=S(""),pe=S(null);function Be(){return e(pe)?.resultTotal??null}function Ee(x,V,ie){const ne=[];if(!x||!x.result)return ne;const q=V.match(/([+-]?\d*d\d+|[+-]?\d+)/g)||[];let te=0;const Te=new Set;for(const Y of q){const Fe=Y.trim();if(!Fe)continue;const Ce=Fe.match(/([+-]?)(\d*)d(\d+)/);if(Ce){const tt=parseInt(Ce[2]||"1"),ot=`${tt}d${Ce[3]}`,ft=ie.findIndex((O,X)=>!Te.has(X)&&typeof O.value=="string"&&O.value===ot),ht=[];for(let O=0;O<tt&&te<x.result.length;O++)ht.push(x.result[te++]);const at=ft>=0?ie[ft].source:"base die";ft>=0&&Te.add(ft);for(const O of ht)ne.push({display:`${O}`,source:at})}}for(let Y=0;Y<ie.length;Y++)if(!Te.has(Y)&&typeof ie[Y].value=="number"){const Fe=ie[Y].value;ne.push({display:Fe>=0?`+${Fe}`:`${Fe}`,source:ie[Y].source})}return ne}let ae=S(0),ke=S(0),Re=S(0),B=S(0),P=S(0),y=S(0),K=S(0),g=S([]),R=S(!1),J=S(!1),He=S(!1),Ue=S("#051e0a"),oe=S("#ffffff"),ve=S("#3a2004"),ze=S(!1);function We(x){return x.length===9&&x.startsWith("#")?x.substring(0,7):x}function lt(x,V="ff"){return x.length===7&&x.startsWith("#")?x+V:x}function it(){if(window.DICE&&e(H))try{U&&e(H)&&ma(H,e(H).innerHTML="");const x=e(H).clientWidth||500,V=e(H).clientHeight||300;U=new window.DICE.dice_box(e(H),{w:x,h:V}),r(_e,!0)}catch(x){console.error("Error initializing dice box:",x)}}Ca(()=>{const x=ne=>new Promise((q,te)=>{if(document.querySelector(`script[src="${ne}"]`)){q(null);return}const Y=document.createElement("script");Y.src=ne,Y.onload=()=>{q(null)},Y.onerror=()=>{console.error(`Failed to load: ${ne}`),te(new Error(`Failed to load ${ne}`))},document.head.appendChild(Y)});setTimeout(()=>{x(`${ja}/libs/three.min.js`).then(()=>x(`${ja}/libs/cannon.min.js`)).then(()=>x(`${ja}/libs/teal.js`)).then(()=>x(`${ja}/dice.js`)).then(()=>{if(window.DICE){const ne=window.DICE.getColors();r(Ue,We(ne.dice_color)),r(oe,We(ne.label_color)),r(ve,We(ne.desk_color))}it()}).catch(ne=>{console.error("Failed to load dice libraries:",ne)})},100);const V=()=>{e(_e)&&it()},ie=ne=>{E()&&ne.key==="Escape"&&Z()};return window.addEventListener("resize",V),window.addEventListener("keydown",ie),()=>{window.removeEventListener("resize",V),window.removeEventListener("keydown",ie)}});function nt(x,V="other"){if(!U||!e(_e))return;r(pe,null),r(g,[]),r(R,!1),r(J,!1),V==="damage"&&ce([]),Q(V),r(He,!1),U.diceToRoll=x;const ie=q=>null,ne=q=>{let te=q.resultTotal,Te=q.resultString;if(fe()&&(te=Math.floor(te/2),Te=Te+" (halved)"),r(pe,{...q,resultTotal:te,resultString:Te}),console.log("Final roll result:",e(pe)),console.log({type:V}),V==="attack"&&q.result&&q.result.length>0){const Y=q.result[0];r(R,Y===20),r(J,Y===1)}if(r(g,[]),console.log("Setting up follow-up actions. Type:",V,"damageNotation:",M(),"isCriticalSuccess:",e(R),"isCriticalFail:",e(J)),V==="attack"&&M())if(e(R)){const Y=$(M());e(g).push({label:`Roll Critical Damage (${Y})`,notation:Y})}else e(J)||e(g).push({label:`Roll Damage (${M()})`,notation:M()})};U.start_throw(ie,ne)}function et(){const x=[];e(ae)>0&&x.push(`${e(ae)}d4`),e(ke)>0&&x.push(`${e(ke)}d6`),e(Re)>0&&x.push(`${e(Re)}d8`),e(B)>0&&x.push(`${e(B)}d10`),e(P)>0&&x.push(`${e(P)}d12`),e(y)>0&&x.push(`${e(y)}d20`);let V=x.join("+")||"1d20";return e(K)!==0&&(V+=e(K)>=0?`+${e(K)}`:`${e(K)}`),V}function bt(){const x=et();nt(x)}function $(x){return x.replace(/(\d+)d(\d+)/g,(V,ie,ne)=>`${parseInt(ie)*2}d${ne}`)}function N(){r(ae,0),r(ke,0),r(Re,0),r(B,0),r(P,0),r(y,0),r(K,0),r(pe,null),r(g,[]),r(R,!1),r(J,!1),Q("other"),r(He,!1)}function T(){window.DICE&&(window.DICE.setColors({dice_color:lt(e(Ue),"ff"),label_color:lt(e(oe),"ff"),desk_color:e(ve)}),U&&(U.updateDeskColor(e(ve)),U.updateDiceColors()))}function C(){r(ze,!e(ze))}function I(){!e(pe)||e(m)<=0||e(He)||(r(pe,{...e(pe),resultTotal:e(pe).resultTotal+10,resultString:e(pe).resultString+" + 10 (Guided Strike)"}),ue.update(x=>{const V="ChannelDivinity",ie=x.classFeatures.features[V];return typeof ie=="number"&&ie>0&&(x.classFeatures.features[V]=ie-1),x}),r(He,!0))}function Z(){_("close"),k(""),M(""),ee(""),r(Pe,""),r(pe,null),r(He,!1),r(R,!1),r(J,!1),N()}Xe(()=>(t(),Sa),()=>{r(p,t().class?Sa(t().class,t().level,t().subclass).some(V=>V.name==="Guided Strike"):!1)}),Xe(()=>t(),()=>{r(m,(()=>{const V=t().classFeatures.features["ChannelDivinity"];return typeof V=="number"?V:0})())}),Xe(()=>(e(ae),e(ke),e(Re),e(B),e(P),e(y),e(K)),()=>{r(w,(()=>{const x=[];e(ae)>0&&x.push(`${e(ae)}d4`),e(ke)>0&&x.push(`${e(ke)}d6`),e(Re)>0&&x.push(`${e(Re)}d8`),e(B)>0&&x.push(`${e(B)}d10`),e(P)>0&&x.push(`${e(P)}d12`),e(y)>0&&x.push(`${e(y)}d20`);let V=x.join("+")||"1d20";return e(K)!==0&&(V+=e(K)>=0?`+${e(K)}`:`${e(K)}`),V})())}),Xe(()=>(W(k()),e(_e),W(E()),e(Pe),W(M()),W(ee()),W(Q())),()=>{k()&&e(_e)&&E()&&k()!==e(Pe)&&(r(Pe,k()),r(pe,null),r(g,[]),r(R,!1),r(J,!1),r(He,!1),console.log("Auto-roll triggered. notation:",k(),"damageNotation:",M(),"attackName:",ee(),"rollType:",Q()),setTimeout(()=>nt(k(),Q()),200))}),va();var ge={getLastRollTotal:Be};qt();var Se=Bn();let re;var ye=l(Se),z=l(ye),A=a(l(z),2),Le=l(A),Ve=a(Le,2);s(A),s(z);var Me=a(z,2);{var Ze=x=>{var V=hn(),ie=a(l(V),2),ne=l(ie),q=a(l(ne),2);De(q),s(ne);var te=a(ne,2),Te=a(l(te),2);De(Te),s(te);var Y=a(te,2),Fe=a(l(Y),2);De(Fe),s(Y),s(ie),s(V),Ie(q,()=>e(Ue),Ce=>r(Ue,Ce)),L("change",q,T),Ie(Te,()=>e(oe),Ce=>r(oe,Ce)),L("change",Te,T),Ie(Fe,()=>e(ve),Ce=>r(ve,Ce)),L("change",Fe,T),c(x,V)};h(Me,x=>{e(ze)&&x(Ze)})}var se=a(Me,2);{var u=x=>{var V=_n();c(x,V)};h(se,x=>{e(_e)||x(u)})}var we=a(se,2),be=l(we);Ra(be,x=>r(H,x),()=>e(H));var G=a(be,2);{var je=x=>{var V=yn(),ie=a(l(V),2),ne=l(ie),q=a(l(ne),2);De(q),s(ne);var te=a(ne,2),Te=a(l(te),2);De(Te),s(te);var Y=a(te,2),Fe=a(l(Y),2);De(Fe),s(Y);var Ce=a(Y,2),tt=a(l(Ce),2);De(tt),s(Ce);var ot=a(Ce,2),ft=a(l(ot),2);De(ft),s(ot);var ht=a(ot,2),at=a(l(ht),2);De(at),s(ht),s(ie);var O=a(ie,2),X=l(O),ut=l(X);s(X);var Ye=a(X,2);s(O),s(V),j(()=>{X.disabled=!e(_e),D(ut,`Roll ${e(w)??""}`)}),Ie(q,()=>e(ae),Ke=>r(ae,Ke)),Ie(Te,()=>e(ke),Ke=>r(ke,Ke)),Ie(Fe,()=>e(Re),Ke=>r(Re,Ke)),Ie(tt,()=>e(B),Ke=>r(B,Ke)),Ie(ft,()=>e(P),Ke=>r(P,Ke)),Ie(at,()=>e(y),Ke=>r(y,Ke)),L("click",X,bt),L("click",Ye,N),c(x,V)};h(G,x=>{k()||x(je)})}s(we);var de=a(we,2);let $e;var le=l(de);{var Ge=x=>{var V=An(),ie=Ae(V),ne=l(ie),q=l(ne,!0);s(ne);var te=a(ne,2);{var Te=Ye=>{var Ke=xn();c(Ye,Ke)};h(te,Ye=>{e(R)&&Ye(Te)})}var Y=a(te,2);{var Fe=Ye=>{var Ke=kn();c(Ye,Ke)};h(Y,Ye=>{e(J)&&Ye(Fe)})}s(ie);var Ce=a(ie,2),tt=l(Ce,!0);s(Ce);var ot=a(Ce,2),ft=l(ot);{var ht=Ye=>{var Ke=dt(),yt=Ae(Ke);{var b=F=>{var Ne=$n();_t(Ne,5,()=>(e(pe),W(k()),W(ce()),n(()=>Ee(e(pe),k(),ce()))),kt,(me,Je)=>{var xe=wn(),ct=l(xe),rt=l(ct,!0);s(ct);var Ct=a(ct,2),jt=l(Ct);s(Ct),s(xe),j(()=>{D(rt,(e(Je),n(()=>e(Je).display))),D(jt,`(${e(Je),n(()=>e(Je).source)??""})`)}),c(me,xe)}),s(Ne),c(F,Ne)},qe=F=>{var Ne=dt(),me=Ae(Ne);{var Je=xe=>{var ct=Sn(),rt=l(ct);s(ct),j(()=>D(rt,`Modifier: ${e(pe),n(()=>e(pe).constant>=0?"+":"")??""}${e(pe),n(()=>e(pe).constant)??""}`)),c(xe,ct)};h(me,xe=>{e(pe),n(()=>e(pe).constant)&&xe(Je)},!0)}c(F,Ne)};h(yt,F=>{W(ce()),n(()=>ce().length>0)?F(b):F(qe,!1)})}c(Ye,Ke)};h(ft,Ye=>{e(pe),W(ce()),n(()=>e(pe).constant||ce().length>0)&&Ye(ht)})}s(ot);var at=a(ot,2);{var O=Ye=>{var Ke=Cn();c(Ye,Ke)};h(at,Ye=>{e(J)&&Ye(O)})}var X=a(at,2);{var ut=Ye=>{var Ke=jn(),yt=l(Ke);_t(yt,1,()=>e(g),kt,(F,Ne)=>{var me=Dn(),Je=l(me,!0);s(me),j(()=>D(Je,(e(Ne),n(()=>e(Ne).label)))),L("click",me,()=>nt(e(Ne).notation,"damage")),c(F,me)});var b=a(yt,2);{var qe=F=>{var Ne=Ln();j(()=>{Ne.disabled=e(m)<=0,Qe(Ne,"title",e(m)<=0?"No Channel Divinity uses remaining":"Use Channel Divinity to add +10 to this attack roll")}),L("click",Ne,I),c(F,Ne)};h(b,F=>{e(p)&&Q()==="attack"&&!e(He)&&e(m)>0&&!e(J)&&F(qe)})}s(Ke),c(Ye,Ke)};h(X,Ye=>{e(g),e(p),W(Q()),e(He),e(m),n(()=>e(g).length>0||e(p)&&Q()==="attack"&&!e(He)&&e(m)>0)&&Ye(ut)})}j(()=>{D(q,ee()?`${ee()} - Result`:"Result"),D(tt,(e(pe),n(()=>e(pe).resultTotal)))}),c(x,V)};h(le,x=>{e(pe)&&x(Ge)})}s(de),s(ye),s(Se),j(()=>{re=St(Se,1,"modal-overlay svelte-1r90jgp",null,re,{hidden:!E()}),$e=St(de,1,"roll-result svelte-1r90jgp",null,$e,{"has-result":e(pe)})}),L("click",Le,C),L("click",Ve,Z),L("click",ye,rs(function(x){$a.call(this,o,x)})),L("keydown",ye,function(x){$a.call(this,o,x)}),L("click",Se,Z),L("keydown",Se,x=>x.key==="Escape"&&Z()),c(i,Se),dl(o,"getLastRollTotal",Be);var he=zt(ge);return d(),he}const qa="https://api.github.com/gists";async function Mn(i,o,t){if(!o)throw new Error("GitHub token is required");const v=JSON.stringify(i,null,2),d=`${i.name||"character"}_dnd.json`,p={description:t||`D&D Character: ${i.name}`,public:!1,files:{[d]:{content:v}}},m=await fetch(qa,{method:"POST",headers:{Authorization:`token ${o}`,"Content-Type":"application/json"},body:JSON.stringify(p)});if(!m.ok)throw new Error(`Failed to create gist: ${m.statusText}`);return(await m.json()).id}async function Fn(i,o,t){if(!o||!t)throw new Error("GitHub token and Gist ID are required");const v=JSON.stringify(i,null,2),p={files:{[`${i.name||"character"}_dnd.json`]:{content:v}}},m=await fetch(`${qa}/${t}`,{method:"PATCH",headers:{Authorization:`token ${o}`,"Content-Type":"application/json"},body:JSON.stringify(p)});if(!m.ok)throw new Error(`Failed to update gist: ${m.statusText}`)}async function Pn(i,o){if(!i)throw new Error("Gist ID is required");const t={"Content-Type":"application/json"};o&&(t.Authorization=`token ${o}`);const v=await fetch(`${qa}/${i}`,{method:"GET",headers:t});if(!v.ok)throw new Error(`Failed to load gist: ${v.statusText}`);const d=await v.json(),p=Object.values(d.files);if(p.length===0)throw new Error("No files found in gist");const w=p[0].content;try{const _=JSON.parse(w);return _.attacks&&Array.isArray(_.attacks)&&(_.attacks=_.attacks.map(k=>({...k,id:k.id||crypto.randomUUID()}))),_.classFeatures?(_.classFeatures.features||(_.classFeatures.features={}),_.classFeatures.spellSlots||(_.classFeatures.spellSlots=[]),_.classFeatures.preparedSpells===void 0&&(_.classFeatures.preparedSpells="")):_.classFeatures={features:{},spellSlots:[],preparedSpells:""},_}catch{throw new Error("Invalid character data in gist")}}function ys(i){typeof window<"u"&&localStorage.setItem("dnd_gist_config",JSON.stringify(i))}function Tn(){if(typeof window<"u"){const i=localStorage.getItem("dnd_gist_config");if(i)return JSON.parse(i)}return{}}async function In(i,o=30){if(!i)throw new Error("GitHub token is required to list gists");const t=await fetch(`${qa}?per_page=${o}`,{method:"GET",headers:{Authorization:`token ${i}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error(`Failed to list gists: ${t.statusText}`);return await t.json()}var En=f('<div class="error-message svelte-1jb5ckg"> </div>'),Hn=f('<div class="toggle-container svelte-1jb5ckg"><button type="button" class="toggle-btn svelte-1jb5ckg"> </button></div>'),Un=f('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID (leave empty to create new)</label> <input type="text" id="gistId" placeholder="Optional: existing Gist ID to update" class="svelte-1jb5ckg"/></div>'),Nn=f('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),On=f('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),Gn=f('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Update (or leave unselected to create new)</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),qn=f('<div class="info-message svelte-1jb5ckg">No gists found. A new one will be created.</div>'),Wn=f('<!> <div class="form-group svelte-1jb5ckg"><label for="description" class="svelte-1jb5ckg"> </label> <input type="text" id="description" placeholder="D&amp;D Character Sheet" class="svelte-1jb5ckg"/></div>',1),zn=f('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID *</label> <input type="text" id="gistId" placeholder="Enter Gist ID (for public or your private gists)" required class="svelte-1jb5ckg"/></div>'),Kn=f('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),Vn=f('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),Jn=f('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Load</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),Yn=f('<div class="info-message svelte-1jb5ckg">No gists found. Enter a Gist ID manually or create a new one in Save mode.</div>'),Qn=f('<div class="modal-overlay svelte-1jb5ckg" role="button" tabindex="-1"><div class="modal-content svelte-1jb5ckg" role="dialog" tabindex="0"><div class="modal-header svelte-1jb5ckg"><h2 class="svelte-1jb5ckg"> </h2> <button class="close-btn svelte-1jb5ckg">√ó</button></div> <div class="modal-body svelte-1jb5ckg"><!> <div class="form-group svelte-1jb5ckg"><label for="token" class="svelte-1jb5ckg"> <a href="https://github.com/settings/tokens" target="_blank" rel="noopener" class="svelte-1jb5ckg">Get token</a></label> <input type="password" id="token" placeholder="ghp_xxxxxxxxxxxxx" class="svelte-1jb5ckg"/></div> <!> <!> <div class="modal-actions svelte-1jb5ckg"><button class="btn btn-primary svelte-1jb5ckg"><!></button> <button class="btn btn-secondary svelte-1jb5ckg">Cancel</button></div></div></div></div>');function Xn(i,o){Wt(o,!1);const t=()=>st(ue,"$character",v),[v,d]=ra(),p=_a();let m=xt(o,"mode",8,"save"),w=S(""),_=S(""),k=S(""),E=S(!1),M=S(""),ee=S(!1),fe=S(!1),ce=S([]),Q=S(null);const U=Tn();U.token&&r(w,U.token),U.gistId&&r(_,U.gistId),Ca(async()=>{e(w)&&!e(ee)&&await H()});async function H(){if(e(w)){r(fe,!0),r(M,"");try{r(ce,await In(e(w))),e(_)&&r(Q,e(ce).find(C=>C.id===e(_))||null)}catch(C){r(M,C.message||"Failed to load gists"),r(ce,[])}finally{r(fe,!1)}}}function _e(C){r(Q,C),r(_,C.id)}function Pe(){r(ee,!e(ee)),r(M,""),!e(ee)&&e(w)&&H()}async function pe(){if(!e(w)){r(M,"GitHub token is required");return}const C=e(Q)?.id||e(_);r(E,!0),r(M,"");try{if(C)await Fn(t(),e(w),C),r(_,C),It.add("Character updated in Gist successfully!","success");else{const I=await Mn(t(),e(w),e(k));r(_,I),It.add(`Character saved to Gist! ID: ${I}`,"success")}ys({token:e(w),gistId:e(_)}),p("close")}catch(I){r(M,I.message||"Failed to save to Gist")}finally{r(E,!1)}}async function Be(){const C=e(Q)?.id||e(_);if(!C){r(M,"Please select a gist or enter a Gist ID");return}r(E,!0),r(M,"");try{const I=await Pn(C,e(w)||void 0);ue.set(I),r(_,C),ys({token:e(w),gistId:e(_)}),It.add("Character loaded from Gist successfully!","success"),p("close")}catch(I){r(M,I.message||"Failed to load from Gist")}finally{r(E,!1)}}function Ee(){p("close")}qt();var ae=Qn(),ke=l(ae),Re=l(ke),B=l(Re),P=l(B,!0);s(B);var y=a(B,2);s(Re);var K=a(Re,2),g=l(K);{var R=C=>{var I=En(),Z=l(I,!0);s(I),j(()=>D(Z,e(M))),c(C,I)};h(g,C=>{e(M)&&C(R)})}var J=a(g,2),He=l(J),Ue=l(He);Jt(),s(He);var oe=a(He,2);De(oe),s(J);var ve=a(J,2);{var ze=C=>{var I=Hn(),Z=l(I),ge=l(Z,!0);s(Z),s(I),j(()=>{Z.disabled=e(E),D(ge,e(ee)?"üìã Show My Gists":"‚úèÔ∏è Enter Gist ID Manually")}),L("click",Z,Pe),c(C,I)};h(ve,C=>{(m()==="load"||m()==="save"&&e(w))&&C(ze)})}var We=a(ve,2);{var lt=C=>{var I=Wn(),Z=Ae(I);{var ge=Le=>{var Ve=Un(),Me=a(l(Ve),2);De(Me),s(Ve),j(()=>Me.disabled=e(E)),Ie(Me,()=>e(_),Ze=>r(_,Ze)),c(Le,Ve)},Se=Le=>{var Ve=dt(),Me=Ae(Ve);{var Ze=u=>{var we=Nn();c(u,we)},se=u=>{var we=dt(),be=Ae(we);{var G=de=>{var $e=Gn(),le=a(l($e),2);_t(le,5,()=>e(ce),kt,(Ge,he)=>{var x=On();let V;var ie=l(x),ne=l(ie),q=l(ne,!0);s(ne);var te=a(ne,2),Te=l(te,!0);s(te),s(ie);var Y=a(ie,2),Fe=l(Y),Ce=l(Fe);s(Fe);var tt=a(Fe,2),ot=l(tt);s(tt),s(Y),s(x),j(ft=>{V=St(x,1,"gist-item svelte-1jb5ckg",null,V,{selected:e(Q)?.id===e(he).id}),x.disabled=e(E),D(q,(e(he),n(()=>e(he).description||"Untitled"))),D(Te,(e(he),n(()=>e(he).public?"üåê Public":"üîí Private"))),D(Ce,`ID: ${e(he),n(()=>e(he).id)??""}`),D(ot,`Updated: ${ft??""}`)},[()=>(e(he),n(()=>new Date(e(he).updated_at).toLocaleDateString()))]),L("click",x,()=>_e(e(he))),c(Ge,x)}),s(le),s($e),c(de,$e)},je=de=>{var $e=dt(),le=Ae($e);{var Ge=he=>{var x=qn();c(he,x)};h(le,he=>{e(w)&&he(Ge)},!0)}c(de,$e)};h(be,de=>{e(ce),n(()=>e(ce).length>0)?de(G):de(je,!1)},!0)}c(u,we)};h(Me,u=>{e(fe)?u(Ze):u(se,!1)},!0)}c(Le,Ve)};h(Z,Le=>{e(ee)||!e(w)?Le(ge):Le(Se,!1)})}var re=a(Z,2),ye=l(re),z=l(ye);s(ye);var A=a(ye,2);De(A),s(re),j(()=>{D(z,`Description ${e(_)?"(optional)":""}`),A.disabled=e(E)}),Ie(A,()=>e(k),Le=>r(k,Le)),c(C,I)},it=C=>{var I=dt(),Z=Ae(I);{var ge=re=>{var ye=zn(),z=a(l(ye),2);De(z),s(ye),j(()=>z.disabled=e(E)),Ie(z,()=>e(_),A=>r(_,A)),c(re,ye)},Se=re=>{var ye=dt(),z=Ae(ye);{var A=Ve=>{var Me=Kn();c(Ve,Me)},Le=Ve=>{var Me=dt(),Ze=Ae(Me);{var se=we=>{var be=Jn(),G=a(l(be),2);_t(G,5,()=>e(ce),kt,(je,de)=>{var $e=Vn();let le;var Ge=l($e),he=l(Ge),x=l(he,!0);s(he);var V=a(he,2),ie=l(V,!0);s(V),s(Ge);var ne=a(Ge,2),q=l(ne),te=l(q);s(q);var Te=a(q,2),Y=l(Te);s(Te),s(ne),s($e),j(Fe=>{le=St($e,1,"gist-item svelte-1jb5ckg",null,le,{selected:e(Q)?.id===e(de).id}),$e.disabled=e(E),D(x,(e(de),n(()=>e(de).description||"Untitled"))),D(ie,(e(de),n(()=>e(de).public?"üåê Public":"üîí Private"))),D(te,`ID: ${e(de),n(()=>e(de).id)??""}`),D(Y,`Updated: ${Fe??""}`)},[()=>(e(de),n(()=>new Date(e(de).updated_at).toLocaleDateString()))]),L("click",$e,()=>_e(e(de))),c(je,$e)}),s(G),s(be),c(we,be)},u=we=>{var be=dt(),G=Ae(be);{var je=de=>{var $e=Yn();c(de,$e)};h(G,de=>{e(w)&&de(je)},!0)}c(we,be)};h(Ze,we=>{e(ce),n(()=>e(ce).length>0)?we(se):we(u,!1)},!0)}c(Ve,Me)};h(z,Ve=>{e(fe)?Ve(A):Ve(Le,!1)},!0)}c(re,ye)};h(Z,re=>{e(ee)||!e(w)?re(ge):re(Se,!1)},!0)}c(C,I)};h(We,C=>{m()==="save"?C(lt):C(it,!1)})}var nt=a(We,2),et=l(nt),bt=l(et);{var $=C=>{var I=Gt();j(()=>D(I,m()==="save"?"Saving...":"Loading...")),c(C,I)},N=C=>{var I=Gt();j(()=>D(I,m()==="save"?"Save":"Load")),c(C,I)};h(bt,C=>{e(E)?C($):C(N,!1)})}s(et);var T=a(et,2);s(nt),s(K),s(ke),s(ae),j(()=>{D(P,m()==="save"?"Save to GitHub Gist":"Load from GitHub Gist"),D(Ue,`GitHub Token ${m()==="load"?"(optional for public gists)":"(required)"} `),oe.disabled=e(E),et.disabled=e(E),T.disabled=e(E)}),L("click",y,Ee),Ie(oe,()=>e(w),C=>r(w,C)),L("blur",oe,()=>{e(w)&&!e(ee)&&H()}),L("click",et,function(...C){(m()==="save"?pe:Be)?.apply(this,C)}),L("click",T,Ee),L("click",ke,rs(function(C){$a.call(this,o,C)})),L("keydown",ke,function(C){$a.call(this,o,C)}),L("click",ae,Ee),L("keydown",ae,C=>C.key==="Escape"&&Ee()),c(i,ae),zt(),d()}var Zn=f('<div class="loading svelte-1ngjemu">Loading D&D data...</div>'),er=f("<option> </option>"),tr=f('<select class="level-filter svelte-1ngjemu"><option>All Levels</option><option>Cantrip</option><!></select>'),ar=f('<div class="no-results svelte-1ngjemu"> </div>'),sr=f('<div class="item-meta svelte-1ngjemu"> </div>'),lr=f('<div class="item-meta svelte-1ngjemu"> </div>'),ir=f('<button><div class="item-name svelte-1ngjemu"> </div> <!></button>'),nr=f('<p class="higher-levels"><strong>At Higher Levels:</strong> </p>'),rr=f('<p class="cantrip-upgrade"><strong>Cantrip Upgrade:</strong> </p>'),or=f('<h3 class="svelte-1ngjemu"> </h3> <p class="spell-meta svelte-1ngjemu"><!> <!></p> <p class="spell-classes"><strong>Classes:</strong> </p> <div class="spell-stats svelte-1ngjemu"><div><strong>Casting Time:</strong> </div> <div><strong>Range:</strong> </div> <div><strong>Components:</strong> <!></div> <div><strong>Duration:</strong> <!> </div></div> <p class="description svelte-1ngjemu"> </p> <!> <!>',1),cr=f('<p class="prerequisite svelte-1ngjemu"><strong>Prerequisite:</strong> </p>'),vr=f('<h3 class="svelte-1ngjemu"> </h3> <!> <p class="description svelte-1ngjemu"> </p> <a target="_blank" rel="noopener" class="source-link svelte-1ngjemu">View Full Details ‚Üí</a>',1),dr=f('<div class="item-details svelte-1ngjemu"><!></div>'),ur=f('<div class="controls svelte-1ngjemu"><div class="tabs svelte-1ngjemu"><button> </button> <button> </button></div> <div class="search-controls svelte-1ngjemu"><input type="text" placeholder="Search by name or description..." class="search-input svelte-1ngjemu"/> <!></div></div> <div class="content-container svelte-1ngjemu"><div class="items-list svelte-1ngjemu"><!></div> <!></div>',1),fr=f('<div class="modal-backdrop svelte-1ngjemu" role="presentation"><div class="modal svelte-1ngjemu" role="dialog" aria-modal="true" tabindex="-1"><div class="modal-header svelte-1ngjemu"><h2 class="svelte-1ngjemu">Browse D&D Spells & Feats</h2> <button class="close-btn svelte-1ngjemu" aria-label="Close">&times;</button></div> <div class="modal-body svelte-1ngjemu"><!></div> <div class="modal-footer svelte-1ngjemu"><button class="btn-secondary svelte-1ngjemu">Cancel</button> <button class="btn-primary svelte-1ngjemu">Add to Character Sheet</button></div></div></div>');function pr(i,o){Wt(o,!1);const t=S(),v=S(),d=S();let p=xt(o,"onClose",8),m=S("spell"),w=S(!0),_=S(""),k=S(null),E=S([]),M=S([]),ee=S(null);Ca(async()=>{r(w,!0);try{r(E,await As()),r(M,await Xl())}catch(y){console.error("Failed to load data:",y)}finally{r(w,!1)}});function fe(y){r(ee,y)}function ce(y){const K=y.match(/(\d+d\d+(?:\s*\+\s*\d+)?)/i);return K?K[1]:""}function Q(y){const K=y.split(/\.( |$)/)[0].trim(),g=Array.from(y.matchAll(/\*\*(.*?)\*\*/g)).map(J=>J[1].replace(/\.$/,""));let R=K;return g.length&&(R+=" | Effects: "+g.join(", ")),R}function U(){if(e(ee)){if(e(m)==="spell"){const y=e(ee);ue.update(K=>{const R=[];y.range&&R.push(`Range: ${y.range}`),y.castingTime&&R.push(`Cast: ${y.castingTime}`),y.duration&&R.push(`Duration: ${y.duration}`),y.actionType==="Save"&&R.push("Saving throw spell"),y.components&&y.components.length>0&&R.push(`Components: ${y.components.join(", ")}`),y.material&&R.push(`Material: ${y.material}`);const J=R.join(" | "),He=Q(y.description),Ue={id:crypto.randomUUID(),name:`${y.name}${y.concentration?" (C)":""}${y.ritual?" (R)":""}`,bonus:y.actionType==="Attack"?5:0,damage:ce(y.description),damageType:`${y.school} (Lvl ${y.level})`,spellRef:y.name,infoNotes:J,generalNotes:He,castAtLevel:y.level};return K.attacks=[...K.attacks,Ue],K})}else if(e(m)==="feat"){const y=e(ee);ue.update(K=>{const g=`${y.name}${y.prerequisite?` (Req: ${y.prerequisite})`:""}
${y.description}
`;return K.features=K.features?`${K.features}
${g}`:g,K})}r(ee,null),p()()}}Xe(()=>(e(k),e(E),e(_)),()=>{r(t,e(k)!==null?Zl(bs(e(E),e(_)),e(k)):bs(e(E),e(_)))}),Xe(()=>(e(M),e(_)),()=>{r(v,ei(e(M),e(_)))}),Xe(()=>(e(m),e(t),e(v)),()=>{r(d,e(m)==="spell"?e(t):e(v))}),va(),qt();var H=fr(),_e=l(H),Pe=l(_e),pe=a(l(Pe),2);s(Pe);var Be=a(Pe,2),Ee=l(Be);{var ae=y=>{var K=Zn();c(y,K)},ke=y=>{var K=ur(),g=Ae(K),R=l(g),J=l(R);let He;var Ue=l(J);s(J);var oe=a(J,2);let ve;var ze=l(oe);s(oe),s(R);var We=a(R,2),lt=l(We);De(lt);var it=a(lt,2);{var nt=Z=>{var ge=tr();j(()=>{e(k),Tt(()=>{})});var Se=l(ge);Se.value=(Se.__value=null)??"";var re=a(Se);re.value=re.__value=0;var ye=a(re);_t(ye,0,()=>[1,2,3,4,5,6,7,8,9],kt,(z,A)=>{var Le=er(),Ve=l(Le);s(Le);var Me={};j(()=>{D(Ve,`Level ${A??""}`),Me!==(Me=A)&&(Le.value=(Le.__value=A)??"")}),c(z,Le)}),s(ge),Ma(ge,()=>e(k),z=>r(k,z)),c(Z,ge)};h(it,Z=>{e(m)==="spell"&&Z(nt)})}s(We),s(g);var et=a(g,2),bt=l(et),$=l(bt);{var N=Z=>{var ge=ar(),Se=l(ge);s(ge),j(()=>D(Se,`No ${e(m)??""}s found`)),c(Z,ge)},T=Z=>{var ge=dt(),Se=Ae(ge);_t(Se,1,()=>e(d),kt,(re,ye)=>{var z=ir();let A;var Le=l(z),Ve=l(Le,!0);s(Le);var Me=a(Le,2);{var Ze=u=>{const we=gt(()=>e(ye));var be=sr(),G=l(be);s(be),j(()=>D(G,`Level ${W(e(we)),n(()=>e(we).level)??""} ‚Ä¢ ${W(e(we)),n(()=>e(we).school)??""}`)),c(u,be)},se=u=>{const we=gt(()=>e(ye));var be=dt(),G=Ae(be);{var je=de=>{var $e=lr(),le=l($e,!0);s($e),j(()=>D(le,(W(e(we)),n(()=>e(we).prerequisite)))),c(de,$e)};h(G,de=>{W(e(we)),n(()=>e(we).prerequisite)&&de(je)})}c(u,be)};h(Me,u=>{e(m)==="spell"?u(Ze):u(se,!1)})}s(z),j(()=>{A=St(z,1,"item-card svelte-1ngjemu",null,A,{selected:e(ee)?.name===e(ye).name}),D(Ve,(e(ye),n(()=>e(ye).name)))}),L("click",z,()=>fe(e(ye))),c(re,z)}),c(Z,ge)};h($,Z=>{e(d),n(()=>e(d).length===0)?Z(N):Z(T,!1)})}s(bt);var C=a(bt,2);{var I=Z=>{var ge=dr(),Se=l(ge);{var re=z=>{const A=gt(()=>e(ee));var Le=or(),Ve=Ae(Le),Me=l(Ve,!0);s(Ve);var Ze=a(Ve,2),se=l(Ze);{var u=O=>{var X=Gt();j(()=>D(X,`${W(e(A)),n(()=>e(A).school)??""} cantrip`)),c(O,X)},we=O=>{var X=Gt();j(()=>D(X,`Level ${W(e(A)),n(()=>e(A).level)??""} ${W(e(A)),n(()=>e(A).school)??""}`)),c(O,X)};h(se,O=>{W(e(A)),n(()=>e(A).level===0)?O(u):O(we,!1)})}var be=a(se,2);{var G=O=>{var X=Gt("(ritual)");c(O,X)};h(be,O=>{W(e(A)),n(()=>e(A).ritual)&&O(G)})}s(Ze);var je=a(Ze,2),de=a(l(je));s(je);var $e=a(je,2),le=l($e),Ge=a(l(le));s(le);var he=a(le,2),x=a(l(he));s(he);var V=a(he,2),ie=a(l(V)),ne=a(ie);{var q=O=>{var X=Gt();j(()=>D(X,`(${W(e(A)),n(()=>e(A).material)??""})`)),c(O,X)};h(ne,O=>{W(e(A)),n(()=>e(A).material)&&O(q)})}s(V);var te=a(V,2),Te=a(l(te),2);{var Y=O=>{var X=Gt("Concentration,");c(O,X)};h(Te,O=>{W(e(A)),n(()=>e(A).concentration)&&O(Y)})}var Fe=a(Te,1,!0);s(te),s($e);var Ce=a($e,2),tt=l(Ce,!0);s(Ce);var ot=a(Ce,2);{var ft=O=>{var X=nr(),ut=a(l(X));s(X),j(()=>D(ut,` ${W(e(A)),n(()=>e(A).higherLevelSlot)??""}`)),c(O,X)};h(ot,O=>{W(e(A)),n(()=>e(A).higherLevelSlot)&&O(ft)})}var ht=a(ot,2);{var at=O=>{var X=rr(),ut=a(l(X));s(X),j(()=>D(ut,` ${W(e(A)),n(()=>e(A).cantripUpgrade)??""}`)),c(O,X)};h(ht,O=>{W(e(A)),n(()=>e(A).cantripUpgrade)&&O(at)})}j((O,X)=>{D(Me,(W(e(A)),n(()=>e(A).name))),D(de,` ${O??""}`),D(Ge,` ${W(e(A)),n(()=>e(A).castingTime||e(A).actionType)??""}`),D(x,` ${W(e(A)),n(()=>e(A).range)??""}`),D(ie,` ${X??""}`),D(Fe,(W(e(A)),n(()=>e(A).duration))),D(tt,(W(e(A)),n(()=>e(A).description)))},[()=>(W(e(A)),n(()=>e(A).classes.join(", "))),()=>(W(e(A)),n(()=>e(A).components.join(", ").toUpperCase()))]),c(z,Le)},ye=z=>{const A=gt(()=>e(ee));var Le=vr(),Ve=Ae(Le),Me=l(Ve,!0);s(Ve);var Ze=a(Ve,2);{var se=G=>{var je=cr(),de=a(l(je));s(je),j(()=>D(de,` ${W(e(A)),n(()=>e(A).prerequisite)??""}`)),c(G,je)};h(Ze,G=>{W(e(A)),n(()=>e(A).prerequisite)&&G(se)})}var u=a(Ze,2),we=l(u,!0);s(u);var be=a(u,2);j(()=>{D(Me,(W(e(A)),n(()=>e(A).name))),D(we,(W(e(A)),n(()=>e(A).description))),Qe(be,"href",(W(e(A)),n(()=>e(A).source)))}),c(z,Le)};h(Se,z=>{e(m)==="spell"?z(re):z(ye,!1)})}s(ge),c(Z,ge)};h(C,Z=>{e(ee)&&Z(I)})}s(et),j(()=>{He=St(J,1,"tab svelte-1ngjemu",null,He,{active:e(m)==="spell"}),D(Ue,`üìú Spells (${e(E),n(()=>e(E).length)??""})`),ve=St(oe,1,"tab svelte-1ngjemu",null,ve,{active:e(m)==="feat"}),D(ze,`‚≠ê Feats (${e(M),n(()=>e(M).length)??""})`)}),L("click",J,()=>{r(m,"spell"),r(ee,null),r(_,"")}),L("click",oe,()=>{r(m,"feat"),r(ee,null),r(_,"")}),Ie(lt,()=>e(_),Z=>r(_,Z)),c(y,K)};h(Ee,y=>{e(w)?y(ae):y(ke,!1)})}s(Be);var Re=a(Be,2),B=l(Re),P=a(B,2);s(Re),s(_e),s(H),j(()=>P.disabled=!e(ee)),L("click",pe,function(...y){p()?.apply(this,y)}),L("click",B,function(...y){p()?.apply(this,y)}),L("click",P,U),L("click",_e,rs(function(y){$a.call(this,o,y)})),L("keydown",_e,function(y){$a.call(this,o,y)}),L("click",H,function(...y){p()?.apply(this,y)}),L("keydown",H,y=>y.key==="Escape"&&p()()),c(i,H),zt()}var mr=f('<span class="resistance-tag svelte-gdwwx1"> <button type="button" class="tag-remove svelte-gdwwx1">√ó</button></span>'),gr=f('<div class="resistance-list svelte-gdwwx1"></div>'),br=f('<p class="ability-meta svelte-gdwwx1"> <!></p>'),hr=f('<p class="ability-meta svelte-gdwwx1">Requires Reaction</p>'),_r=f('<div class="ability-card svelte-gdwwx1"><div class="ability-header svelte-gdwwx1"><strong class="svelte-gdwwx1"> </strong> <button type="button" class="ability-remove svelte-gdwwx1">√ó</button></div> <p class="ability-description svelte-gdwwx1"> </p> <!></div>'),yr=f('<div class="abilities-list svelte-gdwwx1"></div>'),xr=f(`<div class="modal-backdrop svelte-gdwwx1" role="presentation"><div class="modal-content svelte-gdwwx1" role="dialog" aria-modal="true" aria-labelledby="modal-title"><div class="modal-header svelte-gdwwx1"><h3 id="modal-title" class="svelte-gdwwx1">Add Custom Condition</h3> <button class="btn-close svelte-gdwwx1" aria-label="Close">√ó</button></div> <div class="modal-body svelte-gdwwx1"><div class="form-group svelte-gdwwx1"><label for="conditionName" class="svelte-gdwwx1">Condition Name*</label> <input type="text" id="conditionName" placeholder="e.g., Cazna's Mark" class="svelte-gdwwx1"/></div> <div class="form-group svelte-gdwwx1"><label for="description" class="svelte-gdwwx1">Description</label> <textarea id="description" placeholder="Describe the condition..." rows="3" class="svelte-gdwwx1"></textarea></div> <div class="form-row svelte-gdwwx1"><div class="form-group svelte-gdwwx1"><label for="attackBonus" class="svelte-gdwwx1">Attack Bonus</label> <input type="text" id="attackBonus" placeholder="0 or 1d4" class="svelte-gdwwx1"/></div> <div class="form-group svelte-gdwwx1"><label for="damageBonus" class="svelte-gdwwx1">Damage Bonus</label> <input type="text" id="damageBonus" placeholder="0 or 1d6" class="svelte-gdwwx1"/></div> <div class="form-group svelte-gdwwx1"><label for="acBonus" class="svelte-gdwwx1">AC Bonus</label> <input type="number" id="acBonus" placeholder="0" class="svelte-gdwwx1"/></div></div> <div class="form-group svelte-gdwwx1"><label for="darkvision" class="svelte-gdwwx1">Darkvision (feet)</label> <input type="number" id="darkvision" placeholder="0" min="0" step="30" class="svelte-gdwwx1"/> <small class="help-text svelte-gdwwx1">Grant or extend darkvision (e.g., 60 for 60 feet)</small></div> <div class="form-group svelte-gdwwx1"><label class="svelte-gdwwx1">Damage Resistances</label> <div class="resistance-input-group svelte-gdwwx1"><input type="text" placeholder="e.g., cold, fire, poison" class="svelte-gdwwx1"/> <button type="button" class="btn-add svelte-gdwwx1">Add</button></div> <!></div> <div class="form-group svelte-gdwwx1"><label class="svelte-gdwwx1">Special Abilities</label> <div class="ability-form svelte-gdwwx1"><input type="text" placeholder="Ability name (e.g., Flicker of Deceit)" class="ability-name-input svelte-gdwwx1"/> <textarea placeholder="Ability description..." rows="2" class="ability-desc-input svelte-gdwwx1"></textarea> <div class="ability-options svelte-gdwwx1"><div class="ability-option svelte-gdwwx1"><label for="abilityUses" class="svelte-gdwwx1">Uses per rest</label> <input type="number" id="abilityUses" min="0" class="svelte-gdwwx1"/></div> <div class="ability-option svelte-gdwwx1"><label for="restType" class="svelte-gdwwx1">Rest type</label> <select id="restType" class="svelte-gdwwx1"><option>Short</option><option>Long</option></select></div> <div class="ability-option svelte-gdwwx1"><label class="svelte-gdwwx1"><input type="checkbox" class="svelte-gdwwx1"/> Requires Reaction</label></div></div> <button type="button" class="btn-add svelte-gdwwx1">Add Ability</button></div> <!></div></div> <div class="modal-footer svelte-gdwwx1"><button class="btn btn-secondary svelte-gdwwx1">Cancel</button> <button class="btn btn-primary svelte-gdwwx1">Add Condition</button></div></div></div>`);function kr(i,o){Wt(o,!1);let t=xt(o,"show",8,!1),v=xt(o,"onSave",8),d=xt(o,"onCancel",8),p=S(""),m=S(""),w=S(0),_=S(0),k=S(0),E=S(0),M=S([]),ee=S(""),fe=S([]),ce=S(""),Q=S(""),U=S(0),H=S("short"),_e=S(!1);function Pe(){r(p,""),r(m,""),r(w,0),r(_,0),r(k,0),r(E,0),r(M,[]),r(ee,""),r(fe,[]),r(ce,""),r(Q,""),r(U,0),r(H,"short"),r(_e,!1)}function pe(){e(ee).trim()&&(r(M,[...e(M),e(ee).trim()]),r(ee,""))}function Be(g){r(M,e(M).filter((R,J)=>J!==g))}function Ee(){if(e(ce).trim()&&e(Q).trim()){const g={name:e(ce).trim(),description:e(Q).trim(),requiresReaction:e(_e)};e(U)>0&&(g.usesPerRest=e(U),g.currentUses=e(U),g.restType=e(H)),r(fe,[...e(fe),g]),r(ce,""),r(Q,""),r(U,0),r(H,"short"),r(_e,!1)}}function ae(g){r(fe,e(fe).filter((R,J)=>J!==g))}function ke(){if(!e(p).trim()){alert("Please enter a condition name");return}const g={name:e(p).trim(),description:e(m).trim()||"Custom condition",attackBonus:e(w)||0,damageBonus:e(_)||0,target:"self"};e(k)!==0&&(g.acBonus=e(k)),e(E)>0&&(g.darkvision=e(E)),e(M).length>0&&(g.resistances=e(M)),e(fe).length>0&&(g.abilities=e(fe)),v()(g),Pe()}function Re(){Pe(),d()()}function B(g){g.target===g.currentTarget&&Re()}qt();var P=dt(),y=Ae(P);{var K=g=>{var R=xr(),J=l(R),He=l(J),Ue=a(l(He),2);s(He);var oe=a(He,2),ve=l(oe),ze=a(l(ve),2);De(ze),s(ve);var We=a(ve,2),lt=a(l(We),2);xa(lt),s(We);var it=a(We,2),nt=l(it),et=a(l(nt),2);De(et),s(nt);var bt=a(nt,2),$=a(l(bt),2);De($),s(bt);var N=a(bt,2),T=a(l(N),2);De(T),s(N),s(it);var C=a(it,2),I=a(l(C),2);De(I),Jt(2),s(C);var Z=a(C,2),ge=a(l(Z),2),Se=l(ge);De(Se);var re=a(Se,2);s(ge);var ye=a(ge,2);{var z=q=>{var te=gr();_t(te,5,()=>e(M),kt,(Te,Y,Fe)=>{var Ce=mr(),tt=l(Ce),ot=a(tt);s(Ce),j(()=>{D(tt,`${e(Y)??""} `),Qe(ot,"aria-label",`Remove ${e(Y)??""}`)}),L("click",ot,()=>Be(Fe)),c(Te,Ce)}),s(te),c(q,te)};h(ye,q=>{e(M),n(()=>e(M).length>0)&&q(z)})}s(Z);var A=a(Z,2),Le=a(l(A),2),Ve=l(Le);De(Ve);var Me=a(Ve,2);xa(Me);var Ze=a(Me,2),se=l(Ze),u=a(l(se),2);De(u),s(se);var we=a(se,2),be=a(l(we),2);j(()=>{e(H),Tt(()=>{})});var G=l(be);G.value=G.__value="short";var je=a(G);je.value=je.__value="long",s(be),s(we);var de=a(we,2),$e=l(de),le=l($e);De(le),Jt(),s($e),s(de),s(Ze);var Ge=a(Ze,2);s(Le);var he=a(Le,2);{var x=q=>{var te=yr();_t(te,5,()=>e(fe),kt,(Te,Y,Fe)=>{var Ce=_r(),tt=l(Ce),ot=l(tt),ft=l(ot,!0);s(ot);var ht=a(ot,2);s(tt);var at=a(tt,2),O=l(at,!0);s(at);var X=a(at,2);{var ut=Ke=>{var yt=br(),b=l(yt),qe=a(b);{var F=Ne=>{var me=Gt("‚Ä¢ Requires Reaction");c(Ne,me)};h(qe,Ne=>{e(Y),n(()=>e(Y).requiresReaction)&&Ne(F)})}s(yt),j(()=>D(b,`${e(Y),n(()=>e(Y).usesPerRest)??""} use${e(Y),n(()=>e(Y).usesPerRest>1?"s":"")??""} per ${e(Y),n(()=>e(Y).restType)??""}
                      rest `)),c(Ke,yt)},Ye=Ke=>{var yt=dt(),b=Ae(yt);{var qe=F=>{var Ne=hr();c(F,Ne)};h(b,F=>{e(Y),n(()=>e(Y).requiresReaction)&&F(qe)},!0)}c(Ke,yt)};h(X,Ke=>{e(Y),n(()=>e(Y).usesPerRest)?Ke(ut):Ke(Ye,!1)})}s(Ce),j(()=>{D(ft,(e(Y),n(()=>e(Y).name))),Qe(ht,"aria-label",`Remove ${e(Y),n(()=>e(Y).name)??""}`),D(O,(e(Y),n(()=>e(Y).description)))}),L("click",ht,()=>ae(Fe)),c(Te,Ce)}),s(te),c(q,te)};h(he,q=>{e(fe),n(()=>e(fe).length>0)&&q(x)})}s(A),s(oe);var V=a(oe,2),ie=l(V),ne=a(ie,2);s(V),s(J),s(R),L("click",Ue,Re),Ie(ze,()=>e(p),q=>r(p,q)),Ie(lt,()=>e(m),q=>r(m,q)),Ie(et,()=>e(w),q=>r(w,q)),Ie($,()=>e(_),q=>r(_,q)),Ie(T,()=>e(k),q=>r(k,q)),Ie(I,()=>e(E),q=>r(E,q)),Ie(Se,()=>e(ee),q=>r(ee,q)),L("keydown",Se,q=>q.key==="Enter"&&pe()),L("click",re,pe),Ie(Ve,()=>e(ce),q=>r(ce,q)),Ie(Me,()=>e(Q),q=>r(Q,q)),Ie(u,()=>e(U),q=>r(U,q)),Ma(be,()=>e(H),q=>r(H,q)),wa(le,()=>e(_e),q=>r(_e,q)),L("click",Ge,Ee),L("click",ie,Re),L("click",ne,ke),L("click",R,B),c(g,R)};h(y,g=>{t()&&g(K)})}c(i,P),zt()}var wr=f("<option></option>"),$r=f("<button> </button>"),Sr=f('<button class="btn btn-primary calculate-btn use-enabled svelte-uvfntf">Calculate Damage</button>'),Cr=f('<div class="adjustment-msg svelte-uvfntf"> </div>'),Dr=f('<div class="calculation-result svelte-uvfntf"><div class="result-header svelte-uvfntf"><h4 class="svelte-uvfntf">Damage Calculation</h4></div> <div class="result-content svelte-uvfntf"><div class="damage-breakdown svelte-uvfntf"><div class="damage-row svelte-uvfntf"><span class="label svelte-uvfntf">Original Damage:</span> <span class="value svelte-uvfntf"> </span></div> <div class="adjustments svelte-uvfntf"></div> <div class="damage-row final svelte-uvfntf"><span class="label svelte-uvfntf">Final Damage:</span> <span class="value damage-value svelte-uvfntf"> </span></div></div></div> <div class="result-actions svelte-uvfntf"><button class="btn btn-primary apply-btn use-enabled svelte-uvfntf">Apply Damage</button> <button class="btn btn-secondary cancel-btn use-enabled svelte-uvfntf">Cancel</button></div></div>'),Lr=f('<div class="damage-form svelte-uvfntf"><div class="input-group svelte-uvfntf"><div class="input-field svelte-uvfntf"><label for="damageAmount" class="svelte-uvfntf">Damage Amount</label> <input type="number" id="damageAmount" min="0" placeholder="0" class="damage-input-field use-enabled svelte-uvfntf"/></div> <div class="input-field svelte-uvfntf"><label for="damageType" class="svelte-uvfntf">Damage Type</label> <input type="text" id="damageType" list="damageTypes" placeholder="e.g., fire, cold" class="damage-input-field use-enabled svelte-uvfntf"/> <datalist id="damageTypes"></datalist></div></div> <div class="quick-types svelte-uvfntf"><span class="quick-types-label svelte-uvfntf">Quick Select:</span> <!></div> <!></div>'),jr=f("<section><!> <!></section>");function Ar(i,o){Wt(o,!1);const t=()=>st(ue,"$character",p),v=()=>st(ga,"$searchFilter",p),d=()=>st(Yt,"$collapsedStates",p),[p,m]=ra(),w=S();_a();let _=S(0),k=S(""),E=S(!1),M=S(0),ee=S([]);const fe=["slashing","piercing","bludgeoning","fire","cold","lightning","thunder","acid","poison","necrotic","radiant","psychic","force"];function ce(){if(e(_)<0){It.add("Damage amount cannot be negative","error");return}if(!e(k).trim()){It.add("Please enter or select a damage type","error");return}const Ee=Al(e(_),e(k),t());r(M,Ee.finalDamage),r(ee,Ee.adjustments),r(E,!0)}function Q(){ue.update(Ee=>Bl(Ee,e(M))),It.add(`Applied ${e(M)} damage to character (${e(k)})`,"info"),r(_,0),r(k,""),r(E,!1),r(M,0),r(ee,[])}function U(){r(E,!1),r(M,0),r(ee,[])}Xe(()=>v(),()=>{r(w,!v()||"damage".includes(v().toLowerCase())||"resistance".includes(v().toLowerCase())||"immune".includes(v().toLowerCase()))}),va(),qt();var H=jr();let _e;var Pe=l(H);{let Ee=gt(()=>(d(),n(()=>d().damageInput?"Expand":"Collapse")));ya(Pe,{title:"Apply Damage",get collapsed(){return d(),n(()=>d().damageInput)},get ariaLabel(){return e(Ee)},onToggle:()=>Yt.update(ae=>({...ae,damageInput:!ae.damageInput}))})}var pe=a(Pe,2);{var Be=Ee=>{var ae=Lr(),ke=l(ae),Re=l(ke),B=a(l(Re),2);De(B),s(Re);var P=a(Re,2),y=a(l(P),2);De(y);var K=a(y,2);_t(K,5,()=>fe,kt,(oe,ve)=>{var ze=wr(),We={};j(()=>{We!==(We=e(ve))&&(ze.value=(ze.__value=e(ve))??"")}),c(oe,ze)}),s(K),s(P),s(ke);var g=a(ke,2),R=a(l(g),2);_t(R,1,()=>n(()=>fe.slice(0,6)),kt,(oe,ve)=>{var ze=$r();let We;var lt=l(ze,!0);s(ze),j(()=>{We=St(ze,1,"quick-type-btn use-enabled svelte-uvfntf",null,We,{active:e(k)===e(ve)}),D(lt,e(ve))}),L("click",ze,()=>r(k,e(ve))),c(oe,ze)}),s(g);var J=a(g,2);{var He=oe=>{var ve=Sr();L("click",ve,ce),c(oe,ve)},Ue=oe=>{var ve=Dr(),ze=a(l(ve),2),We=l(ze),lt=l(We),it=a(l(lt),2),nt=l(it);s(it),s(lt);var et=a(lt,2);_t(et,5,()=>e(ee),kt,(Z,ge)=>{var Se=Cr(),re=l(Se,!0);s(Se),j(()=>D(re,e(ge))),c(Z,Se)}),s(et);var bt=a(et,2),$=a(l(bt),2),N=l($,!0);s($),s(bt),s(We),s(ze);var T=a(ze,2),C=l(T),I=a(C,2);s(T),s(ve),j(()=>{D(nt,`${e(_)??""} ${e(k)??""}`),D(N,e(M))}),L("click",C,Q),L("click",I,U),c(oe,ve)};h(J,oe=>{e(E)?oe(Ue,!1):oe(He)})}s(ae),Ie(B,()=>e(_),oe=>r(_,oe)),Ie(y,()=>e(k),oe=>r(k,oe)),c(Ee,ae)};h(pe,Ee=>{d(),n(()=>!d().damageInput)&&Ee(Be)})}s(H),j(()=>_e=St(H,1,"damage-input svelte-uvfntf",null,_e,{hidden:!e(w)})),c(i,H),zt(),m()}var Br=f('<link rel="icon" type="image/png" href="favicon4.png"/> <meta name="viewport" content="width=device-width, initial-scale=1"/>',1),Rr=f('<span class="character-name svelte-1uha8ag"> </span>'),Mr=f("<span> </span>"),Fr=f('<div class="spell-slots-header svelte-1uha8ag"></div>'),Pr=f("<span> </span><br/>",1),Tr=f("<span> </span><br/>",1),Ir=f("<span> </span><br/>",1),Er=f("<span> </span><br/>",1),Hr=f("<span> </span><br/>",1),Ur=f("<span> </span><br/>",1),Nr=f("<br/><em> <!>)</em>",1),Or=f("<br/><em>(requires reaction)</em>",1),Gr=f('<div class="ability-detail"><strong> </strong> <!></div>'),qr=f('<div class="abilities-section"><strong>Abilities:</strong><br/> <!></div>'),Wr=f('<span class="effect-tooltip"><strong> </strong><br/> <br/> <!> <!> <!> <!> <!> <!> <!></span>'),zr=f('<button class="effect-remove-btn svelte-1uha8ag">√ó</button>'),Kr=f('<span class="effect-badge svelte-1uha8ag" tabindex="0"> <!> <!></span>'),Vr=f(`<div class="active-effects-header svelte-1uha8ag"></div> <style>.effect-badge {
              position: relative;
            }
            .effect-tooltip {
              position: absolute;
              top: 120%;
              left: 50%;
              transform: translateX(-50%);
              background: #fff;
              color: #222;
              border: 1px solid #a5b4fc;
              border-radius: 6px;
              padding: 8px 12px;
              font-size: 0.95em;
              box-shadow: 0 2px 8px rgba(0, 0, 0, 0.12);
              z-index: 10;
              min-width: 180px;
              max-width: 300px;
              white-space: normal;
              pointer-events: none;
              opacity: 1;
              transition: opacity 0.15s;
            }

            .abilities-section {
              margin-top: 8px;
              padding-top: 8px;
              border-top: 1px solid #e5e7eb;
            }

            .ability-detail {
              margin-top: 6px;
              padding: 4px;
              background: #f9fafb;
              border-radius: 4px;
              font-size: 0.9em;
            }

            .ability-detail strong {
              color: #6366f1;
            }

            .ability-detail em {
              font-size: 0.85em;
              color: #6b7280;
            }</style>`,1),Jr=f('<div class="rest-menu svelte-1uha8ag"><button class="rest-option svelte-1uha8ag">‚òï Short Rest</button> <button class="rest-option svelte-1uha8ag">üõèÔ∏è Long Rest</button></div>'),Yr=f('<div class="container svelte-1uha8ag"><header class="svelte-1uha8ag"><div class="header-top svelte-1uha8ag"><div class="header-title svelte-1uha8ag"><div class="title-row svelte-1uha8ag"><h1 class="svelte-1uha8ag">D&D Character Sheet</h1> <!></div> <!> <!></div> <div class="header-right svelte-1uha8ag"><div class="header-controls svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">üé≤</span><span class="btn-text svelte-1uha8ag">Roll Dice</span></button> <div class="rest-button-container svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">üò¥</span><span class="btn-text svelte-1uha8ag">Rest</span></button> <!></div> <button class="btn btn-secondary use-enabled" title="Add custom condition with effects"><span class="btn-icon svelte-1uha8ag">‚ú®</span><span class="btn-text svelte-1uha8ag">Add Condition</span></button> <div class="mode-toggle"><button><span class="btn-icon svelte-1uha8ag"> </span><span class="btn-text svelte-1uha8ag"> </span></button></div></div> <div class="header-search svelte-1uha8ag"><input type="text" placeholder="üîç Search..." class="search-input use-enabled svelte-1uha8ag"/></div></div></div> <div class="header-actions svelte-1uha8ag"><button class="btn btn-mode svelte-1uha8ag">üìö Browse Spells & Feats</button> <button class="btn btn-secondary">Save to Gist</button> <button class="btn btn-secondary">Load from Gist</button> <button class="btn btn-secondary">Export JSON</button> <button class="btn btn-secondary">Import JSON</button> <input type="file" accept=".json" style="display: none;"/></div></header> <main class="svelte-1uha8ag"><!> <!> <!> <!> <!> <!> <!> <!></main></div> <!> <!> <!> <!> <!>',1);function io(i,o){Wt(o,!1);const t=()=>st(ue,"$character",p),v=()=>st(ha,"$isEditMode",p),d=()=>st(ga,"$searchFilter",p),[p,m]=ra();function w(){const b=[],qe=t().classFeatures.spellSlotsByLevel||{};for(let F=1;F<=9;F++){const Ne=qe[F];if(Ne&&Ne.length>0){const me=Ne.length,Je=Ne.filter(xe=>xe).length;b.push({level:F,available:me-Je,total:me})}}return b}let _=S(!1),k=S(!1),E=S(!1),M=S(!1),ee=S("save"),fe=S(void 0),ce=S(""),Q=S(""),U=S(""),H=S(!1),_e=S([]),Pe=S("other"),pe=S(),Be=!1,Ee=1,ae=S(!1),ke=S(null);function Re(b){r(ke,b)}function B(){r(ke,null)}function P(b){r(ke,e(ke)===b?null:b)}function y(b){ue.update(qe=>(qe.activeStates||(qe.activeStates=[]),qe.activeStates=[...qe.activeStates,b],qe)),r(M,!1),It.add(`Added condition: ${b.name}`,"success")}function K(){r(M,!1)}function g(){const b=[];ue.update(F=>{const Ne=F.hitDice.current;F.hitDice.current=Math.min(F.hitDice.max,F.hitDice.current+Math.max(1,Math.floor(F.hitDice.max/2)));const me=F.hitDice.current-Ne;if(me>0&&b.push(`${me} hit ${me===1?"die":"dice"}`),F.class){const Je=Sa(F.class,F.level,F.subclass);F.classFeatures.features||(F.classFeatures.features={}),Je.forEach(xe=>{if(xe.resetOn==="short"){const ct=xe.name.replace(/\s+/g,"");if(xe.type==="uses"){const rt=typeof xe.maxUses=="function"?xe.maxUses(F.level):xe.maxUses;F.classFeatures.features[ct]=Array(rt).fill(!1),b.push(xe.name)}else if(xe.type==="pool"){const rt=typeof xe.maxPool=="function"?xe.maxPool(F.level):xe.maxPool;rt!==void 0&&(F.classFeatures.features[ct]=rt,b.push(xe.name))}}})}return F.activeStates&&F.activeStates.forEach(Je=>{Je.abilities&&Je.abilities.forEach(xe=>{if(xe.restType==="short"&&xe.usesPerRest){const ct=xe.usesPerRest-(xe.currentUses||0)>0;xe.currentUses=xe.usesPerRest,ct&&b.push(`${Je.name}: ${xe.name}`)}})}),F}),r(ae,!1);const qe=b.length>0?`Short rest taken! Restored: ${b.join(", ")}`:"Short rest taken!";It.add(qe,"success")}function R(){const b=[];ue.update(F=>{const Ne=F.maxHP-F.currentHP;Ne>0&&b.push(`${Ne} HP`),F.currentHP=F.maxHP,F.tempHP=0;const me=F.hitDice.max-F.hitDice.current;me>0&&b.push(`${me} hit ${me===1?"die":"dice"}`),F.hitDice.current=F.hitDice.max;let Je=0;if(F.classFeatures.spellSlotsByLevel&&Object.keys(F.classFeatures.spellSlotsByLevel).forEach(xe=>{const ct=F.classFeatures.spellSlotsByLevel[parseInt(xe)];if(ct){const rt=ct.filter(Ct=>Ct).length;Je+=rt,F.classFeatures.spellSlotsByLevel[parseInt(xe)]=Array(ct.length).fill(!1)}}),Je>0&&b.push(`${Je} spell ${Je===1?"slot":"slots"}`),F.class){const xe=Sa(F.class,F.level,F.subclass);F.classFeatures.features||(F.classFeatures.features={});let ct=!1;xe.forEach(rt=>{const Ct=rt.name.replace(/\s+/g,"");if(!(rt.type==="info"||rt.type==="channelDivinity")){if(rt.type==="uses"){const jt=typeof rt.maxUses=="function"?rt.maxUses(F.level):rt.maxUses;F.classFeatures.features[Ct]=Array(jt).fill(!1),ct=!0}else if(rt.type==="pool"){const jt=typeof rt.maxPool=="function"?rt.maxPool(F.level):rt.maxPool;jt!==void 0&&(F.classFeatures.features[Ct]=jt,ct=!0)}}}),ct&&b.push("all class features")}if(F.activeStates){let xe=!1;F.activeStates.forEach(ct=>{ct.abilities&&ct.abilities.forEach(rt=>{if(rt.usesPerRest){const Ct=(rt.currentUses||0)<rt.usesPerRest;rt.currentUses=rt.usesPerRest,Ct&&(xe=!0)}})}),xe&&b.push("condition abilities")}return F}),r(ae,!1);const qe=b.length>0?`Long rest taken! Restored: ${b.join(", ")}`:"Long rest taken! Fully rested.";It.add(qe,"success")}function J(b){r(ce,""),r(Q,""),r(U,""),r(H,!1),r(_e,[]),r(Pe,"other"),Be=!1,typeof b=="string"?r(ce,b):(r(ce,b.notation),r(Q,b.damageNotation||""),r(U,b.attackName||""),r(H,!!b.applyHalfDamage),r(_e,b.bonusBreakdown||[]),r(Pe,b.rollType||"other")),r(_,!0)}function He(b){const{notation:qe,count:F,bonusBreakdown:Ne}=b.detail;r(ce,""),Be=!0,Ee=F||1,setTimeout(()=>{r(ce,qe),r(Q,""),r(U,"Hit Die"),r(_e,Ne||[]),r(Pe,"other")},0),r(_,!0)}function Ue(){if(r(_,!1),Be&&e(pe)){const b=e(pe).getLastRollTotal();if(b!==null){const qe=Math.max(1,b);ue.update(F=>(F.hitDice.current=Math.max(0,F.hitDice.current-Ee),F.currentHP=Math.min(F.maxHP,F.currentHP+qe),F))}Be=!1}}function oe(){ha.update(b=>!b)}function ve(b){b.target.closest(".rest-button-container")||r(ae,!1)}Ca(()=>{const b=ha.subscribe(qe=>{qe?document.body.classList.remove("use-mode"):document.body.classList.add("use-mode")});return document.addEventListener("click",ve),()=>{b(),document.removeEventListener("click",ve)}});function ze(){tl(t())}function We(){e(fe)?.click()}async function lt(b){const F=b.target.files?.[0];if(F)try{const Ne=await al(F);ue.set(Ne),alert("Character imported successfully!")}catch{alert("Failed to import character file")}}qt();var it=Yr();Zs("1uha8ag",b=>{var qe=Br();Jt(2),ws(()=>{Ys.title="D&D Character Sheet"}),c(b,qe)});var nt=Ae(it),et=l(nt),bt=l(et),$=l(bt),N=l($),T=a(l(N),2);{var C=b=>{var qe=Rr(),F=l(qe);s(qe),j(()=>D(F,`${t().name??""} (${t().level??""})`)),c(b,qe)};h(T,b=>{t().name&&b(C)})}s(N);var I=a(N,2);{var Z=b=>{var qe=Fr();_t(qe,5,w,kt,(F,Ne)=>{var me=Mr();let Je;var xe=l(me);s(me),j(()=>{Je=St(me,1,"slot-badge svelte-1uha8ag",null,Je,{depleted:e(Ne).available===0}),D(xe,`Lv${e(Ne).level??""}: ${e(Ne).available??""}/${e(Ne).total??""}`)}),c(F,me)}),s(qe),c(b,qe)};h(I,b=>{w().length>0&&b(Z)})}var ge=a(I,2);{var Se=b=>{var qe=Vr(),F=Ae(qe);_t(F,5,()=>t().activeStates,kt,(Ne,me,Je)=>{var xe=Kr(),ct=l(xe),rt=a(ct);{var Ct=Xt=>{var Zt=Wr(),pt=l(Zt),wt=l(pt,!0);s(pt);var oa=a(pt,2),ea=a(oa,3);{var ca=Oe=>{var vt=Pr(),mt=Ae(vt),Dt=l(mt);s(mt),Jt(),j(()=>D(Dt,`Attack Bonus: ${typeof e(me).attackBonus=="number"&&e(me).attackBonus>0?"+":""}${e(me).attackBonus??""}`)),c(Oe,vt)};h(ea,Oe=>{e(me).attackBonus&&Oe(ca)})}var Kt=a(ea,2);{var ta=Oe=>{var vt=Tr(),mt=Ae(vt),Dt=l(mt);s(mt),Jt(),j(()=>D(Dt,`Damage Bonus: ${typeof e(me).damageBonus=="number"&&e(me).damageBonus>0?"+":""}${e(me).damageBonus??""}`)),c(Oe,vt)};h(Kt,Oe=>{e(me).damageBonus&&Oe(ta)})}var $t=a(Kt,2);{var At=Oe=>{var vt=Ir(),mt=Ae(vt),Dt=l(mt);s(mt),Jt(),j(()=>D(Dt,`AC Bonus: ${e(me).acBonus>0?"+":""}${e(me).acBonus??""}`)),c(Oe,vt)};h($t,Oe=>{e(me).acBonus&&Oe(At)})}var Rt=a($t,2);{var aa=Oe=>{var vt=Er(),mt=Ae(vt),Dt=l(mt);s(mt),Jt(),j(()=>D(Dt,`Darkvision: ${e(me).darkvision??""} feet`)),c(Oe,vt)};h(Rt,Oe=>{e(me).darkvision&&Oe(aa)})}var sa=a(Rt,2);{var da=Oe=>{var vt=Hr(),mt=Ae(vt),Dt=l(mt);s(mt),Jt(),j(Bt=>D(Dt,`Resistances: ${Bt??""}`),[()=>e(me).resistances.join(", ")]),c(Oe,vt)};h(sa,Oe=>{e(me).resistances&&e(me).resistances.length>0&&Oe(da)})}var Ht=a(sa,2);{var Mt=Oe=>{var vt=Ur(),mt=Ae(vt),Dt=l(mt);s(mt),Jt(),j(Bt=>D(Dt,`Immunities: ${Bt??""}`),[()=>e(me).immunities.join(", ")]),c(Oe,vt)};h(Ht,Oe=>{e(me).immunities&&e(me).immunities.length>0&&Oe(Mt)})}var Ut=a(Ht,2);{var Qt=Oe=>{var vt=qr(),mt=a(l(vt),3);_t(mt,1,()=>e(me).abilities,kt,(Dt,Bt)=>{var Ft=Gr(),Nt=l(Ft),Vt=l(Nt);s(Nt);var la=a(Nt),ua=a(la);{var Pt=Ot=>{var ia=Nr(),ka=a(Ae(ia)),Ta=l(ka),Da=a(Ta);{var Wa=za=>{var Bs=Gt(", requires reaction");c(za,Bs)};h(Da,za=>{e(Bt).requiresReaction&&za(Wa)})}Jt(),s(ka),j(()=>D(Ta,`(${(e(Bt).currentUses||0)??""}/${e(Bt).usesPerRest??""} uses per ${e(Bt).restType??""}
                                rest`)),c(Ot,ia)},Et=Ot=>{var ia=dt(),ka=Ae(ia);{var Ta=Da=>{var Wa=Or();Jt(),c(Da,Wa)};h(ka,Da=>{e(Bt).requiresReaction&&Da(Ta)},!0)}c(Ot,ia)};h(ua,Ot=>{e(Bt).usesPerRest?Ot(Pt):Ot(Et,!1)})}s(Ft),j(()=>{D(Vt,`${e(Bt).name??""}:`),D(la,` ${e(Bt).description??""} `)}),c(Dt,Ft)}),s(vt),c(Oe,vt)};h(Ut,Oe=>{e(me).abilities&&e(me).abilities.length>0&&Oe(Qt)})}s(Zt),j(()=>{D(wt,e(me).name),D(oa,` ${e(me).description??""}`)}),c(Xt,Zt)};h(rt,Xt=>{e(ke)===Je&&Xt(Ct)})}var jt=a(rt,2);{var pa=Xt=>{var Zt=zr();j(()=>Qe(Zt,"title",`End ${e(me).name??""}`)),L("click",Zt,()=>{ue.update(pt=>{if(pt.activeStates){const wt=pt.activeStates[Je];wt?.hpBonus&&wt.target!=="other"&&(pt.maxHP-=wt.hpBonus,pt.currentHP=Math.max(1,Math.min(pt.currentHP-wt.hpBonus,pt.maxHP))),pt.activeStates=pt.activeStates.filter((oa,ea)=>ea!==Je)}return pt})}),c(Xt,Zt)};h(jt,Xt=>{v()||Xt(pa)})}s(xe),j(()=>{Qe(xe,"aria-label",e(me).name),D(ct,`‚ú® ${e(me).name??""} `)}),L("mouseenter",xe,()=>Re(Je)),L("mouseleave",xe,B),L("focus",xe,()=>Re(Je)),L("blur",xe,B),L("click",xe,()=>P(Je)),c(Ne,xe)}),s(F),Jt(2),c(b,qe)};h(ge,b=>{t().activeStates&&t().activeStates.length>0&&b(Se)})}s($);var re=a($,2),ye=l(re),z=l(ye),A=a(z,2),Le=l(A),Ve=a(Le,2);{var Me=b=>{var qe=Jr(),F=l(qe),Ne=a(F,2);s(qe),L("click",F,g),L("click",Ne,R),c(b,qe)};h(Ve,b=>{e(ae)&&b(Me)})}s(A);var Ze=a(A,2),se=a(Ze,2),u=l(se);let we;var be=l(u),G=l(be,!0);s(be);var je=a(be),de=l(je,!0);s(je),s(u),s(se),s(ye);var $e=a(ye,2),le=l($e);De(le),s($e),s(re),s(bt);var Ge=a(bt,2),he=l(Ge),x=a(he,2),V=a(x,2),ie=a(V,2),ne=a(ie,2),q=a(ne,2);Ra(q,b=>r(fe,b),()=>e(fe)),s(Ge),s(et);var te=a(et,2),Te=l(te);xl(Te,{});var Y=a(Te,2);Sl(Y,{$$events:{roll:b=>J(b.detail)}});var Fe=a(Y,2);zl(Fe,{$$events:{roll:b=>J(b.detail)}});var Ce=a(Fe,2);Ol(Ce,{$$events:{rollHitDice:He}});var tt=a(Ce,2);Ar(tt,{});var ot=a(tt,2);Yi(ot,{$$events:{roll:b=>J(b.detail)}});var ft=a(ot,2);pn(ft,{});var ht=a(ft,2);bn(ht,{}),s(te),s(nt);var at=a(nt,2);Ra(Rn(at,{get notation(){return e(ce)},get damageNotation(){return e(Q)},get attackName(){return e(U)},get applyHalfDamage(){return e(H)},get bonusBreakdown(){return e(_e)},get rollType(){return e(Pe)},get visible(){return e(_)},$$events:{close:Ue},$$legacy:!0}),b=>r(pe,b),()=>e(pe));var O=a(at,2);{var X=b=>{Xn(b,{get mode(){return e(ee)},$$events:{close:()=>r(k,!1)}})};h(O,b=>{e(k)&&b(X)})}var ut=a(O,2);{var Ye=b=>{pr(b,{onClose:()=>r(E,!1)})};h(ut,b=>{e(E)&&b(Ye)})}var Ke=a(ut,2);kr(Ke,{get show(){return e(M)},onSave:y,onCancel:K});var yt=a(Ke,2);el(yt,{}),j(()=>{we=St(u,1,"btn btn-mode svelte-1uha8ag",null,we,{"use-mode":!v()}),D(G,v()?"üìù":"üé≤"),D(de,v()?"Edit Mode":"Use Mode")}),L("click",z,()=>{r(_e,[]),r(_,!0)}),L("click",Le,()=>r(ae,!e(ae))),L("click",Ze,()=>r(M,!0)),L("click",u,oe),Ie(le,d,b=>sl(ga,b)),L("click",he,()=>r(E,!0)),L("click",x,()=>{r(ee,"save"),r(k,!0)}),L("click",V,()=>{r(ee,"load"),r(k,!0)}),L("click",ie,ze),L("click",ne,We),L("change",q,lt),c(i,it),zt(),m()}export{io as component};
