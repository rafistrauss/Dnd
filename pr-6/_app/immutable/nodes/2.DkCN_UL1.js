import{f as U,a as E,c as at,t as yt}from"../chunks/B_z_pdCz.js";import{i as Ce}from"../chunks/C6nJFxGc.js";import{w as Ft,d as qt,c as Ve,o as Et}from"../chunks/BIfMbnvC.js";import{a as ct,f as Jt,aP as Lt,k as st,h as we,g as Wt,T as Vt,z as t,a9 as Fe,V as Yt,W as Xt,X as _t,j as lt,e as Ye,C as Zt,aJ as Kt,au as kt,c as Oe,b as vt,s as Qt,$ as q,am as xt,aH as Mt,R as bt,aQ as Nt,aR as Rt,r as Tt,p as ea,aS as ta,aT as it,q as aa,aU as sa,i as la,aV as ia,aW as ra,aG as na,d as oa,a0 as ca,aX as va,aY as da,aZ as Pt,aN as ua,w as b,Z as Ht,a_ as fa,E as je,J as o,G as ae,I as De,M as l,K as n,a$ as Xe,b0 as Ge,b1 as Ut,a2 as k,F as Pe,b2 as Qe,A as Be,b3 as pa,Y as ba,b4 as ma}from"../chunks/BMUXocL7.js";import{e as P,s as Q}from"../chunks/DuCnIS2G.js";import{s as ke,a as Ee,c as re,i as ve,d as Ze,p as Je,b as dt}from"../chunks/DK1cXCUg.js";import{r as z,a as Ot,s as Ue,b as $t,h as ha}from"../chunks/puCMm-MY.js";import{b as Ke}from"../chunks/DtK31vQ5.js";function He(e,s){return s}function ga(e,s,a){for(var i=[],f=s.length,u=0;u<f;u++)ia(s[u].e,i,!0);ra(i,()=>{var r=i.length===0&&a!==null;if(r){var p=a,c=p.parentNode;na(c),c.append(p),e.items.clear(),Se(e,s[0].prev,s[f-1].next)}for(var y=0;y<f;y++){var m=s[y];r||(e.items.delete(m.k),Se(e,m.prev,m.next)),oa(m.e,!r)}e.first===s[0]&&(e.first=s[0].prev)})}function Me(e,s,a,i,f,u=null){var r=e,p=new Map,c=null,y=(s&Lt)!==0,m=(s&Nt)!==0,L=(s&Rt)!==0;if(y){var h=e;r=we?st(Wt(h)):h.appendChild(ct())}we&&Vt();var x=null,C=Fe(()=>{var S=a();return bt(S)?S:S==null?[]:Mt(S)}),w,v=!0;function d(){ya(I,w,r,s,i),x!==null&&(w.length===0?(x.fragment?(r.before(x.fragment),x.fragment=null):Tt(x.effect),H.first=x.effect):ea(x.effect,()=>{x=null}))}var H=Jt(()=>{w=t(C);var S=w.length;let _=!1;if(we){var N=Yt(r)===Xt;N!==(S===0)&&(r=_t(),st(r),lt(!1),_=!0)}for(var M=new Set,B=Oe,R=null,O=Qt(),j=0;j<S;j+=1){we&&Ye.nodeType===Zt&&Ye.data===Kt&&(r=Ye,_=!0,lt(!1));var Z=w[j],Y=i(Z,j),D=v?null:p.get(Y);D?(m&&kt(D.v,Z),L?kt(D.i,j):D.i=j,O&&B.skipped_effects.delete(D.e)):(D=_a(v?r:null,R,Z,Y,j,f,s,a),v&&(D.o=!0,R===null?c=D:R.next=D,R=D),p.set(Y,D)),M.add(Y)}if(S===0&&u&&!x)if(v)x={fragment:null,effect:vt(()=>u(r))};else{var V=document.createDocumentFragment(),G=ct();V.append(G),x={fragment:V,effect:vt(()=>u(G))}}if(we&&S>0&&st(_t()),!v)if(O){for(const[J,ne]of p)M.has(J)||B.skipped_effects.add(ne.e);B.oncommit(d),B.ondiscard(()=>{})}else d();_&&lt(!0),t(C)}),I={effect:H,items:p,first:c};v=!1,we&&(r=Ye)}function ya(e,s,a,i,f){var u=(i&sa)!==0,r=s.length,p=e.items,c=e.first,y,m=null,L,h=[],x=[],C,w,v,d;if(u)for(d=0;d<r;d+=1)C=s[d],w=f(C,d),v=p.get(w),v.a?.measure(),(L??=new Set).add(v);for(d=0;d<r;d+=1){if(C=s[d],w=f(C,d),v=p.get(w),e.first??=v,!v.o){v.o=!0;var H=m?m.next:c;Se(e,m,v),Se(e,v,H),rt(v,H,a),m=v,h=[],x=[],c=m.next;continue}if((v.e.f&it)!==0&&(Tt(v.e),u&&(v.a?.unfix(),(L??=new Set).delete(v))),v!==c){if(y!==void 0&&y.has(v)){if(h.length<x.length){var I=x[0],S;m=I.prev;var _=h[0],N=h[h.length-1];for(S=0;S<h.length;S+=1)rt(h[S],I,a);for(S=0;S<x.length;S+=1)y.delete(x[S]);Se(e,_.prev,N.next),Se(e,m,_),Se(e,N,I),c=I,m=N,d-=1,h=[],x=[]}else y.delete(v),rt(v,c,a),Se(e,v.prev,v.next),Se(e,v,m===null?e.first:m.next),Se(e,m,v),m=v;continue}for(h=[],x=[];c!==null&&c.k!==w;)(c.e.f&it)===0&&(y??=new Set).add(c),x.push(c),c=c.next;if(c===null)continue;v=c}h.push(v),m=v,c=v.next}if(c!==null||y!==void 0){for(var M=y===void 0?[]:Mt(y);c!==null;)(c.e.f&it)===0&&M.push(c),c=c.next;var B=M.length;if(B>0){var R=(i&Lt)!==0&&r===0?a:null;if(u){for(d=0;d<B;d+=1)M[d].a?.measure();for(d=0;d<B;d+=1)M[d].a?.fix()}ga(e,M,R)}}u&&aa(()=>{if(L!==void 0)for(v of L)v.a?.apply()})}function _a(e,s,a,i,f,u,r,p){var c=(r&Nt)!==0,y=(r&ta)===0,m=c?y?q(a,!1,!1):xt(a):a,L=(r&Rt)===0?f:xt(f),h={i:L,v:m,k:i,a:null,e:null,o:!1,prev:s,next:null};try{if(e===null){var x=document.createDocumentFragment();x.append(e=ct())}return h.e=vt(()=>u(e,m,L,p)),s!==null&&(s.next=h),h}finally{}}function rt(e,s,a){for(var i=e.next?e.next.e.nodes_start:a,f=s?s.e.nodes_start:a,u=e.e.nodes_start;u!==null&&u!==i;){var r=la(u);f.before(u),u=r}}function Se(e,s,a){s===null?(e.first=a,e.effect.first=a&&a.e):(s.e.next&&(s.e.next.prev=null),s.next=a,s.e.next=a&&a.e),a===null?e.effect.last=s&&s.e:(a.e.prev&&(a.e.prev.next=null),a.prev=s,a.e.prev=s&&s.e)}const St=[...` 	
\r\fÂ \v\uFEFF`];function ka(e,s,a){var i=e==null?"":""+e;if(a){for(var f in a)if(a[f])i=i?i+" "+f:f;else if(i.length)for(var u=f.length,r=0;(r=i.indexOf(f,r))>=0;){var p=r+u;(r===0||St.includes(i[r-1]))&&(p===i.length||St.includes(i[p]))?i=(r===0?"":i.substring(0,r))+i.substring(p+1):r=p}}return i===""?null:i}function ut(e,s,a,i,f,u){var r=e.__className;if(we||r!==a||r===void 0){var p=ka(a,i,u);(!we||p!==e.getAttribute("class"))&&(p==null?e.removeAttribute("class"):e.className=p),e.__className=a}else if(u&&f!==u)for(var c in u){var y=!!u[c];(f==null||y!==!!f[c])&&e.classList.toggle(c,y)}return u}function Gt(e,s,a=!1){if(e.multiple){if(s==null)return;if(!bt(s))return va();for(var i of e.options)i.selected=s.includes(wt(i));return}for(i of e.options){var f=wt(i);if(da(f,s)){i.selected=!0;return}}(!a||s!==void 0)&&(e.selectedIndex=-1)}function xa(e){var s=new MutationObserver(()=>{Gt(e,e.__value)});s.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),ca(()=>{s.disconnect()})}function wt(e){return"__value"in e?e.__value:e.value}function W(e,s,a=s){var i=new WeakSet;Pt(e,"input",async f=>{var u=f?e.defaultValue:e.value;if(u=nt(e)?ot(u):u,a(u),Oe!==null&&i.add(Oe),await ua(),u!==(u=s())){var r=e.selectionStart,p=e.selectionEnd,c=e.value.length;if(e.value=u??"",p!==null){var y=e.value.length;r===p&&p===c&&y>c?(e.selectionStart=y,e.selectionEnd=y):(e.selectionStart=r,e.selectionEnd=Math.min(p,y))}}}),(we&&e.defaultValue!==e.value||b(s)==null&&e.value)&&(a(nt(e)?ot(e.value):e.value),Oe!==null&&i.add(Oe)),Ht(()=>{var f=s();if(e===document.activeElement){var u=fa??Oe;if(i.has(u))return}nt(e)&&f===ot(e.value)||e.type==="date"&&!f&&!e.value||f!==e.value&&(e.value=f??"")})}function mt(e,s,a=s){Pt(e,"change",i=>{var f=i?e.defaultChecked:e.checked;a(f)}),(we&&e.defaultChecked!==e.checked||b(s)==null)&&a(e.checked),Ht(()=>{var i=s();e.checked=!!i})}function nt(e){var s=e.type;return s==="number"||s==="range"}function ot(e){return e===""?null:+e}function Bt(e){return function(...s){var a=s[0];return a.stopPropagation(),e?.apply(this,s)}}function et(e,s){var a=e.$$events?.[s.type],i=bt(a)?a.slice():a==null?[]:[a];for(var f of i)f.call(this,s)}const ft={name:"",class:"",level:1,race:"",background:"",alignment:"",armorClass:10,initiative:0,speed:"30 ft",currentHP:0,maxHP:0,tempHP:0,hitDice:{current:3,max:3},abilities:{strength:10,dexterity:10,constitution:10,intelligence:10,wisdom:10,charisma:10},proficiencyBonus:2,saveProficiencies:{strength:!1,dexterity:!1,constitution:!1,intelligence:!1,wisdom:!1,charisma:!1},skillProficiencies:{acrobatics:!1,animalHandling:!1,arcana:!1,athletics:!1,deception:!1,history:!1,insight:!1,intimidation:!1,investigation:!1,medicine:!1,nature:!1,perception:!1,performance:!1,persuasion:!1,religion:!1,sleightOfHand:!1,stealth:!1,survival:!1},attacks:[],features:"",equipment:"",notes:"",classFeatures:{features:{},spellSlots:[],preparedSpells:""}};function $a(){try{const e=localStorage.getItem("dndCharacter");if(e){const s={...ft,...JSON.parse(e)};return s.attacks&&Array.isArray(s.attacks)&&(s.attacks=s.attacks.map(a=>({...a,id:a.id||crypto.randomUUID()}))),s.classFeatures?(s.classFeatures.features||(s.classFeatures.features={}),s.classFeatures.spellSlots||(s.classFeatures.spellSlots=[]),s.classFeatures.preparedSpells===void 0&&(s.classFeatures.preparedSpells="")):s.classFeatures={features:{},spellSlots:[],preparedSpells:""},s}}catch(e){console.error("Failed to load character from storage:",e)}return ft}const F=Ft($a());F.subscribe(e=>{try{localStorage.setItem("dndCharacter",JSON.stringify(e))}catch(s){console.error("Failed to save character to storage:",s)}});const We=Ft(!0);{const e=localStorage.getItem("dndMode");We.set(e==="edit"),We.subscribe(s=>{localStorage.setItem("dndMode",s?"edit":"use")})}const ht=qt(F,e=>{const s=a=>Math.floor((a-10)/2);return{strength:s(e.abilities.strength),dexterity:s(e.abilities.dexterity),constitution:s(e.abilities.constitution),intelligence:s(e.abilities.intelligence),wisdom:s(e.abilities.wisdom),charisma:s(e.abilities.charisma)}});function Sa(e){return Math.ceil(e/4)+1}function zt(){F.update(e=>(e.proficiencyBonus=Sa(e.level),e))}function wa(e){const s=JSON.stringify(e,null,2),a="data:application/json;charset=utf-8,"+encodeURIComponent(s),i=`${e.name||"character"}_${new Date().toISOString().split("T")[0]}.json`,f=document.createElement("a");f.setAttribute("href",a),f.setAttribute("download",i),f.click()}function Ca(e){return new Promise((s,a)=>{const i=new FileReader;i.onload=f=>{try{const u=JSON.parse(f.target?.result),r={...ft,...u};r.attacks&&Array.isArray(r.attacks)&&(r.attacks=r.attacks.map(p=>({...p,id:p.id||crypto.randomUUID()}))),r.classFeatures?(r.classFeatures.features||(r.classFeatures.features={}),r.classFeatures.spellSlots||(r.classFeatures.spellSlots=[]),r.classFeatures.preparedSpells===void 0&&(r.classFeatures.preparedSpells="")):r.classFeatures={features:{},spellSlots:[],preparedSpells:""},s(r)}catch{a(new Error("Invalid character file"))}},i.onerror=()=>a(new Error("Failed to read file")),i.readAsText(e)})}const pt={paladin:{name:"Paladin",hitDice:"d10",spellcaster:!0,spellcastingAbility:"charisma",spellSlotsByLevel:{1:0,2:2,3:3,4:3,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Divine Sense",type:"uses",maxUses:(e,s=1)=>1+Math.max(1,s),resetOn:"long",description:"Detect celestials, fiends, and undead within 60 feet",minLevel:1},{name:"Lay on Hands",type:"pool",maxPool:e=>e*5,resetOn:"long",description:"Heal wounds or cure disease",minLevel:1},{name:"Divine Smite",type:"spellSlot",description:"Expend spell slot to deal extra radiant damage",minLevel:2,rollable:!0},{name:"Channel Divinity",type:"uses",maxUses:e=>e>=18?3:e>=6?2:1,resetOn:"short",description:"Sacred Weapon or Turn Undead",minLevel:3}]},fighter:{name:"Fighter",hitDice:"d10",spellcaster:!1,features:[{name:"Second Wind",type:"uses",maxUses:1,resetOn:"short",description:"Regain 1d10 + fighter level HP as bonus action",minLevel:1,rollable:!0,rollFormula:e=>`1d10+${e}`},{name:"Action Surge",type:"uses",maxUses:e=>e>=17?2:1,resetOn:"short",description:"Take one additional action on your turn",minLevel:2},{name:"Indomitable",type:"uses",maxUses:e=>e>=17?3:e>=13?2:1,resetOn:"long",description:"Reroll a failed saving throw",minLevel:9}]},rogue:{name:"Rogue",hitDice:"d8",spellcaster:!1,features:[{name:"Sneak Attack",type:"info",description:e=>`Deal ${Math.ceil(e/2)}d6 extra damage once per turn with advantage or ally nearby`,minLevel:1,rollable:!0,rollFormula:e=>`${Math.ceil(e/2)}d6`},{name:"Cunning Action",type:"info",description:"Dash, Disengage, or Hide as a bonus action",minLevel:2},{name:"Uncanny Dodge",type:"info",description:"Use reaction to halve damage from an attack",minLevel:5},{name:"Evasion",type:"info",description:"Take no damage on successful Dex save (half on fail)",minLevel:7}]},wizard:{name:"Wizard",hitDice:"d6",spellcaster:!0,spellcastingAbility:"intelligence",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Arcane Recovery",type:"uses",maxUses:1,resetOn:"long",description:e=>`Recover spell slots totaling up to ${Math.ceil(e/2)} levels during short rest`,minLevel:1},{name:"Spell Mastery",type:"info",description:"Cast one 1st-level and one 2nd-level spell at will",minLevel:18}]},cleric:{name:"Cleric",hitDice:"d8",spellcaster:!0,spellcastingAbility:"wisdom",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Channel Divinity",type:"uses",maxUses:e=>e>=18?3:e>=6?2:1,resetOn:"short",description:"Turn Undead or domain-specific ability",minLevel:2},{name:"Destroy Undead",type:"info",description:e=>`Channel Divinity destroys undead of CR ${e>=17?4:e>=14?3:e>=11?2:e>=8?1:.5} or lower`,minLevel:5},{name:"Divine Intervention",type:"uses",maxUses:1,resetOn:"long",description:e=>`${e}% chance to succeed, implore deity for aid`,minLevel:10}]},barbarian:{name:"Barbarian",hitDice:"d12",spellcaster:!1,features:[{name:"Rage",type:"uses",maxUses:e=>e>=20?1/0:e>=17?6:e>=12?5:e>=6?4:e>=3?3:2,resetOn:"long",description:e=>`+${e>=16?4:e>=9?3:2} damage, resistance to physical damage`,minLevel:1},{name:"Reckless Attack",type:"info",description:"Gain advantage on melee attacks, enemies get advantage on you",minLevel:2},{name:"Danger Sense",type:"info",description:"Advantage on Dex saves against effects you can see",minLevel:2}]}};function ze(e){const s=e.toLowerCase();return pt[s]||null}function Ct(e,s){const a=ze(e);return a?a.features.filter(i=>!i.minLevel||i.minLevel<=s):[]}function jt(e,s){const a=ze(e);return!a||!a.spellcaster||!a.spellSlotsByLevel?0:a.spellSlotsByLevel[s]||0}function Dt(e,s,a){const i=ze(e);return!i||!i.spellcaster?0:Math.max(1,a+s)}function ja(e,s,a){const i=ze(e);return!i||!i.spellcaster?null:8+s+a}function Da(){return Object.keys(pt).map(e=>({id:e,name:pt[e].name}))}var Aa=U("<option> </option>"),Ia=U('<section class="character-info svelte-172i2fj"><h2 class="svelte-172i2fj">Character Info</h2> <div class="info-grid svelte-172i2fj"><div class="form-group svelte-172i2fj"><label for="characterName" class="svelte-172i2fj">Character Name</label> <input type="text" id="characterName" placeholder="Enter name" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterClass" class="svelte-172i2fj">Class</label> <select id="characterClass" class="svelte-172i2fj"><option>Select Class</option><!></select></div> <div class="form-group svelte-172i2fj"><label for="characterLevel" class="svelte-172i2fj">Level</label> <input type="number" id="characterLevel" min="1" max="20" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterRace" class="svelte-172i2fj">Race</label> <input type="text" id="characterRace" placeholder="e.g., Human" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterBackground" class="svelte-172i2fj">Background</label> <input type="text" id="characterBackground" placeholder="e.g., Soldier" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterAlignment" class="svelte-172i2fj">Alignment</label> <input type="text" id="characterAlignment" placeholder="e.g., Lawful Good" class="svelte-172i2fj"/></div></div></section>');function Fa(e,s){je(s,!1);const a=()=>ke(F,"$character",i),[i,f]=Ee(),u=Da();function r(R){const O=R.target;F.update(j=>(j.class=O.value,j))}function p(R){const O=R.target;F.update(j=>(j.level=parseInt(O.value)||1,j)),zt()}Ce();var c=Ia(),y=l(o(c),2),m=o(y),L=l(o(m),2);z(L),n(m);var h=l(m,2),x=l(o(h),2),C=o(x);C.value=C.__value="";var w=l(C);Me(w,1,()=>u,He,(R,O)=>{var j=Aa(),Z=o(j,!0);n(j);var Y={};ae(()=>{Q(Z,t(O).name),Y!==(Y=t(O).id)&&(j.value=(j.__value=t(O).id)??"")}),E(R,j)}),n(x);var v;xa(x),n(h);var d=l(h,2),H=l(o(d),2);z(H),n(d);var I=l(d,2),S=l(o(I),2);z(S),n(I);var _=l(I,2),N=l(o(_),2);z(N),n(_);var M=l(_,2),B=l(o(M),2);z(B),n(M),n(y),n(c),ae(()=>{v!==(v=a().class)&&(x.value=(x.__value=a().class)??"",Gt(x,a().class)),Ot(H,a().level)}),W(L,()=>a().name,R=>re(F,b(a).name=R,b(a))),P("change",x,r),P("change",H,p),W(S,()=>a().race,R=>re(F,b(a).race=R,b(a))),W(N,()=>a().background,R=>re(F,b(a).background=R,b(a))),W(B,()=>a().alignment,R=>re(F,b(a).alignment=R,b(a))),E(e,c),De(),f()}var Ea=U('<div class="ability-card svelte-bbv1xt"><h3 class="svelte-bbv1xt"> </h3> <input type="number" class="ability-score svelte-bbv1xt" min="1" max="30"/> <div class="ability-modifier svelte-bbv1xt"> </div> <button class="roll-btn svelte-bbv1xt">Check</button> <div class="save-row svelte-bbv1xt"><input type="checkbox" class="svelte-bbv1xt"/> <label class="svelte-bbv1xt">Save</label> <button class="roll-btn-small svelte-bbv1xt">Roll</button></div></div>'),La=U('<section class="ability-scores svelte-bbv1xt"><h2 class="svelte-bbv1xt">Ability Scores</h2> <div class="proficiency-bonus svelte-bbv1xt"><label for="profBonus">Proficiency Bonus</label> <input type="number" id="profBonus" class="prof-input svelte-bbv1xt"/></div> <div class="abilities-grid svelte-bbv1xt"></div></section>');function Ma(e,s){je(s,!1);const a=()=>ke(ht,"$abilityModifiers",f),i=()=>ke(F,"$character",f),[f,u]=Ee(),r=Ve(),p=[{key:"strength",label:"Strength"},{key:"dexterity",label:"Dexterity"},{key:"constitution",label:"Constitution"},{key:"intelligence",label:"Intelligence"},{key:"wisdom",label:"Wisdom"},{key:"charisma",label:"Charisma"}];function c(){zt()}function y(w){const v=a()[w],d=`1d20${v>=0?"+":""}${v}`;r("roll",d)}function m(w){const v=a()[w],d=i().saveProficiencies[w]?i().proficiencyBonus:0,H=v+d,I=`1d20${H>=0?"+":""}${H}`;r("roll",I)}Ce();var L=La(),h=l(o(L),2),x=l(o(h),2);z(x),n(h);var C=l(h,2);Me(C,5,()=>p,He,(w,v)=>{let d=()=>t(v).key,H=()=>t(v).label;var I=Ea(),S=o(I),_=o(S,!0);n(S);var N=l(S,2);z(N);var M=l(N,2),B=o(M);n(M);var R=l(M,2),O=l(R,2),j=o(O);z(j);var Z=l(j,2),Y=l(Z,2);n(O),n(I),ae(D=>{Q(_,D),Q(B,`${a()[d()]>=0?"+":""}${a()[d()]??""}`),Ue(j,"id",`${d()}-save`),Ue(Z,"for",`${d()}-save`)},[()=>H().substring(0,3).toUpperCase()]),W(N,()=>i().abilities[d()],D=>re(F,b(i).abilities[d()]=D,b(i))),P("change",N,c),P("click",R,()=>y(d())),mt(j,()=>i().saveProficiencies[d()],D=>re(F,b(i).saveProficiencies[d()]=D,b(i))),P("click",Y,()=>m(d())),E(w,I)}),n(C),n(L),W(x,()=>i().proficiencyBonus,w=>re(F,b(i).proficiencyBonus=w,b(i))),E(e,L),De(),u()}var Na=U('<section class="combat-stats svelte-1r5hyyb"><h2 class="svelte-1r5hyyb">Combat Stats</h2> <div class="stats-grid svelte-1r5hyyb"><div class="stat-box svelte-1r5hyyb"><label for="armorClass" class="svelte-1r5hyyb">Armor Class</label> <input type="number" id="armorClass" class="stat-input svelte-1r5hyyb"/></div> <div class="stat-box svelte-1r5hyyb"><label for="initiative" class="svelte-1r5hyyb">Initiative</label> <input type="number" id="initiative" class="stat-input svelte-1r5hyyb"/></div> <div class="stat-box svelte-1r5hyyb"><label for="speed" class="svelte-1r5hyyb">Speed</label> <input type="text" id="speed" class="stat-input svelte-1r5hyyb"/></div></div> <div class="hp-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Points</h3> <div class="hp-display svelte-1r5hyyb"><div class="hp-inputs svelte-1r5hyyb"><input type="number" class="hp-current svelte-1r5hyyb" min="0"/> <span class="hp-separator svelte-1r5hyyb">/</span> <input type="number" class="hp-max svelte-1r5hyyb" min="0"/></div> <div class="hp-controls svelte-1r5hyyb"><button class="hp-btn svelte-1r5hyyb">âˆ’</button> <button class="hp-btn svelte-1r5hyyb">+</button> <button class="hp-btn svelte-1r5hyyb">âˆ’5</button> <button class="hp-btn svelte-1r5hyyb">+5</button></div></div> <div class="temp-hp svelte-1r5hyyb"><label for="tempHP" class="svelte-1r5hyyb">Temp HP</label> <input type="number" id="tempHP" min="0" class="svelte-1r5hyyb"/></div></div> <div class="hit-dice-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Dice</h3> <div class="hit-dice-display svelte-1r5hyyb"><input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <span>/</span> <input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/></div></div></section>');function Ra(e,s){je(s,!1);const a=()=>ke(F,"$character",i),[i,f]=Ee();function u(D){F.update(V=>(V.currentHP=Math.max(0,Math.min(V.maxHP,V.currentHP+D)),V))}Ce();var r=Na(),p=l(o(r),2),c=o(p),y=l(o(c),2);z(y),n(c);var m=l(c,2),L=l(o(m),2);z(L),n(m);var h=l(m,2),x=l(o(h),2);z(x),n(h),n(p);var C=l(p,2),w=l(o(C),2),v=o(w),d=o(v);z(d);var H=l(d,4);z(H),n(v);var I=l(v,2),S=o(I),_=l(S,2),N=l(_,2),M=l(N,2);n(I),n(w);var B=l(w,2),R=l(o(B),2);z(R),n(B),n(C);var O=l(C,2),j=l(o(O),2),Z=o(j);z(Z);var Y=l(Z,4);z(Y),n(j),n(O),n(r),ae(()=>{Ue(d,"max",a().maxHP),Ue(Z,"max",a().hitDice.max)}),W(y,()=>a().armorClass,D=>re(F,b(a).armorClass=D,b(a))),W(L,()=>a().initiative,D=>re(F,b(a).initiative=D,b(a))),W(x,()=>a().speed,D=>re(F,b(a).speed=D,b(a))),W(d,()=>a().currentHP,D=>re(F,b(a).currentHP=D,b(a))),W(H,()=>a().maxHP,D=>re(F,b(a).maxHP=D,b(a))),P("click",S,()=>u(-1)),P("click",_,()=>u(1)),P("click",N,()=>u(-5)),P("click",M,()=>u(5)),W(R,()=>a().tempHP,D=>re(F,b(a).tempHP=D,b(a))),W(Z,()=>a().hitDice.current,D=>re(F,b(a).hitDice.current=D,b(a))),W(Y,()=>a().hitDice.max,D=>re(F,b(a).hitDice.max=D,b(a))),E(e,r),De(),f()}const At={acrobatics:"dexterity",animalHandling:"wisdom",arcana:"intelligence",athletics:"strength",deception:"charisma",history:"intelligence",insight:"wisdom",intimidation:"charisma",investigation:"intelligence",medicine:"wisdom",nature:"intelligence",perception:"wisdom",performance:"charisma",persuasion:"charisma",religion:"intelligence",sleightOfHand:"dexterity",stealth:"dexterity",survival:"wisdom"};var Ta=U('<div class="skill-row svelte-1f1pl16"><input type="checkbox" class="svelte-1f1pl16"/> <label class="svelte-1f1pl16"> <span class="ability-tag svelte-1f1pl16"> </span></label> <span class="skill-modifier svelte-1f1pl16"> </span> <button class="roll-btn svelte-1f1pl16">Roll</button></div>'),Pa=U('<section class="skills svelte-1f1pl16"><h2 class="svelte-1f1pl16">Skills</h2> <div class="skills-grid svelte-1f1pl16"></div></section>');function Ha(e,s){je(s,!1);const a=()=>ke(ht,"$abilityModifiers",f),i=()=>ke(F,"$character",f),[f,u]=Ee(),r=Ve(),p=[{key:"acrobatics",label:"Acrobatics"},{key:"animalHandling",label:"Animal Handling"},{key:"arcana",label:"Arcana"},{key:"athletics",label:"Athletics"},{key:"deception",label:"Deception"},{key:"history",label:"History"},{key:"insight",label:"Insight"},{key:"intimidation",label:"Intimidation"},{key:"investigation",label:"Investigation"},{key:"medicine",label:"Medicine"},{key:"nature",label:"Nature"},{key:"perception",label:"Perception"},{key:"performance",label:"Performance"},{key:"persuasion",label:"Persuasion"},{key:"religion",label:"Religion"},{key:"sleightOfHand",label:"Sleight of Hand"},{key:"stealth",label:"Stealth"},{key:"survival",label:"Survival"}];function c(h){const x=At[h],C=a()[x],w=i().skillProficiencies[h]?i().proficiencyBonus:0;return C+w}function y(h){const x=c(h),C=`1d20${x>=0?"+":""}${x}`;r("roll",C)}Ce();var m=Pa(),L=l(o(m),2);Me(L,5,()=>p,He,(h,x)=>{let C=()=>t(x).key,w=()=>t(x).label;const v=Fe(()=>At[C()]),d=Fe(()=>c(C()));var H=Ta(),I=o(H);z(I);var S=l(I,2),_=o(S),N=l(_),M=o(N);n(N),n(S);var B=l(S,2),R=o(B);n(B);var O=l(B,2);n(H),ae(j=>{Ue(I,"id",C()),Ue(S,"for",C()),Q(_,`${w()??""} `),Q(M,`(${j??""})`),Q(R,`${t(d)>=0?"+":""}${t(d)??""}`)},[()=>t(v).substring(0,3).toUpperCase()]),mt(I,()=>i().skillProficiencies[C()],j=>re(F,b(i).skillProficiencies[C()]=j,b(i))),P("click",O,()=>y(C())),E(h,H)}),n(L),n(m),E(e,m),De(),u()}var Ua=U('<div class="attack-card svelte-14o91c5"><div class="attack-header svelte-14o91c5"><input type="text" placeholder="Attack name" class="attack-name svelte-14o91c5"/> <button class="btn-remove svelte-14o91c5">Ã—</button></div> <div class="attack-details svelte-14o91c5"><div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Bonus</label> <input type="number" class="attack-bonus svelte-14o91c5"/></div> <div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Damage</label> <input type="text" placeholder="e.g., 2d6+3" class="attack-damage svelte-14o91c5"/></div> <div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Type</label> <input type="text" placeholder="e.g., slashing" class="attack-type svelte-14o91c5"/></div></div> <div class="attack-actions svelte-14o91c5"><button class="btn btn-primary">Roll Attack</button> <button class="btn btn-secondary">Roll Damage</button></div></div>'),Oa=U('<p class="no-attacks svelte-14o91c5">No attacks added yet. Click "Add Attack" to create one.</p>'),Ga=U('<section class="attacks svelte-14o91c5"><h2 class="svelte-14o91c5">Attacks & Spells</h2> <button class="btn btn-secondary">Add Attack</button> <div class="attacks-list svelte-14o91c5"><!> <!></div></section>');function Ba(e,s){je(s,!1);const a=()=>ke(F,"$character",i),[i,f]=Ee(),u=Ve();function r(){F.update(v=>(v.attacks=[...v.attacks,{id:crypto.randomUUID(),name:"",bonus:0,damage:"",damageType:""}],v))}function p(v){F.update(d=>(d.attacks=d.attacks.filter(H=>H.id!==v),d))}function c(v){const d=`1d20${v.bonus>=0?"+":""}${v.bonus}`;u("roll",{notation:d,damageNotation:v.damage,attackName:v.name})}function y(v){if(!v.damage){alert(`${v.name}: No damage specified`);return}u("roll",{notation:v.damage})}Ce();var m=Ga(),L=l(o(m),2),h=l(L,2),x=o(h);Me(x,1,()=>a().attacks,v=>v.id,(v,d,H)=>{var I=Ua(),S=o(I),_=o(S);z(_);var N=l(_,2);n(S);var M=l(S,2),B=o(M),R=l(o(B),2);z(R),n(B);var O=l(B,2),j=l(o(O),2);z(j),n(O);var Z=l(O,2),Y=l(o(Z),2);z(Y),n(Z),n(M);var D=l(M,2),V=o(D),G=l(V,2);n(D),n(I),W(_,()=>t(d).name,J=>(t(d).name=J,Xe(()=>a()),Ze(i,"$character"))),P("click",N,()=>p(t(d).id)),W(R,()=>t(d).bonus,J=>(t(d).bonus=J,Xe(()=>a()),Ze(i,"$character"))),W(j,()=>t(d).damage,J=>(t(d).damage=J,Xe(()=>a()),Ze(i,"$character"))),W(Y,()=>t(d).damageType,J=>(t(d).damageType=J,Xe(()=>a()),Ze(i,"$character"))),P("click",V,()=>c(t(d))),P("click",G,()=>y(t(d))),E(v,I)});var C=l(x,2);{var w=v=>{var d=Oa();E(v,d)};ve(C,v=>{a().attacks.length===0&&v(w)})}n(h),n(m),P("click",L,r),E(e,m),De(),f()}var za=U('<p class="no-features svelte-1kpvv0n">Select a class to see available features</p>'),qa=U('<p class="no-features svelte-1kpvv0n">No class features available at this level</p>'),Ja=U('<input type="checkbox" class="slot-checkbox svelte-1kpvv0n"/>'),Wa=U('<div class="spell-slots svelte-1kpvv0n"><label class="svelte-1kpvv0n">1st Level Spell Slots</label> <div class="slots-tracker svelte-1kpvv0n"><!> <button class="btn-small svelte-1kpvv0n">Long Rest</button></div></div>'),Va=U('<div class="feature-box spellcasting svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"> </h3> <div class="spell-stats svelte-1kpvv0n"><div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Spell Save DC</label> <div class="spell-value svelte-1kpvv0n"> </div></div> <div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <div class="spell-value svelte-1kpvv0n"> </div></div></div> <!> <div class="prepared-spells svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <textarea placeholder="List your prepared spells..." class="svelte-1kpvv0n"></textarea></div></div>'),Ya=U('<p class="unlimited svelte-1kpvv0n">Unlimited Uses</p>'),Xa=U('<input type="checkbox" class="use-checkbox svelte-1kpvv0n"/>'),Za=U('<input type="checkbox" class="use-checkbox svelte-1kpvv0n"/>'),Ka=U('<!> <button class="btn-small svelte-1kpvv0n"> </button>',1),Qa=U('<div class="uses-tracker svelte-1kpvv0n"><!></div>'),es=U('<div class="pool-tracker svelte-1kpvv0n"><input type="number" min="0" class="pool-input svelte-1kpvv0n"/> <span> </span> <button class="btn-small svelte-1kpvv0n"> </button></div>'),ts=U('<div class="feature-box svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"> </h3> <p class="feature-description svelte-1kpvv0n"> </p> <!></div>'),as=U('<div class="features-grid svelte-1kpvv0n"><!> <!></div>'),ss=U('<section class="class-features svelte-1kpvv0n"><h2 class="svelte-1kpvv0n">Class Features</h2> <!></section>');function ls(e,s){je(s,!1);const a=()=>ke(F,"$character",f),i=()=>ke(ht,"$abilityModifiers",f),[f,u]=Ee(),r=q(),p=q(),c=q();let y=q(0),m=q(0);function L(_,N){F.update(M=>(M.classFeatures.features[_]||(M.classFeatures.features[_]=[]),M.classFeatures.features[_]=Array(N).fill(!1),M))}function h(_,N){F.update(M=>(M.classFeatures.features[_]=N,M))}function x(){F.update(_=>(_.classFeatures.spellSlots=Array(t(c)).fill(!1),_))}function C(_){if(typeof _.maxUses=="function"){if(_.name==="Divine Sense"&&t(r)?.spellcastingAbility){const N=i()[t(r).spellcastingAbility];return _.maxUses(a().level,N)}return _.maxUses(a().level)}return _.maxUses||0}function w(_){return typeof _.maxPool=="function"?_.maxPool(a().level):_.maxPool||0}function v(_){return typeof _.description=="function"?_.description(a().level):_.description}Ge(()=>(a(),ze),()=>{k(r,a().class?ze(a().class):null)}),Ge(()=>(a(),Ct),()=>{k(p,a().class?Ct(a().class,a().level):[])}),Ge(()=>(a(),jt),()=>{k(c,a().class?jt(a().class,a().level):0)}),Ge(()=>(t(r),i(),a(),Dt),()=>{if(t(r)?.spellcaster&&t(r).spellcastingAbility){const _=i()[t(r).spellcastingAbility];k(y,ja(a().class,_,a().proficiencyBonus)||0),k(m,Dt(a().class,a().level,_))}}),Ut(),Ce();var d=ss(),H=l(o(d),2);{var I=_=>{var N=za();E(_,N)},S=_=>{var N=at(),M=Pe(N);{var B=O=>{var j=qa();E(O,j)},R=O=>{var j=as(),Z=o(j);{var Y=V=>{var G=Va(),J=o(G),ne=o(J);n(J);var ge=l(J,2),A=o(ge),X=l(o(A),2),oe=o(X,!0);n(X),n(A);var be=l(A,2),fe=l(o(be),2),xe=o(fe,!0);n(fe),n(be),n(ge);var ye=l(ge,2);{var Ne=T=>{var K=Wa(),ee=l(o(K),2),ie=o(ee);Me(ie,1,()=>(t(c),b(()=>Array(t(c)))),He,(ce,pe,de)=>{var me=Ja();z(me),mt(me,()=>a().classFeatures.spellSlots[de],_e=>re(F,b(a).classFeatures.spellSlots[de]=_e,b(a))),E(ce,me)});var se=l(ie,2);n(ee),n(K),P("click",se,x),E(T,K)};ve(ye,T=>{t(c)>0&&T(Ne)})}var $=l(ye,2),g=l(o($),2);Qe(g),n($),n(G),ae(T=>{Q(ne,`Spellcasting (${T??""})`),Q(oe,t(y)),Q(xe,t(m))},[()=>(t(r),b(()=>t(r).spellcastingAbility?.toUpperCase()))]),W(g,()=>a().classFeatures.preparedSpells,T=>re(F,b(a).classFeatures.preparedSpells=T,b(a))),E(V,G)};ve(Z,V=>{t(r),b(()=>t(r)?.spellcaster)&&V(Y)})}var D=l(Z,2);Me(D,1,()=>t(p),He,(V,G)=>{const J=Fe(()=>(t(G),b(()=>t(G).name.replace(/\s+/g,"")))),ne=Fe(()=>(a(),Be(t(J)),b(()=>a().classFeatures.features[t(J)]))),ge=Fe(()=>(Be(t(ne)),b(()=>Array.isArray(t(ne))))),A=Fe(()=>typeof t(ne)=="number");var X=ts(),oe=o(X),be=o(oe,!0);n(oe);var fe=l(oe,2),xe=o(fe,!0);n(fe);var ye=l(fe,2);{var Ne=g=>{const T=Fe(()=>(t(G),b(()=>C(t(G)))));var K=Qa(),ee=o(K);{var ie=ce=>{var pe=Ya();E(ce,pe)},se=ce=>{var pe=Ka(),de=Pe(pe);Me(de,1,()=>(Be(t(T)),b(()=>Array(t(T)))),He,(Le,Re,$e)=>{var Te=at(),te=Pe(Te);{var ue=le=>{var he=Xa();z(he),ae(()=>$t(he,(Be(t(ne)),b(()=>t(ne)&&t(ne)[$e]||!1)))),P("change",he,qe=>{F.update(Ie=>{Ie.classFeatures.features[t(J)]||(Ie.classFeatures.features[t(J)]=[]);const tt=Ie.classFeatures.features[t(J)];return tt[$e]=qe.currentTarget.checked,Ie})}),E(le,he)},Ae=le=>{var he=Za();z(he),$t(he,!1),P("change",he,qe=>{F.update(Ie=>{Ie.classFeatures.features[t(J)]||(Ie.classFeatures.features[t(J)]=[]);const tt=Ie.classFeatures.features[t(J)];return tt[$e]=qe.currentTarget.checked,Ie})}),E(le,he)};ve(te,le=>{t(ge)?le(ue):le(Ae,!1)})}E(Le,Te)});var me=l(de,2),_e=o(me,!0);n(me),ae(()=>Q(_e,(t(G),b(()=>t(G).resetOn==="short"?"Short Rest":"Long Rest")))),P("click",me,()=>L(t(J),t(T))),E(ce,pe)};ve(ee,ce=>{t(T)===1/0?ce(ie):ce(se,!1)})}n(K),E(g,K)},$=g=>{var T=at(),K=Pe(T);{var ee=ie=>{const se=Fe(()=>(t(G),b(()=>w(t(G)))));var ce=es(),pe=o(ce);z(pe);var de=l(pe,2),me=o(de);n(de);var _e=l(de,2),Le=o(_e,!0);n(_e),n(ce),ae(()=>{Ot(pe,t(A)&&t(ne)!==void 0?t(ne):t(se)),Ue(pe,"max",t(se)),Q(me,`/ ${t(se)??""}`),Q(Le,(t(G),b(()=>t(G).resetOn==="short"?"Short Rest":"Long Rest")))}),P("input",pe,Re=>{F.update($e=>($e.classFeatures.features[t(J)]=parseInt(Re.currentTarget.value)||0,$e))}),P("click",_e,()=>h(t(J),t(se))),E(ie,ce)};ve(K,ie=>{t(G),b(()=>t(G).type==="pool")&&ie(ee)},!0)}E(g,T)};ve(ye,g=>{t(G),b(()=>t(G).type==="uses")?g(Ne):g($,!1)})}n(X),ae(g=>{Q(be,(t(G),b(()=>t(G).name))),Q(xe,g)},[()=>(t(G),b(()=>v(t(G))))]),E(V,X)}),n(j),E(O,j)};ve(M,O=>{t(p),b(()=>t(p).length===0)?O(B):O(R,!1)},!0)}E(_,N)};ve(H,_=>{a(),b(()=>!a().class)?_(I):_(S,!1)})}n(d),E(e,d),De(),u()}var is=U('<section class="notes svelte-wttn0l"><h2 class="svelte-wttn0l">Features & Traits</h2> <textarea placeholder="Enter features, traits, and special abilities..." class="svelte-wttn0l"></textarea> <h2 class="svelte-wttn0l">Equipment</h2> <textarea placeholder="List your equipment and inventory..." class="svelte-wttn0l"></textarea> <h2 class="svelte-wttn0l">Notes</h2> <textarea placeholder="Additional notes..." class="svelte-wttn0l"></textarea></section>');function rs(e,s){je(s,!1);const a=()=>ke(F,"$character",i),[i,f]=Ee();Ce();var u=is(),r=l(o(u),2);Qe(r);var p=l(r,4);Qe(p);var c=l(p,4);Qe(c),n(u),W(r,()=>a().features,y=>re(F,b(a).features=y,b(a))),W(p,()=>a().equipment,y=>re(F,b(a).equipment=y,b(a))),W(c,()=>a().notes,y=>re(F,b(a).notes=y,b(a))),E(e,u),De(),f()}var ns=U('<div class="loading svelte-1r90jgp"><p class="svelte-1r90jgp">Loading 3D dice...</p></div>'),os=U('<div class="custom-dice-selector svelte-1r90jgp"><h3 class="svelte-1r90jgp">Choose Dice to Roll</h3> <div class="dice-inputs svelte-1r90jgp"><div class="dice-input-group svelte-1r90jgp"><label for="d4" class="svelte-1r90jgp">d4</label> <input type="number" id="d4" min="0" max="10" class="svelte-1r90jgp"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d6" class="svelte-1r90jgp">d6</label> <input type="number" id="d6" min="0" max="10" class="svelte-1r90jgp"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d8" class="svelte-1r90jgp">d8</label> <input type="number" id="d8" min="0" max="10" class="svelte-1r90jgp"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d10" class="svelte-1r90jgp">d10</label> <input type="number" id="d10" min="0" max="10" class="svelte-1r90jgp"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d12" class="svelte-1r90jgp">d12</label> <input type="number" id="d12" min="0" max="10" class="svelte-1r90jgp"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d20" class="svelte-1r90jgp">d20</label> <input type="number" id="d20" min="0" max="10" class="svelte-1r90jgp"/></div></div> <div class="dice-controls svelte-1r90jgp"><button class="btn btn-primary svelte-1r90jgp"> </button> <button class="btn btn-secondary svelte-1r90jgp">Reset</button></div></div>'),cs=U('<span class="crit-badge svelte-1r90jgp">CRITICAL!</span>'),vs=U('<p class="svelte-1r90jgp"> </p>'),ds=U('<p class="modifier-text svelte-1r90jgp"> </p>'),us=U('<button class="btn btn-follow-up svelte-1r90jgp"> </button>'),fs=U('<div class="follow-up-actions svelte-1r90jgp"></div>'),ps=U('<div class="result-header svelte-1r90jgp"><h3 class="svelte-1r90jgp"> </h3> <!></div> <div class="result-total svelte-1r90jgp"> </div> <div class="result-details svelte-1r90jgp"><!> <!></div> <!>',1),bs=U('<div role="button" tabindex="-1"><div class="modal-content svelte-1r90jgp" role="dialog" tabindex="0"><div class="modal-header svelte-1r90jgp"><h2 class="svelte-1r90jgp">Dice Roller</h2> <button class="close-btn svelte-1r90jgp">Ã—</button></div> <!> <div class="dice-main-area svelte-1r90jgp"><div class="dice-container svelte-1r90jgp"></div> <!></div> <div><!></div></div></div>');function ms(e,s){je(s,!1);const a=q(),i=Ve();let f=Je(s,"notation",12,""),u=Je(s,"visible",8,!1),r=Je(s,"damageNotation",12,""),p=Je(s,"attackName",12,""),c=null,y=q(void 0),m=q(!1),L=q(""),h=q(null),x=q(0),C=q(0),w=q(0),v=q(0),d=q(0),H=q(0),I=q(0),S=q([]),_=q(!1);function N(){if(window.DICE&&t(y))try{c&&t(y)&&pa(y,t(y).innerHTML="");const $=t(y).clientWidth||500,g=t(y).clientHeight||300;c=new window.DICE.dice_box(t(y),{w:$,h:g}),k(m,!0),console.log(`Dice box initialized with dimensions: ${$}x${g}`)}catch($){console.error("Error initializing dice box:",$)}}Et(()=>{const $=T=>new Promise((K,ee)=>{if(document.querySelector(`script[src="${T}"]`)){console.log(`Script already loaded: ${T}`),K(null);return}const se=document.createElement("script");se.src=T,se.onload=()=>{console.log(`Loaded: ${T}`),K(null)},se.onerror=()=>{console.error(`Failed to load: ${T}`),ee(new Error(`Failed to load ${T}`))},document.head.appendChild(se)});setTimeout(()=>{$(`${Ke}/libs/three.min.js`).then(()=>$(`${Ke}/libs/cannon.min.js`)).then(()=>$(`${Ke}/libs/teal.js`)).then(()=>$(`${Ke}/dice.js`)).then(()=>{console.log("All scripts loaded, initializing dice box..."),console.log("DICE available:",!!window.DICE),console.log("Container available:",!!t(y)),N()}).catch(T=>{console.error("Failed to load dice libraries:",T)})},100);const g=()=>{t(m)&&(console.log("Window resized, reinitializing dice box..."),N())};return window.addEventListener("resize",g),()=>{window.removeEventListener("resize",g)}});function M($,g="other"){if(!c||!t(m))return;console.log("Rolling dice:",$,"type:",g),c.diceToRoll=$;const T=ee=>(console.log("Before roll:",ee),null),K=ee=>{if(console.log("After roll:",ee),console.log("Result:",ee.resultTotal),k(h,ee),g==="attack"||g==="check"||g==="save"){const ie=ee.results?.filter(se=>se.sides===20)||[];if(ie.length>0){const se=ie[0].value;k(_,se===20)}}if(k(S,[]),g==="attack"&&r())if(t(_)){const ie=O(r());t(S).push({label:`Roll Critical Damage (${ie})`,notation:ie})}else t(S).push({label:`Roll Damage (${r()})`,notation:r()})};c.start_throw(T,K)}function B(){const $=[];t(x)>0&&$.push(`${t(x)}d4`),t(C)>0&&$.push(`${t(C)}d6`),t(w)>0&&$.push(`${t(w)}d8`),t(v)>0&&$.push(`${t(v)}d10`),t(d)>0&&$.push(`${t(d)}d12`),t(H)>0&&$.push(`${t(H)}d20`);let g=$.join("+")||"1d20";return t(I)!==0&&(g+=t(I)>=0?`+${t(I)}`:`${t(I)}`),g}function R(){const $=B();M($)}function O($){return $.replace(/(\d+)d(\d+)/g,(g,T,K)=>`${parseInt(T)*2}d${K}`)}function j(){k(x,0),k(C,0),k(w,0),k(v,0),k(d,0),k(H,0),k(I,0),k(h,null),k(S,[]),k(_,!1)}function Z(){i("close"),f(""),r(""),p(""),k(L,""),k(h,null),j()}Ge(()=>(t(x),t(C),t(w),t(v),t(d),t(H),t(I)),()=>{k(a,(()=>{const $=[];t(x)>0&&$.push(`${t(x)}d4`),t(C)>0&&$.push(`${t(C)}d6`),t(w)>0&&$.push(`${t(w)}d8`),t(v)>0&&$.push(`${t(v)}d10`),t(d)>0&&$.push(`${t(d)}d12`),t(H)>0&&$.push(`${t(H)}d20`);let g=$.join("+")||"1d20";return t(I)!==0&&(g+=t(I)>=0?`+${t(I)}`:`${t(I)}`),g})())}),Ge(()=>(Be(f()),t(m),Be(u())),()=>{if(f()&&t(m)&&u()){k(L,f()),k(h,null),k(S,[]),k(_,!1);const $=f().includes("1d20")?"attack":"other";setTimeout(()=>M(f(),$),200)}}),Ut(),Ce();var Y=bs();let D;var V=o(Y),G=o(V),J=l(o(G),2);n(G);var ne=l(G,2);{var ge=$=>{var g=ns();E($,g)};ve(ne,$=>{t(m)||$(ge)})}var A=l(ne,2),X=o(A);dt(X,$=>k(y,$),()=>t(y));var oe=l(X,2);{var be=$=>{var g=os(),T=l(o(g),2),K=o(T),ee=l(o(K),2);z(ee),n(K);var ie=l(K,2),se=l(o(ie),2);z(se),n(ie);var ce=l(ie,2),pe=l(o(ce),2);z(pe),n(ce);var de=l(ce,2),me=l(o(de),2);z(me),n(de);var _e=l(de,2),Le=l(o(_e),2);z(Le),n(_e);var Re=l(_e,2),$e=l(o(Re),2);z($e),n(Re),n(T);var Te=l(T,2),te=o(Te),ue=o(te);n(te);var Ae=l(te,2);n(Te),n(g),ae(()=>{te.disabled=!t(m),Q(ue,`Roll ${t(a)??""}`)}),W(ee,()=>t(x),le=>k(x,le)),W(se,()=>t(C),le=>k(C,le)),W(pe,()=>t(w),le=>k(w,le)),W(me,()=>t(v),le=>k(v,le)),W(Le,()=>t(d),le=>k(d,le)),W($e,()=>t(H),le=>k(H,le)),P("click",te,R),P("click",Ae,j),E($,g)};ve(oe,$=>{f()||$(be)})}n(A);var fe=l(A,2);let xe;var ye=o(fe);{var Ne=$=>{var g=ps(),T=Pe(g),K=o(T),ee=o(K,!0);n(K);var ie=l(K,2);{var se=te=>{var ue=cs();E(te,ue)};ve(ie,te=>{t(_)&&te(se)})}n(T);var ce=l(T,2),pe=o(ce,!0);n(ce);var de=l(ce,2),me=o(de);{var _e=te=>{var ue=vs(),Ae=o(ue,!0);n(ue),ae(()=>Q(Ae,(t(h),b(()=>t(h).resultString)))),E(te,ue)};ve(me,te=>{t(h),b(()=>t(h).resultString)&&te(_e)})}var Le=l(me,2);{var Re=te=>{var ue=ds(),Ae=o(ue);n(ue),ae(()=>Q(Ae,`Modifier: ${t(h),b(()=>t(h).constant>=0?"+":"")??""}${t(h),b(()=>t(h).constant)??""}`)),E(te,ue)};ve(Le,te=>{t(h),b(()=>t(h).constant)&&te(Re)})}n(de);var $e=l(de,2);{var Te=te=>{var ue=fs();Me(ue,5,()=>t(S),He,(Ae,le)=>{var he=us(),qe=o(he,!0);n(he),ae(()=>Q(qe,(t(le),b(()=>t(le).label)))),P("click",he,()=>M(t(le).notation,"damage")),E(Ae,he)}),n(ue),E(te,ue)};ve($e,te=>{t(S),b(()=>t(S).length>0)&&te(Te)})}ae(()=>{Q(ee,p()?`${p()} - Result`:"Result"),Q(pe,(t(h),b(()=>t(h).resultTotal)))}),E($,g)};ve(ye,$=>{t(h)&&$(Ne)})}n(fe),n(V),n(Y),ae(()=>{D=ut(Y,1,"modal-overlay svelte-1r90jgp",null,D,{hidden:!u()}),xe=ut(fe,1,"roll-result svelte-1r90jgp",null,xe,{"has-result":t(h)})}),P("click",J,Z),P("click",V,Bt(function($){et.call(this,s,$)})),P("keydown",V,function($){et.call(this,s,$)}),P("click",Y,Z),P("keydown",Y,$=>$.key==="Escape"&&Z()),E(e,Y),De()}const gt="https://api.github.com/gists";async function hs(e,s,a){if(!s)throw new Error("GitHub token is required");const i=JSON.stringify(e,null,2),f=`${e.name||"character"}_dnd.json`,u={description:a||`D&D Character: ${e.name}`,public:!1,files:{[f]:{content:i}}},r=await fetch(gt,{method:"POST",headers:{Authorization:`token ${s}`,"Content-Type":"application/json"},body:JSON.stringify(u)});if(!r.ok)throw new Error(`Failed to create gist: ${r.statusText}`);return(await r.json()).id}async function gs(e,s,a){if(!s||!a)throw new Error("GitHub token and Gist ID are required");const i=JSON.stringify(e,null,2),u={files:{[`${e.name||"character"}_dnd.json`]:{content:i}}},r=await fetch(`${gt}/${a}`,{method:"PATCH",headers:{Authorization:`token ${s}`,"Content-Type":"application/json"},body:JSON.stringify(u)});if(!r.ok)throw new Error(`Failed to update gist: ${r.statusText}`)}async function ys(e,s){if(!e)throw new Error("Gist ID is required");const a={"Content-Type":"application/json"};s&&(a.Authorization=`token ${s}`);const i=await fetch(`${gt}/${e}`,{method:"GET",headers:a});if(!i.ok)throw new Error(`Failed to load gist: ${i.statusText}`);const f=await i.json(),u=Object.values(f.files);if(u.length===0)throw new Error("No files found in gist");const p=u[0].content;try{const c=JSON.parse(p);return c.attacks&&Array.isArray(c.attacks)&&(c.attacks=c.attacks.map(y=>({...y,id:y.id||crypto.randomUUID()}))),c.classFeatures?(c.classFeatures.features||(c.classFeatures.features={}),c.classFeatures.spellSlots||(c.classFeatures.spellSlots=[]),c.classFeatures.preparedSpells===void 0&&(c.classFeatures.preparedSpells="")):c.classFeatures={features:{},spellSlots:[],preparedSpells:""},c}catch{throw new Error("Invalid character data in gist")}}function It(e){typeof window<"u"&&localStorage.setItem("dnd_gist_config",JSON.stringify(e))}function _s(){if(typeof window<"u"){const e=localStorage.getItem("dnd_gist_config");if(e)return JSON.parse(e)}return{}}var ks=U('<div class="error-message svelte-1jb5ckg"> </div>'),xs=U('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID (leave empty to create new)</label> <input type="text" id="gistId" placeholder="Optional: existing Gist ID to update" class="svelte-1jb5ckg"/></div> <div class="form-group svelte-1jb5ckg"><label for="description" class="svelte-1jb5ckg">Description</label> <input type="text" id="description" placeholder="D&amp;D Character Sheet" class="svelte-1jb5ckg"/></div>',1),$s=U('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID *</label> <input type="text" id="gistId" placeholder="Enter Gist ID" required class="svelte-1jb5ckg"/></div>'),Ss=U('<div class="modal-overlay svelte-1jb5ckg" role="button" tabindex="-1"><div class="modal-content svelte-1jb5ckg" role="dialog" tabindex="0"><div class="modal-header svelte-1jb5ckg"><h2 class="svelte-1jb5ckg"> </h2> <button class="close-btn svelte-1jb5ckg">Ã—</button></div> <div class="modal-body svelte-1jb5ckg"><!> <div class="form-group svelte-1jb5ckg"><label for="token" class="svelte-1jb5ckg">GitHub Token (optional for public gists) <a href="https://github.com/settings/tokens" target="_blank" rel="noopener" class="svelte-1jb5ckg">Get token</a></label> <input type="password" id="token" placeholder="ghp_xxxxxxxxxxxxx" class="svelte-1jb5ckg"/></div> <!> <div class="modal-actions svelte-1jb5ckg"><button class="btn btn-primary svelte-1jb5ckg"><!></button> <button class="btn btn-secondary svelte-1jb5ckg">Cancel</button></div></div></div></div>');function ws(e,s){je(s,!1);const a=()=>ke(F,"$character",i),[i,f]=Ee(),u=Ve();let r=Je(s,"mode",8,"save"),p=q(""),c=q(""),y=q(""),m=q(!1),L=q("");const h=_s();h.token&&k(p,h.token),h.gistId&&k(c,h.gistId);async function x(){if(!t(p)){k(L,"GitHub token is required");return}k(m,!0),k(L,"");try{if(t(c))await gs(a(),t(p),t(c)),alert("Character updated in Gist successfully!");else{const A=await hs(a(),t(p),t(y));k(c,A),alert(`Character saved to Gist! ID: ${A}`)}It({token:t(p),gistId:t(c)}),u("close")}catch(A){k(L,A.message||"Failed to save to Gist")}finally{k(m,!1)}}async function C(){if(!t(c)){k(L,"Gist ID is required");return}k(m,!0),k(L,"");try{const A=await ys(t(c),t(p)||void 0);F.set(A),It({token:t(p),gistId:t(c)}),alert("Character loaded from Gist successfully!"),u("close")}catch(A){k(L,A.message||"Failed to load from Gist")}finally{k(m,!1)}}function w(){u("close")}Ce();var v=Ss(),d=o(v),H=o(d),I=o(H),S=o(I,!0);n(I);var _=l(I,2);n(H);var N=l(H,2),M=o(N);{var B=A=>{var X=ks(),oe=o(X,!0);n(X),ae(()=>Q(oe,t(L))),E(A,X)};ve(M,A=>{t(L)&&A(B)})}var R=l(M,2),O=l(o(R),2);z(O),n(R);var j=l(R,2);{var Z=A=>{var X=xs(),oe=Pe(X),be=l(o(oe),2);z(be),n(oe);var fe=l(oe,2),xe=l(o(fe),2);z(xe),n(fe),ae(()=>{be.disabled=t(m),xe.disabled=t(m)}),W(be,()=>t(c),ye=>k(c,ye)),W(xe,()=>t(y),ye=>k(y,ye)),E(A,X)},Y=A=>{var X=$s(),oe=l(o(X),2);z(oe),n(X),ae(()=>oe.disabled=t(m)),W(oe,()=>t(c),be=>k(c,be)),E(A,X)};ve(j,A=>{r()==="save"?A(Z):A(Y,!1)})}var D=l(j,2),V=o(D),G=o(V);{var J=A=>{var X=yt();ae(()=>Q(X,r()==="save"?"Saving...":"Loading...")),E(A,X)},ne=A=>{var X=yt();ae(()=>Q(X,r()==="save"?"Save":"Load")),E(A,X)};ve(G,A=>{t(m)?A(J):A(ne,!1)})}n(V);var ge=l(V,2);n(D),n(N),n(d),n(v),ae(()=>{Q(S,r()==="save"?"Save to GitHub Gist":"Load from GitHub Gist"),O.disabled=t(m),V.disabled=t(m),ge.disabled=t(m)}),P("click",_,w),W(O,()=>t(p),A=>k(p,A)),P("click",V,function(...A){(r()==="save"?x:C)?.apply(this,A)}),P("click",ge,w),P("click",d,Bt(function(A){et.call(this,s,A)})),P("keydown",d,function(A){et.call(this,s,A)}),P("click",v,w),P("keydown",v,A=>A.key==="Escape"&&w()),E(e,v),De(),f()}var Cs=U('<link rel="icon" type="image/png" href="/favicon.png"/>'),js=U('<div class="container svelte-1uha8ag"><header class="svelte-1uha8ag"><div class="header-top svelte-1uha8ag"><h1 class="svelte-1uha8ag">D&D Character Sheet</h1> <div class="mode-toggle"><button> </button></div></div> <div class="header-actions svelte-1uha8ag"><button class="btn btn-secondary">ðŸŽ² Roll Dice</button> <button class="btn btn-secondary">Save to Gist</button> <button class="btn btn-secondary">Load from Gist</button> <button class="btn btn-secondary">Export JSON</button> <button class="btn btn-secondary">Import JSON</button> <input type="file" accept=".json" style="display: none;"/></div></header> <main class="svelte-1uha8ag"><!> <!> <!> <!> <!> <!> <!></main></div> <!> <!>',1);function Rs(e,s){je(s,!1);const a=()=>ke(We,"$isEditMode",f),i=()=>ke(F,"$character",f),[f,u]=Ee();let r=q(!1),p=q(!1),c=q("save"),y=q(void 0),m=q(""),L=q(""),h=q(""),x=q();function C(g){k(m,""),setTimeout(typeof g=="string"?()=>{k(m,g),k(L,""),k(h,"")}:()=>{k(m,g.notation),k(L,g.damageNotation||""),k(h,g.attackName||"")},0),k(r,!0)}function w(){console.log("toggleMode called, current isEditMode:",a()),We.update(g=>(console.log("Updating isEditMode from",g,"to",!g),!g))}Et(()=>(console.log("onMount - initial isEditMode:",a()),console.log("onMount - body classes:",document.body.className),We.subscribe(T=>{console.log("isEditMode subscription triggered, value:",T),console.log("Body classes before:",document.body.className),T?(document.body.classList.remove("use-mode"),console.log("Removed use-mode class (Edit Mode)")):(document.body.classList.add("use-mode"),console.log("Added use-mode class (Use Mode)")),console.log("Body classes after:",document.body.className)})));function v(){wa(i())}function d(){t(y)?.click()}async function H(g){const K=g.target.files?.[0];if(K)try{const ee=await Ca(K);F.set(ee),alert("Character imported successfully!")}catch{alert("Failed to import character file")}}Ce();var I=js();ha("1uha8ag",g=>{var T=Cs();ba(()=>{ma.title="D&D Character Sheet"}),E(g,T)});var S=Pe(I),_=o(S),N=o(_),M=l(o(N),2),B=o(M);let R;var O=o(B,!0);n(B),n(M),n(N);var j=l(N,2),Z=o(j),Y=l(Z,2),D=l(Y,2),V=l(D,2),G=l(V,2),J=l(G,2);dt(J,g=>k(y,g),()=>t(y)),n(j),n(_);var ne=l(_,2),ge=o(ne);Fa(ge,{});var A=l(ge,2);Ra(A,{});var X=l(A,2);Ma(X,{$$events:{roll:g=>C(g.detail)}});var oe=l(X,2);Ha(oe,{$$events:{roll:g=>C(g.detail)}});var be=l(oe,2);Ba(be,{$$events:{roll:g=>C(g.detail)}});var fe=l(be,2);ls(fe,{});var xe=l(fe,2);rs(xe,{}),n(ne),n(S);var ye=l(S,2);dt(ms(ye,{get notation(){return t(m)},get damageNotation(){return t(L)},get attackName(){return t(h)},get visible(){return t(r)},$$events:{close:()=>k(r,!1)},$$legacy:!0}),g=>k(x,g),()=>t(x));var Ne=l(ye,2);{var $=g=>{ws(g,{get mode(){return t(c)},$$events:{close:()=>k(p,!1)}})};ve(Ne,g=>{t(p)&&g($)})}ae(()=>{R=ut(B,1,"btn btn-mode svelte-1uha8ag",null,R,{"use-mode":!a()}),Q(O,a()?"ðŸ“ Edit Mode":"ðŸŽ² Use Mode")}),P("click",B,w),P("click",Z,()=>k(r,!0)),P("click",Y,()=>{k(c,"save"),k(p,!0)}),P("click",D,()=>{k(c,"load"),k(p,!0)}),P("click",V,v),P("click",G,d),P("change",J,H),E(e,I),De(),u()}export{Rs as component};
