import{f as u,e as D,a as o,s as y,c as ot,t as $t}from"../chunks/DN9NmC1v.js";import{i as Mt}from"../chunks/Dlg-HS1s.js";import{c as Vt,o as na,a as ss}from"../chunks/Icie54Zd.js";import{a7 as Ka,i as Ja,aZ as ls,a_ as is,a$ as Ia,K as Wt,e as Va,b0 as Qa,T as ha,b1 as rs,b2 as ns,q as os,b3 as cs,b4 as vs,b5 as ds,ab as us,d as r,r as Xa,g as ps,C as Bt,b6 as tt,b7 as Gt,F,G as It,s as c,a4 as B,H as i,J as a,I as l,f as e,E as qe,m as rt,A as G,b8 as ja,b9 as St,ba as la,ao as ba,bb as fs}from"../chunks/swQEjlmu.js";import{c as ee,a as Ct,e as pt,i as ft,u as Ya,s as zt,b as _t,d as oa,f as ia,t as At,h as bs,T as gs,g as ms,j as hs}from"../chunks/B53stXlE.js";import{i as _,s as Tt,a as Ze,b as nt,d as da,e as _s}from"../chunks/BEkqXdCA.js";import{p as Dt,b as Aa}from"../chunks/gdGGBrOz.js";import{b as sa,r as ys}from"../chunks/Dhmsbmsw.js";function ga(s,n,t=!1){if(s.multiple){if(n==null)return;if(!Ja(n))return ls();for(var v of s.options)v.selected=n.includes(ra(v));return}for(v of s.options){var p=ra(v);if(is(p,n)){v.selected=!0;return}}(!t||n!==void 0)&&(s.selectedIndex=-1)}function Fa(s){var n=new MutationObserver(()=>{ga(s,s.__value)});n.observe(s,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Ka(()=>{n.disconnect()})}function Za(s,n,t=n){var v=new WeakSet,p=!0;Ia(s,"change",h=>{var x=h?"[selected]":":checked",I;if(s.multiple)I=[].map.call(s.querySelectorAll(x),ra);else{var k=s.querySelector(x)??s.querySelector("option:not([disabled])");I=k&&ra(k)}t(I),Wt!==null&&v.add(Wt)}),Va(()=>{var h=n();if(s===document.activeElement){var x=Qa??Wt;if(v.has(x))return}if(ga(s,h,p),p&&h===void 0){var I=s.querySelector(":checked");I!==null&&(h=ra(I),t(h))}s.__value=h,p=!1}),Fa(s)}function ra(s){return"__value"in s?s.__value:s.value}const ks=Symbol("is custom element"),xs=Symbol("is html");function Le(s){if(ha){var n=!1,t=()=>{if(!n){if(n=!0,s.hasAttribute("value")){var v=s.value;st(s,"value",null),s.value=v}if(s.hasAttribute("checked")){var p=s.checked;st(s,"checked",null),s.checked=p}}};s.__on_r=t,os(t),cs()}}function Ra(s,n){var t=Ea(s);t.value===(t.value=n??void 0)||s.value===n&&(n!==0||s.nodeName!=="PROGRESS")||(s.value=n??"")}function Ss(s,n){var t=Ea(s);t.checked!==(t.checked=n??void 0)&&(s.checked=n)}function st(s,n,t,v){var p=Ea(s);ha&&(p[n]=s.getAttribute(n),n==="src"||n==="srcset"||n==="href"&&s.nodeName==="LINK")||p[n]!==(p[n]=t)&&(n==="loading"&&(s[vs]=t),t==null?s.removeAttribute(n):typeof t!="string"&&$s(s).includes(n)?s[n]=t:s.setAttribute(n,t))}function Ea(s){return s.__attributes??={[ks]:s.nodeName.includes("-"),[xs]:s.namespaceURI===rs}}var Ta=new Map;function $s(s){var n=s.getAttribute("is")||s.nodeName,t=Ta.get(n);if(t)return t;Ta.set(n,t=[]);for(var v,p=s,h=Element.prototype;h!==p;){v=ds(p);for(var x in v)v[x].set&&t.push(x);p=ns(p)}return t}function Me(s,n,t=n){var v=new WeakSet;Ia(s,"input",async p=>{var h=p?s.defaultValue:s.value;if(h=wa(s)?La(h):h,t(h),Wt!==null&&v.add(Wt),await us(),h!==(h=n())){var x=s.selectionStart,I=s.selectionEnd,k=s.value.length;if(s.value=h??"",I!==null){var H=s.value.length;x===I&&I===k&&H>k?(s.selectionStart=H,s.selectionEnd=H):(s.selectionStart=x,s.selectionEnd=Math.min(I,H))}}}),(ha&&s.defaultValue!==s.value||r(n)==null&&s.value)&&(t(wa(s)?La(s.value):s.value),Wt!==null&&v.add(Wt)),Xa(()=>{var p=n();if(s===document.activeElement){var h=Qa??Wt;if(v.has(h))return}wa(s)&&p===La(s.value)||s.type==="date"&&!p&&!s.value||p!==s.value&&(s.value=p??"")})}function ma(s,n,t=n){Ia(s,"change",v=>{var p=v?s.defaultChecked:s.checked;t(p)}),(ha&&s.defaultChecked!==s.checked||r(n)==null)&&t(s.checked),Xa(()=>{var v=n();s.checked=!!v})}function wa(s){var n=s.type;return n==="number"||n==="range"}function La(s){return s===""?null:+s}function Cs(s,n,t){var v=ps(s,n);v&&v.set&&(s[n]=t,Ka(()=>{s[n]=null}))}function Pa(s){return function(...n){var t=n[0];return t.stopPropagation(),s?.apply(this,n)}}function Ha(s){return function(...n){var t=n[0];return t.preventDefault(),s?.apply(this,n)}}function Yt(s,n){var t=s.$$events?.[n.type],v=Ja(t)?t.slice():t==null?[]:[t];for(var p of v)p.call(this,n)}const ws="";function es(...s){return sa+ws+ys(s[0],s[1])}const Ma={paladin:{name:"Paladin",hitDice:"d10",spellcaster:!0,spellcastingAbility:"charisma",spellSlotsByLevel:{1:0,2:2,3:3,4:3,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Divine Sense",type:"uses",maxUses:(s,n=1)=>1+Math.max(1,n),resetOn:"long",description:"Detect celestials, fiends, and undead within 60 feet",minLevel:1},{name:"Lay on Hands",type:"pool",maxPool:s=>s*5,resetOn:"long",description:"Heal wounds or cure disease",minLevel:1},{name:"Divine Smite",type:"spellSlot",description:"Expend spell slot to deal extra radiant damage",minLevel:2,rollable:!0},{name:"Channel Divinity",type:"pool",maxPool:s=>s>=18?3:s>=6?2:1,resetOn:"short",description:"Sacred Weapon or Turn Undead",minLevel:3}]},fighter:{name:"Fighter",hitDice:"d10",spellcaster:!1,features:[{name:"Second Wind",type:"uses",maxUses:1,resetOn:"short",description:"Regain 1d10 + fighter level HP as bonus action",minLevel:1,rollable:!0,rollFormula:s=>`1d10+${s}`},{name:"Action Surge",type:"uses",maxUses:s=>s>=17?2:1,resetOn:"short",description:"Take one additional action on your turn",minLevel:2},{name:"Indomitable",type:"uses",maxUses:s=>s>=17?3:s>=13?2:1,resetOn:"long",description:"Reroll a failed saving throw",minLevel:9}],subclasses:{champion:{name:"Champion",features:[{name:"Improved Critical",type:"info",description:"Critical hit on 19-20",minLevel:3},{name:"Remarkable Athlete",type:"info",description:"Add half proficiency to STR/DEX/CON checks, increase long jump distance",minLevel:7},{name:"Additional Fighting Style",type:"info",description:"Choose a second fighting style",minLevel:10},{name:"Superior Critical",type:"info",description:"Critical hit on 18-20",minLevel:15},{name:"Survivor",type:"info",description:"Regain 5 + CON mod HP at start of turn if below half HP",minLevel:18}]},battlemaster:{name:"Battle Master",features:[{name:"Combat Superiority",type:"uses",maxUses:s=>s>=15?6:s>=7?5:4,resetOn:"short",description:s=>`Use superiority dice (${s>=18?"d12":s>=10?"d10":"d8"}) for maneuvers`,minLevel:3},{name:"Know Your Enemy",type:"info",description:"Learn capabilities of creatures you observe",minLevel:7},{name:"Improved Combat Superiority",type:"info",description:"Superiority dice become d10",minLevel:10},{name:"Relentless",type:"info",description:"Regain 1 superiority die if you have none at start of turn",minLevel:15}]}}},rogue:{name:"Rogue",hitDice:"d8",spellcaster:!1,features:[{name:"Sneak Attack",type:"info",description:s=>`Deal ${Math.ceil(s/2)}d6 extra damage once per turn with advantage or ally nearby`,minLevel:1,rollable:!0,rollFormula:s=>`${Math.ceil(s/2)}d6`},{name:"Cunning Action",type:"info",description:"Dash, Disengage, or Hide as a bonus action",minLevel:2},{name:"Uncanny Dodge",type:"info",description:"Use reaction to halve damage from an attack",minLevel:5},{name:"Evasion",type:"info",description:"Take no damage on successful Dex save (half on fail)",minLevel:7}]},wizard:{name:"Wizard",hitDice:"d6",spellcaster:!0,spellcastingAbility:"intelligence",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Arcane Recovery",type:"uses",maxUses:1,resetOn:"long",description:s=>`Recover spell slots totaling up to ${Math.ceil(s/2)} levels during short rest`,minLevel:1},{name:"Spell Mastery",type:"info",description:"Cast one 1st-level and one 2nd-level spell at will",minLevel:18}]},cleric:{name:"Cleric",hitDice:"d8",spellcaster:!0,spellcastingAbility:"wisdom",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Channel Divinity",type:"pool",maxPool:s=>s>=18?3:s>=6?2:1,resetOn:"short",description:"Turn Undead or domain-specific ability",minLevel:2},{name:"Destroy Undead",type:"info",description:s=>`Channel Divinity destroys undead of CR ${s>=17?4:s>=14?3:s>=11?2:s>=8?1:.5} or lower`,minLevel:5},{name:"Divine Intervention",type:"uses",maxUses:1,resetOn:"long",description:s=>`${s}% chance to succeed, implore deity for aid`,minLevel:10}],subclasses:{war:{name:"War Domain",features:[{name:"War Priest",type:"uses",maxUses:(s,n=1)=>Math.max(1,n),resetOn:"long",description:"Make one weapon attack as a bonus action",minLevel:1},{name:"Guided Strike",type:"channelDivinity",description:"Use your Channel Divinity to gain +10 to an attack roll. Make this choice after you see the roll, but before the DM says whether the attack hits or misses.",minLevel:2,resetOn:"short"},{name:"War God's Blessing",type:"channelDivinity",description:"Use reaction to grant +10 to an ally's attack roll within 30 feet. Consumes one use of Channel Divinity.",minLevel:6,resetOn:"short"},{name:"Divine Strike",type:"info",description:s=>`Deal extra ${s>=14?"2d8":"1d8"} weapon damage once per turn`,minLevel:8,rollable:!0,rollFormula:s=>s>=14?"2d8":"1d8"},{name:"Avatar of Battle",type:"info",description:"Gain resistance to nonmagical weapon damage",minLevel:17}]},life:{name:"Life Domain",features:[{name:"Disciple of Life",type:"info",description:"Healing spells restore additional 2 + spell level HP",minLevel:1},{name:"Preserve Life",type:"pool",maxPool:s=>s*5,resetOn:"short",description:"Restore HP to creatures within 30 feet",minLevel:2},{name:"Blessed Healer",type:"info",description:"Regain 2 + spell level HP when you cast healing spell",minLevel:6},{name:"Divine Strike",type:"info",description:s=>`Deal extra ${s>=14?"2d8":"1d8"} radiant damage once per turn`,minLevel:8,rollable:!0,rollFormula:s=>s>=14?"2d8":"1d8"},{name:"Supreme Healing",type:"info",description:"Maximize healing dice instead of rolling",minLevel:17}]}}},barbarian:{name:"Barbarian",hitDice:"d12",spellcaster:!1,features:[{name:"Rage",type:"uses",maxUses:s=>s>=20?1/0:s>=17?6:s>=12?5:s>=6?4:s>=3?3:2,resetOn:"long",description:s=>`+${s>=16?4:s>=9?3:2} damage, resistance to physical damage`,minLevel:1},{name:"Reckless Attack",type:"info",description:"Gain advantage on melee attacks, enemies get advantage on you",minLevel:2},{name:"Danger Sense",type:"info",description:"Advantage on Dex saves against effects you can see",minLevel:2}],subclasses:{berserker:{name:"Path of the Berserker",features:[{name:"Frenzy",type:"info",description:"While raging, make melee attack as bonus action (gain 1 exhaustion after rage)",minLevel:3},{name:"Mindless Rage",type:"info",description:"Cannot be charmed or frightened while raging",minLevel:6},{name:"Intimidating Presence",type:"info",description:"Use action to frighten creature within 30 feet",minLevel:10},{name:"Retaliation",type:"info",description:"When damaged by creature within 5 feet, make melee attack as reaction",minLevel:14}]}}}};function Ft(s){const n=s.toLowerCase();return Ma[n]||null}function Zt(s,n,t){const v=Ft(s);if(!v)return[];const p=v.features.filter(h=>!h.minLevel||h.minLevel<=n);if(t&&v.subclasses&&v.subclasses[t]){const h=v.subclasses[t].features.filter(x=>!x.minLevel||x.minLevel<=n);return[...p,...h]}return p}function Na(s){const n=Ft(s);return!n||!n.subclasses?[]:Object.keys(n.subclasses).map(t=>({id:t,name:n.subclasses[t].name}))}function Ua(s,n){const t=Ft(s);return!t||!t.spellcaster||!t.spellSlotsByLevel?0:t.spellSlotsByLevel[n]||0}function Ga(s,n,t){const v=Ft(s);return!v||!v.spellcaster?0:Math.max(1,t+n)}function Ls(s,n,t){const v=Ft(s);return!v||!v.spellcaster?null:8+n+t}function Ds(){return Object.keys(Ma).map(s=>({id:s,name:Ma[s].name}))}var js=u("<option> </option>"),As=u("<option> </option>"),Fs=u('<div class="form-group svelte-172i2fj"><label for="characterSubclass" class="svelte-172i2fj">Subclass</label> <select id="characterSubclass" class="svelte-172i2fj"><option>Select Subclass</option><!></select></div>'),Ms=u('<div class="info-grid svelte-172i2fj"><div class="form-group svelte-172i2fj"><label for="characterName" class="svelte-172i2fj">Character Name</label> <input type="text" id="characterName" placeholder="Enter name" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterClass" class="svelte-172i2fj">Class</label> <select id="characterClass" class="svelte-172i2fj"><option>Select Class</option><!></select></div> <!> <div class="form-group svelte-172i2fj"><label for="characterLevel" class="svelte-172i2fj">Level</label> <input type="number" id="characterLevel" min="1" max="20" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterRace" class="svelte-172i2fj">Race</label> <input type="text" id="characterRace" placeholder="e.g., Human" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterBackground" class="svelte-172i2fj">Background</label> <input type="text" id="characterBackground" placeholder="e.g., Soldier" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterAlignment" class="svelte-172i2fj">Alignment</label> <input type="text" id="characterAlignment" placeholder="e.g., Lawful Good" class="svelte-172i2fj"/></div></div>'),Bs=u('<section class="character-info svelte-172i2fj"><div class="header svelte-172i2fj"><h2 class="svelte-172i2fj">Character Info</h2> <button class="collapse-btn svelte-172i2fj"> </button></div> <!></section>');function Is(s,n){Bt(n,!1);const t=()=>Ze(ee,"$character",p),v=()=>Ze(Ct,"$collapsedStates",p),[p,h]=Tt(),x=B(),I=Ds();function k(ie){const q=ie.target;ee.update(je=>(je.class=q.value,je.subclass="",je))}function H(ie){const q=ie.target;ee.update(je=>(je.subclass=q.value,je))}function ve(ie){const q=ie.target;ee.update(je=>(je.level=parseInt(q.value)||1,je)),Ya()}function Q(){Ct.update(ie=>({...ie,characterInfo:!ie.characterInfo}))}tt(()=>(t(),Na),()=>{c(x,t().class?Na(t().class):[])}),Gt(),Mt();var N=Bs(),Ce=i(N),de=a(i(Ce),2),De=i(de,!0);l(de),l(Ce);var ue=a(Ce,2);{var ge=ie=>{var q=Ms(),je=i(q),me=a(i(je),2);Le(me),l(je);var X=a(je,2),z=a(i(X),2),pe=i(z);pe.value=pe.__value="";var xe=a(pe);pt(xe,1,()=>I,ft,(C,Y)=>{var M=js(),Z=i(M,!0);l(M);var We={};F(()=>{y(Z,(e(Y),r(()=>e(Y).name))),We!==(We=(e(Y),r(()=>e(Y).id)))&&(M.value=(M.__value=(e(Y),r(()=>e(Y).id)))??"")}),o(C,M)}),l(z);var fe;Fa(z),l(X);var Ue=a(X,2);{var S=C=>{var Y=Fs(),M=a(i(Y),2),Z=i(M);Z.value=Z.__value="";var We=a(Z);pt(We,1,()=>e(x),ft,(ye,ze)=>{var Ee=As(),it=i(Ee,!0);l(Ee);var A={};F(()=>{y(it,(e(ze),r(()=>e(ze).name))),A!==(A=(e(ze),r(()=>e(ze).id)))&&(Ee.value=(Ee.__value=(e(ze),r(()=>e(ze).id)))??"")}),o(ye,Ee)}),l(M);var oe;Fa(M),l(Y),F(()=>{oe!==(oe=(t(),r(()=>t().subclass)))&&(M.value=(M.__value=(t(),r(()=>t().subclass)))??"",ga(M,(t(),r(()=>t().subclass))))}),D("change",M,H),o(C,Y)};_(Ue,C=>{e(x),r(()=>e(x).length>0)&&C(S)})}var ne=a(Ue,2),ce=a(i(ne),2);Le(ce),l(ne);var he=a(ne,2),g=a(i(he),2);Le(g),l(he);var O=a(he,2),_e=a(i(O),2);Le(_e),l(O);var Re=a(O,2),f=a(i(Re),2);Le(f),l(Re),l(q),F(()=>{fe!==(fe=(t(),r(()=>t().class)))&&(z.value=(z.__value=(t(),r(()=>t().class)))??"",ga(z,(t(),r(()=>t().class)))),Ra(ce,(t(),r(()=>t().level)))}),Me(me,()=>t().name,C=>nt(ee,r(t).name=C,r(t))),D("change",z,k),D("change",ce,ve),Me(g,()=>t().race,C=>nt(ee,r(t).race=C,r(t))),Me(_e,()=>t().background,C=>nt(ee,r(t).background=C,r(t))),Me(f,()=>t().alignment,C=>nt(ee,r(t).alignment=C,r(t))),o(ie,q)};_(ue,ie=>{v(),r(()=>!v().characterInfo)&&ie(ge)})}l(N),F(()=>{st(de,"aria-label",(v(),r(()=>v().characterInfo?"Expand":"Collapse"))),y(De,(v(),r(()=>v().characterInfo?"â–¼":"â–²")))}),D("click",de,Q),o(s,N),It(),h()}var Rs=u('<div class="ability-card svelte-bbv1xt"><h3 class="svelte-bbv1xt"> </h3> <input type="number" class="ability-score svelte-bbv1xt" min="1" max="30"/> <div class="ability-modifier svelte-bbv1xt"> </div> <button class="roll-btn svelte-bbv1xt">Check</button> <div class="save-row svelte-bbv1xt"><input type="checkbox" class="svelte-bbv1xt"/> <label class="svelte-bbv1xt">Save</label> <button class="roll-btn-small svelte-bbv1xt">Roll</button></div></div>'),Es=u('<div class="proficiency-bonus svelte-bbv1xt"><label for="profBonus">Proficiency Bonus</label> <input type="number" id="profBonus" class="prof-input svelte-bbv1xt"/></div> <div class="abilities-grid svelte-bbv1xt"></div>',1),Ps=u('<section><div class="header svelte-bbv1xt"><h2 class="svelte-bbv1xt">Ability Scores</h2> <button class="collapse-btn svelte-bbv1xt"> </button></div> <!></section>');function Ts(s,n){Bt(n,!1);const t=()=>Ze(oa,"$abilityModifiers",x),v=()=>Ze(ee,"$character",x),p=()=>Ze(zt,"$searchFilter",x),h=()=>Ze(Ct,"$collapsedStates",x),[x,I]=Tt(),k=B(),H=B(),ve=Vt(),Q=[{key:"strength",label:"Strength"},{key:"dexterity",label:"Dexterity"},{key:"constitution",label:"Constitution"},{key:"intelligence",label:"Intelligence"},{key:"wisdom",label:"Wisdom"},{key:"charisma",label:"Charisma"}];function N(){Ya()}function Ce(z){const pe=t()[z],xe=`1d20${pe>=0?"+":""}${pe}`;ve("roll",xe)}function de(z){const pe=t()[z],xe=v().saveProficiencies[z]?v().proficiencyBonus:0,fe=pe+xe,Ue=`1d20${fe>=0?"+":""}${fe}`;ve("roll",Ue)}function De(){Ct.update(z=>({...z,abilityScores:!z.abilityScores}))}tt(()=>p(),()=>{c(k,Q.filter(({label:z})=>p()?z.toLowerCase().includes(p().toLowerCase()):!0))}),tt(()=>(e(k),p()),()=>{c(H,e(k).length>0||!p()||p().toLowerCase().includes("proficiency"))}),Gt(),Mt();var ue=Ps();let ge;var ie=i(ue),q=a(i(ie),2),je=i(q,!0);l(q),l(ie);var me=a(ie,2);{var X=z=>{var pe=Es(),xe=qe(pe),fe=a(i(xe),2);Le(fe),l(xe);var Ue=a(xe,2);pt(Ue,5,()=>e(k),ft,(S,ne)=>{let ce=()=>e(ne).key,he=()=>e(ne).label;var g=Rs(),O=i(g),_e=i(O,!0);l(O);var Re=a(O,2);Le(Re);var f=a(Re,2),C=i(f);l(f);var Y=a(f,2),M=a(Y,2),Z=i(M);Le(Z);var We=a(Z,2),oe=a(We,2);l(M),l(g),F(ye=>{y(_e,ye),y(C,`${t(),ce(),r(()=>t()[ce()]>=0?"+":"")??""}${t(),ce(),r(()=>t()[ce()])??""}`),st(Z,"id",`${ce()}-save`),st(We,"for",`${ce()}-save`)},[()=>(he(),r(()=>he().substring(0,3).toUpperCase()))]),Me(Re,()=>v().abilities[ce()],ye=>nt(ee,r(v).abilities[ce()]=ye,r(v))),D("change",Re,N),D("click",Y,()=>Ce(ce())),ma(Z,()=>v().saveProficiencies[ce()],ye=>nt(ee,r(v).saveProficiencies[ce()]=ye,r(v))),D("click",oe,()=>de(ce())),o(S,g)}),l(Ue),Me(fe,()=>v().proficiencyBonus,S=>nt(ee,r(v).proficiencyBonus=S,r(v))),o(z,pe)};_(me,z=>{h(),r(()=>!h().abilityScores)&&z(X)})}l(ue),F(()=>{ge=_t(ue,1,"ability-scores svelte-bbv1xt",null,ge,{hidden:!e(H)}),st(q,"aria-label",(h(),r(()=>h().abilityScores?"Expand":"Collapse"))),y(je,(h(),r(()=>h().abilityScores?"â–¼":"â–²")))}),D("click",q,De),o(s,ue),It(),I()}function Hs(s){return Math.floor((s-10)/2)}function Ba(s,n){if(!s.class)return null;const t=Ft(s.class);if(!t||!t.spellcaster||!t.spellcastingAbility)return null;const v=n[t.spellcastingAbility];return 8+s.proficiencyBonus+v}function Ns(s,n){if(!s.class)return 0;const t=Ft(s.class);return!t||!t.spellcaster||!t.spellcastingAbility?0:Hs(n[t.spellcastingAbility])}var Us=u('<div class="stat-box svelte-1r5hyyb"><label for="spellSaveDC" class="svelte-1r5hyyb">Spell Save DC</label> <input type="number" id="spellSaveDC" class="stat-input svelte-1r5hyyb" readonly="" title="8 + Proficiency Bonus + Spellcasting Ability Modifier"/></div>'),Gs=u('<span class="hit-dice-type"> </span>'),Os=u('<div class="stats-grid svelte-1r5hyyb"><div class="stat-box svelte-1r5hyyb"><label for="armorClass" class="svelte-1r5hyyb">Armor Class</label> <input type="number" id="armorClass" class="stat-input svelte-1r5hyyb"/></div> <div class="stat-box svelte-1r5hyyb"><label for="initiative" class="svelte-1r5hyyb">Initiative</label> <input type="number" id="initiative" class="stat-input svelte-1r5hyyb"/></div> <div class="stat-box svelte-1r5hyyb"><label for="speed" class="svelte-1r5hyyb">Speed</label> <input type="text" id="speed" class="stat-input svelte-1r5hyyb"/></div> <!></div> <div class="hp-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Points</h3> <div class="hp-display svelte-1r5hyyb"><div class="hp-inputs svelte-1r5hyyb"><input type="number" class="hp-current svelte-1r5hyyb" min="0"/> <span class="hp-separator svelte-1r5hyyb">/</span> <input type="number" class="hp-max svelte-1r5hyyb" min="0"/></div> <div class="hp-controls svelte-1r5hyyb"><button class="hp-btn svelte-1r5hyyb">âˆ’</button> <button class="hp-btn svelte-1r5hyyb">+</button> <button class="hp-btn svelte-1r5hyyb">âˆ’5</button> <button class="hp-btn svelte-1r5hyyb">+5</button></div></div> <div class="temp-hp svelte-1r5hyyb"><label for="tempHP" class="svelte-1r5hyyb">Temp HP</label> <input type="number" id="tempHP" min="0" class="svelte-1r5hyyb"/></div></div> <div class="hit-dice-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Dice</h3> <div class="hit-dice-display svelte-1r5hyyb"><input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <span>/</span> <input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <!></div> <div class="hit-dice-controls"><label for="hitDiceCount" class="svelte-1r5hyyb">Roll</label> <input type="number" id="hitDiceCount" class="hit-dice-count-input svelte-1r5hyyb" min="1" value="1"/> <button class="btn btn-primary roll-hit-dice use-enabled svelte-1r5hyyb">ðŸŽ² Roll</button></div></div>',1),qs=u('<section><div class="header svelte-1r5hyyb"><h2 class="svelte-1r5hyyb">Combat Stats</h2> <button class="collapse-btn svelte-1r5hyyb"> </button></div> <!></section>');function Ws(s,n){Bt(n,!1);const t=()=>Ze(ee,"$character",x),v=()=>Ze(oa,"$abilityModifiers",x),p=()=>Ze(zt,"$searchFilter",x),h=()=>Ze(Ct,"$collapsedStates",x),[x,I]=Tt(),k=B(),H=B(),ve=Vt();function Q(me){ee.update(X=>(X.currentHP=Math.max(0,Math.min(X.maxHP,X.currentHP+me)),X))}function N(me=1){if(t().hitDice.current<=0){alert("No hit dice remaining!");return}if(!t().class){alert("Please select a class first!");return}const X=Ft(t().class);if(!X){alert("Invalid class configuration!");return}const z=Math.min(me,t().hitDice.current),pe=X.hitDice,xe=v().constitution,fe=xe>=0?`+${xe}`:`${xe}`,Ue=`${z}${pe}${fe}`;ve("rollHitDice",{notation:Ue,hitDie:pe,count:z})}function Ce(){Ct.update(me=>({...me,combatStats:!me.combatStats}))}tt(()=>(t(),v()),()=>{c(k,Ba(t(),v()))}),tt(()=>p(),()=>{c(H,!p()||"armor class".includes(p().toLowerCase())||"initiative".includes(p().toLowerCase())||"speed".includes(p().toLowerCase())||"hit points".includes(p().toLowerCase())||"hp".includes(p().toLowerCase())||"hit dice".includes(p().toLowerCase())||"spell save".includes(p().toLowerCase())||"combat".includes(p().toLowerCase()))}),Gt(),Mt();var de=qs();let De;var ue=i(de),ge=a(i(ue),2),ie=i(ge,!0);l(ge),l(ue);var q=a(ue,2);{var je=me=>{var X=Os(),z=qe(X),pe=i(z),xe=a(i(pe),2);Le(xe),l(pe);var fe=a(pe,2),Ue=a(i(fe),2);Le(Ue),l(fe);var S=a(fe,2),ne=a(i(S),2);Le(ne),l(S);var ce=a(S,2);{var he=R=>{var V=Us(),w=a(i(V),2);Le(w),l(V),F(()=>Ra(w,e(k))),o(R,V)};_(ce,R=>{e(k)!==null&&R(he)})}l(z);var g=a(z,2),O=a(i(g),2),_e=i(O),Re=i(_e);Le(Re);var f=a(Re,4);Le(f),l(_e);var C=a(_e,2),Y=i(C),M=a(Y,2),Z=a(M,2),We=a(Z,2);l(C),l(O);var oe=a(O,2),ye=a(i(oe),2);Le(ye),l(oe),l(g);var ze=a(g,2),Ee=a(i(ze),2),it=i(Ee);Le(it);var A=a(it,4);Le(A);var E=a(A,2);{var j=R=>{const V=rt(()=>(G(Ft),t(),r(()=>Ft(t().class))));var w=ot(),Se=qe(w);{var Ae=Pe=>{const Xe=rt(()=>(v(),r(()=>v().constitution)));var Ve=Gs(),Te=i(Ve);l(Ve),F(()=>y(Te,`(${G(e(V)),r(()=>e(V).hitDice)??""}${(e(Xe)>=0?`+${e(Xe)}`:e(Xe))??""})`)),o(Pe,Ve)};_(Se,Pe=>{e(V)&&Pe(Ae)})}o(R,w)};_(E,R=>{t(),r(()=>t().class)&&R(j)})}l(Ee);var d=a(Ee,2),Ge=a(i(d),2),re=a(Ge,2);l(d),l(ze),F(()=>{st(Re,"max",(t(),r(()=>t().maxHP))),st(it,"max",(t(),r(()=>t().hitDice.max))),st(Ge,"max",(t(),r(()=>t().hitDice.current))),re.disabled=(t(),r(()=>t().hitDice.current<=0||!t().class))}),Me(xe,()=>t().armorClass,R=>nt(ee,r(t).armorClass=R,r(t))),Me(Ue,()=>t().initiative,R=>nt(ee,r(t).initiative=R,r(t))),Me(ne,()=>t().speed,R=>nt(ee,r(t).speed=R,r(t))),Me(Re,()=>t().currentHP,R=>nt(ee,r(t).currentHP=R,r(t))),Me(f,()=>t().maxHP,R=>nt(ee,r(t).maxHP=R,r(t))),D("click",Y,()=>Q(-1)),D("click",M,()=>Q(1)),D("click",Z,()=>Q(-5)),D("click",We,()=>Q(5)),Me(ye,()=>t().tempHP,R=>nt(ee,r(t).tempHP=R,r(t))),Me(it,()=>t().hitDice.current,R=>nt(ee,r(t).hitDice.current=R,r(t))),Me(A,()=>t().hitDice.max,R=>nt(ee,r(t).hitDice.max=R,r(t))),D("input",Ge,R=>{const V=R.target,w=parseInt(V.value);w>t().hitDice.current&&(V.value=String(t().hitDice.current)),w<1&&(V.value="1")}),D("click",re,()=>{const R=document.getElementById("hitDiceCount"),V=parseInt(R?.value||"1");N(V)}),o(me,X)};_(q,me=>{h(),r(()=>!h().combatStats)&&me(je)})}l(de),F(()=>{De=_t(de,1,"combat-stats svelte-1r5hyyb",null,De,{hidden:!e(H)}),st(ge,"aria-label",(h(),r(()=>h().combatStats?"Expand":"Collapse"))),y(ie,(h(),r(()=>h().combatStats?"â–¼":"â–²")))}),D("click",ge,Ce),o(s,de),It(),I()}const Da={acrobatics:"dexterity",animalHandling:"wisdom",arcana:"intelligence",athletics:"strength",deception:"charisma",history:"intelligence",insight:"wisdom",intimidation:"charisma",investigation:"intelligence",medicine:"wisdom",nature:"intelligence",perception:"wisdom",performance:"charisma",persuasion:"charisma",religion:"intelligence",sleightOfHand:"dexterity",stealth:"dexterity",survival:"wisdom"};var zs=u('<div class="skill-row svelte-1f1pl16"><input type="checkbox" class="svelte-1f1pl16"/> <label class="svelte-1f1pl16"> <span class="ability-tag svelte-1f1pl16"> </span></label> <span class="skill-modifier svelte-1f1pl16"> </span> <button class="roll-btn svelte-1f1pl16">Roll</button></div>'),Ks=u('<div class="skills-grid svelte-1f1pl16"></div>'),Js=u('<section><div class="header svelte-1f1pl16"><h2 class="svelte-1f1pl16">Skills</h2> <button class="collapse-btn svelte-1f1pl16"> </button></div> <!></section>');function Vs(s,n){Bt(n,!1);const t=()=>Ze(oa,"$abilityModifiers",x),v=()=>Ze(ee,"$character",x),p=()=>Ze(zt,"$searchFilter",x),h=()=>Ze(Ct,"$collapsedStates",x),[x,I]=Tt(),k=B(),H=B(),ve=Vt(),Q=[{key:"acrobatics",label:"Acrobatics"},{key:"animalHandling",label:"Animal Handling"},{key:"arcana",label:"Arcana"},{key:"athletics",label:"Athletics"},{key:"deception",label:"Deception"},{key:"history",label:"History"},{key:"insight",label:"Insight"},{key:"intimidation",label:"Intimidation"},{key:"investigation",label:"Investigation"},{key:"medicine",label:"Medicine"},{key:"nature",label:"Nature"},{key:"perception",label:"Perception"},{key:"performance",label:"Performance"},{key:"persuasion",label:"Persuasion"},{key:"religion",label:"Religion"},{key:"sleightOfHand",label:"Sleight of Hand"},{key:"stealth",label:"Stealth"},{key:"survival",label:"Survival"}];function N(X){const z=Da[X],pe=t()[z],xe=v().skillProficiencies[X]?v().proficiencyBonus:0;return pe+xe}function Ce(X){const z=N(X),pe=`1d20${z>=0?"+":""}${z}`;ve("roll",pe)}function de(){Ct.update(X=>({...X,skills:!X.skills}))}tt(()=>p(),()=>{c(k,Q.filter(({label:X})=>p()?X.toLowerCase().includes(p().toLowerCase()):!0))}),tt(()=>e(k),()=>{c(H,e(k).length>0)}),Gt(),Mt();var De=Js();let ue;var ge=i(De),ie=a(i(ge),2),q=i(ie,!0);l(ie),l(ge);var je=a(ge,2);{var me=X=>{var z=Ks();pt(z,5,()=>e(k),ft,(pe,xe)=>{let fe=()=>e(xe).key,Ue=()=>e(xe).label;const S=rt(()=>(G(Da),fe(),r(()=>Da[fe()]))),ne=rt(()=>(fe(),r(()=>N(fe()))));var ce=zs(),he=i(ce);Le(he);var g=a(he,2),O=i(g),_e=a(O),Re=i(_e);l(_e),l(g);var f=a(g,2),C=i(f);l(f);var Y=a(f,2);l(ce),F(M=>{st(he,"id",fe()),st(g,"for",fe()),y(O,`${Ue()??""} `),y(Re,`(${M??""})`),y(C,`${e(ne)>=0?"+":""}${e(ne)??""}`)},[()=>(G(e(S)),r(()=>e(S).substring(0,3).toUpperCase()))]),ma(he,()=>v().skillProficiencies[fe()],M=>nt(ee,r(v).skillProficiencies[fe()]=M,r(v))),D("click",Y,()=>Ce(fe())),o(pe,ce)}),l(z),o(X,z)};_(je,X=>{h(),r(()=>!h().skills)&&X(me)})}l(De),F(()=>{ue=_t(De,1,"skills svelte-1f1pl16",null,ue,{hidden:!e(H)}),st(ie,"aria-label",(h(),r(()=>h().skills?"Expand":"Collapse"))),y(q,(h(),r(()=>h().skills?"â–¼":"â–²")))}),D("click",ie,de),o(s,De),It(),I()}let ua=null,pa=null;async function ts(){if(ua)return ua;try{return ua=await(await fetch(es("/data/spells.json"))).json(),ua||[]}catch(s){return console.error("Failed to load spells:",s),[]}}async function Qs(){if(pa)return pa;try{return pa=await(await fetch(es("/data/feats.json"))).json(),pa||[]}catch(s){return console.error("Failed to load feats:",s),[]}}function Oa(s,n){if(!n.trim())return s;const t=n.toLowerCase();return s.filter(v=>v.name.toLowerCase().includes(t)||v.school.toLowerCase().includes(t)||v.classes.some(p=>p.toLowerCase().includes(t))||v.description.toLowerCase().includes(t))}function Xs(s,n){return n===null?s:s.filter(t=>t.level===n)}function Ys(s,n){if(!n.trim())return s;const t=n.toLowerCase();return s.filter(v=>v.name.toLowerCase().includes(t)||v.description.toLowerCase().includes(t))}function fa(s){const n=s.description,t=/\b(Strength|Dexterity|Constitution|Intelligence|Wisdom|Charisma)\s+saving\s+throw/i,v=n.match(t);if(!v)return null;const p=v[1].toLowerCase(),x=/half\s+(?:as\s+much\s+)?damage\s+on\s+a\s+successful(?:\s+save)?/i.test(n),k=/saving\s+throw\s+or\s+take.*?damage/i.test(n)&&!x;return{ability:p,halfDamageOnSave:x,noDamageOnSave:k}}function Zs(s){const n=s.description;return/(plus|add)\s+your\s+spellcasting\s+(ability\s+)?modifier/i.test(n)}function qa(s){const n=s.description.toLowerCase(),v=["takes","take","deals","deal","damage equal to","force damage","fire damage","cold damage","lightning damage","thunder damage","acid damage","poison damage","necrotic damage","radiant damage","psychic damage","regain","regains","hit point"].some(x=>n.includes(x));return["bonus to attack","bonus to damage","bonus to ac","gains a +","gain a +","+1 bonus","+2 bonus","+3 bonus","advantage on","becomes a magic weapon"].some(x=>n.includes(x))&&!v}function el(s){const n=s.description;let t=0,v=0,p="";const h=n.match(/\+(\d+)\s+bonus\s+to\s+attack\s+rolls\s+and\s+damage\s+rolls/i);if(h){const I=parseInt(h[1]);t=I,v=I,p=`+${I} to attack and damage rolls`}s.name==="Bless"&&(p="Add 1d4 to attack rolls and saves");const x=n.match(/\+(\d+)\s+bonus\s+to\s+AC/i);return x&&(p=`+${parseInt(x[1])} to AC`),s.name==="Haste"&&(p="+2 AC, doubled speed, extra action"),p||t!==0||v!==0?{attackBonus:t,damageBonus:v,description:p||s.description.substring(0,100)}:null}var tl=u('<button class="btn-remove svelte-14o91c5">Ã—</button>'),al=u('<div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Bonus</label> <input type="number" class="attack-bonus svelte-14o91c5"/></div>'),sl=u('<div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Damage</label> <input type="text" placeholder="e.g., 2d6+3" class="attack-damage svelte-14o91c5"/></div>'),ll=u('<div class="spell-info-loading svelte-14o91c5">Loading spell info...</div>'),il=u('<div class="spell-notes svelte-14o91c5"><h4 class="svelte-14o91c5">General Notes</h4> <p> </p></div>'),rl=u('<li class="svelte-14o91c5"><strong>At Higher Levels:</strong> </li>'),nl=u('<ul class="svelte-14o91c5"><li class="svelte-14o91c5"><strong>Level:</strong> </li> <li class="svelte-14o91c5"><strong>Casting Time:</strong> </li> <li class="svelte-14o91c5"><strong>Range:</strong> </li> <li class="svelte-14o91c5"><strong>Components:</strong> <!></li> <li class="svelte-14o91c5"><strong>Duration:</strong> <!> </li> <li class="svelte-14o91c5"><strong>Description:</strong> </li> <!></ul>'),ol=u("<option> </option>"),cl=u('<span class="scaled-damage svelte-14o91c5"><!> </span>'),vl=u('<span class="scaled-damage svelte-14o91c5"> </span>'),dl=u('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> Target is Fiend or Undead <!></label></div>'),ul=u('<span class="scaled-damage svelte-14o91c5" style="margin-left: 8px;"> </span>'),pl=u('<span class="scaled-damage svelte-14o91c5">(Half damage)</span>'),fl=u('<span class="scaled-damage svelte-14o91c5">(No damage)</span>'),bl=u('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> <!> <!></label></div>'),gl=u('<div class="spell-level-selector svelte-14o91c5"><label class="svelte-14o91c5">Cast at Level:</label> <select class="spell-level-select use-enabled svelte-14o91c5"></select> <!></div> <!> <!>',1),ml=u('<div class="spell-level-selector svelte-14o91c5"><span style="color: #dc3545; font-weight: bold;">No spell slots available!</span></div>'),hl=u('<!> <div class="spell-info svelte-14o91c5"><div class="spell-info-header svelte-14o91c5" role="button" tabindex="0"><h4 class="svelte-14o91c5">Spell Info</h4> <button class="collapse-btn-small svelte-14o91c5"> </button></div> <!></div> <!>',1),_l=u('<div class="spell-info-missing svelte-14o91c5">Spell info not found.</div>'),yl=u('<div class="attack-notes svelte-14o91c5"><label class="svelte-14o91c5">Notes</label> <textarea placeholder="e.g., DC 15 Dex save, Range 120 ft, Concentration" class="notes-input svelte-14o91c5" rows="2"></textarea></div>'),kl=u('<button class="btn btn-primary">Roll Attack</button>'),xl=u('<button class="btn btn-success">Cast Spell</button>'),Sl=u('<button class="btn btn-secondary"><!></button>'),$l=u('<button class="btn btn-secondary">Roll Damage</button>'),Cl=u('<div class="attack-card svelte-14o91c5"><div class="attack-header svelte-14o91c5"><input type="text" placeholder="Attack name" class="attack-name svelte-14o91c5"/> <!></div> <div class="attack-details svelte-14o91c5"><!> <!> <div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Type</label> <input type="text" placeholder="e.g., slashing" class="attack-type svelte-14o91c5"/></div></div> <!> <!> <div class="attack-actions svelte-14o91c5"><!> <!></div></div>'),wl=u('<p class="no-attacks svelte-14o91c5">No attacks added yet. Click "Add Attack" to create one.</p>'),Ll=u('<p class="no-attacks svelte-14o91c5">No attacks match your search.</p>'),Dl=u('<button class="btn-remove svelte-14o91c5">Ã—</button>'),jl=u('<div class="state-card svelte-14o91c5"><div class="state-header svelte-14o91c5"><input type="text" placeholder="Effect name (e.g., Magic Weapon)" class="state-name svelte-14o91c5"/> <!></div> <div class="state-details svelte-14o91c5"><div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Attack Bonus</label> <input type="number" class="state-bonus svelte-14o91c5"/></div> <div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Damage Bonus</label> <input type="number" class="state-bonus svelte-14o91c5"/></div></div> <div class="state-description svelte-14o91c5"><label class="svelte-14o91c5">Description</label> <input type="text" placeholder="e.g., +1 to attack and damage rolls (Magic Weapon)" class="state-desc-input svelte-14o91c5"/></div></div>'),Al=u('<div class="states-list svelte-14o91c5"></div>'),Fl=u('<p class="no-states svelte-14o91c5">No active effects. Add spell effects that modify your attacks.</p>'),Ml=u('<button class="btn btn-secondary">Add Attack</button> <div class="attacks-list svelte-14o91c5"><!> <!></div> <div class="active-states-section svelte-14o91c5"><h3 class="svelte-14o91c5">Active Spell Effects</h3> <p class="section-description svelte-14o91c5">Effects that modify attack and damage rolls (e.g., Magic Weapon, Bless)</p> <button class="btn btn-secondary">Add Effect</button> <!></div>',1),Bl=u('<section><div class="header svelte-14o91c5"><h2 class="svelte-14o91c5">Attacks & Spells</h2> <button class="collapse-btn svelte-14o91c5"> </button></div> <!></section>');function Il(s,n){Bt(n,!1);const t=()=>Ze(ee,"$character",I),v=()=>Ze(oa,"$abilityModifiers",I),p=()=>Ze(zt,"$searchFilter",I),h=()=>Ze(Ct,"$collapsedStates",I),x=()=>Ze(ia,"$isEditMode",I),[I,k]=Tt(),H=B(),ve=B(),Q=Vt();let N=B({});function Ce(f){ja(N,e(N)[f]=!e(N)[f]),c(N,{...e(N)})}function de(f){return f.description.toLowerCase().includes("regain")&&(f.description.toLowerCase().includes("hit point")||f.description.toLowerCase().includes("hp"))}function De(){ee.update(f=>(f.attacks=[...f.attacks,{id:crypto.randomUUID(),name:"",bonus:0,damage:"",damageType:"",notes:""}],f))}function ue(f){ee.update(C=>(C.attacks=C.attacks.filter(Y=>Y.id!==f),C))}function ge(f){let C=f.damage,Y=!1;if(f.spellRef){const oe=X(f.spellRef);if(oe&&oe.level>0){const ye=f.castAtLevel||oe.level;if(!z(ye)){At.add(`No level ${ye} spell slots available!`,"error");return}const Ee=fa(oe);Ee&&f.targetSucceededSave&&Ee.noDamageOnSave?C="0":(Y=Ee?.halfDamageOnSave&&f.targetSucceededSave||!1,C=pe(f,oe))}}else if(t().activeStates&&t().activeStates.length>0){let oe=0;for(const ye of t().activeStates)oe+=ye.damageBonus;if(oe!==0&&C){const ye=C.match(/(\d+d\d+)([+-]\d+)?/);if(ye){const[,ze,Ee]=ye,A=(Ee?parseInt(Ee):0)+oe;C=`${ze}${A>=0?"+":""}${A}`}}}const M=[];f.bonus!==0&&M.push({value:f.bonus,source:"base"});let Z=f.bonus;if(t().activeStates)for(const oe of t().activeStates)oe.attackBonus!==0&&(M.push({value:oe.attackBonus,source:oe.name.toLowerCase()}),Z+=oe.attackBonus);let We;We=`1d20${Z>=0?"+":""}${Z}`,Q("roll",{notation:We,damageNotation:C,attackName:f.name,applyHalfDamage:Y,bonusBreakdown:M})}function ie(f){if(!f.damage){At.add(`${f.name}: No damage specified`,"error");return}let C=f.damage,Y=!1;const M=[];if(f.spellRef){const Z=X(f.spellRef);if(Z&&Z.level>0){const We=f.castAtLevel||Z.level;if(!z(We)){At.add(`No level ${We} spell slots available!`,"error");return}const ye=fa(Z);ye&&f.targetSucceededSave&&ye.noDamageOnSave?C="0":(Y=ye?.halfDamageOnSave&&f.targetSucceededSave||!1,C=pe(f,Z))}}else{const Z=C.match(/(\d+d\d+)([+-]\d+)?/);if(Z){const[,We,oe]=Z,ye=oe?parseInt(oe):0;if(ye!==0&&M.push({value:ye,source:"base"}),t().activeStates&&t().activeStates.length>0){let ze=0;for(const Ee of t().activeStates)Ee.damageBonus!==0&&(M.push({value:Ee.damageBonus,source:Ee.name.toLowerCase()}),ze+=Ee.damageBonus);if(ze!==0){const Ee=ye+ze;C=`${We}${Ee>=0?"+":""}${Ee}`}}}}Q("roll",{notation:C,attackName:f.name,applyHalfDamage:Y,bonusBreakdown:M})}function q(){Ct.update(f=>({...f,attacks:!f.attacks}))}let je=B([]),me=B(!1);na(async()=>{c(je,await ts()),c(me,!0)});function X(f){return e(je).find(C=>C.name===f)}function z(f){t().classFeatures.spellSlotsByLevel||nt(ee,r(t).classFeatures.spellSlotsByLevel={},r(t)),t().classFeatures.spellSlotsByLevel[f]||nt(ee,r(t).classFeatures.spellSlotsByLevel[f]=Array(2).fill(!1),r(t));const Y=t().classFeatures.spellSlotsByLevel[f].findIndex(M=>!M);return Y===-1?!1:(ee.update(M=>(M.classFeatures.spellSlotsByLevel||(M.classFeatures.spellSlotsByLevel={}),M.classFeatures.spellSlotsByLevel[f]||(M.classFeatures.spellSlotsByLevel[f]=Array(2).fill(!1)),M.classFeatures.spellSlotsByLevel[f][Y]=!0,M)),!0)}function pe(f,C){let Y=f.damage,M=0,Z=0;if(Zs(C)&&(Z+=Ns(t(),v())),t().activeStates)for(const j of t().activeStates)Z+=j.damageBonus;if(C.higherLevelSlot&&f.castAtLevel){const j=C.level,Ge=(f.castAtLevel||j)-j;if(Ge>0){const re=C.higherLevelSlot.match(/(\d+)d(\d+)\s+for\s+each.*?level\s+above/i);if(re){const[,R]=re;M+=Ge*parseInt(R)}}}if(f.targetIsFiendOrUndead&&C.description.includes("Fiend or an Undead")){const j=C.description.match(/increases by (\d+)d(\d+) if.*?Fiend or.*?Undead/i);if(j){const[,d]=j;M+=parseInt(d)}}const We=Y.match(/(\d+)d(\d+)([+-]\d+)?/);if(!We)return Z!==0?Z>=0?`${Z}`:`${Z}`:Y||"0";const[,oe,ye,ze]=We,Ee=parseInt(oe)+M,A=(ze?parseInt(ze):0)+Z;let E=`${Ee}d${ye}`;return A!==0&&(E+=A>=0?`+${A}`:`${A}`),E}function xe(f){const C=[];for(let M=f.level;M<=9;M++){const Z=t().classFeatures.spellSlotsByLevel?.[M];Z&&Z.length>0&&C.push(M)}return C}function fe(){ee.update(f=>(f.activeStates||(f.activeStates=[]),f.activeStates=[...f.activeStates,{name:"",attackBonus:0,damageBonus:0,description:""}],f))}function Ue(f){ee.update(C=>(C.activeStates&&(C.activeStates=C.activeStates.filter((Y,M)=>M!==f)),C))}function S(f){const C=X(f.spellRef);if(!C){At.add("Spell not found","error");return}const Y=f.castAtLevel||C.level;if(Y>0&&!z(Y)){At.add(`No level ${Y} spell slots available!`,"error");return}const M=el(C);if(!M){At.add(`${C.name} cast! Check spell description for effects.`,"info");return}ee.update(Z=>(Z.activeStates||(Z.activeStates=[]),Z.activeStates=Z.activeStates.filter(We=>We.name!==C.name),Z.activeStates=[...Z.activeStates,{name:C.name,attackBonus:M.attackBonus,damageBonus:M.damageBonus,description:M.description}],Z)),At.add(`${C.name} cast! Effect added to Active Spell Effects.`,"success")}tt(()=>(t(),e(N)),()=>{if(t()&&t().attacks)for(const f of t().attacks)f.spellRef&&e(N)[f.id]===void 0&&ja(N,e(N)[f.id]=!0)}),tt(()=>(t(),p()),()=>{c(H,t().attacks.filter(f=>{if(!p())return!0;const C=p().toLowerCase();return f.name.toLowerCase().includes(C)||f.damageType.toLowerCase().includes(C)}).sort((f,C)=>!f.spellRef&&C.spellRef?-1:f.spellRef&&!C.spellRef?1:0))}),tt(()=>(p(),e(H)),()=>{c(ve,!p()||e(H).length>0||"attack".includes(p().toLowerCase())||"spell".includes(p().toLowerCase()))}),Gt(),Mt();var ne=Bl();let ce;var he=i(ne),g=a(i(he),2),O=i(g,!0);l(g),l(he);var _e=a(he,2);{var Re=f=>{var C=Ml(),Y=qe(C),M=a(Y,2),Z=i(M);pt(Z,1,()=>e(H),j=>j.id,(j,d,Ge)=>{var re=Cl(),R=i(re),V=i(R);Le(V);var w=a(V,2);{var Se=U=>{var W=tl();D("click",W,()=>ue(e(d).id)),o(U,W)};_(w,U=>{x()&&U(Se)})}l(R);var Ae=a(R,2),Pe=i(Ae);{var Xe=U=>{var W=al(),se=a(i(W),2);Le(se),l(W),Me(se,()=>e(d).bonus,He=>(e(d).bonus=He,St(()=>(e(H),t(),p())))),o(U,W)};_(Pe,U=>{e(d),r(()=>e(d).bonus!==0&&e(d).bonus!==void 0)&&U(Xe)})}var Ve=a(Pe,2);{var Te=U=>{var W=sl(),se=a(i(W),2);Le(se),l(W),Me(se,()=>e(d).damage,He=>(e(d).damage=He,St(()=>(e(H),t(),p())))),o(U,W)};_(Ve,U=>{e(d),r(()=>e(d).damage&&e(d).damage.trim()!=="")&&U(Te)})}var ae=a(Ve,2),we=a(i(ae),2);Le(we),l(ae),l(Ae);var Oe=a(Ae,2);{var Ke=U=>{var W=ot(),se=qe(W);{var He=Qe=>{var P=ll();o(Qe,P)},ke=Qe=>{const P=rt(()=>(e(d),r(()=>X(e(d).spellRef))));var at=ot(),vt=qe(at);{var $=m=>{var T=hl(),J=qe(T);{var Ne=lt=>{var mt=il(),kt=a(i(mt),2),Ot=i(kt,!0);l(kt),l(mt),F(()=>y(Ot,(e(d),r(()=>e(d).generalNotes)))),o(lt,mt)};_(J,lt=>{e(d),r(()=>e(d).generalNotes)&&lt(Ne)})}var Ie=a(J,2),Ye=i(Ie),Be=a(i(Ye),2),bt=i(Be,!0);l(Be),l(Ye);var ut=a(Ye,2);{var Rt=lt=>{var mt=nl(),kt=i(mt),Ot=a(i(kt));l(kt);var Kt=a(kt,2),ea=a(i(Kt));l(Kt);var jt=a(Kt,2),dt=a(i(jt));l(jt);var Lt=a(jt,2),Et=a(i(Lt)),Qt=a(Et);{var Jt=et=>{var ct=$t();F(()=>y(ct,`(${G(e(P)),r(()=>e(P).material)??""})`)),o(et,ct)};_(Qt,et=>{G(e(P)),r(()=>e(P).material)&&et(Jt)})}l(Lt);var ta=a(Lt,2),ca=a(i(ta),2);{var va=et=>{var ct=$t("Concentration,");o(et,ct)};_(ca,et=>{G(e(P)),r(()=>e(P).concentration)&&et(va)})}var ya=a(ca,1,!0);l(ta);var aa=a(ta,2),ka=a(i(aa));l(aa);var ht=a(aa,2);{var yt=et=>{var ct=rl(),Pt=a(i(ct));l(ct),F(()=>y(Pt,` ${G(e(P)),r(()=>e(P).higherLevelSlot)??""}`)),o(et,ct)};_(ht,et=>{G(e(P)),r(()=>e(P).higherLevelSlot)&&et(yt)})}l(mt),F(et=>{y(Ot,` ${G(e(P)),r(()=>e(P).level)??""}`),y(ea,` ${G(e(P)),r(()=>e(P).castingTime||e(P).actionType)??""}`),y(dt,` ${G(e(P)),r(()=>e(P).range)??""}`),y(Et,` ${et??""}`),y(ya,(G(e(P)),r(()=>e(P).duration))),y(ka,` ${G(e(P)),r(()=>e(P).description)??""}`)},[()=>(G(e(P)),r(()=>e(P).components.join(", ")))]),o(lt,mt)};_(ut,lt=>{e(N),e(d),r(()=>!e(N)[e(d).id])&&lt(Rt)})}l(Ie);var gt=a(Ie,2);{var wt=lt=>{const mt=rt(()=>(G(e(P)),r(()=>xe(e(P)))));var kt=ot(),Ot=qe(kt);{var Kt=jt=>{const dt=rt(()=>(G(fa),G(e(P)),r(()=>fa(e(P)))));var Lt=gl(),Et=qe(Lt),Qt=i(Et),Jt=a(Qt,2);F(()=>{e(d),St(()=>{e(mt)})}),pt(Jt,5,()=>e(mt),ft,(ht,yt)=>{var et=ol(),ct=i(et);l(et);var Pt={};F(()=>{y(ct,`Level ${e(yt)??""}`),Pt!==(Pt=e(yt))&&(et.value=(et.__value=e(yt))??"")}),o(ht,et)}),l(Jt);var ta=a(Jt,2);{var ca=ht=>{const yt=rt(()=>(e(d),G(e(P)),r(()=>pe(e(d),e(P)))));var et=cl(),ct=i(et);{var Pt=Ht=>{var Ut=$t("Healing");o(Ht,Ut)},Xt=Ht=>{var Ut=$t("Damage");o(Ht,Ut)};_(ct,Ht=>{G(e(P)),r(()=>de(e(P)))?Ht(Pt):Ht(Xt,!1)})}var Nt=a(ct);l(et),F(()=>y(Nt,` ${e(yt)??""}`)),o(ht,et)};_(ta,ht=>{e(d),G(e(P)),r(()=>e(d).castAtLevel&&e(d).castAtLevel>e(P).level)&&ht(ca)})}l(Et);var va=a(Et,2);{var ya=ht=>{var yt=dl(),et=i(yt),ct=i(et);Le(ct);var Pt=a(ct,2);{var Xt=Nt=>{const Ht=rt(()=>(e(d),G(e(P)),r(()=>pe(e(d),e(P)))));var Ut=vl(),xa=i(Ut);l(Ut),F(()=>y(xa,`(+1d8, total: ${e(Ht)??""})`)),o(Nt,Ut)};_(Pt,Nt=>{e(d),r(()=>e(d).targetIsFiendOrUndead)&&Nt(Xt)})}l(et),l(yt),ma(ct,()=>e(d).targetIsFiendOrUndead,Nt=>(e(d).targetIsFiendOrUndead=Nt,St(()=>(e(H),t(),p())))),o(ht,yt)};_(va,ht=>{G(e(P)),r(()=>e(P).description.includes("Fiend or an Undead"))&&ht(ya)})}var aa=a(va,2);{var ka=ht=>{var yt=bl(),et=i(yt),ct=i(et);Le(ct);var Pt=a(ct),Xt=a(Pt);{var Nt=xt=>{var qt=ul(),Sa=i(qt);l(qt),F($a=>y(Sa,`(Spell Save DC: ${$a??""})`),[()=>(G(Ba),t(),v(),r(()=>Ba(t(),v())))]),o(xt,qt)};_(Xt,xt=>{t(),r(()=>t().class)&&xt(Nt)})}var Ht=a(Xt,2);{var Ut=xt=>{var qt=pl();o(xt,qt)},xa=xt=>{var qt=ot(),Sa=qe(qt);{var $a=Ca=>{var as=fl();o(Ca,as)};_(Sa,Ca=>{e(d),G(e(dt)),r(()=>e(d).targetSucceededSave&&e(dt).noDamageOnSave)&&Ca($a)},!0)}o(xt,qt)};_(Ht,xt=>{e(d),G(e(dt)),r(()=>e(d).targetSucceededSave&&e(dt).halfDamageOnSave)?xt(Ut):xt(xa,!1)})}l(et),l(yt),F(xt=>y(Pt,` Target succeeded on ${xt??""} save `),[()=>(G(e(dt)),r(()=>e(dt).ability.charAt(0).toUpperCase()+e(dt).ability.slice(1)))]),ma(ct,()=>e(d).targetSucceededSave,xt=>(e(d).targetSucceededSave=xt,St(()=>(e(H),t(),p())))),o(ht,yt)};_(aa,ht=>{e(dt)&&ht(ka)})}F(()=>{st(Qt,"for",`castLevel-${e(d),r(()=>e(d).id)??""}`),st(Jt,"id",`castLevel-${e(d),r(()=>e(d).id)??""}`)}),Za(Jt,()=>e(d).castAtLevel,ht=>(e(d).castAtLevel=ht,St(()=>(e(H),t(),p())))),o(jt,Lt)},ea=jt=>{var dt=ml();o(jt,dt)};_(Ot,jt=>{G(e(mt)),r(()=>e(mt).length>0)?jt(Kt):jt(ea,!1)})}o(lt,kt)};_(gt,lt=>{G(e(P)),r(()=>e(P).higherLevelSlot&&e(P).level>0)&&lt(wt)})}F(()=>{st(Be,"aria-label",(e(N),e(d),r(()=>e(N)[e(d).id]?"Expand":"Collapse"))),y(bt,(e(N),e(d),r(()=>e(N)[e(d).id]?"â–¼":"â–²")))}),D("click",Ye,()=>Ce(e(d).id)),D("keydown",Ye,lt=>lt.key==="Enter"&&Ce(e(d).id)),o(m,T)},Fe=m=>{var T=_l();o(m,T)};_(vt,m=>{e(P)?m($):m(Fe,!1)})}o(Qe,at)};_(se,Qe=>{e(je),r(()=>e(je).length===0)?Qe(He):Qe(ke,!1)})}o(U,W)};_(Oe,U=>{e(d),r(()=>e(d).spellRef)&&U(Ke)})}var K=a(Oe,2);{var $e=U=>{var W=yl(),se=a(i(W),2);la(se),l(W),Me(se,()=>e(d).notes,He=>(e(d).notes=He,St(()=>(e(H),t(),p())))),o(U,W)};_(K,U=>{e(d),r(()=>!e(d).spellRef)&&U($e)})}var Je=a(K,2),b=i(Je);{var L=U=>{var W=kl();D("click",W,()=>ge(e(d))),o(U,W)};_(b,U=>{e(d),r(()=>e(d).bonus!==0||!e(d).spellRef)&&U(L)})}var le=a(b,2);{var te=U=>{const W=rt(()=>(e(d),r(()=>X(e(d).spellRef))));var se=ot(),He=qe(se);{var ke=P=>{var at=xl();D("click",at,()=>S(e(d))),o(P,at)},Qe=P=>{var at=Sl(),vt=i(at);{var $=m=>{var T=$t("Roll Healing");o(m,T)},Fe=m=>{var T=$t("Roll Damage");o(m,T)};_(vt,m=>{G(e(W)),r(()=>e(W)&&de(e(W)))?m($):m(Fe,!1)})}l(at),D("click",at,()=>ie(e(d))),o(P,at)};_(He,P=>{G(e(W)),G(qa),r(()=>e(W)&&qa(e(W)))?P(ke):P(Qe,!1)})}o(U,se)},be=U=>{var W=$l();D("click",W,()=>ie(e(d))),o(U,W)};_(le,U=>{e(d),e(me),r(()=>e(d).spellRef&&e(me))?U(te):U(be,!1)})}l(Je),l(re),Me(V,()=>e(d).name,U=>(e(d).name=U,St(()=>(e(H),t(),p())))),Me(we,()=>e(d).damageType,U=>(e(d).damageType=U,St(()=>(e(H),t(),p())))),o(j,re)});var We=a(Z,2);{var oe=j=>{var d=wl();o(j,d)},ye=j=>{var d=ot(),Ge=qe(d);{var re=R=>{var V=Ll();o(R,V)};_(Ge,R=>{e(H),r(()=>e(H).length===0)&&R(re)},!0)}o(j,d)};_(We,j=>{t(),r(()=>t().attacks.length===0)?j(oe):j(ye,!1)})}l(M);var ze=a(M,2),Ee=a(i(ze),4),it=a(Ee,2);{var A=j=>{var d=Al();pt(d,5,()=>(t(),r(()=>t().activeStates)),ft,(Ge,re,R)=>{var V=jl(),w=i(V),Se=i(w);Le(Se);var Ae=a(Se,2);{var Pe=K=>{var $e=Dl();D("click",$e,()=>Ue(R)),o(K,$e)};_(Ae,K=>{x()&&K(Pe)})}l(w);var Xe=a(w,2),Ve=i(Xe),Te=a(i(Ve),2);Le(Te),l(Ve);var ae=a(Ve,2),we=a(i(ae),2);Le(we),l(ae),l(Xe);var Oe=a(Xe,2),Ke=a(i(Oe),2);Le(Ke),l(Oe),l(V),Me(Se,()=>e(re).name,K=>(e(re).name=K,St(()=>t()),da(I,"$character"))),Me(Te,()=>e(re).attackBonus,K=>(e(re).attackBonus=K,St(()=>t()),da(I,"$character"))),Me(we,()=>e(re).damageBonus,K=>(e(re).damageBonus=K,St(()=>t()),da(I,"$character"))),Me(Ke,()=>e(re).description,K=>(e(re).description=K,St(()=>t()),da(I,"$character"))),o(Ge,V)}),l(d),o(j,d)},E=j=>{var d=Fl();o(j,d)};_(it,j=>{t(),r(()=>t().activeStates&&t().activeStates.length>0)?j(A):j(E,!1)})}l(ze),D("click",Y,De),D("click",Ee,fe),o(f,C)};_(_e,f=>{h(),r(()=>!h().attacks)&&f(Re)})}l(ne),F(()=>{ce=_t(ne,1,"attacks svelte-14o91c5",null,ce,{hidden:!e(ve)}),st(g,"aria-label",(h(),r(()=>h().attacks?"Expand":"Collapse"))),y(O,(h(),r(()=>h().attacks?"â–¼":"â–²")))}),D("click",g,q),o(s,ne),It(),k()}var Rl=u('<span class="slot-checkbox-x svelte-serp1j">&#8212;</span>'),El=u('<label><input type="checkbox" class="slot-checkbox-input svelte-serp1j"/> <span><!></span></label>');function Wa(s,n){Bt(n,!1);const t=()=>Ze(ia,"$isEditMode",v),[v,p]=Tt();let h=Dt(n,"checked",8,!1),x=Dt(n,"disabled",8,!1),I=Dt(n,"className",8,""),k=Dt(n,"index",8,void 0),H=Dt(n,"ariaLabel",8,void 0);const ve=Vt();function Q(ge){ve("change",{checked:ge.currentTarget.checked,index:k()})}Mt();var N=El(),Ce=i(N);Le(Ce);var de=a(Ce,2),De=i(de);{var ue=ge=>{var ie=Rl();o(ge,ie)};_(De,ge=>{h()&&ge(ue)})}l(de),l(N),F(()=>{_t(N,1,"slot-checkbox-label "+I()+(t()?"":" not-editable"),"svelte-serp1j"),Ss(Ce,h()),Ce.disabled=x()||!t(),st(Ce,"aria-label",H()),st(Ce,"tabindex",t()?0:-1),_t(de,1,`slot-checkbox-custom ${h()?"used":""} ${t()?"":"readonly"}`,"svelte-serp1j")}),D("change",Ce,Q),o(s,N),It(),p()}var Pl=u('<p class="no-features svelte-1kpvv0n">Select a class to see available features</p>'),Tl=u('<p class="no-features svelte-1kpvv0n">No class features available at this level</p>'),Hl=u('<div class="spell-slots svelte-1kpvv0n"><label class="svelte-1kpvv0n"> </label> <div class="slots-tracker svelte-1kpvv0n"></div></div>'),Nl=u('<div class="all-spell-slots"></div>'),Ul=u('<div class="feature-box spellcasting svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"> </h3> <div class="spell-stats svelte-1kpvv0n"><div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Spell Save DC</label> <div class="spell-value svelte-1kpvv0n"> </div></div> <div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <div class="spell-value svelte-1kpvv0n"> </div></div></div> <!> <div class="prepared-spells svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <textarea placeholder="List your prepared spells..." class="svelte-1kpvv0n"></textarea></div></div>'),Gl=u('<p class="unlimited svelte-1kpvv0n">Unlimited Uses</p>'),Ol=u('<div class="slots-tracker svelte-1kpvv0n"></div> <div class="uses-actions-row"><button class="btn btn-primary use-enabled"> </button></div> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div>',1),ql=u('<div class="uses-tracker svelte-1kpvv0n"><!></div>'),Wl=u('<div class="pool-tracker svelte-1kpvv0n"><input type="number" min="0" class="pool-input svelte-1kpvv0n"/> <span> </span> <button class="btn-small svelte-1kpvv0n"> </button></div>'),zl=u('<p class="no-uses svelte-1kpvv0n">No Channel Divinity uses remaining</p>'),Kl=u('<div class="channel-divinity-option svelte-1kpvv0n"><button class="btn btn-primary use-enabled svelte-1kpvv0n">Use Channel Divinity</button> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div> <!></div>'),Jl=u('<div class="feature-box svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"><!> </h3> <p class="feature-description svelte-1kpvv0n"> </p> <!></div>'),Vl=u('<div class="features-grid svelte-1kpvv0n"><!> <!></div>'),Ql=u('<section><div class="header svelte-1kpvv0n"><h2 class="svelte-1kpvv0n">Class Features</h2> <button class="collapse-btn svelte-1kpvv0n"> </button></div> <!></section>');function Xl(s,n){Bt(n,!1);const t=()=>Ze(ee,"$character",x),v=()=>Ze(oa,"$abilityModifiers",x),p=()=>Ze(zt,"$searchFilter",x),h=()=>Ze(Ct,"$collapsedStates",x),[x,I]=Tt(),k=B(),H=B(),ve=B(),Q=B(),N=B(),Ce=B(),de=B();let De=B(0),ue=B(0);function ge(g,O){ee.update(_e=>(_e.classFeatures.features[g]=O,_e))}function ie(){ee.update(g=>(g.classFeatures.spellSlotsByLevel||(g.classFeatures.spellSlotsByLevel={}),e(Q).forEach(({level:O,slots:_e})=>{g.classFeatures.spellSlotsByLevel[O]||(g.classFeatures.spellSlotsByLevel[O]=Array(_e).fill(!1))}),g))}function q(g){if(typeof g.maxUses=="function"){if((g.name==="Divine Sense"||g.name==="War Priest")&&e(k)?.spellcastingAbility){const O=v()[e(k).spellcastingAbility];return g.maxUses(t().level,O)}return g.maxUses(t().level)}return g.maxUses||0}function je(g,O){ee.update(_e=>((!_e.classFeatures.features[g]||!Array.isArray(_e.classFeatures.features[g])||_e.classFeatures.features[g].length!==O)&&(_e.classFeatures.features[g]=Array(O).fill(!1)),_e))}ss(()=>{e(Ce)&&t()&&t().classFeatures&&t().classFeatures.features&&e(Ce).forEach(g=>{if(g.type==="uses"){const O=g.name.replace(/\s+/g,""),_e=q(g),Re=t().classFeatures.features[O];(!Array.isArray(Re)||Re.length!==_e)&&je(O,_e)}})});function me(g){return typeof g.maxPool=="function"?g.maxPool(t().level):g.maxPool||0}function X(g){return typeof g.description=="function"?g.description(t().level):g.description}function z(){const g="ChannelDivinity";ee.update(O=>{const _e=O.classFeatures.features[g];return typeof _e=="number"&&_e>0&&(O.classFeatures.features[g]=_e-1),O})}function pe(){Ct.update(g=>({...g,classFeatures:!g.classFeatures}))}tt(()=>(t(),Ft),()=>{c(k,t().class?Ft(t().class):null)}),tt(()=>(t(),Zt),()=>{c(H,t().class?Zt(t().class,t().level,t().subclass):[])}),tt(()=>(t(),Ua),()=>{c(ve,t().class?Ua(t().class,t().level):0)}),tt(()=>(e(k),t()),()=>{c(Q,(()=>{if(!e(k)?.spellcaster)return[];const g=t().level,O=[];return g>=1&&O.push({level:1,slots:Math.min(4,2+Math.floor(g/3))}),g>=3&&O.push({level:2,slots:Math.min(3,2+Math.floor((g-3)/4))}),g>=5&&O.push({level:3,slots:Math.min(3,2+Math.floor((g-5)/5))}),g>=7&&O.push({level:4,slots:Math.min(3,1+Math.floor((g-7)/6))}),g>=9&&O.push({level:5,slots:Math.min(2,1+Math.floor((g-9)/8))}),g>=11&&O.push({level:6,slots:1}),g>=13&&O.push({level:7,slots:1}),g>=15&&O.push({level:8,slots:1}),g>=17&&O.push({level:9,slots:1}),O})())}),tt(()=>(e(k),v(),t(),Ga),()=>{if(e(k)?.spellcaster&&e(k).spellcastingAbility){const g=v()[e(k).spellcastingAbility];c(De,Ls(t().class,g,t().proficiencyBonus)||0),c(ue,Ga(t().class,t().level,g))}}),tt(()=>(t(),e(k),e(Q)),()=>{t().class&&e(k)?.spellcaster&&e(Q).length>0&&ie()}),tt(()=>t(),()=>{c(N,(()=>{const O=t().classFeatures.features["ChannelDivinity"];return typeof O=="number"?O:0})())}),tt(()=>(e(H),p()),()=>{c(Ce,e(H).filter(g=>{if(!p())return!0;const O=p().toLowerCase();return g.name.toLowerCase().includes(O)||X(g).toLowerCase().includes(O)}))}),tt(()=>(p(),t(),e(Ce)),()=>{c(de,!p()||t().class||"class features".includes(p().toLowerCase())||"spellcasting".includes(p().toLowerCase())||e(Ce).length>0)}),Gt(),Mt();var xe=Ql();let fe;var Ue=i(xe),S=a(i(Ue),2),ne=i(S,!0);l(S),l(Ue);var ce=a(Ue,2);{var he=g=>{var O=ot(),_e=qe(O);{var Re=C=>{var Y=Pl();o(C,Y)},f=C=>{var Y=ot(),M=qe(Y);{var Z=oe=>{var ye=Tl();o(oe,ye)},We=oe=>{var ye=Vl(),ze=i(ye);{var Ee=A=>{var E=Ul(),j=i(E),d=i(j);l(j);var Ge=a(j,2),re=i(Ge),R=a(i(re),2),V=i(R,!0);l(R),l(re);var w=a(re,2),Se=a(i(w),2),Ae=i(Se,!0);l(Se),l(w),l(Ge);var Pe=a(Ge,2);{var Xe=ae=>{var we=Nl();pt(we,5,()=>e(Q),ft,(Oe,Ke)=>{let K=()=>e(Ke).level,$e=()=>e(Ke).slots;const Je=rt(()=>(t(),K(),$e(),r(()=>t().classFeatures.spellSlotsByLevel?.[K()]||Array($e()).fill(!1))));var b=Hl(),L=i(b),le=i(L);l(L);var te=a(L,2);pt(te,5,()=>e(Je),ft,(be,U,W)=>{{let se=rt(()=>(G(e(Je)),r(()=>e(Je)[W]||!1)));Wa(be,{get checked(){return e(se)},$$events:{change:He=>{ee.update(ke=>(ke.classFeatures.spellSlotsByLevel||(ke.classFeatures.spellSlotsByLevel={}),ke.classFeatures.spellSlotsByLevel[K()]||(ke.classFeatures.spellSlotsByLevel[K()]=Array($e()).fill(!1)),ke.classFeatures.spellSlotsByLevel[K()][W]=He.detail.checked,ke))}}})}}),l(te),l(b),F(()=>y(le,`${K()===1?"1st":K()===2?"2nd":K()===3?"3rd":`${K()}th`} Level Spell Slots`)),o(Oe,b)}),l(we),o(ae,we)};_(Pe,ae=>{e(Q),r(()=>e(Q).length>0)&&ae(Xe)})}var Ve=a(Pe,2),Te=a(i(Ve),2);la(Te),l(Ve),l(E),F(ae=>{y(d,`Spellcasting (${ae??""})`),y(V,e(De)),y(Ae,e(ue))},[()=>(e(k),r(()=>e(k).spellcastingAbility?.toUpperCase()))]),Me(Te,()=>t().classFeatures.preparedSpells,ae=>nt(ee,r(t).classFeatures.preparedSpells=ae,r(t))),o(A,E)};_(ze,A=>{e(k),r(()=>e(k)?.spellcaster)&&A(Ee)})}var it=a(ze,2);pt(it,1,()=>e(Ce),ft,(A,E)=>{const j=rt(()=>(e(E),r(()=>e(E).name.replace(/\s+/g,"")))),d=rt(()=>(t(),G(e(j)),r(()=>t().classFeatures.features[e(j)]))),Ge=rt(()=>typeof e(d)=="number");var re=Jl(),R=i(re),V=i(R);{var w=ae=>{var we=$t("Channel Divinity:");o(ae,we)};_(V,ae=>{e(E),r(()=>e(E).type==="channelDivinity")&&ae(w)})}var Se=a(V);l(R);var Ae=a(R,2),Pe=i(Ae,!0);l(Ae);var Xe=a(Ae,2);{var Ve=ae=>{const we=rt(()=>(e(E),r(()=>q(e(E))))),Oe=rt(()=>(G(e(d)),G(e(we)),r(()=>Array.isArray(e(d))?e(d):Array(e(we)).fill(!1))));var Ke=ql(),K=i(Ke);{var $e=b=>{var L=Gl();o(b,L)},Je=b=>{var L=Ol(),le=qe(L);pt(le,5,()=>e(Oe),ft,(ke,Qe,P)=>{Wa(ke,{get checked(){return e(Qe)},index:P,$$events:{change:at=>{ee.update(vt=>(vt.classFeatures.features[e(j)]||(vt.classFeatures.features[e(j)]=Array(e(we)).fill(!1)),vt.classFeatures.features[e(j)][P]=at.detail.checked,vt))}}})}),l(le);var te=a(le,2),be=i(te),U=i(be);l(be),l(te);var W=a(te,2),se=i(W),He=i(se);l(se),l(W),F(ke=>{be.disabled=ke,y(U,`Use ${e(E),r(()=>e(E).name)??""}`),y(He,`Resets on ${e(E),r(()=>e(E).resetOn==="short"?"Short Rest":"Long Rest")??""}`)},[()=>(G(e(Oe)),r(()=>e(Oe).filter(ke=>!ke).length<=0))]),D("click",be,()=>{ee.update(ke=>{ke.classFeatures.features[e(j)]||(ke.classFeatures.features[e(j)]=Array(e(we)).fill(!1));const Qe=ke.classFeatures.features[e(j)],P=Qe.findIndex(at=>!at);return P!==-1&&(Qe[P]=!0),ke})}),o(b,L)};_(K,b=>{e(we)===1/0?b($e):b(Je,!1)})}l(Ke),o(ae,Ke)},Te=ae=>{var we=ot(),Oe=qe(we);{var Ke=$e=>{const Je=rt(()=>(e(E),r(()=>me(e(E)))));var b=Wl(),L=i(b);Le(L);var le=a(L,2),te=i(le);l(le);var be=a(le,2),U=i(be,!0);l(be),l(b),F(()=>{Ra(L,e(Ge)&&e(d)!==void 0?e(d):e(Je)),st(L,"max",e(Je)),y(te,`/ ${e(Je)??""}`),y(U,(e(E),r(()=>e(E).resetOn==="short"?"Short Rest":"Long Rest")))}),D("input",L,W=>{ee.update(se=>(se.classFeatures.features[e(j)]=parseInt(W.currentTarget.value)||0,se))}),D("click",be,()=>ge(e(j),e(Je))),o($e,b)},K=$e=>{var Je=ot(),b=qe(Je);{var L=le=>{var te=Kl(),be=i(te),U=a(be,2),W=i(U),se=i(W);l(W),l(U);var He=a(U,2);{var ke=Qe=>{var P=zl();o(Qe,P)};_(He,Qe=>{e(N)<=0&&Qe(ke)})}l(te),F(()=>{be.disabled=e(N)<=0,y(se,`Resets on ${e(E),r(()=>e(E).resetOn==="short"?"Short Rest":"Long Rest")??""}`)}),D("click",be,z),o(le,te)};_(b,le=>{e(E),r(()=>e(E).type==="channelDivinity")&&le(L)},!0)}o($e,Je)};_(Oe,$e=>{e(E),r(()=>e(E).type==="pool")?$e(Ke):$e(K,!1)},!0)}o(ae,we)};_(Xe,ae=>{e(E),r(()=>e(E).type==="uses")?ae(Ve):ae(Te,!1)})}l(re),F(ae=>{y(Se,` ${e(E),r(()=>e(E).name)??""}`),y(Pe,ae)},[()=>(e(E),r(()=>X(e(E))))]),o(A,re)}),l(ye),o(oe,ye)};_(M,oe=>{e(H),r(()=>e(H).length===0)?oe(Z):oe(We,!1)},!0)}o(C,Y)};_(_e,C=>{t(),r(()=>!t().class)?C(Re):C(f,!1)})}o(g,O)};_(ce,g=>{h(),r(()=>!h().classFeatures)&&g(he)})}l(xe),F(()=>{fe=_t(xe,1,"class-features svelte-1kpvv0n",null,fe,{hidden:!e(de)}),st(S,"aria-label",(h(),r(()=>h().classFeatures?"Expand":"Collapse"))),y(ne,(h(),r(()=>h().classFeatures?"â–¼":"â–²")))}),D("click",S,pe),o(s,xe),It(),I()}var Yl=u('<textarea placeholder="Enter features, traits, and special abilities..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Equipment</h3> <textarea placeholder="List your equipment and inventory..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Notes</h3> <textarea placeholder="Additional notes..." class="svelte-wttn0l"></textarea>',1),Zl=u('<section><div class="header svelte-wttn0l"><h2 class="svelte-wttn0l">Features & Traits</h2> <button class="collapse-btn svelte-wttn0l"> </button></div> <!></section>');function ei(s,n){Bt(n,!1);const t=()=>Ze(zt,"$searchFilter",h),v=()=>Ze(ee,"$character",h),p=()=>Ze(Ct,"$collapsedStates",h),[h,x]=Tt(),I=B();function k(){Ct.update(ue=>({...ue,notes:!ue.notes}))}tt(()=>(t(),v()),()=>{c(I,!t()||"features".includes(t().toLowerCase())||"traits".includes(t().toLowerCase())||"equipment".includes(t().toLowerCase())||"notes".includes(t().toLowerCase())||v().features.toLowerCase().includes(t().toLowerCase())||v().equipment.toLowerCase().includes(t().toLowerCase())||v().notes.toLowerCase().includes(t().toLowerCase()))}),Gt(),Mt();var H=Zl();let ve;var Q=i(H),N=a(i(Q),2),Ce=i(N,!0);l(N),l(Q);var de=a(Q,2);{var De=ue=>{var ge=Yl(),ie=qe(ge);la(ie);var q=a(ie,4);la(q);var je=a(q,4);la(je),Me(ie,()=>v().features,me=>nt(ee,r(v).features=me,r(v))),Me(q,()=>v().equipment,me=>nt(ee,r(v).equipment=me,r(v))),Me(je,()=>v().notes,me=>nt(ee,r(v).notes=me,r(v))),o(ue,ge)};_(de,ue=>{p(),r(()=>!p().notes)&&ue(De)})}l(H),F(()=>{ve=_t(H,1,"notes svelte-wttn0l",null,ve,{hidden:!e(I)}),st(N,"aria-label",(p(),r(()=>p().notes?"Expand":"Collapse"))),y(Ce,(p(),r(()=>p().notes?"â–¼":"â–²")))}),D("click",N,k),o(s,H),It(),x()}var ti=u('<div class="color-picker-section svelte-1r90jgp"><h3 class="svelte-1r90jgp">Dice Colors</h3> <div class="color-inputs svelte-1r90jgp"><div class="color-input-group svelte-1r90jgp"><label for="dice-color" class="svelte-1r90jgp">Dice Color</label> <input type="color" id="dice-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="label-color" class="svelte-1r90jgp">Label Color</label> <input type="color" id="label-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="desk-color" class="svelte-1r90jgp">Background Color</label> <input type="color" id="desk-color" class="svelte-1r90jgp"/></div></div></div>'),ai=u('<div class="loading svelte-1r90jgp"><p class="svelte-1r90jgp">Loading 3D dice...</p></div>'),si=u('<div class="custom-dice-selector svelte-1r90jgp"><h3 class="svelte-1r90jgp">Choose Dice to Roll</h3> <div class="dice-inputs svelte-1r90jgp"><div class="dice-input-group svelte-1r90jgp"><label for="d4" class="svelte-1r90jgp">d4</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d4" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d6" class="svelte-1r90jgp">d6</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d6" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d8" class="svelte-1r90jgp">d8</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d8" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d10" class="svelte-1r90jgp">d10</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d10" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d12" class="svelte-1r90jgp">d12</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d12" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d20" class="svelte-1r90jgp">d20</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d20" min="0" max="10"/></div></div> <div class="dice-controls svelte-1r90jgp"><button class="btn btn-primary use-enabled svelte-1r90jgp"> </button> <button class="btn btn-secondary use-enabled svelte-1r90jgp">Reset</button></div></div>'),li=u('<span class="crit-badge svelte-1r90jgp">CRITICAL!</span>'),ii=u('<p class="svelte-1r90jgp"> </p>'),ri=u('<div class="bonus-item svelte-1r90jgp"><span class="bonus-value svelte-1r90jgp"> </span> <span class="bonus-source svelte-1r90jgp"> </span></div>'),ni=u('<div class="bonus-breakdown svelte-1r90jgp"></div>'),oi=u('<p class="modifier-text svelte-1r90jgp"> </p>'),ci=u('<button class="btn btn-follow-up svelte-1r90jgp"> </button>'),vi=u('<button class="btn btn-guided-strike svelte-1r90jgp">âš¡ Use Guided Strike (+10)</button>'),di=u('<div class="follow-up-actions svelte-1r90jgp"><!> <!></div>'),ui=u('<div class="result-header svelte-1r90jgp"><h3 class="svelte-1r90jgp"> </h3> <!></div> <div class="result-total svelte-1r90jgp"> </div> <div class="result-details svelte-1r90jgp"><!> <!></div> <!>',1),pi=u('<div role="button" tabindex="-1"><div class="modal-content svelte-1r90jgp" role="dialog" tabindex="0"><div class="modal-header svelte-1r90jgp"><h2 class="svelte-1r90jgp">Dice Roller</h2> <div class="header-buttons svelte-1r90jgp"><button class="color-btn svelte-1r90jgp" title="Customize dice colors">ðŸŽ¨</button> <button class="close-btn svelte-1r90jgp">Ã—</button></div></div> <!> <!> <div class="dice-main-area svelte-1r90jgp"><div class="dice-container svelte-1r90jgp"></div> <!></div> <div><!></div></div></div>');function fi(s,n){Bt(n,!1);const t=()=>Ze(ee,"$character",v),[v,p]=Tt(),h=B(),x=B(),I=B(),k=Vt();let H=Dt(n,"notation",12,""),ve=Dt(n,"visible",8,!1),Q=Dt(n,"damageNotation",12,""),N=Dt(n,"attackName",12,""),Ce=Dt(n,"applyHalfDamage",8,!1),de=Dt(n,"bonusBreakdown",28,()=>[]),De=null,ue=B(void 0),ge=B(!1),ie=B(""),q=B(null);function je(){return e(q)?.resultTotal??null}let me=B(0),X=B(0),z=B(0),pe=B(0),xe=B(0),fe=B(0),Ue=B(0),S=B([]),ne=B(!1),ce=B("other"),he=B(!1),g=B("#051e0a"),O=B("#ffffff"),_e=B("#3a2004"),Re=B(!1);function f(b){return b.length===9&&b.startsWith("#")?b.substring(0,7):b}function C(b,L="ff"){return b.length===7&&b.startsWith("#")?b+L:b}function Y(){if(window.DICE&&e(ue))try{De&&e(ue)&&ja(ue,e(ue).innerHTML="");const b=e(ue).clientWidth||500,L=e(ue).clientHeight||300;De=new window.DICE.dice_box(e(ue),{w:b,h:L}),c(ge,!0)}catch(b){console.error("Error initializing dice box:",b)}}na(()=>{const b=te=>new Promise((be,U)=>{if(document.querySelector(`script[src="${te}"]`)){console.log(`Script already loaded: ${te}`),be(null);return}const se=document.createElement("script");se.src=te,se.onload=()=>{console.log(`Loaded: ${te}`),be(null)},se.onerror=()=>{console.error(`Failed to load: ${te}`),U(new Error(`Failed to load ${te}`))},document.head.appendChild(se)});setTimeout(()=>{b(`${sa}/libs/three.min.js`).then(()=>b(`${sa}/libs/cannon.min.js`)).then(()=>b(`${sa}/libs/teal.js`)).then(()=>b(`${sa}/dice.js`)).then(()=>{if(console.log("All scripts loaded, initializing dice box..."),console.log("DICE available:",!!window.DICE),console.log("Container available:",!!e(ue)),window.DICE){const te=window.DICE.getColors();c(g,f(te.dice_color)),c(O,f(te.label_color)),c(_e,f(te.desk_color))}Y()}).catch(te=>{console.error("Failed to load dice libraries:",te)})},100);const L=()=>{e(ge)&&(console.log("Window resized, reinitializing dice box..."),Y())},le=te=>{ve()&&te.key==="Escape"&&A()};return window.addEventListener("resize",L),window.addEventListener("keydown",le),()=>{window.removeEventListener("resize",L),window.removeEventListener("keydown",le)}});function M(b,L="other"){if(!De||!e(ge))return;console.log("Rolling dice:",b,"type:",L),c(q,null),c(S,[]),c(ne,!1),L==="damage"&&de([]),c(ce,L),c(he,!1),De.diceToRoll=b;const le=be=>(console.log("Before roll:",be),null),te=be=>{console.log("After roll:",be);let U=be.resultTotal,W=be.resultString;if(Ce()&&(U=Math.floor(U/2),W=W+" (halved)"),c(q,{...be,resultTotal:U,resultString:W}),L==="attack"||L==="check"||L==="save"){const se=be.result?.filter(He=>He===20)||[];if(se.length>0){const He=se[0];c(ne,He===20)}}if(c(S,[]),console.log("Setting up follow-up actions. Type:",L,"damageNotation:",Q(),"isCritical:",e(ne)),L==="attack")if(Q()){if(e(ne)){const se=oe(Q());console.log("Creating critical damage button:",se),e(S).push({label:`Roll Critical Damage (${se})`,notation:se})}else console.log("Creating normal damage button:",Q()),e(S).push({label:`Roll Damage (${Q()})`,notation:Q()});console.log("Follow-up actions after setup:",e(S))}else console.log("No damageNotation provided for attack roll");console.log("Final followUpActions:",e(S))};De.start_throw(le,te)}function Z(){const b=[];e(me)>0&&b.push(`${e(me)}d4`),e(X)>0&&b.push(`${e(X)}d6`),e(z)>0&&b.push(`${e(z)}d8`),e(pe)>0&&b.push(`${e(pe)}d10`),e(xe)>0&&b.push(`${e(xe)}d12`),e(fe)>0&&b.push(`${e(fe)}d20`);let L=b.join("+")||"1d20";return e(Ue)!==0&&(L+=e(Ue)>=0?`+${e(Ue)}`:`${e(Ue)}`),L}function We(){const b=Z();M(b)}function oe(b){return b.replace(/(\d+)d(\d+)/g,(L,le,te)=>`${parseInt(le)*2}d${te}`)}function ye(){c(me,0),c(X,0),c(z,0),c(pe,0),c(xe,0),c(fe,0),c(Ue,0),c(q,null),c(S,[]),c(ne,!1),c(ce,"other"),c(he,!1)}function ze(){window.DICE&&(window.DICE.setColors({dice_color:C(e(g),"ff"),label_color:C(e(O),"ff"),desk_color:e(_e)}),De&&(De.updateDeskColor(e(_e)),De.updateDiceColors()))}function Ee(){c(Re,!e(Re))}function it(){!e(q)||e(x)<=0||e(he)||(c(q,{...e(q),resultTotal:e(q).resultTotal+10,resultString:e(q).resultString+" + 10 (Guided Strike)"}),ee.update(b=>{const L="ChannelDivinity",le=b.classFeatures.features[L];return typeof le=="number"&&le>0&&(b.classFeatures.features[L]=le-1),b}),c(he,!0))}function A(){k("close"),H(""),Q(""),N(""),c(ie,""),c(q,null),c(he,!1),ye()}tt(()=>(t(),Zt),()=>{c(h,t().class?Zt(t().class,t().level,t().subclass).some(L=>L.name==="Guided Strike"):!1)}),tt(()=>t(),()=>{c(x,(()=>{const L=t().classFeatures.features["ChannelDivinity"];return typeof L=="number"?L:0})())}),tt(()=>(e(me),e(X),e(z),e(pe),e(xe),e(fe),e(Ue)),()=>{c(I,(()=>{const b=[];e(me)>0&&b.push(`${e(me)}d4`),e(X)>0&&b.push(`${e(X)}d6`),e(z)>0&&b.push(`${e(z)}d8`),e(pe)>0&&b.push(`${e(pe)}d10`),e(xe)>0&&b.push(`${e(xe)}d12`),e(fe)>0&&b.push(`${e(fe)}d20`);let L=b.join("+")||"1d20";return e(Ue)!==0&&(L+=e(Ue)>=0?`+${e(Ue)}`:`${e(Ue)}`),L})())}),tt(()=>(G(H()),e(ge),G(ve()),e(ie),G(Q()),G(N())),()=>{if(H()&&e(ge)&&ve()&&H()!==e(ie)){c(ie,H()),c(q,null),c(S,[]),c(ne,!1),c(he,!1);const b=H().includes("1d20")?"attack":"other";console.log("Auto-roll triggered. notation:",H(),"damageNotation:",Q(),"attackName:",N()),setTimeout(()=>M(H(),b),200)}}),Gt();var E={getLastRollTotal:je};Mt();var j=pi();let d;var Ge=i(j),re=i(Ge),R=a(i(re),2),V=i(R),w=a(V,2);l(R),l(re);var Se=a(re,2);{var Ae=b=>{var L=ti(),le=a(i(L),2),te=i(le),be=a(i(te),2);Le(be),l(te);var U=a(te,2),W=a(i(U),2);Le(W),l(U);var se=a(U,2),He=a(i(se),2);Le(He),l(se),l(le),l(L),Me(be,()=>e(g),ke=>c(g,ke)),D("change",be,ze),Me(W,()=>e(O),ke=>c(O,ke)),D("change",W,ze),Me(He,()=>e(_e),ke=>c(_e,ke)),D("change",He,ze),o(b,L)};_(Se,b=>{e(Re)&&b(Ae)})}var Pe=a(Se,2);{var Xe=b=>{var L=ai();o(b,L)};_(Pe,b=>{e(ge)||b(Xe)})}var Ve=a(Pe,2),Te=i(Ve);Aa(Te,b=>c(ue,b),()=>e(ue));var ae=a(Te,2);{var we=b=>{var L=si(),le=a(i(L),2),te=i(le),be=a(i(te),2);Le(be),l(te);var U=a(te,2),W=a(i(U),2);Le(W),l(U);var se=a(U,2),He=a(i(se),2);Le(He),l(se);var ke=a(se,2),Qe=a(i(ke),2);Le(Qe),l(ke);var P=a(ke,2),at=a(i(P),2);Le(at),l(P);var vt=a(P,2),$=a(i(vt),2);Le($),l(vt),l(le);var Fe=a(le,2),m=i(Fe),T=i(m);l(m);var J=a(m,2);l(Fe),l(L),F(()=>{m.disabled=!e(ge),y(T,`Roll ${e(I)??""}`)}),Me(be,()=>e(me),Ne=>c(me,Ne)),Me(W,()=>e(X),Ne=>c(X,Ne)),Me(He,()=>e(z),Ne=>c(z,Ne)),Me(Qe,()=>e(pe),Ne=>c(pe,Ne)),Me(at,()=>e(xe),Ne=>c(xe,Ne)),Me($,()=>e(fe),Ne=>c(fe,Ne)),D("click",m,We),D("click",J,ye),o(b,L)};_(ae,b=>{H()||b(we)})}l(Ve);var Oe=a(Ve,2);let Ke;var K=i(Oe);{var $e=b=>{var L=ui(),le=qe(L),te=i(le),be=i(te,!0);l(te);var U=a(te,2);{var W=m=>{var T=li();o(m,T)};_(U,m=>{e(ne)&&m(W)})}l(le);var se=a(le,2),He=i(se,!0);l(se);var ke=a(se,2),Qe=i(ke);{var P=m=>{var T=ii(),J=i(T,!0);l(T),F(()=>y(J,(e(q),r(()=>e(q).resultString)))),o(m,T)};_(Qe,m=>{e(q),r(()=>e(q).resultString)&&m(P)})}var at=a(Qe,2);{var vt=m=>{var T=ot(),J=qe(T);{var Ne=Ye=>{var Be=ni();pt(Be,5,de,ft,(bt,ut)=>{var Rt=ri(),gt=i(Rt),wt=i(gt);l(gt);var lt=a(gt,2),mt=i(lt);l(lt),l(Rt),F(()=>{y(wt,`${e(ut),r(()=>e(ut).value>=0?"+":"")??""}${e(ut),r(()=>e(ut).value)??""}`),y(mt,`(${e(ut),r(()=>e(ut).source)??""})`)}),o(bt,Rt)}),l(Be),o(Ye,Be)},Ie=Ye=>{var Be=ot(),bt=qe(Be);{var ut=Rt=>{var gt=oi(),wt=i(gt);l(gt),F(()=>y(wt,`Modifier: ${e(q),r(()=>e(q).constant>=0?"+":"")??""}${e(q),r(()=>e(q).constant)??""}`)),o(Rt,gt)};_(bt,Rt=>{e(q),r(()=>e(q).constant)&&Rt(ut)},!0)}o(Ye,Be)};_(J,Ye=>{G(de()),r(()=>de().length>0)?Ye(Ne):Ye(Ie,!1)})}o(m,T)};_(at,m=>{e(q),G(de()),r(()=>e(q).constant||de().length>0)&&m(vt)})}l(ke);var $=a(ke,2);{var Fe=m=>{var T=di(),J=i(T);pt(J,1,()=>e(S),ft,(Ye,Be)=>{var bt=ci(),ut=i(bt,!0);l(bt),F(()=>y(ut,(e(Be),r(()=>e(Be).label)))),D("click",bt,()=>M(e(Be).notation,"damage")),o(Ye,bt)});var Ne=a(J,2);{var Ie=Ye=>{var Be=vi();F(()=>{Be.disabled=e(x)<=0,st(Be,"title",e(x)<=0?"No Channel Divinity uses remaining":"Use Channel Divinity to add +10 to this attack roll")}),D("click",Be,it),o(Ye,Be)};_(Ne,Ye=>{e(h)&&e(ce)==="attack"&&!e(he)&&Ye(Ie)})}l(T),o(m,T)};_($,m=>{e(S),e(h),e(ce),e(he),r(()=>e(S).length>0||e(h)&&e(ce)==="attack"&&!e(he))&&m(Fe)})}F(()=>{y(be,N()?`${N()} - Result`:"Result"),y(He,(e(q),r(()=>e(q).resultTotal)))}),o(b,L)};_(K,b=>{e(q)&&b($e)})}l(Oe),l(Ge),l(j),F(()=>{d=_t(j,1,"modal-overlay svelte-1r90jgp",null,d,{hidden:!ve()}),Ke=_t(Oe,1,"roll-result svelte-1r90jgp",null,Ke,{"has-result":e(q)})}),D("click",V,Ee),D("click",w,A),D("click",Ge,Pa(function(b){Yt.call(this,n,b)})),D("keydown",Ge,function(b){Yt.call(this,n,b)}),D("click",j,A),D("keydown",j,b=>b.key==="Escape"&&A()),o(s,j),Cs(n,"getLastRollTotal",je);var Je=It(E);return p(),Je}const _a="https://api.github.com/gists";async function bi(s,n,t){if(!n)throw new Error("GitHub token is required");const v=JSON.stringify(s,null,2),p=`${s.name||"character"}_dnd.json`,h={description:t||`D&D Character: ${s.name}`,public:!1,files:{[p]:{content:v}}},x=await fetch(_a,{method:"POST",headers:{Authorization:`token ${n}`,"Content-Type":"application/json"},body:JSON.stringify(h)});if(!x.ok)throw new Error(`Failed to create gist: ${x.statusText}`);return(await x.json()).id}async function gi(s,n,t){if(!n||!t)throw new Error("GitHub token and Gist ID are required");const v=JSON.stringify(s,null,2),h={files:{[`${s.name||"character"}_dnd.json`]:{content:v}}},x=await fetch(`${_a}/${t}`,{method:"PATCH",headers:{Authorization:`token ${n}`,"Content-Type":"application/json"},body:JSON.stringify(h)});if(!x.ok)throw new Error(`Failed to update gist: ${x.statusText}`)}async function mi(s,n){if(!s)throw new Error("Gist ID is required");const t={"Content-Type":"application/json"};n&&(t.Authorization=`token ${n}`);const v=await fetch(`${_a}/${s}`,{method:"GET",headers:t});if(!v.ok)throw new Error(`Failed to load gist: ${v.statusText}`);const p=await v.json(),h=Object.values(p.files);if(h.length===0)throw new Error("No files found in gist");const I=h[0].content;try{const k=JSON.parse(I);return k.attacks&&Array.isArray(k.attacks)&&(k.attacks=k.attacks.map(H=>({...H,id:H.id||crypto.randomUUID()}))),k.classFeatures?(k.classFeatures.features||(k.classFeatures.features={}),k.classFeatures.spellSlots||(k.classFeatures.spellSlots=[]),k.classFeatures.preparedSpells===void 0&&(k.classFeatures.preparedSpells="")):k.classFeatures={features:{},spellSlots:[],preparedSpells:""},k}catch{throw new Error("Invalid character data in gist")}}function za(s){typeof window<"u"&&localStorage.setItem("dnd_gist_config",JSON.stringify(s))}function hi(){if(typeof window<"u"){const s=localStorage.getItem("dnd_gist_config");if(s)return JSON.parse(s)}return{}}async function _i(s,n=30){if(!s)throw new Error("GitHub token is required to list gists");const t=await fetch(`${_a}?per_page=${n}`,{method:"GET",headers:{Authorization:`token ${s}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error(`Failed to list gists: ${t.statusText}`);return await t.json()}var yi=u('<div class="error-message svelte-1jb5ckg"> </div>'),ki=u('<div class="toggle-container svelte-1jb5ckg"><button type="button" class="toggle-btn svelte-1jb5ckg"> </button></div>'),xi=u('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID (leave empty to create new)</label> <input type="text" id="gistId" placeholder="Optional: existing Gist ID to update" class="svelte-1jb5ckg"/></div>'),Si=u('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),$i=u('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),Ci=u('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Update (or leave unselected to create new)</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),wi=u('<div class="info-message svelte-1jb5ckg">No gists found. A new one will be created.</div>'),Li=u('<!> <div class="form-group svelte-1jb5ckg"><label for="description" class="svelte-1jb5ckg"> </label> <input type="text" id="description" placeholder="D&amp;D Character Sheet" class="svelte-1jb5ckg"/></div>',1),Di=u('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID *</label> <input type="text" id="gistId" placeholder="Enter Gist ID (for public or your private gists)" required class="svelte-1jb5ckg"/></div>'),ji=u('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),Ai=u('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),Fi=u('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Load</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),Mi=u('<div class="info-message svelte-1jb5ckg">No gists found. Enter a Gist ID manually or create a new one in Save mode.</div>'),Bi=u('<div class="modal-overlay svelte-1jb5ckg" role="button" tabindex="-1"><div class="modal-content svelte-1jb5ckg" role="dialog" tabindex="0"><div class="modal-header svelte-1jb5ckg"><h2 class="svelte-1jb5ckg"> </h2> <button class="close-btn svelte-1jb5ckg">Ã—</button></div> <div class="modal-body svelte-1jb5ckg"><!> <div class="form-group svelte-1jb5ckg"><label for="token" class="svelte-1jb5ckg"> <a href="https://github.com/settings/tokens" target="_blank" rel="noopener" class="svelte-1jb5ckg">Get token</a></label> <input type="password" id="token" placeholder="ghp_xxxxxxxxxxxxx" class="svelte-1jb5ckg"/></div> <!> <!> <div class="modal-actions svelte-1jb5ckg"><button class="btn btn-primary svelte-1jb5ckg"><!></button> <button class="btn btn-secondary svelte-1jb5ckg">Cancel</button></div></div></div></div>');function Ii(s,n){Bt(n,!1);const t=()=>Ze(ee,"$character",v),[v,p]=Tt(),h=Vt();let x=Dt(n,"mode",8,"save"),I=B(""),k=B(""),H=B(""),ve=B(!1),Q=B(""),N=B(!1),Ce=B(!1),de=B([]),De=B(null);const ue=hi();ue.token&&c(I,ue.token),ue.gistId&&c(k,ue.gistId),na(async()=>{e(I)&&!e(N)&&await ge()});async function ge(){if(e(I)){c(Ce,!0),c(Q,"");try{c(de,await _i(e(I))),e(k)&&c(De,e(de).find(A=>A.id===e(k))||null)}catch(A){c(Q,A.message||"Failed to load gists"),c(de,[])}finally{c(Ce,!1)}}}function ie(A){c(De,A),c(k,A.id)}function q(){c(N,!e(N)),c(Q,""),!e(N)&&e(I)&&ge()}async function je(){if(!e(I)){c(Q,"GitHub token is required");return}const A=e(De)?.id||e(k);c(ve,!0),c(Q,"");try{if(A)await gi(t(),e(I),A),c(k,A),At.add("Character updated in Gist successfully!","success");else{const E=await bi(t(),e(I),e(H));c(k,E),At.add(`Character saved to Gist! ID: ${E}`,"success")}za({token:e(I),gistId:e(k)}),h("close")}catch(E){c(Q,E.message||"Failed to save to Gist")}finally{c(ve,!1)}}async function me(){const A=e(De)?.id||e(k);if(!A){c(Q,"Please select a gist or enter a Gist ID");return}c(ve,!0),c(Q,"");try{const E=await mi(A,e(I)||void 0);ee.set(E),c(k,A),za({token:e(I),gistId:e(k)}),At.add("Character loaded from Gist successfully!","success"),h("close")}catch(E){c(Q,E.message||"Failed to load from Gist")}finally{c(ve,!1)}}function X(){h("close")}Mt();var z=Bi(),pe=i(z),xe=i(pe),fe=i(xe),Ue=i(fe,!0);l(fe);var S=a(fe,2);l(xe);var ne=a(xe,2),ce=i(ne);{var he=A=>{var E=yi(),j=i(E,!0);l(E),F(()=>y(j,e(Q))),o(A,E)};_(ce,A=>{e(Q)&&A(he)})}var g=a(ce,2),O=i(g),_e=i(O);ba(),l(O);var Re=a(O,2);Le(Re),l(g);var f=a(g,2);{var C=A=>{var E=ki(),j=i(E),d=i(j,!0);l(j),l(E),F(()=>{j.disabled=e(ve),y(d,e(N)?"ðŸ“‹ Show My Gists":"âœï¸ Enter Gist ID Manually")}),D("click",j,q),o(A,E)};_(f,A=>{(x()==="load"||x()==="save"&&e(I))&&A(C)})}var Y=a(f,2);{var M=A=>{var E=Li(),j=qe(E);{var d=Se=>{var Ae=xi(),Pe=a(i(Ae),2);Le(Pe),l(Ae),F(()=>Pe.disabled=e(ve)),Me(Pe,()=>e(k),Xe=>c(k,Xe)),o(Se,Ae)},Ge=Se=>{var Ae=ot(),Pe=qe(Ae);{var Xe=Te=>{var ae=Si();o(Te,ae)},Ve=Te=>{var ae=ot(),we=qe(ae);{var Oe=K=>{var $e=Ci(),Je=a(i($e),2);pt(Je,5,()=>e(de),ft,(b,L)=>{var le=$i();let te;var be=i(le),U=i(be),W=i(U,!0);l(U);var se=a(U,2),He=i(se,!0);l(se),l(be);var ke=a(be,2),Qe=i(ke),P=i(Qe);l(Qe);var at=a(Qe,2),vt=i(at);l(at),l(ke),l(le),F($=>{te=_t(le,1,"gist-item svelte-1jb5ckg",null,te,{selected:e(De)?.id===e(L).id}),le.disabled=e(ve),y(W,(e(L),r(()=>e(L).description||"Untitled"))),y(He,(e(L),r(()=>e(L).public?"ðŸŒ Public":"ðŸ”’ Private"))),y(P,`ID: ${e(L),r(()=>e(L).id)??""}`),y(vt,`Updated: ${$??""}`)},[()=>(e(L),r(()=>new Date(e(L).updated_at).toLocaleDateString()))]),D("click",le,()=>ie(e(L))),o(b,le)}),l(Je),l($e),o(K,$e)},Ke=K=>{var $e=ot(),Je=qe($e);{var b=L=>{var le=wi();o(L,le)};_(Je,L=>{e(I)&&L(b)},!0)}o(K,$e)};_(we,K=>{e(de),r(()=>e(de).length>0)?K(Oe):K(Ke,!1)},!0)}o(Te,ae)};_(Pe,Te=>{e(Ce)?Te(Xe):Te(Ve,!1)},!0)}o(Se,Ae)};_(j,Se=>{e(N)||!e(I)?Se(d):Se(Ge,!1)})}var re=a(j,2),R=i(re),V=i(R);l(R);var w=a(R,2);Le(w),l(re),F(()=>{y(V,`Description ${e(k)?"(optional)":""}`),w.disabled=e(ve)}),Me(w,()=>e(H),Se=>c(H,Se)),o(A,E)},Z=A=>{var E=ot(),j=qe(E);{var d=re=>{var R=Di(),V=a(i(R),2);Le(V),l(R),F(()=>V.disabled=e(ve)),Me(V,()=>e(k),w=>c(k,w)),o(re,R)},Ge=re=>{var R=ot(),V=qe(R);{var w=Ae=>{var Pe=ji();o(Ae,Pe)},Se=Ae=>{var Pe=ot(),Xe=qe(Pe);{var Ve=ae=>{var we=Fi(),Oe=a(i(we),2);pt(Oe,5,()=>e(de),ft,(Ke,K)=>{var $e=Ai();let Je;var b=i($e),L=i(b),le=i(L,!0);l(L);var te=a(L,2),be=i(te,!0);l(te),l(b);var U=a(b,2),W=i(U),se=i(W);l(W);var He=a(W,2),ke=i(He);l(He),l(U),l($e),F(Qe=>{Je=_t($e,1,"gist-item svelte-1jb5ckg",null,Je,{selected:e(De)?.id===e(K).id}),$e.disabled=e(ve),y(le,(e(K),r(()=>e(K).description||"Untitled"))),y(be,(e(K),r(()=>e(K).public?"ðŸŒ Public":"ðŸ”’ Private"))),y(se,`ID: ${e(K),r(()=>e(K).id)??""}`),y(ke,`Updated: ${Qe??""}`)},[()=>(e(K),r(()=>new Date(e(K).updated_at).toLocaleDateString()))]),D("click",$e,()=>ie(e(K))),o(Ke,$e)}),l(Oe),l(we),o(ae,we)},Te=ae=>{var we=ot(),Oe=qe(we);{var Ke=K=>{var $e=Mi();o(K,$e)};_(Oe,K=>{e(I)&&K(Ke)},!0)}o(ae,we)};_(Xe,ae=>{e(de),r(()=>e(de).length>0)?ae(Ve):ae(Te,!1)},!0)}o(Ae,Pe)};_(V,Ae=>{e(Ce)?Ae(w):Ae(Se,!1)},!0)}o(re,R)};_(j,re=>{e(N)||!e(I)?re(d):re(Ge,!1)},!0)}o(A,E)};_(Y,A=>{x()==="save"?A(M):A(Z,!1)})}var We=a(Y,2),oe=i(We),ye=i(oe);{var ze=A=>{var E=$t();F(()=>y(E,x()==="save"?"Saving...":"Loading...")),o(A,E)},Ee=A=>{var E=$t();F(()=>y(E,x()==="save"?"Save":"Load")),o(A,E)};_(ye,A=>{e(ve)?A(ze):A(Ee,!1)})}l(oe);var it=a(oe,2);l(We),l(ne),l(pe),l(z),F(()=>{y(Ue,x()==="save"?"Save to GitHub Gist":"Load from GitHub Gist"),y(_e,`GitHub Token ${x()==="load"?"(optional for public gists)":"(required)"} `),Re.disabled=e(ve),oe.disabled=e(ve),it.disabled=e(ve)}),D("click",S,X),Me(Re,()=>e(I),A=>c(I,A)),D("blur",Re,()=>{e(I)&&!e(N)&&ge()}),D("click",oe,function(...A){(x()==="save"?je:me)?.apply(this,A)}),D("click",it,X),D("click",pe,Pa(function(A){Yt.call(this,n,A)})),D("keydown",pe,function(A){Yt.call(this,n,A)}),D("click",z,X),D("keydown",z,A=>A.key==="Escape"&&X()),o(s,z),It(),p()}var Ri=u('<div class="loading svelte-1ngjemu">Loading D&D data...</div>'),Ei=u("<option> </option>"),Pi=u('<select class="level-filter svelte-1ngjemu"><option>All Levels</option><option>Cantrip</option><!></select>'),Ti=u('<div class="no-results svelte-1ngjemu"> </div>'),Hi=u('<div class="item-meta svelte-1ngjemu"> </div>'),Ni=u('<div class="item-meta svelte-1ngjemu"> </div>'),Ui=u('<button><div class="item-name svelte-1ngjemu"> </div> <!></button>'),Gi=u('<p class="higher-levels"><strong>At Higher Levels:</strong> </p>'),Oi=u('<p class="cantrip-upgrade"><strong>Cantrip Upgrade:</strong> </p>'),qi=u('<h3 class="svelte-1ngjemu"> </h3> <p class="spell-meta svelte-1ngjemu"><!> <!></p> <p class="spell-classes"><strong>Classes:</strong> </p> <div class="spell-stats svelte-1ngjemu"><div><strong>Casting Time:</strong> </div> <div><strong>Range:</strong> </div> <div><strong>Components:</strong> <!></div> <div><strong>Duration:</strong> <!> </div></div> <p class="description svelte-1ngjemu"> </p> <!> <!>',1),Wi=u('<p class="prerequisite svelte-1ngjemu"><strong>Prerequisite:</strong> </p>'),zi=u('<h3 class="svelte-1ngjemu"> </h3> <!> <p class="description svelte-1ngjemu"> </p> <a target="_blank" rel="noopener" class="source-link svelte-1ngjemu">View Full Details â†’</a>',1),Ki=u('<div class="item-details svelte-1ngjemu"><!></div>'),Ji=u('<div class="controls svelte-1ngjemu"><div class="tabs svelte-1ngjemu"><button> </button> <button> </button></div> <div class="search-controls svelte-1ngjemu"><input type="text" placeholder="Search by name or description..." class="search-input svelte-1ngjemu"/> <!></div></div> <div class="content-container svelte-1ngjemu"><div class="items-list svelte-1ngjemu"><!></div> <!></div>',1),Vi=u('<div class="modal-backdrop svelte-1ngjemu" role="presentation"><div class="modal svelte-1ngjemu" role="dialog" aria-modal="true" tabindex="-1"><div class="modal-header svelte-1ngjemu"><h2 class="svelte-1ngjemu">Browse D&D Spells & Feats</h2> <button class="close-btn svelte-1ngjemu" aria-label="Close">&times;</button></div> <div class="modal-body svelte-1ngjemu"><!></div> <div class="modal-footer svelte-1ngjemu"><button class="btn-secondary svelte-1ngjemu">Cancel</button> <button class="btn-primary svelte-1ngjemu">Add to Character Sheet</button></div></div></div>');function Qi(s,n){Bt(n,!1);const t=B(),v=B(),p=B();let h=Dt(n,"onClose",8),x=B("spell"),I=B(!0),k=B(""),H=B(null),ve=B([]),Q=B([]),N=B(null);na(async()=>{c(I,!0);try{c(ve,await ts()),c(Q,await Qs())}catch(S){console.error("Failed to load data:",S)}finally{c(I,!1)}});function Ce(S){c(N,S)}function de(S){const ne=S.match(/(\d+d\d+(?:\s*\+\s*\d+)?)/i);return ne?ne[1]:""}function De(S){const ne=S.split(/\.( |$)/)[0].trim(),ce=Array.from(S.matchAll(/\*\*(.*?)\*\*/g)).map(g=>g[1].replace(/\.$/,""));let he=ne;return ce.length&&(he+=" | Effects: "+ce.join(", ")),he}function ue(){if(e(N)){if(e(x)==="spell"){const S=e(N);ee.update(ne=>{const he=[];S.range&&he.push(`Range: ${S.range}`),S.castingTime&&he.push(`Cast: ${S.castingTime}`),S.duration&&he.push(`Duration: ${S.duration}`),S.actionType==="Save"&&he.push("Saving throw spell"),S.components&&S.components.length>0&&he.push(`Components: ${S.components.join(", ")}`),S.material&&he.push(`Material: ${S.material}`);const g=he.join(" | "),O=De(S.description),_e={id:crypto.randomUUID(),name:`${S.name}${S.concentration?" (C)":""}${S.ritual?" (R)":""}`,bonus:S.actionType==="Attack"?5:0,damage:de(S.description),damageType:`${S.school} (Lvl ${S.level})`,spellRef:S.name,infoNotes:g,generalNotes:O,castAtLevel:S.level};return ne.attacks=[...ne.attacks,_e],ne})}else if(e(x)==="feat"){const S=e(N);ee.update(ne=>{const ce=`${S.name}${S.prerequisite?` (Req: ${S.prerequisite})`:""}
${S.description}
`;return ne.features=ne.features?`${ne.features}
${ce}`:ce,ne})}c(N,null),h()()}}tt(()=>(e(H),e(ve),e(k)),()=>{c(t,e(H)!==null?Xs(Oa(e(ve),e(k)),e(H)):Oa(e(ve),e(k)))}),tt(()=>(e(Q),e(k)),()=>{c(v,Ys(e(Q),e(k)))}),tt(()=>(e(x),e(t),e(v)),()=>{c(p,e(x)==="spell"?e(t):e(v))}),Gt(),Mt();var ge=Vi(),ie=i(ge),q=i(ie),je=a(i(q),2);l(q);var me=a(q,2),X=i(me);{var z=S=>{var ne=Ri();o(S,ne)},pe=S=>{var ne=Ji(),ce=qe(ne),he=i(ce),g=i(he);let O;var _e=i(g);l(g);var Re=a(g,2);let f;var C=i(Re);l(Re),l(he);var Y=a(he,2),M=i(Y);Le(M);var Z=a(M,2);{var We=j=>{var d=Pi();F(()=>{e(H),St(()=>{})});var Ge=i(d);Ge.value=(Ge.__value=null)??"";var re=a(Ge);re.value=re.__value=0;var R=a(re);pt(R,0,()=>[1,2,3,4,5,6,7,8,9],ft,(V,w)=>{var Se=Ei(),Ae=i(Se);l(Se);var Pe={};F(()=>{y(Ae,`Level ${w??""}`),Pe!==(Pe=w)&&(Se.value=(Se.__value=w)??"")}),o(V,Se)}),l(d),Za(d,()=>e(H),V=>c(H,V)),o(j,d)};_(Z,j=>{e(x)==="spell"&&j(We)})}l(Y),l(ce);var oe=a(ce,2),ye=i(oe),ze=i(ye);{var Ee=j=>{var d=Ti(),Ge=i(d);l(d),F(()=>y(Ge,`No ${e(x)??""}s found`)),o(j,d)},it=j=>{var d=ot(),Ge=qe(d);pt(Ge,1,()=>e(p),ft,(re,R)=>{var V=Ui();let w;var Se=i(V),Ae=i(Se,!0);l(Se);var Pe=a(Se,2);{var Xe=Te=>{const ae=rt(()=>e(R));var we=Hi(),Oe=i(we);l(we),F(()=>y(Oe,`Level ${G(e(ae)),r(()=>e(ae).level)??""} â€¢ ${G(e(ae)),r(()=>e(ae).school)??""}`)),o(Te,we)},Ve=Te=>{const ae=rt(()=>e(R));var we=ot(),Oe=qe(we);{var Ke=K=>{var $e=Ni(),Je=i($e,!0);l($e),F(()=>y(Je,(G(e(ae)),r(()=>e(ae).prerequisite)))),o(K,$e)};_(Oe,K=>{G(e(ae)),r(()=>e(ae).prerequisite)&&K(Ke)})}o(Te,we)};_(Pe,Te=>{e(x)==="spell"?Te(Xe):Te(Ve,!1)})}l(V),F(()=>{w=_t(V,1,"item-card svelte-1ngjemu",null,w,{selected:e(N)?.name===e(R).name}),y(Ae,(e(R),r(()=>e(R).name)))}),D("click",V,()=>Ce(e(R))),o(re,V)}),o(j,d)};_(ze,j=>{e(p),r(()=>e(p).length===0)?j(Ee):j(it,!1)})}l(ye);var A=a(ye,2);{var E=j=>{var d=Ki(),Ge=i(d);{var re=V=>{const w=rt(()=>e(N));var Se=qi(),Ae=qe(Se),Pe=i(Ae,!0);l(Ae);var Xe=a(Ae,2),Ve=i(Xe);{var Te=T=>{var J=$t();F(()=>y(J,`${G(e(w)),r(()=>e(w).school)??""} cantrip`)),o(T,J)},ae=T=>{var J=$t();F(()=>y(J,`Level ${G(e(w)),r(()=>e(w).level)??""} ${G(e(w)),r(()=>e(w).school)??""}`)),o(T,J)};_(Ve,T=>{G(e(w)),r(()=>e(w).level===0)?T(Te):T(ae,!1)})}var we=a(Ve,2);{var Oe=T=>{var J=$t("(ritual)");o(T,J)};_(we,T=>{G(e(w)),r(()=>e(w).ritual)&&T(Oe)})}l(Xe);var Ke=a(Xe,2),K=a(i(Ke));l(Ke);var $e=a(Ke,2),Je=i($e),b=a(i(Je));l(Je);var L=a(Je,2),le=a(i(L));l(L);var te=a(L,2),be=a(i(te)),U=a(be);{var W=T=>{var J=$t();F(()=>y(J,`(${G(e(w)),r(()=>e(w).material)??""})`)),o(T,J)};_(U,T=>{G(e(w)),r(()=>e(w).material)&&T(W)})}l(te);var se=a(te,2),He=a(i(se),2);{var ke=T=>{var J=$t("Concentration,");o(T,J)};_(He,T=>{G(e(w)),r(()=>e(w).concentration)&&T(ke)})}var Qe=a(He,1,!0);l(se),l($e);var P=a($e,2),at=i(P,!0);l(P);var vt=a(P,2);{var $=T=>{var J=Gi(),Ne=a(i(J));l(J),F(()=>y(Ne,` ${G(e(w)),r(()=>e(w).higherLevelSlot)??""}`)),o(T,J)};_(vt,T=>{G(e(w)),r(()=>e(w).higherLevelSlot)&&T($)})}var Fe=a(vt,2);{var m=T=>{var J=Oi(),Ne=a(i(J));l(J),F(()=>y(Ne,` ${G(e(w)),r(()=>e(w).cantripUpgrade)??""}`)),o(T,J)};_(Fe,T=>{G(e(w)),r(()=>e(w).cantripUpgrade)&&T(m)})}F((T,J)=>{y(Pe,(G(e(w)),r(()=>e(w).name))),y(K,` ${T??""}`),y(b,` ${G(e(w)),r(()=>e(w).castingTime||e(w).actionType)??""}`),y(le,` ${G(e(w)),r(()=>e(w).range)??""}`),y(be,` ${J??""}`),y(Qe,(G(e(w)),r(()=>e(w).duration))),y(at,(G(e(w)),r(()=>e(w).description)))},[()=>(G(e(w)),r(()=>e(w).classes.join(", "))),()=>(G(e(w)),r(()=>e(w).components.join(", ").toUpperCase()))]),o(V,Se)},R=V=>{const w=rt(()=>e(N));var Se=zi(),Ae=qe(Se),Pe=i(Ae,!0);l(Ae);var Xe=a(Ae,2);{var Ve=Oe=>{var Ke=Wi(),K=a(i(Ke));l(Ke),F(()=>y(K,` ${G(e(w)),r(()=>e(w).prerequisite)??""}`)),o(Oe,Ke)};_(Xe,Oe=>{G(e(w)),r(()=>e(w).prerequisite)&&Oe(Ve)})}var Te=a(Xe,2),ae=i(Te,!0);l(Te);var we=a(Te,2);F(()=>{y(Pe,(G(e(w)),r(()=>e(w).name))),y(ae,(G(e(w)),r(()=>e(w).description))),st(we,"href",(G(e(w)),r(()=>e(w).source)))}),o(V,Se)};_(Ge,V=>{e(x)==="spell"?V(re):V(R,!1)})}l(d),o(j,d)};_(A,j=>{e(N)&&j(E)})}l(oe),F(()=>{O=_t(g,1,"tab svelte-1ngjemu",null,O,{active:e(x)==="spell"}),y(_e,`ðŸ“œ Spells (${e(ve),r(()=>e(ve).length)??""})`),f=_t(Re,1,"tab svelte-1ngjemu",null,f,{active:e(x)==="feat"}),y(C,`â­ Feats (${e(Q),r(()=>e(Q).length)??""})`)}),D("click",g,()=>{c(x,"spell"),c(N,null),c(k,"")}),D("click",Re,()=>{c(x,"feat"),c(N,null),c(k,"")}),Me(M,()=>e(k),j=>c(k,j)),o(S,ne)};_(X,S=>{e(I)?S(z):S(pe,!1)})}l(me);var xe=a(me,2),fe=i(xe),Ue=a(fe,2);l(xe),l(ie),l(ge),F(()=>Ue.disabled=!e(N)),D("click",je,function(...S){h()?.apply(this,S)}),D("click",fe,function(...S){h()?.apply(this,S)}),D("click",Ue,ue),D("click",ie,Pa(function(S){Yt.call(this,n,S)})),D("keydown",ie,function(S){Yt.call(this,n,S)}),D("click",ge,function(...S){h()?.apply(this,S)}),D("keydown",ge,S=>S.key==="Escape"&&h()()),o(s,ge),It()}var Xi=u('<link rel="icon" type="image/png" href="favicon4.png"/> <meta name="viewport" content="width=device-width, initial-scale=1"/>',1),Yi=u('<span class="character-name svelte-1uha8ag"> </span>'),Zi=u("<span> </span>"),er=u('<div class="spell-slots-header svelte-1uha8ag"></div>'),tr=u("<span> </span><br/>",1),ar=u("<span> </span>"),sr=u('<span class="effect-tooltip"><strong> </strong><br/> <br/> <!> <!></span>'),lr=u('<button class="effect-remove-btn svelte-1uha8ag">Ã—</button>'),ir=u('<span class="effect-badge svelte-1uha8ag" tabindex="0"> <!> <!></span>'),rr=u(`<div class="active-effects-header svelte-1uha8ag"></div> <style>.effect-badge {
            position: relative;
          }
          .effect-tooltip {
            position: absolute;
            top: 120%;
            left: 50%;
            transform: translateX(-50%);
            background: #fff;
            color: #222;
            border: 1px solid #a5b4fc;
            border-radius: 6px;
            padding: 8px 12px;
            font-size: 0.95em;
            box-shadow: 0 2px 8px rgba(0,0,0,0.12);
            z-index: 10;
            min-width: 180px;
            max-width: 260px;
            white-space: normal;
            pointer-events: none;
            opacity: 1;
            transition: opacity 0.15s;
          }</style>`,1),nr=u('<div class="rest-menu svelte-1uha8ag"><button class="rest-option svelte-1uha8ag">â˜• Short Rest</button> <button class="rest-option svelte-1uha8ag">ðŸ›ï¸ Long Rest</button></div>'),or=u('<div class="container svelte-1uha8ag"><header class="svelte-1uha8ag"><div class="header-top svelte-1uha8ag"><div class="header-title svelte-1uha8ag"><div class="title-row svelte-1uha8ag"><h1 class="svelte-1uha8ag">D&D Character Sheet</h1> <!></div> <!> <!></div> <div class="header-right svelte-1uha8ag"><div class="header-controls svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">ðŸŽ²</span><span class="btn-text svelte-1uha8ag">Roll Dice</span></button> <div class="rest-button-container svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">ðŸ˜´</span><span class="btn-text svelte-1uha8ag">Rest</span></button> <!></div> <div class="mode-toggle"><button><span class="btn-icon svelte-1uha8ag"> </span><span class="btn-text svelte-1uha8ag"> </span></button></div></div> <div class="header-search svelte-1uha8ag"><input type="text" placeholder="ðŸ” Search..." class="search-input use-enabled svelte-1uha8ag"/></div></div></div> <div class="header-actions svelte-1uha8ag"><button class="btn btn-mode svelte-1uha8ag">ðŸ“š Browse Spells & Feats</button> <button class="btn btn-secondary">Save to Gist</button> <button class="btn btn-secondary">Load from Gist</button> <button class="btn btn-secondary">Export JSON</button> <button class="btn btn-secondary">Import JSON</button> <input type="file" accept=".json" style="display: none;"/></div></header> <main class="svelte-1uha8ag"><!> <!> <!> <!> <!> <!> <!></main></div> <!> <!> <!> <!>',1);function mr(s,n){Bt(n,!1);const t=()=>Ze(ee,"$character",h),v=()=>Ze(ia,"$isEditMode",h),p=()=>Ze(zt,"$searchFilter",h),[h,x]=Tt();function I(){const $=[],Fe=t().classFeatures.spellSlotsByLevel||{};for(let m=1;m<=9;m++){const T=Fe[m];if(T&&T.length>0){const J=T.length,Ne=T.filter(Ie=>Ie).length;$.push({level:m,available:J-Ne,total:J})}}return $}let k=B(!1),H=B(!1),ve=B(!1),Q=B("save"),N=B(void 0),Ce=B(""),de=B(""),De=B(""),ue=B(!1),ge=B([]),ie=B(),q=!1,je=B(!1),me=B(null);function X($){c(me,$)}function z(){c(me,null)}function pe(){const $=[];ee.update(m=>{const T=m.hitDice.current;m.hitDice.current=Math.min(m.hitDice.max,m.hitDice.current+Math.max(1,Math.floor(m.hitDice.max/2)));const J=m.hitDice.current-T;if(J>0&&$.push(`${J} hit ${J===1?"die":"dice"}`),m.class){const Ne=Zt(m.class,m.level,m.subclass);m.classFeatures.features||(m.classFeatures.features={}),Ne.forEach(Ie=>{if(Ie.resetOn==="short"){const Ye=Ie.name.replace(/\s+/g,"");if(Ie.type==="uses"){const Be=typeof Ie.maxUses=="function"?Ie.maxUses(m.level):Ie.maxUses;m.classFeatures.features[Ye]=Array(Be).fill(!1),$.push(Ie.name)}else if(Ie.type==="pool"){const Be=typeof Ie.maxPool=="function"?Ie.maxPool(m.level):Ie.maxPool;Be!==void 0&&(m.classFeatures.features[Ye]=Be,$.push(Ie.name))}}})}return m}),c(je,!1);const Fe=$.length>0?`Short rest taken! Restored: ${$.join(", ")}`:"Short rest taken!";At.add(Fe,"success")}function xe(){const $=[];ee.update(m=>{const T=m.maxHP-m.currentHP;T>0&&$.push(`${T} HP`),m.currentHP=m.maxHP,m.tempHP=0;const J=m.hitDice.max-m.hitDice.current;J>0&&$.push(`${J} hit ${J===1?"die":"dice"}`),m.hitDice.current=m.hitDice.max;let Ne=0;if(m.classFeatures.spellSlotsByLevel&&Object.keys(m.classFeatures.spellSlotsByLevel).forEach(Ie=>{const Ye=m.classFeatures.spellSlotsByLevel[parseInt(Ie)];if(Ye){const Be=Ye.filter(bt=>bt).length;Ne+=Be,m.classFeatures.spellSlotsByLevel[parseInt(Ie)]=Array(Ye.length).fill(!1)}}),Ne>0&&$.push(`${Ne} spell ${Ne===1?"slot":"slots"}`),m.class){const Ie=Zt(m.class,m.level,m.subclass);m.classFeatures.features||(m.classFeatures.features={});let Ye=!1;Ie.forEach(Be=>{const bt=Be.name.replace(/\s+/g,"");if(!(Be.type==="info"||Be.type==="channelDivinity")){if(Be.type==="uses"){const ut=typeof Be.maxUses=="function"?Be.maxUses(m.level):Be.maxUses;m.classFeatures.features[bt]=Array(ut).fill(!1),Ye=!0}else if(Be.type==="pool"){const ut=typeof Be.maxPool=="function"?Be.maxPool(m.level):Be.maxPool;ut!==void 0&&(m.classFeatures.features[bt]=ut,Ye=!0)}}}),Ye&&$.push("all class features")}return m}),c(je,!1);const Fe=$.length>0?`Long rest taken! Restored: ${$.join(", ")}`:"Long rest taken! Fully rested.";At.add(Fe,"success")}function fe($){c(Ce,""),c(de,""),c(De,""),c(ue,!1),c(ge,[]),q=!1,typeof $=="string"?c(Ce,$):(c(Ce,$.notation),c(de,$.damageNotation||""),c(De,$.attackName||""),c(ue,!!$.applyHalfDamage),c(ge,$.bonusBreakdown||[])),c(k,!0)}function Ue($){const{notation:Fe}=$.detail;c(Ce,""),q=!0,setTimeout(()=>{c(Ce,Fe),c(de,""),c(De,"Hit Die")},0),c(k,!0)}function S(){if(c(k,!1),q&&e(ie)){const $=e(ie).getLastRollTotal();if($!==null){const Fe=Math.max(1,$);ee.update(m=>(m.hitDice.current=Math.max(0,m.hitDice.current-1),m.currentHP=Math.min(m.maxHP,m.currentHP+Fe),m))}q=!1}}function ne(){console.log("toggleMode called, current isEditMode:",v()),ia.update($=>(console.log("Updating isEditMode from",$,"to",!$),!$))}function ce($){$.target.closest(".rest-button-container")||c(je,!1)}na(()=>{console.log("onMount - initial isEditMode:",v()),console.log("onMount - body classes:",document.body.className);const $=ia.subscribe(Fe=>{console.log("isEditMode subscription triggered, value:",Fe),console.log("Body classes before:",document.body.className),Fe?(document.body.classList.remove("use-mode"),console.log("Removed use-mode class (Edit Mode)")):(document.body.classList.add("use-mode"),console.log("Added use-mode class (Use Mode)")),console.log("Body classes after:",document.body.className)});return document.addEventListener("click",ce),()=>{$(),document.removeEventListener("click",ce)}});function he(){ms(t())}function g(){e(N)?.click()}async function O($){const m=$.target.files?.[0];if(m)try{const T=await hs(m);ee.set(T),alert("Character imported successfully!")}catch{alert("Failed to import character file")}}Mt();var _e=or();bs("1uha8ag",$=>{var Fe=Xi();ba(2),Va(()=>{fs.title="D&D Character Sheet"}),o($,Fe)});var Re=qe(_e),f=i(Re),C=i(f),Y=i(C),M=i(Y),Z=a(i(M),2);{var We=$=>{var Fe=Yi(),m=i(Fe);l(Fe),F(()=>y(m,`${t().name??""} (${t().level??""})`)),o($,Fe)};_(Z,$=>{t().name&&$(We)})}l(M);var oe=a(M,2);{var ye=$=>{var Fe=er();pt(Fe,5,I,ft,(m,T)=>{var J=Zi();let Ne;var Ie=i(J);l(J),F(()=>{Ne=_t(J,1,"slot-badge svelte-1uha8ag",null,Ne,{depleted:e(T).available===0}),y(Ie,`Lv${e(T).level??""}: ${e(T).available??""}/${e(T).total??""}`)}),o(m,J)}),l(Fe),o($,Fe)};_(oe,$=>{I().length>0&&$(ye)})}var ze=a(oe,2);{var Ee=$=>{var Fe=rr(),m=qe(Fe);pt(m,5,()=>t().activeStates,ft,(T,J,Ne)=>{var Ie=ir(),Ye=i(Ie),Be=a(Ye);{var bt=gt=>{var wt=sr(),lt=i(wt),mt=i(lt,!0);l(lt);var kt=a(lt,2),Ot=a(kt,3);{var Kt=dt=>{var Lt=tr(),Et=qe(Lt),Qt=i(Et);l(Et),ba(),F(()=>y(Qt,`Attack Bonus: ${e(J).attackBonus>0?"+":""}${e(J).attackBonus??""}`)),o(dt,Lt)};_(Ot,dt=>{e(J).attackBonus&&dt(Kt)})}var ea=a(Ot,2);{var jt=dt=>{var Lt=ar(),Et=i(Lt);l(Lt),F(()=>y(Et,`Damage Bonus: ${e(J).damageBonus>0?"+":""}${e(J).damageBonus??""}`)),o(dt,Lt)};_(ea,dt=>{e(J).damageBonus&&dt(jt)})}l(wt),F(()=>{y(mt,e(J).name),y(kt,` ${e(J).description??""}`)}),o(gt,wt)};_(Be,gt=>{e(me)===Ne&&gt(bt)})}var ut=a(Be,2);{var Rt=gt=>{var wt=lr();F(()=>st(wt,"title",`End ${e(J).name??""}`)),D("click",wt,()=>{ee.update(lt=>(lt.activeStates&&(lt.activeStates=lt.activeStates.filter((mt,kt)=>kt!==Ne)),lt))}),o(gt,wt)};_(ut,gt=>{v()||gt(Rt)})}l(Ie),F(()=>{st(Ie,"aria-label",e(J).name),y(Ye,`âœ¨ ${e(J).name??""} `)}),D("mouseenter",Ie,()=>X(Ne)),D("mouseleave",Ie,z),D("focus",Ie,()=>X(Ne)),D("blur",Ie,z),D("touchstart",Ie,Ha(()=>X(Ne))),D("touchend",Ie,Ha(z)),o(T,Ie)}),l(m),ba(2),o($,Fe)};_(ze,$=>{t().activeStates&&t().activeStates.length>0&&$(Ee)})}l(Y);var it=a(Y,2),A=i(it),E=i(A),j=a(E,2),d=i(j),Ge=a(d,2);{var re=$=>{var Fe=nr(),m=i(Fe),T=a(m,2);l(Fe),D("click",m,pe),D("click",T,xe),o($,Fe)};_(Ge,$=>{e(je)&&$(re)})}l(j);var R=a(j,2),V=i(R);let w;var Se=i(V),Ae=i(Se,!0);l(Se);var Pe=a(Se),Xe=i(Pe,!0);l(Pe),l(V),l(R),l(A);var Ve=a(A,2),Te=i(Ve);Le(Te),l(Ve),l(it),l(C);var ae=a(C,2),we=i(ae),Oe=a(we,2),Ke=a(Oe,2),K=a(Ke,2),$e=a(K,2),Je=a($e,2);Aa(Je,$=>c(N,$),()=>e(N)),l(ae),l(f);var b=a(f,2),L=i(b);Is(L,{});var le=a(L,2);Ws(le,{$$events:{rollHitDice:Ue}});var te=a(le,2);Ts(te,{$$events:{roll:$=>fe($.detail)}});var be=a(te,2);Vs(be,{$$events:{roll:$=>fe($.detail)}});var U=a(be,2);Il(U,{$$events:{roll:$=>fe($.detail)}});var W=a(U,2);Xl(W,{});var se=a(W,2);ei(se,{}),l(b),l(Re);var He=a(Re,2);Aa(fi(He,{get notation(){return e(Ce)},get damageNotation(){return e(de)},get attackName(){return e(De)},get applyHalfDamage(){return e(ue)},get bonusBreakdown(){return e(ge)},get visible(){return e(k)},$$events:{close:S},$$legacy:!0}),$=>c(ie,$),()=>e(ie));var ke=a(He,2);{var Qe=$=>{Ii($,{get mode(){return e(Q)},$$events:{close:()=>c(H,!1)}})};_(ke,$=>{e(H)&&$(Qe)})}var P=a(ke,2);{var at=$=>{Qi($,{onClose:()=>c(ve,!1)})};_(P,$=>{e(ve)&&$(at)})}var vt=a(P,2);gs(vt,{}),F(()=>{w=_t(V,1,"btn btn-mode svelte-1uha8ag",null,w,{"use-mode":!v()}),y(Ae,v()?"ðŸ“":"ðŸŽ²"),y(Xe,v()?"Edit Mode":"Use Mode")}),D("click",E,()=>c(k,!0)),D("click",d,()=>c(je,!e(je))),D("click",V,ne),Me(Te,p,$=>_s(zt,$)),D("click",we,()=>c(ve,!0)),D("click",Oe,()=>{c(Q,"save"),c(H,!0)}),D("click",Ke,()=>{c(Q,"load"),c(H,!0)}),D("click",K,he),D("click",$e,g),D("change",Je,O),o(s,_e),It(),x()}export{mr as component};
