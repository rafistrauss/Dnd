import{f as h,e as S,a as v,s as x,c as at,t as mt}from"../chunks/DByWoho_.js";import{i as ut}from"../chunks/B8VD8sBm.js";import{c as St,o as Ft}from"../chunks/rdJCzvYT.js";import{a6 as Yt,i as Zt,b1 as ca,b2 as va,b3 as zt,J as _t,e as ea,b4 as ta,ay as da,b as n,r as aa,R as sa,g as ua,B as pt,b5 as qe,b6 as gt,E as B,F as ft,s as o,a3 as D,G as l,I as a,H as s,d as e,C as He,k as tt,z as W,b7 as xt,b8 as Lt,b9 as pa,aI as fa,ba}from"../chunks/BMWhyEAP.js";import{i as w,s as ht,a as Ee,b as Ke,d as ma}from"../chunks/D39sVKQV.js";import{a as st,c as q,b as rt,r as xe,e as nt,i as ct,d as la,u as ha,f as yt,s as it,g as Pt,j as Mt,k as ga,t as Ht,h as _a,l as ya,m as ka}from"../chunks/D9whcMjT.js";import{p as $t,b as Ut}from"../chunks/Ds54jWm4.js";import{b as jt,r as xa}from"../chunks/B_EcHlum.js";function Et(r,d,t=!1){if(r.multiple){if(d==null)return;if(!Zt(d))return ca();for(var c of r.options)c.selected=d.includes(wt(c));return}for(c of r.options){var y=wt(c);if(va(y,d)){c.selected=!0;return}}(!t||d!==void 0)&&(r.selectedIndex=-1)}function Ot(r){var d=new MutationObserver(()=>{Et(r,r.__value)});d.observe(r,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Yt(()=>{d.disconnect()})}function $a(r,d,t=d){var c=new WeakSet,y=!0;zt(r,"change",g=>{var $=g?"[selected]":":checked",E;if(r.multiple)E=[].map.call(r.querySelectorAll($),wt);else{var f=r.querySelector($)??r.querySelector("option:not([disabled])");E=f&&wt(f)}t(E),_t!==null&&c.add(_t)}),ea(()=>{var g=d();if(r===document.activeElement){var $=ta??_t;if(c.has($))return}if(Et(r,g,y),y&&g===void 0){var E=r.querySelector(":checked");E!==null&&(g=wt(E),t(g))}r.__value=g,y=!1}),Ot(r)}function wt(r){return"__value"in r?r.__value:r.value}function $e(r,d,t=d){var c=new WeakSet;zt(r,"input",async y=>{var g=y?r.defaultValue:r.value;if(g=Gt(r)?Nt(g):g,t(g),_t!==null&&c.add(_t),await da(),g!==(g=d())){var $=r.selectionStart,E=r.selectionEnd,f=r.value.length;if(r.value=g??"",E!==null){var T=r.value.length;$===E&&E===f&&T>f?(r.selectionStart=T,r.selectionEnd=T):(r.selectionStart=$,r.selectionEnd=Math.min(E,T))}}}),(sa&&r.defaultValue!==r.value||n(d)==null&&r.value)&&(t(Gt(r)?Nt(r.value):r.value),_t!==null&&c.add(_t)),aa(()=>{var y=d();if(r===document.activeElement){var g=ta??_t;if(c.has(g))return}Gt(r)&&y===Nt(r.value)||r.type==="date"&&!y&&!r.value||y!==r.value&&(r.value=y??"")})}function ia(r,d,t=d){zt(r,"change",c=>{var y=c?r.defaultChecked:r.checked;t(y)}),(sa&&r.defaultChecked!==r.checked||n(d)==null)&&t(r.checked),aa(()=>{var c=d();r.checked=!!c})}function Gt(r){var d=r.type;return d==="number"||d==="range"}function Nt(r){return r===""?null:+r}function Ca(r,d,t){var c=ua(r,d);c&&c.set&&(r[d]=t,Yt(()=>{r[d]=null}))}function Wt(r){return function(...d){var t=d[0];return t.stopPropagation(),r?.apply(this,d)}}function Ct(r,d){var t=r.$$events?.[d.type],c=Zt(t)?t.slice():t==null?[]:[t];for(var y of c)y.call(this,d)}const Sa="";function ra(...r){return jt+Sa+xa(r[0],r[1])}const qt={paladin:{name:"Paladin",hitDice:"d10",spellcaster:!0,spellcastingAbility:"charisma",spellSlotsByLevel:{1:0,2:2,3:3,4:3,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Divine Sense",type:"uses",maxUses:(r,d=1)=>1+Math.max(1,d),resetOn:"long",description:"Detect celestials, fiends, and undead within 60 feet",minLevel:1},{name:"Lay on Hands",type:"pool",maxPool:r=>r*5,resetOn:"long",description:"Heal wounds or cure disease",minLevel:1},{name:"Divine Smite",type:"spellSlot",description:"Expend spell slot to deal extra radiant damage",minLevel:2,rollable:!0},{name:"Channel Divinity",type:"pool",maxPool:r=>r>=18?3:r>=6?2:1,resetOn:"short",description:"Sacred Weapon or Turn Undead",minLevel:3}]},fighter:{name:"Fighter",hitDice:"d10",spellcaster:!1,features:[{name:"Second Wind",type:"uses",maxUses:1,resetOn:"short",description:"Regain 1d10 + fighter level HP as bonus action",minLevel:1,rollable:!0,rollFormula:r=>`1d10+${r}`},{name:"Action Surge",type:"uses",maxUses:r=>r>=17?2:1,resetOn:"short",description:"Take one additional action on your turn",minLevel:2},{name:"Indomitable",type:"uses",maxUses:r=>r>=17?3:r>=13?2:1,resetOn:"long",description:"Reroll a failed saving throw",minLevel:9}],subclasses:{champion:{name:"Champion",features:[{name:"Improved Critical",type:"info",description:"Critical hit on 19-20",minLevel:3},{name:"Remarkable Athlete",type:"info",description:"Add half proficiency to STR/DEX/CON checks, increase long jump distance",minLevel:7},{name:"Additional Fighting Style",type:"info",description:"Choose a second fighting style",minLevel:10},{name:"Superior Critical",type:"info",description:"Critical hit on 18-20",minLevel:15},{name:"Survivor",type:"info",description:"Regain 5 + CON mod HP at start of turn if below half HP",minLevel:18}]},battlemaster:{name:"Battle Master",features:[{name:"Combat Superiority",type:"uses",maxUses:r=>r>=15?6:r>=7?5:4,resetOn:"short",description:r=>`Use superiority dice (${r>=18?"d12":r>=10?"d10":"d8"}) for maneuvers`,minLevel:3},{name:"Know Your Enemy",type:"info",description:"Learn capabilities of creatures you observe",minLevel:7},{name:"Improved Combat Superiority",type:"info",description:"Superiority dice become d10",minLevel:10},{name:"Relentless",type:"info",description:"Regain 1 superiority die if you have none at start of turn",minLevel:15}]}}},rogue:{name:"Rogue",hitDice:"d8",spellcaster:!1,features:[{name:"Sneak Attack",type:"info",description:r=>`Deal ${Math.ceil(r/2)}d6 extra damage once per turn with advantage or ally nearby`,minLevel:1,rollable:!0,rollFormula:r=>`${Math.ceil(r/2)}d6`},{name:"Cunning Action",type:"info",description:"Dash, Disengage, or Hide as a bonus action",minLevel:2},{name:"Uncanny Dodge",type:"info",description:"Use reaction to halve damage from an attack",minLevel:5},{name:"Evasion",type:"info",description:"Take no damage on successful Dex save (half on fail)",minLevel:7}]},wizard:{name:"Wizard",hitDice:"d6",spellcaster:!0,spellcastingAbility:"intelligence",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Arcane Recovery",type:"uses",maxUses:1,resetOn:"long",description:r=>`Recover spell slots totaling up to ${Math.ceil(r/2)} levels during short rest`,minLevel:1},{name:"Spell Mastery",type:"info",description:"Cast one 1st-level and one 2nd-level spell at will",minLevel:18}]},cleric:{name:"Cleric",hitDice:"d8",spellcaster:!0,spellcastingAbility:"wisdom",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Channel Divinity",type:"pool",maxPool:r=>r>=18?3:r>=6?2:1,resetOn:"short",description:"Turn Undead or domain-specific ability",minLevel:2},{name:"Destroy Undead",type:"info",description:r=>`Channel Divinity destroys undead of CR ${r>=17?4:r>=14?3:r>=11?2:r>=8?1:.5} or lower`,minLevel:5},{name:"Divine Intervention",type:"uses",maxUses:1,resetOn:"long",description:r=>`${r}% chance to succeed, implore deity for aid`,minLevel:10}],subclasses:{war:{name:"War Domain",features:[{name:"War Priest",type:"uses",maxUses:(r,d=1)=>Math.max(1,d),resetOn:"long",description:"Make one weapon attack as a bonus action",minLevel:1},{name:"Guided Strike",type:"channelDivinity",description:"Use your Channel Divinity to gain +10 to an attack roll. Make this choice after you see the roll, but before the DM says whether the attack hits or misses.",minLevel:2,resetOn:"short"},{name:"War God's Blessing",type:"channelDivinity",description:"Use reaction to grant +10 to an ally's attack roll within 30 feet. Consumes one use of Channel Divinity.",minLevel:6,resetOn:"short"},{name:"Divine Strike",type:"info",description:r=>`Deal extra ${r>=14?"2d8":"1d8"} weapon damage once per turn`,minLevel:8,rollable:!0,rollFormula:r=>r>=14?"2d8":"1d8"},{name:"Avatar of Battle",type:"info",description:"Gain resistance to nonmagical weapon damage",minLevel:17}]},life:{name:"Life Domain",features:[{name:"Disciple of Life",type:"info",description:"Healing spells restore additional 2 + spell level HP",minLevel:1},{name:"Preserve Life",type:"pool",maxPool:r=>r*5,resetOn:"short",description:"Restore HP to creatures within 30 feet",minLevel:2},{name:"Blessed Healer",type:"info",description:"Regain 2 + spell level HP when you cast healing spell",minLevel:6},{name:"Divine Strike",type:"info",description:r=>`Deal extra ${r>=14?"2d8":"1d8"} radiant damage once per turn`,minLevel:8,rollable:!0,rollFormula:r=>r>=14?"2d8":"1d8"},{name:"Supreme Healing",type:"info",description:"Maximize healing dice instead of rolling",minLevel:17}]}}},barbarian:{name:"Barbarian",hitDice:"d12",spellcaster:!1,features:[{name:"Rage",type:"uses",maxUses:r=>r>=20?1/0:r>=17?6:r>=12?5:r>=6?4:r>=3?3:2,resetOn:"long",description:r=>`+${r>=16?4:r>=9?3:2} damage, resistance to physical damage`,minLevel:1},{name:"Reckless Attack",type:"info",description:"Gain advantage on melee attacks, enemies get advantage on you",minLevel:2},{name:"Danger Sense",type:"info",description:"Advantage on Dex saves against effects you can see",minLevel:2}],subclasses:{berserker:{name:"Path of the Berserker",features:[{name:"Frenzy",type:"info",description:"While raging, make melee attack as bonus action (gain 1 exhaustion after rage)",minLevel:3},{name:"Mindless Rage",type:"info",description:"Cannot be charmed or frightened while raging",minLevel:6},{name:"Intimidating Presence",type:"info",description:"Use action to frighten creature within 30 feet",minLevel:10},{name:"Retaliation",type:"info",description:"When damaged by creature within 5 feet, make melee attack as reaction",minLevel:14}]}}}};function dt(r){const d=r.toLowerCase();return qt[d]||null}function Dt(r,d,t){const c=dt(r);if(!c)return[];const y=c.features.filter(g=>!g.minLevel||g.minLevel<=d);if(t&&c.subclasses&&c.subclasses[t]){const g=c.subclasses[t].features.filter($=>!$.minLevel||$.minLevel<=d);return[...y,...g]}return y}function Vt(r){const d=dt(r);return!d||!d.subclasses?[]:Object.keys(d.subclasses).map(t=>({id:t,name:d.subclasses[t].name}))}function Jt(r,d){const t=dt(r);return!t||!t.spellcaster||!t.spellSlotsByLevel?0:t.spellSlotsByLevel[d]||0}function Kt(r,d,t){const c=dt(r);return!c||!c.spellcaster?0:Math.max(1,t+d)}function ja(r,d,t){const c=dt(r);return!c||!c.spellcaster?null:8+d+t}function La(){return Object.keys(qt).map(r=>({id:r,name:qt[r].name}))}var wa=h("<option> </option>"),Da=h("<option> </option>"),Fa=h('<div class="form-group svelte-172i2fj"><label for="characterSubclass" class="svelte-172i2fj">Subclass</label> <select id="characterSubclass" class="svelte-172i2fj"><option>Select Subclass</option><!></select></div>'),Aa=h('<div class="info-grid svelte-172i2fj"><div class="form-group svelte-172i2fj"><label for="characterName" class="svelte-172i2fj">Character Name</label> <input type="text" id="characterName" placeholder="Enter name" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterClass" class="svelte-172i2fj">Class</label> <select id="characterClass" class="svelte-172i2fj"><option>Select Class</option><!></select></div> <!> <div class="form-group svelte-172i2fj"><label for="characterLevel" class="svelte-172i2fj">Level</label> <input type="number" id="characterLevel" min="1" max="20" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterRace" class="svelte-172i2fj">Race</label> <input type="text" id="characterRace" placeholder="e.g., Human" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterBackground" class="svelte-172i2fj">Background</label> <input type="text" id="characterBackground" placeholder="e.g., Soldier" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterAlignment" class="svelte-172i2fj">Alignment</label> <input type="text" id="characterAlignment" placeholder="e.g., Lawful Good" class="svelte-172i2fj"/></div></div>'),Ra=h('<section class="character-info svelte-172i2fj"><div class="header svelte-172i2fj"><h2 class="svelte-172i2fj">Character Info</h2> <button class="collapse-btn svelte-172i2fj"> </button></div> <!></section>');function Ia(r,d){pt(d,!1);const t=()=>Ee(q,"$character",y),c=()=>Ee(rt,"$collapsedStates",y),[y,g]=ht(),$=D(),E=La();function f(ve){const ie=ve.target;q.update(V=>(V.class=ie.value,V.subclass="",V))}function T(ve){const ie=ve.target;q.update(V=>(V.subclass=ie.value,V))}function X(ve){const ie=ve.target;q.update(V=>(V.level=parseInt(ie.value)||1,V)),ha()}function Q(){rt.update(ve=>({...ve,characterInfo:!ve.characterInfo}))}qe(()=>(t(),Vt),()=>{o($,t().class?Vt(t().class):[])}),gt(),ut();var U=Ra(),pe=l(U),se=a(l(pe),2),me=l(se,!0);s(se),s(pe);var le=a(pe,2);{var H=ve=>{var ie=Aa(),V=l(ie),Z=a(l(V),2);xe(Z),s(V);var J=a(V,2),G=a(l(J),2),re=l(G);re.value=re.__value="";var ee=a(re);nt(ee,1,()=>E,ct,(de,fe)=>{var be=wa(),Te=l(be,!0);s(be);var ze={};B(()=>{x(Te,(e(fe),n(()=>e(fe).name))),ze!==(ze=(e(fe),n(()=>e(fe).id)))&&(be.value=(be.__value=(e(fe),n(()=>e(fe).id)))??"")}),v(de,be)}),s(G);var _;Ot(G),s(J);var ae=a(J,2);{var m=de=>{var fe=Fa(),be=a(l(fe),2),Te=l(be);Te.value=Te.__value="";var ze=a(Te);nt(ze,1,()=>e($),ct,(De,Ge)=>{var Ue=Da(),Ze=l(Ue,!0);s(Ue);var L={};B(()=>{x(Ze,(e(Ge),n(()=>e(Ge).name))),L!==(L=(e(Ge),n(()=>e(Ge).id)))&&(Ue.value=(Ue.__value=(e(Ge),n(()=>e(Ge).id)))??"")}),v(De,Ue)}),s(be);var Le;Ot(be),s(fe),B(()=>{Le!==(Le=(t(),n(()=>t().subclass)))&&(be.value=(be.__value=(t(),n(()=>t().subclass)))??"",Et(be,(t(),n(()=>t().subclass))))}),S("change",be,T),v(de,fe)};w(ae,de=>{e($),n(()=>e($).length>0)&&de(m)})}var A=a(ae,2),z=a(l(A),2);xe(z),s(A);var oe=a(A,2),p=a(l(oe),2);xe(p),s(oe);var R=a(oe,2),Y=a(l(R),2);xe(Y),s(R);var N=a(R,2),Re=a(l(N),2);xe(Re),s(N),s(ie),B(()=>{_!==(_=(t(),n(()=>t().class)))&&(G.value=(G.__value=(t(),n(()=>t().class)))??"",Et(G,(t(),n(()=>t().class)))),la(z,(t(),n(()=>t().level)))}),$e(Z,()=>t().name,de=>Ke(q,n(t).name=de,n(t))),S("change",G,f),S("change",z,X),$e(p,()=>t().race,de=>Ke(q,n(t).race=de,n(t))),$e(Y,()=>t().background,de=>Ke(q,n(t).background=de,n(t))),$e(Re,()=>t().alignment,de=>Ke(q,n(t).alignment=de,n(t))),v(ve,ie)};w(le,ve=>{c(),n(()=>!c().characterInfo)&&ve(H)})}s(U),B(()=>{st(se,"aria-label",(c(),n(()=>c().characterInfo?"Expand":"Collapse"))),x(me,(c(),n(()=>c().characterInfo?"â–¼":"â–²")))}),S("click",se,Q),v(r,U),ft(),g()}var Ma=h('<div class="ability-card svelte-bbv1xt"><h3 class="svelte-bbv1xt"> </h3> <input type="number" class="ability-score svelte-bbv1xt" min="1" max="30"/> <div class="ability-modifier svelte-bbv1xt"> </div> <button class="roll-btn svelte-bbv1xt">Check</button> <div class="save-row svelte-bbv1xt"><input type="checkbox" class="svelte-bbv1xt"/> <label class="svelte-bbv1xt">Save</label> <button class="roll-btn-small svelte-bbv1xt">Roll</button></div></div>'),Ea=h('<div class="proficiency-bonus svelte-bbv1xt"><label for="profBonus">Proficiency Bonus</label> <input type="number" id="profBonus" class="prof-input svelte-bbv1xt"/></div> <div class="abilities-grid svelte-bbv1xt"></div>',1),Pa=h('<section><div class="header svelte-bbv1xt"><h2 class="svelte-bbv1xt">Ability Scores</h2> <button class="collapse-btn svelte-bbv1xt"> </button></div> <!></section>');function Ba(r,d){pt(d,!1);const t=()=>Ee(Pt,"$abilityModifiers",$),c=()=>Ee(q,"$character",$),y=()=>Ee(yt,"$searchFilter",$),g=()=>Ee(rt,"$collapsedStates",$),[$,E]=ht(),f=D(),T=D(),X=St(),Q=[{key:"strength",label:"Strength"},{key:"dexterity",label:"Dexterity"},{key:"constitution",label:"Constitution"},{key:"intelligence",label:"Intelligence"},{key:"wisdom",label:"Wisdom"},{key:"charisma",label:"Charisma"}];function U(){updateProficiencyBonus()}function pe(G){const re=t()[G],ee=`1d20${re>=0?"+":""}${re}`;X("roll",ee)}function se(G){const re=t()[G],ee=c().saveProficiencies[G]?c().proficiencyBonus:0,_=re+ee,ae=`1d20${_>=0?"+":""}${_}`;X("roll",ae)}function me(){rt.update(G=>({...G,abilityScores:!G.abilityScores}))}qe(()=>y(),()=>{o(f,Q.filter(({label:G})=>y()?G.toLowerCase().includes(y().toLowerCase()):!0))}),qe(()=>(e(f),y()),()=>{o(T,e(f).length>0||!y()||y().toLowerCase().includes("proficiency"))}),gt(),ut();var le=Pa();let H;var ve=l(le),ie=a(l(ve),2),V=l(ie,!0);s(ie),s(ve);var Z=a(ve,2);{var J=G=>{var re=Ea(),ee=He(re),_=a(l(ee),2);xe(_),s(ee);var ae=a(ee,2);nt(ae,5,()=>e(f),ct,(m,A)=>{let z=()=>e(A).key,oe=()=>e(A).label;var p=Ma(),R=l(p),Y=l(R,!0);s(R);var N=a(R,2);xe(N);var Re=a(N,2),de=l(Re);s(Re);var fe=a(Re,2),be=a(fe,2),Te=l(be);xe(Te);var ze=a(Te,2),Le=a(ze,2);s(be),s(p),B(De=>{x(Y,De),x(de,`${t(),z(),n(()=>t()[z()]>=0?"+":"")??""}${t(),z(),n(()=>t()[z()])??""}`),st(Te,"id",`${z()}-save`),st(ze,"for",`${z()}-save`)},[()=>(oe(),n(()=>oe().substring(0,3).toUpperCase()))]),$e(N,()=>c().abilities[z()],De=>Ke(q,n(c).abilities[z()]=De,n(c))),S("change",N,U),S("click",fe,()=>pe(z())),ia(Te,()=>c().saveProficiencies[z()],De=>Ke(q,n(c).saveProficiencies[z()]=De,n(c))),S("click",Le,()=>se(z())),v(m,p)}),s(ae),$e(_,()=>c().proficiencyBonus,m=>Ke(q,n(c).proficiencyBonus=m,n(c))),v(G,re)};w(Z,G=>{g(),n(()=>!g().abilityScores)&&G(J)})}s(le),B(()=>{H=it(le,1,"ability-scores svelte-bbv1xt",null,H,{hidden:!e(T)}),st(ie,"aria-label",(g(),n(()=>g().abilityScores?"Expand":"Collapse"))),x(V,(g(),n(()=>g().abilityScores?"â–¼":"â–²")))}),S("click",ie,me),v(r,le),ft(),E()}var Ha=h('<span class="hit-dice-type"> </span>'),Ga=h('<div class="stats-grid svelte-1r5hyyb"><div class="stat-box svelte-1r5hyyb"><label for="armorClass" class="svelte-1r5hyyb">Armor Class</label> <input type="number" id="armorClass" class="stat-input svelte-1r5hyyb"/></div> <div class="stat-box svelte-1r5hyyb"><label for="initiative" class="svelte-1r5hyyb">Initiative</label> <input type="number" id="initiative" class="stat-input svelte-1r5hyyb"/></div> <div class="stat-box svelte-1r5hyyb"><label for="speed" class="svelte-1r5hyyb">Speed</label> <input type="text" id="speed" class="stat-input svelte-1r5hyyb"/></div></div> <div class="hp-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Points</h3> <div class="hp-display svelte-1r5hyyb"><div class="hp-inputs svelte-1r5hyyb"><input type="number" class="hp-current svelte-1r5hyyb" min="0"/> <span class="hp-separator svelte-1r5hyyb">/</span> <input type="number" class="hp-max svelte-1r5hyyb" min="0"/></div> <div class="hp-controls svelte-1r5hyyb"><button class="hp-btn svelte-1r5hyyb">âˆ’</button> <button class="hp-btn svelte-1r5hyyb">+</button> <button class="hp-btn svelte-1r5hyyb">âˆ’5</button> <button class="hp-btn svelte-1r5hyyb">+5</button></div></div> <div class="temp-hp svelte-1r5hyyb"><label for="tempHP" class="svelte-1r5hyyb">Temp HP</label> <input type="number" id="tempHP" min="0" class="svelte-1r5hyyb"/></div></div> <div class="hit-dice-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Dice</h3> <div class="hit-dice-display svelte-1r5hyyb"><input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <span>/</span> <input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <!></div> <div class="hit-dice-controls"><label for="hitDiceCount" class="svelte-1r5hyyb">Roll</label> <input type="number" id="hitDiceCount" class="hit-dice-count-input svelte-1r5hyyb" min="1" value="1"/> <button class="btn btn-primary roll-hit-dice use-enabled svelte-1r5hyyb">ðŸŽ² Roll</button></div></div>',1),Na=h('<section><div class="header svelte-1r5hyyb"><h2 class="svelte-1r5hyyb">Combat Stats</h2> <button class="collapse-btn svelte-1r5hyyb"> </button></div> <!></section>');function Ta(r,d){pt(d,!1);const t=()=>Ee(q,"$character",$),c=()=>Ee(Pt,"$abilityModifiers",$),y=()=>Ee(yt,"$searchFilter",$),g=()=>Ee(rt,"$collapsedStates",$),[$,E]=ht(),f=D(),T=St();function X(V){q.update(Z=>(Z.currentHP=Math.max(0,Math.min(Z.maxHP,Z.currentHP+V)),Z))}function Q(V=1){if(t().hitDice.current<=0){alert("No hit dice remaining!");return}if(!t().class){alert("Please select a class first!");return}const Z=dt(t().class);if(!Z){alert("Invalid class configuration!");return}const J=Math.min(V,t().hitDice.current),G=Z.hitDice,re=c().constitution,ee=re>=0?`+${re}`:`${re}`,_=`${J}${G}${ee}`;T("rollHitDice",{notation:_,hitDie:G,count:J})}function U(){rt.update(V=>({...V,combatStats:!V.combatStats}))}qe(()=>y(),()=>{o(f,!y()||"armor class".includes(y().toLowerCase())||"initiative".includes(y().toLowerCase())||"speed".includes(y().toLowerCase())||"hit points".includes(y().toLowerCase())||"hp".includes(y().toLowerCase())||"hit dice".includes(y().toLowerCase())||"combat".includes(y().toLowerCase()))}),gt(),ut();var pe=Na();let se;var me=l(pe),le=a(l(me),2),H=l(le,!0);s(le),s(me);var ve=a(me,2);{var ie=V=>{var Z=Ga(),J=He(Z),G=l(J),re=a(l(G),2);xe(re),s(G);var ee=a(G,2),_=a(l(ee),2);xe(_),s(ee);var ae=a(ee,2),m=a(l(ae),2);xe(m),s(ae),s(J);var A=a(J,2),z=a(l(A),2),oe=l(z),p=l(oe);xe(p);var R=a(p,4);xe(R),s(oe);var Y=a(oe,2),N=l(Y),Re=a(N,2),de=a(Re,2),fe=a(de,2);s(Y),s(z);var be=a(z,2),Te=a(l(be),2);xe(Te),s(be),s(A);var ze=a(A,2),Le=a(l(ze),2),De=l(Le);xe(De);var Ge=a(De,4);xe(Ge);var Ue=a(Ge,2);{var Ze=I=>{const ye=tt(()=>(W(dt),t(),n(()=>dt(t().class))));var Ce=at(),ke=He(Ce);{var he=k=>{const P=tt(()=>(c(),n(()=>c().constitution)));var te=Ha(),ge=l(te);s(te),B(()=>x(ge,`(${W(e(ye)),n(()=>e(ye).hitDice)??""}${(e(P)>=0?`+${e(P)}`:e(P))??""})`)),v(k,te)};w(ke,k=>{e(ye)&&k(he)})}v(I,Ce)};w(Ue,I=>{t(),n(()=>t().class)&&I(Ze)})}s(Le);var L=a(Le,2),j=a(l(L),2),O=a(j,2);s(L),s(ze),B(()=>{st(p,"max",(t(),n(()=>t().maxHP))),st(De,"max",(t(),n(()=>t().hitDice.max))),st(j,"max",(t(),n(()=>t().hitDice.current))),O.disabled=(t(),n(()=>t().hitDice.current<=0||!t().class))}),$e(re,()=>t().armorClass,I=>Ke(q,n(t).armorClass=I,n(t))),$e(_,()=>t().initiative,I=>Ke(q,n(t).initiative=I,n(t))),$e(m,()=>t().speed,I=>Ke(q,n(t).speed=I,n(t))),$e(p,()=>t().currentHP,I=>Ke(q,n(t).currentHP=I,n(t))),$e(R,()=>t().maxHP,I=>Ke(q,n(t).maxHP=I,n(t))),S("click",N,()=>X(-1)),S("click",Re,()=>X(1)),S("click",de,()=>X(-5)),S("click",fe,()=>X(5)),$e(Te,()=>t().tempHP,I=>Ke(q,n(t).tempHP=I,n(t))),$e(De,()=>t().hitDice.current,I=>Ke(q,n(t).hitDice.current=I,n(t))),$e(Ge,()=>t().hitDice.max,I=>Ke(q,n(t).hitDice.max=I,n(t))),S("input",j,I=>{const ye=I.target,Ce=parseInt(ye.value);Ce>t().hitDice.current&&(ye.value=String(t().hitDice.current)),Ce<1&&(ye.value="1")}),S("click",O,()=>{const I=document.getElementById("hitDiceCount"),ye=parseInt(I?.value||"1");Q(ye)}),v(V,Z)};w(ve,V=>{g(),n(()=>!g().combatStats)&&V(ie)})}s(pe),B(()=>{se=it(pe,1,"combat-stats svelte-1r5hyyb",null,se,{hidden:!e(f)}),st(le,"aria-label",(g(),n(()=>g().combatStats?"Expand":"Collapse"))),x(H,(g(),n(()=>g().combatStats?"â–¼":"â–²")))}),S("click",le,U),v(r,pe),ft(),E()}const Tt={acrobatics:"dexterity",animalHandling:"wisdom",arcana:"intelligence",athletics:"strength",deception:"charisma",history:"intelligence",insight:"wisdom",intimidation:"charisma",investigation:"intelligence",medicine:"wisdom",nature:"intelligence",perception:"wisdom",performance:"charisma",persuasion:"charisma",religion:"intelligence",sleightOfHand:"dexterity",stealth:"dexterity",survival:"wisdom"};var Ua=h('<div class="skill-row svelte-1f1pl16"><input type="checkbox" class="svelte-1f1pl16"/> <label class="svelte-1f1pl16"> <span class="ability-tag svelte-1f1pl16"> </span></label> <span class="skill-modifier svelte-1f1pl16"> </span> <button class="roll-btn svelte-1f1pl16">Roll</button></div>'),Oa=h('<div class="skills-grid svelte-1f1pl16"></div>'),qa=h('<section><div class="header svelte-1f1pl16"><h2 class="svelte-1f1pl16">Skills</h2> <button class="collapse-btn svelte-1f1pl16"> </button></div> <!></section>');function za(r,d){pt(d,!1);const t=()=>Ee(Pt,"$abilityModifiers",$),c=()=>Ee(q,"$character",$),y=()=>Ee(yt,"$searchFilter",$),g=()=>Ee(rt,"$collapsedStates",$),[$,E]=ht(),f=D(),T=D(),X=St(),Q=[{key:"acrobatics",label:"Acrobatics"},{key:"animalHandling",label:"Animal Handling"},{key:"arcana",label:"Arcana"},{key:"athletics",label:"Athletics"},{key:"deception",label:"Deception"},{key:"history",label:"History"},{key:"insight",label:"Insight"},{key:"intimidation",label:"Intimidation"},{key:"investigation",label:"Investigation"},{key:"medicine",label:"Medicine"},{key:"nature",label:"Nature"},{key:"perception",label:"Perception"},{key:"performance",label:"Performance"},{key:"persuasion",label:"Persuasion"},{key:"religion",label:"Religion"},{key:"sleightOfHand",label:"Sleight of Hand"},{key:"stealth",label:"Stealth"},{key:"survival",label:"Survival"}];function U(J){const G=Tt[J],re=t()[G],ee=c().skillProficiencies[J]?c().proficiencyBonus:0;return re+ee}function pe(J){const G=U(J),re=`1d20${G>=0?"+":""}${G}`;X("roll",re)}function se(){rt.update(J=>({...J,skills:!J.skills}))}qe(()=>y(),()=>{o(f,Q.filter(({label:J})=>y()?J.toLowerCase().includes(y().toLowerCase()):!0))}),qe(()=>e(f),()=>{o(T,e(f).length>0)}),gt(),ut();var me=qa();let le;var H=l(me),ve=a(l(H),2),ie=l(ve,!0);s(ve),s(H);var V=a(H,2);{var Z=J=>{var G=Oa();nt(G,5,()=>e(f),ct,(re,ee)=>{let _=()=>e(ee).key,ae=()=>e(ee).label;const m=tt(()=>(W(Tt),_(),n(()=>Tt[_()]))),A=tt(()=>(_(),n(()=>U(_()))));var z=Ua(),oe=l(z);xe(oe);var p=a(oe,2),R=l(p),Y=a(R),N=l(Y);s(Y),s(p);var Re=a(p,2),de=l(Re);s(Re);var fe=a(Re,2);s(z),B(be=>{st(oe,"id",_()),st(p,"for",_()),x(R,`${ae()??""} `),x(N,`(${be??""})`),x(de,`${e(A)>=0?"+":""}${e(A)??""}`)},[()=>(W(e(m)),n(()=>e(m).substring(0,3).toUpperCase()))]),ia(oe,()=>c().skillProficiencies[_()],be=>Ke(q,n(c).skillProficiencies[_()]=be,n(c))),S("click",fe,()=>pe(_())),v(re,z)}),s(G),v(J,G)};w(V,J=>{g(),n(()=>!g().skills)&&J(Z)})}s(me),B(()=>{le=it(me,1,"skills svelte-1f1pl16",null,le,{hidden:!e(T)}),st(ve,"aria-label",(g(),n(()=>g().skills?"Expand":"Collapse"))),x(ie,(g(),n(()=>g().skills?"â–¼":"â–²")))}),S("click",ve,se),v(r,me),ft(),E()}let Rt=null,It=null;async function na(){if(Rt)return Rt;try{return Rt=await(await fetch(ra("/data/spells.json"))).json(),Rt||[]}catch(r){return console.error("Failed to load spells:",r),[]}}async function Wa(){if(It)return It;try{return It=await(await fetch(ra("/data/feats.json"))).json(),It||[]}catch(r){return console.error("Failed to load feats:",r),[]}}function Qt(r,d){if(!d.trim())return r;const t=d.toLowerCase();return r.filter(c=>c.name.toLowerCase().includes(t)||c.school.toLowerCase().includes(t)||c.classes.some(y=>y.toLowerCase().includes(t))||c.description.toLowerCase().includes(t))}function Va(r,d){return d===null?r:r.filter(t=>t.level===d)}function Ja(r,d){if(!d.trim())return r;const t=d.toLowerCase();return r.filter(c=>c.name.toLowerCase().includes(t)||c.description.toLowerCase().includes(t))}var Ka=h('<button class="btn-remove svelte-14o91c5">Ã—</button>'),Qa=h('<div class="spell-info-loading svelte-14o91c5">Loading spell info...</div>'),Xa=h('<li class="svelte-14o91c5"><strong>At Higher Levels:</strong> </li>'),Ya=h('<div class="spell-notes svelte-14o91c5"><h4 class="svelte-14o91c5">General Notes</h4> <p> </p></div>'),Za=h('<div class="spell-info svelte-14o91c5"><h4 class="svelte-14o91c5">Spell Info</h4> <ul class="svelte-14o91c5"><li class="svelte-14o91c5"><strong>Level:</strong> </li> <li class="svelte-14o91c5"><strong>Casting Time:</strong> </li> <li class="svelte-14o91c5"><strong>Range:</strong> </li> <li class="svelte-14o91c5"><strong>Components:</strong> <!></li> <li class="svelte-14o91c5"><strong>Duration:</strong> <!> </li> <li class="svelte-14o91c5"><strong>Description:</strong> </li> <!></ul></div> <!>',1),es=h('<div class="spell-info-missing svelte-14o91c5">Spell info not found.</div>'),ts=h('<div class="attack-notes svelte-14o91c5"><label class="svelte-14o91c5">Notes</label> <textarea placeholder="e.g., DC 15 Dex save, Range 120 ft, Concentration" class="notes-input svelte-14o91c5" rows="2"></textarea></div>'),as=h('<div class="attack-card svelte-14o91c5"><div class="attack-header svelte-14o91c5"><input type="text" placeholder="Attack name" class="attack-name svelte-14o91c5"/> <!></div> <div class="attack-details svelte-14o91c5"><div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Bonus</label> <input type="number" class="attack-bonus svelte-14o91c5"/></div> <div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Damage</label> <input type="text" placeholder="e.g., 2d6+3" class="attack-damage svelte-14o91c5"/></div> <div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Type</label> <input type="text" placeholder="e.g., slashing" class="attack-type svelte-14o91c5"/></div></div> <!> <!> <div class="attack-actions svelte-14o91c5"><button class="btn btn-primary">Roll Attack</button> <button class="btn btn-secondary">Roll Damage</button></div></div>'),ss=h('<p class="no-attacks svelte-14o91c5">No attacks added yet. Click "Add Attack" to create one.</p>'),ls=h('<p class="no-attacks svelte-14o91c5">No attacks match your search.</p>'),is=h('<button class="btn btn-secondary">Add Attack</button> <div class="attacks-list svelte-14o91c5"><!> <!></div>',1),rs=h('<section><div class="header svelte-14o91c5"><h2 class="svelte-14o91c5">Attacks & Spells</h2> <button class="collapse-btn svelte-14o91c5"> </button></div> <!></section>');function ns(r,d){pt(d,!1);const t=()=>Ee(q,"$character",$),c=()=>Ee(yt,"$searchFilter",$),y=()=>Ee(rt,"$collapsedStates",$),g=()=>Ee(Mt,"$isEditMode",$),[$,E]=ht(),f=D(),T=D(),X=St();function Q(){q.update(_=>(_.attacks=[..._.attacks,{id:crypto.randomUUID(),name:"",bonus:0,damage:"",damageType:"",notes:""}],_))}function U(_){q.update(ae=>(ae.attacks=ae.attacks.filter(m=>m.id!==_),ae))}function pe(_){if(_.spellRef){const m=H(_.spellRef);if(m&&m.level>0){const A=_.castAtLevel||m.level;if(!ve(A)){alert(`No level ${A} spell slots available!`);return}}}const ae=`1d20${_.bonus>=0?"+":""}${_.bonus}`;X("roll",{notation:ae,damageNotation:_.damage,attackName:_.name})}function se(_){if(!_.damage){alert(`${_.name}: No damage specified`);return}X("roll",{notation:_.damage})}function me(){rt.update(_=>({..._,attacks:!_.attacks}))}let le=D([]);Ft(async()=>{o(le,await na())});function H(_){return e(le).find(ae=>ae.name===_)}function ve(_){t().classFeatures.spellSlotsByLevel||Ke(q,n(t).classFeatures.spellSlotsByLevel={},n(t)),t().classFeatures.spellSlotsByLevel[_]||Ke(q,n(t).classFeatures.spellSlotsByLevel[_]=Array(2).fill(!1),n(t));const m=t().classFeatures.spellSlotsByLevel[_].findIndex(A=>!A);return m===-1?!1:(q.update(A=>(A.classFeatures.spellSlotsByLevel||(A.classFeatures.spellSlotsByLevel={}),A.classFeatures.spellSlotsByLevel[_]||(A.classFeatures.spellSlotsByLevel[_]=Array(2).fill(!1)),A.classFeatures.spellSlotsByLevel[_][m]=!0,A)),!0)}qe(()=>(t(),c()),()=>{o(f,t().attacks.filter(_=>{if(!c())return!0;const ae=c().toLowerCase();return _.name.toLowerCase().includes(ae)||_.damageType.toLowerCase().includes(ae)}).sort((_,ae)=>!_.spellRef&&ae.spellRef?-1:_.spellRef&&!ae.spellRef?1:0))}),qe(()=>(c(),e(f)),()=>{o(T,!c()||e(f).length>0||"attack".includes(c().toLowerCase())||"spell".includes(c().toLowerCase()))}),gt(),ut();var ie=rs();let V;var Z=l(ie),J=a(l(Z),2),G=l(J,!0);s(J),s(Z);var re=a(Z,2);{var ee=_=>{var ae=is(),m=He(ae),A=a(m,2),z=l(A);nt(z,1,()=>e(f),Y=>Y.id,(Y,N,Re)=>{var de=as(),fe=l(de),be=l(fe);xe(be);var Te=a(be,2);{var ze=P=>{var te=Ka();S("click",te,()=>U(e(N).id)),v(P,te)};w(Te,P=>{g()&&P(ze)})}s(fe);var Le=a(fe,2),De=l(Le),Ge=a(l(De),2);xe(Ge),s(De);var Ue=a(De,2),Ze=a(l(Ue),2);xe(Ze),s(Ue);var L=a(Ue,2),j=a(l(L),2);xe(j),s(L),s(Le);var O=a(Le,2);{var I=P=>{var te=at(),ge=He(te);{var Pe=Se=>{var F=Qa();v(Se,F)},Je=Se=>{const F=tt(()=>(e(N),n(()=>H(e(N).spellRef))));var ce=at(),we=He(ce);{var Ie=i=>{var u=Za(),C=He(u),b=a(l(C),2),M=l(b),ne=a(l(M));s(M);var je=a(M,2),_e=a(l(je));s(je);var Fe=a(je,2),Ae=a(l(Fe));s(Fe);var Be=a(Fe,2),We=a(l(Be)),Xe=a(We);{var Oe=Ye=>{var ot=mt();B(()=>x(ot,`(${W(e(F)),n(()=>e(F).material)??""})`)),v(Ye,ot)};w(Xe,Ye=>{W(e(F)),n(()=>e(F).material)&&Ye(Oe)})}s(Be);var Ve=a(Be,2),et=a(l(Ve),2);{var Me=Ye=>{var ot=mt("Concentration,");v(Ye,ot)};w(et,Ye=>{W(e(F)),n(()=>e(F).concentration)&&Ye(Me)})}var Qe=a(et,1,!0);s(Ve);var lt=a(Ve,2),ue=a(l(lt));s(lt);var Ne=a(lt,2);{var vt=Ye=>{var ot=Xa(),At=a(l(ot));s(ot),B(()=>x(At,` ${W(e(F)),n(()=>e(F).higherLevelSlot)??""}`)),v(Ye,ot)};w(Ne,Ye=>{W(e(F)),n(()=>e(F).higherLevelSlot)&&Ye(vt)})}s(b),s(C);var bt=a(C,2);{var kt=Ye=>{var ot=Ya(),At=a(l(ot),2),oa=l(At,!0);s(At),s(ot),B(()=>x(oa,(e(N),n(()=>e(N).generalNotes)))),v(Ye,ot)};w(bt,Ye=>{e(N),n(()=>e(N).generalNotes)&&Ye(kt)})}B(Ye=>{x(ne,` ${W(e(F)),n(()=>e(F).level)??""}`),x(_e,` ${W(e(F)),n(()=>e(F).castingTime||e(F).actionType)??""}`),x(Ae,` ${W(e(F)),n(()=>e(F).range)??""}`),x(We,` ${Ye??""}`),x(Qe,(W(e(F)),n(()=>e(F).duration))),x(ue,` ${W(e(F)),n(()=>e(F).description)??""}`)},[()=>(W(e(F)),n(()=>e(F).components.join(", ")))]),v(i,u)},K=i=>{var u=es();v(i,u)};w(we,i=>{e(F)?i(Ie):i(K,!1)})}v(Se,ce)};w(ge,Se=>{e(le),n(()=>e(le).length===0)?Se(Pe):Se(Je,!1)})}v(P,te)};w(O,P=>{e(N),n(()=>e(N).spellRef)&&P(I)})}var ye=a(O,2);{var Ce=P=>{var te=ts(),ge=a(l(te),2);Lt(ge),s(te),$e(ge,()=>e(N).notes,Pe=>(e(N).notes=Pe,xt(()=>(e(f),t(),c())))),v(P,te)};w(ye,P=>{e(N),n(()=>!e(N).spellRef)&&P(Ce)})}var ke=a(ye,2),he=l(ke),k=a(he,2);s(ke),s(de),$e(be,()=>e(N).name,P=>(e(N).name=P,xt(()=>(e(f),t(),c())))),$e(Ge,()=>e(N).bonus,P=>(e(N).bonus=P,xt(()=>(e(f),t(),c())))),$e(Ze,()=>e(N).damage,P=>(e(N).damage=P,xt(()=>(e(f),t(),c())))),$e(j,()=>e(N).damageType,P=>(e(N).damageType=P,xt(()=>(e(f),t(),c())))),S("click",he,()=>pe(e(N))),S("click",k,()=>se(e(N))),v(Y,de)});var oe=a(z,2);{var p=Y=>{var N=ss();v(Y,N)},R=Y=>{var N=at(),Re=He(N);{var de=fe=>{var be=ls();v(fe,be)};w(Re,fe=>{e(f),n(()=>e(f).length===0)&&fe(de)},!0)}v(Y,N)};w(oe,Y=>{t(),n(()=>t().attacks.length===0)?Y(p):Y(R,!1)})}s(A),S("click",m,Q),v(_,ae)};w(re,_=>{y(),n(()=>!y().attacks)&&_(ee)})}s(ie),B(()=>{V=it(ie,1,"attacks svelte-14o91c5",null,V,{hidden:!e(T)}),st(J,"aria-label",(y(),n(()=>y().attacks?"Expand":"Collapse"))),x(G,(y(),n(()=>y().attacks?"â–¼":"â–²")))}),S("click",J,me),v(r,ie),ft(),E()}var os=h('<p class="no-features svelte-1kpvv0n">Select a class to see available features</p>'),cs=h('<p class="no-features svelte-1kpvv0n">No class features available at this level</p>'),vs=h('<input type="checkbox" class="slot-checkbox svelte-1kpvv0n"/>'),ds=h('<div class="spell-slots svelte-1kpvv0n"><label class="svelte-1kpvv0n"> </label> <div class="slots-tracker svelte-1kpvv0n"><!> <button class="btn-small svelte-1kpvv0n">Long Rest</button></div></div>'),us=h('<div class="all-spell-slots"></div>'),ps=h('<div class="feature-box spellcasting svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"> </h3> <div class="spell-stats svelte-1kpvv0n"><div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Spell Save DC</label> <div class="spell-value svelte-1kpvv0n"> </div></div> <div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <div class="spell-value svelte-1kpvv0n"> </div></div></div> <!> <div class="prepared-spells svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <textarea placeholder="List your prepared spells..." class="svelte-1kpvv0n"></textarea></div></div>'),fs=h('<p class="unlimited svelte-1kpvv0n">Unlimited Uses</p>'),bs=h('<p class="no-uses svelte-1kpvv0n">No uses remaining</p>'),ms=h('<div class="uses-with-button svelte-1kpvv0n"><button class="btn btn-primary use-enabled"> </button> <div class="uses-info svelte-1kpvv0n"><span class="uses-remaining svelte-1kpvv0n"> </span> <span class="reset-info svelte-1kpvv0n"> </span></div> <!></div>'),hs=h('<div class="uses-tracker svelte-1kpvv0n"><!></div>'),gs=h('<div class="pool-tracker svelte-1kpvv0n"><input type="number" min="0" class="pool-input svelte-1kpvv0n"/> <span> </span> <button class="btn-small svelte-1kpvv0n"> </button></div>'),_s=h('<p class="no-uses svelte-1kpvv0n">No Channel Divinity uses remaining</p>'),ys=h('<div class="channel-divinity-option svelte-1kpvv0n"><button class="btn btn-primary use-enabled svelte-1kpvv0n">Use Channel Divinity</button> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div> <!></div>'),ks=h('<div class="feature-box svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"><!> </h3> <p class="feature-description svelte-1kpvv0n"> </p> <!></div>'),xs=h('<div class="features-grid svelte-1kpvv0n"><!> <!></div>'),$s=h('<section><div class="header svelte-1kpvv0n"><h2 class="svelte-1kpvv0n">Class Features</h2> <button class="collapse-btn svelte-1kpvv0n"> </button></div> <!></section>');function Cs(r,d){pt(d,!1);const t=()=>Ee(q,"$character",$),c=()=>Ee(Pt,"$abilityModifiers",$),y=()=>Ee(yt,"$searchFilter",$),g=()=>Ee(rt,"$collapsedStates",$),[$,E]=ht(),f=D(),T=D(),X=D(),Q=D(),U=D(),pe=D(),se=D();let me=D(0),le=D(0);function H(p,R){q.update(Y=>(Y.classFeatures.features[p]=R,Y))}function ve(p,R){q.update(Y=>(Y.classFeatures.spellSlotsByLevel||(Y.classFeatures.spellSlotsByLevel={}),Y.classFeatures.spellSlotsByLevel[p]=Array(R).fill(!1),Y))}function ie(){q.update(p=>(p.classFeatures.spellSlotsByLevel||(p.classFeatures.spellSlotsByLevel={}),e(Q).forEach(({level:R,slots:Y})=>{p.classFeatures.spellSlotsByLevel[R]||(p.classFeatures.spellSlotsByLevel[R]=Array(Y).fill(!1))}),p))}function V(p){if(typeof p.maxUses=="function"){if((p.name==="Divine Sense"||p.name==="War Priest")&&e(f)?.spellcastingAbility){const R=c()[e(f).spellcastingAbility];return p.maxUses(t().level,R)}return p.maxUses(t().level)}return p.maxUses||0}function Z(p){return typeof p.maxPool=="function"?p.maxPool(t().level):p.maxPool||0}function J(p){return typeof p.description=="function"?p.description(t().level):p.description}function G(){const p="ChannelDivinity";q.update(R=>{const Y=R.classFeatures.features[p];return typeof Y=="number"&&Y>0&&(R.classFeatures.features[p]=Y-1),R})}function re(){rt.update(p=>({...p,classFeatures:!p.classFeatures}))}qe(()=>(t(),dt),()=>{o(f,t().class?dt(t().class):null)}),qe(()=>(t(),Dt),()=>{o(T,t().class?Dt(t().class,t().level,t().subclass):[])}),qe(()=>(t(),Jt),()=>{o(X,t().class?Jt(t().class,t().level):0)}),qe(()=>(e(f),t()),()=>{o(Q,(()=>{if(!e(f)?.spellcaster)return[];const p=t().level,R=[];return p>=1&&R.push({level:1,slots:Math.min(4,2+Math.floor(p/3))}),p>=3&&R.push({level:2,slots:Math.min(3,2+Math.floor((p-3)/4))}),p>=5&&R.push({level:3,slots:Math.min(3,2+Math.floor((p-5)/5))}),p>=7&&R.push({level:4,slots:Math.min(3,1+Math.floor((p-7)/6))}),p>=9&&R.push({level:5,slots:Math.min(2,1+Math.floor((p-9)/8))}),p>=11&&R.push({level:6,slots:1}),p>=13&&R.push({level:7,slots:1}),p>=15&&R.push({level:8,slots:1}),p>=17&&R.push({level:9,slots:1}),R})())}),qe(()=>(e(f),c(),t(),Kt),()=>{if(e(f)?.spellcaster&&e(f).spellcastingAbility){const p=c()[e(f).spellcastingAbility];o(me,ja(t().class,p,t().proficiencyBonus)||0),o(le,Kt(t().class,t().level,p))}}),qe(()=>(t(),e(f),e(Q)),()=>{t().class&&e(f)?.spellcaster&&e(Q).length>0&&ie()}),qe(()=>t(),()=>{o(U,(()=>{const R=t().classFeatures.features["ChannelDivinity"];return typeof R=="number"?R:0})())}),qe(()=>(e(T),y()),()=>{o(pe,e(T).filter(p=>{if(!y())return!0;const R=y().toLowerCase();return p.name.toLowerCase().includes(R)||J(p).toLowerCase().includes(R)}))}),qe(()=>(y(),t(),e(pe)),()=>{o(se,!y()||t().class||"class features".includes(y().toLowerCase())||"spellcasting".includes(y().toLowerCase())||e(pe).length>0)}),gt(),ut();var ee=$s();let _;var ae=l(ee),m=a(l(ae),2),A=l(m,!0);s(m),s(ae);var z=a(ae,2);{var oe=p=>{var R=at(),Y=He(R);{var N=de=>{var fe=os();v(de,fe)},Re=de=>{var fe=at(),be=He(fe);{var Te=Le=>{var De=cs();v(Le,De)},ze=Le=>{var De=xs(),Ge=l(De);{var Ue=L=>{var j=ps(),O=l(j),I=l(O);s(O);var ye=a(O,2),Ce=l(ye),ke=a(l(Ce),2),he=l(ke,!0);s(ke),s(Ce);var k=a(Ce,2),P=a(l(k),2),te=l(P,!0);s(P),s(k),s(ye);var ge=a(ye,2);{var Pe=F=>{var ce=us();nt(ce,5,()=>e(Q),ct,(we,Ie)=>{let K=()=>e(Ie).level,i=()=>e(Ie).slots;const u=tt(()=>(t(),K(),i(),n(()=>t().classFeatures.spellSlotsByLevel?.[K()]||Array(i()).fill(!1))));var C=ds(),b=l(C),M=l(b);s(b);var ne=a(b,2),je=l(ne);nt(je,1,()=>(i(),n(()=>Array(i()))),ct,(Fe,Ae,Be)=>{var We=vs();xe(We),B(()=>ga(We,(W(e(u)),n(()=>e(u)[Be]||!1)))),S("change",We,Xe=>{q.update(Oe=>(Oe.classFeatures.spellSlotsByLevel||(Oe.classFeatures.spellSlotsByLevel={}),Oe.classFeatures.spellSlotsByLevel[K()]||(Oe.classFeatures.spellSlotsByLevel[K()]=Array(i()).fill(!1)),Oe.classFeatures.spellSlotsByLevel[K()][Be]=Xe.currentTarget.checked,Oe))}),v(Fe,We)});var _e=a(je,2);s(ne),s(C),B(()=>x(M,`${K()===1?"1st":K()===2?"2nd":K()===3?"3rd":`${K()}th`} Level Spell Slots`)),S("click",_e,()=>ve(K(),i())),v(we,C)}),s(ce),v(F,ce)};w(ge,F=>{e(Q),n(()=>e(Q).length>0)&&F(Pe)})}var Je=a(ge,2),Se=a(l(Je),2);Lt(Se),s(Je),s(j),B(F=>{x(I,`Spellcasting (${F??""})`),x(he,e(me)),x(te,e(le))},[()=>(e(f),n(()=>e(f).spellcastingAbility?.toUpperCase()))]),$e(Se,()=>t().classFeatures.preparedSpells,F=>Ke(q,n(t).classFeatures.preparedSpells=F,n(t))),v(L,j)};w(Ge,L=>{e(f),n(()=>e(f)?.spellcaster)&&L(Ue)})}var Ze=a(Ge,2);nt(Ze,1,()=>e(pe),ct,(L,j)=>{const O=tt(()=>(e(j),n(()=>e(j).name.replace(/\s+/g,"")))),I=tt(()=>(t(),W(e(O)),n(()=>t().classFeatures.features[e(O)]))),ye=tt(()=>(W(e(I)),n(()=>Array.isArray(e(I))))),Ce=tt(()=>typeof e(I)=="number");var ke=ks(),he=l(ke),k=l(he);{var P=ce=>{var we=mt("Channel Divinity:");v(ce,we)};w(k,ce=>{e(j),n(()=>e(j).type==="channelDivinity")&&ce(P)})}var te=a(k);s(he);var ge=a(he,2),Pe=l(ge,!0);s(ge);var Je=a(ge,2);{var Se=ce=>{const we=tt(()=>(e(j),n(()=>V(e(j))))),Ie=tt(()=>(W(e(ye)),W(e(we)),W(e(I)),n(()=>e(ye)?e(I).filter(M=>!M).length:e(we))));var K=hs(),i=l(K);{var u=b=>{var M=fs();v(b,M)},C=b=>{var M=ms(),ne=l(M),je=l(ne);s(ne);var _e=a(ne,2),Fe=l(_e),Ae=l(Fe);s(Fe);var Be=a(Fe,2),We=l(Be);s(Be),s(_e);var Xe=a(_e,2);{var Oe=Ve=>{var et=bs();v(Ve,et)};w(Xe,Ve=>{e(Ie)<=0&&Ve(Oe)})}s(M),B(()=>{ne.disabled=e(Ie)<=0,x(je,`Use ${e(j),n(()=>e(j).name)??""}`),x(Ae,`${e(Ie)??""} / ${e(we)??""} uses`),x(We,`Resets on ${e(j),n(()=>e(j).resetOn==="short"?"Short Rest":"Long Rest")??""}`)}),S("click",ne,()=>{q.update(Ve=>{Ve.classFeatures.features[e(O)]||(Ve.classFeatures.features[e(O)]=Array(e(we)).fill(!1));const et=Ve.classFeatures.features[e(O)],Me=et.findIndex(Qe=>!Qe);return Me!==-1&&(et[Me]=!0),Ve})}),v(b,M)};w(i,b=>{e(we)===1/0?b(u):b(C,!1)})}s(K),v(ce,K)},F=ce=>{var we=at(),Ie=He(we);{var K=u=>{const C=tt(()=>(e(j),n(()=>Z(e(j)))));var b=gs(),M=l(b);xe(M);var ne=a(M,2),je=l(ne);s(ne);var _e=a(ne,2),Fe=l(_e,!0);s(_e),s(b),B(()=>{la(M,e(Ce)&&e(I)!==void 0?e(I):e(C)),st(M,"max",e(C)),x(je,`/ ${e(C)??""}`),x(Fe,(e(j),n(()=>e(j).resetOn==="short"?"Short Rest":"Long Rest")))}),S("input",M,Ae=>{q.update(Be=>(Be.classFeatures.features[e(O)]=parseInt(Ae.currentTarget.value)||0,Be))}),S("click",_e,()=>H(e(O),e(C))),v(u,b)},i=u=>{var C=at(),b=He(C);{var M=ne=>{var je=ys(),_e=l(je),Fe=a(_e,2),Ae=l(Fe),Be=l(Ae);s(Ae),s(Fe);var We=a(Fe,2);{var Xe=Oe=>{var Ve=_s();v(Oe,Ve)};w(We,Oe=>{e(U)<=0&&Oe(Xe)})}s(je),B(()=>{_e.disabled=e(U)<=0,x(Be,`Resets on ${e(j),n(()=>e(j).resetOn==="short"?"Short Rest":"Long Rest")??""}`)}),S("click",_e,G),v(ne,je)};w(b,ne=>{e(j),n(()=>e(j).type==="channelDivinity")&&ne(M)},!0)}v(u,C)};w(Ie,u=>{e(j),n(()=>e(j).type==="pool")?u(K):u(i,!1)},!0)}v(ce,we)};w(Je,ce=>{e(j),n(()=>e(j).type==="uses")?ce(Se):ce(F,!1)})}s(ke),B(ce=>{x(te,` ${e(j),n(()=>e(j).name)??""}`),x(Pe,ce)},[()=>(e(j),n(()=>J(e(j))))]),v(L,ke)}),s(De),v(Le,De)};w(be,Le=>{e(T),n(()=>e(T).length===0)?Le(Te):Le(ze,!1)},!0)}v(de,fe)};w(Y,de=>{t(),n(()=>!t().class)?de(N):de(Re,!1)})}v(p,R)};w(z,p=>{g(),n(()=>!g().classFeatures)&&p(oe)})}s(ee),B(()=>{_=it(ee,1,"class-features svelte-1kpvv0n",null,_,{hidden:!e(se)}),st(m,"aria-label",(g(),n(()=>g().classFeatures?"Expand":"Collapse"))),x(A,(g(),n(()=>g().classFeatures?"â–¼":"â–²")))}),S("click",m,re),v(r,ee),ft(),E()}var Ss=h('<textarea placeholder="Enter features, traits, and special abilities..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Equipment</h3> <textarea placeholder="List your equipment and inventory..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Notes</h3> <textarea placeholder="Additional notes..." class="svelte-wttn0l"></textarea>',1),js=h('<section><div class="header svelte-wttn0l"><h2 class="svelte-wttn0l">Features & Traits</h2> <button class="collapse-btn svelte-wttn0l"> </button></div> <!></section>');function Ls(r,d){pt(d,!1);const t=()=>Ee(yt,"$searchFilter",g),c=()=>Ee(q,"$character",g),y=()=>Ee(rt,"$collapsedStates",g),[g,$]=ht(),E=D();function f(){rt.update(le=>({...le,notes:!le.notes}))}qe(()=>(t(),c()),()=>{o(E,!t()||"features".includes(t().toLowerCase())||"traits".includes(t().toLowerCase())||"equipment".includes(t().toLowerCase())||"notes".includes(t().toLowerCase())||c().features.toLowerCase().includes(t().toLowerCase())||c().equipment.toLowerCase().includes(t().toLowerCase())||c().notes.toLowerCase().includes(t().toLowerCase()))}),gt(),ut();var T=js();let X;var Q=l(T),U=a(l(Q),2),pe=l(U,!0);s(U),s(Q);var se=a(Q,2);{var me=le=>{var H=Ss(),ve=He(H);Lt(ve);var ie=a(ve,4);Lt(ie);var V=a(ie,4);Lt(V),$e(ve,()=>c().features,Z=>Ke(q,n(c).features=Z,n(c))),$e(ie,()=>c().equipment,Z=>Ke(q,n(c).equipment=Z,n(c))),$e(V,()=>c().notes,Z=>Ke(q,n(c).notes=Z,n(c))),v(le,H)};w(se,le=>{y(),n(()=>!y().notes)&&le(me)})}s(T),B(()=>{X=it(T,1,"notes svelte-wttn0l",null,X,{hidden:!e(E)}),st(U,"aria-label",(y(),n(()=>y().notes?"Expand":"Collapse"))),x(pe,(y(),n(()=>y().notes?"â–¼":"â–²")))}),S("click",U,f),v(r,T),ft(),$()}var ws=h('<div class="color-picker-section svelte-1r90jgp"><h3 class="svelte-1r90jgp">Dice Colors</h3> <div class="color-inputs svelte-1r90jgp"><div class="color-input-group svelte-1r90jgp"><label for="dice-color" class="svelte-1r90jgp">Dice Color</label> <input type="color" id="dice-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="label-color" class="svelte-1r90jgp">Label Color</label> <input type="color" id="label-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="desk-color" class="svelte-1r90jgp">Background Color</label> <input type="color" id="desk-color" class="svelte-1r90jgp"/></div></div></div>'),Ds=h('<div class="loading svelte-1r90jgp"><p class="svelte-1r90jgp">Loading 3D dice...</p></div>'),Fs=h('<div class="custom-dice-selector svelte-1r90jgp"><h3 class="svelte-1r90jgp">Choose Dice to Roll</h3> <div class="dice-inputs svelte-1r90jgp"><div class="dice-input-group svelte-1r90jgp"><label for="d4" class="svelte-1r90jgp">d4</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d4" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d6" class="svelte-1r90jgp">d6</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d6" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d8" class="svelte-1r90jgp">d8</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d8" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d10" class="svelte-1r90jgp">d10</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d10" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d12" class="svelte-1r90jgp">d12</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d12" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d20" class="svelte-1r90jgp">d20</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d20" min="0" max="10"/></div></div> <div class="dice-controls svelte-1r90jgp"><button class="btn btn-primary use-enabled svelte-1r90jgp"> </button> <button class="btn btn-secondary use-enabled svelte-1r90jgp">Reset</button></div></div>'),As=h('<span class="crit-badge svelte-1r90jgp">CRITICAL!</span>'),Rs=h('<p class="svelte-1r90jgp"> </p>'),Is=h('<p class="modifier-text svelte-1r90jgp"> </p>'),Ms=h('<button class="btn btn-follow-up svelte-1r90jgp"> </button>'),Es=h('<button class="btn btn-guided-strike svelte-1r90jgp">âš¡ Use Guided Strike (+10)</button>'),Ps=h('<div class="follow-up-actions svelte-1r90jgp"><!> <!></div>'),Bs=h('<div class="result-header svelte-1r90jgp"><h3 class="svelte-1r90jgp"> </h3> <!></div> <div class="result-total svelte-1r90jgp"> </div> <div class="result-details svelte-1r90jgp"><!> <!></div> <!>',1),Hs=h('<div role="button" tabindex="-1"><div class="modal-content svelte-1r90jgp" role="dialog" tabindex="0"><div class="modal-header svelte-1r90jgp"><h2 class="svelte-1r90jgp">Dice Roller</h2> <div class="header-buttons svelte-1r90jgp"><button class="color-btn svelte-1r90jgp" title="Customize dice colors">ðŸŽ¨</button> <button class="close-btn svelte-1r90jgp">Ã—</button></div></div> <!> <!> <div class="dice-main-area svelte-1r90jgp"><div class="dice-container svelte-1r90jgp"></div> <!></div> <div><!></div></div></div>');function Gs(r,d){pt(d,!1);const t=()=>Ee(q,"$character",c),[c,y]=ht(),g=D(),$=D(),E=D(),f=St();let T=$t(d,"notation",12,""),X=$t(d,"visible",8,!1),Q=$t(d,"damageNotation",12,""),U=$t(d,"attackName",12,""),pe=null,se=D(void 0),me=D(!1),le=D(""),H=D(null);function ve(){return e(H)?.resultTotal??null}let ie=D(0),V=D(0),Z=D(0),J=D(0),G=D(0),re=D(0),ee=D(0),_=D([]),ae=D(!1),m=D("other"),A=D(!1),z=D("#051e0a"),oe=D("#ffffff"),p=D("#3a2004"),R=D(!1);function Y(i){return i.length===9&&i.startsWith("#")?i.substring(0,7):i}function N(i,u="ff"){return i.length===7&&i.startsWith("#")?i+u:i}function Re(){if(window.DICE&&e(se))try{pe&&e(se)&&pa(se,e(se).innerHTML="");const i=e(se).clientWidth||500,u=e(se).clientHeight||300;pe=new window.DICE.dice_box(e(se),{w:i,h:u}),o(me,!0)}catch(i){console.error("Error initializing dice box:",i)}}Ft(()=>{const i=b=>new Promise((M,ne)=>{if(document.querySelector(`script[src="${b}"]`)){console.log(`Script already loaded: ${b}`),M(null);return}const _e=document.createElement("script");_e.src=b,_e.onload=()=>{console.log(`Loaded: ${b}`),M(null)},_e.onerror=()=>{console.error(`Failed to load: ${b}`),ne(new Error(`Failed to load ${b}`))},document.head.appendChild(_e)});setTimeout(()=>{i(`${jt}/libs/three.min.js`).then(()=>i(`${jt}/libs/cannon.min.js`)).then(()=>i(`${jt}/libs/teal.js`)).then(()=>i(`${jt}/dice.js`)).then(()=>{if(console.log("All scripts loaded, initializing dice box..."),console.log("DICE available:",!!window.DICE),console.log("Container available:",!!e(se)),window.DICE){const b=window.DICE.getColors();o(z,Y(b.dice_color)),o(oe,Y(b.label_color)),o(p,Y(b.desk_color))}Re()}).catch(b=>{console.error("Failed to load dice libraries:",b)})},100);const u=()=>{e(me)&&(console.log("Window resized, reinitializing dice box..."),Re())},C=b=>{X()&&b.key==="Escape"&&Ue()};return window.addEventListener("resize",u),window.addEventListener("keydown",C),()=>{window.removeEventListener("resize",u),window.removeEventListener("keydown",C)}});function de(i,u="other"){if(!pe||!e(me))return;console.log("Rolling dice:",i,"type:",u),o(m,u),o(A,!1),pe.diceToRoll=i;const C=M=>(console.log("Before roll:",M),null),b=M=>{if(console.log("After roll:",M),console.log("Result:",M.resultTotal),o(H,M),u==="attack"||u==="check"||u==="save"){const ne=M.results?.filter(je=>je.sides===20)||[];if(ne.length>0){const je=ne[0].value;o(ae,je===20)}}if(o(_,[]),u==="attack"&&Q())if(e(ae)){const ne=Te(Q());e(_).push({label:`Roll Critical Damage (${ne})`,notation:ne})}else e(_).push({label:`Roll Damage (${Q()})`,notation:Q()})};pe.start_throw(C,b)}function fe(){const i=[];e(ie)>0&&i.push(`${e(ie)}d4`),e(V)>0&&i.push(`${e(V)}d6`),e(Z)>0&&i.push(`${e(Z)}d8`),e(J)>0&&i.push(`${e(J)}d10`),e(G)>0&&i.push(`${e(G)}d12`),e(re)>0&&i.push(`${e(re)}d20`);let u=i.join("+")||"1d20";return e(ee)!==0&&(u+=e(ee)>=0?`+${e(ee)}`:`${e(ee)}`),u}function be(){const i=fe();de(i)}function Te(i){return i.replace(/(\d+)d(\d+)/g,(u,C,b)=>`${parseInt(C)*2}d${b}`)}function ze(){o(ie,0),o(V,0),o(Z,0),o(J,0),o(G,0),o(re,0),o(ee,0),o(H,null),o(_,[]),o(ae,!1),o(m,"other"),o(A,!1)}function Le(){window.DICE&&(window.DICE.setColors({dice_color:N(e(z),"ff"),label_color:N(e(oe),"ff"),desk_color:e(p)}),pe&&(pe.updateDeskColor(e(p)),pe.updateDiceColors()))}function De(){o(R,!e(R))}function Ge(){!e(H)||e($)<=0||e(A)||(o(H,{...e(H),resultTotal:e(H).resultTotal+10,resultString:e(H).resultString+" + 10 (Guided Strike)"}),q.update(i=>{const u="ChannelDivinity",C=i.classFeatures.features[u];return typeof C=="number"&&C>0&&(i.classFeatures.features[u]=C-1),i}),o(A,!0))}function Ue(){f("close"),T(""),Q(""),U(""),o(le,""),o(H,null),o(A,!1),ze()}qe(()=>(t(),Dt),()=>{o(g,t().class?Dt(t().class,t().level,t().subclass).some(u=>u.name==="Guided Strike"):!1)}),qe(()=>t(),()=>{o($,(()=>{const u=t().classFeatures.features["ChannelDivinity"];return typeof u=="number"?u:0})())}),qe(()=>(e(ie),e(V),e(Z),e(J),e(G),e(re),e(ee)),()=>{o(E,(()=>{const i=[];e(ie)>0&&i.push(`${e(ie)}d4`),e(V)>0&&i.push(`${e(V)}d6`),e(Z)>0&&i.push(`${e(Z)}d8`),e(J)>0&&i.push(`${e(J)}d10`),e(G)>0&&i.push(`${e(G)}d12`),e(re)>0&&i.push(`${e(re)}d20`);let u=i.join("+")||"1d20";return e(ee)!==0&&(u+=e(ee)>=0?`+${e(ee)}`:`${e(ee)}`),u})())}),qe(()=>(W(T()),e(me),W(X()),e(le),W(Q()),W(U())),()=>{if(T()&&e(me)&&X()&&T()!==e(le)){o(le,T()),o(H,null),o(_,[]),o(ae,!1),o(A,!1);const i=T().includes("1d20")?"attack":"other";console.log("Auto-roll triggered. notation:",T(),"damageNotation:",Q(),"attackName:",U()),setTimeout(()=>de(T(),i),200)}}),gt();var Ze={getLastRollTotal:ve};ut();var L=Hs();let j;var O=l(L),I=l(O),ye=a(l(I),2),Ce=l(ye),ke=a(Ce,2);s(ye),s(I);var he=a(I,2);{var k=i=>{var u=ws(),C=a(l(u),2),b=l(C),M=a(l(b),2);xe(M),s(b);var ne=a(b,2),je=a(l(ne),2);xe(je),s(ne);var _e=a(ne,2),Fe=a(l(_e),2);xe(Fe),s(_e),s(C),s(u),$e(M,()=>e(z),Ae=>o(z,Ae)),S("change",M,Le),$e(je,()=>e(oe),Ae=>o(oe,Ae)),S("change",je,Le),$e(Fe,()=>e(p),Ae=>o(p,Ae)),S("change",Fe,Le),v(i,u)};w(he,i=>{e(R)&&i(k)})}var P=a(he,2);{var te=i=>{var u=Ds();v(i,u)};w(P,i=>{e(me)||i(te)})}var ge=a(P,2),Pe=l(ge);Ut(Pe,i=>o(se,i),()=>e(se));var Je=a(Pe,2);{var Se=i=>{var u=Fs(),C=a(l(u),2),b=l(C),M=a(l(b),2);xe(M),s(b);var ne=a(b,2),je=a(l(ne),2);xe(je),s(ne);var _e=a(ne,2),Fe=a(l(_e),2);xe(Fe),s(_e);var Ae=a(_e,2),Be=a(l(Ae),2);xe(Be),s(Ae);var We=a(Ae,2),Xe=a(l(We),2);xe(Xe),s(We);var Oe=a(We,2),Ve=a(l(Oe),2);xe(Ve),s(Oe),s(C);var et=a(C,2),Me=l(et),Qe=l(Me);s(Me);var lt=a(Me,2);s(et),s(u),B(()=>{Me.disabled=!e(me),x(Qe,`Roll ${e(E)??""}`)}),$e(M,()=>e(ie),ue=>o(ie,ue)),$e(je,()=>e(V),ue=>o(V,ue)),$e(Fe,()=>e(Z),ue=>o(Z,ue)),$e(Be,()=>e(J),ue=>o(J,ue)),$e(Xe,()=>e(G),ue=>o(G,ue)),$e(Ve,()=>e(re),ue=>o(re,ue)),S("click",Me,be),S("click",lt,ze),v(i,u)};w(Je,i=>{T()||i(Se)})}s(ge);var F=a(ge,2);let ce;var we=l(F);{var Ie=i=>{var u=Bs(),C=He(u),b=l(C),M=l(b,!0);s(b);var ne=a(b,2);{var je=Me=>{var Qe=As();v(Me,Qe)};w(ne,Me=>{e(ae)&&Me(je)})}s(C);var _e=a(C,2),Fe=l(_e,!0);s(_e);var Ae=a(_e,2),Be=l(Ae);{var We=Me=>{var Qe=Rs(),lt=l(Qe,!0);s(Qe),B(()=>x(lt,(e(H),n(()=>e(H).resultString)))),v(Me,Qe)};w(Be,Me=>{e(H),n(()=>e(H).resultString)&&Me(We)})}var Xe=a(Be,2);{var Oe=Me=>{var Qe=Is(),lt=l(Qe);s(Qe),B(()=>x(lt,`Modifier: ${e(H),n(()=>e(H).constant>=0?"+":"")??""}${e(H),n(()=>e(H).constant)??""}`)),v(Me,Qe)};w(Xe,Me=>{e(H),n(()=>e(H).constant)&&Me(Oe)})}s(Ae);var Ve=a(Ae,2);{var et=Me=>{var Qe=Ps(),lt=l(Qe);nt(lt,1,()=>e(_),ct,(vt,bt)=>{var kt=Ms(),Ye=l(kt,!0);s(kt),B(()=>x(Ye,(e(bt),n(()=>e(bt).label)))),S("click",kt,()=>de(e(bt).notation,"damage")),v(vt,kt)});var ue=a(lt,2);{var Ne=vt=>{var bt=Es();B(()=>{bt.disabled=e($)<=0,st(bt,"title",e($)<=0?"No Channel Divinity uses remaining":"Use Channel Divinity to add +10 to this attack roll")}),S("click",bt,Ge),v(vt,bt)};w(ue,vt=>{e(g)&&e(m)==="attack"&&!e(A)&&vt(Ne)})}s(Qe),v(Me,Qe)};w(Ve,Me=>{e(_),e(g),e(m),e(A),n(()=>e(_).length>0||e(g)&&e(m)==="attack"&&!e(A))&&Me(et)})}B(()=>{x(M,U()?`${U()} - Result`:"Result"),x(Fe,(e(H),n(()=>e(H).resultTotal)))}),v(i,u)};w(we,i=>{e(H)&&i(Ie)})}s(F),s(O),s(L),B(()=>{j=it(L,1,"modal-overlay svelte-1r90jgp",null,j,{hidden:!X()}),ce=it(F,1,"roll-result svelte-1r90jgp",null,ce,{"has-result":e(H)})}),S("click",Ce,De),S("click",ke,Ue),S("click",O,Wt(function(i){Ct.call(this,d,i)})),S("keydown",O,function(i){Ct.call(this,d,i)}),S("click",L,Ue),S("keydown",L,i=>i.key==="Escape"&&Ue()),v(r,L),Ca(d,"getLastRollTotal",ve);var K=ft(Ze);return y(),K}const Bt="https://api.github.com/gists";async function Ns(r,d,t){if(!d)throw new Error("GitHub token is required");const c=JSON.stringify(r,null,2),y=`${r.name||"character"}_dnd.json`,g={description:t||`D&D Character: ${r.name}`,public:!1,files:{[y]:{content:c}}},$=await fetch(Bt,{method:"POST",headers:{Authorization:`token ${d}`,"Content-Type":"application/json"},body:JSON.stringify(g)});if(!$.ok)throw new Error(`Failed to create gist: ${$.statusText}`);return(await $.json()).id}async function Ts(r,d,t){if(!d||!t)throw new Error("GitHub token and Gist ID are required");const c=JSON.stringify(r,null,2),g={files:{[`${r.name||"character"}_dnd.json`]:{content:c}}},$=await fetch(`${Bt}/${t}`,{method:"PATCH",headers:{Authorization:`token ${d}`,"Content-Type":"application/json"},body:JSON.stringify(g)});if(!$.ok)throw new Error(`Failed to update gist: ${$.statusText}`)}async function Us(r,d){if(!r)throw new Error("Gist ID is required");const t={"Content-Type":"application/json"};d&&(t.Authorization=`token ${d}`);const c=await fetch(`${Bt}/${r}`,{method:"GET",headers:t});if(!c.ok)throw new Error(`Failed to load gist: ${c.statusText}`);const y=await c.json(),g=Object.values(y.files);if(g.length===0)throw new Error("No files found in gist");const E=g[0].content;try{const f=JSON.parse(E);return f.attacks&&Array.isArray(f.attacks)&&(f.attacks=f.attacks.map(T=>({...T,id:T.id||crypto.randomUUID()}))),f.classFeatures?(f.classFeatures.features||(f.classFeatures.features={}),f.classFeatures.spellSlots||(f.classFeatures.spellSlots=[]),f.classFeatures.preparedSpells===void 0&&(f.classFeatures.preparedSpells="")):f.classFeatures={features:{},spellSlots:[],preparedSpells:""},f}catch{throw new Error("Invalid character data in gist")}}function Xt(r){typeof window<"u"&&localStorage.setItem("dnd_gist_config",JSON.stringify(r))}function Os(){if(typeof window<"u"){const r=localStorage.getItem("dnd_gist_config");if(r)return JSON.parse(r)}return{}}async function qs(r,d=30){if(!r)throw new Error("GitHub token is required to list gists");const t=await fetch(`${Bt}?per_page=${d}`,{method:"GET",headers:{Authorization:`token ${r}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error(`Failed to list gists: ${t.statusText}`);return await t.json()}var zs=h('<div class="error-message svelte-1jb5ckg"> </div>'),Ws=h('<div class="toggle-container svelte-1jb5ckg"><button type="button" class="toggle-btn svelte-1jb5ckg"> </button></div>'),Vs=h('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID (leave empty to create new)</label> <input type="text" id="gistId" placeholder="Optional: existing Gist ID to update" class="svelte-1jb5ckg"/></div>'),Js=h('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),Ks=h('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),Qs=h('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Update (or leave unselected to create new)</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),Xs=h('<div class="info-message svelte-1jb5ckg">No gists found. A new one will be created.</div>'),Ys=h('<!> <div class="form-group svelte-1jb5ckg"><label for="description" class="svelte-1jb5ckg"> </label> <input type="text" id="description" placeholder="D&amp;D Character Sheet" class="svelte-1jb5ckg"/></div>',1),Zs=h('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID *</label> <input type="text" id="gistId" placeholder="Enter Gist ID (for public or your private gists)" required class="svelte-1jb5ckg"/></div>'),el=h('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),tl=h('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),al=h('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Load</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),sl=h('<div class="info-message svelte-1jb5ckg">No gists found. Enter a Gist ID manually or create a new one in Save mode.</div>'),ll=h('<div class="modal-overlay svelte-1jb5ckg" role="button" tabindex="-1"><div class="modal-content svelte-1jb5ckg" role="dialog" tabindex="0"><div class="modal-header svelte-1jb5ckg"><h2 class="svelte-1jb5ckg"> </h2> <button class="close-btn svelte-1jb5ckg">Ã—</button></div> <div class="modal-body svelte-1jb5ckg"><!> <div class="form-group svelte-1jb5ckg"><label for="token" class="svelte-1jb5ckg"> <a href="https://github.com/settings/tokens" target="_blank" rel="noopener" class="svelte-1jb5ckg">Get token</a></label> <input type="password" id="token" placeholder="ghp_xxxxxxxxxxxxx" class="svelte-1jb5ckg"/></div> <!> <!> <div class="modal-actions svelte-1jb5ckg"><button class="btn btn-primary svelte-1jb5ckg"><!></button> <button class="btn btn-secondary svelte-1jb5ckg">Cancel</button></div></div></div></div>');function il(r,d){pt(d,!1);const t=()=>Ee(q,"$character",c),[c,y]=ht(),g=St();let $=$t(d,"mode",8,"save"),E=D(""),f=D(""),T=D(""),X=D(!1),Q=D(""),U=D(!1),pe=D(!1),se=D([]),me=D(null);const le=Os();le.token&&o(E,le.token),le.gistId&&o(f,le.gistId),Ft(async()=>{e(E)&&!e(U)&&await H()});async function H(){if(e(E)){o(pe,!0),o(Q,"");try{o(se,await qs(e(E))),e(f)&&o(me,e(se).find(L=>L.id===e(f))||null)}catch(L){o(Q,L.message||"Failed to load gists"),o(se,[])}finally{o(pe,!1)}}}function ve(L){o(me,L),o(f,L.id)}function ie(){o(U,!e(U)),o(Q,""),!e(U)&&e(E)&&H()}async function V(){if(!e(E)){o(Q,"GitHub token is required");return}const L=e(me)?.id||e(f);o(X,!0),o(Q,"");try{if(L)await Ts(t(),e(E),L),o(f,L),Ht.add("Character updated in Gist successfully!","success");else{const j=await Ns(t(),e(E),e(T));o(f,j),Ht.add(`Character saved to Gist! ID: ${j}`,"success")}Xt({token:e(E),gistId:e(f)}),g("close")}catch(j){o(Q,j.message||"Failed to save to Gist")}finally{o(X,!1)}}async function Z(){const L=e(me)?.id||e(f);if(!L){o(Q,"Please select a gist or enter a Gist ID");return}o(X,!0),o(Q,"");try{const j=await Us(L,e(E)||void 0);q.set(j),o(f,L),Xt({token:e(E),gistId:e(f)}),Ht.add("Character loaded from Gist successfully!","success"),g("close")}catch(j){o(Q,j.message||"Failed to load from Gist")}finally{o(X,!1)}}function J(){g("close")}ut();var G=ll(),re=l(G),ee=l(re),_=l(ee),ae=l(_,!0);s(_);var m=a(_,2);s(ee);var A=a(ee,2),z=l(A);{var oe=L=>{var j=zs(),O=l(j,!0);s(j),B(()=>x(O,e(Q))),v(L,j)};w(z,L=>{e(Q)&&L(oe)})}var p=a(z,2),R=l(p),Y=l(R);fa(),s(R);var N=a(R,2);xe(N),s(p);var Re=a(p,2);{var de=L=>{var j=Ws(),O=l(j),I=l(O,!0);s(O),s(j),B(()=>{O.disabled=e(X),x(I,e(U)?"ðŸ“‹ Show My Gists":"âœï¸ Enter Gist ID Manually")}),S("click",O,ie),v(L,j)};w(Re,L=>{($()==="load"||$()==="save"&&e(E))&&L(de)})}var fe=a(Re,2);{var be=L=>{var j=Ys(),O=He(j);{var I=P=>{var te=Vs(),ge=a(l(te),2);xe(ge),s(te),B(()=>ge.disabled=e(X)),$e(ge,()=>e(f),Pe=>o(f,Pe)),v(P,te)},ye=P=>{var te=at(),ge=He(te);{var Pe=Se=>{var F=Js();v(Se,F)},Je=Se=>{var F=at(),ce=He(F);{var we=K=>{var i=Qs(),u=a(l(i),2);nt(u,5,()=>e(se),ct,(C,b)=>{var M=Ks();let ne;var je=l(M),_e=l(je),Fe=l(_e,!0);s(_e);var Ae=a(_e,2),Be=l(Ae,!0);s(Ae),s(je);var We=a(je,2),Xe=l(We),Oe=l(Xe);s(Xe);var Ve=a(Xe,2),et=l(Ve);s(Ve),s(We),s(M),B(Me=>{ne=it(M,1,"gist-item svelte-1jb5ckg",null,ne,{selected:e(me)?.id===e(b).id}),M.disabled=e(X),x(Fe,(e(b),n(()=>e(b).description||"Untitled"))),x(Be,(e(b),n(()=>e(b).public?"ðŸŒ Public":"ðŸ”’ Private"))),x(Oe,`ID: ${e(b),n(()=>e(b).id)??""}`),x(et,`Updated: ${Me??""}`)},[()=>(e(b),n(()=>new Date(e(b).updated_at).toLocaleDateString()))]),S("click",M,()=>ve(e(b))),v(C,M)}),s(u),s(i),v(K,i)},Ie=K=>{var i=at(),u=He(i);{var C=b=>{var M=Xs();v(b,M)};w(u,b=>{e(E)&&b(C)},!0)}v(K,i)};w(ce,K=>{e(se),n(()=>e(se).length>0)?K(we):K(Ie,!1)},!0)}v(Se,F)};w(ge,Se=>{e(pe)?Se(Pe):Se(Je,!1)},!0)}v(P,te)};w(O,P=>{e(U)||!e(E)?P(I):P(ye,!1)})}var Ce=a(O,2),ke=l(Ce),he=l(ke);s(ke);var k=a(ke,2);xe(k),s(Ce),B(()=>{x(he,`Description ${e(f)?"(optional)":""}`),k.disabled=e(X)}),$e(k,()=>e(T),P=>o(T,P)),v(L,j)},Te=L=>{var j=at(),O=He(j);{var I=Ce=>{var ke=Zs(),he=a(l(ke),2);xe(he),s(ke),B(()=>he.disabled=e(X)),$e(he,()=>e(f),k=>o(f,k)),v(Ce,ke)},ye=Ce=>{var ke=at(),he=He(ke);{var k=te=>{var ge=el();v(te,ge)},P=te=>{var ge=at(),Pe=He(ge);{var Je=F=>{var ce=al(),we=a(l(ce),2);nt(we,5,()=>e(se),ct,(Ie,K)=>{var i=tl();let u;var C=l(i),b=l(C),M=l(b,!0);s(b);var ne=a(b,2),je=l(ne,!0);s(ne),s(C);var _e=a(C,2),Fe=l(_e),Ae=l(Fe);s(Fe);var Be=a(Fe,2),We=l(Be);s(Be),s(_e),s(i),B(Xe=>{u=it(i,1,"gist-item svelte-1jb5ckg",null,u,{selected:e(me)?.id===e(K).id}),i.disabled=e(X),x(M,(e(K),n(()=>e(K).description||"Untitled"))),x(je,(e(K),n(()=>e(K).public?"ðŸŒ Public":"ðŸ”’ Private"))),x(Ae,`ID: ${e(K),n(()=>e(K).id)??""}`),x(We,`Updated: ${Xe??""}`)},[()=>(e(K),n(()=>new Date(e(K).updated_at).toLocaleDateString()))]),S("click",i,()=>ve(e(K))),v(Ie,i)}),s(we),s(ce),v(F,ce)},Se=F=>{var ce=at(),we=He(ce);{var Ie=K=>{var i=sl();v(K,i)};w(we,K=>{e(E)&&K(Ie)},!0)}v(F,ce)};w(Pe,F=>{e(se),n(()=>e(se).length>0)?F(Je):F(Se,!1)},!0)}v(te,ge)};w(he,te=>{e(pe)?te(k):te(P,!1)},!0)}v(Ce,ke)};w(O,Ce=>{e(U)||!e(E)?Ce(I):Ce(ye,!1)})}v(L,j)};w(fe,L=>{$()==="save"?L(be):L(Te,!1)})}var ze=a(fe,2),Le=l(ze),De=l(Le);{var Ge=L=>{var j=mt();B(()=>x(j,$()==="save"?"Saving...":"Loading...")),v(L,j)},Ue=L=>{var j=mt();B(()=>x(j,$()==="save"?"Save":"Load")),v(L,j)};w(De,L=>{e(X)?L(Ge):L(Ue,!1)})}s(Le);var Ze=a(Le,2);s(ze),s(A),s(re),s(G),B(()=>{x(ae,$()==="save"?"Save to GitHub Gist":"Load from GitHub Gist"),x(Y,`GitHub Token ${$()==="load"?"(optional for public gists)":"(required)"} `),N.disabled=e(X),Le.disabled=e(X),Ze.disabled=e(X)}),S("click",m,J),$e(N,()=>e(E),L=>o(E,L)),S("blur",N,()=>{e(E)&&!e(U)&&H()}),S("click",Le,function(...L){($()==="save"?V:Z)?.apply(this,L)}),S("click",Ze,J),S("click",re,Wt(function(L){Ct.call(this,d,L)})),S("keydown",re,function(L){Ct.call(this,d,L)}),S("click",G,J),S("keydown",G,L=>L.key==="Escape"&&J()),v(r,G),ft(),y()}var rl=h('<div class="loading svelte-1ngjemu">Loading D&D data...</div>'),nl=h("<option> </option>"),ol=h('<select class="level-filter svelte-1ngjemu"><option>All Levels</option><option>Cantrip</option><!></select>'),cl=h('<div class="no-results svelte-1ngjemu"> </div>'),vl=h('<div class="item-meta svelte-1ngjemu"> </div>'),dl=h('<div class="item-meta svelte-1ngjemu"> </div>'),ul=h('<button><div class="item-name svelte-1ngjemu"> </div> <!></button>'),pl=h('<p class="higher-levels"><strong>At Higher Levels:</strong> </p>'),fl=h('<p class="cantrip-upgrade"><strong>Cantrip Upgrade:</strong> </p>'),bl=h('<h3 class="svelte-1ngjemu"> </h3> <p class="spell-meta svelte-1ngjemu"><!> <!></p> <p class="spell-classes"><strong>Classes:</strong> </p> <div class="spell-stats svelte-1ngjemu"><div><strong>Casting Time:</strong> </div> <div><strong>Range:</strong> </div> <div><strong>Components:</strong> <!></div> <div><strong>Duration:</strong> <!> </div></div> <p class="description svelte-1ngjemu"> </p> <!> <!>',1),ml=h('<p class="prerequisite svelte-1ngjemu"><strong>Prerequisite:</strong> </p>'),hl=h('<h3 class="svelte-1ngjemu"> </h3> <!> <p class="description svelte-1ngjemu"> </p> <a target="_blank" rel="noopener" class="source-link svelte-1ngjemu">View Full Details â†’</a>',1),gl=h('<div class="item-details svelte-1ngjemu"><!></div>'),_l=h('<div class="controls svelte-1ngjemu"><div class="tabs svelte-1ngjemu"><button> </button> <button> </button></div> <div class="search-controls svelte-1ngjemu"><input type="text" placeholder="Search by name or description..." class="search-input svelte-1ngjemu"/> <!></div></div> <div class="content-container svelte-1ngjemu"><div class="items-list svelte-1ngjemu"><!></div> <!></div>',1),yl=h('<div class="modal-backdrop svelte-1ngjemu" role="presentation"><div class="modal svelte-1ngjemu" role="dialog" aria-modal="true" tabindex="-1"><div class="modal-header svelte-1ngjemu"><h2 class="svelte-1ngjemu">Browse D&D Spells & Feats</h2> <button class="close-btn svelte-1ngjemu" aria-label="Close">&times;</button></div> <div class="modal-body svelte-1ngjemu"><!></div> <div class="modal-footer svelte-1ngjemu"><button class="btn-secondary svelte-1ngjemu">Cancel</button> <button class="btn-primary svelte-1ngjemu">Add to Character Sheet</button></div></div></div>');function kl(r,d){pt(d,!1);const t=D(),c=D(),y=D();let g=$t(d,"onClose",8),$=D("spell"),E=D(!0),f=D(""),T=D(null),X=D([]),Q=D([]),U=D(null);Ft(async()=>{o(E,!0);try{o(X,await na()),o(Q,await Wa())}catch(m){console.error("Failed to load data:",m)}finally{o(E,!1)}});function pe(m){o(U,m)}function se(m){const A=m.match(/(\d+d\d+(?:\s*\+\s*\d+)?)/i);return A?A[1]:""}function me(m){const A=m.split(/\.( |$)/)[0].trim(),z=Array.from(m.matchAll(/\*\*(.*?)\*\*/g)).map(p=>p[1].replace(/\.$/,""));let oe=A;return z.length&&(oe+=" | Effects: "+z.join(", ")),oe}function le(){if(e(U)){if(e($)==="spell"){const m=e(U);q.update(A=>{const oe=[];m.range&&oe.push(`Range: ${m.range}`),m.castingTime&&oe.push(`Cast: ${m.castingTime}`),m.duration&&oe.push(`Duration: ${m.duration}`),m.actionType==="Save"&&oe.push("Saving throw spell"),m.components&&m.components.length>0&&oe.push(`Components: ${m.components.join(", ")}`),m.material&&oe.push(`Material: ${m.material}`);const p=oe.join(" | "),R=me(m.description),Y={id:crypto.randomUUID(),name:`${m.name}${m.concentration?" (C)":""}${m.ritual?" (R)":""}`,bonus:m.actionType==="Attack"?5:0,damage:se(m.description),damageType:`${m.school} (Lvl ${m.level})`,spellRef:m.name,infoNotes:p,generalNotes:R,castAtLevel:m.level};return A.attacks=[...A.attacks,Y],A})}else if(e($)==="feat"){const m=e(U);q.update(A=>{const z=`${m.name}${m.prerequisite?` (Req: ${m.prerequisite})`:""}
${m.description}
`;return A.features=A.features?`${A.features}
${z}`:z,A})}o(U,null),g()()}}qe(()=>(e(T),e(X),e(f)),()=>{o(t,e(T)!==null?Va(Qt(e(X),e(f)),e(T)):Qt(e(X),e(f)))}),qe(()=>(e(Q),e(f)),()=>{o(c,Ja(e(Q),e(f)))}),qe(()=>(e($),e(t),e(c)),()=>{o(y,e($)==="spell"?e(t):e(c))}),gt(),ut();var H=yl(),ve=l(H),ie=l(ve),V=a(l(ie),2);s(ie);var Z=a(ie,2),J=l(Z);{var G=m=>{var A=rl();v(m,A)},re=m=>{var A=_l(),z=He(A),oe=l(z),p=l(oe);let R;var Y=l(p);s(p);var N=a(p,2);let Re;var de=l(N);s(N),s(oe);var fe=a(oe,2),be=l(fe);xe(be);var Te=a(be,2);{var ze=O=>{var I=ol();B(()=>{e(T),xt(()=>{})});var ye=l(I);ye.value=(ye.__value=null)??"";var Ce=a(ye);Ce.value=Ce.__value=0;var ke=a(Ce);nt(ke,0,()=>[1,2,3,4,5,6,7,8,9],ct,(he,k)=>{var P=nl(),te=l(P);s(P);var ge={};B(()=>{x(te,`Level ${k??""}`),ge!==(ge=k)&&(P.value=(P.__value=k)??"")}),v(he,P)}),s(I),$a(I,()=>e(T),he=>o(T,he)),v(O,I)};w(Te,O=>{e($)==="spell"&&O(ze)})}s(fe),s(z);var Le=a(z,2),De=l(Le),Ge=l(De);{var Ue=O=>{var I=cl(),ye=l(I);s(I),B(()=>x(ye,`No ${e($)??""}s found`)),v(O,I)},Ze=O=>{var I=at(),ye=He(I);nt(ye,1,()=>e(y),ct,(Ce,ke)=>{var he=ul();let k;var P=l(he),te=l(P,!0);s(P);var ge=a(P,2);{var Pe=Se=>{const F=tt(()=>e(ke));var ce=vl(),we=l(ce);s(ce),B(()=>x(we,`Level ${W(e(F)),n(()=>e(F).level)??""} â€¢ ${W(e(F)),n(()=>e(F).school)??""}`)),v(Se,ce)},Je=Se=>{const F=tt(()=>e(ke));var ce=at(),we=He(ce);{var Ie=K=>{var i=dl(),u=l(i,!0);s(i),B(()=>x(u,(W(e(F)),n(()=>e(F).prerequisite)))),v(K,i)};w(we,K=>{W(e(F)),n(()=>e(F).prerequisite)&&K(Ie)})}v(Se,ce)};w(ge,Se=>{e($)==="spell"?Se(Pe):Se(Je,!1)})}s(he),B(()=>{k=it(he,1,"item-card svelte-1ngjemu",null,k,{selected:e(U)?.name===e(ke).name}),x(te,(e(ke),n(()=>e(ke).name)))}),S("click",he,()=>pe(e(ke))),v(Ce,he)}),v(O,I)};w(Ge,O=>{e(y),n(()=>e(y).length===0)?O(Ue):O(Ze,!1)})}s(De);var L=a(De,2);{var j=O=>{var I=gl(),ye=l(I);{var Ce=he=>{const k=tt(()=>e(U));var P=bl(),te=He(P),ge=l(te,!0);s(te);var Pe=a(te,2),Je=l(Pe);{var Se=ue=>{var Ne=mt();B(()=>x(Ne,`${W(e(k)),n(()=>e(k).school)??""} cantrip`)),v(ue,Ne)},F=ue=>{var Ne=mt();B(()=>x(Ne,`Level ${W(e(k)),n(()=>e(k).level)??""} ${W(e(k)),n(()=>e(k).school)??""}`)),v(ue,Ne)};w(Je,ue=>{W(e(k)),n(()=>e(k).level===0)?ue(Se):ue(F,!1)})}var ce=a(Je,2);{var we=ue=>{var Ne=mt("(ritual)");v(ue,Ne)};w(ce,ue=>{W(e(k)),n(()=>e(k).ritual)&&ue(we)})}s(Pe);var Ie=a(Pe,2),K=a(l(Ie));s(Ie);var i=a(Ie,2),u=l(i),C=a(l(u));s(u);var b=a(u,2),M=a(l(b));s(b);var ne=a(b,2),je=a(l(ne)),_e=a(je);{var Fe=ue=>{var Ne=mt();B(()=>x(Ne,`(${W(e(k)),n(()=>e(k).material)??""})`)),v(ue,Ne)};w(_e,ue=>{W(e(k)),n(()=>e(k).material)&&ue(Fe)})}s(ne);var Ae=a(ne,2),Be=a(l(Ae),2);{var We=ue=>{var Ne=mt("Concentration,");v(ue,Ne)};w(Be,ue=>{W(e(k)),n(()=>e(k).concentration)&&ue(We)})}var Xe=a(Be,1,!0);s(Ae),s(i);var Oe=a(i,2),Ve=l(Oe,!0);s(Oe);var et=a(Oe,2);{var Me=ue=>{var Ne=pl(),vt=a(l(Ne));s(Ne),B(()=>x(vt,` ${W(e(k)),n(()=>e(k).higherLevelSlot)??""}`)),v(ue,Ne)};w(et,ue=>{W(e(k)),n(()=>e(k).higherLevelSlot)&&ue(Me)})}var Qe=a(et,2);{var lt=ue=>{var Ne=fl(),vt=a(l(Ne));s(Ne),B(()=>x(vt,` ${W(e(k)),n(()=>e(k).cantripUpgrade)??""}`)),v(ue,Ne)};w(Qe,ue=>{W(e(k)),n(()=>e(k).cantripUpgrade)&&ue(lt)})}B((ue,Ne)=>{x(ge,(W(e(k)),n(()=>e(k).name))),x(K,` ${ue??""}`),x(C,` ${W(e(k)),n(()=>e(k).castingTime||e(k).actionType)??""}`),x(M,` ${W(e(k)),n(()=>e(k).range)??""}`),x(je,` ${Ne??""}`),x(Xe,(W(e(k)),n(()=>e(k).duration))),x(Ve,(W(e(k)),n(()=>e(k).description)))},[()=>(W(e(k)),n(()=>e(k).classes.join(", "))),()=>(W(e(k)),n(()=>e(k).components.join(", ").toUpperCase()))]),v(he,P)},ke=he=>{const k=tt(()=>e(U));var P=hl(),te=He(P),ge=l(te,!0);s(te);var Pe=a(te,2);{var Je=we=>{var Ie=ml(),K=a(l(Ie));s(Ie),B(()=>x(K,` ${W(e(k)),n(()=>e(k).prerequisite)??""}`)),v(we,Ie)};w(Pe,we=>{W(e(k)),n(()=>e(k).prerequisite)&&we(Je)})}var Se=a(Pe,2),F=l(Se,!0);s(Se);var ce=a(Se,2);B(()=>{x(ge,(W(e(k)),n(()=>e(k).name))),x(F,(W(e(k)),n(()=>e(k).description))),st(ce,"href",(W(e(k)),n(()=>e(k).source)))}),v(he,P)};w(ye,he=>{e($)==="spell"?he(Ce):he(ke,!1)})}s(I),v(O,I)};w(L,O=>{e(U)&&O(j)})}s(Le),B(()=>{R=it(p,1,"tab svelte-1ngjemu",null,R,{active:e($)==="spell"}),x(Y,`ðŸ“œ Spells (${e(X),n(()=>e(X).length)??""})`),Re=it(N,1,"tab svelte-1ngjemu",null,Re,{active:e($)==="feat"}),x(de,`â­ Feats (${e(Q),n(()=>e(Q).length)??""})`)}),S("click",p,()=>{o($,"spell"),o(U,null),o(f,"")}),S("click",N,()=>{o($,"feat"),o(U,null),o(f,"")}),$e(be,()=>e(f),O=>o(f,O)),v(m,A)};w(J,m=>{e(E)?m(G):m(re,!1)})}s(Z);var ee=a(Z,2),_=l(ee),ae=a(_,2);s(ee),s(ve),s(H),B(()=>ae.disabled=!e(U)),S("click",V,function(...m){g()?.apply(this,m)}),S("click",_,function(...m){g()?.apply(this,m)}),S("click",ae,le),S("click",ve,Wt(function(m){Ct.call(this,d,m)})),S("keydown",ve,function(m){Ct.call(this,d,m)}),S("click",H,function(...m){g()?.apply(this,m)}),S("keydown",H,m=>m.key==="Escape"&&g()()),v(r,H),ft()}var xl=h('<link rel="icon" type="image/png" href="/favicon.png"/>'),$l=h('<span class="character-name svelte-1uha8ag"> </span>'),Cl=h('<div class="rest-menu svelte-1uha8ag"><button class="rest-option svelte-1uha8ag">â˜• Short Rest</button> <button class="rest-option svelte-1uha8ag">ðŸ›ï¸ Long Rest</button></div>'),Sl=h('<div class="container svelte-1uha8ag"><header class="svelte-1uha8ag"><div class="header-top svelte-1uha8ag"><div class="header-title svelte-1uha8ag"><h1 class="svelte-1uha8ag">D&D Character Sheet</h1> <!></div> <div class="header-controls svelte-1uha8ag"><button class="btn btn-secondary use-enabled">ðŸŽ² Roll Dice</button> <div class="rest-button-container svelte-1uha8ag"><button class="btn btn-secondary use-enabled">ðŸ˜´ Rest</button> <!></div> <input type="text" placeholder="ðŸ” Search (e.g., Religion, Strength, Attack...)" class="search-input use-enabled svelte-1uha8ag"/> <div class="mode-toggle"><button> </button></div></div></div> <div class="header-actions svelte-1uha8ag"><button class="btn btn-primary">ðŸ“š Browse Spells & Feats</button> <button class="btn btn-secondary">Save to Gist</button> <button class="btn btn-secondary">Load from Gist</button> <button class="btn btn-secondary">Export JSON</button> <button class="btn btn-secondary">Import JSON</button> <input type="file" accept=".json" style="display: none;"/></div></header> <main class="svelte-1uha8ag"><!> <!> <!> <!> <!> <!> <!></main></div> <!> <!> <!>',1);function Ml(r,d){pt(d,!1);const t=()=>Ee(q,"$character",g),c=()=>Ee(Mt,"$isEditMode",g),y=()=>Ee(yt,"$searchFilter",g),[g,$]=ht();let E=D(!1),f=D(!1),T=D(!1),X=D("save"),Q=D(void 0),U=D(""),pe=D(""),se=D(""),me=D(),le=!1,H=D(!1);function ve(){q.update(i=>(i.hitDice.current=Math.min(i.hitDice.max,i.hitDice.current+Math.max(1,Math.floor(i.hitDice.max/2))),i.classFeatures.features&&Object.keys(i.classFeatures.features).forEach(u=>{const C=V(u);if(C?.resetOn==="short"){if(Array.isArray(i.classFeatures.features[u])){const b=C.maxUses,M=typeof b=="function"?b(i.level):b;i.classFeatures.features[u]=Array(M).fill(!1)}else if(typeof i.classFeatures.features[u]=="number"){const b=C.maxPool,M=typeof b=="function"?b(i.level):b;M!==void 0&&(i.classFeatures.features[u]=M)}}}),i)),o(H,!1)}function ie(){q.update(i=>(i.currentHP=i.maxHP,i.tempHP=0,i.hitDice.current=i.hitDice.max,i.classFeatures.spellSlotsByLevel&&Object.keys(i.classFeatures.spellSlotsByLevel).forEach(u=>{const C=i.classFeatures.spellSlotsByLevel[parseInt(u)];C&&(i.classFeatures.spellSlotsByLevel[parseInt(u)]=Array(C.length).fill(!1))}),i.classFeatures.features&&Object.keys(i.classFeatures.features).forEach(u=>{const C=V(u);if(C){if(Array.isArray(i.classFeatures.features[u])){const b=C.maxUses,M=typeof b=="function"?b(i.level):b;i.classFeatures.features[u]=Array(M).fill(!1)}else if(typeof i.classFeatures.features[u]=="number"){const b=C.maxPool,M=typeof b=="function"?b(i.level):b;M!==void 0&&(i.classFeatures.features[u]=M)}}}),i)),o(H,!1)}function V(i){return(t().class?dt(t().class):null)?Dt(t().class,t().level,t().subclass).find(b=>b.name.replace(/\s+/g,"")===i):null}function Z(i){o(U,""),o(pe,""),o(se,""),le=!1,typeof i=="string"?o(U,i):(o(U,i.notation),o(pe,i.damageNotation||""),o(se,i.attackName||"")),o(E,!0)}function J(i){const{notation:u}=i.detail;o(U,""),le=!0,setTimeout(()=>{o(U,u),o(pe,""),o(se,"Hit Die")},0),o(E,!0)}function G(){if(o(E,!1),le&&e(me)){const i=e(me).getLastRollTotal();if(i!==null){const u=Math.max(1,i);q.update(C=>(C.hitDice.current=Math.max(0,C.hitDice.current-1),C.currentHP=Math.min(C.maxHP,C.currentHP+u),C))}le=!1}}function re(){console.log("toggleMode called, current isEditMode:",c()),Mt.update(i=>(console.log("Updating isEditMode from",i,"to",!i),!i))}function ee(i){i.target.closest(".rest-button-container")||o(H,!1)}Ft(()=>{console.log("onMount - initial isEditMode:",c()),console.log("onMount - body classes:",document.body.className);const i=Mt.subscribe(u=>{console.log("isEditMode subscription triggered, value:",u),console.log("Body classes before:",document.body.className),u?(document.body.classList.remove("use-mode"),console.log("Removed use-mode class (Edit Mode)")):(document.body.classList.add("use-mode"),console.log("Added use-mode class (Use Mode)")),console.log("Body classes after:",document.body.className)});return document.addEventListener("click",ee),()=>{i(),document.removeEventListener("click",ee)}});function _(){ya(t())}function ae(){e(Q)?.click()}async function m(i){const C=i.target.files?.[0];if(C)try{const b=await ka(C);q.set(b),alert("Character imported successfully!")}catch{alert("Failed to import character file")}}ut();var A=Sl();_a("1uha8ag",i=>{var u=xl();ea(()=>{ba.title="D&D Character Sheet"}),v(i,u)});var z=He(A),oe=l(z),p=l(oe),R=l(p),Y=a(l(R),2);{var N=i=>{var u=$l(),C=l(u,!0);s(u),B(()=>x(C,t().name)),v(i,u)};w(Y,i=>{t().name&&i(N)})}s(R);var Re=a(R,2),de=l(Re),fe=a(de,2),be=l(fe),Te=a(be,2);{var ze=i=>{var u=Cl(),C=l(u),b=a(C,2);s(u),S("click",C,ve),S("click",b,ie),v(i,u)};w(Te,i=>{e(H)&&i(ze)})}s(fe);var Le=a(fe,2);xe(Le);var De=a(Le,2),Ge=l(De);let Ue;var Ze=l(Ge,!0);s(Ge),s(De),s(Re),s(p);var L=a(p,2),j=l(L),O=a(j,2),I=a(O,2),ye=a(I,2),Ce=a(ye,2),ke=a(Ce,2);Ut(ke,i=>o(Q,i),()=>e(Q)),s(L),s(oe);var he=a(oe,2),k=l(he);Ia(k,{});var P=a(k,2);Ta(P,{$$events:{rollHitDice:J}});var te=a(P,2);Ba(te,{$$events:{roll:i=>Z(i.detail)}});var ge=a(te,2);za(ge,{$$events:{roll:i=>Z(i.detail)}});var Pe=a(ge,2);ns(Pe,{$$events:{roll:i=>Z(i.detail)}});var Je=a(Pe,2);Cs(Je,{});var Se=a(Je,2);Ls(Se,{}),s(he),s(z);var F=a(z,2);Ut(Gs(F,{get notation(){return e(U)},get damageNotation(){return e(pe)},get attackName(){return e(se)},get visible(){return e(E)},$$events:{close:G},$$legacy:!0}),i=>o(me,i),()=>e(me));var ce=a(F,2);{var we=i=>{il(i,{get mode(){return e(X)},$$events:{close:()=>o(f,!1)}})};w(ce,i=>{e(f)&&i(we)})}var Ie=a(ce,2);{var K=i=>{kl(i,{onClose:()=>o(T,!1)})};w(Ie,i=>{e(T)&&i(K)})}B(()=>{Ue=it(Ge,1,"btn btn-mode svelte-1uha8ag",null,Ue,{"use-mode":!c()}),x(Ze,c()?"ðŸ“ Edit Mode":"ðŸŽ² Use Mode")}),S("click",de,()=>o(E,!0)),S("click",be,()=>o(H,!e(H))),$e(Le,y,i=>ma(yt,i)),S("click",Ge,re),S("click",j,()=>o(T,!0)),S("click",O,()=>{o(X,"save"),o(f,!0)}),S("click",I,()=>{o(X,"load"),o(f,!0)}),S("click",ye,_),S("click",Ce,ae),S("change",ke,m),v(r,A),ft(),$()}export{Ml as component};
