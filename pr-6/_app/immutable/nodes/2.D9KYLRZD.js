import{d as Ss,g as Ys,f as d,e as R,a as o,s as k,c as kt,t as Pt}from"../chunks/BESELRjb.js";import{i as Jt}from"../chunks/JMgyEzd3.js";import{c as xa,o as La,a as Qs,b as Xs}from"../chunks/CtPH092J.js";import{F as D,T as ha,Y as ms,j as Zs,aZ as el,U as Cs,ag as tl,aD as al,aK as sl,aE as ll,a1 as il,av as Ka,a7 as xs,i as Hs,a_ as rl,a$ as Us,b0 as ts,K as Sa,e as Ns,b1 as Os,b2 as nl,b3 as ol,b4 as cl,q as gs,b5 as vl,b6 as dl,ab as ul,d as r,r as $s,g as fl,C as Vt,G as Yt,H as l,I as s,J as a,b7 as Qe,b8 as ma,s as n,a4 as S,f as e,m as xt,E as ke,b9 as Kt,ao as sa,A as N,ba,bb as Ra,bc as pl}from"../chunks/DyJ43TGI.js";import{t as ml,c as ea,a as be,e as Ct,i as Bt,u as Gs,s as ya,b as Ut,d as as,f as Da,g as Za,j as gl,k as Ht,l as bl,m as Ds,n as os,r as Ua,h as hl,T as _l,o as yl,p as xl,q as Ls,v as As}from"../chunks/CpYsI7SN.js";import{i as m,s as ca,a as ft,b as Gt,d as Ia,e as $l}from"../chunks/CCL4udNy.js";import{p as Rt,b as Na}from"../chunks/iXw84bXb.js";import{b as Ea,r as kl}from"../chunks/D9F9ZPlt.js";function bs(i,c,t=!1,v=!1,f=!1){var p=i,g="";D(()=>{var $=Zs;if(g===(g=c()??"")){ha&&ms();return}if($.nodes_start!==null&&(el($.nodes_start,$.nodes_end),$.nodes_start=$.nodes_end=null),g!==""){if(ha){Cs.data;for(var _=ms(),y=_;_!==null&&(_.nodeType!==tl||_.data!=="");)y=_,_=al(_);if(_===null)throw sl(),ll;Ss(Cs,y),p=il(_);return}var F=g+"";t?F=`<svg>${F}</svg>`:v&&(F=`<math>${F}</math>`);var P=Ys(F);if((t||v)&&(P=Ka(P)),Ss(Ka(P),P.lastChild),t||v)for(;Ka(P);)p.before(Ka(P));else p.before(P)}})}function wl(i,c,t,v,f){ha&&ms();var p=c.$$slots?.[t],g=!1;p===!0&&(p=c[t],g=!0),p===void 0?f!==null&&f(i):p(i,g?()=>v:v)}function Sl(i,c,t,v){var f=i.__style;if(ha||f!==c){var p=ml(c);(!ha||p!==i.getAttribute("style"))&&(p==null?i.removeAttribute("style"):i.style.cssText=p),i.__style=c}return v}function es(i,c,t=!1){if(i.multiple){if(c==null)return;if(!Hs(c))return rl();for(var v of i.options)v.selected=c.includes(Ha(v));return}for(v of i.options){var f=Ha(v);if(Us(f,c)){v.selected=!0;return}}(!t||c!==void 0)&&(i.selectedIndex=-1)}function hs(i){var c=new MutationObserver(()=>{es(i,i.__value)});c.observe(i,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),xs(()=>{c.disconnect()})}function Oa(i,c,t=c){var v=new WeakSet,f=!0;ts(i,"change",p=>{var g=p?"[selected]":":checked",$;if(i.multiple)$=[].map.call(i.querySelectorAll(g),Ha);else{var _=i.querySelector(g)??i.querySelector("option:not([disabled])");$=_&&Ha(_)}t($),Sa!==null&&v.add(Sa)}),Ns(()=>{var p=c();if(i===document.activeElement){var g=Os??Sa;if(v.has(g))return}if(es(i,p,f),f&&p===void 0){var $=i.querySelector(":checked");$!==null&&(p=Ha($),t(p))}i.__value=p,f=!1}),hs(i)}function Ha(i){return"__value"in i?i.__value:i.value}const Cl=Symbol("is custom element"),Dl=Symbol("is html");function we(i){if(ha){var c=!1,t=()=>{if(!c){if(c=!0,i.hasAttribute("value")){var v=i.value;ot(i,"value",null),i.value=v}if(i.hasAttribute("checked")){var f=i.checked;ot(i,"checked",null),i.checked=f}}};i.__on_r=t,gs(t),vl()}}function Ba(i,c){var t=ks(i);t.value===(t.value=c??void 0)||i.value===c&&(c!==0||i.nodeName!=="PROGRESS")||(i.value=c??"")}function qs(i,c){var t=ks(i);t.checked!==(t.checked=c??void 0)&&(i.checked=c)}function ot(i,c,t,v){var f=ks(i);ha&&(f[c]=i.getAttribute(c),c==="src"||c==="srcset"||c==="href"&&i.nodeName==="LINK")||f[c]!==(f[c]=t)&&(c==="loading"&&(i[nl]=t),t==null?i.removeAttribute(c):typeof t!="string"&&Ll(i).includes(c)?i[c]=t:i.setAttribute(c,t))}function ks(i){return i.__attributes??={[Cl]:i.nodeName.includes("-"),[Dl]:i.namespaceURI===ol}}var js=new Map;function Ll(i){var c=i.getAttribute("is")||i.nodeName,t=js.get(c);if(t)return t;js.set(c,t=[]);for(var v,f=i,p=Element.prototype;p!==f;){v=dl(f);for(var g in v)v[g].set&&t.push(g);f=cl(f)}return t}function Je(i,c,t=c){var v=new WeakSet;ts(i,"input",async f=>{var p=f?i.defaultValue:i.value;if(p=vs(i)?ds(p):p,t(p),Sa!==null&&v.add(Sa),await ul(),p!==(p=c())){var g=i.selectionStart,$=i.selectionEnd,_=i.value.length;if(i.value=p??"",$!==null){var y=i.value.length;g===$&&$===_&&y>_?(i.selectionStart=y,i.selectionEnd=y):(i.selectionStart=g,i.selectionEnd=Math.min($,y))}}}),(ha&&i.defaultValue!==i.value||r(c)==null&&i.value)&&(t(vs(i)?ds(i.value):i.value),Sa!==null&&v.add(Sa)),$s(()=>{var f=c();if(i===document.activeElement){var p=Os??Sa;if(v.has(p))return}vs(i)&&f===ds(i.value)||i.type==="date"&&!f&&!i.value||f!==i.value&&(i.value=f??"")})}const cs=new Set;function Rs(i,c,t,v,f=v){var p=t.getAttribute("type")==="checkbox",g=i;let $=!1;if(c!==null)for(var _ of c)g=g[_]??=[];g.push(t),ts(t,"change",()=>{var y=t.__value;p&&(y=Bs(g,y,t.checked)),f(y)},()=>f(p?[]:null)),$s(()=>{var y=v();if(ha&&t.defaultChecked!==t.checked){$=!0;return}p?(y=y||[],t.checked=y.includes(t.__value)):t.checked=Us(t.__value,y)}),xs(()=>{var y=g.indexOf(t);y!==-1&&g.splice(y,1)}),cs.has(g)||(cs.add(g),gs(()=>{g.sort((y,F)=>y.compareDocumentPosition(F)===4?-1:1),cs.delete(g)})),gs(()=>{if($){var y;if(p)y=Bs(g,y,t.checked);else{var F=g.find(P=>P.checked);y=F?.__value}f(y)}})}function Ca(i,c,t=c){ts(i,"change",v=>{var f=v?i.defaultChecked:i.checked;t(f)}),(ha&&i.defaultChecked!==i.checked||r(c)==null)&&t(i.checked),$s(()=>{var v=c();i.checked=!!v})}function Bs(i,c,t){for(var v=new Set,f=0;f<i.length;f+=1)i[f].checked&&v.add(i[f].__value);return t||v.delete(c),Array.from(v)}function vs(i){var c=i.type;return c==="number"||c==="range"}function ds(i){return i===""?null:+i}function Al(i,c,t){var v=fl(i,c);v&&v.set&&(i[c]=t,xs(()=>{i[c]=null}))}function ws(i){return function(...c){var t=c[0];return t.stopPropagation(),i?.apply(this,c)}}function Ma(i,c){var t=i.$$events?.[c.type],v=Hs(t)?t.slice():t==null?[]:[t];for(var f of v)f.call(this,c)}const jl="";function Ws(...i){return Ea+jl+kl(i[0],i[1])}const _s={paladin:{name:"Paladin",hitDice:"d10",spellcaster:!0,spellcastingAbility:"charisma",spellSlotsByLevel:{1:0,2:2,3:3,4:3,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Divine Sense",type:"uses",maxUses:(i,c=1)=>1+Math.max(1,c),resetOn:"long",description:"Detect celestials, fiends, and undead within 60 feet",minLevel:1},{name:"Lay on Hands",type:"pool",maxPool:i=>i*5,resetOn:"long",description:"Heal wounds or cure disease",minLevel:1},{name:"Divine Smite",type:"spellSlot",description:"Expend spell slot to deal extra radiant damage",minLevel:2,rollable:!0},{name:"Channel Divinity",type:"pool",maxPool:i=>i>=18?3:i>=6?2:1,resetOn:"short",description:"Sacred Weapon or Turn Undead",minLevel:3}]},fighter:{name:"Fighter",hitDice:"d10",spellcaster:!1,features:[{name:"Second Wind",type:"uses",maxUses:1,resetOn:"short",description:"Regain 1d10 + fighter level HP as bonus action",minLevel:1,rollable:!0,rollFormula:i=>`1d10+${i}`},{name:"Action Surge",type:"uses",maxUses:i=>i>=17?2:1,resetOn:"short",description:"Take one additional action on your turn",minLevel:2},{name:"Indomitable",type:"uses",maxUses:i=>i>=17?3:i>=13?2:1,resetOn:"long",description:"Reroll a failed saving throw",minLevel:9}],subclasses:{champion:{name:"Champion",features:[{name:"Improved Critical",type:"info",description:"Critical hit on 19-20",minLevel:3},{name:"Remarkable Athlete",type:"info",description:"Add half proficiency to STR/DEX/CON checks, increase long jump distance",minLevel:7},{name:"Additional Fighting Style",type:"info",description:"Choose a second fighting style",minLevel:10},{name:"Superior Critical",type:"info",description:"Critical hit on 18-20",minLevel:15},{name:"Survivor",type:"info",description:"Regain 5 + CON mod HP at start of turn if below half HP",minLevel:18}]},battlemaster:{name:"Battle Master",features:[{name:"Combat Superiority",type:"uses",maxUses:i=>i>=15?6:i>=7?5:4,resetOn:"short",description:i=>`Use superiority dice (${i>=18?"d12":i>=10?"d10":"d8"}) for maneuvers`,minLevel:3},{name:"Know Your Enemy",type:"info",description:"Learn capabilities of creatures you observe",minLevel:7},{name:"Improved Combat Superiority",type:"info",description:"Superiority dice become d10",minLevel:10},{name:"Relentless",type:"info",description:"Regain 1 superiority die if you have none at start of turn",minLevel:15}]}}},rogue:{name:"Rogue",hitDice:"d8",spellcaster:!1,features:[{name:"Sneak Attack",type:"info",description:i=>`Deal ${Math.ceil(i/2)}d6 extra damage once per turn with advantage or ally nearby`,minLevel:1,rollable:!0,rollFormula:i=>`${Math.ceil(i/2)}d6`},{name:"Cunning Action",type:"info",description:"Dash, Disengage, or Hide as a bonus action",minLevel:2},{name:"Uncanny Dodge",type:"info",description:"Use reaction to halve damage from an attack",minLevel:5},{name:"Evasion",type:"info",description:"Take no damage on successful Dex save (half on fail)",minLevel:7}]},wizard:{name:"Wizard",hitDice:"d6",spellcaster:!0,spellcastingAbility:"intelligence",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Arcane Recovery",type:"uses",maxUses:1,resetOn:"long",description:i=>`Recover spell slots totaling up to ${Math.ceil(i/2)} levels during short rest`,minLevel:1},{name:"Spell Mastery",type:"info",description:"Cast one 1st-level and one 2nd-level spell at will",minLevel:18}]},cleric:{name:"Cleric",hitDice:"d8",spellcaster:!0,spellcastingAbility:"wisdom",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Channel Divinity",type:"pool",maxPool:i=>i>=18?4:i>=6?3:2,resetOn:"short",description:"Turn Undead or domain-specific ability",minLevel:2},{name:i=>i>=5?"Sear Undead":"Turn Undead",subName:i=>i>=5?"Improved Turn Undead":null,type:"channelDivinity",description:(i,c=1)=>{let t="As a Magic action, you present your Holy Symbol and censure Undead creatures. Each Undead of your choice within 30 feet of you must make a Wisdom saving throw. If the creature fails its save, it has the Frightened and Incapacitated conditions for 1 minute. For that duration, it tries to move as far from you as it can on its turns. This effect ends early on the creature if it takes any damage, if you have the Incapacitated condition, or if you die.";if(i>=5){const v=Math.max(1,c);t+=` <br /><br />
            
          With Sear Undead, roll ${v}d8 radiant damage to turned undead.`}return t},minLevel:2,rollable:!0,rollFormula:(i,c=1)=>i>=5?`${Math.max(1,c)}d8`:""},{name:"Divine Intervention",type:"uses",maxUses:1,resetOn:"long",description:i=>`${i}% chance to succeed, implore deity for aid`,minLevel:10}],subclasses:{war:{name:"War Domain",features:[{name:"War Priest",type:"uses",maxUses:(i,c=1)=>Math.max(1,c),resetOn:"long",description:"Make one weapon attack as a bonus action",minLevel:1},{name:"Channel Divinity",type:"info",description:"Additional Channel Divinity options from War Domain",minLevel:2,subFeatures:[{name:"Guided Strike",type:"channelDivinity",description:"Use your Channel Divinity to gain +10 to an attack roll. Make this choice after you see the roll, but before the DM says whether the attack hits or misses.",minLevel:2},{name:"War God's Blessing",type:"channelDivinity",description:"Use reaction to grant +10 to an ally's attack roll within 30 feet. Consumes one use of Channel Divinity.",minLevel:6,resetOn:"short"}]},{name:"Divine Strike",type:"info",description:i=>`Deal extra ${i>=14?"2d8":"1d8"} weapon damage once per turn`,minLevel:8,rollable:!0,rollFormula:i=>i>=14?"2d8":"1d8"},{name:"Avatar of Battle",type:"info",description:"Gain resistance to nonmagical weapon damage",minLevel:17}]},life:{name:"Life Domain",features:[{name:"Disciple of Life",type:"info",description:"Healing spells restore additional 2 + spell level HP",minLevel:1},{name:"Preserve Life",type:"pool",maxPool:i=>i*5,resetOn:"short",description:"Restore HP to creatures within 30 feet",minLevel:2},{name:"Blessed Healer",type:"info",description:"Regain 2 + spell level HP when you cast healing spell",minLevel:6},{name:"Divine Strike",type:"info",description:i=>`Deal extra ${i>=14?"2d8":"1d8"} radiant damage once per turn`,minLevel:8,rollable:!0,rollFormula:i=>i>=14?"2d8":"1d8"},{name:"Supreme Healing",type:"info",description:"Maximize healing dice instead of rolling",minLevel:17}]}}},barbarian:{name:"Barbarian",hitDice:"d12",spellcaster:!1,features:[{name:"Rage",type:"uses",maxUses:i=>i>=20?1/0:i>=17?6:i>=12?5:i>=6?4:i>=3?3:2,resetOn:"long",description:i=>`+${i>=16?4:i>=9?3:2} damage, resistance to physical damage`,minLevel:1},{name:"Reckless Attack",type:"info",description:"Gain advantage on melee attacks, enemies get advantage on you",minLevel:2},{name:"Danger Sense",type:"info",description:"Advantage on Dex saves against effects you can see",minLevel:2}],subclasses:{berserker:{name:"Path of the Berserker",features:[{name:"Frenzy",type:"info",description:"While raging, make melee attack as bonus action (gain 1 exhaustion after rage)",minLevel:3},{name:"Mindless Rage",type:"info",description:"Cannot be charmed or frightened while raging",minLevel:6},{name:"Intimidating Presence",type:"info",description:"Use action to frighten creature within 30 feet",minLevel:10},{name:"Retaliation",type:"info",description:"When damaged by creature within 5 feet, make melee attack as reaction",minLevel:14}]}}}};function da(i){const c=i.toLowerCase();return _s[c]||null}function Ta(i,c,t){const v=da(i);if(!v)return[];const f=v.features.filter(p=>!p.minLevel||p.minLevel<=c);if(t&&v.subclasses&&v.subclasses[t]){const p=v.subclasses[t].features.filter(g=>!g.minLevel||g.minLevel<=c);return[...f,...p]}return f}function Ms(i){const c=da(i);return!c||!c.subclasses?[]:Object.keys(c.subclasses).map(t=>({id:t,name:c.subclasses[t].name}))}function Ts(i,c){const t=da(i);return!t||!t.spellcaster||!t.spellSlotsByLevel?0:t.spellSlotsByLevel[c]||0}function Fs(i,c,t){const v=da(i);return!v||!v.spellcaster?0:Math.max(1,t+c)}function Rl(i,c,t){const v=da(i);return!v||!v.spellcaster?null:8+c+t}function Bl(){return Object.keys(_s).map(i=>({id:i,name:_s[i].name}))}var Ml=d('<div class="section-header svelte-ls99y2" role="button" tabindex="0"><h2 class="svelte-ls99y2"> </h2> <span class="collapse-btn svelte-ls99y2"> </span></div>');function $a(i,c){Vt(c,!1);let t=Rt(c,"title",8),v=Rt(c,"collapsed",8),f=Rt(c,"ariaLabel",8,""),p=Rt(c,"onToggle",8);Jt();var g=Ml(),$=l(g),_=l($,!0);s($);var y=a($,2),F=l(y,!0);s(y),s(g),D(()=>{ot(g,"aria-expanded",!v()),ot(g,"aria-label",f()),k(_,t()),k(F,v()?"‚ñº":"‚ñ≤")}),R("click",g,function(...P){p()?.apply(this,P)}),R("keydown",g,P=>{(P.key==="Enter"||P.key===" ")&&p()()}),o(i,g),Yt()}var Tl=d("<option> </option>"),Fl=d("<option> </option>"),Pl=d('<div class="form-group svelte-172i2fj"><label for="characterSubclass" class="svelte-172i2fj">Subclass</label> <select id="characterSubclass" class="svelte-172i2fj"><option>Select Subclass</option><!></select></div>'),Il=d('<div class="info-grid svelte-172i2fj"><div class="form-group svelte-172i2fj"><label for="characterName" class="svelte-172i2fj">Character Name</label> <input type="text" id="characterName" placeholder="Enter name" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterClass" class="svelte-172i2fj">Class</label> <select id="characterClass" class="svelte-172i2fj"><option>Select Class</option><!></select></div> <!> <div class="form-group svelte-172i2fj"><label for="characterLevel" class="svelte-172i2fj">Level</label> <input type="number" id="characterLevel" min="1" max="20" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterRace" class="svelte-172i2fj">Race</label> <input type="text" id="characterRace" placeholder="e.g., Human" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterBackground" class="svelte-172i2fj">Background</label> <input type="text" id="characterBackground" placeholder="e.g., Soldier" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterAlignment" class="svelte-172i2fj">Alignment</label> <input type="text" id="characterAlignment" placeholder="e.g., Lawful Good" class="svelte-172i2fj"/></div></div>'),El=d('<section class="character-info svelte-172i2fj"><!> <!></section>');function Hl(i,c){Vt(c,!1);const t=()=>ft(be,"$character",f),v=()=>ft(ea,"$collapsedStates",f),[f,p]=ca(),g=S(),$=Bl();function _(E){const B=E.target;be.update(T=>(T.class=B.value,T.subclass="",T))}function y(E){const B=E.target;be.update(T=>(T.subclass=B.value,T))}function F(E){const B=E.target;be.update(T=>(T.level=parseInt(B.value)||1,T)),Gs()}Qe(()=>(t(),Ms),()=>{n(g,t().class?Ms(t().class):[])}),ma(),Jt();var P=El(),q=l(P);{let E=xt(()=>(v(),r(()=>v().characterInfo?"Expand":"Collapse")));$a(q,{title:"Character Info",get collapsed(){return v(),r(()=>v().characterInfo)},get ariaLabel(){return e(E)},onToggle:()=>ea.update(B=>({...B,characterInfo:!B.characterInfo}))})}var U=a(q,2);{var Z=E=>{var B=Il(),T=l(B),ee=a(l(T),2);we(ee),s(T);var fe=a(T,2),Oe=a(l(fe),2),$e=l(Oe);$e.value=$e.__value="";var ce=a($e);Ct(ce,1,()=>$,Bt,(ze,Re)=>{var De=Tl(),h=l(De,!0);s(De);var I={};D(()=>{k(h,(e(Re),r(()=>e(Re).name))),I!==(I=(e(Re),r(()=>e(Re).id)))&&(De.value=(De.__value=(e(Re),r(()=>e(Re).id)))??"")}),o(ze,De)}),s(Oe);var se;hs(Oe),s(fe);var he=a(fe,2);{var Ee=ze=>{var Re=Pl(),De=a(l(Re),2),h=l(De);h.value=h.__value="";var I=a(h);Ct(I,1,()=>e(g),Bt,(et,at)=>{var pt=Fl(),Lt=l(pt,!0);s(pt);var Mt={};D(()=>{k(Lt,(e(at),r(()=>e(at).name))),Mt!==(Mt=(e(at),r(()=>e(at).id)))&&(pt.value=(pt.__value=(e(at),r(()=>e(at).id)))??"")}),o(et,pt)}),s(De);var ve;hs(De),s(Re),D(()=>{ve!==(ve=(t(),r(()=>t().subclass)))&&(De.value=(De.__value=(t(),r(()=>t().subclass)))??"",es(De,(t(),r(()=>t().subclass))))}),R("change",De,y),o(ze,Re)};m(he,ze=>{e(g),r(()=>e(g).length>0)&&ze(Ee)})}var J=a(he,2),A=a(l(J),2);we(A),s(J);var x=a(J,2),O=a(l(x),2);we(O),s(x);var G=a(x,2),ue=a(l(G),2);we(ue),s(G);var _e=a(G,2),Ae=a(l(_e),2);we(Ae),s(_e),s(B),D(()=>{se!==(se=(t(),r(()=>t().class)))&&(Oe.value=(Oe.__value=(t(),r(()=>t().class)))??"",es(Oe,(t(),r(()=>t().class)))),Ba(A,(t(),r(()=>t().level)))}),Je(ee,()=>t().name,ze=>Gt(be,r(t).name=ze,r(t))),R("change",Oe,_),R("change",A,F),Je(O,()=>t().race,ze=>Gt(be,r(t).race=ze,r(t))),Je(ue,()=>t().background,ze=>Gt(be,r(t).background=ze,r(t))),Je(Ae,()=>t().alignment,ze=>Gt(be,r(t).alignment=ze,r(t))),o(E,B)};m(U,E=>{v(),r(()=>!v().characterInfo)&&E(Z)})}s(P),o(i,P),Yt(),p()}var Ul=d('<div class="ability-card svelte-bbv1xt"><h3 class="svelte-bbv1xt"> </h3> <input type="number" class="ability-score svelte-bbv1xt" min="1" max="30"/> <div class="ability-modifier svelte-bbv1xt"> </div> <div class="roll-buttons svelte-bbv1xt"><button class="roll-btn svelte-bbv1xt">Check</button> <button class="roll-btn svelte-bbv1xt">Save</button></div> <div class="save-proficiency svelte-bbv1xt"><input type="checkbox" class="svelte-bbv1xt"/> <label class="svelte-bbv1xt">Save Prof.</label></div></div>'),Nl=d('<div class="proficiency-bonus svelte-bbv1xt"><label for="profBonus">Proficiency Bonus</label> <input type="number" id="profBonus" class="prof-input svelte-bbv1xt"/></div> <div class="abilities-grid svelte-bbv1xt"></div>',1),Ol=d("<section><!> <!></section>");function Gl(i,c){Vt(c,!1);const t=()=>ft(as,"$abilityModifiers",$),v=()=>ft(be,"$character",$),f=()=>ft(ya,"$searchFilter",$),p=()=>ft(ea,"$collapsedStates",$),g=()=>ft(Da,"$isEditMode",$),[$,_]=ca(),y=S(),F=S(),P=xa(),q=[{key:"strength",label:"Strength"},{key:"dexterity",label:"Dexterity"},{key:"constitution",label:"Constitution"},{key:"intelligence",label:"Intelligence"},{key:"wisdom",label:"Wisdom"},{key:"charisma",label:"Charisma"}];function U(){Gs()}function Z($e){const ce=t()[$e],se=`1d20${ce>=0?"+":""}${ce}`,he=[];he.push({value:"1d20",source:"base die"}),ce!==0&&he.push({value:ce,source:$e}),P("roll",{notation:se,rollType:"check",bonusBreakdown:he})}function E($e){const ce=t()[$e],se=v().saveProficiencies[$e]?v().proficiencyBonus:0,he=ce+se,Ee=`1d20${he>=0?"+":""}${he}`,J=[];J.push({value:"1d20",source:"base die"}),ce!==0&&J.push({value:ce,source:$e}),se!==0&&J.push({value:se,source:"proficiency"}),P("roll",{notation:Ee,rollType:"save",bonusBreakdown:J})}Qe(()=>f(),()=>{n(y,q.filter(({label:$e})=>f()?$e.toLowerCase().includes(f().toLowerCase()):!0))}),Qe(()=>(e(y),f()),()=>{n(F,e(y).length>0||!f()||f().toLowerCase().includes("proficiency"))}),ma(),Jt();var B=Ol();let T;var ee=l(B);$a(ee,{title:"Ability Scores",get collapsed(){return p(),r(()=>p().abilityScores)},ariaLabel:"Toggle Ability Scores Section",onToggle:()=>ea.update($e=>({...$e,abilityScores:!$e.abilityScores}))});var fe=a(ee,2);{var Oe=$e=>{var ce=Nl(),se=ke(ce),he=a(l(se),2);we(he),s(se);var Ee=a(se,2);Ct(Ee,5,()=>e(y),Bt,(J,A)=>{let x=()=>e(A).key,O=()=>e(A).label;var G=Ul(),ue=l(G),_e=l(ue,!0);s(ue);var Ae=a(ue,2);we(Ae);var ze=a(Ae,2),Re=l(ze);s(ze);var De=a(ze,2),h=l(De),I=a(h,2);s(De);var ve=a(De,2),et=l(ve);we(et);var at=a(et,2);s(ve),s(G),D(pt=>{k(_e,pt),k(Re,`${t(),x(),r(()=>t()[x()]>=0?"+":"")??""}${t(),x(),r(()=>t()[x()])??""}`),et.disabled=!g(),ot(et,"id",`${x()}-save`),ot(at,"for",`${x()}-save`)},[()=>(O(),r(()=>O().substring(0,3).toUpperCase()))]),Je(Ae,()=>v().abilities[x()],pt=>Gt(be,r(v).abilities[x()]=pt,r(v))),R("change",Ae,U),R("click",h,()=>Z(x())),R("click",I,()=>E(x())),Ca(et,()=>v().saveProficiencies[x()],pt=>Gt(be,r(v).saveProficiencies[x()]=pt,r(v))),o(J,G)}),s(Ee),Je(he,()=>v().proficiencyBonus,J=>Gt(be,r(v).proficiencyBonus=J,r(v))),o($e,ce)};m(fe,$e=>{p(),r(()=>!p().abilityScores)&&$e(Oe)})}s(B),D(()=>T=Ut(B,1,"ability-scores svelte-bbv1xt",null,T,{hidden:!e(F)})),o(i,B),Yt(),_()}const zs=[{name:"Unarmored",type:"none",baseAC:10},{name:"Padded",type:"light",baseAC:11},{name:"Leather",type:"light",baseAC:11},{name:"Studded Leather",type:"light",baseAC:12},{name:"Hide",type:"medium",baseAC:12,maxDexBonus:2},{name:"Chain Shirt",type:"medium",baseAC:13,maxDexBonus:2},{name:"Scale Mail",type:"medium",baseAC:14,maxDexBonus:2},{name:"Breastplate",type:"medium",baseAC:14,maxDexBonus:2},{name:"Half Plate",type:"medium",baseAC:15,maxDexBonus:2},{name:"Ring Mail",type:"heavy",baseAC:14,maxDexBonus:0},{name:"Chain Mail",type:"heavy",baseAC:16,maxDexBonus:0},{name:"Splint",type:"heavy",baseAC:17,maxDexBonus:0},{name:"Plate",type:"heavy",baseAC:18,maxDexBonus:0}];function Ks(i){return zs.find(c=>c.name===i)}function ql(i,c,t){if(!i)return 10+c+(t?2:0);const v=Ks(i);if(!v)return 10+c+(t?2:0);let f=v.baseAC;return v.maxDexBonus===void 0?f+=c:v.maxDexBonus>0&&(f+=Math.min(c,v.maxDexBonus)),t&&(f+=2),f}function Ga(i){return Math.floor((i-10)/2)}function ys(i,c){if(!i.class)return null;const t=da(i.class);if(!t||!t.spellcaster||!t.spellcastingAbility)return null;const v=Ga(c[t.spellcastingAbility]);return 8+i.proficiencyBonus+v}function us(i,c){if(!i.class)return 0;const t=da(i.class);return!t||!t.spellcaster||!t.spellcastingAbility?0:Ga(c[t.spellcastingAbility])}function Wl(i,c){const t=[],v=Ga(c.dexterity),f=i.armorName?Ks(i.armorName):void 0;if(f){if(f.type==="none")t.push("Unarmored"),t.push("Base: 10"),t.push(`Dexterity: ${v>=0?"+":""}${v}`);else if(f.type==="light")t.push(`${f.name}: ${f.baseAC}`),t.push(`Dexterity: ${v>=0?"+":""}${v}`);else if(f.type==="medium"){const p=Math.min(2,v);t.push(`${f.name}: ${f.baseAC}`),t.push(`Dexterity: ${p>=0?"+":""}${p} (max +2)`)}else f.type==="heavy"&&(t.push(`${f.name}: ${f.baseAC}`),t.push("Dexterity: +0 (heavy armor)"));i.shieldEquipped&&t.push("Shield: +2")}else{t.push("Base: 10"),v!==0&&t.push(`Dexterity: ${v>=0?"+":""}${v}`);const p=10+v,g=i.armorClass-p;g!==0&&t.push(`Other: ${g>=0?"+":""}${g}`)}return i.activeStates&&i.activeStates.length>0&&i.activeStates.forEach(p=>{typeof p.acBonus=="number"&&p.acBonus!==0&&(!p.target||p.target==="self")&&t.push(`${p.name}: ${p.acBonus>=0?"+":""}${p.acBonus}`)}),t.join(`
`)}function zl(i,c){const t=[],v=Ga(c.dexterity);t.push(`Dexterity: ${v>=0?"+":""}${v}`);const f=i.initiative-v;return f!==0&&t.push(`Other Bonuses: ${f>=0?"+":""}${f}`),t.join(`
`)}function Kl(i,c){if(!i.class)return"";const t=da(i.class);if(!t||!t.spellcaster||!t.spellcastingAbility)return"";const v=[],f=Ga(c[t.spellcastingAbility]),p=t.spellcastingAbility.charAt(0).toUpperCase()+t.spellcastingAbility.slice(1);return v.push("Base: 8"),v.push(`Proficiency: +${i.proficiencyBonus}`),v.push(`${p}: ${f>=0?"+":""}${f}`),v.join(`
`)}function Jl(i,c,t){const v=[];let f=i;const p=c.toLowerCase().trim();if(t.activeStates){for(const $ of t.activeStates)if($.immunities&&$.immunities.length>0&&$.immunities.some(y=>y.toLowerCase().trim()===p))return v.push(`Immune to ${c} (${$.name})`),{finalDamage:0,adjustments:v}}let g=!1;if(t.activeStates){for(const $ of t.activeStates)if($.resistances&&$.resistances.length>0&&$.resistances.some(y=>y.toLowerCase().trim()===p)){const y=Math.floor(f/2);v.push(`Resistant to ${c} (${$.name}): ${f} ‚Üí ${y}`),f=y,g=!0;break}}if(!g&&t.race){const $=Za(t.race);if($){for(const _ of $.traits)if(_.resistances&&_.resistances.some(y=>y.toLowerCase().trim()===p)){const y=Math.floor(f/2);v.push(`Resistant to ${c} (racial trait): ${f} ‚Üí ${y}`),f=y,g=!0;break}}}return v.length===0&&v.push(`No adjustments for ${c}`),{finalDamage:f,adjustments:v}}function Vl(i,c){const t={...i};if(t.tempHP>0){if(c<=t.tempHP)return t.tempHP-=c,t;c-=t.tempHP,t.tempHP=0}return t.currentHP=Math.max(0,t.currentHP-c),t}var Yl=d('<button class="info-icon svelte-1o8ci7b" type="button">‚ÑπÔ∏è</button>'),Ql=d('<button class="info-icon svelte-1o8ci7b" type="button">‚ÑπÔ∏è</button>'),Xl=d("<div><!></div>"),Zl=d('<div class="tooltip-wrapper svelte-1o8ci7b"><!> <!></div>');function fs(i,c){Vt(c,!1);let t=Rt(c,"tooltipContent",8),v=Rt(c,"ariaLabel",8,"Show information"),f=S(!1),p=S(),g=S(!1),$=S(null),_=S(!1),y=S(!1),F=S("");const P=Math.random().toString(36).slice(2);function q(){window.dispatchEvent(new CustomEvent("tooltip-open",{detail:P}))}function U(J){J.detail!==P&&(n(f,!1),n(_,!1))}function Z(){n(g,window.matchMedia("(pointer: coarse)").matches||"ontouchstart"in window)}function E(){if(!e($)||!e(p))return;const J=e(p).getBoundingClientRect(),A=e($).getBoundingClientRect();let x=J.bottom+5,O=J.left;n(_,!1),O+A.width>window.innerWidth-8&&(O=J.right-A.width,n(_,!0),O<8&&(O=8)),O<8&&(O=8),x+A.height>window.innerHeight-8&&(x=J.top-A.height-5),n(F,`position:fixed;top:${x}px;left:${O}px;z-index:1000;`),n(y,!0)}function B(){q(),n(f,!1),n(y,!1),requestAnimationFrame(()=>{n(f,!0),n(y,!1),setTimeout(E,0)})}function T(){n(f,!1),n(_,!1)}function ee(J){J.stopPropagation(),e(f)?(n(f,!1),n(_,!1),n(y,!1)):(q(),n(f,!1),n(y,!1),requestAnimationFrame(()=>{n(f,!0),n(y,!1),setTimeout(E,0)}))}function fe(J){e(p)&&!e(p).contains(J.target)&&(n(f,!1),n(_,!1))}La(()=>{Z(),document.addEventListener("click",fe),window.addEventListener("tooltip-open",U)}),Qs(()=>{document.removeEventListener("click",fe),window.removeEventListener("tooltip-open",U)}),Jt();var Oe=Zl(),$e=l(Oe);{var ce=J=>{var A=Yl();D(()=>ot(A,"aria-label",v())),R("click",A,ee),o(J,A)},se=J=>{var A=Ql();D(()=>ot(A,"aria-label",v())),R("mouseenter",A,B),R("mouseleave",A,T),o(J,A)};m($e,J=>{e(g)?J(ce):J(se,!1)})}var he=a($e,2);{var Ee=J=>{var A=Xl(),x=l(A);wl(x,c,"content",{},O=>{var G=kt(),ue=ke(G);bs(ue,t),o(O,G)}),s(A),Na(A,O=>n($,O),()=>e($)),D(()=>{Ut(A,1,`tooltip-popup ${e(_)?"right-align":""}`,"svelte-1o8ci7b"),Sl(A,e(y)?e(F)+"opacity:1;pointer-events:auto;":"opacity:0;pointer-events:none;position:fixed;top:0;left:0;z-index:1000;")}),o(J,A)};m(he,J=>{e(f)&&J(Ee)})}s(Oe),Na(Oe,J=>n(p,J),()=>e(p)),o(i,Oe),Yt()}var ei=d("<option> </option>"),ti=d('<div class="armor-config svelte-1r5hyyb"><h4 class="svelte-1r5hyyb">Armor Configuration</h4> <div class="armor-controls svelte-1r5hyyb"><div class="armor-field svelte-1r5hyyb"><label for="armorName" class="svelte-1r5hyyb">Armor</label> <select id="armorName" class="armor-select svelte-1r5hyyb"><option>None (Unarmored)</option><!></select></div> <div class="armor-field svelte-1r5hyyb"><label class="shield-label svelte-1r5hyyb"><input type="checkbox" class="shield-checkbox svelte-1r5hyyb"/> Shield Equipped (+2 AC)</label></div></div></div>'),ai=d('<div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="spellSaveDC" class="svelte-1r5hyyb">Spell Save DC</label> <!></div> <input type="number" id="spellSaveDC" class="stat-input svelte-1r5hyyb" readonly=""/></div>'),si=d('<span class="hit-dice-type"> </span>'),li=d('<!> <div class="stats-grid svelte-1r5hyyb"><div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="armorClass" class="svelte-1r5hyyb">Armor Class</label> <!></div> <input type="text" id="armorClass" readonly=""/></div> <div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="initiative" class="svelte-1r5hyyb">Initiative</label> <!></div> <div class="initiative-container svelte-1r5hyyb"><input type="text" id="initiative" class="stat-input initiative-input svelte-1r5hyyb" readonly=""/> <button class="btn btn-primary roll-initiative-btn use-enabled svelte-1r5hyyb" title="Roll Initiative">üé≤</button></div></div> <div class="stat-box svelte-1r5hyyb"><label for="speed" class="svelte-1r5hyyb">Speed</label> <input type="text" id="speed" class="stat-input svelte-1r5hyyb"/></div> <!></div> <div class="hp-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Points</h3> <div><div class="hp-inputs svelte-1r5hyyb"><input type="number" class="hp-current svelte-1r5hyyb" min="0"/> <span class="hp-separator svelte-1r5hyyb">/</span> <input type="number" class="hp-max svelte-1r5hyyb" min="0"/></div> <div class="hp-controls svelte-1r5hyyb"><button class="hp-btn svelte-1r5hyyb">‚àí</button> <button class="hp-btn svelte-1r5hyyb">+</button> <button class="hp-btn svelte-1r5hyyb">‚àí5</button> <button class="hp-btn svelte-1r5hyyb">+5</button></div></div> <div class="temp-hp svelte-1r5hyyb"><label for="tempHP" class="svelte-1r5hyyb">Temp HP</label> <input type="number" id="tempHP" min="0" class="svelte-1r5hyyb"/></div></div> <div class="hit-dice-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Dice</h3> <div class="hit-dice-display svelte-1r5hyyb"><input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <span>/</span> <input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <!></div> <div class="hit-dice-controls svelte-1r5hyyb"><label for="hitDiceCount" class="svelte-1r5hyyb">Roll</label> <div class="hit-dice-count-controls svelte-1r5hyyb"><button class="hit-dice-btn svelte-1r5hyyb">‚àí</button> <input type="number" id="hitDiceCount" class="hit-dice-count-input svelte-1r5hyyb" min="1"/> <button class="hit-dice-btn svelte-1r5hyyb">+</button></div> <button class="btn btn-primary roll-hit-dice use-enabled svelte-1r5hyyb">üé≤ Roll</button></div></div>',1),ii=d("<section><!> <!></section>");function ri(i,c){Vt(c,!1);const t=()=>ft(be,"$character",$),v=()=>ft(as,"$abilityModifiers",$),f=()=>ft(ya,"$searchFilter",$),p=()=>ft(ea,"$collapsedStates",$),g=()=>ft(Da,"$isEditMode",$),[$,_]=ca(),y=S(),F=S(),P=S(),q=S(),U=S(),Z=S(),E=S(),B=xa();let T=S(1);function ee(A){be.update(x=>(x.currentHP=Math.max(0,Math.min(x.maxHP,x.currentHP+A)),x))}function fe(A){const x=e(T)+A,O=t().hitDice.current;n(T,Math.max(1,Math.min(O,x)))}function Oe(A=1){if(t().hitDice.current<=0){alert("No hit dice remaining!");return}if(!t().class){alert("Please select a class first!");return}const x=da(t().class);if(!x){alert("Invalid class configuration!");return}const O=Math.min(A,t().hitDice.current),G=x.hitDice,ue=v().constitution,_e=ue*O,Ae=_e>=0?`+${_e}`:`${_e}`,ze=`${O}${G}${Ae}`,Re=[];if(Re.push({value:`${O}${G}`,source:"hit dice"}),ue!==0)for(let De=0;De<O;De++)Re.push({value:ue,source:"constitution"});B("rollHitDice",{notation:ze,hitDie:G,count:O,bonusBreakdown:Re})}function $e(){const A=t().initiative,O=`1d20${A>=0?`+${A}`:`${A}`}`,G=[];G.push({value:"1d20",source:"base"}),A!==0&&G.push({value:A,source:"initiative"}),B("rollInitiative",{notation:O,bonusBreakdown:G})}Qe(()=>(t(),v(),be),()=>{if(t().armorName!==void 0||t().shieldEquipped!==void 0){const A=v().dexterity,x=ql(t().armorName,A,t().shieldEquipped||!1);t().armorClass!==x&&be.update(O=>({...O,armorClass:x}))}}),Qe(()=>(v(),t(),be),()=>{const A=v().dexterity;t().initiative!==A&&be.update(x=>({...x,initiative:A}))}),Qe(()=>t(),()=>{n(y,ys(t(),t().abilities))}),Qe(()=>t(),()=>{n(F,Wl(t(),t().abilities))}),Qe(()=>t(),()=>{n(P,zl(t(),t().abilities))}),Qe(()=>t(),()=>{n(q,Kl(t(),t().abilities))}),Qe(()=>(t(),e(T)),()=>{const A=t().hitDice.current;A>0&&e(T)>A&&n(T,A)}),Qe(()=>t(),()=>{n(U,t().activeStates&&t().activeStates.length>0?t().activeStates.reduce((A,x)=>A+(x.acBonus||0),0):0)}),Qe(()=>t(),()=>{n(Z,t().activeStates&&t().activeStates.length>0?t().activeStates.some(A=>A.name==="Aid"&&A.target==="self"):!1)}),Qe(()=>f(),()=>{n(E,!f()||"armor class".includes(f().toLowerCase())||"initiative".includes(f().toLowerCase())||"speed".includes(f().toLowerCase())||"hit points".includes(f().toLowerCase())||"hp".includes(f().toLowerCase())||"hit dice".includes(f().toLowerCase())||"spell save".includes(f().toLowerCase())||"combat".includes(f().toLowerCase()))}),ma(),Jt();var ce=ii();let se;var he=l(ce);{let A=xt(()=>(p(),r(()=>p().combatStats?"Expand":"Collapse")));$a(he,{title:"Combat Stats",get collapsed(){return p(),r(()=>p().combatStats)},get ariaLabel(){return e(A)},onToggle:()=>ea.update(x=>({...x,combatStats:!x.combatStats}))})}var Ee=a(he,2);{var J=A=>{var x=li(),O=ke(x);{var G=ye=>{var je=ti(),He=a(l(je),2),vt=l(He),X=a(l(vt),2);D(()=>{t(),Kt(()=>{})});var Ke=l(X);Ke.value=(Ke.__value=void 0)??"";var ct=a(Ke);Ct(ct,1,()=>zs,Bt,(oe,ie)=>{var Te=kt(),tt=ke(Te);{var qe=re=>{var Y=ei(),Xe=l(Y);s(Y);var me={};D(()=>{k(Xe,`${e(ie),r(()=>e(ie).name)??""} (AC ${e(ie),r(()=>e(ie).baseAC)??""})`),me!==(me=(e(ie),r(()=>e(ie).name)))&&(Y.value=(Y.__value=(e(ie),r(()=>e(ie).name)))??"")}),o(re,Y)};m(tt,re=>{e(ie),r(()=>e(ie).name!=="Unarmored")&&re(qe)})}o(oe,Te)}),s(X),s(vt);var b=a(vt,2),H=l(b),de=l(H);we(de),sa(),s(H),s(b),s(He),s(je),Oa(X,()=>t().armorName,oe=>Gt(be,r(t).armorName=oe,r(t))),Ca(de,()=>t().shieldEquipped,oe=>Gt(be,r(t).shieldEquipped=oe,r(t))),o(ye,je)};m(O,ye=>{g()&&ye(G)})}var ue=a(O,2),_e=l(ue),Ae=l(_e),ze=a(l(Ae),2);fs(ze,{get tooltipContent(){return e(F)},ariaLabel:"Show AC breakdown"}),s(Ae);var Re=a(Ae,2);we(Re),s(_e);var De=a(_e,2),h=l(De),I=a(l(h),2);fs(I,{get tooltipContent(){return e(P)},ariaLabel:"Show Initiative breakdown"}),s(h);var ve=a(h,2),et=l(ve);we(et);var at=a(et,2);s(ve),s(De);var pt=a(De,2),Lt=a(l(pt),2);we(Lt),s(pt);var Mt=a(pt,2);{var C=ye=>{var je=ai(),He=l(je),vt=a(l(He),2);fs(vt,{get tooltipContent(){return e(q)},ariaLabel:"Show Spell Save DC breakdown"}),s(He);var X=a(He,2);we(X),s(je),D(()=>Ba(X,e(y))),o(ye,je)};m(Mt,ye=>{e(y)!==null&&ye(C)})}s(ue);var Q=a(ue,2),j=a(l(Q),2);let z;var K=l(j),pe=l(K);we(pe);var Ue=a(pe,4);we(Ue),s(K);var Fe=a(K,2),Be=l(Fe),Me=a(Be,2),w=a(Me,2),le=a(w,2);s(Fe),s(j);var V=a(j,2),Pe=a(l(V),2);we(Pe),s(V),s(Q);var Se=a(Q,2),lt=a(l(Se),2),xe=l(lt);we(xe);var te=a(xe,4);we(te);var u=a(te,2);{var it=ye=>{const je=xt(()=>(N(da),t(),r(()=>da(t().class))));var He=kt(),vt=ke(He);{var X=Ke=>{const ct=xt(()=>(v(),r(()=>v().constitution)));var b=si(),H=l(b);s(b),D(()=>k(H,`(${N(e(je)),r(()=>e(je).hitDice)??""}${(e(ct)>=0?`+${e(ct)}`:e(ct))??""})`)),o(Ke,b)};m(vt,Ke=>{e(je)&&Ke(X)})}o(ye,He)};m(u,ye=>{t(),r(()=>t().class)&&ye(it)})}s(lt);var Ge=a(lt,2),W=a(l(Ge),2),Le=l(W),Ye=a(Le,2);we(Ye);var mt=a(Ye,2);s(W);var rt=a(W,2);s(Ge),s(Se),D(()=>{Ba(Re,(e(U),t(),r(()=>e(U)!==0?`${t().armorClass} ‚Üí ${t().armorClass+e(U)}`:`${t().armorClass}`))),Ut(Re,1,gl(e(U)!==0?"stat-input ac-enhanced":"stat-input"),"svelte-1r5hyyb"),Ba(et,(t(),r(()=>t().initiative))),z=Ut(j,1,"hp-display svelte-1r5hyyb",null,z,{"aid-active":e(Z)}),ot(pe,"max",(t(),r(()=>t().maxHP))),ot(xe,"max",(t(),r(()=>t().hitDice.max))),Le.disabled=e(T)<=1,ot(Ye,"max",(t(),r(()=>t().hitDice.current))),mt.disabled=(e(T),t(),r(()=>e(T)>=t().hitDice.current)),rt.disabled=(t(),r(()=>t().hitDice.current<=0||!t().class))}),R("click",at,$e),Je(Lt,()=>t().speed,ye=>Gt(be,r(t).speed=ye,r(t))),Je(pe,()=>t().currentHP,ye=>Gt(be,r(t).currentHP=ye,r(t))),Je(Ue,()=>t().maxHP,ye=>Gt(be,r(t).maxHP=ye,r(t))),R("click",Be,()=>ee(-1)),R("click",Me,()=>ee(1)),R("click",w,()=>ee(-5)),R("click",le,()=>ee(5)),Je(Pe,()=>t().tempHP,ye=>Gt(be,r(t).tempHP=ye,r(t))),Je(xe,()=>t().hitDice.current,ye=>Gt(be,r(t).hitDice.current=ye,r(t))),Je(te,()=>t().hitDice.max,ye=>Gt(be,r(t).hitDice.max=ye,r(t))),R("click",Le,()=>fe(-1)),Je(Ye,()=>e(T),ye=>n(T,ye)),R("input",Ye,ye=>{const je=ye.target,He=parseInt(je.value);He>t().hitDice.current&&n(T,t().hitDice.current),He<1&&n(T,1)}),R("click",mt,()=>fe(1)),R("click",rt,()=>Oe(e(T))),o(A,x)};m(Ee,A=>{p(),r(()=>!p().combatStats)&&A(J)})}s(ce),D(()=>se=Ut(ce,1,"combat-stats svelte-1r5hyyb",null,se,{hidden:!e(E)})),o(i,ce),Yt(),_()}const Ja={acrobatics:"dexterity",animalHandling:"wisdom",arcana:"intelligence",athletics:"strength",deception:"charisma",history:"intelligence",insight:"wisdom",intimidation:"charisma",investigation:"intelligence",medicine:"wisdom",nature:"intelligence",perception:"wisdom",performance:"charisma",persuasion:"charisma",religion:"intelligence",sleightOfHand:"dexterity",stealth:"dexterity",survival:"wisdom"};var ni=d('<div class="skill-row svelte-1f1pl16"><input type="checkbox" class="svelte-1f1pl16"/> <label class="svelte-1f1pl16"> <span class="ability-tag svelte-1f1pl16"> </span></label> <span class="skill-modifier svelte-1f1pl16"> </span> <button class="roll-btn svelte-1f1pl16">Roll</button></div>'),oi=d('<div class="skills-grid svelte-1f1pl16"></div>'),ci=d("<section><!> <!></section>");function vi(i,c){Vt(c,!1);const t=()=>ft(be,"$character",$),v=()=>ft(as,"$abilityModifiers",$),f=()=>ft(ya,"$searchFilter",$),p=()=>ft(ea,"$collapsedStates",$),g=()=>ft(Da,"$isEditMode",$),[$,_]=ca(),y=S(),F=S(),P=S(),q=S(),U=S(),Z=S(),E=xa(),B=[{key:"acrobatics",label:"Acrobatics"},{key:"animalHandling",label:"Animal Handling"},{key:"arcana",label:"Arcana"},{key:"athletics",label:"Athletics"},{key:"deception",label:"Deception"},{key:"history",label:"History"},{key:"insight",label:"Insight"},{key:"intimidation",label:"Intimidation"},{key:"investigation",label:"Investigation"},{key:"medicine",label:"Medicine"},{key:"nature",label:"Nature"},{key:"perception",label:"Perception"},{key:"performance",label:"Performance"},{key:"persuasion",label:"Persuasion"},{key:"religion",label:"Religion"},{key:"sleightOfHand",label:"Sleight of Hand"},{key:"stealth",label:"Stealth"},{key:"survival",label:"Survival"}];function T(se){const he=Ja[se],Ee=v()[he],J=t().skillProficiencies[se]?t().proficiencyBonus:0,A=e(y)[se],x=`1d20${A>=0?"+":""}${A}`,O=[];O.push({value:"1d20",source:"base die"}),Ee!==0&&O.push({value:Ee,source:he}),J!==0&&O.push({value:J,source:"proficiency"}),E("roll",{notation:x,rollType:"check",bonusBreakdown:O})}Qe(()=>{},()=>{n(y,{})}),Qe(()=>t(),()=>{n(F,t().skillProficiencies)}),Qe(()=>t(),()=>{n(P,t().proficiencyBonus)}),Qe(()=>v(),()=>{n(q,v())}),Qe(()=>(e(q),e(F),e(P)),()=>{for(const{key:se}of B){const he=Ja[se],Ee=e(q)[he],J=e(F)[se]?e(P):0;ba(y,e(y)[se]=Ee+J)}}),Qe(()=>f(),()=>{n(U,B.filter(({label:se})=>f()?se.toLowerCase().includes(f().toLowerCase()):!0))}),Qe(()=>e(U),()=>{n(Z,e(U).length>0)}),ma(),Jt();var ee=ci();let fe;var Oe=l(ee);{let se=xt(()=>(p(),r(()=>p().skills?"Expand":"Collapse")));$a(Oe,{title:"Skills",get collapsed(){return p(),r(()=>p().skills)},get ariaLabel(){return e(se)},onToggle:()=>ea.update(he=>({...he,skills:!he.skills}))})}var $e=a(Oe,2);{var ce=se=>{var he=oi();Ct(he,5,()=>e(U),Bt,(Ee,J)=>{let A=()=>e(J).key,x=()=>e(J).label;var O=ni(),G=l(O);we(G);var ue=a(G,2),_e=l(ue),Ae=a(_e),ze=l(Ae);s(Ae),s(ue);var Re=a(ue,2),De=l(Re);s(Re);var h=a(Re,2);s(O),D(I=>{qs(G,(e(F),A(),r(()=>e(F)[A()]))),G.disabled=!g(),ot(G,"id",A()),ot(ue,"for",A()),k(_e,`${x()??""} `),k(ze,`(${I??""})`),k(De,`${e(y),A(),r(()=>e(y)[A()]>=0?"+":"")??""}${e(y),A(),r(()=>e(y)[A()])??""}`)},[()=>(N(Ja),A(),r(()=>Ja[A()].substring(0,3).toUpperCase()))]),R("change",G,I=>{console.log("Skill proficiency changed:",A(),I.target.checked),be.update(ve=>({...ve,skillProficiencies:{...ve.skillProficiencies,[A()]:I.target.checked}}))}),R("click",h,()=>T(A())),o(Ee,O)}),s(he),o(se,he)};m($e,se=>{p(),r(()=>!p().skills)&&se(ce)})}s(ee),D(()=>fe=Ut(ee,1,"skills svelte-1f1pl16",null,fe,{hidden:!e(Z)})),o(i,ee),Yt(),_()}var di=d('<p class="empty-message svelte-1123ljy">No attacks or spells to reorder.</p>'),ui=d('<li class="reorder-item svelte-1123ljy"><span class="attack-name svelte-1123ljy"> </span> <div class="reorder-buttons svelte-1123ljy"><button class="btn-move svelte-1123ljy" aria-label="Move up">‚ñ≤</button> <button class="btn-move svelte-1123ljy" aria-label="Move down">‚ñº</button></div></li>'),fi=d('<ul class="reorder-list svelte-1123ljy"></ul>'),pi=d('<div class="modal-backdrop svelte-1123ljy" role="presentation"><div class="modal-content svelte-1123ljy" role="dialog" aria-modal="true" aria-labelledby="modal-title"><div class="modal-header svelte-1123ljy"><h3 id="modal-title" class="svelte-1123ljy">Reorder Attacks & Spells</h3> <button class="btn-close svelte-1123ljy" aria-label="Close">√ó</button></div> <div class="modal-body svelte-1123ljy"><!></div> <div class="modal-footer svelte-1123ljy"><button class="btn btn-secondary svelte-1123ljy">Cancel</button> <button class="btn btn-primary svelte-1123ljy">Save Order</button></div></div></div>');function mi(i,c){Vt(c,!1);let t=Rt(c,"show",8,!1),v=Rt(c,"attacks",24,()=>[]),f=Rt(c,"onSave",8),p=Rt(c,"onCancel",8),g=S([]);function $(B,T){const ee=e(g)[B];ba(g,e(g)[B]=e(g)[T]),ba(g,e(g)[T]=ee),n(g,[...e(g)])}function _(B){B>0&&$(B,B-1)}function y(B){B<e(g).length-1&&$(B,B+1)}function F(){f()(e(g))}function P(){p()()}function q(B){B.target===B.currentTarget&&P()}Qe(()=>(N(t()),N(v())),()=>{t()&&n(g,[...v()])}),ma(),Jt();var U=kt(),Z=ke(U);{var E=B=>{var T=pi(),ee=l(T),fe=l(ee),Oe=a(l(fe),2);s(fe);var $e=a(fe,2),ce=l($e);{var se=x=>{var O=di();o(x,O)},he=x=>{var O=fi();Ct(O,7,()=>e(g),G=>G.id,(G,ue,_e)=>{var Ae=ui(),ze=l(Ae),Re=l(ze,!0);s(ze);var De=a(ze,2),h=l(De),I=a(h,2);s(De),s(Ae),D(()=>{k(Re,(e(ue),r(()=>e(ue).name||"(Unnamed attack or spell)"))),h.disabled=e(_e)===0,I.disabled=(N(e(_e)),e(g),r(()=>e(_e)===e(g).length-1))}),R("click",h,()=>_(e(_e))),R("click",I,()=>y(e(_e))),o(G,Ae)}),s(O),o(x,O)};m(ce,x=>{e(g),r(()=>e(g).length===0)?x(se):x(he,!1)})}s($e);var Ee=a($e,2),J=l(Ee),A=a(J,2);s(Ee),s(ee),s(T),R("click",Oe,P),R("click",J,P),R("click",A,F),R("click",T,q),o(B,T)};m(Z,B=>{t()&&B(E)})}o(i,U),Yt()}let Va=null,Ya=null;async function Js(){if(Va)return Va;try{return Va=await(await fetch(Ws("/data/spells.json"))).json(),Va||[]}catch(i){return console.error("Failed to load spells:",i),[]}}async function gi(){if(Ya)return Ya;try{return Ya=await(await fetch(Ws("/data/feats.json"))).json(),Ya||[]}catch(i){return console.error("Failed to load feats:",i),[]}}function Ps(i,c){if(!c.trim())return i;const t=c.toLowerCase();return i.filter(v=>v.name.toLowerCase().includes(t)||v.school.toLowerCase().includes(t)||v.classes.some(f=>f.toLowerCase().includes(t))||v.description.toLowerCase().includes(t))}function bi(i,c){return c===null?i:i.filter(t=>t.level===c)}function hi(i,c){if(!c.trim())return i;const t=c.toLowerCase();return i.filter(v=>v.name.toLowerCase().includes(t)||v.description.toLowerCase().includes(t))}function Qa(i){const c=i.description,t=/\b(Strength|Dexterity|Constitution|Intelligence|Wisdom|Charisma)\s+saving\s+throw/i,v=c.match(t);if(!v)return null;const f=v[1].toLowerCase(),g=/half\s+(?:as\s+much\s+)?damage\s+on\s+a\s+successful(?:\s+save)?|on\s+a\s+successful(?:\s+save)?[^.]*half\s+(?:as\s+much\s+)?damage/i.test(c),_=/saving\s+throw\s+or\s+take.*?damage/i.test(c)&&!g;return{ability:f,halfDamageOnSave:g,noDamageOnSave:_}}function _i(i){const c=i.description;return/(plus|add)\s+your\s+spellcasting\s+(ability\s+)?modifier/i.test(c)}function ja(i){const c=i.description.toLowerCase();return c.includes("ranged spell attack")||c.includes("melee spell attack")}function Xa(i){const c=i.description.toLowerCase();if(["Divine Favor","Bless","Aid","Command","Crusader's Mantle"].includes(i.name))return!0;const f=["takes","take","deals","deal","damage equal to","force damage","fire damage","cold damage","lightning damage","thunder damage","acid damage","poison damage","necrotic damage","radiant damage","psychic damage","regain","regains","hit point"].some($=>c.includes($));return["bonus to attack","bonus to damage","bonus to ac","gains a +","gain a +","+1 bonus","+2 bonus","+3 bonus","advantage on","becomes a magic weapon"].some($=>c.includes($))&&!f}function yi(i){const c=i.description;let t=0,v=0,f=0,p="";const g=c.match(/\+(\d+)\s+bonus\s+to\s+attack\s+rolls\s+and\s+damage\s+rolls/i);if(g){const _=parseInt(g[1]);t=_,v=_,p=`+${_} to attack and damage rolls`}if(i.name==="Bless"&&(p="Add 1d4 to attack rolls and saves",t="1d4"),i.name==="Aid")return p="+5 HP (max and current) for 8 hours",{attackBonus:0,damageBonus:0,acBonus:0,hpBonus:5,description:p,name:i.name};i.name==="Divine Favor"&&(p="Your weapon attacks deal an extra 1d4 radiant damage on a hit.",v="1d4");const $=c.match(/\+(\d+)\s+bonus\s+to\s+AC/i);return $&&(f=parseInt($[1]),p=`+${f} to AC`),i.name==="Haste"&&(p="+2 AC, doubled speed, extra action",f=2),i.name==="Crusader's Mantle"&&(p="Your weapon attacks deal an extra 1d4 radiant damage on a hit.",v="1d4"),p||t!==0||v!==0||f!==0?{attackBonus:t,damageBonus:v,acBonus:f,description:p||i.description.substring(0,100),name:i.name}:null}function ps(i){const c=i.description,t=/takes?\s+(\d+d\d+)\s+\w+\s+damage[^.]*\.\s*If\s+the\s+target\s+is\s+missing.*?instead\s+takes?\s+(\d+d\d+)/is,v=c.match(t);return v?{baseDamage:v[1],alternateDamage:v[2]}:null}var xi=d('<button class="btn btn-secondary">Reorder</button>'),$i=d('<div class="edit-buttons svelte-14o91c5"><button class="btn btn-secondary">Add Attack</button> <!></div>'),ki=d('<input type="text" placeholder="Attack name" class="attack-name svelte-14o91c5"/>'),wi=d('<h4 class="attack-name-display svelte-14o91c5"> </h4>'),Si=d('<button class="btn-remove svelte-14o91c5">√ó</button>'),Ci=d('<div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Bonus</label> <input type="number" class="attack-bonus svelte-14o91c5"/></div>'),Di=d('<div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Damage</label> <input type="text" placeholder="e.g., 2d6+3" class="attack-damage svelte-14o91c5"/></div>'),Li=d('<div class="spell-info-loading svelte-14o91c5">Loading spell info...</div>'),Ai=d('<li class="svelte-14o91c5"><strong>At Higher Levels:</strong> </li>'),ji=d('<li style="color: #007bff;" class="svelte-14o91c5"><strong>Special:</strong> Mage Hand is invisible when cast via Githyanki Psionics.</li>'),Ri=d('<li style="color: #007bff;" class="svelte-14o91c5"><strong>Cast via:</strong> </li>'),Bi=d("<!> <!>",1),Mi=d('<ul class="svelte-14o91c5"><li class="svelte-14o91c5"><strong>Level:</strong> </li> <li class="svelte-14o91c5"><strong>Casting Time:</strong> </li> <li class="svelte-14o91c5"><strong>Range:</strong> </li> <li class="svelte-14o91c5"><strong>Components:</strong> <!></li> <li class="svelte-14o91c5"><strong>Duration:</strong> <!> </li> <li class="svelte-14o91c5"><strong>Description:</strong> </li> <!> <!></ul>'),Ti=d('<span class="scaled-damage svelte-14o91c5" style="margin-left: 8px;"> </span>'),Fi=d('<span class="scaled-damage svelte-14o91c5">(Half damage)</span>'),Pi=d('<span class="scaled-damage svelte-14o91c5">(No damage)</span>'),Ii=d('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> <!> <!></label></div>'),Ei=d('<span class="scaled-damage svelte-14o91c5"> </span>'),Hi=d('<span class="scaled-damage svelte-14o91c5"> </span>'),Ui=d('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> Target is missing HP <!></label></div>'),Ni=d("<option> </option>"),Oi=d('<span class="scaled-damage svelte-14o91c5"><!> </span>'),Gi=d('<span class="scaled-damage svelte-14o91c5"> </span>'),qi=d('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> Target is Fiend or Undead <!></label></div>'),Wi=d('<div class="spell-level-selector svelte-14o91c5"><label class="svelte-14o91c5">Cast at Level:</label> <select class="spell-level-select use-enabled svelte-14o91c5"></select> <!></div> <!>',1),zi=d('<div class="spell-info svelte-14o91c5"><div class="spell-info-header svelte-14o91c5" role="button" tabindex="0"><h4 class="svelte-14o91c5">Spell Info</h4> <button class="collapse-btn-small svelte-14o91c5"> </button></div> <!></div> <!> <!> <!>',1),Ki=d('<div class="spell-info-missing svelte-14o91c5">Spell info not found.</div>'),Ji=d('<div class="attack-notes svelte-14o91c5"><label class="svelte-14o91c5">Notes</label> <textarea placeholder="e.g., DC 15 Dex save, Range 120 ft, Concentration" class="notes-input svelte-14o91c5" rows="2"></textarea></div>'),Vi=d('<div style="margin-bottom: 0.5em;"><label style="font-size:0.95em;"><input type="checkbox" class="svelte-14o91c5"/> Use Racial Trait <span style="color:#007bff; font-size:0.95em; margin-left:0.5em;"> </span></label></div>'),Yi=d('<button class="btn btn-primary">Roll Attack (Spell Slot)</button>'),Qi=d('<button class="btn btn-primary" disabled>No spell slots available</button>'),Xi=d('<button class="btn btn-primary">Roll Attack (Racial Trait)</button>'),Zi=d('<button class="btn btn-primary" disabled>No racial uses left</button>'),er=d('<div class="buff-target-selection svelte-14o91c5"><div class="target-options svelte-14o91c5"><label class="target-option svelte-14o91c5"><input type="radio" class="svelte-14o91c5"/> Self</label> <label class="target-option svelte-14o91c5"><input type="radio" class="svelte-14o91c5"/> Other</label></div> <button class="btn btn-info"> </button></div>'),tr=d('<button class="btn btn-info">Cast Spell</button>'),ar=d("<button><!></button>"),sr=d('<button class="btn btn-info">Cast Spell</button>'),lr=d("<!> <!> <!> <!>",1),ir=d('<button class="btn btn-secondary">Roll Damage</button>'),rr=d('<button class="btn btn-primary">Roll Attack</button> <!>',1),nr=d('<div class="attack-card svelte-14o91c5"><div class="attack-header svelte-14o91c5"><!> <!></div> <div class="attack-details svelte-14o91c5"><!> <!> <div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Type</label> <input type="text" placeholder="e.g., slashing" class="attack-type svelte-14o91c5"/></div></div> <!> <!> <div class="attack-actions svelte-14o91c5"><!> <!></div></div>'),or=d('<p class="no-attacks svelte-14o91c5">No attacks added yet. Click "Add Attack" to create one.</p>'),cr=d('<p class="no-attacks svelte-14o91c5">No attacks match your search.</p>'),vr=d('<span class="ability-uses svelte-14o91c5"> <!></span>'),dr=d('<span class="ability-reaction svelte-14o91c5">‚ö° Reaction</span>'),ur=d('<button class="btn btn-ability svelte-14o91c5">Use Ability</button>'),fr=d('<div class="ability-card svelte-14o91c5"><div class="ability-header svelte-14o91c5"><h4 class="ability-name svelte-14o91c5"> </h4> <span class="ability-source svelte-14o91c5"> </span></div> <p class="ability-description svelte-14o91c5"> </p> <div class="ability-footer svelte-14o91c5"><!> <!> <!></div></div>'),pr=d('<div class="condition-abilities-section svelte-14o91c5"><h3 class="abilities-header svelte-14o91c5">Condition Abilities</h3> <p class="section-description svelte-14o91c5">Special actions granted by active conditions (e.g., Flicker of Deceit)</p> <div class="abilities-list svelte-14o91c5"></div></div>'),mr=d('<button class="btn-remove svelte-14o91c5">√ó</button>'),gr=d('<div class="state-card svelte-14o91c5"><div class="state-header svelte-14o91c5"><input type="text" placeholder="Effect name (e.g., Magic Weapon)" class="state-name svelte-14o91c5"/> <!></div> <div class="state-details svelte-14o91c5"><div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Attack Bonus</label> <input type="text" class="state-bonus svelte-14o91c5" placeholder="0 or 1d4"/></div> <div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Damage Bonus</label> <input type="text" class="state-bonus svelte-14o91c5"/></div> <div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Target</label> <select class="state-bonus svelte-14o91c5"><option>Self</option><option>Other</option></select></div></div> <div class="state-description svelte-14o91c5"><label class="svelte-14o91c5">Description</label> <input type="text" placeholder="e.g., +1 to attack and damage rolls (Magic Weapon)" class="state-desc-input svelte-14o91c5"/></div></div>'),br=d('<div class="states-list svelte-14o91c5"></div>'),hr=d('<p class="no-states svelte-14o91c5">No active effects. Add spell effects that modify your attacks.</p>'),_r=d('<!> <div class="attacks-list svelte-14o91c5"><!> <!> <!></div> <!> <div class="active-states-section svelte-14o91c5"><h3 class="svelte-14o91c5">Active Spell Effects</h3> <p class="section-description svelte-14o91c5">Effects that modify attack and damage rolls (e.g., Magic Weapon, Bless)</p> <button class="btn btn-secondary">Add Effect</button> <!></div>',1),yr=d("<section><!> <!></section> <!>",1);function xr(i,c){Vt(c,!1);const t=()=>ft(be,"$character",g),v=()=>ft(ya,"$searchFilter",g),f=()=>ft(ea,"$collapsedStates",g),p=()=>ft(Da,"$isEditMode",g),[g,$]=ca(),_=S(),y=S(),F=S(),P=[];let q=S({});function U(C,Q){be.update(j=>{if(!j.activeStates)return j;const z=j.activeStates.findIndex(Fe=>Fe.name===C);if(z===-1)return j;const K=j.activeStates[z];if(!K.abilities)return j;const pe=K.abilities.findIndex(Fe=>Fe.name===Q);if(pe===-1)return j;const Ue=K.abilities[pe];return Ue.currentUses!==void 0&&Ue.currentUses>0&&(Ue.currentUses-=1,Ue.usesPerRest!==void 0?Ht.add(`Used ${Q} (${Ue.currentUses}/${Ue.usesPerRest} remaining)`,"info"):Ht.add(`Used ${Q}`,"info")),j})}const Z=xa();let E=S({}),B=S({}),T=S(!1);function ee(C){ba(E,e(E)[C]=!e(E)[C]),n(E,{...e(E)})}function fe(C){return C.description.toLowerCase().includes("regain")&&(C.description.toLowerCase().includes("hit point")||C.description.toLowerCase().includes("hp"))}function Oe(C){return["Shield of Faith","Bless","Aid","Magic Weapon"].includes(C)}function $e(){be.update(C=>(C.attacks=[...C.attacks,{id:crypto.randomUUID(),name:"",bonus:0,damage:"",damageType:"",notes:""}],C))}function ce(C){be.update(Q=>(Q.attacks=Q.attacks.filter(j=>j.id!==C),Q))}function se(){n(T,!0)}function he(){n(T,!1)}function Ee(C){be.update(Q=>(Q.attacks=C,Q)),n(T,!1),Ht.add("Attack order updated successfully!","success")}function J(C,Q){let j=C.damage,z=!1,K=!1;const pe=[];if(C.spellRef){const w=G(C.spellRef);if(w&&(K=ja(w),w.level>0)){const le=C.castAtLevel||w.level;let V=!1;if(Q||C.source==="racial"){if(V=_e(C.name),!V){Ht.add(`No uses of ${C.name} remaining!`,"error");return}}else if(V=ue(le),!V){Ht.add(`No level ${le} spell slots available!`,"error");return}const Se=Qa(w);Se&&C.targetSucceededSave&&Se.noDamageOnSave?j="0":(z=Se?.halfDamageOnSave&&C.targetSucceededSave||!1,j=Ae(C,w))}}else if(j){const w=j.match(/(\d+d\d+)([+-]?\d+)?/);if(w){const[,le,V]=w,Pe=V?parseInt(V):0;if(Pe!==0&&pe.push({value:Pe,source:"base"}),t().activeStates&&t().activeStates.length>0){let Se=0,lt=[];for(const xe of t().activeStates)xe.target!=="other"&&(typeof xe.damageBonus=="string"?(lt.push(xe.damageBonus),pe.push({value:xe.damageBonus,source:xe.name})):typeof xe.damageBonus=="number"&&xe.damageBonus!==0&&(Se+=xe.damageBonus,pe.push({value:xe.damageBonus,source:xe.name})));if(Se!==0||lt.length>0){const xe=Pe+Se;let te=`${le}`;xe!==0&&(te+=`${xe>=0?"+":""}${xe}`),lt.length>0&&(te+=" + "+lt.join(" + ")),j=te}}}}const Ue=[];let Fe=0;if(K){const w=us(t(),t().abilities),le=t().proficiencyBonus||0;Ue.push({value:le,source:"proficiency"}),Ue.push({value:w,source:"spellcasting"}),Fe=le+w}else C.bonus!==0&&Ue.push({value:C.bonus,source:"base"}),Fe=C.bonus;let Be=[];if(t().activeStates)for(const w of t().activeStates)w.target!=="other"&&(typeof w.attackBonus=="number"&&w.attackBonus!==0?(Ue.push({value:w.attackBonus,source:w.name}),Fe+=w.attackBonus):typeof w.attackBonus=="string"&&w.attackBonus&&(Be.push(w.attackBonus),Ue.push({value:w.attackBonus,source:w.name})));let Me=`1d20${Fe>=0?"+":""}${Fe}`;Be.length>0&&(Me+="+"+Be.join("+")),Z("roll",{notation:Me,damageNotation:j,attackName:C.name,applyHalfDamage:z,bonusBreakdown:Ue,damageBreakdown:pe,rollType:"attack"})}function A(C){if(!C.damage){Ht.add(`${C.name}: No damage specified`,"error");return}let Q=C.damage,j=!1;const z=[];let K=C.damageType||"";if(C.spellRef){const pe=G(C.spellRef);if(pe){const Ue=fe(pe);if(Ue){const Fe=us(t(),t().abilities),Be=Q.match(/^(\d+d\d+)/);Be&&(Q=Be[1],Fe>0&&(Q+=`+${Fe}`,z.push({value:Fe,source:"spellcasting"}))),K="Healing"}if(pe.level>0){const Fe=C.castAtLevel||pe.level;let Be=!1;if(C.source==="racial"){if(Be=_e(C.name),!Be){Ht.add(`No uses of ${C.name} remaining!`,"error");return}}else if(Be=ue(Fe),!Be){Ht.add(`No level ${Fe} spell slots available!`,"error");return}const Me=Qa(pe);Me&&C.targetSucceededSave&&Me.noDamageOnSave?Q="0":(j=Me?.halfDamageOnSave&&C.targetSucceededSave||!1,Ue||(Q=Ae(C,pe)))}}}else{const pe=Q.match(/(\d+d\d+)([+-]\d+)?/);if(pe){const[,Ue,Fe]=pe,Be=Fe?parseInt(Fe):0;if(Be!==0&&z.push({value:Be,source:"base"}),t().activeStates&&t().activeStates.length>0){let Me=0,w=[];for(const le of t().activeStates)le.target!=="other"&&(typeof le.damageBonus=="string"?(w.push(le.damageBonus),z.push({value:le.damageBonus,source:le.name})):typeof le.damageBonus=="number"&&le.damageBonus!==0&&(z.push({value:le.damageBonus,source:le.name}),Me+=le.damageBonus));if(Me!==0||w.length>0){const le=Be+Me;let V=`${Ue}`;le!==0&&(V+=`${le>=0?"+":""}${le}`),w.length>0&&(V+=" + "+w.join(" + ")),Q=V}}}}Z("roll",{notation:Q,attackName:C.name,applyHalfDamage:j,bonusBreakdown:z,damageType:K})}let x=S([]),O=S(!1);La(async()=>{n(x,await Js()),n(O,!0)});function G(C){return e(x).find(Q=>Q.name===C)}function ue(C){t().classFeatures.spellSlotsByLevel||Gt(be,r(t).classFeatures.spellSlotsByLevel={},r(t)),t().classFeatures.spellSlotsByLevel[C]||Gt(be,r(t).classFeatures.spellSlotsByLevel[C]=Array(2).fill(!1),r(t));const j=t().classFeatures.spellSlotsByLevel[C].findIndex(z=>!z);return j===-1?!1:(be.update(z=>(z.classFeatures.spellSlotsByLevel||(z.classFeatures.spellSlotsByLevel={}),z.classFeatures.spellSlotsByLevel[C]||(z.classFeatures.spellSlotsByLevel[C]=Array(2).fill(!1)),z.classFeatures.spellSlotsByLevel[C][j]=!0,z)),!0)}function _e(C){return!t().racialTraits||!t().racialTraits.uses[C]?!0:t().racialTraits.uses[C].currentUses<=0?!1:(bl(C),!0)}function Ae(C,Q){let j=C.damage,z=0,K=0;const pe=ps(Q);if(pe&&C.targetIsDamaged&&(j=pe.alternateDamage),_i(Q)&&(K+=us(t(),t().abilities)),t().activeStates)for(const Se of t().activeStates)Se.target!=="other"&&typeof Se.damageBonus=="number"&&(K+=Se.damageBonus);if(Q.higherLevelSlot&&C.castAtLevel){const Se=Q.level,xe=(C.castAtLevel||Se)-Se;if(xe>0){const te=Q.higherLevelSlot.match(/(\d+)d(\d+)\s+for\s+each.*?level\s+above/i);if(te){const[,u]=te;z+=xe*parseInt(u)}}}if(C.targetIsFiendOrUndead&&Q.description.includes("Fiend or an Undead")){const Se=Q.description.match(/increases by (\d+)d(\d+) if.*?Fiend or.*?Undead/i);if(Se){const[,lt]=Se;z+=parseInt(lt)}}const Ue=j.match(/(\d+)d(\d+)([+-]\d+)?/);if(!Ue)return K!==0?K>=0?`${K}`:`${K}`:j||"0";const[,Fe,Be,Me]=Ue,w=parseInt(Fe)+z,V=(Me?parseInt(Me):0)+K;let Pe=`${w}d${Be}`;return V!==0&&(Pe+=V>=0?`+${V}`:`${V}`),Pe}function ze(C){const Q=[];for(let z=C.level;z<=9;z++){const K=t().classFeatures.spellSlotsByLevel?.[z];K&&K.length>0&&Q.push(z)}return Q}function Re(){be.update(C=>(C.activeStates||(C.activeStates=[]),C.activeStates=[...C.activeStates,{name:"",attackBonus:0,damageBonus:0,description:"",target:"self"}],C))}function De(C){be.update(Q=>{if(Q.activeStates){const j=Q.activeStates[C];j?.hpBonus&&j.target!=="other"&&(Q.maxHP-=j.hpBonus,Q.currentHP=Math.max(1,Math.min(Q.currentHP-j.hpBonus,Q.maxHP))),Q.activeStates=Q.activeStates.filter((z,K)=>K!==C)}return Q})}function h(C,Q="self"){const j=G(C.spellRef);if(!j){Ht.add("Spell not found","error");return}const z=C.castAtLevel||j.level;if(z>0){let w=!1;if(C.source==="racial"){if(w=_e(C.name),!w){Ht.add(`No uses of ${C.name} remaining!`,"error");return}}else if(w=ue(z),!w){Ht.add(`No level ${z} spell slots available!`,"error");return}}const K=yi(j);if(!K){Ht.add(`${j.name} cast! Check spell description for effects.`,"info");return}let pe=K.hpBonus||0,Ue=K.description;j.name==="Aid"&&z>j.level&&(pe=5+(z-j.level)*5,Ue=`+${pe} HP (max and current) for 8 hours`);const Be=["Shield of Faith","Bless","Aid","Magic Weapon"].includes(j.name);be.update(w=>{w.activeStates||(w.activeStates=[]);const le=w.activeStates.find(V=>V.name===j.name);return le&&le.hpBonus&&le.target!=="other"&&(w.maxHP-=le.hpBonus,w.currentHP=Math.max(1,Math.min(w.currentHP-le.hpBonus,w.maxHP))),w.activeStates=w.activeStates.filter(V=>V.name!==j.name),pe>0&&Q==="self"&&(w.maxHP+=pe,w.currentHP+=pe),w.activeStates=[...w.activeStates,{name:j.name,attackBonus:K.attackBonus,damageBonus:K.damageBonus,acBonus:K.acBonus,description:Ue,target:Q,hpBonus:pe}],w});const Me=Q==="self"?" on self":" on other";Ht.add(`${j.name} cast${Be?Me:""}! Effect added to Active Spell Effects.`,"success")}Qe(()=>t(),()=>{n(_,t().activeStates?t().activeStates.filter(C=>C.abilities&&C.abilities.length>0).flatMap(C=>C.abilities.map(Q=>({...Q,conditionName:C.name}))):[])}),Qe(()=>(t(),e(E),e(B)),()=>{if(t()&&t().attacks)for(const C of t().attacks)C.spellRef&&e(E)[C.id]===void 0&&ba(E,e(E)[C.id]=!0),C.spellRef&&e(B)[C.id]===void 0&&ba(B,e(B)[C.id]="self")}),Qe(()=>(t(),v()),()=>{n(y,t().attacks.filter(C=>{if(!v())return!0;const Q=v().toLowerCase();return C.name.toLowerCase().includes(Q)||C.damageType.toLowerCase().includes(Q)}).sort((C,Q)=>!C.spellRef&&Q.spellRef?-1:C.spellRef&&!Q.spellRef?1:0))}),Qe(()=>(v(),e(y)),()=>{n(F,!v()||e(y).length>0||"attack".includes(v().toLowerCase())||"spell".includes(v().toLowerCase()))}),ma(),Jt();var I=yr(),ve=ke(I);let et;var at=l(ve);{let C=xt(()=>(f(),r(()=>f().attacks?"Expand":"Collapse")));$a(at,{title:"Attacks & Spells",get collapsed(){return f(),r(()=>f().attacks)},get ariaLabel(){return e(C)},onToggle:()=>ea.update(Q=>({...Q,attacks:!Q.attacks}))})}var pt=a(at,2);{var Lt=C=>{var Q=_r(),j=ke(Q);{var z=te=>{var u=$i(),it=l(u),Ge=a(it,2);{var W=Le=>{var Ye=xi();R("click",Ye,se),o(Le,Ye)};m(Ge,Le=>{t(),r(()=>t().attacks.length>0)&&Le(W)})}s(u),R("click",it,$e),o(te,u)};m(j,te=>{p()&&te(z)})}var K=a(j,2),pe=l(K);Ct(pe,1,()=>e(y),te=>te.id,(te,u,it)=>{var Ge=nr(),W=l(Ge),Le=l(W);{var Ye=me=>{var ae=ki();we(ae),Je(ae,()=>e(u).name,ge=>(e(u).name=ge,Kt(()=>(e(y),t(),v())))),o(me,ae)},mt=me=>{var ae=wi(),ge=l(ae,!0);s(ae),D(()=>k(ge,(e(u),r(()=>e(u).name||"(Unnamed Attack)")))),o(me,ae)};m(Le,me=>{p()?me(Ye):me(mt,!1)})}var rt=a(Le,2);{var ye=me=>{var ae=Si();R("click",ae,()=>ce(e(u).id)),o(me,ae)};m(rt,me=>{p()&&me(ye)})}s(W);var je=a(W,2),He=l(je);{var vt=me=>{var ae=Ci(),ge=l(ae),Ze=a(ge,2);we(Ze),s(ae),D(()=>{ot(ge,"for",`attack-bonus-${e(u),r(()=>e(u).id)??""}`),ot(Ze,"id",`attack-bonus-${e(u),r(()=>e(u).id)??""}`)}),Je(Ze,()=>e(u).bonus,wt=>(e(u).bonus=wt,Kt(()=>(e(y),t(),v())))),o(me,ae)};m(He,me=>{e(u),r(()=>e(u).bonus!==0&&e(u).bonus!==void 0)&&me(vt)})}var X=a(He,2);{var Ke=me=>{var ae=Di(),ge=l(ae),Ze=a(ge,2);we(Ze),s(ae),D(()=>{ot(ge,"for",`attack-damage-${e(u),r(()=>e(u).id)??""}`),ot(Ze,"id",`attack-damage-${e(u),r(()=>e(u).id)??""}`)}),Je(Ze,()=>e(u).damage,wt=>(e(u).damage=wt,Kt(()=>(e(y),t(),v())))),o(me,ae)};m(X,me=>{e(u),r(()=>e(u).damage&&e(u).damage.trim()!=="")&&me(Ke)})}var ct=a(X,2),b=l(ct),H=a(b,2);we(H),s(ct),s(je);var de=a(je,2);{var oe=me=>{var ae=kt(),ge=ke(ae);{var Ze=nt=>{var ne=Li();o(nt,ne)},wt=nt=>{const ne=xt(()=>(e(u),r(()=>G(e(u).spellRef))));var qt=kt(),Ie=ke(qt);{var St=ia=>{const Nt=xt(()=>(N(Qa),N(e(ne)),r(()=>Qa(e(ne))))),At=xt(()=>(N(ps),N(e(ne)),r(()=>ps(e(ne)))));var L=zi(),We=ke(L),Ce=l(We),st=a(l(Ce),2),M=l(st,!0);s(st),s(Ce);var dt=a(Ce,2);{var gt=Ve=>{var $t=Mi(),Ot=l($t),zt=a(l(Ot));s(Ot);var ra=a(Ot,2),ua=a(l(ra));s(ra);var va=a(ra,2),Qt=a(l(va));s(va);var ta=a(va,2),Xt=a(l(ta)),Et=a(Xt);{var oa=_t=>{var aa=Pt();D(()=>k(aa,`(${N(e(ne)),r(()=>e(ne).material)??""})`)),o(_t,aa)};m(Et,_t=>{N(e(ne)),r(()=>e(ne).material)&&_t(oa)})}s(ta);var fa=a(ta,2),ga=a(l(fa),2);{var Wt=_t=>{var aa=Pt("Concentration,");o(_t,aa)};m(ga,_t=>{N(e(ne)),r(()=>e(ne).concentration)&&_t(Wt)})}var na=a(ga,1,!0);s(fa);var Zt=a(fa,2),pa=a(l(Zt));s(Zt);var yt=a(Zt,2);{var Tt=_t=>{var aa=Ai(),ka=a(l(aa));s(aa),D(()=>k(ka,` ${N(e(ne)),r(()=>e(ne).higherLevelSlot)??""}`)),o(_t,aa)};m(yt,_t=>{N(e(ne)),r(()=>e(ne).higherLevelSlot)&&_t(Tt)})}var jt=a(yt,2);{var It=_t=>{var aa=Bi(),ka=ke(aa);{var ls=_a=>{var Aa=ji();o(_a,Aa)};m(ka,_a=>{e(u),N(e(ne)),r(()=>e(u).racialTraitName==="Githyanki Psionics"&&e(ne).name==="Mage Hand")&&_a(ls)})}var qa=a(ka,2);{var is=_a=>{var Aa=Ri(),wa=a(l(Aa));s(Aa),D(()=>k(wa,` ${e(u),r(()=>e(u).racialTraitName)??""}`)),o(_a,Aa)};m(qa,_a=>{e(u),r(()=>e(u).racialTraitName)&&_a(is)})}o(_t,aa)};m(jt,_t=>{e(u),r(()=>e(u).source==="racial")&&_t(It)})}s($t),D(_t=>{k(zt,` ${N(e(ne)),r(()=>e(ne).level)??""}`),k(ua,` ${N(e(ne)),r(()=>e(ne).castingTime||e(ne).actionType)??""}`),k(Qt,` ${N(e(ne)),r(()=>e(ne).range)??""}`),k(Xt,` ${_t??""}`),k(na,(N(e(ne)),r(()=>e(ne).duration))),k(pa,` ${N(e(ne)),r(()=>e(ne).description)??""}`)},[()=>(N(e(ne)),r(()=>e(ne).components.join(", ")))]),o(Ve,$t)};m(dt,Ve=>{e(E),e(u),r(()=>!e(E)[e(u).id])&&Ve(gt)})}s(We);var ut=a(We,2);{var Ne=Ve=>{var $t=Ii(),Ot=l($t),zt=l(Ot);we(zt);var ra=a(zt),ua=a(ra);{var va=Et=>{var oa=Ti(),fa=l(oa);s(oa),D(ga=>k(fa,`(Spell Save DC: ${ga??""})`),[()=>(N(ys),t(),r(()=>ys(t(),t().abilities)))]),o(Et,oa)};m(ua,Et=>{t(),r(()=>t().class)&&Et(va)})}var Qt=a(ua,2);{var ta=Et=>{var oa=Fi();o(Et,oa)},Xt=Et=>{var oa=kt(),fa=ke(oa);{var ga=Wt=>{var na=Pi();o(Wt,na)};m(fa,Wt=>{e(u),N(e(Nt)),r(()=>e(u).targetSucceededSave&&e(Nt).noDamageOnSave)&&Wt(ga)},!0)}o(Et,oa)};m(Qt,Et=>{e(u),N(e(Nt)),r(()=>e(u).targetSucceededSave&&e(Nt).halfDamageOnSave)?Et(ta):Et(Xt,!1)})}s(Ot),s($t),D(Et=>k(ra,` Target succeeded on ${Et??""} save `),[()=>(N(e(Nt)),r(()=>e(Nt).ability.charAt(0).toUpperCase()+e(Nt).ability.slice(1)))]),Ca(zt,()=>e(u).targetSucceededSave,Et=>(e(u).targetSucceededSave=Et,Kt(()=>(e(y),t(),v())))),o(Ve,$t)};m(ut,Ve=>{e(Nt)&&Ve(Ne)})}var Dt=a(ut,2);{var bt=Ve=>{var $t=Ui(),Ot=l($t),zt=l(Ot);we(zt);var ra=a(zt,2);{var ua=Qt=>{const ta=xt(()=>(e(u),N(e(ne)),r(()=>Ae(e(u),e(ne)))));var Xt=Ei(),Et=l(Xt);s(Xt),D(()=>k(Et,`(${N(e(At)),r(()=>e(At).alternateDamage)??""}, total: ${e(ta)??""})`)),o(Qt,Xt)},va=Qt=>{var ta=Hi(),Xt=l(ta);s(ta),D(()=>k(Xt,`(${N(e(At)),r(()=>e(At).baseDamage)??""})`)),o(Qt,ta)};m(ra,Qt=>{e(u),r(()=>e(u).targetIsDamaged)?Qt(ua):Qt(va,!1)})}s(Ot),s($t),Ca(zt,()=>e(u).targetIsDamaged,Qt=>(e(u).targetIsDamaged=Qt,Kt(()=>(e(y),t(),v())))),o(Ve,$t)};m(Dt,Ve=>{e(At)&&Ve(bt)})}var Ft=a(Dt,2);{var ht=Ve=>{const $t=xt(()=>(N(e(ne)),r(()=>ze(e(ne)))));var Ot=kt(),zt=ke(Ot);{var ra=ua=>{var va=Wi(),Qt=ke(va),ta=l(Qt),Xt=a(ta,2);D(()=>{e(u),Kt(()=>{e($t)})}),Ct(Xt,5,()=>e($t),Bt,(Wt,na)=>{var Zt=Ni(),pa=l(Zt);s(Zt);var yt={};D(()=>{k(pa,`Level ${e(na)??""}`),yt!==(yt=e(na))&&(Zt.value=(Zt.__value=e(na))??"")}),o(Wt,Zt)}),s(Xt);var Et=a(Xt,2);{var oa=Wt=>{const na=xt(()=>(e(u),N(e(ne)),r(()=>Ae(e(u),e(ne)))));var Zt=Oi(),pa=l(Zt);{var yt=It=>{var _t=Pt("Healing");o(It,_t)},Tt=It=>{var _t=Pt("Damage");o(It,_t)};m(pa,It=>{N(e(ne)),r(()=>fe(e(ne)))?It(yt):It(Tt,!1)})}var jt=a(pa);s(Zt),D(()=>k(jt,` ${e(na)??""}`)),o(Wt,Zt)};m(Et,Wt=>{e(u),N(e(ne)),r(()=>e(u).castAtLevel&&e(u).castAtLevel>e(ne).level)&&Wt(oa)})}s(Qt);var fa=a(Qt,2);{var ga=Wt=>{var na=qi(),Zt=l(na),pa=l(Zt);we(pa);var yt=a(pa,2);{var Tt=jt=>{const It=xt(()=>(e(u),N(e(ne)),r(()=>Ae(e(u),e(ne)))));var _t=Gi(),aa=l(_t);s(_t),D(()=>k(aa,`(+1d8, total: ${e(It)??""})`)),o(jt,_t)};m(yt,jt=>{e(u),r(()=>e(u).targetIsFiendOrUndead)&&jt(Tt)})}s(Zt),s(na),Ca(pa,()=>e(u).targetIsFiendOrUndead,jt=>(e(u).targetIsFiendOrUndead=jt,Kt(()=>(e(y),t(),v())))),o(Wt,na)};m(fa,Wt=>{N(e(ne)),r(()=>e(ne).description.includes("Fiend or an Undead"))&&Wt(ga)})}D(()=>{ot(ta,"for",`castLevel-${e(u),r(()=>e(u).id)??""}`),ot(Xt,"id",`castLevel-${e(u),r(()=>e(u).id)??""}`)}),Oa(Xt,()=>e(u).castAtLevel,Wt=>(e(u).castAtLevel=Wt,Kt(()=>(e(y),t(),v())))),o(ua,va)};m(zt,ua=>{N(e($t)),e(q),e(u),r(()=>e($t).length>0&&!e(q)[e(u).id])&&ua(ra)})}o(Ve,Ot)};m(Ft,Ve=>{N(e(ne)),r(()=>e(ne).higherLevelSlot&&e(ne).level>0)&&Ve(ht)})}D(()=>{ot(st,"aria-label",(e(E),e(u),r(()=>e(E)[e(u).id]?"Expand":"Collapse"))),k(M,(e(E),e(u),r(()=>e(E)[e(u).id]?"‚ñº":"‚ñ≤")))}),R("click",Ce,()=>ee(e(u).id)),R("keydown",Ce,Ve=>Ve.key==="Enter"&&ee(e(u).id)),o(ia,L)},la=ia=>{var Nt=Ki();o(ia,Nt)};m(Ie,ia=>{e(ne)?ia(St):ia(la,!1)})}o(nt,qt)};m(ge,nt=>{e(x),r(()=>e(x).length===0)?nt(Ze):nt(wt,!1)})}o(me,ae)};m(de,me=>{e(u),r(()=>e(u).spellRef)&&me(oe)})}var ie=a(de,2);{var Te=me=>{var ae=kt(),ge=ke(ae);{var Ze=wt=>{var nt=Ji(),ne=l(nt),qt=a(ne,2);Ra(qt),s(nt),D(()=>{ot(ne,"for",`attack-notes-${e(u),r(()=>e(u).id)??""}`),ot(qt,"id",`attack-notes-${e(u),r(()=>e(u).id)??""}`)}),Je(qt,()=>e(u).notes,Ie=>(e(u).notes=Ie,Kt(()=>(e(y),t(),v())))),o(wt,nt)};m(ge,wt=>{e(u),r(()=>e(u).notes&&e(u).notes.trim()!=="")&&wt(Ze)})}o(me,ae)};m(ie,me=>{e(u),r(()=>!e(u).spellRef)&&me(Te)})}var tt=a(ie,2),qe=l(tt);{var re=me=>{const ae=xt(()=>(e(u),r(()=>G(e(u).spellRef))));var ge=kt(),Ze=ke(ge);{var wt=nt=>{const ne=xt(()=>(t(),e(u),r(()=>t().racialTraits&&t().racialTraits.uses[e(u).name])));var qt=lr(),Ie=ke(qt);{var St=Ce=>{var st=Vi(),M=l(st),dt=l(M);we(dt);var gt=a(dt,2),ut=l(gt);s(gt),s(M),s(st),D(()=>k(ut,`(${N(e(ne)),r(()=>e(ne).currentUses)??""}/${N(e(ne)),r(()=>e(ne).maxUses)??""} uses left)`)),Ca(dt,()=>e(q)[e(u).id],Ne=>ba(q,e(q)[e(u).id]=Ne)),R("change",dt,()=>{n(q,{...e(q)})}),o(Ce,st)};m(Ie,Ce=>{e(u),N(e(ne)),r(()=>e(u).source==="racial"&&e(ne))&&Ce(St)})}var la=a(Ie,2);{var ia=Ce=>{var st=kt(),M=ke(st);{var dt=ut=>{var Ne=kt(),Dt=ke(Ne);{var bt=ht=>{var Ve=Yi();R("click",Ve,()=>J(e(u),!1)),o(ht,Ve)},Ft=ht=>{var Ve=Qi();o(ht,Ve)};m(Dt,ht=>{t(),N(e(ae)),r(()=>t().classFeatures&&t().classFeatures.spellSlotsByLevel&&t().classFeatures.spellSlotsByLevel[e(ae).level]?.some(Ve=>!Ve))?ht(bt):ht(Ft,!1)})}o(ut,Ne)},gt=ut=>{var Ne=kt(),Dt=ke(Ne);{var bt=ht=>{var Ve=Xi();R("click",Ve,()=>J(e(u),!0)),o(ht,Ve)},Ft=ht=>{var Ve=Zi();o(ht,Ve)};m(Dt,ht=>{N(e(ne)),r(()=>e(ne)&&e(ne).currentUses>0)?ht(bt):ht(Ft,!1)})}o(ut,Ne)};m(M,ut=>{e(q),e(u),r(()=>!e(q)[e(u).id])?ut(dt):ut(gt,!1)})}o(Ce,st)};m(la,Ce=>{N(ja),N(e(ae)),r(()=>ja(e(ae)))&&Ce(ia)})}var Nt=a(la,2);{var At=Ce=>{var st=kt(),M=ke(st);{var dt=ut=>{var Ne=er(),Dt=l(Ne),bt=l(Dt),Ft=l(bt);we(Ft),Ft.value=Ft.__value="self",sa(),s(bt);var ht=a(bt,2),Ve=l(ht);we(Ve),Ve.value=Ve.__value="other",sa(),s(ht),s(Dt);var $t=a(Dt,2),Ot=l($t);s($t),s(Ne),D(()=>{ot(Ft,"name",`target-${e(u),r(()=>e(u).id)??""}`),ot(Ve,"name",`target-${e(u),r(()=>e(u).id)??""}`),k(Ot,`Cast ${N(e(ae)),r(()=>e(ae).name)??""}`)}),Rs(P,[it],Ft,()=>e(B)[e(u).id],zt=>ba(B,e(B)[e(u).id]=zt)),Rs(P,[it],Ve,()=>e(B)[e(u).id],zt=>ba(B,e(B)[e(u).id]=zt)),R("click",$t,()=>h(e(u),e(B)[e(u).id])),o(ut,Ne)},gt=ut=>{var Ne=tr();R("click",Ne,()=>h(e(u),"self")),o(ut,Ne)};m(M,ut=>{N(e(ae)),r(()=>Oe(e(ae).name))?ut(dt):ut(gt,!1)})}o(Ce,st)};m(Nt,Ce=>{N(ja),N(e(ae)),N(Xa),r(()=>!ja(e(ae))&&Xa(e(ae)))&&Ce(At)})}var L=a(Nt,2);{var We=Ce=>{var st=kt(),M=ke(st);{var dt=ut=>{var Ne=ar(),Dt=l(Ne);{var bt=ht=>{var Ve=Pt("Roll Healing");o(ht,Ve)},Ft=ht=>{var Ve=Pt("Roll Damage");o(ht,Ve)};m(Dt,ht=>{N(e(ae)),r(()=>fe(e(ae)))?ht(bt):ht(Ft,!1)})}s(Ne),D(ht=>Ut(Ne,1,`btn ${ht??""}`),[()=>(N(e(ae)),r(()=>fe(e(ae))?"btn-success":"btn-secondary"))]),R("click",Ne,()=>A(e(u))),o(ut,Ne)},gt=ut=>{var Ne=sr();R("click",Ne,()=>h(e(u),"self")),o(ut,Ne)};m(M,ut=>{e(u),r(()=>e(u).damage&&e(u).damage.trim()!=="")?ut(dt):ut(gt,!1)})}o(Ce,st)};m(L,Ce=>{N(ja),N(e(ae)),N(Xa),r(()=>!ja(e(ae))&&!Xa(e(ae)))&&Ce(We)})}o(nt,qt)};m(Ze,nt=>{e(ae)&&nt(wt)})}o(me,ge)};m(qe,me=>{e(u),e(O),r(()=>e(u).spellRef&&e(O))&&me(re)})}var Y=a(qe,2);{var Xe=me=>{var ae=rr(),ge=ke(ae),Ze=a(ge,2);{var wt=nt=>{var ne=ir();R("click",ne,()=>A(e(u))),o(nt,ne)};m(Ze,nt=>{e(u),r(()=>e(u).damage&&e(u).damage.trim()!=="")&&nt(wt)})}R("click",ge,()=>J(e(u))),o(me,ae)};m(Y,me=>{e(u),r(()=>!e(u).spellRef)&&me(Xe)})}s(tt),s(Ge),D(()=>{ot(b,"for",`attack-type-${e(u),r(()=>e(u).id)??""}`),ot(H,"id",`attack-type-${e(u),r(()=>e(u).id)??""}`)}),Je(H,()=>e(u).damageType,me=>(e(u).damageType=me,Kt(()=>(e(y),t(),v())))),o(te,Ge)});var Ue=a(pe,2);{var Fe=te=>{var u=or();o(te,u)};m(Ue,te=>{t(),r(()=>t().attacks.length===0)&&te(Fe)})}var Be=a(Ue,2);{var Me=te=>{var u=cr();o(te,u)};m(Be,te=>{e(y),t(),r(()=>e(y).length===0&&t().attacks.length>0)&&te(Me)})}s(K);var w=a(K,2);{var le=te=>{var u=pr(),it=a(l(u),4);Ct(it,5,()=>e(_),Bt,(Ge,W)=>{var Le=fr(),Ye=l(Le),mt=l(Ye),rt=l(mt,!0);s(mt);var ye=a(mt,2),je=l(ye);s(ye),s(Ye);var He=a(Ye,2),vt=l(He,!0);s(He);var X=a(He,2),Ke=l(X);{var ct=ie=>{var Te=vr(),tt=l(Te),qe=a(tt);{var re=Y=>{var Xe=Pt();D(()=>k(Xe,`per ${e(W),r(()=>e(W).restType)??""} rest`)),o(Y,Xe)};m(qe,Y=>{e(W),r(()=>e(W).restType)&&Y(re)})}s(Te),D(()=>k(tt,`${e(W),r(()=>e(W).currentUses??e(W).usesPerRest)??""}/${e(W),r(()=>e(W).usesPerRest)??""} uses `)),o(ie,Te)};m(Ke,ie=>{e(W),r(()=>e(W).usesPerRest)&&ie(ct)})}var b=a(Ke,2);{var H=ie=>{var Te=dr();o(ie,Te)};m(b,ie=>{e(W),r(()=>e(W).requiresReaction)&&ie(H)})}var de=a(b,2);{var oe=ie=>{var Te=ur();D(()=>Te.disabled=(e(W),r(()=>e(W).currentUses===void 0||e(W).currentUses===0))),R("click",Te,()=>U(e(W).conditionName,e(W).name)),o(ie,Te)};m(de,ie=>{p(),e(W),r(()=>!p()&&e(W).usesPerRest)&&ie(oe)})}s(X),s(Le),D(()=>{k(rt,(e(W),r(()=>e(W).name))),k(je,`(${e(W),r(()=>e(W).conditionName)??""})`),k(vt,(e(W),r(()=>e(W).description)))}),o(Ge,Le)}),s(it),s(u),o(te,u)};m(w,te=>{e(_),r(()=>e(_).length>0)&&te(le)})}var V=a(w,2),Pe=a(l(V),4),Se=a(Pe,2);{var lt=te=>{var u=br();Ct(u,5,()=>(t(),r(()=>t().activeStates)),Bt,(it,Ge,W)=>{var Le=gr(),Ye=l(Le),mt=l(Ye);we(mt);var rt=a(mt,2);{var ye=Y=>{var Xe=mr();R("click",Xe,()=>De(W)),o(Y,Xe)};m(rt,Y=>{p()&&Y(ye)})}s(Ye);var je=a(Ye,2),He=l(je),vt=l(He);ot(vt,"for",`state-attack-bonus-${W}`);var X=a(vt,2);we(X),ot(X,"id",`state-attack-bonus-${W}`),s(He);var Ke=a(He,2),ct=l(Ke);ot(ct,"for",`state-damage-bonus-${W}`);var b=a(ct,2);we(b),ot(b,"id",`state-damage-bonus-${W}`),s(Ke);var H=a(Ke,2),de=l(H);ot(de,"for",`state-target-${W}`);var oe=a(de,2);D(()=>{e(Ge),Kt(()=>{})}),ot(oe,"id",`state-target-${W}`);var ie=l(oe);ie.value=ie.__value="self";var Te=a(ie);Te.value=Te.__value="other",s(oe),s(H),s(je);var tt=a(je,2),qe=l(tt);ot(qe,"for",`state-desc-${W}`);var re=a(qe,2);we(re),ot(re,"id",`state-desc-${W}`),s(tt),s(Le),Je(mt,()=>e(Ge).name,Y=>(e(Ge).name=Y,Kt(()=>t()),Ia(g,"$character"))),Je(X,()=>e(Ge).attackBonus,Y=>(e(Ge).attackBonus=Y,Kt(()=>t()),Ia(g,"$character"))),Je(b,()=>e(Ge).damageBonus,Y=>(e(Ge).damageBonus=Y,Kt(()=>t()),Ia(g,"$character"))),Oa(oe,()=>e(Ge).target,Y=>(e(Ge).target=Y,Kt(()=>t()),Ia(g,"$character"))),Je(re,()=>e(Ge).description,Y=>(e(Ge).description=Y,Kt(()=>t()),Ia(g,"$character"))),o(it,Le)}),s(u),o(te,u)},xe=te=>{var u=hr();o(te,u)};m(Se,te=>{t(),r(()=>t().activeStates&&t().activeStates.length>0)?te(lt):te(xe,!1)})}s(V),R("click",Pe,Re),o(C,Q)};m(pt,C=>{f(),r(()=>!f().attacks)&&C(Lt)})}s(ve);var Mt=a(ve,2);mi(Mt,{get show(){return e(T)},get attacks(){return t(),r(()=>t().attacks)},onSave:Ee,onCancel:he}),D(()=>et=Ut(ve,1,"attacks svelte-14o91c5",null,et,{hidden:!e(F)})),o(i,I),Yt(),$()}var $r=d('<span class="slot-checkbox-x svelte-serp1j">&#8212;</span>'),kr=d('<label><input type="checkbox" class="slot-checkbox-input svelte-serp1j"/> <span><!></span></label>');function Is(i,c){Vt(c,!1);const t=()=>ft(Da,"$isEditMode",v),[v,f]=ca();let p=Rt(c,"checked",8,!1),g=Rt(c,"disabled",8,!1),$=Rt(c,"className",8,""),_=Rt(c,"index",8,void 0),y=Rt(c,"ariaLabel",8,void 0);const F=xa();function P(T){F("change",{checked:T.currentTarget.checked,index:_()})}Jt();var q=kr(),U=l(q);we(U);var Z=a(U,2),E=l(Z);{var B=T=>{var ee=$r();o(T,ee)};m(E,T=>{p()&&T(B)})}s(Z),s(q),D(()=>{Ut(q,1,"slot-checkbox-label "+$()+(t()?"":" not-editable"),"svelte-serp1j"),qs(U,p()),U.disabled=g()||!t(),ot(U,"aria-label",y()),ot(U,"tabindex",t()?0:-1),Ut(Z,1,`slot-checkbox-custom ${p()?"used":""} ${t()?"":"readonly"}`,"svelte-serp1j")}),R("change",U,P),o(i,q),Yt(),f()}var wr=d('<span style="color:#007bff; margin-left:0.5em;"> </span>'),Sr=d("<li><strong> </strong> <!></li>"),Cr=d('<div class="racial-traits"><h4>Racial Traits</h4> <ul></ul></div>'),Dr=d("<li> </li>"),Lr=d('<div class="racial-resistances"><h4>Racial Resistances</h4> <ul></ul></div>'),Ar=d("<!> <!>",1);function jr(i,c){Vt(c,!1);const t=()=>ft(be,"$character",v),[v,f]=ca(),p=S(),g=S();let $=S(),_=S();La(()=>{t().race&&t().level&&(Ds(),os(),n($,t().race),n(_,t().level))}),Qe(()=>(t(),e($),e(_),os),()=>{t().race&&t().level&&(t().race!==e($)||t().level!==e(_))&&(Ds(),os(),n($,t().race),n(_,t().level))}),Qe(()=>(t(),Za),()=>{n(p,(()=>{const Z=t().activeStates?t().activeStates.filter(T=>T.name&&T.name.toLowerCase().includes("racial")).flatMap(T=>T.resistances||[]):[],E=Za(t().race||""),B=E?E.traits.flatMap(T=>T.resistances||[]):[];return Array.from(new Set([...Z,...B]))})())}),Qe(()=>t(),()=>{n(g,(()=>{const Z=Za(t().race||"");return Z?Z.traits:[]})())}),ma(),Jt();var y=Ar(),F=ke(y);{var P=Z=>{var E=Cr(),B=a(l(E),2);Ct(B,5,()=>e(g),Bt,(T,ee)=>{var fe=Sr(),Oe=l(fe),$e=l(Oe);s(Oe);var ce=a(Oe),se=a(ce);{var he=Ee=>{var J=wr(),A=l(J);s(J),D(x=>k(A,`(Resistances: ${x??""})`),[()=>(e(ee),r(()=>e(ee).resistances.map(x=>x.charAt(0).toUpperCase()+x.slice(1)).join(", ")))]),o(Ee,J)};m(se,Ee=>{e(ee),r(()=>e(ee).resistances&&e(ee).resistances.length>0)&&Ee(he)})}s(fe),D(()=>{k($e,`${e(ee),r(()=>e(ee).name)??""}:`),k(ce,` ${e(ee),r(()=>e(ee).description)??""} `)}),o(T,fe)}),s(B),s(E),o(Z,E)};m(F,Z=>{e(g),r(()=>e(g).length>0)&&Z(P)})}var q=a(F,2);{var U=Z=>{var E=Lr(),B=a(l(E),2);Ct(B,5,()=>e(p),Bt,(T,ee)=>{var fe=Dr(),Oe=l(fe,!0);s(fe),D($e=>k(Oe,$e),[()=>(e(ee),r(()=>e(ee).charAt(0).toUpperCase()+e(ee).slice(1)))]),o(T,fe)}),s(B),s(E),o(Z,E)};m(q,Z=>{e(p),r(()=>e(p).length>0)&&Z(U)})}o(i,y),Yt(),f()}var Rr=d('<p class="no-features svelte-1kpvv0n">Select a class to see available features</p>'),Br=d('<p class="no-features svelte-1kpvv0n">No class features available at this level</p>'),Mr=d('<h5 class="svelte-1kpvv0n"> </h5>'),Tr=d('<p class="no-uses svelte-1kpvv0n">No Channel Divinity uses remaining</p>'),Fr=d('<div class="channel-divinity-option svelte-1kpvv0n"><button class="btn btn-primary use-enabled svelte-1kpvv0n"><!></button> <!></div>'),Pr=d('<div class="sub-feature-box svelte-1kpvv0n"><h4 class="svelte-1kpvv0n"> </h4> <!> <p class="feature-description svelte-1kpvv0n"><!></p> <!></div>'),Ir=d('<div class="sub-features-grid svelte-1kpvv0n"></div>'),Er=d('<div class="feature-box channel-divinity-main svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"> </h3> <p class="feature-description svelte-1kpvv0n"><!></p> <div class="pool-tracker svelte-1kpvv0n"><input type="number" min="0" class="pool-input svelte-1kpvv0n"/> <span> </span> <button class="btn-small svelte-1kpvv0n"> </button></div> <!></div>'),Hr=d('<div class="spell-slots svelte-1kpvv0n"><label class="svelte-1kpvv0n"> </label> <div class="slots-tracker svelte-1kpvv0n"></div></div>'),Ur=d('<div class="all-spell-slots"></div>'),Nr=d('<div class="feature-box spellcasting svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"> </h3> <div class="spell-stats svelte-1kpvv0n"><div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Spell Save DC</label> <div class="spell-value svelte-1kpvv0n"> </div></div> <div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <div class="spell-value svelte-1kpvv0n"> </div></div></div> <!> <div class="prepared-spells svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <textarea placeholder="List your prepared spells..." class="svelte-1kpvv0n"></textarea></div></div>'),Or=d('<p class="unlimited svelte-1kpvv0n">Unlimited Uses</p>'),Gr=d('<div class="slots-tracker svelte-1kpvv0n"></div> <div class="uses-actions-row"><button class="btn btn-primary use-enabled"> </button></div> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div>',1),qr=d('<div class="uses-tracker svelte-1kpvv0n"><!></div>'),Wr=d('<div class="pool-tracker svelte-1kpvv0n"><input type="number" min="0" class="pool-input svelte-1kpvv0n"/> <span> </span> <button class="btn-small svelte-1kpvv0n"> </button></div>'),zr=d('<div class="feature-box svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"><!> </h3> <p class="feature-description svelte-1kpvv0n"> </p> <!></div>'),Kr=d('<!> <div class="features-grid svelte-1kpvv0n"><!> <!></div>',1),Jr=d("<!> <!>",1),Vr=d("<section><!> <!></section>");function Yr(i,c){Vt(c,!1);const t=()=>ft(be,"$character",g),v=()=>ft(as,"$abilityModifiers",g),f=()=>ft(ya,"$searchFilter",g),p=()=>ft(ea,"$collapsedStates",g),[g,$]=ca(),_=S(),y=S(),F=S(),P=S(),q=S(),U=S(),Z=S(),E=S(),B=S(),T=S(),ee=xa();let fe=S(0),Oe=S(0);function $e(h,I){be.update(ve=>(ve.classFeatures.features[h]=I,ve))}function ce(){be.update(h=>(h.classFeatures.spellSlotsByLevel||(h.classFeatures.spellSlotsByLevel={}),e(P).forEach(({level:I,slots:ve})=>{h.classFeatures.spellSlotsByLevel[I]||(h.classFeatures.spellSlotsByLevel[I]=Array(ve).fill(!1))}),h))}function se(h){if(typeof h.maxUses=="function"){if((h.name==="Divine Sense"||h.name==="War Priest")&&e(_)?.spellcastingAbility){const I=v()[e(_).spellcastingAbility];return h.maxUses(t().level,I)}return h.maxUses(t().level)}return h.maxUses||0}function he(h,I){be.update(ve=>((!ve.classFeatures.features[h]||!Array.isArray(ve.classFeatures.features[h])||ve.classFeatures.features[h].length!==I)&&(ve.classFeatures.features[h]=Array(I).fill(!1)),ve))}Xs(()=>{e(U)&&t()&&t().classFeatures&&t().classFeatures.features&&e(U).forEach(h=>{if(h.type==="uses"){const ve=A(h).replace(/\s+/g,""),et=se(h),at=t().classFeatures.features[ve];(!Array.isArray(at)||at.length!==et)&&he(ve,et)}})});function Ee(h){return typeof h.maxPool=="function"?h.maxPool(t().level):h.maxPool||0}function J(h){if(typeof h.description=="function"){if(e(_)?.spellcastingAbility){const I=v()[e(_).spellcastingAbility];return h.description(t().level,I)}return h.description(t().level)}return h.description}function A(h){if(typeof h.name=="function"){if(e(_)?.spellcastingAbility){const I=v()[e(_).spellcastingAbility];return h.name(t().level,I)}return h.name(t().level)}return h.name}function x(h){if(typeof h.subName=="function"){if(e(_)?.spellcastingAbility){const I=v()[e(_).spellcastingAbility];return h.subName(t().level,I)}return h.subName(t().level)}return h.subName||null}function O(h){if(typeof h.rollFormula=="function"){if(e(_)?.spellcastingAbility){const I=v()[e(_).spellcastingAbility];return h.rollFormula(t().level,I)}return h.rollFormula(t().level)}return h.rollFormula||""}function G(h){const I="ChannelDivinity",ve=t().classFeatures.features[I];if(typeof ve=="number"&&ve>0){be.update(at=>(at.classFeatures.features[I]=ve-1,at));const et=A(h);if(h.rollable&&h.rollFormula){const at=O(h);at?ee("roll",{notation:at,attackName:et,rollType:"other"}):Ht.add(`Used ${et}`,"info")}else Ht.add(`Used ${et}`,"info")}}function ue(){ea.update(h=>({...h,classFeatures:!h.classFeatures}))}Qe(()=>(t(),da),()=>{n(_,t().class?da(t().class):null)}),Qe(()=>(t(),Ta),()=>{n(y,t().class?Ta(t().class,t().level,t().subclass):[])}),Qe(()=>(t(),Ts),()=>{n(F,t().class?Ts(t().class,t().level):0)}),Qe(()=>(e(_),t()),()=>{n(P,(()=>{if(!e(_)?.spellcaster)return[];const h=t().level,I=[];return h>=1&&I.push({level:1,slots:Math.min(4,2+Math.floor(h/3))}),h>=3&&I.push({level:2,slots:Math.min(3,2+Math.floor((h-3)/4))}),h>=5&&I.push({level:3,slots:Math.min(3,2+Math.floor((h-5)/5))}),h>=7&&I.push({level:4,slots:Math.min(3,1+Math.floor((h-7)/6))}),h>=9&&I.push({level:5,slots:Math.min(2,1+Math.floor((h-9)/8))}),h>=11&&I.push({level:6,slots:1}),h>=13&&I.push({level:7,slots:1}),h>=15&&I.push({level:8,slots:1}),h>=17&&I.push({level:9,slots:1}),I})())}),Qe(()=>(e(_),v(),t(),Fs),()=>{if(e(_)?.spellcaster&&e(_).spellcastingAbility){const h=v()[e(_).spellcastingAbility];n(fe,Rl(t().class,h,t().proficiencyBonus)||0),n(Oe,Fs(t().class,t().level,h))}}),Qe(()=>(t(),e(_),e(P)),()=>{t().class&&e(_)?.spellcaster&&e(P).length>0&&ce()}),Qe(()=>t(),()=>{n(q,(()=>{const I=t().classFeatures.features["ChannelDivinity"];return typeof I=="number"?I:0})())}),Qe(()=>(e(y),f()),()=>{n(U,e(y).filter(h=>{if(!f())return!0;const I=f().toLowerCase();return A(h).toLowerCase().includes(I)||J(h).toLowerCase().includes(I)}))}),Qe(()=>e(U),()=>{n(Z,e(U).find(h=>h.type==="pool"&&A(h)==="Channel Divinity"))}),Qe(()=>e(U),()=>{n(E,e(U).flatMap(h=>{const I=[];return h.subFeatures&&I.push(...h.subFeatures),h.type==="channelDivinity"&&I.push(h),I}))}),Qe(()=>e(U),()=>{n(B,e(U).filter(h=>{const I=A(h);return!(h.type==="pool"&&I==="Channel Divinity"||h.type==="channelDivinity"||I==="Channel Divinity"&&h.subFeatures)}))}),Qe(()=>(f(),t(),e(U)),()=>{n(T,!f()||t().class||"class features".includes(f().toLowerCase())||"spellcasting".includes(f().toLowerCase())||e(U).length>0)}),ma(),Jt();var _e=Vr();let Ae;var ze=l(_e);{let h=xt(()=>(p(),r(()=>p().classFeatures?"Expand":"Collapse")));$a(ze,{title:"Class Features",get collapsed(){return p(),r(()=>p().classFeatures)},get ariaLabel(){return e(h)},onToggle:ue})}var Re=a(ze,2);{var De=h=>{var I=Jr(),ve=ke(I);jr(ve,{});var et=a(ve,2);{var at=Lt=>{var Mt=Rr();o(Lt,Mt)},pt=Lt=>{var Mt=kt(),C=ke(Mt);{var Q=z=>{var K=Br();o(z,K)},j=z=>{var K=Kr(),pe=ke(K);{var Ue=le=>{const V=xt(()=>(e(Z),r(()=>A(e(Z))))),Pe=xt(()=>(N(e(V)),r(()=>e(V).replace(/\s+/g,"")))),Se=xt(()=>(t(),N(e(Pe)),r(()=>t().classFeatures.features[e(Pe)]))),lt=xt(()=>typeof e(Se)=="number"),xe=xt(()=>(e(Z),r(()=>Ee(e(Z)))));var te=Er(),u=l(te),it=l(u,!0);s(u);var Ge=a(u,2),W=l(Ge);bs(W,()=>(e(Z),r(()=>J(e(Z))))),s(Ge);var Le=a(Ge,2),Ye=l(Le);we(Ye);var mt=a(Ye,2),rt=l(mt);s(mt);var ye=a(mt,2),je=l(ye,!0);s(ye),s(Le);var He=a(Le,2);{var vt=X=>{var Ke=Ir();Ct(Ke,5,()=>e(E),Bt,(ct,b)=>{const H=xt(()=>(e(b),r(()=>A(e(b)))));var de=Pr(),oe=l(de),ie=l(oe,!0);s(oe);var Te=a(oe,2);{var tt=me=>{var ae=Mr(),ge=l(ae,!0);s(ae),D(Ze=>k(ge,Ze),[()=>(e(b),r(()=>x(e(b))))]),o(me,ae)};m(Te,me=>{e(b),r(()=>e(b).subName)&&me(tt)})}var qe=a(Te,2),re=l(qe);bs(re,()=>(e(b),r(()=>J(e(b))))),s(qe);var Y=a(qe,2);{var Xe=me=>{var ae=Fr(),ge=l(ae),Ze=l(ge);{var wt=Ie=>{var St=Pt();D(()=>k(St,`Roll ${e(H)??""}`)),o(Ie,St)},nt=Ie=>{var St=Pt();D(()=>k(St,`Use ${e(H)??""}`)),o(Ie,St)};m(Ze,Ie=>{e(b),r(()=>e(b).rollable&&O(e(b)))?Ie(wt):Ie(nt,!1)})}s(ge);var ne=a(ge,2);{var qt=Ie=>{var St=Tr();o(Ie,St)};m(ne,Ie=>{e(q)<=0&&Ie(qt)})}s(ae),D(()=>ge.disabled=e(q)<=0),R("click",ge,()=>G(e(b))),o(me,ae)};m(Y,me=>{e(b),r(()=>e(b).type==="channelDivinity")&&me(Xe)})}s(de),D(()=>k(ie,e(H))),o(ct,de)}),s(Ke),o(X,Ke)};m(He,X=>{e(E),r(()=>e(E).length>0)&&X(vt)})}s(te),D(()=>{k(it,e(V)),Ba(Ye,e(lt)&&e(Se)!==void 0?e(Se):e(xe)),ot(Ye,"max",e(xe)),k(rt,`/ ${e(xe)??""}`),k(je,(e(Z),r(()=>e(Z).resetOn==="short"?"Short Rest":"Long Rest")))}),R("input",Ye,X=>{be.update(Ke=>(Ke.classFeatures.features[e(Pe)]=parseInt(X.currentTarget.value)||0,Ke))}),R("click",ye,()=>$e(e(Pe),e(xe))),o(le,te)};m(pe,le=>{e(Z)&&le(Ue)})}var Fe=a(pe,2),Be=l(Fe);{var Me=le=>{var V=Nr(),Pe=l(V),Se=l(Pe);s(Pe);var lt=a(Pe,2),xe=l(lt),te=a(l(xe),2),u=l(te,!0);s(te),s(xe);var it=a(xe,2),Ge=a(l(it),2),W=l(Ge,!0);s(Ge),s(it),s(lt);var Le=a(lt,2);{var Ye=ye=>{var je=Ur();Ct(je,5,()=>e(P),Bt,(He,vt)=>{let X=()=>e(vt).level,Ke=()=>e(vt).slots;const ct=xt(()=>(t(),X(),Ke(),r(()=>t().classFeatures.spellSlotsByLevel?.[X()]||Array(Ke()).fill(!1))));var b=Hr(),H=l(b),de=l(H);s(H);var oe=a(H,2);Ct(oe,5,()=>e(ct),Bt,(ie,Te,tt)=>{{let qe=xt(()=>(N(e(ct)),r(()=>e(ct)[tt]||!1)));Is(ie,{get checked(){return e(qe)},$$events:{change:re=>{be.update(Y=>(Y.classFeatures.spellSlotsByLevel||(Y.classFeatures.spellSlotsByLevel={}),Y.classFeatures.spellSlotsByLevel[X()]||(Y.classFeatures.spellSlotsByLevel[X()]=Array(Ke()).fill(!1)),Y.classFeatures.spellSlotsByLevel[X()][tt]=re.detail.checked,Y))}}})}}),s(oe),s(b),D(()=>k(de,`${X()===1?"1st":X()===2?"2nd":X()===3?"3rd":`${X()}th`} Level Spell Slots`)),o(He,b)}),s(je),o(ye,je)};m(Le,ye=>{e(P),r(()=>e(P).length>0)&&ye(Ye)})}var mt=a(Le,2),rt=a(l(mt),2);Ra(rt),s(mt),s(V),D(ye=>{k(Se,`Spellcasting (${ye??""})`),k(u,e(fe)),k(W,e(Oe))},[()=>(e(_),r(()=>e(_).spellcastingAbility?.toUpperCase()))]),Je(rt,()=>t().classFeatures.preparedSpells,ye=>Gt(be,r(t).classFeatures.preparedSpells=ye,r(t))),o(le,V)};m(Be,le=>{e(_),r(()=>e(_)?.spellcaster)&&le(Me)})}var w=a(Be,2);Ct(w,1,()=>e(B),Bt,(le,V)=>{const Pe=xt(()=>(e(V),r(()=>A(e(V))))),Se=xt(()=>(N(e(Pe)),r(()=>e(Pe).replace(/\s+/g,"")))),lt=xt(()=>(t(),N(e(Se)),r(()=>t().classFeatures.features[e(Se)]))),xe=xt(()=>typeof e(lt)=="number");var te=zr(),u=l(te),it=l(u);{var Ge=je=>{var He=Pt("Channel Divinity:");o(je,He)};m(it,je=>{e(V),r(()=>e(V).type==="channelDivinity")&&je(Ge)})}var W=a(it);s(u);var Le=a(u,2),Ye=l(Le,!0);s(Le);var mt=a(Le,2);{var rt=je=>{const He=xt(()=>(e(V),r(()=>se(e(V))))),vt=xt(()=>(N(e(lt)),N(e(He)),r(()=>Array.isArray(e(lt))?e(lt):Array(e(He)).fill(!1))));var X=qr(),Ke=l(X);{var ct=H=>{var de=Or();o(H,de)},b=H=>{var de=Gr(),oe=ke(de);Ct(oe,5,()=>e(vt),Bt,(Xe,me,ae)=>{Is(Xe,{get checked(){return e(me)},index:ae,$$events:{change:ge=>{be.update(Ze=>(Ze.classFeatures.features[e(Se)]||(Ze.classFeatures.features[e(Se)]=Array(e(He)).fill(!1)),Ze.classFeatures.features[e(Se)][ae]=ge.detail.checked,Ze))}}})}),s(oe);var ie=a(oe,2),Te=l(ie),tt=l(Te);s(Te),s(ie);var qe=a(ie,2),re=l(qe),Y=l(re);s(re),s(qe),D(Xe=>{Te.disabled=Xe,k(tt,`Use ${e(Pe)??""}`),k(Y,`Resets on ${e(V),r(()=>e(V).resetOn==="short"?"Short Rest":"Long Rest")??""}`)},[()=>(N(e(vt)),r(()=>e(vt).filter(Xe=>!Xe).length<=0))]),R("click",Te,()=>{be.update(Xe=>{Xe.classFeatures.features[e(Se)]||(Xe.classFeatures.features[e(Se)]=Array(e(He)).fill(!1));const me=Xe.classFeatures.features[e(Se)],ae=me.findIndex(ge=>!ge);return ae!==-1&&(me[ae]=!0),Xe})}),o(H,de)};m(Ke,H=>{e(He)===1/0?H(ct):H(b,!1)})}s(X),o(je,X)},ye=je=>{var He=kt(),vt=ke(He);{var X=Ke=>{const ct=xt(()=>(e(V),r(()=>Ee(e(V)))));var b=Wr(),H=l(b);we(H);var de=a(H,2),oe=l(de);s(de);var ie=a(de,2),Te=l(ie,!0);s(ie),s(b),D(()=>{Ba(H,e(xe)&&e(lt)!==void 0?e(lt):e(ct)),ot(H,"max",e(ct)),k(oe,`/ ${e(ct)??""}`),k(Te,(e(V),r(()=>e(V).resetOn==="short"?"Short Rest":"Long Rest")))}),R("input",H,tt=>{be.update(qe=>(qe.classFeatures.features[e(Se)]=parseInt(tt.currentTarget.value)||0,qe))}),R("click",ie,()=>$e(e(Se),e(ct))),o(Ke,b)};m(vt,Ke=>{e(V),r(()=>e(V).type==="pool")&&Ke(X)},!0)}o(je,He)};m(mt,je=>{e(V),r(()=>e(V).type==="uses")?je(rt):je(ye,!1)})}s(te),D(je=>{k(W,` ${e(Pe)??""}`),k(Ye,je)},[()=>(e(V),r(()=>J(e(V))))]),o(le,te)}),s(Fe),o(z,K)};m(C,z=>{e(y),r(()=>e(y).length===0)?z(Q):z(j,!1)},!0)}o(Lt,Mt)};m(et,Lt=>{t(),r(()=>!t().class)?Lt(at):Lt(pt,!1)})}o(h,I)};m(Re,h=>{p(),r(()=>!p().classFeatures)&&h(De)})}s(_e),D(()=>Ae=Ut(_e,1,"class-features svelte-1kpvv0n",null,Ae,{hidden:!e(T)})),o(i,_e),Yt(),$()}var Qr=d('<textarea placeholder="Enter features, traits, and special abilities..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Equipment</h3> <textarea placeholder="List your equipment and inventory..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Notes</h3> <textarea placeholder="Additional notes..." class="svelte-wttn0l"></textarea>',1),Xr=d("<section><!> <!></section>");function Zr(i,c){Vt(c,!1);const t=()=>ft(ya,"$searchFilter",p),v=()=>ft(be,"$character",p),f=()=>ft(ea,"$collapsedStates",p),[p,g]=ca(),$=S();function _(){ea.update(Z=>({...Z,notes:!Z.notes}))}Qe(()=>(t(),v()),()=>{n($,!t()||"features".includes(t().toLowerCase())||"traits".includes(t().toLowerCase())||"equipment".includes(t().toLowerCase())||"notes".includes(t().toLowerCase())||v().features.toLowerCase().includes(t().toLowerCase())||v().equipment.toLowerCase().includes(t().toLowerCase())||v().notes.toLowerCase().includes(t().toLowerCase()))}),ma(),Jt();var y=Xr();let F;var P=l(y);{let Z=xt(()=>(f(),r(()=>f().notes?"Expand":"Collapse")));$a(P,{title:"Features & Traits",get collapsed(){return f(),r(()=>f().notes)},get ariaLabel(){return e(Z)},onToggle:_})}var q=a(P,2);{var U=Z=>{var E=Qr(),B=ke(E);Ra(B);var T=a(B,4);Ra(T);var ee=a(T,4);Ra(ee),Je(B,()=>v().features,fe=>Gt(be,r(v).features=fe,r(v))),Je(T,()=>v().equipment,fe=>Gt(be,r(v).equipment=fe,r(v))),Je(ee,()=>v().notes,fe=>Gt(be,r(v).notes=fe,r(v))),o(Z,E)};m(q,Z=>{f(),r(()=>!f().notes)&&Z(U)})}s(y),D(()=>F=Ut(y,1,"notes svelte-wttn0l",null,F,{hidden:!e($)})),o(i,y),Yt(),g()}var en=d('<div class="empty-state svelte-1e2ypyh"><p>No rolls yet. Roll some dice to see your history!</p></div>'),tn=d('<div class="entry-breakdown svelte-1e2ypyh"> </div>'),an=d('<div class="history-entry svelte-1e2ypyh"><div class="entry-header svelte-1e2ypyh"><span class="entry-purpose svelte-1e2ypyh"> </span> <span class="entry-time svelte-1e2ypyh"> </span></div> <div class="entry-details svelte-1e2ypyh"><span class="entry-notation svelte-1e2ypyh"> </span> <span class="entry-result svelte-1e2ypyh"> </span></div> <!></div>'),sn=d('<div class="history-controls svelte-1e2ypyh"><button class="btn btn-secondary clear-btn svelte-1e2ypyh">Clear History</button></div> <div class="history-list svelte-1e2ypyh"></div>',1),ln=d('<section class="roll-history-container svelte-1e2ypyh"><!> <!></section>');function rn(i,c){Vt(c,!1);const t=()=>ft(ea,"$collapsedStates",f),v=()=>ft(Ua,"$rollHistory",f),[f,p]=ca();function g(q){const U=new Date(q),E=new Date().getTime()-U.getTime(),B=Math.floor(E/6e4);if(B<1)return"Just now";if(B<60)return`${B}m ago`;const T=Math.floor(B/60);return T<24?`${T}h ago`:U.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}function $(){confirm("Clear all roll history?")&&Ua.clear()}Jt();var _=ln(),y=l(_);$a(y,{title:"Roll History",get collapsed(){return t().rollHistory},onToggle:()=>ea.update(q=>({...q,rollHistory:!q.rollHistory}))});var F=a(y,2);{var P=q=>{var U=kt(),Z=ke(U);{var E=T=>{var ee=en();o(T,ee)},B=T=>{var ee=sn(),fe=ke(ee),Oe=l(fe);s(fe);var $e=a(fe,2);Ct($e,5,v,ce=>ce.id,(ce,se)=>{var he=an(),Ee=l(he),J=l(Ee),A=l(J,!0);s(J);var x=a(J,2),O=l(x,!0);s(x),s(Ee);var G=a(Ee,2),ue=l(G),_e=l(ue,!0);s(ue);var Ae=a(ue,2),ze=l(Ae);s(Ae),s(G);var Re=a(G,2);{var De=h=>{var I=tn(),ve=l(I,!0);s(I),D(()=>k(ve,e(se).breakdown)),o(h,I)};m(Re,h=>{e(se).breakdown&&h(De)})}s(he),D(h=>{k(A,e(se).purpose),k(O,h),k(_e,e(se).notation),k(ze,`= ${e(se).result??""}`)},[()=>g(e(se).timestamp)]),o(ce,he)}),s($e),R("click",Oe,$),o(T,ee)};m(Z,T=>{v().length===0?T(E):T(B,!1)})}o(q,U)};m(F,q=>{t().rollHistory||q(P)})}s(_),o(i,_),Yt(),p()}var nn=d(" <!> <!> <!> <!> <!>",1),on=d('<div class="color-picker-section svelte-1r90jgp"><h3 class="svelte-1r90jgp">Dice Colors</h3> <div class="color-inputs svelte-1r90jgp"><div class="color-input-group svelte-1r90jgp"><label for="dice-color" class="svelte-1r90jgp">Dice Color</label> <input type="color" id="dice-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="label-color" class="svelte-1r90jgp">Label Color</label> <input type="color" id="label-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="desk-color" class="svelte-1r90jgp">Background Color</label> <input type="color" id="desk-color" class="svelte-1r90jgp"/></div></div></div>'),cn=d('<div class="loading svelte-1r90jgp"><p class="svelte-1r90jgp">Loading 3D dice...</p></div>'),vn=d('<div class="custom-dice-selector svelte-1r90jgp"><h3 class="svelte-1r90jgp">Choose Dice to Roll</h3> <div class="dice-inputs svelte-1r90jgp"><div class="dice-input-group svelte-1r90jgp"><label for="d4" class="svelte-1r90jgp">d4</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d4" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d6" class="svelte-1r90jgp">d6</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d6" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d8" class="svelte-1r90jgp">d8</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d8" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d10" class="svelte-1r90jgp">d10</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d10" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d12" class="svelte-1r90jgp">d12</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d12" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d20" class="svelte-1r90jgp">d20</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d20" min="0" max="10"/></div></div> <div class="dice-controls svelte-1r90jgp"><button class="btn btn-primary use-enabled svelte-1r90jgp"> </button> <button class="btn btn-secondary use-enabled svelte-1r90jgp">Reset</button></div></div>'),dn=d('<h3 class="svelte-1r90jgp"> </h3>'),un=d('<h3 class="svelte-1r90jgp"> </h3>'),fn=d('<h3 class="svelte-1r90jgp"> </h3>'),pn=d('<h3 class="svelte-1r90jgp"> </h3>'),mn=d('<span class="crit-badge svelte-1r90jgp">CRITICAL HIT!</span>'),gn=d('<span class="crit-badge crit-fail svelte-1r90jgp">CRITICAL MISS!</span>'),bn=d('<div class="bonus-item svelte-1r90jgp"><span class="bonus-value svelte-1r90jgp"> </span> <span class="bonus-source svelte-1r90jgp"> </span></div>'),hn=d('<div class="bonus-breakdown svelte-1r90jgp"></div>'),_n=d('<p class="modifier-text svelte-1r90jgp"> </p>'),yn=d('<div class="svelte-1r90jgp"><em class="svelte-1r90jgp">No damage is dealt on a critical miss.</em></div>'),xn=d('<button class="btn btn-follow-up svelte-1r90jgp"> </button>'),$n=d('<button class="btn btn-guided-strike svelte-1r90jgp">‚ö° Use Guided Strike (+10)</button>'),kn=d('<div class="follow-up-actions svelte-1r90jgp"><!> <!></div>'),wn=d('<div class="result-header svelte-1r90jgp"><!> <!> <!></div> <div class="result-total svelte-1r90jgp"> </div> <div class="result-details svelte-1r90jgp"><!></div> <!> <!>',1),Sn=d('<div role="button" tabindex="-1"><div class="modal-content svelte-1r90jgp" role="dialog" tabindex="0"><div class="modal-header svelte-1r90jgp"><h2 class="svelte-1r90jgp"><!></h2> <div class="header-buttons svelte-1r90jgp"><button class="color-btn svelte-1r90jgp" title="Customize dice colors">üé®</button> <button class="close-btn svelte-1r90jgp">√ó</button></div></div> <!> <!> <div class="dice-main-area svelte-1r90jgp"><div class="dice-container svelte-1r90jgp"></div> <!></div> <div><!></div></div></div>');function Cn(i,c){Vt(c,!1);const t=()=>ft(be,"$character",v),[v,f]=ca(),p=S(),g=S(),$=S(),_=xa();let y=Rt(c,"notation",12,""),F=Rt(c,"visible",8,!1),P=Rt(c,"damageNotation",12,""),q=Rt(c,"damageType",8,""),U=Rt(c,"attackName",12,""),Z=Rt(c,"applyHalfDamage",8,!1),E=Rt(c,"bonusBreakdown",28,()=>[]),B=Rt(c,"rollType",12,"other"),T=Rt(c,"damageBreakdown",24,()=>[]),ee=null,fe=S(void 0),Oe=S(!1),$e=S(""),ce=S(null),se=S("");function he(){return e(ce)?.resultTotal??null}function Ee(b,H,de){const oe=[];if(!b||!b.result)return oe;const ie=H.match(/([+-]?\d*d\d+|[+-]?\d+)/g)||[];let Te=0;const tt=new Set;let qe=!0;for(const re of ie){const Y=re.trim();if(!Y)continue;const Xe=Y.match(/([+-]?)(\d*)d(\d+)/);if(Xe){const me=parseInt(Xe[2]||"1"),ae=`${me}d${Xe[3]}`,ge=de.findIndex((nt,ne)=>!tt.has(ne)&&typeof nt.value=="string"&&nt.value===ae),Ze=[];for(let nt=0;nt<me&&Te<b.result.length;nt++)Ze.push(b.result[Te++]);let wt;ge>=0?(wt=de[ge].source,tt.add(ge)):wt="base";for(const nt of Ze)oe.push({display:`${nt}`,source:wt});qe=!1}}for(let re=0;re<de.length;re++)if(!tt.has(re)&&typeof de[re].value=="number"){const Y=de[re].value;oe.push({display:Y>=0?`+${Y}`:`${Y}`,source:de[re].source})}return oe}let J=S(0),A=S(0),x=S(0),O=S(0),G=S(0),ue=S(0),_e=S(0),Ae=S([]),ze=S(!1),Re=S(!1),De=S(!1),h=S("#051e0a"),I=S("#ffffff"),ve=S("#3a2004"),et=S(!1);function at(b){return b.length===9&&b.startsWith("#")?b.substring(0,7):b}function pt(b,H="ff"){return b.length===7&&b.startsWith("#")?b+H:b}function Lt(){if(window.DICE&&e(fe))try{ee&&e(fe)&&ba(fe,e(fe).innerHTML="");const b=e(fe).clientWidth||500,H=e(fe).clientHeight||300;ee=new window.DICE.dice_box(e(fe),{w:b,h:H}),n(Oe,!0)}catch(b){console.error("Error initializing dice box:",b)}}La(()=>{const b=oe=>new Promise((ie,Te)=>{if(document.querySelector(`script[src="${oe}"]`)){ie(null);return}const qe=document.createElement("script");qe.src=oe,qe.onload=()=>{ie(null)},qe.onerror=()=>{console.error(`Failed to load: ${oe}`),Te(new Error(`Failed to load ${oe}`))},document.head.appendChild(qe)});setTimeout(()=>{b(`${Ea}/libs/three.min.js`).then(()=>b(`${Ea}/libs/cannon.min.js`)).then(()=>b(`${Ea}/libs/teal.js`)).then(()=>b(`${Ea}/dice.js`)).then(()=>{if(window.DICE){const oe=window.DICE.getColors();n(h,at(oe.dice_color)),n(I,at(oe.label_color)),n(ve,at(oe.desk_color))}Lt()}).catch(oe=>{console.error("Failed to load dice libraries:",oe)})},100);const H=()=>{e(Oe)&&Lt()},de=oe=>{F()&&oe.key==="Escape"&&Fe()};return window.addEventListener("resize",H),window.addEventListener("keydown",de),()=>{window.removeEventListener("resize",H),window.removeEventListener("keydown",de)}});function Mt(b,H="other"){if(!ee||!e(Oe))return;n(ce,null),n(Ae,[]),n(ze,!1),n(Re,!1),B(H),n(De,!1),n(se,b),ee.diceToRoll=b;const de=ie=>null,oe=ie=>{let Te=ie.resultTotal,tt=ie.resultString;Z()&&(Te=Math.floor(Te/2),tt=tt+" (halved)"),n(ce,{...ie,resultTotal:Te,resultString:tt});let qe=U()||"Roll";if(H==="attack"?qe=`${U()||"Attack"} Roll`:H==="damage"?qe=`${U()||"Damage"} Roll`:H==="check"?qe=`${U()||"Check"} Roll`:H==="save"&&(qe=`${U()||"Save"} Roll`),Ua.addRoll(qe,e(se),Te,tt),H==="attack"&&ie.result&&ie.result.length>0){const re=ie.result[0];n(ze,re===20),n(Re,re===1)}if(n(Ae,[]),H==="attack"){if(P())if(e(ze)){const re=j(P()),Y=T().map(Xe=>{if(typeof Xe.value=="string"&&Xe.value.match(/^\d+d\d+$/)){const me=j(Xe.value);return{...Xe,value:me}}return Xe});e(Ae).push({label:`Roll Critical Damage (${re})`,notation:re,breakdown:Y})}else e(Re)||e(Ae).push({label:`Roll Damage (${P()})`,notation:P(),breakdown:T()});if(U()&&P()&&t().class?.toLowerCase()==="rogue"&&t().features?.toLowerCase?.().includes("sneak attack")){const re=`${P()}+3d6`,Y=[...T(),{value:"3d6",source:"Sneak Attack"}];e(Ae).push({label:`Roll Damage + Sneak Attack (${re})`,notation:re,breakdown:Y})}}};ee.start_throw(de,oe)}function C(){const b=[];e(J)>0&&b.push(`${e(J)}d4`),e(A)>0&&b.push(`${e(A)}d6`),e(x)>0&&b.push(`${e(x)}d8`),e(O)>0&&b.push(`${e(O)}d10`),e(G)>0&&b.push(`${e(G)}d12`),e(ue)>0&&b.push(`${e(ue)}d20`);let H=b.join("+")||"1d20";return e(_e)!==0&&(H+=e(_e)>=0?`+${e(_e)}`:`${e(_e)}`),H}function Q(){const b=C();Mt(b)}function j(b){return b.replace(/(\d+)d(\d+)/g,(H,de,oe)=>`${parseInt(de)*2}d${oe}`)}function z(){n(J,0),n(A,0),n(x,0),n(O,0),n(G,0),n(ue,0),n(_e,0),n(ce,null),n(Ae,[]),n(ze,!1),n(Re,!1),B("other"),n(De,!1)}function K(){window.DICE&&(window.DICE.setColors({dice_color:pt(e(h),"ff"),label_color:pt(e(I),"ff"),desk_color:e(ve)}),ee&&(ee.updateDeskColor(e(ve)),ee.updateDiceColors()))}function pe(){n(et,!e(et))}function Ue(){!e(ce)||e(g)<=0||e(De)||(n(ce,{...e(ce),resultTotal:e(ce).resultTotal+10,resultString:e(ce).resultString+" + 10 (Guided Strike)"}),E([...E(),{value:10,source:"Guided Strike"}]),be.update(b=>{const H="ChannelDivinity",de=b.classFeatures.features[H];return typeof de=="number"&&de>0&&(b.classFeatures.features[H]=de-1),b}),n(De,!0))}function Fe(){_("close"),y(""),P(""),U(""),n($e,""),n(ce,null),n(De,!1),n(ze,!1),n(Re,!1),z()}Qe(()=>(t(),Ta),()=>{n(p,t().class?Ta(t().class,t().level,t().subclass).some(H=>H.name==="Guided Strike"):!1)}),Qe(()=>t(),()=>{n(g,(()=>{const H=t().classFeatures.features["ChannelDivinity"];return typeof H=="number"?H:0})())}),Qe(()=>(e(J),e(A),e(x),e(O),e(G),e(ue),e(_e)),()=>{n($,(()=>{const b=[];e(J)>0&&b.push(`${e(J)}d4`),e(A)>0&&b.push(`${e(A)}d6`),e(x)>0&&b.push(`${e(x)}d8`),e(O)>0&&b.push(`${e(O)}d10`),e(G)>0&&b.push(`${e(G)}d12`),e(ue)>0&&b.push(`${e(ue)}d20`);let H=b.join("+")||"1d20";return e(_e)!==0&&(H+=e(_e)>=0?`+${e(_e)}`:`${e(_e)}`),H})())}),Qe(()=>(N(y()),e(Oe),N(F()),e($e),N(B())),()=>{y()&&e(Oe)&&F()&&y()!==e($e)&&(n($e,y()),n(ce,null),n(Ae,[]),n(ze,!1),n(Re,!1),n(De,!1),setTimeout(()=>Mt(y(),B()),200))}),ma();var Be={getLastRollTotal:he};Jt();var Me=Sn();let w;var le=l(Me),V=l(le),Pe=l(V),Se=l(Pe);{var lt=b=>{var H=nn(),de=ke(H),oe=a(de);{var ie=ge=>{var Ze=Pt("- Attack Roll");o(ge,Ze)};m(oe,ge=>{B()==="attack"&&ge(ie)})}var Te=a(oe,2);{var tt=ge=>{var Ze=Pt("- Damage Roll");o(ge,Ze)};m(Te,ge=>{B()==="damage"&&ge(tt)})}var qe=a(Te,2);{var re=ge=>{var Ze=Pt("- Healing Roll");o(ge,Ze)};m(qe,ge=>{B()==="healing"&&ge(re)})}var Y=a(qe,2);{var Xe=ge=>{var Ze=Pt("- Ability Check");o(ge,Ze)};m(Y,ge=>{B()==="check"&&ge(Xe)})}var me=a(Y,2);{var ae=ge=>{var Ze=Pt("- Saving Throw");o(ge,Ze)};m(me,ge=>{B()==="save"&&ge(ae)})}D(()=>k(de,`${U()??""} `)),o(b,H)},xe=b=>{var H=Pt("Dice Roller");o(b,H)};m(Se,b=>{U()?b(lt):b(xe,!1)})}s(Pe);var te=a(Pe,2),u=l(te),it=a(u,2);s(te),s(V);var Ge=a(V,2);{var W=b=>{var H=on(),de=a(l(H),2),oe=l(de),ie=a(l(oe),2);we(ie),s(oe);var Te=a(oe,2),tt=a(l(Te),2);we(tt),s(Te);var qe=a(Te,2),re=a(l(qe),2);we(re),s(qe),s(de),s(H),Je(ie,()=>e(h),Y=>n(h,Y)),R("change",ie,K),Je(tt,()=>e(I),Y=>n(I,Y)),R("change",tt,K),Je(re,()=>e(ve),Y=>n(ve,Y)),R("change",re,K),o(b,H)};m(Ge,b=>{e(et)&&b(W)})}var Le=a(Ge,2);{var Ye=b=>{var H=cn();o(b,H)};m(Le,b=>{e(Oe)||b(Ye)})}var mt=a(Le,2),rt=l(mt);Na(rt,b=>n(fe,b),()=>e(fe));var ye=a(rt,2);{var je=b=>{var H=vn(),de=a(l(H),2),oe=l(de),ie=a(l(oe),2);we(ie),s(oe);var Te=a(oe,2),tt=a(l(Te),2);we(tt),s(Te);var qe=a(Te,2),re=a(l(qe),2);we(re),s(qe);var Y=a(qe,2),Xe=a(l(Y),2);we(Xe),s(Y);var me=a(Y,2),ae=a(l(me),2);we(ae),s(me);var ge=a(me,2),Ze=a(l(ge),2);we(Ze),s(ge),s(de);var wt=a(de,2),nt=l(wt),ne=l(nt);s(nt);var qt=a(nt,2);s(wt),s(H),D(()=>{nt.disabled=!e(Oe),k(ne,`Roll ${e($)??""}`)}),Je(ie,()=>e(J),Ie=>n(J,Ie)),Je(tt,()=>e(A),Ie=>n(A,Ie)),Je(re,()=>e(x),Ie=>n(x,Ie)),Je(Xe,()=>e(O),Ie=>n(O,Ie)),Je(ae,()=>e(G),Ie=>n(G,Ie)),Je(Ze,()=>e(ue),Ie=>n(ue,Ie)),R("click",nt,Q),R("click",qt,z),o(b,H)};m(ye,b=>{y()||b(je)})}s(mt);var He=a(mt,2);let vt;var X=l(He);{var Ke=b=>{var H=wn(),de=ke(H),oe=l(de);{var ie=Ie=>{var St=dn(),la=l(St,!0);s(St),D(()=>k(la,U()?`${U()} - Healing`:"Healing")),o(Ie,St)},Te=Ie=>{var St=kt(),la=ke(St);{var ia=At=>{var L=un(),We=l(L,!0);s(L),D(()=>k(We,U()?`${U()} - ${q()} Damage`:`${q()} Damage`)),o(At,L)},Nt=At=>{var L=kt(),We=ke(L);{var Ce=M=>{var dt=fn(),gt=l(dt,!0);s(dt),D(()=>k(gt,U()?`${U()} - Damage`:"Damage")),o(M,dt)},st=M=>{var dt=pn(),gt=l(dt,!0);s(dt),D(()=>k(gt,U()?`${U()} - Result`:"Result")),o(M,dt)};m(We,M=>{B()==="damage"?M(Ce):M(st,!1)},!0)}o(At,L)};m(la,At=>{B()==="damage"&&q()?At(ia):At(Nt,!1)},!0)}o(Ie,St)};m(oe,Ie=>{B()==="damage"&&q()==="Healing"?Ie(ie):Ie(Te,!1)})}var tt=a(oe,2);{var qe=Ie=>{var St=mn();o(Ie,St)};m(tt,Ie=>{e(ze)&&Ie(qe)})}var re=a(tt,2);{var Y=Ie=>{var St=gn();o(Ie,St)};m(re,Ie=>{e(Re)&&Ie(Y)})}s(de);var Xe=a(de,2),me=l(Xe,!0);s(Xe);var ae=a(Xe,2),ge=l(ae);{var Ze=Ie=>{var St=kt(),la=ke(St);{var ia=At=>{var L=hn();Ct(L,5,()=>(e(ce),e(se),N(E()),r(()=>Ee(e(ce),e(se),E()))),Bt,(We,Ce)=>{var st=bn(),M=l(st),dt=l(M,!0);s(M);var gt=a(M,2),ut=l(gt);s(gt),s(st),D(()=>{k(dt,(e(Ce),r(()=>e(Ce).display))),k(ut,`(${e(Ce),r(()=>e(Ce).source)??""})`)}),o(We,st)}),s(L),o(At,L)},Nt=At=>{var L=kt(),We=ke(L);{var Ce=st=>{var M=_n(),dt=l(M);s(M),D(()=>k(dt,`Modifier: ${e(ce),r(()=>e(ce).constant>=0?"+":"")??""}${e(ce),r(()=>e(ce).constant)??""}`)),o(st,M)};m(We,st=>{e(ce),r(()=>e(ce).constant)&&st(Ce)},!0)}o(At,L)};m(la,At=>{N(E()),r(()=>E().length>0)?At(ia):At(Nt,!1)})}o(Ie,St)};m(ge,Ie=>{e(ce),N(E()),r(()=>e(ce).constant||E().length>0)&&Ie(Ze)})}s(ae);var wt=a(ae,2);{var nt=Ie=>{var St=yn();o(Ie,St)};m(wt,Ie=>{e(Re)&&Ie(nt)})}var ne=a(wt,2);{var qt=Ie=>{var St=kn(),la=l(St);Ct(la,1,()=>e(Ae),Bt,(At,L)=>{var We=xn(),Ce=l(We,!0);s(We),D(()=>k(Ce,(e(L),r(()=>e(L).label)))),R("click",We,()=>{E(e(L).breakdown||[]),Mt(e(L).notation,"damage")}),o(At,We)});var ia=a(la,2);{var Nt=At=>{var L=$n();D(()=>{L.disabled=e(g)<=0,ot(L,"title",e(g)<=0?"No Channel Divinity uses remaining":"Use Channel Divinity to add +10 to this attack roll")}),R("click",L,Ue),o(At,L)};m(ia,At=>{e(p)&&B()==="attack"&&!e(De)&&e(g)>0&&!e(Re)&&At(Nt)})}s(St),o(Ie,St)};m(ne,Ie=>{e(Ae),e(p),N(B()),e(De),e(g),r(()=>e(Ae).length>0||e(p)&&B()==="attack"&&!e(De)&&e(g)>0)&&Ie(qt)})}D(()=>k(me,(e(ce),r(()=>e(ce).resultTotal)))),o(b,H)};m(X,b=>{e(ce)&&b(Ke)})}s(He),s(le),s(Me),D(()=>{w=Ut(Me,1,"modal-overlay svelte-1r90jgp",null,w,{hidden:!F()}),vt=Ut(He,1,"roll-result svelte-1r90jgp",null,vt,{"has-result":e(ce)})}),R("click",u,pe),R("click",it,Fe),R("click",le,ws(function(b){Ma.call(this,c,b)})),R("keydown",le,function(b){Ma.call(this,c,b)}),R("click",Me,Fe),R("keydown",Me,b=>b.key==="Escape"&&Fe()),o(i,Me),Al(c,"getLastRollTotal",he);var ct=Yt(Be);return f(),ct}const ss="https://api.github.com/gists";async function Dn(i,c,t,v){if(!c)throw new Error("GitHub token is required");const f=JSON.stringify(i,null,2),g={[`${i.name||"character"}_dnd.json`]:{content:f}};if(v&&v.length>0){const F=`${i.name||"character"}_roll_history.json`;g[F]={content:JSON.stringify(v,null,2)}}const $={description:t||`D&D Character: ${i.name}`,public:!1,files:g},_=await fetch(ss,{method:"POST",headers:{Authorization:`token ${c}`,"Content-Type":"application/json"},body:JSON.stringify($)});if(!_.ok)throw new Error(`Failed to create gist: ${_.statusText}`);return(await _.json()).id}async function Ln(i,c,t,v){if(!c||!t)throw new Error("GitHub token and Gist ID are required");const f=JSON.stringify(i,null,2),g={[`${i.name||"character"}_dnd.json`]:{content:f}};if(v&&v.length>0){const y=`${i.name||"character"}_roll_history.json`;g[y]={content:JSON.stringify(v,null,2)}}const $={files:g},_=await fetch(`${ss}/${t}`,{method:"PATCH",headers:{Authorization:`token ${c}`,"Content-Type":"application/json"},body:JSON.stringify($)});if(!_.ok)throw new Error(`Failed to update gist: ${_.statusText}`)}async function An(i,c){if(!i)throw new Error("Gist ID is required");const t={"Content-Type":"application/json"};c&&(t.Authorization=`token ${c}`);const v=await fetch(`${ss}/${i}`,{method:"GET",headers:t});if(!v.ok)throw new Error(`Failed to load gist: ${v.statusText}`);const f=await v.json(),p=Object.entries(f.files);if(p.length===0)throw new Error("No files found in gist");let g=null,$=null;for(const[_,y]of p){const F=y;_.includes("roll_history")?$=F.content:g=F.content}if(!g)throw new Error("No character file found in gist");try{const _=JSON.parse(g);_.attacks&&Array.isArray(_.attacks)&&(_.attacks=_.attacks.map(F=>({...F,id:F.id||crypto.randomUUID()}))),_.classFeatures?(_.classFeatures.features||(_.classFeatures.features={}),_.classFeatures.spellSlots||(_.classFeatures.spellSlots=[]),_.classFeatures.preparedSpells===void 0&&(_.classFeatures.preparedSpells="")):_.classFeatures={features:{},spellSlots:[],preparedSpells:""};let y;if($)try{y=JSON.parse($)}catch(F){console.error("Failed to parse roll history from gist:",F)}return{character:_,rollHistory:y}}catch{throw new Error("Invalid character data in gist")}}function Es(i){typeof window<"u"&&localStorage.setItem("dnd_gist_config",JSON.stringify(i))}function jn(){if(typeof window<"u"){const i=localStorage.getItem("dnd_gist_config");if(i)return JSON.parse(i)}return{}}async function Rn(i,c=30){if(!i)throw new Error("GitHub token is required to list gists");const t=await fetch(`${ss}?per_page=${c}`,{method:"GET",headers:{Authorization:`token ${i}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error(`Failed to list gists: ${t.statusText}`);return await t.json()}var Bn=d('<div class="error-message svelte-1jb5ckg"> </div>'),Mn=d('<div class="toggle-container svelte-1jb5ckg"><button type="button" class="toggle-btn svelte-1jb5ckg"> </button></div>'),Tn=d('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID (leave empty to create new)</label> <input type="text" id="gistId" placeholder="Optional: existing Gist ID to update" class="svelte-1jb5ckg"/></div>'),Fn=d('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),Pn=d('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),In=d('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Update (or leave unselected to create new)</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),En=d('<div class="info-message svelte-1jb5ckg">No gists found. A new one will be created.</div>'),Hn=d('<!> <div class="form-group svelte-1jb5ckg"><label for="description" class="svelte-1jb5ckg"> </label> <input type="text" id="description" placeholder="D&amp;D Character Sheet" class="svelte-1jb5ckg"/></div>',1),Un=d('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID *</label> <input type="text" id="gistId" placeholder="Enter Gist ID (for public or your private gists)" required class="svelte-1jb5ckg"/></div>'),Nn=d('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),On=d('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),Gn=d('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Load</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),qn=d('<div class="info-message svelte-1jb5ckg">No gists found. Enter a Gist ID manually or create a new one in Save mode.</div>'),Wn=d('<div class="modal-overlay svelte-1jb5ckg" role="button" tabindex="-1"><div class="modal-content svelte-1jb5ckg" role="dialog" tabindex="0"><div class="modal-header svelte-1jb5ckg"><h2 class="svelte-1jb5ckg"> </h2> <button class="close-btn svelte-1jb5ckg">√ó</button></div> <div class="modal-body svelte-1jb5ckg"><!> <div class="form-group svelte-1jb5ckg"><label for="token" class="svelte-1jb5ckg"> <a href="https://github.com/settings/tokens" target="_blank" rel="noopener" class="svelte-1jb5ckg">Get token</a></label> <input type="password" id="token" placeholder="ghp_xxxxxxxxxxxxx" class="svelte-1jb5ckg"/></div> <!> <!> <div class="modal-actions svelte-1jb5ckg"><button class="btn btn-primary svelte-1jb5ckg"><!></button> <button class="btn btn-secondary svelte-1jb5ckg">Cancel</button></div></div></div></div>');function zn(i,c){Vt(c,!1);const t=()=>ft(be,"$character",v),[v,f]=ca(),p=xa();let g=Rt(c,"mode",8,"save"),$=S(""),_=S(""),y=S(""),F=S(!1),P=S(""),q=S(!1),U=S(!1),Z=S([]),E=S(null);const B=jn();B.token&&n($,B.token),B.gistId&&n(_,B.gistId),La(async()=>{e($)&&!e(q)&&await T()});async function T(){if(e($)){n(U,!0),n(P,"");try{n(Z,await Rn(e($))),e(_)&&n(E,e(Z).find(j=>j.id===e(_))||null)}catch(j){n(P,j.message||"Failed to load gists"),n(Z,[])}finally{n(U,!1)}}}function ee(j){e(E)?.id===j.id?(n(E,null),n(_,"")):(n(E,j),n(_,j.id))}function fe(){n(q,!e(q)),n(P,""),!e(q)&&e($)&&T()}async function Oe(){if(!e($)){n(P,"GitHub token is required");return}const j=e(E)?.id||e(_);n(F,!0),n(P,"");try{const z=Ua.export();if(j)await Ln(t(),e($),j,z),n(_,j),Ht.add("Character updated in Gist successfully!","success");else{const K=await Dn(t(),e($),e(y),z);n(_,K),Ht.add(`Character saved to Gist! ID: ${K}`,"success")}Es({token:e($),gistId:e(_)}),p("close")}catch(z){n(P,z.message||"Failed to save to Gist")}finally{n(F,!1)}}async function $e(){const j=e(E)?.id||e(_);if(!j){n(P,"Please select a gist or enter a Gist ID");return}n(F,!0),n(P,"");try{const{character:z,rollHistory:K}=await An(j,e($)||void 0);be.set(z),K?(Ua.import(K),Ht.add("Character and roll history loaded from Gist successfully!","success")):Ht.add("Character loaded from Gist successfully!","success"),n(_,j),Es({token:e($),gistId:e(_)}),p("close")}catch(z){n(P,z.message||"Failed to load from Gist")}finally{n(F,!1)}}function ce(){p("close")}Jt();var se=Wn(),he=l(se),Ee=l(he),J=l(Ee),A=l(J,!0);s(J);var x=a(J,2);s(Ee);var O=a(Ee,2),G=l(O);{var ue=j=>{var z=Bn(),K=l(z,!0);s(z),D(()=>k(K,e(P))),o(j,z)};m(G,j=>{e(P)&&j(ue)})}var _e=a(G,2),Ae=l(_e),ze=l(Ae);sa(),s(Ae);var Re=a(Ae,2);we(Re),s(_e);var De=a(_e,2);{var h=j=>{var z=Mn(),K=l(z),pe=l(K,!0);s(K),s(z),D(()=>{K.disabled=e(F),k(pe,e(q)?"üìã Show My Gists":"‚úèÔ∏è Enter Gist ID Manually")}),R("click",K,fe),o(j,z)};m(De,j=>{(g()==="load"||g()==="save"&&e($))&&j(h)})}var I=a(De,2);{var ve=j=>{var z=Hn(),K=ke(z);{var pe=le=>{var V=Tn(),Pe=a(l(V),2);we(Pe),s(V),D(()=>Pe.disabled=e(F)),Je(Pe,()=>e(_),Se=>n(_,Se)),o(le,V)},Ue=le=>{var V=kt(),Pe=ke(V);{var Se=xe=>{var te=Fn();o(xe,te)},lt=xe=>{var te=kt(),u=ke(te);{var it=W=>{var Le=In(),Ye=a(l(Le),2);Ct(Ye,5,()=>e(Z),Bt,(mt,rt)=>{var ye=Pn();let je;var He=l(ye),vt=l(He),X=l(vt,!0);s(vt);var Ke=a(vt,2),ct=l(Ke,!0);s(Ke),s(He);var b=a(He,2),H=l(b),de=l(H);s(H);var oe=a(H,2),ie=l(oe);s(oe),s(b),s(ye),D(Te=>{je=Ut(ye,1,"gist-item svelte-1jb5ckg",null,je,{selected:e(E)?.id===e(rt).id}),ye.disabled=e(F),k(X,(e(rt),r(()=>e(rt).description||"Untitled"))),k(ct,(e(rt),r(()=>e(rt).public?"üåê Public":"üîí Private"))),k(de,`ID: ${e(rt),r(()=>e(rt).id)??""}`),k(ie,`Updated: ${Te??""}`)},[()=>(e(rt),r(()=>new Date(e(rt).updated_at).toLocaleDateString()))]),R("click",ye,()=>ee(e(rt))),o(mt,ye)}),s(Ye),s(Le),o(W,Le)},Ge=W=>{var Le=kt(),Ye=ke(Le);{var mt=rt=>{var ye=En();o(rt,ye)};m(Ye,rt=>{e($)&&rt(mt)},!0)}o(W,Le)};m(u,W=>{e(Z),r(()=>e(Z).length>0)?W(it):W(Ge,!1)},!0)}o(xe,te)};m(Pe,xe=>{e(U)?xe(Se):xe(lt,!1)},!0)}o(le,V)};m(K,le=>{e(q)||!e($)?le(pe):le(Ue,!1)})}var Fe=a(K,2),Be=l(Fe),Me=l(Be);s(Be);var w=a(Be,2);we(w),s(Fe),D(()=>{k(Me,`Description ${e(_)?"(optional)":""}`),w.disabled=e(F)}),Je(w,()=>e(y),le=>n(y,le)),o(j,z)},et=j=>{var z=kt(),K=ke(z);{var pe=Fe=>{var Be=Un(),Me=a(l(Be),2);we(Me),s(Be),D(()=>Me.disabled=e(F)),Je(Me,()=>e(_),w=>n(_,w)),o(Fe,Be)},Ue=Fe=>{var Be=kt(),Me=ke(Be);{var w=V=>{var Pe=Nn();o(V,Pe)},le=V=>{var Pe=kt(),Se=ke(Pe);{var lt=te=>{var u=Gn(),it=a(l(u),2);Ct(it,5,()=>e(Z),Bt,(Ge,W)=>{var Le=On();let Ye;var mt=l(Le),rt=l(mt),ye=l(rt,!0);s(rt);var je=a(rt,2),He=l(je,!0);s(je),s(mt);var vt=a(mt,2),X=l(vt),Ke=l(X);s(X);var ct=a(X,2),b=l(ct);s(ct),s(vt),s(Le),D(H=>{Ye=Ut(Le,1,"gist-item svelte-1jb5ckg",null,Ye,{selected:e(E)?.id===e(W).id}),Le.disabled=e(F),k(ye,(e(W),r(()=>e(W).description||"Untitled"))),k(He,(e(W),r(()=>e(W).public?"üåê Public":"üîí Private"))),k(Ke,`ID: ${e(W),r(()=>e(W).id)??""}`),k(b,`Updated: ${H??""}`)},[()=>(e(W),r(()=>new Date(e(W).updated_at).toLocaleDateString()))]),R("click",Le,()=>ee(e(W))),o(Ge,Le)}),s(it),s(u),o(te,u)},xe=te=>{var u=kt(),it=ke(u);{var Ge=W=>{var Le=qn();o(W,Le)};m(it,W=>{e($)&&W(Ge)},!0)}o(te,u)};m(Se,te=>{e(Z),r(()=>e(Z).length>0)?te(lt):te(xe,!1)},!0)}o(V,Pe)};m(Me,V=>{e(U)?V(w):V(le,!1)},!0)}o(Fe,Be)};m(K,Fe=>{e(q)||!e($)?Fe(pe):Fe(Ue,!1)},!0)}o(j,z)};m(I,j=>{g()==="save"?j(ve):j(et,!1)})}var at=a(I,2),pt=l(at),Lt=l(pt);{var Mt=j=>{var z=Pt();D(()=>k(z,g()==="save"?"Saving...":"Loading...")),o(j,z)},C=j=>{var z=Pt();D(()=>k(z,g()==="save"?"Save":"Load")),o(j,z)};m(Lt,j=>{e(F)?j(Mt):j(C,!1)})}s(pt);var Q=a(pt,2);s(at),s(O),s(he),s(se),D(()=>{k(A,g()==="save"?"Save to GitHub Gist":"Load from GitHub Gist"),k(ze,`GitHub Token ${g()==="load"?"(optional for public gists)":"(required)"} `),Re.disabled=e(F),pt.disabled=e(F),Q.disabled=e(F)}),R("click",x,ce),Je(Re,()=>e($),j=>n($,j)),R("blur",Re,()=>{e($)&&!e(q)&&T()}),R("click",pt,function(...j){(g()==="save"?Oe:$e)?.apply(this,j)}),R("click",Q,ce),R("click",he,ws(function(j){Ma.call(this,c,j)})),R("keydown",he,function(j){Ma.call(this,c,j)}),R("click",se,ce),R("keydown",se,j=>j.key==="Escape"&&ce()),o(i,se),Yt(),f()}var Kn=d('<div class="loading svelte-1ngjemu">Loading D&D data...</div>'),Jn=d("<option> </option>"),Vn=d('<select class="level-filter svelte-1ngjemu"><option>All Levels</option><option>Cantrip</option><!></select>'),Yn=d('<div class="no-results svelte-1ngjemu"> </div>'),Qn=d('<div class="item-meta svelte-1ngjemu"> </div>'),Xn=d('<div class="item-meta svelte-1ngjemu"> </div>'),Zn=d('<button><div class="item-name svelte-1ngjemu"> </div> <!></button>'),eo=d('<p class="higher-levels"><strong>At Higher Levels:</strong> </p>'),to=d('<p class="cantrip-upgrade"><strong>Cantrip Upgrade:</strong> </p>'),ao=d('<h3 class="svelte-1ngjemu"> </h3> <p class="spell-meta svelte-1ngjemu"><!> <!></p> <p class="spell-classes"><strong>Classes:</strong> </p> <div class="spell-stats svelte-1ngjemu"><div><strong>Casting Time:</strong> </div> <div><strong>Range:</strong> </div> <div><strong>Components:</strong> <!></div> <div><strong>Duration:</strong> <!> </div></div> <p class="description svelte-1ngjemu"> </p> <!> <!>',1),so=d('<p class="prerequisite svelte-1ngjemu"><strong>Prerequisite:</strong> </p>'),lo=d('<h3 class="svelte-1ngjemu"> </h3> <!> <p class="description svelte-1ngjemu"> </p> <a target="_blank" rel="noopener" class="source-link svelte-1ngjemu">View Full Details ‚Üí</a>',1),io=d('<div class="item-details svelte-1ngjemu"><!></div>'),ro=d('<div class="controls svelte-1ngjemu"><div class="tabs svelte-1ngjemu"><button> </button> <button> </button></div> <div class="search-controls svelte-1ngjemu"><input type="text" placeholder="Search by name or description..." class="search-input svelte-1ngjemu"/> <!></div></div> <div class="content-container svelte-1ngjemu"><div class="items-list svelte-1ngjemu"><!></div> <!></div>',1),no=d('<div class="modal-backdrop svelte-1ngjemu" role="presentation"><div class="modal svelte-1ngjemu" role="dialog" aria-modal="true" tabindex="-1"><div class="modal-header svelte-1ngjemu"><h2 class="svelte-1ngjemu">Browse D&D Spells & Feats</h2> <button class="close-btn svelte-1ngjemu" aria-label="Close">&times;</button></div> <div class="modal-body svelte-1ngjemu"><!></div> <div class="modal-footer svelte-1ngjemu"><button class="btn-secondary svelte-1ngjemu">Cancel</button> <button class="btn-primary svelte-1ngjemu">Add to Character Sheet</button></div></div></div>');function oo(i,c){Vt(c,!1);const t=S(),v=S(),f=S();let p=Rt(c,"onClose",8),g=S("spell"),$=S(!0),_=S(""),y=S(null),F=S([]),P=S([]),q=S(null);La(async()=>{n($,!0);try{n(F,await Js()),n(P,await gi())}catch(x){console.error("Failed to load data:",x)}finally{n($,!1)}});function U(x){n(q,x)}function Z(x){const O=x.match(/(\d+d\d+(?:\s*\+\s*\d+)?)/i);return O?O[1]:""}function E(x){const O=x.split(/\.( |$)/)[0].trim(),G=Array.from(x.matchAll(/\*\*(.*?)\*\*/g)).map(_e=>_e[1].replace(/\.$/,""));let ue=O;return G.length&&(ue+=" | Effects: "+G.join(", ")),ue}function B(){if(e(q)){if(e(g)==="spell"){const x=e(q);be.update(O=>{const ue=[];x.range&&ue.push(`Range: ${x.range}`),x.castingTime&&ue.push(`Cast: ${x.castingTime}`),x.duration&&ue.push(`Duration: ${x.duration}`),x.actionType==="Save"&&ue.push("Saving throw spell"),x.components&&x.components.length>0&&ue.push(`Components: ${x.components.join(", ")}`),x.material&&ue.push(`Material: ${x.material}`);const _e=ue.join(" | "),Ae=E(x.description),ze={id:crypto.randomUUID(),name:`${x.name}${x.concentration?" (C)":""}${x.ritual?" (R)":""}`,bonus:x.actionType==="Attack"?5:0,damage:Z(x.description),damageType:`${x.school} (Lvl ${x.level})`,spellRef:x.name,infoNotes:_e,generalNotes:Ae,castAtLevel:x.level};return O.attacks=[...O.attacks,ze],O})}else if(e(g)==="feat"){const x=e(q);be.update(O=>{const G=`${x.name}${x.prerequisite?` (Req: ${x.prerequisite})`:""}
${x.description}
`;return O.features=O.features?`${O.features}
${G}`:G,O})}n(q,null),p()()}}Qe(()=>(e(y),e(F),e(_)),()=>{n(t,e(y)!==null?bi(Ps(e(F),e(_)),e(y)):Ps(e(F),e(_)))}),Qe(()=>(e(P),e(_)),()=>{n(v,hi(e(P),e(_)))}),Qe(()=>(e(g),e(t),e(v)),()=>{n(f,e(g)==="spell"?e(t):e(v))}),ma(),Jt();var T=no(),ee=l(T),fe=l(ee),Oe=a(l(fe),2);s(fe);var $e=a(fe,2),ce=l($e);{var se=x=>{var O=Kn();o(x,O)},he=x=>{var O=ro(),G=ke(O),ue=l(G),_e=l(ue);let Ae;var ze=l(_e);s(_e);var Re=a(_e,2);let De;var h=l(Re);s(Re),s(ue);var I=a(ue,2),ve=l(I);we(ve);var et=a(ve,2);{var at=K=>{var pe=Vn();D(()=>{e(y),Kt(()=>{})});var Ue=l(pe);Ue.value=(Ue.__value=null)??"";var Fe=a(Ue);Fe.value=Fe.__value=0;var Be=a(Fe);Ct(Be,0,()=>[1,2,3,4,5,6,7,8,9],Bt,(Me,w)=>{var le=Jn(),V=l(le);s(le);var Pe={};D(()=>{k(V,`Level ${w??""}`),Pe!==(Pe=w)&&(le.value=(le.__value=w)??"")}),o(Me,le)}),s(pe),Oa(pe,()=>e(y),Me=>n(y,Me)),o(K,pe)};m(et,K=>{e(g)==="spell"&&K(at)})}s(I),s(G);var pt=a(G,2),Lt=l(pt),Mt=l(Lt);{var C=K=>{var pe=Yn(),Ue=l(pe);s(pe),D(()=>k(Ue,`No ${e(g)??""}s found`)),o(K,pe)},Q=K=>{var pe=kt(),Ue=ke(pe);Ct(Ue,1,()=>e(f),Bt,(Fe,Be)=>{var Me=Zn();let w;var le=l(Me),V=l(le,!0);s(le);var Pe=a(le,2);{var Se=xe=>{const te=xt(()=>e(Be));var u=Qn(),it=l(u);s(u),D(()=>k(it,`Level ${N(e(te)),r(()=>e(te).level)??""} ‚Ä¢ ${N(e(te)),r(()=>e(te).school)??""}`)),o(xe,u)},lt=xe=>{const te=xt(()=>e(Be));var u=kt(),it=ke(u);{var Ge=W=>{var Le=Xn(),Ye=l(Le,!0);s(Le),D(()=>k(Ye,(N(e(te)),r(()=>e(te).prerequisite)))),o(W,Le)};m(it,W=>{N(e(te)),r(()=>e(te).prerequisite)&&W(Ge)})}o(xe,u)};m(Pe,xe=>{e(g)==="spell"?xe(Se):xe(lt,!1)})}s(Me),D(()=>{w=Ut(Me,1,"item-card svelte-1ngjemu",null,w,{selected:e(q)?.name===e(Be).name}),k(V,(e(Be),r(()=>e(Be).name)))}),R("click",Me,()=>U(e(Be))),o(Fe,Me)}),o(K,pe)};m(Mt,K=>{e(f),r(()=>e(f).length===0)?K(C):K(Q,!1)})}s(Lt);var j=a(Lt,2);{var z=K=>{var pe=io(),Ue=l(pe);{var Fe=Me=>{const w=xt(()=>e(q));var le=ao(),V=ke(le),Pe=l(V,!0);s(V);var Se=a(V,2),lt=l(Se);{var xe=re=>{var Y=Pt();D(()=>k(Y,`${N(e(w)),r(()=>e(w).school)??""} cantrip`)),o(re,Y)},te=re=>{var Y=Pt();D(()=>k(Y,`Level ${N(e(w)),r(()=>e(w).level)??""} ${N(e(w)),r(()=>e(w).school)??""}`)),o(re,Y)};m(lt,re=>{N(e(w)),r(()=>e(w).level===0)?re(xe):re(te,!1)})}var u=a(lt,2);{var it=re=>{var Y=Pt("(ritual)");o(re,Y)};m(u,re=>{N(e(w)),r(()=>e(w).ritual)&&re(it)})}s(Se);var Ge=a(Se,2),W=a(l(Ge));s(Ge);var Le=a(Ge,2),Ye=l(Le),mt=a(l(Ye));s(Ye);var rt=a(Ye,2),ye=a(l(rt));s(rt);var je=a(rt,2),He=a(l(je)),vt=a(He);{var X=re=>{var Y=Pt();D(()=>k(Y,`(${N(e(w)),r(()=>e(w).material)??""})`)),o(re,Y)};m(vt,re=>{N(e(w)),r(()=>e(w).material)&&re(X)})}s(je);var Ke=a(je,2),ct=a(l(Ke),2);{var b=re=>{var Y=Pt("Concentration,");o(re,Y)};m(ct,re=>{N(e(w)),r(()=>e(w).concentration)&&re(b)})}var H=a(ct,1,!0);s(Ke),s(Le);var de=a(Le,2),oe=l(de,!0);s(de);var ie=a(de,2);{var Te=re=>{var Y=eo(),Xe=a(l(Y));s(Y),D(()=>k(Xe,` ${N(e(w)),r(()=>e(w).higherLevelSlot)??""}`)),o(re,Y)};m(ie,re=>{N(e(w)),r(()=>e(w).higherLevelSlot)&&re(Te)})}var tt=a(ie,2);{var qe=re=>{var Y=to(),Xe=a(l(Y));s(Y),D(()=>k(Xe,` ${N(e(w)),r(()=>e(w).cantripUpgrade)??""}`)),o(re,Y)};m(tt,re=>{N(e(w)),r(()=>e(w).cantripUpgrade)&&re(qe)})}D((re,Y)=>{k(Pe,(N(e(w)),r(()=>e(w).name))),k(W,` ${re??""}`),k(mt,` ${N(e(w)),r(()=>e(w).castingTime||e(w).actionType)??""}`),k(ye,` ${N(e(w)),r(()=>e(w).range)??""}`),k(He,` ${Y??""}`),k(H,(N(e(w)),r(()=>e(w).duration))),k(oe,(N(e(w)),r(()=>e(w).description)))},[()=>(N(e(w)),r(()=>e(w).classes.join(", "))),()=>(N(e(w)),r(()=>e(w).components.join(", ").toUpperCase()))]),o(Me,le)},Be=Me=>{const w=xt(()=>e(q));var le=lo(),V=ke(le),Pe=l(V,!0);s(V);var Se=a(V,2);{var lt=it=>{var Ge=so(),W=a(l(Ge));s(Ge),D(()=>k(W,` ${N(e(w)),r(()=>e(w).prerequisite)??""}`)),o(it,Ge)};m(Se,it=>{N(e(w)),r(()=>e(w).prerequisite)&&it(lt)})}var xe=a(Se,2),te=l(xe,!0);s(xe);var u=a(xe,2);D(()=>{k(Pe,(N(e(w)),r(()=>e(w).name))),k(te,(N(e(w)),r(()=>e(w).description))),ot(u,"href",(N(e(w)),r(()=>e(w).source)))}),o(Me,le)};m(Ue,Me=>{e(g)==="spell"?Me(Fe):Me(Be,!1)})}s(pe),o(K,pe)};m(j,K=>{e(q)&&K(z)})}s(pt),D(()=>{Ae=Ut(_e,1,"tab svelte-1ngjemu",null,Ae,{active:e(g)==="spell"}),k(ze,`üìú Spells (${e(F),r(()=>e(F).length)??""})`),De=Ut(Re,1,"tab svelte-1ngjemu",null,De,{active:e(g)==="feat"}),k(h,`‚≠ê Feats (${e(P),r(()=>e(P).length)??""})`)}),R("click",_e,()=>{n(g,"spell"),n(q,null),n(_,"")}),R("click",Re,()=>{n(g,"feat"),n(q,null),n(_,"")}),Je(ve,()=>e(_),K=>n(_,K)),o(x,O)};m(ce,x=>{e($)?x(se):x(he,!1)})}s($e);var Ee=a($e,2),J=l(Ee),A=a(J,2);s(Ee),s(ee),s(T),D(()=>A.disabled=!e(q)),R("click",Oe,function(...x){p()?.apply(this,x)}),R("click",J,function(...x){p()?.apply(this,x)}),R("click",A,B),R("click",ee,ws(function(x){Ma.call(this,c,x)})),R("keydown",ee,function(x){Ma.call(this,c,x)}),R("click",T,function(...x){p()?.apply(this,x)}),R("keydown",T,x=>x.key==="Escape"&&p()()),o(i,T),Yt()}var co=d('<span class="resistance-tag svelte-gdwwx1"> <button type="button" class="tag-remove svelte-gdwwx1">√ó</button></span>'),vo=d('<div class="resistance-list svelte-gdwwx1"></div>'),uo=d('<p class="ability-meta svelte-gdwwx1"> <!></p>'),fo=d('<p class="ability-meta svelte-gdwwx1">Requires Reaction</p>'),po=d('<div class="ability-card svelte-gdwwx1"><div class="ability-header svelte-gdwwx1"><strong class="svelte-gdwwx1"> </strong> <button type="button" class="ability-remove svelte-gdwwx1">√ó</button></div> <p class="ability-description svelte-gdwwx1"> </p> <!></div>'),mo=d('<div class="abilities-list svelte-gdwwx1"></div>'),go=d(`<div class="modal-backdrop svelte-gdwwx1" role="presentation"><div class="modal-content svelte-gdwwx1" role="dialog" aria-modal="true" aria-labelledby="modal-title"><div class="modal-header svelte-gdwwx1"><h3 id="modal-title" class="svelte-gdwwx1">Add Custom Condition</h3> <button class="btn-close svelte-gdwwx1" aria-label="Close">√ó</button></div> <div class="modal-body svelte-gdwwx1"><div class="form-group svelte-gdwwx1"><label for="conditionName" class="svelte-gdwwx1">Condition Name*</label> <input type="text" id="conditionName" placeholder="e.g., Cazna's Mark" class="svelte-gdwwx1"/></div> <div class="form-group svelte-gdwwx1"><label for="description" class="svelte-gdwwx1">Description</label> <textarea id="description" placeholder="Describe the condition..." rows="3" class="svelte-gdwwx1"></textarea></div> <div class="form-row svelte-gdwwx1"><div class="form-group svelte-gdwwx1"><label for="attackBonus" class="svelte-gdwwx1">Attack Bonus</label> <input type="text" id="attackBonus" placeholder="0 or 1d4" class="svelte-gdwwx1"/></div> <div class="form-group svelte-gdwwx1"><label for="damageBonus" class="svelte-gdwwx1">Damage Bonus</label> <input type="text" id="damageBonus" placeholder="0 or 1d6" class="svelte-gdwwx1"/></div> <div class="form-group svelte-gdwwx1"><label for="acBonus" class="svelte-gdwwx1">AC Bonus</label> <input type="number" id="acBonus" placeholder="0" class="svelte-gdwwx1"/></div></div> <div class="form-group svelte-gdwwx1"><label for="darkvision" class="svelte-gdwwx1">Darkvision (feet)</label> <input type="number" id="darkvision" placeholder="0" min="0" step="30" class="svelte-gdwwx1"/> <small class="help-text svelte-gdwwx1">Grant or extend darkvision (e.g., 60 for 60 feet)</small></div> <div class="form-group svelte-gdwwx1"><label class="svelte-gdwwx1">Damage Resistances</label> <div class="resistance-input-group svelte-gdwwx1"><input type="text" placeholder="e.g., cold, fire, poison" class="svelte-gdwwx1"/> <button type="button" class="btn-add svelte-gdwwx1">Add</button></div> <!></div> <div class="form-group svelte-gdwwx1"><label class="svelte-gdwwx1">Special Abilities</label> <div class="ability-form svelte-gdwwx1"><input type="text" placeholder="Ability name (e.g., Flicker of Deceit)" class="ability-name-input svelte-gdwwx1"/> <textarea placeholder="Ability description..." rows="2" class="ability-desc-input svelte-gdwwx1"></textarea> <div class="ability-options svelte-gdwwx1"><div class="ability-option svelte-gdwwx1"><label for="abilityUses" class="svelte-gdwwx1">Uses per rest</label> <input type="number" id="abilityUses" min="0" class="svelte-gdwwx1"/></div> <div class="ability-option svelte-gdwwx1"><label for="restType" class="svelte-gdwwx1">Rest type</label> <select id="restType" class="svelte-gdwwx1"><option>Short</option><option>Long</option></select></div> <div class="ability-option svelte-gdwwx1"><label class="svelte-gdwwx1"><input type="checkbox" class="svelte-gdwwx1"/> Requires Reaction</label></div></div> <button type="button" class="btn-add svelte-gdwwx1">Add Ability</button></div> <!></div></div> <div class="modal-footer svelte-gdwwx1"><button class="btn btn-secondary svelte-gdwwx1">Cancel</button> <button class="btn btn-primary svelte-gdwwx1">Add Condition</button></div></div></div>`);function bo(i,c){Vt(c,!1);let t=Rt(c,"show",8,!1),v=Rt(c,"onSave",8),f=Rt(c,"onCancel",8),p=S(""),g=S(""),$=S(0),_=S(0),y=S(0),F=S(0),P=S([]),q=S(""),U=S([]),Z=S(""),E=S(""),B=S(0),T=S("short"),ee=S(!1);function fe(){n(p,""),n(g,""),n($,0),n(_,0),n(y,0),n(F,0),n(P,[]),n(q,""),n(U,[]),n(Z,""),n(E,""),n(B,0),n(T,"short"),n(ee,!1)}function Oe(){e(q).trim()&&(n(P,[...e(P),e(q).trim()]),n(q,""))}function $e(G){n(P,e(P).filter((ue,_e)=>_e!==G))}function ce(){if(e(Z).trim()&&e(E).trim()){const G={name:e(Z).trim(),description:e(E).trim(),requiresReaction:e(ee)};e(B)>0&&(G.usesPerRest=e(B),G.currentUses=e(B),G.restType=e(T)),n(U,[...e(U),G]),n(Z,""),n(E,""),n(B,0),n(T,"short"),n(ee,!1)}}function se(G){n(U,e(U).filter((ue,_e)=>_e!==G))}function he(){if(!e(p).trim()){alert("Please enter a condition name");return}const G={name:e(p).trim(),description:e(g).trim()||"Custom condition",attackBonus:e($)||0,damageBonus:e(_)||0,target:"self"};e(y)!==0&&(G.acBonus=e(y)),e(F)>0&&(G.darkvision=e(F)),e(P).length>0&&(G.resistances=e(P)),e(U).length>0&&(G.abilities=e(U)),v()(G),fe()}function Ee(){fe(),f()()}function J(G){G.target===G.currentTarget&&Ee()}Jt();var A=kt(),x=ke(A);{var O=G=>{var ue=go(),_e=l(ue),Ae=l(_e),ze=a(l(Ae),2);s(Ae);var Re=a(Ae,2),De=l(Re),h=a(l(De),2);we(h),s(De);var I=a(De,2),ve=a(l(I),2);Ra(ve),s(I);var et=a(I,2),at=l(et),pt=a(l(at),2);we(pt),s(at);var Lt=a(at,2),Mt=a(l(Lt),2);we(Mt),s(Lt);var C=a(Lt,2),Q=a(l(C),2);we(Q),s(C),s(et);var j=a(et,2),z=a(l(j),2);we(z),sa(2),s(j);var K=a(j,2),pe=a(l(K),2),Ue=l(pe);we(Ue);var Fe=a(Ue,2);s(pe);var Be=a(pe,2);{var Me=X=>{var Ke=vo();Ct(Ke,5,()=>e(P),Bt,(ct,b,H)=>{var de=co(),oe=l(de),ie=a(oe);s(de),D(()=>{k(oe,`${e(b)??""} `),ot(ie,"aria-label",`Remove ${e(b)??""}`)}),R("click",ie,()=>$e(H)),o(ct,de)}),s(Ke),o(X,Ke)};m(Be,X=>{e(P),r(()=>e(P).length>0)&&X(Me)})}s(K);var w=a(K,2),le=a(l(w),2),V=l(le);we(V);var Pe=a(V,2);Ra(Pe);var Se=a(Pe,2),lt=l(Se),xe=a(l(lt),2);we(xe),s(lt);var te=a(lt,2),u=a(l(te),2);D(()=>{e(T),Kt(()=>{})});var it=l(u);it.value=it.__value="short";var Ge=a(it);Ge.value=Ge.__value="long",s(u),s(te);var W=a(te,2),Le=l(W),Ye=l(Le);we(Ye),sa(),s(Le),s(W),s(Se);var mt=a(Se,2);s(le);var rt=a(le,2);{var ye=X=>{var Ke=mo();Ct(Ke,5,()=>e(U),Bt,(ct,b,H)=>{var de=po(),oe=l(de),ie=l(oe),Te=l(ie,!0);s(ie);var tt=a(ie,2);s(oe);var qe=a(oe,2),re=l(qe,!0);s(qe);var Y=a(qe,2);{var Xe=ae=>{var ge=uo(),Ze=l(ge),wt=a(Ze);{var nt=ne=>{var qt=Pt("‚Ä¢ Requires Reaction");o(ne,qt)};m(wt,ne=>{e(b),r(()=>e(b).requiresReaction)&&ne(nt)})}s(ge),D(()=>k(Ze,`${e(b),r(()=>e(b).usesPerRest)??""} use${e(b),r(()=>e(b).usesPerRest>1?"s":"")??""} per ${e(b),r(()=>e(b).restType)??""}
                      rest `)),o(ae,ge)},me=ae=>{var ge=kt(),Ze=ke(ge);{var wt=nt=>{var ne=fo();o(nt,ne)};m(Ze,nt=>{e(b),r(()=>e(b).requiresReaction)&&nt(wt)},!0)}o(ae,ge)};m(Y,ae=>{e(b),r(()=>e(b).usesPerRest)?ae(Xe):ae(me,!1)})}s(de),D(()=>{k(Te,(e(b),r(()=>e(b).name))),ot(tt,"aria-label",`Remove ${e(b),r(()=>e(b).name)??""}`),k(re,(e(b),r(()=>e(b).description)))}),R("click",tt,()=>se(H)),o(ct,de)}),s(Ke),o(X,Ke)};m(rt,X=>{e(U),r(()=>e(U).length>0)&&X(ye)})}s(w),s(Re);var je=a(Re,2),He=l(je),vt=a(He,2);s(je),s(_e),s(ue),R("click",ze,Ee),Je(h,()=>e(p),X=>n(p,X)),Je(ve,()=>e(g),X=>n(g,X)),Je(pt,()=>e($),X=>n($,X)),Je(Mt,()=>e(_),X=>n(_,X)),Je(Q,()=>e(y),X=>n(y,X)),Je(z,()=>e(F),X=>n(F,X)),Je(Ue,()=>e(q),X=>n(q,X)),R("keydown",Ue,X=>X.key==="Enter"&&Oe()),R("click",Fe,Oe),Je(V,()=>e(Z),X=>n(Z,X)),Je(Pe,()=>e(E),X=>n(E,X)),Je(xe,()=>e(B),X=>n(B,X)),Oa(u,()=>e(T),X=>n(T,X)),Ca(Ye,()=>e(ee),X=>n(ee,X)),R("click",mt,ce),R("click",He,Ee),R("click",vt,he),R("click",ue,J),o(G,ue)};m(x,G=>{t()&&G(O)})}o(i,A),Yt()}var ho=d("<option></option>"),_o=d("<button> </button>"),yo=d('<div class="input-field svelte-uvfntf"><label class="svelte-uvfntf"><input type="checkbox"/> Uncanny Dodge (When an attacker that you can see hits you with an attack roll, you can take a Reaction to halve the attack‚Äôs damage against you.)</label></div>'),xo=d('<div class="adjustment-msg svelte-uvfntf"> </div>'),$o=d('<div class="calculation-result svelte-uvfntf"><div class="result-header svelte-uvfntf"><h4 class="svelte-uvfntf">Damage Calculation</h4></div> <div class="result-content svelte-uvfntf"><div class="damage-breakdown svelte-uvfntf"><div class="damage-row svelte-uvfntf"><span class="label svelte-uvfntf">Original Damage:</span> <span class="value svelte-uvfntf"> </span></div> <div class="adjustments svelte-uvfntf"></div> <div class="damage-row final svelte-uvfntf"><span class="label svelte-uvfntf">Final Damage:</span> <span class="value damage-value svelte-uvfntf"> </span></div></div></div> <div class="result-actions svelte-uvfntf"><button class="btn btn-primary apply-btn use-enabled svelte-uvfntf">Apply Damage</button> <button class="btn btn-secondary cancel-btn use-enabled svelte-uvfntf">Cancel</button></div></div>'),ko=d('<div class="damage-form svelte-uvfntf"><div class="input-group svelte-uvfntf"><div class="input-field svelte-uvfntf"><label for="damageAmount" class="svelte-uvfntf">Damage Amount</label> <input type="number" id="damageAmount" min="0" placeholder="0" class="damage-input-field use-enabled svelte-uvfntf"/></div> <div class="input-field svelte-uvfntf"><label for="damageType" class="svelte-uvfntf">Damage Type</label> <input type="text" id="damageType" list="damageTypes" placeholder="e.g., fire, cold" class="damage-input-field use-enabled svelte-uvfntf"/> <datalist id="damageTypes"></datalist></div></div> <div class="quick-types svelte-uvfntf"><span class="quick-types-label svelte-uvfntf">Quick Select:</span> <!></div> <!> <!></div>'),wo=d("<section><!> <!></section>");function So(i,c){Vt(c,!1);const t=()=>ft(be,"$character",p),v=()=>ft(ya,"$searchFilter",p),f=()=>ft(ea,"$collapsedStates",p),[p,g]=ca(),$=S(),_=S();xa();let y=S(0),F=S(""),P=S(0),q=S([]),U=S(!1);const Z=["slashing","piercing","bludgeoning","fire","cold","lightning","thunder","acid","poison","necrotic","radiant","psychic","force"],E={slashing:"üó°Ô∏è",piercing:"üèπ",bludgeoning:"üî®",fire:"üî•",cold:"‚ùÑÔ∏è",lightning:"‚ö°",thunder:"üí•",acid:"üß™",poison:"‚ò†Ô∏è",necrotic:"üíÄ",radiant:"‚ú®",psychic:"üß†",force:"üå™Ô∏è"};function B(){be.update(se=>Vl(se,e(P))),Ht.add(`Applied ${e(P)} damage to character (${e(F)})`,"info"),n(y,0),n(F,""),n(P,0),n(q,[])}function T(){n(y,0),n(F,""),n(P,0),n(q,[])}Qe(()=>t(),()=>{n($,t()?.features?.toLowerCase?.().includes("uncanny dodge"))}),Qe(()=>(e(y),e(F),t(),e(U)),()=>{if(e(y)>=0&&e(F).trim()){const se=Jl(e(y),e(F),t());let he=se.finalDamage,Ee=[...se.adjustments];e(U)&&(he=Math.floor(he/2),Ee.push("Uncanny Dodge: Halved final damage")),n(P,he),n(q,Ee)}else n(P,0),n(q,[])}),Qe(()=>v(),()=>{n(_,!v()||"damage".includes(v().toLowerCase())||"resistance".includes(v().toLowerCase())||"immune".includes(v().toLowerCase()))}),ma(),Jt();var ee=wo();let fe;var Oe=l(ee);{let se=xt(()=>(f(),r(()=>f().damageInput?"Expand":"Collapse")));$a(Oe,{title:"Apply Damage",get collapsed(){return f(),r(()=>f().damageInput)},get ariaLabel(){return e(se)},onToggle:()=>ea.update(he=>({...he,damageInput:!he.damageInput}))})}var $e=a(Oe,2);{var ce=se=>{var he=ko(),Ee=l(he),J=l(Ee),A=a(l(J),2);we(A),s(J);var x=a(J,2),O=a(l(x),2);we(O);var G=a(O,2);Ct(G,5,()=>Z,Bt,(h,I)=>{var ve=ho(),et={};D(()=>{et!==(et=e(I))&&(ve.value=(ve.__value=e(I))??"")}),o(h,ve)}),s(G),s(x),s(Ee);var ue=a(Ee,2),_e=a(l(ue),2);Ct(_e,1,()=>Z,Bt,(h,I)=>{var ve=_o();let et;var at=l(ve);s(ve),D(()=>{et=Ut(ve,1,"quick-type-btn use-enabled svelte-uvfntf",null,et,{active:e(F)===e(I)}),k(at,`${e(I),r(()=>E[e(I)])??""} ${e(I)??""}`)}),R("click",ve,()=>n(F,e(I))),o(h,ve)}),s(ue);var Ae=a(ue,2);{var ze=h=>{var I=yo(),ve=l(I),et=l(ve);we(et),sa(),s(ve),s(I),Ca(et,()=>e(U),at=>n(U,at)),o(h,I)};m(Ae,h=>{e($)&&h(ze)})}var Re=a(Ae,2);{var De=h=>{var I=$o(),ve=a(l(I),2),et=l(ve),at=l(et),pt=a(l(at),2),Lt=l(pt);s(pt),s(at);var Mt=a(at,2);Ct(Mt,5,()=>e(q),Bt,(Ue,Fe)=>{var Be=xo(),Me=l(Be,!0);s(Be),D(()=>k(Me,e(Fe))),o(Ue,Be)}),s(Mt);var C=a(Mt,2),Q=a(l(C),2),j=l(Q,!0);s(Q),s(C),s(et),s(ve);var z=a(ve,2),K=l(z),pe=a(K,2);s(z),s(I),D(()=>{k(Lt,`${e(y)??""} ${e(F),r(()=>E[e(F)]||"")??""} ${e(F)??""}`),k(j,e(P))}),R("click",K,B),R("click",pe,T),o(h,I)};m(Re,h=>{e(y),e(F),r(()=>e(y)>=0&&e(F).trim())&&h(De)})}s(he),Je(A,()=>e(y),h=>n(y,h)),Je(O,()=>e(F),h=>n(F,h)),o(se,he)};m($e,se=>{f(),r(()=>!f().damageInput)&&se(ce)})}s(ee),D(()=>fe=Ut(ee,1,"damage-input svelte-uvfntf",null,fe,{hidden:!e(_)})),o(i,ee),Yt(),g()}var Co=d('<link rel="icon" type="image/png" href="favicon4.png"/> <meta name="viewport" content="width=device-width, initial-scale=1"/>',1),Do=d('<span class="character-name svelte-1uha8ag"> </span>'),Lo=d("<span> </span>"),Ao=d('<div class="spell-slots-header svelte-1uha8ag"></div>'),jo=d("<span> </span><br/>",1),Ro=d("<span> </span><br/>",1),Bo=d("<span> </span><br/>",1),Mo=d("<span> </span><br/>",1),To=d("<span> </span><br/>",1),Fo=d("<span> </span><br/>",1),Po=d("<br/><em> <!>)</em>",1),Io=d("<br/><em>(requires reaction)</em>",1),Eo=d('<div class="ability-detail"><strong> </strong> <!></div>'),Ho=d('<div class="abilities-section"><strong>Abilities:</strong><br/> <!></div>'),Uo=d('<span class="effect-tooltip"><strong> </strong><br/> <br/> <!> <!> <!> <!> <!> <!> <!></span>'),No=d('<button class="effect-remove-btn svelte-1uha8ag">√ó</button>'),Oo=d('<span class="effect-badge svelte-1uha8ag" tabindex="0"> <!> <!></span>'),Go=d(`<div class="active-effects-header svelte-1uha8ag"></div> <style>.effect-badge {
              position: relative;
            }
            .effect-tooltip {
              position: absolute;
              top: 120%;
              left: 50%;
              transform: translateX(-50%);
              background: #fff;
              color: #222;
              border: 1px solid #a5b4fc;
              border-radius: 6px;
              padding: 8px 12px;
              font-size: 0.95em;
              box-shadow: 0 2px 8px rgba(0, 0, 0, 0.12);
              z-index: 10;
              min-width: 180px;
              max-width: 300px;
              white-space: normal;
              pointer-events: none;
              opacity: 1;
              transition: opacity 0.15s;
            }

            .abilities-section {
              margin-top: 8px;
              padding-top: 8px;
              border-top: 1px solid #e5e7eb;
            }

            .ability-detail {
              margin-top: 6px;
              padding: 4px;
              background: #f9fafb;
              border-radius: 4px;
              font-size: 0.9em;
            }

            .ability-detail strong {
              color: #6366f1;
            }

            .ability-detail em {
              font-size: 0.85em;
              color: #6b7280;
            }</style>`,1),qo=d('<div class="rest-menu svelte-1uha8ag"><button class="rest-option svelte-1uha8ag">‚òï Short Rest</button> <button class="rest-option svelte-1uha8ag">üõèÔ∏è Long Rest</button></div>'),Wo=d('<div class="container svelte-1uha8ag"><header class="svelte-1uha8ag"><div class="header-top svelte-1uha8ag"><div class="header-title svelte-1uha8ag"><div class="title-row svelte-1uha8ag"><h1 class="svelte-1uha8ag">D&D Character Sheet</h1> <!></div> <!> <!></div> <div class="header-right svelte-1uha8ag"><div class="header-controls svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">üé≤</span><span class="btn-text svelte-1uha8ag">Roll Dice</span></button> <div class="rest-button-container svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">üò¥</span><span class="btn-text svelte-1uha8ag">Rest</span></button> <!></div> <button class="btn btn-secondary use-enabled" title="Add custom condition with effects"><span class="btn-icon svelte-1uha8ag">‚ú®</span><span class="btn-text svelte-1uha8ag">Add Condition</span></button> <div class="mode-toggle"><button><span class="btn-icon svelte-1uha8ag"> </span><span class="btn-text svelte-1uha8ag"> </span></button> <button class="btn btn-mode svelte-1uha8ag" title="Toggle dark mode"><span class="btn-icon svelte-1uha8ag"> </span> <span class="btn-text svelte-1uha8ag"> </span></button></div></div> <div class="header-search svelte-1uha8ag"><input type="text" placeholder="üîç Search..." class="search-input use-enabled svelte-1uha8ag"/></div></div></div> <div class="header-actions svelte-1uha8ag"><button class="btn btn-mode svelte-1uha8ag">üìö Browse Spells & Feats</button> <button class="btn btn-secondary">Save to Gist</button> <button class="btn btn-secondary">Load from Gist</button> <button class="btn btn-secondary">Export JSON</button> <button class="btn btn-secondary">Import JSON</button> <input type="file" accept=".json" style="display: none;"/></div></header> <main class="svelte-1uha8ag"><!> <!> <!> <!> <!> <!> <!> <!> <!></main></div> <!> <!> <!> <!> <!>',1);function ec(i,c){Vt(c,!1);const t=()=>ft(be,"$character",p),v=()=>ft(Da,"$isEditMode",p),f=()=>ft(ya,"$searchFilter",p),[p,g]=ca();let $=S(!1);function _(L){n($,L),L?document.body.classList.add("dark-mode"):document.body.classList.remove("dark-mode"),localStorage.setItem("dnd-dark-mode",L?"true":"false")}function y(){_(!e($))}La(()=>{const L=localStorage.getItem("dnd-dark-mode");_(L==="true")});function F(){const L=[],We=t().classFeatures.spellSlotsByLevel||{};for(let Ce=1;Ce<=9;Ce++){const st=We[Ce];if(st&&st.length>0){const M=st.length,dt=st.filter(gt=>gt).length;L.push({level:Ce,available:M-dt,total:M})}}return L}let P=S(!1),q=S(!1),U=S(!1),Z=S(!1),E=S("save"),B=S(void 0),T=S(""),ee=S(""),fe=S(""),Oe=S(!1),$e=S([]),ce=S([]),se=S("other"),he=S(),Ee=!1,J=1,A=S(!1),x=S(null);function O(L){n(x,L)}function G(){n(x,null)}function ue(L){n(x,e(x)===L?null:L)}function _e(L){be.update(We=>(We.activeStates||(We.activeStates=[]),We.activeStates=[...We.activeStates,L],We)),n(Z,!1),Ht.add(`Added condition: ${L.name}`,"success")}function Ae(){n(Z,!1)}function ze(){const L=[];be.update(M=>{const dt=M.hitDice.current;M.hitDice.current=Math.min(M.hitDice.max,M.hitDice.current+Math.max(1,Math.floor(M.hitDice.max/2)));const gt=M.hitDice.current-dt;if(gt>0&&L.push(`${gt} hit ${gt===1?"die":"dice"}`),M.class){const ut=Ta(M.class,M.level,M.subclass);M.classFeatures.features||(M.classFeatures.features={}),ut.forEach(Ne=>{if(Ne.resetOn==="short"){const Dt=typeof Ne.name=="function"?Ne.name(M.level):Ne.name,bt=Dt.replace(/\s+/g,"");if(Ne.type==="uses"){const Ft=typeof Ne.maxUses=="function"?Ne.maxUses(M.level):Ne.maxUses;M.classFeatures.features[bt]=Array(Ft).fill(!1),L.push(Dt)}else if(Ne.type==="pool"){const Ft=typeof Ne.maxPool=="function"?Ne.maxPool(M.level):Ne.maxPool;Ft!==void 0&&(M.classFeatures.features[bt]=Ft,L.push(Dt))}}})}return M.activeStates&&M.activeStates.forEach(ut=>{ut.abilities&&ut.abilities.forEach(Ne=>{if(Ne.restType==="short"&&Ne.usesPerRest){const Dt=Ne.usesPerRest-(Ne.currentUses||0)>0;Ne.currentUses=Ne.usesPerRest,Dt&&L.push(`${ut.name}: ${Ne.name}`)}})}),M}),Ls("short"),As(t().race,t().level).some(M=>M.restType==="short"&&M.usesPerRest)&&L.push("racial traits"),n(A,!1);const st=L.length>0?`Short rest taken! Restored: ${L.join(", ")}`:"Short rest taken!";Ht.add(st,"success")}function Re(){const L=[];be.update(M=>{const dt=M.maxHP-M.currentHP;dt>0&&L.push(`${dt} HP`),M.currentHP=M.maxHP,M.tempHP=0;const gt=M.hitDice.max-M.hitDice.current;gt>0&&L.push(`${gt} hit ${gt===1?"die":"dice"}`),M.hitDice.current=M.hitDice.max;let ut=0;if(M.classFeatures.spellSlotsByLevel&&Object.keys(M.classFeatures.spellSlotsByLevel).forEach(Ne=>{const Dt=M.classFeatures.spellSlotsByLevel[parseInt(Ne)];if(Dt){const bt=Dt.filter(Ft=>Ft).length;ut+=bt,M.classFeatures.spellSlotsByLevel[parseInt(Ne)]=Array(Dt.length).fill(!1)}}),ut>0&&L.push(`${ut} spell ${ut===1?"slot":"slots"}`),M.class){const Ne=Ta(M.class,M.level,M.subclass);M.classFeatures.features||(M.classFeatures.features={});let Dt=!1;Ne.forEach(bt=>{const ht=(typeof bt.name=="function"?bt.name(M.level):bt.name).replace(/\s+/g,"");if(!(bt.type==="info"||bt.type==="channelDivinity")){if(bt.type==="uses"){const Ve=typeof bt.maxUses=="function"?bt.maxUses(M.level):bt.maxUses;M.classFeatures.features[ht]=Array(Ve).fill(!1),Dt=!0}else if(bt.type==="pool"){const Ve=typeof bt.maxPool=="function"?bt.maxPool(M.level):bt.maxPool;Ve!==void 0&&(M.classFeatures.features[ht]=Ve,Dt=!0)}}}),Dt&&L.push("all class features")}if(M.activeStates){let Ne=!1;M.activeStates.forEach(Dt=>{Dt.abilities&&Dt.abilities.forEach(bt=>{if(bt.usesPerRest){const Ft=(bt.currentUses||0)<bt.usesPerRest;bt.currentUses=bt.usesPerRest,Ft&&(Ne=!0)}})}),Ne&&L.push("condition abilities")}return M}),Ls("long"),As(t().race,t().level).some(M=>M.usesPerRest)&&L.push("racial traits"),n(A,!1);const st=L.length>0?`Long rest taken! Restored: ${L.join(", ")}`:"Long rest taken! Fully rested.";Ht.add(st,"success")}function De(L){n(T,""),n(ee,""),n(fe,""),n(Oe,!1),n($e,[]),n(ce,[]),n(se,"other"),Ee=!1,typeof L=="string"?n(T,L):(n(T,L.notation),n(ee,L.damageNotation||""),n(fe,L.attackName||""),n(Oe,!!L.applyHalfDamage),n($e,L.bonusBreakdown||[]),n(ce,L.damageBreakdown||[]),n(se,L.rollType||"other")),n(P,!0)}function h(L){const{notation:We,count:Ce,bonusBreakdown:st}=L.detail;n(T,""),Ee=!0,J=Ce||1,setTimeout(()=>{n(T,We),n(ee,""),n(fe,"Hit Die"),n($e,st||[]),n(se,"other")},0),n(P,!0)}function I(L){const{notation:We,bonusBreakdown:Ce}=L.detail;n(T,""),setTimeout(()=>{n(T,We),n(ee,""),n(fe,"Initiative"),n($e,Ce||[]),n(se,"check")},0),n(P,!0)}function ve(){if(n(P,!1),Ee&&e(he)){const L=e(he).getLastRollTotal();if(L!==null){const We=Math.max(1,L);be.update(Ce=>(Ce.hitDice.current=Math.max(0,Ce.hitDice.current-J),Ce.currentHP=Math.min(Ce.maxHP,Ce.currentHP+We),Ce))}Ee=!1}}function et(){Da.update(L=>!L)}function at(L){L.target.closest(".rest-button-container")||n(A,!1)}La(()=>{const L=Da.subscribe(We=>{We?document.body.classList.remove("use-mode"):document.body.classList.add("use-mode")});return document.addEventListener("click",at),()=>{L(),document.removeEventListener("click",at)}});function pt(){yl(t())}function Lt(){e(B)?.click()}async function Mt(L){const Ce=L.target.files?.[0];if(Ce)try{const st=await xl(Ce);be.set(st),alert("Character imported successfully!")}catch{alert("Failed to import character file")}}Jt();var C=Wo();hl("1uha8ag",L=>{var We=Co();sa(2),Ns(()=>{pl.title="D&D Character Sheet"}),o(L,We)});var Q=ke(C),j=l(Q),z=l(j),K=l(z),pe=l(K),Ue=a(l(pe),2);{var Fe=L=>{var We=Do(),Ce=l(We);s(We),D(()=>k(Ce,`${t().name??""} (${t().level??""})`)),o(L,We)};m(Ue,L=>{t().name&&L(Fe)})}s(pe);var Be=a(pe,2);{var Me=L=>{var We=Ao();Ct(We,5,F,Bt,(Ce,st)=>{var M=Lo();let dt;var gt=l(M);s(M),D(()=>{dt=Ut(M,1,"slot-badge svelte-1uha8ag",null,dt,{depleted:e(st).available===0}),k(gt,`Lv${e(st).level??""}: ${e(st).available??""}/${e(st).total??""}`)}),o(Ce,M)}),s(We),o(L,We)};m(Be,L=>{F().length>0&&L(Me)})}var w=a(Be,2);{var le=L=>{var We=Go(),Ce=ke(We);Ct(Ce,5,()=>t().activeStates,Bt,(st,M,dt)=>{var gt=Oo(),ut=l(gt),Ne=a(ut);{var Dt=ht=>{var Ve=Uo(),$t=l(Ve),Ot=l($t,!0);s($t);var zt=a($t,2),ra=a(zt,3);{var ua=yt=>{var Tt=jo(),jt=ke(Tt),It=l(jt);s(jt),sa(),D(()=>k(It,`Attack Bonus: ${typeof e(M).attackBonus=="number"&&e(M).attackBonus>0?"+":""}${e(M).attackBonus??""}`)),o(yt,Tt)};m(ra,yt=>{e(M).attackBonus&&yt(ua)})}var va=a(ra,2);{var Qt=yt=>{var Tt=Ro(),jt=ke(Tt),It=l(jt);s(jt),sa(),D(()=>k(It,`Damage Bonus: ${typeof e(M).damageBonus=="number"&&e(M).damageBonus>0?"+":""}${e(M).damageBonus??""}`)),o(yt,Tt)};m(va,yt=>{e(M).damageBonus&&yt(Qt)})}var ta=a(va,2);{var Xt=yt=>{var Tt=Bo(),jt=ke(Tt),It=l(jt);s(jt),sa(),D(()=>k(It,`AC Bonus: ${e(M).acBonus>0?"+":""}${e(M).acBonus??""}`)),o(yt,Tt)};m(ta,yt=>{e(M).acBonus&&yt(Xt)})}var Et=a(ta,2);{var oa=yt=>{var Tt=Mo(),jt=ke(Tt),It=l(jt);s(jt),sa(),D(()=>k(It,`Darkvision: ${e(M).darkvision??""} feet`)),o(yt,Tt)};m(Et,yt=>{e(M).darkvision&&yt(oa)})}var fa=a(Et,2);{var ga=yt=>{var Tt=To(),jt=ke(Tt),It=l(jt);s(jt),sa(),D(_t=>k(It,`Resistances: ${_t??""}`),[()=>e(M).resistances.join(", ")]),o(yt,Tt)};m(fa,yt=>{e(M).resistances&&e(M).resistances.length>0&&yt(ga)})}var Wt=a(fa,2);{var na=yt=>{var Tt=Fo(),jt=ke(Tt),It=l(jt);s(jt),sa(),D(_t=>k(It,`Immunities: ${_t??""}`),[()=>e(M).immunities.join(", ")]),o(yt,Tt)};m(Wt,yt=>{e(M).immunities&&e(M).immunities.length>0&&yt(na)})}var Zt=a(Wt,2);{var pa=yt=>{var Tt=Ho(),jt=a(l(Tt),3);Ct(jt,1,()=>e(M).abilities,Bt,(It,_t)=>{var aa=Eo(),ka=l(aa),ls=l(ka);s(ka);var qa=a(ka),is=a(qa);{var _a=wa=>{var Fa=Po(),Wa=a(ke(Fa)),za=l(Wa),Pa=a(za);{var rs=ns=>{var Vs=Pt(", requires reaction");o(ns,Vs)};m(Pa,ns=>{e(_t).requiresReaction&&ns(rs)})}sa(),s(Wa),D(()=>k(za,`(${(e(_t).currentUses||0)??""}/${e(_t).usesPerRest??""} uses per ${e(_t).restType??""}
                                rest`)),o(wa,Fa)},Aa=wa=>{var Fa=kt(),Wa=ke(Fa);{var za=Pa=>{var rs=Io();sa(),o(Pa,rs)};m(Wa,Pa=>{e(_t).requiresReaction&&Pa(za)},!0)}o(wa,Fa)};m(is,wa=>{e(_t).usesPerRest?wa(_a):wa(Aa,!1)})}s(aa),D(()=>{k(ls,`${e(_t).name??""}:`),k(qa,` ${e(_t).description??""} `)}),o(It,aa)}),s(Tt),o(yt,Tt)};m(Zt,yt=>{e(M).abilities&&e(M).abilities.length>0&&yt(pa)})}s(Ve),D(()=>{k(Ot,e(M).name),k(zt,` ${e(M).description??""}`)}),o(ht,Ve)};m(Ne,ht=>{e(x)===dt&&ht(Dt)})}var bt=a(Ne,2);{var Ft=ht=>{var Ve=No();D(()=>ot(Ve,"title",`End ${e(M).name??""}`)),R("click",Ve,()=>{be.update($t=>{if($t.activeStates){const Ot=$t.activeStates[dt];Ot?.hpBonus&&Ot.target!=="other"&&($t.maxHP-=Ot.hpBonus,$t.currentHP=Math.max(1,Math.min($t.currentHP-Ot.hpBonus,$t.maxHP))),$t.activeStates=$t.activeStates.filter((zt,ra)=>ra!==dt)}return $t})}),o(ht,Ve)};m(bt,ht=>{v()||ht(Ft)})}s(gt),D(()=>{ot(gt,"aria-label",e(M).name),k(ut,`‚ú® ${e(M).name??""} `)}),R("mouseenter",gt,()=>O(dt)),R("mouseleave",gt,G),R("focus",gt,()=>O(dt)),R("blur",gt,G),R("click",gt,()=>ue(dt)),o(st,gt)}),s(Ce),sa(2),o(L,We)};m(w,L=>{t().activeStates&&t().activeStates.length>0&&L(le)})}s(K);var V=a(K,2),Pe=l(V),Se=l(Pe),lt=a(Se,2),xe=l(lt),te=a(xe,2);{var u=L=>{var We=qo(),Ce=l(We),st=a(Ce,2);s(We),R("click",Ce,ze),R("click",st,Re),o(L,We)};m(te,L=>{e(A)&&L(u)})}s(lt);var it=a(lt,2),Ge=a(it,2),W=l(Ge);let Le;var Ye=l(W),mt=l(Ye,!0);s(Ye);var rt=a(Ye),ye=l(rt,!0);s(rt),s(W);var je=a(W,2),He=l(je),vt=l(He,!0);s(He);var X=a(He,2),Ke=l(X,!0);s(X),s(je),s(Ge),s(Pe);var ct=a(Pe,2),b=l(ct);we(b),s(ct),s(V),s(z);var H=a(z,2),de=l(H),oe=a(de,2),ie=a(oe,2),Te=a(ie,2),tt=a(Te,2),qe=a(tt,2);Na(qe,L=>n(B,L),()=>e(B)),s(H),s(j);var re=a(j,2),Y=l(re);Hl(Y,{});var Xe=a(Y,2);Gl(Xe,{$$events:{roll:L=>De(L.detail)}});var me=a(Xe,2);vi(me,{$$events:{roll:L=>De(L.detail)}});var ae=a(me,2);ri(ae,{$$events:{rollHitDice:h,rollInitiative:I}});var ge=a(ae,2);So(ge,{});var Ze=a(ge,2);xr(Ze,{$$events:{roll:L=>De(L.detail)}});var wt=a(Ze,2);Yr(wt,{$$events:{roll:L=>De(L.detail)}});var nt=a(wt,2);Zr(nt,{});var ne=a(nt,2);rn(ne,{}),s(re),s(Q);var qt=a(Q,2);Na(Cn(qt,{get notation(){return e(T)},get damageNotation(){return e(ee)},get attackName(){return e(fe)},get applyHalfDamage(){return e(Oe)},get bonusBreakdown(){return e($e)},get damageBreakdown(){return e(ce)},get rollType(){return e(se)},get visible(){return e(P)},$$events:{close:ve},$$legacy:!0}),L=>n(he,L),()=>e(he));var Ie=a(qt,2);{var St=L=>{zn(L,{get mode(){return e(E)},$$events:{close:()=>n(q,!1)}})};m(Ie,L=>{e(q)&&L(St)})}var la=a(Ie,2);{var ia=L=>{oo(L,{onClose:()=>n(U,!1)})};m(la,L=>{e(U)&&L(ia)})}var Nt=a(la,2);bo(Nt,{get show(){return e(Z)},onSave:_e,onCancel:Ae});var At=a(Nt,2);_l(At,{}),D(()=>{Le=Ut(W,1,"btn btn-mode svelte-1uha8ag",null,Le,{"use-mode":!v()}),k(mt,v()?"üìù":"üé≤"),k(ye,v()?"Edit Mode":"Use Mode"),k(vt,e($)?"‚òÄÔ∏è":"üåô"),k(Ke,e($)?"Light Mode":"Dark Mode")}),R("click",Se,()=>{n($e,[]),n(P,!0)}),R("click",xe,()=>n(A,!e(A))),R("click",it,()=>n(Z,!0)),R("click",W,et),R("click",je,y),Je(b,f,L=>$l(ya,L)),R("click",de,()=>n(U,!0)),R("click",oe,()=>{n(E,"save"),n(q,!0)}),R("click",ie,()=>{n(E,"load"),n(q,!0)}),R("click",Te,pt),R("click",tt,Lt),R("change",qe,Mt),o(i,C),Yt(),g()}export{ec as component};
