import{f as u,e as A,a as c,s as C,c as nt,t as jt}from"../chunks/DBs_ODQp.js";import{i as Mt}from"../chunks/BbaRvQ4Z.js";import{c as Zt,o as na,a as Va}from"../chunks/CHX4V4AM.js";import{a7 as Ta,i as Ha,aZ as Qa,a_ as Xa,a$ as wa,K as Vt,e as Ua,b0 as Na,T as ma,b1 as Ya,b2 as Za,b3 as es,q as ts,b4 as as,b5 as ss,ab as ls,d as i,r as Ga,g as rs,C as It,F as P,G as Rt,H as r,I as l,J as s,b6 as ze,b7 as Wt,s as v,a4 as M,f as e,m as et,E as Ge,A as U,b8 as fa,b9 as Dt,ba as ra,ao as pa,bb as is}from"../chunks/DwmZeGF1.js";import{c as At,a as V,e as ut,i as pt,u as Oa,s as Qt,b as ft,d as oa,f as ta,g as ns,t as Et,h as os,T as cs,j as vs,k as ds}from"../chunks/DQJFtNtV.js";import{i as k,s as Ut,a as Ke,b as vt,d as ca,e as us}from"../chunks/0ovU14Ao.js";import{p as mt,b as Sa}from"../chunks/CFUzmRYW.js";import{b as la,r as ps}from"../chunks/DO38Wrfm.js";function ga(a,n,t=!1){if(a.multiple){if(n==null)return;if(!Ha(n))return Qa();for(var d of a.options)d.selected=n.includes(ia(d));return}for(d of a.options){var p=ia(d);if(Xa(p,n)){d.selected=!0;return}}(!t||n!==void 0)&&(a.selectedIndex=-1)}function xa(a){var n=new MutationObserver(()=>{ga(a,a.__value)});n.observe(a,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Ta(()=>{n.disconnect()})}function qa(a,n,t=n){var d=new WeakSet,p=!0;wa(a,"change",h=>{var S=h?"[selected]":":checked",F;if(a.multiple)F=[].map.call(a.querySelectorAll(S),ia);else{var _=a.querySelector(S)??a.querySelector("option:not([disabled])");F=_&&ia(_)}t(F),Vt!==null&&d.add(Vt)}),Ua(()=>{var h=n();if(a===document.activeElement){var S=Na??Vt;if(d.has(S))return}if(ga(a,h,p),p&&h===void 0){var F=a.querySelector(":checked");F!==null&&(h=ia(F),t(h))}a.__value=h,p=!1}),xa(a)}function ia(a){return"__value"in a?a.__value:a.value}const fs=Symbol("is custom element"),gs=Symbol("is html");function Ce(a){if(ma){var n=!1,t=()=>{if(!n){if(n=!0,a.hasAttribute("value")){var d=a.value;ot(a,"value",null),a.value=d}if(a.hasAttribute("checked")){var p=a.checked;ot(a,"checked",null),a.checked=p}}};a.__on_r=t,ts(t),as()}}function ba(a,n){var t=Da(a);t.value===(t.value=n??void 0)||a.value===n&&(n!==0||a.nodeName!=="PROGRESS")||(a.value=n??"")}function Wa(a,n){var t=Da(a);t.checked!==(t.checked=n??void 0)&&(a.checked=n)}function ot(a,n,t,d){var p=Da(a);ma&&(p[n]=a.getAttribute(n),n==="src"||n==="srcset"||n==="href"&&a.nodeName==="LINK")||p[n]!==(p[n]=t)&&(n==="loading"&&(a[Ya]=t),t==null?a.removeAttribute(n):typeof t!="string"&&bs(a).includes(n)?a[n]=t:a.setAttribute(n,t))}function Da(a){return a.__attributes??={[fs]:a.nodeName.includes("-"),[gs]:a.namespaceURI===Za}}var Aa=new Map;function bs(a){var n=a.getAttribute("is")||a.nodeName,t=Aa.get(n);if(t)return t;Aa.set(n,t=[]);for(var d,p=a,h=Element.prototype;h!==p;){d=ss(p);for(var S in d)d[S].set&&t.push(S);p=es(p)}return t}function Be(a,n,t=n){var d=new WeakSet;wa(a,"input",async p=>{var h=p?a.defaultValue:a.value;if(h=_a(a)?ya(h):h,t(h),Vt!==null&&d.add(Vt),await ls(),h!==(h=n())){var S=a.selectionStart,F=a.selectionEnd,_=a.value.length;if(a.value=h??"",F!==null){var R=a.value.length;S===F&&F===_&&R>_?(a.selectionStart=R,a.selectionEnd=R):(a.selectionStart=S,a.selectionEnd=Math.min(F,R))}}}),(ma&&a.defaultValue!==a.value||i(n)==null&&a.value)&&(t(_a(a)?ya(a.value):a.value),Vt!==null&&d.add(Vt)),Ga(()=>{var p=n();if(a===document.activeElement){var h=Na??Vt;if(d.has(h))return}_a(a)&&p===ya(a.value)||a.type==="date"&&!p&&!a.value||p!==a.value&&(a.value=p??"")})}function $a(a,n,t=n){wa(a,"change",d=>{var p=d?a.defaultChecked:a.checked;t(p)}),(ma&&a.defaultChecked!==a.checked||i(n)==null)&&t(a.checked),Ga(()=>{var d=n();a.checked=!!d})}function _a(a){var n=a.type;return n==="number"||n==="range"}function ya(a){return a===""?null:+a}function ms(a,n,t){var d=rs(a,n);d&&d.set&&(a[n]=t,Ta(()=>{a[n]=null}))}function ja(a){return function(...n){var t=n[0];return t.stopPropagation(),a?.apply(this,n)}}function aa(a,n){var t=a.$$events?.[n.type],d=Ha(t)?t.slice():t==null?[]:[t];for(var p of d)p.call(this,n)}const hs="";function za(...a){return la+hs+ps(a[0],a[1])}const Ca={paladin:{name:"Paladin",hitDice:"d10",spellcaster:!0,spellcastingAbility:"charisma",spellSlotsByLevel:{1:0,2:2,3:3,4:3,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Divine Sense",type:"uses",maxUses:(a,n=1)=>1+Math.max(1,n),resetOn:"long",description:"Detect celestials, fiends, and undead within 60 feet",minLevel:1},{name:"Lay on Hands",type:"pool",maxPool:a=>a*5,resetOn:"long",description:"Heal wounds or cure disease",minLevel:1},{name:"Divine Smite",type:"spellSlot",description:"Expend spell slot to deal extra radiant damage",minLevel:2,rollable:!0},{name:"Channel Divinity",type:"pool",maxPool:a=>a>=18?3:a>=6?2:1,resetOn:"short",description:"Sacred Weapon or Turn Undead",minLevel:3}]},fighter:{name:"Fighter",hitDice:"d10",spellcaster:!1,features:[{name:"Second Wind",type:"uses",maxUses:1,resetOn:"short",description:"Regain 1d10 + fighter level HP as bonus action",minLevel:1,rollable:!0,rollFormula:a=>`1d10+${a}`},{name:"Action Surge",type:"uses",maxUses:a=>a>=17?2:1,resetOn:"short",description:"Take one additional action on your turn",minLevel:2},{name:"Indomitable",type:"uses",maxUses:a=>a>=17?3:a>=13?2:1,resetOn:"long",description:"Reroll a failed saving throw",minLevel:9}],subclasses:{champion:{name:"Champion",features:[{name:"Improved Critical",type:"info",description:"Critical hit on 19-20",minLevel:3},{name:"Remarkable Athlete",type:"info",description:"Add half proficiency to STR/DEX/CON checks, increase long jump distance",minLevel:7},{name:"Additional Fighting Style",type:"info",description:"Choose a second fighting style",minLevel:10},{name:"Superior Critical",type:"info",description:"Critical hit on 18-20",minLevel:15},{name:"Survivor",type:"info",description:"Regain 5 + CON mod HP at start of turn if below half HP",minLevel:18}]},battlemaster:{name:"Battle Master",features:[{name:"Combat Superiority",type:"uses",maxUses:a=>a>=15?6:a>=7?5:4,resetOn:"short",description:a=>`Use superiority dice (${a>=18?"d12":a>=10?"d10":"d8"}) for maneuvers`,minLevel:3},{name:"Know Your Enemy",type:"info",description:"Learn capabilities of creatures you observe",minLevel:7},{name:"Improved Combat Superiority",type:"info",description:"Superiority dice become d10",minLevel:10},{name:"Relentless",type:"info",description:"Regain 1 superiority die if you have none at start of turn",minLevel:15}]}}},rogue:{name:"Rogue",hitDice:"d8",spellcaster:!1,features:[{name:"Sneak Attack",type:"info",description:a=>`Deal ${Math.ceil(a/2)}d6 extra damage once per turn with advantage or ally nearby`,minLevel:1,rollable:!0,rollFormula:a=>`${Math.ceil(a/2)}d6`},{name:"Cunning Action",type:"info",description:"Dash, Disengage, or Hide as a bonus action",minLevel:2},{name:"Uncanny Dodge",type:"info",description:"Use reaction to halve damage from an attack",minLevel:5},{name:"Evasion",type:"info",description:"Take no damage on successful Dex save (half on fail)",minLevel:7}]},wizard:{name:"Wizard",hitDice:"d6",spellcaster:!0,spellcastingAbility:"intelligence",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Arcane Recovery",type:"uses",maxUses:1,resetOn:"long",description:a=>`Recover spell slots totaling up to ${Math.ceil(a/2)} levels during short rest`,minLevel:1},{name:"Spell Mastery",type:"info",description:"Cast one 1st-level and one 2nd-level spell at will",minLevel:18}]},cleric:{name:"Cleric",hitDice:"d8",spellcaster:!0,spellcastingAbility:"wisdom",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Channel Divinity",type:"pool",maxPool:a=>a>=18?3:a>=6?2:1,resetOn:"short",description:"Turn Undead or domain-specific ability",minLevel:2},{name:"Destroy Undead",type:"info",description:a=>`Channel Divinity destroys undead of CR ${a>=17?4:a>=14?3:a>=11?2:a>=8?1:.5} or lower`,minLevel:5},{name:"Divine Intervention",type:"uses",maxUses:1,resetOn:"long",description:a=>`${a}% chance to succeed, implore deity for aid`,minLevel:10}],subclasses:{war:{name:"War Domain",features:[{name:"War Priest",type:"uses",maxUses:(a,n=1)=>Math.max(1,n),resetOn:"long",description:"Make one weapon attack as a bonus action",minLevel:1},{name:"Guided Strike",type:"channelDivinity",description:"Use your Channel Divinity to gain +10 to an attack roll. Make this choice after you see the roll, but before the DM says whether the attack hits or misses.",minLevel:2,resetOn:"short"},{name:"War God's Blessing",type:"channelDivinity",description:"Use reaction to grant +10 to an ally's attack roll within 30 feet. Consumes one use of Channel Divinity.",minLevel:6,resetOn:"short"},{name:"Divine Strike",type:"info",description:a=>`Deal extra ${a>=14?"2d8":"1d8"} weapon damage once per turn`,minLevel:8,rollable:!0,rollFormula:a=>a>=14?"2d8":"1d8"},{name:"Avatar of Battle",type:"info",description:"Gain resistance to nonmagical weapon damage",minLevel:17}]},life:{name:"Life Domain",features:[{name:"Disciple of Life",type:"info",description:"Healing spells restore additional 2 + spell level HP",minLevel:1},{name:"Preserve Life",type:"pool",maxPool:a=>a*5,resetOn:"short",description:"Restore HP to creatures within 30 feet",minLevel:2},{name:"Blessed Healer",type:"info",description:"Regain 2 + spell level HP when you cast healing spell",minLevel:6},{name:"Divine Strike",type:"info",description:a=>`Deal extra ${a>=14?"2d8":"1d8"} radiant damage once per turn`,minLevel:8,rollable:!0,rollFormula:a=>a>=14?"2d8":"1d8"},{name:"Supreme Healing",type:"info",description:"Maximize healing dice instead of rolling",minLevel:17}]}}},barbarian:{name:"Barbarian",hitDice:"d12",spellcaster:!1,features:[{name:"Rage",type:"uses",maxUses:a=>a>=20?1/0:a>=17?6:a>=12?5:a>=6?4:a>=3?3:2,resetOn:"long",description:a=>`+${a>=16?4:a>=9?3:2} damage, resistance to physical damage`,minLevel:1},{name:"Reckless Attack",type:"info",description:"Gain advantage on melee attacks, enemies get advantage on you",minLevel:2},{name:"Danger Sense",type:"info",description:"Advantage on Dex saves against effects you can see",minLevel:2}],subclasses:{berserker:{name:"Path of the Berserker",features:[{name:"Frenzy",type:"info",description:"While raging, make melee attack as bonus action (gain 1 exhaustion after rage)",minLevel:3},{name:"Mindless Rage",type:"info",description:"Cannot be charmed or frightened while raging",minLevel:6},{name:"Intimidating Presence",type:"info",description:"Use action to frighten creature within 30 feet",minLevel:10},{name:"Retaliation",type:"info",description:"When damaged by creature within 5 feet, make melee attack as reaction",minLevel:14}]}}}};function Pt(a){const n=a.toLowerCase();return Ca[n]||null}function sa(a,n,t){const d=Pt(a);if(!d)return[];const p=d.features.filter(h=>!h.minLevel||h.minLevel<=n);if(t&&d.subclasses&&d.subclasses[t]){const h=d.subclasses[t].features.filter(S=>!S.minLevel||S.minLevel<=n);return[...p,...h]}return p}function Fa(a){const n=Pt(a);return!n||!n.subclasses?[]:Object.keys(n.subclasses).map(t=>({id:t,name:n.subclasses[t].name}))}function Ba(a,n){const t=Pt(a);return!t||!t.spellcaster||!t.spellSlotsByLevel?0:t.spellSlotsByLevel[n]||0}function Ma(a,n,t){const d=Pt(a);return!d||!d.spellcaster?0:Math.max(1,t+n)}function _s(a,n,t){const d=Pt(a);return!d||!d.spellcaster?null:8+n+t}function ys(){return Object.keys(Ca).map(a=>({id:a,name:Ca[a].name}))}var ks=u('<div class="section-header svelte-ls99y2" role="button" tabindex="0"><h2 class="svelte-ls99y2"> </h2> <span class="collapse-btn svelte-ls99y2"> </span></div>');function ea(a,n){It(n,!1);let t=mt(n,"title",8),d=mt(n,"collapsed",8),p=mt(n,"ariaLabel",8,""),h=mt(n,"onToggle",8);Mt();var S=ks(),F=r(S),_=r(F,!0);l(F);var R=s(F,2),Q=r(R,!0);l(R),l(S),P(()=>{ot(S,"aria-expanded",!d()),ot(S,"aria-label",p()),C(_,t()),C(Q,d()?"â–¼":"â–²")}),A("click",S,function(...q){h()?.apply(this,q)}),A("keydown",S,q=>{(q.key==="Enter"||q.key===" ")&&h()()}),c(a,S),Rt()}var Ss=u("<option> </option>"),xs=u("<option> </option>"),$s=u('<div class="form-group svelte-172i2fj"><label for="characterSubclass" class="svelte-172i2fj">Subclass</label> <select id="characterSubclass" class="svelte-172i2fj"><option>Select Subclass</option><!></select></div>'),Cs=u('<div class="info-grid svelte-172i2fj"><div class="form-group svelte-172i2fj"><label for="characterName" class="svelte-172i2fj">Character Name</label> <input type="text" id="characterName" placeholder="Enter name" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterClass" class="svelte-172i2fj">Class</label> <select id="characterClass" class="svelte-172i2fj"><option>Select Class</option><!></select></div> <!> <div class="form-group svelte-172i2fj"><label for="characterLevel" class="svelte-172i2fj">Level</label> <input type="number" id="characterLevel" min="1" max="20" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterRace" class="svelte-172i2fj">Race</label> <input type="text" id="characterRace" placeholder="e.g., Human" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterBackground" class="svelte-172i2fj">Background</label> <input type="text" id="characterBackground" placeholder="e.g., Soldier" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterAlignment" class="svelte-172i2fj">Alignment</label> <input type="text" id="characterAlignment" placeholder="e.g., Lawful Good" class="svelte-172i2fj"/></div></div>'),Ls=u('<section class="character-info svelte-172i2fj"><!> <!></section>');function ws(a,n){It(n,!1);const t=()=>Ke(V,"$character",p),d=()=>Ke(At,"$collapsedStates",p),[p,h]=Ut(),S=M(),F=ys();function _(Y){const ve=Y.target;V.update(J=>(J.class=ve.value,J.subclass="",J))}function R(Y){const ve=Y.target;V.update(J=>(J.subclass=ve.value,J))}function Q(Y){const ve=Y.target;V.update(J=>(J.level=parseInt(ve.value)||1,J)),Oa()}ze(()=>(t(),Fa),()=>{v(S,t().class?Fa(t().class):[])}),Wt(),Mt();var q=Ls(),H=r(q);{let Y=et(()=>(d(),i(()=>d().characterInfo?"Expand":"Collapse")));ea(H,{title:"Character Info",get collapsed(){return d(),i(()=>d().characterInfo)},get ariaLabel(){return e(Y)},onToggle:()=>At.update(ve=>({...ve,characterInfo:!ve.characterInfo}))})}var be=s(H,2);{var pe=Y=>{var ve=Cs(),J=r(ve),Te=s(r(J),2);Ce(Te),l(J);var z=s(J,2),se=s(r(z),2),X=r(se);X.value=X.__value="";var te=s(X);ut(te,1,()=>F,pt,(x,O)=>{var I=Ss(),G=r(I,!0);l(I);var De={};P(()=>{C(G,(e(O),i(()=>e(O).name))),De!==(De=(e(O),i(()=>e(O).id)))&&(I.value=(I.__value=(e(O),i(()=>e(O).id)))??"")}),c(x,I)}),l(se);var ie;xa(se),l(z);var Me=s(z,2);{var Ee=x=>{var O=$s(),I=s(r(O),2),G=r(I);G.value=G.__value="";var De=s(G);ut(De,1,()=>e(S),pt,(_e,He)=>{var je=xs(),rt=r(je,!0);l(je);var Xe={};P(()=>{C(rt,(e(He),i(()=>e(He).name))),Xe!==(Xe=(e(He),i(()=>e(He).id)))&&(je.value=(je.__value=(e(He),i(()=>e(He).id)))??"")}),c(_e,je)}),l(I);var xe;xa(I),l(O),P(()=>{xe!==(xe=(t(),i(()=>t().subclass)))&&(I.value=(I.__value=(t(),i(()=>t().subclass)))??"",ga(I,(t(),i(()=>t().subclass))))}),A("change",I,R),c(x,O)};k(Me,x=>{e(S),i(()=>e(S).length>0)&&x(Ee)})}var me=s(Me,2),he=s(r(me),2);Ce(he),l(me);var $=s(me,2),oe=s(r($),2);Ce(oe),l($);var m=s($,2),E=s(r(m),2);Ce(E),l(m);var le=s(m,2),g=s(r(le),2);Ce(g),l(le),l(ve),P(()=>{ie!==(ie=(t(),i(()=>t().class)))&&(se.value=(se.__value=(t(),i(()=>t().class)))??"",ga(se,(t(),i(()=>t().class)))),ba(he,(t(),i(()=>t().level)))}),Be(Te,()=>t().name,x=>vt(V,i(t).name=x,i(t))),A("change",se,_),A("change",he,Q),Be(oe,()=>t().race,x=>vt(V,i(t).race=x,i(t))),Be(E,()=>t().background,x=>vt(V,i(t).background=x,i(t))),Be(g,()=>t().alignment,x=>vt(V,i(t).alignment=x,i(t))),c(Y,ve)};k(be,Y=>{d(),i(()=>!d().characterInfo)&&Y(pe)})}l(q),c(a,q),Rt(),h()}var Ds=u('<div class="ability-card svelte-bbv1xt"><h3 class="svelte-bbv1xt"> </h3> <input type="number" class="ability-score svelte-bbv1xt" min="1" max="30"/> <div class="ability-modifier svelte-bbv1xt"> </div> <button class="roll-btn svelte-bbv1xt">Check</button> <div class="save-row svelte-bbv1xt"><input type="checkbox" class="svelte-bbv1xt"/> <label class="svelte-bbv1xt">Save</label> <button class="roll-btn-small svelte-bbv1xt">Roll</button></div></div>'),js=u('<div class="proficiency-bonus svelte-bbv1xt"><label for="profBonus">Proficiency Bonus</label> <input type="number" id="profBonus" class="prof-input svelte-bbv1xt"/></div> <div class="abilities-grid svelte-bbv1xt"></div>',1),As=u("<section><!> <!></section>");function Fs(a,n){It(n,!1);const t=()=>Ke(oa,"$abilityModifiers",S),d=()=>Ke(V,"$character",S),p=()=>Ke(Qt,"$searchFilter",S),h=()=>Ke(At,"$collapsedStates",S),[S,F]=Ut(),_=M(),R=M(),Q=Zt(),q=[{key:"strength",label:"Strength"},{key:"dexterity",label:"Dexterity"},{key:"constitution",label:"Constitution"},{key:"intelligence",label:"Intelligence"},{key:"wisdom",label:"Wisdom"},{key:"charisma",label:"Charisma"}];function H(){Oa()}function be(se){const X=t()[se],te=`1d20${X>=0?"+":""}${X}`;Q("roll",te)}function pe(se){const X=t()[se],te=d().saveProficiencies[se]?d().proficiencyBonus:0,ie=X+te,Me=`1d20${ie>=0?"+":""}${ie}`;Q("roll",Me)}ze(()=>p(),()=>{v(_,q.filter(({label:se})=>p()?se.toLowerCase().includes(p().toLowerCase()):!0))}),ze(()=>(e(_),p()),()=>{v(R,e(_).length>0||!p()||p().toLowerCase().includes("proficiency"))}),Wt(),Mt();var Y=As();let ve;var J=r(Y);ea(J,{title:"Ability Scores",get collapsed(){return h(),i(()=>h().abilityScores)},ariaLabel:"Toggle Ability Scores Section",onToggle:()=>At.update(se=>({...se,abilityScores:!se.abilityScores}))});var Te=s(J,2);{var z=se=>{var X=js(),te=Ge(X),ie=s(r(te),2);Ce(ie),l(te);var Me=s(te,2);ut(Me,5,()=>e(_),pt,(Ee,me)=>{let he=()=>e(me).key,$=()=>e(me).label;var oe=Ds(),m=r(oe),E=r(m,!0);l(m);var le=s(m,2);Ce(le);var g=s(le,2),x=r(g);l(g);var O=s(g,2),I=s(O,2),G=r(I);Ce(G);var De=s(G,2),xe=s(De,2);l(I),l(oe),P(_e=>{C(E,_e),C(x,`${t(),he(),i(()=>t()[he()]>=0?"+":"")??""}${t(),he(),i(()=>t()[he()])??""}`),ot(G,"id",`${he()}-save`),ot(De,"for",`${he()}-save`)},[()=>($(),i(()=>$().substring(0,3).toUpperCase()))]),Be(le,()=>d().abilities[he()],_e=>vt(V,i(d).abilities[he()]=_e,i(d))),A("change",le,H),A("click",O,()=>be(he())),$a(G,()=>d().saveProficiencies[he()],_e=>vt(V,i(d).saveProficiencies[he()]=_e,i(d))),A("click",xe,()=>pe(he())),c(Ee,oe)}),l(Me),Be(ie,()=>d().proficiencyBonus,Ee=>vt(V,i(d).proficiencyBonus=Ee,i(d))),c(se,X)};k(Te,se=>{h(),i(()=>!h().abilityScores)&&se(z)})}l(Y),P(()=>ve=ft(Y,1,"ability-scores svelte-bbv1xt",null,ve,{hidden:!e(R)})),c(a,Y),Rt(),F()}function Bs(a){return Math.floor((a-10)/2)}function La(a,n){if(!a.class)return null;const t=Pt(a.class);if(!t||!t.spellcaster||!t.spellcastingAbility)return null;const d=n[t.spellcastingAbility];return 8+a.proficiencyBonus+d}function Ms(a,n){if(!a.class)return 0;const t=Pt(a.class);return!t||!t.spellcaster||!t.spellcastingAbility?0:Bs(n[t.spellcastingAbility])}var Is=u('<input type="number" id="armorClass" class="stat-input svelte-1r5hyyb"/>'),Rs=u('<input type="text" id="armorClass" readonly=""/>'),Es=u('<div class="stat-box svelte-1r5hyyb"><label for="spellSaveDC" class="svelte-1r5hyyb">Spell Save DC</label> <input type="number" id="spellSaveDC" class="stat-input svelte-1r5hyyb" readonly="" title="8 + Proficiency Bonus + Spellcasting Ability Modifier"/></div>'),Ps=u('<span class="hit-dice-type"> </span>'),Ts=u('<div class="stats-grid svelte-1r5hyyb"><div class="stat-box svelte-1r5hyyb"><label for="armorClass" class="svelte-1r5hyyb">Armor Class</label> <!></div> <div class="stat-box svelte-1r5hyyb"><label for="initiative" class="svelte-1r5hyyb">Initiative</label> <input type="number" id="initiative" class="stat-input svelte-1r5hyyb"/></div> <div class="stat-box svelte-1r5hyyb"><label for="speed" class="svelte-1r5hyyb">Speed</label> <input type="text" id="speed" class="stat-input svelte-1r5hyyb"/></div> <!></div> <div class="hp-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Points</h3> <div class="hp-display svelte-1r5hyyb"><div class="hp-inputs svelte-1r5hyyb"><input type="number" class="hp-current svelte-1r5hyyb" min="0"/> <span class="hp-separator svelte-1r5hyyb">/</span> <input type="number" class="hp-max svelte-1r5hyyb" min="0"/></div> <div class="hp-controls svelte-1r5hyyb"><button class="hp-btn svelte-1r5hyyb">âˆ’</button> <button class="hp-btn svelte-1r5hyyb">+</button> <button class="hp-btn svelte-1r5hyyb">âˆ’5</button> <button class="hp-btn svelte-1r5hyyb">+5</button></div></div> <div class="temp-hp svelte-1r5hyyb"><label for="tempHP" class="svelte-1r5hyyb">Temp HP</label> <input type="number" id="tempHP" min="0" class="svelte-1r5hyyb"/></div></div> <div class="hit-dice-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Dice</h3> <div class="hit-dice-display svelte-1r5hyyb"><input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <span>/</span> <input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <!></div> <div class="hit-dice-controls"><label for="hitDiceCount" class="svelte-1r5hyyb">Roll</label> <input type="number" id="hitDiceCount" class="hit-dice-count-input svelte-1r5hyyb" min="1" value="1"/> <button class="btn btn-primary roll-hit-dice use-enabled svelte-1r5hyyb">ðŸŽ² Roll</button></div></div>',1),Hs=u("<section><!> <!></section>");function Us(a,n){It(n,!1);const t=()=>Ke(V,"$character",F),d=()=>Ke(oa,"$abilityModifiers",F),p=()=>Ke(Qt,"$searchFilter",F),h=()=>Ke(At,"$collapsedStates",F),S=()=>Ke(ta,"$isEditMode",F),[F,_]=Ut(),R=M(),Q=M(),q=M(),H=Zt();function be(se){V.update(X=>(X.currentHP=Math.max(0,Math.min(X.maxHP,X.currentHP+se)),X))}function pe(se=1){if(t().hitDice.current<=0){alert("No hit dice remaining!");return}if(!t().class){alert("Please select a class first!");return}const X=Pt(t().class);if(!X){alert("Invalid class configuration!");return}const te=Math.min(se,t().hitDice.current),ie=X.hitDice,Me=d().constitution,Ee=Me>=0?`+${Me}`:`${Me}`,me=`${te}${ie}${Ee}`;H("rollHitDice",{notation:me,hitDie:ie,count:te})}ze(()=>(t(),d()),()=>{v(R,La(t(),d()))}),ze(()=>t(),()=>{v(Q,t().activeStates&&t().activeStates.length>0?t().activeStates.reduce((se,X)=>se+(X.acBonus||0),0):0)}),ze(()=>p(),()=>{v(q,!p()||"armor class".includes(p().toLowerCase())||"initiative".includes(p().toLowerCase())||"speed".includes(p().toLowerCase())||"hit points".includes(p().toLowerCase())||"hp".includes(p().toLowerCase())||"hit dice".includes(p().toLowerCase())||"spell save".includes(p().toLowerCase())||"combat".includes(p().toLowerCase()))}),Wt(),Mt();var Y=Hs();let ve;var J=r(Y);{let se=et(()=>(h(),i(()=>h().combatStats?"Expand":"Collapse")));ea(J,{title:"Combat Stats",get collapsed(){return h(),i(()=>h().combatStats)},get ariaLabel(){return e(se)},onToggle:()=>At.update(X=>({...X,combatStats:!X.combatStats}))})}var Te=s(J,2);{var z=se=>{var X=Ts(),te=Ge(X),ie=r(te),Me=s(r(ie),2);{var Ee=T=>{var b=Is();Ce(b),Be(b,()=>t().armorClass,ne=>vt(V,i(t).armorClass=ne,i(t))),c(T,b)},me=T=>{var b=Rs();Ce(b),P(()=>{ba(b,(e(Q),t(),i(()=>e(Q)!==0?`${t().armorClass} â†’ ${t().armorClass+e(Q)}`:`${t().armorClass}`))),ft(b,1,ns(e(Q)!==0?"stat-input ac-enhanced":"stat-input"),"svelte-1r5hyyb"),ot(b,"title",e(Q)!==0?"Base AC plus active effect bonuses":"Base Armor Class")}),c(T,b)};k(Me,T=>{S()?T(Ee):T(me,!1)})}l(ie);var he=s(ie,2),$=s(r(he),2);Ce($),l(he);var oe=s(he,2),m=s(r(oe),2);Ce(m),l(oe);var E=s(oe,2);{var le=T=>{var b=Es(),ne=s(r(b),2);Ce(ne),l(b),P(()=>ba(ne,e(R))),c(T,b)};k(E,T=>{e(R)!==null&&T(le)})}l(te);var g=s(te,2),x=s(r(g),2),O=r(x),I=r(O);Ce(I);var G=s(I,4);Ce(G),l(O);var De=s(O,2),xe=r(De),_e=s(xe,2),He=s(_e,2),je=s(He,2);l(De),l(x);var rt=s(x,2),Xe=s(r(rt),2);Ce(Xe),l(rt),l(g);var ct=s(g,2),N=s(r(ct),2),o=r(N);Ce(o);var Z=s(o,4);Ce(Z);var W=s(Z,2);{var fe=T=>{const b=et(()=>(U(Pt),t(),i(()=>Pt(t().class))));var ne=nt(),we=Ge(ne);{var Oe=qe=>{const ye=et(()=>(d(),i(()=>d().constitution)));var de=Ps(),Le=r(de);l(de),P(()=>C(Le,`(${U(e(b)),i(()=>e(b).hitDice)??""}${(e(ye)>=0?`+${e(ye)}`:e(ye))??""})`)),c(qe,de)};k(we,qe=>{e(b)&&qe(Oe)})}c(T,ne)};k(W,T=>{t(),i(()=>t().class)&&T(fe)})}l(N);var Ie=s(N,2),Pe=s(r(Ie),2),Re=s(Pe,2);l(Ie),l(ct),P(()=>{ot(I,"max",(t(),i(()=>t().maxHP))),ot(o,"max",(t(),i(()=>t().hitDice.max))),ot(Pe,"max",(t(),i(()=>t().hitDice.current))),Re.disabled=(t(),i(()=>t().hitDice.current<=0||!t().class))}),Be($,()=>t().initiative,T=>vt(V,i(t).initiative=T,i(t))),Be(m,()=>t().speed,T=>vt(V,i(t).speed=T,i(t))),Be(I,()=>t().currentHP,T=>vt(V,i(t).currentHP=T,i(t))),Be(G,()=>t().maxHP,T=>vt(V,i(t).maxHP=T,i(t))),A("click",xe,()=>be(-1)),A("click",_e,()=>be(1)),A("click",He,()=>be(-5)),A("click",je,()=>be(5)),Be(Xe,()=>t().tempHP,T=>vt(V,i(t).tempHP=T,i(t))),Be(o,()=>t().hitDice.current,T=>vt(V,i(t).hitDice.current=T,i(t))),Be(Z,()=>t().hitDice.max,T=>vt(V,i(t).hitDice.max=T,i(t))),A("input",Pe,T=>{const b=T.target,ne=parseInt(b.value);ne>t().hitDice.current&&(b.value=String(t().hitDice.current)),ne<1&&(b.value="1")}),A("click",Re,()=>{const T=document.getElementById("hitDiceCount"),b=parseInt(T?.value||"1");pe(b)}),c(se,X)};k(Te,se=>{h(),i(()=>!h().combatStats)&&se(z)})}l(Y),P(()=>ve=ft(Y,1,"combat-stats svelte-1r5hyyb",null,ve,{hidden:!e(q)})),c(a,Y),Rt(),_()}const ka={acrobatics:"dexterity",animalHandling:"wisdom",arcana:"intelligence",athletics:"strength",deception:"charisma",history:"intelligence",insight:"wisdom",intimidation:"charisma",investigation:"intelligence",medicine:"wisdom",nature:"intelligence",perception:"wisdom",performance:"charisma",persuasion:"charisma",religion:"intelligence",sleightOfHand:"dexterity",stealth:"dexterity",survival:"wisdom"};var Ns=u('<div class="skill-row svelte-1f1pl16"><input type="checkbox" class="svelte-1f1pl16"/> <label class="svelte-1f1pl16"> <span class="ability-tag svelte-1f1pl16"> </span></label> <span class="skill-modifier svelte-1f1pl16"> </span> <button class="roll-btn svelte-1f1pl16">Roll</button></div>'),Gs=u('<div class="skills-grid svelte-1f1pl16"></div>'),Os=u("<section><!> <!></section>");function qs(a,n){It(n,!1);const t=()=>Ke(V,"$character",S),d=()=>Ke(oa,"$abilityModifiers",S),p=()=>Ke(Qt,"$searchFilter",S),h=()=>Ke(At,"$collapsedStates",S),[S,F]=Ut(),_=M(),R=M(),Q=M(),q=M(),H=M(),be=M(),pe=Zt(),Y=[{key:"acrobatics",label:"Acrobatics"},{key:"animalHandling",label:"Animal Handling"},{key:"arcana",label:"Arcana"},{key:"athletics",label:"Athletics"},{key:"deception",label:"Deception"},{key:"history",label:"History"},{key:"insight",label:"Insight"},{key:"intimidation",label:"Intimidation"},{key:"investigation",label:"Investigation"},{key:"medicine",label:"Medicine"},{key:"nature",label:"Nature"},{key:"perception",label:"Perception"},{key:"performance",label:"Performance"},{key:"persuasion",label:"Persuasion"},{key:"religion",label:"Religion"},{key:"sleightOfHand",label:"Sleight of Hand"},{key:"stealth",label:"Stealth"},{key:"survival",label:"Survival"}];function ve(te){const ie=e(_)[te],Me=`1d20${ie>=0?"+":""}${ie}`;pe("roll",Me)}ze(()=>{},()=>{v(_,{})}),ze(()=>t(),()=>{v(R,t().skillProficiencies)}),ze(()=>t(),()=>{v(Q,t().proficiencyBonus)}),ze(()=>d(),()=>{v(q,d())}),ze(()=>(e(q),e(R),e(Q)),()=>{for(const{key:te}of Y){const ie=ka[te],Me=e(q)[ie],Ee=e(R)[te]?e(Q):0;fa(_,e(_)[te]=Me+Ee)}}),ze(()=>p(),()=>{v(H,Y.filter(({label:te})=>p()?te.toLowerCase().includes(p().toLowerCase()):!0))}),ze(()=>e(H),()=>{v(be,e(H).length>0)}),Wt(),Mt();var J=Os();let Te;var z=r(J);{let te=et(()=>(h(),i(()=>h().skills?"Expand":"Collapse")));ea(z,{title:"Skills",get collapsed(){return h(),i(()=>h().skills)},get ariaLabel(){return e(te)},onToggle:()=>At.update(ie=>({...ie,skills:!ie.skills}))})}var se=s(z,2);{var X=te=>{var ie=Gs();ut(ie,5,()=>e(H),pt,(Me,Ee)=>{let me=()=>e(Ee).key,he=()=>e(Ee).label;var $=Ns(),oe=r($);Ce(oe);var m=s(oe,2),E=r(m),le=s(E),g=r(le);l(le),l(m);var x=s(m,2),O=r(x);l(x);var I=s(x,2);l($),P(G=>{Wa(oe,(e(R),me(),i(()=>e(R)[me()]))),ot(oe,"id",me()),ot(m,"for",me()),C(E,`${he()??""} `),C(g,`(${G??""})`),C(O,`${e(_),me(),i(()=>e(_)[me()]>=0?"+":"")??""}${e(_),me(),i(()=>e(_)[me()])??""}`)},[()=>(U(ka),me(),i(()=>ka[me()].substring(0,3).toUpperCase()))]),A("change",oe,G=>{console.log("Skill proficiency changed:",me(),G.target.checked),V.update(De=>({...De,skillProficiencies:{...De.skillProficiencies,[me()]:G.target.checked}}))}),A("click",I,()=>ve(me())),c(Me,$)}),l(ie),c(te,ie)};k(se,te=>{h(),i(()=>!h().skills)&&te(X)})}l(J),P(()=>Te=ft(J,1,"skills svelte-1f1pl16",null,Te,{hidden:!e(be)})),c(a,J),Rt(),F()}let va=null,da=null;async function Ka(){if(va)return va;try{return va=await(await fetch(za("/data/spells.json"))).json(),va||[]}catch(a){return console.error("Failed to load spells:",a),[]}}async function Ws(){if(da)return da;try{return da=await(await fetch(za("/data/feats.json"))).json(),da||[]}catch(a){return console.error("Failed to load feats:",a),[]}}function Ia(a,n){if(!n.trim())return a;const t=n.toLowerCase();return a.filter(d=>d.name.toLowerCase().includes(t)||d.school.toLowerCase().includes(t)||d.classes.some(p=>p.toLowerCase().includes(t))||d.description.toLowerCase().includes(t))}function zs(a,n){return n===null?a:a.filter(t=>t.level===n)}function Ks(a,n){if(!n.trim())return a;const t=n.toLowerCase();return a.filter(d=>d.name.toLowerCase().includes(t)||d.description.toLowerCase().includes(t))}function ua(a){const n=a.description,t=/\b(Strength|Dexterity|Constitution|Intelligence|Wisdom|Charisma)\s+saving\s+throw/i,d=n.match(t);if(!d)return null;const p=d[1].toLowerCase(),S=/half\s+(?:as\s+much\s+)?damage\s+on\s+a\s+successful(?:\s+save)?/i.test(n),_=/saving\s+throw\s+or\s+take.*?damage/i.test(n)&&!S;return{ability:p,halfDamageOnSave:S,noDamageOnSave:_}}function Js(a){const n=a.description;return/(plus|add)\s+your\s+spellcasting\s+(ability\s+)?modifier/i.test(n)}function Ra(a){const n=a.description.toLowerCase(),d=["takes","take","deals","deal","damage equal to","force damage","fire damage","cold damage","lightning damage","thunder damage","acid damage","poison damage","necrotic damage","radiant damage","psychic damage","regain","regains","hit point"].some(S=>n.includes(S));return["bonus to attack","bonus to damage","bonus to ac","gains a +","gain a +","+1 bonus","+2 bonus","+3 bonus","advantage on","becomes a magic weapon"].some(S=>n.includes(S))&&!d}function Vs(a){const n=a.description;let t=0,d=0,p=0,h="";const S=n.match(/\+(\d+)\s+bonus\s+to\s+attack\s+rolls\s+and\s+damage\s+rolls/i);if(S){const _=parseInt(S[1]);t=_,d=_,h=`+${_} to attack and damage rolls`}a.name==="Bless"&&(h="Add 1d4 to attack rolls and saves");const F=n.match(/\+(\d+)\s+bonus\s+to\s+AC/i);return F&&(p=parseInt(F[1]),h=`+${p} to AC`),a.name==="Haste"&&(h="+2 AC, doubled speed, extra action"),h||t!==0||d!==0||p!==0?{attackBonus:t,damageBonus:d,acBonus:p,description:h||a.description.substring(0,100)}:null}var Qs=u('<button class="btn-remove svelte-14o91c5">Ã—</button>'),Xs=u('<div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Bonus</label> <input type="number" class="attack-bonus svelte-14o91c5"/></div>'),Ys=u('<div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Damage</label> <input type="text" placeholder="e.g., 2d6+3" class="attack-damage svelte-14o91c5"/></div>'),Zs=u('<div class="spell-info-loading svelte-14o91c5">Loading spell info...</div>'),el=u('<div class="spell-notes svelte-14o91c5"><h4 class="svelte-14o91c5">General Notes</h4> <p> </p></div>'),tl=u('<li class="svelte-14o91c5"><strong>At Higher Levels:</strong> </li>'),al=u('<ul class="svelte-14o91c5"><li class="svelte-14o91c5"><strong>Level:</strong> </li> <li class="svelte-14o91c5"><strong>Casting Time:</strong> </li> <li class="svelte-14o91c5"><strong>Range:</strong> </li> <li class="svelte-14o91c5"><strong>Components:</strong> <!></li> <li class="svelte-14o91c5"><strong>Duration:</strong> <!> </li> <li class="svelte-14o91c5"><strong>Description:</strong> </li> <!></ul>'),sl=u('<span class="scaled-damage svelte-14o91c5" style="margin-left: 8px;"> </span>'),ll=u('<span class="scaled-damage svelte-14o91c5">(Half damage)</span>'),rl=u('<span class="scaled-damage svelte-14o91c5">(No damage)</span>'),il=u('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> <!> <!></label></div>'),nl=u("<option> </option>"),ol=u('<span class="scaled-damage svelte-14o91c5"><!> </span>'),cl=u('<span class="scaled-damage svelte-14o91c5"> </span>'),vl=u('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> Target is Fiend or Undead <!></label></div>'),dl=u('<div class="spell-level-selector svelte-14o91c5"><label class="svelte-14o91c5">Cast at Level:</label> <select class="spell-level-select use-enabled svelte-14o91c5"></select> <!></div> <!>',1),ul=u('<div class="spell-level-selector svelte-14o91c5"><span style="color: #dc3545; font-weight: bold;">No spell slots available!</span></div>'),pl=u('<!> <div class="spell-info svelte-14o91c5"><div class="spell-info-header svelte-14o91c5" role="button" tabindex="0"><h4 class="svelte-14o91c5">Spell Info</h4> <button class="collapse-btn-small svelte-14o91c5"> </button></div> <!></div> <!> <!>',1),fl=u('<div class="spell-info-missing svelte-14o91c5">Spell info not found.</div>'),gl=u('<div class="attack-notes svelte-14o91c5"><label class="svelte-14o91c5">Notes</label> <textarea placeholder="e.g., DC 15 Dex save, Range 120 ft, Concentration" class="notes-input svelte-14o91c5" rows="2"></textarea></div>'),bl=u('<button class="btn btn-primary">Roll Attack</button>'),ml=u('<button class="btn btn-success">Cast Spell</button>'),hl=u('<button class="btn btn-secondary"><!></button>'),_l=u('<button class="btn btn-secondary">Roll Damage</button>'),yl=u('<div class="attack-card svelte-14o91c5"><div class="attack-header svelte-14o91c5"><input type="text" placeholder="Attack name" class="attack-name svelte-14o91c5"/> <!></div> <div class="attack-details svelte-14o91c5"><!> <!> <div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Type</label> <input type="text" placeholder="e.g., slashing" class="attack-type svelte-14o91c5"/></div></div> <!> <!> <div class="attack-actions svelte-14o91c5"><!> <!></div></div>'),kl=u('<p class="no-attacks svelte-14o91c5">No attacks added yet. Click "Add Attack" to create one.</p>'),Sl=u('<p class="no-attacks svelte-14o91c5">No attacks match your search.</p>'),xl=u('<button class="btn-remove svelte-14o91c5">Ã—</button>'),$l=u('<div class="state-card svelte-14o91c5"><div class="state-header svelte-14o91c5"><input type="text" placeholder="Effect name (e.g., Magic Weapon)" class="state-name svelte-14o91c5"/> <!></div> <div class="state-details svelte-14o91c5"><div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Attack Bonus</label> <input type="number" class="state-bonus svelte-14o91c5"/></div> <div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Damage Bonus</label> <input type="number" class="state-bonus svelte-14o91c5"/></div></div> <div class="state-description svelte-14o91c5"><label class="svelte-14o91c5">Description</label> <input type="text" placeholder="e.g., +1 to attack and damage rolls (Magic Weapon)" class="state-desc-input svelte-14o91c5"/></div></div>'),Cl=u('<div class="states-list svelte-14o91c5"></div>'),Ll=u('<p class="no-states svelte-14o91c5">No active effects. Add spell effects that modify your attacks.</p>'),wl=u('<button class="btn btn-secondary">Add Attack</button> <div class="attacks-list svelte-14o91c5"><!> <!></div> <div class="active-states-section svelte-14o91c5"><h3 class="svelte-14o91c5">Active Spell Effects</h3> <p class="section-description svelte-14o91c5">Effects that modify attack and damage rolls (e.g., Magic Weapon, Bless)</p> <button class="btn btn-secondary">Add Effect</button> <!></div>',1),Dl=u("<section><!> <!></section>");function jl(a,n){It(n,!1);const t=()=>Ke(V,"$character",F),d=()=>Ke(oa,"$abilityModifiers",F),p=()=>Ke(Qt,"$searchFilter",F),h=()=>Ke(At,"$collapsedStates",F),S=()=>Ke(ta,"$isEditMode",F),[F,_]=Ut(),R=M(),Q=M(),q=Zt();let H=M({});function be(g){fa(H,e(H)[g]=!e(H)[g]),v(H,{...e(H)})}function pe(g){return g.description.toLowerCase().includes("regain")&&(g.description.toLowerCase().includes("hit point")||g.description.toLowerCase().includes("hp"))}function Y(){V.update(g=>(g.attacks=[...g.attacks,{id:crypto.randomUUID(),name:"",bonus:0,damage:"",damageType:"",notes:""}],g))}function ve(g){V.update(x=>(x.attacks=x.attacks.filter(O=>O.id!==g),x))}function J(g){let x=g.damage,O=!1;if(g.spellRef){const xe=X(g.spellRef);if(xe&&xe.level>0){const _e=g.castAtLevel||xe.level;if(!te(_e)){Et.add(`No level ${_e} spell slots available!`,"error");return}const je=ua(xe);je&&g.targetSucceededSave&&je.noDamageOnSave?x="0":(O=je?.halfDamageOnSave&&g.targetSucceededSave||!1,x=ie(g,xe))}}else if(t().activeStates&&t().activeStates.length>0){let xe=0;for(const _e of t().activeStates)xe+=_e.damageBonus;if(xe!==0&&x){const _e=x.match(/(\d+d\d+)([+-]\d+)?/);if(_e){const[,He,je]=_e,Xe=(je?parseInt(je):0)+xe;x=`${He}${Xe>=0?"+":""}${Xe}`}}}const I=[];g.bonus!==0&&I.push({value:g.bonus,source:"base"});let G=g.bonus;if(t().activeStates)for(const xe of t().activeStates)xe.attackBonus!==0&&(I.push({value:xe.attackBonus,source:xe.name.toLowerCase()}),G+=xe.attackBonus);let De;De=`1d20${G>=0?"+":""}${G}`,q("roll",{notation:De,damageNotation:x,attackName:g.name,applyHalfDamage:O,bonusBreakdown:I})}function Te(g){if(!g.damage){Et.add(`${g.name}: No damage specified`,"error");return}let x=g.damage,O=!1;const I=[];if(g.spellRef){const G=X(g.spellRef);if(G&&G.level>0){const De=g.castAtLevel||G.level;if(!te(De)){Et.add(`No level ${De} spell slots available!`,"error");return}const _e=ua(G);_e&&g.targetSucceededSave&&_e.noDamageOnSave?x="0":(O=_e?.halfDamageOnSave&&g.targetSucceededSave||!1,x=ie(g,G))}}else{const G=x.match(/(\d+d\d+)([+-]\d+)?/);if(G){const[,De,xe]=G,_e=xe?parseInt(xe):0;if(_e!==0&&I.push({value:_e,source:"base"}),t().activeStates&&t().activeStates.length>0){let He=0;for(const je of t().activeStates)je.damageBonus!==0&&(I.push({value:je.damageBonus,source:je.name.toLowerCase()}),He+=je.damageBonus);if(He!==0){const je=_e+He;x=`${De}${je>=0?"+":""}${je}`}}}}q("roll",{notation:x,attackName:g.name,applyHalfDamage:O,bonusBreakdown:I})}let z=M([]),se=M(!1);na(async()=>{v(z,await Ka()),v(se,!0)});function X(g){return e(z).find(x=>x.name===g)}function te(g){t().classFeatures.spellSlotsByLevel||vt(V,i(t).classFeatures.spellSlotsByLevel={},i(t)),t().classFeatures.spellSlotsByLevel[g]||vt(V,i(t).classFeatures.spellSlotsByLevel[g]=Array(2).fill(!1),i(t));const O=t().classFeatures.spellSlotsByLevel[g].findIndex(I=>!I);return O===-1?!1:(V.update(I=>(I.classFeatures.spellSlotsByLevel||(I.classFeatures.spellSlotsByLevel={}),I.classFeatures.spellSlotsByLevel[g]||(I.classFeatures.spellSlotsByLevel[g]=Array(2).fill(!1)),I.classFeatures.spellSlotsByLevel[g][O]=!0,I)),!0)}function ie(g,x){let O=g.damage,I=0,G=0;if(Js(x)&&(G+=Ms(t(),d())),t().activeStates)for(const N of t().activeStates)G+=N.damageBonus;if(x.higherLevelSlot&&g.castAtLevel){const N=x.level,Z=(g.castAtLevel||N)-N;if(Z>0){const W=x.higherLevelSlot.match(/(\d+)d(\d+)\s+for\s+each.*?level\s+above/i);if(W){const[,fe]=W;I+=Z*parseInt(fe)}}}if(g.targetIsFiendOrUndead&&x.description.includes("Fiend or an Undead")){const N=x.description.match(/increases by (\d+)d(\d+) if.*?Fiend or.*?Undead/i);if(N){const[,o]=N;I+=parseInt(o)}}const De=O.match(/(\d+)d(\d+)([+-]\d+)?/);if(!De)return G!==0?G>=0?`${G}`:`${G}`:O||"0";const[,xe,_e,He]=De,je=parseInt(xe)+I,Xe=(He?parseInt(He):0)+G;let ct=`${je}d${_e}`;return Xe!==0&&(ct+=Xe>=0?`+${Xe}`:`${Xe}`),ct}function Me(g){const x=[];for(let I=g.level;I<=9;I++){const G=t().classFeatures.spellSlotsByLevel?.[I];G&&G.length>0&&x.push(I)}return x}function Ee(){V.update(g=>(g.activeStates||(g.activeStates=[]),g.activeStates=[...g.activeStates,{name:"",attackBonus:0,damageBonus:0,description:""}],g))}function me(g){V.update(x=>(x.activeStates&&(x.activeStates=x.activeStates.filter((O,I)=>I!==g)),x))}function he(g){const x=X(g.spellRef);if(!x){Et.add("Spell not found","error");return}const O=g.castAtLevel||x.level;if(O>0&&!te(O)){Et.add(`No level ${O} spell slots available!`,"error");return}const I=Vs(x);if(!I){Et.add(`${x.name} cast! Check spell description for effects.`,"info");return}V.update(G=>(G.activeStates||(G.activeStates=[]),G.activeStates=G.activeStates.filter(De=>De.name!==x.name),G.activeStates=[...G.activeStates,{name:x.name,attackBonus:I.attackBonus,damageBonus:I.damageBonus,acBonus:I.acBonus,description:I.description}],G)),Et.add(`${x.name} cast! Effect added to Active Spell Effects.`,"success")}ze(()=>(t(),e(H)),()=>{if(t()&&t().attacks)for(const g of t().attacks)g.spellRef&&e(H)[g.id]===void 0&&fa(H,e(H)[g.id]=!0)}),ze(()=>(t(),p()),()=>{v(R,t().attacks.filter(g=>{if(!p())return!0;const x=p().toLowerCase();return g.name.toLowerCase().includes(x)||g.damageType.toLowerCase().includes(x)}).sort((g,x)=>!g.spellRef&&x.spellRef?-1:g.spellRef&&!x.spellRef?1:0))}),ze(()=>(p(),e(R)),()=>{v(Q,!p()||e(R).length>0||"attack".includes(p().toLowerCase())||"spell".includes(p().toLowerCase()))}),Wt(),Mt();var $=Dl();let oe;var m=r($);{let g=et(()=>(h(),i(()=>h().attacks?"Expand":"Collapse")));ea(m,{title:"Attacks & Spells",get collapsed(){return h(),i(()=>h().attacks)},get ariaLabel(){return e(g)},onToggle:()=>At.update(x=>({...x,attacks:!x.attacks}))})}var E=s(m,2);{var le=g=>{var x=wl(),O=Ge(x),I=s(O,2),G=r(I);ut(G,1,()=>e(R),N=>N.id,(N,o,Z)=>{var W=yl(),fe=r(W),Ie=r(fe);Ce(Ie);var Pe=s(Ie,2);{var Re=w=>{var B=Qs();A("click",B,()=>ve(e(o).id)),c(w,B)};k(Pe,w=>{S()&&w(Re)})}l(fe);var T=s(fe,2),b=r(T);{var ne=w=>{var B=Xs(),re=s(r(B),2);Ce(re),l(B),Be(re,()=>e(o).bonus,Se=>(e(o).bonus=Se,Dt(()=>(e(R),t(),p())))),c(w,B)};k(b,w=>{e(o),i(()=>e(o).bonus!==0&&e(o).bonus!==void 0)&&w(ne)})}var we=s(b,2);{var Oe=w=>{var B=Ys(),re=s(r(B),2);Ce(re),l(B),Be(re,()=>e(o).damage,Se=>(e(o).damage=Se,Dt(()=>(e(R),t(),p())))),c(w,B)};k(we,w=>{e(o),i(()=>e(o).damage&&e(o).damage.trim()!=="")&&w(Oe)})}var qe=s(we,2),ye=s(r(qe),2);Ce(ye),l(qe),l(T);var de=s(T,2);{var Le=w=>{var B=nt(),re=Ge(B);{var Se=K=>{var j=Zs();c(K,j)},We=K=>{const j=et(()=>(e(o),i(()=>X(e(o).spellRef))));var Fe=nt(),lt=Ge(Fe);{var it=tt=>{const at=et(()=>(U(ua),U(e(j)),i(()=>ua(e(j)))));var L=pl(),ee=Ge(L);{var f=Qe=>{var Ye=el(),kt=s(r(Ye),2),xt=r(kt,!0);l(kt),l(Ye),P(()=>C(xt,(e(o),i(()=>e(o).generalNotes)))),c(Qe,Ye)};k(ee,Qe=>{e(o),i(()=>e(o).generalNotes)&&Qe(f)})}var ae=s(ee,2),ce=r(ae),st=s(r(ce),2),$e=r(st,!0);l(st),l(ce);var Ve=s(ce,2);{var Je=Qe=>{var Ye=al(),kt=r(Ye),xt=s(r(kt));l(kt);var Ht=s(kt,2),zt=s(r(Ht));l(Ht);var $t=s(Ht,2),Nt=s(r($t));l($t);var gt=s($t,2),Ct=s(r(gt)),Ze=s(Ct);{var Lt=bt=>{var yt=jt();P(()=>C(yt,`(${U(e(j)),i(()=>e(j).material)??""})`)),c(bt,yt)};k(Ze,bt=>{U(e(j)),i(()=>e(j).material)&&bt(Lt)})}l(gt);var qt=s(gt,2),Kt=s(r(qt),2);{var Xt=bt=>{var yt=jt("Concentration,");c(bt,yt)};k(Kt,bt=>{U(e(j)),i(()=>e(j).concentration)&&bt(Xt)})}var St=s(Kt,1,!0);l(qt);var Bt=s(qt,2),wt=s(r(Bt));l(Bt);var Gt=s(Bt,2);{var Jt=bt=>{var yt=tl(),Ot=s(r(yt));l(yt),P(()=>C(Ot,` ${U(e(j)),i(()=>e(j).higherLevelSlot)??""}`)),c(bt,yt)};k(Gt,bt=>{U(e(j)),i(()=>e(j).higherLevelSlot)&&bt(Jt)})}l(Ye),P(bt=>{C(xt,` ${U(e(j)),i(()=>e(j).level)??""}`),C(zt,` ${U(e(j)),i(()=>e(j).castingTime||e(j).actionType)??""}`),C(Nt,` ${U(e(j)),i(()=>e(j).range)??""}`),C(Ct,` ${bt??""}`),C(St,(U(e(j)),i(()=>e(j).duration))),C(wt,` ${U(e(j)),i(()=>e(j).description)??""}`)},[()=>(U(e(j)),i(()=>e(j).components.join(", ")))]),c(Qe,Ye)};k(Ve,Qe=>{e(H),e(o),i(()=>!e(H)[e(o).id])&&Qe(Je)})}l(ae);var dt=s(ae,2);{var _t=Qe=>{var Ye=il(),kt=r(Ye),xt=r(kt);Ce(xt);var Ht=s(xt),zt=s(Ht);{var $t=Ze=>{var Lt=sl(),qt=r(Lt);l(Lt),P(Kt=>C(qt,`(Spell Save DC: ${Kt??""})`),[()=>(U(La),t(),d(),i(()=>La(t(),d())))]),c(Ze,Lt)};k(zt,Ze=>{t(),i(()=>t().class)&&Ze($t)})}var Nt=s(zt,2);{var gt=Ze=>{var Lt=ll();c(Ze,Lt)},Ct=Ze=>{var Lt=nt(),qt=Ge(Lt);{var Kt=Xt=>{var St=rl();c(Xt,St)};k(qt,Xt=>{e(o),U(e(at)),i(()=>e(o).targetSucceededSave&&e(at).noDamageOnSave)&&Xt(Kt)},!0)}c(Ze,Lt)};k(Nt,Ze=>{e(o),U(e(at)),i(()=>e(o).targetSucceededSave&&e(at).halfDamageOnSave)?Ze(gt):Ze(Ct,!1)})}l(kt),l(Ye),P(Ze=>C(Ht,` Target succeeded on ${Ze??""} save `),[()=>(U(e(at)),i(()=>e(at).ability.charAt(0).toUpperCase()+e(at).ability.slice(1)))]),$a(xt,()=>e(o).targetSucceededSave,Ze=>(e(o).targetSucceededSave=Ze,Dt(()=>(e(R),t(),p())))),c(Qe,Ye)};k(dt,Qe=>{e(at)&&Qe(_t)})}var Tt=s(dt,2);{var Ft=Qe=>{const Ye=et(()=>(U(e(j)),i(()=>Me(e(j)))));var kt=nt(),xt=Ge(kt);{var Ht=$t=>{var Nt=dl(),gt=Ge(Nt),Ct=r(gt),Ze=s(Ct,2);P(()=>{e(o),Dt(()=>{e(Ye)})}),ut(Ze,5,()=>e(Ye),pt,(St,Bt)=>{var wt=nl(),Gt=r(wt);l(wt);var Jt={};P(()=>{C(Gt,`Level ${e(Bt)??""}`),Jt!==(Jt=e(Bt))&&(wt.value=(wt.__value=e(Bt))??"")}),c(St,wt)}),l(Ze);var Lt=s(Ze,2);{var qt=St=>{const Bt=et(()=>(e(o),U(e(j)),i(()=>ie(e(o),e(j)))));var wt=ol(),Gt=r(wt);{var Jt=Ot=>{var Yt=jt("Healing");c(Ot,Yt)},bt=Ot=>{var Yt=jt("Damage");c(Ot,Yt)};k(Gt,Ot=>{U(e(j)),i(()=>pe(e(j)))?Ot(Jt):Ot(bt,!1)})}var yt=s(Gt);l(wt),P(()=>C(yt,` ${e(Bt)??""}`)),c(St,wt)};k(Lt,St=>{e(o),U(e(j)),i(()=>e(o).castAtLevel&&e(o).castAtLevel>e(j).level)&&St(qt)})}l(gt);var Kt=s(gt,2);{var Xt=St=>{var Bt=vl(),wt=r(Bt),Gt=r(wt);Ce(Gt);var Jt=s(Gt,2);{var bt=yt=>{const Ot=et(()=>(e(o),U(e(j)),i(()=>ie(e(o),e(j)))));var Yt=cl(),Ja=r(Yt);l(Yt),P(()=>C(Ja,`(+1d8, total: ${e(Ot)??""})`)),c(yt,Yt)};k(Jt,yt=>{e(o),i(()=>e(o).targetIsFiendOrUndead)&&yt(bt)})}l(wt),l(Bt),$a(Gt,()=>e(o).targetIsFiendOrUndead,yt=>(e(o).targetIsFiendOrUndead=yt,Dt(()=>(e(R),t(),p())))),c(St,Bt)};k(Kt,St=>{U(e(j)),i(()=>e(j).description.includes("Fiend or an Undead"))&&St(Xt)})}P(()=>{ot(Ct,"for",`castLevel-${e(o),i(()=>e(o).id)??""}`),ot(Ze,"id",`castLevel-${e(o),i(()=>e(o).id)??""}`)}),qa(Ze,()=>e(o).castAtLevel,St=>(e(o).castAtLevel=St,Dt(()=>(e(R),t(),p())))),c($t,Nt)},zt=$t=>{var Nt=ul();c($t,Nt)};k(xt,$t=>{U(e(Ye)),i(()=>e(Ye).length>0)?$t(Ht):$t(zt,!1)})}c(Qe,kt)};k(Tt,Qe=>{U(e(j)),i(()=>e(j).higherLevelSlot&&e(j).level>0)&&Qe(Ft)})}P(()=>{ot(st,"aria-label",(e(H),e(o),i(()=>e(H)[e(o).id]?"Expand":"Collapse"))),C($e,(e(H),e(o),i(()=>e(H)[e(o).id]?"â–¼":"â–²")))}),A("click",ce,()=>be(e(o).id)),A("keydown",ce,Qe=>Qe.key==="Enter"&&be(e(o).id)),c(tt,L)},ht=tt=>{var at=fl();c(tt,at)};k(lt,tt=>{e(j)?tt(it):tt(ht,!1)})}c(K,Fe)};k(re,K=>{e(z),i(()=>e(z).length===0)?K(Se):K(We,!1)})}c(w,B)};k(de,w=>{e(o),i(()=>e(o).spellRef)&&w(Le)})}var ge=s(de,2);{var Ae=w=>{var B=gl(),re=s(r(B),2);ra(re),l(B),Be(re,()=>e(o).notes,Se=>(e(o).notes=Se,Dt(()=>(e(R),t(),p())))),c(w,B)};k(ge,w=>{e(o),i(()=>!e(o).spellRef)&&w(Ae)})}var Ue=s(ge,2),ue=r(Ue);{var ke=w=>{var B=bl();A("click",B,()=>J(e(o))),c(w,B)};k(ue,w=>{e(o),i(()=>e(o).bonus!==0||!e(o).spellRef)&&w(ke)})}var Ne=s(ue,2);{var y=w=>{const B=et(()=>(e(o),i(()=>X(e(o).spellRef))));var re=nt(),Se=Ge(re);{var We=j=>{var Fe=ml();A("click",Fe,()=>he(e(o))),c(j,Fe)},K=j=>{var Fe=hl(),lt=r(Fe);{var it=tt=>{var at=jt("Roll Healing");c(tt,at)},ht=tt=>{var at=jt("Roll Damage");c(tt,at)};k(lt,tt=>{U(e(B)),i(()=>e(B)&&pe(e(B)))?tt(it):tt(ht,!1)})}l(Fe),A("click",Fe,()=>Te(e(o))),c(j,Fe)};k(Se,j=>{U(e(B)),U(Ra),i(()=>e(B)&&Ra(e(B)))?j(We):j(K,!1)})}c(w,re)},D=w=>{var B=_l();A("click",B,()=>Te(e(o))),c(w,B)};k(Ne,w=>{e(o),e(se),i(()=>e(o).spellRef&&e(se))?w(y):w(D,!1)})}l(Ue),l(W),Be(Ie,()=>e(o).name,w=>(e(o).name=w,Dt(()=>(e(R),t(),p())))),Be(ye,()=>e(o).damageType,w=>(e(o).damageType=w,Dt(()=>(e(R),t(),p())))),c(N,W)});var De=s(G,2);{var xe=N=>{var o=kl();c(N,o)},_e=N=>{var o=nt(),Z=Ge(o);{var W=fe=>{var Ie=Sl();c(fe,Ie)};k(Z,fe=>{e(R),i(()=>e(R).length===0)&&fe(W)},!0)}c(N,o)};k(De,N=>{t(),i(()=>t().attacks.length===0)?N(xe):N(_e,!1)})}l(I);var He=s(I,2),je=s(r(He),4),rt=s(je,2);{var Xe=N=>{var o=Cl();ut(o,5,()=>(t(),i(()=>t().activeStates)),pt,(Z,W,fe)=>{var Ie=$l(),Pe=r(Ie),Re=r(Pe);Ce(Re);var T=s(Re,2);{var b=ge=>{var Ae=xl();A("click",Ae,()=>me(fe)),c(ge,Ae)};k(T,ge=>{S()&&ge(b)})}l(Pe);var ne=s(Pe,2),we=r(ne),Oe=s(r(we),2);Ce(Oe),l(we);var qe=s(we,2),ye=s(r(qe),2);Ce(ye),l(qe),l(ne);var de=s(ne,2),Le=s(r(de),2);Ce(Le),l(de),l(Ie),Be(Re,()=>e(W).name,ge=>(e(W).name=ge,Dt(()=>t()),ca(F,"$character"))),Be(Oe,()=>e(W).attackBonus,ge=>(e(W).attackBonus=ge,Dt(()=>t()),ca(F,"$character"))),Be(ye,()=>e(W).damageBonus,ge=>(e(W).damageBonus=ge,Dt(()=>t()),ca(F,"$character"))),Be(Le,()=>e(W).description,ge=>(e(W).description=ge,Dt(()=>t()),ca(F,"$character"))),c(Z,Ie)}),l(o),c(N,o)},ct=N=>{var o=Ll();c(N,o)};k(rt,N=>{t(),i(()=>t().activeStates&&t().activeStates.length>0)?N(Xe):N(ct,!1)})}l(He),A("click",O,Y),A("click",je,Ee),c(g,x)};k(E,g=>{h(),i(()=>!h().attacks)&&g(le)})}l($),P(()=>oe=ft($,1,"attacks svelte-14o91c5",null,oe,{hidden:!e(Q)})),c(a,$),Rt(),_()}var Al=u('<span class="slot-checkbox-x svelte-serp1j">&#8212;</span>'),Fl=u('<label><input type="checkbox" class="slot-checkbox-input svelte-serp1j"/> <span><!></span></label>');function Ea(a,n){It(n,!1);const t=()=>Ke(ta,"$isEditMode",d),[d,p]=Ut();let h=mt(n,"checked",8,!1),S=mt(n,"disabled",8,!1),F=mt(n,"className",8,""),_=mt(n,"index",8,void 0),R=mt(n,"ariaLabel",8,void 0);const Q=Zt();function q(J){Q("change",{checked:J.currentTarget.checked,index:_()})}Mt();var H=Fl(),be=r(H);Ce(be);var pe=s(be,2),Y=r(pe);{var ve=J=>{var Te=Al();c(J,Te)};k(Y,J=>{h()&&J(ve)})}l(pe),l(H),P(()=>{ft(H,1,"slot-checkbox-label "+F()+(t()?"":" not-editable"),"svelte-serp1j"),Wa(be,h()),be.disabled=S()||!t(),ot(be,"aria-label",R()),ot(be,"tabindex",t()?0:-1),ft(pe,1,`slot-checkbox-custom ${h()?"used":""} ${t()?"":"readonly"}`,"svelte-serp1j")}),A("change",be,q),c(a,H),Rt(),p()}var Bl=u('<p class="no-features svelte-1kpvv0n">Select a class to see available features</p>'),Ml=u('<p class="no-features svelte-1kpvv0n">No class features available at this level</p>'),Il=u('<div class="spell-slots svelte-1kpvv0n"><label class="svelte-1kpvv0n"> </label> <div class="slots-tracker svelte-1kpvv0n"></div></div>'),Rl=u('<div class="all-spell-slots"></div>'),El=u('<div class="feature-box spellcasting svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"> </h3> <div class="spell-stats svelte-1kpvv0n"><div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Spell Save DC</label> <div class="spell-value svelte-1kpvv0n"> </div></div> <div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <div class="spell-value svelte-1kpvv0n"> </div></div></div> <!> <div class="prepared-spells svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <textarea placeholder="List your prepared spells..." class="svelte-1kpvv0n"></textarea></div></div>'),Pl=u('<p class="unlimited svelte-1kpvv0n">Unlimited Uses</p>'),Tl=u('<div class="slots-tracker svelte-1kpvv0n"></div> <div class="uses-actions-row"><button class="btn btn-primary use-enabled"> </button></div> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div>',1),Hl=u('<div class="uses-tracker svelte-1kpvv0n"><!></div>'),Ul=u('<div class="pool-tracker svelte-1kpvv0n"><input type="number" min="0" class="pool-input svelte-1kpvv0n"/> <span> </span> <button class="btn-small svelte-1kpvv0n"> </button></div>'),Nl=u('<p class="no-uses svelte-1kpvv0n">No Channel Divinity uses remaining</p>'),Gl=u('<div class="channel-divinity-option svelte-1kpvv0n"><button class="btn btn-primary use-enabled svelte-1kpvv0n">Use Channel Divinity</button> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div> <!></div>'),Ol=u('<div class="feature-box svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"><!> </h3> <p class="feature-description svelte-1kpvv0n"> </p> <!></div>'),ql=u('<div class="features-grid svelte-1kpvv0n"><!> <!></div>'),Wl=u("<section><!> <!></section>");function zl(a,n){It(n,!1);const t=()=>Ke(V,"$character",S),d=()=>Ke(oa,"$abilityModifiers",S),p=()=>Ke(Qt,"$searchFilter",S),h=()=>Ke(At,"$collapsedStates",S),[S,F]=Ut(),_=M(),R=M(),Q=M(),q=M(),H=M(),be=M(),pe=M();let Y=M(0),ve=M(0);function J(m,E){V.update(le=>(le.classFeatures.features[m]=E,le))}function Te(){V.update(m=>(m.classFeatures.spellSlotsByLevel||(m.classFeatures.spellSlotsByLevel={}),e(q).forEach(({level:E,slots:le})=>{m.classFeatures.spellSlotsByLevel[E]||(m.classFeatures.spellSlotsByLevel[E]=Array(le).fill(!1))}),m))}function z(m){if(typeof m.maxUses=="function"){if((m.name==="Divine Sense"||m.name==="War Priest")&&e(_)?.spellcastingAbility){const E=d()[e(_).spellcastingAbility];return m.maxUses(t().level,E)}return m.maxUses(t().level)}return m.maxUses||0}function se(m,E){V.update(le=>((!le.classFeatures.features[m]||!Array.isArray(le.classFeatures.features[m])||le.classFeatures.features[m].length!==E)&&(le.classFeatures.features[m]=Array(E).fill(!1)),le))}Va(()=>{e(be)&&t()&&t().classFeatures&&t().classFeatures.features&&e(be).forEach(m=>{if(m.type==="uses"){const E=m.name.replace(/\s+/g,""),le=z(m),g=t().classFeatures.features[E];(!Array.isArray(g)||g.length!==le)&&se(E,le)}})});function X(m){return typeof m.maxPool=="function"?m.maxPool(t().level):m.maxPool||0}function te(m){return typeof m.description=="function"?m.description(t().level):m.description}function ie(){const m="ChannelDivinity";V.update(E=>{const le=E.classFeatures.features[m];return typeof le=="number"&&le>0&&(E.classFeatures.features[m]=le-1),E})}function Me(){At.update(m=>({...m,classFeatures:!m.classFeatures}))}ze(()=>(t(),Pt),()=>{v(_,t().class?Pt(t().class):null)}),ze(()=>(t(),sa),()=>{v(R,t().class?sa(t().class,t().level,t().subclass):[])}),ze(()=>(t(),Ba),()=>{v(Q,t().class?Ba(t().class,t().level):0)}),ze(()=>(e(_),t()),()=>{v(q,(()=>{if(!e(_)?.spellcaster)return[];const m=t().level,E=[];return m>=1&&E.push({level:1,slots:Math.min(4,2+Math.floor(m/3))}),m>=3&&E.push({level:2,slots:Math.min(3,2+Math.floor((m-3)/4))}),m>=5&&E.push({level:3,slots:Math.min(3,2+Math.floor((m-5)/5))}),m>=7&&E.push({level:4,slots:Math.min(3,1+Math.floor((m-7)/6))}),m>=9&&E.push({level:5,slots:Math.min(2,1+Math.floor((m-9)/8))}),m>=11&&E.push({level:6,slots:1}),m>=13&&E.push({level:7,slots:1}),m>=15&&E.push({level:8,slots:1}),m>=17&&E.push({level:9,slots:1}),E})())}),ze(()=>(e(_),d(),t(),Ma),()=>{if(e(_)?.spellcaster&&e(_).spellcastingAbility){const m=d()[e(_).spellcastingAbility];v(Y,_s(t().class,m,t().proficiencyBonus)||0),v(ve,Ma(t().class,t().level,m))}}),ze(()=>(t(),e(_),e(q)),()=>{t().class&&e(_)?.spellcaster&&e(q).length>0&&Te()}),ze(()=>t(),()=>{v(H,(()=>{const E=t().classFeatures.features["ChannelDivinity"];return typeof E=="number"?E:0})())}),ze(()=>(e(R),p()),()=>{v(be,e(R).filter(m=>{if(!p())return!0;const E=p().toLowerCase();return m.name.toLowerCase().includes(E)||te(m).toLowerCase().includes(E)}))}),ze(()=>(p(),t(),e(be)),()=>{v(pe,!p()||t().class||"class features".includes(p().toLowerCase())||"spellcasting".includes(p().toLowerCase())||e(be).length>0)}),Wt(),Mt();var Ee=Wl();let me;var he=r(Ee);{let m=et(()=>(h(),i(()=>h().classFeatures?"Expand":"Collapse")));ea(he,{title:"Class Features",get collapsed(){return h(),i(()=>h().classFeatures)},get ariaLabel(){return e(m)},onToggle:Me})}var $=s(he,2);{var oe=m=>{var E=nt(),le=Ge(E);{var g=O=>{var I=Bl();c(O,I)},x=O=>{var I=nt(),G=Ge(I);{var De=_e=>{var He=Ml();c(_e,He)},xe=_e=>{var He=ql(),je=r(He);{var rt=ct=>{var N=El(),o=r(N),Z=r(o);l(o);var W=s(o,2),fe=r(W),Ie=s(r(fe),2),Pe=r(Ie,!0);l(Ie),l(fe);var Re=s(fe,2),T=s(r(Re),2),b=r(T,!0);l(T),l(Re),l(W);var ne=s(W,2);{var we=ye=>{var de=Rl();ut(de,5,()=>e(q),pt,(Le,ge)=>{let Ae=()=>e(ge).level,Ue=()=>e(ge).slots;const ue=et(()=>(t(),Ae(),Ue(),i(()=>t().classFeatures.spellSlotsByLevel?.[Ae()]||Array(Ue()).fill(!1))));var ke=Il(),Ne=r(ke),y=r(Ne);l(Ne);var D=s(Ne,2);ut(D,5,()=>e(ue),pt,(w,B,re)=>{{let Se=et(()=>(U(e(ue)),i(()=>e(ue)[re]||!1)));Ea(w,{get checked(){return e(Se)},$$events:{change:We=>{V.update(K=>(K.classFeatures.spellSlotsByLevel||(K.classFeatures.spellSlotsByLevel={}),K.classFeatures.spellSlotsByLevel[Ae()]||(K.classFeatures.spellSlotsByLevel[Ae()]=Array(Ue()).fill(!1)),K.classFeatures.spellSlotsByLevel[Ae()][re]=We.detail.checked,K))}}})}}),l(D),l(ke),P(()=>C(y,`${Ae()===1?"1st":Ae()===2?"2nd":Ae()===3?"3rd":`${Ae()}th`} Level Spell Slots`)),c(Le,ke)}),l(de),c(ye,de)};k(ne,ye=>{e(q),i(()=>e(q).length>0)&&ye(we)})}var Oe=s(ne,2),qe=s(r(Oe),2);ra(qe),l(Oe),l(N),P(ye=>{C(Z,`Spellcasting (${ye??""})`),C(Pe,e(Y)),C(b,e(ve))},[()=>(e(_),i(()=>e(_).spellcastingAbility?.toUpperCase()))]),Be(qe,()=>t().classFeatures.preparedSpells,ye=>vt(V,i(t).classFeatures.preparedSpells=ye,i(t))),c(ct,N)};k(je,ct=>{e(_),i(()=>e(_)?.spellcaster)&&ct(rt)})}var Xe=s(je,2);ut(Xe,1,()=>e(be),pt,(ct,N)=>{const o=et(()=>(e(N),i(()=>e(N).name.replace(/\s+/g,"")))),Z=et(()=>(t(),U(e(o)),i(()=>t().classFeatures.features[e(o)]))),W=et(()=>typeof e(Z)=="number");var fe=Ol(),Ie=r(fe),Pe=r(Ie);{var Re=ye=>{var de=jt("Channel Divinity:");c(ye,de)};k(Pe,ye=>{e(N),i(()=>e(N).type==="channelDivinity")&&ye(Re)})}var T=s(Pe);l(Ie);var b=s(Ie,2),ne=r(b,!0);l(b);var we=s(b,2);{var Oe=ye=>{const de=et(()=>(e(N),i(()=>z(e(N))))),Le=et(()=>(U(e(Z)),U(e(de)),i(()=>Array.isArray(e(Z))?e(Z):Array(e(de)).fill(!1))));var ge=Hl(),Ae=r(ge);{var Ue=ke=>{var Ne=Pl();c(ke,Ne)},ue=ke=>{var Ne=Tl(),y=Ge(Ne);ut(y,5,()=>e(Le),pt,(K,j,Fe)=>{Ea(K,{get checked(){return e(j)},index:Fe,$$events:{change:lt=>{V.update(it=>(it.classFeatures.features[e(o)]||(it.classFeatures.features[e(o)]=Array(e(de)).fill(!1)),it.classFeatures.features[e(o)][Fe]=lt.detail.checked,it))}}})}),l(y);var D=s(y,2),w=r(D),B=r(w);l(w),l(D);var re=s(D,2),Se=r(re),We=r(Se);l(Se),l(re),P(K=>{w.disabled=K,C(B,`Use ${e(N),i(()=>e(N).name)??""}`),C(We,`Resets on ${e(N),i(()=>e(N).resetOn==="short"?"Short Rest":"Long Rest")??""}`)},[()=>(U(e(Le)),i(()=>e(Le).filter(K=>!K).length<=0))]),A("click",w,()=>{V.update(K=>{K.classFeatures.features[e(o)]||(K.classFeatures.features[e(o)]=Array(e(de)).fill(!1));const j=K.classFeatures.features[e(o)],Fe=j.findIndex(lt=>!lt);return Fe!==-1&&(j[Fe]=!0),K})}),c(ke,Ne)};k(Ae,ke=>{e(de)===1/0?ke(Ue):ke(ue,!1)})}l(ge),c(ye,ge)},qe=ye=>{var de=nt(),Le=Ge(de);{var ge=Ue=>{const ue=et(()=>(e(N),i(()=>X(e(N)))));var ke=Ul(),Ne=r(ke);Ce(Ne);var y=s(Ne,2),D=r(y);l(y);var w=s(y,2),B=r(w,!0);l(w),l(ke),P(()=>{ba(Ne,e(W)&&e(Z)!==void 0?e(Z):e(ue)),ot(Ne,"max",e(ue)),C(D,`/ ${e(ue)??""}`),C(B,(e(N),i(()=>e(N).resetOn==="short"?"Short Rest":"Long Rest")))}),A("input",Ne,re=>{V.update(Se=>(Se.classFeatures.features[e(o)]=parseInt(re.currentTarget.value)||0,Se))}),A("click",w,()=>J(e(o),e(ue))),c(Ue,ke)},Ae=Ue=>{var ue=nt(),ke=Ge(ue);{var Ne=y=>{var D=Gl(),w=r(D),B=s(w,2),re=r(B),Se=r(re);l(re),l(B);var We=s(B,2);{var K=j=>{var Fe=Nl();c(j,Fe)};k(We,j=>{e(H)<=0&&j(K)})}l(D),P(()=>{w.disabled=e(H)<=0,C(Se,`Resets on ${e(N),i(()=>e(N).resetOn==="short"?"Short Rest":"Long Rest")??""}`)}),A("click",w,ie),c(y,D)};k(ke,y=>{e(N),i(()=>e(N).type==="channelDivinity")&&y(Ne)},!0)}c(Ue,ue)};k(Le,Ue=>{e(N),i(()=>e(N).type==="pool")?Ue(ge):Ue(Ae,!1)},!0)}c(ye,de)};k(we,ye=>{e(N),i(()=>e(N).type==="uses")?ye(Oe):ye(qe,!1)})}l(fe),P(ye=>{C(T,` ${e(N),i(()=>e(N).name)??""}`),C(ne,ye)},[()=>(e(N),i(()=>te(e(N))))]),c(ct,fe)}),l(He),c(_e,He)};k(G,_e=>{e(R),i(()=>e(R).length===0)?_e(De):_e(xe,!1)},!0)}c(O,I)};k(le,O=>{t(),i(()=>!t().class)?O(g):O(x,!1)})}c(m,E)};k($,m=>{h(),i(()=>!h().classFeatures)&&m(oe)})}l(Ee),P(()=>me=ft(Ee,1,"class-features svelte-1kpvv0n",null,me,{hidden:!e(pe)})),c(a,Ee),Rt(),F()}var Kl=u('<textarea placeholder="Enter features, traits, and special abilities..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Equipment</h3> <textarea placeholder="List your equipment and inventory..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Notes</h3> <textarea placeholder="Additional notes..." class="svelte-wttn0l"></textarea>',1),Jl=u("<section><!> <!></section>");function Vl(a,n){It(n,!1);const t=()=>Ke(Qt,"$searchFilter",h),d=()=>Ke(V,"$character",h),p=()=>Ke(At,"$collapsedStates",h),[h,S]=Ut(),F=M();function _(){At.update(pe=>({...pe,notes:!pe.notes}))}ze(()=>(t(),d()),()=>{v(F,!t()||"features".includes(t().toLowerCase())||"traits".includes(t().toLowerCase())||"equipment".includes(t().toLowerCase())||"notes".includes(t().toLowerCase())||d().features.toLowerCase().includes(t().toLowerCase())||d().equipment.toLowerCase().includes(t().toLowerCase())||d().notes.toLowerCase().includes(t().toLowerCase()))}),Wt(),Mt();var R=Jl();let Q;var q=r(R);{let pe=et(()=>(p(),i(()=>p().notes?"Expand":"Collapse")));ea(q,{title:"Features & Traits",get collapsed(){return p(),i(()=>p().notes)},get ariaLabel(){return e(pe)},onToggle:_})}var H=s(q,2);{var be=pe=>{var Y=Kl(),ve=Ge(Y);ra(ve);var J=s(ve,4);ra(J);var Te=s(J,4);ra(Te),Be(ve,()=>d().features,z=>vt(V,i(d).features=z,i(d))),Be(J,()=>d().equipment,z=>vt(V,i(d).equipment=z,i(d))),Be(Te,()=>d().notes,z=>vt(V,i(d).notes=z,i(d))),c(pe,Y)};k(H,pe=>{p(),i(()=>!p().notes)&&pe(be)})}l(R),P(()=>Q=ft(R,1,"notes svelte-wttn0l",null,Q,{hidden:!e(F)})),c(a,R),Rt(),S()}var Ql=u('<div class="color-picker-section svelte-1r90jgp"><h3 class="svelte-1r90jgp">Dice Colors</h3> <div class="color-inputs svelte-1r90jgp"><div class="color-input-group svelte-1r90jgp"><label for="dice-color" class="svelte-1r90jgp">Dice Color</label> <input type="color" id="dice-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="label-color" class="svelte-1r90jgp">Label Color</label> <input type="color" id="label-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="desk-color" class="svelte-1r90jgp">Background Color</label> <input type="color" id="desk-color" class="svelte-1r90jgp"/></div></div></div>'),Xl=u('<div class="loading svelte-1r90jgp"><p class="svelte-1r90jgp">Loading 3D dice...</p></div>'),Yl=u('<div class="custom-dice-selector svelte-1r90jgp"><h3 class="svelte-1r90jgp">Choose Dice to Roll</h3> <div class="dice-inputs svelte-1r90jgp"><div class="dice-input-group svelte-1r90jgp"><label for="d4" class="svelte-1r90jgp">d4</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d4" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d6" class="svelte-1r90jgp">d6</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d6" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d8" class="svelte-1r90jgp">d8</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d8" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d10" class="svelte-1r90jgp">d10</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d10" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d12" class="svelte-1r90jgp">d12</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d12" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d20" class="svelte-1r90jgp">d20</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d20" min="0" max="10"/></div></div> <div class="dice-controls svelte-1r90jgp"><button class="btn btn-primary use-enabled svelte-1r90jgp"> </button> <button class="btn btn-secondary use-enabled svelte-1r90jgp">Reset</button></div></div>'),Zl=u('<span class="crit-badge svelte-1r90jgp">CRITICAL!</span>'),er=u('<p class="svelte-1r90jgp"> </p>'),tr=u('<div class="bonus-item svelte-1r90jgp"><span class="bonus-value svelte-1r90jgp"> </span> <span class="bonus-source svelte-1r90jgp"> </span></div>'),ar=u('<div class="bonus-breakdown svelte-1r90jgp"></div>'),sr=u('<p class="modifier-text svelte-1r90jgp"> </p>'),lr=u('<button class="btn btn-follow-up svelte-1r90jgp"> </button>'),rr=u('<button class="btn btn-guided-strike svelte-1r90jgp">âš¡ Use Guided Strike (+10)</button>'),ir=u('<div class="follow-up-actions svelte-1r90jgp"><!> <!></div>'),nr=u('<div class="result-header svelte-1r90jgp"><h3 class="svelte-1r90jgp"> </h3> <!></div> <div class="result-total svelte-1r90jgp"> </div> <div class="result-details svelte-1r90jgp"><!> <!></div> <!>',1),or=u('<div role="button" tabindex="-1"><div class="modal-content svelte-1r90jgp" role="dialog" tabindex="0"><div class="modal-header svelte-1r90jgp"><h2 class="svelte-1r90jgp">Dice Roller</h2> <div class="header-buttons svelte-1r90jgp"><button class="color-btn svelte-1r90jgp" title="Customize dice colors">ðŸŽ¨</button> <button class="close-btn svelte-1r90jgp">Ã—</button></div></div> <!> <!> <div class="dice-main-area svelte-1r90jgp"><div class="dice-container svelte-1r90jgp"></div> <!></div> <div><!></div></div></div>');function cr(a,n){It(n,!1);const t=()=>Ke(V,"$character",d),[d,p]=Ut(),h=M(),S=M(),F=M(),_=Zt();let R=mt(n,"notation",12,""),Q=mt(n,"visible",8,!1),q=mt(n,"damageNotation",12,""),H=mt(n,"attackName",12,""),be=mt(n,"applyHalfDamage",8,!1),pe=mt(n,"bonusBreakdown",28,()=>[]),Y=null,ve=M(void 0),J=M(!1),Te=M(""),z=M(null);function se(){return e(z)?.resultTotal??null}let X=M(0),te=M(0),ie=M(0),Me=M(0),Ee=M(0),me=M(0),he=M(0),$=M([]),oe=M(!1),m=M("other"),E=M(!1),le=M("#051e0a"),g=M("#ffffff"),x=M("#3a2004"),O=M(!1);function I(y){return y.length===9&&y.startsWith("#")?y.substring(0,7):y}function G(y,D="ff"){return y.length===7&&y.startsWith("#")?y+D:y}function De(){if(window.DICE&&e(ve))try{Y&&e(ve)&&fa(ve,e(ve).innerHTML="");const y=e(ve).clientWidth||500,D=e(ve).clientHeight||300;Y=new window.DICE.dice_box(e(ve),{w:y,h:D}),v(J,!0)}catch(y){console.error("Error initializing dice box:",y)}}na(()=>{const y=B=>new Promise((re,Se)=>{if(document.querySelector(`script[src="${B}"]`)){re(null);return}const K=document.createElement("script");K.src=B,K.onload=()=>{re(null)},K.onerror=()=>{console.error(`Failed to load: ${B}`),Se(new Error(`Failed to load ${B}`))},document.head.appendChild(K)});setTimeout(()=>{y(`${la}/libs/three.min.js`).then(()=>y(`${la}/libs/cannon.min.js`)).then(()=>y(`${la}/libs/teal.js`)).then(()=>y(`${la}/dice.js`)).then(()=>{if(window.DICE){const B=window.DICE.getColors();v(le,I(B.dice_color)),v(g,I(B.label_color)),v(x,I(B.desk_color))}De()}).catch(B=>{console.error("Failed to load dice libraries:",B)})},100);const D=()=>{e(J)&&De()},w=B=>{Q()&&B.key==="Escape"&&o()};return window.addEventListener("resize",D),window.addEventListener("keydown",w),()=>{window.removeEventListener("resize",D),window.removeEventListener("keydown",w)}});function xe(y,D="other"){if(!Y||!e(J))return;v(z,null),v($,[]),v(oe,!1),D==="damage"&&pe([]),v(m,D),v(E,!1),Y.diceToRoll=y;const w=re=>null,B=re=>{let Se=re.resultTotal,We=re.resultString;if(be()&&(Se=Math.floor(Se/2),We=We+" (halved)"),v(z,{...re,resultTotal:Se,resultString:We}),D==="attack"||D==="check"||D==="save"){const K=re.result?.filter(j=>j===20)||[];if(K.length>0){const j=K[0];v(oe,j===20)}}if(v($,[]),console.log("Setting up follow-up actions. Type:",D,"damageNotation:",q(),"isCritical:",e(oe)),D==="attack"&&q())if(e(oe)){const K=je(q());e($).push({label:`Roll Critical Damage (${K})`,notation:K})}else e($).push({label:`Roll Damage (${q()})`,notation:q()})};Y.start_throw(w,B)}function _e(){const y=[];e(X)>0&&y.push(`${e(X)}d4`),e(te)>0&&y.push(`${e(te)}d6`),e(ie)>0&&y.push(`${e(ie)}d8`),e(Me)>0&&y.push(`${e(Me)}d10`),e(Ee)>0&&y.push(`${e(Ee)}d12`),e(me)>0&&y.push(`${e(me)}d20`);let D=y.join("+")||"1d20";return e(he)!==0&&(D+=e(he)>=0?`+${e(he)}`:`${e(he)}`),D}function He(){const y=_e();xe(y)}function je(y){return y.replace(/(\d+)d(\d+)/g,(D,w,B)=>`${parseInt(w)*2}d${B}`)}function rt(){v(X,0),v(te,0),v(ie,0),v(Me,0),v(Ee,0),v(me,0),v(he,0),v(z,null),v($,[]),v(oe,!1),v(m,"other"),v(E,!1)}function Xe(){window.DICE&&(window.DICE.setColors({dice_color:G(e(le),"ff"),label_color:G(e(g),"ff"),desk_color:e(x)}),Y&&(Y.updateDeskColor(e(x)),Y.updateDiceColors()))}function ct(){v(O,!e(O))}function N(){!e(z)||e(S)<=0||e(E)||(v(z,{...e(z),resultTotal:e(z).resultTotal+10,resultString:e(z).resultString+" + 10 (Guided Strike)"}),V.update(y=>{const D="ChannelDivinity",w=y.classFeatures.features[D];return typeof w=="number"&&w>0&&(y.classFeatures.features[D]=w-1),y}),v(E,!0))}function o(){_("close"),R(""),q(""),H(""),v(Te,""),v(z,null),v(E,!1),rt()}ze(()=>(t(),sa),()=>{v(h,t().class?sa(t().class,t().level,t().subclass).some(D=>D.name==="Guided Strike"):!1)}),ze(()=>t(),()=>{v(S,(()=>{const D=t().classFeatures.features["ChannelDivinity"];return typeof D=="number"?D:0})())}),ze(()=>(e(X),e(te),e(ie),e(Me),e(Ee),e(me),e(he)),()=>{v(F,(()=>{const y=[];e(X)>0&&y.push(`${e(X)}d4`),e(te)>0&&y.push(`${e(te)}d6`),e(ie)>0&&y.push(`${e(ie)}d8`),e(Me)>0&&y.push(`${e(Me)}d10`),e(Ee)>0&&y.push(`${e(Ee)}d12`),e(me)>0&&y.push(`${e(me)}d20`);let D=y.join("+")||"1d20";return e(he)!==0&&(D+=e(he)>=0?`+${e(he)}`:`${e(he)}`),D})())}),ze(()=>(U(R()),e(J),U(Q()),e(Te),U(q()),U(H())),()=>{if(R()&&e(J)&&Q()&&R()!==e(Te)){v(Te,R()),v(z,null),v($,[]),v(oe,!1),v(E,!1);const y=R().includes("1d20")?"attack":"other";console.log("Auto-roll triggered. notation:",R(),"damageNotation:",q(),"attackName:",H()),setTimeout(()=>xe(R(),y),200)}}),Wt();var Z={getLastRollTotal:se};Mt();var W=or();let fe;var Ie=r(W),Pe=r(Ie),Re=s(r(Pe),2),T=r(Re),b=s(T,2);l(Re),l(Pe);var ne=s(Pe,2);{var we=y=>{var D=Ql(),w=s(r(D),2),B=r(w),re=s(r(B),2);Ce(re),l(B);var Se=s(B,2),We=s(r(Se),2);Ce(We),l(Se);var K=s(Se,2),j=s(r(K),2);Ce(j),l(K),l(w),l(D),Be(re,()=>e(le),Fe=>v(le,Fe)),A("change",re,Xe),Be(We,()=>e(g),Fe=>v(g,Fe)),A("change",We,Xe),Be(j,()=>e(x),Fe=>v(x,Fe)),A("change",j,Xe),c(y,D)};k(ne,y=>{e(O)&&y(we)})}var Oe=s(ne,2);{var qe=y=>{var D=Xl();c(y,D)};k(Oe,y=>{e(J)||y(qe)})}var ye=s(Oe,2),de=r(ye);Sa(de,y=>v(ve,y),()=>e(ve));var Le=s(de,2);{var ge=y=>{var D=Yl(),w=s(r(D),2),B=r(w),re=s(r(B),2);Ce(re),l(B);var Se=s(B,2),We=s(r(Se),2);Ce(We),l(Se);var K=s(Se,2),j=s(r(K),2);Ce(j),l(K);var Fe=s(K,2),lt=s(r(Fe),2);Ce(lt),l(Fe);var it=s(Fe,2),ht=s(r(it),2);Ce(ht),l(it);var tt=s(it,2),at=s(r(tt),2);Ce(at),l(tt),l(w);var L=s(w,2),ee=r(L),f=r(ee);l(ee);var ae=s(ee,2);l(L),l(D),P(()=>{ee.disabled=!e(J),C(f,`Roll ${e(F)??""}`)}),Be(re,()=>e(X),ce=>v(X,ce)),Be(We,()=>e(te),ce=>v(te,ce)),Be(j,()=>e(ie),ce=>v(ie,ce)),Be(lt,()=>e(Me),ce=>v(Me,ce)),Be(ht,()=>e(Ee),ce=>v(Ee,ce)),Be(at,()=>e(me),ce=>v(me,ce)),A("click",ee,He),A("click",ae,rt),c(y,D)};k(Le,y=>{R()||y(ge)})}l(ye);var Ae=s(ye,2);let Ue;var ue=r(Ae);{var ke=y=>{var D=nr(),w=Ge(D),B=r(w),re=r(B,!0);l(B);var Se=s(B,2);{var We=ee=>{var f=Zl();c(ee,f)};k(Se,ee=>{e(oe)&&ee(We)})}l(w);var K=s(w,2),j=r(K,!0);l(K);var Fe=s(K,2),lt=r(Fe);{var it=ee=>{var f=er(),ae=r(f,!0);l(f),P(()=>C(ae,(e(z),i(()=>e(z).resultString)))),c(ee,f)};k(lt,ee=>{e(z),i(()=>e(z).resultString)&&ee(it)})}var ht=s(lt,2);{var tt=ee=>{var f=nt(),ae=Ge(f);{var ce=$e=>{var Ve=ar();ut(Ve,5,pe,pt,(Je,dt)=>{var _t=tr(),Tt=r(_t),Ft=r(Tt);l(Tt);var Qe=s(Tt,2),Ye=r(Qe);l(Qe),l(_t),P(()=>{C(Ft,`${e(dt),i(()=>e(dt).value>=0?"+":"")??""}${e(dt),i(()=>e(dt).value)??""}`),C(Ye,`(${e(dt),i(()=>e(dt).source)??""})`)}),c(Je,_t)}),l(Ve),c($e,Ve)},st=$e=>{var Ve=nt(),Je=Ge(Ve);{var dt=_t=>{var Tt=sr(),Ft=r(Tt);l(Tt),P(()=>C(Ft,`Modifier: ${e(z),i(()=>e(z).constant>=0?"+":"")??""}${e(z),i(()=>e(z).constant)??""}`)),c(_t,Tt)};k(Je,_t=>{e(z),i(()=>e(z).constant)&&_t(dt)},!0)}c($e,Ve)};k(ae,$e=>{U(pe()),i(()=>pe().length>0)?$e(ce):$e(st,!1)})}c(ee,f)};k(ht,ee=>{e(z),U(pe()),i(()=>e(z).constant||pe().length>0)&&ee(tt)})}l(Fe);var at=s(Fe,2);{var L=ee=>{var f=ir(),ae=r(f);ut(ae,1,()=>e($),pt,($e,Ve)=>{var Je=lr(),dt=r(Je,!0);l(Je),P(()=>C(dt,(e(Ve),i(()=>e(Ve).label)))),A("click",Je,()=>xe(e(Ve).notation,"damage")),c($e,Je)});var ce=s(ae,2);{var st=$e=>{var Ve=rr();P(()=>{Ve.disabled=e(S)<=0,ot(Ve,"title",e(S)<=0?"No Channel Divinity uses remaining":"Use Channel Divinity to add +10 to this attack roll")}),A("click",Ve,N),c($e,Ve)};k(ce,$e=>{e(h)&&e(m)==="attack"&&!e(E)&&$e(st)})}l(f),c(ee,f)};k(at,ee=>{e($),e(h),e(m),e(E),i(()=>e($).length>0||e(h)&&e(m)==="attack"&&!e(E))&&ee(L)})}P(()=>{C(re,H()?`${H()} - Result`:"Result"),C(j,(e(z),i(()=>e(z).resultTotal)))}),c(y,D)};k(ue,y=>{e(z)&&y(ke)})}l(Ae),l(Ie),l(W),P(()=>{fe=ft(W,1,"modal-overlay svelte-1r90jgp",null,fe,{hidden:!Q()}),Ue=ft(Ae,1,"roll-result svelte-1r90jgp",null,Ue,{"has-result":e(z)})}),A("click",T,ct),A("click",b,o),A("click",Ie,ja(function(y){aa.call(this,n,y)})),A("keydown",Ie,function(y){aa.call(this,n,y)}),A("click",W,o),A("keydown",W,y=>y.key==="Escape"&&o()),c(a,W),ms(n,"getLastRollTotal",se);var Ne=Rt(Z);return p(),Ne}const ha="https://api.github.com/gists";async function vr(a,n,t){if(!n)throw new Error("GitHub token is required");const d=JSON.stringify(a,null,2),p=`${a.name||"character"}_dnd.json`,h={description:t||`D&D Character: ${a.name}`,public:!1,files:{[p]:{content:d}}},S=await fetch(ha,{method:"POST",headers:{Authorization:`token ${n}`,"Content-Type":"application/json"},body:JSON.stringify(h)});if(!S.ok)throw new Error(`Failed to create gist: ${S.statusText}`);return(await S.json()).id}async function dr(a,n,t){if(!n||!t)throw new Error("GitHub token and Gist ID are required");const d=JSON.stringify(a,null,2),h={files:{[`${a.name||"character"}_dnd.json`]:{content:d}}},S=await fetch(`${ha}/${t}`,{method:"PATCH",headers:{Authorization:`token ${n}`,"Content-Type":"application/json"},body:JSON.stringify(h)});if(!S.ok)throw new Error(`Failed to update gist: ${S.statusText}`)}async function ur(a,n){if(!a)throw new Error("Gist ID is required");const t={"Content-Type":"application/json"};n&&(t.Authorization=`token ${n}`);const d=await fetch(`${ha}/${a}`,{method:"GET",headers:t});if(!d.ok)throw new Error(`Failed to load gist: ${d.statusText}`);const p=await d.json(),h=Object.values(p.files);if(h.length===0)throw new Error("No files found in gist");const F=h[0].content;try{const _=JSON.parse(F);return _.attacks&&Array.isArray(_.attacks)&&(_.attacks=_.attacks.map(R=>({...R,id:R.id||crypto.randomUUID()}))),_.classFeatures?(_.classFeatures.features||(_.classFeatures.features={}),_.classFeatures.spellSlots||(_.classFeatures.spellSlots=[]),_.classFeatures.preparedSpells===void 0&&(_.classFeatures.preparedSpells="")):_.classFeatures={features:{},spellSlots:[],preparedSpells:""},_}catch{throw new Error("Invalid character data in gist")}}function Pa(a){typeof window<"u"&&localStorage.setItem("dnd_gist_config",JSON.stringify(a))}function pr(){if(typeof window<"u"){const a=localStorage.getItem("dnd_gist_config");if(a)return JSON.parse(a)}return{}}async function fr(a,n=30){if(!a)throw new Error("GitHub token is required to list gists");const t=await fetch(`${ha}?per_page=${n}`,{method:"GET",headers:{Authorization:`token ${a}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error(`Failed to list gists: ${t.statusText}`);return await t.json()}var gr=u('<div class="error-message svelte-1jb5ckg"> </div>'),br=u('<div class="toggle-container svelte-1jb5ckg"><button type="button" class="toggle-btn svelte-1jb5ckg"> </button></div>'),mr=u('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID (leave empty to create new)</label> <input type="text" id="gistId" placeholder="Optional: existing Gist ID to update" class="svelte-1jb5ckg"/></div>'),hr=u('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),_r=u('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),yr=u('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Update (or leave unselected to create new)</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),kr=u('<div class="info-message svelte-1jb5ckg">No gists found. A new one will be created.</div>'),Sr=u('<!> <div class="form-group svelte-1jb5ckg"><label for="description" class="svelte-1jb5ckg"> </label> <input type="text" id="description" placeholder="D&amp;D Character Sheet" class="svelte-1jb5ckg"/></div>',1),xr=u('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID *</label> <input type="text" id="gistId" placeholder="Enter Gist ID (for public or your private gists)" required class="svelte-1jb5ckg"/></div>'),$r=u('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),Cr=u('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),Lr=u('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Load</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),wr=u('<div class="info-message svelte-1jb5ckg">No gists found. Enter a Gist ID manually or create a new one in Save mode.</div>'),Dr=u('<div class="modal-overlay svelte-1jb5ckg" role="button" tabindex="-1"><div class="modal-content svelte-1jb5ckg" role="dialog" tabindex="0"><div class="modal-header svelte-1jb5ckg"><h2 class="svelte-1jb5ckg"> </h2> <button class="close-btn svelte-1jb5ckg">Ã—</button></div> <div class="modal-body svelte-1jb5ckg"><!> <div class="form-group svelte-1jb5ckg"><label for="token" class="svelte-1jb5ckg"> <a href="https://github.com/settings/tokens" target="_blank" rel="noopener" class="svelte-1jb5ckg">Get token</a></label> <input type="password" id="token" placeholder="ghp_xxxxxxxxxxxxx" class="svelte-1jb5ckg"/></div> <!> <!> <div class="modal-actions svelte-1jb5ckg"><button class="btn btn-primary svelte-1jb5ckg"><!></button> <button class="btn btn-secondary svelte-1jb5ckg">Cancel</button></div></div></div></div>');function jr(a,n){It(n,!1);const t=()=>Ke(V,"$character",d),[d,p]=Ut(),h=Zt();let S=mt(n,"mode",8,"save"),F=M(""),_=M(""),R=M(""),Q=M(!1),q=M(""),H=M(!1),be=M(!1),pe=M([]),Y=M(null);const ve=pr();ve.token&&v(F,ve.token),ve.gistId&&v(_,ve.gistId),na(async()=>{e(F)&&!e(H)&&await J()});async function J(){if(e(F)){v(be,!0),v(q,"");try{v(pe,await fr(e(F))),e(_)&&v(Y,e(pe).find(o=>o.id===e(_))||null)}catch(o){v(q,o.message||"Failed to load gists"),v(pe,[])}finally{v(be,!1)}}}function Te(o){v(Y,o),v(_,o.id)}function z(){v(H,!e(H)),v(q,""),!e(H)&&e(F)&&J()}async function se(){if(!e(F)){v(q,"GitHub token is required");return}const o=e(Y)?.id||e(_);v(Q,!0),v(q,"");try{if(o)await dr(t(),e(F),o),v(_,o),Et.add("Character updated in Gist successfully!","success");else{const Z=await vr(t(),e(F),e(R));v(_,Z),Et.add(`Character saved to Gist! ID: ${Z}`,"success")}Pa({token:e(F),gistId:e(_)}),h("close")}catch(Z){v(q,Z.message||"Failed to save to Gist")}finally{v(Q,!1)}}async function X(){const o=e(Y)?.id||e(_);if(!o){v(q,"Please select a gist or enter a Gist ID");return}v(Q,!0),v(q,"");try{const Z=await ur(o,e(F)||void 0);V.set(Z),v(_,o),Pa({token:e(F),gistId:e(_)}),Et.add("Character loaded from Gist successfully!","success"),h("close")}catch(Z){v(q,Z.message||"Failed to load from Gist")}finally{v(Q,!1)}}function te(){h("close")}Mt();var ie=Dr(),Me=r(ie),Ee=r(Me),me=r(Ee),he=r(me,!0);l(me);var $=s(me,2);l(Ee);var oe=s(Ee,2),m=r(oe);{var E=o=>{var Z=gr(),W=r(Z,!0);l(Z),P(()=>C(W,e(q))),c(o,Z)};k(m,o=>{e(q)&&o(E)})}var le=s(m,2),g=r(le),x=r(g);pa(),l(g);var O=s(g,2);Ce(O),l(le);var I=s(le,2);{var G=o=>{var Z=br(),W=r(Z),fe=r(W,!0);l(W),l(Z),P(()=>{W.disabled=e(Q),C(fe,e(H)?"ðŸ“‹ Show My Gists":"âœï¸ Enter Gist ID Manually")}),A("click",W,z),c(o,Z)};k(I,o=>{(S()==="load"||S()==="save"&&e(F))&&o(G)})}var De=s(I,2);{var xe=o=>{var Z=Sr(),W=Ge(Z);{var fe=ne=>{var we=mr(),Oe=s(r(we),2);Ce(Oe),l(we),P(()=>Oe.disabled=e(Q)),Be(Oe,()=>e(_),qe=>v(_,qe)),c(ne,we)},Ie=ne=>{var we=nt(),Oe=Ge(we);{var qe=de=>{var Le=hr();c(de,Le)},ye=de=>{var Le=nt(),ge=Ge(Le);{var Ae=ue=>{var ke=yr(),Ne=s(r(ke),2);ut(Ne,5,()=>e(pe),pt,(y,D)=>{var w=_r();let B;var re=r(w),Se=r(re),We=r(Se,!0);l(Se);var K=s(Se,2),j=r(K,!0);l(K),l(re);var Fe=s(re,2),lt=r(Fe),it=r(lt);l(lt);var ht=s(lt,2),tt=r(ht);l(ht),l(Fe),l(w),P(at=>{B=ft(w,1,"gist-item svelte-1jb5ckg",null,B,{selected:e(Y)?.id===e(D).id}),w.disabled=e(Q),C(We,(e(D),i(()=>e(D).description||"Untitled"))),C(j,(e(D),i(()=>e(D).public?"ðŸŒ Public":"ðŸ”’ Private"))),C(it,`ID: ${e(D),i(()=>e(D).id)??""}`),C(tt,`Updated: ${at??""}`)},[()=>(e(D),i(()=>new Date(e(D).updated_at).toLocaleDateString()))]),A("click",w,()=>Te(e(D))),c(y,w)}),l(Ne),l(ke),c(ue,ke)},Ue=ue=>{var ke=nt(),Ne=Ge(ke);{var y=D=>{var w=kr();c(D,w)};k(Ne,D=>{e(F)&&D(y)},!0)}c(ue,ke)};k(ge,ue=>{e(pe),i(()=>e(pe).length>0)?ue(Ae):ue(Ue,!1)},!0)}c(de,Le)};k(Oe,de=>{e(be)?de(qe):de(ye,!1)},!0)}c(ne,we)};k(W,ne=>{e(H)||!e(F)?ne(fe):ne(Ie,!1)})}var Pe=s(W,2),Re=r(Pe),T=r(Re);l(Re);var b=s(Re,2);Ce(b),l(Pe),P(()=>{C(T,`Description ${e(_)?"(optional)":""}`),b.disabled=e(Q)}),Be(b,()=>e(R),ne=>v(R,ne)),c(o,Z)},_e=o=>{var Z=nt(),W=Ge(Z);{var fe=Pe=>{var Re=xr(),T=s(r(Re),2);Ce(T),l(Re),P(()=>T.disabled=e(Q)),Be(T,()=>e(_),b=>v(_,b)),c(Pe,Re)},Ie=Pe=>{var Re=nt(),T=Ge(Re);{var b=we=>{var Oe=$r();c(we,Oe)},ne=we=>{var Oe=nt(),qe=Ge(Oe);{var ye=Le=>{var ge=Lr(),Ae=s(r(ge),2);ut(Ae,5,()=>e(pe),pt,(Ue,ue)=>{var ke=Cr();let Ne;var y=r(ke),D=r(y),w=r(D,!0);l(D);var B=s(D,2),re=r(B,!0);l(B),l(y);var Se=s(y,2),We=r(Se),K=r(We);l(We);var j=s(We,2),Fe=r(j);l(j),l(Se),l(ke),P(lt=>{Ne=ft(ke,1,"gist-item svelte-1jb5ckg",null,Ne,{selected:e(Y)?.id===e(ue).id}),ke.disabled=e(Q),C(w,(e(ue),i(()=>e(ue).description||"Untitled"))),C(re,(e(ue),i(()=>e(ue).public?"ðŸŒ Public":"ðŸ”’ Private"))),C(K,`ID: ${e(ue),i(()=>e(ue).id)??""}`),C(Fe,`Updated: ${lt??""}`)},[()=>(e(ue),i(()=>new Date(e(ue).updated_at).toLocaleDateString()))]),A("click",ke,()=>Te(e(ue))),c(Ue,ke)}),l(Ae),l(ge),c(Le,ge)},de=Le=>{var ge=nt(),Ae=Ge(ge);{var Ue=ue=>{var ke=wr();c(ue,ke)};k(Ae,ue=>{e(F)&&ue(Ue)},!0)}c(Le,ge)};k(qe,Le=>{e(pe),i(()=>e(pe).length>0)?Le(ye):Le(de,!1)},!0)}c(we,Oe)};k(T,we=>{e(be)?we(b):we(ne,!1)},!0)}c(Pe,Re)};k(W,Pe=>{e(H)||!e(F)?Pe(fe):Pe(Ie,!1)},!0)}c(o,Z)};k(De,o=>{S()==="save"?o(xe):o(_e,!1)})}var He=s(De,2),je=r(He),rt=r(je);{var Xe=o=>{var Z=jt();P(()=>C(Z,S()==="save"?"Saving...":"Loading...")),c(o,Z)},ct=o=>{var Z=jt();P(()=>C(Z,S()==="save"?"Save":"Load")),c(o,Z)};k(rt,o=>{e(Q)?o(Xe):o(ct,!1)})}l(je);var N=s(je,2);l(He),l(oe),l(Me),l(ie),P(()=>{C(he,S()==="save"?"Save to GitHub Gist":"Load from GitHub Gist"),C(x,`GitHub Token ${S()==="load"?"(optional for public gists)":"(required)"} `),O.disabled=e(Q),je.disabled=e(Q),N.disabled=e(Q)}),A("click",$,te),Be(O,()=>e(F),o=>v(F,o)),A("blur",O,()=>{e(F)&&!e(H)&&J()}),A("click",je,function(...o){(S()==="save"?se:X)?.apply(this,o)}),A("click",N,te),A("click",Me,ja(function(o){aa.call(this,n,o)})),A("keydown",Me,function(o){aa.call(this,n,o)}),A("click",ie,te),A("keydown",ie,o=>o.key==="Escape"&&te()),c(a,ie),Rt(),p()}var Ar=u('<div class="loading svelte-1ngjemu">Loading D&D data...</div>'),Fr=u("<option> </option>"),Br=u('<select class="level-filter svelte-1ngjemu"><option>All Levels</option><option>Cantrip</option><!></select>'),Mr=u('<div class="no-results svelte-1ngjemu"> </div>'),Ir=u('<div class="item-meta svelte-1ngjemu"> </div>'),Rr=u('<div class="item-meta svelte-1ngjemu"> </div>'),Er=u('<button><div class="item-name svelte-1ngjemu"> </div> <!></button>'),Pr=u('<p class="higher-levels"><strong>At Higher Levels:</strong> </p>'),Tr=u('<p class="cantrip-upgrade"><strong>Cantrip Upgrade:</strong> </p>'),Hr=u('<h3 class="svelte-1ngjemu"> </h3> <p class="spell-meta svelte-1ngjemu"><!> <!></p> <p class="spell-classes"><strong>Classes:</strong> </p> <div class="spell-stats svelte-1ngjemu"><div><strong>Casting Time:</strong> </div> <div><strong>Range:</strong> </div> <div><strong>Components:</strong> <!></div> <div><strong>Duration:</strong> <!> </div></div> <p class="description svelte-1ngjemu"> </p> <!> <!>',1),Ur=u('<p class="prerequisite svelte-1ngjemu"><strong>Prerequisite:</strong> </p>'),Nr=u('<h3 class="svelte-1ngjemu"> </h3> <!> <p class="description svelte-1ngjemu"> </p> <a target="_blank" rel="noopener" class="source-link svelte-1ngjemu">View Full Details â†’</a>',1),Gr=u('<div class="item-details svelte-1ngjemu"><!></div>'),Or=u('<div class="controls svelte-1ngjemu"><div class="tabs svelte-1ngjemu"><button> </button> <button> </button></div> <div class="search-controls svelte-1ngjemu"><input type="text" placeholder="Search by name or description..." class="search-input svelte-1ngjemu"/> <!></div></div> <div class="content-container svelte-1ngjemu"><div class="items-list svelte-1ngjemu"><!></div> <!></div>',1),qr=u('<div class="modal-backdrop svelte-1ngjemu" role="presentation"><div class="modal svelte-1ngjemu" role="dialog" aria-modal="true" tabindex="-1"><div class="modal-header svelte-1ngjemu"><h2 class="svelte-1ngjemu">Browse D&D Spells & Feats</h2> <button class="close-btn svelte-1ngjemu" aria-label="Close">&times;</button></div> <div class="modal-body svelte-1ngjemu"><!></div> <div class="modal-footer svelte-1ngjemu"><button class="btn-secondary svelte-1ngjemu">Cancel</button> <button class="btn-primary svelte-1ngjemu">Add to Character Sheet</button></div></div></div>');function Wr(a,n){It(n,!1);const t=M(),d=M(),p=M();let h=mt(n,"onClose",8),S=M("spell"),F=M(!0),_=M(""),R=M(null),Q=M([]),q=M([]),H=M(null);na(async()=>{v(F,!0);try{v(Q,await Ka()),v(q,await Ws())}catch($){console.error("Failed to load data:",$)}finally{v(F,!1)}});function be($){v(H,$)}function pe($){const oe=$.match(/(\d+d\d+(?:\s*\+\s*\d+)?)/i);return oe?oe[1]:""}function Y($){const oe=$.split(/\.( |$)/)[0].trim(),m=Array.from($.matchAll(/\*\*(.*?)\*\*/g)).map(le=>le[1].replace(/\.$/,""));let E=oe;return m.length&&(E+=" | Effects: "+m.join(", ")),E}function ve(){if(e(H)){if(e(S)==="spell"){const $=e(H);V.update(oe=>{const E=[];$.range&&E.push(`Range: ${$.range}`),$.castingTime&&E.push(`Cast: ${$.castingTime}`),$.duration&&E.push(`Duration: ${$.duration}`),$.actionType==="Save"&&E.push("Saving throw spell"),$.components&&$.components.length>0&&E.push(`Components: ${$.components.join(", ")}`),$.material&&E.push(`Material: ${$.material}`);const le=E.join(" | "),g=Y($.description),x={id:crypto.randomUUID(),name:`${$.name}${$.concentration?" (C)":""}${$.ritual?" (R)":""}`,bonus:$.actionType==="Attack"?5:0,damage:pe($.description),damageType:`${$.school} (Lvl ${$.level})`,spellRef:$.name,infoNotes:le,generalNotes:g,castAtLevel:$.level};return oe.attacks=[...oe.attacks,x],oe})}else if(e(S)==="feat"){const $=e(H);V.update(oe=>{const m=`${$.name}${$.prerequisite?` (Req: ${$.prerequisite})`:""}
${$.description}
`;return oe.features=oe.features?`${oe.features}
${m}`:m,oe})}v(H,null),h()()}}ze(()=>(e(R),e(Q),e(_)),()=>{v(t,e(R)!==null?zs(Ia(e(Q),e(_)),e(R)):Ia(e(Q),e(_)))}),ze(()=>(e(q),e(_)),()=>{v(d,Ks(e(q),e(_)))}),ze(()=>(e(S),e(t),e(d)),()=>{v(p,e(S)==="spell"?e(t):e(d))}),Wt(),Mt();var J=qr(),Te=r(J),z=r(Te),se=s(r(z),2);l(z);var X=s(z,2),te=r(X);{var ie=$=>{var oe=Ar();c($,oe)},Me=$=>{var oe=Or(),m=Ge(oe),E=r(m),le=r(E);let g;var x=r(le);l(le);var O=s(le,2);let I;var G=r(O);l(O),l(E);var De=s(E,2),xe=r(De);Ce(xe);var _e=s(xe,2);{var He=W=>{var fe=Br();P(()=>{e(R),Dt(()=>{})});var Ie=r(fe);Ie.value=(Ie.__value=null)??"";var Pe=s(Ie);Pe.value=Pe.__value=0;var Re=s(Pe);ut(Re,0,()=>[1,2,3,4,5,6,7,8,9],pt,(T,b)=>{var ne=Fr(),we=r(ne);l(ne);var Oe={};P(()=>{C(we,`Level ${b??""}`),Oe!==(Oe=b)&&(ne.value=(ne.__value=b)??"")}),c(T,ne)}),l(fe),qa(fe,()=>e(R),T=>v(R,T)),c(W,fe)};k(_e,W=>{e(S)==="spell"&&W(He)})}l(De),l(m);var je=s(m,2),rt=r(je),Xe=r(rt);{var ct=W=>{var fe=Mr(),Ie=r(fe);l(fe),P(()=>C(Ie,`No ${e(S)??""}s found`)),c(W,fe)},N=W=>{var fe=nt(),Ie=Ge(fe);ut(Ie,1,()=>e(p),pt,(Pe,Re)=>{var T=Er();let b;var ne=r(T),we=r(ne,!0);l(ne);var Oe=s(ne,2);{var qe=de=>{const Le=et(()=>e(Re));var ge=Ir(),Ae=r(ge);l(ge),P(()=>C(Ae,`Level ${U(e(Le)),i(()=>e(Le).level)??""} â€¢ ${U(e(Le)),i(()=>e(Le).school)??""}`)),c(de,ge)},ye=de=>{const Le=et(()=>e(Re));var ge=nt(),Ae=Ge(ge);{var Ue=ue=>{var ke=Rr(),Ne=r(ke,!0);l(ke),P(()=>C(Ne,(U(e(Le)),i(()=>e(Le).prerequisite)))),c(ue,ke)};k(Ae,ue=>{U(e(Le)),i(()=>e(Le).prerequisite)&&ue(Ue)})}c(de,ge)};k(Oe,de=>{e(S)==="spell"?de(qe):de(ye,!1)})}l(T),P(()=>{b=ft(T,1,"item-card svelte-1ngjemu",null,b,{selected:e(H)?.name===e(Re).name}),C(we,(e(Re),i(()=>e(Re).name)))}),A("click",T,()=>be(e(Re))),c(Pe,T)}),c(W,fe)};k(Xe,W=>{e(p),i(()=>e(p).length===0)?W(ct):W(N,!1)})}l(rt);var o=s(rt,2);{var Z=W=>{var fe=Gr(),Ie=r(fe);{var Pe=T=>{const b=et(()=>e(H));var ne=Hr(),we=Ge(ne),Oe=r(we,!0);l(we);var qe=s(we,2),ye=r(qe);{var de=f=>{var ae=jt();P(()=>C(ae,`${U(e(b)),i(()=>e(b).school)??""} cantrip`)),c(f,ae)},Le=f=>{var ae=jt();P(()=>C(ae,`Level ${U(e(b)),i(()=>e(b).level)??""} ${U(e(b)),i(()=>e(b).school)??""}`)),c(f,ae)};k(ye,f=>{U(e(b)),i(()=>e(b).level===0)?f(de):f(Le,!1)})}var ge=s(ye,2);{var Ae=f=>{var ae=jt("(ritual)");c(f,ae)};k(ge,f=>{U(e(b)),i(()=>e(b).ritual)&&f(Ae)})}l(qe);var Ue=s(qe,2),ue=s(r(Ue));l(Ue);var ke=s(Ue,2),Ne=r(ke),y=s(r(Ne));l(Ne);var D=s(Ne,2),w=s(r(D));l(D);var B=s(D,2),re=s(r(B)),Se=s(re);{var We=f=>{var ae=jt();P(()=>C(ae,`(${U(e(b)),i(()=>e(b).material)??""})`)),c(f,ae)};k(Se,f=>{U(e(b)),i(()=>e(b).material)&&f(We)})}l(B);var K=s(B,2),j=s(r(K),2);{var Fe=f=>{var ae=jt("Concentration,");c(f,ae)};k(j,f=>{U(e(b)),i(()=>e(b).concentration)&&f(Fe)})}var lt=s(j,1,!0);l(K),l(ke);var it=s(ke,2),ht=r(it,!0);l(it);var tt=s(it,2);{var at=f=>{var ae=Pr(),ce=s(r(ae));l(ae),P(()=>C(ce,` ${U(e(b)),i(()=>e(b).higherLevelSlot)??""}`)),c(f,ae)};k(tt,f=>{U(e(b)),i(()=>e(b).higherLevelSlot)&&f(at)})}var L=s(tt,2);{var ee=f=>{var ae=Tr(),ce=s(r(ae));l(ae),P(()=>C(ce,` ${U(e(b)),i(()=>e(b).cantripUpgrade)??""}`)),c(f,ae)};k(L,f=>{U(e(b)),i(()=>e(b).cantripUpgrade)&&f(ee)})}P((f,ae)=>{C(Oe,(U(e(b)),i(()=>e(b).name))),C(ue,` ${f??""}`),C(y,` ${U(e(b)),i(()=>e(b).castingTime||e(b).actionType)??""}`),C(w,` ${U(e(b)),i(()=>e(b).range)??""}`),C(re,` ${ae??""}`),C(lt,(U(e(b)),i(()=>e(b).duration))),C(ht,(U(e(b)),i(()=>e(b).description)))},[()=>(U(e(b)),i(()=>e(b).classes.join(", "))),()=>(U(e(b)),i(()=>e(b).components.join(", ").toUpperCase()))]),c(T,ne)},Re=T=>{const b=et(()=>e(H));var ne=Nr(),we=Ge(ne),Oe=r(we,!0);l(we);var qe=s(we,2);{var ye=Ae=>{var Ue=Ur(),ue=s(r(Ue));l(Ue),P(()=>C(ue,` ${U(e(b)),i(()=>e(b).prerequisite)??""}`)),c(Ae,Ue)};k(qe,Ae=>{U(e(b)),i(()=>e(b).prerequisite)&&Ae(ye)})}var de=s(qe,2),Le=r(de,!0);l(de);var ge=s(de,2);P(()=>{C(Oe,(U(e(b)),i(()=>e(b).name))),C(Le,(U(e(b)),i(()=>e(b).description))),ot(ge,"href",(U(e(b)),i(()=>e(b).source)))}),c(T,ne)};k(Ie,T=>{e(S)==="spell"?T(Pe):T(Re,!1)})}l(fe),c(W,fe)};k(o,W=>{e(H)&&W(Z)})}l(je),P(()=>{g=ft(le,1,"tab svelte-1ngjemu",null,g,{active:e(S)==="spell"}),C(x,`ðŸ“œ Spells (${e(Q),i(()=>e(Q).length)??""})`),I=ft(O,1,"tab svelte-1ngjemu",null,I,{active:e(S)==="feat"}),C(G,`â­ Feats (${e(q),i(()=>e(q).length)??""})`)}),A("click",le,()=>{v(S,"spell"),v(H,null),v(_,"")}),A("click",O,()=>{v(S,"feat"),v(H,null),v(_,"")}),Be(xe,()=>e(_),W=>v(_,W)),c($,oe)};k(te,$=>{e(F)?$(ie):$(Me,!1)})}l(X);var Ee=s(X,2),me=r(Ee),he=s(me,2);l(Ee),l(Te),l(J),P(()=>he.disabled=!e(H)),A("click",se,function(...$){h()?.apply(this,$)}),A("click",me,function(...$){h()?.apply(this,$)}),A("click",he,ve),A("click",Te,ja(function($){aa.call(this,n,$)})),A("keydown",Te,function($){aa.call(this,n,$)}),A("click",J,function(...$){h()?.apply(this,$)}),A("keydown",J,$=>$.key==="Escape"&&h()()),c(a,J),Rt()}var zr=u('<link rel="icon" type="image/png" href="favicon4.png"/> <meta name="viewport" content="width=device-width, initial-scale=1"/>',1),Kr=u('<span class="character-name svelte-1uha8ag"> </span>'),Jr=u("<span> </span>"),Vr=u('<div class="spell-slots-header svelte-1uha8ag"></div>'),Qr=u("<span> </span><br/>",1),Xr=u("<span> </span>"),Yr=u('<span class="effect-tooltip"><strong> </strong><br/> <br/> <!> <!></span>'),Zr=u('<button class="effect-remove-btn svelte-1uha8ag">Ã—</button>'),ei=u('<span class="effect-badge svelte-1uha8ag" tabindex="0"> <!> <!></span>'),ti=u(`<div class="active-effects-header svelte-1uha8ag"></div> <style>.effect-badge {
            position: relative;
          }
          .effect-tooltip {
            position: absolute;
            top: 120%;
            left: 50%;
            transform: translateX(-50%);
            background: #fff;
            color: #222;
            border: 1px solid #a5b4fc;
            border-radius: 6px;
            padding: 8px 12px;
            font-size: 0.95em;
            box-shadow: 0 2px 8px rgba(0,0,0,0.12);
            z-index: 10;
            min-width: 180px;
            max-width: 260px;
            white-space: normal;
            pointer-events: none;
            opacity: 1;
            transition: opacity 0.15s;
          }</style>`,1),ai=u('<div class="rest-menu svelte-1uha8ag"><button class="rest-option svelte-1uha8ag">â˜• Short Rest</button> <button class="rest-option svelte-1uha8ag">ðŸ›ï¸ Long Rest</button></div>'),si=u('<div class="container svelte-1uha8ag"><header class="svelte-1uha8ag"><div class="header-top svelte-1uha8ag"><div class="header-title svelte-1uha8ag"><div class="title-row svelte-1uha8ag"><h1 class="svelte-1uha8ag">D&D Character Sheet</h1> <!></div> <!> <!></div> <div class="header-right svelte-1uha8ag"><div class="header-controls svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">ðŸŽ²</span><span class="btn-text svelte-1uha8ag">Roll Dice</span></button> <div class="rest-button-container svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">ðŸ˜´</span><span class="btn-text svelte-1uha8ag">Rest</span></button> <!></div> <div class="mode-toggle"><button><span class="btn-icon svelte-1uha8ag"> </span><span class="btn-text svelte-1uha8ag"> </span></button></div></div> <div class="header-search svelte-1uha8ag"><input type="text" placeholder="ðŸ” Search..." class="search-input use-enabled svelte-1uha8ag"/></div></div></div> <div class="header-actions svelte-1uha8ag"><button class="btn btn-mode svelte-1uha8ag">ðŸ“š Browse Spells & Feats</button> <button class="btn btn-secondary">Save to Gist</button> <button class="btn btn-secondary">Load from Gist</button> <button class="btn btn-secondary">Export JSON</button> <button class="btn btn-secondary">Import JSON</button> <input type="file" accept=".json" style="display: none;"/></div></header> <main class="svelte-1uha8ag"><!> <!> <!> <!> <!> <!> <!></main></div> <!> <!> <!> <!>',1);function ui(a,n){It(n,!1);const t=()=>Ke(V,"$character",h),d=()=>Ke(ta,"$isEditMode",h),p=()=>Ke(Qt,"$searchFilter",h),[h,S]=Ut();function F(){const L=[],ee=t().classFeatures.spellSlotsByLevel||{};for(let f=1;f<=9;f++){const ae=ee[f];if(ae&&ae.length>0){const ce=ae.length,st=ae.filter($e=>$e).length;L.push({level:f,available:ce-st,total:ce})}}return L}let _=M(!1),R=M(!1),Q=M(!1),q=M("save"),H=M(void 0),be=M(""),pe=M(""),Y=M(""),ve=M(!1),J=M([]),Te=M(),z=!1,se=M(!1),X=M(null);function te(L){v(X,L)}function ie(){v(X,null)}function Me(L){v(X,e(X)===L?null:L)}function Ee(){const L=[];V.update(f=>{const ae=f.hitDice.current;f.hitDice.current=Math.min(f.hitDice.max,f.hitDice.current+Math.max(1,Math.floor(f.hitDice.max/2)));const ce=f.hitDice.current-ae;if(ce>0&&L.push(`${ce} hit ${ce===1?"die":"dice"}`),f.class){const st=sa(f.class,f.level,f.subclass);f.classFeatures.features||(f.classFeatures.features={}),st.forEach($e=>{if($e.resetOn==="short"){const Ve=$e.name.replace(/\s+/g,"");if($e.type==="uses"){const Je=typeof $e.maxUses=="function"?$e.maxUses(f.level):$e.maxUses;f.classFeatures.features[Ve]=Array(Je).fill(!1),L.push($e.name)}else if($e.type==="pool"){const Je=typeof $e.maxPool=="function"?$e.maxPool(f.level):$e.maxPool;Je!==void 0&&(f.classFeatures.features[Ve]=Je,L.push($e.name))}}})}return f}),v(se,!1);const ee=L.length>0?`Short rest taken! Restored: ${L.join(", ")}`:"Short rest taken!";Et.add(ee,"success")}function me(){const L=[];V.update(f=>{const ae=f.maxHP-f.currentHP;ae>0&&L.push(`${ae} HP`),f.currentHP=f.maxHP,f.tempHP=0;const ce=f.hitDice.max-f.hitDice.current;ce>0&&L.push(`${ce} hit ${ce===1?"die":"dice"}`),f.hitDice.current=f.hitDice.max;let st=0;if(f.classFeatures.spellSlotsByLevel&&Object.keys(f.classFeatures.spellSlotsByLevel).forEach($e=>{const Ve=f.classFeatures.spellSlotsByLevel[parseInt($e)];if(Ve){const Je=Ve.filter(dt=>dt).length;st+=Je,f.classFeatures.spellSlotsByLevel[parseInt($e)]=Array(Ve.length).fill(!1)}}),st>0&&L.push(`${st} spell ${st===1?"slot":"slots"}`),f.class){const $e=sa(f.class,f.level,f.subclass);f.classFeatures.features||(f.classFeatures.features={});let Ve=!1;$e.forEach(Je=>{const dt=Je.name.replace(/\s+/g,"");if(!(Je.type==="info"||Je.type==="channelDivinity")){if(Je.type==="uses"){const _t=typeof Je.maxUses=="function"?Je.maxUses(f.level):Je.maxUses;f.classFeatures.features[dt]=Array(_t).fill(!1),Ve=!0}else if(Je.type==="pool"){const _t=typeof Je.maxPool=="function"?Je.maxPool(f.level):Je.maxPool;_t!==void 0&&(f.classFeatures.features[dt]=_t,Ve=!0)}}}),Ve&&L.push("all class features")}return f}),v(se,!1);const ee=L.length>0?`Long rest taken! Restored: ${L.join(", ")}`:"Long rest taken! Fully rested.";Et.add(ee,"success")}function he(L){v(be,""),v(pe,""),v(Y,""),v(ve,!1),v(J,[]),z=!1,typeof L=="string"?v(be,L):(v(be,L.notation),v(pe,L.damageNotation||""),v(Y,L.attackName||""),v(ve,!!L.applyHalfDamage),v(J,L.bonusBreakdown||[])),v(_,!0)}function $(L){const{notation:ee}=L.detail;v(be,""),z=!0,setTimeout(()=>{v(be,ee),v(pe,""),v(Y,"Hit Die")},0),v(_,!0)}function oe(){if(v(_,!1),z&&e(Te)){const L=e(Te).getLastRollTotal();if(L!==null){const ee=Math.max(1,L);V.update(f=>(f.hitDice.current=Math.max(0,f.hitDice.current-1),f.currentHP=Math.min(f.maxHP,f.currentHP+ee),f))}z=!1}}function m(){ta.update(L=>!L)}function E(L){L.target.closest(".rest-button-container")||v(se,!1)}na(()=>{const L=ta.subscribe(ee=>{ee?document.body.classList.remove("use-mode"):document.body.classList.add("use-mode")});return document.addEventListener("click",E),()=>{L(),document.removeEventListener("click",E)}});function le(){vs(t())}function g(){e(H)?.click()}async function x(L){const f=L.target.files?.[0];if(f)try{const ae=await ds(f);V.set(ae),alert("Character imported successfully!")}catch{alert("Failed to import character file")}}Mt();var O=si();os("1uha8ag",L=>{var ee=zr();pa(2),Ua(()=>{is.title="D&D Character Sheet"}),c(L,ee)});var I=Ge(O),G=r(I),De=r(G),xe=r(De),_e=r(xe),He=s(r(_e),2);{var je=L=>{var ee=Kr(),f=r(ee);l(ee),P(()=>C(f,`${t().name??""} (${t().level??""})`)),c(L,ee)};k(He,L=>{t().name&&L(je)})}l(_e);var rt=s(_e,2);{var Xe=L=>{var ee=Vr();ut(ee,5,F,pt,(f,ae)=>{var ce=Jr();let st;var $e=r(ce);l(ce),P(()=>{st=ft(ce,1,"slot-badge svelte-1uha8ag",null,st,{depleted:e(ae).available===0}),C($e,`Lv${e(ae).level??""}: ${e(ae).available??""}/${e(ae).total??""}`)}),c(f,ce)}),l(ee),c(L,ee)};k(rt,L=>{F().length>0&&L(Xe)})}var ct=s(rt,2);{var N=L=>{var ee=ti(),f=Ge(ee);ut(f,5,()=>t().activeStates,pt,(ae,ce,st)=>{var $e=ei(),Ve=r($e),Je=s(Ve);{var dt=Ft=>{var Qe=Yr(),Ye=r(Qe),kt=r(Ye,!0);l(Ye);var xt=s(Ye,2),Ht=s(xt,3);{var zt=gt=>{var Ct=Qr(),Ze=Ge(Ct),Lt=r(Ze);l(Ze),pa(),P(()=>C(Lt,`Attack Bonus: ${e(ce).attackBonus>0?"+":""}${e(ce).attackBonus??""}`)),c(gt,Ct)};k(Ht,gt=>{e(ce).attackBonus&&gt(zt)})}var $t=s(Ht,2);{var Nt=gt=>{var Ct=Xr(),Ze=r(Ct);l(Ct),P(()=>C(Ze,`Damage Bonus: ${e(ce).damageBonus>0?"+":""}${e(ce).damageBonus??""}`)),c(gt,Ct)};k($t,gt=>{e(ce).damageBonus&&gt(Nt)})}l(Qe),P(()=>{C(kt,e(ce).name),C(xt,` ${e(ce).description??""}`)}),c(Ft,Qe)};k(Je,Ft=>{e(X)===st&&Ft(dt)})}var _t=s(Je,2);{var Tt=Ft=>{var Qe=Zr();P(()=>ot(Qe,"title",`End ${e(ce).name??""}`)),A("click",Qe,()=>{V.update(Ye=>(Ye.activeStates&&(Ye.activeStates=Ye.activeStates.filter((kt,xt)=>xt!==st)),Ye))}),c(Ft,Qe)};k(_t,Ft=>{d()||Ft(Tt)})}l($e),P(()=>{ot($e,"aria-label",e(ce).name),C(Ve,`âœ¨ ${e(ce).name??""} `)}),A("mouseenter",$e,()=>te(st)),A("mouseleave",$e,ie),A("focus",$e,()=>te(st)),A("blur",$e,ie),A("click",$e,()=>Me(st)),c(ae,$e)}),l(f),pa(2),c(L,ee)};k(ct,L=>{t().activeStates&&t().activeStates.length>0&&L(N)})}l(xe);var o=s(xe,2),Z=r(o),W=r(Z),fe=s(W,2),Ie=r(fe),Pe=s(Ie,2);{var Re=L=>{var ee=ai(),f=r(ee),ae=s(f,2);l(ee),A("click",f,Ee),A("click",ae,me),c(L,ee)};k(Pe,L=>{e(se)&&L(Re)})}l(fe);var T=s(fe,2),b=r(T);let ne;var we=r(b),Oe=r(we,!0);l(we);var qe=s(we),ye=r(qe,!0);l(qe),l(b),l(T),l(Z);var de=s(Z,2),Le=r(de);Ce(Le),l(de),l(o),l(De);var ge=s(De,2),Ae=r(ge),Ue=s(Ae,2),ue=s(Ue,2),ke=s(ue,2),Ne=s(ke,2),y=s(Ne,2);Sa(y,L=>v(H,L),()=>e(H)),l(ge),l(G);var D=s(G,2),w=r(D);ws(w,{});var B=s(w,2);Us(B,{$$events:{rollHitDice:$}});var re=s(B,2);Fs(re,{$$events:{roll:L=>he(L.detail)}});var Se=s(re,2);qs(Se,{$$events:{roll:L=>he(L.detail)}});var We=s(Se,2);jl(We,{$$events:{roll:L=>he(L.detail)}});var K=s(We,2);zl(K,{});var j=s(K,2);Vl(j,{}),l(D),l(I);var Fe=s(I,2);Sa(cr(Fe,{get notation(){return e(be)},get damageNotation(){return e(pe)},get attackName(){return e(Y)},get applyHalfDamage(){return e(ve)},get bonusBreakdown(){return e(J)},get visible(){return e(_)},$$events:{close:oe},$$legacy:!0}),L=>v(Te,L),()=>e(Te));var lt=s(Fe,2);{var it=L=>{jr(L,{get mode(){return e(q)},$$events:{close:()=>v(R,!1)}})};k(lt,L=>{e(R)&&L(it)})}var ht=s(lt,2);{var tt=L=>{Wr(L,{onClose:()=>v(Q,!1)})};k(ht,L=>{e(Q)&&L(tt)})}var at=s(ht,2);cs(at,{}),P(()=>{ne=ft(b,1,"btn btn-mode svelte-1uha8ag",null,ne,{"use-mode":!d()}),C(Oe,d()?"ðŸ“":"ðŸŽ²"),C(ye,d()?"Edit Mode":"Use Mode")}),A("click",W,()=>v(_,!0)),A("click",Ie,()=>v(se,!e(se))),A("click",b,m),Be(Le,p,L=>us(Qt,L)),A("click",Ae,()=>v(Q,!0)),A("click",Ue,()=>{v(q,"save"),v(R,!0)}),A("click",ue,()=>{v(q,"load"),v(R,!0)}),A("click",ke,le),A("click",Ne,g),A("change",y,x),c(a,O),Rt(),S()}export{ui as component};
