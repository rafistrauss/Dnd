import{f as u,e as L,a as o,s as k,c as rt,t as wt}from"../chunks/DN9NmC1v.js";import{i as Rt}from"../chunks/Dlg-HS1s.js";import{c as ea,o as ca,a as Xa}from"../chunks/Icie54Zd.js";import{a7 as Ua,i as Ga,aZ as Ya,a_ as Za,a$ as ja,K as Vt,e as Oa,b0 as qa,T as _a,b1 as es,b2 as ts,q as as,b3 as ss,b4 as ls,b5 as is,ab as rs,d as r,r as Wa,g as ns,C as Et,b6 as et,b7 as zt,F as B,G as Pt,s as c,a4 as R,H as i,J as a,I as l,f as e,E as We,m as lt,A as G,b8 as $a,b9 as Ct,ba as na,ao as ga,bb as os}from"../chunks/swQEjlmu.js";import{c as Z,a as Lt,e as ut,i as ft,u as za,s as Qt,b as gt,d as va,f as sa,g as cs,t as Bt,h as vs,T as ds,j as us,k as ps}from"../chunks/DXoUWR_X.js";import{i as _,s as Nt,a as Xe,b as it,d as da,e as fs}from"../chunks/BEkqXdCA.js";import{p as Ft,b as Ca}from"../chunks/gdGGBrOz.js";import{b as ra,r as gs}from"../chunks/BN_VALLi.js";function ba(s,n,t=!1){if(s.multiple){if(n==null)return;if(!Ga(n))return Ya();for(var v of s.options)v.selected=n.includes(oa(v));return}for(v of s.options){var p=oa(v);if(Za(p,n)){v.selected=!0;return}}(!t||n!==void 0)&&(s.selectedIndex=-1)}function wa(s){var n=new MutationObserver(()=>{ba(s,s.__value)});n.observe(s,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Ua(()=>{n.disconnect()})}function Ka(s,n,t=n){var v=new WeakSet,p=!0;ja(s,"change",h=>{var C=h?"[selected]":":checked",I;if(s.multiple)I=[].map.call(s.querySelectorAll(C),oa);else{var y=s.querySelector(C)??s.querySelector("option:not([disabled])");I=y&&oa(y)}t(I),Vt!==null&&v.add(Vt)}),Oa(()=>{var h=n();if(s===document.activeElement){var C=qa??Vt;if(v.has(C))return}if(ba(s,h,p),p&&h===void 0){var I=s.querySelector(":checked");I!==null&&(h=oa(I),t(h))}s.__value=h,p=!1}),wa(s)}function oa(s){return"__value"in s?s.__value:s.value}const bs=Symbol("is custom element"),ms=Symbol("is html");function De(s){if(_a){var n=!1,t=()=>{if(!n){if(n=!0,s.hasAttribute("value")){var v=s.value;tt(s,"value",null),s.value=v}if(s.hasAttribute("checked")){var p=s.checked;tt(s,"checked",null),s.checked=p}}};s.__on_r=t,as(t),ss()}}function ma(s,n){var t=Aa(s);t.value===(t.value=n??void 0)||s.value===n&&(n!==0||s.nodeName!=="PROGRESS")||(s.value=n??"")}function hs(s,n){var t=Aa(s);t.checked!==(t.checked=n??void 0)&&(s.checked=n)}function tt(s,n,t,v){var p=Aa(s);_a&&(p[n]=s.getAttribute(n),n==="src"||n==="srcset"||n==="href"&&s.nodeName==="LINK")||p[n]!==(p[n]=t)&&(n==="loading"&&(s[ls]=t),t==null?s.removeAttribute(n):typeof t!="string"&&_s(s).includes(n)?s[n]=t:s.setAttribute(n,t))}function Aa(s){return s.__attributes??={[bs]:s.nodeName.includes("-"),[ms]:s.namespaceURI===es}}var Ma=new Map;function _s(s){var n=s.getAttribute("is")||s.nodeName,t=Ma.get(n);if(t)return t;Ma.set(n,t=[]);for(var v,p=s,h=Element.prototype;h!==p;){v=is(p);for(var C in v)v[C].set&&t.push(C);p=ts(p)}return t}function Be(s,n,t=n){var v=new WeakSet;ja(s,"input",async p=>{var h=p?s.defaultValue:s.value;if(h=ka(s)?xa(h):h,t(h),Vt!==null&&v.add(Vt),await rs(),h!==(h=n())){var C=s.selectionStart,I=s.selectionEnd,y=s.value.length;if(s.value=h??"",I!==null){var T=s.value.length;C===I&&I===y&&T>y?(s.selectionStart=T,s.selectionEnd=T):(s.selectionStart=C,s.selectionEnd=Math.min(I,T))}}}),(_a&&s.defaultValue!==s.value||r(n)==null&&s.value)&&(t(ka(s)?xa(s.value):s.value),Vt!==null&&v.add(Vt)),Wa(()=>{var p=n();if(s===document.activeElement){var h=qa??Vt;if(v.has(h))return}ka(s)&&p===xa(s.value)||s.type==="date"&&!p&&!s.value||p!==s.value&&(s.value=p??"")})}function ha(s,n,t=n){ja(s,"change",v=>{var p=v?s.defaultChecked:s.checked;t(p)}),(_a&&s.defaultChecked!==s.checked||r(n)==null)&&t(s.checked),Wa(()=>{var v=n();s.checked=!!v})}function ka(s){var n=s.type;return n==="number"||n==="range"}function xa(s){return s===""?null:+s}function ys(s,n,t){var v=ns(s,n);v&&v.set&&(s[n]=t,Ua(()=>{s[n]=null}))}function Fa(s){return function(...n){var t=n[0];return t.stopPropagation(),s?.apply(this,n)}}function Ba(s){return function(...n){var t=n[0];return t.preventDefault(),s?.apply(this,n)}}function la(s,n){var t=s.$$events?.[n.type],v=Ga(t)?t.slice():t==null?[]:[t];for(var p of v)p.call(this,n)}const ks="";function Ja(...s){return ra+ks+gs(s[0],s[1])}const La={paladin:{name:"Paladin",hitDice:"d10",spellcaster:!0,spellcastingAbility:"charisma",spellSlotsByLevel:{1:0,2:2,3:3,4:3,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Divine Sense",type:"uses",maxUses:(s,n=1)=>1+Math.max(1,n),resetOn:"long",description:"Detect celestials, fiends, and undead within 60 feet",minLevel:1},{name:"Lay on Hands",type:"pool",maxPool:s=>s*5,resetOn:"long",description:"Heal wounds or cure disease",minLevel:1},{name:"Divine Smite",type:"spellSlot",description:"Expend spell slot to deal extra radiant damage",minLevel:2,rollable:!0},{name:"Channel Divinity",type:"pool",maxPool:s=>s>=18?3:s>=6?2:1,resetOn:"short",description:"Sacred Weapon or Turn Undead",minLevel:3}]},fighter:{name:"Fighter",hitDice:"d10",spellcaster:!1,features:[{name:"Second Wind",type:"uses",maxUses:1,resetOn:"short",description:"Regain 1d10 + fighter level HP as bonus action",minLevel:1,rollable:!0,rollFormula:s=>`1d10+${s}`},{name:"Action Surge",type:"uses",maxUses:s=>s>=17?2:1,resetOn:"short",description:"Take one additional action on your turn",minLevel:2},{name:"Indomitable",type:"uses",maxUses:s=>s>=17?3:s>=13?2:1,resetOn:"long",description:"Reroll a failed saving throw",minLevel:9}],subclasses:{champion:{name:"Champion",features:[{name:"Improved Critical",type:"info",description:"Critical hit on 19-20",minLevel:3},{name:"Remarkable Athlete",type:"info",description:"Add half proficiency to STR/DEX/CON checks, increase long jump distance",minLevel:7},{name:"Additional Fighting Style",type:"info",description:"Choose a second fighting style",minLevel:10},{name:"Superior Critical",type:"info",description:"Critical hit on 18-20",minLevel:15},{name:"Survivor",type:"info",description:"Regain 5 + CON mod HP at start of turn if below half HP",minLevel:18}]},battlemaster:{name:"Battle Master",features:[{name:"Combat Superiority",type:"uses",maxUses:s=>s>=15?6:s>=7?5:4,resetOn:"short",description:s=>`Use superiority dice (${s>=18?"d12":s>=10?"d10":"d8"}) for maneuvers`,minLevel:3},{name:"Know Your Enemy",type:"info",description:"Learn capabilities of creatures you observe",minLevel:7},{name:"Improved Combat Superiority",type:"info",description:"Superiority dice become d10",minLevel:10},{name:"Relentless",type:"info",description:"Regain 1 superiority die if you have none at start of turn",minLevel:15}]}}},rogue:{name:"Rogue",hitDice:"d8",spellcaster:!1,features:[{name:"Sneak Attack",type:"info",description:s=>`Deal ${Math.ceil(s/2)}d6 extra damage once per turn with advantage or ally nearby`,minLevel:1,rollable:!0,rollFormula:s=>`${Math.ceil(s/2)}d6`},{name:"Cunning Action",type:"info",description:"Dash, Disengage, or Hide as a bonus action",minLevel:2},{name:"Uncanny Dodge",type:"info",description:"Use reaction to halve damage from an attack",minLevel:5},{name:"Evasion",type:"info",description:"Take no damage on successful Dex save (half on fail)",minLevel:7}]},wizard:{name:"Wizard",hitDice:"d6",spellcaster:!0,spellcastingAbility:"intelligence",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Arcane Recovery",type:"uses",maxUses:1,resetOn:"long",description:s=>`Recover spell slots totaling up to ${Math.ceil(s/2)} levels during short rest`,minLevel:1},{name:"Spell Mastery",type:"info",description:"Cast one 1st-level and one 2nd-level spell at will",minLevel:18}]},cleric:{name:"Cleric",hitDice:"d8",spellcaster:!0,spellcastingAbility:"wisdom",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Channel Divinity",type:"pool",maxPool:s=>s>=18?3:s>=6?2:1,resetOn:"short",description:"Turn Undead or domain-specific ability",minLevel:2},{name:"Destroy Undead",type:"info",description:s=>`Channel Divinity destroys undead of CR ${s>=17?4:s>=14?3:s>=11?2:s>=8?1:.5} or lower`,minLevel:5},{name:"Divine Intervention",type:"uses",maxUses:1,resetOn:"long",description:s=>`${s}% chance to succeed, implore deity for aid`,minLevel:10}],subclasses:{war:{name:"War Domain",features:[{name:"War Priest",type:"uses",maxUses:(s,n=1)=>Math.max(1,n),resetOn:"long",description:"Make one weapon attack as a bonus action",minLevel:1},{name:"Guided Strike",type:"channelDivinity",description:"Use your Channel Divinity to gain +10 to an attack roll. Make this choice after you see the roll, but before the DM says whether the attack hits or misses.",minLevel:2,resetOn:"short"},{name:"War God's Blessing",type:"channelDivinity",description:"Use reaction to grant +10 to an ally's attack roll within 30 feet. Consumes one use of Channel Divinity.",minLevel:6,resetOn:"short"},{name:"Divine Strike",type:"info",description:s=>`Deal extra ${s>=14?"2d8":"1d8"} weapon damage once per turn`,minLevel:8,rollable:!0,rollFormula:s=>s>=14?"2d8":"1d8"},{name:"Avatar of Battle",type:"info",description:"Gain resistance to nonmagical weapon damage",minLevel:17}]},life:{name:"Life Domain",features:[{name:"Disciple of Life",type:"info",description:"Healing spells restore additional 2 + spell level HP",minLevel:1},{name:"Preserve Life",type:"pool",maxPool:s=>s*5,resetOn:"short",description:"Restore HP to creatures within 30 feet",minLevel:2},{name:"Blessed Healer",type:"info",description:"Regain 2 + spell level HP when you cast healing spell",minLevel:6},{name:"Divine Strike",type:"info",description:s=>`Deal extra ${s>=14?"2d8":"1d8"} radiant damage once per turn`,minLevel:8,rollable:!0,rollFormula:s=>s>=14?"2d8":"1d8"},{name:"Supreme Healing",type:"info",description:"Maximize healing dice instead of rolling",minLevel:17}]}}},barbarian:{name:"Barbarian",hitDice:"d12",spellcaster:!1,features:[{name:"Rage",type:"uses",maxUses:s=>s>=20?1/0:s>=17?6:s>=12?5:s>=6?4:s>=3?3:2,resetOn:"long",description:s=>`+${s>=16?4:s>=9?3:2} damage, resistance to physical damage`,minLevel:1},{name:"Reckless Attack",type:"info",description:"Gain advantage on melee attacks, enemies get advantage on you",minLevel:2},{name:"Danger Sense",type:"info",description:"Advantage on Dex saves against effects you can see",minLevel:2}],subclasses:{berserker:{name:"Path of the Berserker",features:[{name:"Frenzy",type:"info",description:"While raging, make melee attack as bonus action (gain 1 exhaustion after rage)",minLevel:3},{name:"Mindless Rage",type:"info",description:"Cannot be charmed or frightened while raging",minLevel:6},{name:"Intimidating Presence",type:"info",description:"Use action to frighten creature within 30 feet",minLevel:10},{name:"Retaliation",type:"info",description:"When damaged by creature within 5 feet, make melee attack as reaction",minLevel:14}]}}}};function It(s){const n=s.toLowerCase();return La[n]||null}function ia(s,n,t){const v=It(s);if(!v)return[];const p=v.features.filter(h=>!h.minLevel||h.minLevel<=n);if(t&&v.subclasses&&v.subclasses[t]){const h=v.subclasses[t].features.filter(C=>!C.minLevel||C.minLevel<=n);return[...p,...h]}return p}function Ia(s){const n=It(s);return!n||!n.subclasses?[]:Object.keys(n.subclasses).map(t=>({id:t,name:n.subclasses[t].name}))}function Ra(s,n){const t=It(s);return!t||!t.spellcaster||!t.spellSlotsByLevel?0:t.spellSlotsByLevel[n]||0}function Ea(s,n,t){const v=It(s);return!v||!v.spellcaster?0:Math.max(1,t+n)}function xs(s,n,t){const v=It(s);return!v||!v.spellcaster?null:8+n+t}function Ss(){return Object.keys(La).map(s=>({id:s,name:La[s].name}))}var $s=u("<option> </option>"),Cs=u("<option> </option>"),ws=u('<div class="form-group svelte-172i2fj"><label for="characterSubclass" class="svelte-172i2fj">Subclass</label> <select id="characterSubclass" class="svelte-172i2fj"><option>Select Subclass</option><!></select></div>'),Ls=u('<div class="info-grid svelte-172i2fj"><div class="form-group svelte-172i2fj"><label for="characterName" class="svelte-172i2fj">Character Name</label> <input type="text" id="characterName" placeholder="Enter name" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterClass" class="svelte-172i2fj">Class</label> <select id="characterClass" class="svelte-172i2fj"><option>Select Class</option><!></select></div> <!> <div class="form-group svelte-172i2fj"><label for="characterLevel" class="svelte-172i2fj">Level</label> <input type="number" id="characterLevel" min="1" max="20" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterRace" class="svelte-172i2fj">Race</label> <input type="text" id="characterRace" placeholder="e.g., Human" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterBackground" class="svelte-172i2fj">Background</label> <input type="text" id="characterBackground" placeholder="e.g., Soldier" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterAlignment" class="svelte-172i2fj">Alignment</label> <input type="text" id="characterAlignment" placeholder="e.g., Lawful Good" class="svelte-172i2fj"/></div></div>'),Ds=u('<section class="character-info svelte-172i2fj"><div class="header svelte-172i2fj"><h2 class="svelte-172i2fj">Character Info</h2> <button class="collapse-btn svelte-172i2fj"> </button></div> <!></section>');function js(s,n){Et(n,!1);const t=()=>Xe(Z,"$character",p),v=()=>Xe(Lt,"$collapsedStates",p),[p,h]=Nt(),C=R(),I=Ss();function y(ie){const q=ie.target;Z.update(je=>(je.class=q.value,je.subclass="",je))}function T(ie){const q=ie.target;Z.update(je=>(je.subclass=q.value,je))}function le(ie){const q=ie.target;Z.update(je=>(je.level=parseInt(q.value)||1,je)),za()}function te(){Lt.update(ie=>({...ie,characterInfo:!ie.characterInfo}))}et(()=>(t(),Ia),()=>{c(C,t().class?Ia(t().class):[])}),zt(),Rt();var N=Ds(),he=i(N),Se=a(i(he),2),Fe=i(Se,!0);l(Se),l(he);var de=a(he,2);{var $e=ie=>{var q=Ls(),je=i(q),Ee=a(i(je),2);De(Ee),l(je);var ue=a(je,2),O=a(i(ue),2),se=i(O);se.value=se.__value="";var Ce=a(se);ut(Ce,1,()=>I,ft,(S,Q)=>{var A=$s(),X=i(A,!0);l(A);var Ke={};B(()=>{k(X,(e(Q),r(()=>e(Q).name))),Ke!==(Ke=(e(Q),r(()=>e(Q).id)))&&(A.value=(A.__value=(e(Q),r(()=>e(Q).id)))??"")}),o(S,A)}),l(O);var pe;wa(O),l(ue);var Pe=a(ue,2);{var x=S=>{var Q=ws(),A=a(i(Q),2),X=i(A);X.value=X.__value="";var Ke=a(X);ut(Ke,1,()=>e(C),ft,(ye,Je)=>{var Oe=Cs(),nt=i(Oe,!0);l(Oe);var F={};B(()=>{k(nt,(e(Je),r(()=>e(Je).name))),F!==(F=(e(Je),r(()=>e(Je).id)))&&(Oe.value=(Oe.__value=(e(Je),r(()=>e(Je).id)))??"")}),o(ye,Oe)}),l(A);var ce;wa(A),l(Q),B(()=>{ce!==(ce=(t(),r(()=>t().subclass)))&&(A.value=(A.__value=(t(),r(()=>t().subclass)))??"",ba(A,(t(),r(()=>t().subclass))))}),L("change",A,T),o(S,Q)};_(Pe,S=>{e(C),r(()=>e(C).length>0)&&S(x)})}var ne=a(Pe,2),oe=a(i(ne),2);De(oe),l(ne);var ge=a(ne,2),b=a(i(ge),2);De(b),l(ge);var W=a(ge,2),we=a(i(W),2);De(we),l(W);var ze=a(W,2),f=a(i(ze),2);De(f),l(ze),l(q),B(()=>{pe!==(pe=(t(),r(()=>t().class)))&&(O.value=(O.__value=(t(),r(()=>t().class)))??"",ba(O,(t(),r(()=>t().class)))),ma(oe,(t(),r(()=>t().level)))}),Be(Ee,()=>t().name,S=>it(Z,r(t).name=S,r(t))),L("change",O,y),L("change",oe,le),Be(b,()=>t().race,S=>it(Z,r(t).race=S,r(t))),Be(we,()=>t().background,S=>it(Z,r(t).background=S,r(t))),Be(f,()=>t().alignment,S=>it(Z,r(t).alignment=S,r(t))),o(ie,q)};_(de,ie=>{v(),r(()=>!v().characterInfo)&&ie($e)})}l(N),B(()=>{tt(Se,"aria-label",(v(),r(()=>v().characterInfo?"Expand":"Collapse"))),k(Fe,(v(),r(()=>v().characterInfo?"â–¼":"â–²")))}),L("click",Se,te),o(s,N),Pt(),h()}var As=u('<div class="ability-card svelte-bbv1xt"><h3 class="svelte-bbv1xt"> </h3> <input type="number" class="ability-score svelte-bbv1xt" min="1" max="30"/> <div class="ability-modifier svelte-bbv1xt"> </div> <button class="roll-btn svelte-bbv1xt">Check</button> <div class="save-row svelte-bbv1xt"><input type="checkbox" class="svelte-bbv1xt"/> <label class="svelte-bbv1xt">Save</label> <button class="roll-btn-small svelte-bbv1xt">Roll</button></div></div>'),Fs=u('<div class="proficiency-bonus svelte-bbv1xt"><label for="profBonus">Proficiency Bonus</label> <input type="number" id="profBonus" class="prof-input svelte-bbv1xt"/></div> <div class="abilities-grid svelte-bbv1xt"></div>',1),Ms=u('<section><div class="header svelte-bbv1xt"><h2 class="svelte-bbv1xt">Ability Scores</h2> <button class="collapse-btn svelte-bbv1xt"> </button></div> <!></section>');function Bs(s,n){Et(n,!1);const t=()=>Xe(va,"$abilityModifiers",C),v=()=>Xe(Z,"$character",C),p=()=>Xe(Qt,"$searchFilter",C),h=()=>Xe(Lt,"$collapsedStates",C),[C,I]=Nt(),y=R(),T=R(),le=ea(),te=[{key:"strength",label:"Strength"},{key:"dexterity",label:"Dexterity"},{key:"constitution",label:"Constitution"},{key:"intelligence",label:"Intelligence"},{key:"wisdom",label:"Wisdom"},{key:"charisma",label:"Charisma"}];function N(){za()}function he(O){const se=t()[O],Ce=`1d20${se>=0?"+":""}${se}`;le("roll",Ce)}function Se(O){const se=t()[O],Ce=v().saveProficiencies[O]?v().proficiencyBonus:0,pe=se+Ce,Pe=`1d20${pe>=0?"+":""}${pe}`;le("roll",Pe)}function Fe(){Lt.update(O=>({...O,abilityScores:!O.abilityScores}))}et(()=>p(),()=>{c(y,te.filter(({label:O})=>p()?O.toLowerCase().includes(p().toLowerCase()):!0))}),et(()=>(e(y),p()),()=>{c(T,e(y).length>0||!p()||p().toLowerCase().includes("proficiency"))}),zt(),Rt();var de=Ms();let $e;var ie=i(de),q=a(i(ie),2),je=i(q,!0);l(q),l(ie);var Ee=a(ie,2);{var ue=O=>{var se=Fs(),Ce=We(se),pe=a(i(Ce),2);De(pe),l(Ce);var Pe=a(Ce,2);ut(Pe,5,()=>e(y),ft,(x,ne)=>{let oe=()=>e(ne).key,ge=()=>e(ne).label;var b=As(),W=i(b),we=i(W,!0);l(W);var ze=a(W,2);De(ze);var f=a(ze,2),S=i(f);l(f);var Q=a(f,2),A=a(Q,2),X=i(A);De(X);var Ke=a(X,2),ce=a(Ke,2);l(A),l(b),B(ye=>{k(we,ye),k(S,`${t(),oe(),r(()=>t()[oe()]>=0?"+":"")??""}${t(),oe(),r(()=>t()[oe()])??""}`),tt(X,"id",`${oe()}-save`),tt(Ke,"for",`${oe()}-save`)},[()=>(ge(),r(()=>ge().substring(0,3).toUpperCase()))]),Be(ze,()=>v().abilities[oe()],ye=>it(Z,r(v).abilities[oe()]=ye,r(v))),L("change",ze,N),L("click",Q,()=>he(oe())),ha(X,()=>v().saveProficiencies[oe()],ye=>it(Z,r(v).saveProficiencies[oe()]=ye,r(v))),L("click",ce,()=>Se(oe())),o(x,b)}),l(Pe),Be(pe,()=>v().proficiencyBonus,x=>it(Z,r(v).proficiencyBonus=x,r(v))),o(O,se)};_(Ee,O=>{h(),r(()=>!h().abilityScores)&&O(ue)})}l(de),B(()=>{$e=gt(de,1,"ability-scores svelte-bbv1xt",null,$e,{hidden:!e(T)}),tt(q,"aria-label",(h(),r(()=>h().abilityScores?"Expand":"Collapse"))),k(je,(h(),r(()=>h().abilityScores?"â–¼":"â–²")))}),L("click",q,Fe),o(s,de),Pt(),I()}function Is(s){return Math.floor((s-10)/2)}function Da(s,n){if(!s.class)return null;const t=It(s.class);if(!t||!t.spellcaster||!t.spellcastingAbility)return null;const v=n[t.spellcastingAbility];return 8+s.proficiencyBonus+v}function Rs(s,n){if(!s.class)return 0;const t=It(s.class);return!t||!t.spellcaster||!t.spellcastingAbility?0:Is(n[t.spellcastingAbility])}var Es=u('<input type="number" id="armorClass" class="stat-input svelte-1r5hyyb"/>'),Ps=u('<input type="text" id="armorClass" readonly=""/>'),Ts=u('<div class="stat-box svelte-1r5hyyb"><label for="spellSaveDC" class="svelte-1r5hyyb">Spell Save DC</label> <input type="number" id="spellSaveDC" class="stat-input svelte-1r5hyyb" readonly="" title="8 + Proficiency Bonus + Spellcasting Ability Modifier"/></div>'),Hs=u('<span class="hit-dice-type"> </span>'),Ns=u('<div class="stats-grid svelte-1r5hyyb"><div class="stat-box svelte-1r5hyyb"><label for="armorClass" class="svelte-1r5hyyb">Armor Class</label> <!></div> <div class="stat-box svelte-1r5hyyb"><label for="initiative" class="svelte-1r5hyyb">Initiative</label> <input type="number" id="initiative" class="stat-input svelte-1r5hyyb"/></div> <div class="stat-box svelte-1r5hyyb"><label for="speed" class="svelte-1r5hyyb">Speed</label> <input type="text" id="speed" class="stat-input svelte-1r5hyyb"/></div> <!></div> <div class="hp-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Points</h3> <div class="hp-display svelte-1r5hyyb"><div class="hp-inputs svelte-1r5hyyb"><input type="number" class="hp-current svelte-1r5hyyb" min="0"/> <span class="hp-separator svelte-1r5hyyb">/</span> <input type="number" class="hp-max svelte-1r5hyyb" min="0"/></div> <div class="hp-controls svelte-1r5hyyb"><button class="hp-btn svelte-1r5hyyb">âˆ’</button> <button class="hp-btn svelte-1r5hyyb">+</button> <button class="hp-btn svelte-1r5hyyb">âˆ’5</button> <button class="hp-btn svelte-1r5hyyb">+5</button></div></div> <div class="temp-hp svelte-1r5hyyb"><label for="tempHP" class="svelte-1r5hyyb">Temp HP</label> <input type="number" id="tempHP" min="0" class="svelte-1r5hyyb"/></div></div> <div class="hit-dice-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Dice</h3> <div class="hit-dice-display svelte-1r5hyyb"><input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <span>/</span> <input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <!></div> <div class="hit-dice-controls"><label for="hitDiceCount" class="svelte-1r5hyyb">Roll</label> <input type="number" id="hitDiceCount" class="hit-dice-count-input svelte-1r5hyyb" min="1" value="1"/> <button class="btn btn-primary roll-hit-dice use-enabled svelte-1r5hyyb">ðŸŽ² Roll</button></div></div>',1),Us=u('<section><div class="header svelte-1r5hyyb"><h2 class="svelte-1r5hyyb">Combat Stats</h2> <button class="collapse-btn svelte-1r5hyyb"> </button></div> <!></section>');function Gs(s,n){Et(n,!1);const t=()=>Xe(Z,"$character",I),v=()=>Xe(va,"$abilityModifiers",I),p=()=>Xe(Qt,"$searchFilter",I),h=()=>Xe(Lt,"$collapsedStates",I),C=()=>Xe(sa,"$isEditMode",I),[I,y]=Nt(),T=R(),le=R(),te=R(),N=ea();function he(O){Z.update(se=>(se.currentHP=Math.max(0,Math.min(se.maxHP,se.currentHP+O)),se))}function Se(O=1){if(t().hitDice.current<=0){alert("No hit dice remaining!");return}if(!t().class){alert("Please select a class first!");return}const se=It(t().class);if(!se){alert("Invalid class configuration!");return}const Ce=Math.min(O,t().hitDice.current),pe=se.hitDice,Pe=v().constitution,x=Pe>=0?`+${Pe}`:`${Pe}`,ne=`${Ce}${pe}${x}`;N("rollHitDice",{notation:ne,hitDie:pe,count:Ce})}function Fe(){Lt.update(O=>({...O,combatStats:!O.combatStats}))}console.log("Active States:",t().activeStates),et(()=>(t(),v()),()=>{c(T,Da(t(),v()))}),et(()=>t(),()=>{c(le,t().activeStates&&t().activeStates.length>0?t().activeStates.reduce((O,se)=>O+(se.acBonus||0),0):0)}),et(()=>p(),()=>{c(te,!p()||"armor class".includes(p().toLowerCase())||"initiative".includes(p().toLowerCase())||"speed".includes(p().toLowerCase())||"hit points".includes(p().toLowerCase())||"hp".includes(p().toLowerCase())||"hit dice".includes(p().toLowerCase())||"spell save".includes(p().toLowerCase())||"combat".includes(p().toLowerCase()))}),zt(),Rt();var de=Us();let $e;var ie=i(de),q=a(i(ie),2),je=i(q,!0);l(q),l(ie);var Ee=a(ie,2);{var ue=O=>{var se=Ns(),Ce=We(se),pe=i(Ce),Pe=a(i(pe),2);{var x=P=>{var Y=Es();De(Y),Be(Y,()=>t().armorClass,Te=>it(Z,r(t).armorClass=Te,r(t))),o(P,Y)},ne=P=>{var Y=Ps();De(Y),B(()=>{ma(Y,(e(le),t(),r(()=>e(le)!==0?`${t().armorClass} â†’ ${t().armorClass+e(le)}`:`${t().armorClass}`))),gt(Y,1,cs(e(le)!==0?"stat-input ac-enhanced":"stat-input"),"svelte-1r5hyyb"),tt(Y,"title",e(le)!==0?"Base AC plus active effect bonuses":"Base Armor Class")}),o(P,Y)};_(Pe,P=>{C()?P(x):P(ne,!1)})}l(pe);var oe=a(pe,2),ge=a(i(oe),2);De(ge),l(oe);var b=a(oe,2),W=a(i(b),2);De(W),l(b);var we=a(b,2);{var ze=P=>{var Y=Ts(),Te=a(i(Y),2);De(Te),l(Y),B(()=>ma(Te,e(T))),o(P,Y)};_(we,P=>{e(T)!==null&&P(ze)})}l(Ce);var f=a(Ce,2),S=a(i(f),2),Q=i(S),A=i(Q);De(A);var X=a(A,4);De(X),l(Q);var Ke=a(Q,2),ce=i(Ke),ye=a(ce,2),Je=a(ye,2),Oe=a(Je,2);l(Ke),l(S);var nt=a(S,2),F=a(i(nt),2);De(F),l(nt),l(f);var E=a(f,2),j=a(i(E),2),d=i(j);De(d);var Ue=a(d,4);De(Ue);var ve=a(Ue,2);{var _e=P=>{const Y=lt(()=>(G(It),t(),r(()=>It(t().class))));var Te=rt(),Ye=We(Te);{var He=V=>{const be=lt(()=>(v(),r(()=>v().constitution)));var Ie=Hs(),qe=i(Ie);l(Ie),B(()=>k(qe,`(${G(e(Y)),r(()=>e(Y).hitDice)??""}${(e(be)>=0?`+${e(be)}`:e(be))??""})`)),o(V,Ie)};_(Ye,V=>{e(Y)&&V(He)})}o(P,Te)};_(ve,P=>{t(),r(()=>t().class)&&P(_e)})}l(j);var fe=a(j,2),D=a(i(fe),2),ke=a(D,2);l(fe),l(E),B(()=>{tt(A,"max",(t(),r(()=>t().maxHP))),tt(d,"max",(t(),r(()=>t().hitDice.max))),tt(D,"max",(t(),r(()=>t().hitDice.current))),ke.disabled=(t(),r(()=>t().hitDice.current<=0||!t().class))}),Be(ge,()=>t().initiative,P=>it(Z,r(t).initiative=P,r(t))),Be(W,()=>t().speed,P=>it(Z,r(t).speed=P,r(t))),Be(A,()=>t().currentHP,P=>it(Z,r(t).currentHP=P,r(t))),Be(X,()=>t().maxHP,P=>it(Z,r(t).maxHP=P,r(t))),L("click",ce,()=>he(-1)),L("click",ye,()=>he(1)),L("click",Je,()=>he(-5)),L("click",Oe,()=>he(5)),Be(F,()=>t().tempHP,P=>it(Z,r(t).tempHP=P,r(t))),Be(d,()=>t().hitDice.current,P=>it(Z,r(t).hitDice.current=P,r(t))),Be(Ue,()=>t().hitDice.max,P=>it(Z,r(t).hitDice.max=P,r(t))),L("input",D,P=>{const Y=P.target,Te=parseInt(Y.value);Te>t().hitDice.current&&(Y.value=String(t().hitDice.current)),Te<1&&(Y.value="1")}),L("click",ke,()=>{const P=document.getElementById("hitDiceCount"),Y=parseInt(P?.value||"1");Se(Y)}),o(O,se)};_(Ee,O=>{h(),r(()=>!h().combatStats)&&O(ue)})}l(de),B(()=>{$e=gt(de,1,"combat-stats svelte-1r5hyyb",null,$e,{hidden:!e(te)}),tt(q,"aria-label",(h(),r(()=>h().combatStats?"Expand":"Collapse"))),k(je,(h(),r(()=>h().combatStats?"â–¼":"â–²")))}),L("click",q,Fe),o(s,de),Pt(),y()}const Sa={acrobatics:"dexterity",animalHandling:"wisdom",arcana:"intelligence",athletics:"strength",deception:"charisma",history:"intelligence",insight:"wisdom",intimidation:"charisma",investigation:"intelligence",medicine:"wisdom",nature:"intelligence",perception:"wisdom",performance:"charisma",persuasion:"charisma",religion:"intelligence",sleightOfHand:"dexterity",stealth:"dexterity",survival:"wisdom"};var Os=u('<div class="skill-row svelte-1f1pl16"><input type="checkbox" class="svelte-1f1pl16"/> <label class="svelte-1f1pl16"> <span class="ability-tag svelte-1f1pl16"> </span></label> <span class="skill-modifier svelte-1f1pl16"> </span> <button class="roll-btn svelte-1f1pl16">Roll</button></div>'),qs=u('<div class="skills-grid svelte-1f1pl16"></div>'),Ws=u('<section><div class="header svelte-1f1pl16"><h2 class="svelte-1f1pl16">Skills</h2> <button class="collapse-btn svelte-1f1pl16"> </button></div> <!></section>');function zs(s,n){Et(n,!1);const t=()=>Xe(va,"$abilityModifiers",C),v=()=>Xe(Z,"$character",C),p=()=>Xe(Qt,"$searchFilter",C),h=()=>Xe(Lt,"$collapsedStates",C),[C,I]=Nt(),y=R(),T=R(),le=ea(),te=[{key:"acrobatics",label:"Acrobatics"},{key:"animalHandling",label:"Animal Handling"},{key:"arcana",label:"Arcana"},{key:"athletics",label:"Athletics"},{key:"deception",label:"Deception"},{key:"history",label:"History"},{key:"insight",label:"Insight"},{key:"intimidation",label:"Intimidation"},{key:"investigation",label:"Investigation"},{key:"medicine",label:"Medicine"},{key:"nature",label:"Nature"},{key:"perception",label:"Perception"},{key:"performance",label:"Performance"},{key:"persuasion",label:"Persuasion"},{key:"religion",label:"Religion"},{key:"sleightOfHand",label:"Sleight of Hand"},{key:"stealth",label:"Stealth"},{key:"survival",label:"Survival"}];function N(ue){const O=Sa[ue],se=t()[O],Ce=v().skillProficiencies[ue]?v().proficiencyBonus:0;return se+Ce}function he(ue){const O=N(ue),se=`1d20${O>=0?"+":""}${O}`;le("roll",se)}function Se(){Lt.update(ue=>({...ue,skills:!ue.skills}))}et(()=>p(),()=>{c(y,te.filter(({label:ue})=>p()?ue.toLowerCase().includes(p().toLowerCase()):!0))}),et(()=>e(y),()=>{c(T,e(y).length>0)}),zt(),Rt();var Fe=Ws();let de;var $e=i(Fe),ie=a(i($e),2),q=i(ie,!0);l(ie),l($e);var je=a($e,2);{var Ee=ue=>{var O=qs();ut(O,5,()=>e(y),ft,(se,Ce)=>{let pe=()=>e(Ce).key,Pe=()=>e(Ce).label;const x=lt(()=>(G(Sa),pe(),r(()=>Sa[pe()]))),ne=lt(()=>(pe(),r(()=>N(pe()))));var oe=Os(),ge=i(oe);De(ge);var b=a(ge,2),W=i(b),we=a(W),ze=i(we);l(we),l(b);var f=a(b,2),S=i(f);l(f);var Q=a(f,2);l(oe),B(A=>{tt(ge,"id",pe()),tt(b,"for",pe()),k(W,`${Pe()??""} `),k(ze,`(${A??""})`),k(S,`${e(ne)>=0?"+":""}${e(ne)??""}`)},[()=>(G(e(x)),r(()=>e(x).substring(0,3).toUpperCase()))]),ha(ge,()=>v().skillProficiencies[pe()],A=>it(Z,r(v).skillProficiencies[pe()]=A,r(v))),L("click",Q,()=>he(pe())),o(se,oe)}),l(O),o(ue,O)};_(je,ue=>{h(),r(()=>!h().skills)&&ue(Ee)})}l(Fe),B(()=>{de=gt(Fe,1,"skills svelte-1f1pl16",null,de,{hidden:!e(T)}),tt(ie,"aria-label",(h(),r(()=>h().skills?"Expand":"Collapse"))),k(q,(h(),r(()=>h().skills?"â–¼":"â–²")))}),L("click",ie,Se),o(s,Fe),Pt(),I()}let ua=null,pa=null;async function Va(){if(ua)return ua;try{return ua=await(await fetch(Ja("/data/spells.json"))).json(),ua||[]}catch(s){return console.error("Failed to load spells:",s),[]}}async function Ks(){if(pa)return pa;try{return pa=await(await fetch(Ja("/data/feats.json"))).json(),pa||[]}catch(s){return console.error("Failed to load feats:",s),[]}}function Pa(s,n){if(!n.trim())return s;const t=n.toLowerCase();return s.filter(v=>v.name.toLowerCase().includes(t)||v.school.toLowerCase().includes(t)||v.classes.some(p=>p.toLowerCase().includes(t))||v.description.toLowerCase().includes(t))}function Js(s,n){return n===null?s:s.filter(t=>t.level===n)}function Vs(s,n){if(!n.trim())return s;const t=n.toLowerCase();return s.filter(v=>v.name.toLowerCase().includes(t)||v.description.toLowerCase().includes(t))}function fa(s){const n=s.description,t=/\b(Strength|Dexterity|Constitution|Intelligence|Wisdom|Charisma)\s+saving\s+throw/i,v=n.match(t);if(!v)return null;const p=v[1].toLowerCase(),C=/half\s+(?:as\s+much\s+)?damage\s+on\s+a\s+successful(?:\s+save)?/i.test(n),y=/saving\s+throw\s+or\s+take.*?damage/i.test(n)&&!C;return{ability:p,halfDamageOnSave:C,noDamageOnSave:y}}function Qs(s){const n=s.description;return/(plus|add)\s+your\s+spellcasting\s+(ability\s+)?modifier/i.test(n)}function Ta(s){const n=s.description.toLowerCase(),v=["takes","take","deals","deal","damage equal to","force damage","fire damage","cold damage","lightning damage","thunder damage","acid damage","poison damage","necrotic damage","radiant damage","psychic damage","regain","regains","hit point"].some(C=>n.includes(C));return["bonus to attack","bonus to damage","bonus to ac","gains a +","gain a +","+1 bonus","+2 bonus","+3 bonus","advantage on","becomes a magic weapon"].some(C=>n.includes(C))&&!v}function Xs(s){const n=s.description;let t=0,v=0,p=0,h="";const C=n.match(/\+(\d+)\s+bonus\s+to\s+attack\s+rolls\s+and\s+damage\s+rolls/i);if(C){const y=parseInt(C[1]);t=y,v=y,h=`+${y} to attack and damage rolls`}s.name==="Bless"&&(h="Add 1d4 to attack rolls and saves");const I=n.match(/\+(\d+)\s+bonus\s+to\s+AC/i);return I&&(p=parseInt(I[1]),h=`+${p} to AC`),s.name==="Haste"&&(h="+2 AC, doubled speed, extra action"),h||t!==0||v!==0||p!==0?{attackBonus:t,damageBonus:v,acBonus:p,description:h||s.description.substring(0,100)}:null}var Ys=u('<button class="btn-remove svelte-14o91c5">Ã—</button>'),Zs=u('<div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Bonus</label> <input type="number" class="attack-bonus svelte-14o91c5"/></div>'),el=u('<div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Damage</label> <input type="text" placeholder="e.g., 2d6+3" class="attack-damage svelte-14o91c5"/></div>'),tl=u('<div class="spell-info-loading svelte-14o91c5">Loading spell info...</div>'),al=u('<div class="spell-notes svelte-14o91c5"><h4 class="svelte-14o91c5">General Notes</h4> <p> </p></div>'),sl=u('<li class="svelte-14o91c5"><strong>At Higher Levels:</strong> </li>'),ll=u('<ul class="svelte-14o91c5"><li class="svelte-14o91c5"><strong>Level:</strong> </li> <li class="svelte-14o91c5"><strong>Casting Time:</strong> </li> <li class="svelte-14o91c5"><strong>Range:</strong> </li> <li class="svelte-14o91c5"><strong>Components:</strong> <!></li> <li class="svelte-14o91c5"><strong>Duration:</strong> <!> </li> <li class="svelte-14o91c5"><strong>Description:</strong> </li> <!></ul>'),il=u('<span class="scaled-damage svelte-14o91c5" style="margin-left: 8px;"> </span>'),rl=u('<span class="scaled-damage svelte-14o91c5">(Half damage)</span>'),nl=u('<span class="scaled-damage svelte-14o91c5">(No damage)</span>'),ol=u('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> <!> <!></label></div>'),cl=u("<option> </option>"),vl=u('<span class="scaled-damage svelte-14o91c5"><!> </span>'),dl=u('<span class="scaled-damage svelte-14o91c5"> </span>'),ul=u('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> Target is Fiend or Undead <!></label></div>'),pl=u('<div class="spell-level-selector svelte-14o91c5"><label class="svelte-14o91c5">Cast at Level:</label> <select class="spell-level-select use-enabled svelte-14o91c5"></select> <!></div> <!>',1),fl=u('<div class="spell-level-selector svelte-14o91c5"><span style="color: #dc3545; font-weight: bold;">No spell slots available!</span></div>'),gl=u('<!> <div class="spell-info svelte-14o91c5"><div class="spell-info-header svelte-14o91c5" role="button" tabindex="0"><h4 class="svelte-14o91c5">Spell Info</h4> <button class="collapse-btn-small svelte-14o91c5"> </button></div> <!></div> <!> <!>',1),bl=u('<div class="spell-info-missing svelte-14o91c5">Spell info not found.</div>'),ml=u('<div class="attack-notes svelte-14o91c5"><label class="svelte-14o91c5">Notes</label> <textarea placeholder="e.g., DC 15 Dex save, Range 120 ft, Concentration" class="notes-input svelte-14o91c5" rows="2"></textarea></div>'),hl=u('<button class="btn btn-primary">Roll Attack</button>'),_l=u('<button class="btn btn-success">Cast Spell</button>'),yl=u('<button class="btn btn-secondary"><!></button>'),kl=u('<button class="btn btn-secondary">Roll Damage</button>'),xl=u('<div class="attack-card svelte-14o91c5"><div class="attack-header svelte-14o91c5"><input type="text" placeholder="Attack name" class="attack-name svelte-14o91c5"/> <!></div> <div class="attack-details svelte-14o91c5"><!> <!> <div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Type</label> <input type="text" placeholder="e.g., slashing" class="attack-type svelte-14o91c5"/></div></div> <!> <!> <div class="attack-actions svelte-14o91c5"><!> <!></div></div>'),Sl=u('<p class="no-attacks svelte-14o91c5">No attacks added yet. Click "Add Attack" to create one.</p>'),$l=u('<p class="no-attacks svelte-14o91c5">No attacks match your search.</p>'),Cl=u('<button class="btn-remove svelte-14o91c5">Ã—</button>'),wl=u('<div class="state-card svelte-14o91c5"><div class="state-header svelte-14o91c5"><input type="text" placeholder="Effect name (e.g., Magic Weapon)" class="state-name svelte-14o91c5"/> <!></div> <div class="state-details svelte-14o91c5"><div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Attack Bonus</label> <input type="number" class="state-bonus svelte-14o91c5"/></div> <div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Damage Bonus</label> <input type="number" class="state-bonus svelte-14o91c5"/></div></div> <div class="state-description svelte-14o91c5"><label class="svelte-14o91c5">Description</label> <input type="text" placeholder="e.g., +1 to attack and damage rolls (Magic Weapon)" class="state-desc-input svelte-14o91c5"/></div></div>'),Ll=u('<div class="states-list svelte-14o91c5"></div>'),Dl=u('<p class="no-states svelte-14o91c5">No active effects. Add spell effects that modify your attacks.</p>'),jl=u('<button class="btn btn-secondary">Add Attack</button> <div class="attacks-list svelte-14o91c5"><!> <!></div> <div class="active-states-section svelte-14o91c5"><h3 class="svelte-14o91c5">Active Spell Effects</h3> <p class="section-description svelte-14o91c5">Effects that modify attack and damage rolls (e.g., Magic Weapon, Bless)</p> <button class="btn btn-secondary">Add Effect</button> <!></div>',1),Al=u('<section><div class="header svelte-14o91c5"><h2 class="svelte-14o91c5">Attacks & Spells</h2> <button class="collapse-btn svelte-14o91c5"> </button></div> <!></section>');function Fl(s,n){Et(n,!1);const t=()=>Xe(Z,"$character",I),v=()=>Xe(va,"$abilityModifiers",I),p=()=>Xe(Qt,"$searchFilter",I),h=()=>Xe(Lt,"$collapsedStates",I),C=()=>Xe(sa,"$isEditMode",I),[I,y]=Nt(),T=R(),le=R(),te=ea();let N=R({});function he(f){$a(N,e(N)[f]=!e(N)[f]),c(N,{...e(N)})}function Se(f){return f.description.toLowerCase().includes("regain")&&(f.description.toLowerCase().includes("hit point")||f.description.toLowerCase().includes("hp"))}function Fe(){Z.update(f=>(f.attacks=[...f.attacks,{id:crypto.randomUUID(),name:"",bonus:0,damage:"",damageType:"",notes:""}],f))}function de(f){Z.update(S=>(S.attacks=S.attacks.filter(Q=>Q.id!==f),S))}function $e(f){let S=f.damage,Q=!1;if(f.spellRef){const ce=ue(f.spellRef);if(ce&&ce.level>0){const ye=f.castAtLevel||ce.level;if(!O(ye)){Bt.add(`No level ${ye} spell slots available!`,"error");return}const Oe=fa(ce);Oe&&f.targetSucceededSave&&Oe.noDamageOnSave?S="0":(Q=Oe?.halfDamageOnSave&&f.targetSucceededSave||!1,S=se(f,ce))}}else if(t().activeStates&&t().activeStates.length>0){let ce=0;for(const ye of t().activeStates)ce+=ye.damageBonus;if(ce!==0&&S){const ye=S.match(/(\d+d\d+)([+-]\d+)?/);if(ye){const[,Je,Oe]=ye,F=(Oe?parseInt(Oe):0)+ce;S=`${Je}${F>=0?"+":""}${F}`}}}const A=[];f.bonus!==0&&A.push({value:f.bonus,source:"base"});let X=f.bonus;if(t().activeStates)for(const ce of t().activeStates)ce.attackBonus!==0&&(A.push({value:ce.attackBonus,source:ce.name.toLowerCase()}),X+=ce.attackBonus);let Ke;Ke=`1d20${X>=0?"+":""}${X}`,te("roll",{notation:Ke,damageNotation:S,attackName:f.name,applyHalfDamage:Q,bonusBreakdown:A})}function ie(f){if(!f.damage){Bt.add(`${f.name}: No damage specified`,"error");return}let S=f.damage,Q=!1;const A=[];if(f.spellRef){const X=ue(f.spellRef);if(X&&X.level>0){const Ke=f.castAtLevel||X.level;if(!O(Ke)){Bt.add(`No level ${Ke} spell slots available!`,"error");return}const ye=fa(X);ye&&f.targetSucceededSave&&ye.noDamageOnSave?S="0":(Q=ye?.halfDamageOnSave&&f.targetSucceededSave||!1,S=se(f,X))}}else{const X=S.match(/(\d+d\d+)([+-]\d+)?/);if(X){const[,Ke,ce]=X,ye=ce?parseInt(ce):0;if(ye!==0&&A.push({value:ye,source:"base"}),t().activeStates&&t().activeStates.length>0){let Je=0;for(const Oe of t().activeStates)Oe.damageBonus!==0&&(A.push({value:Oe.damageBonus,source:Oe.name.toLowerCase()}),Je+=Oe.damageBonus);if(Je!==0){const Oe=ye+Je;S=`${Ke}${Oe>=0?"+":""}${Oe}`}}}}te("roll",{notation:S,attackName:f.name,applyHalfDamage:Q,bonusBreakdown:A})}function q(){Lt.update(f=>({...f,attacks:!f.attacks}))}let je=R([]),Ee=R(!1);ca(async()=>{c(je,await Va()),c(Ee,!0)});function ue(f){return e(je).find(S=>S.name===f)}function O(f){t().classFeatures.spellSlotsByLevel||it(Z,r(t).classFeatures.spellSlotsByLevel={},r(t)),t().classFeatures.spellSlotsByLevel[f]||it(Z,r(t).classFeatures.spellSlotsByLevel[f]=Array(2).fill(!1),r(t));const Q=t().classFeatures.spellSlotsByLevel[f].findIndex(A=>!A);return Q===-1?!1:(Z.update(A=>(A.classFeatures.spellSlotsByLevel||(A.classFeatures.spellSlotsByLevel={}),A.classFeatures.spellSlotsByLevel[f]||(A.classFeatures.spellSlotsByLevel[f]=Array(2).fill(!1)),A.classFeatures.spellSlotsByLevel[f][Q]=!0,A)),!0)}function se(f,S){let Q=f.damage,A=0,X=0;if(Qs(S)&&(X+=Rs(t(),v())),t().activeStates)for(const j of t().activeStates)X+=j.damageBonus;if(S.higherLevelSlot&&f.castAtLevel){const j=S.level,Ue=(f.castAtLevel||j)-j;if(Ue>0){const ve=S.higherLevelSlot.match(/(\d+)d(\d+)\s+for\s+each.*?level\s+above/i);if(ve){const[,_e]=ve;A+=Ue*parseInt(_e)}}}if(f.targetIsFiendOrUndead&&S.description.includes("Fiend or an Undead")){const j=S.description.match(/increases by (\d+)d(\d+) if.*?Fiend or.*?Undead/i);if(j){const[,d]=j;A+=parseInt(d)}}const Ke=Q.match(/(\d+)d(\d+)([+-]\d+)?/);if(!Ke)return X!==0?X>=0?`${X}`:`${X}`:Q||"0";const[,ce,ye,Je]=Ke,Oe=parseInt(ce)+A,F=(Je?parseInt(Je):0)+X;let E=`${Oe}d${ye}`;return F!==0&&(E+=F>=0?`+${F}`:`${F}`),E}function Ce(f){const S=[];for(let A=f.level;A<=9;A++){const X=t().classFeatures.spellSlotsByLevel?.[A];X&&X.length>0&&S.push(A)}return S}function pe(){Z.update(f=>(f.activeStates||(f.activeStates=[]),f.activeStates=[...f.activeStates,{name:"",attackBonus:0,damageBonus:0,description:""}],f))}function Pe(f){Z.update(S=>(S.activeStates&&(S.activeStates=S.activeStates.filter((Q,A)=>A!==f)),S))}function x(f){const S=ue(f.spellRef);if(!S){Bt.add("Spell not found","error");return}const Q=f.castAtLevel||S.level;if(Q>0&&!O(Q)){Bt.add(`No level ${Q} spell slots available!`,"error");return}const A=Xs(S);if(!A){Bt.add(`${S.name} cast! Check spell description for effects.`,"info");return}Z.update(X=>(X.activeStates||(X.activeStates=[]),X.activeStates=X.activeStates.filter(Ke=>Ke.name!==S.name),X.activeStates=[...X.activeStates,{name:S.name,attackBonus:A.attackBonus,damageBonus:A.damageBonus,acBonus:A.acBonus,description:A.description}],X)),Bt.add(`${S.name} cast! Effect added to Active Spell Effects.`,"success")}et(()=>(t(),e(N)),()=>{if(t()&&t().attacks)for(const f of t().attacks)f.spellRef&&e(N)[f.id]===void 0&&$a(N,e(N)[f.id]=!0)}),et(()=>(t(),p()),()=>{c(T,t().attacks.filter(f=>{if(!p())return!0;const S=p().toLowerCase();return f.name.toLowerCase().includes(S)||f.damageType.toLowerCase().includes(S)}).sort((f,S)=>!f.spellRef&&S.spellRef?-1:f.spellRef&&!S.spellRef?1:0))}),et(()=>(p(),e(T)),()=>{c(le,!p()||e(T).length>0||"attack".includes(p().toLowerCase())||"spell".includes(p().toLowerCase()))}),zt(),Rt();var ne=Al();let oe;var ge=i(ne),b=a(i(ge),2),W=i(b,!0);l(b),l(ge);var we=a(ge,2);{var ze=f=>{var S=jl(),Q=We(S),A=a(Q,2),X=i(A);ut(X,1,()=>e(T),j=>j.id,(j,d,Ue)=>{var ve=xl(),_e=i(ve),fe=i(_e);De(fe);var D=a(fe,2);{var ke=U=>{var z=Ys();L("click",z,()=>de(e(d).id)),o(U,z)};_(D,U=>{C()&&U(ke)})}l(_e);var P=a(_e,2),Y=i(P);{var Te=U=>{var z=Zs(),ae=a(i(z),2);De(ae),l(z),Be(ae,()=>e(d).bonus,Ne=>(e(d).bonus=Ne,Ct(()=>(e(T),t(),p())))),o(U,z)};_(Y,U=>{e(d),r(()=>e(d).bonus!==0&&e(d).bonus!==void 0)&&U(Te)})}var Ye=a(Y,2);{var He=U=>{var z=el(),ae=a(i(z),2);De(ae),l(z),Be(ae,()=>e(d).damage,Ne=>(e(d).damage=Ne,Ct(()=>(e(T),t(),p())))),o(U,z)};_(Ye,U=>{e(d),r(()=>e(d).damage&&e(d).damage.trim()!=="")&&U(He)})}var V=a(Ye,2),be=a(i(V),2);De(be),l(V),l(P);var Ie=a(P,2);{var qe=U=>{var z=rt(),ae=We(z);{var Ne=Qe=>{var H=tl();o(Qe,H)},xe=Qe=>{const H=lt(()=>(e(d),r(()=>ue(e(d).spellRef))));var at=rt(),ot=We(at);{var $=m=>{const M=lt(()=>(G(fa),G(e(H)),r(()=>fa(e(H)))));var J=gl(),Re=We(J);{var Ge=ct=>{var pt=al(),St=a(i(pt),2),Ht=i(St,!0);l(St),l(pt),B(()=>k(Ht,(e(d),r(()=>e(d).generalNotes)))),o(ct,pt)};_(Re,ct=>{e(d),r(()=>e(d).generalNotes)&&ct(Ge)})}var Ze=a(Re,2),Ae=i(Ze),vt=a(i(Ae),2),dt=i(vt,!0);l(vt),l(Ae);var Tt=a(Ae,2);{var bt=ct=>{var pt=ll(),St=i(pt),Ht=a(i(St));l(St);var _t=a(St,2),jt=a(i(_t));l(_t);var mt=a(_t,2),Ut=a(i(mt));l(mt);var qt=a(mt,2),Xt=a(i(qt)),st=a(Xt);{var Mt=ht=>{var yt=wt();B(()=>k(yt,`(${G(e(H)),r(()=>e(H).material)??""})`)),o(ht,yt)};_(st,ht=>{G(e(H)),r(()=>e(H).material)&&ht(Mt)})}l(qt);var Wt=a(qt,2),Kt=a(i(Wt),2);{var Yt=ht=>{var yt=wt("Concentration,");o(ht,yt)};_(Kt,ht=>{G(e(H)),r(()=>e(H).concentration)&&ht(Yt)})}var kt=a(Kt,1,!0);l(Wt);var At=a(Wt,2),$t=a(i(At));l(At);var Gt=a(At,2);{var Jt=ht=>{var yt=sl(),Ot=a(i(yt));l(yt),B(()=>k(Ot,` ${G(e(H)),r(()=>e(H).higherLevelSlot)??""}`)),o(ht,yt)};_(Gt,ht=>{G(e(H)),r(()=>e(H).higherLevelSlot)&&ht(Jt)})}l(pt),B(ht=>{k(Ht,` ${G(e(H)),r(()=>e(H).level)??""}`),k(jt,` ${G(e(H)),r(()=>e(H).castingTime||e(H).actionType)??""}`),k(Ut,` ${G(e(H)),r(()=>e(H).range)??""}`),k(Xt,` ${ht??""}`),k(kt,(G(e(H)),r(()=>e(H).duration))),k($t,` ${G(e(H)),r(()=>e(H).description)??""}`)},[()=>(G(e(H)),r(()=>e(H).components.join(", ")))]),o(ct,pt)};_(Tt,ct=>{e(N),e(d),r(()=>!e(N)[e(d).id])&&ct(bt)})}l(Ze);var xt=a(Ze,2);{var Dt=ct=>{var pt=ol(),St=i(pt),Ht=i(St);De(Ht);var _t=a(Ht),jt=a(_t);{var mt=st=>{var Mt=il(),Wt=i(Mt);l(Mt),B(Kt=>k(Wt,`(Spell Save DC: ${Kt??""})`),[()=>(G(Da),t(),v(),r(()=>Da(t(),v())))]),o(st,Mt)};_(jt,st=>{t(),r(()=>t().class)&&st(mt)})}var Ut=a(jt,2);{var qt=st=>{var Mt=rl();o(st,Mt)},Xt=st=>{var Mt=rt(),Wt=We(Mt);{var Kt=Yt=>{var kt=nl();o(Yt,kt)};_(Wt,Yt=>{e(d),G(e(M)),r(()=>e(d).targetSucceededSave&&e(M).noDamageOnSave)&&Yt(Kt)},!0)}o(st,Mt)};_(Ut,st=>{e(d),G(e(M)),r(()=>e(d).targetSucceededSave&&e(M).halfDamageOnSave)?st(qt):st(Xt,!1)})}l(St),l(pt),B(st=>k(_t,` Target succeeded on ${st??""} save `),[()=>(G(e(M)),r(()=>e(M).ability.charAt(0).toUpperCase()+e(M).ability.slice(1)))]),ha(Ht,()=>e(d).targetSucceededSave,st=>(e(d).targetSucceededSave=st,Ct(()=>(e(T),t(),p())))),o(ct,pt)};_(xt,ct=>{e(M)&&ct(Dt)})}var ta=a(xt,2);{var aa=ct=>{const pt=lt(()=>(G(e(H)),r(()=>Ce(e(H)))));var St=rt(),Ht=We(St);{var _t=mt=>{var Ut=pl(),qt=We(Ut),Xt=i(qt),st=a(Xt,2);B(()=>{e(d),Ct(()=>{e(pt)})}),ut(st,5,()=>e(pt),ft,(kt,At)=>{var $t=cl(),Gt=i($t);l($t);var Jt={};B(()=>{k(Gt,`Level ${e(At)??""}`),Jt!==(Jt=e(At))&&($t.value=($t.__value=e(At))??"")}),o(kt,$t)}),l(st);var Mt=a(st,2);{var Wt=kt=>{const At=lt(()=>(e(d),G(e(H)),r(()=>se(e(d),e(H)))));var $t=vl(),Gt=i($t);{var Jt=Ot=>{var Zt=wt("Healing");o(Ot,Zt)},ht=Ot=>{var Zt=wt("Damage");o(Ot,Zt)};_(Gt,Ot=>{G(e(H)),r(()=>Se(e(H)))?Ot(Jt):Ot(ht,!1)})}var yt=a(Gt);l($t),B(()=>k(yt,` ${e(At)??""}`)),o(kt,$t)};_(Mt,kt=>{e(d),G(e(H)),r(()=>e(d).castAtLevel&&e(d).castAtLevel>e(H).level)&&kt(Wt)})}l(qt);var Kt=a(qt,2);{var Yt=kt=>{var At=ul(),$t=i(At),Gt=i($t);De(Gt);var Jt=a(Gt,2);{var ht=yt=>{const Ot=lt(()=>(e(d),G(e(H)),r(()=>se(e(d),e(H)))));var Zt=dl(),Qa=i(Zt);l(Zt),B(()=>k(Qa,`(+1d8, total: ${e(Ot)??""})`)),o(yt,Zt)};_(Jt,yt=>{e(d),r(()=>e(d).targetIsFiendOrUndead)&&yt(ht)})}l($t),l(At),ha(Gt,()=>e(d).targetIsFiendOrUndead,yt=>(e(d).targetIsFiendOrUndead=yt,Ct(()=>(e(T),t(),p())))),o(kt,At)};_(Kt,kt=>{G(e(H)),r(()=>e(H).description.includes("Fiend or an Undead"))&&kt(Yt)})}B(()=>{tt(Xt,"for",`castLevel-${e(d),r(()=>e(d).id)??""}`),tt(st,"id",`castLevel-${e(d),r(()=>e(d).id)??""}`)}),Ka(st,()=>e(d).castAtLevel,kt=>(e(d).castAtLevel=kt,Ct(()=>(e(T),t(),p())))),o(mt,Ut)},jt=mt=>{var Ut=fl();o(mt,Ut)};_(Ht,mt=>{G(e(pt)),r(()=>e(pt).length>0)?mt(_t):mt(jt,!1)})}o(ct,St)};_(ta,ct=>{G(e(H)),r(()=>e(H).higherLevelSlot&&e(H).level>0)&&ct(aa)})}B(()=>{tt(vt,"aria-label",(e(N),e(d),r(()=>e(N)[e(d).id]?"Expand":"Collapse"))),k(dt,(e(N),e(d),r(()=>e(N)[e(d).id]?"â–¼":"â–²")))}),L("click",Ae,()=>he(e(d).id)),L("keydown",Ae,ct=>ct.key==="Enter"&&he(e(d).id)),o(m,J)},Me=m=>{var M=bl();o(m,M)};_(ot,m=>{e(H)?m($):m(Me,!1)})}o(Qe,at)};_(ae,Qe=>{e(je),r(()=>e(je).length===0)?Qe(Ne):Qe(xe,!1)})}o(U,z)};_(Ie,U=>{e(d),r(()=>e(d).spellRef)&&U(qe)})}var K=a(Ie,2);{var Le=U=>{var z=ml(),ae=a(i(z),2);na(ae),l(z),Be(ae,()=>e(d).notes,Ne=>(e(d).notes=Ne,Ct(()=>(e(T),t(),p())))),o(U,z)};_(K,U=>{e(d),r(()=>!e(d).spellRef)&&U(Le)})}var Ve=a(K,2),g=i(Ve);{var w=U=>{var z=hl();L("click",z,()=>$e(e(d))),o(U,z)};_(g,U=>{e(d),r(()=>e(d).bonus!==0||!e(d).spellRef)&&U(w)})}var re=a(g,2);{var ee=U=>{const z=lt(()=>(e(d),r(()=>ue(e(d).spellRef))));var ae=rt(),Ne=We(ae);{var xe=H=>{var at=_l();L("click",at,()=>x(e(d))),o(H,at)},Qe=H=>{var at=yl(),ot=i(at);{var $=m=>{var M=wt("Roll Healing");o(m,M)},Me=m=>{var M=wt("Roll Damage");o(m,M)};_(ot,m=>{G(e(z)),r(()=>e(z)&&Se(e(z)))?m($):m(Me,!1)})}l(at),L("click",at,()=>ie(e(d))),o(H,at)};_(Ne,H=>{G(e(z)),G(Ta),r(()=>e(z)&&Ta(e(z)))?H(xe):H(Qe,!1)})}o(U,ae)},me=U=>{var z=kl();L("click",z,()=>ie(e(d))),o(U,z)};_(re,U=>{e(d),e(Ee),r(()=>e(d).spellRef&&e(Ee))?U(ee):U(me,!1)})}l(Ve),l(ve),Be(fe,()=>e(d).name,U=>(e(d).name=U,Ct(()=>(e(T),t(),p())))),Be(be,()=>e(d).damageType,U=>(e(d).damageType=U,Ct(()=>(e(T),t(),p())))),o(j,ve)});var Ke=a(X,2);{var ce=j=>{var d=Sl();o(j,d)},ye=j=>{var d=rt(),Ue=We(d);{var ve=_e=>{var fe=$l();o(_e,fe)};_(Ue,_e=>{e(T),r(()=>e(T).length===0)&&_e(ve)},!0)}o(j,d)};_(Ke,j=>{t(),r(()=>t().attacks.length===0)?j(ce):j(ye,!1)})}l(A);var Je=a(A,2),Oe=a(i(Je),4),nt=a(Oe,2);{var F=j=>{var d=Ll();ut(d,5,()=>(t(),r(()=>t().activeStates)),ft,(Ue,ve,_e)=>{var fe=wl(),D=i(fe),ke=i(D);De(ke);var P=a(ke,2);{var Y=K=>{var Le=Cl();L("click",Le,()=>Pe(_e)),o(K,Le)};_(P,K=>{C()&&K(Y)})}l(D);var Te=a(D,2),Ye=i(Te),He=a(i(Ye),2);De(He),l(Ye);var V=a(Ye,2),be=a(i(V),2);De(be),l(V),l(Te);var Ie=a(Te,2),qe=a(i(Ie),2);De(qe),l(Ie),l(fe),Be(ke,()=>e(ve).name,K=>(e(ve).name=K,Ct(()=>t()),da(I,"$character"))),Be(He,()=>e(ve).attackBonus,K=>(e(ve).attackBonus=K,Ct(()=>t()),da(I,"$character"))),Be(be,()=>e(ve).damageBonus,K=>(e(ve).damageBonus=K,Ct(()=>t()),da(I,"$character"))),Be(qe,()=>e(ve).description,K=>(e(ve).description=K,Ct(()=>t()),da(I,"$character"))),o(Ue,fe)}),l(d),o(j,d)},E=j=>{var d=Dl();o(j,d)};_(nt,j=>{t(),r(()=>t().activeStates&&t().activeStates.length>0)?j(F):j(E,!1)})}l(Je),L("click",Q,Fe),L("click",Oe,pe),o(f,S)};_(we,f=>{h(),r(()=>!h().attacks)&&f(ze)})}l(ne),B(()=>{oe=gt(ne,1,"attacks svelte-14o91c5",null,oe,{hidden:!e(le)}),tt(b,"aria-label",(h(),r(()=>h().attacks?"Expand":"Collapse"))),k(W,(h(),r(()=>h().attacks?"â–¼":"â–²")))}),L("click",b,q),o(s,ne),Pt(),y()}var Ml=u('<span class="slot-checkbox-x svelte-serp1j">&#8212;</span>'),Bl=u('<label><input type="checkbox" class="slot-checkbox-input svelte-serp1j"/> <span><!></span></label>');function Ha(s,n){Et(n,!1);const t=()=>Xe(sa,"$isEditMode",v),[v,p]=Nt();let h=Ft(n,"checked",8,!1),C=Ft(n,"disabled",8,!1),I=Ft(n,"className",8,""),y=Ft(n,"index",8,void 0),T=Ft(n,"ariaLabel",8,void 0);const le=ea();function te($e){le("change",{checked:$e.currentTarget.checked,index:y()})}Rt();var N=Bl(),he=i(N);De(he);var Se=a(he,2),Fe=i(Se);{var de=$e=>{var ie=Ml();o($e,ie)};_(Fe,$e=>{h()&&$e(de)})}l(Se),l(N),B(()=>{gt(N,1,"slot-checkbox-label "+I()+(t()?"":" not-editable"),"svelte-serp1j"),hs(he,h()),he.disabled=C()||!t(),tt(he,"aria-label",T()),tt(he,"tabindex",t()?0:-1),gt(Se,1,`slot-checkbox-custom ${h()?"used":""} ${t()?"":"readonly"}`,"svelte-serp1j")}),L("change",he,te),o(s,N),Pt(),p()}var Il=u('<p class="no-features svelte-1kpvv0n">Select a class to see available features</p>'),Rl=u('<p class="no-features svelte-1kpvv0n">No class features available at this level</p>'),El=u('<div class="spell-slots svelte-1kpvv0n"><label class="svelte-1kpvv0n"> </label> <div class="slots-tracker svelte-1kpvv0n"></div></div>'),Pl=u('<div class="all-spell-slots"></div>'),Tl=u('<div class="feature-box spellcasting svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"> </h3> <div class="spell-stats svelte-1kpvv0n"><div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Spell Save DC</label> <div class="spell-value svelte-1kpvv0n"> </div></div> <div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <div class="spell-value svelte-1kpvv0n"> </div></div></div> <!> <div class="prepared-spells svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <textarea placeholder="List your prepared spells..." class="svelte-1kpvv0n"></textarea></div></div>'),Hl=u('<p class="unlimited svelte-1kpvv0n">Unlimited Uses</p>'),Nl=u('<div class="slots-tracker svelte-1kpvv0n"></div> <div class="uses-actions-row"><button class="btn btn-primary use-enabled"> </button></div> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div>',1),Ul=u('<div class="uses-tracker svelte-1kpvv0n"><!></div>'),Gl=u('<div class="pool-tracker svelte-1kpvv0n"><input type="number" min="0" class="pool-input svelte-1kpvv0n"/> <span> </span> <button class="btn-small svelte-1kpvv0n"> </button></div>'),Ol=u('<p class="no-uses svelte-1kpvv0n">No Channel Divinity uses remaining</p>'),ql=u('<div class="channel-divinity-option svelte-1kpvv0n"><button class="btn btn-primary use-enabled svelte-1kpvv0n">Use Channel Divinity</button> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div> <!></div>'),Wl=u('<div class="feature-box svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"><!> </h3> <p class="feature-description svelte-1kpvv0n"> </p> <!></div>'),zl=u('<div class="features-grid svelte-1kpvv0n"><!> <!></div>'),Kl=u('<section><div class="header svelte-1kpvv0n"><h2 class="svelte-1kpvv0n">Class Features</h2> <button class="collapse-btn svelte-1kpvv0n"> </button></div> <!></section>');function Jl(s,n){Et(n,!1);const t=()=>Xe(Z,"$character",C),v=()=>Xe(va,"$abilityModifiers",C),p=()=>Xe(Qt,"$searchFilter",C),h=()=>Xe(Lt,"$collapsedStates",C),[C,I]=Nt(),y=R(),T=R(),le=R(),te=R(),N=R(),he=R(),Se=R();let Fe=R(0),de=R(0);function $e(b,W){Z.update(we=>(we.classFeatures.features[b]=W,we))}function ie(){Z.update(b=>(b.classFeatures.spellSlotsByLevel||(b.classFeatures.spellSlotsByLevel={}),e(te).forEach(({level:W,slots:we})=>{b.classFeatures.spellSlotsByLevel[W]||(b.classFeatures.spellSlotsByLevel[W]=Array(we).fill(!1))}),b))}function q(b){if(typeof b.maxUses=="function"){if((b.name==="Divine Sense"||b.name==="War Priest")&&e(y)?.spellcastingAbility){const W=v()[e(y).spellcastingAbility];return b.maxUses(t().level,W)}return b.maxUses(t().level)}return b.maxUses||0}function je(b,W){Z.update(we=>((!we.classFeatures.features[b]||!Array.isArray(we.classFeatures.features[b])||we.classFeatures.features[b].length!==W)&&(we.classFeatures.features[b]=Array(W).fill(!1)),we))}Xa(()=>{e(he)&&t()&&t().classFeatures&&t().classFeatures.features&&e(he).forEach(b=>{if(b.type==="uses"){const W=b.name.replace(/\s+/g,""),we=q(b),ze=t().classFeatures.features[W];(!Array.isArray(ze)||ze.length!==we)&&je(W,we)}})});function Ee(b){return typeof b.maxPool=="function"?b.maxPool(t().level):b.maxPool||0}function ue(b){return typeof b.description=="function"?b.description(t().level):b.description}function O(){const b="ChannelDivinity";Z.update(W=>{const we=W.classFeatures.features[b];return typeof we=="number"&&we>0&&(W.classFeatures.features[b]=we-1),W})}function se(){Lt.update(b=>({...b,classFeatures:!b.classFeatures}))}et(()=>(t(),It),()=>{c(y,t().class?It(t().class):null)}),et(()=>(t(),ia),()=>{c(T,t().class?ia(t().class,t().level,t().subclass):[])}),et(()=>(t(),Ra),()=>{c(le,t().class?Ra(t().class,t().level):0)}),et(()=>(e(y),t()),()=>{c(te,(()=>{if(!e(y)?.spellcaster)return[];const b=t().level,W=[];return b>=1&&W.push({level:1,slots:Math.min(4,2+Math.floor(b/3))}),b>=3&&W.push({level:2,slots:Math.min(3,2+Math.floor((b-3)/4))}),b>=5&&W.push({level:3,slots:Math.min(3,2+Math.floor((b-5)/5))}),b>=7&&W.push({level:4,slots:Math.min(3,1+Math.floor((b-7)/6))}),b>=9&&W.push({level:5,slots:Math.min(2,1+Math.floor((b-9)/8))}),b>=11&&W.push({level:6,slots:1}),b>=13&&W.push({level:7,slots:1}),b>=15&&W.push({level:8,slots:1}),b>=17&&W.push({level:9,slots:1}),W})())}),et(()=>(e(y),v(),t(),Ea),()=>{if(e(y)?.spellcaster&&e(y).spellcastingAbility){const b=v()[e(y).spellcastingAbility];c(Fe,xs(t().class,b,t().proficiencyBonus)||0),c(de,Ea(t().class,t().level,b))}}),et(()=>(t(),e(y),e(te)),()=>{t().class&&e(y)?.spellcaster&&e(te).length>0&&ie()}),et(()=>t(),()=>{c(N,(()=>{const W=t().classFeatures.features["ChannelDivinity"];return typeof W=="number"?W:0})())}),et(()=>(e(T),p()),()=>{c(he,e(T).filter(b=>{if(!p())return!0;const W=p().toLowerCase();return b.name.toLowerCase().includes(W)||ue(b).toLowerCase().includes(W)}))}),et(()=>(p(),t(),e(he)),()=>{c(Se,!p()||t().class||"class features".includes(p().toLowerCase())||"spellcasting".includes(p().toLowerCase())||e(he).length>0)}),zt(),Rt();var Ce=Kl();let pe;var Pe=i(Ce),x=a(i(Pe),2),ne=i(x,!0);l(x),l(Pe);var oe=a(Pe,2);{var ge=b=>{var W=rt(),we=We(W);{var ze=S=>{var Q=Il();o(S,Q)},f=S=>{var Q=rt(),A=We(Q);{var X=ce=>{var ye=Rl();o(ce,ye)},Ke=ce=>{var ye=zl(),Je=i(ye);{var Oe=F=>{var E=Tl(),j=i(E),d=i(j);l(j);var Ue=a(j,2),ve=i(Ue),_e=a(i(ve),2),fe=i(_e,!0);l(_e),l(ve);var D=a(ve,2),ke=a(i(D),2),P=i(ke,!0);l(ke),l(D),l(Ue);var Y=a(Ue,2);{var Te=V=>{var be=Pl();ut(be,5,()=>e(te),ft,(Ie,qe)=>{let K=()=>e(qe).level,Le=()=>e(qe).slots;const Ve=lt(()=>(t(),K(),Le(),r(()=>t().classFeatures.spellSlotsByLevel?.[K()]||Array(Le()).fill(!1))));var g=El(),w=i(g),re=i(w);l(w);var ee=a(w,2);ut(ee,5,()=>e(Ve),ft,(me,U,z)=>{{let ae=lt(()=>(G(e(Ve)),r(()=>e(Ve)[z]||!1)));Ha(me,{get checked(){return e(ae)},$$events:{change:Ne=>{Z.update(xe=>(xe.classFeatures.spellSlotsByLevel||(xe.classFeatures.spellSlotsByLevel={}),xe.classFeatures.spellSlotsByLevel[K()]||(xe.classFeatures.spellSlotsByLevel[K()]=Array(Le()).fill(!1)),xe.classFeatures.spellSlotsByLevel[K()][z]=Ne.detail.checked,xe))}}})}}),l(ee),l(g),B(()=>k(re,`${K()===1?"1st":K()===2?"2nd":K()===3?"3rd":`${K()}th`} Level Spell Slots`)),o(Ie,g)}),l(be),o(V,be)};_(Y,V=>{e(te),r(()=>e(te).length>0)&&V(Te)})}var Ye=a(Y,2),He=a(i(Ye),2);na(He),l(Ye),l(E),B(V=>{k(d,`Spellcasting (${V??""})`),k(fe,e(Fe)),k(P,e(de))},[()=>(e(y),r(()=>e(y).spellcastingAbility?.toUpperCase()))]),Be(He,()=>t().classFeatures.preparedSpells,V=>it(Z,r(t).classFeatures.preparedSpells=V,r(t))),o(F,E)};_(Je,F=>{e(y),r(()=>e(y)?.spellcaster)&&F(Oe)})}var nt=a(Je,2);ut(nt,1,()=>e(he),ft,(F,E)=>{const j=lt(()=>(e(E),r(()=>e(E).name.replace(/\s+/g,"")))),d=lt(()=>(t(),G(e(j)),r(()=>t().classFeatures.features[e(j)]))),Ue=lt(()=>typeof e(d)=="number");var ve=Wl(),_e=i(ve),fe=i(_e);{var D=V=>{var be=wt("Channel Divinity:");o(V,be)};_(fe,V=>{e(E),r(()=>e(E).type==="channelDivinity")&&V(D)})}var ke=a(fe);l(_e);var P=a(_e,2),Y=i(P,!0);l(P);var Te=a(P,2);{var Ye=V=>{const be=lt(()=>(e(E),r(()=>q(e(E))))),Ie=lt(()=>(G(e(d)),G(e(be)),r(()=>Array.isArray(e(d))?e(d):Array(e(be)).fill(!1))));var qe=Ul(),K=i(qe);{var Le=g=>{var w=Hl();o(g,w)},Ve=g=>{var w=Nl(),re=We(w);ut(re,5,()=>e(Ie),ft,(xe,Qe,H)=>{Ha(xe,{get checked(){return e(Qe)},index:H,$$events:{change:at=>{Z.update(ot=>(ot.classFeatures.features[e(j)]||(ot.classFeatures.features[e(j)]=Array(e(be)).fill(!1)),ot.classFeatures.features[e(j)][H]=at.detail.checked,ot))}}})}),l(re);var ee=a(re,2),me=i(ee),U=i(me);l(me),l(ee);var z=a(ee,2),ae=i(z),Ne=i(ae);l(ae),l(z),B(xe=>{me.disabled=xe,k(U,`Use ${e(E),r(()=>e(E).name)??""}`),k(Ne,`Resets on ${e(E),r(()=>e(E).resetOn==="short"?"Short Rest":"Long Rest")??""}`)},[()=>(G(e(Ie)),r(()=>e(Ie).filter(xe=>!xe).length<=0))]),L("click",me,()=>{Z.update(xe=>{xe.classFeatures.features[e(j)]||(xe.classFeatures.features[e(j)]=Array(e(be)).fill(!1));const Qe=xe.classFeatures.features[e(j)],H=Qe.findIndex(at=>!at);return H!==-1&&(Qe[H]=!0),xe})}),o(g,w)};_(K,g=>{e(be)===1/0?g(Le):g(Ve,!1)})}l(qe),o(V,qe)},He=V=>{var be=rt(),Ie=We(be);{var qe=Le=>{const Ve=lt(()=>(e(E),r(()=>Ee(e(E)))));var g=Gl(),w=i(g);De(w);var re=a(w,2),ee=i(re);l(re);var me=a(re,2),U=i(me,!0);l(me),l(g),B(()=>{ma(w,e(Ue)&&e(d)!==void 0?e(d):e(Ve)),tt(w,"max",e(Ve)),k(ee,`/ ${e(Ve)??""}`),k(U,(e(E),r(()=>e(E).resetOn==="short"?"Short Rest":"Long Rest")))}),L("input",w,z=>{Z.update(ae=>(ae.classFeatures.features[e(j)]=parseInt(z.currentTarget.value)||0,ae))}),L("click",me,()=>$e(e(j),e(Ve))),o(Le,g)},K=Le=>{var Ve=rt(),g=We(Ve);{var w=re=>{var ee=ql(),me=i(ee),U=a(me,2),z=i(U),ae=i(z);l(z),l(U);var Ne=a(U,2);{var xe=Qe=>{var H=Ol();o(Qe,H)};_(Ne,Qe=>{e(N)<=0&&Qe(xe)})}l(ee),B(()=>{me.disabled=e(N)<=0,k(ae,`Resets on ${e(E),r(()=>e(E).resetOn==="short"?"Short Rest":"Long Rest")??""}`)}),L("click",me,O),o(re,ee)};_(g,re=>{e(E),r(()=>e(E).type==="channelDivinity")&&re(w)},!0)}o(Le,Ve)};_(Ie,Le=>{e(E),r(()=>e(E).type==="pool")?Le(qe):Le(K,!1)},!0)}o(V,be)};_(Te,V=>{e(E),r(()=>e(E).type==="uses")?V(Ye):V(He,!1)})}l(ve),B(V=>{k(ke,` ${e(E),r(()=>e(E).name)??""}`),k(Y,V)},[()=>(e(E),r(()=>ue(e(E))))]),o(F,ve)}),l(ye),o(ce,ye)};_(A,ce=>{e(T),r(()=>e(T).length===0)?ce(X):ce(Ke,!1)},!0)}o(S,Q)};_(we,S=>{t(),r(()=>!t().class)?S(ze):S(f,!1)})}o(b,W)};_(oe,b=>{h(),r(()=>!h().classFeatures)&&b(ge)})}l(Ce),B(()=>{pe=gt(Ce,1,"class-features svelte-1kpvv0n",null,pe,{hidden:!e(Se)}),tt(x,"aria-label",(h(),r(()=>h().classFeatures?"Expand":"Collapse"))),k(ne,(h(),r(()=>h().classFeatures?"â–¼":"â–²")))}),L("click",x,se),o(s,Ce),Pt(),I()}var Vl=u('<textarea placeholder="Enter features, traits, and special abilities..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Equipment</h3> <textarea placeholder="List your equipment and inventory..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Notes</h3> <textarea placeholder="Additional notes..." class="svelte-wttn0l"></textarea>',1),Ql=u('<section><div class="header svelte-wttn0l"><h2 class="svelte-wttn0l">Features & Traits</h2> <button class="collapse-btn svelte-wttn0l"> </button></div> <!></section>');function Xl(s,n){Et(n,!1);const t=()=>Xe(Qt,"$searchFilter",h),v=()=>Xe(Z,"$character",h),p=()=>Xe(Lt,"$collapsedStates",h),[h,C]=Nt(),I=R();function y(){Lt.update(de=>({...de,notes:!de.notes}))}et(()=>(t(),v()),()=>{c(I,!t()||"features".includes(t().toLowerCase())||"traits".includes(t().toLowerCase())||"equipment".includes(t().toLowerCase())||"notes".includes(t().toLowerCase())||v().features.toLowerCase().includes(t().toLowerCase())||v().equipment.toLowerCase().includes(t().toLowerCase())||v().notes.toLowerCase().includes(t().toLowerCase()))}),zt(),Rt();var T=Ql();let le;var te=i(T),N=a(i(te),2),he=i(N,!0);l(N),l(te);var Se=a(te,2);{var Fe=de=>{var $e=Vl(),ie=We($e);na(ie);var q=a(ie,4);na(q);var je=a(q,4);na(je),Be(ie,()=>v().features,Ee=>it(Z,r(v).features=Ee,r(v))),Be(q,()=>v().equipment,Ee=>it(Z,r(v).equipment=Ee,r(v))),Be(je,()=>v().notes,Ee=>it(Z,r(v).notes=Ee,r(v))),o(de,$e)};_(Se,de=>{p(),r(()=>!p().notes)&&de(Fe)})}l(T),B(()=>{le=gt(T,1,"notes svelte-wttn0l",null,le,{hidden:!e(I)}),tt(N,"aria-label",(p(),r(()=>p().notes?"Expand":"Collapse"))),k(he,(p(),r(()=>p().notes?"â–¼":"â–²")))}),L("click",N,y),o(s,T),Pt(),C()}var Yl=u('<div class="color-picker-section svelte-1r90jgp"><h3 class="svelte-1r90jgp">Dice Colors</h3> <div class="color-inputs svelte-1r90jgp"><div class="color-input-group svelte-1r90jgp"><label for="dice-color" class="svelte-1r90jgp">Dice Color</label> <input type="color" id="dice-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="label-color" class="svelte-1r90jgp">Label Color</label> <input type="color" id="label-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="desk-color" class="svelte-1r90jgp">Background Color</label> <input type="color" id="desk-color" class="svelte-1r90jgp"/></div></div></div>'),Zl=u('<div class="loading svelte-1r90jgp"><p class="svelte-1r90jgp">Loading 3D dice...</p></div>'),ei=u('<div class="custom-dice-selector svelte-1r90jgp"><h3 class="svelte-1r90jgp">Choose Dice to Roll</h3> <div class="dice-inputs svelte-1r90jgp"><div class="dice-input-group svelte-1r90jgp"><label for="d4" class="svelte-1r90jgp">d4</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d4" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d6" class="svelte-1r90jgp">d6</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d6" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d8" class="svelte-1r90jgp">d8</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d8" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d10" class="svelte-1r90jgp">d10</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d10" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d12" class="svelte-1r90jgp">d12</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d12" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d20" class="svelte-1r90jgp">d20</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d20" min="0" max="10"/></div></div> <div class="dice-controls svelte-1r90jgp"><button class="btn btn-primary use-enabled svelte-1r90jgp"> </button> <button class="btn btn-secondary use-enabled svelte-1r90jgp">Reset</button></div></div>'),ti=u('<span class="crit-badge svelte-1r90jgp">CRITICAL!</span>'),ai=u('<p class="svelte-1r90jgp"> </p>'),si=u('<div class="bonus-item svelte-1r90jgp"><span class="bonus-value svelte-1r90jgp"> </span> <span class="bonus-source svelte-1r90jgp"> </span></div>'),li=u('<div class="bonus-breakdown svelte-1r90jgp"></div>'),ii=u('<p class="modifier-text svelte-1r90jgp"> </p>'),ri=u('<button class="btn btn-follow-up svelte-1r90jgp"> </button>'),ni=u('<button class="btn btn-guided-strike svelte-1r90jgp">âš¡ Use Guided Strike (+10)</button>'),oi=u('<div class="follow-up-actions svelte-1r90jgp"><!> <!></div>'),ci=u('<div class="result-header svelte-1r90jgp"><h3 class="svelte-1r90jgp"> </h3> <!></div> <div class="result-total svelte-1r90jgp"> </div> <div class="result-details svelte-1r90jgp"><!> <!></div> <!>',1),vi=u('<div role="button" tabindex="-1"><div class="modal-content svelte-1r90jgp" role="dialog" tabindex="0"><div class="modal-header svelte-1r90jgp"><h2 class="svelte-1r90jgp">Dice Roller</h2> <div class="header-buttons svelte-1r90jgp"><button class="color-btn svelte-1r90jgp" title="Customize dice colors">ðŸŽ¨</button> <button class="close-btn svelte-1r90jgp">Ã—</button></div></div> <!> <!> <div class="dice-main-area svelte-1r90jgp"><div class="dice-container svelte-1r90jgp"></div> <!></div> <div><!></div></div></div>');function di(s,n){Et(n,!1);const t=()=>Xe(Z,"$character",v),[v,p]=Nt(),h=R(),C=R(),I=R(),y=ea();let T=Ft(n,"notation",12,""),le=Ft(n,"visible",8,!1),te=Ft(n,"damageNotation",12,""),N=Ft(n,"attackName",12,""),he=Ft(n,"applyHalfDamage",8,!1),Se=Ft(n,"bonusBreakdown",28,()=>[]),Fe=null,de=R(void 0),$e=R(!1),ie=R(""),q=R(null);function je(){return e(q)?.resultTotal??null}let Ee=R(0),ue=R(0),O=R(0),se=R(0),Ce=R(0),pe=R(0),Pe=R(0),x=R([]),ne=R(!1),oe=R("other"),ge=R(!1),b=R("#051e0a"),W=R("#ffffff"),we=R("#3a2004"),ze=R(!1);function f(g){return g.length===9&&g.startsWith("#")?g.substring(0,7):g}function S(g,w="ff"){return g.length===7&&g.startsWith("#")?g+w:g}function Q(){if(window.DICE&&e(de))try{Fe&&e(de)&&$a(de,e(de).innerHTML="");const g=e(de).clientWidth||500,w=e(de).clientHeight||300;Fe=new window.DICE.dice_box(e(de),{w:g,h:w}),c($e,!0)}catch(g){console.error("Error initializing dice box:",g)}}ca(()=>{const g=ee=>new Promise((me,U)=>{if(document.querySelector(`script[src="${ee}"]`)){console.log(`Script already loaded: ${ee}`),me(null);return}const ae=document.createElement("script");ae.src=ee,ae.onload=()=>{console.log(`Loaded: ${ee}`),me(null)},ae.onerror=()=>{console.error(`Failed to load: ${ee}`),U(new Error(`Failed to load ${ee}`))},document.head.appendChild(ae)});setTimeout(()=>{g(`${ra}/libs/three.min.js`).then(()=>g(`${ra}/libs/cannon.min.js`)).then(()=>g(`${ra}/libs/teal.js`)).then(()=>g(`${ra}/dice.js`)).then(()=>{if(console.log("All scripts loaded, initializing dice box..."),console.log("DICE available:",!!window.DICE),console.log("Container available:",!!e(de)),window.DICE){const ee=window.DICE.getColors();c(b,f(ee.dice_color)),c(W,f(ee.label_color)),c(we,f(ee.desk_color))}Q()}).catch(ee=>{console.error("Failed to load dice libraries:",ee)})},100);const w=()=>{e($e)&&(console.log("Window resized, reinitializing dice box..."),Q())},re=ee=>{le()&&ee.key==="Escape"&&F()};return window.addEventListener("resize",w),window.addEventListener("keydown",re),()=>{window.removeEventListener("resize",w),window.removeEventListener("keydown",re)}});function A(g,w="other"){if(!Fe||!e($e))return;console.log("Rolling dice:",g,"type:",w),c(q,null),c(x,[]),c(ne,!1),w==="damage"&&Se([]),c(oe,w),c(ge,!1),Fe.diceToRoll=g;const re=me=>(console.log("Before roll:",me),null),ee=me=>{console.log("After roll:",me);let U=me.resultTotal,z=me.resultString;if(he()&&(U=Math.floor(U/2),z=z+" (halved)"),c(q,{...me,resultTotal:U,resultString:z}),w==="attack"||w==="check"||w==="save"){const ae=me.result?.filter(Ne=>Ne===20)||[];if(ae.length>0){const Ne=ae[0];c(ne,Ne===20)}}if(c(x,[]),console.log("Setting up follow-up actions. Type:",w,"damageNotation:",te(),"isCritical:",e(ne)),w==="attack")if(te()){if(e(ne)){const ae=ce(te());console.log("Creating critical damage button:",ae),e(x).push({label:`Roll Critical Damage (${ae})`,notation:ae})}else console.log("Creating normal damage button:",te()),e(x).push({label:`Roll Damage (${te()})`,notation:te()});console.log("Follow-up actions after setup:",e(x))}else console.log("No damageNotation provided for attack roll");console.log("Final followUpActions:",e(x))};Fe.start_throw(re,ee)}function X(){const g=[];e(Ee)>0&&g.push(`${e(Ee)}d4`),e(ue)>0&&g.push(`${e(ue)}d6`),e(O)>0&&g.push(`${e(O)}d8`),e(se)>0&&g.push(`${e(se)}d10`),e(Ce)>0&&g.push(`${e(Ce)}d12`),e(pe)>0&&g.push(`${e(pe)}d20`);let w=g.join("+")||"1d20";return e(Pe)!==0&&(w+=e(Pe)>=0?`+${e(Pe)}`:`${e(Pe)}`),w}function Ke(){const g=X();A(g)}function ce(g){return g.replace(/(\d+)d(\d+)/g,(w,re,ee)=>`${parseInt(re)*2}d${ee}`)}function ye(){c(Ee,0),c(ue,0),c(O,0),c(se,0),c(Ce,0),c(pe,0),c(Pe,0),c(q,null),c(x,[]),c(ne,!1),c(oe,"other"),c(ge,!1)}function Je(){window.DICE&&(window.DICE.setColors({dice_color:S(e(b),"ff"),label_color:S(e(W),"ff"),desk_color:e(we)}),Fe&&(Fe.updateDeskColor(e(we)),Fe.updateDiceColors()))}function Oe(){c(ze,!e(ze))}function nt(){!e(q)||e(C)<=0||e(ge)||(c(q,{...e(q),resultTotal:e(q).resultTotal+10,resultString:e(q).resultString+" + 10 (Guided Strike)"}),Z.update(g=>{const w="ChannelDivinity",re=g.classFeatures.features[w];return typeof re=="number"&&re>0&&(g.classFeatures.features[w]=re-1),g}),c(ge,!0))}function F(){y("close"),T(""),te(""),N(""),c(ie,""),c(q,null),c(ge,!1),ye()}et(()=>(t(),ia),()=>{c(h,t().class?ia(t().class,t().level,t().subclass).some(w=>w.name==="Guided Strike"):!1)}),et(()=>t(),()=>{c(C,(()=>{const w=t().classFeatures.features["ChannelDivinity"];return typeof w=="number"?w:0})())}),et(()=>(e(Ee),e(ue),e(O),e(se),e(Ce),e(pe),e(Pe)),()=>{c(I,(()=>{const g=[];e(Ee)>0&&g.push(`${e(Ee)}d4`),e(ue)>0&&g.push(`${e(ue)}d6`),e(O)>0&&g.push(`${e(O)}d8`),e(se)>0&&g.push(`${e(se)}d10`),e(Ce)>0&&g.push(`${e(Ce)}d12`),e(pe)>0&&g.push(`${e(pe)}d20`);let w=g.join("+")||"1d20";return e(Pe)!==0&&(w+=e(Pe)>=0?`+${e(Pe)}`:`${e(Pe)}`),w})())}),et(()=>(G(T()),e($e),G(le()),e(ie),G(te()),G(N())),()=>{if(T()&&e($e)&&le()&&T()!==e(ie)){c(ie,T()),c(q,null),c(x,[]),c(ne,!1),c(ge,!1);const g=T().includes("1d20")?"attack":"other";console.log("Auto-roll triggered. notation:",T(),"damageNotation:",te(),"attackName:",N()),setTimeout(()=>A(T(),g),200)}}),zt();var E={getLastRollTotal:je};Rt();var j=vi();let d;var Ue=i(j),ve=i(Ue),_e=a(i(ve),2),fe=i(_e),D=a(fe,2);l(_e),l(ve);var ke=a(ve,2);{var P=g=>{var w=Yl(),re=a(i(w),2),ee=i(re),me=a(i(ee),2);De(me),l(ee);var U=a(ee,2),z=a(i(U),2);De(z),l(U);var ae=a(U,2),Ne=a(i(ae),2);De(Ne),l(ae),l(re),l(w),Be(me,()=>e(b),xe=>c(b,xe)),L("change",me,Je),Be(z,()=>e(W),xe=>c(W,xe)),L("change",z,Je),Be(Ne,()=>e(we),xe=>c(we,xe)),L("change",Ne,Je),o(g,w)};_(ke,g=>{e(ze)&&g(P)})}var Y=a(ke,2);{var Te=g=>{var w=Zl();o(g,w)};_(Y,g=>{e($e)||g(Te)})}var Ye=a(Y,2),He=i(Ye);Ca(He,g=>c(de,g),()=>e(de));var V=a(He,2);{var be=g=>{var w=ei(),re=a(i(w),2),ee=i(re),me=a(i(ee),2);De(me),l(ee);var U=a(ee,2),z=a(i(U),2);De(z),l(U);var ae=a(U,2),Ne=a(i(ae),2);De(Ne),l(ae);var xe=a(ae,2),Qe=a(i(xe),2);De(Qe),l(xe);var H=a(xe,2),at=a(i(H),2);De(at),l(H);var ot=a(H,2),$=a(i(ot),2);De($),l(ot),l(re);var Me=a(re,2),m=i(Me),M=i(m);l(m);var J=a(m,2);l(Me),l(w),B(()=>{m.disabled=!e($e),k(M,`Roll ${e(I)??""}`)}),Be(me,()=>e(Ee),Re=>c(Ee,Re)),Be(z,()=>e(ue),Re=>c(ue,Re)),Be(Ne,()=>e(O),Re=>c(O,Re)),Be(Qe,()=>e(se),Re=>c(se,Re)),Be(at,()=>e(Ce),Re=>c(Ce,Re)),Be($,()=>e(pe),Re=>c(pe,Re)),L("click",m,Ke),L("click",J,ye),o(g,w)};_(V,g=>{T()||g(be)})}l(Ye);var Ie=a(Ye,2);let qe;var K=i(Ie);{var Le=g=>{var w=ci(),re=We(w),ee=i(re),me=i(ee,!0);l(ee);var U=a(ee,2);{var z=m=>{var M=ti();o(m,M)};_(U,m=>{e(ne)&&m(z)})}l(re);var ae=a(re,2),Ne=i(ae,!0);l(ae);var xe=a(ae,2),Qe=i(xe);{var H=m=>{var M=ai(),J=i(M,!0);l(M),B(()=>k(J,(e(q),r(()=>e(q).resultString)))),o(m,M)};_(Qe,m=>{e(q),r(()=>e(q).resultString)&&m(H)})}var at=a(Qe,2);{var ot=m=>{var M=rt(),J=We(M);{var Re=Ze=>{var Ae=li();ut(Ae,5,Se,ft,(vt,dt)=>{var Tt=si(),bt=i(Tt),xt=i(bt);l(bt);var Dt=a(bt,2),ta=i(Dt);l(Dt),l(Tt),B(()=>{k(xt,`${e(dt),r(()=>e(dt).value>=0?"+":"")??""}${e(dt),r(()=>e(dt).value)??""}`),k(ta,`(${e(dt),r(()=>e(dt).source)??""})`)}),o(vt,Tt)}),l(Ae),o(Ze,Ae)},Ge=Ze=>{var Ae=rt(),vt=We(Ae);{var dt=Tt=>{var bt=ii(),xt=i(bt);l(bt),B(()=>k(xt,`Modifier: ${e(q),r(()=>e(q).constant>=0?"+":"")??""}${e(q),r(()=>e(q).constant)??""}`)),o(Tt,bt)};_(vt,Tt=>{e(q),r(()=>e(q).constant)&&Tt(dt)},!0)}o(Ze,Ae)};_(J,Ze=>{G(Se()),r(()=>Se().length>0)?Ze(Re):Ze(Ge,!1)})}o(m,M)};_(at,m=>{e(q),G(Se()),r(()=>e(q).constant||Se().length>0)&&m(ot)})}l(xe);var $=a(xe,2);{var Me=m=>{var M=oi(),J=i(M);ut(J,1,()=>e(x),ft,(Ze,Ae)=>{var vt=ri(),dt=i(vt,!0);l(vt),B(()=>k(dt,(e(Ae),r(()=>e(Ae).label)))),L("click",vt,()=>A(e(Ae).notation,"damage")),o(Ze,vt)});var Re=a(J,2);{var Ge=Ze=>{var Ae=ni();B(()=>{Ae.disabled=e(C)<=0,tt(Ae,"title",e(C)<=0?"No Channel Divinity uses remaining":"Use Channel Divinity to add +10 to this attack roll")}),L("click",Ae,nt),o(Ze,Ae)};_(Re,Ze=>{e(h)&&e(oe)==="attack"&&!e(ge)&&Ze(Ge)})}l(M),o(m,M)};_($,m=>{e(x),e(h),e(oe),e(ge),r(()=>e(x).length>0||e(h)&&e(oe)==="attack"&&!e(ge))&&m(Me)})}B(()=>{k(me,N()?`${N()} - Result`:"Result"),k(Ne,(e(q),r(()=>e(q).resultTotal)))}),o(g,w)};_(K,g=>{e(q)&&g(Le)})}l(Ie),l(Ue),l(j),B(()=>{d=gt(j,1,"modal-overlay svelte-1r90jgp",null,d,{hidden:!le()}),qe=gt(Ie,1,"roll-result svelte-1r90jgp",null,qe,{"has-result":e(q)})}),L("click",fe,Oe),L("click",D,F),L("click",Ue,Fa(function(g){la.call(this,n,g)})),L("keydown",Ue,function(g){la.call(this,n,g)}),L("click",j,F),L("keydown",j,g=>g.key==="Escape"&&F()),o(s,j),ys(n,"getLastRollTotal",je);var Ve=Pt(E);return p(),Ve}const ya="https://api.github.com/gists";async function ui(s,n,t){if(!n)throw new Error("GitHub token is required");const v=JSON.stringify(s,null,2),p=`${s.name||"character"}_dnd.json`,h={description:t||`D&D Character: ${s.name}`,public:!1,files:{[p]:{content:v}}},C=await fetch(ya,{method:"POST",headers:{Authorization:`token ${n}`,"Content-Type":"application/json"},body:JSON.stringify(h)});if(!C.ok)throw new Error(`Failed to create gist: ${C.statusText}`);return(await C.json()).id}async function pi(s,n,t){if(!n||!t)throw new Error("GitHub token and Gist ID are required");const v=JSON.stringify(s,null,2),h={files:{[`${s.name||"character"}_dnd.json`]:{content:v}}},C=await fetch(`${ya}/${t}`,{method:"PATCH",headers:{Authorization:`token ${n}`,"Content-Type":"application/json"},body:JSON.stringify(h)});if(!C.ok)throw new Error(`Failed to update gist: ${C.statusText}`)}async function fi(s,n){if(!s)throw new Error("Gist ID is required");const t={"Content-Type":"application/json"};n&&(t.Authorization=`token ${n}`);const v=await fetch(`${ya}/${s}`,{method:"GET",headers:t});if(!v.ok)throw new Error(`Failed to load gist: ${v.statusText}`);const p=await v.json(),h=Object.values(p.files);if(h.length===0)throw new Error("No files found in gist");const I=h[0].content;try{const y=JSON.parse(I);return y.attacks&&Array.isArray(y.attacks)&&(y.attacks=y.attacks.map(T=>({...T,id:T.id||crypto.randomUUID()}))),y.classFeatures?(y.classFeatures.features||(y.classFeatures.features={}),y.classFeatures.spellSlots||(y.classFeatures.spellSlots=[]),y.classFeatures.preparedSpells===void 0&&(y.classFeatures.preparedSpells="")):y.classFeatures={features:{},spellSlots:[],preparedSpells:""},y}catch{throw new Error("Invalid character data in gist")}}function Na(s){typeof window<"u"&&localStorage.setItem("dnd_gist_config",JSON.stringify(s))}function gi(){if(typeof window<"u"){const s=localStorage.getItem("dnd_gist_config");if(s)return JSON.parse(s)}return{}}async function bi(s,n=30){if(!s)throw new Error("GitHub token is required to list gists");const t=await fetch(`${ya}?per_page=${n}`,{method:"GET",headers:{Authorization:`token ${s}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error(`Failed to list gists: ${t.statusText}`);return await t.json()}var mi=u('<div class="error-message svelte-1jb5ckg"> </div>'),hi=u('<div class="toggle-container svelte-1jb5ckg"><button type="button" class="toggle-btn svelte-1jb5ckg"> </button></div>'),_i=u('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID (leave empty to create new)</label> <input type="text" id="gistId" placeholder="Optional: existing Gist ID to update" class="svelte-1jb5ckg"/></div>'),yi=u('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),ki=u('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),xi=u('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Update (or leave unselected to create new)</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),Si=u('<div class="info-message svelte-1jb5ckg">No gists found. A new one will be created.</div>'),$i=u('<!> <div class="form-group svelte-1jb5ckg"><label for="description" class="svelte-1jb5ckg"> </label> <input type="text" id="description" placeholder="D&amp;D Character Sheet" class="svelte-1jb5ckg"/></div>',1),Ci=u('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID *</label> <input type="text" id="gistId" placeholder="Enter Gist ID (for public or your private gists)" required class="svelte-1jb5ckg"/></div>'),wi=u('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),Li=u('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),Di=u('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Load</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),ji=u('<div class="info-message svelte-1jb5ckg">No gists found. Enter a Gist ID manually or create a new one in Save mode.</div>'),Ai=u('<div class="modal-overlay svelte-1jb5ckg" role="button" tabindex="-1"><div class="modal-content svelte-1jb5ckg" role="dialog" tabindex="0"><div class="modal-header svelte-1jb5ckg"><h2 class="svelte-1jb5ckg"> </h2> <button class="close-btn svelte-1jb5ckg">Ã—</button></div> <div class="modal-body svelte-1jb5ckg"><!> <div class="form-group svelte-1jb5ckg"><label for="token" class="svelte-1jb5ckg"> <a href="https://github.com/settings/tokens" target="_blank" rel="noopener" class="svelte-1jb5ckg">Get token</a></label> <input type="password" id="token" placeholder="ghp_xxxxxxxxxxxxx" class="svelte-1jb5ckg"/></div> <!> <!> <div class="modal-actions svelte-1jb5ckg"><button class="btn btn-primary svelte-1jb5ckg"><!></button> <button class="btn btn-secondary svelte-1jb5ckg">Cancel</button></div></div></div></div>');function Fi(s,n){Et(n,!1);const t=()=>Xe(Z,"$character",v),[v,p]=Nt(),h=ea();let C=Ft(n,"mode",8,"save"),I=R(""),y=R(""),T=R(""),le=R(!1),te=R(""),N=R(!1),he=R(!1),Se=R([]),Fe=R(null);const de=gi();de.token&&c(I,de.token),de.gistId&&c(y,de.gistId),ca(async()=>{e(I)&&!e(N)&&await $e()});async function $e(){if(e(I)){c(he,!0),c(te,"");try{c(Se,await bi(e(I))),e(y)&&c(Fe,e(Se).find(F=>F.id===e(y))||null)}catch(F){c(te,F.message||"Failed to load gists"),c(Se,[])}finally{c(he,!1)}}}function ie(F){c(Fe,F),c(y,F.id)}function q(){c(N,!e(N)),c(te,""),!e(N)&&e(I)&&$e()}async function je(){if(!e(I)){c(te,"GitHub token is required");return}const F=e(Fe)?.id||e(y);c(le,!0),c(te,"");try{if(F)await pi(t(),e(I),F),c(y,F),Bt.add("Character updated in Gist successfully!","success");else{const E=await ui(t(),e(I),e(T));c(y,E),Bt.add(`Character saved to Gist! ID: ${E}`,"success")}Na({token:e(I),gistId:e(y)}),h("close")}catch(E){c(te,E.message||"Failed to save to Gist")}finally{c(le,!1)}}async function Ee(){const F=e(Fe)?.id||e(y);if(!F){c(te,"Please select a gist or enter a Gist ID");return}c(le,!0),c(te,"");try{const E=await fi(F,e(I)||void 0);Z.set(E),c(y,F),Na({token:e(I),gistId:e(y)}),Bt.add("Character loaded from Gist successfully!","success"),h("close")}catch(E){c(te,E.message||"Failed to load from Gist")}finally{c(le,!1)}}function ue(){h("close")}Rt();var O=Ai(),se=i(O),Ce=i(se),pe=i(Ce),Pe=i(pe,!0);l(pe);var x=a(pe,2);l(Ce);var ne=a(Ce,2),oe=i(ne);{var ge=F=>{var E=mi(),j=i(E,!0);l(E),B(()=>k(j,e(te))),o(F,E)};_(oe,F=>{e(te)&&F(ge)})}var b=a(oe,2),W=i(b),we=i(W);ga(),l(W);var ze=a(W,2);De(ze),l(b);var f=a(b,2);{var S=F=>{var E=hi(),j=i(E),d=i(j,!0);l(j),l(E),B(()=>{j.disabled=e(le),k(d,e(N)?"ðŸ“‹ Show My Gists":"âœï¸ Enter Gist ID Manually")}),L("click",j,q),o(F,E)};_(f,F=>{(C()==="load"||C()==="save"&&e(I))&&F(S)})}var Q=a(f,2);{var A=F=>{var E=$i(),j=We(E);{var d=ke=>{var P=_i(),Y=a(i(P),2);De(Y),l(P),B(()=>Y.disabled=e(le)),Be(Y,()=>e(y),Te=>c(y,Te)),o(ke,P)},Ue=ke=>{var P=rt(),Y=We(P);{var Te=He=>{var V=yi();o(He,V)},Ye=He=>{var V=rt(),be=We(V);{var Ie=K=>{var Le=xi(),Ve=a(i(Le),2);ut(Ve,5,()=>e(Se),ft,(g,w)=>{var re=ki();let ee;var me=i(re),U=i(me),z=i(U,!0);l(U);var ae=a(U,2),Ne=i(ae,!0);l(ae),l(me);var xe=a(me,2),Qe=i(xe),H=i(Qe);l(Qe);var at=a(Qe,2),ot=i(at);l(at),l(xe),l(re),B($=>{ee=gt(re,1,"gist-item svelte-1jb5ckg",null,ee,{selected:e(Fe)?.id===e(w).id}),re.disabled=e(le),k(z,(e(w),r(()=>e(w).description||"Untitled"))),k(Ne,(e(w),r(()=>e(w).public?"ðŸŒ Public":"ðŸ”’ Private"))),k(H,`ID: ${e(w),r(()=>e(w).id)??""}`),k(ot,`Updated: ${$??""}`)},[()=>(e(w),r(()=>new Date(e(w).updated_at).toLocaleDateString()))]),L("click",re,()=>ie(e(w))),o(g,re)}),l(Ve),l(Le),o(K,Le)},qe=K=>{var Le=rt(),Ve=We(Le);{var g=w=>{var re=Si();o(w,re)};_(Ve,w=>{e(I)&&w(g)},!0)}o(K,Le)};_(be,K=>{e(Se),r(()=>e(Se).length>0)?K(Ie):K(qe,!1)},!0)}o(He,V)};_(Y,He=>{e(he)?He(Te):He(Ye,!1)},!0)}o(ke,P)};_(j,ke=>{e(N)||!e(I)?ke(d):ke(Ue,!1)})}var ve=a(j,2),_e=i(ve),fe=i(_e);l(_e);var D=a(_e,2);De(D),l(ve),B(()=>{k(fe,`Description ${e(y)?"(optional)":""}`),D.disabled=e(le)}),Be(D,()=>e(T),ke=>c(T,ke)),o(F,E)},X=F=>{var E=rt(),j=We(E);{var d=ve=>{var _e=Ci(),fe=a(i(_e),2);De(fe),l(_e),B(()=>fe.disabled=e(le)),Be(fe,()=>e(y),D=>c(y,D)),o(ve,_e)},Ue=ve=>{var _e=rt(),fe=We(_e);{var D=P=>{var Y=wi();o(P,Y)},ke=P=>{var Y=rt(),Te=We(Y);{var Ye=V=>{var be=Di(),Ie=a(i(be),2);ut(Ie,5,()=>e(Se),ft,(qe,K)=>{var Le=Li();let Ve;var g=i(Le),w=i(g),re=i(w,!0);l(w);var ee=a(w,2),me=i(ee,!0);l(ee),l(g);var U=a(g,2),z=i(U),ae=i(z);l(z);var Ne=a(z,2),xe=i(Ne);l(Ne),l(U),l(Le),B(Qe=>{Ve=gt(Le,1,"gist-item svelte-1jb5ckg",null,Ve,{selected:e(Fe)?.id===e(K).id}),Le.disabled=e(le),k(re,(e(K),r(()=>e(K).description||"Untitled"))),k(me,(e(K),r(()=>e(K).public?"ðŸŒ Public":"ðŸ”’ Private"))),k(ae,`ID: ${e(K),r(()=>e(K).id)??""}`),k(xe,`Updated: ${Qe??""}`)},[()=>(e(K),r(()=>new Date(e(K).updated_at).toLocaleDateString()))]),L("click",Le,()=>ie(e(K))),o(qe,Le)}),l(Ie),l(be),o(V,be)},He=V=>{var be=rt(),Ie=We(be);{var qe=K=>{var Le=ji();o(K,Le)};_(Ie,K=>{e(I)&&K(qe)},!0)}o(V,be)};_(Te,V=>{e(Se),r(()=>e(Se).length>0)?V(Ye):V(He,!1)},!0)}o(P,Y)};_(fe,P=>{e(he)?P(D):P(ke,!1)},!0)}o(ve,_e)};_(j,ve=>{e(N)||!e(I)?ve(d):ve(Ue,!1)},!0)}o(F,E)};_(Q,F=>{C()==="save"?F(A):F(X,!1)})}var Ke=a(Q,2),ce=i(Ke),ye=i(ce);{var Je=F=>{var E=wt();B(()=>k(E,C()==="save"?"Saving...":"Loading...")),o(F,E)},Oe=F=>{var E=wt();B(()=>k(E,C()==="save"?"Save":"Load")),o(F,E)};_(ye,F=>{e(le)?F(Je):F(Oe,!1)})}l(ce);var nt=a(ce,2);l(Ke),l(ne),l(se),l(O),B(()=>{k(Pe,C()==="save"?"Save to GitHub Gist":"Load from GitHub Gist"),k(we,`GitHub Token ${C()==="load"?"(optional for public gists)":"(required)"} `),ze.disabled=e(le),ce.disabled=e(le),nt.disabled=e(le)}),L("click",x,ue),Be(ze,()=>e(I),F=>c(I,F)),L("blur",ze,()=>{e(I)&&!e(N)&&$e()}),L("click",ce,function(...F){(C()==="save"?je:Ee)?.apply(this,F)}),L("click",nt,ue),L("click",se,Fa(function(F){la.call(this,n,F)})),L("keydown",se,function(F){la.call(this,n,F)}),L("click",O,ue),L("keydown",O,F=>F.key==="Escape"&&ue()),o(s,O),Pt(),p()}var Mi=u('<div class="loading svelte-1ngjemu">Loading D&D data...</div>'),Bi=u("<option> </option>"),Ii=u('<select class="level-filter svelte-1ngjemu"><option>All Levels</option><option>Cantrip</option><!></select>'),Ri=u('<div class="no-results svelte-1ngjemu"> </div>'),Ei=u('<div class="item-meta svelte-1ngjemu"> </div>'),Pi=u('<div class="item-meta svelte-1ngjemu"> </div>'),Ti=u('<button><div class="item-name svelte-1ngjemu"> </div> <!></button>'),Hi=u('<p class="higher-levels"><strong>At Higher Levels:</strong> </p>'),Ni=u('<p class="cantrip-upgrade"><strong>Cantrip Upgrade:</strong> </p>'),Ui=u('<h3 class="svelte-1ngjemu"> </h3> <p class="spell-meta svelte-1ngjemu"><!> <!></p> <p class="spell-classes"><strong>Classes:</strong> </p> <div class="spell-stats svelte-1ngjemu"><div><strong>Casting Time:</strong> </div> <div><strong>Range:</strong> </div> <div><strong>Components:</strong> <!></div> <div><strong>Duration:</strong> <!> </div></div> <p class="description svelte-1ngjemu"> </p> <!> <!>',1),Gi=u('<p class="prerequisite svelte-1ngjemu"><strong>Prerequisite:</strong> </p>'),Oi=u('<h3 class="svelte-1ngjemu"> </h3> <!> <p class="description svelte-1ngjemu"> </p> <a target="_blank" rel="noopener" class="source-link svelte-1ngjemu">View Full Details â†’</a>',1),qi=u('<div class="item-details svelte-1ngjemu"><!></div>'),Wi=u('<div class="controls svelte-1ngjemu"><div class="tabs svelte-1ngjemu"><button> </button> <button> </button></div> <div class="search-controls svelte-1ngjemu"><input type="text" placeholder="Search by name or description..." class="search-input svelte-1ngjemu"/> <!></div></div> <div class="content-container svelte-1ngjemu"><div class="items-list svelte-1ngjemu"><!></div> <!></div>',1),zi=u('<div class="modal-backdrop svelte-1ngjemu" role="presentation"><div class="modal svelte-1ngjemu" role="dialog" aria-modal="true" tabindex="-1"><div class="modal-header svelte-1ngjemu"><h2 class="svelte-1ngjemu">Browse D&D Spells & Feats</h2> <button class="close-btn svelte-1ngjemu" aria-label="Close">&times;</button></div> <div class="modal-body svelte-1ngjemu"><!></div> <div class="modal-footer svelte-1ngjemu"><button class="btn-secondary svelte-1ngjemu">Cancel</button> <button class="btn-primary svelte-1ngjemu">Add to Character Sheet</button></div></div></div>');function Ki(s,n){Et(n,!1);const t=R(),v=R(),p=R();let h=Ft(n,"onClose",8),C=R("spell"),I=R(!0),y=R(""),T=R(null),le=R([]),te=R([]),N=R(null);ca(async()=>{c(I,!0);try{c(le,await Va()),c(te,await Ks())}catch(x){console.error("Failed to load data:",x)}finally{c(I,!1)}});function he(x){c(N,x)}function Se(x){const ne=x.match(/(\d+d\d+(?:\s*\+\s*\d+)?)/i);return ne?ne[1]:""}function Fe(x){const ne=x.split(/\.( |$)/)[0].trim(),oe=Array.from(x.matchAll(/\*\*(.*?)\*\*/g)).map(b=>b[1].replace(/\.$/,""));let ge=ne;return oe.length&&(ge+=" | Effects: "+oe.join(", ")),ge}function de(){if(e(N)){if(e(C)==="spell"){const x=e(N);Z.update(ne=>{const ge=[];x.range&&ge.push(`Range: ${x.range}`),x.castingTime&&ge.push(`Cast: ${x.castingTime}`),x.duration&&ge.push(`Duration: ${x.duration}`),x.actionType==="Save"&&ge.push("Saving throw spell"),x.components&&x.components.length>0&&ge.push(`Components: ${x.components.join(", ")}`),x.material&&ge.push(`Material: ${x.material}`);const b=ge.join(" | "),W=Fe(x.description),we={id:crypto.randomUUID(),name:`${x.name}${x.concentration?" (C)":""}${x.ritual?" (R)":""}`,bonus:x.actionType==="Attack"?5:0,damage:Se(x.description),damageType:`${x.school} (Lvl ${x.level})`,spellRef:x.name,infoNotes:b,generalNotes:W,castAtLevel:x.level};return ne.attacks=[...ne.attacks,we],ne})}else if(e(C)==="feat"){const x=e(N);Z.update(ne=>{const oe=`${x.name}${x.prerequisite?` (Req: ${x.prerequisite})`:""}
${x.description}
`;return ne.features=ne.features?`${ne.features}
${oe}`:oe,ne})}c(N,null),h()()}}et(()=>(e(T),e(le),e(y)),()=>{c(t,e(T)!==null?Js(Pa(e(le),e(y)),e(T)):Pa(e(le),e(y)))}),et(()=>(e(te),e(y)),()=>{c(v,Vs(e(te),e(y)))}),et(()=>(e(C),e(t),e(v)),()=>{c(p,e(C)==="spell"?e(t):e(v))}),zt(),Rt();var $e=zi(),ie=i($e),q=i(ie),je=a(i(q),2);l(q);var Ee=a(q,2),ue=i(Ee);{var O=x=>{var ne=Mi();o(x,ne)},se=x=>{var ne=Wi(),oe=We(ne),ge=i(oe),b=i(ge);let W;var we=i(b);l(b);var ze=a(b,2);let f;var S=i(ze);l(ze),l(ge);var Q=a(ge,2),A=i(Q);De(A);var X=a(A,2);{var Ke=j=>{var d=Ii();B(()=>{e(T),Ct(()=>{})});var Ue=i(d);Ue.value=(Ue.__value=null)??"";var ve=a(Ue);ve.value=ve.__value=0;var _e=a(ve);ut(_e,0,()=>[1,2,3,4,5,6,7,8,9],ft,(fe,D)=>{var ke=Bi(),P=i(ke);l(ke);var Y={};B(()=>{k(P,`Level ${D??""}`),Y!==(Y=D)&&(ke.value=(ke.__value=D)??"")}),o(fe,ke)}),l(d),Ka(d,()=>e(T),fe=>c(T,fe)),o(j,d)};_(X,j=>{e(C)==="spell"&&j(Ke)})}l(Q),l(oe);var ce=a(oe,2),ye=i(ce),Je=i(ye);{var Oe=j=>{var d=Ri(),Ue=i(d);l(d),B(()=>k(Ue,`No ${e(C)??""}s found`)),o(j,d)},nt=j=>{var d=rt(),Ue=We(d);ut(Ue,1,()=>e(p),ft,(ve,_e)=>{var fe=Ti();let D;var ke=i(fe),P=i(ke,!0);l(ke);var Y=a(ke,2);{var Te=He=>{const V=lt(()=>e(_e));var be=Ei(),Ie=i(be);l(be),B(()=>k(Ie,`Level ${G(e(V)),r(()=>e(V).level)??""} â€¢ ${G(e(V)),r(()=>e(V).school)??""}`)),o(He,be)},Ye=He=>{const V=lt(()=>e(_e));var be=rt(),Ie=We(be);{var qe=K=>{var Le=Pi(),Ve=i(Le,!0);l(Le),B(()=>k(Ve,(G(e(V)),r(()=>e(V).prerequisite)))),o(K,Le)};_(Ie,K=>{G(e(V)),r(()=>e(V).prerequisite)&&K(qe)})}o(He,be)};_(Y,He=>{e(C)==="spell"?He(Te):He(Ye,!1)})}l(fe),B(()=>{D=gt(fe,1,"item-card svelte-1ngjemu",null,D,{selected:e(N)?.name===e(_e).name}),k(P,(e(_e),r(()=>e(_e).name)))}),L("click",fe,()=>he(e(_e))),o(ve,fe)}),o(j,d)};_(Je,j=>{e(p),r(()=>e(p).length===0)?j(Oe):j(nt,!1)})}l(ye);var F=a(ye,2);{var E=j=>{var d=qi(),Ue=i(d);{var ve=fe=>{const D=lt(()=>e(N));var ke=Ui(),P=We(ke),Y=i(P,!0);l(P);var Te=a(P,2),Ye=i(Te);{var He=M=>{var J=wt();B(()=>k(J,`${G(e(D)),r(()=>e(D).school)??""} cantrip`)),o(M,J)},V=M=>{var J=wt();B(()=>k(J,`Level ${G(e(D)),r(()=>e(D).level)??""} ${G(e(D)),r(()=>e(D).school)??""}`)),o(M,J)};_(Ye,M=>{G(e(D)),r(()=>e(D).level===0)?M(He):M(V,!1)})}var be=a(Ye,2);{var Ie=M=>{var J=wt("(ritual)");o(M,J)};_(be,M=>{G(e(D)),r(()=>e(D).ritual)&&M(Ie)})}l(Te);var qe=a(Te,2),K=a(i(qe));l(qe);var Le=a(qe,2),Ve=i(Le),g=a(i(Ve));l(Ve);var w=a(Ve,2),re=a(i(w));l(w);var ee=a(w,2),me=a(i(ee)),U=a(me);{var z=M=>{var J=wt();B(()=>k(J,`(${G(e(D)),r(()=>e(D).material)??""})`)),o(M,J)};_(U,M=>{G(e(D)),r(()=>e(D).material)&&M(z)})}l(ee);var ae=a(ee,2),Ne=a(i(ae),2);{var xe=M=>{var J=wt("Concentration,");o(M,J)};_(Ne,M=>{G(e(D)),r(()=>e(D).concentration)&&M(xe)})}var Qe=a(Ne,1,!0);l(ae),l(Le);var H=a(Le,2),at=i(H,!0);l(H);var ot=a(H,2);{var $=M=>{var J=Hi(),Re=a(i(J));l(J),B(()=>k(Re,` ${G(e(D)),r(()=>e(D).higherLevelSlot)??""}`)),o(M,J)};_(ot,M=>{G(e(D)),r(()=>e(D).higherLevelSlot)&&M($)})}var Me=a(ot,2);{var m=M=>{var J=Ni(),Re=a(i(J));l(J),B(()=>k(Re,` ${G(e(D)),r(()=>e(D).cantripUpgrade)??""}`)),o(M,J)};_(Me,M=>{G(e(D)),r(()=>e(D).cantripUpgrade)&&M(m)})}B((M,J)=>{k(Y,(G(e(D)),r(()=>e(D).name))),k(K,` ${M??""}`),k(g,` ${G(e(D)),r(()=>e(D).castingTime||e(D).actionType)??""}`),k(re,` ${G(e(D)),r(()=>e(D).range)??""}`),k(me,` ${J??""}`),k(Qe,(G(e(D)),r(()=>e(D).duration))),k(at,(G(e(D)),r(()=>e(D).description)))},[()=>(G(e(D)),r(()=>e(D).classes.join(", "))),()=>(G(e(D)),r(()=>e(D).components.join(", ").toUpperCase()))]),o(fe,ke)},_e=fe=>{const D=lt(()=>e(N));var ke=Oi(),P=We(ke),Y=i(P,!0);l(P);var Te=a(P,2);{var Ye=Ie=>{var qe=Gi(),K=a(i(qe));l(qe),B(()=>k(K,` ${G(e(D)),r(()=>e(D).prerequisite)??""}`)),o(Ie,qe)};_(Te,Ie=>{G(e(D)),r(()=>e(D).prerequisite)&&Ie(Ye)})}var He=a(Te,2),V=i(He,!0);l(He);var be=a(He,2);B(()=>{k(Y,(G(e(D)),r(()=>e(D).name))),k(V,(G(e(D)),r(()=>e(D).description))),tt(be,"href",(G(e(D)),r(()=>e(D).source)))}),o(fe,ke)};_(Ue,fe=>{e(C)==="spell"?fe(ve):fe(_e,!1)})}l(d),o(j,d)};_(F,j=>{e(N)&&j(E)})}l(ce),B(()=>{W=gt(b,1,"tab svelte-1ngjemu",null,W,{active:e(C)==="spell"}),k(we,`ðŸ“œ Spells (${e(le),r(()=>e(le).length)??""})`),f=gt(ze,1,"tab svelte-1ngjemu",null,f,{active:e(C)==="feat"}),k(S,`â­ Feats (${e(te),r(()=>e(te).length)??""})`)}),L("click",b,()=>{c(C,"spell"),c(N,null),c(y,"")}),L("click",ze,()=>{c(C,"feat"),c(N,null),c(y,"")}),Be(A,()=>e(y),j=>c(y,j)),o(x,ne)};_(ue,x=>{e(I)?x(O):x(se,!1)})}l(Ee);var Ce=a(Ee,2),pe=i(Ce),Pe=a(pe,2);l(Ce),l(ie),l($e),B(()=>Pe.disabled=!e(N)),L("click",je,function(...x){h()?.apply(this,x)}),L("click",pe,function(...x){h()?.apply(this,x)}),L("click",Pe,de),L("click",ie,Fa(function(x){la.call(this,n,x)})),L("keydown",ie,function(x){la.call(this,n,x)}),L("click",$e,function(...x){h()?.apply(this,x)}),L("keydown",$e,x=>x.key==="Escape"&&h()()),o(s,$e),Pt()}var Ji=u('<link rel="icon" type="image/png" href="favicon4.png"/> <meta name="viewport" content="width=device-width, initial-scale=1"/>',1),Vi=u('<span class="character-name svelte-1uha8ag"> </span>'),Qi=u("<span> </span>"),Xi=u('<div class="spell-slots-header svelte-1uha8ag"></div>'),Yi=u("<span> </span><br/>",1),Zi=u("<span> </span>"),er=u('<span class="effect-tooltip"><strong> </strong><br/> <br/> <!> <!></span>'),tr=u('<button class="effect-remove-btn svelte-1uha8ag">Ã—</button>'),ar=u('<span class="effect-badge svelte-1uha8ag" tabindex="0"> <!> <!></span>'),sr=u(`<div class="active-effects-header svelte-1uha8ag"></div> <style>.effect-badge {
            position: relative;
          }
          .effect-tooltip {
            position: absolute;
            top: 120%;
            left: 50%;
            transform: translateX(-50%);
            background: #fff;
            color: #222;
            border: 1px solid #a5b4fc;
            border-radius: 6px;
            padding: 8px 12px;
            font-size: 0.95em;
            box-shadow: 0 2px 8px rgba(0,0,0,0.12);
            z-index: 10;
            min-width: 180px;
            max-width: 260px;
            white-space: normal;
            pointer-events: none;
            opacity: 1;
            transition: opacity 0.15s;
          }</style>`,1),lr=u('<div class="rest-menu svelte-1uha8ag"><button class="rest-option svelte-1uha8ag">â˜• Short Rest</button> <button class="rest-option svelte-1uha8ag">ðŸ›ï¸ Long Rest</button></div>'),ir=u('<div class="container svelte-1uha8ag"><header class="svelte-1uha8ag"><div class="header-top svelte-1uha8ag"><div class="header-title svelte-1uha8ag"><div class="title-row svelte-1uha8ag"><h1 class="svelte-1uha8ag">D&D Character Sheet</h1> <!></div> <!> <!></div> <div class="header-right svelte-1uha8ag"><div class="header-controls svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">ðŸŽ²</span><span class="btn-text svelte-1uha8ag">Roll Dice</span></button> <div class="rest-button-container svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">ðŸ˜´</span><span class="btn-text svelte-1uha8ag">Rest</span></button> <!></div> <div class="mode-toggle"><button><span class="btn-icon svelte-1uha8ag"> </span><span class="btn-text svelte-1uha8ag"> </span></button></div></div> <div class="header-search svelte-1uha8ag"><input type="text" placeholder="ðŸ” Search..." class="search-input use-enabled svelte-1uha8ag"/></div></div></div> <div class="header-actions svelte-1uha8ag"><button class="btn btn-mode svelte-1uha8ag">ðŸ“š Browse Spells & Feats</button> <button class="btn btn-secondary">Save to Gist</button> <button class="btn btn-secondary">Load from Gist</button> <button class="btn btn-secondary">Export JSON</button> <button class="btn btn-secondary">Import JSON</button> <input type="file" accept=".json" style="display: none;"/></div></header> <main class="svelte-1uha8ag"><!> <!> <!> <!> <!> <!> <!></main></div> <!> <!> <!> <!>',1);function fr(s,n){Et(n,!1);const t=()=>Xe(Z,"$character",h),v=()=>Xe(sa,"$isEditMode",h),p=()=>Xe(Qt,"$searchFilter",h),[h,C]=Nt();function I(){const $=[],Me=t().classFeatures.spellSlotsByLevel||{};for(let m=1;m<=9;m++){const M=Me[m];if(M&&M.length>0){const J=M.length,Re=M.filter(Ge=>Ge).length;$.push({level:m,available:J-Re,total:J})}}return $}let y=R(!1),T=R(!1),le=R(!1),te=R("save"),N=R(void 0),he=R(""),Se=R(""),Fe=R(""),de=R(!1),$e=R([]),ie=R(),q=!1,je=R(!1),Ee=R(null);function ue($){c(Ee,$)}function O(){c(Ee,null)}function se(){const $=[];Z.update(m=>{const M=m.hitDice.current;m.hitDice.current=Math.min(m.hitDice.max,m.hitDice.current+Math.max(1,Math.floor(m.hitDice.max/2)));const J=m.hitDice.current-M;if(J>0&&$.push(`${J} hit ${J===1?"die":"dice"}`),m.class){const Re=ia(m.class,m.level,m.subclass);m.classFeatures.features||(m.classFeatures.features={}),Re.forEach(Ge=>{if(Ge.resetOn==="short"){const Ze=Ge.name.replace(/\s+/g,"");if(Ge.type==="uses"){const Ae=typeof Ge.maxUses=="function"?Ge.maxUses(m.level):Ge.maxUses;m.classFeatures.features[Ze]=Array(Ae).fill(!1),$.push(Ge.name)}else if(Ge.type==="pool"){const Ae=typeof Ge.maxPool=="function"?Ge.maxPool(m.level):Ge.maxPool;Ae!==void 0&&(m.classFeatures.features[Ze]=Ae,$.push(Ge.name))}}})}return m}),c(je,!1);const Me=$.length>0?`Short rest taken! Restored: ${$.join(", ")}`:"Short rest taken!";Bt.add(Me,"success")}function Ce(){const $=[];Z.update(m=>{const M=m.maxHP-m.currentHP;M>0&&$.push(`${M} HP`),m.currentHP=m.maxHP,m.tempHP=0;const J=m.hitDice.max-m.hitDice.current;J>0&&$.push(`${J} hit ${J===1?"die":"dice"}`),m.hitDice.current=m.hitDice.max;let Re=0;if(m.classFeatures.spellSlotsByLevel&&Object.keys(m.classFeatures.spellSlotsByLevel).forEach(Ge=>{const Ze=m.classFeatures.spellSlotsByLevel[parseInt(Ge)];if(Ze){const Ae=Ze.filter(vt=>vt).length;Re+=Ae,m.classFeatures.spellSlotsByLevel[parseInt(Ge)]=Array(Ze.length).fill(!1)}}),Re>0&&$.push(`${Re} spell ${Re===1?"slot":"slots"}`),m.class){const Ge=ia(m.class,m.level,m.subclass);m.classFeatures.features||(m.classFeatures.features={});let Ze=!1;Ge.forEach(Ae=>{const vt=Ae.name.replace(/\s+/g,"");if(!(Ae.type==="info"||Ae.type==="channelDivinity")){if(Ae.type==="uses"){const dt=typeof Ae.maxUses=="function"?Ae.maxUses(m.level):Ae.maxUses;m.classFeatures.features[vt]=Array(dt).fill(!1),Ze=!0}else if(Ae.type==="pool"){const dt=typeof Ae.maxPool=="function"?Ae.maxPool(m.level):Ae.maxPool;dt!==void 0&&(m.classFeatures.features[vt]=dt,Ze=!0)}}}),Ze&&$.push("all class features")}return m}),c(je,!1);const Me=$.length>0?`Long rest taken! Restored: ${$.join(", ")}`:"Long rest taken! Fully rested.";Bt.add(Me,"success")}function pe($){c(he,""),c(Se,""),c(Fe,""),c(de,!1),c($e,[]),q=!1,typeof $=="string"?c(he,$):(c(he,$.notation),c(Se,$.damageNotation||""),c(Fe,$.attackName||""),c(de,!!$.applyHalfDamage),c($e,$.bonusBreakdown||[])),c(y,!0)}function Pe($){const{notation:Me}=$.detail;c(he,""),q=!0,setTimeout(()=>{c(he,Me),c(Se,""),c(Fe,"Hit Die")},0),c(y,!0)}function x(){if(c(y,!1),q&&e(ie)){const $=e(ie).getLastRollTotal();if($!==null){const Me=Math.max(1,$);Z.update(m=>(m.hitDice.current=Math.max(0,m.hitDice.current-1),m.currentHP=Math.min(m.maxHP,m.currentHP+Me),m))}q=!1}}function ne(){console.log("toggleMode called, current isEditMode:",v()),sa.update($=>(console.log("Updating isEditMode from",$,"to",!$),!$))}function oe($){$.target.closest(".rest-button-container")||c(je,!1)}ca(()=>{console.log("onMount - initial isEditMode:",v()),console.log("onMount - body classes:",document.body.className);const $=sa.subscribe(Me=>{console.log("isEditMode subscription triggered, value:",Me),console.log("Body classes before:",document.body.className),Me?(document.body.classList.remove("use-mode"),console.log("Removed use-mode class (Edit Mode)")):(document.body.classList.add("use-mode"),console.log("Added use-mode class (Use Mode)")),console.log("Body classes after:",document.body.className)});return document.addEventListener("click",oe),()=>{$(),document.removeEventListener("click",oe)}});function ge(){us(t())}function b(){e(N)?.click()}async function W($){const m=$.target.files?.[0];if(m)try{const M=await ps(m);Z.set(M),alert("Character imported successfully!")}catch{alert("Failed to import character file")}}Rt();var we=ir();vs("1uha8ag",$=>{var Me=Ji();ga(2),Oa(()=>{os.title="D&D Character Sheet"}),o($,Me)});var ze=We(we),f=i(ze),S=i(f),Q=i(S),A=i(Q),X=a(i(A),2);{var Ke=$=>{var Me=Vi(),m=i(Me);l(Me),B(()=>k(m,`${t().name??""} (${t().level??""})`)),o($,Me)};_(X,$=>{t().name&&$(Ke)})}l(A);var ce=a(A,2);{var ye=$=>{var Me=Xi();ut(Me,5,I,ft,(m,M)=>{var J=Qi();let Re;var Ge=i(J);l(J),B(()=>{Re=gt(J,1,"slot-badge svelte-1uha8ag",null,Re,{depleted:e(M).available===0}),k(Ge,`Lv${e(M).level??""}: ${e(M).available??""}/${e(M).total??""}`)}),o(m,J)}),l(Me),o($,Me)};_(ce,$=>{I().length>0&&$(ye)})}var Je=a(ce,2);{var Oe=$=>{var Me=sr(),m=We(Me);ut(m,5,()=>t().activeStates,ft,(M,J,Re)=>{var Ge=ar(),Ze=i(Ge),Ae=a(Ze);{var vt=bt=>{var xt=er(),Dt=i(xt),ta=i(Dt,!0);l(Dt);var aa=a(Dt,2),ct=a(aa,3);{var pt=_t=>{var jt=Yi(),mt=We(jt),Ut=i(mt);l(mt),ga(),B(()=>k(Ut,`Attack Bonus: ${e(J).attackBonus>0?"+":""}${e(J).attackBonus??""}`)),o(_t,jt)};_(ct,_t=>{e(J).attackBonus&&_t(pt)})}var St=a(ct,2);{var Ht=_t=>{var jt=Zi(),mt=i(jt);l(jt),B(()=>k(mt,`Damage Bonus: ${e(J).damageBonus>0?"+":""}${e(J).damageBonus??""}`)),o(_t,jt)};_(St,_t=>{e(J).damageBonus&&_t(Ht)})}l(xt),B(()=>{k(ta,e(J).name),k(aa,` ${e(J).description??""}`)}),o(bt,xt)};_(Ae,bt=>{e(Ee)===Re&&bt(vt)})}var dt=a(Ae,2);{var Tt=bt=>{var xt=tr();B(()=>tt(xt,"title",`End ${e(J).name??""}`)),L("click",xt,()=>{Z.update(Dt=>(Dt.activeStates&&(Dt.activeStates=Dt.activeStates.filter((ta,aa)=>aa!==Re)),Dt))}),o(bt,xt)};_(dt,bt=>{v()||bt(Tt)})}l(Ge),B(()=>{tt(Ge,"aria-label",e(J).name),k(Ze,`âœ¨ ${e(J).name??""} `)}),L("mouseenter",Ge,()=>ue(Re)),L("mouseleave",Ge,O),L("focus",Ge,()=>ue(Re)),L("blur",Ge,O),L("touchstart",Ge,Ba(()=>ue(Re))),L("touchend",Ge,Ba(O)),o(M,Ge)}),l(m),ga(2),o($,Me)};_(Je,$=>{t().activeStates&&t().activeStates.length>0&&$(Oe)})}l(Q);var nt=a(Q,2),F=i(nt),E=i(F),j=a(E,2),d=i(j),Ue=a(d,2);{var ve=$=>{var Me=lr(),m=i(Me),M=a(m,2);l(Me),L("click",m,se),L("click",M,Ce),o($,Me)};_(Ue,$=>{e(je)&&$(ve)})}l(j);var _e=a(j,2),fe=i(_e);let D;var ke=i(fe),P=i(ke,!0);l(ke);var Y=a(ke),Te=i(Y,!0);l(Y),l(fe),l(_e),l(F);var Ye=a(F,2),He=i(Ye);De(He),l(Ye),l(nt),l(S);var V=a(S,2),be=i(V),Ie=a(be,2),qe=a(Ie,2),K=a(qe,2),Le=a(K,2),Ve=a(Le,2);Ca(Ve,$=>c(N,$),()=>e(N)),l(V),l(f);var g=a(f,2),w=i(g);js(w,{});var re=a(w,2);Gs(re,{$$events:{rollHitDice:Pe}});var ee=a(re,2);Bs(ee,{$$events:{roll:$=>pe($.detail)}});var me=a(ee,2);zs(me,{$$events:{roll:$=>pe($.detail)}});var U=a(me,2);Fl(U,{$$events:{roll:$=>pe($.detail)}});var z=a(U,2);Jl(z,{});var ae=a(z,2);Xl(ae,{}),l(g),l(ze);var Ne=a(ze,2);Ca(di(Ne,{get notation(){return e(he)},get damageNotation(){return e(Se)},get attackName(){return e(Fe)},get applyHalfDamage(){return e(de)},get bonusBreakdown(){return e($e)},get visible(){return e(y)},$$events:{close:x},$$legacy:!0}),$=>c(ie,$),()=>e(ie));var xe=a(Ne,2);{var Qe=$=>{Fi($,{get mode(){return e(te)},$$events:{close:()=>c(T,!1)}})};_(xe,$=>{e(T)&&$(Qe)})}var H=a(xe,2);{var at=$=>{Ki($,{onClose:()=>c(le,!1)})};_(H,$=>{e(le)&&$(at)})}var ot=a(H,2);ds(ot,{}),B(()=>{D=gt(fe,1,"btn btn-mode svelte-1uha8ag",null,D,{"use-mode":!v()}),k(P,v()?"ðŸ“":"ðŸŽ²"),k(Te,v()?"Edit Mode":"Use Mode")}),L("click",E,()=>c(y,!0)),L("click",d,()=>c(je,!e(je))),L("click",fe,ne),Be(He,p,$=>fs(Qt,$)),L("click",be,()=>c(le,!0)),L("click",Ie,()=>{c(te,"save"),c(T,!0)}),L("click",qe,()=>{c(te,"load"),c(T,!0)}),L("click",K,ge),L("click",Le,b),L("change",Ve,W),o(s,we),Pt(),C()}export{fr as component};
