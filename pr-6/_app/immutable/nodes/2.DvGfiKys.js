import{f as p,e as R,a as o,s as w,c as nt,t as At}from"../chunks/DBs_ODQp.js";import{i as It}from"../chunks/BbaRvQ4Z.js";import{c as sa,o as pa,a as rs}from"../chunks/CHX4V4AM.js";import{a7 as Pa,i as Qa,aZ as ns,a_ as Ya,a$ as ka,K as Xt,e as Xa,b0 as Za,T as fa,b1 as is,b2 as os,b3 as cs,q as Da,b4 as vs,b5 as ds,ab as us,d as n,r as Ia,g as ps,C as Tt,F as M,G as Et,H as r,I as l,J as s,b6 as et,b7 as Jt,s as c,a4 as P,f as e,m as it,E as Ee,A as H,b8 as aa,b9 as Lt,ba as da,ao as ra,bb as fs}from"../chunks/DwmZeGF1.js";import{c as Ft,a as ae,e as yt,i as St,u as es,s as Zt,b as ht,d as ga,f as na,g as gs,t as Gt,h as ms,T as hs,j as bs,k as _s}from"../chunks/DQJFtNtV.js";import{i as S,s as qt,a as at,b as ut,d as ca,e as ys}from"../chunks/0ovU14Ao.js";import{p as kt,b as ja}from"../chunks/CFUzmRYW.js";import{b as va,r as ks}from"../chunks/Bj8OIMjb.js";function _a(a,i,t=!1){if(a.multiple){if(i==null)return;if(!Qa(i))return ns();for(var d of a.options)d.selected=i.includes(ua(d));return}for(d of a.options){var u=ua(d);if(Ya(u,i)){d.selected=!0;return}}(!t||i!==void 0)&&(a.selectedIndex=-1)}function Ba(a){var i=new MutationObserver(()=>{_a(a,a.__value)});i.observe(a,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Pa(()=>{i.disconnect()})}function Aa(a,i,t=i){var d=new WeakSet,u=!0;ka(a,"change",m=>{var h=m?"[selected]":":checked",D;if(a.multiple)D=[].map.call(a.querySelectorAll(h),ua);else{var k=a.querySelector(h)??a.querySelector("option:not([disabled])");D=k&&ua(k)}t(D),Xt!==null&&d.add(Xt)}),Xa(()=>{var m=i();if(a===document.activeElement){var h=Za??Xt;if(d.has(h))return}if(_a(a,m,u),u&&m===void 0){var D=a.querySelector(":checked");D!==null&&(m=ua(D),t(m))}a.__value=m,u=!1}),Ba(a)}function ua(a){return"__value"in a?a.__value:a.value}const Ss=Symbol("is custom element"),xs=Symbol("is html");function we(a){if(fa){var i=!1,t=()=>{if(!i){if(i=!0,a.hasAttribute("value")){var d=a.value;We(a,"value",null),a.value=d}if(a.hasAttribute("checked")){var u=a.checked;We(a,"checked",null),a.checked=u}}};a.__on_r=t,Da(t),vs()}}function ya(a,i){var t=Ta(a);t.value===(t.value=i??void 0)||a.value===i&&(i!==0||a.nodeName!=="PROGRESS")||(a.value=i??"")}function ts(a,i){var t=Ta(a);t.checked!==(t.checked=i??void 0)&&(a.checked=i)}function We(a,i,t,d){var u=Ta(a);fa&&(u[i]=a.getAttribute(i),i==="src"||i==="srcset"||i==="href"&&a.nodeName==="LINK")||u[i]!==(u[i]=t)&&(i==="loading"&&(a[is]=t),t==null?a.removeAttribute(i):typeof t!="string"&&$s(a).includes(i)?a[i]=t:a.setAttribute(i,t))}function Ta(a){return a.__attributes??={[Ss]:a.nodeName.includes("-"),[xs]:a.namespaceURI===os}}var Ha=new Map;function $s(a){var i=a.getAttribute("is")||a.nodeName,t=Ha.get(i);if(t)return t;Ha.set(i,t=[]);for(var d,u=a,m=Element.prototype;m!==u;){d=ds(u);for(var h in d)d[h].set&&t.push(h);u=cs(u)}return t}function He(a,i,t=i){var d=new WeakSet;ka(a,"input",async u=>{var m=u?a.defaultValue:a.value;if(m=$a(a)?Ca(m):m,t(m),Xt!==null&&d.add(Xt),await us(),m!==(m=i())){var h=a.selectionStart,D=a.selectionEnd,k=a.value.length;if(a.value=m??"",D!==null){var x=a.value.length;h===D&&D===k&&x>k?(a.selectionStart=x,a.selectionEnd=x):(a.selectionStart=h,a.selectionEnd=Math.min(D,x))}}}),(fa&&a.defaultValue!==a.value||n(i)==null&&a.value)&&(t($a(a)?Ca(a.value):a.value),Xt!==null&&d.add(Xt)),Ia(()=>{var u=i();if(a===document.activeElement){var m=Za??Xt;if(d.has(m))return}$a(a)&&u===Ca(a.value)||a.type==="date"&&!u&&!a.value||u!==a.value&&(a.value=u??"")})}const xa=new Set;function Ua(a,i,t,d,u=d){var m=t.getAttribute("type")==="checkbox",h=a;let D=!1;if(i!==null)for(var k of i)h=h[k]??=[];h.push(t),ka(t,"change",()=>{var x=t.__value;m&&(x=Na(h,x,t.checked)),u(x)},()=>u(m?[]:null)),Ia(()=>{var x=d();if(fa&&t.defaultChecked!==t.checked){D=!0;return}m?(x=x||[],t.checked=x.includes(t.__value)):t.checked=Ya(t.__value,x)}),Pa(()=>{var x=h.indexOf(t);x!==-1&&h.splice(x,1)}),xa.has(h)||(xa.add(h),Da(()=>{h.sort((x,Y)=>x.compareDocumentPosition(Y)===4?-1:1),xa.delete(h)})),Da(()=>{if(D){var x;if(m)x=Na(h,x,t.checked);else{var Y=h.find(q=>q.checked);x=Y?.__value}u(x)}})}function Fa(a,i,t=i){ka(a,"change",d=>{var u=d?a.defaultChecked:a.checked;t(u)}),(fa&&a.defaultChecked!==a.checked||n(i)==null)&&t(a.checked),Ia(()=>{var d=i();a.checked=!!d})}function Na(a,i,t){for(var d=new Set,u=0;u<a.length;u+=1)a[u].checked&&d.add(a[u].__value);return t||d.delete(i),Array.from(d)}function $a(a){var i=a.type;return i==="number"||i==="range"}function Ca(a){return a===""?null:+a}function Cs(a,i,t){var d=ps(a,i);d&&d.set&&(a[i]=t,Pa(()=>{a[i]=null}))}function Ea(a){return function(...i){var t=i[0];return t.stopPropagation(),a?.apply(this,i)}}function ia(a,i){var t=a.$$events?.[i.type],d=Qa(t)?t.slice():t==null?[]:[t];for(var u of d)u.call(this,i)}const Ls="";function as(...a){return va+Ls+ks(a[0],a[1])}const Ma={paladin:{name:"Paladin",hitDice:"d10",spellcaster:!0,spellcastingAbility:"charisma",spellSlotsByLevel:{1:0,2:2,3:3,4:3,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Divine Sense",type:"uses",maxUses:(a,i=1)=>1+Math.max(1,i),resetOn:"long",description:"Detect celestials, fiends, and undead within 60 feet",minLevel:1},{name:"Lay on Hands",type:"pool",maxPool:a=>a*5,resetOn:"long",description:"Heal wounds or cure disease",minLevel:1},{name:"Divine Smite",type:"spellSlot",description:"Expend spell slot to deal extra radiant damage",minLevel:2,rollable:!0},{name:"Channel Divinity",type:"pool",maxPool:a=>a>=18?3:a>=6?2:1,resetOn:"short",description:"Sacred Weapon or Turn Undead",minLevel:3}]},fighter:{name:"Fighter",hitDice:"d10",spellcaster:!1,features:[{name:"Second Wind",type:"uses",maxUses:1,resetOn:"short",description:"Regain 1d10 + fighter level HP as bonus action",minLevel:1,rollable:!0,rollFormula:a=>`1d10+${a}`},{name:"Action Surge",type:"uses",maxUses:a=>a>=17?2:1,resetOn:"short",description:"Take one additional action on your turn",minLevel:2},{name:"Indomitable",type:"uses",maxUses:a=>a>=17?3:a>=13?2:1,resetOn:"long",description:"Reroll a failed saving throw",minLevel:9}],subclasses:{champion:{name:"Champion",features:[{name:"Improved Critical",type:"info",description:"Critical hit on 19-20",minLevel:3},{name:"Remarkable Athlete",type:"info",description:"Add half proficiency to STR/DEX/CON checks, increase long jump distance",minLevel:7},{name:"Additional Fighting Style",type:"info",description:"Choose a second fighting style",minLevel:10},{name:"Superior Critical",type:"info",description:"Critical hit on 18-20",minLevel:15},{name:"Survivor",type:"info",description:"Regain 5 + CON mod HP at start of turn if below half HP",minLevel:18}]},battlemaster:{name:"Battle Master",features:[{name:"Combat Superiority",type:"uses",maxUses:a=>a>=15?6:a>=7?5:4,resetOn:"short",description:a=>`Use superiority dice (${a>=18?"d12":a>=10?"d10":"d8"}) for maneuvers`,minLevel:3},{name:"Know Your Enemy",type:"info",description:"Learn capabilities of creatures you observe",minLevel:7},{name:"Improved Combat Superiority",type:"info",description:"Superiority dice become d10",minLevel:10},{name:"Relentless",type:"info",description:"Regain 1 superiority die if you have none at start of turn",minLevel:15}]}}},rogue:{name:"Rogue",hitDice:"d8",spellcaster:!1,features:[{name:"Sneak Attack",type:"info",description:a=>`Deal ${Math.ceil(a/2)}d6 extra damage once per turn with advantage or ally nearby`,minLevel:1,rollable:!0,rollFormula:a=>`${Math.ceil(a/2)}d6`},{name:"Cunning Action",type:"info",description:"Dash, Disengage, or Hide as a bonus action",minLevel:2},{name:"Uncanny Dodge",type:"info",description:"Use reaction to halve damage from an attack",minLevel:5},{name:"Evasion",type:"info",description:"Take no damage on successful Dex save (half on fail)",minLevel:7}]},wizard:{name:"Wizard",hitDice:"d6",spellcaster:!0,spellcastingAbility:"intelligence",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Arcane Recovery",type:"uses",maxUses:1,resetOn:"long",description:a=>`Recover spell slots totaling up to ${Math.ceil(a/2)} levels during short rest`,minLevel:1},{name:"Spell Mastery",type:"info",description:"Cast one 1st-level and one 2nd-level spell at will",minLevel:18}]},cleric:{name:"Cleric",hitDice:"d8",spellcaster:!0,spellcastingAbility:"wisdom",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Channel Divinity",type:"pool",maxPool:a=>a>=18?3:a>=6?2:1,resetOn:"short",description:"Turn Undead or domain-specific ability",minLevel:2},{name:"Destroy Undead",type:"info",description:a=>`Channel Divinity destroys undead of CR ${a>=17?4:a>=14?3:a>=11?2:a>=8?1:.5} or lower`,minLevel:5},{name:"Divine Intervention",type:"uses",maxUses:1,resetOn:"long",description:a=>`${a}% chance to succeed, implore deity for aid`,minLevel:10}],subclasses:{war:{name:"War Domain",features:[{name:"War Priest",type:"uses",maxUses:(a,i=1)=>Math.max(1,i),resetOn:"long",description:"Make one weapon attack as a bonus action",minLevel:1},{name:"Guided Strike",type:"channelDivinity",description:"Use your Channel Divinity to gain +10 to an attack roll. Make this choice after you see the roll, but before the DM says whether the attack hits or misses.",minLevel:2,resetOn:"short"},{name:"War God's Blessing",type:"channelDivinity",description:"Use reaction to grant +10 to an ally's attack roll within 30 feet. Consumes one use of Channel Divinity.",minLevel:6,resetOn:"short"},{name:"Divine Strike",type:"info",description:a=>`Deal extra ${a>=14?"2d8":"1d8"} weapon damage once per turn`,minLevel:8,rollable:!0,rollFormula:a=>a>=14?"2d8":"1d8"},{name:"Avatar of Battle",type:"info",description:"Gain resistance to nonmagical weapon damage",minLevel:17}]},life:{name:"Life Domain",features:[{name:"Disciple of Life",type:"info",description:"Healing spells restore additional 2 + spell level HP",minLevel:1},{name:"Preserve Life",type:"pool",maxPool:a=>a*5,resetOn:"short",description:"Restore HP to creatures within 30 feet",minLevel:2},{name:"Blessed Healer",type:"info",description:"Regain 2 + spell level HP when you cast healing spell",minLevel:6},{name:"Divine Strike",type:"info",description:a=>`Deal extra ${a>=14?"2d8":"1d8"} radiant damage once per turn`,minLevel:8,rollable:!0,rollFormula:a=>a>=14?"2d8":"1d8"},{name:"Supreme Healing",type:"info",description:"Maximize healing dice instead of rolling",minLevel:17}]}}},barbarian:{name:"Barbarian",hitDice:"d12",spellcaster:!1,features:[{name:"Rage",type:"uses",maxUses:a=>a>=20?1/0:a>=17?6:a>=12?5:a>=6?4:a>=3?3:2,resetOn:"long",description:a=>`+${a>=16?4:a>=9?3:2} damage, resistance to physical damage`,minLevel:1},{name:"Reckless Attack",type:"info",description:"Gain advantage on melee attacks, enemies get advantage on you",minLevel:2},{name:"Danger Sense",type:"info",description:"Advantage on Dex saves against effects you can see",minLevel:2}],subclasses:{berserker:{name:"Path of the Berserker",features:[{name:"Frenzy",type:"info",description:"While raging, make melee attack as bonus action (gain 1 exhaustion after rage)",minLevel:3},{name:"Mindless Rage",type:"info",description:"Cannot be charmed or frightened while raging",minLevel:6},{name:"Intimidating Presence",type:"info",description:"Use action to frighten creature within 30 feet",minLevel:10},{name:"Retaliation",type:"info",description:"When damaged by creature within 5 feet, make melee attack as reaction",minLevel:14}]}}}};function Ot(a){const i=a.toLowerCase();return Ma[i]||null}function oa(a,i,t){const d=Ot(a);if(!d)return[];const u=d.features.filter(m=>!m.minLevel||m.minLevel<=i);if(t&&d.subclasses&&d.subclasses[t]){const m=d.subclasses[t].features.filter(h=>!h.minLevel||h.minLevel<=i);return[...u,...m]}return u}function Ga(a){const i=Ot(a);return!i||!i.subclasses?[]:Object.keys(i.subclasses).map(t=>({id:t,name:i.subclasses[t].name}))}function Oa(a,i){const t=Ot(a);return!t||!t.spellcaster||!t.spellSlotsByLevel?0:t.spellSlotsByLevel[i]||0}function qa(a,i,t){const d=Ot(a);return!d||!d.spellcaster?0:Math.max(1,t+i)}function ws(a,i,t){const d=Ot(a);return!d||!d.spellcaster?null:8+i+t}function Ds(){return Object.keys(Ma).map(a=>({id:a,name:Ma[a].name}))}var js=p('<div class="section-header svelte-ls99y2" role="button" tabindex="0"><h2 class="svelte-ls99y2"> </h2> <span class="collapse-btn svelte-ls99y2"> </span></div>');function la(a,i){Tt(i,!1);let t=kt(i,"title",8),d=kt(i,"collapsed",8),u=kt(i,"ariaLabel",8,""),m=kt(i,"onToggle",8);It();var h=js(),D=r(h),k=r(D,!0);l(D);var x=s(D,2),Y=r(x,!0);l(x),l(h),M(()=>{We(h,"aria-expanded",!d()),We(h,"aria-label",u()),w(k,t()),w(Y,d()?"â–¼":"â–²")}),R("click",h,function(...q){m()?.apply(this,q)}),R("keydown",h,q=>{(q.key==="Enter"||q.key===" ")&&m()()}),o(a,h),Et()}var Bs=p("<option> </option>"),As=p("<option> </option>"),Fs=p('<div class="form-group svelte-172i2fj"><label for="characterSubclass" class="svelte-172i2fj">Subclass</label> <select id="characterSubclass" class="svelte-172i2fj"><option>Select Subclass</option><!></select></div>'),Ms=p('<div class="info-grid svelte-172i2fj"><div class="form-group svelte-172i2fj"><label for="characterName" class="svelte-172i2fj">Character Name</label> <input type="text" id="characterName" placeholder="Enter name" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterClass" class="svelte-172i2fj">Class</label> <select id="characterClass" class="svelte-172i2fj"><option>Select Class</option><!></select></div> <!> <div class="form-group svelte-172i2fj"><label for="characterLevel" class="svelte-172i2fj">Level</label> <input type="number" id="characterLevel" min="1" max="20" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterRace" class="svelte-172i2fj">Race</label> <input type="text" id="characterRace" placeholder="e.g., Human" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterBackground" class="svelte-172i2fj">Background</label> <input type="text" id="characterBackground" placeholder="e.g., Soldier" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterAlignment" class="svelte-172i2fj">Alignment</label> <input type="text" id="characterAlignment" placeholder="e.g., Lawful Good" class="svelte-172i2fj"/></div></div>'),Rs=p('<section class="character-info svelte-172i2fj"><!> <!></section>');function Ps(a,i){Tt(i,!1);const t=()=>at(ae,"$character",u),d=()=>at(Ft,"$collapsedStates",u),[u,m]=qt(),h=P(),D=Ds();function k(ve){const de=ve.target;ae.update(J=>(J.class=de.value,J.subclass="",J))}function x(ve){const de=ve.target;ae.update(J=>(J.subclass=de.value,J))}function Y(ve){const de=ve.target;ae.update(J=>(J.level=parseInt(de.value)||1,J)),es()}et(()=>(t(),Ga),()=>{c(h,t().class?Ga(t().class):[])}),Jt(),It();var q=Rs(),se=r(q);{let ve=it(()=>(d(),n(()=>d().characterInfo?"Expand":"Collapse")));la(se,{title:"Character Info",get collapsed(){return d(),n(()=>d().characterInfo)},get ariaLabel(){return e(ve)},onToggle:()=>Ft.update(de=>({...de,characterInfo:!de.characterInfo}))})}var re=s(se,2);{var V=ve=>{var de=Ms(),J=r(de),ze=s(r(J),2);we(ze),l(J);var Ve=s(J,2),z=s(r(Ve),2),Ce=r(z);Ce.value=Ce.__value="";var X=s(Ce);yt(X,1,()=>D,St,(Oe,je)=>{var f=Bs(),L=r(f,!0);l(f);var W={};M(()=>{w(L,(e(je),n(()=>e(je).name))),W!==(W=(e(je),n(()=>e(je).id)))&&(f.value=(f.__value=(e(je),n(()=>e(je).id)))??"")}),o(Oe,f)}),l(z);var fe;Ba(z),l(Ve);var De=s(Ve,2);{var Me=Oe=>{var je=Fs(),f=s(r(je),2),L=r(f);L.value=L.__value="";var W=s(L);yt(W,1,()=>e(h),St,(G,Se)=>{var Ke=As(),tt=r(Ke,!0);l(Ke);var ge={};M(()=>{w(tt,(e(Se),n(()=>e(Se).name))),ge!==(ge=(e(Se),n(()=>e(Se).id)))&&(Ke.value=(Ke.__value=(e(Se),n(()=>e(Se).id)))??"")}),o(G,Ke)}),l(f);var ne;Ba(f),l(je),M(()=>{ne!==(ne=(t(),n(()=>t().subclass)))&&(f.value=(f.__value=(t(),n(()=>t().subclass)))??"",_a(f,(t(),n(()=>t().subclass))))}),R("change",f,x),o(Oe,je)};S(De,Oe=>{e(h),n(()=>e(h).length>0)&&Oe(Me)})}var ke=s(De,2),Re=s(r(ke),2);we(Re),l(ke);var j=s(ke,2),pe=s(r(j),2);we(pe),l(j);var b=s(j,2),T=s(r(b),2);we(T),l(b);var Z=s(b,2),Ze=s(r(Z),2);we(Ze),l(Z),l(de),M(()=>{fe!==(fe=(t(),n(()=>t().class)))&&(z.value=(z.__value=(t(),n(()=>t().class)))??"",_a(z,(t(),n(()=>t().class)))),ya(Re,(t(),n(()=>t().level)))}),He(ze,()=>t().name,Oe=>ut(ae,n(t).name=Oe,n(t))),R("change",z,k),R("change",Re,Y),He(pe,()=>t().race,Oe=>ut(ae,n(t).race=Oe,n(t))),He(T,()=>t().background,Oe=>ut(ae,n(t).background=Oe,n(t))),He(Ze,()=>t().alignment,Oe=>ut(ae,n(t).alignment=Oe,n(t))),o(ve,de)};S(re,ve=>{d(),n(()=>!d().characterInfo)&&ve(V)})}l(q),o(a,q),Et(),m()}var Is=p('<div class="ability-card svelte-bbv1xt"><h3 class="svelte-bbv1xt"> </h3> <input type="number" class="ability-score svelte-bbv1xt" min="1" max="30"/> <div class="ability-modifier svelte-bbv1xt"> </div> <button class="roll-btn svelte-bbv1xt">Check</button> <div class="save-row svelte-bbv1xt"><input type="checkbox" class="svelte-bbv1xt"/> <label class="svelte-bbv1xt">Save</label> <button class="roll-btn-small svelte-bbv1xt">Roll</button></div></div>'),Ts=p('<div class="proficiency-bonus svelte-bbv1xt"><label for="profBonus">Proficiency Bonus</label> <input type="number" id="profBonus" class="prof-input svelte-bbv1xt"/></div> <div class="abilities-grid svelte-bbv1xt"></div>',1),Es=p("<section><!> <!></section>");function Hs(a,i){Tt(i,!1);const t=()=>at(ga,"$abilityModifiers",h),d=()=>at(ae,"$character",h),u=()=>at(Zt,"$searchFilter",h),m=()=>at(Ft,"$collapsedStates",h),[h,D]=qt(),k=P(),x=P(),Y=sa(),q=[{key:"strength",label:"Strength"},{key:"dexterity",label:"Dexterity"},{key:"constitution",label:"Constitution"},{key:"intelligence",label:"Intelligence"},{key:"wisdom",label:"Wisdom"},{key:"charisma",label:"Charisma"}];function se(){es()}function re(z){const Ce=t()[z],X=`1d20${Ce>=0?"+":""}${Ce}`;Y("roll",{notation:X,rollType:"check"})}function V(z){const Ce=t()[z],X=d().saveProficiencies[z]?d().proficiencyBonus:0,fe=Ce+X,De=`1d20${fe>=0?"+":""}${fe}`;Y("roll",{notation:De,rollType:"save"})}et(()=>u(),()=>{c(k,q.filter(({label:z})=>u()?z.toLowerCase().includes(u().toLowerCase()):!0))}),et(()=>(e(k),u()),()=>{c(x,e(k).length>0||!u()||u().toLowerCase().includes("proficiency"))}),Jt(),It();var ve=Es();let de;var J=r(ve);la(J,{title:"Ability Scores",get collapsed(){return m(),n(()=>m().abilityScores)},ariaLabel:"Toggle Ability Scores Section",onToggle:()=>Ft.update(z=>({...z,abilityScores:!z.abilityScores}))});var ze=s(J,2);{var Ve=z=>{var Ce=Ts(),X=Ee(Ce),fe=s(r(X),2);we(fe),l(X);var De=s(X,2);yt(De,5,()=>e(k),St,(Me,ke)=>{let Re=()=>e(ke).key,j=()=>e(ke).label;var pe=Is(),b=r(pe),T=r(b,!0);l(b);var Z=s(b,2);we(Z);var Ze=s(Z,2),Oe=r(Ze);l(Ze);var je=s(Ze,2),f=s(je,2),L=r(f);we(L);var W=s(L,2),ne=s(W,2);l(f),l(pe),M(G=>{w(T,G),w(Oe,`${t(),Re(),n(()=>t()[Re()]>=0?"+":"")??""}${t(),Re(),n(()=>t()[Re()])??""}`),We(L,"id",`${Re()}-save`),We(W,"for",`${Re()}-save`)},[()=>(j(),n(()=>j().substring(0,3).toUpperCase()))]),He(Z,()=>d().abilities[Re()],G=>ut(ae,n(d).abilities[Re()]=G,n(d))),R("change",Z,se),R("click",je,()=>re(Re())),Fa(L,()=>d().saveProficiencies[Re()],G=>ut(ae,n(d).saveProficiencies[Re()]=G,n(d))),R("click",ne,()=>V(Re())),o(Me,pe)}),l(De),He(fe,()=>d().proficiencyBonus,Me=>ut(ae,n(d).proficiencyBonus=Me,n(d))),o(z,Ce)};S(ze,z=>{m(),n(()=>!m().abilityScores)&&z(Ve)})}l(ve),M(()=>de=ht(ve,1,"ability-scores svelte-bbv1xt",null,de,{hidden:!e(x)})),o(a,ve),Et(),D()}function Ra(a,i){if(!a.class)return null;const t=Ot(a.class);if(!t||!t.spellcaster||!t.spellcastingAbility)return null;const d=i[t.spellcastingAbility];return 8+a.proficiencyBonus+d}function Wa(a,i){if(!a.class)return 0;const t=Ot(a.class);return!t||!t.spellcaster||!t.spellcastingAbility?0:i[t.spellcastingAbility]}var Us=p('<input type="number" id="armorClass" class="stat-input svelte-1r5hyyb"/>'),Ns=p('<input type="text" id="armorClass" readonly=""/>'),Gs=p('<div class="stat-box svelte-1r5hyyb"><label for="spellSaveDC" class="svelte-1r5hyyb">Spell Save DC</label> <input type="number" id="spellSaveDC" class="stat-input svelte-1r5hyyb" readonly="" title="8 + Proficiency Bonus + Spellcasting Ability Modifier"/></div>'),Os=p('<span class="hit-dice-type"> </span>'),qs=p('<div class="stats-grid svelte-1r5hyyb"><div class="stat-box svelte-1r5hyyb"><label for="armorClass" class="svelte-1r5hyyb">Armor Class</label> <!></div> <div class="stat-box svelte-1r5hyyb"><label for="initiative" class="svelte-1r5hyyb">Initiative</label> <input type="number" id="initiative" class="stat-input svelte-1r5hyyb"/></div> <div class="stat-box svelte-1r5hyyb"><label for="speed" class="svelte-1r5hyyb">Speed</label> <input type="text" id="speed" class="stat-input svelte-1r5hyyb"/></div> <!></div> <div class="hp-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Points</h3> <div><div class="hp-inputs svelte-1r5hyyb"><input type="number" class="hp-current svelte-1r5hyyb" min="0"/> <span class="hp-separator svelte-1r5hyyb">/</span> <input type="number" class="hp-max svelte-1r5hyyb" min="0"/></div> <div class="hp-controls svelte-1r5hyyb"><button class="hp-btn svelte-1r5hyyb">âˆ’</button> <button class="hp-btn svelte-1r5hyyb">+</button> <button class="hp-btn svelte-1r5hyyb">âˆ’5</button> <button class="hp-btn svelte-1r5hyyb">+5</button></div></div> <div class="temp-hp svelte-1r5hyyb"><label for="tempHP" class="svelte-1r5hyyb">Temp HP</label> <input type="number" id="tempHP" min="0" class="svelte-1r5hyyb"/></div></div> <div class="hit-dice-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Dice</h3> <div class="hit-dice-display svelte-1r5hyyb"><input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <span>/</span> <input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <!></div> <div class="hit-dice-controls"><label for="hitDiceCount" class="svelte-1r5hyyb">Roll</label> <input type="number" id="hitDiceCount" class="hit-dice-count-input svelte-1r5hyyb" min="1" value="1"/> <button class="btn btn-primary roll-hit-dice use-enabled svelte-1r5hyyb">ðŸŽ² Roll</button></div></div>',1),Ws=p("<section><!> <!></section>");function zs(a,i){Tt(i,!1);const t=()=>at(ae,"$character",D),d=()=>at(ga,"$abilityModifiers",D),u=()=>at(Zt,"$searchFilter",D),m=()=>at(Ft,"$collapsedStates",D),h=()=>at(na,"$isEditMode",D),[D,k]=qt(),x=P(),Y=P(),q=P(),se=P(),re=sa();function V(Ce){ae.update(X=>(X.currentHP=Math.max(0,Math.min(X.maxHP,X.currentHP+Ce)),X))}function ve(Ce=1){if(t().hitDice.current<=0){alert("No hit dice remaining!");return}if(!t().class){alert("Please select a class first!");return}const X=Ot(t().class);if(!X){alert("Invalid class configuration!");return}const fe=Math.min(Ce,t().hitDice.current),De=X.hitDice,Me=d().constitution,ke=Me>=0?`+${Me}`:`${Me}`,Re=`${fe}${De}${ke}`;re("rollHitDice",{notation:Re,hitDie:De,count:fe})}et(()=>(t(),d()),()=>{c(x,Ra(t(),d()))}),et(()=>t(),()=>{c(Y,t().activeStates&&t().activeStates.length>0?t().activeStates.reduce((Ce,X)=>Ce+(X.acBonus||0),0):0)}),et(()=>t(),()=>{c(q,t().activeStates&&t().activeStates.length>0?t().activeStates.some(Ce=>Ce.name==="Aid"&&Ce.target==="self"):!1)}),et(()=>u(),()=>{c(se,!u()||"armor class".includes(u().toLowerCase())||"initiative".includes(u().toLowerCase())||"speed".includes(u().toLowerCase())||"hit points".includes(u().toLowerCase())||"hp".includes(u().toLowerCase())||"hit dice".includes(u().toLowerCase())||"spell save".includes(u().toLowerCase())||"combat".includes(u().toLowerCase()))}),Jt(),It();var de=Ws();let J;var ze=r(de);{let Ce=it(()=>(m(),n(()=>m().combatStats?"Expand":"Collapse")));la(ze,{title:"Combat Stats",get collapsed(){return m(),n(()=>m().combatStats)},get ariaLabel(){return e(Ce)},onToggle:()=>Ft.update(X=>({...X,combatStats:!X.combatStats}))})}var Ve=s(ze,2);{var z=Ce=>{var X=qs(),fe=Ee(X),De=r(fe),Me=s(r(De),2);{var ke=U=>{var K=Us();we(K),He(K,()=>t().armorClass,Ae=>ut(ae,n(t).armorClass=Ae,n(t))),o(U,K)},Re=U=>{var K=Ns();we(K),M(()=>{ya(K,(e(Y),t(),n(()=>e(Y)!==0?`${t().armorClass} â†’ ${t().armorClass+e(Y)}`:`${t().armorClass}`))),ht(K,1,gs(e(Y)!==0?"stat-input ac-enhanced":"stat-input"),"svelte-1r5hyyb"),We(K,"title",e(Y)!==0?"Base AC plus active effect bonuses":"Base Armor Class")}),o(U,K)};S(Me,U=>{h()?U(ke):U(Re,!1)})}l(De);var j=s(De,2),pe=s(r(j),2);we(pe),l(j);var b=s(j,2),T=s(r(b),2);we(T),l(b);var Z=s(b,2);{var Ze=U=>{var K=Gs(),Ae=s(r(K),2);we(Ae),l(K),M(()=>ya(Ae,e(x))),o(U,K)};S(Z,U=>{e(x)!==null&&U(Ze)})}l(fe);var Oe=s(fe,2),je=s(r(Oe),2);let f;var L=r(je),W=r(L);we(W);var ne=s(W,4);we(ne),l(L);var G=s(L,2),Se=r(G),Ke=s(Se,2),tt=s(Ke,2),ge=s(tt,2);l(G),l(je);var Ue=s(je,2),F=s(r(Ue),2);we(F),l(Ue),l(Oe);var $=s(Oe,2),Q=s(r($),2),le=r(Q);we(le);var N=s(le,4);we(N);var v=s(N,2);{var Te=U=>{const K=it(()=>(H(Ot),t(),n(()=>Ot(t().class))));var Ae=nt(),st=Ee(Ae);{var Be=me=>{const Le=it(()=>(d(),n(()=>d().constitution)));var Fe=Os(),Pe=r(Fe);l(Fe),M(()=>w(Pe,`(${H(e(K)),n(()=>e(K).hitDice)??""}${(e(Le)>=0?`+${e(Le)}`:e(Le))??""})`)),o(me,Fe)};S(st,me=>{e(K)&&me(Be)})}o(U,Ae)};S(v,U=>{t(),n(()=>t().class)&&U(Te)})}l(Q);var ue=s(Q,2),ie=s(r(ue),2),B=s(ie,2);l(ue),l($),M(()=>{f=ht(je,1,"hp-display svelte-1r5hyyb",null,f,{"aid-active":e(q)}),We(W,"max",(t(),n(()=>t().maxHP))),We(le,"max",(t(),n(()=>t().hitDice.max))),We(ie,"max",(t(),n(()=>t().hitDice.current))),B.disabled=(t(),n(()=>t().hitDice.current<=0||!t().class))}),He(pe,()=>t().initiative,U=>ut(ae,n(t).initiative=U,n(t))),He(T,()=>t().speed,U=>ut(ae,n(t).speed=U,n(t))),He(W,()=>t().currentHP,U=>ut(ae,n(t).currentHP=U,n(t))),He(ne,()=>t().maxHP,U=>ut(ae,n(t).maxHP=U,n(t))),R("click",Se,()=>V(-1)),R("click",Ke,()=>V(1)),R("click",tt,()=>V(-5)),R("click",ge,()=>V(5)),He(F,()=>t().tempHP,U=>ut(ae,n(t).tempHP=U,n(t))),He(le,()=>t().hitDice.current,U=>ut(ae,n(t).hitDice.current=U,n(t))),He(N,()=>t().hitDice.max,U=>ut(ae,n(t).hitDice.max=U,n(t))),R("input",ie,U=>{const K=U.target,Ae=parseInt(K.value);Ae>t().hitDice.current&&(K.value=String(t().hitDice.current)),Ae<1&&(K.value="1")}),R("click",B,()=>{const U=document.getElementById("hitDiceCount"),K=parseInt(U?.value||"1");ve(K)}),o(Ce,X)};S(Ve,Ce=>{m(),n(()=>!m().combatStats)&&Ce(z)})}l(de),M(()=>J=ht(de,1,"combat-stats svelte-1r5hyyb",null,J,{hidden:!e(se)})),o(a,de),Et(),k()}const La={acrobatics:"dexterity",animalHandling:"wisdom",arcana:"intelligence",athletics:"strength",deception:"charisma",history:"intelligence",insight:"wisdom",intimidation:"charisma",investigation:"intelligence",medicine:"wisdom",nature:"intelligence",perception:"wisdom",performance:"charisma",persuasion:"charisma",religion:"intelligence",sleightOfHand:"dexterity",stealth:"dexterity",survival:"wisdom"};var Ks=p('<div class="skill-row svelte-1f1pl16"><input type="checkbox" class="svelte-1f1pl16"/> <label class="svelte-1f1pl16"> <span class="ability-tag svelte-1f1pl16"> </span></label> <span class="skill-modifier svelte-1f1pl16"> </span> <button class="roll-btn svelte-1f1pl16">Roll</button></div>'),Vs=p('<div class="skills-grid svelte-1f1pl16"></div>'),Js=p("<section><!> <!></section>");function Qs(a,i){Tt(i,!1);const t=()=>at(ae,"$character",h),d=()=>at(ga,"$abilityModifiers",h),u=()=>at(Zt,"$searchFilter",h),m=()=>at(Ft,"$collapsedStates",h),[h,D]=qt(),k=P(),x=P(),Y=P(),q=P(),se=P(),re=P(),V=sa(),ve=[{key:"acrobatics",label:"Acrobatics"},{key:"animalHandling",label:"Animal Handling"},{key:"arcana",label:"Arcana"},{key:"athletics",label:"Athletics"},{key:"deception",label:"Deception"},{key:"history",label:"History"},{key:"insight",label:"Insight"},{key:"intimidation",label:"Intimidation"},{key:"investigation",label:"Investigation"},{key:"medicine",label:"Medicine"},{key:"nature",label:"Nature"},{key:"perception",label:"Perception"},{key:"performance",label:"Performance"},{key:"persuasion",label:"Persuasion"},{key:"religion",label:"Religion"},{key:"sleightOfHand",label:"Sleight of Hand"},{key:"stealth",label:"Stealth"},{key:"survival",label:"Survival"}];function de(X){const fe=e(k)[X],De=`1d20${fe>=0?"+":""}${fe}`;V("roll",{notation:De,rollType:"check"})}et(()=>{},()=>{c(k,{})}),et(()=>t(),()=>{c(x,t().skillProficiencies)}),et(()=>t(),()=>{c(Y,t().proficiencyBonus)}),et(()=>d(),()=>{c(q,d())}),et(()=>(e(q),e(x),e(Y)),()=>{for(const{key:X}of ve){const fe=La[X],De=e(q)[fe],Me=e(x)[X]?e(Y):0;aa(k,e(k)[X]=De+Me)}}),et(()=>u(),()=>{c(se,ve.filter(({label:X})=>u()?X.toLowerCase().includes(u().toLowerCase()):!0))}),et(()=>e(se),()=>{c(re,e(se).length>0)}),Jt(),It();var J=Js();let ze;var Ve=r(J);{let X=it(()=>(m(),n(()=>m().skills?"Expand":"Collapse")));la(Ve,{title:"Skills",get collapsed(){return m(),n(()=>m().skills)},get ariaLabel(){return e(X)},onToggle:()=>Ft.update(fe=>({...fe,skills:!fe.skills}))})}var z=s(Ve,2);{var Ce=X=>{var fe=Vs();yt(fe,5,()=>e(se),St,(De,Me)=>{let ke=()=>e(Me).key,Re=()=>e(Me).label;var j=Ks(),pe=r(j);we(pe);var b=s(pe,2),T=r(b),Z=s(T),Ze=r(Z);l(Z),l(b);var Oe=s(b,2),je=r(Oe);l(Oe);var f=s(Oe,2);l(j),M(L=>{ts(pe,(e(x),ke(),n(()=>e(x)[ke()]))),We(pe,"id",ke()),We(b,"for",ke()),w(T,`${Re()??""} `),w(Ze,`(${L??""})`),w(je,`${e(k),ke(),n(()=>e(k)[ke()]>=0?"+":"")??""}${e(k),ke(),n(()=>e(k)[ke()])??""}`)},[()=>(H(La),ke(),n(()=>La[ke()].substring(0,3).toUpperCase()))]),R("change",pe,L=>{console.log("Skill proficiency changed:",ke(),L.target.checked),ae.update(W=>({...W,skillProficiencies:{...W.skillProficiencies,[ke()]:L.target.checked}}))}),R("click",f,()=>de(ke())),o(De,j)}),l(fe),o(X,fe)};S(z,X=>{m(),n(()=>!m().skills)&&X(Ce)})}l(J),M(()=>ze=ht(J,1,"skills svelte-1f1pl16",null,ze,{hidden:!e(re)})),o(a,J),Et(),D()}let ma=null,ha=null;async function ss(){if(ma)return ma;try{return ma=await(await fetch(as("/data/spells.json"))).json(),ma||[]}catch(a){return console.error("Failed to load spells:",a),[]}}async function Ys(){if(ha)return ha;try{return ha=await(await fetch(as("/data/feats.json"))).json(),ha||[]}catch(a){return console.error("Failed to load feats:",a),[]}}function za(a,i){if(!i.trim())return a;const t=i.toLowerCase();return a.filter(d=>d.name.toLowerCase().includes(t)||d.school.toLowerCase().includes(t)||d.classes.some(u=>u.toLowerCase().includes(t))||d.description.toLowerCase().includes(t))}function Xs(a,i){return i===null?a:a.filter(t=>t.level===i)}function Zs(a,i){if(!i.trim())return a;const t=i.toLowerCase();return a.filter(d=>d.name.toLowerCase().includes(t)||d.description.toLowerCase().includes(t))}function ba(a){const i=a.description,t=/\b(Strength|Dexterity|Constitution|Intelligence|Wisdom|Charisma)\s+saving\s+throw/i,d=i.match(t);if(!d)return null;const u=d[1].toLowerCase(),h=/half\s+(?:as\s+much\s+)?damage\s+on\s+a\s+successful(?:\s+save)?/i.test(i),k=/saving\s+throw\s+or\s+take.*?damage/i.test(i)&&!h;return{ability:u,halfDamageOnSave:h,noDamageOnSave:k}}function el(a){const i=a.description;return/(plus|add)\s+your\s+spellcasting\s+(ability\s+)?modifier/i.test(i)}function wa(a){const i=a.description.toLowerCase();return i.includes("ranged spell attack")||i.includes("melee spell attack")}function Ka(a){const i=a.description.toLowerCase();if(["Divine Favor","Bless","Aid","Command"].includes(a.name))return!0;const u=["takes","take","deals","deal","damage equal to","force damage","fire damage","cold damage","lightning damage","thunder damage","acid damage","poison damage","necrotic damage","radiant damage","psychic damage","regain","regains","hit point"].some(D=>i.includes(D));return["bonus to attack","bonus to damage","bonus to ac","gains a +","gain a +","+1 bonus","+2 bonus","+3 bonus","advantage on","becomes a magic weapon"].some(D=>i.includes(D))&&!u}function tl(a){const i=a.description;let t=0,d=0,u=0,m="";const h=i.match(/\+(\d+)\s+bonus\s+to\s+attack\s+rolls\s+and\s+damage\s+rolls/i);if(h){const k=parseInt(h[1]);t=k,d=k,m=`+${k} to attack and damage rolls`}if(a.name==="Bless"&&(m="Add 1d4 to attack rolls and saves",t="1d4"),a.name==="Aid")return m="+5 HP (max and current) for 8 hours",{attackBonus:0,damageBonus:0,acBonus:0,hpBonus:5,description:m,name:a.name};a.name==="Divine Favor"&&(m="Your weapon attacks deal an extra 1d4 radiant damage on a hit.",d="1d4");const D=i.match(/\+(\d+)\s+bonus\s+to\s+AC/i);return D&&(u=parseInt(D[1]),m=`+${u} to AC`),a.name==="Haste"&&(m="+2 AC, doubled speed, extra action",u=2),m||t!==0||d!==0||u!==0?{attackBonus:t,damageBonus:d,acBonus:u,description:m||a.description.substring(0,100),name:a.name}:null}var al=p('<button class="btn btn-secondary">Add Attack</button>'),sl=p('<input type="text" placeholder="Attack name" class="attack-name svelte-14o91c5"/>'),ll=p('<h4 class="attack-name-display svelte-14o91c5"> </h4>'),rl=p('<button class="btn-remove svelte-14o91c5">Ã—</button>'),nl=p('<div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Bonus</label> <input type="number" class="attack-bonus svelte-14o91c5"/></div>'),il=p('<div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Damage</label> <input type="text" placeholder="e.g., 2d6+3" class="attack-damage svelte-14o91c5"/></div>'),ol=p('<div class="spell-info-loading svelte-14o91c5">Loading spell info...</div>'),cl=p('<li class="svelte-14o91c5"><strong>At Higher Levels:</strong> </li>'),vl=p('<ul class="svelte-14o91c5"><li class="svelte-14o91c5"><strong>Level:</strong> </li> <li class="svelte-14o91c5"><strong>Casting Time:</strong> </li> <li class="svelte-14o91c5"><strong>Range:</strong> </li> <li class="svelte-14o91c5"><strong>Components:</strong> <!></li> <li class="svelte-14o91c5"><strong>Duration:</strong> <!> </li> <li class="svelte-14o91c5"><strong>Description:</strong> </li> <!></ul>'),dl=p('<span class="scaled-damage svelte-14o91c5" style="margin-left: 8px;"> </span>'),ul=p('<span class="scaled-damage svelte-14o91c5">(Half damage)</span>'),pl=p('<span class="scaled-damage svelte-14o91c5">(No damage)</span>'),fl=p('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> <!> <!></label></div>'),gl=p("<option> </option>"),ml=p('<span class="scaled-damage svelte-14o91c5"><!> </span>'),hl=p('<span class="scaled-damage svelte-14o91c5"> </span>'),bl=p('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> Target is Fiend or Undead <!></label></div>'),_l=p('<div class="spell-level-selector svelte-14o91c5"><label class="svelte-14o91c5">Cast at Level:</label> <select class="spell-level-select use-enabled svelte-14o91c5"></select> <!></div> <!>',1),yl=p('<div class="spell-level-selector svelte-14o91c5"><span style="color: #dc3545; font-weight: bold;">No spell slots available!</span></div>'),kl=p('<div class="spell-info svelte-14o91c5"><div class="spell-info-header svelte-14o91c5" role="button" tabindex="0"><h4 class="svelte-14o91c5">Spell Info</h4> <button class="collapse-btn-small svelte-14o91c5"> </button></div> <!></div> <!> <!>',1),Sl=p('<div class="spell-info-missing svelte-14o91c5">Spell info not found.</div>'),xl=p('<div class="attack-notes svelte-14o91c5"><label class="svelte-14o91c5">Notes</label> <textarea placeholder="e.g., DC 15 Dex save, Range 120 ft, Concentration" class="notes-input svelte-14o91c5" rows="2"></textarea></div>'),$l=p('<button class="btn btn-primary">Roll Attack</button>'),Cl=p('<div class="buff-target-selection svelte-14o91c5"><div class="target-options svelte-14o91c5"><label class="target-option svelte-14o91c5"><input type="radio" class="svelte-14o91c5"/> Self</label> <label class="target-option svelte-14o91c5"><input type="radio" class="svelte-14o91c5"/> Other</label></div> <button class="btn btn-info"> </button></div>'),Ll=p('<button class="btn btn-info">Cast Spell</button>'),wl=p("<button><!></button>"),Dl=p('<button class="btn btn-primary">Roll Attack</button> <button class="btn btn-secondary">Roll Damage</button>',1),jl=p('<div class="attack-card svelte-14o91c5"><div class="attack-header svelte-14o91c5"><!> <!></div> <div class="attack-details svelte-14o91c5"><!> <!> <div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Type</label> <input type="text" placeholder="e.g., slashing" class="attack-type svelte-14o91c5"/></div></div> <!> <!> <div class="attack-actions svelte-14o91c5"><!></div></div>'),Bl=p('<p class="no-attacks svelte-14o91c5">No attacks added yet. Click "Add Attack" to create one.</p>'),Al=p('<p class="no-attacks svelte-14o91c5">No attacks match your search.</p>'),Fl=p('<button class="btn-remove svelte-14o91c5">Ã—</button>'),Ml=p('<div class="state-card svelte-14o91c5"><div class="state-header svelte-14o91c5"><input type="text" placeholder="Effect name (e.g., Magic Weapon)" class="state-name svelte-14o91c5"/> <!></div> <div class="state-details svelte-14o91c5"><div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Attack Bonus</label> <input type="number" class="state-bonus svelte-14o91c5"/></div> <div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Damage Bonus</label> <input type="text" class="state-bonus svelte-14o91c5"/></div> <div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Target</label> <select class="state-bonus svelte-14o91c5"><option>Self</option><option>Other</option></select></div></div> <div class="state-description svelte-14o91c5"><label class="svelte-14o91c5">Description</label> <input type="text" placeholder="e.g., +1 to attack and damage rolls (Magic Weapon)" class="state-desc-input svelte-14o91c5"/></div></div>'),Rl=p('<div class="states-list svelte-14o91c5"></div>'),Pl=p('<p class="no-states svelte-14o91c5">No active effects. Add spell effects that modify your attacks.</p>'),Il=p('<!> <div class="attacks-list svelte-14o91c5"><!> <!></div> <div class="active-states-section svelte-14o91c5"><h3 class="svelte-14o91c5">Active Spell Effects</h3> <p class="section-description svelte-14o91c5">Effects that modify attack and damage rolls (e.g., Magic Weapon, Bless)</p> <button class="btn btn-secondary">Add Effect</button> <!></div>',1),Tl=p("<section><!> <!></section>");function El(a,i){Tt(i,!1);const t=()=>at(ae,"$character",D),d=()=>at(ga,"$abilityModifiers",D),u=()=>at(Zt,"$searchFilter",D),m=()=>at(Ft,"$collapsedStates",D),h=()=>at(na,"$isEditMode",D),[D,k]=qt(),x=P(),Y=P(),q=[],se=sa();let re=P({}),V=P({});function ve(f){aa(re,e(re)[f]=!e(re)[f]),c(re,{...e(re)})}function de(f){return f.description.toLowerCase().includes("regain")&&(f.description.toLowerCase().includes("hit point")||f.description.toLowerCase().includes("hp"))}function J(f){return["Shield of Faith","Bless","Aid","Magic Weapon"].includes(f)}function ze(){ae.update(f=>(f.attacks=[...f.attacks,{id:crypto.randomUUID(),name:"",bonus:0,damage:"",damageType:"",notes:""}],f))}function Ve(f){ae.update(L=>(L.attacks=L.attacks.filter(W=>W.id!==f),L))}function z(f){let L=f.damage,W=!1,ne=!1;if(f.spellRef){const ge=De(f.spellRef);if(ge&&(ne=wa(ge),ge.level>0)){const Ue=f.castAtLevel||ge.level;if(!Me(Ue)){Gt.add(`No level ${Ue} spell slots available!`,"error");return}const $=ba(ge);$&&f.targetSucceededSave&&$.noDamageOnSave?L="0":(W=$?.halfDamageOnSave&&f.targetSucceededSave||!1,L=ke(f,ge))}}else if(t().activeStates&&t().activeStates.length>0){let ge=0,Ue=[];for(const F of t().activeStates)F.target!=="other"&&(typeof F.damageBonus=="string"?Ue.push(F.damageBonus):typeof F.damageBonus=="number"&&(ge+=F.damageBonus));if((ge!==0||Ue.length>0)&&L){const F=L.match(/(\d+d\d+)([+-]\d+)?/);if(F){const[,$,Q]=F,N=(Q?parseInt(Q):0)+ge;let v=`${$}`;N!==0&&(v+=`${N>=0?"+":""}${N}`),Ue.length>0&&(v+=" + "+Ue.join(" + ")),L=v}}}const G=[];let Se=0;if(ne){const ge=Wa(t(),d()),Ue=t().proficiencyBonus||0;G.push({value:Ue,source:"proficiency"}),G.push({value:ge,source:"spellcasting"}),Se=Ue+ge}else f.bonus!==0&&G.push({value:f.bonus,source:"base"}),Se=f.bonus;let Ke=[];if(t().activeStates)for(const ge of t().activeStates)ge.target!=="other"&&(typeof ge.attackBonus=="number"&&ge.attackBonus!==0?(G.push({value:ge.attackBonus,source:ge.name.toLowerCase()}),Se+=ge.attackBonus):typeof ge.attackBonus=="string"&&ge.attackBonus&&(Ke.push(ge.attackBonus),G.push({value:ge.attackBonus,source:ge.name.toLowerCase()})));let tt;tt=`1d20${Se>=0?"+":""}${Se}`,Ke.length>0&&(tt+="+"+Ke.join("+")),se("roll",{notation:tt,damageNotation:L,attackName:f.name,applyHalfDamage:W,bonusBreakdown:G})}function Ce(f){if(!f.damage){Gt.add(`${f.name}: No damage specified`,"error");return}let L=f.damage,W=!1;const ne=[];if(f.spellRef){const G=De(f.spellRef);if(G&&G.level>0){const Se=f.castAtLevel||G.level;if(!Me(Se)){Gt.add(`No level ${Se} spell slots available!`,"error");return}const tt=ba(G);tt&&f.targetSucceededSave&&tt.noDamageOnSave?L="0":(W=tt?.halfDamageOnSave&&f.targetSucceededSave||!1,L=ke(f,G))}}else{const G=L.match(/(\d+d\d+)([+-]\d+)?/);if(G){const[,Se,Ke]=G,tt=Ke?parseInt(Ke):0;if(tt!==0&&ne.push({value:tt,source:"base"}),t().activeStates&&t().activeStates.length>0){let ge=0,Ue=[];for(const F of t().activeStates)F.target!=="other"&&(typeof F.damageBonus=="string"?Ue.push(F.damageBonus):typeof F.damageBonus=="number"&&F.damageBonus!==0&&(ne.push({value:F.damageBonus,source:F.name.toLowerCase()}),ge+=F.damageBonus));if(ge!==0||Ue.length>0){const F=tt+ge;let $=`${Se}`;F!==0&&($+=`${F>=0?"+":""}${F}`),Ue.length>0&&($+=" + "+Ue.join(" + ")),L=$}}}}se("roll",{notation:L,attackName:f.name,applyHalfDamage:W,bonusBreakdown:ne})}let X=P([]),fe=P(!1);pa(async()=>{c(X,await ss()),c(fe,!0)});function De(f){return e(X).find(L=>L.name===f)}function Me(f){t().classFeatures.spellSlotsByLevel||ut(ae,n(t).classFeatures.spellSlotsByLevel={},n(t)),t().classFeatures.spellSlotsByLevel[f]||ut(ae,n(t).classFeatures.spellSlotsByLevel[f]=Array(2).fill(!1),n(t));const W=t().classFeatures.spellSlotsByLevel[f].findIndex(ne=>!ne);return W===-1?!1:(ae.update(ne=>(ne.classFeatures.spellSlotsByLevel||(ne.classFeatures.spellSlotsByLevel={}),ne.classFeatures.spellSlotsByLevel[f]||(ne.classFeatures.spellSlotsByLevel[f]=Array(2).fill(!1)),ne.classFeatures.spellSlotsByLevel[f][W]=!0,ne)),!0)}function ke(f,L){let W=f.damage,ne=0,G=0;if(el(L)&&(G+=Wa(t(),d())),t().activeStates)for(const le of t().activeStates)le.target!=="other"&&typeof le.damageBonus=="number"&&(G+=le.damageBonus);if(L.higherLevelSlot&&f.castAtLevel){const le=L.level,v=(f.castAtLevel||le)-le;if(v>0){const Te=L.higherLevelSlot.match(/(\d+)d(\d+)\s+for\s+each.*?level\s+above/i);if(Te){const[,ue]=Te;ne+=v*parseInt(ue)}}}if(f.targetIsFiendOrUndead&&L.description.includes("Fiend or an Undead")){const le=L.description.match(/increases by (\d+)d(\d+) if.*?Fiend or.*?Undead/i);if(le){const[,N]=le;ne+=parseInt(N)}}const Se=W.match(/(\d+)d(\d+)([+-]\d+)?/);if(!Se)return G!==0?G>=0?`${G}`:`${G}`:W||"0";const[,Ke,tt,ge]=Se,Ue=parseInt(Ke)+ne,$=(ge?parseInt(ge):0)+G;let Q=`${Ue}d${tt}`;return $!==0&&(Q+=$>=0?`+${$}`:`${$}`),Q}function Re(f){const L=[];for(let ne=f.level;ne<=9;ne++){const G=t().classFeatures.spellSlotsByLevel?.[ne];G&&G.length>0&&L.push(ne)}return L}function j(){ae.update(f=>(f.activeStates||(f.activeStates=[]),f.activeStates=[...f.activeStates,{name:"",attackBonus:0,damageBonus:0,description:"",target:"self"}],f))}function pe(f){ae.update(L=>{if(L.activeStates){const W=L.activeStates[f];W?.hpBonus&&W.target!=="other"&&(L.maxHP-=W.hpBonus,L.currentHP=Math.max(1,Math.min(L.currentHP-W.hpBonus,L.maxHP))),L.activeStates=L.activeStates.filter((ne,G)=>G!==f)}return L})}function b(f,L="self"){const W=De(f.spellRef);if(!W){Gt.add("Spell not found","error");return}const ne=f.castAtLevel||W.level;if(ne>0&&!Me(ne)){Gt.add(`No level ${ne} spell slots available!`,"error");return}const G=tl(W);if(!G){Gt.add(`${W.name} cast! Check spell description for effects.`,"info");return}let Se=G.hpBonus||0,Ke=G.description;W.name==="Aid"&&ne>W.level&&(Se=5+(ne-W.level)*5,Ke=`+${Se} HP (max and current) for 8 hours`);const ge=["Shield of Faith","Bless","Aid","Magic Weapon"].includes(W.name);ae.update(F=>{F.activeStates||(F.activeStates=[]);const $=F.activeStates.find(Q=>Q.name===W.name);return $&&$.hpBonus&&$.target!=="other"&&(F.maxHP-=$.hpBonus,F.currentHP=Math.max(1,Math.min(F.currentHP-$.hpBonus,F.maxHP))),F.activeStates=F.activeStates.filter(Q=>Q.name!==W.name),Se>0&&L==="self"&&(F.maxHP+=Se,F.currentHP+=Se),F.activeStates=[...F.activeStates,{name:W.name,attackBonus:G.attackBonus,damageBonus:G.damageBonus,acBonus:G.acBonus,description:Ke,target:L,hpBonus:Se}],F});const Ue=L==="self"?" on self":" on other";Gt.add(`${W.name} cast${ge?Ue:""}! Effect added to Active Spell Effects.`,"success")}et(()=>(t(),e(re),e(V)),()=>{if(t()&&t().attacks)for(const f of t().attacks)f.spellRef&&e(re)[f.id]===void 0&&aa(re,e(re)[f.id]=!0),f.spellRef&&e(V)[f.id]===void 0&&aa(V,e(V)[f.id]="self")}),et(()=>(t(),u()),()=>{c(x,t().attacks.filter(f=>{if(!u())return!0;const L=u().toLowerCase();return f.name.toLowerCase().includes(L)||f.damageType.toLowerCase().includes(L)}).sort((f,L)=>!f.spellRef&&L.spellRef?-1:f.spellRef&&!L.spellRef?1:0))}),et(()=>(u(),e(x)),()=>{c(Y,!u()||e(x).length>0||"attack".includes(u().toLowerCase())||"spell".includes(u().toLowerCase()))}),Jt(),It();var T=Tl();let Z;var Ze=r(T);{let f=it(()=>(m(),n(()=>m().attacks?"Expand":"Collapse")));la(Ze,{title:"Attacks & Spells",get collapsed(){return m(),n(()=>m().attacks)},get ariaLabel(){return e(f)},onToggle:()=>Ft.update(L=>({...L,attacks:!L.attacks}))})}var Oe=s(Ze,2);{var je=f=>{var L=Il(),W=Ee(L);{var ne=N=>{var v=al();R("click",v,ze),o(N,v)};S(W,N=>{h()&&N(ne)})}var G=s(W,2),Se=r(G);yt(Se,1,()=>e(x),N=>N.id,(N,v,Te)=>{var ue=jl(),ie=r(ue),B=r(ie);{var U=A=>{var C=sl();we(C),He(C,()=>e(v).name,_e=>(e(v).name=_e,Lt(()=>(e(x),t(),u())))),o(A,C)},K=A=>{var C=ll(),_e=r(C,!0);l(C),M(()=>w(_e,(e(v),n(()=>e(v).name||"(Unnamed Attack)")))),o(A,C)};S(B,A=>{h()?A(U):A(K,!1)})}var Ae=s(B,2);{var st=A=>{var C=rl();R("click",C,()=>Ve(e(v).id)),o(A,C)};S(Ae,A=>{h()&&A(st)})}l(ie);var Be=s(ie,2),me=r(Be);{var Le=A=>{var C=nl(),_e=r(C),$e=s(_e,2);we($e),l(C),M(()=>{We(_e,"for",`attack-bonus-${e(v),n(()=>e(v).id)??""}`),We($e,"id",`attack-bonus-${e(v),n(()=>e(v).id)??""}`)}),He($e,()=>e(v).bonus,Qe=>(e(v).bonus=Qe,Lt(()=>(e(x),t(),u())))),o(A,C)};S(me,A=>{e(v),n(()=>e(v).bonus!==0&&e(v).bonus!==void 0)&&A(Le)})}var Fe=s(me,2);{var Pe=A=>{var C=il(),_e=r(C),$e=s(_e,2);we($e),l(C),M(()=>{We(_e,"for",`attack-damage-${e(v),n(()=>e(v).id)??""}`),We($e,"id",`attack-damage-${e(v),n(()=>e(v).id)??""}`)}),He($e,()=>e(v).damage,Qe=>(e(v).damage=Qe,Lt(()=>(e(x),t(),u())))),o(A,C)};S(Fe,A=>{e(v),n(()=>e(v).damage&&e(v).damage.trim()!=="")&&A(Pe)})}var Ne=s(Fe,2),oe=r(Ne),be=s(oe,2);we(be),l(Ne),l(Be);var Ge=s(Be,2);{var Je=A=>{var C=nt(),_e=Ee(C);{var $e=lt=>{var O=ol();o(lt,O)},Qe=lt=>{const O=it(()=>(e(v),n(()=>De(e(v).spellRef))));var pt=nt(),ot=Ee(pt);{var y=_=>{const Ie=it(()=>(H(ba),H(e(O)),n(()=>ba(e(O)))));var te=kl(),qe=Ee(te),he=r(qe),Ye=s(r(he),2),Xe=r(Ye,!0);l(Ye),l(he);var ft=s(he,2);{var $t=rt=>{var _t=vl(),gt=r(_t),Rt=s(r(gt));l(gt);var Ht=s(gt,2),Ut=s(r(Ht));l(Ht);var mt=s(Ht,2),wt=s(r(mt));l(mt);var jt=s(mt,2),Kt=s(r(jt)),dt=s(Kt);{var Nt=xt=>{var Ct=At();M(()=>w(Ct,`(${H(e(O)),n(()=>e(O).material)??""})`)),o(xt,Ct)};S(dt,xt=>{H(e(O)),n(()=>e(O).material)&&xt(Nt)})}l(jt);var Vt=s(jt,2),Qt=s(r(Vt),2);{var ea=xt=>{var Ct=At("Concentration,");o(xt,Ct)};S(Qt,xt=>{H(e(O)),n(()=>e(O).concentration)&&xt(ea)})}var Dt=s(Qt,1,!0);l(Vt);var Pt=s(Vt,2),Bt=s(r(Pt));l(Pt);var Wt=s(Pt,2);{var Yt=xt=>{var Ct=cl(),zt=s(r(Ct));l(Ct),M(()=>w(zt,` ${H(e(O)),n(()=>e(O).higherLevelSlot)??""}`)),o(xt,Ct)};S(Wt,xt=>{H(e(O)),n(()=>e(O).higherLevelSlot)&&xt(Yt)})}l(_t),M(xt=>{w(Rt,` ${H(e(O)),n(()=>e(O).level)??""}`),w(Ut,` ${H(e(O)),n(()=>e(O).castingTime||e(O).actionType)??""}`),w(wt,` ${H(e(O)),n(()=>e(O).range)??""}`),w(Kt,` ${xt??""}`),w(Dt,(H(e(O)),n(()=>e(O).duration))),w(Bt,` ${H(e(O)),n(()=>e(O).description)??""}`)},[()=>(H(e(O)),n(()=>e(O).components.join(", ")))]),o(rt,_t)};S(ft,rt=>{e(re),e(v),n(()=>!e(re)[e(v).id])&&rt($t)})}l(qe);var ct=s(qe,2);{var vt=rt=>{var _t=fl(),gt=r(_t),Rt=r(gt);we(Rt);var Ht=s(Rt),Ut=s(Ht);{var mt=dt=>{var Nt=dl(),Vt=r(Nt);l(Nt),M(Qt=>w(Vt,`(Spell Save DC: ${Qt??""})`),[()=>(H(Ra),t(),d(),n(()=>Ra(t(),d())))]),o(dt,Nt)};S(Ut,dt=>{t(),n(()=>t().class)&&dt(mt)})}var wt=s(Ut,2);{var jt=dt=>{var Nt=ul();o(dt,Nt)},Kt=dt=>{var Nt=nt(),Vt=Ee(Nt);{var Qt=ea=>{var Dt=pl();o(ea,Dt)};S(Vt,ea=>{e(v),H(e(Ie)),n(()=>e(v).targetSucceededSave&&e(Ie).noDamageOnSave)&&ea(Qt)},!0)}o(dt,Nt)};S(wt,dt=>{e(v),H(e(Ie)),n(()=>e(v).targetSucceededSave&&e(Ie).halfDamageOnSave)?dt(jt):dt(Kt,!1)})}l(gt),l(_t),M(dt=>w(Ht,` Target succeeded on ${dt??""} save `),[()=>(H(e(Ie)),n(()=>e(Ie).ability.charAt(0).toUpperCase()+e(Ie).ability.slice(1)))]),Fa(Rt,()=>e(v).targetSucceededSave,dt=>(e(v).targetSucceededSave=dt,Lt(()=>(e(x),t(),u())))),o(rt,_t)};S(ct,rt=>{e(Ie)&&rt(vt)})}var Mt=s(ct,2);{var bt=rt=>{const _t=it(()=>(H(e(O)),n(()=>Re(e(O)))));var gt=nt(),Rt=Ee(gt);{var Ht=mt=>{var wt=_l(),jt=Ee(wt),Kt=r(jt),dt=s(Kt,2);M(()=>{e(v),Lt(()=>{e(_t)})}),yt(dt,5,()=>e(_t),St,(Dt,Pt)=>{var Bt=gl(),Wt=r(Bt);l(Bt);var Yt={};M(()=>{w(Wt,`Level ${e(Pt)??""}`),Yt!==(Yt=e(Pt))&&(Bt.value=(Bt.__value=e(Pt))??"")}),o(Dt,Bt)}),l(dt);var Nt=s(dt,2);{var Vt=Dt=>{const Pt=it(()=>(e(v),H(e(O)),n(()=>ke(e(v),e(O)))));var Bt=ml(),Wt=r(Bt);{var Yt=zt=>{var ta=At("Healing");o(zt,ta)},xt=zt=>{var ta=At("Damage");o(zt,ta)};S(Wt,zt=>{H(e(O)),n(()=>de(e(O)))?zt(Yt):zt(xt,!1)})}var Ct=s(Wt);l(Bt),M(()=>w(Ct,` ${e(Pt)??""}`)),o(Dt,Bt)};S(Nt,Dt=>{e(v),H(e(O)),n(()=>e(v).castAtLevel&&e(v).castAtLevel>e(O).level)&&Dt(Vt)})}l(jt);var Qt=s(jt,2);{var ea=Dt=>{var Pt=bl(),Bt=r(Pt),Wt=r(Bt);we(Wt);var Yt=s(Wt,2);{var xt=Ct=>{const zt=it(()=>(e(v),H(e(O)),n(()=>ke(e(v),e(O)))));var ta=hl(),ls=r(ta);l(ta),M(()=>w(ls,`(+1d8, total: ${e(zt)??""})`)),o(Ct,ta)};S(Yt,Ct=>{e(v),n(()=>e(v).targetIsFiendOrUndead)&&Ct(xt)})}l(Bt),l(Pt),Fa(Wt,()=>e(v).targetIsFiendOrUndead,Ct=>(e(v).targetIsFiendOrUndead=Ct,Lt(()=>(e(x),t(),u())))),o(Dt,Pt)};S(Qt,Dt=>{H(e(O)),n(()=>e(O).description.includes("Fiend or an Undead"))&&Dt(ea)})}M(()=>{We(Kt,"for",`castLevel-${e(v),n(()=>e(v).id)??""}`),We(dt,"id",`castLevel-${e(v),n(()=>e(v).id)??""}`)}),Aa(dt,()=>e(v).castAtLevel,Dt=>(e(v).castAtLevel=Dt,Lt(()=>(e(x),t(),u())))),o(mt,wt)},Ut=mt=>{var wt=yl();o(mt,wt)};S(Rt,mt=>{H(e(_t)),n(()=>e(_t).length>0)?mt(Ht):mt(Ut,!1)})}o(rt,gt)};S(Mt,rt=>{H(e(O)),n(()=>e(O).higherLevelSlot&&e(O).level>0)&&rt(bt)})}M(()=>{We(Ye,"aria-label",(e(re),e(v),n(()=>e(re)[e(v).id]?"Expand":"Collapse"))),w(Xe,(e(re),e(v),n(()=>e(re)[e(v).id]?"â–¼":"â–²")))}),R("click",he,()=>ve(e(v).id)),R("keydown",he,rt=>rt.key==="Enter"&&ve(e(v).id)),o(_,te)},I=_=>{var Ie=Sl();o(_,Ie)};S(ot,_=>{e(O)?_(y):_(I,!1)})}o(lt,pt)};S(_e,lt=>{e(X),n(()=>e(X).length===0)?lt($e):lt(Qe,!1)})}o(A,C)};S(Ge,A=>{e(v),n(()=>e(v).spellRef)&&A(Je)})}var g=s(Ge,2);{var E=A=>{var C=xl(),_e=r(C),$e=s(_e,2);da($e),l(C),M(()=>{We(_e,"for",`attack-notes-${e(v),n(()=>e(v).id)??""}`),We($e,"id",`attack-notes-${e(v),n(()=>e(v).id)??""}`)}),He($e,()=>e(v).notes,Qe=>(e(v).notes=Qe,Lt(()=>(e(x),t(),u())))),o(A,C)};S(g,A=>{e(v),n(()=>!e(v).spellRef)&&A(E)})}var ce=s(g,2),ee=r(ce);{var xe=A=>{const C=it(()=>(e(v),n(()=>De(e(v).spellRef))));var _e=nt(),$e=Ee(_e);{var Qe=lt=>{var O=nt(),pt=Ee(O);{var ot=I=>{var _=$l();R("click",_,()=>z(e(v))),o(I,_)},y=I=>{var _=nt(),Ie=Ee(_);{var te=he=>{var Ye=nt(),Xe=Ee(Ye);{var ft=ct=>{var vt=Cl(),Mt=r(vt),bt=r(Mt),rt=r(bt);we(rt),rt.value=rt.__value="self",ra(),l(bt);var _t=s(bt,2),gt=r(_t);we(gt),gt.value=gt.__value="other",ra(),l(_t),l(Mt);var Rt=s(Mt,2),Ht=r(Rt);l(Rt),l(vt),M(()=>{We(rt,"name",`target-${e(v),n(()=>e(v).id)??""}`),We(gt,"name",`target-${e(v),n(()=>e(v).id)??""}`),w(Ht,`Cast ${H(e(C)),n(()=>e(C).name)??""}`)}),Ua(q,[Te],rt,()=>e(V)[e(v).id],Ut=>aa(V,e(V)[e(v).id]=Ut)),Ua(q,[Te],gt,()=>e(V)[e(v).id],Ut=>aa(V,e(V)[e(v).id]=Ut)),R("click",Rt,()=>b(e(v),e(V)[e(v).id])),o(ct,vt)},$t=ct=>{var vt=Ll();R("click",vt,()=>b(e(v),"self")),o(ct,vt)};S(Xe,ct=>{H(e(C)),n(()=>J(e(C).name))?ct(ft):ct($t,!1)})}o(he,Ye)},qe=he=>{var Ye=wl(),Xe=r(Ye);{var ft=ct=>{var vt=At("Roll Healing");o(ct,vt)},$t=ct=>{var vt=At("Roll Damage");o(ct,vt)};S(Xe,ct=>{H(e(C)),n(()=>de(e(C)))?ct(ft):ct($t,!1)})}l(Ye),M(ct=>ht(Ye,1,`btn ${ct??""}`),[()=>(H(e(C)),n(()=>de(e(C))?"btn-success":"btn-secondary"))]),R("click",Ye,()=>Ce(e(v))),o(he,Ye)};S(Ie,he=>{H(Ka),H(e(C)),n(()=>Ka(e(C)))?he(te):he(qe,!1)},!0)}o(I,_)};S(pt,I=>{H(wa),H(e(C)),n(()=>wa(e(C)))?I(ot):I(y,!1)})}o(lt,O)};S($e,lt=>{e(C)&&lt(Qe)})}o(A,_e)},ye=A=>{var C=nt(),_e=Ee(C);{var $e=Qe=>{var lt=Dl(),O=Ee(lt),pt=s(O,2);R("click",O,()=>z(e(v))),R("click",pt,()=>Ce(e(v))),o(Qe,lt)};S(_e,Qe=>{e(v),n(()=>!e(v).spellRef)&&Qe($e)},!0)}o(A,C)};S(ee,A=>{e(v),e(fe),n(()=>e(v).spellRef&&e(fe))?A(xe):A(ye,!1)})}l(ce),l(ue),M(()=>{We(oe,"for",`attack-type-${e(v),n(()=>e(v).id)??""}`),We(be,"id",`attack-type-${e(v),n(()=>e(v).id)??""}`)}),He(be,()=>e(v).damageType,A=>(e(v).damageType=A,Lt(()=>(e(x),t(),u())))),o(N,ue)});var Ke=s(Se,2);{var tt=N=>{var v=Bl();o(N,v)},ge=N=>{var v=nt(),Te=Ee(v);{var ue=ie=>{var B=Al();o(ie,B)};S(Te,ie=>{e(x),n(()=>e(x).length===0)&&ie(ue)},!0)}o(N,v)};S(Ke,N=>{t(),n(()=>t().attacks.length===0)?N(tt):N(ge,!1)})}l(G);var Ue=s(G,2),F=s(r(Ue),4),$=s(F,2);{var Q=N=>{var v=Rl();yt(v,5,()=>(t(),n(()=>t().activeStates)),St,(Te,ue,ie)=>{var B=Ml(),U=r(B),K=r(U);we(K);var Ae=s(K,2);{var st=ye=>{var A=Fl();R("click",A,()=>pe(ie)),o(ye,A)};S(Ae,ye=>{h()&&ye(st)})}l(U);var Be=s(U,2),me=r(Be),Le=r(me);We(Le,"for",`state-attack-bonus-${ie}`);var Fe=s(Le,2);we(Fe),We(Fe,"id",`state-attack-bonus-${ie}`),l(me);var Pe=s(me,2),Ne=r(Pe);We(Ne,"for",`state-damage-bonus-${ie}`);var oe=s(Ne,2);we(oe),We(oe,"id",`state-damage-bonus-${ie}`),l(Pe);var be=s(Pe,2),Ge=r(be);We(Ge,"for",`state-target-${ie}`);var Je=s(Ge,2);M(()=>{e(ue),Lt(()=>{})}),We(Je,"id",`state-target-${ie}`);var g=r(Je);g.value=g.__value="self";var E=s(g);E.value=E.__value="other",l(Je),l(be),l(Be);var ce=s(Be,2),ee=r(ce);We(ee,"for",`state-desc-${ie}`);var xe=s(ee,2);we(xe),We(xe,"id",`state-desc-${ie}`),l(ce),l(B),He(K,()=>e(ue).name,ye=>(e(ue).name=ye,Lt(()=>t()),ca(D,"$character"))),He(Fe,()=>e(ue).attackBonus,ye=>(e(ue).attackBonus=ye,Lt(()=>t()),ca(D,"$character"))),He(oe,()=>e(ue).damageBonus,ye=>(e(ue).damageBonus=ye,Lt(()=>t()),ca(D,"$character"))),Aa(Je,()=>e(ue).target,ye=>(e(ue).target=ye,Lt(()=>t()),ca(D,"$character"))),He(xe,()=>e(ue).description,ye=>(e(ue).description=ye,Lt(()=>t()),ca(D,"$character"))),o(Te,B)}),l(v),o(N,v)},le=N=>{var v=Pl();o(N,v)};S($,N=>{t(),n(()=>t().activeStates&&t().activeStates.length>0)?N(Q):N(le,!1)})}l(Ue),R("click",F,j),o(f,L)};S(Oe,f=>{m(),n(()=>!m().attacks)&&f(je)})}l(T),M(()=>Z=ht(T,1,"attacks svelte-14o91c5",null,Z,{hidden:!e(Y)})),o(a,T),Et(),k()}var Hl=p('<span class="slot-checkbox-x svelte-serp1j">&#8212;</span>'),Ul=p('<label><input type="checkbox" class="slot-checkbox-input svelte-serp1j"/> <span><!></span></label>');function Va(a,i){Tt(i,!1);const t=()=>at(na,"$isEditMode",d),[d,u]=qt();let m=kt(i,"checked",8,!1),h=kt(i,"disabled",8,!1),D=kt(i,"className",8,""),k=kt(i,"index",8,void 0),x=kt(i,"ariaLabel",8,void 0);const Y=sa();function q(J){Y("change",{checked:J.currentTarget.checked,index:k()})}It();var se=Ul(),re=r(se);we(re);var V=s(re,2),ve=r(V);{var de=J=>{var ze=Hl();o(J,ze)};S(ve,J=>{m()&&J(de)})}l(V),l(se),M(()=>{ht(se,1,"slot-checkbox-label "+D()+(t()?"":" not-editable"),"svelte-serp1j"),ts(re,m()),re.disabled=h()||!t(),We(re,"aria-label",x()),We(re,"tabindex",t()?0:-1),ht(V,1,`slot-checkbox-custom ${m()?"used":""} ${t()?"":"readonly"}`,"svelte-serp1j")}),R("change",re,q),o(a,se),Et(),u()}var Nl=p('<p class="no-features svelte-1kpvv0n">Select a class to see available features</p>'),Gl=p('<p class="no-features svelte-1kpvv0n">No class features available at this level</p>'),Ol=p('<div class="spell-slots svelte-1kpvv0n"><label class="svelte-1kpvv0n"> </label> <div class="slots-tracker svelte-1kpvv0n"></div></div>'),ql=p('<div class="all-spell-slots"></div>'),Wl=p('<div class="feature-box spellcasting svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"> </h3> <div class="spell-stats svelte-1kpvv0n"><div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Spell Save DC</label> <div class="spell-value svelte-1kpvv0n"> </div></div> <div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <div class="spell-value svelte-1kpvv0n"> </div></div></div> <!> <div class="prepared-spells svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <textarea placeholder="List your prepared spells..." class="svelte-1kpvv0n"></textarea></div></div>'),zl=p('<p class="unlimited svelte-1kpvv0n">Unlimited Uses</p>'),Kl=p('<div class="slots-tracker svelte-1kpvv0n"></div> <div class="uses-actions-row"><button class="btn btn-primary use-enabled"> </button></div> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div>',1),Vl=p('<div class="uses-tracker svelte-1kpvv0n"><!></div>'),Jl=p('<div class="pool-tracker svelte-1kpvv0n"><input type="number" min="0" class="pool-input svelte-1kpvv0n"/> <span> </span> <button class="btn-small svelte-1kpvv0n"> </button></div>'),Ql=p('<p class="no-uses svelte-1kpvv0n">No Channel Divinity uses remaining</p>'),Yl=p('<div class="channel-divinity-option svelte-1kpvv0n"><button class="btn btn-primary use-enabled svelte-1kpvv0n">Use Channel Divinity</button> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div> <!></div>'),Xl=p('<div class="feature-box svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"><!> </h3> <p class="feature-description svelte-1kpvv0n"> </p> <!></div>'),Zl=p('<div class="features-grid svelte-1kpvv0n"><!> <!></div>'),er=p("<section><!> <!></section>");function tr(a,i){Tt(i,!1);const t=()=>at(ae,"$character",h),d=()=>at(ga,"$abilityModifiers",h),u=()=>at(Zt,"$searchFilter",h),m=()=>at(Ft,"$collapsedStates",h),[h,D]=qt(),k=P(),x=P(),Y=P(),q=P(),se=P(),re=P(),V=P();let ve=P(0),de=P(0);function J(b,T){ae.update(Z=>(Z.classFeatures.features[b]=T,Z))}function ze(){ae.update(b=>(b.classFeatures.spellSlotsByLevel||(b.classFeatures.spellSlotsByLevel={}),e(q).forEach(({level:T,slots:Z})=>{b.classFeatures.spellSlotsByLevel[T]||(b.classFeatures.spellSlotsByLevel[T]=Array(Z).fill(!1))}),b))}function Ve(b){if(typeof b.maxUses=="function"){if((b.name==="Divine Sense"||b.name==="War Priest")&&e(k)?.spellcastingAbility){const T=d()[e(k).spellcastingAbility];return b.maxUses(t().level,T)}return b.maxUses(t().level)}return b.maxUses||0}function z(b,T){ae.update(Z=>((!Z.classFeatures.features[b]||!Array.isArray(Z.classFeatures.features[b])||Z.classFeatures.features[b].length!==T)&&(Z.classFeatures.features[b]=Array(T).fill(!1)),Z))}rs(()=>{e(re)&&t()&&t().classFeatures&&t().classFeatures.features&&e(re).forEach(b=>{if(b.type==="uses"){const T=b.name.replace(/\s+/g,""),Z=Ve(b),Ze=t().classFeatures.features[T];(!Array.isArray(Ze)||Ze.length!==Z)&&z(T,Z)}})});function Ce(b){return typeof b.maxPool=="function"?b.maxPool(t().level):b.maxPool||0}function X(b){return typeof b.description=="function"?b.description(t().level):b.description}function fe(){const b="ChannelDivinity";ae.update(T=>{const Z=T.classFeatures.features[b];return typeof Z=="number"&&Z>0&&(T.classFeatures.features[b]=Z-1),T})}function De(){Ft.update(b=>({...b,classFeatures:!b.classFeatures}))}et(()=>(t(),Ot),()=>{c(k,t().class?Ot(t().class):null)}),et(()=>(t(),oa),()=>{c(x,t().class?oa(t().class,t().level,t().subclass):[])}),et(()=>(t(),Oa),()=>{c(Y,t().class?Oa(t().class,t().level):0)}),et(()=>(e(k),t()),()=>{c(q,(()=>{if(!e(k)?.spellcaster)return[];const b=t().level,T=[];return b>=1&&T.push({level:1,slots:Math.min(4,2+Math.floor(b/3))}),b>=3&&T.push({level:2,slots:Math.min(3,2+Math.floor((b-3)/4))}),b>=5&&T.push({level:3,slots:Math.min(3,2+Math.floor((b-5)/5))}),b>=7&&T.push({level:4,slots:Math.min(3,1+Math.floor((b-7)/6))}),b>=9&&T.push({level:5,slots:Math.min(2,1+Math.floor((b-9)/8))}),b>=11&&T.push({level:6,slots:1}),b>=13&&T.push({level:7,slots:1}),b>=15&&T.push({level:8,slots:1}),b>=17&&T.push({level:9,slots:1}),T})())}),et(()=>(e(k),d(),t(),qa),()=>{if(e(k)?.spellcaster&&e(k).spellcastingAbility){const b=d()[e(k).spellcastingAbility];c(ve,ws(t().class,b,t().proficiencyBonus)||0),c(de,qa(t().class,t().level,b))}}),et(()=>(t(),e(k),e(q)),()=>{t().class&&e(k)?.spellcaster&&e(q).length>0&&ze()}),et(()=>t(),()=>{c(se,(()=>{const T=t().classFeatures.features["ChannelDivinity"];return typeof T=="number"?T:0})())}),et(()=>(e(x),u()),()=>{c(re,e(x).filter(b=>{if(!u())return!0;const T=u().toLowerCase();return b.name.toLowerCase().includes(T)||X(b).toLowerCase().includes(T)}))}),et(()=>(u(),t(),e(re)),()=>{c(V,!u()||t().class||"class features".includes(u().toLowerCase())||"spellcasting".includes(u().toLowerCase())||e(re).length>0)}),Jt(),It();var Me=er();let ke;var Re=r(Me);{let b=it(()=>(m(),n(()=>m().classFeatures?"Expand":"Collapse")));la(Re,{title:"Class Features",get collapsed(){return m(),n(()=>m().classFeatures)},get ariaLabel(){return e(b)},onToggle:De})}var j=s(Re,2);{var pe=b=>{var T=nt(),Z=Ee(T);{var Ze=je=>{var f=Nl();o(je,f)},Oe=je=>{var f=nt(),L=Ee(f);{var W=G=>{var Se=Gl();o(G,Se)},ne=G=>{var Se=Zl(),Ke=r(Se);{var tt=Ue=>{var F=Wl(),$=r(F),Q=r($);l($);var le=s($,2),N=r(le),v=s(r(N),2),Te=r(v,!0);l(v),l(N);var ue=s(N,2),ie=s(r(ue),2),B=r(ie,!0);l(ie),l(ue),l(le);var U=s(le,2);{var K=Be=>{var me=ql();yt(me,5,()=>e(q),St,(Le,Fe)=>{let Pe=()=>e(Fe).level,Ne=()=>e(Fe).slots;const oe=it(()=>(t(),Pe(),Ne(),n(()=>t().classFeatures.spellSlotsByLevel?.[Pe()]||Array(Ne()).fill(!1))));var be=Ol(),Ge=r(be),Je=r(Ge);l(Ge);var g=s(Ge,2);yt(g,5,()=>e(oe),St,(E,ce,ee)=>{{let xe=it(()=>(H(e(oe)),n(()=>e(oe)[ee]||!1)));Va(E,{get checked(){return e(xe)},$$events:{change:ye=>{ae.update(A=>(A.classFeatures.spellSlotsByLevel||(A.classFeatures.spellSlotsByLevel={}),A.classFeatures.spellSlotsByLevel[Pe()]||(A.classFeatures.spellSlotsByLevel[Pe()]=Array(Ne()).fill(!1)),A.classFeatures.spellSlotsByLevel[Pe()][ee]=ye.detail.checked,A))}}})}}),l(g),l(be),M(()=>w(Je,`${Pe()===1?"1st":Pe()===2?"2nd":Pe()===3?"3rd":`${Pe()}th`} Level Spell Slots`)),o(Le,be)}),l(me),o(Be,me)};S(U,Be=>{e(q),n(()=>e(q).length>0)&&Be(K)})}var Ae=s(U,2),st=s(r(Ae),2);da(st),l(Ae),l(F),M(Be=>{w(Q,`Spellcasting (${Be??""})`),w(Te,e(ve)),w(B,e(de))},[()=>(e(k),n(()=>e(k).spellcastingAbility?.toUpperCase()))]),He(st,()=>t().classFeatures.preparedSpells,Be=>ut(ae,n(t).classFeatures.preparedSpells=Be,n(t))),o(Ue,F)};S(Ke,Ue=>{e(k),n(()=>e(k)?.spellcaster)&&Ue(tt)})}var ge=s(Ke,2);yt(ge,1,()=>e(re),St,(Ue,F)=>{const $=it(()=>(e(F),n(()=>e(F).name.replace(/\s+/g,"")))),Q=it(()=>(t(),H(e($)),n(()=>t().classFeatures.features[e($)]))),le=it(()=>typeof e(Q)=="number");var N=Xl(),v=r(N),Te=r(v);{var ue=Be=>{var me=At("Channel Divinity:");o(Be,me)};S(Te,Be=>{e(F),n(()=>e(F).type==="channelDivinity")&&Be(ue)})}var ie=s(Te);l(v);var B=s(v,2),U=r(B,!0);l(B);var K=s(B,2);{var Ae=Be=>{const me=it(()=>(e(F),n(()=>Ve(e(F))))),Le=it(()=>(H(e(Q)),H(e(me)),n(()=>Array.isArray(e(Q))?e(Q):Array(e(me)).fill(!1))));var Fe=Vl(),Pe=r(Fe);{var Ne=be=>{var Ge=zl();o(be,Ge)},oe=be=>{var Ge=Kl(),Je=Ee(Ge);yt(Je,5,()=>e(Le),St,(A,C,_e)=>{Va(A,{get checked(){return e(C)},index:_e,$$events:{change:$e=>{ae.update(Qe=>(Qe.classFeatures.features[e($)]||(Qe.classFeatures.features[e($)]=Array(e(me)).fill(!1)),Qe.classFeatures.features[e($)][_e]=$e.detail.checked,Qe))}}})}),l(Je);var g=s(Je,2),E=r(g),ce=r(E);l(E),l(g);var ee=s(g,2),xe=r(ee),ye=r(xe);l(xe),l(ee),M(A=>{E.disabled=A,w(ce,`Use ${e(F),n(()=>e(F).name)??""}`),w(ye,`Resets on ${e(F),n(()=>e(F).resetOn==="short"?"Short Rest":"Long Rest")??""}`)},[()=>(H(e(Le)),n(()=>e(Le).filter(A=>!A).length<=0))]),R("click",E,()=>{ae.update(A=>{A.classFeatures.features[e($)]||(A.classFeatures.features[e($)]=Array(e(me)).fill(!1));const C=A.classFeatures.features[e($)],_e=C.findIndex($e=>!$e);return _e!==-1&&(C[_e]=!0),A})}),o(be,Ge)};S(Pe,be=>{e(me)===1/0?be(Ne):be(oe,!1)})}l(Fe),o(Be,Fe)},st=Be=>{var me=nt(),Le=Ee(me);{var Fe=Ne=>{const oe=it(()=>(e(F),n(()=>Ce(e(F)))));var be=Jl(),Ge=r(be);we(Ge);var Je=s(Ge,2),g=r(Je);l(Je);var E=s(Je,2),ce=r(E,!0);l(E),l(be),M(()=>{ya(Ge,e(le)&&e(Q)!==void 0?e(Q):e(oe)),We(Ge,"max",e(oe)),w(g,`/ ${e(oe)??""}`),w(ce,(e(F),n(()=>e(F).resetOn==="short"?"Short Rest":"Long Rest")))}),R("input",Ge,ee=>{ae.update(xe=>(xe.classFeatures.features[e($)]=parseInt(ee.currentTarget.value)||0,xe))}),R("click",E,()=>J(e($),e(oe))),o(Ne,be)},Pe=Ne=>{var oe=nt(),be=Ee(oe);{var Ge=Je=>{var g=Yl(),E=r(g),ce=s(E,2),ee=r(ce),xe=r(ee);l(ee),l(ce);var ye=s(ce,2);{var A=C=>{var _e=Ql();o(C,_e)};S(ye,C=>{e(se)<=0&&C(A)})}l(g),M(()=>{E.disabled=e(se)<=0,w(xe,`Resets on ${e(F),n(()=>e(F).resetOn==="short"?"Short Rest":"Long Rest")??""}`)}),R("click",E,fe),o(Je,g)};S(be,Je=>{e(F),n(()=>e(F).type==="channelDivinity")&&Je(Ge)},!0)}o(Ne,oe)};S(Le,Ne=>{e(F),n(()=>e(F).type==="pool")?Ne(Fe):Ne(Pe,!1)},!0)}o(Be,me)};S(K,Be=>{e(F),n(()=>e(F).type==="uses")?Be(Ae):Be(st,!1)})}l(N),M(Be=>{w(ie,` ${e(F),n(()=>e(F).name)??""}`),w(U,Be)},[()=>(e(F),n(()=>X(e(F))))]),o(Ue,N)}),l(Se),o(G,Se)};S(L,G=>{e(x),n(()=>e(x).length===0)?G(W):G(ne,!1)},!0)}o(je,f)};S(Z,je=>{t(),n(()=>!t().class)?je(Ze):je(Oe,!1)})}o(b,T)};S(j,b=>{m(),n(()=>!m().classFeatures)&&b(pe)})}l(Me),M(()=>ke=ht(Me,1,"class-features svelte-1kpvv0n",null,ke,{hidden:!e(V)})),o(a,Me),Et(),D()}var ar=p('<textarea placeholder="Enter features, traits, and special abilities..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Equipment</h3> <textarea placeholder="List your equipment and inventory..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Notes</h3> <textarea placeholder="Additional notes..." class="svelte-wttn0l"></textarea>',1),sr=p("<section><!> <!></section>");function lr(a,i){Tt(i,!1);const t=()=>at(Zt,"$searchFilter",m),d=()=>at(ae,"$character",m),u=()=>at(Ft,"$collapsedStates",m),[m,h]=qt(),D=P();function k(){Ft.update(V=>({...V,notes:!V.notes}))}et(()=>(t(),d()),()=>{c(D,!t()||"features".includes(t().toLowerCase())||"traits".includes(t().toLowerCase())||"equipment".includes(t().toLowerCase())||"notes".includes(t().toLowerCase())||d().features.toLowerCase().includes(t().toLowerCase())||d().equipment.toLowerCase().includes(t().toLowerCase())||d().notes.toLowerCase().includes(t().toLowerCase()))}),Jt(),It();var x=sr();let Y;var q=r(x);{let V=it(()=>(u(),n(()=>u().notes?"Expand":"Collapse")));la(q,{title:"Features & Traits",get collapsed(){return u(),n(()=>u().notes)},get ariaLabel(){return e(V)},onToggle:k})}var se=s(q,2);{var re=V=>{var ve=ar(),de=Ee(ve);da(de);var J=s(de,4);da(J);var ze=s(J,4);da(ze),He(de,()=>d().features,Ve=>ut(ae,n(d).features=Ve,n(d))),He(J,()=>d().equipment,Ve=>ut(ae,n(d).equipment=Ve,n(d))),He(ze,()=>d().notes,Ve=>ut(ae,n(d).notes=Ve,n(d))),o(V,ve)};S(se,V=>{u(),n(()=>!u().notes)&&V(re)})}l(x),M(()=>Y=ht(x,1,"notes svelte-wttn0l",null,Y,{hidden:!e(D)})),o(a,x),Et(),h()}var rr=p('<div class="color-picker-section svelte-1r90jgp"><h3 class="svelte-1r90jgp">Dice Colors</h3> <div class="color-inputs svelte-1r90jgp"><div class="color-input-group svelte-1r90jgp"><label for="dice-color" class="svelte-1r90jgp">Dice Color</label> <input type="color" id="dice-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="label-color" class="svelte-1r90jgp">Label Color</label> <input type="color" id="label-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="desk-color" class="svelte-1r90jgp">Background Color</label> <input type="color" id="desk-color" class="svelte-1r90jgp"/></div></div></div>'),nr=p('<div class="loading svelte-1r90jgp"><p class="svelte-1r90jgp">Loading 3D dice...</p></div>'),ir=p('<div class="custom-dice-selector svelte-1r90jgp"><h3 class="svelte-1r90jgp">Choose Dice to Roll</h3> <div class="dice-inputs svelte-1r90jgp"><div class="dice-input-group svelte-1r90jgp"><label for="d4" class="svelte-1r90jgp">d4</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d4" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d6" class="svelte-1r90jgp">d6</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d6" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d8" class="svelte-1r90jgp">d8</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d8" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d10" class="svelte-1r90jgp">d10</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d10" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d12" class="svelte-1r90jgp">d12</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d12" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d20" class="svelte-1r90jgp">d20</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d20" min="0" max="10"/></div></div> <div class="dice-controls svelte-1r90jgp"><button class="btn btn-primary use-enabled svelte-1r90jgp"> </button> <button class="btn btn-secondary use-enabled svelte-1r90jgp">Reset</button></div></div>'),or=p('<span class="crit-badge svelte-1r90jgp">CRITICAL!</span>'),cr=p('<div class="bonus-item svelte-1r90jgp"><span class="bonus-value svelte-1r90jgp"> </span> <span class="bonus-source svelte-1r90jgp"> </span></div>'),vr=p('<div class="bonus-breakdown svelte-1r90jgp"></div>'),dr=p('<p class="modifier-text svelte-1r90jgp"> </p>'),ur=p('<button class="btn btn-follow-up svelte-1r90jgp"> </button>'),pr=p('<button class="btn btn-guided-strike svelte-1r90jgp">âš¡ Use Guided Strike (+10)</button>'),fr=p('<div class="follow-up-actions svelte-1r90jgp"><!> <!></div>'),gr=p('<div class="result-header svelte-1r90jgp"><h3 class="svelte-1r90jgp"> </h3> <!></div> <div class="result-total svelte-1r90jgp"> </div> <div class="result-details svelte-1r90jgp"><!></div> <!>',1),mr=p('<div role="button" tabindex="-1"><div class="modal-content svelte-1r90jgp" role="dialog" tabindex="0"><div class="modal-header svelte-1r90jgp"><h2 class="svelte-1r90jgp">Dice Roller</h2> <div class="header-buttons svelte-1r90jgp"><button class="color-btn svelte-1r90jgp" title="Customize dice colors">ðŸŽ¨</button> <button class="close-btn svelte-1r90jgp">Ã—</button></div></div> <!> <!> <div class="dice-main-area svelte-1r90jgp"><div class="dice-container svelte-1r90jgp"></div> <!></div> <div><!></div></div></div>');function hr(a,i){Tt(i,!1);const t=()=>at(ae,"$character",d),[d,u]=qt(),m=P(),h=P(),D=P(),k=sa();let x=kt(i,"notation",12,""),Y=kt(i,"visible",8,!1),q=kt(i,"damageNotation",12,""),se=kt(i,"attackName",12,""),re=kt(i,"applyHalfDamage",8,!1),V=kt(i,"bonusBreakdown",28,()=>[]),ve=kt(i,"rollType",12,"other"),de=null,J=P(void 0),ze=P(!1),Ve=P(""),z=P(null);function Ce(){return e(z)?.resultTotal??null}function X(g,E,ce){const ee=[];if(!g||!g.result)return ee;const xe=E.match(/([+-]?\d*d\d+|[+-]?\d+)/g)||[];let ye=0;const A=new Set;for(const C of xe){const _e=C.trim();if(!_e)continue;const $e=_e.match(/([+-]?)(\d*)d(\d+)/);if($e){const Qe=parseInt($e[2]||"1"),lt=`${Qe}d${$e[3]}`,O=ce.findIndex((y,I)=>!A.has(I)&&typeof y.value=="string"&&y.value===lt),pt=[];for(let y=0;y<Qe&&ye<g.result.length;y++)pt.push(g.result[ye++]);const ot=O>=0?ce[O].source:"base die";O>=0&&A.add(O);for(const y of pt)ee.push({display:`${y}`,source:ot})}}for(let C=0;C<ce.length;C++)if(!A.has(C)&&typeof ce[C].value=="number"){const _e=ce[C].value;ee.push({display:_e>=0?`+${_e}`:`${_e}`,source:ce[C].source})}return ee}let fe=P(0),De=P(0),Me=P(0),ke=P(0),Re=P(0),j=P(0),pe=P(0),b=P([]),T=P(!1),Z=P(!1),Ze=P("#051e0a"),Oe=P("#ffffff"),je=P("#3a2004"),f=P(!1);function L(g){return g.length===9&&g.startsWith("#")?g.substring(0,7):g}function W(g,E="ff"){return g.length===7&&g.startsWith("#")?g+E:g}function ne(){if(window.DICE&&e(J))try{de&&e(J)&&aa(J,e(J).innerHTML="");const g=e(J).clientWidth||500,E=e(J).clientHeight||300;de=new window.DICE.dice_box(e(J),{w:g,h:E}),c(ze,!0)}catch(g){console.error("Error initializing dice box:",g)}}pa(()=>{const g=ee=>new Promise((xe,ye)=>{if(document.querySelector(`script[src="${ee}"]`)){xe(null);return}const C=document.createElement("script");C.src=ee,C.onload=()=>{xe(null)},C.onerror=()=>{console.error(`Failed to load: ${ee}`),ye(new Error(`Failed to load ${ee}`))},document.head.appendChild(C)});setTimeout(()=>{g(`${va}/libs/three.min.js`).then(()=>g(`${va}/libs/cannon.min.js`)).then(()=>g(`${va}/libs/teal.js`)).then(()=>g(`${va}/dice.js`)).then(()=>{if(window.DICE){const ee=window.DICE.getColors();c(Ze,L(ee.dice_color)),c(Oe,L(ee.label_color)),c(je,L(ee.desk_color))}ne()}).catch(ee=>{console.error("Failed to load dice libraries:",ee)})},100);const E=()=>{e(ze)&&ne()},ce=ee=>{Y()&&ee.key==="Escape"&&Q()};return window.addEventListener("resize",E),window.addEventListener("keydown",ce),()=>{window.removeEventListener("resize",E),window.removeEventListener("keydown",ce)}});function G(g,E="other"){if(!de||!e(ze))return;c(z,null),c(b,[]),c(T,!1),E==="damage"&&V([]),ve(E),c(Z,!1),de.diceToRoll=g;const ce=xe=>null,ee=xe=>{let ye=xe.resultTotal,A=xe.resultString;if(re()&&(ye=Math.floor(ye/2),A=A+" (halved)"),c(z,{...xe,resultTotal:ye,resultString:A}),(E==="attack"||E==="check"||E==="save")&&xe.result&&xe.result.length>0){const C=xe.result[0];c(T,C===20),C===1&&c(T,!1)}if(c(b,[]),console.log("Setting up follow-up actions. Type:",E,"damageNotation:",q(),"isCritical:",e(T)),E==="attack"&&q())if(e(T)){const C=tt(q());e(b).push({label:`Roll Critical Damage (${C})`,notation:C})}else e(b).push({label:`Roll Damage (${q()})`,notation:q()})};de.start_throw(ce,ee)}function Se(){const g=[];e(fe)>0&&g.push(`${e(fe)}d4`),e(De)>0&&g.push(`${e(De)}d6`),e(Me)>0&&g.push(`${e(Me)}d8`),e(ke)>0&&g.push(`${e(ke)}d10`),e(Re)>0&&g.push(`${e(Re)}d12`),e(j)>0&&g.push(`${e(j)}d20`);let E=g.join("+")||"1d20";return e(pe)!==0&&(E+=e(pe)>=0?`+${e(pe)}`:`${e(pe)}`),E}function Ke(){const g=Se();G(g)}function tt(g){return g.replace(/(\d+)d(\d+)/g,(E,ce,ee)=>`${parseInt(ce)*2}d${ee}`)}function ge(){c(fe,0),c(De,0),c(Me,0),c(ke,0),c(Re,0),c(j,0),c(pe,0),c(z,null),c(b,[]),c(T,!1),ve("other"),c(Z,!1)}function Ue(){window.DICE&&(window.DICE.setColors({dice_color:W(e(Ze),"ff"),label_color:W(e(Oe),"ff"),desk_color:e(je)}),de&&(de.updateDeskColor(e(je)),de.updateDiceColors()))}function F(){c(f,!e(f))}function $(){!e(z)||e(h)<=0||e(Z)||(c(z,{...e(z),resultTotal:e(z).resultTotal+10,resultString:e(z).resultString+" + 10 (Guided Strike)"}),ae.update(g=>{const E="ChannelDivinity",ce=g.classFeatures.features[E];return typeof ce=="number"&&ce>0&&(g.classFeatures.features[E]=ce-1),g}),c(Z,!0))}function Q(){k("close"),x(""),q(""),se(""),c(Ve,""),c(z,null),c(Z,!1),ge()}et(()=>(t(),oa),()=>{c(m,t().class?oa(t().class,t().level,t().subclass).some(E=>E.name==="Guided Strike"):!1)}),et(()=>t(),()=>{c(h,(()=>{const E=t().classFeatures.features["ChannelDivinity"];return typeof E=="number"?E:0})())}),et(()=>(e(fe),e(De),e(Me),e(ke),e(Re),e(j),e(pe)),()=>{c(D,(()=>{const g=[];e(fe)>0&&g.push(`${e(fe)}d4`),e(De)>0&&g.push(`${e(De)}d6`),e(Me)>0&&g.push(`${e(Me)}d8`),e(ke)>0&&g.push(`${e(ke)}d10`),e(Re)>0&&g.push(`${e(Re)}d12`),e(j)>0&&g.push(`${e(j)}d20`);let E=g.join("+")||"1d20";return e(pe)!==0&&(E+=e(pe)>=0?`+${e(pe)}`:`${e(pe)}`),E})())}),et(()=>(H(x()),e(ze),H(Y()),e(Ve),H(q()),H(se()),H(ve())),()=>{x()&&e(ze)&&Y()&&x()!==e(Ve)&&(c(Ve,x()),c(z,null),c(b,[]),c(T,!1),c(Z,!1),console.log("Auto-roll triggered. notation:",x(),"damageNotation:",q(),"attackName:",se(),"rollType:",ve()),setTimeout(()=>G(x(),ve()),200))}),Jt();var le={getLastRollTotal:Ce};It();var N=mr();let v;var Te=r(N),ue=r(Te),ie=s(r(ue),2),B=r(ie),U=s(B,2);l(ie),l(ue);var K=s(ue,2);{var Ae=g=>{var E=rr(),ce=s(r(E),2),ee=r(ce),xe=s(r(ee),2);we(xe),l(ee);var ye=s(ee,2),A=s(r(ye),2);we(A),l(ye);var C=s(ye,2),_e=s(r(C),2);we(_e),l(C),l(ce),l(E),He(xe,()=>e(Ze),$e=>c(Ze,$e)),R("change",xe,Ue),He(A,()=>e(Oe),$e=>c(Oe,$e)),R("change",A,Ue),He(_e,()=>e(je),$e=>c(je,$e)),R("change",_e,Ue),o(g,E)};S(K,g=>{e(f)&&g(Ae)})}var st=s(K,2);{var Be=g=>{var E=nr();o(g,E)};S(st,g=>{e(ze)||g(Be)})}var me=s(st,2),Le=r(me);ja(Le,g=>c(J,g),()=>e(J));var Fe=s(Le,2);{var Pe=g=>{var E=ir(),ce=s(r(E),2),ee=r(ce),xe=s(r(ee),2);we(xe),l(ee);var ye=s(ee,2),A=s(r(ye),2);we(A),l(ye);var C=s(ye,2),_e=s(r(C),2);we(_e),l(C);var $e=s(C,2),Qe=s(r($e),2);we(Qe),l($e);var lt=s($e,2),O=s(r(lt),2);we(O),l(lt);var pt=s(lt,2),ot=s(r(pt),2);we(ot),l(pt),l(ce);var y=s(ce,2),I=r(y),_=r(I);l(I);var Ie=s(I,2);l(y),l(E),M(()=>{I.disabled=!e(ze),w(_,`Roll ${e(D)??""}`)}),He(xe,()=>e(fe),te=>c(fe,te)),He(A,()=>e(De),te=>c(De,te)),He(_e,()=>e(Me),te=>c(Me,te)),He(Qe,()=>e(ke),te=>c(ke,te)),He(O,()=>e(Re),te=>c(Re,te)),He(ot,()=>e(j),te=>c(j,te)),R("click",I,Ke),R("click",Ie,ge),o(g,E)};S(Fe,g=>{x()||g(Pe)})}l(me);var Ne=s(me,2);let oe;var be=r(Ne);{var Ge=g=>{var E=gr(),ce=Ee(E),ee=r(ce),xe=r(ee,!0);l(ee);var ye=s(ee,2);{var A=ot=>{var y=or();o(ot,y)};S(ye,ot=>{e(T)&&ot(A)})}l(ce);var C=s(ce,2),_e=r(C,!0);l(C);var $e=s(C,2),Qe=r($e);{var lt=ot=>{var y=nt(),I=Ee(y);{var _=te=>{var qe=vr();yt(qe,5,()=>(e(z),H(x()),H(V()),n(()=>X(e(z),x(),V()))),St,(he,Ye)=>{var Xe=cr(),ft=r(Xe),$t=r(ft,!0);l(ft);var ct=s(ft,2),vt=r(ct);l(ct),l(Xe),M(()=>{w($t,(e(Ye),n(()=>e(Ye).display))),w(vt,`(${e(Ye),n(()=>e(Ye).source)??""})`)}),o(he,Xe)}),l(qe),o(te,qe)},Ie=te=>{var qe=nt(),he=Ee(qe);{var Ye=Xe=>{var ft=dr(),$t=r(ft);l(ft),M(()=>w($t,`Modifier: ${e(z),n(()=>e(z).constant>=0?"+":"")??""}${e(z),n(()=>e(z).constant)??""}`)),o(Xe,ft)};S(he,Xe=>{e(z),n(()=>e(z).constant)&&Xe(Ye)},!0)}o(te,qe)};S(I,te=>{H(V()),n(()=>V().length>0)?te(_):te(Ie,!1)})}o(ot,y)};S(Qe,ot=>{e(z),H(V()),n(()=>e(z).constant||V().length>0)&&ot(lt)})}l($e);var O=s($e,2);{var pt=ot=>{var y=fr(),I=r(y);yt(I,1,()=>e(b),St,(te,qe)=>{var he=ur(),Ye=r(he,!0);l(he),M(()=>w(Ye,(e(qe),n(()=>e(qe).label)))),R("click",he,()=>G(e(qe).notation,"damage")),o(te,he)});var _=s(I,2);{var Ie=te=>{var qe=pr();M(()=>{qe.disabled=e(h)<=0,We(qe,"title",e(h)<=0?"No Channel Divinity uses remaining":"Use Channel Divinity to add +10 to this attack roll")}),R("click",qe,$),o(te,qe)};S(_,te=>{e(m)&&ve()==="attack"&&!e(Z)&&e(h)>0&&te(Ie)})}l(y),o(ot,y)};S(O,ot=>{e(b),e(m),H(ve()),e(Z),e(h),n(()=>e(b).length>0||e(m)&&ve()==="attack"&&!e(Z)&&e(h)>0)&&ot(pt)})}M(()=>{w(xe,se()?`${se()} - Result`:"Result"),w(_e,(e(z),n(()=>e(z).resultTotal)))}),o(g,E)};S(be,g=>{e(z)&&g(Ge)})}l(Ne),l(Te),l(N),M(()=>{v=ht(N,1,"modal-overlay svelte-1r90jgp",null,v,{hidden:!Y()}),oe=ht(Ne,1,"roll-result svelte-1r90jgp",null,oe,{"has-result":e(z)})}),R("click",B,F),R("click",U,Q),R("click",Te,Ea(function(g){ia.call(this,i,g)})),R("keydown",Te,function(g){ia.call(this,i,g)}),R("click",N,Q),R("keydown",N,g=>g.key==="Escape"&&Q()),o(a,N),Cs(i,"getLastRollTotal",Ce);var Je=Et(le);return u(),Je}const Sa="https://api.github.com/gists";async function br(a,i,t){if(!i)throw new Error("GitHub token is required");const d=JSON.stringify(a,null,2),u=`${a.name||"character"}_dnd.json`,m={description:t||`D&D Character: ${a.name}`,public:!1,files:{[u]:{content:d}}},h=await fetch(Sa,{method:"POST",headers:{Authorization:`token ${i}`,"Content-Type":"application/json"},body:JSON.stringify(m)});if(!h.ok)throw new Error(`Failed to create gist: ${h.statusText}`);return(await h.json()).id}async function _r(a,i,t){if(!i||!t)throw new Error("GitHub token and Gist ID are required");const d=JSON.stringify(a,null,2),m={files:{[`${a.name||"character"}_dnd.json`]:{content:d}}},h=await fetch(`${Sa}/${t}`,{method:"PATCH",headers:{Authorization:`token ${i}`,"Content-Type":"application/json"},body:JSON.stringify(m)});if(!h.ok)throw new Error(`Failed to update gist: ${h.statusText}`)}async function yr(a,i){if(!a)throw new Error("Gist ID is required");const t={"Content-Type":"application/json"};i&&(t.Authorization=`token ${i}`);const d=await fetch(`${Sa}/${a}`,{method:"GET",headers:t});if(!d.ok)throw new Error(`Failed to load gist: ${d.statusText}`);const u=await d.json(),m=Object.values(u.files);if(m.length===0)throw new Error("No files found in gist");const D=m[0].content;try{const k=JSON.parse(D);return k.attacks&&Array.isArray(k.attacks)&&(k.attacks=k.attacks.map(x=>({...x,id:x.id||crypto.randomUUID()}))),k.classFeatures?(k.classFeatures.features||(k.classFeatures.features={}),k.classFeatures.spellSlots||(k.classFeatures.spellSlots=[]),k.classFeatures.preparedSpells===void 0&&(k.classFeatures.preparedSpells="")):k.classFeatures={features:{},spellSlots:[],preparedSpells:""},k}catch{throw new Error("Invalid character data in gist")}}function Ja(a){typeof window<"u"&&localStorage.setItem("dnd_gist_config",JSON.stringify(a))}function kr(){if(typeof window<"u"){const a=localStorage.getItem("dnd_gist_config");if(a)return JSON.parse(a)}return{}}async function Sr(a,i=30){if(!a)throw new Error("GitHub token is required to list gists");const t=await fetch(`${Sa}?per_page=${i}`,{method:"GET",headers:{Authorization:`token ${a}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error(`Failed to list gists: ${t.statusText}`);return await t.json()}var xr=p('<div class="error-message svelte-1jb5ckg"> </div>'),$r=p('<div class="toggle-container svelte-1jb5ckg"><button type="button" class="toggle-btn svelte-1jb5ckg"> </button></div>'),Cr=p('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID (leave empty to create new)</label> <input type="text" id="gistId" placeholder="Optional: existing Gist ID to update" class="svelte-1jb5ckg"/></div>'),Lr=p('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),wr=p('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),Dr=p('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Update (or leave unselected to create new)</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),jr=p('<div class="info-message svelte-1jb5ckg">No gists found. A new one will be created.</div>'),Br=p('<!> <div class="form-group svelte-1jb5ckg"><label for="description" class="svelte-1jb5ckg"> </label> <input type="text" id="description" placeholder="D&amp;D Character Sheet" class="svelte-1jb5ckg"/></div>',1),Ar=p('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID *</label> <input type="text" id="gistId" placeholder="Enter Gist ID (for public or your private gists)" required class="svelte-1jb5ckg"/></div>'),Fr=p('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),Mr=p('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),Rr=p('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Load</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),Pr=p('<div class="info-message svelte-1jb5ckg">No gists found. Enter a Gist ID manually or create a new one in Save mode.</div>'),Ir=p('<div class="modal-overlay svelte-1jb5ckg" role="button" tabindex="-1"><div class="modal-content svelte-1jb5ckg" role="dialog" tabindex="0"><div class="modal-header svelte-1jb5ckg"><h2 class="svelte-1jb5ckg"> </h2> <button class="close-btn svelte-1jb5ckg">Ã—</button></div> <div class="modal-body svelte-1jb5ckg"><!> <div class="form-group svelte-1jb5ckg"><label for="token" class="svelte-1jb5ckg"> <a href="https://github.com/settings/tokens" target="_blank" rel="noopener" class="svelte-1jb5ckg">Get token</a></label> <input type="password" id="token" placeholder="ghp_xxxxxxxxxxxxx" class="svelte-1jb5ckg"/></div> <!> <!> <div class="modal-actions svelte-1jb5ckg"><button class="btn btn-primary svelte-1jb5ckg"><!></button> <button class="btn btn-secondary svelte-1jb5ckg">Cancel</button></div></div></div></div>');function Tr(a,i){Tt(i,!1);const t=()=>at(ae,"$character",d),[d,u]=qt(),m=sa();let h=kt(i,"mode",8,"save"),D=P(""),k=P(""),x=P(""),Y=P(!1),q=P(""),se=P(!1),re=P(!1),V=P([]),ve=P(null);const de=kr();de.token&&c(D,de.token),de.gistId&&c(k,de.gistId),pa(async()=>{e(D)&&!e(se)&&await J()});async function J(){if(e(D)){c(re,!0),c(q,"");try{c(V,await Sr(e(D))),e(k)&&c(ve,e(V).find($=>$.id===e(k))||null)}catch($){c(q,$.message||"Failed to load gists"),c(V,[])}finally{c(re,!1)}}}function ze($){c(ve,$),c(k,$.id)}function Ve(){c(se,!e(se)),c(q,""),!e(se)&&e(D)&&J()}async function z(){if(!e(D)){c(q,"GitHub token is required");return}const $=e(ve)?.id||e(k);c(Y,!0),c(q,"");try{if($)await _r(t(),e(D),$),c(k,$),Gt.add("Character updated in Gist successfully!","success");else{const Q=await br(t(),e(D),e(x));c(k,Q),Gt.add(`Character saved to Gist! ID: ${Q}`,"success")}Ja({token:e(D),gistId:e(k)}),m("close")}catch(Q){c(q,Q.message||"Failed to save to Gist")}finally{c(Y,!1)}}async function Ce(){const $=e(ve)?.id||e(k);if(!$){c(q,"Please select a gist or enter a Gist ID");return}c(Y,!0),c(q,"");try{const Q=await yr($,e(D)||void 0);ae.set(Q),c(k,$),Ja({token:e(D),gistId:e(k)}),Gt.add("Character loaded from Gist successfully!","success"),m("close")}catch(Q){c(q,Q.message||"Failed to load from Gist")}finally{c(Y,!1)}}function X(){m("close")}It();var fe=Ir(),De=r(fe),Me=r(De),ke=r(Me),Re=r(ke,!0);l(ke);var j=s(ke,2);l(Me);var pe=s(Me,2),b=r(pe);{var T=$=>{var Q=xr(),le=r(Q,!0);l(Q),M(()=>w(le,e(q))),o($,Q)};S(b,$=>{e(q)&&$(T)})}var Z=s(b,2),Ze=r(Z),Oe=r(Ze);ra(),l(Ze);var je=s(Ze,2);we(je),l(Z);var f=s(Z,2);{var L=$=>{var Q=$r(),le=r(Q),N=r(le,!0);l(le),l(Q),M(()=>{le.disabled=e(Y),w(N,e(se)?"ðŸ“‹ Show My Gists":"âœï¸ Enter Gist ID Manually")}),R("click",le,Ve),o($,Q)};S(f,$=>{(h()==="load"||h()==="save"&&e(D))&&$(L)})}var W=s(f,2);{var ne=$=>{var Q=Br(),le=Ee(Q);{var N=U=>{var K=Cr(),Ae=s(r(K),2);we(Ae),l(K),M(()=>Ae.disabled=e(Y)),He(Ae,()=>e(k),st=>c(k,st)),o(U,K)},v=U=>{var K=nt(),Ae=Ee(K);{var st=me=>{var Le=Lr();o(me,Le)},Be=me=>{var Le=nt(),Fe=Ee(Le);{var Pe=oe=>{var be=Dr(),Ge=s(r(be),2);yt(Ge,5,()=>e(V),St,(Je,g)=>{var E=wr();let ce;var ee=r(E),xe=r(ee),ye=r(xe,!0);l(xe);var A=s(xe,2),C=r(A,!0);l(A),l(ee);var _e=s(ee,2),$e=r(_e),Qe=r($e);l($e);var lt=s($e,2),O=r(lt);l(lt),l(_e),l(E),M(pt=>{ce=ht(E,1,"gist-item svelte-1jb5ckg",null,ce,{selected:e(ve)?.id===e(g).id}),E.disabled=e(Y),w(ye,(e(g),n(()=>e(g).description||"Untitled"))),w(C,(e(g),n(()=>e(g).public?"ðŸŒ Public":"ðŸ”’ Private"))),w(Qe,`ID: ${e(g),n(()=>e(g).id)??""}`),w(O,`Updated: ${pt??""}`)},[()=>(e(g),n(()=>new Date(e(g).updated_at).toLocaleDateString()))]),R("click",E,()=>ze(e(g))),o(Je,E)}),l(Ge),l(be),o(oe,be)},Ne=oe=>{var be=nt(),Ge=Ee(be);{var Je=g=>{var E=jr();o(g,E)};S(Ge,g=>{e(D)&&g(Je)},!0)}o(oe,be)};S(Fe,oe=>{e(V),n(()=>e(V).length>0)?oe(Pe):oe(Ne,!1)},!0)}o(me,Le)};S(Ae,me=>{e(re)?me(st):me(Be,!1)},!0)}o(U,K)};S(le,U=>{e(se)||!e(D)?U(N):U(v,!1)})}var Te=s(le,2),ue=r(Te),ie=r(ue);l(ue);var B=s(ue,2);we(B),l(Te),M(()=>{w(ie,`Description ${e(k)?"(optional)":""}`),B.disabled=e(Y)}),He(B,()=>e(x),U=>c(x,U)),o($,Q)},G=$=>{var Q=nt(),le=Ee(Q);{var N=Te=>{var ue=Ar(),ie=s(r(ue),2);we(ie),l(ue),M(()=>ie.disabled=e(Y)),He(ie,()=>e(k),B=>c(k,B)),o(Te,ue)},v=Te=>{var ue=nt(),ie=Ee(ue);{var B=K=>{var Ae=Fr();o(K,Ae)},U=K=>{var Ae=nt(),st=Ee(Ae);{var Be=Le=>{var Fe=Rr(),Pe=s(r(Fe),2);yt(Pe,5,()=>e(V),St,(Ne,oe)=>{var be=Mr();let Ge;var Je=r(be),g=r(Je),E=r(g,!0);l(g);var ce=s(g,2),ee=r(ce,!0);l(ce),l(Je);var xe=s(Je,2),ye=r(xe),A=r(ye);l(ye);var C=s(ye,2),_e=r(C);l(C),l(xe),l(be),M($e=>{Ge=ht(be,1,"gist-item svelte-1jb5ckg",null,Ge,{selected:e(ve)?.id===e(oe).id}),be.disabled=e(Y),w(E,(e(oe),n(()=>e(oe).description||"Untitled"))),w(ee,(e(oe),n(()=>e(oe).public?"ðŸŒ Public":"ðŸ”’ Private"))),w(A,`ID: ${e(oe),n(()=>e(oe).id)??""}`),w(_e,`Updated: ${$e??""}`)},[()=>(e(oe),n(()=>new Date(e(oe).updated_at).toLocaleDateString()))]),R("click",be,()=>ze(e(oe))),o(Ne,be)}),l(Pe),l(Fe),o(Le,Fe)},me=Le=>{var Fe=nt(),Pe=Ee(Fe);{var Ne=oe=>{var be=Pr();o(oe,be)};S(Pe,oe=>{e(D)&&oe(Ne)},!0)}o(Le,Fe)};S(st,Le=>{e(V),n(()=>e(V).length>0)?Le(Be):Le(me,!1)},!0)}o(K,Ae)};S(ie,K=>{e(re)?K(B):K(U,!1)},!0)}o(Te,ue)};S(le,Te=>{e(se)||!e(D)?Te(N):Te(v,!1)},!0)}o($,Q)};S(W,$=>{h()==="save"?$(ne):$(G,!1)})}var Se=s(W,2),Ke=r(Se),tt=r(Ke);{var ge=$=>{var Q=At();M(()=>w(Q,h()==="save"?"Saving...":"Loading...")),o($,Q)},Ue=$=>{var Q=At();M(()=>w(Q,h()==="save"?"Save":"Load")),o($,Q)};S(tt,$=>{e(Y)?$(ge):$(Ue,!1)})}l(Ke);var F=s(Ke,2);l(Se),l(pe),l(De),l(fe),M(()=>{w(Re,h()==="save"?"Save to GitHub Gist":"Load from GitHub Gist"),w(Oe,`GitHub Token ${h()==="load"?"(optional for public gists)":"(required)"} `),je.disabled=e(Y),Ke.disabled=e(Y),F.disabled=e(Y)}),R("click",j,X),He(je,()=>e(D),$=>c(D,$)),R("blur",je,()=>{e(D)&&!e(se)&&J()}),R("click",Ke,function(...$){(h()==="save"?z:Ce)?.apply(this,$)}),R("click",F,X),R("click",De,Ea(function($){ia.call(this,i,$)})),R("keydown",De,function($){ia.call(this,i,$)}),R("click",fe,X),R("keydown",fe,$=>$.key==="Escape"&&X()),o(a,fe),Et(),u()}var Er=p('<div class="loading svelte-1ngjemu">Loading D&D data...</div>'),Hr=p("<option> </option>"),Ur=p('<select class="level-filter svelte-1ngjemu"><option>All Levels</option><option>Cantrip</option><!></select>'),Nr=p('<div class="no-results svelte-1ngjemu"> </div>'),Gr=p('<div class="item-meta svelte-1ngjemu"> </div>'),Or=p('<div class="item-meta svelte-1ngjemu"> </div>'),qr=p('<button><div class="item-name svelte-1ngjemu"> </div> <!></button>'),Wr=p('<p class="higher-levels"><strong>At Higher Levels:</strong> </p>'),zr=p('<p class="cantrip-upgrade"><strong>Cantrip Upgrade:</strong> </p>'),Kr=p('<h3 class="svelte-1ngjemu"> </h3> <p class="spell-meta svelte-1ngjemu"><!> <!></p> <p class="spell-classes"><strong>Classes:</strong> </p> <div class="spell-stats svelte-1ngjemu"><div><strong>Casting Time:</strong> </div> <div><strong>Range:</strong> </div> <div><strong>Components:</strong> <!></div> <div><strong>Duration:</strong> <!> </div></div> <p class="description svelte-1ngjemu"> </p> <!> <!>',1),Vr=p('<p class="prerequisite svelte-1ngjemu"><strong>Prerequisite:</strong> </p>'),Jr=p('<h3 class="svelte-1ngjemu"> </h3> <!> <p class="description svelte-1ngjemu"> </p> <a target="_blank" rel="noopener" class="source-link svelte-1ngjemu">View Full Details â†’</a>',1),Qr=p('<div class="item-details svelte-1ngjemu"><!></div>'),Yr=p('<div class="controls svelte-1ngjemu"><div class="tabs svelte-1ngjemu"><button> </button> <button> </button></div> <div class="search-controls svelte-1ngjemu"><input type="text" placeholder="Search by name or description..." class="search-input svelte-1ngjemu"/> <!></div></div> <div class="content-container svelte-1ngjemu"><div class="items-list svelte-1ngjemu"><!></div> <!></div>',1),Xr=p('<div class="modal-backdrop svelte-1ngjemu" role="presentation"><div class="modal svelte-1ngjemu" role="dialog" aria-modal="true" tabindex="-1"><div class="modal-header svelte-1ngjemu"><h2 class="svelte-1ngjemu">Browse D&D Spells & Feats</h2> <button class="close-btn svelte-1ngjemu" aria-label="Close">&times;</button></div> <div class="modal-body svelte-1ngjemu"><!></div> <div class="modal-footer svelte-1ngjemu"><button class="btn-secondary svelte-1ngjemu">Cancel</button> <button class="btn-primary svelte-1ngjemu">Add to Character Sheet</button></div></div></div>');function Zr(a,i){Tt(i,!1);const t=P(),d=P(),u=P();let m=kt(i,"onClose",8),h=P("spell"),D=P(!0),k=P(""),x=P(null),Y=P([]),q=P([]),se=P(null);pa(async()=>{c(D,!0);try{c(Y,await ss()),c(q,await Ys())}catch(j){console.error("Failed to load data:",j)}finally{c(D,!1)}});function re(j){c(se,j)}function V(j){const pe=j.match(/(\d+d\d+(?:\s*\+\s*\d+)?)/i);return pe?pe[1]:""}function ve(j){const pe=j.split(/\.( |$)/)[0].trim(),b=Array.from(j.matchAll(/\*\*(.*?)\*\*/g)).map(Z=>Z[1].replace(/\.$/,""));let T=pe;return b.length&&(T+=" | Effects: "+b.join(", ")),T}function de(){if(e(se)){if(e(h)==="spell"){const j=e(se);ae.update(pe=>{const T=[];j.range&&T.push(`Range: ${j.range}`),j.castingTime&&T.push(`Cast: ${j.castingTime}`),j.duration&&T.push(`Duration: ${j.duration}`),j.actionType==="Save"&&T.push("Saving throw spell"),j.components&&j.components.length>0&&T.push(`Components: ${j.components.join(", ")}`),j.material&&T.push(`Material: ${j.material}`);const Z=T.join(" | "),Ze=ve(j.description),Oe={id:crypto.randomUUID(),name:`${j.name}${j.concentration?" (C)":""}${j.ritual?" (R)":""}`,bonus:j.actionType==="Attack"?5:0,damage:V(j.description),damageType:`${j.school} (Lvl ${j.level})`,spellRef:j.name,infoNotes:Z,generalNotes:Ze,castAtLevel:j.level};return pe.attacks=[...pe.attacks,Oe],pe})}else if(e(h)==="feat"){const j=e(se);ae.update(pe=>{const b=`${j.name}${j.prerequisite?` (Req: ${j.prerequisite})`:""}
${j.description}
`;return pe.features=pe.features?`${pe.features}
${b}`:b,pe})}c(se,null),m()()}}et(()=>(e(x),e(Y),e(k)),()=>{c(t,e(x)!==null?Xs(za(e(Y),e(k)),e(x)):za(e(Y),e(k)))}),et(()=>(e(q),e(k)),()=>{c(d,Zs(e(q),e(k)))}),et(()=>(e(h),e(t),e(d)),()=>{c(u,e(h)==="spell"?e(t):e(d))}),Jt(),It();var J=Xr(),ze=r(J),Ve=r(ze),z=s(r(Ve),2);l(Ve);var Ce=s(Ve,2),X=r(Ce);{var fe=j=>{var pe=Er();o(j,pe)},De=j=>{var pe=Yr(),b=Ee(pe),T=r(b),Z=r(T);let Ze;var Oe=r(Z);l(Z);var je=s(Z,2);let f;var L=r(je);l(je),l(T);var W=s(T,2),ne=r(W);we(ne);var G=s(ne,2);{var Se=le=>{var N=Ur();M(()=>{e(x),Lt(()=>{})});var v=r(N);v.value=(v.__value=null)??"";var Te=s(v);Te.value=Te.__value=0;var ue=s(Te);yt(ue,0,()=>[1,2,3,4,5,6,7,8,9],St,(ie,B)=>{var U=Hr(),K=r(U);l(U);var Ae={};M(()=>{w(K,`Level ${B??""}`),Ae!==(Ae=B)&&(U.value=(U.__value=B)??"")}),o(ie,U)}),l(N),Aa(N,()=>e(x),ie=>c(x,ie)),o(le,N)};S(G,le=>{e(h)==="spell"&&le(Se)})}l(W),l(b);var Ke=s(b,2),tt=r(Ke),ge=r(tt);{var Ue=le=>{var N=Nr(),v=r(N);l(N),M(()=>w(v,`No ${e(h)??""}s found`)),o(le,N)},F=le=>{var N=nt(),v=Ee(N);yt(v,1,()=>e(u),St,(Te,ue)=>{var ie=qr();let B;var U=r(ie),K=r(U,!0);l(U);var Ae=s(U,2);{var st=me=>{const Le=it(()=>e(ue));var Fe=Gr(),Pe=r(Fe);l(Fe),M(()=>w(Pe,`Level ${H(e(Le)),n(()=>e(Le).level)??""} â€¢ ${H(e(Le)),n(()=>e(Le).school)??""}`)),o(me,Fe)},Be=me=>{const Le=it(()=>e(ue));var Fe=nt(),Pe=Ee(Fe);{var Ne=oe=>{var be=Or(),Ge=r(be,!0);l(be),M(()=>w(Ge,(H(e(Le)),n(()=>e(Le).prerequisite)))),o(oe,be)};S(Pe,oe=>{H(e(Le)),n(()=>e(Le).prerequisite)&&oe(Ne)})}o(me,Fe)};S(Ae,me=>{e(h)==="spell"?me(st):me(Be,!1)})}l(ie),M(()=>{B=ht(ie,1,"item-card svelte-1ngjemu",null,B,{selected:e(se)?.name===e(ue).name}),w(K,(e(ue),n(()=>e(ue).name)))}),R("click",ie,()=>re(e(ue))),o(Te,ie)}),o(le,N)};S(ge,le=>{e(u),n(()=>e(u).length===0)?le(Ue):le(F,!1)})}l(tt);var $=s(tt,2);{var Q=le=>{var N=Qr(),v=r(N);{var Te=ie=>{const B=it(()=>e(se));var U=Kr(),K=Ee(U),Ae=r(K,!0);l(K);var st=s(K,2),Be=r(st);{var me=I=>{var _=At();M(()=>w(_,`${H(e(B)),n(()=>e(B).school)??""} cantrip`)),o(I,_)},Le=I=>{var _=At();M(()=>w(_,`Level ${H(e(B)),n(()=>e(B).level)??""} ${H(e(B)),n(()=>e(B).school)??""}`)),o(I,_)};S(Be,I=>{H(e(B)),n(()=>e(B).level===0)?I(me):I(Le,!1)})}var Fe=s(Be,2);{var Pe=I=>{var _=At("(ritual)");o(I,_)};S(Fe,I=>{H(e(B)),n(()=>e(B).ritual)&&I(Pe)})}l(st);var Ne=s(st,2),oe=s(r(Ne));l(Ne);var be=s(Ne,2),Ge=r(be),Je=s(r(Ge));l(Ge);var g=s(Ge,2),E=s(r(g));l(g);var ce=s(g,2),ee=s(r(ce)),xe=s(ee);{var ye=I=>{var _=At();M(()=>w(_,`(${H(e(B)),n(()=>e(B).material)??""})`)),o(I,_)};S(xe,I=>{H(e(B)),n(()=>e(B).material)&&I(ye)})}l(ce);var A=s(ce,2),C=s(r(A),2);{var _e=I=>{var _=At("Concentration,");o(I,_)};S(C,I=>{H(e(B)),n(()=>e(B).concentration)&&I(_e)})}var $e=s(C,1,!0);l(A),l(be);var Qe=s(be,2),lt=r(Qe,!0);l(Qe);var O=s(Qe,2);{var pt=I=>{var _=Wr(),Ie=s(r(_));l(_),M(()=>w(Ie,` ${H(e(B)),n(()=>e(B).higherLevelSlot)??""}`)),o(I,_)};S(O,I=>{H(e(B)),n(()=>e(B).higherLevelSlot)&&I(pt)})}var ot=s(O,2);{var y=I=>{var _=zr(),Ie=s(r(_));l(_),M(()=>w(Ie,` ${H(e(B)),n(()=>e(B).cantripUpgrade)??""}`)),o(I,_)};S(ot,I=>{H(e(B)),n(()=>e(B).cantripUpgrade)&&I(y)})}M((I,_)=>{w(Ae,(H(e(B)),n(()=>e(B).name))),w(oe,` ${I??""}`),w(Je,` ${H(e(B)),n(()=>e(B).castingTime||e(B).actionType)??""}`),w(E,` ${H(e(B)),n(()=>e(B).range)??""}`),w(ee,` ${_??""}`),w($e,(H(e(B)),n(()=>e(B).duration))),w(lt,(H(e(B)),n(()=>e(B).description)))},[()=>(H(e(B)),n(()=>e(B).classes.join(", "))),()=>(H(e(B)),n(()=>e(B).components.join(", ").toUpperCase()))]),o(ie,U)},ue=ie=>{const B=it(()=>e(se));var U=Jr(),K=Ee(U),Ae=r(K,!0);l(K);var st=s(K,2);{var Be=Pe=>{var Ne=Vr(),oe=s(r(Ne));l(Ne),M(()=>w(oe,` ${H(e(B)),n(()=>e(B).prerequisite)??""}`)),o(Pe,Ne)};S(st,Pe=>{H(e(B)),n(()=>e(B).prerequisite)&&Pe(Be)})}var me=s(st,2),Le=r(me,!0);l(me);var Fe=s(me,2);M(()=>{w(Ae,(H(e(B)),n(()=>e(B).name))),w(Le,(H(e(B)),n(()=>e(B).description))),We(Fe,"href",(H(e(B)),n(()=>e(B).source)))}),o(ie,U)};S(v,ie=>{e(h)==="spell"?ie(Te):ie(ue,!1)})}l(N),o(le,N)};S($,le=>{e(se)&&le(Q)})}l(Ke),M(()=>{Ze=ht(Z,1,"tab svelte-1ngjemu",null,Ze,{active:e(h)==="spell"}),w(Oe,`ðŸ“œ Spells (${e(Y),n(()=>e(Y).length)??""})`),f=ht(je,1,"tab svelte-1ngjemu",null,f,{active:e(h)==="feat"}),w(L,`â­ Feats (${e(q),n(()=>e(q).length)??""})`)}),R("click",Z,()=>{c(h,"spell"),c(se,null),c(k,"")}),R("click",je,()=>{c(h,"feat"),c(se,null),c(k,"")}),He(ne,()=>e(k),le=>c(k,le)),o(j,pe)};S(X,j=>{e(D)?j(fe):j(De,!1)})}l(Ce);var Me=s(Ce,2),ke=r(Me),Re=s(ke,2);l(Me),l(ze),l(J),M(()=>Re.disabled=!e(se)),R("click",z,function(...j){m()?.apply(this,j)}),R("click",ke,function(...j){m()?.apply(this,j)}),R("click",Re,de),R("click",ze,Ea(function(j){ia.call(this,i,j)})),R("keydown",ze,function(j){ia.call(this,i,j)}),R("click",J,function(...j){m()?.apply(this,j)}),R("keydown",J,j=>j.key==="Escape"&&m()()),o(a,J),Et()}var en=p('<link rel="icon" type="image/png" href="favicon4.png"/> <meta name="viewport" content="width=device-width, initial-scale=1"/>',1),tn=p('<span class="character-name svelte-1uha8ag"> </span>'),an=p("<span> </span>"),sn=p('<div class="spell-slots-header svelte-1uha8ag"></div>'),ln=p("<span> </span><br/>",1),rn=p("<span> </span>"),nn=p('<span class="effect-tooltip"><strong> </strong><br/> <br/> <!> <!></span>'),on=p('<button class="effect-remove-btn svelte-1uha8ag">Ã—</button>'),cn=p('<span class="effect-badge svelte-1uha8ag" tabindex="0"> <!> <!></span>'),vn=p(`<div class="active-effects-header svelte-1uha8ag"></div> <style>.effect-badge {
              position: relative;
            }
            .effect-tooltip {
              position: absolute;
              top: 120%;
              left: 50%;
              transform: translateX(-50%);
              background: #fff;
              color: #222;
              border: 1px solid #a5b4fc;
              border-radius: 6px;
              padding: 8px 12px;
              font-size: 0.95em;
              box-shadow: 0 2px 8px rgba(0, 0, 0, 0.12);
              z-index: 10;
              min-width: 180px;
              max-width: 260px;
              white-space: normal;
              pointer-events: none;
              opacity: 1;
              transition: opacity 0.15s;
            }</style>`,1),dn=p('<div class="rest-menu svelte-1uha8ag"><button class="rest-option svelte-1uha8ag">â˜• Short Rest</button> <button class="rest-option svelte-1uha8ag">ðŸ›ï¸ Long Rest</button></div>'),un=p('<div class="container svelte-1uha8ag"><header class="svelte-1uha8ag"><div class="header-top svelte-1uha8ag"><div class="header-title svelte-1uha8ag"><div class="title-row svelte-1uha8ag"><h1 class="svelte-1uha8ag">D&D Character Sheet</h1> <!></div> <!> <!></div> <div class="header-right svelte-1uha8ag"><div class="header-controls svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">ðŸŽ²</span><span class="btn-text svelte-1uha8ag">Roll Dice</span></button> <div class="rest-button-container svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">ðŸ˜´</span><span class="btn-text svelte-1uha8ag">Rest</span></button> <!></div> <div class="mode-toggle"><button><span class="btn-icon svelte-1uha8ag"> </span><span class="btn-text svelte-1uha8ag"> </span></button></div></div> <div class="header-search svelte-1uha8ag"><input type="text" placeholder="ðŸ” Search..." class="search-input use-enabled svelte-1uha8ag"/></div></div></div> <div class="header-actions svelte-1uha8ag"><button class="btn btn-mode svelte-1uha8ag">ðŸ“š Browse Spells & Feats</button> <button class="btn btn-secondary">Save to Gist</button> <button class="btn btn-secondary">Load from Gist</button> <button class="btn btn-secondary">Export JSON</button> <button class="btn btn-secondary">Import JSON</button> <input type="file" accept=".json" style="display: none;"/></div></header> <main class="svelte-1uha8ag"><!> <!> <!> <!> <!> <!> <!></main></div> <!> <!> <!> <!>',1);function kn(a,i){Tt(i,!1);const t=()=>at(ae,"$character",m),d=()=>at(na,"$isEditMode",m),u=()=>at(Zt,"$searchFilter",m),[m,h]=qt();function D(){const y=[],I=t().classFeatures.spellSlotsByLevel||{};for(let _=1;_<=9;_++){const Ie=I[_];if(Ie&&Ie.length>0){const te=Ie.length,qe=Ie.filter(he=>he).length;y.push({level:_,available:te-qe,total:te})}}return y}let k=P(!1),x=P(!1),Y=P(!1),q=P("save"),se=P(void 0),re=P(""),V=P(""),ve=P(""),de=P(!1),J=P([]),ze=P("other"),Ve=P(),z=!1,Ce=P(!1),X=P(null);function fe(y){c(X,y)}function De(){c(X,null)}function Me(y){c(X,e(X)===y?null:y)}function ke(){const y=[];ae.update(_=>{const Ie=_.hitDice.current;_.hitDice.current=Math.min(_.hitDice.max,_.hitDice.current+Math.max(1,Math.floor(_.hitDice.max/2)));const te=_.hitDice.current-Ie;if(te>0&&y.push(`${te} hit ${te===1?"die":"dice"}`),_.class){const qe=oa(_.class,_.level,_.subclass);_.classFeatures.features||(_.classFeatures.features={}),qe.forEach(he=>{if(he.resetOn==="short"){const Ye=he.name.replace(/\s+/g,"");if(he.type==="uses"){const Xe=typeof he.maxUses=="function"?he.maxUses(_.level):he.maxUses;_.classFeatures.features[Ye]=Array(Xe).fill(!1),y.push(he.name)}else if(he.type==="pool"){const Xe=typeof he.maxPool=="function"?he.maxPool(_.level):he.maxPool;Xe!==void 0&&(_.classFeatures.features[Ye]=Xe,y.push(he.name))}}})}return _}),c(Ce,!1);const I=y.length>0?`Short rest taken! Restored: ${y.join(", ")}`:"Short rest taken!";Gt.add(I,"success")}function Re(){const y=[];ae.update(_=>{const Ie=_.maxHP-_.currentHP;Ie>0&&y.push(`${Ie} HP`),_.currentHP=_.maxHP,_.tempHP=0;const te=_.hitDice.max-_.hitDice.current;te>0&&y.push(`${te} hit ${te===1?"die":"dice"}`),_.hitDice.current=_.hitDice.max;let qe=0;if(_.classFeatures.spellSlotsByLevel&&Object.keys(_.classFeatures.spellSlotsByLevel).forEach(he=>{const Ye=_.classFeatures.spellSlotsByLevel[parseInt(he)];if(Ye){const Xe=Ye.filter(ft=>ft).length;qe+=Xe,_.classFeatures.spellSlotsByLevel[parseInt(he)]=Array(Ye.length).fill(!1)}}),qe>0&&y.push(`${qe} spell ${qe===1?"slot":"slots"}`),_.class){const he=oa(_.class,_.level,_.subclass);_.classFeatures.features||(_.classFeatures.features={});let Ye=!1;he.forEach(Xe=>{const ft=Xe.name.replace(/\s+/g,"");if(!(Xe.type==="info"||Xe.type==="channelDivinity")){if(Xe.type==="uses"){const $t=typeof Xe.maxUses=="function"?Xe.maxUses(_.level):Xe.maxUses;_.classFeatures.features[ft]=Array($t).fill(!1),Ye=!0}else if(Xe.type==="pool"){const $t=typeof Xe.maxPool=="function"?Xe.maxPool(_.level):Xe.maxPool;$t!==void 0&&(_.classFeatures.features[ft]=$t,Ye=!0)}}}),Ye&&y.push("all class features")}return _}),c(Ce,!1);const I=y.length>0?`Long rest taken! Restored: ${y.join(", ")}`:"Long rest taken! Fully rested.";Gt.add(I,"success")}function j(y){c(re,""),c(V,""),c(ve,""),c(de,!1),c(J,[]),c(ze,"other"),z=!1,typeof y=="string"?c(re,y):(c(re,y.notation),c(V,y.damageNotation||""),c(ve,y.attackName||""),c(de,!!y.applyHalfDamage),c(J,y.bonusBreakdown||[]),c(ze,y.rollType||"other")),c(k,!0)}function pe(y){const{notation:I}=y.detail;c(re,""),z=!0,setTimeout(()=>{c(re,I),c(V,""),c(ve,"Hit Die")},0),c(k,!0)}function b(){if(c(k,!1),z&&e(Ve)){const y=e(Ve).getLastRollTotal();if(y!==null){const I=Math.max(1,y);ae.update(_=>(_.hitDice.current=Math.max(0,_.hitDice.current-1),_.currentHP=Math.min(_.maxHP,_.currentHP+I),_))}z=!1}}function T(){na.update(y=>!y)}function Z(y){y.target.closest(".rest-button-container")||c(Ce,!1)}pa(()=>{const y=na.subscribe(I=>{I?document.body.classList.remove("use-mode"):document.body.classList.add("use-mode")});return document.addEventListener("click",Z),()=>{y(),document.removeEventListener("click",Z)}});function Ze(){bs(t())}function Oe(){e(se)?.click()}async function je(y){const _=y.target.files?.[0];if(_)try{const Ie=await _s(_);ae.set(Ie),alert("Character imported successfully!")}catch{alert("Failed to import character file")}}It();var f=un();ms("1uha8ag",y=>{var I=en();ra(2),Xa(()=>{fs.title="D&D Character Sheet"}),o(y,I)});var L=Ee(f),W=r(L),ne=r(W),G=r(ne),Se=r(G),Ke=s(r(Se),2);{var tt=y=>{var I=tn(),_=r(I);l(I),M(()=>w(_,`${t().name??""} (${t().level??""})`)),o(y,I)};S(Ke,y=>{t().name&&y(tt)})}l(Se);var ge=s(Se,2);{var Ue=y=>{var I=sn();yt(I,5,D,St,(_,Ie)=>{var te=an();let qe;var he=r(te);l(te),M(()=>{qe=ht(te,1,"slot-badge svelte-1uha8ag",null,qe,{depleted:e(Ie).available===0}),w(he,`Lv${e(Ie).level??""}: ${e(Ie).available??""}/${e(Ie).total??""}`)}),o(_,te)}),l(I),o(y,I)};S(ge,y=>{D().length>0&&y(Ue)})}var F=s(ge,2);{var $=y=>{var I=vn(),_=Ee(I);yt(_,5,()=>t().activeStates,St,(Ie,te,qe)=>{var he=cn(),Ye=r(he),Xe=s(Ye);{var ft=vt=>{var Mt=nn(),bt=r(Mt),rt=r(bt,!0);l(bt);var _t=s(bt,2),gt=s(_t,3);{var Rt=mt=>{var wt=ln(),jt=Ee(wt),Kt=r(jt);l(jt),ra(),M(()=>w(Kt,`Attack Bonus: ${typeof e(te).attackBonus=="number"&&e(te).attackBonus>0?"+":""}${e(te).attackBonus??""}`)),o(mt,wt)};S(gt,mt=>{e(te).attackBonus&&mt(Rt)})}var Ht=s(gt,2);{var Ut=mt=>{var wt=rn(),jt=r(wt);l(wt),M(()=>w(jt,`Damage Bonus: ${typeof e(te).damageBonus=="number"&&e(te).damageBonus>0?"+":""}${e(te).damageBonus??""}`)),o(mt,wt)};S(Ht,mt=>{e(te).damageBonus&&mt(Ut)})}l(Mt),M(()=>{w(rt,e(te).name),w(_t,` ${e(te).description??""}`)}),o(vt,Mt)};S(Xe,vt=>{e(X)===qe&&vt(ft)})}var $t=s(Xe,2);{var ct=vt=>{var Mt=on();M(()=>We(Mt,"title",`End ${e(te).name??""}`)),R("click",Mt,()=>{ae.update(bt=>{if(bt.activeStates){const rt=bt.activeStates[qe];rt?.hpBonus&&rt.target!=="other"&&(bt.maxHP-=rt.hpBonus,bt.currentHP=Math.max(1,Math.min(bt.currentHP-rt.hpBonus,bt.maxHP))),bt.activeStates=bt.activeStates.filter((_t,gt)=>gt!==qe)}return bt})}),o(vt,Mt)};S($t,vt=>{d()||vt(ct)})}l(he),M(()=>{We(he,"aria-label",e(te).name),w(Ye,`âœ¨ ${e(te).name??""} `)}),R("mouseenter",he,()=>fe(qe)),R("mouseleave",he,De),R("focus",he,()=>fe(qe)),R("blur",he,De),R("click",he,()=>Me(qe)),o(Ie,he)}),l(_),ra(2),o(y,I)};S(F,y=>{t().activeStates&&t().activeStates.length>0&&y($)})}l(G);var Q=s(G,2),le=r(Q),N=r(le),v=s(N,2),Te=r(v),ue=s(Te,2);{var ie=y=>{var I=dn(),_=r(I),Ie=s(_,2);l(I),R("click",_,ke),R("click",Ie,Re),o(y,I)};S(ue,y=>{e(Ce)&&y(ie)})}l(v);var B=s(v,2),U=r(B);let K;var Ae=r(U),st=r(Ae,!0);l(Ae);var Be=s(Ae),me=r(Be,!0);l(Be),l(U),l(B),l(le);var Le=s(le,2),Fe=r(Le);we(Fe),l(Le),l(Q),l(ne);var Pe=s(ne,2),Ne=r(Pe),oe=s(Ne,2),be=s(oe,2),Ge=s(be,2),Je=s(Ge,2),g=s(Je,2);ja(g,y=>c(se,y),()=>e(se)),l(Pe),l(W);var E=s(W,2),ce=r(E);Ps(ce,{});var ee=s(ce,2);Hs(ee,{$$events:{roll:y=>j(y.detail)}});var xe=s(ee,2);Qs(xe,{$$events:{roll:y=>j(y.detail)}});var ye=s(xe,2);zs(ye,{$$events:{rollHitDice:pe}});var A=s(ye,2);El(A,{$$events:{roll:y=>j(y.detail)}});var C=s(A,2);tr(C,{});var _e=s(C,2);lr(_e,{}),l(E),l(L);var $e=s(L,2);ja(hr($e,{get notation(){return e(re)},get damageNotation(){return e(V)},get attackName(){return e(ve)},get applyHalfDamage(){return e(de)},get bonusBreakdown(){return e(J)},get rollType(){return e(ze)},get visible(){return e(k)},$$events:{close:b},$$legacy:!0}),y=>c(Ve,y),()=>e(Ve));var Qe=s($e,2);{var lt=y=>{Tr(y,{get mode(){return e(q)},$$events:{close:()=>c(x,!1)}})};S(Qe,y=>{e(x)&&y(lt)})}var O=s(Qe,2);{var pt=y=>{Zr(y,{onClose:()=>c(Y,!1)})};S(O,y=>{e(Y)&&y(pt)})}var ot=s(O,2);hs(ot,{}),M(()=>{K=ht(U,1,"btn btn-mode svelte-1uha8ag",null,K,{"use-mode":!d()}),w(st,d()?"ðŸ“":"ðŸŽ²"),w(me,d()?"Edit Mode":"Use Mode")}),R("click",N,()=>{c(J,[]),c(k,!0)}),R("click",Te,()=>c(Ce,!e(Ce))),R("click",U,T),He(Fe,u,y=>ys(Zt,y)),R("click",Ne,()=>c(Y,!0)),R("click",oe,()=>{c(q,"save"),c(x,!0)}),R("click",be,()=>{c(q,"load"),c(x,!0)}),R("click",Ge,Ze),R("click",Je,Oe),R("change",g,je),o(a,f),Et(),h()}export{kn as component};
