import{d as cs,g as Rs,f,e as L,a as c,s as S,c as bt,t as At}from"../chunks/BESELRjb.js";import{i as zt}from"../chunks/JMgyEzd3.js";import{c as ha,o as Sa,a as Ms,b as Ts}from"../chunks/CtPH092J.js";import{F as C,T as fa,Y as es,j as Fs,aZ as Ps,U as vs,ag as Is,aD as Es,aK as Hs,aE as Us,a1 as Ns,av as Pa,a7 as is,i as xs,a_ as Os,a$ as ks,b0 as Oa,K as ga,e as ws,b1 as $s,b2 as Gs,b3 as qs,b4 as Ws,q as ts,b5 as zs,b6 as Ks,ab as Vs,d as n,r as ns,g as Js,C as Kt,G as Vt,H as l,I as s,J as a,b7 as nt,b8 as ua,s as r,a4 as $,f as e,m as yt,E as je,b9 as Et,ao as Yt,A as O,ba as pa,bb as xa,bc as Ys}from"../chunks/DyJ43TGI.js";import{t as Qs,c as Qt,a as fe,e as $t,i as Dt,u as Ss,s as ma,b as Bt,d as Ga,f as ba,g as Xs,j as Ht,h as Zs,T as el,k as tl,l as al}from"../chunks/ByvjJ_Au.js";import{i as b,s as ca,a as pt,b as Ft,d as Da,e as sl}from"../chunks/CCL4udNy.js";import{p as wt,b as Ba}from"../chunks/iXw84bXb.js";import{b as La,r as ll}from"../chunks/HLFL0E2P.js";function il(i,o,t=!1,v=!1,d=!1){var p=i,m="";C(()=>{var D=Fs;if(m===(m=o()??"")){fa&&es();return}if(D.nodes_start!==null&&(Ps(D.nodes_start,D.nodes_end),D.nodes_start=D.nodes_end=null),m!==""){if(fa){vs.data;for(var h=es(),y=h;h!==null&&(h.nodeType!==Is||h.data!=="");)y=h,h=Es(h);if(h===null)throw Hs(),Us;cs(vs,y),p=Ns(h);return}var V=m+"";t?V=`<svg>${V}</svg>`:v&&(V=`<math>${V}</math>`);var M=Rs(V);if((t||v)&&(M=Pa(M)),cs(Pa(M),M.lastChild),t||v)for(;Pa(M);)p.before(Pa(M));else p.before(M)}})}function nl(i,o,t,v,d){fa&&es();var p=o.$$slots?.[t],m=!1;p===!0&&(p=o[t],m=!0),p===void 0?d!==null&&d(i):p(i,m?()=>v:v)}function rl(i,o,t,v){var d=i.__style;if(fa||d!==o){var p=Qs(o);(!fa||p!==i.getAttribute("style"))&&(p==null?i.removeAttribute("style"):i.style.cssText=p),i.__style=o}return v}function Na(i,o,t=!1){if(i.multiple){if(o==null)return;if(!xs(o))return Os();for(var v of i.options)v.selected=o.includes(ja(v));return}for(v of i.options){var d=ja(v);if(ks(d,o)){v.selected=!0;return}}(!t||o!==void 0)&&(i.selectedIndex=-1)}function as(i){var o=new MutationObserver(()=>{Na(i,i.__value)});o.observe(i,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),is(()=>{o.disconnect()})}function Ra(i,o,t=o){var v=new WeakSet,d=!0;Oa(i,"change",p=>{var m=p?"[selected]":":checked",D;if(i.multiple)D=[].map.call(i.querySelectorAll(m),ja);else{var h=i.querySelector(m)??i.querySelector("option:not([disabled])");D=h&&ja(h)}t(D),ga!==null&&v.add(ga)}),ws(()=>{var p=o();if(i===document.activeElement){var m=$s??ga;if(v.has(m))return}if(Na(i,p,d),d&&p===void 0){var D=i.querySelector(":checked");D!==null&&(p=ja(D),t(p))}i.__value=p,d=!1}),as(i)}function ja(i){return"__value"in i?i.__value:i.value}const ol=Symbol("is custom element"),cl=Symbol("is html");function Ce(i){if(fa){var o=!1,t=()=>{if(!o){if(o=!0,i.hasAttribute("value")){var v=i.value;it(i,"value",null),i.value=v}if(i.hasAttribute("checked")){var d=i.checked;it(i,"checked",null),i.checked=d}}};i.__on_r=t,ts(t),zs()}}function Aa(i,o){var t=rs(i);t.value===(t.value=o??void 0)||i.value===o&&(o!==0||i.nodeName!=="PROGRESS")||(i.value=o??"")}function Cs(i,o){var t=rs(i);t.checked!==(t.checked=o??void 0)&&(i.checked=o)}function it(i,o,t,v){var d=rs(i);fa&&(d[o]=i.getAttribute(o),o==="src"||o==="srcset"||o==="href"&&i.nodeName==="LINK")||d[o]!==(d[o]=t)&&(o==="loading"&&(i[Gs]=t),t==null?i.removeAttribute(o):typeof t!="string"&&vl(i).includes(o)?i[o]=t:i.setAttribute(o,t))}function rs(i){return i.__attributes??={[ol]:i.nodeName.includes("-"),[cl]:i.namespaceURI===qs}}var ds=new Map;function vl(i){var o=i.getAttribute("is")||i.nodeName,t=ds.get(o);if(t)return t;ds.set(o,t=[]);for(var v,d=i,p=Element.prototype;p!==d;){v=Ks(d);for(var m in v)v[m].set&&t.push(m);d=Ws(d)}return t}function Ne(i,o,t=o){var v=new WeakSet;Oa(i,"input",async d=>{var p=d?i.defaultValue:i.value;if(p=Va(i)?Ja(p):p,t(p),ga!==null&&v.add(ga),await Vs(),p!==(p=o())){var m=i.selectionStart,D=i.selectionEnd,h=i.value.length;if(i.value=p??"",D!==null){var y=i.value.length;m===D&&D===h&&y>h?(i.selectionStart=y,i.selectionEnd=y):(i.selectionStart=m,i.selectionEnd=Math.min(D,y))}}}),(fa&&i.defaultValue!==i.value||n(o)==null&&i.value)&&(t(Va(i)?Ja(i.value):i.value),ga!==null&&v.add(ga)),ns(()=>{var d=o();if(i===document.activeElement){var p=$s??ga;if(v.has(p))return}Va(i)&&d===Ja(i.value)||i.type==="date"&&!d&&!i.value||d!==i.value&&(i.value=d??"")})}const Ka=new Set;function us(i,o,t,v,d=v){var p=t.getAttribute("type")==="checkbox",m=i;let D=!1;if(o!==null)for(var h of o)m=m[h]??=[];m.push(t),Oa(t,"change",()=>{var y=t.__value;p&&(y=fs(m,y,t.checked)),d(y)},()=>d(p?[]:null)),ns(()=>{var y=v();if(fa&&t.defaultChecked!==t.checked){D=!0;return}p?(y=y||[],t.checked=y.includes(t.__value)):t.checked=ks(t.__value,y)}),is(()=>{var y=m.indexOf(t);y!==-1&&m.splice(y,1)}),Ka.has(m)||(Ka.add(m),ts(()=>{m.sort((y,V)=>y.compareDocumentPosition(V)===4?-1:1),Ka.delete(m)})),ts(()=>{if(D){var y;if(p)y=fs(m,y,t.checked);else{var V=m.find(M=>M.checked);y=V?.__value}d(y)}})}function ka(i,o,t=o){Oa(i,"change",v=>{var d=v?i.defaultChecked:i.checked;t(d)}),(fa&&i.defaultChecked!==i.checked||n(o)==null)&&t(i.checked),ns(()=>{var v=o();i.checked=!!v})}function fs(i,o,t){for(var v=new Set,d=0;d<i.length;d+=1)i[d].checked&&v.add(i[d].__value);return t||v.delete(o),Array.from(v)}function Va(i){var o=i.type;return o==="number"||o==="range"}function Ja(i){return i===""?null:+i}function dl(i,o,t){var v=Js(i,o);v&&v.set&&(i[o]=t,is(()=>{i[o]=null}))}function os(i){return function(...o){var t=o[0];return t.stopPropagation(),i?.apply(this,o)}}function wa(i,o){var t=i.$$events?.[o.type],v=xs(t)?t.slice():t==null?[]:[t];for(var d of v)d.call(this,o)}const ul="";function Ds(...i){return La+ul+ll(i[0],i[1])}const ss={paladin:{name:"Paladin",hitDice:"d10",spellcaster:!0,spellcastingAbility:"charisma",spellSlotsByLevel:{1:0,2:2,3:3,4:3,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Divine Sense",type:"uses",maxUses:(i,o=1)=>1+Math.max(1,o),resetOn:"long",description:"Detect celestials, fiends, and undead within 60 feet",minLevel:1},{name:"Lay on Hands",type:"pool",maxPool:i=>i*5,resetOn:"long",description:"Heal wounds or cure disease",minLevel:1},{name:"Divine Smite",type:"spellSlot",description:"Expend spell slot to deal extra radiant damage",minLevel:2,rollable:!0},{name:"Channel Divinity",type:"pool",maxPool:i=>i>=18?3:i>=6?2:1,resetOn:"short",description:"Sacred Weapon or Turn Undead",minLevel:3}]},fighter:{name:"Fighter",hitDice:"d10",spellcaster:!1,features:[{name:"Second Wind",type:"uses",maxUses:1,resetOn:"short",description:"Regain 1d10 + fighter level HP as bonus action",minLevel:1,rollable:!0,rollFormula:i=>`1d10+${i}`},{name:"Action Surge",type:"uses",maxUses:i=>i>=17?2:1,resetOn:"short",description:"Take one additional action on your turn",minLevel:2},{name:"Indomitable",type:"uses",maxUses:i=>i>=17?3:i>=13?2:1,resetOn:"long",description:"Reroll a failed saving throw",minLevel:9}],subclasses:{champion:{name:"Champion",features:[{name:"Improved Critical",type:"info",description:"Critical hit on 19-20",minLevel:3},{name:"Remarkable Athlete",type:"info",description:"Add half proficiency to STR/DEX/CON checks, increase long jump distance",minLevel:7},{name:"Additional Fighting Style",type:"info",description:"Choose a second fighting style",minLevel:10},{name:"Superior Critical",type:"info",description:"Critical hit on 18-20",minLevel:15},{name:"Survivor",type:"info",description:"Regain 5 + CON mod HP at start of turn if below half HP",minLevel:18}]},battlemaster:{name:"Battle Master",features:[{name:"Combat Superiority",type:"uses",maxUses:i=>i>=15?6:i>=7?5:4,resetOn:"short",description:i=>`Use superiority dice (${i>=18?"d12":i>=10?"d10":"d8"}) for maneuvers`,minLevel:3},{name:"Know Your Enemy",type:"info",description:"Learn capabilities of creatures you observe",minLevel:7},{name:"Improved Combat Superiority",type:"info",description:"Superiority dice become d10",minLevel:10},{name:"Relentless",type:"info",description:"Regain 1 superiority die if you have none at start of turn",minLevel:15}]}}},rogue:{name:"Rogue",hitDice:"d8",spellcaster:!1,features:[{name:"Sneak Attack",type:"info",description:i=>`Deal ${Math.ceil(i/2)}d6 extra damage once per turn with advantage or ally nearby`,minLevel:1,rollable:!0,rollFormula:i=>`${Math.ceil(i/2)}d6`},{name:"Cunning Action",type:"info",description:"Dash, Disengage, or Hide as a bonus action",minLevel:2},{name:"Uncanny Dodge",type:"info",description:"Use reaction to halve damage from an attack",minLevel:5},{name:"Evasion",type:"info",description:"Take no damage on successful Dex save (half on fail)",minLevel:7}]},wizard:{name:"Wizard",hitDice:"d6",spellcaster:!0,spellcastingAbility:"intelligence",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Arcane Recovery",type:"uses",maxUses:1,resetOn:"long",description:i=>`Recover spell slots totaling up to ${Math.ceil(i/2)} levels during short rest`,minLevel:1},{name:"Spell Mastery",type:"info",description:"Cast one 1st-level and one 2nd-level spell at will",minLevel:18}]},cleric:{name:"Cleric",hitDice:"d8",spellcaster:!0,spellcastingAbility:"wisdom",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Channel Divinity",type:"pool",maxPool:i=>i>=18?3:i>=6?2:1,resetOn:"short",description:"Turn Undead or domain-specific ability",minLevel:2},{name:"Destroy Undead",type:"info",description:i=>`Channel Divinity destroys undead of CR ${i>=17?4:i>=14?3:i>=11?2:i>=8?1:.5} or lower`,minLevel:5},{name:"Divine Intervention",type:"uses",maxUses:1,resetOn:"long",description:i=>`${i}% chance to succeed, implore deity for aid`,minLevel:10}],subclasses:{war:{name:"War Domain",features:[{name:"War Priest",type:"uses",maxUses:(i,o=1)=>Math.max(1,o),resetOn:"long",description:"Make one weapon attack as a bonus action",minLevel:1},{name:"Guided Strike",type:"channelDivinity",description:"Use your Channel Divinity to gain +10 to an attack roll. Make this choice after you see the roll, but before the DM says whether the attack hits or misses.",minLevel:2,resetOn:"short"},{name:"War God's Blessing",type:"channelDivinity",description:"Use reaction to grant +10 to an ally's attack roll within 30 feet. Consumes one use of Channel Divinity.",minLevel:6,resetOn:"short"},{name:"Divine Strike",type:"info",description:i=>`Deal extra ${i>=14?"2d8":"1d8"} weapon damage once per turn`,minLevel:8,rollable:!0,rollFormula:i=>i>=14?"2d8":"1d8"},{name:"Avatar of Battle",type:"info",description:"Gain resistance to nonmagical weapon damage",minLevel:17}]},life:{name:"Life Domain",features:[{name:"Disciple of Life",type:"info",description:"Healing spells restore additional 2 + spell level HP",minLevel:1},{name:"Preserve Life",type:"pool",maxPool:i=>i*5,resetOn:"short",description:"Restore HP to creatures within 30 feet",minLevel:2},{name:"Blessed Healer",type:"info",description:"Regain 2 + spell level HP when you cast healing spell",minLevel:6},{name:"Divine Strike",type:"info",description:i=>`Deal extra ${i>=14?"2d8":"1d8"} radiant damage once per turn`,minLevel:8,rollable:!0,rollFormula:i=>i>=14?"2d8":"1d8"},{name:"Supreme Healing",type:"info",description:"Maximize healing dice instead of rolling",minLevel:17}]}}},barbarian:{name:"Barbarian",hitDice:"d12",spellcaster:!1,features:[{name:"Rage",type:"uses",maxUses:i=>i>=20?1/0:i>=17?6:i>=12?5:i>=6?4:i>=3?3:2,resetOn:"long",description:i=>`+${i>=16?4:i>=9?3:2} damage, resistance to physical damage`,minLevel:1},{name:"Reckless Attack",type:"info",description:"Gain advantage on melee attacks, enemies get advantage on you",minLevel:2},{name:"Danger Sense",type:"info",description:"Advantage on Dex saves against effects you can see",minLevel:2}],subclasses:{berserker:{name:"Path of the Berserker",features:[{name:"Frenzy",type:"info",description:"While raging, make melee attack as bonus action (gain 1 exhaustion after rage)",minLevel:3},{name:"Mindless Rage",type:"info",description:"Cannot be charmed or frightened while raging",minLevel:6},{name:"Intimidating Presence",type:"info",description:"Use action to frighten creature within 30 feet",minLevel:10},{name:"Retaliation",type:"info",description:"When damaged by creature within 5 feet, make melee attack as reaction",minLevel:14}]}}}};function ia(i){const o=i.toLowerCase();return ss[o]||null}function $a(i,o,t){const v=ia(i);if(!v)return[];const d=v.features.filter(p=>!p.minLevel||p.minLevel<=o);if(t&&v.subclasses&&v.subclasses[t]){const p=v.subclasses[t].features.filter(m=>!m.minLevel||m.minLevel<=o);return[...d,...p]}return d}function ps(i){const o=ia(i);return!o||!o.subclasses?[]:Object.keys(o.subclasses).map(t=>({id:t,name:o.subclasses[t].name}))}function ms(i,o){const t=ia(i);return!t||!t.spellcaster||!t.spellSlotsByLevel?0:t.spellSlotsByLevel[o]||0}function gs(i,o,t){const v=ia(i);return!v||!v.spellcaster?0:Math.max(1,t+o)}function fl(i,o,t){const v=ia(i);return!v||!v.spellcaster?null:8+o+t}function pl(){return Object.keys(ss).map(i=>({id:i,name:ss[i].name}))}var ml=f('<div class="section-header svelte-ls99y2" role="button" tabindex="0"><h2 class="svelte-ls99y2"> </h2> <span class="collapse-btn svelte-ls99y2"> </span></div>');function _a(i,o){Kt(o,!1);let t=wt(o,"title",8),v=wt(o,"collapsed",8),d=wt(o,"ariaLabel",8,""),p=wt(o,"onToggle",8);zt();var m=ml(),D=l(m),h=l(D,!0);s(D);var y=a(D,2),V=l(y,!0);s(y),s(m),C(()=>{it(m,"aria-expanded",!v()),it(m,"aria-label",d()),S(h,t()),S(V,v()?"‚ñº":"‚ñ≤")}),L("click",m,function(...M){p()?.apply(this,M)}),L("keydown",m,M=>{(M.key==="Enter"||M.key===" ")&&p()()}),c(i,m),Vt()}var gl=f("<option> </option>"),bl=f("<option> </option>"),hl=f('<div class="form-group svelte-172i2fj"><label for="characterSubclass" class="svelte-172i2fj">Subclass</label> <select id="characterSubclass" class="svelte-172i2fj"><option>Select Subclass</option><!></select></div>'),_l=f('<div class="info-grid svelte-172i2fj"><div class="form-group svelte-172i2fj"><label for="characterName" class="svelte-172i2fj">Character Name</label> <input type="text" id="characterName" placeholder="Enter name" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterClass" class="svelte-172i2fj">Class</label> <select id="characterClass" class="svelte-172i2fj"><option>Select Class</option><!></select></div> <!> <div class="form-group svelte-172i2fj"><label for="characterLevel" class="svelte-172i2fj">Level</label> <input type="number" id="characterLevel" min="1" max="20" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterRace" class="svelte-172i2fj">Race</label> <input type="text" id="characterRace" placeholder="e.g., Human" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterBackground" class="svelte-172i2fj">Background</label> <input type="text" id="characterBackground" placeholder="e.g., Soldier" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterAlignment" class="svelte-172i2fj">Alignment</label> <input type="text" id="characterAlignment" placeholder="e.g., Lawful Good" class="svelte-172i2fj"/></div></div>'),yl=f('<section class="character-info svelte-172i2fj"><!> <!></section>');function xl(i,o){Kt(o,!1);const t=()=>pt(fe,"$character",d),v=()=>pt(Qt,"$collapsedStates",d),[d,p]=ca(),m=$(),D=pl();function h(se){const F=se.target;fe.update(I=>(I.class=F.value,I.subclass="",I))}function y(se){const F=se.target;fe.update(I=>(I.subclass=F.value,I))}function V(se){const F=se.target;fe.update(I=>(I.level=parseInt(F.value)||1,I)),Ss()}nt(()=>(t(),ps),()=>{r(m,t().class?ps(t().class):[])}),ua(),zt();var M=yl(),ne=l(M);{let se=yt(()=>(v(),n(()=>v().characterInfo?"Expand":"Collapse")));_a(ne,{title:"Character Info",get collapsed(){return v(),n(()=>v().characterInfo)},get ariaLabel(){return e(se)},onToggle:()=>Qt.update(F=>({...F,characterInfo:!F.characterInfo}))})}var J=a(ne,2);{var ae=se=>{var F=_l(),I=l(F),pe=a(l(I),2);Ce(pe),s(I);var Ie=a(I,2),Ze=a(l(Ie),2),Y=l(Ze);Y.value=Y.__value="";var He=a(Y);$t(He,1,()=>D,Dt,(Be,re)=>{var be=gl(),Oe=l(be,!0);s(be);var Ve={};C(()=>{S(Oe,(e(re),n(()=>e(re).name))),Ve!==(Ve=(e(re),n(()=>e(re).id)))&&(be.value=(be.__value=(e(re),n(()=>e(re).id)))??"")}),c(Be,be)}),s(Ze);var ye;as(Ze),s(Ie);var $e=a(Ie,2);{var Pe=Be=>{var re=hl(),be=a(l(re),2),Oe=l(be);Oe.value=Oe.__value="";var Ve=a(Oe);$t(Ve,1,()=>e(m),Dt,(mt,gt)=>{var rt=bl(),k=l(rt,!0);s(rt);var P={};C(()=>{S(k,(e(gt),n(()=>e(gt).name))),P!==(P=(e(gt),n(()=>e(gt).id)))&&(rt.value=(rt.__value=(e(gt),n(()=>e(gt).id)))??"")}),c(mt,rt)}),s(be);var ut;as(be),s(re),C(()=>{ut!==(ut=(t(),n(()=>t().subclass)))&&(be.value=(be.__value=(t(),n(()=>t().subclass)))??"",Na(be,(t(),n(()=>t().subclass))))}),L("change",be,y),c(Be,re)};b($e,Be=>{e(m),n(()=>e(m).length>0)&&Be(Pe)})}var R=a($e,2),T=a(l(R),2);Ce(T),s(R);var x=a(R,2),W=a(l(x),2);Ce(W),s(x);var g=a(x,2),A=a(l(g),2);Ce(A),s(g);var Z=a(g,2),Ue=a(l(Z),2);Ce(Ue),s(Z),s(F),C(()=>{ye!==(ye=(t(),n(()=>t().class)))&&(Ze.value=(Ze.__value=(t(),n(()=>t().class)))??"",Na(Ze,(t(),n(()=>t().class)))),Aa(T,(t(),n(()=>t().level)))}),Ne(pe,()=>t().name,Be=>Ft(fe,n(t).name=Be,n(t))),L("change",Ze,h),L("change",T,V),Ne(W,()=>t().race,Be=>Ft(fe,n(t).race=Be,n(t))),Ne(A,()=>t().background,Be=>Ft(fe,n(t).background=Be,n(t))),Ne(Ue,()=>t().alignment,Be=>Ft(fe,n(t).alignment=Be,n(t))),c(se,F)};b(J,se=>{v(),n(()=>!v().characterInfo)&&se(ae)})}s(M),c(i,M),Vt(),p()}var kl=f('<div class="ability-card svelte-bbv1xt"><h3 class="svelte-bbv1xt"> </h3> <input type="number" class="ability-score svelte-bbv1xt" min="1" max="30"/> <div class="ability-modifier svelte-bbv1xt"> </div> <div class="roll-buttons svelte-bbv1xt"><button class="roll-btn svelte-bbv1xt">Check</button> <button class="roll-btn svelte-bbv1xt">Save</button></div> <div class="save-proficiency svelte-bbv1xt"><input type="checkbox" class="svelte-bbv1xt"/> <label class="svelte-bbv1xt">Save Prof.</label></div></div>'),wl=f('<div class="proficiency-bonus svelte-bbv1xt"><label for="profBonus">Proficiency Bonus</label> <input type="number" id="profBonus" class="prof-input svelte-bbv1xt"/></div> <div class="abilities-grid svelte-bbv1xt"></div>',1),$l=f("<section><!> <!></section>");function Sl(i,o){Kt(o,!1);const t=()=>pt(Ga,"$abilityModifiers",D),v=()=>pt(fe,"$character",D),d=()=>pt(ma,"$searchFilter",D),p=()=>pt(Qt,"$collapsedStates",D),m=()=>pt(ba,"$isEditMode",D),[D,h]=ca(),y=$(),V=$(),M=ha(),ne=[{key:"strength",label:"Strength"},{key:"dexterity",label:"Dexterity"},{key:"constitution",label:"Constitution"},{key:"intelligence",label:"Intelligence"},{key:"wisdom",label:"Wisdom"},{key:"charisma",label:"Charisma"}];function J(){Ss()}function ae(Y){const He=t()[Y],ye=`1d20${He>=0?"+":""}${He}`,$e=[];$e.push({value:"1d20",source:"base die"}),He!==0&&$e.push({value:He,source:Y}),M("roll",{notation:ye,rollType:"check",bonusBreakdown:$e})}function se(Y){const He=t()[Y],ye=v().saveProficiencies[Y]?v().proficiencyBonus:0,$e=He+ye,Pe=`1d20${$e>=0?"+":""}${$e}`,R=[];R.push({value:"1d20",source:"base die"}),He!==0&&R.push({value:He,source:Y}),ye!==0&&R.push({value:ye,source:"proficiency"}),M("roll",{notation:Pe,rollType:"save",bonusBreakdown:R})}nt(()=>d(),()=>{r(y,ne.filter(({label:Y})=>d()?Y.toLowerCase().includes(d().toLowerCase()):!0))}),nt(()=>(e(y),d()),()=>{r(V,e(y).length>0||!d()||d().toLowerCase().includes("proficiency"))}),ua(),zt();var F=$l();let I;var pe=l(F);_a(pe,{title:"Ability Scores",get collapsed(){return p(),n(()=>p().abilityScores)},ariaLabel:"Toggle Ability Scores Section",onToggle:()=>Qt.update(Y=>({...Y,abilityScores:!Y.abilityScores}))});var Ie=a(pe,2);{var Ze=Y=>{var He=wl(),ye=je(He),$e=a(l(ye),2);Ce($e),s(ye);var Pe=a(ye,2);$t(Pe,5,()=>e(y),Dt,(R,T)=>{let x=()=>e(T).key,W=()=>e(T).label;var g=kl(),A=l(g),Z=l(A,!0);s(A);var Ue=a(A,2);Ce(Ue);var Be=a(Ue,2),re=l(Be);s(Be);var be=a(Be,2),Oe=l(be),Ve=a(Oe,2);s(be);var ut=a(be,2),mt=l(ut);Ce(mt);var gt=a(mt,2);s(ut),s(g),C(rt=>{S(Z,rt),S(re,`${t(),x(),n(()=>t()[x()]>=0?"+":"")??""}${t(),x(),n(()=>t()[x()])??""}`),mt.disabled=!m(),it(mt,"id",`${x()}-save`),it(gt,"for",`${x()}-save`)},[()=>(W(),n(()=>W().substring(0,3).toUpperCase()))]),Ne(Ue,()=>v().abilities[x()],rt=>Ft(fe,n(v).abilities[x()]=rt,n(v))),L("change",Ue,J),L("click",Oe,()=>ae(x())),L("click",Ve,()=>se(x())),ka(mt,()=>v().saveProficiencies[x()],rt=>Ft(fe,n(v).saveProficiencies[x()]=rt,n(v))),c(R,g)}),s(Pe),Ne($e,()=>v().proficiencyBonus,R=>Ft(fe,n(v).proficiencyBonus=R,n(v))),c(Y,He)};b(Ie,Y=>{p(),n(()=>!p().abilityScores)&&Y(Ze)})}s(F),C(()=>I=Bt(F,1,"ability-scores svelte-bbv1xt",null,I,{hidden:!e(V)})),c(i,F),Vt(),h()}const Ls=[{name:"Unarmored",type:"none",baseAC:10},{name:"Padded",type:"light",baseAC:11},{name:"Leather",type:"light",baseAC:11},{name:"Studded Leather",type:"light",baseAC:12},{name:"Hide",type:"medium",baseAC:12,maxDexBonus:2},{name:"Chain Shirt",type:"medium",baseAC:13,maxDexBonus:2},{name:"Scale Mail",type:"medium",baseAC:14,maxDexBonus:2},{name:"Breastplate",type:"medium",baseAC:14,maxDexBonus:2},{name:"Half Plate",type:"medium",baseAC:15,maxDexBonus:2},{name:"Ring Mail",type:"heavy",baseAC:14,maxDexBonus:0},{name:"Chain Mail",type:"heavy",baseAC:16,maxDexBonus:0},{name:"Splint",type:"heavy",baseAC:17,maxDexBonus:0},{name:"Plate",type:"heavy",baseAC:18,maxDexBonus:0}];function js(i){return Ls.find(o=>o.name===i)}function Cl(i,o,t){if(!i)return 10+o+(t?2:0);const v=js(i);if(!v)return 10+o+(t?2:0);let d=v.baseAC;return v.maxDexBonus===void 0?d+=o:v.maxDexBonus>0&&(d+=Math.min(o,v.maxDexBonus)),t&&(d+=2),d}function Ma(i){return Math.floor((i-10)/2)}function ls(i,o){if(!i.class)return null;const t=ia(i.class);if(!t||!t.spellcaster||!t.spellcastingAbility)return null;const v=Ma(o[t.spellcastingAbility]);return 8+i.proficiencyBonus+v}function Ya(i,o){if(!i.class)return 0;const t=ia(i.class);return!t||!t.spellcaster||!t.spellcastingAbility?0:Ma(o[t.spellcastingAbility])}function Dl(i,o){const t=[],v=Ma(o.dexterity),d=i.armorName?js(i.armorName):void 0;if(d){if(d.type==="none")t.push("Unarmored"),t.push("Base: 10"),t.push(`Dexterity: ${v>=0?"+":""}${v}`);else if(d.type==="light")t.push(`${d.name}: ${d.baseAC}`),t.push(`Dexterity: ${v>=0?"+":""}${v}`);else if(d.type==="medium"){const p=Math.min(2,v);t.push(`${d.name}: ${d.baseAC}`),t.push(`Dexterity: ${p>=0?"+":""}${p} (max +2)`)}else d.type==="heavy"&&(t.push(`${d.name}: ${d.baseAC}`),t.push("Dexterity: +0 (heavy armor)"));i.shieldEquipped&&t.push("Shield: +2")}else{t.push("Base: 10"),v!==0&&t.push(`Dexterity: ${v>=0?"+":""}${v}`);const p=10+v,m=i.armorClass-p;m!==0&&t.push(`Other: ${m>=0?"+":""}${m}`)}return i.activeStates&&i.activeStates.length>0&&i.activeStates.forEach(p=>{typeof p.acBonus=="number"&&p.acBonus!==0&&(!p.target||p.target==="self")&&t.push(`${p.name}: ${p.acBonus>=0?"+":""}${p.acBonus}`)}),t.join(`
`)}function Ll(i,o){const t=[],v=Ma(o.dexterity);t.push(`Dexterity: ${v>=0?"+":""}${v}`);const d=i.initiative-v;return d!==0&&t.push(`Other Bonuses: ${d>=0?"+":""}${d}`),t.join(`
`)}function jl(i,o){if(!i.class)return"";const t=ia(i.class);if(!t||!t.spellcaster||!t.spellcastingAbility)return"";const v=[],d=Ma(o[t.spellcastingAbility]),p=t.spellcastingAbility.charAt(0).toUpperCase()+t.spellcastingAbility.slice(1);return v.push("Base: 8"),v.push(`Proficiency: +${i.proficiencyBonus}`),v.push(`${p}: ${d>=0?"+":""}${d}`),v.join(`
`)}function Al(i,o,t){const v=[];let d=i;const p=o.toLowerCase().trim();if(t.activeStates){for(const m of t.activeStates)if(m.immunities&&m.immunities.length>0&&m.immunities.some(h=>h.toLowerCase().trim()===p))return v.push(`Immune to ${o} (${m.name})`),{finalDamage:0,adjustments:v}}if(t.activeStates){for(const m of t.activeStates)if(m.resistances&&m.resistances.length>0&&m.resistances.some(h=>h.toLowerCase().trim()===p)){const h=Math.floor(d/2);v.push(`Resistant to ${o} (${m.name}): ${d} ‚Üí ${h}`),d=h;break}}return v.length===0&&v.push(`No adjustments for ${o}`),{finalDamage:d,adjustments:v}}function Bl(i,o){const t={...i};if(t.tempHP>0){if(o<=t.tempHP)return t.tempHP-=o,t;o-=t.tempHP,t.tempHP=0}return t.currentHP=Math.max(0,t.currentHP-o),t}var Rl=f('<button class="info-icon svelte-1o8ci7b" type="button">‚ÑπÔ∏è</button>'),Ml=f('<button class="info-icon svelte-1o8ci7b" type="button">‚ÑπÔ∏è</button>'),Tl=f("<div><!></div>"),Fl=f('<div class="tooltip-wrapper svelte-1o8ci7b"><!> <!></div>');function Qa(i,o){Kt(o,!1);let t=wt(o,"tooltipContent",8),v=wt(o,"ariaLabel",8,"Show information"),d=$(!1),p=$(),m=$(!1),D=$(null),h=$(!1),y=$(!1),V=$("");const M=Math.random().toString(36).slice(2);function ne(){window.dispatchEvent(new CustomEvent("tooltip-open",{detail:M}))}function J(R){R.detail!==M&&(r(d,!1),r(h,!1))}function ae(){r(m,window.matchMedia("(pointer: coarse)").matches||"ontouchstart"in window)}function se(){if(!e(D)||!e(p))return;const R=e(p).getBoundingClientRect(),T=e(D).getBoundingClientRect();let x=R.bottom+5,W=R.left;r(h,!1),W+T.width>window.innerWidth-8&&(W=R.right-T.width,r(h,!0),W<8&&(W=8)),W<8&&(W=8),x+T.height>window.innerHeight-8&&(x=R.top-T.height-5),r(V,`position:fixed;top:${x}px;left:${W}px;z-index:1000;`),r(y,!0)}function F(){ne(),r(d,!1),r(y,!1),requestAnimationFrame(()=>{r(d,!0),r(y,!1),setTimeout(se,0)})}function I(){r(d,!1),r(h,!1)}function pe(R){R.stopPropagation(),e(d)?(r(d,!1),r(h,!1),r(y,!1)):(ne(),r(d,!1),r(y,!1),requestAnimationFrame(()=>{r(d,!0),r(y,!1),setTimeout(se,0)}))}function Ie(R){e(p)&&!e(p).contains(R.target)&&(r(d,!1),r(h,!1))}Sa(()=>{ae(),document.addEventListener("click",Ie),window.addEventListener("tooltip-open",J)}),Ms(()=>{document.removeEventListener("click",Ie),window.removeEventListener("tooltip-open",J)}),zt();var Ze=Fl(),Y=l(Ze);{var He=R=>{var T=Rl();C(()=>it(T,"aria-label",v())),L("click",T,pe),c(R,T)},ye=R=>{var T=Ml();C(()=>it(T,"aria-label",v())),L("mouseenter",T,F),L("mouseleave",T,I),c(R,T)};b(Y,R=>{e(m)?R(He):R(ye,!1)})}var $e=a(Y,2);{var Pe=R=>{var T=Tl(),x=l(T);nl(x,o,"content",{},W=>{var g=bt(),A=je(g);il(A,t),c(W,g)}),s(T),Ba(T,W=>r(D,W),()=>e(D)),C(()=>{Bt(T,1,`tooltip-popup ${e(h)?"right-align":""}`,"svelte-1o8ci7b"),rl(T,e(y)?e(V)+"opacity:1;pointer-events:auto;":"opacity:0;pointer-events:none;position:fixed;top:0;left:0;z-index:1000;")}),c(R,T)};b($e,R=>{e(d)&&R(Pe)})}s(Ze),Ba(Ze,R=>r(p,R),()=>e(p)),c(i,Ze),Vt()}var Pl=f("<option> </option>"),Il=f('<div class="armor-config svelte-1r5hyyb"><h4 class="svelte-1r5hyyb">Armor Configuration</h4> <div class="armor-controls svelte-1r5hyyb"><div class="armor-field svelte-1r5hyyb"><label for="armorName" class="svelte-1r5hyyb">Armor</label> <select id="armorName" class="armor-select svelte-1r5hyyb"><option>None (Unarmored)</option><!></select></div> <div class="armor-field svelte-1r5hyyb"><label class="shield-label svelte-1r5hyyb"><input type="checkbox" class="shield-checkbox svelte-1r5hyyb"/> Shield Equipped (+2 AC)</label></div></div></div>'),El=f('<div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="spellSaveDC" class="svelte-1r5hyyb">Spell Save DC</label> <!></div> <input type="number" id="spellSaveDC" class="stat-input svelte-1r5hyyb" readonly=""/></div>'),Hl=f('<span class="hit-dice-type"> </span>'),Ul=f('<!> <div class="stats-grid svelte-1r5hyyb"><div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="armorClass" class="svelte-1r5hyyb">Armor Class</label> <!></div> <input type="text" id="armorClass" readonly=""/></div> <div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="initiative" class="svelte-1r5hyyb">Initiative</label> <!></div> <input type="text" id="initiative" class="stat-input svelte-1r5hyyb" readonly=""/></div> <div class="stat-box svelte-1r5hyyb"><label for="speed" class="svelte-1r5hyyb">Speed</label> <input type="text" id="speed" class="stat-input svelte-1r5hyyb"/></div> <!></div> <div class="hp-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Points</h3> <div><div class="hp-inputs svelte-1r5hyyb"><input type="number" class="hp-current svelte-1r5hyyb" min="0"/> <span class="hp-separator svelte-1r5hyyb">/</span> <input type="number" class="hp-max svelte-1r5hyyb" min="0"/></div> <div class="hp-controls svelte-1r5hyyb"><button class="hp-btn svelte-1r5hyyb">‚àí</button> <button class="hp-btn svelte-1r5hyyb">+</button> <button class="hp-btn svelte-1r5hyyb">‚àí5</button> <button class="hp-btn svelte-1r5hyyb">+5</button></div></div> <div class="temp-hp svelte-1r5hyyb"><label for="tempHP" class="svelte-1r5hyyb">Temp HP</label> <input type="number" id="tempHP" min="0" class="svelte-1r5hyyb"/></div></div> <div class="hit-dice-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Dice</h3> <div class="hit-dice-display svelte-1r5hyyb"><input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <span>/</span> <input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <!></div> <div class="hit-dice-controls svelte-1r5hyyb"><label for="hitDiceCount" class="svelte-1r5hyyb">Roll</label> <div class="hit-dice-count-controls svelte-1r5hyyb"><button class="hit-dice-btn svelte-1r5hyyb">‚àí</button> <input type="number" id="hitDiceCount" class="hit-dice-count-input svelte-1r5hyyb" min="1"/> <button class="hit-dice-btn svelte-1r5hyyb">+</button></div> <button class="btn btn-primary roll-hit-dice use-enabled svelte-1r5hyyb">üé≤ Roll</button></div></div>',1),Nl=f("<section><!> <!></section>");function Ol(i,o){Kt(o,!1);const t=()=>pt(fe,"$character",D),v=()=>pt(Ga,"$abilityModifiers",D),d=()=>pt(ma,"$searchFilter",D),p=()=>pt(Qt,"$collapsedStates",D),m=()=>pt(ba,"$isEditMode",D),[D,h]=ca(),y=$(),V=$(),M=$(),ne=$(),J=$(),ae=$(),se=$(),F=ha();let I=$(1);function pe(R){fe.update(T=>(T.currentHP=Math.max(0,Math.min(T.maxHP,T.currentHP+R)),T))}function Ie(R){const T=e(I)+R,x=t().hitDice.current;r(I,Math.max(1,Math.min(x,T)))}function Ze(R=1){if(t().hitDice.current<=0){alert("No hit dice remaining!");return}if(!t().class){alert("Please select a class first!");return}const T=ia(t().class);if(!T){alert("Invalid class configuration!");return}const x=Math.min(R,t().hitDice.current),W=T.hitDice,g=v().constitution,A=g*x,Z=A>=0?`+${A}`:`${A}`,Ue=`${x}${W}${Z}`,Be=[];if(Be.push({value:`${x}${W}`,source:"hit dice"}),g!==0)for(let re=0;re<x;re++)Be.push({value:g,source:"constitution"});F("rollHitDice",{notation:Ue,hitDie:W,count:x,bonusBreakdown:Be})}nt(()=>(t(),v(),fe),()=>{if(t().armorName!==void 0||t().shieldEquipped!==void 0){const R=v().dexterity,T=Cl(t().armorName,R,t().shieldEquipped||!1);t().armorClass!==T&&fe.update(x=>({...x,armorClass:T}))}}),nt(()=>(v(),t(),fe),()=>{const R=v().dexterity;t().initiative!==R&&fe.update(T=>({...T,initiative:R}))}),nt(()=>t(),()=>{r(y,ls(t(),t().abilities))}),nt(()=>t(),()=>{r(V,Dl(t(),t().abilities))}),nt(()=>t(),()=>{r(M,Ll(t(),t().abilities))}),nt(()=>t(),()=>{r(ne,jl(t(),t().abilities))}),nt(()=>(t(),e(I)),()=>{const R=t().hitDice.current;R>0&&e(I)>R&&r(I,R)}),nt(()=>t(),()=>{r(J,t().activeStates&&t().activeStates.length>0?t().activeStates.reduce((R,T)=>R+(T.acBonus||0),0):0)}),nt(()=>t(),()=>{r(ae,t().activeStates&&t().activeStates.length>0?t().activeStates.some(R=>R.name==="Aid"&&R.target==="self"):!1)}),nt(()=>d(),()=>{r(se,!d()||"armor class".includes(d().toLowerCase())||"initiative".includes(d().toLowerCase())||"speed".includes(d().toLowerCase())||"hit points".includes(d().toLowerCase())||"hp".includes(d().toLowerCase())||"hit dice".includes(d().toLowerCase())||"spell save".includes(d().toLowerCase())||"combat".includes(d().toLowerCase()))}),ua(),zt();var Y=Nl();let He;var ye=l(Y);{let R=yt(()=>(p(),n(()=>p().combatStats?"Expand":"Collapse")));_a(ye,{title:"Combat Stats",get collapsed(){return p(),n(()=>p().combatStats)},get ariaLabel(){return e(R)},onToggle:()=>Qt.update(T=>({...T,combatStats:!T.combatStats}))})}var $e=a(ye,2);{var Pe=R=>{var T=Ul(),x=je(T);{var W=le=>{var Ee=Il(),_e=a(l(Ee),2),We=l(_e),Qe=a(l(We),2);C(()=>{t(),Et(()=>{})});var et=l(Qe);et.value=(et.__value=void 0)??"";var dt=a(et);$t(dt,1,()=>Ls,Dt,(q,z)=>{var ke=bt(),Je=je(ke);{var tt=Ge=>{var ze=Pl(),ve=l(ze);s(ze);var E={};C(()=>{S(ve,`${e(z),n(()=>e(z).name)??""} (AC ${e(z),n(()=>e(z).baseAC)??""})`),E!==(E=(e(z),n(()=>e(z).name)))&&(ze.value=(ze.__value=(e(z),n(()=>e(z).name)))??"")}),c(Ge,ze)};b(Je,Ge=>{e(z),n(()=>e(z).name!=="Unarmored")&&Ge(tt)})}c(q,ke)}),s(Qe),s(We);var ue=a(We,2),_=l(ue),K=l(_);Ce(K),Yt(),s(_),s(ue),s(_e),s(Ee),Ra(Qe,()=>t().armorName,q=>Ft(fe,n(t).armorName=q,n(t))),ka(K,()=>t().shieldEquipped,q=>Ft(fe,n(t).shieldEquipped=q,n(t))),c(le,Ee)};b(x,le=>{m()&&le(W)})}var g=a(x,2),A=l(g),Z=l(A),Ue=a(l(Z),2);Qa(Ue,{get tooltipContent(){return e(V)},ariaLabel:"Show AC breakdown"}),s(Z);var Be=a(Z,2);Ce(Be),s(A);var re=a(A,2),be=l(re),Oe=a(l(be),2);Qa(Oe,{get tooltipContent(){return e(M)},ariaLabel:"Show Initiative breakdown"}),s(be);var Ve=a(be,2);Ce(Ve),s(re);var ut=a(re,2),mt=a(l(ut),2);Ce(mt),s(ut);var gt=a(ut,2);{var rt=le=>{var Ee=El(),_e=l(Ee),We=a(l(_e),2);Qa(We,{get tooltipContent(){return e(ne)},ariaLabel:"Show Spell Save DC breakdown"}),s(_e);var Qe=a(_e,2);Ce(Qe),s(Ee),C(()=>Aa(Qe,e(y))),c(le,Ee)};b(gt,le=>{e(y)!==null&&le(rt)})}s(g);var k=a(g,2),P=a(l(k),2);let de;var N=l(P),w=l(N);Ce(w);var G=a(w,4);Ce(G),s(N);var oe=a(N,2),me=l(oe),ee=a(me,2),he=a(ee,2),ie=a(he,2);s(oe),s(P);var ce=a(P,2),B=a(l(ce),2);Ce(B),s(ce),s(k);var qe=a(k,2),Re=a(l(qe),2),Ye=l(Re);Ce(Ye);var Se=a(Ye,4);Ce(Se);var u=a(Se,2);{var xe=le=>{const Ee=yt(()=>(O(ia),t(),n(()=>ia(t().class))));var _e=bt(),We=je(_e);{var Qe=et=>{const dt=yt(()=>(v(),n(()=>v().constitution)));var ue=Hl(),_=l(ue);s(ue),C(()=>S(_,`(${O(e(Ee)),n(()=>e(Ee).hitDice)??""}${(e(dt)>=0?`+${e(dt)}`:e(dt))??""})`)),c(et,ue)};b(We,et=>{e(Ee)&&et(Qe)})}c(le,_e)};b(u,le=>{t(),n(()=>t().class)&&le(xe)})}s(Re);var ge=a(Re,2),U=a(l(ge),2),De=l(U),Me=a(De,2);Ce(Me);var we=a(Me,2);s(U);var Le=a(U,2);s(ge),s(qe),C(()=>{Aa(Be,(e(J),t(),n(()=>e(J)!==0?`${t().armorClass} ‚Üí ${t().armorClass+e(J)}`:`${t().armorClass}`))),Bt(Be,1,Xs(e(J)!==0?"stat-input ac-enhanced":"stat-input"),"svelte-1r5hyyb"),Aa(Ve,(t(),n(()=>t().initiative))),de=Bt(P,1,"hp-display svelte-1r5hyyb",null,de,{"aid-active":e(ae)}),it(w,"max",(t(),n(()=>t().maxHP))),it(Ye,"max",(t(),n(()=>t().hitDice.max))),De.disabled=e(I)<=1,it(Me,"max",(t(),n(()=>t().hitDice.current))),we.disabled=(e(I),t(),n(()=>e(I)>=t().hitDice.current)),Le.disabled=(t(),n(()=>t().hitDice.current<=0||!t().class))}),Ne(mt,()=>t().speed,le=>Ft(fe,n(t).speed=le,n(t))),Ne(w,()=>t().currentHP,le=>Ft(fe,n(t).currentHP=le,n(t))),Ne(G,()=>t().maxHP,le=>Ft(fe,n(t).maxHP=le,n(t))),L("click",me,()=>pe(-1)),L("click",ee,()=>pe(1)),L("click",he,()=>pe(-5)),L("click",ie,()=>pe(5)),Ne(B,()=>t().tempHP,le=>Ft(fe,n(t).tempHP=le,n(t))),Ne(Ye,()=>t().hitDice.current,le=>Ft(fe,n(t).hitDice.current=le,n(t))),Ne(Se,()=>t().hitDice.max,le=>Ft(fe,n(t).hitDice.max=le,n(t))),L("click",De,()=>Ie(-1)),Ne(Me,()=>e(I),le=>r(I,le)),L("input",Me,le=>{const Ee=le.target,_e=parseInt(Ee.value);_e>t().hitDice.current&&r(I,t().hitDice.current),_e<1&&r(I,1)}),L("click",we,()=>Ie(1)),L("click",Le,()=>Ze(e(I))),c(R,T)};b($e,R=>{p(),n(()=>!p().combatStats)&&R(Pe)})}s(Y),C(()=>He=Bt(Y,1,"combat-stats svelte-1r5hyyb",null,He,{hidden:!e(se)})),c(i,Y),Vt(),h()}const Ia={acrobatics:"dexterity",animalHandling:"wisdom",arcana:"intelligence",athletics:"strength",deception:"charisma",history:"intelligence",insight:"wisdom",intimidation:"charisma",investigation:"intelligence",medicine:"wisdom",nature:"intelligence",perception:"wisdom",performance:"charisma",persuasion:"charisma",religion:"intelligence",sleightOfHand:"dexterity",stealth:"dexterity",survival:"wisdom"};var Gl=f('<div class="skill-row svelte-1f1pl16"><input type="checkbox" class="svelte-1f1pl16"/> <label class="svelte-1f1pl16"> <span class="ability-tag svelte-1f1pl16"> </span></label> <span class="skill-modifier svelte-1f1pl16"> </span> <button class="roll-btn svelte-1f1pl16">Roll</button></div>'),ql=f('<div class="skills-grid svelte-1f1pl16"></div>'),Wl=f("<section><!> <!></section>");function zl(i,o){Kt(o,!1);const t=()=>pt(fe,"$character",D),v=()=>pt(Ga,"$abilityModifiers",D),d=()=>pt(ma,"$searchFilter",D),p=()=>pt(Qt,"$collapsedStates",D),m=()=>pt(ba,"$isEditMode",D),[D,h]=ca(),y=$(),V=$(),M=$(),ne=$(),J=$(),ae=$(),se=ha(),F=[{key:"acrobatics",label:"Acrobatics"},{key:"animalHandling",label:"Animal Handling"},{key:"arcana",label:"Arcana"},{key:"athletics",label:"Athletics"},{key:"deception",label:"Deception"},{key:"history",label:"History"},{key:"insight",label:"Insight"},{key:"intimidation",label:"Intimidation"},{key:"investigation",label:"Investigation"},{key:"medicine",label:"Medicine"},{key:"nature",label:"Nature"},{key:"perception",label:"Perception"},{key:"performance",label:"Performance"},{key:"persuasion",label:"Persuasion"},{key:"religion",label:"Religion"},{key:"sleightOfHand",label:"Sleight of Hand"},{key:"stealth",label:"Stealth"},{key:"survival",label:"Survival"}];function I(ye){const $e=Ia[ye],Pe=v()[$e],R=t().skillProficiencies[ye]?t().proficiencyBonus:0,T=e(y)[ye],x=`1d20${T>=0?"+":""}${T}`,W=[];W.push({value:"1d20",source:"base die"}),Pe!==0&&W.push({value:Pe,source:$e}),R!==0&&W.push({value:R,source:"proficiency"}),se("roll",{notation:x,rollType:"check",bonusBreakdown:W})}nt(()=>{},()=>{r(y,{})}),nt(()=>t(),()=>{r(V,t().skillProficiencies)}),nt(()=>t(),()=>{r(M,t().proficiencyBonus)}),nt(()=>v(),()=>{r(ne,v())}),nt(()=>(e(ne),e(V),e(M)),()=>{for(const{key:ye}of F){const $e=Ia[ye],Pe=e(ne)[$e],R=e(V)[ye]?e(M):0;pa(y,e(y)[ye]=Pe+R)}}),nt(()=>d(),()=>{r(J,F.filter(({label:ye})=>d()?ye.toLowerCase().includes(d().toLowerCase()):!0))}),nt(()=>e(J),()=>{r(ae,e(J).length>0)}),ua(),zt();var pe=Wl();let Ie;var Ze=l(pe);{let ye=yt(()=>(p(),n(()=>p().skills?"Expand":"Collapse")));_a(Ze,{title:"Skills",get collapsed(){return p(),n(()=>p().skills)},get ariaLabel(){return e(ye)},onToggle:()=>Qt.update($e=>({...$e,skills:!$e.skills}))})}var Y=a(Ze,2);{var He=ye=>{var $e=ql();$t($e,5,()=>e(J),Dt,(Pe,R)=>{let T=()=>e(R).key,x=()=>e(R).label;var W=Gl(),g=l(W);Ce(g);var A=a(g,2),Z=l(A),Ue=a(Z),Be=l(Ue);s(Ue),s(A);var re=a(A,2),be=l(re);s(re);var Oe=a(re,2);s(W),C(Ve=>{Cs(g,(e(V),T(),n(()=>e(V)[T()]))),g.disabled=!m(),it(g,"id",T()),it(A,"for",T()),S(Z,`${x()??""} `),S(Be,`(${Ve??""})`),S(be,`${e(y),T(),n(()=>e(y)[T()]>=0?"+":"")??""}${e(y),T(),n(()=>e(y)[T()])??""}`)},[()=>(O(Ia),T(),n(()=>Ia[T()].substring(0,3).toUpperCase()))]),L("change",g,Ve=>{console.log("Skill proficiency changed:",T(),Ve.target.checked),fe.update(ut=>({...ut,skillProficiencies:{...ut.skillProficiencies,[T()]:Ve.target.checked}}))}),L("click",Oe,()=>I(T())),c(Pe,W)}),s($e),c(ye,$e)};b(Y,ye=>{p(),n(()=>!p().skills)&&ye(He)})}s(pe),C(()=>Ie=Bt(pe,1,"skills svelte-1f1pl16",null,Ie,{hidden:!e(ae)})),c(i,pe),Vt(),h()}var Kl=f('<p class="empty-message svelte-1123ljy">No attacks or spells to reorder.</p>'),Vl=f('<li class="reorder-item svelte-1123ljy"><span class="attack-name svelte-1123ljy"> </span> <div class="reorder-buttons svelte-1123ljy"><button class="btn-move svelte-1123ljy" aria-label="Move up">‚ñ≤</button> <button class="btn-move svelte-1123ljy" aria-label="Move down">‚ñº</button></div></li>'),Jl=f('<ul class="reorder-list svelte-1123ljy"></ul>'),Yl=f('<div class="modal-backdrop svelte-1123ljy" role="presentation"><div class="modal-content svelte-1123ljy" role="dialog" aria-modal="true" aria-labelledby="modal-title"><div class="modal-header svelte-1123ljy"><h3 id="modal-title" class="svelte-1123ljy">Reorder Attacks & Spells</h3> <button class="btn-close svelte-1123ljy" aria-label="Close">√ó</button></div> <div class="modal-body svelte-1123ljy"><!></div> <div class="modal-footer svelte-1123ljy"><button class="btn btn-secondary svelte-1123ljy">Cancel</button> <button class="btn btn-primary svelte-1123ljy">Save Order</button></div></div></div>');function Ql(i,o){Kt(o,!1);let t=wt(o,"show",8,!1),v=wt(o,"attacks",24,()=>[]),d=wt(o,"onSave",8),p=wt(o,"onCancel",8),m=$([]);function D(F,I){const pe=e(m)[F];pa(m,e(m)[F]=e(m)[I]),pa(m,e(m)[I]=pe),r(m,[...e(m)])}function h(F){F>0&&D(F,F-1)}function y(F){F<e(m).length-1&&D(F,F+1)}function V(){d()(e(m))}function M(){p()()}function ne(F){F.target===F.currentTarget&&M()}nt(()=>(O(t()),O(v())),()=>{t()&&r(m,[...v()])}),ua(),zt();var J=bt(),ae=je(J);{var se=F=>{var I=Yl(),pe=l(I),Ie=l(pe),Ze=a(l(Ie),2);s(Ie);var Y=a(Ie,2),He=l(Y);{var ye=x=>{var W=Kl();c(x,W)},$e=x=>{var W=Jl();$t(W,7,()=>e(m),g=>g.id,(g,A,Z)=>{var Ue=Vl(),Be=l(Ue),re=l(Be,!0);s(Be);var be=a(Be,2),Oe=l(be),Ve=a(Oe,2);s(be),s(Ue),C(()=>{S(re,(e(A),n(()=>e(A).name||"(Unnamed attack or spell)"))),Oe.disabled=e(Z)===0,Ve.disabled=(O(e(Z)),e(m),n(()=>e(Z)===e(m).length-1))}),L("click",Oe,()=>h(e(Z))),L("click",Ve,()=>y(e(Z))),c(g,Ue)}),s(W),c(x,W)};b(He,x=>{e(m),n(()=>e(m).length===0)?x(ye):x($e,!1)})}s(Y);var Pe=a(Y,2),R=l(Pe),T=a(R,2);s(Pe),s(pe),s(I),L("click",Ze,M),L("click",R,M),L("click",T,V),L("click",I,ne),c(F,I)};b(ae,F=>{t()&&F(se)})}c(i,J),Vt()}let Ea=null,Ha=null;async function As(){if(Ea)return Ea;try{return Ea=await(await fetch(Ds("/data/spells.json"))).json(),Ea||[]}catch(i){return console.error("Failed to load spells:",i),[]}}async function Xl(){if(Ha)return Ha;try{return Ha=await(await fetch(Ds("/data/feats.json"))).json(),Ha||[]}catch(i){return console.error("Failed to load feats:",i),[]}}function bs(i,o){if(!o.trim())return i;const t=o.toLowerCase();return i.filter(v=>v.name.toLowerCase().includes(t)||v.school.toLowerCase().includes(t)||v.classes.some(d=>d.toLowerCase().includes(t))||v.description.toLowerCase().includes(t))}function Zl(i,o){return o===null?i:i.filter(t=>t.level===o)}function ei(i,o){if(!o.trim())return i;const t=o.toLowerCase();return i.filter(v=>v.name.toLowerCase().includes(t)||v.description.toLowerCase().includes(t))}function Ua(i){const o=i.description,t=/\b(Strength|Dexterity|Constitution|Intelligence|Wisdom|Charisma)\s+saving\s+throw/i,v=o.match(t);if(!v)return null;const d=v[1].toLowerCase(),m=/half\s+(?:as\s+much\s+)?damage\s+on\s+a\s+successful(?:\s+save)?/i.test(o),h=/saving\s+throw\s+or\s+take.*?damage/i.test(o)&&!m;return{ability:d,halfDamageOnSave:m,noDamageOnSave:h}}function ti(i){const o=i.description;return/(plus|add)\s+your\s+spellcasting\s+(ability\s+)?modifier/i.test(o)}function Xa(i){const o=i.description.toLowerCase();return o.includes("ranged spell attack")||o.includes("melee spell attack")}function hs(i){const o=i.description.toLowerCase();if(["Divine Favor","Bless","Aid","Command"].includes(i.name))return!0;const d=["takes","take","deals","deal","damage equal to","force damage","fire damage","cold damage","lightning damage","thunder damage","acid damage","poison damage","necrotic damage","radiant damage","psychic damage","regain","regains","hit point"].some(D=>o.includes(D));return["bonus to attack","bonus to damage","bonus to ac","gains a +","gain a +","+1 bonus","+2 bonus","+3 bonus","advantage on","becomes a magic weapon"].some(D=>o.includes(D))&&!d}function ai(i){const o=i.description;let t=0,v=0,d=0,p="";const m=o.match(/\+(\d+)\s+bonus\s+to\s+attack\s+rolls\s+and\s+damage\s+rolls/i);if(m){const h=parseInt(m[1]);t=h,v=h,p=`+${h} to attack and damage rolls`}if(i.name==="Bless"&&(p="Add 1d4 to attack rolls and saves",t="1d4"),i.name==="Aid")return p="+5 HP (max and current) for 8 hours",{attackBonus:0,damageBonus:0,acBonus:0,hpBonus:5,description:p,name:i.name};i.name==="Divine Favor"&&(p="Your weapon attacks deal an extra 1d4 radiant damage on a hit.",v="1d4");const D=o.match(/\+(\d+)\s+bonus\s+to\s+AC/i);return D&&(d=parseInt(D[1]),p=`+${d} to AC`),i.name==="Haste"&&(p="+2 AC, doubled speed, extra action",d=2),p||t!==0||v!==0||d!==0?{attackBonus:t,damageBonus:v,acBonus:d,description:p||i.description.substring(0,100),name:i.name}:null}function Za(i){const o=i.description,t=/takes?\s+(\d+d\d+)\s+\w+\s+damage[^.]*\.\s*If\s+the\s+target\s+is\s+missing.*?instead\s+takes?\s+(\d+d\d+)/is,v=o.match(t);return v?{baseDamage:v[1],alternateDamage:v[2]}:null}var si=f('<button class="btn btn-secondary">Reorder</button>'),li=f('<div class="edit-buttons svelte-14o91c5"><button class="btn btn-secondary">Add Attack</button> <!></div>'),ii=f('<input type="text" placeholder="Attack name" class="attack-name svelte-14o91c5"/>'),ni=f('<h4 class="attack-name-display svelte-14o91c5"> </h4>'),ri=f('<button class="btn-remove svelte-14o91c5">√ó</button>'),oi=f('<div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Bonus</label> <input type="number" class="attack-bonus svelte-14o91c5"/></div>'),ci=f('<div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Damage</label> <input type="text" placeholder="e.g., 2d6+3" class="attack-damage svelte-14o91c5"/></div>'),vi=f('<div class="spell-info-loading svelte-14o91c5">Loading spell info...</div>'),di=f('<li class="svelte-14o91c5"><strong>At Higher Levels:</strong> </li>'),ui=f('<ul class="svelte-14o91c5"><li class="svelte-14o91c5"><strong>Level:</strong> </li> <li class="svelte-14o91c5"><strong>Casting Time:</strong> </li> <li class="svelte-14o91c5"><strong>Range:</strong> </li> <li class="svelte-14o91c5"><strong>Components:</strong> <!></li> <li class="svelte-14o91c5"><strong>Duration:</strong> <!> </li> <li class="svelte-14o91c5"><strong>Description:</strong> </li> <!></ul>'),fi=f('<span class="scaled-damage svelte-14o91c5" style="margin-left: 8px;"> </span>'),pi=f('<span class="scaled-damage svelte-14o91c5">(Half damage)</span>'),mi=f('<span class="scaled-damage svelte-14o91c5">(No damage)</span>'),gi=f('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> <!> <!></label></div>'),bi=f('<span class="scaled-damage svelte-14o91c5"> </span>'),hi=f('<span class="scaled-damage svelte-14o91c5"> </span>'),_i=f('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> Target is missing HP <!></label></div>'),yi=f("<option> </option>"),xi=f('<span class="scaled-damage svelte-14o91c5"><!> </span>'),ki=f('<span class="scaled-damage svelte-14o91c5"> </span>'),wi=f('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> Target is Fiend or Undead <!></label></div>'),$i=f('<div class="spell-level-selector svelte-14o91c5"><label class="svelte-14o91c5">Cast at Level:</label> <select class="spell-level-select use-enabled svelte-14o91c5"></select> <!></div> <!>',1),Si=f('<div class="spell-level-selector svelte-14o91c5"><span style="color: #dc3545; font-weight: bold;">No spell slots available!</span></div>'),Ci=f('<div class="spell-info svelte-14o91c5"><div class="spell-info-header svelte-14o91c5" role="button" tabindex="0"><h4 class="svelte-14o91c5">Spell Info</h4> <button class="collapse-btn-small svelte-14o91c5"> </button></div> <!></div> <!> <!> <!>',1),Di=f('<div class="spell-info-missing svelte-14o91c5">Spell info not found.</div>'),Li=f('<div class="attack-notes svelte-14o91c5"><label class="svelte-14o91c5">Notes</label> <textarea placeholder="e.g., DC 15 Dex save, Range 120 ft, Concentration" class="notes-input svelte-14o91c5" rows="2"></textarea></div>'),ji=f('<button class="btn btn-primary">Roll Attack</button>'),Ai=f('<div class="buff-target-selection svelte-14o91c5"><div class="target-options svelte-14o91c5"><label class="target-option svelte-14o91c5"><input type="radio" class="svelte-14o91c5"/> Self</label> <label class="target-option svelte-14o91c5"><input type="radio" class="svelte-14o91c5"/> Other</label></div> <button class="btn btn-info"> </button></div>'),Bi=f('<button class="btn btn-info">Cast Spell</button>'),Ri=f("<button><!></button>"),Mi=f('<button class="btn btn-info">Cast Spell</button>'),Ti=f('<button class="btn btn-secondary">Roll Damage</button>'),Fi=f('<button class="btn btn-primary">Roll Attack</button> <!>',1),Pi=f('<div class="attack-card svelte-14o91c5"><div class="attack-header svelte-14o91c5"><!> <!></div> <div class="attack-details svelte-14o91c5"><!> <!> <div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Type</label> <input type="text" placeholder="e.g., slashing" class="attack-type svelte-14o91c5"/></div></div> <!> <!> <div class="attack-actions svelte-14o91c5"><!></div></div>'),Ii=f('<p class="no-attacks svelte-14o91c5">No attacks added yet. Click "Add Attack" to create one.</p>'),Ei=f('<p class="no-attacks svelte-14o91c5">No attacks match your search.</p>'),Hi=f('<span class="ability-uses svelte-14o91c5"> <!></span>'),Ui=f('<span class="ability-reaction svelte-14o91c5">‚ö° Reaction</span>'),Ni=f('<button class="btn btn-ability svelte-14o91c5">Use Ability</button>'),Oi=f('<div class="ability-card svelte-14o91c5"><div class="ability-header svelte-14o91c5"><h4 class="ability-name svelte-14o91c5"> </h4> <span class="ability-source svelte-14o91c5"> </span></div> <p class="ability-description svelte-14o91c5"> </p> <div class="ability-footer svelte-14o91c5"><!> <!> <!></div></div>'),Gi=f('<div class="condition-abilities-section svelte-14o91c5"><h3 class="abilities-header svelte-14o91c5">Condition Abilities</h3> <p class="section-description svelte-14o91c5">Special actions granted by active conditions (e.g., Flicker of Deceit)</p> <div class="abilities-list svelte-14o91c5"></div></div>'),qi=f('<button class="btn-remove svelte-14o91c5">√ó</button>'),Wi=f('<div class="state-card svelte-14o91c5"><div class="state-header svelte-14o91c5"><input type="text" placeholder="Effect name (e.g., Magic Weapon)" class="state-name svelte-14o91c5"/> <!></div> <div class="state-details svelte-14o91c5"><div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Attack Bonus</label> <input type="number" class="state-bonus svelte-14o91c5"/></div> <div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Damage Bonus</label> <input type="text" class="state-bonus svelte-14o91c5"/></div> <div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Target</label> <select class="state-bonus svelte-14o91c5"><option>Self</option><option>Other</option></select></div></div> <div class="state-description svelte-14o91c5"><label class="svelte-14o91c5">Description</label> <input type="text" placeholder="e.g., +1 to attack and damage rolls (Magic Weapon)" class="state-desc-input svelte-14o91c5"/></div></div>'),zi=f('<div class="states-list svelte-14o91c5"></div>'),Ki=f('<p class="no-states svelte-14o91c5">No active effects. Add spell effects that modify your attacks.</p>'),Vi=f('<!> <div class="attacks-list svelte-14o91c5"><!> <!></div> <!> <div class="active-states-section svelte-14o91c5"><h3 class="svelte-14o91c5">Active Spell Effects</h3> <p class="section-description svelte-14o91c5">Effects that modify attack and damage rolls (e.g., Magic Weapon, Bless)</p> <button class="btn btn-secondary">Add Effect</button> <!></div>',1),Ji=f("<section><!> <!></section> <!>",1);function Yi(i,o){Kt(o,!1);const t=()=>pt(fe,"$character",m),v=()=>pt(ma,"$searchFilter",m),d=()=>pt(Qt,"$collapsedStates",m),p=()=>pt(ba,"$isEditMode",m),[m,D]=ca(),h=$(),y=$(),V=$(),M=[];function ne(k,P){fe.update(de=>{if(!de.activeStates)return de;const N=de.activeStates.findIndex(me=>me.name===k);if(N===-1)return de;const w=de.activeStates[N];if(!w.abilities)return de;const G=w.abilities.findIndex(me=>me.name===P);if(G===-1)return de;const oe=w.abilities[G];return oe.currentUses!==void 0&&oe.currentUses>0&&(oe.currentUses-=1,oe.usesPerRest!==void 0?Ht.add(`Used ${P} (${oe.currentUses}/${oe.usesPerRest} remaining)`,"info"):Ht.add(`Used ${P}`,"info")),de})}const J=ha();let ae=$({}),se=$({}),F=$(!1);function I(k){pa(ae,e(ae)[k]=!e(ae)[k]),r(ae,{...e(ae)})}function pe(k){return k.description.toLowerCase().includes("regain")&&(k.description.toLowerCase().includes("hit point")||k.description.toLowerCase().includes("hp"))}function Ie(k){return["Shield of Faith","Bless","Aid","Magic Weapon"].includes(k)}function Ze(){fe.update(k=>(k.attacks=[...k.attacks,{id:crypto.randomUUID(),name:"",bonus:0,damage:"",damageType:"",notes:""}],k))}function Y(k){fe.update(P=>(P.attacks=P.attacks.filter(de=>de.id!==k),P))}function He(){r(F,!0)}function ye(){r(F,!1)}function $e(k){fe.update(P=>(P.attacks=k,P)),r(F,!1),Ht.add("Attack order updated successfully!","success")}function Pe(k){let P=k.damage,de=!1,N=!1;if(k.spellRef){const ee=W(k.spellRef);if(ee&&(N=Xa(ee),ee.level>0)){const he=k.castAtLevel||ee.level;if(!g(he)){Ht.add(`No level ${he} spell slots available!`,"error");return}const ce=Ua(ee);ce&&k.targetSucceededSave&&ce.noDamageOnSave?P="0":(de=ce?.halfDamageOnSave&&k.targetSucceededSave||!1,P=A(k,ee))}}else if(t().activeStates&&t().activeStates.length>0){let ee=0,he=[];for(const ie of t().activeStates)ie.target!=="other"&&(typeof ie.damageBonus=="string"?he.push(ie.damageBonus):typeof ie.damageBonus=="number"&&(ee+=ie.damageBonus));if((ee!==0||he.length>0)&&P){const ie=P.match(/(\d+d\d+)([+-]\d+)?/);if(ie){const[,ce,B]=ie,Re=(B?parseInt(B):0)+ee;let Ye=`${ce}`;Re!==0&&(Ye+=`${Re>=0?"+":""}${Re}`),he.length>0&&(Ye+=" + "+he.join(" + ")),P=Ye}}}const w=[];let G=0;if(N){const ee=Ya(t(),t().abilities),he=t().proficiencyBonus||0;w.push({value:he,source:"proficiency"}),w.push({value:ee,source:"spellcasting"}),G=he+ee}else k.bonus!==0&&w.push({value:k.bonus,source:"base"}),G=k.bonus;let oe=[];if(t().activeStates)for(const ee of t().activeStates)ee.target!=="other"&&(typeof ee.attackBonus=="number"&&ee.attackBonus!==0?(w.push({value:ee.attackBonus,source:ee.name.toLowerCase()}),G+=ee.attackBonus):typeof ee.attackBonus=="string"&&ee.attackBonus&&(oe.push(ee.attackBonus),w.push({value:ee.attackBonus,source:ee.name.toLowerCase()})));let me=`1d20${G>=0?"+":""}${G}`;oe.length>0&&(me+="+"+oe.join("+")),J("roll",{notation:me,damageNotation:P,attackName:k.name,applyHalfDamage:de,bonusBreakdown:w,rollType:"attack"})}function R(k){if(!k.damage){Ht.add(`${k.name}: No damage specified`,"error");return}let P=k.damage,de=!1;const N=[];let w=k.damageType||"";if(k.spellRef){const G=W(k.spellRef);if(G){const oe=pe(G);if(oe){const me=Ya(t(),t().abilities),ee=P.match(/^(\d+d\d+)/);ee&&(P=ee[1],me>0&&(P+=`+${me}`,N.push({value:me,source:"spellcasting"}))),w="Healing"}if(G.level>0){const me=k.castAtLevel||G.level;if(!g(me)){Ht.add(`No level ${me} spell slots available!`,"error");return}const he=Ua(G);he&&k.targetSucceededSave&&he.noDamageOnSave?P="0":(de=he?.halfDamageOnSave&&k.targetSucceededSave||!1,oe||(P=A(k,G))),G.damageType&&!oe&&(w=G.damageType)}}}else{const G=P.match(/(\d+d\d+)([+-]\d+)?/);if(G){const[,oe,me]=G,ee=me?parseInt(me):0;if(ee!==0&&N.push({value:ee,source:"base"}),t().activeStates&&t().activeStates.length>0){let he=0,ie=[];for(const ce of t().activeStates)ce.target!=="other"&&(typeof ce.damageBonus=="string"?ie.push(ce.damageBonus):typeof ce.damageBonus=="number"&&ce.damageBonus!==0&&(N.push({value:ce.damageBonus,source:ce.name.toLowerCase()}),he+=ce.damageBonus));if(he!==0||ie.length>0){const ce=ee+he;let B=`${oe}`;ce!==0&&(B+=`${ce>=0?"+":""}${ce}`),ie.length>0&&(B+=" + "+ie.join(" + ")),P=B}}}}J("roll",{notation:P,attackName:k.name,applyHalfDamage:de,bonusBreakdown:N,damageType:w})}let T=$([]),x=$(!1);Sa(async()=>{r(T,await As()),r(x,!0)});function W(k){return e(T).find(P=>P.name===k)}function g(k){t().classFeatures.spellSlotsByLevel||Ft(fe,n(t).classFeatures.spellSlotsByLevel={},n(t)),t().classFeatures.spellSlotsByLevel[k]||Ft(fe,n(t).classFeatures.spellSlotsByLevel[k]=Array(2).fill(!1),n(t));const de=t().classFeatures.spellSlotsByLevel[k].findIndex(N=>!N);return de===-1?!1:(fe.update(N=>(N.classFeatures.spellSlotsByLevel||(N.classFeatures.spellSlotsByLevel={}),N.classFeatures.spellSlotsByLevel[k]||(N.classFeatures.spellSlotsByLevel[k]=Array(2).fill(!1)),N.classFeatures.spellSlotsByLevel[k][de]=!0,N)),!0)}function A(k,P){let de=k.damage,N=0,w=0;const G=Za(P);if(G&&k.targetIsDamaged&&(de=G.alternateDamage),ti(P)&&(w+=Ya(t(),t().abilities)),t().activeStates)for(const Re of t().activeStates)Re.target!=="other"&&typeof Re.damageBonus=="number"&&(w+=Re.damageBonus);if(P.higherLevelSlot&&k.castAtLevel){const Re=P.level,Se=(k.castAtLevel||Re)-Re;if(Se>0){const u=P.higherLevelSlot.match(/(\d+)d(\d+)\s+for\s+each.*?level\s+above/i);if(u){const[,xe]=u;N+=Se*parseInt(xe)}}}if(k.targetIsFiendOrUndead&&P.description.includes("Fiend or an Undead")){const Re=P.description.match(/increases by (\d+)d(\d+) if.*?Fiend or.*?Undead/i);if(Re){const[,Ye]=Re;N+=parseInt(Ye)}}const oe=de.match(/(\d+)d(\d+)([+-]\d+)?/);if(!oe)return w!==0?w>=0?`${w}`:`${w}`:de||"0";const[,me,ee,he]=oe,ie=parseInt(me)+N,B=(he?parseInt(he):0)+w;let qe=`${ie}d${ee}`;return B!==0&&(qe+=B>=0?`+${B}`:`${B}`),qe}function Z(k){const P=[];for(let N=k.level;N<=9;N++){const w=t().classFeatures.spellSlotsByLevel?.[N];w&&w.length>0&&P.push(N)}return P}function Ue(){fe.update(k=>(k.activeStates||(k.activeStates=[]),k.activeStates=[...k.activeStates,{name:"",attackBonus:0,damageBonus:0,description:"",target:"self"}],k))}function Be(k){fe.update(P=>{if(P.activeStates){const de=P.activeStates[k];de?.hpBonus&&de.target!=="other"&&(P.maxHP-=de.hpBonus,P.currentHP=Math.max(1,Math.min(P.currentHP-de.hpBonus,P.maxHP))),P.activeStates=P.activeStates.filter((N,w)=>w!==k)}return P})}function re(k,P="self"){const de=W(k.spellRef);if(!de){Ht.add("Spell not found","error");return}const N=k.castAtLevel||de.level;if(N>0&&!g(N)){Ht.add(`No level ${N} spell slots available!`,"error");return}const w=ai(de);if(!w){Ht.add(`${de.name} cast! Check spell description for effects.`,"info");return}let G=w.hpBonus||0,oe=w.description;de.name==="Aid"&&N>de.level&&(G=5+(N-de.level)*5,oe=`+${G} HP (max and current) for 8 hours`);const ee=["Shield of Faith","Bless","Aid","Magic Weapon"].includes(de.name);fe.update(ie=>{ie.activeStates||(ie.activeStates=[]);const ce=ie.activeStates.find(B=>B.name===de.name);return ce&&ce.hpBonus&&ce.target!=="other"&&(ie.maxHP-=ce.hpBonus,ie.currentHP=Math.max(1,Math.min(ie.currentHP-ce.hpBonus,ie.maxHP))),ie.activeStates=ie.activeStates.filter(B=>B.name!==de.name),G>0&&P==="self"&&(ie.maxHP+=G,ie.currentHP+=G),ie.activeStates=[...ie.activeStates,{name:de.name,attackBonus:w.attackBonus,damageBonus:w.damageBonus,acBonus:w.acBonus,description:oe,target:P,hpBonus:G}],ie});const he=P==="self"?" on self":" on other";Ht.add(`${de.name} cast${ee?he:""}! Effect added to Active Spell Effects.`,"success")}nt(()=>t(),()=>{r(h,t().activeStates?t().activeStates.filter(k=>k.abilities&&k.abilities.length>0).flatMap(k=>k.abilities.map(P=>({...P,conditionName:k.name}))):[])}),nt(()=>(t(),e(ae),e(se)),()=>{if(t()&&t().attacks)for(const k of t().attacks)k.spellRef&&e(ae)[k.id]===void 0&&pa(ae,e(ae)[k.id]=!0),k.spellRef&&e(se)[k.id]===void 0&&pa(se,e(se)[k.id]="self")}),nt(()=>(t(),v()),()=>{r(y,t().attacks.filter(k=>{if(!v())return!0;const P=v().toLowerCase();return k.name.toLowerCase().includes(P)||k.damageType.toLowerCase().includes(P)}).sort((k,P)=>!k.spellRef&&P.spellRef?-1:k.spellRef&&!P.spellRef?1:0))}),nt(()=>(v(),e(y)),()=>{r(V,!v()||e(y).length>0||"attack".includes(v().toLowerCase())||"spell".includes(v().toLowerCase()))}),ua(),zt();var be=Ji(),Oe=je(be);let Ve;var ut=l(Oe);{let k=yt(()=>(d(),n(()=>d().attacks?"Expand":"Collapse")));_a(ut,{title:"Attacks & Spells",get collapsed(){return d(),n(()=>d().attacks)},get ariaLabel(){return e(k)},onToggle:()=>Qt.update(P=>({...P,attacks:!P.attacks}))})}var mt=a(ut,2);{var gt=k=>{var P=Vi(),de=je(P);{var N=Se=>{var u=li(),xe=l(u),ge=a(xe,2);{var U=De=>{var Me=si();L("click",Me,He),c(De,Me)};b(ge,De=>{t(),n(()=>t().attacks.length>0)&&De(U)})}s(u),L("click",xe,Ze),c(Se,u)};b(de,Se=>{p()&&Se(N)})}var w=a(de,2),G=l(w);$t(G,1,()=>e(y),Se=>Se.id,(Se,u,xe)=>{var ge=Pi(),U=l(ge),De=l(U);{var Me=ve=>{var E=ii();Ce(E),Ne(E,()=>e(u).name,Te=>(e(u).name=Te,Et(()=>(e(y),t(),v())))),c(ve,E)},we=ve=>{var E=ni(),Te=l(E,!0);s(E),C(()=>S(Te,(e(u),n(()=>e(u).name||"(Unnamed Attack)")))),c(ve,E)};b(De,ve=>{p()?ve(Me):ve(we,!1)})}var Le=a(De,2);{var le=ve=>{var E=ri();L("click",E,()=>Y(e(u).id)),c(ve,E)};b(Le,ve=>{p()&&ve(le)})}s(U);var Ee=a(U,2),_e=l(Ee);{var We=ve=>{var E=oi(),Te=l(E),ot=a(Te,2);Ce(ot),s(E),C(()=>{it(Te,"for",`attack-bonus-${e(u),n(()=>e(u).id)??""}`),it(ot,"id",`attack-bonus-${e(u),n(()=>e(u).id)??""}`)}),Ne(ot,()=>e(u).bonus,Xe=>(e(u).bonus=Xe,Et(()=>(e(y),t(),v())))),c(ve,E)};b(_e,ve=>{e(u),n(()=>e(u).bonus!==0&&e(u).bonus!==void 0)&&ve(We)})}var Qe=a(_e,2);{var et=ve=>{var E=ci(),Te=l(E),ot=a(Te,2);Ce(ot),s(E),C(()=>{it(Te,"for",`attack-damage-${e(u),n(()=>e(u).id)??""}`),it(ot,"id",`attack-damage-${e(u),n(()=>e(u).id)??""}`)}),Ne(ot,()=>e(u).damage,Xe=>(e(u).damage=Xe,Et(()=>(e(y),t(),v())))),c(ve,E)};b(Qe,ve=>{e(u),n(()=>e(u).damage&&e(u).damage.trim()!=="")&&ve(et)})}var dt=a(Qe,2),ue=l(dt),_=a(ue,2);Ce(_),s(dt),s(Ee);var K=a(Ee,2);{var q=ve=>{var E=bt(),Te=je(E);{var ot=ct=>{var te=vi();c(ct,te)},Xe=ct=>{const te=yt(()=>(e(u),n(()=>W(e(u).spellRef))));var j=bt(),Ke=je(j);{var H=X=>{const at=yt(()=>(O(Ua),O(e(te)),n(()=>Ua(e(te))))),Fe=yt(()=>(O(Za),O(e(te)),n(()=>Za(e(te)))));var _t=Ci(),Ae=je(_t),lt=l(Ae),St=a(l(lt),2),Ut=l(St,!0);s(St),s(lt);var Lt=a(lt,2);{var ft=jt=>{var Mt=ui(),Nt=l(Mt),sa=a(l(Nt));s(Nt);var na=a(Nt,2),va=a(l(na));s(na);var Jt=a(na,2),Pt=a(l(Jt));s(Jt);var qt=a(Jt,2),Zt=a(l(qt)),Ct=a(Zt);{var vt=It=>{var Gt=At();C(()=>S(Gt,`(${O(e(te)),n(()=>e(te).material)??""})`)),c(It,Gt)};b(Ct,It=>{O(e(te)),n(()=>e(te).material)&&It(vt)})}s(qt);var ht=a(qt,2),xt=a(l(ht),2);{var Tt=It=>{var Gt=At("Concentration,");c(It,Gt)};b(xt,It=>{O(e(te)),n(()=>e(te).concentration)&&It(Tt)})}var kt=a(xt,1,!0);s(ht);var Wt=a(ht,2),Ot=a(l(Wt));s(Wt);var ra=a(Wt,2);{var da=It=>{var Gt=di(),oa=a(l(Gt));s(Gt),C(()=>S(oa,` ${O(e(te)),n(()=>e(te).higherLevelSlot)??""}`)),c(It,Gt)};b(ra,It=>{O(e(te)),n(()=>e(te).higherLevelSlot)&&It(da)})}s(Mt),C(It=>{S(sa,` ${O(e(te)),n(()=>e(te).level)??""}`),S(va,` ${O(e(te)),n(()=>e(te).castingTime||e(te).actionType)??""}`),S(Pt,` ${O(e(te)),n(()=>e(te).range)??""}`),S(Zt,` ${It??""}`),S(kt,(O(e(te)),n(()=>e(te).duration))),S(Ot,` ${O(e(te)),n(()=>e(te).description)??""}`)},[()=>(O(e(te)),n(()=>e(te).components.join(", ")))]),c(jt,Mt)};b(Lt,jt=>{e(ae),e(u),n(()=>!e(ae)[e(u).id])&&jt(ft)})}s(Ae);var st=a(Ae,2);{var Rt=jt=>{var Mt=gi(),Nt=l(Mt),sa=l(Nt);Ce(sa);var na=a(sa),va=a(na);{var Jt=Ct=>{var vt=fi(),ht=l(vt);s(vt),C(xt=>S(ht,`(Spell Save DC: ${xt??""})`),[()=>(O(ls),t(),n(()=>ls(t(),t().abilities)))]),c(Ct,vt)};b(va,Ct=>{t(),n(()=>t().class)&&Ct(Jt)})}var Pt=a(va,2);{var qt=Ct=>{var vt=pi();c(Ct,vt)},Zt=Ct=>{var vt=bt(),ht=je(vt);{var xt=Tt=>{var kt=mi();c(Tt,kt)};b(ht,Tt=>{e(u),O(e(at)),n(()=>e(u).targetSucceededSave&&e(at).noDamageOnSave)&&Tt(xt)},!0)}c(Ct,vt)};b(Pt,Ct=>{e(u),O(e(at)),n(()=>e(u).targetSucceededSave&&e(at).halfDamageOnSave)?Ct(qt):Ct(Zt,!1)})}s(Nt),s(Mt),C(Ct=>S(na,` Target succeeded on ${Ct??""} save `),[()=>(O(e(at)),n(()=>e(at).ability.charAt(0).toUpperCase()+e(at).ability.slice(1)))]),ka(sa,()=>e(u).targetSucceededSave,Ct=>(e(u).targetSucceededSave=Ct,Et(()=>(e(y),t(),v())))),c(jt,Mt)};b(st,jt=>{e(at)&&jt(Rt)})}var ea=a(st,2);{var ta=jt=>{var Mt=_i(),Nt=l(Mt),sa=l(Nt);Ce(sa);var na=a(sa,2);{var va=Pt=>{const qt=yt(()=>(e(u),O(e(te)),n(()=>A(e(u),e(te)))));var Zt=bi(),Ct=l(Zt);s(Zt),C(()=>S(Ct,`(${O(e(Fe)),n(()=>e(Fe).alternateDamage)??""}, total: ${e(qt)??""})`)),c(Pt,Zt)},Jt=Pt=>{var qt=hi(),Zt=l(qt);s(qt),C(()=>S(Zt,`(${O(e(Fe)),n(()=>e(Fe).baseDamage)??""})`)),c(Pt,qt)};b(na,Pt=>{e(u),n(()=>e(u).targetIsDamaged)?Pt(va):Pt(Jt,!1)})}s(Nt),s(Mt),ka(sa,()=>e(u).targetIsDamaged,Pt=>(e(u).targetIsDamaged=Pt,Et(()=>(e(y),t(),v())))),c(jt,Mt)};b(ea,jt=>{e(Fe)&&jt(ta)})}var Xt=a(ea,2);{var aa=jt=>{const Mt=yt(()=>(O(e(te)),n(()=>Z(e(te)))));var Nt=bt(),sa=je(Nt);{var na=Jt=>{var Pt=$i(),qt=je(Pt),Zt=l(qt),Ct=a(Zt,2);C(()=>{e(u),Et(()=>{e(Mt)})}),$t(Ct,5,()=>e(Mt),Dt,(kt,Wt)=>{var Ot=yi(),ra=l(Ot);s(Ot);var da={};C(()=>{S(ra,`Level ${e(Wt)??""}`),da!==(da=e(Wt))&&(Ot.value=(Ot.__value=e(Wt))??"")}),c(kt,Ot)}),s(Ct);var vt=a(Ct,2);{var ht=kt=>{const Wt=yt(()=>(e(u),O(e(te)),n(()=>A(e(u),e(te)))));var Ot=xi(),ra=l(Ot);{var da=oa=>{var la=At("Healing");c(oa,la)},It=oa=>{var la=At("Damage");c(oa,la)};b(ra,oa=>{O(e(te)),n(()=>pe(e(te)))?oa(da):oa(It,!1)})}var Gt=a(ra);s(Ot),C(()=>S(Gt,` ${e(Wt)??""}`)),c(kt,Ot)};b(vt,kt=>{e(u),O(e(te)),n(()=>e(u).castAtLevel&&e(u).castAtLevel>e(te).level)&&kt(ht)})}s(qt);var xt=a(qt,2);{var Tt=kt=>{var Wt=wi(),Ot=l(Wt),ra=l(Ot);Ce(ra);var da=a(ra,2);{var It=Gt=>{const oa=yt(()=>(e(u),O(e(te)),n(()=>A(e(u),e(te)))));var la=ki(),ya=l(la);s(la),C(()=>S(ya,`(+1d8, total: ${e(oa)??""})`)),c(Gt,la)};b(da,Gt=>{e(u),n(()=>e(u).targetIsFiendOrUndead)&&Gt(It)})}s(Ot),s(Wt),ka(ra,()=>e(u).targetIsFiendOrUndead,Gt=>(e(u).targetIsFiendOrUndead=Gt,Et(()=>(e(y),t(),v())))),c(kt,Wt)};b(xt,kt=>{O(e(te)),n(()=>e(te).description.includes("Fiend or an Undead"))&&kt(Tt)})}C(()=>{it(Zt,"for",`castLevel-${e(u),n(()=>e(u).id)??""}`),it(Ct,"id",`castLevel-${e(u),n(()=>e(u).id)??""}`)}),Ra(Ct,()=>e(u).castAtLevel,kt=>(e(u).castAtLevel=kt,Et(()=>(e(y),t(),v())))),c(Jt,Pt)},va=Jt=>{var Pt=Si();c(Jt,Pt)};b(sa,Jt=>{O(e(Mt)),n(()=>e(Mt).length>0)?Jt(na):Jt(va,!1)})}c(jt,Nt)};b(Xt,jt=>{O(e(te)),n(()=>e(te).higherLevelSlot&&e(te).level>0)&&jt(aa)})}C(()=>{it(St,"aria-label",(e(ae),e(u),n(()=>e(ae)[e(u).id]?"Expand":"Collapse"))),S(Ut,(e(ae),e(u),n(()=>e(ae)[e(u).id]?"‚ñº":"‚ñ≤")))}),L("click",lt,()=>I(e(u).id)),L("keydown",lt,jt=>jt.key==="Enter"&&I(e(u).id)),c(X,_t)},Q=X=>{var at=Di();c(X,at)};b(Ke,X=>{e(te)?X(H):X(Q,!1)})}c(ct,j)};b(Te,ct=>{e(T),n(()=>e(T).length===0)?ct(ot):ct(Xe,!1)})}c(ve,E)};b(K,ve=>{e(u),n(()=>e(u).spellRef)&&ve(q)})}var z=a(K,2);{var ke=ve=>{var E=Li(),Te=l(E),ot=a(Te,2);xa(ot),s(E),C(()=>{it(Te,"for",`attack-notes-${e(u),n(()=>e(u).id)??""}`),it(ot,"id",`attack-notes-${e(u),n(()=>e(u).id)??""}`)}),Ne(ot,()=>e(u).notes,Xe=>(e(u).notes=Xe,Et(()=>(e(y),t(),v())))),c(ve,E)};b(z,ve=>{e(u),n(()=>!e(u).spellRef)&&ve(ke)})}var Je=a(z,2),tt=l(Je);{var Ge=ve=>{const E=yt(()=>(e(u),n(()=>W(e(u).spellRef))));var Te=bt(),ot=je(Te);{var Xe=ct=>{var te=bt(),j=je(te);{var Ke=Q=>{var X=ji();L("click",X,()=>Pe(e(u))),c(Q,X)},H=Q=>{var X=bt(),at=je(X);{var Fe=Ae=>{var lt=bt(),St=je(lt);{var Ut=ft=>{var st=Ai(),Rt=l(st),ea=l(Rt),ta=l(ea);Ce(ta),ta.value=ta.__value="self",Yt(),s(ea);var Xt=a(ea,2),aa=l(Xt);Ce(aa),aa.value=aa.__value="other",Yt(),s(Xt),s(Rt);var jt=a(Rt,2),Mt=l(jt);s(jt),s(st),C(()=>{it(ta,"name",`target-${e(u),n(()=>e(u).id)??""}`),it(aa,"name",`target-${e(u),n(()=>e(u).id)??""}`),S(Mt,`Cast ${O(e(E)),n(()=>e(E).name)??""}`)}),us(M,[xe],ta,()=>e(se)[e(u).id],Nt=>pa(se,e(se)[e(u).id]=Nt)),us(M,[xe],aa,()=>e(se)[e(u).id],Nt=>pa(se,e(se)[e(u).id]=Nt)),L("click",jt,()=>re(e(u),e(se)[e(u).id])),c(ft,st)},Lt=ft=>{var st=Bi();L("click",st,()=>re(e(u),"self")),c(ft,st)};b(St,ft=>{O(e(E)),n(()=>Ie(e(E).name))?ft(Ut):ft(Lt,!1)})}c(Ae,lt)},_t=Ae=>{var lt=bt(),St=je(lt);{var Ut=ft=>{var st=Ri(),Rt=l(st);{var ea=Xt=>{var aa=At("Roll Healing");c(Xt,aa)},ta=Xt=>{var aa=At("Roll Damage");c(Xt,aa)};b(Rt,Xt=>{O(e(E)),n(()=>pe(e(E)))?Xt(ea):Xt(ta,!1)})}s(st),C(Xt=>Bt(st,1,`btn ${Xt??""}`),[()=>(O(e(E)),n(()=>pe(e(E))?"btn-success":"btn-secondary"))]),L("click",st,()=>R(e(u))),c(ft,st)},Lt=ft=>{var st=Mi();L("click",st,()=>re(e(u),"self")),c(ft,st)};b(St,ft=>{e(u),n(()=>e(u).damage&&e(u).damage.trim()!=="")?ft(Ut):ft(Lt,!1)})}c(Ae,lt)};b(at,Ae=>{O(hs),O(e(E)),n(()=>hs(e(E)))?Ae(Fe):Ae(_t,!1)},!0)}c(Q,X)};b(j,Q=>{O(Xa),O(e(E)),n(()=>Xa(e(E)))?Q(Ke):Q(H,!1)})}c(ct,te)};b(ot,ct=>{e(E)&&ct(Xe)})}c(ve,Te)},ze=ve=>{var E=bt(),Te=je(E);{var ot=Xe=>{var ct=Fi(),te=je(ct),j=a(te,2);{var Ke=H=>{var Q=Ti();L("click",Q,()=>R(e(u))),c(H,Q)};b(j,H=>{e(u),n(()=>e(u).damage&&e(u).damage.trim()!=="")&&H(Ke)})}L("click",te,()=>Pe(e(u))),c(Xe,ct)};b(Te,Xe=>{e(u),n(()=>!e(u).spellRef)&&Xe(ot)},!0)}c(ve,E)};b(tt,ve=>{e(u),e(x),n(()=>e(u).spellRef&&e(x))?ve(Ge):ve(ze,!1)})}s(Je),s(ge),C(()=>{it(ue,"for",`attack-type-${e(u),n(()=>e(u).id)??""}`),it(_,"id",`attack-type-${e(u),n(()=>e(u).id)??""}`)}),Ne(_,()=>e(u).damageType,ve=>(e(u).damageType=ve,Et(()=>(e(y),t(),v())))),c(Se,ge)});var oe=a(G,2);{var me=Se=>{var u=Ii();c(Se,u)},ee=Se=>{var u=bt(),xe=je(u);{var ge=U=>{var De=Ei();c(U,De)};b(xe,U=>{e(y),n(()=>e(y).length===0)&&U(ge)},!0)}c(Se,u)};b(oe,Se=>{t(),n(()=>t().attacks.length===0)?Se(me):Se(ee,!1)})}s(w);var he=a(w,2);{var ie=Se=>{var u=Gi(),xe=a(l(u),4);$t(xe,5,()=>e(h),Dt,(ge,U)=>{var De=Oi(),Me=l(De),we=l(Me),Le=l(we,!0);s(we);var le=a(we,2),Ee=l(le);s(le),s(Me);var _e=a(Me,2),We=l(_e,!0);s(_e);var Qe=a(_e,2),et=l(Qe);{var dt=z=>{var ke=Hi(),Je=l(ke),tt=a(Je);{var Ge=ze=>{var ve=At();C(()=>S(ve,`per ${e(U),n(()=>e(U).restType)??""} rest`)),c(ze,ve)};b(tt,ze=>{e(U),n(()=>e(U).restType)&&ze(Ge)})}s(ke),C(()=>S(Je,`${e(U),n(()=>e(U).currentUses??e(U).usesPerRest)??""}/${e(U),n(()=>e(U).usesPerRest)??""} uses `)),c(z,ke)};b(et,z=>{e(U),n(()=>e(U).usesPerRest)&&z(dt)})}var ue=a(et,2);{var _=z=>{var ke=Ui();c(z,ke)};b(ue,z=>{e(U),n(()=>e(U).requiresReaction)&&z(_)})}var K=a(ue,2);{var q=z=>{var ke=Ni();C(()=>ke.disabled=(e(U),n(()=>e(U).currentUses===void 0||e(U).currentUses===0))),L("click",ke,()=>ne(e(U).conditionName,e(U).name)),c(z,ke)};b(K,z=>{p(),e(U),n(()=>!p()&&e(U).usesPerRest)&&z(q)})}s(Qe),s(De),C(()=>{S(Le,(e(U),n(()=>e(U).name))),S(Ee,`(${e(U),n(()=>e(U).conditionName)??""})`),S(We,(e(U),n(()=>e(U).description)))}),c(ge,De)}),s(xe),s(u),c(Se,u)};b(he,Se=>{e(h),n(()=>e(h).length>0)&&Se(ie)})}var ce=a(he,2),B=a(l(ce),4),qe=a(B,2);{var Re=Se=>{var u=zi();$t(u,5,()=>(t(),n(()=>t().activeStates)),Dt,(xe,ge,U)=>{var De=Wi(),Me=l(De),we=l(Me);Ce(we);var Le=a(we,2);{var le=ze=>{var ve=qi();L("click",ve,()=>Be(U)),c(ze,ve)};b(Le,ze=>{p()&&ze(le)})}s(Me);var Ee=a(Me,2),_e=l(Ee),We=l(_e);it(We,"for",`state-attack-bonus-${U}`);var Qe=a(We,2);Ce(Qe),it(Qe,"id",`state-attack-bonus-${U}`),s(_e);var et=a(_e,2),dt=l(et);it(dt,"for",`state-damage-bonus-${U}`);var ue=a(dt,2);Ce(ue),it(ue,"id",`state-damage-bonus-${U}`),s(et);var _=a(et,2),K=l(_);it(K,"for",`state-target-${U}`);var q=a(K,2);C(()=>{e(ge),Et(()=>{})}),it(q,"id",`state-target-${U}`);var z=l(q);z.value=z.__value="self";var ke=a(z);ke.value=ke.__value="other",s(q),s(_),s(Ee);var Je=a(Ee,2),tt=l(Je);it(tt,"for",`state-desc-${U}`);var Ge=a(tt,2);Ce(Ge),it(Ge,"id",`state-desc-${U}`),s(Je),s(De),Ne(we,()=>e(ge).name,ze=>(e(ge).name=ze,Et(()=>t()),Da(m,"$character"))),Ne(Qe,()=>e(ge).attackBonus,ze=>(e(ge).attackBonus=ze,Et(()=>t()),Da(m,"$character"))),Ne(ue,()=>e(ge).damageBonus,ze=>(e(ge).damageBonus=ze,Et(()=>t()),Da(m,"$character"))),Ra(q,()=>e(ge).target,ze=>(e(ge).target=ze,Et(()=>t()),Da(m,"$character"))),Ne(Ge,()=>e(ge).description,ze=>(e(ge).description=ze,Et(()=>t()),Da(m,"$character"))),c(xe,De)}),s(u),c(Se,u)},Ye=Se=>{var u=Ki();c(Se,u)};b(qe,Se=>{t(),n(()=>t().activeStates&&t().activeStates.length>0)?Se(Re):Se(Ye,!1)})}s(ce),L("click",B,Ue),c(k,P)};b(mt,k=>{d(),n(()=>!d().attacks)&&k(gt)})}s(Oe);var rt=a(Oe,2);Ql(rt,{get show(){return e(F)},get attacks(){return t(),n(()=>t().attacks)},onSave:$e,onCancel:ye}),C(()=>Ve=Bt(Oe,1,"attacks svelte-14o91c5",null,Ve,{hidden:!e(V)})),c(i,be),Vt(),D()}var Qi=f('<span class="slot-checkbox-x svelte-serp1j">&#8212;</span>'),Xi=f('<label><input type="checkbox" class="slot-checkbox-input svelte-serp1j"/> <span><!></span></label>');function _s(i,o){Kt(o,!1);const t=()=>pt(ba,"$isEditMode",v),[v,d]=ca();let p=wt(o,"checked",8,!1),m=wt(o,"disabled",8,!1),D=wt(o,"className",8,""),h=wt(o,"index",8,void 0),y=wt(o,"ariaLabel",8,void 0);const V=ha();function M(I){V("change",{checked:I.currentTarget.checked,index:h()})}zt();var ne=Xi(),J=l(ne);Ce(J);var ae=a(J,2),se=l(ae);{var F=I=>{var pe=Qi();c(I,pe)};b(se,I=>{p()&&I(F)})}s(ae),s(ne),C(()=>{Bt(ne,1,"slot-checkbox-label "+D()+(t()?"":" not-editable"),"svelte-serp1j"),Cs(J,p()),J.disabled=m()||!t(),it(J,"aria-label",y()),it(J,"tabindex",t()?0:-1),Bt(ae,1,`slot-checkbox-custom ${p()?"used":""} ${t()?"":"readonly"}`,"svelte-serp1j")}),L("change",J,M),c(i,ne),Vt(),d()}var Zi=f('<p class="no-features svelte-1kpvv0n">Select a class to see available features</p>'),en=f('<p class="no-features svelte-1kpvv0n">No class features available at this level</p>'),tn=f('<div class="spell-slots svelte-1kpvv0n"><label class="svelte-1kpvv0n"> </label> <div class="slots-tracker svelte-1kpvv0n"></div></div>'),an=f('<div class="all-spell-slots"></div>'),sn=f('<div class="feature-box spellcasting svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"> </h3> <div class="spell-stats svelte-1kpvv0n"><div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Spell Save DC</label> <div class="spell-value svelte-1kpvv0n"> </div></div> <div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <div class="spell-value svelte-1kpvv0n"> </div></div></div> <!> <div class="prepared-spells svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <textarea placeholder="List your prepared spells..." class="svelte-1kpvv0n"></textarea></div></div>'),ln=f('<p class="unlimited svelte-1kpvv0n">Unlimited Uses</p>'),nn=f('<div class="slots-tracker svelte-1kpvv0n"></div> <div class="uses-actions-row"><button class="btn btn-primary use-enabled"> </button></div> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div>',1),rn=f('<div class="uses-tracker svelte-1kpvv0n"><!></div>'),on=f('<div class="pool-tracker svelte-1kpvv0n"><input type="number" min="0" class="pool-input svelte-1kpvv0n"/> <span> </span> <button class="btn-small svelte-1kpvv0n"> </button></div>'),cn=f('<p class="no-uses svelte-1kpvv0n">No Channel Divinity uses remaining</p>'),vn=f('<div class="channel-divinity-option svelte-1kpvv0n"><button class="btn btn-primary use-enabled svelte-1kpvv0n">Use Channel Divinity</button> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div> <!></div>'),dn=f('<div class="feature-box svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"><!> </h3> <p class="feature-description svelte-1kpvv0n"> </p> <!></div>'),un=f('<div class="features-grid svelte-1kpvv0n"><!> <!></div>'),fn=f("<section><!> <!></section>");function pn(i,o){Kt(o,!1);const t=()=>pt(fe,"$character",m),v=()=>pt(Ga,"$abilityModifiers",m),d=()=>pt(ma,"$searchFilter",m),p=()=>pt(Qt,"$collapsedStates",m),[m,D]=ca(),h=$(),y=$(),V=$(),M=$(),ne=$(),J=$(),ae=$();let se=$(0),F=$(0);function I(g,A){fe.update(Z=>(Z.classFeatures.features[g]=A,Z))}function pe(){fe.update(g=>(g.classFeatures.spellSlotsByLevel||(g.classFeatures.spellSlotsByLevel={}),e(M).forEach(({level:A,slots:Z})=>{g.classFeatures.spellSlotsByLevel[A]||(g.classFeatures.spellSlotsByLevel[A]=Array(Z).fill(!1))}),g))}function Ie(g){if(typeof g.maxUses=="function"){if((g.name==="Divine Sense"||g.name==="War Priest")&&e(h)?.spellcastingAbility){const A=v()[e(h).spellcastingAbility];return g.maxUses(t().level,A)}return g.maxUses(t().level)}return g.maxUses||0}function Ze(g,A){fe.update(Z=>((!Z.classFeatures.features[g]||!Array.isArray(Z.classFeatures.features[g])||Z.classFeatures.features[g].length!==A)&&(Z.classFeatures.features[g]=Array(A).fill(!1)),Z))}Ts(()=>{e(J)&&t()&&t().classFeatures&&t().classFeatures.features&&e(J).forEach(g=>{if(g.type==="uses"){const A=g.name.replace(/\s+/g,""),Z=Ie(g),Ue=t().classFeatures.features[A];(!Array.isArray(Ue)||Ue.length!==Z)&&Ze(A,Z)}})});function Y(g){return typeof g.maxPool=="function"?g.maxPool(t().level):g.maxPool||0}function He(g){return typeof g.description=="function"?g.description(t().level):g.description}function ye(){const g="ChannelDivinity";fe.update(A=>{const Z=A.classFeatures.features[g];return typeof Z=="number"&&Z>0&&(A.classFeatures.features[g]=Z-1),A})}function $e(){Qt.update(g=>({...g,classFeatures:!g.classFeatures}))}nt(()=>(t(),ia),()=>{r(h,t().class?ia(t().class):null)}),nt(()=>(t(),$a),()=>{r(y,t().class?$a(t().class,t().level,t().subclass):[])}),nt(()=>(t(),ms),()=>{r(V,t().class?ms(t().class,t().level):0)}),nt(()=>(e(h),t()),()=>{r(M,(()=>{if(!e(h)?.spellcaster)return[];const g=t().level,A=[];return g>=1&&A.push({level:1,slots:Math.min(4,2+Math.floor(g/3))}),g>=3&&A.push({level:2,slots:Math.min(3,2+Math.floor((g-3)/4))}),g>=5&&A.push({level:3,slots:Math.min(3,2+Math.floor((g-5)/5))}),g>=7&&A.push({level:4,slots:Math.min(3,1+Math.floor((g-7)/6))}),g>=9&&A.push({level:5,slots:Math.min(2,1+Math.floor((g-9)/8))}),g>=11&&A.push({level:6,slots:1}),g>=13&&A.push({level:7,slots:1}),g>=15&&A.push({level:8,slots:1}),g>=17&&A.push({level:9,slots:1}),A})())}),nt(()=>(e(h),v(),t(),gs),()=>{if(e(h)?.spellcaster&&e(h).spellcastingAbility){const g=v()[e(h).spellcastingAbility];r(se,fl(t().class,g,t().proficiencyBonus)||0),r(F,gs(t().class,t().level,g))}}),nt(()=>(t(),e(h),e(M)),()=>{t().class&&e(h)?.spellcaster&&e(M).length>0&&pe()}),nt(()=>t(),()=>{r(ne,(()=>{const A=t().classFeatures.features["ChannelDivinity"];return typeof A=="number"?A:0})())}),nt(()=>(e(y),d()),()=>{r(J,e(y).filter(g=>{if(!d())return!0;const A=d().toLowerCase();return g.name.toLowerCase().includes(A)||He(g).toLowerCase().includes(A)}))}),nt(()=>(d(),t(),e(J)),()=>{r(ae,!d()||t().class||"class features".includes(d().toLowerCase())||"spellcasting".includes(d().toLowerCase())||e(J).length>0)}),ua(),zt();var Pe=fn();let R;var T=l(Pe);{let g=yt(()=>(p(),n(()=>p().classFeatures?"Expand":"Collapse")));_a(T,{title:"Class Features",get collapsed(){return p(),n(()=>p().classFeatures)},get ariaLabel(){return e(g)},onToggle:$e})}var x=a(T,2);{var W=g=>{var A=bt(),Z=je(A);{var Ue=re=>{var be=Zi();c(re,be)},Be=re=>{var be=bt(),Oe=je(be);{var Ve=mt=>{var gt=en();c(mt,gt)},ut=mt=>{var gt=un(),rt=l(gt);{var k=de=>{var N=sn(),w=l(N),G=l(w);s(w);var oe=a(w,2),me=l(oe),ee=a(l(me),2),he=l(ee,!0);s(ee),s(me);var ie=a(me,2),ce=a(l(ie),2),B=l(ce,!0);s(ce),s(ie),s(oe);var qe=a(oe,2);{var Re=u=>{var xe=an();$t(xe,5,()=>e(M),Dt,(ge,U)=>{let De=()=>e(U).level,Me=()=>e(U).slots;const we=yt(()=>(t(),De(),Me(),n(()=>t().classFeatures.spellSlotsByLevel?.[De()]||Array(Me()).fill(!1))));var Le=tn(),le=l(Le),Ee=l(le);s(le);var _e=a(le,2);$t(_e,5,()=>e(we),Dt,(We,Qe,et)=>{{let dt=yt(()=>(O(e(we)),n(()=>e(we)[et]||!1)));_s(We,{get checked(){return e(dt)},$$events:{change:ue=>{fe.update(_=>(_.classFeatures.spellSlotsByLevel||(_.classFeatures.spellSlotsByLevel={}),_.classFeatures.spellSlotsByLevel[De()]||(_.classFeatures.spellSlotsByLevel[De()]=Array(Me()).fill(!1)),_.classFeatures.spellSlotsByLevel[De()][et]=ue.detail.checked,_))}}})}}),s(_e),s(Le),C(()=>S(Ee,`${De()===1?"1st":De()===2?"2nd":De()===3?"3rd":`${De()}th`} Level Spell Slots`)),c(ge,Le)}),s(xe),c(u,xe)};b(qe,u=>{e(M),n(()=>e(M).length>0)&&u(Re)})}var Ye=a(qe,2),Se=a(l(Ye),2);xa(Se),s(Ye),s(N),C(u=>{S(G,`Spellcasting (${u??""})`),S(he,e(se)),S(B,e(F))},[()=>(e(h),n(()=>e(h).spellcastingAbility?.toUpperCase()))]),Ne(Se,()=>t().classFeatures.preparedSpells,u=>Ft(fe,n(t).classFeatures.preparedSpells=u,n(t))),c(de,N)};b(rt,de=>{e(h),n(()=>e(h)?.spellcaster)&&de(k)})}var P=a(rt,2);$t(P,1,()=>e(J),Dt,(de,N)=>{const w=yt(()=>(e(N),n(()=>e(N).name.replace(/\s+/g,"")))),G=yt(()=>(t(),O(e(w)),n(()=>t().classFeatures.features[e(w)]))),oe=yt(()=>typeof e(G)=="number");var me=dn(),ee=l(me),he=l(ee);{var ie=u=>{var xe=At("Channel Divinity:");c(u,xe)};b(he,u=>{e(N),n(()=>e(N).type==="channelDivinity")&&u(ie)})}var ce=a(he);s(ee);var B=a(ee,2),qe=l(B,!0);s(B);var Re=a(B,2);{var Ye=u=>{const xe=yt(()=>(e(N),n(()=>Ie(e(N))))),ge=yt(()=>(O(e(G)),O(e(xe)),n(()=>Array.isArray(e(G))?e(G):Array(e(xe)).fill(!1))));var U=rn(),De=l(U);{var Me=Le=>{var le=ln();c(Le,le)},we=Le=>{var le=nn(),Ee=je(le);$t(Ee,5,()=>e(ge),Dt,(_,K,q)=>{_s(_,{get checked(){return e(K)},index:q,$$events:{change:z=>{fe.update(ke=>(ke.classFeatures.features[e(w)]||(ke.classFeatures.features[e(w)]=Array(e(xe)).fill(!1)),ke.classFeatures.features[e(w)][q]=z.detail.checked,ke))}}})}),s(Ee);var _e=a(Ee,2),We=l(_e),Qe=l(We);s(We),s(_e);var et=a(_e,2),dt=l(et),ue=l(dt);s(dt),s(et),C(_=>{We.disabled=_,S(Qe,`Use ${e(N),n(()=>e(N).name)??""}`),S(ue,`Resets on ${e(N),n(()=>e(N).resetOn==="short"?"Short Rest":"Long Rest")??""}`)},[()=>(O(e(ge)),n(()=>e(ge).filter(_=>!_).length<=0))]),L("click",We,()=>{fe.update(_=>{_.classFeatures.features[e(w)]||(_.classFeatures.features[e(w)]=Array(e(xe)).fill(!1));const K=_.classFeatures.features[e(w)],q=K.findIndex(z=>!z);return q!==-1&&(K[q]=!0),_})}),c(Le,le)};b(De,Le=>{e(xe)===1/0?Le(Me):Le(we,!1)})}s(U),c(u,U)},Se=u=>{var xe=bt(),ge=je(xe);{var U=Me=>{const we=yt(()=>(e(N),n(()=>Y(e(N)))));var Le=on(),le=l(Le);Ce(le);var Ee=a(le,2),_e=l(Ee);s(Ee);var We=a(Ee,2),Qe=l(We,!0);s(We),s(Le),C(()=>{Aa(le,e(oe)&&e(G)!==void 0?e(G):e(we)),it(le,"max",e(we)),S(_e,`/ ${e(we)??""}`),S(Qe,(e(N),n(()=>e(N).resetOn==="short"?"Short Rest":"Long Rest")))}),L("input",le,et=>{fe.update(dt=>(dt.classFeatures.features[e(w)]=parseInt(et.currentTarget.value)||0,dt))}),L("click",We,()=>I(e(w),e(we))),c(Me,Le)},De=Me=>{var we=bt(),Le=je(we);{var le=Ee=>{var _e=vn(),We=l(_e),Qe=a(We,2),et=l(Qe),dt=l(et);s(et),s(Qe);var ue=a(Qe,2);{var _=K=>{var q=cn();c(K,q)};b(ue,K=>{e(ne)<=0&&K(_)})}s(_e),C(()=>{We.disabled=e(ne)<=0,S(dt,`Resets on ${e(N),n(()=>e(N).resetOn==="short"?"Short Rest":"Long Rest")??""}`)}),L("click",We,ye),c(Ee,_e)};b(Le,Ee=>{e(N),n(()=>e(N).type==="channelDivinity")&&Ee(le)},!0)}c(Me,we)};b(ge,Me=>{e(N),n(()=>e(N).type==="pool")?Me(U):Me(De,!1)},!0)}c(u,xe)};b(Re,u=>{e(N),n(()=>e(N).type==="uses")?u(Ye):u(Se,!1)})}s(me),C(u=>{S(ce,` ${e(N),n(()=>e(N).name)??""}`),S(qe,u)},[()=>(e(N),n(()=>He(e(N))))]),c(de,me)}),s(gt),c(mt,gt)};b(Oe,mt=>{e(y),n(()=>e(y).length===0)?mt(Ve):mt(ut,!1)},!0)}c(re,be)};b(Z,re=>{t(),n(()=>!t().class)?re(Ue):re(Be,!1)})}c(g,A)};b(x,g=>{p(),n(()=>!p().classFeatures)&&g(W)})}s(Pe),C(()=>R=Bt(Pe,1,"class-features svelte-1kpvv0n",null,R,{hidden:!e(ae)})),c(i,Pe),Vt(),D()}var mn=f('<textarea placeholder="Enter features, traits, and special abilities..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Equipment</h3> <textarea placeholder="List your equipment and inventory..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Notes</h3> <textarea placeholder="Additional notes..." class="svelte-wttn0l"></textarea>',1),gn=f("<section><!> <!></section>");function bn(i,o){Kt(o,!1);const t=()=>pt(ma,"$searchFilter",p),v=()=>pt(fe,"$character",p),d=()=>pt(Qt,"$collapsedStates",p),[p,m]=ca(),D=$();function h(){Qt.update(ae=>({...ae,notes:!ae.notes}))}nt(()=>(t(),v()),()=>{r(D,!t()||"features".includes(t().toLowerCase())||"traits".includes(t().toLowerCase())||"equipment".includes(t().toLowerCase())||"notes".includes(t().toLowerCase())||v().features.toLowerCase().includes(t().toLowerCase())||v().equipment.toLowerCase().includes(t().toLowerCase())||v().notes.toLowerCase().includes(t().toLowerCase()))}),ua(),zt();var y=gn();let V;var M=l(y);{let ae=yt(()=>(d(),n(()=>d().notes?"Expand":"Collapse")));_a(M,{title:"Features & Traits",get collapsed(){return d(),n(()=>d().notes)},get ariaLabel(){return e(ae)},onToggle:h})}var ne=a(M,2);{var J=ae=>{var se=mn(),F=je(se);xa(F);var I=a(F,4);xa(I);var pe=a(I,4);xa(pe),Ne(F,()=>v().features,Ie=>Ft(fe,n(v).features=Ie,n(v))),Ne(I,()=>v().equipment,Ie=>Ft(fe,n(v).equipment=Ie,n(v))),Ne(pe,()=>v().notes,Ie=>Ft(fe,n(v).notes=Ie,n(v))),c(ae,se)};b(ne,ae=>{d(),n(()=>!d().notes)&&ae(J)})}s(y),C(()=>V=Bt(y,1,"notes svelte-wttn0l",null,V,{hidden:!e(D)})),c(i,y),Vt(),m()}var hn=f(" <!> <!> <!> <!> <!>",1),_n=f('<div class="color-picker-section svelte-1r90jgp"><h3 class="svelte-1r90jgp">Dice Colors</h3> <div class="color-inputs svelte-1r90jgp"><div class="color-input-group svelte-1r90jgp"><label for="dice-color" class="svelte-1r90jgp">Dice Color</label> <input type="color" id="dice-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="label-color" class="svelte-1r90jgp">Label Color</label> <input type="color" id="label-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="desk-color" class="svelte-1r90jgp">Background Color</label> <input type="color" id="desk-color" class="svelte-1r90jgp"/></div></div></div>'),yn=f('<div class="loading svelte-1r90jgp"><p class="svelte-1r90jgp">Loading 3D dice...</p></div>'),xn=f('<div class="custom-dice-selector svelte-1r90jgp"><h3 class="svelte-1r90jgp">Choose Dice to Roll</h3> <div class="dice-inputs svelte-1r90jgp"><div class="dice-input-group svelte-1r90jgp"><label for="d4" class="svelte-1r90jgp">d4</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d4" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d6" class="svelte-1r90jgp">d6</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d6" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d8" class="svelte-1r90jgp">d8</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d8" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d10" class="svelte-1r90jgp">d10</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d10" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d12" class="svelte-1r90jgp">d12</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d12" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d20" class="svelte-1r90jgp">d20</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d20" min="0" max="10"/></div></div> <div class="dice-controls svelte-1r90jgp"><button class="btn btn-primary use-enabled svelte-1r90jgp"> </button> <button class="btn btn-secondary use-enabled svelte-1r90jgp">Reset</button></div></div>'),kn=f('<h3 class="svelte-1r90jgp"> </h3>'),wn=f('<h3 class="svelte-1r90jgp"> </h3>'),$n=f('<h3 class="svelte-1r90jgp"> </h3>'),Sn=f('<h3 class="svelte-1r90jgp"> </h3>'),Cn=f('<span class="crit-badge svelte-1r90jgp">CRITICAL HIT!</span>'),Dn=f('<span class="crit-badge crit-fail svelte-1r90jgp">CRITICAL MISS!</span>'),Ln=f('<div class="bonus-item svelte-1r90jgp"><span class="bonus-value svelte-1r90jgp"> </span> <span class="bonus-source svelte-1r90jgp"> </span></div>'),jn=f('<div class="bonus-breakdown svelte-1r90jgp"></div>'),An=f('<p class="modifier-text svelte-1r90jgp"> </p>'),Bn=f('<div class="svelte-1r90jgp"><em class="svelte-1r90jgp">No damage is dealt on a critical miss.</em></div>'),Rn=f('<button class="btn btn-follow-up svelte-1r90jgp"> </button>'),Mn=f('<button class="btn btn-guided-strike svelte-1r90jgp">‚ö° Use Guided Strike (+10)</button>'),Tn=f('<div class="follow-up-actions svelte-1r90jgp"><!> <!></div>'),Fn=f('<div class="result-header svelte-1r90jgp"><!> <!> <!></div> <div class="result-total svelte-1r90jgp"> </div> <div class="result-details svelte-1r90jgp"><!></div> <!> <!>',1),Pn=f('<div role="button" tabindex="-1"><div class="modal-content svelte-1r90jgp" role="dialog" tabindex="0"><div class="modal-header svelte-1r90jgp"><h2 class="svelte-1r90jgp"><!></h2> <div class="header-buttons svelte-1r90jgp"><button class="color-btn svelte-1r90jgp" title="Customize dice colors">üé®</button> <button class="close-btn svelte-1r90jgp">√ó</button></div></div> <!> <!> <div class="dice-main-area svelte-1r90jgp"><div class="dice-container svelte-1r90jgp"></div> <!></div> <div><!></div></div></div>');function In(i,o){Kt(o,!1);const t=()=>pt(fe,"$character",v),[v,d]=ca(),p=$(),m=$(),D=$(),h=ha();let y=wt(o,"notation",12,""),V=wt(o,"visible",8,!1),M=wt(o,"damageNotation",12,""),ne=wt(o,"damageType",8,""),J=wt(o,"attackName",12,""),ae=wt(o,"applyHalfDamage",8,!1),se=wt(o,"bonusBreakdown",28,()=>[]),F=wt(o,"rollType",12,"other"),I=null,pe=$(void 0),Ie=$(!1),Ze=$(""),Y=$(null);function He(){return e(Y)?.resultTotal??null}function ye(_,K,q){const z=[];if(!_||!_.result)return z;const ke=K.match(/([+-]?\d*d\d+|[+-]?\d+)/g)||[];let Je=0;const tt=new Set;for(const Ge of ke){const ze=Ge.trim();if(!ze)continue;const ve=ze.match(/([+-]?)(\d*)d(\d+)/);if(ve){const E=parseInt(ve[2]||"1"),Te=`${E}d${ve[3]}`,ot=q.findIndex((te,j)=>!tt.has(j)&&typeof te.value=="string"&&te.value===Te),Xe=[];for(let te=0;te<E&&Je<_.result.length;te++)Xe.push(_.result[Je++]);const ct=ot>=0?q[ot].source:"base die";ot>=0&&tt.add(ot);for(const te of Xe)z.push({display:`${te}`,source:ct})}}for(let Ge=0;Ge<q.length;Ge++)if(!tt.has(Ge)&&typeof q[Ge].value=="number"){const ze=q[Ge].value;z.push({display:ze>=0?`+${ze}`:`${ze}`,source:q[Ge].source})}return z}let $e=$(0),Pe=$(0),R=$(0),T=$(0),x=$(0),W=$(0),g=$(0),A=$([]),Z=$(!1),Ue=$(!1),Be=$(!1),re=$("#051e0a"),be=$("#ffffff"),Oe=$("#3a2004"),Ve=$(!1);function ut(_){return _.length===9&&_.startsWith("#")?_.substring(0,7):_}function mt(_,K="ff"){return _.length===7&&_.startsWith("#")?_+K:_}function gt(){if(window.DICE&&e(pe))try{I&&e(pe)&&pa(pe,e(pe).innerHTML="");const _=e(pe).clientWidth||500,K=e(pe).clientHeight||300;I=new window.DICE.dice_box(e(pe),{w:_,h:K}),r(Ie,!0)}catch(_){console.error("Error initializing dice box:",_)}}Sa(()=>{const _=z=>new Promise((ke,Je)=>{if(document.querySelector(`script[src="${z}"]`)){ke(null);return}const Ge=document.createElement("script");Ge.src=z,Ge.onload=()=>{ke(null)},Ge.onerror=()=>{console.error(`Failed to load: ${z}`),Je(new Error(`Failed to load ${z}`))},document.head.appendChild(Ge)});setTimeout(()=>{_(`${La}/libs/three.min.js`).then(()=>_(`${La}/libs/cannon.min.js`)).then(()=>_(`${La}/libs/teal.js`)).then(()=>_(`${La}/dice.js`)).then(()=>{if(window.DICE){const z=window.DICE.getColors();r(re,ut(z.dice_color)),r(be,ut(z.label_color)),r(Oe,ut(z.desk_color))}gt()}).catch(z=>{console.error("Failed to load dice libraries:",z)})},100);const K=()=>{e(Ie)&&gt()},q=z=>{V()&&z.key==="Escape"&&me()};return window.addEventListener("resize",K),window.addEventListener("keydown",q),()=>{window.removeEventListener("resize",K),window.removeEventListener("keydown",q)}});function rt(_,K="other"){if(!I||!e(Ie))return;r(Y,null),r(A,[]),r(Z,!1),r(Ue,!1),K==="damage"&&se([]),F(K),r(Be,!1),I.diceToRoll=_;const q=ke=>null,z=ke=>{let Je=ke.resultTotal,tt=ke.resultString;if(ae()&&(Je=Math.floor(Je/2),tt=tt+" (halved)"),r(Y,{...ke,resultTotal:Je,resultString:tt}),console.log("Final roll result:",e(Y)),console.log({type:K}),K==="attack"&&ke.result&&ke.result.length>0){const Ge=ke.result[0];r(Z,Ge===20),r(Ue,Ge===1)}if(r(A,[]),console.log("Setting up follow-up actions. Type:",K,"damageNotation:",M(),"isCriticalSuccess:",e(Z),"isCriticalFail:",e(Ue)),K==="attack"&&M())if(e(Z)){const Ge=de(M());e(A).push({label:`Roll Critical Damage (${Ge})`,notation:Ge})}else e(Ue)||e(A).push({label:`Roll Damage (${M()})`,notation:M()})};I.start_throw(q,z)}function k(){const _=[];e($e)>0&&_.push(`${e($e)}d4`),e(Pe)>0&&_.push(`${e(Pe)}d6`),e(R)>0&&_.push(`${e(R)}d8`),e(T)>0&&_.push(`${e(T)}d10`),e(x)>0&&_.push(`${e(x)}d12`),e(W)>0&&_.push(`${e(W)}d20`);let K=_.join("+")||"1d20";return e(g)!==0&&(K+=e(g)>=0?`+${e(g)}`:`${e(g)}`),K}function P(){const _=k();rt(_)}function de(_){return _.replace(/(\d+)d(\d+)/g,(K,q,z)=>`${parseInt(q)*2}d${z}`)}function N(){r($e,0),r(Pe,0),r(R,0),r(T,0),r(x,0),r(W,0),r(g,0),r(Y,null),r(A,[]),r(Z,!1),r(Ue,!1),F("other"),r(Be,!1)}function w(){window.DICE&&(window.DICE.setColors({dice_color:mt(e(re),"ff"),label_color:mt(e(be),"ff"),desk_color:e(Oe)}),I&&(I.updateDeskColor(e(Oe)),I.updateDiceColors()))}function G(){r(Ve,!e(Ve))}function oe(){!e(Y)||e(m)<=0||e(Be)||(r(Y,{...e(Y),resultTotal:e(Y).resultTotal+10,resultString:e(Y).resultString+" + 10 (Guided Strike)"}),fe.update(_=>{const K="ChannelDivinity",q=_.classFeatures.features[K];return typeof q=="number"&&q>0&&(_.classFeatures.features[K]=q-1),_}),r(Be,!0))}function me(){h("close"),y(""),M(""),J(""),r(Ze,""),r(Y,null),r(Be,!1),r(Z,!1),r(Ue,!1),N()}nt(()=>(t(),$a),()=>{r(p,t().class?$a(t().class,t().level,t().subclass).some(K=>K.name==="Guided Strike"):!1)}),nt(()=>t(),()=>{r(m,(()=>{const K=t().classFeatures.features["ChannelDivinity"];return typeof K=="number"?K:0})())}),nt(()=>(e($e),e(Pe),e(R),e(T),e(x),e(W),e(g)),()=>{r(D,(()=>{const _=[];e($e)>0&&_.push(`${e($e)}d4`),e(Pe)>0&&_.push(`${e(Pe)}d6`),e(R)>0&&_.push(`${e(R)}d8`),e(T)>0&&_.push(`${e(T)}d10`),e(x)>0&&_.push(`${e(x)}d12`),e(W)>0&&_.push(`${e(W)}d20`);let K=_.join("+")||"1d20";return e(g)!==0&&(K+=e(g)>=0?`+${e(g)}`:`${e(g)}`),K})())}),nt(()=>(O(y()),e(Ie),O(V()),e(Ze),O(M()),O(J()),O(F())),()=>{y()&&e(Ie)&&V()&&y()!==e(Ze)&&(r(Ze,y()),r(Y,null),r(A,[]),r(Z,!1),r(Ue,!1),r(Be,!1),console.log("Auto-roll triggered. notation:",y(),"damageNotation:",M(),"attackName:",J(),"rollType:",F()),setTimeout(()=>rt(y(),F()),200))}),ua();var ee={getLastRollTotal:He};zt();var he=Pn();let ie;var ce=l(he),B=l(ce),qe=l(B),Re=l(qe);{var Ye=_=>{var K=hn(),q=je(K),z=a(q);{var ke=Xe=>{var ct=At("- Attack Roll");c(Xe,ct)};b(z,Xe=>{F()==="attack"&&Xe(ke)})}var Je=a(z,2);{var tt=Xe=>{var ct=At("- Damage Roll");c(Xe,ct)};b(Je,Xe=>{F()==="damage"&&Xe(tt)})}var Ge=a(Je,2);{var ze=Xe=>{var ct=At("- Healing Roll");c(Xe,ct)};b(Ge,Xe=>{F()==="healing"&&Xe(ze)})}var ve=a(Ge,2);{var E=Xe=>{var ct=At("- Ability Check");c(Xe,ct)};b(ve,Xe=>{F()==="check"&&Xe(E)})}var Te=a(ve,2);{var ot=Xe=>{var ct=At("- Saving Throw");c(Xe,ct)};b(Te,Xe=>{F()==="save"&&Xe(ot)})}C(()=>S(q,`${J()??""} `)),c(_,K)},Se=_=>{var K=At("Dice Roller");c(_,K)};b(Re,_=>{J()?_(Ye):_(Se,!1)})}s(qe);var u=a(qe,2),xe=l(u),ge=a(xe,2);s(u),s(B);var U=a(B,2);{var De=_=>{var K=_n(),q=a(l(K),2),z=l(q),ke=a(l(z),2);Ce(ke),s(z);var Je=a(z,2),tt=a(l(Je),2);Ce(tt),s(Je);var Ge=a(Je,2),ze=a(l(Ge),2);Ce(ze),s(Ge),s(q),s(K),Ne(ke,()=>e(re),ve=>r(re,ve)),L("change",ke,w),Ne(tt,()=>e(be),ve=>r(be,ve)),L("change",tt,w),Ne(ze,()=>e(Oe),ve=>r(Oe,ve)),L("change",ze,w),c(_,K)};b(U,_=>{e(Ve)&&_(De)})}var Me=a(U,2);{var we=_=>{var K=yn();c(_,K)};b(Me,_=>{e(Ie)||_(we)})}var Le=a(Me,2),le=l(Le);Ba(le,_=>r(pe,_),()=>e(pe));var Ee=a(le,2);{var _e=_=>{var K=xn(),q=a(l(K),2),z=l(q),ke=a(l(z),2);Ce(ke),s(z);var Je=a(z,2),tt=a(l(Je),2);Ce(tt),s(Je);var Ge=a(Je,2),ze=a(l(Ge),2);Ce(ze),s(Ge);var ve=a(Ge,2),E=a(l(ve),2);Ce(E),s(ve);var Te=a(ve,2),ot=a(l(Te),2);Ce(ot),s(Te);var Xe=a(Te,2),ct=a(l(Xe),2);Ce(ct),s(Xe),s(q);var te=a(q,2),j=l(te),Ke=l(j);s(j);var H=a(j,2);s(te),s(K),C(()=>{j.disabled=!e(Ie),S(Ke,`Roll ${e(D)??""}`)}),Ne(ke,()=>e($e),Q=>r($e,Q)),Ne(tt,()=>e(Pe),Q=>r(Pe,Q)),Ne(ze,()=>e(R),Q=>r(R,Q)),Ne(E,()=>e(T),Q=>r(T,Q)),Ne(ot,()=>e(x),Q=>r(x,Q)),Ne(ct,()=>e(W),Q=>r(W,Q)),L("click",j,P),L("click",H,N),c(_,K)};b(Ee,_=>{y()||_(_e)})}s(Le);var We=a(Le,2);let Qe;var et=l(We);{var dt=_=>{var K=Fn(),q=je(K),z=l(q);{var ke=Q=>{var X=kn(),at=l(X,!0);s(X),C(()=>S(at,J()?`${J()} - Healing`:"Healing")),c(Q,X)},Je=Q=>{var X=bt(),at=je(X);{var Fe=Ae=>{var lt=wn(),St=l(lt,!0);s(lt),C(()=>S(St,J()?`${J()} - ${ne()} Damage`:`${ne()} Damage`)),c(Ae,lt)},_t=Ae=>{var lt=bt(),St=je(lt);{var Ut=ft=>{var st=$n(),Rt=l(st,!0);s(st),C(()=>S(Rt,J()?`${J()} - Damage`:"Damage")),c(ft,st)},Lt=ft=>{var st=Sn(),Rt=l(st,!0);s(st),C(()=>S(Rt,J()?`${J()} - Result`:"Result")),c(ft,st)};b(St,ft=>{F()==="damage"?ft(Ut):ft(Lt,!1)},!0)}c(Ae,lt)};b(at,Ae=>{F()==="damage"&&ne()?Ae(Fe):Ae(_t,!1)},!0)}c(Q,X)};b(z,Q=>{F()==="damage"&&ne()==="Healing"?Q(ke):Q(Je,!1)})}var tt=a(z,2);{var Ge=Q=>{var X=Cn();c(Q,X)};b(tt,Q=>{e(Z)&&Q(Ge)})}var ze=a(tt,2);{var ve=Q=>{var X=Dn();c(Q,X)};b(ze,Q=>{e(Ue)&&Q(ve)})}s(q);var E=a(q,2),Te=l(E,!0);s(E);var ot=a(E,2),Xe=l(ot);{var ct=Q=>{var X=bt(),at=je(X);{var Fe=Ae=>{var lt=jn();$t(lt,5,()=>(e(Y),O(y()),O(se()),n(()=>ye(e(Y),y(),se()))),Dt,(St,Ut)=>{var Lt=Ln(),ft=l(Lt),st=l(ft,!0);s(ft);var Rt=a(ft,2),ea=l(Rt);s(Rt),s(Lt),C(()=>{S(st,(e(Ut),n(()=>e(Ut).display))),S(ea,`(${e(Ut),n(()=>e(Ut).source)??""})`)}),c(St,Lt)}),s(lt),c(Ae,lt)},_t=Ae=>{var lt=bt(),St=je(lt);{var Ut=Lt=>{var ft=An(),st=l(ft);s(ft),C(()=>S(st,`Modifier: ${e(Y),n(()=>e(Y).constant>=0?"+":"")??""}${e(Y),n(()=>e(Y).constant)??""}`)),c(Lt,ft)};b(St,Lt=>{e(Y),n(()=>e(Y).constant)&&Lt(Ut)},!0)}c(Ae,lt)};b(at,Ae=>{O(se()),n(()=>se().length>0)?Ae(Fe):Ae(_t,!1)})}c(Q,X)};b(Xe,Q=>{e(Y),O(se()),n(()=>e(Y).constant||se().length>0)&&Q(ct)})}s(ot);var te=a(ot,2);{var j=Q=>{var X=Bn();c(Q,X)};b(te,Q=>{e(Ue)&&Q(j)})}var Ke=a(te,2);{var H=Q=>{var X=Tn(),at=l(X);$t(at,1,()=>e(A),Dt,(Ae,lt)=>{var St=Rn(),Ut=l(St,!0);s(St),C(()=>S(Ut,(e(lt),n(()=>e(lt).label)))),L("click",St,()=>rt(e(lt).notation,"damage")),c(Ae,St)});var Fe=a(at,2);{var _t=Ae=>{var lt=Mn();C(()=>{lt.disabled=e(m)<=0,it(lt,"title",e(m)<=0?"No Channel Divinity uses remaining":"Use Channel Divinity to add +10 to this attack roll")}),L("click",lt,oe),c(Ae,lt)};b(Fe,Ae=>{e(p)&&F()==="attack"&&!e(Be)&&e(m)>0&&!e(Ue)&&Ae(_t)})}s(X),c(Q,X)};b(Ke,Q=>{e(A),e(p),O(F()),e(Be),e(m),n(()=>e(A).length>0||e(p)&&F()==="attack"&&!e(Be)&&e(m)>0)&&Q(H)})}C(()=>S(Te,(e(Y),n(()=>e(Y).resultTotal)))),c(_,K)};b(et,_=>{e(Y)&&_(dt)})}s(We),s(ce),s(he),C(()=>{ie=Bt(he,1,"modal-overlay svelte-1r90jgp",null,ie,{hidden:!V()}),Qe=Bt(We,1,"roll-result svelte-1r90jgp",null,Qe,{"has-result":e(Y)})}),L("click",xe,G),L("click",ge,me),L("click",ce,os(function(_){wa.call(this,o,_)})),L("keydown",ce,function(_){wa.call(this,o,_)}),L("click",he,me),L("keydown",he,_=>_.key==="Escape"&&me()),c(i,he),dl(o,"getLastRollTotal",He);var ue=Vt(ee);return d(),ue}const qa="https://api.github.com/gists";async function En(i,o,t){if(!o)throw new Error("GitHub token is required");const v=JSON.stringify(i,null,2),d=`${i.name||"character"}_dnd.json`,p={description:t||`D&D Character: ${i.name}`,public:!1,files:{[d]:{content:v}}},m=await fetch(qa,{method:"POST",headers:{Authorization:`token ${o}`,"Content-Type":"application/json"},body:JSON.stringify(p)});if(!m.ok)throw new Error(`Failed to create gist: ${m.statusText}`);return(await m.json()).id}async function Hn(i,o,t){if(!o||!t)throw new Error("GitHub token and Gist ID are required");const v=JSON.stringify(i,null,2),p={files:{[`${i.name||"character"}_dnd.json`]:{content:v}}},m=await fetch(`${qa}/${t}`,{method:"PATCH",headers:{Authorization:`token ${o}`,"Content-Type":"application/json"},body:JSON.stringify(p)});if(!m.ok)throw new Error(`Failed to update gist: ${m.statusText}`)}async function Un(i,o){if(!i)throw new Error("Gist ID is required");const t={"Content-Type":"application/json"};o&&(t.Authorization=`token ${o}`);const v=await fetch(`${qa}/${i}`,{method:"GET",headers:t});if(!v.ok)throw new Error(`Failed to load gist: ${v.statusText}`);const d=await v.json(),p=Object.values(d.files);if(p.length===0)throw new Error("No files found in gist");const D=p[0].content;try{const h=JSON.parse(D);return h.attacks&&Array.isArray(h.attacks)&&(h.attacks=h.attacks.map(y=>({...y,id:y.id||crypto.randomUUID()}))),h.classFeatures?(h.classFeatures.features||(h.classFeatures.features={}),h.classFeatures.spellSlots||(h.classFeatures.spellSlots=[]),h.classFeatures.preparedSpells===void 0&&(h.classFeatures.preparedSpells="")):h.classFeatures={features:{},spellSlots:[],preparedSpells:""},h}catch{throw new Error("Invalid character data in gist")}}function ys(i){typeof window<"u"&&localStorage.setItem("dnd_gist_config",JSON.stringify(i))}function Nn(){if(typeof window<"u"){const i=localStorage.getItem("dnd_gist_config");if(i)return JSON.parse(i)}return{}}async function On(i,o=30){if(!i)throw new Error("GitHub token is required to list gists");const t=await fetch(`${qa}?per_page=${o}`,{method:"GET",headers:{Authorization:`token ${i}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error(`Failed to list gists: ${t.statusText}`);return await t.json()}var Gn=f('<div class="error-message svelte-1jb5ckg"> </div>'),qn=f('<div class="toggle-container svelte-1jb5ckg"><button type="button" class="toggle-btn svelte-1jb5ckg"> </button></div>'),Wn=f('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID (leave empty to create new)</label> <input type="text" id="gistId" placeholder="Optional: existing Gist ID to update" class="svelte-1jb5ckg"/></div>'),zn=f('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),Kn=f('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),Vn=f('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Update (or leave unselected to create new)</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),Jn=f('<div class="info-message svelte-1jb5ckg">No gists found. A new one will be created.</div>'),Yn=f('<!> <div class="form-group svelte-1jb5ckg"><label for="description" class="svelte-1jb5ckg"> </label> <input type="text" id="description" placeholder="D&amp;D Character Sheet" class="svelte-1jb5ckg"/></div>',1),Qn=f('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID *</label> <input type="text" id="gistId" placeholder="Enter Gist ID (for public or your private gists)" required class="svelte-1jb5ckg"/></div>'),Xn=f('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),Zn=f('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),er=f('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Load</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),tr=f('<div class="info-message svelte-1jb5ckg">No gists found. Enter a Gist ID manually or create a new one in Save mode.</div>'),ar=f('<div class="modal-overlay svelte-1jb5ckg" role="button" tabindex="-1"><div class="modal-content svelte-1jb5ckg" role="dialog" tabindex="0"><div class="modal-header svelte-1jb5ckg"><h2 class="svelte-1jb5ckg"> </h2> <button class="close-btn svelte-1jb5ckg">√ó</button></div> <div class="modal-body svelte-1jb5ckg"><!> <div class="form-group svelte-1jb5ckg"><label for="token" class="svelte-1jb5ckg"> <a href="https://github.com/settings/tokens" target="_blank" rel="noopener" class="svelte-1jb5ckg">Get token</a></label> <input type="password" id="token" placeholder="ghp_xxxxxxxxxxxxx" class="svelte-1jb5ckg"/></div> <!> <!> <div class="modal-actions svelte-1jb5ckg"><button class="btn btn-primary svelte-1jb5ckg"><!></button> <button class="btn btn-secondary svelte-1jb5ckg">Cancel</button></div></div></div></div>');function sr(i,o){Kt(o,!1);const t=()=>pt(fe,"$character",v),[v,d]=ca(),p=ha();let m=wt(o,"mode",8,"save"),D=$(""),h=$(""),y=$(""),V=$(!1),M=$(""),ne=$(!1),J=$(!1),ae=$([]),se=$(null);const F=Nn();F.token&&r(D,F.token),F.gistId&&r(h,F.gistId),Sa(async()=>{e(D)&&!e(ne)&&await I()});async function I(){if(e(D)){r(J,!0),r(M,"");try{r(ae,await On(e(D))),e(h)&&r(se,e(ae).find(w=>w.id===e(h))||null)}catch(w){r(M,w.message||"Failed to load gists"),r(ae,[])}finally{r(J,!1)}}}function pe(w){r(se,w),r(h,w.id)}function Ie(){r(ne,!e(ne)),r(M,""),!e(ne)&&e(D)&&I()}async function Ze(){if(!e(D)){r(M,"GitHub token is required");return}const w=e(se)?.id||e(h);r(V,!0),r(M,"");try{if(w)await Hn(t(),e(D),w),r(h,w),Ht.add("Character updated in Gist successfully!","success");else{const G=await En(t(),e(D),e(y));r(h,G),Ht.add(`Character saved to Gist! ID: ${G}`,"success")}ys({token:e(D),gistId:e(h)}),p("close")}catch(G){r(M,G.message||"Failed to save to Gist")}finally{r(V,!1)}}async function Y(){const w=e(se)?.id||e(h);if(!w){r(M,"Please select a gist or enter a Gist ID");return}r(V,!0),r(M,"");try{const G=await Un(w,e(D)||void 0);fe.set(G),r(h,w),ys({token:e(D),gistId:e(h)}),Ht.add("Character loaded from Gist successfully!","success"),p("close")}catch(G){r(M,G.message||"Failed to load from Gist")}finally{r(V,!1)}}function He(){p("close")}zt();var ye=ar(),$e=l(ye),Pe=l($e),R=l(Pe),T=l(R,!0);s(R);var x=a(R,2);s(Pe);var W=a(Pe,2),g=l(W);{var A=w=>{var G=Gn(),oe=l(G,!0);s(G),C(()=>S(oe,e(M))),c(w,G)};b(g,w=>{e(M)&&w(A)})}var Z=a(g,2),Ue=l(Z),Be=l(Ue);Yt(),s(Ue);var re=a(Ue,2);Ce(re),s(Z);var be=a(Z,2);{var Oe=w=>{var G=qn(),oe=l(G),me=l(oe,!0);s(oe),s(G),C(()=>{oe.disabled=e(V),S(me,e(ne)?"üìã Show My Gists":"‚úèÔ∏è Enter Gist ID Manually")}),L("click",oe,Ie),c(w,G)};b(be,w=>{(m()==="load"||m()==="save"&&e(D))&&w(Oe)})}var Ve=a(be,2);{var ut=w=>{var G=Yn(),oe=je(G);{var me=qe=>{var Re=Wn(),Ye=a(l(Re),2);Ce(Ye),s(Re),C(()=>Ye.disabled=e(V)),Ne(Ye,()=>e(h),Se=>r(h,Se)),c(qe,Re)},ee=qe=>{var Re=bt(),Ye=je(Re);{var Se=xe=>{var ge=zn();c(xe,ge)},u=xe=>{var ge=bt(),U=je(ge);{var De=we=>{var Le=Vn(),le=a(l(Le),2);$t(le,5,()=>e(ae),Dt,(Ee,_e)=>{var We=Kn();let Qe;var et=l(We),dt=l(et),ue=l(dt,!0);s(dt);var _=a(dt,2),K=l(_,!0);s(_),s(et);var q=a(et,2),z=l(q),ke=l(z);s(z);var Je=a(z,2),tt=l(Je);s(Je),s(q),s(We),C(Ge=>{Qe=Bt(We,1,"gist-item svelte-1jb5ckg",null,Qe,{selected:e(se)?.id===e(_e).id}),We.disabled=e(V),S(ue,(e(_e),n(()=>e(_e).description||"Untitled"))),S(K,(e(_e),n(()=>e(_e).public?"üåê Public":"üîí Private"))),S(ke,`ID: ${e(_e),n(()=>e(_e).id)??""}`),S(tt,`Updated: ${Ge??""}`)},[()=>(e(_e),n(()=>new Date(e(_e).updated_at).toLocaleDateString()))]),L("click",We,()=>pe(e(_e))),c(Ee,We)}),s(le),s(Le),c(we,Le)},Me=we=>{var Le=bt(),le=je(Le);{var Ee=_e=>{var We=Jn();c(_e,We)};b(le,_e=>{e(D)&&_e(Ee)},!0)}c(we,Le)};b(U,we=>{e(ae),n(()=>e(ae).length>0)?we(De):we(Me,!1)},!0)}c(xe,ge)};b(Ye,xe=>{e(J)?xe(Se):xe(u,!1)},!0)}c(qe,Re)};b(oe,qe=>{e(ne)||!e(D)?qe(me):qe(ee,!1)})}var he=a(oe,2),ie=l(he),ce=l(ie);s(ie);var B=a(ie,2);Ce(B),s(he),C(()=>{S(ce,`Description ${e(h)?"(optional)":""}`),B.disabled=e(V)}),Ne(B,()=>e(y),qe=>r(y,qe)),c(w,G)},mt=w=>{var G=bt(),oe=je(G);{var me=he=>{var ie=Qn(),ce=a(l(ie),2);Ce(ce),s(ie),C(()=>ce.disabled=e(V)),Ne(ce,()=>e(h),B=>r(h,B)),c(he,ie)},ee=he=>{var ie=bt(),ce=je(ie);{var B=Re=>{var Ye=Xn();c(Re,Ye)},qe=Re=>{var Ye=bt(),Se=je(Ye);{var u=ge=>{var U=er(),De=a(l(U),2);$t(De,5,()=>e(ae),Dt,(Me,we)=>{var Le=Zn();let le;var Ee=l(Le),_e=l(Ee),We=l(_e,!0);s(_e);var Qe=a(_e,2),et=l(Qe,!0);s(Qe),s(Ee);var dt=a(Ee,2),ue=l(dt),_=l(ue);s(ue);var K=a(ue,2),q=l(K);s(K),s(dt),s(Le),C(z=>{le=Bt(Le,1,"gist-item svelte-1jb5ckg",null,le,{selected:e(se)?.id===e(we).id}),Le.disabled=e(V),S(We,(e(we),n(()=>e(we).description||"Untitled"))),S(et,(e(we),n(()=>e(we).public?"üåê Public":"üîí Private"))),S(_,`ID: ${e(we),n(()=>e(we).id)??""}`),S(q,`Updated: ${z??""}`)},[()=>(e(we),n(()=>new Date(e(we).updated_at).toLocaleDateString()))]),L("click",Le,()=>pe(e(we))),c(Me,Le)}),s(De),s(U),c(ge,U)},xe=ge=>{var U=bt(),De=je(U);{var Me=we=>{var Le=tr();c(we,Le)};b(De,we=>{e(D)&&we(Me)},!0)}c(ge,U)};b(Se,ge=>{e(ae),n(()=>e(ae).length>0)?ge(u):ge(xe,!1)},!0)}c(Re,Ye)};b(ce,Re=>{e(J)?Re(B):Re(qe,!1)},!0)}c(he,ie)};b(oe,he=>{e(ne)||!e(D)?he(me):he(ee,!1)},!0)}c(w,G)};b(Ve,w=>{m()==="save"?w(ut):w(mt,!1)})}var gt=a(Ve,2),rt=l(gt),k=l(rt);{var P=w=>{var G=At();C(()=>S(G,m()==="save"?"Saving...":"Loading...")),c(w,G)},de=w=>{var G=At();C(()=>S(G,m()==="save"?"Save":"Load")),c(w,G)};b(k,w=>{e(V)?w(P):w(de,!1)})}s(rt);var N=a(rt,2);s(gt),s(W),s($e),s(ye),C(()=>{S(T,m()==="save"?"Save to GitHub Gist":"Load from GitHub Gist"),S(Be,`GitHub Token ${m()==="load"?"(optional for public gists)":"(required)"} `),re.disabled=e(V),rt.disabled=e(V),N.disabled=e(V)}),L("click",x,He),Ne(re,()=>e(D),w=>r(D,w)),L("blur",re,()=>{e(D)&&!e(ne)&&I()}),L("click",rt,function(...w){(m()==="save"?Ze:Y)?.apply(this,w)}),L("click",N,He),L("click",$e,os(function(w){wa.call(this,o,w)})),L("keydown",$e,function(w){wa.call(this,o,w)}),L("click",ye,He),L("keydown",ye,w=>w.key==="Escape"&&He()),c(i,ye),Vt(),d()}var lr=f('<div class="loading svelte-1ngjemu">Loading D&D data...</div>'),ir=f("<option> </option>"),nr=f('<select class="level-filter svelte-1ngjemu"><option>All Levels</option><option>Cantrip</option><!></select>'),rr=f('<div class="no-results svelte-1ngjemu"> </div>'),or=f('<div class="item-meta svelte-1ngjemu"> </div>'),cr=f('<div class="item-meta svelte-1ngjemu"> </div>'),vr=f('<button><div class="item-name svelte-1ngjemu"> </div> <!></button>'),dr=f('<p class="higher-levels"><strong>At Higher Levels:</strong> </p>'),ur=f('<p class="cantrip-upgrade"><strong>Cantrip Upgrade:</strong> </p>'),fr=f('<h3 class="svelte-1ngjemu"> </h3> <p class="spell-meta svelte-1ngjemu"><!> <!></p> <p class="spell-classes"><strong>Classes:</strong> </p> <div class="spell-stats svelte-1ngjemu"><div><strong>Casting Time:</strong> </div> <div><strong>Range:</strong> </div> <div><strong>Components:</strong> <!></div> <div><strong>Duration:</strong> <!> </div></div> <p class="description svelte-1ngjemu"> </p> <!> <!>',1),pr=f('<p class="prerequisite svelte-1ngjemu"><strong>Prerequisite:</strong> </p>'),mr=f('<h3 class="svelte-1ngjemu"> </h3> <!> <p class="description svelte-1ngjemu"> </p> <a target="_blank" rel="noopener" class="source-link svelte-1ngjemu">View Full Details ‚Üí</a>',1),gr=f('<div class="item-details svelte-1ngjemu"><!></div>'),br=f('<div class="controls svelte-1ngjemu"><div class="tabs svelte-1ngjemu"><button> </button> <button> </button></div> <div class="search-controls svelte-1ngjemu"><input type="text" placeholder="Search by name or description..." class="search-input svelte-1ngjemu"/> <!></div></div> <div class="content-container svelte-1ngjemu"><div class="items-list svelte-1ngjemu"><!></div> <!></div>',1),hr=f('<div class="modal-backdrop svelte-1ngjemu" role="presentation"><div class="modal svelte-1ngjemu" role="dialog" aria-modal="true" tabindex="-1"><div class="modal-header svelte-1ngjemu"><h2 class="svelte-1ngjemu">Browse D&D Spells & Feats</h2> <button class="close-btn svelte-1ngjemu" aria-label="Close">&times;</button></div> <div class="modal-body svelte-1ngjemu"><!></div> <div class="modal-footer svelte-1ngjemu"><button class="btn-secondary svelte-1ngjemu">Cancel</button> <button class="btn-primary svelte-1ngjemu">Add to Character Sheet</button></div></div></div>');function _r(i,o){Kt(o,!1);const t=$(),v=$(),d=$();let p=wt(o,"onClose",8),m=$("spell"),D=$(!0),h=$(""),y=$(null),V=$([]),M=$([]),ne=$(null);Sa(async()=>{r(D,!0);try{r(V,await As()),r(M,await Xl())}catch(x){console.error("Failed to load data:",x)}finally{r(D,!1)}});function J(x){r(ne,x)}function ae(x){const W=x.match(/(\d+d\d+(?:\s*\+\s*\d+)?)/i);return W?W[1]:""}function se(x){const W=x.split(/\.( |$)/)[0].trim(),g=Array.from(x.matchAll(/\*\*(.*?)\*\*/g)).map(Z=>Z[1].replace(/\.$/,""));let A=W;return g.length&&(A+=" | Effects: "+g.join(", ")),A}function F(){if(e(ne)){if(e(m)==="spell"){const x=e(ne);fe.update(W=>{const A=[];x.range&&A.push(`Range: ${x.range}`),x.castingTime&&A.push(`Cast: ${x.castingTime}`),x.duration&&A.push(`Duration: ${x.duration}`),x.actionType==="Save"&&A.push("Saving throw spell"),x.components&&x.components.length>0&&A.push(`Components: ${x.components.join(", ")}`),x.material&&A.push(`Material: ${x.material}`);const Z=A.join(" | "),Ue=se(x.description),Be={id:crypto.randomUUID(),name:`${x.name}${x.concentration?" (C)":""}${x.ritual?" (R)":""}`,bonus:x.actionType==="Attack"?5:0,damage:ae(x.description),damageType:`${x.school} (Lvl ${x.level})`,spellRef:x.name,infoNotes:Z,generalNotes:Ue,castAtLevel:x.level};return W.attacks=[...W.attacks,Be],W})}else if(e(m)==="feat"){const x=e(ne);fe.update(W=>{const g=`${x.name}${x.prerequisite?` (Req: ${x.prerequisite})`:""}
${x.description}
`;return W.features=W.features?`${W.features}
${g}`:g,W})}r(ne,null),p()()}}nt(()=>(e(y),e(V),e(h)),()=>{r(t,e(y)!==null?Zl(bs(e(V),e(h)),e(y)):bs(e(V),e(h)))}),nt(()=>(e(M),e(h)),()=>{r(v,ei(e(M),e(h)))}),nt(()=>(e(m),e(t),e(v)),()=>{r(d,e(m)==="spell"?e(t):e(v))}),ua(),zt();var I=hr(),pe=l(I),Ie=l(pe),Ze=a(l(Ie),2);s(Ie);var Y=a(Ie,2),He=l(Y);{var ye=x=>{var W=lr();c(x,W)},$e=x=>{var W=br(),g=je(W),A=l(g),Z=l(A);let Ue;var Be=l(Z);s(Z);var re=a(Z,2);let be;var Oe=l(re);s(re),s(A);var Ve=a(A,2),ut=l(Ve);Ce(ut);var mt=a(ut,2);{var gt=oe=>{var me=nr();C(()=>{e(y),Et(()=>{})});var ee=l(me);ee.value=(ee.__value=null)??"";var he=a(ee);he.value=he.__value=0;var ie=a(he);$t(ie,0,()=>[1,2,3,4,5,6,7,8,9],Dt,(ce,B)=>{var qe=ir(),Re=l(qe);s(qe);var Ye={};C(()=>{S(Re,`Level ${B??""}`),Ye!==(Ye=B)&&(qe.value=(qe.__value=B)??"")}),c(ce,qe)}),s(me),Ra(me,()=>e(y),ce=>r(y,ce)),c(oe,me)};b(mt,oe=>{e(m)==="spell"&&oe(gt)})}s(Ve),s(g);var rt=a(g,2),k=l(rt),P=l(k);{var de=oe=>{var me=rr(),ee=l(me);s(me),C(()=>S(ee,`No ${e(m)??""}s found`)),c(oe,me)},N=oe=>{var me=bt(),ee=je(me);$t(ee,1,()=>e(d),Dt,(he,ie)=>{var ce=vr();let B;var qe=l(ce),Re=l(qe,!0);s(qe);var Ye=a(qe,2);{var Se=xe=>{const ge=yt(()=>e(ie));var U=or(),De=l(U);s(U),C(()=>S(De,`Level ${O(e(ge)),n(()=>e(ge).level)??""} ‚Ä¢ ${O(e(ge)),n(()=>e(ge).school)??""}`)),c(xe,U)},u=xe=>{const ge=yt(()=>e(ie));var U=bt(),De=je(U);{var Me=we=>{var Le=cr(),le=l(Le,!0);s(Le),C(()=>S(le,(O(e(ge)),n(()=>e(ge).prerequisite)))),c(we,Le)};b(De,we=>{O(e(ge)),n(()=>e(ge).prerequisite)&&we(Me)})}c(xe,U)};b(Ye,xe=>{e(m)==="spell"?xe(Se):xe(u,!1)})}s(ce),C(()=>{B=Bt(ce,1,"item-card svelte-1ngjemu",null,B,{selected:e(ne)?.name===e(ie).name}),S(Re,(e(ie),n(()=>e(ie).name)))}),L("click",ce,()=>J(e(ie))),c(he,ce)}),c(oe,me)};b(P,oe=>{e(d),n(()=>e(d).length===0)?oe(de):oe(N,!1)})}s(k);var w=a(k,2);{var G=oe=>{var me=gr(),ee=l(me);{var he=ce=>{const B=yt(()=>e(ne));var qe=fr(),Re=je(qe),Ye=l(Re,!0);s(Re);var Se=a(Re,2),u=l(Se);{var xe=E=>{var Te=At();C(()=>S(Te,`${O(e(B)),n(()=>e(B).school)??""} cantrip`)),c(E,Te)},ge=E=>{var Te=At();C(()=>S(Te,`Level ${O(e(B)),n(()=>e(B).level)??""} ${O(e(B)),n(()=>e(B).school)??""}`)),c(E,Te)};b(u,E=>{O(e(B)),n(()=>e(B).level===0)?E(xe):E(ge,!1)})}var U=a(u,2);{var De=E=>{var Te=At("(ritual)");c(E,Te)};b(U,E=>{O(e(B)),n(()=>e(B).ritual)&&E(De)})}s(Se);var Me=a(Se,2),we=a(l(Me));s(Me);var Le=a(Me,2),le=l(Le),Ee=a(l(le));s(le);var _e=a(le,2),We=a(l(_e));s(_e);var Qe=a(_e,2),et=a(l(Qe)),dt=a(et);{var ue=E=>{var Te=At();C(()=>S(Te,`(${O(e(B)),n(()=>e(B).material)??""})`)),c(E,Te)};b(dt,E=>{O(e(B)),n(()=>e(B).material)&&E(ue)})}s(Qe);var _=a(Qe,2),K=a(l(_),2);{var q=E=>{var Te=At("Concentration,");c(E,Te)};b(K,E=>{O(e(B)),n(()=>e(B).concentration)&&E(q)})}var z=a(K,1,!0);s(_),s(Le);var ke=a(Le,2),Je=l(ke,!0);s(ke);var tt=a(ke,2);{var Ge=E=>{var Te=dr(),ot=a(l(Te));s(Te),C(()=>S(ot,` ${O(e(B)),n(()=>e(B).higherLevelSlot)??""}`)),c(E,Te)};b(tt,E=>{O(e(B)),n(()=>e(B).higherLevelSlot)&&E(Ge)})}var ze=a(tt,2);{var ve=E=>{var Te=ur(),ot=a(l(Te));s(Te),C(()=>S(ot,` ${O(e(B)),n(()=>e(B).cantripUpgrade)??""}`)),c(E,Te)};b(ze,E=>{O(e(B)),n(()=>e(B).cantripUpgrade)&&E(ve)})}C((E,Te)=>{S(Ye,(O(e(B)),n(()=>e(B).name))),S(we,` ${E??""}`),S(Ee,` ${O(e(B)),n(()=>e(B).castingTime||e(B).actionType)??""}`),S(We,` ${O(e(B)),n(()=>e(B).range)??""}`),S(et,` ${Te??""}`),S(z,(O(e(B)),n(()=>e(B).duration))),S(Je,(O(e(B)),n(()=>e(B).description)))},[()=>(O(e(B)),n(()=>e(B).classes.join(", "))),()=>(O(e(B)),n(()=>e(B).components.join(", ").toUpperCase()))]),c(ce,qe)},ie=ce=>{const B=yt(()=>e(ne));var qe=mr(),Re=je(qe),Ye=l(Re,!0);s(Re);var Se=a(Re,2);{var u=De=>{var Me=pr(),we=a(l(Me));s(Me),C(()=>S(we,` ${O(e(B)),n(()=>e(B).prerequisite)??""}`)),c(De,Me)};b(Se,De=>{O(e(B)),n(()=>e(B).prerequisite)&&De(u)})}var xe=a(Se,2),ge=l(xe,!0);s(xe);var U=a(xe,2);C(()=>{S(Ye,(O(e(B)),n(()=>e(B).name))),S(ge,(O(e(B)),n(()=>e(B).description))),it(U,"href",(O(e(B)),n(()=>e(B).source)))}),c(ce,qe)};b(ee,ce=>{e(m)==="spell"?ce(he):ce(ie,!1)})}s(me),c(oe,me)};b(w,oe=>{e(ne)&&oe(G)})}s(rt),C(()=>{Ue=Bt(Z,1,"tab svelte-1ngjemu",null,Ue,{active:e(m)==="spell"}),S(Be,`üìú Spells (${e(V),n(()=>e(V).length)??""})`),be=Bt(re,1,"tab svelte-1ngjemu",null,be,{active:e(m)==="feat"}),S(Oe,`‚≠ê Feats (${e(M),n(()=>e(M).length)??""})`)}),L("click",Z,()=>{r(m,"spell"),r(ne,null),r(h,"")}),L("click",re,()=>{r(m,"feat"),r(ne,null),r(h,"")}),Ne(ut,()=>e(h),oe=>r(h,oe)),c(x,W)};b(He,x=>{e(D)?x(ye):x($e,!1)})}s(Y);var Pe=a(Y,2),R=l(Pe),T=a(R,2);s(Pe),s(pe),s(I),C(()=>T.disabled=!e(ne)),L("click",Ze,function(...x){p()?.apply(this,x)}),L("click",R,function(...x){p()?.apply(this,x)}),L("click",T,F),L("click",pe,os(function(x){wa.call(this,o,x)})),L("keydown",pe,function(x){wa.call(this,o,x)}),L("click",I,function(...x){p()?.apply(this,x)}),L("keydown",I,x=>x.key==="Escape"&&p()()),c(i,I),Vt()}var yr=f('<span class="resistance-tag svelte-gdwwx1"> <button type="button" class="tag-remove svelte-gdwwx1">√ó</button></span>'),xr=f('<div class="resistance-list svelte-gdwwx1"></div>'),kr=f('<p class="ability-meta svelte-gdwwx1"> <!></p>'),wr=f('<p class="ability-meta svelte-gdwwx1">Requires Reaction</p>'),$r=f('<div class="ability-card svelte-gdwwx1"><div class="ability-header svelte-gdwwx1"><strong class="svelte-gdwwx1"> </strong> <button type="button" class="ability-remove svelte-gdwwx1">√ó</button></div> <p class="ability-description svelte-gdwwx1"> </p> <!></div>'),Sr=f('<div class="abilities-list svelte-gdwwx1"></div>'),Cr=f(`<div class="modal-backdrop svelte-gdwwx1" role="presentation"><div class="modal-content svelte-gdwwx1" role="dialog" aria-modal="true" aria-labelledby="modal-title"><div class="modal-header svelte-gdwwx1"><h3 id="modal-title" class="svelte-gdwwx1">Add Custom Condition</h3> <button class="btn-close svelte-gdwwx1" aria-label="Close">√ó</button></div> <div class="modal-body svelte-gdwwx1"><div class="form-group svelte-gdwwx1"><label for="conditionName" class="svelte-gdwwx1">Condition Name*</label> <input type="text" id="conditionName" placeholder="e.g., Cazna's Mark" class="svelte-gdwwx1"/></div> <div class="form-group svelte-gdwwx1"><label for="description" class="svelte-gdwwx1">Description</label> <textarea id="description" placeholder="Describe the condition..." rows="3" class="svelte-gdwwx1"></textarea></div> <div class="form-row svelte-gdwwx1"><div class="form-group svelte-gdwwx1"><label for="attackBonus" class="svelte-gdwwx1">Attack Bonus</label> <input type="text" id="attackBonus" placeholder="0 or 1d4" class="svelte-gdwwx1"/></div> <div class="form-group svelte-gdwwx1"><label for="damageBonus" class="svelte-gdwwx1">Damage Bonus</label> <input type="text" id="damageBonus" placeholder="0 or 1d6" class="svelte-gdwwx1"/></div> <div class="form-group svelte-gdwwx1"><label for="acBonus" class="svelte-gdwwx1">AC Bonus</label> <input type="number" id="acBonus" placeholder="0" class="svelte-gdwwx1"/></div></div> <div class="form-group svelte-gdwwx1"><label for="darkvision" class="svelte-gdwwx1">Darkvision (feet)</label> <input type="number" id="darkvision" placeholder="0" min="0" step="30" class="svelte-gdwwx1"/> <small class="help-text svelte-gdwwx1">Grant or extend darkvision (e.g., 60 for 60 feet)</small></div> <div class="form-group svelte-gdwwx1"><label class="svelte-gdwwx1">Damage Resistances</label> <div class="resistance-input-group svelte-gdwwx1"><input type="text" placeholder="e.g., cold, fire, poison" class="svelte-gdwwx1"/> <button type="button" class="btn-add svelte-gdwwx1">Add</button></div> <!></div> <div class="form-group svelte-gdwwx1"><label class="svelte-gdwwx1">Special Abilities</label> <div class="ability-form svelte-gdwwx1"><input type="text" placeholder="Ability name (e.g., Flicker of Deceit)" class="ability-name-input svelte-gdwwx1"/> <textarea placeholder="Ability description..." rows="2" class="ability-desc-input svelte-gdwwx1"></textarea> <div class="ability-options svelte-gdwwx1"><div class="ability-option svelte-gdwwx1"><label for="abilityUses" class="svelte-gdwwx1">Uses per rest</label> <input type="number" id="abilityUses" min="0" class="svelte-gdwwx1"/></div> <div class="ability-option svelte-gdwwx1"><label for="restType" class="svelte-gdwwx1">Rest type</label> <select id="restType" class="svelte-gdwwx1"><option>Short</option><option>Long</option></select></div> <div class="ability-option svelte-gdwwx1"><label class="svelte-gdwwx1"><input type="checkbox" class="svelte-gdwwx1"/> Requires Reaction</label></div></div> <button type="button" class="btn-add svelte-gdwwx1">Add Ability</button></div> <!></div></div> <div class="modal-footer svelte-gdwwx1"><button class="btn btn-secondary svelte-gdwwx1">Cancel</button> <button class="btn btn-primary svelte-gdwwx1">Add Condition</button></div></div></div>`);function Dr(i,o){Kt(o,!1);let t=wt(o,"show",8,!1),v=wt(o,"onSave",8),d=wt(o,"onCancel",8),p=$(""),m=$(""),D=$(0),h=$(0),y=$(0),V=$(0),M=$([]),ne=$(""),J=$([]),ae=$(""),se=$(""),F=$(0),I=$("short"),pe=$(!1);function Ie(){r(p,""),r(m,""),r(D,0),r(h,0),r(y,0),r(V,0),r(M,[]),r(ne,""),r(J,[]),r(ae,""),r(se,""),r(F,0),r(I,"short"),r(pe,!1)}function Ze(){e(ne).trim()&&(r(M,[...e(M),e(ne).trim()]),r(ne,""))}function Y(g){r(M,e(M).filter((A,Z)=>Z!==g))}function He(){if(e(ae).trim()&&e(se).trim()){const g={name:e(ae).trim(),description:e(se).trim(),requiresReaction:e(pe)};e(F)>0&&(g.usesPerRest=e(F),g.currentUses=e(F),g.restType=e(I)),r(J,[...e(J),g]),r(ae,""),r(se,""),r(F,0),r(I,"short"),r(pe,!1)}}function ye(g){r(J,e(J).filter((A,Z)=>Z!==g))}function $e(){if(!e(p).trim()){alert("Please enter a condition name");return}const g={name:e(p).trim(),description:e(m).trim()||"Custom condition",attackBonus:e(D)||0,damageBonus:e(h)||0,target:"self"};e(y)!==0&&(g.acBonus=e(y)),e(V)>0&&(g.darkvision=e(V)),e(M).length>0&&(g.resistances=e(M)),e(J).length>0&&(g.abilities=e(J)),v()(g),Ie()}function Pe(){Ie(),d()()}function R(g){g.target===g.currentTarget&&Pe()}zt();var T=bt(),x=je(T);{var W=g=>{var A=Cr(),Z=l(A),Ue=l(Z),Be=a(l(Ue),2);s(Ue);var re=a(Ue,2),be=l(re),Oe=a(l(be),2);Ce(Oe),s(be);var Ve=a(be,2),ut=a(l(Ve),2);xa(ut),s(Ve);var mt=a(Ve,2),gt=l(mt),rt=a(l(gt),2);Ce(rt),s(gt);var k=a(gt,2),P=a(l(k),2);Ce(P),s(k);var de=a(k,2),N=a(l(de),2);Ce(N),s(de),s(mt);var w=a(mt,2),G=a(l(w),2);Ce(G),Yt(2),s(w);var oe=a(w,2),me=a(l(oe),2),ee=l(me);Ce(ee);var he=a(ee,2);s(me);var ie=a(me,2);{var ce=ue=>{var _=xr();$t(_,5,()=>e(M),Dt,(K,q,z)=>{var ke=yr(),Je=l(ke),tt=a(Je);s(ke),C(()=>{S(Je,`${e(q)??""} `),it(tt,"aria-label",`Remove ${e(q)??""}`)}),L("click",tt,()=>Y(z)),c(K,ke)}),s(_),c(ue,_)};b(ie,ue=>{e(M),n(()=>e(M).length>0)&&ue(ce)})}s(oe);var B=a(oe,2),qe=a(l(B),2),Re=l(qe);Ce(Re);var Ye=a(Re,2);xa(Ye);var Se=a(Ye,2),u=l(Se),xe=a(l(u),2);Ce(xe),s(u);var ge=a(u,2),U=a(l(ge),2);C(()=>{e(I),Et(()=>{})});var De=l(U);De.value=De.__value="short";var Me=a(De);Me.value=Me.__value="long",s(U),s(ge);var we=a(ge,2),Le=l(we),le=l(Le);Ce(le),Yt(),s(Le),s(we),s(Se);var Ee=a(Se,2);s(qe);var _e=a(qe,2);{var We=ue=>{var _=Sr();$t(_,5,()=>e(J),Dt,(K,q,z)=>{var ke=$r(),Je=l(ke),tt=l(Je),Ge=l(tt,!0);s(tt);var ze=a(tt,2);s(Je);var ve=a(Je,2),E=l(ve,!0);s(ve);var Te=a(ve,2);{var ot=ct=>{var te=kr(),j=l(te),Ke=a(j);{var H=Q=>{var X=At("‚Ä¢ Requires Reaction");c(Q,X)};b(Ke,Q=>{e(q),n(()=>e(q).requiresReaction)&&Q(H)})}s(te),C(()=>S(j,`${e(q),n(()=>e(q).usesPerRest)??""} use${e(q),n(()=>e(q).usesPerRest>1?"s":"")??""} per ${e(q),n(()=>e(q).restType)??""}
                      rest `)),c(ct,te)},Xe=ct=>{var te=bt(),j=je(te);{var Ke=H=>{var Q=wr();c(H,Q)};b(j,H=>{e(q),n(()=>e(q).requiresReaction)&&H(Ke)},!0)}c(ct,te)};b(Te,ct=>{e(q),n(()=>e(q).usesPerRest)?ct(ot):ct(Xe,!1)})}s(ke),C(()=>{S(Ge,(e(q),n(()=>e(q).name))),it(ze,"aria-label",`Remove ${e(q),n(()=>e(q).name)??""}`),S(E,(e(q),n(()=>e(q).description)))}),L("click",ze,()=>ye(z)),c(K,ke)}),s(_),c(ue,_)};b(_e,ue=>{e(J),n(()=>e(J).length>0)&&ue(We)})}s(B),s(re);var Qe=a(re,2),et=l(Qe),dt=a(et,2);s(Qe),s(Z),s(A),L("click",Be,Pe),Ne(Oe,()=>e(p),ue=>r(p,ue)),Ne(ut,()=>e(m),ue=>r(m,ue)),Ne(rt,()=>e(D),ue=>r(D,ue)),Ne(P,()=>e(h),ue=>r(h,ue)),Ne(N,()=>e(y),ue=>r(y,ue)),Ne(G,()=>e(V),ue=>r(V,ue)),Ne(ee,()=>e(ne),ue=>r(ne,ue)),L("keydown",ee,ue=>ue.key==="Enter"&&Ze()),L("click",he,Ze),Ne(Re,()=>e(ae),ue=>r(ae,ue)),Ne(Ye,()=>e(se),ue=>r(se,ue)),Ne(xe,()=>e(F),ue=>r(F,ue)),Ra(U,()=>e(I),ue=>r(I,ue)),ka(le,()=>e(pe),ue=>r(pe,ue)),L("click",Ee,He),L("click",et,Pe),L("click",dt,$e),L("click",A,R),c(g,A)};b(x,g=>{t()&&g(W)})}c(i,T),Vt()}var Lr=f("<option></option>"),jr=f("<button> </button>"),Ar=f('<button class="btn btn-primary calculate-btn use-enabled svelte-uvfntf">Calculate Damage</button>'),Br=f('<div class="adjustment-msg svelte-uvfntf"> </div>'),Rr=f('<div class="calculation-result svelte-uvfntf"><div class="result-header svelte-uvfntf"><h4 class="svelte-uvfntf">Damage Calculation</h4></div> <div class="result-content svelte-uvfntf"><div class="damage-breakdown svelte-uvfntf"><div class="damage-row svelte-uvfntf"><span class="label svelte-uvfntf">Original Damage:</span> <span class="value svelte-uvfntf"> </span></div> <div class="adjustments svelte-uvfntf"></div> <div class="damage-row final svelte-uvfntf"><span class="label svelte-uvfntf">Final Damage:</span> <span class="value damage-value svelte-uvfntf"> </span></div></div></div> <div class="result-actions svelte-uvfntf"><button class="btn btn-primary apply-btn use-enabled svelte-uvfntf">Apply Damage</button> <button class="btn btn-secondary cancel-btn use-enabled svelte-uvfntf">Cancel</button></div></div>'),Mr=f('<div class="damage-form svelte-uvfntf"><div class="input-group svelte-uvfntf"><div class="input-field svelte-uvfntf"><label for="damageAmount" class="svelte-uvfntf">Damage Amount</label> <input type="number" id="damageAmount" min="0" placeholder="0" class="damage-input-field use-enabled svelte-uvfntf"/></div> <div class="input-field svelte-uvfntf"><label for="damageType" class="svelte-uvfntf">Damage Type</label> <input type="text" id="damageType" list="damageTypes" placeholder="e.g., fire, cold" class="damage-input-field use-enabled svelte-uvfntf"/> <datalist id="damageTypes"></datalist></div></div> <div class="quick-types svelte-uvfntf"><span class="quick-types-label svelte-uvfntf">Quick Select:</span> <!></div> <!></div>'),Tr=f("<section><!> <!></section>");function Fr(i,o){Kt(o,!1);const t=()=>pt(fe,"$character",p),v=()=>pt(ma,"$searchFilter",p),d=()=>pt(Qt,"$collapsedStates",p),[p,m]=ca(),D=$();ha();let h=$(0),y=$(""),V=$(!1),M=$(0),ne=$([]);const J=["slashing","piercing","bludgeoning","fire","cold","lightning","thunder","acid","poison","necrotic","radiant","psychic","force"];function ae(){if(e(h)<0){Ht.add("Damage amount cannot be negative","error");return}if(!e(y).trim()){Ht.add("Please enter or select a damage type","error");return}const He=Al(e(h),e(y),t());r(M,He.finalDamage),r(ne,He.adjustments),r(V,!0)}function se(){fe.update(He=>Bl(He,e(M))),Ht.add(`Applied ${e(M)} damage to character (${e(y)})`,"info"),r(h,0),r(y,""),r(V,!1),r(M,0),r(ne,[])}function F(){r(V,!1),r(M,0),r(ne,[])}nt(()=>v(),()=>{r(D,!v()||"damage".includes(v().toLowerCase())||"resistance".includes(v().toLowerCase())||"immune".includes(v().toLowerCase()))}),ua(),zt();var I=Tr();let pe;var Ie=l(I);{let He=yt(()=>(d(),n(()=>d().damageInput?"Expand":"Collapse")));_a(Ie,{title:"Apply Damage",get collapsed(){return d(),n(()=>d().damageInput)},get ariaLabel(){return e(He)},onToggle:()=>Qt.update(ye=>({...ye,damageInput:!ye.damageInput}))})}var Ze=a(Ie,2);{var Y=He=>{var ye=Mr(),$e=l(ye),Pe=l($e),R=a(l(Pe),2);Ce(R),s(Pe);var T=a(Pe,2),x=a(l(T),2);Ce(x);var W=a(x,2);$t(W,5,()=>J,Dt,(re,be)=>{var Oe=Lr(),Ve={};C(()=>{Ve!==(Ve=e(be))&&(Oe.value=(Oe.__value=e(be))??"")}),c(re,Oe)}),s(W),s(T),s($e);var g=a($e,2),A=a(l(g),2);$t(A,1,()=>n(()=>J.slice(0,6)),Dt,(re,be)=>{var Oe=jr();let Ve;var ut=l(Oe,!0);s(Oe),C(()=>{Ve=Bt(Oe,1,"quick-type-btn use-enabled svelte-uvfntf",null,Ve,{active:e(y)===e(be)}),S(ut,e(be))}),L("click",Oe,()=>r(y,e(be))),c(re,Oe)}),s(g);var Z=a(g,2);{var Ue=re=>{var be=Ar();L("click",be,ae),c(re,be)},Be=re=>{var be=Rr(),Oe=a(l(be),2),Ve=l(Oe),ut=l(Ve),mt=a(l(ut),2),gt=l(mt);s(mt),s(ut);var rt=a(ut,2);$t(rt,5,()=>e(ne),Dt,(oe,me)=>{var ee=Br(),he=l(ee,!0);s(ee),C(()=>S(he,e(me))),c(oe,ee)}),s(rt);var k=a(rt,2),P=a(l(k),2),de=l(P,!0);s(P),s(k),s(Ve),s(Oe);var N=a(Oe,2),w=l(N),G=a(w,2);s(N),s(be),C(()=>{S(gt,`${e(h)??""} ${e(y)??""}`),S(de,e(M))}),L("click",w,se),L("click",G,F),c(re,be)};b(Z,re=>{e(V)?re(Be,!1):re(Ue)})}s(ye),Ne(R,()=>e(h),re=>r(h,re)),Ne(x,()=>e(y),re=>r(y,re)),c(He,ye)};b(Ze,He=>{d(),n(()=>!d().damageInput)&&He(Y)})}s(I),C(()=>pe=Bt(I,1,"damage-input svelte-uvfntf",null,pe,{hidden:!e(D)})),c(i,I),Vt(),m()}var Pr=f('<link rel="icon" type="image/png" href="favicon4.png"/> <meta name="viewport" content="width=device-width, initial-scale=1"/>',1),Ir=f('<span class="character-name svelte-1uha8ag"> </span>'),Er=f("<span> </span>"),Hr=f('<div class="spell-slots-header svelte-1uha8ag"></div>'),Ur=f("<span> </span><br/>",1),Nr=f("<span> </span><br/>",1),Or=f("<span> </span><br/>",1),Gr=f("<span> </span><br/>",1),qr=f("<span> </span><br/>",1),Wr=f("<span> </span><br/>",1),zr=f("<br/><em> <!>)</em>",1),Kr=f("<br/><em>(requires reaction)</em>",1),Vr=f('<div class="ability-detail"><strong> </strong> <!></div>'),Jr=f('<div class="abilities-section"><strong>Abilities:</strong><br/> <!></div>'),Yr=f('<span class="effect-tooltip"><strong> </strong><br/> <br/> <!> <!> <!> <!> <!> <!> <!></span>'),Qr=f('<button class="effect-remove-btn svelte-1uha8ag">√ó</button>'),Xr=f('<span class="effect-badge svelte-1uha8ag" tabindex="0"> <!> <!></span>'),Zr=f(`<div class="active-effects-header svelte-1uha8ag"></div> <style>.effect-badge {
              position: relative;
            }
            .effect-tooltip {
              position: absolute;
              top: 120%;
              left: 50%;
              transform: translateX(-50%);
              background: #fff;
              color: #222;
              border: 1px solid #a5b4fc;
              border-radius: 6px;
              padding: 8px 12px;
              font-size: 0.95em;
              box-shadow: 0 2px 8px rgba(0, 0, 0, 0.12);
              z-index: 10;
              min-width: 180px;
              max-width: 300px;
              white-space: normal;
              pointer-events: none;
              opacity: 1;
              transition: opacity 0.15s;
            }

            .abilities-section {
              margin-top: 8px;
              padding-top: 8px;
              border-top: 1px solid #e5e7eb;
            }

            .ability-detail {
              margin-top: 6px;
              padding: 4px;
              background: #f9fafb;
              border-radius: 4px;
              font-size: 0.9em;
            }

            .ability-detail strong {
              color: #6366f1;
            }

            .ability-detail em {
              font-size: 0.85em;
              color: #6b7280;
            }</style>`,1),eo=f('<div class="rest-menu svelte-1uha8ag"><button class="rest-option svelte-1uha8ag">‚òï Short Rest</button> <button class="rest-option svelte-1uha8ag">üõèÔ∏è Long Rest</button></div>'),to=f('<div class="container svelte-1uha8ag"><header class="svelte-1uha8ag"><div class="header-top svelte-1uha8ag"><div class="header-title svelte-1uha8ag"><div class="title-row svelte-1uha8ag"><h1 class="svelte-1uha8ag">D&D Character Sheet</h1> <!></div> <!> <!></div> <div class="header-right svelte-1uha8ag"><div class="header-controls svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">üé≤</span><span class="btn-text svelte-1uha8ag">Roll Dice</span></button> <div class="rest-button-container svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">üò¥</span><span class="btn-text svelte-1uha8ag">Rest</span></button> <!></div> <button class="btn btn-secondary use-enabled" title="Add custom condition with effects"><span class="btn-icon svelte-1uha8ag">‚ú®</span><span class="btn-text svelte-1uha8ag">Add Condition</span></button> <div class="mode-toggle"><button><span class="btn-icon svelte-1uha8ag"> </span><span class="btn-text svelte-1uha8ag"> </span></button></div></div> <div class="header-search svelte-1uha8ag"><input type="text" placeholder="üîç Search..." class="search-input use-enabled svelte-1uha8ag"/></div></div></div> <div class="header-actions svelte-1uha8ag"><button class="btn btn-mode svelte-1uha8ag">üìö Browse Spells & Feats</button> <button class="btn btn-secondary">Save to Gist</button> <button class="btn btn-secondary">Load from Gist</button> <button class="btn btn-secondary">Export JSON</button> <button class="btn btn-secondary">Import JSON</button> <input type="file" accept=".json" style="display: none;"/></div></header> <main class="svelte-1uha8ag"><!> <!> <!> <!> <!> <!> <!> <!></main></div> <!> <!> <!> <!> <!>',1);function vo(i,o){Kt(o,!1);const t=()=>pt(fe,"$character",p),v=()=>pt(ba,"$isEditMode",p),d=()=>pt(ma,"$searchFilter",p),[p,m]=ca();function D(){const j=[],Ke=t().classFeatures.spellSlotsByLevel||{};for(let H=1;H<=9;H++){const Q=Ke[H];if(Q&&Q.length>0){const X=Q.length,at=Q.filter(Fe=>Fe).length;j.push({level:H,available:X-at,total:X})}}return j}let h=$(!1),y=$(!1),V=$(!1),M=$(!1),ne=$("save"),J=$(void 0),ae=$(""),se=$(""),F=$(""),I=$(!1),pe=$([]),Ie=$("other"),Ze=$(),Y=!1,He=1,ye=$(!1),$e=$(null);function Pe(j){r($e,j)}function R(){r($e,null)}function T(j){r($e,e($e)===j?null:j)}function x(j){fe.update(Ke=>(Ke.activeStates||(Ke.activeStates=[]),Ke.activeStates=[...Ke.activeStates,j],Ke)),r(M,!1),Ht.add(`Added condition: ${j.name}`,"success")}function W(){r(M,!1)}function g(){const j=[];fe.update(H=>{const Q=H.hitDice.current;H.hitDice.current=Math.min(H.hitDice.max,H.hitDice.current+Math.max(1,Math.floor(H.hitDice.max/2)));const X=H.hitDice.current-Q;if(X>0&&j.push(`${X} hit ${X===1?"die":"dice"}`),H.class){const at=$a(H.class,H.level,H.subclass);H.classFeatures.features||(H.classFeatures.features={}),at.forEach(Fe=>{if(Fe.resetOn==="short"){const _t=Fe.name.replace(/\s+/g,"");if(Fe.type==="uses"){const Ae=typeof Fe.maxUses=="function"?Fe.maxUses(H.level):Fe.maxUses;H.classFeatures.features[_t]=Array(Ae).fill(!1),j.push(Fe.name)}else if(Fe.type==="pool"){const Ae=typeof Fe.maxPool=="function"?Fe.maxPool(H.level):Fe.maxPool;Ae!==void 0&&(H.classFeatures.features[_t]=Ae,j.push(Fe.name))}}})}return H.activeStates&&H.activeStates.forEach(at=>{at.abilities&&at.abilities.forEach(Fe=>{if(Fe.restType==="short"&&Fe.usesPerRest){const _t=Fe.usesPerRest-(Fe.currentUses||0)>0;Fe.currentUses=Fe.usesPerRest,_t&&j.push(`${at.name}: ${Fe.name}`)}})}),H}),r(ye,!1);const Ke=j.length>0?`Short rest taken! Restored: ${j.join(", ")}`:"Short rest taken!";Ht.add(Ke,"success")}function A(){const j=[];fe.update(H=>{const Q=H.maxHP-H.currentHP;Q>0&&j.push(`${Q} HP`),H.currentHP=H.maxHP,H.tempHP=0;const X=H.hitDice.max-H.hitDice.current;X>0&&j.push(`${X} hit ${X===1?"die":"dice"}`),H.hitDice.current=H.hitDice.max;let at=0;if(H.classFeatures.spellSlotsByLevel&&Object.keys(H.classFeatures.spellSlotsByLevel).forEach(Fe=>{const _t=H.classFeatures.spellSlotsByLevel[parseInt(Fe)];if(_t){const Ae=_t.filter(lt=>lt).length;at+=Ae,H.classFeatures.spellSlotsByLevel[parseInt(Fe)]=Array(_t.length).fill(!1)}}),at>0&&j.push(`${at} spell ${at===1?"slot":"slots"}`),H.class){const Fe=$a(H.class,H.level,H.subclass);H.classFeatures.features||(H.classFeatures.features={});let _t=!1;Fe.forEach(Ae=>{const lt=Ae.name.replace(/\s+/g,"");if(!(Ae.type==="info"||Ae.type==="channelDivinity")){if(Ae.type==="uses"){const St=typeof Ae.maxUses=="function"?Ae.maxUses(H.level):Ae.maxUses;H.classFeatures.features[lt]=Array(St).fill(!1),_t=!0}else if(Ae.type==="pool"){const St=typeof Ae.maxPool=="function"?Ae.maxPool(H.level):Ae.maxPool;St!==void 0&&(H.classFeatures.features[lt]=St,_t=!0)}}}),_t&&j.push("all class features")}if(H.activeStates){let Fe=!1;H.activeStates.forEach(_t=>{_t.abilities&&_t.abilities.forEach(Ae=>{if(Ae.usesPerRest){const lt=(Ae.currentUses||0)<Ae.usesPerRest;Ae.currentUses=Ae.usesPerRest,lt&&(Fe=!0)}})}),Fe&&j.push("condition abilities")}return H}),r(ye,!1);const Ke=j.length>0?`Long rest taken! Restored: ${j.join(", ")}`:"Long rest taken! Fully rested.";Ht.add(Ke,"success")}function Z(j){r(ae,""),r(se,""),r(F,""),r(I,!1),r(pe,[]),r(Ie,"other"),Y=!1,typeof j=="string"?r(ae,j):(r(ae,j.notation),r(se,j.damageNotation||""),r(F,j.attackName||""),r(I,!!j.applyHalfDamage),r(pe,j.bonusBreakdown||[]),r(Ie,j.rollType||"other")),r(h,!0)}function Ue(j){const{notation:Ke,count:H,bonusBreakdown:Q}=j.detail;r(ae,""),Y=!0,He=H||1,setTimeout(()=>{r(ae,Ke),r(se,""),r(F,"Hit Die"),r(pe,Q||[]),r(Ie,"other")},0),r(h,!0)}function Be(){if(r(h,!1),Y&&e(Ze)){const j=e(Ze).getLastRollTotal();if(j!==null){const Ke=Math.max(1,j);fe.update(H=>(H.hitDice.current=Math.max(0,H.hitDice.current-He),H.currentHP=Math.min(H.maxHP,H.currentHP+Ke),H))}Y=!1}}function re(){ba.update(j=>!j)}function be(j){j.target.closest(".rest-button-container")||r(ye,!1)}Sa(()=>{const j=ba.subscribe(Ke=>{Ke?document.body.classList.remove("use-mode"):document.body.classList.add("use-mode")});return document.addEventListener("click",be),()=>{j(),document.removeEventListener("click",be)}});function Oe(){tl(t())}function Ve(){e(J)?.click()}async function ut(j){const H=j.target.files?.[0];if(H)try{const Q=await al(H);fe.set(Q),alert("Character imported successfully!")}catch{alert("Failed to import character file")}}zt();var mt=to();Zs("1uha8ag",j=>{var Ke=Pr();Yt(2),ws(()=>{Ys.title="D&D Character Sheet"}),c(j,Ke)});var gt=je(mt),rt=l(gt),k=l(rt),P=l(k),de=l(P),N=a(l(de),2);{var w=j=>{var Ke=Ir(),H=l(Ke);s(Ke),C(()=>S(H,`${t().name??""} (${t().level??""})`)),c(j,Ke)};b(N,j=>{t().name&&j(w)})}s(de);var G=a(de,2);{var oe=j=>{var Ke=Hr();$t(Ke,5,D,Dt,(H,Q)=>{var X=Er();let at;var Fe=l(X);s(X),C(()=>{at=Bt(X,1,"slot-badge svelte-1uha8ag",null,at,{depleted:e(Q).available===0}),S(Fe,`Lv${e(Q).level??""}: ${e(Q).available??""}/${e(Q).total??""}`)}),c(H,X)}),s(Ke),c(j,Ke)};b(G,j=>{D().length>0&&j(oe)})}var me=a(G,2);{var ee=j=>{var Ke=Zr(),H=je(Ke);$t(H,5,()=>t().activeStates,Dt,(Q,X,at)=>{var Fe=Xr(),_t=l(Fe),Ae=a(_t);{var lt=Lt=>{var ft=Yr(),st=l(ft),Rt=l(st,!0);s(st);var ea=a(st,2),ta=a(ea,3);{var Xt=vt=>{var ht=Ur(),xt=je(ht),Tt=l(xt);s(xt),Yt(),C(()=>S(Tt,`Attack Bonus: ${typeof e(X).attackBonus=="number"&&e(X).attackBonus>0?"+":""}${e(X).attackBonus??""}`)),c(vt,ht)};b(ta,vt=>{e(X).attackBonus&&vt(Xt)})}var aa=a(ta,2);{var jt=vt=>{var ht=Nr(),xt=je(ht),Tt=l(xt);s(xt),Yt(),C(()=>S(Tt,`Damage Bonus: ${typeof e(X).damageBonus=="number"&&e(X).damageBonus>0?"+":""}${e(X).damageBonus??""}`)),c(vt,ht)};b(aa,vt=>{e(X).damageBonus&&vt(jt)})}var Mt=a(aa,2);{var Nt=vt=>{var ht=Or(),xt=je(ht),Tt=l(xt);s(xt),Yt(),C(()=>S(Tt,`AC Bonus: ${e(X).acBonus>0?"+":""}${e(X).acBonus??""}`)),c(vt,ht)};b(Mt,vt=>{e(X).acBonus&&vt(Nt)})}var sa=a(Mt,2);{var na=vt=>{var ht=Gr(),xt=je(ht),Tt=l(xt);s(xt),Yt(),C(()=>S(Tt,`Darkvision: ${e(X).darkvision??""} feet`)),c(vt,ht)};b(sa,vt=>{e(X).darkvision&&vt(na)})}var va=a(sa,2);{var Jt=vt=>{var ht=qr(),xt=je(ht),Tt=l(xt);s(xt),Yt(),C(kt=>S(Tt,`Resistances: ${kt??""}`),[()=>e(X).resistances.join(", ")]),c(vt,ht)};b(va,vt=>{e(X).resistances&&e(X).resistances.length>0&&vt(Jt)})}var Pt=a(va,2);{var qt=vt=>{var ht=Wr(),xt=je(ht),Tt=l(xt);s(xt),Yt(),C(kt=>S(Tt,`Immunities: ${kt??""}`),[()=>e(X).immunities.join(", ")]),c(vt,ht)};b(Pt,vt=>{e(X).immunities&&e(X).immunities.length>0&&vt(qt)})}var Zt=a(Pt,2);{var Ct=vt=>{var ht=Jr(),xt=a(l(ht),3);$t(xt,1,()=>e(X).abilities,Dt,(Tt,kt)=>{var Wt=Vr(),Ot=l(Wt),ra=l(Ot);s(Ot);var da=a(Ot),It=a(da);{var Gt=la=>{var ya=zr(),Ta=a(je(ya)),Fa=l(Ta),Ca=a(Fa);{var Wa=za=>{var Bs=At(", requires reaction");c(za,Bs)};b(Ca,za=>{e(kt).requiresReaction&&za(Wa)})}Yt(),s(Ta),C(()=>S(Fa,`(${(e(kt).currentUses||0)??""}/${e(kt).usesPerRest??""} uses per ${e(kt).restType??""}
                                rest`)),c(la,ya)},oa=la=>{var ya=bt(),Ta=je(ya);{var Fa=Ca=>{var Wa=Kr();Yt(),c(Ca,Wa)};b(Ta,Ca=>{e(kt).requiresReaction&&Ca(Fa)},!0)}c(la,ya)};b(It,la=>{e(kt).usesPerRest?la(Gt):la(oa,!1)})}s(Wt),C(()=>{S(ra,`${e(kt).name??""}:`),S(da,` ${e(kt).description??""} `)}),c(Tt,Wt)}),s(ht),c(vt,ht)};b(Zt,vt=>{e(X).abilities&&e(X).abilities.length>0&&vt(Ct)})}s(ft),C(()=>{S(Rt,e(X).name),S(ea,` ${e(X).description??""}`)}),c(Lt,ft)};b(Ae,Lt=>{e($e)===at&&Lt(lt)})}var St=a(Ae,2);{var Ut=Lt=>{var ft=Qr();C(()=>it(ft,"title",`End ${e(X).name??""}`)),L("click",ft,()=>{fe.update(st=>{if(st.activeStates){const Rt=st.activeStates[at];Rt?.hpBonus&&Rt.target!=="other"&&(st.maxHP-=Rt.hpBonus,st.currentHP=Math.max(1,Math.min(st.currentHP-Rt.hpBonus,st.maxHP))),st.activeStates=st.activeStates.filter((ea,ta)=>ta!==at)}return st})}),c(Lt,ft)};b(St,Lt=>{v()||Lt(Ut)})}s(Fe),C(()=>{it(Fe,"aria-label",e(X).name),S(_t,`‚ú® ${e(X).name??""} `)}),L("mouseenter",Fe,()=>Pe(at)),L("mouseleave",Fe,R),L("focus",Fe,()=>Pe(at)),L("blur",Fe,R),L("click",Fe,()=>T(at)),c(Q,Fe)}),s(H),Yt(2),c(j,Ke)};b(me,j=>{t().activeStates&&t().activeStates.length>0&&j(ee)})}s(P);var he=a(P,2),ie=l(he),ce=l(ie),B=a(ce,2),qe=l(B),Re=a(qe,2);{var Ye=j=>{var Ke=eo(),H=l(Ke),Q=a(H,2);s(Ke),L("click",H,g),L("click",Q,A),c(j,Ke)};b(Re,j=>{e(ye)&&j(Ye)})}s(B);var Se=a(B,2),u=a(Se,2),xe=l(u);let ge;var U=l(xe),De=l(U,!0);s(U);var Me=a(U),we=l(Me,!0);s(Me),s(xe),s(u),s(ie);var Le=a(ie,2),le=l(Le);Ce(le),s(Le),s(he),s(k);var Ee=a(k,2),_e=l(Ee),We=a(_e,2),Qe=a(We,2),et=a(Qe,2),dt=a(et,2),ue=a(dt,2);Ba(ue,j=>r(J,j),()=>e(J)),s(Ee),s(rt);var _=a(rt,2),K=l(_);xl(K,{});var q=a(K,2);Sl(q,{$$events:{roll:j=>Z(j.detail)}});var z=a(q,2);zl(z,{$$events:{roll:j=>Z(j.detail)}});var ke=a(z,2);Ol(ke,{$$events:{rollHitDice:Ue}});var Je=a(ke,2);Fr(Je,{});var tt=a(Je,2);Yi(tt,{$$events:{roll:j=>Z(j.detail)}});var Ge=a(tt,2);pn(Ge,{});var ze=a(Ge,2);bn(ze,{}),s(_),s(gt);var ve=a(gt,2);Ba(In(ve,{get notation(){return e(ae)},get damageNotation(){return e(se)},get attackName(){return e(F)},get applyHalfDamage(){return e(I)},get bonusBreakdown(){return e(pe)},get rollType(){return e(Ie)},get visible(){return e(h)},$$events:{close:Be},$$legacy:!0}),j=>r(Ze,j),()=>e(Ze));var E=a(ve,2);{var Te=j=>{sr(j,{get mode(){return e(ne)},$$events:{close:()=>r(y,!1)}})};b(E,j=>{e(y)&&j(Te)})}var ot=a(E,2);{var Xe=j=>{_r(j,{onClose:()=>r(V,!1)})};b(ot,j=>{e(V)&&j(Xe)})}var ct=a(ot,2);Dr(ct,{get show(){return e(M)},onSave:x,onCancel:W});var te=a(ct,2);el(te,{}),C(()=>{ge=Bt(xe,1,"btn btn-mode svelte-1uha8ag",null,ge,{"use-mode":!v()}),S(De,v()?"üìù":"üé≤"),S(we,v()?"Edit Mode":"Use Mode")}),L("click",ce,()=>{r(pe,[]),r(h,!0)}),L("click",qe,()=>r(ye,!e(ye))),L("click",Se,()=>r(M,!0)),L("click",xe,re),Ne(le,d,j=>sl(ma,j)),L("click",_e,()=>r(V,!0)),L("click",We,()=>{r(ne,"save"),r(y,!0)}),L("click",Qe,()=>{r(ne,"load"),r(y,!0)}),L("click",et,Oe),L("click",dt,Ve),L("change",ue,ut),c(i,mt),Vt(),m()}export{vo as component};
