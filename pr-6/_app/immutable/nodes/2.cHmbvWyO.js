import{f as u,e as D,a as o,s as y,c as ot,t as $t}from"../chunks/DN9NmC1v.js";import{i as Mt}from"../chunks/Dlg-HS1s.js";import{c as Vt,o as na,a as ss}from"../chunks/Icie54Zd.js";import{a7 as Ka,i as Ja,aZ as ls,a_ as is,a$ as Ia,K as Wt,e as Va,b0 as Qa,T as ma,b1 as rs,b2 as ns,q as os,b3 as cs,b4 as vs,b5 as ds,ab as us,d as r,r as Xa,g as ps,C as Bt,b6 as tt,b7 as Gt,F,G as It,s as c,a4 as B,H as i,J as a,I as l,f as e,E as Oe,m as rt,A as U,b8 as ja,b9 as St,ba as la,ao as ba,bb as fs}from"../chunks/swQEjlmu.js";import{c as Z,a as Ct,e as pt,i as ft,u as Ya,s as zt,b as _t,d as oa,f as ia,t as At,h as bs,T as gs,g as hs,j as ms}from"../chunks/B53stXlE.js";import{i as _,s as Tt,a as Ze,b as nt,d as da,e as _s}from"../chunks/BEkqXdCA.js";import{p as Dt,b as Aa}from"../chunks/gdGGBrOz.js";import{b as sa,r as ys}from"../chunks/Bd1f5zHu.js";function ga(s,n,t=!1){if(s.multiple){if(n==null)return;if(!Ja(n))return ls();for(var v of s.options)v.selected=n.includes(ra(v));return}for(v of s.options){var p=ra(v);if(is(p,n)){v.selected=!0;return}}(!t||n!==void 0)&&(s.selectedIndex=-1)}function Fa(s){var n=new MutationObserver(()=>{ga(s,s.__value)});n.observe(s,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Ka(()=>{n.disconnect()})}function Za(s,n,t=n){var v=new WeakSet,p=!0;Ia(s,"change",m=>{var x=m?"[selected]":":checked",I;if(s.multiple)I=[].map.call(s.querySelectorAll(x),ra);else{var k=s.querySelector(x)??s.querySelector("option:not([disabled])");I=k&&ra(k)}t(I),Wt!==null&&v.add(Wt)}),Va(()=>{var m=n();if(s===document.activeElement){var x=Qa??Wt;if(v.has(x))return}if(ga(s,m,p),p&&m===void 0){var I=s.querySelector(":checked");I!==null&&(m=ra(I),t(m))}s.__value=m,p=!1}),Fa(s)}function ra(s){return"__value"in s?s.__value:s.value}const ks=Symbol("is custom element"),xs=Symbol("is html");function Le(s){if(ma){var n=!1,t=()=>{if(!n){if(n=!0,s.hasAttribute("value")){var v=s.value;st(s,"value",null),s.value=v}if(s.hasAttribute("checked")){var p=s.checked;st(s,"checked",null),s.checked=p}}};s.__on_r=t,os(t),cs()}}function Ra(s,n){var t=Ea(s);t.value===(t.value=n??void 0)||s.value===n&&(n!==0||s.nodeName!=="PROGRESS")||(s.value=n??"")}function Ss(s,n){var t=Ea(s);t.checked!==(t.checked=n??void 0)&&(s.checked=n)}function st(s,n,t,v){var p=Ea(s);ma&&(p[n]=s.getAttribute(n),n==="src"||n==="srcset"||n==="href"&&s.nodeName==="LINK")||p[n]!==(p[n]=t)&&(n==="loading"&&(s[vs]=t),t==null?s.removeAttribute(n):typeof t!="string"&&$s(s).includes(n)?s[n]=t:s.setAttribute(n,t))}function Ea(s){return s.__attributes??={[ks]:s.nodeName.includes("-"),[xs]:s.namespaceURI===rs}}var Ta=new Map;function $s(s){var n=s.getAttribute("is")||s.nodeName,t=Ta.get(n);if(t)return t;Ta.set(n,t=[]);for(var v,p=s,m=Element.prototype;m!==p;){v=ds(p);for(var x in v)v[x].set&&t.push(x);p=ns(p)}return t}function Me(s,n,t=n){var v=new WeakSet;Ia(s,"input",async p=>{var m=p?s.defaultValue:s.value;if(m=wa(s)?La(m):m,t(m),Wt!==null&&v.add(Wt),await us(),m!==(m=n())){var x=s.selectionStart,I=s.selectionEnd,k=s.value.length;if(s.value=m??"",I!==null){var H=s.value.length;x===I&&I===k&&H>k?(s.selectionStart=H,s.selectionEnd=H):(s.selectionStart=x,s.selectionEnd=Math.min(I,H))}}}),(ma&&s.defaultValue!==s.value||r(n)==null&&s.value)&&(t(wa(s)?La(s.value):s.value),Wt!==null&&v.add(Wt)),Xa(()=>{var p=n();if(s===document.activeElement){var m=Qa??Wt;if(v.has(m))return}wa(s)&&p===La(s.value)||s.type==="date"&&!p&&!s.value||p!==s.value&&(s.value=p??"")})}function ha(s,n,t=n){Ia(s,"change",v=>{var p=v?s.defaultChecked:s.checked;t(p)}),(ma&&s.defaultChecked!==s.checked||r(n)==null)&&t(s.checked),Xa(()=>{var v=n();s.checked=!!v})}function wa(s){var n=s.type;return n==="number"||n==="range"}function La(s){return s===""?null:+s}function Cs(s,n,t){var v=ps(s,n);v&&v.set&&(s[n]=t,Ka(()=>{s[n]=null}))}function Pa(s){return function(...n){var t=n[0];return t.stopPropagation(),s?.apply(this,n)}}function Ha(s){return function(...n){var t=n[0];return t.preventDefault(),s?.apply(this,n)}}function Yt(s,n){var t=s.$$events?.[n.type],v=Ja(t)?t.slice():t==null?[]:[t];for(var p of v)p.call(this,n)}const ws="";function es(...s){return sa+ws+ys(s[0],s[1])}const Ma={paladin:{name:"Paladin",hitDice:"d10",spellcaster:!0,spellcastingAbility:"charisma",spellSlotsByLevel:{1:0,2:2,3:3,4:3,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Divine Sense",type:"uses",maxUses:(s,n=1)=>1+Math.max(1,n),resetOn:"long",description:"Detect celestials, fiends, and undead within 60 feet",minLevel:1},{name:"Lay on Hands",type:"pool",maxPool:s=>s*5,resetOn:"long",description:"Heal wounds or cure disease",minLevel:1},{name:"Divine Smite",type:"spellSlot",description:"Expend spell slot to deal extra radiant damage",minLevel:2,rollable:!0},{name:"Channel Divinity",type:"pool",maxPool:s=>s>=18?3:s>=6?2:1,resetOn:"short",description:"Sacred Weapon or Turn Undead",minLevel:3}]},fighter:{name:"Fighter",hitDice:"d10",spellcaster:!1,features:[{name:"Second Wind",type:"uses",maxUses:1,resetOn:"short",description:"Regain 1d10 + fighter level HP as bonus action",minLevel:1,rollable:!0,rollFormula:s=>`1d10+${s}`},{name:"Action Surge",type:"uses",maxUses:s=>s>=17?2:1,resetOn:"short",description:"Take one additional action on your turn",minLevel:2},{name:"Indomitable",type:"uses",maxUses:s=>s>=17?3:s>=13?2:1,resetOn:"long",description:"Reroll a failed saving throw",minLevel:9}],subclasses:{champion:{name:"Champion",features:[{name:"Improved Critical",type:"info",description:"Critical hit on 19-20",minLevel:3},{name:"Remarkable Athlete",type:"info",description:"Add half proficiency to STR/DEX/CON checks, increase long jump distance",minLevel:7},{name:"Additional Fighting Style",type:"info",description:"Choose a second fighting style",minLevel:10},{name:"Superior Critical",type:"info",description:"Critical hit on 18-20",minLevel:15},{name:"Survivor",type:"info",description:"Regain 5 + CON mod HP at start of turn if below half HP",minLevel:18}]},battlemaster:{name:"Battle Master",features:[{name:"Combat Superiority",type:"uses",maxUses:s=>s>=15?6:s>=7?5:4,resetOn:"short",description:s=>`Use superiority dice (${s>=18?"d12":s>=10?"d10":"d8"}) for maneuvers`,minLevel:3},{name:"Know Your Enemy",type:"info",description:"Learn capabilities of creatures you observe",minLevel:7},{name:"Improved Combat Superiority",type:"info",description:"Superiority dice become d10",minLevel:10},{name:"Relentless",type:"info",description:"Regain 1 superiority die if you have none at start of turn",minLevel:15}]}}},rogue:{name:"Rogue",hitDice:"d8",spellcaster:!1,features:[{name:"Sneak Attack",type:"info",description:s=>`Deal ${Math.ceil(s/2)}d6 extra damage once per turn with advantage or ally nearby`,minLevel:1,rollable:!0,rollFormula:s=>`${Math.ceil(s/2)}d6`},{name:"Cunning Action",type:"info",description:"Dash, Disengage, or Hide as a bonus action",minLevel:2},{name:"Uncanny Dodge",type:"info",description:"Use reaction to halve damage from an attack",minLevel:5},{name:"Evasion",type:"info",description:"Take no damage on successful Dex save (half on fail)",minLevel:7}]},wizard:{name:"Wizard",hitDice:"d6",spellcaster:!0,spellcastingAbility:"intelligence",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Arcane Recovery",type:"uses",maxUses:1,resetOn:"long",description:s=>`Recover spell slots totaling up to ${Math.ceil(s/2)} levels during short rest`,minLevel:1},{name:"Spell Mastery",type:"info",description:"Cast one 1st-level and one 2nd-level spell at will",minLevel:18}]},cleric:{name:"Cleric",hitDice:"d8",spellcaster:!0,spellcastingAbility:"wisdom",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Channel Divinity",type:"pool",maxPool:s=>s>=18?3:s>=6?2:1,resetOn:"short",description:"Turn Undead or domain-specific ability",minLevel:2},{name:"Destroy Undead",type:"info",description:s=>`Channel Divinity destroys undead of CR ${s>=17?4:s>=14?3:s>=11?2:s>=8?1:.5} or lower`,minLevel:5},{name:"Divine Intervention",type:"uses",maxUses:1,resetOn:"long",description:s=>`${s}% chance to succeed, implore deity for aid`,minLevel:10}],subclasses:{war:{name:"War Domain",features:[{name:"War Priest",type:"uses",maxUses:(s,n=1)=>Math.max(1,n),resetOn:"long",description:"Make one weapon attack as a bonus action",minLevel:1},{name:"Guided Strike",type:"channelDivinity",description:"Use your Channel Divinity to gain +10 to an attack roll. Make this choice after you see the roll, but before the DM says whether the attack hits or misses.",minLevel:2,resetOn:"short"},{name:"War God's Blessing",type:"channelDivinity",description:"Use reaction to grant +10 to an ally's attack roll within 30 feet. Consumes one use of Channel Divinity.",minLevel:6,resetOn:"short"},{name:"Divine Strike",type:"info",description:s=>`Deal extra ${s>=14?"2d8":"1d8"} weapon damage once per turn`,minLevel:8,rollable:!0,rollFormula:s=>s>=14?"2d8":"1d8"},{name:"Avatar of Battle",type:"info",description:"Gain resistance to nonmagical weapon damage",minLevel:17}]},life:{name:"Life Domain",features:[{name:"Disciple of Life",type:"info",description:"Healing spells restore additional 2 + spell level HP",minLevel:1},{name:"Preserve Life",type:"pool",maxPool:s=>s*5,resetOn:"short",description:"Restore HP to creatures within 30 feet",minLevel:2},{name:"Blessed Healer",type:"info",description:"Regain 2 + spell level HP when you cast healing spell",minLevel:6},{name:"Divine Strike",type:"info",description:s=>`Deal extra ${s>=14?"2d8":"1d8"} radiant damage once per turn`,minLevel:8,rollable:!0,rollFormula:s=>s>=14?"2d8":"1d8"},{name:"Supreme Healing",type:"info",description:"Maximize healing dice instead of rolling",minLevel:17}]}}},barbarian:{name:"Barbarian",hitDice:"d12",spellcaster:!1,features:[{name:"Rage",type:"uses",maxUses:s=>s>=20?1/0:s>=17?6:s>=12?5:s>=6?4:s>=3?3:2,resetOn:"long",description:s=>`+${s>=16?4:s>=9?3:2} damage, resistance to physical damage`,minLevel:1},{name:"Reckless Attack",type:"info",description:"Gain advantage on melee attacks, enemies get advantage on you",minLevel:2},{name:"Danger Sense",type:"info",description:"Advantage on Dex saves against effects you can see",minLevel:2}],subclasses:{berserker:{name:"Path of the Berserker",features:[{name:"Frenzy",type:"info",description:"While raging, make melee attack as bonus action (gain 1 exhaustion after rage)",minLevel:3},{name:"Mindless Rage",type:"info",description:"Cannot be charmed or frightened while raging",minLevel:6},{name:"Intimidating Presence",type:"info",description:"Use action to frighten creature within 30 feet",minLevel:10},{name:"Retaliation",type:"info",description:"When damaged by creature within 5 feet, make melee attack as reaction",minLevel:14}]}}}};function Ft(s){const n=s.toLowerCase();return Ma[n]||null}function Zt(s,n,t){const v=Ft(s);if(!v)return[];const p=v.features.filter(m=>!m.minLevel||m.minLevel<=n);if(t&&v.subclasses&&v.subclasses[t]){const m=v.subclasses[t].features.filter(x=>!x.minLevel||x.minLevel<=n);return[...p,...m]}return p}function Na(s){const n=Ft(s);return!n||!n.subclasses?[]:Object.keys(n.subclasses).map(t=>({id:t,name:n.subclasses[t].name}))}function Ua(s,n){const t=Ft(s);return!t||!t.spellcaster||!t.spellSlotsByLevel?0:t.spellSlotsByLevel[n]||0}function Ga(s,n,t){const v=Ft(s);return!v||!v.spellcaster?0:Math.max(1,t+n)}function Ls(s,n,t){const v=Ft(s);return!v||!v.spellcaster?null:8+n+t}function Ds(){return Object.keys(Ma).map(s=>({id:s,name:Ma[s].name}))}var js=u("<option> </option>"),As=u("<option> </option>"),Fs=u('<div class="form-group svelte-172i2fj"><label for="characterSubclass" class="svelte-172i2fj">Subclass</label> <select id="characterSubclass" class="svelte-172i2fj"><option>Select Subclass</option><!></select></div>'),Ms=u('<div class="info-grid svelte-172i2fj"><div class="form-group svelte-172i2fj"><label for="characterName" class="svelte-172i2fj">Character Name</label> <input type="text" id="characterName" placeholder="Enter name" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterClass" class="svelte-172i2fj">Class</label> <select id="characterClass" class="svelte-172i2fj"><option>Select Class</option><!></select></div> <!> <div class="form-group svelte-172i2fj"><label for="characterLevel" class="svelte-172i2fj">Level</label> <input type="number" id="characterLevel" min="1" max="20" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterRace" class="svelte-172i2fj">Race</label> <input type="text" id="characterRace" placeholder="e.g., Human" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterBackground" class="svelte-172i2fj">Background</label> <input type="text" id="characterBackground" placeholder="e.g., Soldier" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterAlignment" class="svelte-172i2fj">Alignment</label> <input type="text" id="characterAlignment" placeholder="e.g., Lawful Good" class="svelte-172i2fj"/></div></div>'),Bs=u('<section class="character-info svelte-172i2fj"><div class="header svelte-172i2fj"><h2 class="svelte-172i2fj">Character Info</h2> <button class="collapse-btn svelte-172i2fj"> </button></div> <!></section>');function Is(s,n){Bt(n,!1);const t=()=>Ze(Z,"$character",p),v=()=>Ze(Ct,"$collapsedStates",p),[p,m]=Tt(),x=B(),I=Ds();function k(le){const q=le.target;Z.update(je=>(je.class=q.value,je.subclass="",je))}function H(le){const q=le.target;Z.update(je=>(je.subclass=q.value,je))}function ve(le){const q=le.target;Z.update(je=>(je.level=parseInt(q.value)||1,je)),Ya()}function V(){Ct.update(le=>({...le,characterInfo:!le.characterInfo}))}tt(()=>(t(),Na),()=>{c(x,t().class?Na(t().class):[])}),Gt(),Mt();var N=Bs(),Ce=i(N),de=a(i(Ce),2),De=i(de,!0);l(de),l(Ce);var ue=a(Ce,2);{var ge=le=>{var q=Ms(),je=i(q),he=a(i(je),2);Le(he),l(je);var Q=a(je,2),W=a(i(Q),2),pe=i(W);pe.value=pe.__value="";var xe=a(pe);pt(xe,1,()=>I,ft,(C,X)=>{var M=js(),Y=i(M,!0);l(M);var qe={};F(()=>{y(Y,(e(X),r(()=>e(X).name))),qe!==(qe=(e(X),r(()=>e(X).id)))&&(M.value=(M.__value=(e(X),r(()=>e(X).id)))??"")}),o(C,M)}),l(W);var fe;Fa(W),l(Q);var Ne=a(Q,2);{var S=C=>{var X=Fs(),M=a(i(X),2),Y=i(M);Y.value=Y.__value="";var qe=a(Y);pt(qe,1,()=>e(x),ft,(ye,We)=>{var Te=As(),it=i(Te,!0);l(Te);var A={};F(()=>{y(it,(e(We),r(()=>e(We).name))),A!==(A=(e(We),r(()=>e(We).id)))&&(Te.value=(Te.__value=(e(We),r(()=>e(We).id)))??"")}),o(ye,Te)}),l(M);var ne;Fa(M),l(X),F(()=>{ne!==(ne=(t(),r(()=>t().subclass)))&&(M.value=(M.__value=(t(),r(()=>t().subclass)))??"",ga(M,(t(),r(()=>t().subclass))))}),D("change",M,H),o(C,X)};_(Ne,C=>{e(x),r(()=>e(x).length>0)&&C(S)})}var re=a(Ne,2),oe=a(i(re),2);Le(oe),l(re);var me=a(re,2),g=a(i(me),2);Le(g),l(me);var G=a(me,2),_e=a(i(G),2);Le(_e),l(G);var Pe=a(G,2),f=a(i(Pe),2);Le(f),l(Pe),l(q),F(()=>{fe!==(fe=(t(),r(()=>t().class)))&&(W.value=(W.__value=(t(),r(()=>t().class)))??"",ga(W,(t(),r(()=>t().class)))),Ra(oe,(t(),r(()=>t().level)))}),Me(he,()=>t().name,C=>nt(Z,r(t).name=C,r(t))),D("change",W,k),D("change",oe,ve),Me(g,()=>t().race,C=>nt(Z,r(t).race=C,r(t))),Me(_e,()=>t().background,C=>nt(Z,r(t).background=C,r(t))),Me(f,()=>t().alignment,C=>nt(Z,r(t).alignment=C,r(t))),o(le,q)};_(ue,le=>{v(),r(()=>!v().characterInfo)&&le(ge)})}l(N),F(()=>{st(de,"aria-label",(v(),r(()=>v().characterInfo?"Expand":"Collapse"))),y(De,(v(),r(()=>v().characterInfo?"â–¼":"â–²")))}),D("click",de,V),o(s,N),It(),m()}var Rs=u('<div class="ability-card svelte-bbv1xt"><h3 class="svelte-bbv1xt"> </h3> <input type="number" class="ability-score svelte-bbv1xt" min="1" max="30"/> <div class="ability-modifier svelte-bbv1xt"> </div> <button class="roll-btn svelte-bbv1xt">Check</button> <div class="save-row svelte-bbv1xt"><input type="checkbox" class="svelte-bbv1xt"/> <label class="svelte-bbv1xt">Save</label> <button class="roll-btn-small svelte-bbv1xt">Roll</button></div></div>'),Es=u('<div class="proficiency-bonus svelte-bbv1xt"><label for="profBonus">Proficiency Bonus</label> <input type="number" id="profBonus" class="prof-input svelte-bbv1xt"/></div> <div class="abilities-grid svelte-bbv1xt"></div>',1),Ps=u('<section><div class="header svelte-bbv1xt"><h2 class="svelte-bbv1xt">Ability Scores</h2> <button class="collapse-btn svelte-bbv1xt"> </button></div> <!></section>');function Ts(s,n){Bt(n,!1);const t=()=>Ze(oa,"$abilityModifiers",x),v=()=>Ze(Z,"$character",x),p=()=>Ze(zt,"$searchFilter",x),m=()=>Ze(Ct,"$collapsedStates",x),[x,I]=Tt(),k=B(),H=B(),ve=Vt(),V=[{key:"strength",label:"Strength"},{key:"dexterity",label:"Dexterity"},{key:"constitution",label:"Constitution"},{key:"intelligence",label:"Intelligence"},{key:"wisdom",label:"Wisdom"},{key:"charisma",label:"Charisma"}];function N(){Ya()}function Ce(W){const pe=t()[W],xe=`1d20${pe>=0?"+":""}${pe}`;ve("roll",xe)}function de(W){const pe=t()[W],xe=v().saveProficiencies[W]?v().proficiencyBonus:0,fe=pe+xe,Ne=`1d20${fe>=0?"+":""}${fe}`;ve("roll",Ne)}function De(){Ct.update(W=>({...W,abilityScores:!W.abilityScores}))}tt(()=>p(),()=>{c(k,V.filter(({label:W})=>p()?W.toLowerCase().includes(p().toLowerCase()):!0))}),tt(()=>(e(k),p()),()=>{c(H,e(k).length>0||!p()||p().toLowerCase().includes("proficiency"))}),Gt(),Mt();var ue=Ps();let ge;var le=i(ue),q=a(i(le),2),je=i(q,!0);l(q),l(le);var he=a(le,2);{var Q=W=>{var pe=Es(),xe=Oe(pe),fe=a(i(xe),2);Le(fe),l(xe);var Ne=a(xe,2);pt(Ne,5,()=>e(k),ft,(S,re)=>{let oe=()=>e(re).key,me=()=>e(re).label;var g=Rs(),G=i(g),_e=i(G,!0);l(G);var Pe=a(G,2);Le(Pe);var f=a(Pe,2),C=i(f);l(f);var X=a(f,2),M=a(X,2),Y=i(M);Le(Y);var qe=a(Y,2),ne=a(qe,2);l(M),l(g),F(ye=>{y(_e,ye),y(C,`${t(),oe(),r(()=>t()[oe()]>=0?"+":"")??""}${t(),oe(),r(()=>t()[oe()])??""}`),st(Y,"id",`${oe()}-save`),st(qe,"for",`${oe()}-save`)},[()=>(me(),r(()=>me().substring(0,3).toUpperCase()))]),Me(Pe,()=>v().abilities[oe()],ye=>nt(Z,r(v).abilities[oe()]=ye,r(v))),D("change",Pe,N),D("click",X,()=>Ce(oe())),ha(Y,()=>v().saveProficiencies[oe()],ye=>nt(Z,r(v).saveProficiencies[oe()]=ye,r(v))),D("click",ne,()=>de(oe())),o(S,g)}),l(Ne),Me(fe,()=>v().proficiencyBonus,S=>nt(Z,r(v).proficiencyBonus=S,r(v))),o(W,pe)};_(he,W=>{m(),r(()=>!m().abilityScores)&&W(Q)})}l(ue),F(()=>{ge=_t(ue,1,"ability-scores svelte-bbv1xt",null,ge,{hidden:!e(H)}),st(q,"aria-label",(m(),r(()=>m().abilityScores?"Expand":"Collapse"))),y(je,(m(),r(()=>m().abilityScores?"â–¼":"â–²")))}),D("click",q,De),o(s,ue),It(),I()}function Hs(s){return Math.floor((s-10)/2)}function Ba(s,n){if(!s.class)return null;const t=Ft(s.class);if(!t||!t.spellcaster||!t.spellcastingAbility)return null;const v=n[t.spellcastingAbility];return 8+s.proficiencyBonus+v}function Ns(s,n){if(!s.class)return 0;const t=Ft(s.class);return!t||!t.spellcaster||!t.spellcastingAbility?0:Hs(n[t.spellcastingAbility])}var Us=u('<div class="stat-box svelte-1r5hyyb"><label for="spellSaveDC" class="svelte-1r5hyyb">Spell Save DC</label> <input type="number" id="spellSaveDC" class="stat-input svelte-1r5hyyb" readonly="" title="8 + Proficiency Bonus + Spellcasting Ability Modifier"/></div>'),Gs=u('<span class="hit-dice-type"> </span>'),Os=u('<div class="stats-grid svelte-1r5hyyb"><div class="stat-box svelte-1r5hyyb"><label for="armorClass" class="svelte-1r5hyyb">Armor Class</label> <input type="number" id="armorClass" class="stat-input svelte-1r5hyyb"/></div> <div class="stat-box svelte-1r5hyyb"><label for="initiative" class="svelte-1r5hyyb">Initiative</label> <input type="number" id="initiative" class="stat-input svelte-1r5hyyb"/></div> <div class="stat-box svelte-1r5hyyb"><label for="speed" class="svelte-1r5hyyb">Speed</label> <input type="text" id="speed" class="stat-input svelte-1r5hyyb"/></div> <!></div> <div class="hp-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Points</h3> <div class="hp-display svelte-1r5hyyb"><div class="hp-inputs svelte-1r5hyyb"><input type="number" class="hp-current svelte-1r5hyyb" min="0"/> <span class="hp-separator svelte-1r5hyyb">/</span> <input type="number" class="hp-max svelte-1r5hyyb" min="0"/></div> <div class="hp-controls svelte-1r5hyyb"><button class="hp-btn svelte-1r5hyyb">âˆ’</button> <button class="hp-btn svelte-1r5hyyb">+</button> <button class="hp-btn svelte-1r5hyyb">âˆ’5</button> <button class="hp-btn svelte-1r5hyyb">+5</button></div></div> <div class="temp-hp svelte-1r5hyyb"><label for="tempHP" class="svelte-1r5hyyb">Temp HP</label> <input type="number" id="tempHP" min="0" class="svelte-1r5hyyb"/></div></div> <div class="hit-dice-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Dice</h3> <div class="hit-dice-display svelte-1r5hyyb"><input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <span>/</span> <input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <!></div> <div class="hit-dice-controls"><label for="hitDiceCount" class="svelte-1r5hyyb">Roll</label> <input type="number" id="hitDiceCount" class="hit-dice-count-input svelte-1r5hyyb" min="1" value="1"/> <button class="btn btn-primary roll-hit-dice use-enabled svelte-1r5hyyb">ðŸŽ² Roll</button></div></div>',1),qs=u('<section><div class="header svelte-1r5hyyb"><h2 class="svelte-1r5hyyb">Combat Stats</h2> <button class="collapse-btn svelte-1r5hyyb"> </button></div> <!></section>');function Ws(s,n){Bt(n,!1);const t=()=>Ze(Z,"$character",x),v=()=>Ze(oa,"$abilityModifiers",x),p=()=>Ze(zt,"$searchFilter",x),m=()=>Ze(Ct,"$collapsedStates",x),[x,I]=Tt(),k=B(),H=B(),ve=Vt();function V(he){Z.update(Q=>(Q.currentHP=Math.max(0,Math.min(Q.maxHP,Q.currentHP+he)),Q))}function N(he=1){if(t().hitDice.current<=0){alert("No hit dice remaining!");return}if(!t().class){alert("Please select a class first!");return}const Q=Ft(t().class);if(!Q){alert("Invalid class configuration!");return}const W=Math.min(he,t().hitDice.current),pe=Q.hitDice,xe=v().constitution,fe=xe>=0?`+${xe}`:`${xe}`,Ne=`${W}${pe}${fe}`;ve("rollHitDice",{notation:Ne,hitDie:pe,count:W})}function Ce(){Ct.update(he=>({...he,combatStats:!he.combatStats}))}tt(()=>(t(),v()),()=>{c(k,Ba(t(),v()))}),tt(()=>p(),()=>{c(H,!p()||"armor class".includes(p().toLowerCase())||"initiative".includes(p().toLowerCase())||"speed".includes(p().toLowerCase())||"hit points".includes(p().toLowerCase())||"hp".includes(p().toLowerCase())||"hit dice".includes(p().toLowerCase())||"spell save".includes(p().toLowerCase())||"combat".includes(p().toLowerCase()))}),Gt(),Mt();var de=qs();let De;var ue=i(de),ge=a(i(ue),2),le=i(ge,!0);l(ge),l(ue);var q=a(ue,2);{var je=he=>{var Q=Os(),W=Oe(Q),pe=i(W),xe=a(i(pe),2);Le(xe),l(pe);var fe=a(pe,2),Ne=a(i(fe),2);Le(Ne),l(fe);var S=a(fe,2),re=a(i(S),2);Le(re),l(S);var oe=a(S,2);{var me=R=>{var J=Us(),w=a(i(J),2);Le(w),l(J),F(()=>Ra(w,e(k))),o(R,J)};_(oe,R=>{e(k)!==null&&R(me)})}l(W);var g=a(W,2),G=a(i(g),2),_e=i(G),Pe=i(_e);Le(Pe);var f=a(Pe,4);Le(f),l(_e);var C=a(_e,2),X=i(C),M=a(X,2),Y=a(M,2),qe=a(Y,2);l(C),l(G);var ne=a(G,2),ye=a(i(ne),2);Le(ye),l(ne),l(g);var We=a(g,2),Te=a(i(We),2),it=i(Te);Le(it);var A=a(it,4);Le(A);var E=a(A,2);{var j=R=>{const J=rt(()=>(U(Ft),t(),r(()=>Ft(t().class))));var w=ot(),Se=Oe(w);{var Ae=Ie=>{const Qe=rt(()=>(v(),r(()=>v().constitution)));var Ve=Gs(),Re=i(Ve);l(Ve),F(()=>y(Re,`(${U(e(J)),r(()=>e(J).hitDice)??""}${(e(Qe)>=0?`+${e(Qe)}`:e(Qe))??""})`)),o(Ie,Ve)};_(Se,Ie=>{e(J)&&Ie(Ae)})}o(R,w)};_(E,R=>{t(),r(()=>t().class)&&R(j)})}l(Te);var d=a(Te,2),Ue=a(i(d),2),ie=a(Ue,2);l(d),l(We),F(()=>{st(Pe,"max",(t(),r(()=>t().maxHP))),st(it,"max",(t(),r(()=>t().hitDice.max))),st(Ue,"max",(t(),r(()=>t().hitDice.current))),ie.disabled=(t(),r(()=>t().hitDice.current<=0||!t().class))}),Me(xe,()=>t().armorClass,R=>nt(Z,r(t).armorClass=R,r(t))),Me(Ne,()=>t().initiative,R=>nt(Z,r(t).initiative=R,r(t))),Me(re,()=>t().speed,R=>nt(Z,r(t).speed=R,r(t))),Me(Pe,()=>t().currentHP,R=>nt(Z,r(t).currentHP=R,r(t))),Me(f,()=>t().maxHP,R=>nt(Z,r(t).maxHP=R,r(t))),D("click",X,()=>V(-1)),D("click",M,()=>V(1)),D("click",Y,()=>V(-5)),D("click",qe,()=>V(5)),Me(ye,()=>t().tempHP,R=>nt(Z,r(t).tempHP=R,r(t))),Me(it,()=>t().hitDice.current,R=>nt(Z,r(t).hitDice.current=R,r(t))),Me(A,()=>t().hitDice.max,R=>nt(Z,r(t).hitDice.max=R,r(t))),D("input",Ue,R=>{const J=R.target,w=parseInt(J.value);w>t().hitDice.current&&(J.value=String(t().hitDice.current)),w<1&&(J.value="1")}),D("click",ie,()=>{const R=document.getElementById("hitDiceCount"),J=parseInt(R?.value||"1");N(J)}),o(he,Q)};_(q,he=>{m(),r(()=>!m().combatStats)&&he(je)})}l(de),F(()=>{De=_t(de,1,"combat-stats svelte-1r5hyyb",null,De,{hidden:!e(H)}),st(ge,"aria-label",(m(),r(()=>m().combatStats?"Expand":"Collapse"))),y(le,(m(),r(()=>m().combatStats?"â–¼":"â–²")))}),D("click",ge,Ce),o(s,de),It(),I()}const Da={acrobatics:"dexterity",animalHandling:"wisdom",arcana:"intelligence",athletics:"strength",deception:"charisma",history:"intelligence",insight:"wisdom",intimidation:"charisma",investigation:"intelligence",medicine:"wisdom",nature:"intelligence",perception:"wisdom",performance:"charisma",persuasion:"charisma",religion:"intelligence",sleightOfHand:"dexterity",stealth:"dexterity",survival:"wisdom"};var zs=u('<div class="skill-row svelte-1f1pl16"><input type="checkbox" class="svelte-1f1pl16"/> <label class="svelte-1f1pl16"> <span class="ability-tag svelte-1f1pl16"> </span></label> <span class="skill-modifier svelte-1f1pl16"> </span> <button class="roll-btn svelte-1f1pl16">Roll</button></div>'),Ks=u('<div class="skills-grid svelte-1f1pl16"></div>'),Js=u('<section><div class="header svelte-1f1pl16"><h2 class="svelte-1f1pl16">Skills</h2> <button class="collapse-btn svelte-1f1pl16"> </button></div> <!></section>');function Vs(s,n){Bt(n,!1);const t=()=>Ze(oa,"$abilityModifiers",x),v=()=>Ze(Z,"$character",x),p=()=>Ze(zt,"$searchFilter",x),m=()=>Ze(Ct,"$collapsedStates",x),[x,I]=Tt(),k=B(),H=B(),ve=Vt(),V=[{key:"acrobatics",label:"Acrobatics"},{key:"animalHandling",label:"Animal Handling"},{key:"arcana",label:"Arcana"},{key:"athletics",label:"Athletics"},{key:"deception",label:"Deception"},{key:"history",label:"History"},{key:"insight",label:"Insight"},{key:"intimidation",label:"Intimidation"},{key:"investigation",label:"Investigation"},{key:"medicine",label:"Medicine"},{key:"nature",label:"Nature"},{key:"perception",label:"Perception"},{key:"performance",label:"Performance"},{key:"persuasion",label:"Persuasion"},{key:"religion",label:"Religion"},{key:"sleightOfHand",label:"Sleight of Hand"},{key:"stealth",label:"Stealth"},{key:"survival",label:"Survival"}];function N(Q){const W=Da[Q],pe=t()[W],xe=v().skillProficiencies[Q]?v().proficiencyBonus:0;return pe+xe}function Ce(Q){const W=N(Q),pe=`1d20${W>=0?"+":""}${W}`;ve("roll",pe)}function de(){Ct.update(Q=>({...Q,skills:!Q.skills}))}tt(()=>p(),()=>{c(k,V.filter(({label:Q})=>p()?Q.toLowerCase().includes(p().toLowerCase()):!0))}),tt(()=>e(k),()=>{c(H,e(k).length>0)}),Gt(),Mt();var De=Js();let ue;var ge=i(De),le=a(i(ge),2),q=i(le,!0);l(le),l(ge);var je=a(ge,2);{var he=Q=>{var W=Ks();pt(W,5,()=>e(k),ft,(pe,xe)=>{let fe=()=>e(xe).key,Ne=()=>e(xe).label;const S=rt(()=>(U(Da),fe(),r(()=>Da[fe()]))),re=rt(()=>(fe(),r(()=>N(fe()))));var oe=zs(),me=i(oe);Le(me);var g=a(me,2),G=i(g),_e=a(G),Pe=i(_e);l(_e),l(g);var f=a(g,2),C=i(f);l(f);var X=a(f,2);l(oe),F(M=>{st(me,"id",fe()),st(g,"for",fe()),y(G,`${Ne()??""} `),y(Pe,`(${M??""})`),y(C,`${e(re)>=0?"+":""}${e(re)??""}`)},[()=>(U(e(S)),r(()=>e(S).substring(0,3).toUpperCase()))]),ha(me,()=>v().skillProficiencies[fe()],M=>nt(Z,r(v).skillProficiencies[fe()]=M,r(v))),D("click",X,()=>Ce(fe())),o(pe,oe)}),l(W),o(Q,W)};_(je,Q=>{m(),r(()=>!m().skills)&&Q(he)})}l(De),F(()=>{ue=_t(De,1,"skills svelte-1f1pl16",null,ue,{hidden:!e(H)}),st(le,"aria-label",(m(),r(()=>m().skills?"Expand":"Collapse"))),y(q,(m(),r(()=>m().skills?"â–¼":"â–²")))}),D("click",le,de),o(s,De),It(),I()}let ua=null,pa=null;async function ts(){if(ua)return ua;try{return ua=await(await fetch(es("/data/spells.json"))).json(),ua||[]}catch(s){return console.error("Failed to load spells:",s),[]}}async function Qs(){if(pa)return pa;try{return pa=await(await fetch(es("/data/feats.json"))).json(),pa||[]}catch(s){return console.error("Failed to load feats:",s),[]}}function Oa(s,n){if(!n.trim())return s;const t=n.toLowerCase();return s.filter(v=>v.name.toLowerCase().includes(t)||v.school.toLowerCase().includes(t)||v.classes.some(p=>p.toLowerCase().includes(t))||v.description.toLowerCase().includes(t))}function Xs(s,n){return n===null?s:s.filter(t=>t.level===n)}function Ys(s,n){if(!n.trim())return s;const t=n.toLowerCase();return s.filter(v=>v.name.toLowerCase().includes(t)||v.description.toLowerCase().includes(t))}function fa(s){const n=s.description,t=/\b(Strength|Dexterity|Constitution|Intelligence|Wisdom|Charisma)\s+saving\s+throw/i,v=n.match(t);if(!v)return null;const p=v[1].toLowerCase(),x=/half\s+(?:as\s+much\s+)?damage\s+on\s+a\s+successful(?:\s+save)?/i.test(n),k=/saving\s+throw\s+or\s+take.*?damage/i.test(n)&&!x;return{ability:p,halfDamageOnSave:x,noDamageOnSave:k}}function Zs(s){const n=s.description;return/(plus|add)\s+your\s+spellcasting\s+(ability\s+)?modifier/i.test(n)}function qa(s){const n=s.description.toLowerCase(),v=["takes","take","deals","deal","damage equal to","force damage","fire damage","cold damage","lightning damage","thunder damage","acid damage","poison damage","necrotic damage","radiant damage","psychic damage","regain","regains","hit point"].some(x=>n.includes(x));return["bonus to attack","bonus to damage","bonus to ac","gains a +","gain a +","+1 bonus","+2 bonus","+3 bonus","advantage on","becomes a magic weapon"].some(x=>n.includes(x))&&!v}function el(s){const n=s.description;let t=0,v=0,p="";const m=n.match(/\+(\d+)\s+bonus\s+to\s+attack\s+rolls\s+and\s+damage\s+rolls/i);if(m){const I=parseInt(m[1]);t=I,v=I,p=`+${I} to attack and damage rolls`}s.name==="Bless"&&(p="Add 1d4 to attack rolls and saves");const x=n.match(/\+(\d+)\s+bonus\s+to\s+AC/i);return x&&(p=`+${parseInt(x[1])} to AC`),s.name==="Haste"&&(p="+2 AC, doubled speed, extra action"),p||t!==0||v!==0?{attackBonus:t,damageBonus:v,description:p||s.description.substring(0,100)}:null}var tl=u('<button class="btn-remove svelte-14o91c5">Ã—</button>'),al=u('<div class="spell-info-loading svelte-14o91c5">Loading spell info...</div>'),sl=u('<div class="spell-notes svelte-14o91c5"><h4 class="svelte-14o91c5">General Notes</h4> <p> </p></div>'),ll=u('<li class="svelte-14o91c5"><strong>At Higher Levels:</strong> </li>'),il=u('<ul class="svelte-14o91c5"><li class="svelte-14o91c5"><strong>Level:</strong> </li> <li class="svelte-14o91c5"><strong>Casting Time:</strong> </li> <li class="svelte-14o91c5"><strong>Range:</strong> </li> <li class="svelte-14o91c5"><strong>Components:</strong> <!></li> <li class="svelte-14o91c5"><strong>Duration:</strong> <!> </li> <li class="svelte-14o91c5"><strong>Description:</strong> </li> <!></ul>'),rl=u("<option> </option>"),nl=u('<span class="scaled-damage svelte-14o91c5"><!> </span>'),ol=u('<span class="scaled-damage svelte-14o91c5"> </span>'),cl=u('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> Target is Fiend or Undead <!></label></div>'),vl=u('<span class="scaled-damage svelte-14o91c5" style="margin-left: 8px;"> </span>'),dl=u('<span class="scaled-damage svelte-14o91c5">(Half damage)</span>'),ul=u('<span class="scaled-damage svelte-14o91c5">(No damage)</span>'),pl=u('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> <!> <!></label></div>'),fl=u('<div class="spell-level-selector svelte-14o91c5"><label class="svelte-14o91c5">Cast at Level:</label> <select class="spell-level-select use-enabled svelte-14o91c5"></select> <!></div> <!> <!>',1),bl=u('<div class="spell-level-selector svelte-14o91c5"><span style="color: #dc3545; font-weight: bold;">No spell slots available!</span></div>'),gl=u('<!> <div class="spell-info svelte-14o91c5"><div class="spell-info-header svelte-14o91c5" role="button" tabindex="0"><h4 class="svelte-14o91c5">Spell Info</h4> <button class="collapse-btn-small svelte-14o91c5"> </button></div> <!></div> <!>',1),hl=u('<div class="spell-info-missing svelte-14o91c5">Spell info not found.</div>'),ml=u('<div class="attack-notes svelte-14o91c5"><label class="svelte-14o91c5">Notes</label> <textarea placeholder="e.g., DC 15 Dex save, Range 120 ft, Concentration" class="notes-input svelte-14o91c5" rows="2"></textarea></div>'),_l=u('<button class="btn btn-primary">Roll Attack</button>'),yl=u('<button class="btn btn-success">Cast Spell</button>'),kl=u('<button class="btn btn-secondary"><!></button>'),xl=u('<button class="btn btn-secondary">Roll Damage</button>'),Sl=u('<div class="attack-card svelte-14o91c5"><div class="attack-header svelte-14o91c5"><input type="text" placeholder="Attack name" class="attack-name svelte-14o91c5"/> <!></div> <div class="attack-details svelte-14o91c5"><div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Bonus</label> <input type="number" class="attack-bonus svelte-14o91c5"/></div> <div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Damage</label> <input type="text" placeholder="e.g., 2d6+3" class="attack-damage svelte-14o91c5"/></div> <div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Type</label> <input type="text" placeholder="e.g., slashing" class="attack-type svelte-14o91c5"/></div></div> <!> <!> <div class="attack-actions svelte-14o91c5"><!> <!></div></div>'),$l=u('<p class="no-attacks svelte-14o91c5">No attacks added yet. Click "Add Attack" to create one.</p>'),Cl=u('<p class="no-attacks svelte-14o91c5">No attacks match your search.</p>'),wl=u('<button class="btn-remove svelte-14o91c5">Ã—</button>'),Ll=u('<div class="state-card svelte-14o91c5"><div class="state-header svelte-14o91c5"><input type="text" placeholder="Effect name (e.g., Magic Weapon)" class="state-name svelte-14o91c5"/> <!></div> <div class="state-details svelte-14o91c5"><div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Attack Bonus</label> <input type="number" class="state-bonus svelte-14o91c5"/></div> <div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Damage Bonus</label> <input type="number" class="state-bonus svelte-14o91c5"/></div></div> <div class="state-description svelte-14o91c5"><label class="svelte-14o91c5">Description</label> <input type="text" placeholder="e.g., +1 to attack and damage rolls (Magic Weapon)" class="state-desc-input svelte-14o91c5"/></div></div>'),Dl=u('<div class="states-list svelte-14o91c5"></div>'),jl=u('<p class="no-states svelte-14o91c5">No active effects. Add spell effects that modify your attacks.</p>'),Al=u('<button class="btn btn-secondary">Add Attack</button> <div class="attacks-list svelte-14o91c5"><!> <!></div> <div class="active-states-section svelte-14o91c5"><h3 class="svelte-14o91c5">Active Spell Effects</h3> <p class="section-description svelte-14o91c5">Effects that modify attack and damage rolls (e.g., Magic Weapon, Bless)</p> <button class="btn btn-secondary">Add Effect</button> <!></div>',1),Fl=u('<section><div class="header svelte-14o91c5"><h2 class="svelte-14o91c5">Attacks & Spells</h2> <button class="collapse-btn svelte-14o91c5"> </button></div> <!></section>');function Ml(s,n){Bt(n,!1);const t=()=>Ze(Z,"$character",I),v=()=>Ze(oa,"$abilityModifiers",I),p=()=>Ze(zt,"$searchFilter",I),m=()=>Ze(Ct,"$collapsedStates",I),x=()=>Ze(ia,"$isEditMode",I),[I,k]=Tt(),H=B(),ve=B(),V=Vt();let N=B({});function Ce(f){ja(N,e(N)[f]=!e(N)[f]),c(N,{...e(N)})}function de(f){return f.description.toLowerCase().includes("regain")&&(f.description.toLowerCase().includes("hit point")||f.description.toLowerCase().includes("hp"))}function De(){Z.update(f=>(f.attacks=[...f.attacks,{id:crypto.randomUUID(),name:"",bonus:0,damage:"",damageType:"",notes:""}],f))}function ue(f){Z.update(C=>(C.attacks=C.attacks.filter(X=>X.id!==f),C))}function ge(f){let C=f.damage,X=!1;if(f.spellRef){const ne=Q(f.spellRef);if(ne&&ne.level>0){const ye=f.castAtLevel||ne.level;if(!W(ye)){At.add(`No level ${ye} spell slots available!`,"error");return}const Te=fa(ne);Te&&f.targetSucceededSave&&Te.noDamageOnSave?C="0":(X=Te?.halfDamageOnSave&&f.targetSucceededSave||!1,C=pe(f,ne))}}else if(t().activeStates&&t().activeStates.length>0){let ne=0;for(const ye of t().activeStates)ne+=ye.damageBonus;if(ne!==0&&C){const ye=C.match(/(\d+d\d+)([+-]\d+)?/);if(ye){const[,We,Te]=ye,A=(Te?parseInt(Te):0)+ne;C=`${We}${A>=0?"+":""}${A}`}}}const M=[];f.bonus!==0&&M.push({value:f.bonus,source:"base"});let Y=f.bonus;if(t().activeStates)for(const ne of t().activeStates)ne.attackBonus!==0&&(M.push({value:ne.attackBonus,source:ne.name.toLowerCase()}),Y+=ne.attackBonus);let qe;qe=`1d20${Y>=0?"+":""}${Y}`,V("roll",{notation:qe,damageNotation:C,attackName:f.name,applyHalfDamage:X,bonusBreakdown:M})}function le(f){if(!f.damage){At.add(`${f.name}: No damage specified`,"error");return}let C=f.damage,X=!1;const M=[];if(f.spellRef){const Y=Q(f.spellRef);if(Y&&Y.level>0){const qe=f.castAtLevel||Y.level;if(!W(qe)){At.add(`No level ${qe} spell slots available!`,"error");return}const ye=fa(Y);ye&&f.targetSucceededSave&&ye.noDamageOnSave?C="0":(X=ye?.halfDamageOnSave&&f.targetSucceededSave||!1,C=pe(f,Y))}}else{const Y=C.match(/(\d+d\d+)([+-]\d+)?/);if(Y){const[,qe,ne]=Y,ye=ne?parseInt(ne):0;if(ye!==0&&M.push({value:ye,source:"base"}),t().activeStates&&t().activeStates.length>0){let We=0;for(const Te of t().activeStates)Te.damageBonus!==0&&(M.push({value:Te.damageBonus,source:Te.name.toLowerCase()}),We+=Te.damageBonus);if(We!==0){const Te=ye+We;C=`${qe}${Te>=0?"+":""}${Te}`}}}}V("roll",{notation:C,attackName:f.name,applyHalfDamage:X,bonusBreakdown:M})}function q(){Ct.update(f=>({...f,attacks:!f.attacks}))}let je=B([]),he=B(!1);na(async()=>{c(je,await ts()),c(he,!0)});function Q(f){return e(je).find(C=>C.name===f)}function W(f){t().classFeatures.spellSlotsByLevel||nt(Z,r(t).classFeatures.spellSlotsByLevel={},r(t)),t().classFeatures.spellSlotsByLevel[f]||nt(Z,r(t).classFeatures.spellSlotsByLevel[f]=Array(2).fill(!1),r(t));const X=t().classFeatures.spellSlotsByLevel[f].findIndex(M=>!M);return X===-1?!1:(Z.update(M=>(M.classFeatures.spellSlotsByLevel||(M.classFeatures.spellSlotsByLevel={}),M.classFeatures.spellSlotsByLevel[f]||(M.classFeatures.spellSlotsByLevel[f]=Array(2).fill(!1)),M.classFeatures.spellSlotsByLevel[f][X]=!0,M)),!0)}function pe(f,C){let X=f.damage,M=0,Y=0;if(Zs(C)&&(Y+=Ns(t(),v())),t().activeStates)for(const j of t().activeStates)Y+=j.damageBonus;if(C.higherLevelSlot&&f.castAtLevel){const j=C.level,Ue=(f.castAtLevel||j)-j;if(Ue>0){const ie=C.higherLevelSlot.match(/(\d+)d(\d+)\s+for\s+each.*?level\s+above/i);if(ie){const[,R]=ie;M+=Ue*parseInt(R)}}}if(f.targetIsFiendOrUndead&&C.description.includes("Fiend or an Undead")){const j=C.description.match(/increases by (\d+)d(\d+) if.*?Fiend or.*?Undead/i);if(j){const[,d]=j;M+=parseInt(d)}}const qe=X.match(/(\d+)d(\d+)([+-]\d+)?/);if(!qe)return Y!==0?Y>=0?`${Y}`:`${Y}`:X||"0";const[,ne,ye,We]=qe,Te=parseInt(ne)+M,A=(We?parseInt(We):0)+Y;let E=`${Te}d${ye}`;return A!==0&&(E+=A>=0?`+${A}`:`${A}`),E}function xe(f){const C=[];for(let M=f.level;M<=9;M++){const Y=t().classFeatures.spellSlotsByLevel?.[M];Y&&Y.length>0&&C.push(M)}return C}function fe(){Z.update(f=>(f.activeStates||(f.activeStates=[]),f.activeStates=[...f.activeStates,{name:"",attackBonus:0,damageBonus:0,description:""}],f))}function Ne(f){Z.update(C=>(C.activeStates&&(C.activeStates=C.activeStates.filter((X,M)=>M!==f)),C))}function S(f){const C=Q(f.spellRef);if(!C){At.add("Spell not found","error");return}const X=f.castAtLevel||C.level;if(X>0&&!W(X)){At.add(`No level ${X} spell slots available!`,"error");return}const M=el(C);if(!M){At.add(`${C.name} cast! Check spell description for effects.`,"info");return}Z.update(Y=>(Y.activeStates||(Y.activeStates=[]),Y.activeStates=Y.activeStates.filter(qe=>qe.name!==C.name),Y.activeStates=[...Y.activeStates,{name:C.name,attackBonus:M.attackBonus,damageBonus:M.damageBonus,description:M.description}],Y)),At.add(`${C.name} cast! Effect added to Active Spell Effects.`,"success")}tt(()=>(t(),e(N)),()=>{if(t()&&t().attacks)for(const f of t().attacks)f.spellRef&&e(N)[f.id]===void 0&&ja(N,e(N)[f.id]=!0)}),tt(()=>(t(),p()),()=>{c(H,t().attacks.filter(f=>{if(!p())return!0;const C=p().toLowerCase();return f.name.toLowerCase().includes(C)||f.damageType.toLowerCase().includes(C)}).sort((f,C)=>!f.spellRef&&C.spellRef?-1:f.spellRef&&!C.spellRef?1:0))}),tt(()=>(p(),e(H)),()=>{c(ve,!p()||e(H).length>0||"attack".includes(p().toLowerCase())||"spell".includes(p().toLowerCase()))}),Gt(),Mt();var re=Fl();let oe;var me=i(re),g=a(i(me),2),G=i(g,!0);l(g),l(me);var _e=a(me,2);{var Pe=f=>{var C=Al(),X=Oe(C),M=a(X,2),Y=i(M);pt(Y,1,()=>e(H),j=>j.id,(j,d,Ue)=>{var ie=Sl(),R=i(ie),J=i(R);Le(J);var w=a(J,2);{var Se=O=>{var te=tl();D("click",te,()=>ue(e(d).id)),o(O,te)};_(w,O=>{x()&&O(Se)})}l(R);var Ae=a(R,2),Ie=i(Ae),Qe=a(i(Ie),2);Le(Qe),l(Ie);var Ve=a(Ie,2),Re=a(i(Ve),2);Le(Re),l(Ve);var ae=a(Ve,2),we=a(i(ae),2);Le(we),l(ae),l(Ae);var Ge=a(Ae,2);{var ze=O=>{var te=ot(),ce=Oe(te);{var Je=Xe=>{var P=al();o(Xe,P)},ke=Xe=>{const P=rt(()=>(e(d),r(()=>Q(e(d).spellRef))));var at=ot(),vt=Oe(at);{var $=h=>{var T=gl(),K=Oe(T);{var He=lt=>{var ht=sl(),kt=a(i(ht),2),Ot=i(kt,!0);l(kt),l(ht),F(()=>y(Ot,(e(d),r(()=>e(d).generalNotes)))),o(lt,ht)};_(K,lt=>{e(d),r(()=>e(d).generalNotes)&&lt(He)})}var Ee=a(K,2),Ye=i(Ee),Be=a(i(Ye),2),bt=i(Be,!0);l(Be),l(Ye);var ut=a(Ye,2);{var Rt=lt=>{var ht=il(),kt=i(ht),Ot=a(i(kt));l(kt);var Kt=a(kt,2),ea=a(i(Kt));l(Kt);var jt=a(Kt,2),dt=a(i(jt));l(jt);var Lt=a(jt,2),Et=a(i(Lt)),Qt=a(Et);{var Jt=et=>{var ct=$t();F(()=>y(ct,`(${U(e(P)),r(()=>e(P).material)??""})`)),o(et,ct)};_(Qt,et=>{U(e(P)),r(()=>e(P).material)&&et(Jt)})}l(Lt);var ta=a(Lt,2),ca=a(i(ta),2);{var va=et=>{var ct=$t("Concentration,");o(et,ct)};_(ca,et=>{U(e(P)),r(()=>e(P).concentration)&&et(va)})}var ya=a(ca,1,!0);l(ta);var aa=a(ta,2),ka=a(i(aa));l(aa);var mt=a(aa,2);{var yt=et=>{var ct=ll(),Pt=a(i(ct));l(ct),F(()=>y(Pt,` ${U(e(P)),r(()=>e(P).higherLevelSlot)??""}`)),o(et,ct)};_(mt,et=>{U(e(P)),r(()=>e(P).higherLevelSlot)&&et(yt)})}l(ht),F(et=>{y(Ot,` ${U(e(P)),r(()=>e(P).level)??""}`),y(ea,` ${U(e(P)),r(()=>e(P).castingTime||e(P).actionType)??""}`),y(dt,` ${U(e(P)),r(()=>e(P).range)??""}`),y(Et,` ${et??""}`),y(ya,(U(e(P)),r(()=>e(P).duration))),y(ka,` ${U(e(P)),r(()=>e(P).description)??""}`)},[()=>(U(e(P)),r(()=>e(P).components.join(", ")))]),o(lt,ht)};_(ut,lt=>{e(N),e(d),r(()=>!e(N)[e(d).id])&&lt(Rt)})}l(Ee);var gt=a(Ee,2);{var wt=lt=>{const ht=rt(()=>(U(e(P)),r(()=>xe(e(P)))));var kt=ot(),Ot=Oe(kt);{var Kt=jt=>{const dt=rt(()=>(U(fa),U(e(P)),r(()=>fa(e(P)))));var Lt=fl(),Et=Oe(Lt),Qt=i(Et),Jt=a(Qt,2);F(()=>{e(d),St(()=>{e(ht)})}),pt(Jt,5,()=>e(ht),ft,(mt,yt)=>{var et=rl(),ct=i(et);l(et);var Pt={};F(()=>{y(ct,`Level ${e(yt)??""}`),Pt!==(Pt=e(yt))&&(et.value=(et.__value=e(yt))??"")}),o(mt,et)}),l(Jt);var ta=a(Jt,2);{var ca=mt=>{const yt=rt(()=>(e(d),U(e(P)),r(()=>pe(e(d),e(P)))));var et=nl(),ct=i(et);{var Pt=Ht=>{var Ut=$t("Healing");o(Ht,Ut)},Xt=Ht=>{var Ut=$t("Damage");o(Ht,Ut)};_(ct,Ht=>{U(e(P)),r(()=>de(e(P)))?Ht(Pt):Ht(Xt,!1)})}var Nt=a(ct);l(et),F(()=>y(Nt,` ${e(yt)??""}`)),o(mt,et)};_(ta,mt=>{e(d),U(e(P)),r(()=>e(d).castAtLevel&&e(d).castAtLevel>e(P).level)&&mt(ca)})}l(Et);var va=a(Et,2);{var ya=mt=>{var yt=cl(),et=i(yt),ct=i(et);Le(ct);var Pt=a(ct,2);{var Xt=Nt=>{const Ht=rt(()=>(e(d),U(e(P)),r(()=>pe(e(d),e(P)))));var Ut=ol(),xa=i(Ut);l(Ut),F(()=>y(xa,`(+1d8, total: ${e(Ht)??""})`)),o(Nt,Ut)};_(Pt,Nt=>{e(d),r(()=>e(d).targetIsFiendOrUndead)&&Nt(Xt)})}l(et),l(yt),ha(ct,()=>e(d).targetIsFiendOrUndead,Nt=>(e(d).targetIsFiendOrUndead=Nt,St(()=>(e(H),t(),p())))),o(mt,yt)};_(va,mt=>{U(e(P)),r(()=>e(P).description.includes("Fiend or an Undead"))&&mt(ya)})}var aa=a(va,2);{var ka=mt=>{var yt=pl(),et=i(yt),ct=i(et);Le(ct);var Pt=a(ct),Xt=a(Pt);{var Nt=xt=>{var qt=vl(),Sa=i(qt);l(qt),F($a=>y(Sa,`(Spell Save DC: ${$a??""})`),[()=>(U(Ba),t(),v(),r(()=>Ba(t(),v())))]),o(xt,qt)};_(Xt,xt=>{t(),r(()=>t().class)&&xt(Nt)})}var Ht=a(Xt,2);{var Ut=xt=>{var qt=dl();o(xt,qt)},xa=xt=>{var qt=ot(),Sa=Oe(qt);{var $a=Ca=>{var as=ul();o(Ca,as)};_(Sa,Ca=>{e(d),U(e(dt)),r(()=>e(d).targetSucceededSave&&e(dt).noDamageOnSave)&&Ca($a)},!0)}o(xt,qt)};_(Ht,xt=>{e(d),U(e(dt)),r(()=>e(d).targetSucceededSave&&e(dt).halfDamageOnSave)?xt(Ut):xt(xa,!1)})}l(et),l(yt),F(xt=>y(Pt,` Target succeeded on ${xt??""} save `),[()=>(U(e(dt)),r(()=>e(dt).ability.charAt(0).toUpperCase()+e(dt).ability.slice(1)))]),ha(ct,()=>e(d).targetSucceededSave,xt=>(e(d).targetSucceededSave=xt,St(()=>(e(H),t(),p())))),o(mt,yt)};_(aa,mt=>{e(dt)&&mt(ka)})}F(()=>{st(Qt,"for",`castLevel-${e(d),r(()=>e(d).id)??""}`),st(Jt,"id",`castLevel-${e(d),r(()=>e(d).id)??""}`)}),Za(Jt,()=>e(d).castAtLevel,mt=>(e(d).castAtLevel=mt,St(()=>(e(H),t(),p())))),o(jt,Lt)},ea=jt=>{var dt=bl();o(jt,dt)};_(Ot,jt=>{U(e(ht)),r(()=>e(ht).length>0)?jt(Kt):jt(ea,!1)})}o(lt,kt)};_(gt,lt=>{U(e(P)),r(()=>e(P).higherLevelSlot&&e(P).level>0)&&lt(wt)})}F(()=>{st(Be,"aria-label",(e(N),e(d),r(()=>e(N)[e(d).id]?"Expand":"Collapse"))),y(bt,(e(N),e(d),r(()=>e(N)[e(d).id]?"â–¼":"â–²")))}),D("click",Ye,()=>Ce(e(d).id)),D("keydown",Ye,lt=>lt.key==="Enter"&&Ce(e(d).id)),o(h,T)},Fe=h=>{var T=hl();o(h,T)};_(vt,h=>{e(P)?h($):h(Fe,!1)})}o(Xe,at)};_(ce,Xe=>{e(je),r(()=>e(je).length===0)?Xe(Je):Xe(ke,!1)})}o(O,te)};_(Ge,O=>{e(d),r(()=>e(d).spellRef)&&O(ze)})}var z=a(Ge,2);{var $e=O=>{var te=ml(),ce=a(i(te),2);la(ce),l(te),Me(ce,()=>e(d).notes,Je=>(e(d).notes=Je,St(()=>(e(H),t(),p())))),o(O,te)};_(z,O=>{e(d),r(()=>!e(d).spellRef)&&O($e)})}var Ke=a(z,2),b=i(Ke);{var L=O=>{var te=_l();D("click",te,()=>ge(e(d))),o(O,te)};_(b,O=>{e(d),r(()=>e(d).bonus!==0||!e(d).spellRef)&&O(L)})}var se=a(b,2);{var ee=O=>{const te=rt(()=>(e(d),r(()=>Q(e(d).spellRef))));var ce=ot(),Je=Oe(ce);{var ke=P=>{var at=yl();D("click",at,()=>S(e(d))),o(P,at)},Xe=P=>{var at=kl(),vt=i(at);{var $=h=>{var T=$t("Roll Healing");o(h,T)},Fe=h=>{var T=$t("Roll Damage");o(h,T)};_(vt,h=>{U(e(te)),r(()=>e(te)&&de(e(te)))?h($):h(Fe,!1)})}l(at),D("click",at,()=>le(e(d))),o(P,at)};_(Je,P=>{U(e(te)),U(qa),r(()=>e(te)&&qa(e(te)))?P(ke):P(Xe,!1)})}o(O,ce)},be=O=>{var te=xl();D("click",te,()=>le(e(d))),o(O,te)};_(se,O=>{e(d),e(he),r(()=>e(d).spellRef&&e(he))?O(ee):O(be,!1)})}l(Ke),l(ie),Me(J,()=>e(d).name,O=>(e(d).name=O,St(()=>(e(H),t(),p())))),Me(Qe,()=>e(d).bonus,O=>(e(d).bonus=O,St(()=>(e(H),t(),p())))),Me(Re,()=>e(d).damage,O=>(e(d).damage=O,St(()=>(e(H),t(),p())))),Me(we,()=>e(d).damageType,O=>(e(d).damageType=O,St(()=>(e(H),t(),p())))),o(j,ie)});var qe=a(Y,2);{var ne=j=>{var d=$l();o(j,d)},ye=j=>{var d=ot(),Ue=Oe(d);{var ie=R=>{var J=Cl();o(R,J)};_(Ue,R=>{e(H),r(()=>e(H).length===0)&&R(ie)},!0)}o(j,d)};_(qe,j=>{t(),r(()=>t().attacks.length===0)?j(ne):j(ye,!1)})}l(M);var We=a(M,2),Te=a(i(We),4),it=a(Te,2);{var A=j=>{var d=Dl();pt(d,5,()=>(t(),r(()=>t().activeStates)),ft,(Ue,ie,R)=>{var J=Ll(),w=i(J),Se=i(w);Le(Se);var Ae=a(Se,2);{var Ie=z=>{var $e=wl();D("click",$e,()=>Ne(R)),o(z,$e)};_(Ae,z=>{x()&&z(Ie)})}l(w);var Qe=a(w,2),Ve=i(Qe),Re=a(i(Ve),2);Le(Re),l(Ve);var ae=a(Ve,2),we=a(i(ae),2);Le(we),l(ae),l(Qe);var Ge=a(Qe,2),ze=a(i(Ge),2);Le(ze),l(Ge),l(J),Me(Se,()=>e(ie).name,z=>(e(ie).name=z,St(()=>t()),da(I,"$character"))),Me(Re,()=>e(ie).attackBonus,z=>(e(ie).attackBonus=z,St(()=>t()),da(I,"$character"))),Me(we,()=>e(ie).damageBonus,z=>(e(ie).damageBonus=z,St(()=>t()),da(I,"$character"))),Me(ze,()=>e(ie).description,z=>(e(ie).description=z,St(()=>t()),da(I,"$character"))),o(Ue,J)}),l(d),o(j,d)},E=j=>{var d=jl();o(j,d)};_(it,j=>{t(),r(()=>t().activeStates&&t().activeStates.length>0)?j(A):j(E,!1)})}l(We),D("click",X,De),D("click",Te,fe),o(f,C)};_(_e,f=>{m(),r(()=>!m().attacks)&&f(Pe)})}l(re),F(()=>{oe=_t(re,1,"attacks svelte-14o91c5",null,oe,{hidden:!e(ve)}),st(g,"aria-label",(m(),r(()=>m().attacks?"Expand":"Collapse"))),y(G,(m(),r(()=>m().attacks?"â–¼":"â–²")))}),D("click",g,q),o(s,re),It(),k()}var Bl=u('<span class="slot-checkbox-x svelte-serp1j">&#8212;</span>'),Il=u('<label><input type="checkbox" class="slot-checkbox-input svelte-serp1j"/> <span><!></span></label>');function Wa(s,n){Bt(n,!1);const t=()=>Ze(ia,"$isEditMode",v),[v,p]=Tt();let m=Dt(n,"checked",8,!1),x=Dt(n,"disabled",8,!1),I=Dt(n,"className",8,""),k=Dt(n,"index",8,void 0),H=Dt(n,"ariaLabel",8,void 0);const ve=Vt();function V(ge){ve("change",{checked:ge.currentTarget.checked,index:k()})}Mt();var N=Il(),Ce=i(N);Le(Ce);var de=a(Ce,2),De=i(de);{var ue=ge=>{var le=Bl();o(ge,le)};_(De,ge=>{m()&&ge(ue)})}l(de),l(N),F(()=>{_t(N,1,"slot-checkbox-label "+I()+(t()?"":" not-editable"),"svelte-serp1j"),Ss(Ce,m()),Ce.disabled=x()||!t(),st(Ce,"aria-label",H()),st(Ce,"tabindex",t()?0:-1),_t(de,1,`slot-checkbox-custom ${m()?"used":""} ${t()?"":"readonly"}`,"svelte-serp1j")}),D("change",Ce,V),o(s,N),It(),p()}var Rl=u('<p class="no-features svelte-1kpvv0n">Select a class to see available features</p>'),El=u('<p class="no-features svelte-1kpvv0n">No class features available at this level</p>'),Pl=u('<div class="spell-slots svelte-1kpvv0n"><label class="svelte-1kpvv0n"> </label> <div class="slots-tracker svelte-1kpvv0n"></div></div>'),Tl=u('<div class="all-spell-slots"></div>'),Hl=u('<div class="feature-box spellcasting svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"> </h3> <div class="spell-stats svelte-1kpvv0n"><div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Spell Save DC</label> <div class="spell-value svelte-1kpvv0n"> </div></div> <div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <div class="spell-value svelte-1kpvv0n"> </div></div></div> <!> <div class="prepared-spells svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <textarea placeholder="List your prepared spells..." class="svelte-1kpvv0n"></textarea></div></div>'),Nl=u('<p class="unlimited svelte-1kpvv0n">Unlimited Uses</p>'),Ul=u('<div class="slots-tracker svelte-1kpvv0n"></div> <div class="uses-actions-row"><button class="btn btn-primary use-enabled"> </button></div> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div>',1),Gl=u('<div class="uses-tracker svelte-1kpvv0n"><!></div>'),Ol=u('<div class="pool-tracker svelte-1kpvv0n"><input type="number" min="0" class="pool-input svelte-1kpvv0n"/> <span> </span> <button class="btn-small svelte-1kpvv0n"> </button></div>'),ql=u('<p class="no-uses svelte-1kpvv0n">No Channel Divinity uses remaining</p>'),Wl=u('<div class="channel-divinity-option svelte-1kpvv0n"><button class="btn btn-primary use-enabled svelte-1kpvv0n">Use Channel Divinity</button> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div> <!></div>'),zl=u('<div class="feature-box svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"><!> </h3> <p class="feature-description svelte-1kpvv0n"> </p> <!></div>'),Kl=u('<div class="features-grid svelte-1kpvv0n"><!> <!></div>'),Jl=u('<section><div class="header svelte-1kpvv0n"><h2 class="svelte-1kpvv0n">Class Features</h2> <button class="collapse-btn svelte-1kpvv0n"> </button></div> <!></section>');function Vl(s,n){Bt(n,!1);const t=()=>Ze(Z,"$character",x),v=()=>Ze(oa,"$abilityModifiers",x),p=()=>Ze(zt,"$searchFilter",x),m=()=>Ze(Ct,"$collapsedStates",x),[x,I]=Tt(),k=B(),H=B(),ve=B(),V=B(),N=B(),Ce=B(),de=B();let De=B(0),ue=B(0);function ge(g,G){Z.update(_e=>(_e.classFeatures.features[g]=G,_e))}function le(){Z.update(g=>(g.classFeatures.spellSlotsByLevel||(g.classFeatures.spellSlotsByLevel={}),e(V).forEach(({level:G,slots:_e})=>{g.classFeatures.spellSlotsByLevel[G]||(g.classFeatures.spellSlotsByLevel[G]=Array(_e).fill(!1))}),g))}function q(g){if(typeof g.maxUses=="function"){if((g.name==="Divine Sense"||g.name==="War Priest")&&e(k)?.spellcastingAbility){const G=v()[e(k).spellcastingAbility];return g.maxUses(t().level,G)}return g.maxUses(t().level)}return g.maxUses||0}function je(g,G){Z.update(_e=>((!_e.classFeatures.features[g]||!Array.isArray(_e.classFeatures.features[g])||_e.classFeatures.features[g].length!==G)&&(_e.classFeatures.features[g]=Array(G).fill(!1)),_e))}ss(()=>{e(Ce)&&t()&&t().classFeatures&&t().classFeatures.features&&e(Ce).forEach(g=>{if(g.type==="uses"){const G=g.name.replace(/\s+/g,""),_e=q(g),Pe=t().classFeatures.features[G];(!Array.isArray(Pe)||Pe.length!==_e)&&je(G,_e)}})});function he(g){return typeof g.maxPool=="function"?g.maxPool(t().level):g.maxPool||0}function Q(g){return typeof g.description=="function"?g.description(t().level):g.description}function W(){const g="ChannelDivinity";Z.update(G=>{const _e=G.classFeatures.features[g];return typeof _e=="number"&&_e>0&&(G.classFeatures.features[g]=_e-1),G})}function pe(){Ct.update(g=>({...g,classFeatures:!g.classFeatures}))}tt(()=>(t(),Ft),()=>{c(k,t().class?Ft(t().class):null)}),tt(()=>(t(),Zt),()=>{c(H,t().class?Zt(t().class,t().level,t().subclass):[])}),tt(()=>(t(),Ua),()=>{c(ve,t().class?Ua(t().class,t().level):0)}),tt(()=>(e(k),t()),()=>{c(V,(()=>{if(!e(k)?.spellcaster)return[];const g=t().level,G=[];return g>=1&&G.push({level:1,slots:Math.min(4,2+Math.floor(g/3))}),g>=3&&G.push({level:2,slots:Math.min(3,2+Math.floor((g-3)/4))}),g>=5&&G.push({level:3,slots:Math.min(3,2+Math.floor((g-5)/5))}),g>=7&&G.push({level:4,slots:Math.min(3,1+Math.floor((g-7)/6))}),g>=9&&G.push({level:5,slots:Math.min(2,1+Math.floor((g-9)/8))}),g>=11&&G.push({level:6,slots:1}),g>=13&&G.push({level:7,slots:1}),g>=15&&G.push({level:8,slots:1}),g>=17&&G.push({level:9,slots:1}),G})())}),tt(()=>(e(k),v(),t(),Ga),()=>{if(e(k)?.spellcaster&&e(k).spellcastingAbility){const g=v()[e(k).spellcastingAbility];c(De,Ls(t().class,g,t().proficiencyBonus)||0),c(ue,Ga(t().class,t().level,g))}}),tt(()=>(t(),e(k),e(V)),()=>{t().class&&e(k)?.spellcaster&&e(V).length>0&&le()}),tt(()=>t(),()=>{c(N,(()=>{const G=t().classFeatures.features["ChannelDivinity"];return typeof G=="number"?G:0})())}),tt(()=>(e(H),p()),()=>{c(Ce,e(H).filter(g=>{if(!p())return!0;const G=p().toLowerCase();return g.name.toLowerCase().includes(G)||Q(g).toLowerCase().includes(G)}))}),tt(()=>(p(),t(),e(Ce)),()=>{c(de,!p()||t().class||"class features".includes(p().toLowerCase())||"spellcasting".includes(p().toLowerCase())||e(Ce).length>0)}),Gt(),Mt();var xe=Jl();let fe;var Ne=i(xe),S=a(i(Ne),2),re=i(S,!0);l(S),l(Ne);var oe=a(Ne,2);{var me=g=>{var G=ot(),_e=Oe(G);{var Pe=C=>{var X=Rl();o(C,X)},f=C=>{var X=ot(),M=Oe(X);{var Y=ne=>{var ye=El();o(ne,ye)},qe=ne=>{var ye=Kl(),We=i(ye);{var Te=A=>{var E=Hl(),j=i(E),d=i(j);l(j);var Ue=a(j,2),ie=i(Ue),R=a(i(ie),2),J=i(R,!0);l(R),l(ie);var w=a(ie,2),Se=a(i(w),2),Ae=i(Se,!0);l(Se),l(w),l(Ue);var Ie=a(Ue,2);{var Qe=ae=>{var we=Tl();pt(we,5,()=>e(V),ft,(Ge,ze)=>{let z=()=>e(ze).level,$e=()=>e(ze).slots;const Ke=rt(()=>(t(),z(),$e(),r(()=>t().classFeatures.spellSlotsByLevel?.[z()]||Array($e()).fill(!1))));var b=Pl(),L=i(b),se=i(L);l(L);var ee=a(L,2);pt(ee,5,()=>e(Ke),ft,(be,O,te)=>{{let ce=rt(()=>(U(e(Ke)),r(()=>e(Ke)[te]||!1)));Wa(be,{get checked(){return e(ce)},$$events:{change:Je=>{Z.update(ke=>(ke.classFeatures.spellSlotsByLevel||(ke.classFeatures.spellSlotsByLevel={}),ke.classFeatures.spellSlotsByLevel[z()]||(ke.classFeatures.spellSlotsByLevel[z()]=Array($e()).fill(!1)),ke.classFeatures.spellSlotsByLevel[z()][te]=Je.detail.checked,ke))}}})}}),l(ee),l(b),F(()=>y(se,`${z()===1?"1st":z()===2?"2nd":z()===3?"3rd":`${z()}th`} Level Spell Slots`)),o(Ge,b)}),l(we),o(ae,we)};_(Ie,ae=>{e(V),r(()=>e(V).length>0)&&ae(Qe)})}var Ve=a(Ie,2),Re=a(i(Ve),2);la(Re),l(Ve),l(E),F(ae=>{y(d,`Spellcasting (${ae??""})`),y(J,e(De)),y(Ae,e(ue))},[()=>(e(k),r(()=>e(k).spellcastingAbility?.toUpperCase()))]),Me(Re,()=>t().classFeatures.preparedSpells,ae=>nt(Z,r(t).classFeatures.preparedSpells=ae,r(t))),o(A,E)};_(We,A=>{e(k),r(()=>e(k)?.spellcaster)&&A(Te)})}var it=a(We,2);pt(it,1,()=>e(Ce),ft,(A,E)=>{const j=rt(()=>(e(E),r(()=>e(E).name.replace(/\s+/g,"")))),d=rt(()=>(t(),U(e(j)),r(()=>t().classFeatures.features[e(j)]))),Ue=rt(()=>typeof e(d)=="number");var ie=zl(),R=i(ie),J=i(R);{var w=ae=>{var we=$t("Channel Divinity:");o(ae,we)};_(J,ae=>{e(E),r(()=>e(E).type==="channelDivinity")&&ae(w)})}var Se=a(J);l(R);var Ae=a(R,2),Ie=i(Ae,!0);l(Ae);var Qe=a(Ae,2);{var Ve=ae=>{const we=rt(()=>(e(E),r(()=>q(e(E))))),Ge=rt(()=>(U(e(d)),U(e(we)),r(()=>Array.isArray(e(d))?e(d):Array(e(we)).fill(!1))));var ze=Gl(),z=i(ze);{var $e=b=>{var L=Nl();o(b,L)},Ke=b=>{var L=Ul(),se=Oe(L);pt(se,5,()=>e(Ge),ft,(ke,Xe,P)=>{Wa(ke,{get checked(){return e(Xe)},index:P,$$events:{change:at=>{Z.update(vt=>(vt.classFeatures.features[e(j)]||(vt.classFeatures.features[e(j)]=Array(e(we)).fill(!1)),vt.classFeatures.features[e(j)][P]=at.detail.checked,vt))}}})}),l(se);var ee=a(se,2),be=i(ee),O=i(be);l(be),l(ee);var te=a(ee,2),ce=i(te),Je=i(ce);l(ce),l(te),F(ke=>{be.disabled=ke,y(O,`Use ${e(E),r(()=>e(E).name)??""}`),y(Je,`Resets on ${e(E),r(()=>e(E).resetOn==="short"?"Short Rest":"Long Rest")??""}`)},[()=>(U(e(Ge)),r(()=>e(Ge).filter(ke=>!ke).length<=0))]),D("click",be,()=>{Z.update(ke=>{ke.classFeatures.features[e(j)]||(ke.classFeatures.features[e(j)]=Array(e(we)).fill(!1));const Xe=ke.classFeatures.features[e(j)],P=Xe.findIndex(at=>!at);return P!==-1&&(Xe[P]=!0),ke})}),o(b,L)};_(z,b=>{e(we)===1/0?b($e):b(Ke,!1)})}l(ze),o(ae,ze)},Re=ae=>{var we=ot(),Ge=Oe(we);{var ze=$e=>{const Ke=rt(()=>(e(E),r(()=>he(e(E)))));var b=Ol(),L=i(b);Le(L);var se=a(L,2),ee=i(se);l(se);var be=a(se,2),O=i(be,!0);l(be),l(b),F(()=>{Ra(L,e(Ue)&&e(d)!==void 0?e(d):e(Ke)),st(L,"max",e(Ke)),y(ee,`/ ${e(Ke)??""}`),y(O,(e(E),r(()=>e(E).resetOn==="short"?"Short Rest":"Long Rest")))}),D("input",L,te=>{Z.update(ce=>(ce.classFeatures.features[e(j)]=parseInt(te.currentTarget.value)||0,ce))}),D("click",be,()=>ge(e(j),e(Ke))),o($e,b)},z=$e=>{var Ke=ot(),b=Oe(Ke);{var L=se=>{var ee=Wl(),be=i(ee),O=a(be,2),te=i(O),ce=i(te);l(te),l(O);var Je=a(O,2);{var ke=Xe=>{var P=ql();o(Xe,P)};_(Je,Xe=>{e(N)<=0&&Xe(ke)})}l(ee),F(()=>{be.disabled=e(N)<=0,y(ce,`Resets on ${e(E),r(()=>e(E).resetOn==="short"?"Short Rest":"Long Rest")??""}`)}),D("click",be,W),o(se,ee)};_(b,se=>{e(E),r(()=>e(E).type==="channelDivinity")&&se(L)},!0)}o($e,Ke)};_(Ge,$e=>{e(E),r(()=>e(E).type==="pool")?$e(ze):$e(z,!1)},!0)}o(ae,we)};_(Qe,ae=>{e(E),r(()=>e(E).type==="uses")?ae(Ve):ae(Re,!1)})}l(ie),F(ae=>{y(Se,` ${e(E),r(()=>e(E).name)??""}`),y(Ie,ae)},[()=>(e(E),r(()=>Q(e(E))))]),o(A,ie)}),l(ye),o(ne,ye)};_(M,ne=>{e(H),r(()=>e(H).length===0)?ne(Y):ne(qe,!1)},!0)}o(C,X)};_(_e,C=>{t(),r(()=>!t().class)?C(Pe):C(f,!1)})}o(g,G)};_(oe,g=>{m(),r(()=>!m().classFeatures)&&g(me)})}l(xe),F(()=>{fe=_t(xe,1,"class-features svelte-1kpvv0n",null,fe,{hidden:!e(de)}),st(S,"aria-label",(m(),r(()=>m().classFeatures?"Expand":"Collapse"))),y(re,(m(),r(()=>m().classFeatures?"â–¼":"â–²")))}),D("click",S,pe),o(s,xe),It(),I()}var Ql=u('<textarea placeholder="Enter features, traits, and special abilities..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Equipment</h3> <textarea placeholder="List your equipment and inventory..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Notes</h3> <textarea placeholder="Additional notes..." class="svelte-wttn0l"></textarea>',1),Xl=u('<section><div class="header svelte-wttn0l"><h2 class="svelte-wttn0l">Features & Traits</h2> <button class="collapse-btn svelte-wttn0l"> </button></div> <!></section>');function Yl(s,n){Bt(n,!1);const t=()=>Ze(zt,"$searchFilter",m),v=()=>Ze(Z,"$character",m),p=()=>Ze(Ct,"$collapsedStates",m),[m,x]=Tt(),I=B();function k(){Ct.update(ue=>({...ue,notes:!ue.notes}))}tt(()=>(t(),v()),()=>{c(I,!t()||"features".includes(t().toLowerCase())||"traits".includes(t().toLowerCase())||"equipment".includes(t().toLowerCase())||"notes".includes(t().toLowerCase())||v().features.toLowerCase().includes(t().toLowerCase())||v().equipment.toLowerCase().includes(t().toLowerCase())||v().notes.toLowerCase().includes(t().toLowerCase()))}),Gt(),Mt();var H=Xl();let ve;var V=i(H),N=a(i(V),2),Ce=i(N,!0);l(N),l(V);var de=a(V,2);{var De=ue=>{var ge=Ql(),le=Oe(ge);la(le);var q=a(le,4);la(q);var je=a(q,4);la(je),Me(le,()=>v().features,he=>nt(Z,r(v).features=he,r(v))),Me(q,()=>v().equipment,he=>nt(Z,r(v).equipment=he,r(v))),Me(je,()=>v().notes,he=>nt(Z,r(v).notes=he,r(v))),o(ue,ge)};_(de,ue=>{p(),r(()=>!p().notes)&&ue(De)})}l(H),F(()=>{ve=_t(H,1,"notes svelte-wttn0l",null,ve,{hidden:!e(I)}),st(N,"aria-label",(p(),r(()=>p().notes?"Expand":"Collapse"))),y(Ce,(p(),r(()=>p().notes?"â–¼":"â–²")))}),D("click",N,k),o(s,H),It(),x()}var Zl=u('<div class="color-picker-section svelte-1r90jgp"><h3 class="svelte-1r90jgp">Dice Colors</h3> <div class="color-inputs svelte-1r90jgp"><div class="color-input-group svelte-1r90jgp"><label for="dice-color" class="svelte-1r90jgp">Dice Color</label> <input type="color" id="dice-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="label-color" class="svelte-1r90jgp">Label Color</label> <input type="color" id="label-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="desk-color" class="svelte-1r90jgp">Background Color</label> <input type="color" id="desk-color" class="svelte-1r90jgp"/></div></div></div>'),ei=u('<div class="loading svelte-1r90jgp"><p class="svelte-1r90jgp">Loading 3D dice...</p></div>'),ti=u('<div class="custom-dice-selector svelte-1r90jgp"><h3 class="svelte-1r90jgp">Choose Dice to Roll</h3> <div class="dice-inputs svelte-1r90jgp"><div class="dice-input-group svelte-1r90jgp"><label for="d4" class="svelte-1r90jgp">d4</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d4" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d6" class="svelte-1r90jgp">d6</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d6" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d8" class="svelte-1r90jgp">d8</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d8" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d10" class="svelte-1r90jgp">d10</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d10" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d12" class="svelte-1r90jgp">d12</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d12" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d20" class="svelte-1r90jgp">d20</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d20" min="0" max="10"/></div></div> <div class="dice-controls svelte-1r90jgp"><button class="btn btn-primary use-enabled svelte-1r90jgp"> </button> <button class="btn btn-secondary use-enabled svelte-1r90jgp">Reset</button></div></div>'),ai=u('<span class="crit-badge svelte-1r90jgp">CRITICAL!</span>'),si=u('<p class="svelte-1r90jgp"> </p>'),li=u('<div class="bonus-item svelte-1r90jgp"><span class="bonus-value svelte-1r90jgp"> </span> <span class="bonus-source svelte-1r90jgp"> </span></div>'),ii=u('<div class="bonus-breakdown svelte-1r90jgp"></div>'),ri=u('<p class="modifier-text svelte-1r90jgp"> </p>'),ni=u('<button class="btn btn-follow-up svelte-1r90jgp"> </button>'),oi=u('<button class="btn btn-guided-strike svelte-1r90jgp">âš¡ Use Guided Strike (+10)</button>'),ci=u('<div class="follow-up-actions svelte-1r90jgp"><!> <!></div>'),vi=u('<div class="result-header svelte-1r90jgp"><h3 class="svelte-1r90jgp"> </h3> <!></div> <div class="result-total svelte-1r90jgp"> </div> <div class="result-details svelte-1r90jgp"><!> <!></div> <!>',1),di=u('<div role="button" tabindex="-1"><div class="modal-content svelte-1r90jgp" role="dialog" tabindex="0"><div class="modal-header svelte-1r90jgp"><h2 class="svelte-1r90jgp">Dice Roller</h2> <div class="header-buttons svelte-1r90jgp"><button class="color-btn svelte-1r90jgp" title="Customize dice colors">ðŸŽ¨</button> <button class="close-btn svelte-1r90jgp">Ã—</button></div></div> <!> <!> <div class="dice-main-area svelte-1r90jgp"><div class="dice-container svelte-1r90jgp"></div> <!></div> <div><!></div></div></div>');function ui(s,n){Bt(n,!1);const t=()=>Ze(Z,"$character",v),[v,p]=Tt(),m=B(),x=B(),I=B(),k=Vt();let H=Dt(n,"notation",12,""),ve=Dt(n,"visible",8,!1),V=Dt(n,"damageNotation",12,""),N=Dt(n,"attackName",12,""),Ce=Dt(n,"applyHalfDamage",8,!1),de=Dt(n,"bonusBreakdown",28,()=>[]),De=null,ue=B(void 0),ge=B(!1),le=B(""),q=B(null);function je(){return e(q)?.resultTotal??null}let he=B(0),Q=B(0),W=B(0),pe=B(0),xe=B(0),fe=B(0),Ne=B(0),S=B([]),re=B(!1),oe=B("other"),me=B(!1),g=B("#051e0a"),G=B("#ffffff"),_e=B("#3a2004"),Pe=B(!1);function f(b){return b.length===9&&b.startsWith("#")?b.substring(0,7):b}function C(b,L="ff"){return b.length===7&&b.startsWith("#")?b+L:b}function X(){if(window.DICE&&e(ue))try{De&&e(ue)&&ja(ue,e(ue).innerHTML="");const b=e(ue).clientWidth||500,L=e(ue).clientHeight||300;De=new window.DICE.dice_box(e(ue),{w:b,h:L}),c(ge,!0)}catch(b){console.error("Error initializing dice box:",b)}}na(()=>{const b=ee=>new Promise((be,O)=>{if(document.querySelector(`script[src="${ee}"]`)){console.log(`Script already loaded: ${ee}`),be(null);return}const ce=document.createElement("script");ce.src=ee,ce.onload=()=>{console.log(`Loaded: ${ee}`),be(null)},ce.onerror=()=>{console.error(`Failed to load: ${ee}`),O(new Error(`Failed to load ${ee}`))},document.head.appendChild(ce)});setTimeout(()=>{b(`${sa}/libs/three.min.js`).then(()=>b(`${sa}/libs/cannon.min.js`)).then(()=>b(`${sa}/libs/teal.js`)).then(()=>b(`${sa}/dice.js`)).then(()=>{if(console.log("All scripts loaded, initializing dice box..."),console.log("DICE available:",!!window.DICE),console.log("Container available:",!!e(ue)),window.DICE){const ee=window.DICE.getColors();c(g,f(ee.dice_color)),c(G,f(ee.label_color)),c(_e,f(ee.desk_color))}X()}).catch(ee=>{console.error("Failed to load dice libraries:",ee)})},100);const L=()=>{e(ge)&&(console.log("Window resized, reinitializing dice box..."),X())},se=ee=>{ve()&&ee.key==="Escape"&&A()};return window.addEventListener("resize",L),window.addEventListener("keydown",se),()=>{window.removeEventListener("resize",L),window.removeEventListener("keydown",se)}});function M(b,L="other"){if(!De||!e(ge))return;console.log("Rolling dice:",b,"type:",L),c(q,null),c(S,[]),c(re,!1),L==="damage"&&de([]),c(oe,L),c(me,!1),De.diceToRoll=b;const se=be=>(console.log("Before roll:",be),null),ee=be=>{console.log("After roll:",be);let O=be.resultTotal,te=be.resultString;if(Ce()&&(O=Math.floor(O/2),te=te+" (halved)"),c(q,{...be,resultTotal:O,resultString:te}),L==="attack"||L==="check"||L==="save"){const ce=be.result?.filter(Je=>Je===20)||[];if(ce.length>0){const Je=ce[0];c(re,Je===20)}}if(c(S,[]),console.log("Setting up follow-up actions. Type:",L,"damageNotation:",V(),"isCritical:",e(re)),L==="attack")if(V()){if(e(re)){const ce=ne(V());console.log("Creating critical damage button:",ce),e(S).push({label:`Roll Critical Damage (${ce})`,notation:ce})}else console.log("Creating normal damage button:",V()),e(S).push({label:`Roll Damage (${V()})`,notation:V()});console.log("Follow-up actions after setup:",e(S))}else console.log("No damageNotation provided for attack roll");console.log("Final followUpActions:",e(S))};De.start_throw(se,ee)}function Y(){const b=[];e(he)>0&&b.push(`${e(he)}d4`),e(Q)>0&&b.push(`${e(Q)}d6`),e(W)>0&&b.push(`${e(W)}d8`),e(pe)>0&&b.push(`${e(pe)}d10`),e(xe)>0&&b.push(`${e(xe)}d12`),e(fe)>0&&b.push(`${e(fe)}d20`);let L=b.join("+")||"1d20";return e(Ne)!==0&&(L+=e(Ne)>=0?`+${e(Ne)}`:`${e(Ne)}`),L}function qe(){const b=Y();M(b)}function ne(b){return b.replace(/(\d+)d(\d+)/g,(L,se,ee)=>`${parseInt(se)*2}d${ee}`)}function ye(){c(he,0),c(Q,0),c(W,0),c(pe,0),c(xe,0),c(fe,0),c(Ne,0),c(q,null),c(S,[]),c(re,!1),c(oe,"other"),c(me,!1)}function We(){window.DICE&&(window.DICE.setColors({dice_color:C(e(g),"ff"),label_color:C(e(G),"ff"),desk_color:e(_e)}),De&&(De.updateDeskColor(e(_e)),De.updateDiceColors()))}function Te(){c(Pe,!e(Pe))}function it(){!e(q)||e(x)<=0||e(me)||(c(q,{...e(q),resultTotal:e(q).resultTotal+10,resultString:e(q).resultString+" + 10 (Guided Strike)"}),Z.update(b=>{const L="ChannelDivinity",se=b.classFeatures.features[L];return typeof se=="number"&&se>0&&(b.classFeatures.features[L]=se-1),b}),c(me,!0))}function A(){k("close"),H(""),V(""),N(""),c(le,""),c(q,null),c(me,!1),ye()}tt(()=>(t(),Zt),()=>{c(m,t().class?Zt(t().class,t().level,t().subclass).some(L=>L.name==="Guided Strike"):!1)}),tt(()=>t(),()=>{c(x,(()=>{const L=t().classFeatures.features["ChannelDivinity"];return typeof L=="number"?L:0})())}),tt(()=>(e(he),e(Q),e(W),e(pe),e(xe),e(fe),e(Ne)),()=>{c(I,(()=>{const b=[];e(he)>0&&b.push(`${e(he)}d4`),e(Q)>0&&b.push(`${e(Q)}d6`),e(W)>0&&b.push(`${e(W)}d8`),e(pe)>0&&b.push(`${e(pe)}d10`),e(xe)>0&&b.push(`${e(xe)}d12`),e(fe)>0&&b.push(`${e(fe)}d20`);let L=b.join("+")||"1d20";return e(Ne)!==0&&(L+=e(Ne)>=0?`+${e(Ne)}`:`${e(Ne)}`),L})())}),tt(()=>(U(H()),e(ge),U(ve()),e(le),U(V()),U(N())),()=>{if(H()&&e(ge)&&ve()&&H()!==e(le)){c(le,H()),c(q,null),c(S,[]),c(re,!1),c(me,!1);const b=H().includes("1d20")?"attack":"other";console.log("Auto-roll triggered. notation:",H(),"damageNotation:",V(),"attackName:",N()),setTimeout(()=>M(H(),b),200)}}),Gt();var E={getLastRollTotal:je};Mt();var j=di();let d;var Ue=i(j),ie=i(Ue),R=a(i(ie),2),J=i(R),w=a(J,2);l(R),l(ie);var Se=a(ie,2);{var Ae=b=>{var L=Zl(),se=a(i(L),2),ee=i(se),be=a(i(ee),2);Le(be),l(ee);var O=a(ee,2),te=a(i(O),2);Le(te),l(O);var ce=a(O,2),Je=a(i(ce),2);Le(Je),l(ce),l(se),l(L),Me(be,()=>e(g),ke=>c(g,ke)),D("change",be,We),Me(te,()=>e(G),ke=>c(G,ke)),D("change",te,We),Me(Je,()=>e(_e),ke=>c(_e,ke)),D("change",Je,We),o(b,L)};_(Se,b=>{e(Pe)&&b(Ae)})}var Ie=a(Se,2);{var Qe=b=>{var L=ei();o(b,L)};_(Ie,b=>{e(ge)||b(Qe)})}var Ve=a(Ie,2),Re=i(Ve);Aa(Re,b=>c(ue,b),()=>e(ue));var ae=a(Re,2);{var we=b=>{var L=ti(),se=a(i(L),2),ee=i(se),be=a(i(ee),2);Le(be),l(ee);var O=a(ee,2),te=a(i(O),2);Le(te),l(O);var ce=a(O,2),Je=a(i(ce),2);Le(Je),l(ce);var ke=a(ce,2),Xe=a(i(ke),2);Le(Xe),l(ke);var P=a(ke,2),at=a(i(P),2);Le(at),l(P);var vt=a(P,2),$=a(i(vt),2);Le($),l(vt),l(se);var Fe=a(se,2),h=i(Fe),T=i(h);l(h);var K=a(h,2);l(Fe),l(L),F(()=>{h.disabled=!e(ge),y(T,`Roll ${e(I)??""}`)}),Me(be,()=>e(he),He=>c(he,He)),Me(te,()=>e(Q),He=>c(Q,He)),Me(Je,()=>e(W),He=>c(W,He)),Me(Xe,()=>e(pe),He=>c(pe,He)),Me(at,()=>e(xe),He=>c(xe,He)),Me($,()=>e(fe),He=>c(fe,He)),D("click",h,qe),D("click",K,ye),o(b,L)};_(ae,b=>{H()||b(we)})}l(Ve);var Ge=a(Ve,2);let ze;var z=i(Ge);{var $e=b=>{var L=vi(),se=Oe(L),ee=i(se),be=i(ee,!0);l(ee);var O=a(ee,2);{var te=h=>{var T=ai();o(h,T)};_(O,h=>{e(re)&&h(te)})}l(se);var ce=a(se,2),Je=i(ce,!0);l(ce);var ke=a(ce,2),Xe=i(ke);{var P=h=>{var T=si(),K=i(T,!0);l(T),F(()=>y(K,(e(q),r(()=>e(q).resultString)))),o(h,T)};_(Xe,h=>{e(q),r(()=>e(q).resultString)&&h(P)})}var at=a(Xe,2);{var vt=h=>{var T=ot(),K=Oe(T);{var He=Ye=>{var Be=ii();pt(Be,5,de,ft,(bt,ut)=>{var Rt=li(),gt=i(Rt),wt=i(gt);l(gt);var lt=a(gt,2),ht=i(lt);l(lt),l(Rt),F(()=>{y(wt,`${e(ut),r(()=>e(ut).value>=0?"+":"")??""}${e(ut),r(()=>e(ut).value)??""}`),y(ht,`(${e(ut),r(()=>e(ut).source)??""})`)}),o(bt,Rt)}),l(Be),o(Ye,Be)},Ee=Ye=>{var Be=ot(),bt=Oe(Be);{var ut=Rt=>{var gt=ri(),wt=i(gt);l(gt),F(()=>y(wt,`Modifier: ${e(q),r(()=>e(q).constant>=0?"+":"")??""}${e(q),r(()=>e(q).constant)??""}`)),o(Rt,gt)};_(bt,Rt=>{e(q),r(()=>e(q).constant)&&Rt(ut)},!0)}o(Ye,Be)};_(K,Ye=>{U(de()),r(()=>de().length>0)?Ye(He):Ye(Ee,!1)})}o(h,T)};_(at,h=>{e(q),U(de()),r(()=>e(q).constant||de().length>0)&&h(vt)})}l(ke);var $=a(ke,2);{var Fe=h=>{var T=ci(),K=i(T);pt(K,1,()=>e(S),ft,(Ye,Be)=>{var bt=ni(),ut=i(bt,!0);l(bt),F(()=>y(ut,(e(Be),r(()=>e(Be).label)))),D("click",bt,()=>M(e(Be).notation,"damage")),o(Ye,bt)});var He=a(K,2);{var Ee=Ye=>{var Be=oi();F(()=>{Be.disabled=e(x)<=0,st(Be,"title",e(x)<=0?"No Channel Divinity uses remaining":"Use Channel Divinity to add +10 to this attack roll")}),D("click",Be,it),o(Ye,Be)};_(He,Ye=>{e(m)&&e(oe)==="attack"&&!e(me)&&Ye(Ee)})}l(T),o(h,T)};_($,h=>{e(S),e(m),e(oe),e(me),r(()=>e(S).length>0||e(m)&&e(oe)==="attack"&&!e(me))&&h(Fe)})}F(()=>{y(be,N()?`${N()} - Result`:"Result"),y(Je,(e(q),r(()=>e(q).resultTotal)))}),o(b,L)};_(z,b=>{e(q)&&b($e)})}l(Ge),l(Ue),l(j),F(()=>{d=_t(j,1,"modal-overlay svelte-1r90jgp",null,d,{hidden:!ve()}),ze=_t(Ge,1,"roll-result svelte-1r90jgp",null,ze,{"has-result":e(q)})}),D("click",J,Te),D("click",w,A),D("click",Ue,Pa(function(b){Yt.call(this,n,b)})),D("keydown",Ue,function(b){Yt.call(this,n,b)}),D("click",j,A),D("keydown",j,b=>b.key==="Escape"&&A()),o(s,j),Cs(n,"getLastRollTotal",je);var Ke=It(E);return p(),Ke}const _a="https://api.github.com/gists";async function pi(s,n,t){if(!n)throw new Error("GitHub token is required");const v=JSON.stringify(s,null,2),p=`${s.name||"character"}_dnd.json`,m={description:t||`D&D Character: ${s.name}`,public:!1,files:{[p]:{content:v}}},x=await fetch(_a,{method:"POST",headers:{Authorization:`token ${n}`,"Content-Type":"application/json"},body:JSON.stringify(m)});if(!x.ok)throw new Error(`Failed to create gist: ${x.statusText}`);return(await x.json()).id}async function fi(s,n,t){if(!n||!t)throw new Error("GitHub token and Gist ID are required");const v=JSON.stringify(s,null,2),m={files:{[`${s.name||"character"}_dnd.json`]:{content:v}}},x=await fetch(`${_a}/${t}`,{method:"PATCH",headers:{Authorization:`token ${n}`,"Content-Type":"application/json"},body:JSON.stringify(m)});if(!x.ok)throw new Error(`Failed to update gist: ${x.statusText}`)}async function bi(s,n){if(!s)throw new Error("Gist ID is required");const t={"Content-Type":"application/json"};n&&(t.Authorization=`token ${n}`);const v=await fetch(`${_a}/${s}`,{method:"GET",headers:t});if(!v.ok)throw new Error(`Failed to load gist: ${v.statusText}`);const p=await v.json(),m=Object.values(p.files);if(m.length===0)throw new Error("No files found in gist");const I=m[0].content;try{const k=JSON.parse(I);return k.attacks&&Array.isArray(k.attacks)&&(k.attacks=k.attacks.map(H=>({...H,id:H.id||crypto.randomUUID()}))),k.classFeatures?(k.classFeatures.features||(k.classFeatures.features={}),k.classFeatures.spellSlots||(k.classFeatures.spellSlots=[]),k.classFeatures.preparedSpells===void 0&&(k.classFeatures.preparedSpells="")):k.classFeatures={features:{},spellSlots:[],preparedSpells:""},k}catch{throw new Error("Invalid character data in gist")}}function za(s){typeof window<"u"&&localStorage.setItem("dnd_gist_config",JSON.stringify(s))}function gi(){if(typeof window<"u"){const s=localStorage.getItem("dnd_gist_config");if(s)return JSON.parse(s)}return{}}async function hi(s,n=30){if(!s)throw new Error("GitHub token is required to list gists");const t=await fetch(`${_a}?per_page=${n}`,{method:"GET",headers:{Authorization:`token ${s}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error(`Failed to list gists: ${t.statusText}`);return await t.json()}var mi=u('<div class="error-message svelte-1jb5ckg"> </div>'),_i=u('<div class="toggle-container svelte-1jb5ckg"><button type="button" class="toggle-btn svelte-1jb5ckg"> </button></div>'),yi=u('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID (leave empty to create new)</label> <input type="text" id="gistId" placeholder="Optional: existing Gist ID to update" class="svelte-1jb5ckg"/></div>'),ki=u('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),xi=u('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),Si=u('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Update (or leave unselected to create new)</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),$i=u('<div class="info-message svelte-1jb5ckg">No gists found. A new one will be created.</div>'),Ci=u('<!> <div class="form-group svelte-1jb5ckg"><label for="description" class="svelte-1jb5ckg"> </label> <input type="text" id="description" placeholder="D&amp;D Character Sheet" class="svelte-1jb5ckg"/></div>',1),wi=u('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID *</label> <input type="text" id="gistId" placeholder="Enter Gist ID (for public or your private gists)" required class="svelte-1jb5ckg"/></div>'),Li=u('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),Di=u('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),ji=u('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Load</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),Ai=u('<div class="info-message svelte-1jb5ckg">No gists found. Enter a Gist ID manually or create a new one in Save mode.</div>'),Fi=u('<div class="modal-overlay svelte-1jb5ckg" role="button" tabindex="-1"><div class="modal-content svelte-1jb5ckg" role="dialog" tabindex="0"><div class="modal-header svelte-1jb5ckg"><h2 class="svelte-1jb5ckg"> </h2> <button class="close-btn svelte-1jb5ckg">Ã—</button></div> <div class="modal-body svelte-1jb5ckg"><!> <div class="form-group svelte-1jb5ckg"><label for="token" class="svelte-1jb5ckg"> <a href="https://github.com/settings/tokens" target="_blank" rel="noopener" class="svelte-1jb5ckg">Get token</a></label> <input type="password" id="token" placeholder="ghp_xxxxxxxxxxxxx" class="svelte-1jb5ckg"/></div> <!> <!> <div class="modal-actions svelte-1jb5ckg"><button class="btn btn-primary svelte-1jb5ckg"><!></button> <button class="btn btn-secondary svelte-1jb5ckg">Cancel</button></div></div></div></div>');function Mi(s,n){Bt(n,!1);const t=()=>Ze(Z,"$character",v),[v,p]=Tt(),m=Vt();let x=Dt(n,"mode",8,"save"),I=B(""),k=B(""),H=B(""),ve=B(!1),V=B(""),N=B(!1),Ce=B(!1),de=B([]),De=B(null);const ue=gi();ue.token&&c(I,ue.token),ue.gistId&&c(k,ue.gistId),na(async()=>{e(I)&&!e(N)&&await ge()});async function ge(){if(e(I)){c(Ce,!0),c(V,"");try{c(de,await hi(e(I))),e(k)&&c(De,e(de).find(A=>A.id===e(k))||null)}catch(A){c(V,A.message||"Failed to load gists"),c(de,[])}finally{c(Ce,!1)}}}function le(A){c(De,A),c(k,A.id)}function q(){c(N,!e(N)),c(V,""),!e(N)&&e(I)&&ge()}async function je(){if(!e(I)){c(V,"GitHub token is required");return}const A=e(De)?.id||e(k);c(ve,!0),c(V,"");try{if(A)await fi(t(),e(I),A),c(k,A),At.add("Character updated in Gist successfully!","success");else{const E=await pi(t(),e(I),e(H));c(k,E),At.add(`Character saved to Gist! ID: ${E}`,"success")}za({token:e(I),gistId:e(k)}),m("close")}catch(E){c(V,E.message||"Failed to save to Gist")}finally{c(ve,!1)}}async function he(){const A=e(De)?.id||e(k);if(!A){c(V,"Please select a gist or enter a Gist ID");return}c(ve,!0),c(V,"");try{const E=await bi(A,e(I)||void 0);Z.set(E),c(k,A),za({token:e(I),gistId:e(k)}),At.add("Character loaded from Gist successfully!","success"),m("close")}catch(E){c(V,E.message||"Failed to load from Gist")}finally{c(ve,!1)}}function Q(){m("close")}Mt();var W=Fi(),pe=i(W),xe=i(pe),fe=i(xe),Ne=i(fe,!0);l(fe);var S=a(fe,2);l(xe);var re=a(xe,2),oe=i(re);{var me=A=>{var E=mi(),j=i(E,!0);l(E),F(()=>y(j,e(V))),o(A,E)};_(oe,A=>{e(V)&&A(me)})}var g=a(oe,2),G=i(g),_e=i(G);ba(),l(G);var Pe=a(G,2);Le(Pe),l(g);var f=a(g,2);{var C=A=>{var E=_i(),j=i(E),d=i(j,!0);l(j),l(E),F(()=>{j.disabled=e(ve),y(d,e(N)?"ðŸ“‹ Show My Gists":"âœï¸ Enter Gist ID Manually")}),D("click",j,q),o(A,E)};_(f,A=>{(x()==="load"||x()==="save"&&e(I))&&A(C)})}var X=a(f,2);{var M=A=>{var E=Ci(),j=Oe(E);{var d=Se=>{var Ae=yi(),Ie=a(i(Ae),2);Le(Ie),l(Ae),F(()=>Ie.disabled=e(ve)),Me(Ie,()=>e(k),Qe=>c(k,Qe)),o(Se,Ae)},Ue=Se=>{var Ae=ot(),Ie=Oe(Ae);{var Qe=Re=>{var ae=ki();o(Re,ae)},Ve=Re=>{var ae=ot(),we=Oe(ae);{var Ge=z=>{var $e=Si(),Ke=a(i($e),2);pt(Ke,5,()=>e(de),ft,(b,L)=>{var se=xi();let ee;var be=i(se),O=i(be),te=i(O,!0);l(O);var ce=a(O,2),Je=i(ce,!0);l(ce),l(be);var ke=a(be,2),Xe=i(ke),P=i(Xe);l(Xe);var at=a(Xe,2),vt=i(at);l(at),l(ke),l(se),F($=>{ee=_t(se,1,"gist-item svelte-1jb5ckg",null,ee,{selected:e(De)?.id===e(L).id}),se.disabled=e(ve),y(te,(e(L),r(()=>e(L).description||"Untitled"))),y(Je,(e(L),r(()=>e(L).public?"ðŸŒ Public":"ðŸ”’ Private"))),y(P,`ID: ${e(L),r(()=>e(L).id)??""}`),y(vt,`Updated: ${$??""}`)},[()=>(e(L),r(()=>new Date(e(L).updated_at).toLocaleDateString()))]),D("click",se,()=>le(e(L))),o(b,se)}),l(Ke),l($e),o(z,$e)},ze=z=>{var $e=ot(),Ke=Oe($e);{var b=L=>{var se=$i();o(L,se)};_(Ke,L=>{e(I)&&L(b)},!0)}o(z,$e)};_(we,z=>{e(de),r(()=>e(de).length>0)?z(Ge):z(ze,!1)},!0)}o(Re,ae)};_(Ie,Re=>{e(Ce)?Re(Qe):Re(Ve,!1)},!0)}o(Se,Ae)};_(j,Se=>{e(N)||!e(I)?Se(d):Se(Ue,!1)})}var ie=a(j,2),R=i(ie),J=i(R);l(R);var w=a(R,2);Le(w),l(ie),F(()=>{y(J,`Description ${e(k)?"(optional)":""}`),w.disabled=e(ve)}),Me(w,()=>e(H),Se=>c(H,Se)),o(A,E)},Y=A=>{var E=ot(),j=Oe(E);{var d=ie=>{var R=wi(),J=a(i(R),2);Le(J),l(R),F(()=>J.disabled=e(ve)),Me(J,()=>e(k),w=>c(k,w)),o(ie,R)},Ue=ie=>{var R=ot(),J=Oe(R);{var w=Ae=>{var Ie=Li();o(Ae,Ie)},Se=Ae=>{var Ie=ot(),Qe=Oe(Ie);{var Ve=ae=>{var we=ji(),Ge=a(i(we),2);pt(Ge,5,()=>e(de),ft,(ze,z)=>{var $e=Di();let Ke;var b=i($e),L=i(b),se=i(L,!0);l(L);var ee=a(L,2),be=i(ee,!0);l(ee),l(b);var O=a(b,2),te=i(O),ce=i(te);l(te);var Je=a(te,2),ke=i(Je);l(Je),l(O),l($e),F(Xe=>{Ke=_t($e,1,"gist-item svelte-1jb5ckg",null,Ke,{selected:e(De)?.id===e(z).id}),$e.disabled=e(ve),y(se,(e(z),r(()=>e(z).description||"Untitled"))),y(be,(e(z),r(()=>e(z).public?"ðŸŒ Public":"ðŸ”’ Private"))),y(ce,`ID: ${e(z),r(()=>e(z).id)??""}`),y(ke,`Updated: ${Xe??""}`)},[()=>(e(z),r(()=>new Date(e(z).updated_at).toLocaleDateString()))]),D("click",$e,()=>le(e(z))),o(ze,$e)}),l(Ge),l(we),o(ae,we)},Re=ae=>{var we=ot(),Ge=Oe(we);{var ze=z=>{var $e=Ai();o(z,$e)};_(Ge,z=>{e(I)&&z(ze)},!0)}o(ae,we)};_(Qe,ae=>{e(de),r(()=>e(de).length>0)?ae(Ve):ae(Re,!1)},!0)}o(Ae,Ie)};_(J,Ae=>{e(Ce)?Ae(w):Ae(Se,!1)},!0)}o(ie,R)};_(j,ie=>{e(N)||!e(I)?ie(d):ie(Ue,!1)},!0)}o(A,E)};_(X,A=>{x()==="save"?A(M):A(Y,!1)})}var qe=a(X,2),ne=i(qe),ye=i(ne);{var We=A=>{var E=$t();F(()=>y(E,x()==="save"?"Saving...":"Loading...")),o(A,E)},Te=A=>{var E=$t();F(()=>y(E,x()==="save"?"Save":"Load")),o(A,E)};_(ye,A=>{e(ve)?A(We):A(Te,!1)})}l(ne);var it=a(ne,2);l(qe),l(re),l(pe),l(W),F(()=>{y(Ne,x()==="save"?"Save to GitHub Gist":"Load from GitHub Gist"),y(_e,`GitHub Token ${x()==="load"?"(optional for public gists)":"(required)"} `),Pe.disabled=e(ve),ne.disabled=e(ve),it.disabled=e(ve)}),D("click",S,Q),Me(Pe,()=>e(I),A=>c(I,A)),D("blur",Pe,()=>{e(I)&&!e(N)&&ge()}),D("click",ne,function(...A){(x()==="save"?je:he)?.apply(this,A)}),D("click",it,Q),D("click",pe,Pa(function(A){Yt.call(this,n,A)})),D("keydown",pe,function(A){Yt.call(this,n,A)}),D("click",W,Q),D("keydown",W,A=>A.key==="Escape"&&Q()),o(s,W),It(),p()}var Bi=u('<div class="loading svelte-1ngjemu">Loading D&D data...</div>'),Ii=u("<option> </option>"),Ri=u('<select class="level-filter svelte-1ngjemu"><option>All Levels</option><option>Cantrip</option><!></select>'),Ei=u('<div class="no-results svelte-1ngjemu"> </div>'),Pi=u('<div class="item-meta svelte-1ngjemu"> </div>'),Ti=u('<div class="item-meta svelte-1ngjemu"> </div>'),Hi=u('<button><div class="item-name svelte-1ngjemu"> </div> <!></button>'),Ni=u('<p class="higher-levels"><strong>At Higher Levels:</strong> </p>'),Ui=u('<p class="cantrip-upgrade"><strong>Cantrip Upgrade:</strong> </p>'),Gi=u('<h3 class="svelte-1ngjemu"> </h3> <p class="spell-meta svelte-1ngjemu"><!> <!></p> <p class="spell-classes"><strong>Classes:</strong> </p> <div class="spell-stats svelte-1ngjemu"><div><strong>Casting Time:</strong> </div> <div><strong>Range:</strong> </div> <div><strong>Components:</strong> <!></div> <div><strong>Duration:</strong> <!> </div></div> <p class="description svelte-1ngjemu"> </p> <!> <!>',1),Oi=u('<p class="prerequisite svelte-1ngjemu"><strong>Prerequisite:</strong> </p>'),qi=u('<h3 class="svelte-1ngjemu"> </h3> <!> <p class="description svelte-1ngjemu"> </p> <a target="_blank" rel="noopener" class="source-link svelte-1ngjemu">View Full Details â†’</a>',1),Wi=u('<div class="item-details svelte-1ngjemu"><!></div>'),zi=u('<div class="controls svelte-1ngjemu"><div class="tabs svelte-1ngjemu"><button> </button> <button> </button></div> <div class="search-controls svelte-1ngjemu"><input type="text" placeholder="Search by name or description..." class="search-input svelte-1ngjemu"/> <!></div></div> <div class="content-container svelte-1ngjemu"><div class="items-list svelte-1ngjemu"><!></div> <!></div>',1),Ki=u('<div class="modal-backdrop svelte-1ngjemu" role="presentation"><div class="modal svelte-1ngjemu" role="dialog" aria-modal="true" tabindex="-1"><div class="modal-header svelte-1ngjemu"><h2 class="svelte-1ngjemu">Browse D&D Spells & Feats</h2> <button class="close-btn svelte-1ngjemu" aria-label="Close">&times;</button></div> <div class="modal-body svelte-1ngjemu"><!></div> <div class="modal-footer svelte-1ngjemu"><button class="btn-secondary svelte-1ngjemu">Cancel</button> <button class="btn-primary svelte-1ngjemu">Add to Character Sheet</button></div></div></div>');function Ji(s,n){Bt(n,!1);const t=B(),v=B(),p=B();let m=Dt(n,"onClose",8),x=B("spell"),I=B(!0),k=B(""),H=B(null),ve=B([]),V=B([]),N=B(null);na(async()=>{c(I,!0);try{c(ve,await ts()),c(V,await Qs())}catch(S){console.error("Failed to load data:",S)}finally{c(I,!1)}});function Ce(S){c(N,S)}function de(S){const re=S.match(/(\d+d\d+(?:\s*\+\s*\d+)?)/i);return re?re[1]:""}function De(S){const re=S.split(/\.( |$)/)[0].trim(),oe=Array.from(S.matchAll(/\*\*(.*?)\*\*/g)).map(g=>g[1].replace(/\.$/,""));let me=re;return oe.length&&(me+=" | Effects: "+oe.join(", ")),me}function ue(){if(e(N)){if(e(x)==="spell"){const S=e(N);Z.update(re=>{const me=[];S.range&&me.push(`Range: ${S.range}`),S.castingTime&&me.push(`Cast: ${S.castingTime}`),S.duration&&me.push(`Duration: ${S.duration}`),S.actionType==="Save"&&me.push("Saving throw spell"),S.components&&S.components.length>0&&me.push(`Components: ${S.components.join(", ")}`),S.material&&me.push(`Material: ${S.material}`);const g=me.join(" | "),G=De(S.description),_e={id:crypto.randomUUID(),name:`${S.name}${S.concentration?" (C)":""}${S.ritual?" (R)":""}`,bonus:S.actionType==="Attack"?5:0,damage:de(S.description),damageType:`${S.school} (Lvl ${S.level})`,spellRef:S.name,infoNotes:g,generalNotes:G,castAtLevel:S.level};return re.attacks=[...re.attacks,_e],re})}else if(e(x)==="feat"){const S=e(N);Z.update(re=>{const oe=`${S.name}${S.prerequisite?` (Req: ${S.prerequisite})`:""}
${S.description}
`;return re.features=re.features?`${re.features}
${oe}`:oe,re})}c(N,null),m()()}}tt(()=>(e(H),e(ve),e(k)),()=>{c(t,e(H)!==null?Xs(Oa(e(ve),e(k)),e(H)):Oa(e(ve),e(k)))}),tt(()=>(e(V),e(k)),()=>{c(v,Ys(e(V),e(k)))}),tt(()=>(e(x),e(t),e(v)),()=>{c(p,e(x)==="spell"?e(t):e(v))}),Gt(),Mt();var ge=Ki(),le=i(ge),q=i(le),je=a(i(q),2);l(q);var he=a(q,2),Q=i(he);{var W=S=>{var re=Bi();o(S,re)},pe=S=>{var re=zi(),oe=Oe(re),me=i(oe),g=i(me);let G;var _e=i(g);l(g);var Pe=a(g,2);let f;var C=i(Pe);l(Pe),l(me);var X=a(me,2),M=i(X);Le(M);var Y=a(M,2);{var qe=j=>{var d=Ri();F(()=>{e(H),St(()=>{})});var Ue=i(d);Ue.value=(Ue.__value=null)??"";var ie=a(Ue);ie.value=ie.__value=0;var R=a(ie);pt(R,0,()=>[1,2,3,4,5,6,7,8,9],ft,(J,w)=>{var Se=Ii(),Ae=i(Se);l(Se);var Ie={};F(()=>{y(Ae,`Level ${w??""}`),Ie!==(Ie=w)&&(Se.value=(Se.__value=w)??"")}),o(J,Se)}),l(d),Za(d,()=>e(H),J=>c(H,J)),o(j,d)};_(Y,j=>{e(x)==="spell"&&j(qe)})}l(X),l(oe);var ne=a(oe,2),ye=i(ne),We=i(ye);{var Te=j=>{var d=Ei(),Ue=i(d);l(d),F(()=>y(Ue,`No ${e(x)??""}s found`)),o(j,d)},it=j=>{var d=ot(),Ue=Oe(d);pt(Ue,1,()=>e(p),ft,(ie,R)=>{var J=Hi();let w;var Se=i(J),Ae=i(Se,!0);l(Se);var Ie=a(Se,2);{var Qe=Re=>{const ae=rt(()=>e(R));var we=Pi(),Ge=i(we);l(we),F(()=>y(Ge,`Level ${U(e(ae)),r(()=>e(ae).level)??""} â€¢ ${U(e(ae)),r(()=>e(ae).school)??""}`)),o(Re,we)},Ve=Re=>{const ae=rt(()=>e(R));var we=ot(),Ge=Oe(we);{var ze=z=>{var $e=Ti(),Ke=i($e,!0);l($e),F(()=>y(Ke,(U(e(ae)),r(()=>e(ae).prerequisite)))),o(z,$e)};_(Ge,z=>{U(e(ae)),r(()=>e(ae).prerequisite)&&z(ze)})}o(Re,we)};_(Ie,Re=>{e(x)==="spell"?Re(Qe):Re(Ve,!1)})}l(J),F(()=>{w=_t(J,1,"item-card svelte-1ngjemu",null,w,{selected:e(N)?.name===e(R).name}),y(Ae,(e(R),r(()=>e(R).name)))}),D("click",J,()=>Ce(e(R))),o(ie,J)}),o(j,d)};_(We,j=>{e(p),r(()=>e(p).length===0)?j(Te):j(it,!1)})}l(ye);var A=a(ye,2);{var E=j=>{var d=Wi(),Ue=i(d);{var ie=J=>{const w=rt(()=>e(N));var Se=Gi(),Ae=Oe(Se),Ie=i(Ae,!0);l(Ae);var Qe=a(Ae,2),Ve=i(Qe);{var Re=T=>{var K=$t();F(()=>y(K,`${U(e(w)),r(()=>e(w).school)??""} cantrip`)),o(T,K)},ae=T=>{var K=$t();F(()=>y(K,`Level ${U(e(w)),r(()=>e(w).level)??""} ${U(e(w)),r(()=>e(w).school)??""}`)),o(T,K)};_(Ve,T=>{U(e(w)),r(()=>e(w).level===0)?T(Re):T(ae,!1)})}var we=a(Ve,2);{var Ge=T=>{var K=$t("(ritual)");o(T,K)};_(we,T=>{U(e(w)),r(()=>e(w).ritual)&&T(Ge)})}l(Qe);var ze=a(Qe,2),z=a(i(ze));l(ze);var $e=a(ze,2),Ke=i($e),b=a(i(Ke));l(Ke);var L=a(Ke,2),se=a(i(L));l(L);var ee=a(L,2),be=a(i(ee)),O=a(be);{var te=T=>{var K=$t();F(()=>y(K,`(${U(e(w)),r(()=>e(w).material)??""})`)),o(T,K)};_(O,T=>{U(e(w)),r(()=>e(w).material)&&T(te)})}l(ee);var ce=a(ee,2),Je=a(i(ce),2);{var ke=T=>{var K=$t("Concentration,");o(T,K)};_(Je,T=>{U(e(w)),r(()=>e(w).concentration)&&T(ke)})}var Xe=a(Je,1,!0);l(ce),l($e);var P=a($e,2),at=i(P,!0);l(P);var vt=a(P,2);{var $=T=>{var K=Ni(),He=a(i(K));l(K),F(()=>y(He,` ${U(e(w)),r(()=>e(w).higherLevelSlot)??""}`)),o(T,K)};_(vt,T=>{U(e(w)),r(()=>e(w).higherLevelSlot)&&T($)})}var Fe=a(vt,2);{var h=T=>{var K=Ui(),He=a(i(K));l(K),F(()=>y(He,` ${U(e(w)),r(()=>e(w).cantripUpgrade)??""}`)),o(T,K)};_(Fe,T=>{U(e(w)),r(()=>e(w).cantripUpgrade)&&T(h)})}F((T,K)=>{y(Ie,(U(e(w)),r(()=>e(w).name))),y(z,` ${T??""}`),y(b,` ${U(e(w)),r(()=>e(w).castingTime||e(w).actionType)??""}`),y(se,` ${U(e(w)),r(()=>e(w).range)??""}`),y(be,` ${K??""}`),y(Xe,(U(e(w)),r(()=>e(w).duration))),y(at,(U(e(w)),r(()=>e(w).description)))},[()=>(U(e(w)),r(()=>e(w).classes.join(", "))),()=>(U(e(w)),r(()=>e(w).components.join(", ").toUpperCase()))]),o(J,Se)},R=J=>{const w=rt(()=>e(N));var Se=qi(),Ae=Oe(Se),Ie=i(Ae,!0);l(Ae);var Qe=a(Ae,2);{var Ve=Ge=>{var ze=Oi(),z=a(i(ze));l(ze),F(()=>y(z,` ${U(e(w)),r(()=>e(w).prerequisite)??""}`)),o(Ge,ze)};_(Qe,Ge=>{U(e(w)),r(()=>e(w).prerequisite)&&Ge(Ve)})}var Re=a(Qe,2),ae=i(Re,!0);l(Re);var we=a(Re,2);F(()=>{y(Ie,(U(e(w)),r(()=>e(w).name))),y(ae,(U(e(w)),r(()=>e(w).description))),st(we,"href",(U(e(w)),r(()=>e(w).source)))}),o(J,Se)};_(Ue,J=>{e(x)==="spell"?J(ie):J(R,!1)})}l(d),o(j,d)};_(A,j=>{e(N)&&j(E)})}l(ne),F(()=>{G=_t(g,1,"tab svelte-1ngjemu",null,G,{active:e(x)==="spell"}),y(_e,`ðŸ“œ Spells (${e(ve),r(()=>e(ve).length)??""})`),f=_t(Pe,1,"tab svelte-1ngjemu",null,f,{active:e(x)==="feat"}),y(C,`â­ Feats (${e(V),r(()=>e(V).length)??""})`)}),D("click",g,()=>{c(x,"spell"),c(N,null),c(k,"")}),D("click",Pe,()=>{c(x,"feat"),c(N,null),c(k,"")}),Me(M,()=>e(k),j=>c(k,j)),o(S,re)};_(Q,S=>{e(I)?S(W):S(pe,!1)})}l(he);var xe=a(he,2),fe=i(xe),Ne=a(fe,2);l(xe),l(le),l(ge),F(()=>Ne.disabled=!e(N)),D("click",je,function(...S){m()?.apply(this,S)}),D("click",fe,function(...S){m()?.apply(this,S)}),D("click",Ne,ue),D("click",le,Pa(function(S){Yt.call(this,n,S)})),D("keydown",le,function(S){Yt.call(this,n,S)}),D("click",ge,function(...S){m()?.apply(this,S)}),D("keydown",ge,S=>S.key==="Escape"&&m()()),o(s,ge),It()}var Vi=u('<link rel="icon" type="image/png" href="favicon4.png"/> <meta name="viewport" content="width=device-width, initial-scale=1"/>',1),Qi=u('<span class="character-name svelte-1uha8ag"> </span>'),Xi=u("<span> </span>"),Yi=u('<div class="spell-slots-header svelte-1uha8ag"></div>'),Zi=u("<span> </span><br/>",1),er=u("<span> </span>"),tr=u('<span class="effect-tooltip"><strong> </strong><br/> <br/> <!> <!></span>'),ar=u('<button class="effect-remove-btn svelte-1uha8ag">Ã—</button>'),sr=u('<span class="effect-badge svelte-1uha8ag" tabindex="0"> <!> <!></span>'),lr=u(`<div class="active-effects-header svelte-1uha8ag"></div> <style>.effect-badge {
            position: relative;
          }
          .effect-tooltip {
            position: absolute;
            top: 120%;
            left: 50%;
            transform: translateX(-50%);
            background: #fff;
            color: #222;
            border: 1px solid #a5b4fc;
            border-radius: 6px;
            padding: 8px 12px;
            font-size: 0.95em;
            box-shadow: 0 2px 8px rgba(0,0,0,0.12);
            z-index: 10;
            min-width: 180px;
            max-width: 260px;
            white-space: normal;
            pointer-events: none;
            opacity: 1;
            transition: opacity 0.15s;
          }</style>`,1),ir=u('<div class="rest-menu svelte-1uha8ag"><button class="rest-option svelte-1uha8ag">â˜• Short Rest</button> <button class="rest-option svelte-1uha8ag">ðŸ›ï¸ Long Rest</button></div>'),rr=u('<div class="container svelte-1uha8ag"><header class="svelte-1uha8ag"><div class="header-top svelte-1uha8ag"><div class="header-title svelte-1uha8ag"><div class="title-row svelte-1uha8ag"><h1 class="svelte-1uha8ag">D&D Character Sheet</h1> <!></div> <!> <!></div> <div class="header-right svelte-1uha8ag"><div class="header-controls svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">ðŸŽ²</span><span class="btn-text svelte-1uha8ag">Roll Dice</span></button> <div class="rest-button-container svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">ðŸ˜´</span><span class="btn-text svelte-1uha8ag">Rest</span></button> <!></div> <div class="mode-toggle"><button><span class="btn-icon svelte-1uha8ag"> </span><span class="btn-text svelte-1uha8ag"> </span></button></div></div> <div class="header-search svelte-1uha8ag"><input type="text" placeholder="ðŸ” Search..." class="search-input use-enabled svelte-1uha8ag"/></div></div></div> <div class="header-actions svelte-1uha8ag"><button class="btn btn-mode svelte-1uha8ag">ðŸ“š Browse Spells & Feats</button> <button class="btn btn-secondary">Save to Gist</button> <button class="btn btn-secondary">Load from Gist</button> <button class="btn btn-secondary">Export JSON</button> <button class="btn btn-secondary">Import JSON</button> <input type="file" accept=".json" style="display: none;"/></div></header> <main class="svelte-1uha8ag"><!> <!> <!> <!> <!> <!> <!></main></div> <!> <!> <!> <!>',1);function br(s,n){Bt(n,!1);const t=()=>Ze(Z,"$character",m),v=()=>Ze(ia,"$isEditMode",m),p=()=>Ze(zt,"$searchFilter",m),[m,x]=Tt();function I(){const $=[],Fe=t().classFeatures.spellSlotsByLevel||{};for(let h=1;h<=9;h++){const T=Fe[h];if(T&&T.length>0){const K=T.length,He=T.filter(Ee=>Ee).length;$.push({level:h,available:K-He,total:K})}}return $}let k=B(!1),H=B(!1),ve=B(!1),V=B("save"),N=B(void 0),Ce=B(""),de=B(""),De=B(""),ue=B(!1),ge=B([]),le=B(),q=!1,je=B(!1),he=B(null);function Q($){c(he,$)}function W(){c(he,null)}function pe(){const $=[];Z.update(h=>{const T=h.hitDice.current;h.hitDice.current=Math.min(h.hitDice.max,h.hitDice.current+Math.max(1,Math.floor(h.hitDice.max/2)));const K=h.hitDice.current-T;if(K>0&&$.push(`${K} hit ${K===1?"die":"dice"}`),h.class){const He=Zt(h.class,h.level,h.subclass);h.classFeatures.features||(h.classFeatures.features={}),He.forEach(Ee=>{if(Ee.resetOn==="short"){const Ye=Ee.name.replace(/\s+/g,"");if(Ee.type==="uses"){const Be=typeof Ee.maxUses=="function"?Ee.maxUses(h.level):Ee.maxUses;h.classFeatures.features[Ye]=Array(Be).fill(!1),$.push(Ee.name)}else if(Ee.type==="pool"){const Be=typeof Ee.maxPool=="function"?Ee.maxPool(h.level):Ee.maxPool;Be!==void 0&&(h.classFeatures.features[Ye]=Be,$.push(Ee.name))}}})}return h}),c(je,!1);const Fe=$.length>0?`Short rest taken! Restored: ${$.join(", ")}`:"Short rest taken!";At.add(Fe,"success")}function xe(){const $=[];Z.update(h=>{const T=h.maxHP-h.currentHP;T>0&&$.push(`${T} HP`),h.currentHP=h.maxHP,h.tempHP=0;const K=h.hitDice.max-h.hitDice.current;K>0&&$.push(`${K} hit ${K===1?"die":"dice"}`),h.hitDice.current=h.hitDice.max;let He=0;if(h.classFeatures.spellSlotsByLevel&&Object.keys(h.classFeatures.spellSlotsByLevel).forEach(Ee=>{const Ye=h.classFeatures.spellSlotsByLevel[parseInt(Ee)];if(Ye){const Be=Ye.filter(bt=>bt).length;He+=Be,h.classFeatures.spellSlotsByLevel[parseInt(Ee)]=Array(Ye.length).fill(!1)}}),He>0&&$.push(`${He} spell ${He===1?"slot":"slots"}`),h.class){const Ee=Zt(h.class,h.level,h.subclass);h.classFeatures.features||(h.classFeatures.features={});let Ye=!1;Ee.forEach(Be=>{const bt=Be.name.replace(/\s+/g,"");if(!(Be.type==="info"||Be.type==="channelDivinity")){if(Be.type==="uses"){const ut=typeof Be.maxUses=="function"?Be.maxUses(h.level):Be.maxUses;h.classFeatures.features[bt]=Array(ut).fill(!1),Ye=!0}else if(Be.type==="pool"){const ut=typeof Be.maxPool=="function"?Be.maxPool(h.level):Be.maxPool;ut!==void 0&&(h.classFeatures.features[bt]=ut,Ye=!0)}}}),Ye&&$.push("all class features")}return h}),c(je,!1);const Fe=$.length>0?`Long rest taken! Restored: ${$.join(", ")}`:"Long rest taken! Fully rested.";At.add(Fe,"success")}function fe($){c(Ce,""),c(de,""),c(De,""),c(ue,!1),c(ge,[]),q=!1,typeof $=="string"?c(Ce,$):(c(Ce,$.notation),c(de,$.damageNotation||""),c(De,$.attackName||""),c(ue,!!$.applyHalfDamage),c(ge,$.bonusBreakdown||[])),c(k,!0)}function Ne($){const{notation:Fe}=$.detail;c(Ce,""),q=!0,setTimeout(()=>{c(Ce,Fe),c(de,""),c(De,"Hit Die")},0),c(k,!0)}function S(){if(c(k,!1),q&&e(le)){const $=e(le).getLastRollTotal();if($!==null){const Fe=Math.max(1,$);Z.update(h=>(h.hitDice.current=Math.max(0,h.hitDice.current-1),h.currentHP=Math.min(h.maxHP,h.currentHP+Fe),h))}q=!1}}function re(){console.log("toggleMode called, current isEditMode:",v()),ia.update($=>(console.log("Updating isEditMode from",$,"to",!$),!$))}function oe($){$.target.closest(".rest-button-container")||c(je,!1)}na(()=>{console.log("onMount - initial isEditMode:",v()),console.log("onMount - body classes:",document.body.className);const $=ia.subscribe(Fe=>{console.log("isEditMode subscription triggered, value:",Fe),console.log("Body classes before:",document.body.className),Fe?(document.body.classList.remove("use-mode"),console.log("Removed use-mode class (Edit Mode)")):(document.body.classList.add("use-mode"),console.log("Added use-mode class (Use Mode)")),console.log("Body classes after:",document.body.className)});return document.addEventListener("click",oe),()=>{$(),document.removeEventListener("click",oe)}});function me(){hs(t())}function g(){e(N)?.click()}async function G($){const h=$.target.files?.[0];if(h)try{const T=await ms(h);Z.set(T),alert("Character imported successfully!")}catch{alert("Failed to import character file")}}Mt();var _e=rr();bs("1uha8ag",$=>{var Fe=Vi();ba(2),Va(()=>{fs.title="D&D Character Sheet"}),o($,Fe)});var Pe=Oe(_e),f=i(Pe),C=i(f),X=i(C),M=i(X),Y=a(i(M),2);{var qe=$=>{var Fe=Qi(),h=i(Fe);l(Fe),F(()=>y(h,`${t().name??""} (${t().level??""})`)),o($,Fe)};_(Y,$=>{t().name&&$(qe)})}l(M);var ne=a(M,2);{var ye=$=>{var Fe=Yi();pt(Fe,5,I,ft,(h,T)=>{var K=Xi();let He;var Ee=i(K);l(K),F(()=>{He=_t(K,1,"slot-badge svelte-1uha8ag",null,He,{depleted:e(T).available===0}),y(Ee,`Lv${e(T).level??""}: ${e(T).available??""}/${e(T).total??""}`)}),o(h,K)}),l(Fe),o($,Fe)};_(ne,$=>{I().length>0&&$(ye)})}var We=a(ne,2);{var Te=$=>{var Fe=lr(),h=Oe(Fe);pt(h,5,()=>t().activeStates,ft,(T,K,He)=>{var Ee=sr(),Ye=i(Ee),Be=a(Ye);{var bt=gt=>{var wt=tr(),lt=i(wt),ht=i(lt,!0);l(lt);var kt=a(lt,2),Ot=a(kt,3);{var Kt=dt=>{var Lt=Zi(),Et=Oe(Lt),Qt=i(Et);l(Et),ba(),F(()=>y(Qt,`Attack Bonus: ${e(K).attackBonus>0?"+":""}${e(K).attackBonus??""}`)),o(dt,Lt)};_(Ot,dt=>{e(K).attackBonus&&dt(Kt)})}var ea=a(Ot,2);{var jt=dt=>{var Lt=er(),Et=i(Lt);l(Lt),F(()=>y(Et,`Damage Bonus: ${e(K).damageBonus>0?"+":""}${e(K).damageBonus??""}`)),o(dt,Lt)};_(ea,dt=>{e(K).damageBonus&&dt(jt)})}l(wt),F(()=>{y(ht,e(K).name),y(kt,` ${e(K).description??""}`)}),o(gt,wt)};_(Be,gt=>{e(he)===He&&gt(bt)})}var ut=a(Be,2);{var Rt=gt=>{var wt=ar();F(()=>st(wt,"title",`End ${e(K).name??""}`)),D("click",wt,()=>{Z.update(lt=>(lt.activeStates&&(lt.activeStates=lt.activeStates.filter((ht,kt)=>kt!==He)),lt))}),o(gt,wt)};_(ut,gt=>{v()||gt(Rt)})}l(Ee),F(()=>{st(Ee,"aria-label",e(K).name),y(Ye,`âœ¨ ${e(K).name??""} `)}),D("mouseenter",Ee,()=>Q(He)),D("mouseleave",Ee,W),D("focus",Ee,()=>Q(He)),D("blur",Ee,W),D("touchstart",Ee,Ha(()=>Q(He))),D("touchend",Ee,Ha(W)),o(T,Ee)}),l(h),ba(2),o($,Fe)};_(We,$=>{t().activeStates&&t().activeStates.length>0&&$(Te)})}l(X);var it=a(X,2),A=i(it),E=i(A),j=a(E,2),d=i(j),Ue=a(d,2);{var ie=$=>{var Fe=ir(),h=i(Fe),T=a(h,2);l(Fe),D("click",h,pe),D("click",T,xe),o($,Fe)};_(Ue,$=>{e(je)&&$(ie)})}l(j);var R=a(j,2),J=i(R);let w;var Se=i(J),Ae=i(Se,!0);l(Se);var Ie=a(Se),Qe=i(Ie,!0);l(Ie),l(J),l(R),l(A);var Ve=a(A,2),Re=i(Ve);Le(Re),l(Ve),l(it),l(C);var ae=a(C,2),we=i(ae),Ge=a(we,2),ze=a(Ge,2),z=a(ze,2),$e=a(z,2),Ke=a($e,2);Aa(Ke,$=>c(N,$),()=>e(N)),l(ae),l(f);var b=a(f,2),L=i(b);Is(L,{});var se=a(L,2);Ws(se,{$$events:{rollHitDice:Ne}});var ee=a(se,2);Ts(ee,{$$events:{roll:$=>fe($.detail)}});var be=a(ee,2);Vs(be,{$$events:{roll:$=>fe($.detail)}});var O=a(be,2);Ml(O,{$$events:{roll:$=>fe($.detail)}});var te=a(O,2);Vl(te,{});var ce=a(te,2);Yl(ce,{}),l(b),l(Pe);var Je=a(Pe,2);Aa(ui(Je,{get notation(){return e(Ce)},get damageNotation(){return e(de)},get attackName(){return e(De)},get applyHalfDamage(){return e(ue)},get bonusBreakdown(){return e(ge)},get visible(){return e(k)},$$events:{close:S},$$legacy:!0}),$=>c(le,$),()=>e(le));var ke=a(Je,2);{var Xe=$=>{Mi($,{get mode(){return e(V)},$$events:{close:()=>c(H,!1)}})};_(ke,$=>{e(H)&&$(Xe)})}var P=a(ke,2);{var at=$=>{Ji($,{onClose:()=>c(ve,!1)})};_(P,$=>{e(ve)&&$(at)})}var vt=a(P,2);gs(vt,{}),F(()=>{w=_t(J,1,"btn btn-mode svelte-1uha8ag",null,w,{"use-mode":!v()}),y(Ae,v()?"ðŸ“":"ðŸŽ²"),y(Qe,v()?"Edit Mode":"Use Mode")}),D("click",E,()=>c(k,!0)),D("click",d,()=>c(je,!e(je))),D("click",J,re),Me(Re,p,$=>_s(zt,$)),D("click",we,()=>c(ve,!0)),D("click",Ge,()=>{c(V,"save"),c(H,!0)}),D("click",ze,()=>{c(V,"load"),c(H,!0)}),D("click",z,me),D("click",$e,g),D("change",Ke,G),o(s,_e),It(),x()}export{br as component};
