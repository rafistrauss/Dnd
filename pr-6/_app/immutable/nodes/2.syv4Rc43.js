import{d as ys,g as zs,f as u,e as j,a as o,s as k,c as bt,t as It}from"../chunks/BESELRjb.js";import{i as Jt}from"../chunks/JMgyEzd3.js";import{c as Ca,o as Sa,a as Ws,b as Ks}from"../chunks/CtPH092J.js";import{F as A,T as ya,Y as ds,j as Vs,aZ as Js,U as xs,ag as Ys,aD as Qs,aK as Xs,aE as Zs,a1 as el,av as Ga,a7 as gs,i as Ts,a_ as tl,a$ as Fs,b0 as Qa,K as wa,e as Ps,b1 as Is,b2 as al,b3 as sl,b4 as ll,q as us,b5 as rl,b6 as il,ab as nl,d as i,r as bs,g as ol,C as Yt,G as Qt,H as l,I as s,J as a,b7 as Ve,b8 as ma,s as n,a4 as C,f as e,m as kt,E as $e,b9 as Wt,ao as aa,A as N,ba as _a,bb as ja,bc as cl}from"../chunks/DyJ43TGI.js";import{t as vl,c as sa,a as de,e as St,i as Lt,u as Es,s as xa,b as Et,d as Xa,f as ka,g as Ja,j as dl,k as Nt,l as ul,m as $s,n as ls,h as fl,T as pl,o as ml,p as gl,r as ws,q as ks}from"../chunks/Fq0DehG0.js";import{i as g,s as va,a as ot,b as Ut,d as Pa,e as bl}from"../chunks/CCL4udNy.js";import{p as Dt,b as Ua}from"../chunks/iXw84bXb.js";import{b as Ia,r as hl}from"../chunks/DVs25mQ5.js";function _l(r,c,t=!1,v=!1,f=!1){var p=r,m="";A(()=>{var $=Vs;if(m===(m=c()??"")){ya&&ds();return}if($.nodes_start!==null&&(Js($.nodes_start,$.nodes_end),$.nodes_start=$.nodes_end=null),m!==""){if(ya){xs.data;for(var y=ds(),b=y;y!==null&&(y.nodeType!==Ys||y.data!=="");)b=y,y=Qs(y);if(y===null)throw Xs(),Zs;ys(xs,b),p=el(y);return}var K=m+"";t?K=`<svg>${K}</svg>`:v&&(K=`<math>${K}</math>`);var P=zs(K);if((t||v)&&(P=Ga(P)),ys(Ga(P),P.lastChild),t||v)for(;Ga(P);)p.before(Ga(P));else p.before(P)}})}function yl(r,c,t,v,f){ya&&ds();var p=c.$$slots?.[t],m=!1;p===!0&&(p=c[t],m=!0),p===void 0?f!==null&&f(r):p(r,m?()=>v:v)}function xl(r,c,t,v){var f=r.__style;if(ya||f!==c){var p=vl(c);(!ya||p!==r.getAttribute("style"))&&(p==null?r.removeAttribute("style"):r.style.cssText=p),r.__style=c}return v}function Ya(r,c,t=!1){if(r.multiple){if(c==null)return;if(!Ts(c))return tl();for(var v of r.options)v.selected=c.includes(Ea(v));return}for(v of r.options){var f=Ea(v);if(Fs(f,c)){v.selected=!0;return}}(!t||c!==void 0)&&(r.selectedIndex=-1)}function fs(r){var c=new MutationObserver(()=>{Ya(r,r.__value)});c.observe(r,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),gs(()=>{c.disconnect()})}function Na(r,c,t=c){var v=new WeakSet,f=!0;Qa(r,"change",p=>{var m=p?"[selected]":":checked",$;if(r.multiple)$=[].map.call(r.querySelectorAll(m),Ea);else{var y=r.querySelector(m)??r.querySelector("option:not([disabled])");$=y&&Ea(y)}t($),wa!==null&&v.add(wa)}),Ps(()=>{var p=c();if(r===document.activeElement){var m=Is??wa;if(v.has(m))return}if(Ya(r,p,f),f&&p===void 0){var $=r.querySelector(":checked");$!==null&&(p=Ea($),t(p))}r.__value=p,f=!1}),fs(r)}function Ea(r){return"__value"in r?r.__value:r.value}const $l=Symbol("is custom element"),wl=Symbol("is html");function we(r){if(ya){var c=!1,t=()=>{if(!c){if(c=!0,r.hasAttribute("value")){var v=r.value;tt(r,"value",null),r.value=v}if(r.hasAttribute("checked")){var f=r.checked;tt(r,"checked",null),r.checked=f}}};r.__on_r=t,us(t),rl()}}function Ha(r,c){var t=hs(r);t.value===(t.value=c??void 0)||r.value===c&&(c!==0||r.nodeName!=="PROGRESS")||(r.value=c??"")}function Hs(r,c){var t=hs(r);t.checked!==(t.checked=c??void 0)&&(r.checked=c)}function tt(r,c,t,v){var f=hs(r);ya&&(f[c]=r.getAttribute(c),c==="src"||c==="srcset"||c==="href"&&r.nodeName==="LINK")||f[c]!==(f[c]=t)&&(c==="loading"&&(r[al]=t),t==null?r.removeAttribute(c):typeof t!="string"&&kl(r).includes(c)?r[c]=t:r.setAttribute(c,t))}function hs(r){return r.__attributes??={[$l]:r.nodeName.includes("-"),[wl]:r.namespaceURI===sl}}var Ss=new Map;function kl(r){var c=r.getAttribute("is")||r.nodeName,t=Ss.get(c);if(t)return t;Ss.set(c,t=[]);for(var v,f=r,p=Element.prototype;p!==f;){v=il(f);for(var m in v)v[m].set&&t.push(m);f=ll(f)}return t}function Ee(r,c,t=c){var v=new WeakSet;Qa(r,"input",async f=>{var p=f?r.defaultValue:r.value;if(p=is(r)?ns(p):p,t(p),wa!==null&&v.add(wa),await nl(),p!==(p=c())){var m=r.selectionStart,$=r.selectionEnd,y=r.value.length;if(r.value=p??"",$!==null){var b=r.value.length;m===$&&$===y&&b>y?(r.selectionStart=b,r.selectionEnd=b):(r.selectionStart=m,r.selectionEnd=Math.min($,b))}}}),(ya&&r.defaultValue!==r.value||i(c)==null&&r.value)&&(t(is(r)?ns(r.value):r.value),wa!==null&&v.add(wa)),bs(()=>{var f=c();if(r===document.activeElement){var p=Is??wa;if(v.has(p))return}is(r)&&f===ns(r.value)||r.type==="date"&&!f&&!r.value||f!==r.value&&(r.value=f??"")})}const rs=new Set;function Cs(r,c,t,v,f=v){var p=t.getAttribute("type")==="checkbox",m=r;let $=!1;if(c!==null)for(var y of c)m=m[y]??=[];m.push(t),Qa(t,"change",()=>{var b=t.__value;p&&(b=Ds(m,b,t.checked)),f(b)},()=>f(p?[]:null)),bs(()=>{var b=v();if(ya&&t.defaultChecked!==t.checked){$=!0;return}p?(b=b||[],t.checked=b.includes(t.__value)):t.checked=Fs(t.__value,b)}),gs(()=>{var b=m.indexOf(t);b!==-1&&m.splice(b,1)}),rs.has(m)||(rs.add(m),us(()=>{m.sort((b,K)=>b.compareDocumentPosition(K)===4?-1:1),rs.delete(m)})),us(()=>{if($){var b;if(p)b=Ds(m,b,t.checked);else{var K=m.find(P=>P.checked);b=K?.__value}f(b)}})}function Aa(r,c,t=c){Qa(r,"change",v=>{var f=v?r.defaultChecked:r.checked;t(f)}),(ya&&r.defaultChecked!==r.checked||i(c)==null)&&t(r.checked),bs(()=>{var v=c();r.checked=!!v})}function Ds(r,c,t){for(var v=new Set,f=0;f<r.length;f+=1)r[f].checked&&v.add(r[f].__value);return t||v.delete(c),Array.from(v)}function is(r){var c=r.type;return c==="number"||c==="range"}function ns(r){return r===""?null:+r}function Sl(r,c,t){var v=ol(r,c);v&&v.set&&(r[c]=t,gs(()=>{r[c]=null}))}function _s(r){return function(...c){var t=c[0];return t.stopPropagation(),r?.apply(this,c)}}function Ma(r,c){var t=r.$$events?.[c.type],v=Ts(t)?t.slice():t==null?[]:[t];for(var f of v)f.call(this,c)}const Cl="";function Us(...r){return Ia+Cl+hl(r[0],r[1])}const ps={paladin:{name:"Paladin",hitDice:"d10",spellcaster:!0,spellcastingAbility:"charisma",spellSlotsByLevel:{1:0,2:2,3:3,4:3,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Divine Sense",type:"uses",maxUses:(r,c=1)=>1+Math.max(1,c),resetOn:"long",description:"Detect celestials, fiends, and undead within 60 feet",minLevel:1},{name:"Lay on Hands",type:"pool",maxPool:r=>r*5,resetOn:"long",description:"Heal wounds or cure disease",minLevel:1},{name:"Divine Smite",type:"spellSlot",description:"Expend spell slot to deal extra radiant damage",minLevel:2,rollable:!0},{name:"Channel Divinity",type:"pool",maxPool:r=>r>=18?3:r>=6?2:1,resetOn:"short",description:"Sacred Weapon or Turn Undead",minLevel:3}]},fighter:{name:"Fighter",hitDice:"d10",spellcaster:!1,features:[{name:"Second Wind",type:"uses",maxUses:1,resetOn:"short",description:"Regain 1d10 + fighter level HP as bonus action",minLevel:1,rollable:!0,rollFormula:r=>`1d10+${r}`},{name:"Action Surge",type:"uses",maxUses:r=>r>=17?2:1,resetOn:"short",description:"Take one additional action on your turn",minLevel:2},{name:"Indomitable",type:"uses",maxUses:r=>r>=17?3:r>=13?2:1,resetOn:"long",description:"Reroll a failed saving throw",minLevel:9}],subclasses:{champion:{name:"Champion",features:[{name:"Improved Critical",type:"info",description:"Critical hit on 19-20",minLevel:3},{name:"Remarkable Athlete",type:"info",description:"Add half proficiency to STR/DEX/CON checks, increase long jump distance",minLevel:7},{name:"Additional Fighting Style",type:"info",description:"Choose a second fighting style",minLevel:10},{name:"Superior Critical",type:"info",description:"Critical hit on 18-20",minLevel:15},{name:"Survivor",type:"info",description:"Regain 5 + CON mod HP at start of turn if below half HP",minLevel:18}]},battlemaster:{name:"Battle Master",features:[{name:"Combat Superiority",type:"uses",maxUses:r=>r>=15?6:r>=7?5:4,resetOn:"short",description:r=>`Use superiority dice (${r>=18?"d12":r>=10?"d10":"d8"}) for maneuvers`,minLevel:3},{name:"Know Your Enemy",type:"info",description:"Learn capabilities of creatures you observe",minLevel:7},{name:"Improved Combat Superiority",type:"info",description:"Superiority dice become d10",minLevel:10},{name:"Relentless",type:"info",description:"Regain 1 superiority die if you have none at start of turn",minLevel:15}]}}},rogue:{name:"Rogue",hitDice:"d8",spellcaster:!1,features:[{name:"Sneak Attack",type:"info",description:r=>`Deal ${Math.ceil(r/2)}d6 extra damage once per turn with advantage or ally nearby`,minLevel:1,rollable:!0,rollFormula:r=>`${Math.ceil(r/2)}d6`},{name:"Cunning Action",type:"info",description:"Dash, Disengage, or Hide as a bonus action",minLevel:2},{name:"Uncanny Dodge",type:"info",description:"Use reaction to halve damage from an attack",minLevel:5},{name:"Evasion",type:"info",description:"Take no damage on successful Dex save (half on fail)",minLevel:7}]},wizard:{name:"Wizard",hitDice:"d6",spellcaster:!0,spellcastingAbility:"intelligence",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Arcane Recovery",type:"uses",maxUses:1,resetOn:"long",description:r=>`Recover spell slots totaling up to ${Math.ceil(r/2)} levels during short rest`,minLevel:1},{name:"Spell Mastery",type:"info",description:"Cast one 1st-level and one 2nd-level spell at will",minLevel:18}]},cleric:{name:"Cleric",hitDice:"d8",spellcaster:!0,spellcastingAbility:"wisdom",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Channel Divinity",type:"pool",maxPool:r=>r>=18?4:r>=6?3:2,resetOn:"short",description:"Turn Undead or domain-specific ability",minLevel:2},{name:"Destroy Undead",type:"info",description:r=>`Channel Divinity destroys undead of CR ${r>=17?4:r>=14?3:r>=11?2:r>=8?1:.5} or lower`,minLevel:5},{name:"Divine Intervention",type:"uses",maxUses:1,resetOn:"long",description:r=>`${r}% chance to succeed, implore deity for aid`,minLevel:10}],subclasses:{war:{name:"War Domain",features:[{name:"War Priest",type:"uses",maxUses:(r,c=1)=>Math.max(1,c),resetOn:"long",description:"Make one weapon attack as a bonus action",minLevel:1},{name:"Guided Strike",type:"channelDivinity",description:"Use your Channel Divinity to gain +10 to an attack roll. Make this choice after you see the roll, but before the DM says whether the attack hits or misses.",minLevel:2,resetOn:"short"},{name:"War God's Blessing",type:"channelDivinity",description:"Use reaction to grant +10 to an ally's attack roll within 30 feet. Consumes one use of Channel Divinity.",minLevel:6,resetOn:"short"},{name:"Divine Strike",type:"info",description:r=>`Deal extra ${r>=14?"2d8":"1d8"} weapon damage once per turn`,minLevel:8,rollable:!0,rollFormula:r=>r>=14?"2d8":"1d8"},{name:"Avatar of Battle",type:"info",description:"Gain resistance to nonmagical weapon damage",minLevel:17}]},life:{name:"Life Domain",features:[{name:"Disciple of Life",type:"info",description:"Healing spells restore additional 2 + spell level HP",minLevel:1},{name:"Preserve Life",type:"pool",maxPool:r=>r*5,resetOn:"short",description:"Restore HP to creatures within 30 feet",minLevel:2},{name:"Blessed Healer",type:"info",description:"Regain 2 + spell level HP when you cast healing spell",minLevel:6},{name:"Divine Strike",type:"info",description:r=>`Deal extra ${r>=14?"2d8":"1d8"} radiant damage once per turn`,minLevel:8,rollable:!0,rollFormula:r=>r>=14?"2d8":"1d8"},{name:"Supreme Healing",type:"info",description:"Maximize healing dice instead of rolling",minLevel:17}]}}},barbarian:{name:"Barbarian",hitDice:"d12",spellcaster:!1,features:[{name:"Rage",type:"uses",maxUses:r=>r>=20?1/0:r>=17?6:r>=12?5:r>=6?4:r>=3?3:2,resetOn:"long",description:r=>`+${r>=16?4:r>=9?3:2} damage, resistance to physical damage`,minLevel:1},{name:"Reckless Attack",type:"info",description:"Gain advantage on melee attacks, enemies get advantage on you",minLevel:2},{name:"Danger Sense",type:"info",description:"Advantage on Dex saves against effects you can see",minLevel:2}],subclasses:{berserker:{name:"Path of the Berserker",features:[{name:"Frenzy",type:"info",description:"While raging, make melee attack as bonus action (gain 1 exhaustion after rage)",minLevel:3},{name:"Mindless Rage",type:"info",description:"Cannot be charmed or frightened while raging",minLevel:6},{name:"Intimidating Presence",type:"info",description:"Use action to frighten creature within 30 feet",minLevel:10},{name:"Retaliation",type:"info",description:"When damaged by creature within 5 feet, make melee attack as reaction",minLevel:14}]}}}};function ca(r){const c=r.toLowerCase();return ps[c]||null}function Ta(r,c,t){const v=ca(r);if(!v)return[];const f=v.features.filter(p=>!p.minLevel||p.minLevel<=c);if(t&&v.subclasses&&v.subclasses[t]){const p=v.subclasses[t].features.filter(m=>!m.minLevel||m.minLevel<=c);return[...f,...p]}return f}function Ls(r){const c=ca(r);return!c||!c.subclasses?[]:Object.keys(c.subclasses).map(t=>({id:t,name:c.subclasses[t].name}))}function As(r,c){const t=ca(r);return!t||!t.spellcaster||!t.spellSlotsByLevel?0:t.spellSlotsByLevel[c]||0}function js(r,c,t){const v=ca(r);return!v||!v.spellcaster?0:Math.max(1,t+c)}function Dl(r,c,t){const v=ca(r);return!v||!v.spellcaster?null:8+c+t}function Ll(){return Object.keys(ps).map(r=>({id:r,name:ps[r].name}))}var Al=u('<div class="section-header svelte-ls99y2" role="button" tabindex="0"><h2 class="svelte-ls99y2"> </h2> <span class="collapse-btn svelte-ls99y2"> </span></div>');function Da(r,c){Yt(c,!1);let t=Dt(c,"title",8),v=Dt(c,"collapsed",8),f=Dt(c,"ariaLabel",8,""),p=Dt(c,"onToggle",8);Jt();var m=Al(),$=l(m),y=l($,!0);s($);var b=a($,2),K=l(b,!0);s(b),s(m),A(()=>{tt(m,"aria-expanded",!v()),tt(m,"aria-label",f()),k(y,t()),k(K,v()?"‚ñº":"‚ñ≤")}),j("click",m,function(...P){p()?.apply(this,P)}),j("keydown",m,P=>{(P.key==="Enter"||P.key===" ")&&p()()}),o(r,m),Qt()}var jl=u("<option> </option>"),Rl=u("<option> </option>"),Bl=u('<div class="form-group svelte-172i2fj"><label for="characterSubclass" class="svelte-172i2fj">Subclass</label> <select id="characterSubclass" class="svelte-172i2fj"><option>Select Subclass</option><!></select></div>'),Ml=u('<div class="info-grid svelte-172i2fj"><div class="form-group svelte-172i2fj"><label for="characterName" class="svelte-172i2fj">Character Name</label> <input type="text" id="characterName" placeholder="Enter name" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterClass" class="svelte-172i2fj">Class</label> <select id="characterClass" class="svelte-172i2fj"><option>Select Class</option><!></select></div> <!> <div class="form-group svelte-172i2fj"><label for="characterLevel" class="svelte-172i2fj">Level</label> <input type="number" id="characterLevel" min="1" max="20" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterRace" class="svelte-172i2fj">Race</label> <input type="text" id="characterRace" placeholder="e.g., Human" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterBackground" class="svelte-172i2fj">Background</label> <input type="text" id="characterBackground" placeholder="e.g., Soldier" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterAlignment" class="svelte-172i2fj">Alignment</label> <input type="text" id="characterAlignment" placeholder="e.g., Lawful Good" class="svelte-172i2fj"/></div></div>'),Tl=u('<section class="character-info svelte-172i2fj"><!> <!></section>');function Fl(r,c){Yt(c,!1);const t=()=>ot(de,"$character",f),v=()=>ot(sa,"$collapsedStates",f),[f,p]=va(),m=C(),$=Ll();function y(z){const R=z.target;de.update(T=>(T.class=R.value,T.subclass="",T))}function b(z){const R=z.target;de.update(T=>(T.subclass=R.value,T))}function K(z){const R=z.target;de.update(T=>(T.level=parseInt(R.value)||1,T)),Es()}Ve(()=>(t(),Ls),()=>{n(m,t().class?Ls(t().class):[])}),ma(),Jt();var P=Tl(),X=l(P);{let z=kt(()=>(v(),i(()=>v().characterInfo?"Expand":"Collapse")));Da(X,{title:"Character Info",get collapsed(){return v(),i(()=>v().characterInfo)},get ariaLabel(){return e(z)},onToggle:()=>sa.update(R=>({...R,characterInfo:!R.characterInfo}))})}var Z=a(X,2);{var ne=z=>{var R=Ml(),T=l(R),ae=a(l(T),2);we(ae),s(T);var me=a(T,2),We=a(l(me),2),G=l(We);G.value=G.__value="";var Pe=a(G);St(Pe,1,()=>$,Lt,(ue,pe)=>{var ke=jl(),Je=l(ke,!0);s(ke);var st={};A(()=>{k(Je,(e(pe),i(()=>e(pe).name))),st!==(st=(e(pe),i(()=>e(pe).id)))&&(ke.value=(ke.__value=(e(pe),i(()=>e(pe).id)))??"")}),o(ue,ke)}),s(We);var ye;fs(We),s(me);var he=a(me,2);{var Ae=ue=>{var pe=Bl(),ke=a(l(pe),2),Je=l(ke);Je.value=Je.__value="";var st=a(Je);St(st,1,()=>e(m),Lt,(ht,vt)=>{var at=Rl(),At=l(at,!0);s(at);var jt={};A(()=>{k(At,(e(vt),i(()=>e(vt).name))),jt!==(jt=(e(vt),i(()=>e(vt).id)))&&(at.value=(at.__value=(e(vt),i(()=>e(vt).id)))??"")}),o(ht,at)}),s(ke);var ct;fs(ke),s(pe),A(()=>{ct!==(ct=(t(),i(()=>t().subclass)))&&(ke.value=(ke.__value=(t(),i(()=>t().subclass)))??"",Ya(ke,(t(),i(()=>t().subclass))))}),j("change",ke,b),o(ue,pe)};g(he,ue=>{e(m),i(()=>e(m).length>0)&&ue(Ae)})}var B=a(he,2),F=a(l(B),2);we(F),s(B);var x=a(B,2),J=a(l(x),2);we(J),s(x);var h=a(x,2),I=a(l(h),2);we(I),s(h);var se=a(h,2),fe=a(l(se),2);we(fe),s(se),s(R),A(()=>{ye!==(ye=(t(),i(()=>t().class)))&&(We.value=(We.__value=(t(),i(()=>t().class)))??"",Ya(We,(t(),i(()=>t().class)))),Ha(F,(t(),i(()=>t().level)))}),Ee(ae,()=>t().name,ue=>Ut(de,i(t).name=ue,i(t))),j("change",We,y),j("change",F,K),Ee(J,()=>t().race,ue=>Ut(de,i(t).race=ue,i(t))),Ee(I,()=>t().background,ue=>Ut(de,i(t).background=ue,i(t))),Ee(fe,()=>t().alignment,ue=>Ut(de,i(t).alignment=ue,i(t))),o(z,R)};g(Z,z=>{v(),i(()=>!v().characterInfo)&&z(ne)})}s(P),o(r,P),Qt(),p()}var Pl=u('<div class="ability-card svelte-bbv1xt"><h3 class="svelte-bbv1xt"> </h3> <input type="number" class="ability-score svelte-bbv1xt" min="1" max="30"/> <div class="ability-modifier svelte-bbv1xt"> </div> <div class="roll-buttons svelte-bbv1xt"><button class="roll-btn svelte-bbv1xt">Check</button> <button class="roll-btn svelte-bbv1xt">Save</button></div> <div class="save-proficiency svelte-bbv1xt"><input type="checkbox" class="svelte-bbv1xt"/> <label class="svelte-bbv1xt">Save Prof.</label></div></div>'),Il=u('<div class="proficiency-bonus svelte-bbv1xt"><label for="profBonus">Proficiency Bonus</label> <input type="number" id="profBonus" class="prof-input svelte-bbv1xt"/></div> <div class="abilities-grid svelte-bbv1xt"></div>',1),El=u("<section><!> <!></section>");function Hl(r,c){Yt(c,!1);const t=()=>ot(Xa,"$abilityModifiers",$),v=()=>ot(de,"$character",$),f=()=>ot(xa,"$searchFilter",$),p=()=>ot(sa,"$collapsedStates",$),m=()=>ot(ka,"$isEditMode",$),[$,y]=va(),b=C(),K=C(),P=Ca(),X=[{key:"strength",label:"Strength"},{key:"dexterity",label:"Dexterity"},{key:"constitution",label:"Constitution"},{key:"intelligence",label:"Intelligence"},{key:"wisdom",label:"Wisdom"},{key:"charisma",label:"Charisma"}];function Z(){Es()}function ne(G){const Pe=t()[G],ye=`1d20${Pe>=0?"+":""}${Pe}`,he=[];he.push({value:"1d20",source:"base die"}),Pe!==0&&he.push({value:Pe,source:G}),P("roll",{notation:ye,rollType:"check",bonusBreakdown:he})}function z(G){const Pe=t()[G],ye=v().saveProficiencies[G]?v().proficiencyBonus:0,he=Pe+ye,Ae=`1d20${he>=0?"+":""}${he}`,B=[];B.push({value:"1d20",source:"base die"}),Pe!==0&&B.push({value:Pe,source:G}),ye!==0&&B.push({value:ye,source:"proficiency"}),P("roll",{notation:Ae,rollType:"save",bonusBreakdown:B})}Ve(()=>f(),()=>{n(b,X.filter(({label:G})=>f()?G.toLowerCase().includes(f().toLowerCase()):!0))}),Ve(()=>(e(b),f()),()=>{n(K,e(b).length>0||!f()||f().toLowerCase().includes("proficiency"))}),ma(),Jt();var R=El();let T;var ae=l(R);Da(ae,{title:"Ability Scores",get collapsed(){return p(),i(()=>p().abilityScores)},ariaLabel:"Toggle Ability Scores Section",onToggle:()=>sa.update(G=>({...G,abilityScores:!G.abilityScores}))});var me=a(ae,2);{var We=G=>{var Pe=Il(),ye=$e(Pe),he=a(l(ye),2);we(he),s(ye);var Ae=a(ye,2);St(Ae,5,()=>e(b),Lt,(B,F)=>{let x=()=>e(F).key,J=()=>e(F).label;var h=Pl(),I=l(h),se=l(I,!0);s(I);var fe=a(I,2);we(fe);var ue=a(fe,2),pe=l(ue);s(ue);var ke=a(ue,2),Je=l(ke),st=a(Je,2);s(ke);var ct=a(ke,2),ht=l(ct);we(ht);var vt=a(ht,2);s(ct),s(h),A(at=>{k(se,at),k(pe,`${t(),x(),i(()=>t()[x()]>=0?"+":"")??""}${t(),x(),i(()=>t()[x()])??""}`),ht.disabled=!m(),tt(ht,"id",`${x()}-save`),tt(vt,"for",`${x()}-save`)},[()=>(J(),i(()=>J().substring(0,3).toUpperCase()))]),Ee(fe,()=>v().abilities[x()],at=>Ut(de,i(v).abilities[x()]=at,i(v))),j("change",fe,Z),j("click",Je,()=>ne(x())),j("click",st,()=>z(x())),Aa(ht,()=>v().saveProficiencies[x()],at=>Ut(de,i(v).saveProficiencies[x()]=at,i(v))),o(B,h)}),s(Ae),Ee(he,()=>v().proficiencyBonus,B=>Ut(de,i(v).proficiencyBonus=B,i(v))),o(G,Pe)};g(me,G=>{p(),i(()=>!p().abilityScores)&&G(We)})}s(R),A(()=>T=Et(R,1,"ability-scores svelte-bbv1xt",null,T,{hidden:!e(K)})),o(r,R),Qt(),y()}const Ns=[{name:"Unarmored",type:"none",baseAC:10},{name:"Padded",type:"light",baseAC:11},{name:"Leather",type:"light",baseAC:11},{name:"Studded Leather",type:"light",baseAC:12},{name:"Hide",type:"medium",baseAC:12,maxDexBonus:2},{name:"Chain Shirt",type:"medium",baseAC:13,maxDexBonus:2},{name:"Scale Mail",type:"medium",baseAC:14,maxDexBonus:2},{name:"Breastplate",type:"medium",baseAC:14,maxDexBonus:2},{name:"Half Plate",type:"medium",baseAC:15,maxDexBonus:2},{name:"Ring Mail",type:"heavy",baseAC:14,maxDexBonus:0},{name:"Chain Mail",type:"heavy",baseAC:16,maxDexBonus:0},{name:"Splint",type:"heavy",baseAC:17,maxDexBonus:0},{name:"Plate",type:"heavy",baseAC:18,maxDexBonus:0}];function Os(r){return Ns.find(c=>c.name===r)}function Ul(r,c,t){if(!r)return 10+c+(t?2:0);const v=Os(r);if(!v)return 10+c+(t?2:0);let f=v.baseAC;return v.maxDexBonus===void 0?f+=c:v.maxDexBonus>0&&(f+=Math.min(c,v.maxDexBonus)),t&&(f+=2),f}function Oa(r){return Math.floor((r-10)/2)}function ms(r,c){if(!r.class)return null;const t=ca(r.class);if(!t||!t.spellcaster||!t.spellcastingAbility)return null;const v=Oa(c[t.spellcastingAbility]);return 8+r.proficiencyBonus+v}function os(r,c){if(!r.class)return 0;const t=ca(r.class);return!t||!t.spellcaster||!t.spellcastingAbility?0:Oa(c[t.spellcastingAbility])}function Nl(r,c){const t=[],v=Oa(c.dexterity),f=r.armorName?Os(r.armorName):void 0;if(f){if(f.type==="none")t.push("Unarmored"),t.push("Base: 10"),t.push(`Dexterity: ${v>=0?"+":""}${v}`);else if(f.type==="light")t.push(`${f.name}: ${f.baseAC}`),t.push(`Dexterity: ${v>=0?"+":""}${v}`);else if(f.type==="medium"){const p=Math.min(2,v);t.push(`${f.name}: ${f.baseAC}`),t.push(`Dexterity: ${p>=0?"+":""}${p} (max +2)`)}else f.type==="heavy"&&(t.push(`${f.name}: ${f.baseAC}`),t.push("Dexterity: +0 (heavy armor)"));r.shieldEquipped&&t.push("Shield: +2")}else{t.push("Base: 10"),v!==0&&t.push(`Dexterity: ${v>=0?"+":""}${v}`);const p=10+v,m=r.armorClass-p;m!==0&&t.push(`Other: ${m>=0?"+":""}${m}`)}return r.activeStates&&r.activeStates.length>0&&r.activeStates.forEach(p=>{typeof p.acBonus=="number"&&p.acBonus!==0&&(!p.target||p.target==="self")&&t.push(`${p.name}: ${p.acBonus>=0?"+":""}${p.acBonus}`)}),t.join(`
`)}function Ol(r,c){const t=[],v=Oa(c.dexterity);t.push(`Dexterity: ${v>=0?"+":""}${v}`);const f=r.initiative-v;return f!==0&&t.push(`Other Bonuses: ${f>=0?"+":""}${f}`),t.join(`
`)}function Gl(r,c){if(!r.class)return"";const t=ca(r.class);if(!t||!t.spellcaster||!t.spellcastingAbility)return"";const v=[],f=Oa(c[t.spellcastingAbility]),p=t.spellcastingAbility.charAt(0).toUpperCase()+t.spellcastingAbility.slice(1);return v.push("Base: 8"),v.push(`Proficiency: +${r.proficiencyBonus}`),v.push(`${p}: ${f>=0?"+":""}${f}`),v.join(`
`)}function ql(r,c,t){const v=[];let f=r;const p=c.toLowerCase().trim();if(t.activeStates){for(const $ of t.activeStates)if($.immunities&&$.immunities.length>0&&$.immunities.some(b=>b.toLowerCase().trim()===p))return v.push(`Immune to ${c} (${$.name})`),{finalDamage:0,adjustments:v}}let m=!1;if(t.activeStates){for(const $ of t.activeStates)if($.resistances&&$.resistances.length>0&&$.resistances.some(b=>b.toLowerCase().trim()===p)){const b=Math.floor(f/2);v.push(`Resistant to ${c} (${$.name}): ${f} ‚Üí ${b}`),f=b,m=!0;break}}if(!m&&t.race){const $=Ja(t.race);if($){for(const y of $.traits)if(y.resistances&&y.resistances.some(b=>b.toLowerCase().trim()===p)){const b=Math.floor(f/2);v.push(`Resistant to ${c} (racial trait): ${f} ‚Üí ${b}`),f=b,m=!0;break}}}return v.length===0&&v.push(`No adjustments for ${c}`),{finalDamage:f,adjustments:v}}function zl(r,c){const t={...r};if(t.tempHP>0){if(c<=t.tempHP)return t.tempHP-=c,t;c-=t.tempHP,t.tempHP=0}return t.currentHP=Math.max(0,t.currentHP-c),t}var Wl=u('<button class="info-icon svelte-1o8ci7b" type="button">‚ÑπÔ∏è</button>'),Kl=u('<button class="info-icon svelte-1o8ci7b" type="button">‚ÑπÔ∏è</button>'),Vl=u("<div><!></div>"),Jl=u('<div class="tooltip-wrapper svelte-1o8ci7b"><!> <!></div>');function cs(r,c){Yt(c,!1);let t=Dt(c,"tooltipContent",8),v=Dt(c,"ariaLabel",8,"Show information"),f=C(!1),p=C(),m=C(!1),$=C(null),y=C(!1),b=C(!1),K=C("");const P=Math.random().toString(36).slice(2);function X(){window.dispatchEvent(new CustomEvent("tooltip-open",{detail:P}))}function Z(B){B.detail!==P&&(n(f,!1),n(y,!1))}function ne(){n(m,window.matchMedia("(pointer: coarse)").matches||"ontouchstart"in window)}function z(){if(!e($)||!e(p))return;const B=e(p).getBoundingClientRect(),F=e($).getBoundingClientRect();let x=B.bottom+5,J=B.left;n(y,!1),J+F.width>window.innerWidth-8&&(J=B.right-F.width,n(y,!0),J<8&&(J=8)),J<8&&(J=8),x+F.height>window.innerHeight-8&&(x=B.top-F.height-5),n(K,`position:fixed;top:${x}px;left:${J}px;z-index:1000;`),n(b,!0)}function R(){X(),n(f,!1),n(b,!1),requestAnimationFrame(()=>{n(f,!0),n(b,!1),setTimeout(z,0)})}function T(){n(f,!1),n(y,!1)}function ae(B){B.stopPropagation(),e(f)?(n(f,!1),n(y,!1),n(b,!1)):(X(),n(f,!1),n(b,!1),requestAnimationFrame(()=>{n(f,!0),n(b,!1),setTimeout(z,0)}))}function me(B){e(p)&&!e(p).contains(B.target)&&(n(f,!1),n(y,!1))}Sa(()=>{ne(),document.addEventListener("click",me),window.addEventListener("tooltip-open",Z)}),Ws(()=>{document.removeEventListener("click",me),window.removeEventListener("tooltip-open",Z)}),Jt();var We=Jl(),G=l(We);{var Pe=B=>{var F=Wl();A(()=>tt(F,"aria-label",v())),j("click",F,ae),o(B,F)},ye=B=>{var F=Kl();A(()=>tt(F,"aria-label",v())),j("mouseenter",F,R),j("mouseleave",F,T),o(B,F)};g(G,B=>{e(m)?B(Pe):B(ye,!1)})}var he=a(G,2);{var Ae=B=>{var F=Vl(),x=l(F);yl(x,c,"content",{},J=>{var h=bt(),I=$e(h);_l(I,t),o(J,h)}),s(F),Ua(F,J=>n($,J),()=>e($)),A(()=>{Et(F,1,`tooltip-popup ${e(y)?"right-align":""}`,"svelte-1o8ci7b"),xl(F,e(b)?e(K)+"opacity:1;pointer-events:auto;":"opacity:0;pointer-events:none;position:fixed;top:0;left:0;z-index:1000;")}),o(B,F)};g(he,B=>{e(f)&&B(Ae)})}s(We),Ua(We,B=>n(p,B),()=>e(p)),o(r,We),Qt()}var Yl=u("<option> </option>"),Ql=u('<div class="armor-config svelte-1r5hyyb"><h4 class="svelte-1r5hyyb">Armor Configuration</h4> <div class="armor-controls svelte-1r5hyyb"><div class="armor-field svelte-1r5hyyb"><label for="armorName" class="svelte-1r5hyyb">Armor</label> <select id="armorName" class="armor-select svelte-1r5hyyb"><option>None (Unarmored)</option><!></select></div> <div class="armor-field svelte-1r5hyyb"><label class="shield-label svelte-1r5hyyb"><input type="checkbox" class="shield-checkbox svelte-1r5hyyb"/> Shield Equipped (+2 AC)</label></div></div></div>'),Xl=u('<div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="spellSaveDC" class="svelte-1r5hyyb">Spell Save DC</label> <!></div> <input type="number" id="spellSaveDC" class="stat-input svelte-1r5hyyb" readonly=""/></div>'),Zl=u('<span class="hit-dice-type"> </span>'),er=u('<!> <div class="stats-grid svelte-1r5hyyb"><div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="armorClass" class="svelte-1r5hyyb">Armor Class</label> <!></div> <input type="text" id="armorClass" readonly=""/></div> <div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="initiative" class="svelte-1r5hyyb">Initiative</label> <!></div> <input type="text" id="initiative" class="stat-input svelte-1r5hyyb" readonly=""/></div> <div class="stat-box svelte-1r5hyyb"><label for="speed" class="svelte-1r5hyyb">Speed</label> <input type="text" id="speed" class="stat-input svelte-1r5hyyb"/></div> <!></div> <div class="hp-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Points</h3> <div><div class="hp-inputs svelte-1r5hyyb"><input type="number" class="hp-current svelte-1r5hyyb" min="0"/> <span class="hp-separator svelte-1r5hyyb">/</span> <input type="number" class="hp-max svelte-1r5hyyb" min="0"/></div> <div class="hp-controls svelte-1r5hyyb"><button class="hp-btn svelte-1r5hyyb">‚àí</button> <button class="hp-btn svelte-1r5hyyb">+</button> <button class="hp-btn svelte-1r5hyyb">‚àí5</button> <button class="hp-btn svelte-1r5hyyb">+5</button></div></div> <div class="temp-hp svelte-1r5hyyb"><label for="tempHP" class="svelte-1r5hyyb">Temp HP</label> <input type="number" id="tempHP" min="0" class="svelte-1r5hyyb"/></div></div> <div class="hit-dice-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Dice</h3> <div class="hit-dice-display svelte-1r5hyyb"><input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <span>/</span> <input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <!></div> <div class="hit-dice-controls svelte-1r5hyyb"><label for="hitDiceCount" class="svelte-1r5hyyb">Roll</label> <div class="hit-dice-count-controls svelte-1r5hyyb"><button class="hit-dice-btn svelte-1r5hyyb">‚àí</button> <input type="number" id="hitDiceCount" class="hit-dice-count-input svelte-1r5hyyb" min="1"/> <button class="hit-dice-btn svelte-1r5hyyb">+</button></div> <button class="btn btn-primary roll-hit-dice use-enabled svelte-1r5hyyb">üé≤ Roll</button></div></div>',1),tr=u("<section><!> <!></section>");function ar(r,c){Yt(c,!1);const t=()=>ot(de,"$character",$),v=()=>ot(Xa,"$abilityModifiers",$),f=()=>ot(xa,"$searchFilter",$),p=()=>ot(sa,"$collapsedStates",$),m=()=>ot(ka,"$isEditMode",$),[$,y]=va(),b=C(),K=C(),P=C(),X=C(),Z=C(),ne=C(),z=C(),R=Ca();let T=C(1);function ae(B){de.update(F=>(F.currentHP=Math.max(0,Math.min(F.maxHP,F.currentHP+B)),F))}function me(B){const F=e(T)+B,x=t().hitDice.current;n(T,Math.max(1,Math.min(x,F)))}function We(B=1){if(t().hitDice.current<=0){alert("No hit dice remaining!");return}if(!t().class){alert("Please select a class first!");return}const F=ca(t().class);if(!F){alert("Invalid class configuration!");return}const x=Math.min(B,t().hitDice.current),J=F.hitDice,h=v().constitution,I=h*x,se=I>=0?`+${I}`:`${I}`,fe=`${x}${J}${se}`,ue=[];if(ue.push({value:`${x}${J}`,source:"hit dice"}),h!==0)for(let pe=0;pe<x;pe++)ue.push({value:h,source:"constitution"});R("rollHitDice",{notation:fe,hitDie:J,count:x,bonusBreakdown:ue})}Ve(()=>(t(),v(),de),()=>{if(t().armorName!==void 0||t().shieldEquipped!==void 0){const B=v().dexterity,F=Ul(t().armorName,B,t().shieldEquipped||!1);t().armorClass!==F&&de.update(x=>({...x,armorClass:F}))}}),Ve(()=>(v(),t(),de),()=>{const B=v().dexterity;t().initiative!==B&&de.update(F=>({...F,initiative:B}))}),Ve(()=>t(),()=>{n(b,ms(t(),t().abilities))}),Ve(()=>t(),()=>{n(K,Nl(t(),t().abilities))}),Ve(()=>t(),()=>{n(P,Ol(t(),t().abilities))}),Ve(()=>t(),()=>{n(X,Gl(t(),t().abilities))}),Ve(()=>(t(),e(T)),()=>{const B=t().hitDice.current;B>0&&e(T)>B&&n(T,B)}),Ve(()=>t(),()=>{n(Z,t().activeStates&&t().activeStates.length>0?t().activeStates.reduce((B,F)=>B+(F.acBonus||0),0):0)}),Ve(()=>t(),()=>{n(ne,t().activeStates&&t().activeStates.length>0?t().activeStates.some(B=>B.name==="Aid"&&B.target==="self"):!1)}),Ve(()=>f(),()=>{n(z,!f()||"armor class".includes(f().toLowerCase())||"initiative".includes(f().toLowerCase())||"speed".includes(f().toLowerCase())||"hit points".includes(f().toLowerCase())||"hp".includes(f().toLowerCase())||"hit dice".includes(f().toLowerCase())||"spell save".includes(f().toLowerCase())||"combat".includes(f().toLowerCase()))}),ma(),Jt();var G=tr();let Pe;var ye=l(G);{let B=kt(()=>(p(),i(()=>p().combatStats?"Expand":"Collapse")));Da(ye,{title:"Combat Stats",get collapsed(){return p(),i(()=>p().combatStats)},get ariaLabel(){return e(B)},onToggle:()=>sa.update(F=>({...F,combatStats:!F.combatStats}))})}var he=a(ye,2);{var Ae=B=>{var F=er(),x=$e(F);{var J=te=>{var Be=Ql(),_e=a(l(Be),2),qe=l(_e),Ge=a(l(qe),2);A(()=>{t(),Wt(()=>{})});var Xe=l(Ge);Xe.value=(Xe.__value=void 0)??"";var it=a(Xe);St(it,1,()=>Ns,Lt,(W,le)=>{var Me=bt(),Ue=$e(Me);{var Te=Le=>{var rt=Yl(),dt=l(rt);s(rt);var Fe={};A(()=>{k(dt,`${e(le),i(()=>e(le).name)??""} (AC ${e(le),i(()=>e(le).baseAC)??""})`),Fe!==(Fe=(e(le),i(()=>e(le).name)))&&(rt.value=(rt.__value=(e(le),i(()=>e(le).name)))??"")}),o(Le,rt)};g(Ue,Le=>{e(le),i(()=>e(le).name!=="Unarmored")&&Le(Te)})}o(W,Me)}),s(Ge),s(qe);var oe=a(qe,2),L=l(oe),O=l(L);we(O),aa(),s(L),s(oe),s(_e),s(Be),Na(Ge,()=>t().armorName,W=>Ut(de,i(t).armorName=W,i(t))),Aa(O,()=>t().shieldEquipped,W=>Ut(de,i(t).shieldEquipped=W,i(t))),o(te,Be)};g(x,te=>{m()&&te(J)})}var h=a(x,2),I=l(h),se=l(I),fe=a(l(se),2);cs(fe,{get tooltipContent(){return e(K)},ariaLabel:"Show AC breakdown"}),s(se);var ue=a(se,2);we(ue),s(I);var pe=a(I,2),ke=l(pe),Je=a(l(ke),2);cs(Je,{get tooltipContent(){return e(P)},ariaLabel:"Show Initiative breakdown"}),s(ke);var st=a(ke,2);we(st),s(pe);var ct=a(pe,2),ht=a(l(ct),2);we(ht),s(ct);var vt=a(ct,2);{var at=te=>{var Be=Xl(),_e=l(Be),qe=a(l(_e),2);cs(qe,{get tooltipContent(){return e(X)},ariaLabel:"Show Spell Save DC breakdown"}),s(_e);var Ge=a(_e,2);we(Ge),s(Be),A(()=>Ha(Ge,e(b))),o(te,Be)};g(vt,te=>{e(b)!==null&&te(at)})}s(h);var At=a(h,2),jt=a(l(At),2);let w;var q=l(jt),_=l(q);we(_);var H=a(_,4);we(H),s(q);var V=a(q,2),re=l(V),Se=a(re,2),Ce=a(Se,2),Re=a(Ce,2);s(V),s(jt);var ee=a(jt,2),S=a(l(ee),2);we(S),s(ee),s(At);var Y=a(At,2),xe=a(l(Y),2),Oe=l(xe);we(Oe);var Qe=a(Oe,4);we(Qe);var ft=a(Qe,2);{var De=te=>{const Be=kt(()=>(N(ca),t(),i(()=>ca(t().class))));var _e=bt(),qe=$e(_e);{var Ge=Xe=>{const it=kt(()=>(v(),i(()=>v().constitution)));var oe=Zl(),L=l(oe);s(oe),A(()=>k(L,`(${N(e(Be)),i(()=>e(Be).hitDice)??""}${(e(it)>=0?`+${e(it)}`:e(it))??""})`)),o(Xe,oe)};g(qe,Xe=>{e(Be)&&Xe(Ge)})}o(te,_e)};g(ft,te=>{t(),i(()=>t().class)&&te(De)})}s(xe);var Q=a(xe,2),d=a(l(Q),2),He=l(d),ge=a(He,2);we(ge);var U=a(ge,2);s(d);var be=a(d,2);s(Q),s(Y),A(()=>{Ha(ue,(e(Z),t(),i(()=>e(Z)!==0?`${t().armorClass} ‚Üí ${t().armorClass+e(Z)}`:`${t().armorClass}`))),Et(ue,1,dl(e(Z)!==0?"stat-input ac-enhanced":"stat-input"),"svelte-1r5hyyb"),Ha(st,(t(),i(()=>t().initiative))),w=Et(jt,1,"hp-display svelte-1r5hyyb",null,w,{"aid-active":e(ne)}),tt(_,"max",(t(),i(()=>t().maxHP))),tt(Oe,"max",(t(),i(()=>t().hitDice.max))),He.disabled=e(T)<=1,tt(ge,"max",(t(),i(()=>t().hitDice.current))),U.disabled=(e(T),t(),i(()=>e(T)>=t().hitDice.current)),be.disabled=(t(),i(()=>t().hitDice.current<=0||!t().class))}),Ee(ht,()=>t().speed,te=>Ut(de,i(t).speed=te,i(t))),Ee(_,()=>t().currentHP,te=>Ut(de,i(t).currentHP=te,i(t))),Ee(H,()=>t().maxHP,te=>Ut(de,i(t).maxHP=te,i(t))),j("click",re,()=>ae(-1)),j("click",Se,()=>ae(1)),j("click",Ce,()=>ae(-5)),j("click",Re,()=>ae(5)),Ee(S,()=>t().tempHP,te=>Ut(de,i(t).tempHP=te,i(t))),Ee(Oe,()=>t().hitDice.current,te=>Ut(de,i(t).hitDice.current=te,i(t))),Ee(Qe,()=>t().hitDice.max,te=>Ut(de,i(t).hitDice.max=te,i(t))),j("click",He,()=>me(-1)),Ee(ge,()=>e(T),te=>n(T,te)),j("input",ge,te=>{const Be=te.target,_e=parseInt(Be.value);_e>t().hitDice.current&&n(T,t().hitDice.current),_e<1&&n(T,1)}),j("click",U,()=>me(1)),j("click",be,()=>We(e(T))),o(B,F)};g(he,B=>{p(),i(()=>!p().combatStats)&&B(Ae)})}s(G),A(()=>Pe=Et(G,1,"combat-stats svelte-1r5hyyb",null,Pe,{hidden:!e(z)})),o(r,G),Qt(),y()}const qa={acrobatics:"dexterity",animalHandling:"wisdom",arcana:"intelligence",athletics:"strength",deception:"charisma",history:"intelligence",insight:"wisdom",intimidation:"charisma",investigation:"intelligence",medicine:"wisdom",nature:"intelligence",perception:"wisdom",performance:"charisma",persuasion:"charisma",religion:"intelligence",sleightOfHand:"dexterity",stealth:"dexterity",survival:"wisdom"};var sr=u('<div class="skill-row svelte-1f1pl16"><input type="checkbox" class="svelte-1f1pl16"/> <label class="svelte-1f1pl16"> <span class="ability-tag svelte-1f1pl16"> </span></label> <span class="skill-modifier svelte-1f1pl16"> </span> <button class="roll-btn svelte-1f1pl16">Roll</button></div>'),lr=u('<div class="skills-grid svelte-1f1pl16"></div>'),rr=u("<section><!> <!></section>");function ir(r,c){Yt(c,!1);const t=()=>ot(de,"$character",$),v=()=>ot(Xa,"$abilityModifiers",$),f=()=>ot(xa,"$searchFilter",$),p=()=>ot(sa,"$collapsedStates",$),m=()=>ot(ka,"$isEditMode",$),[$,y]=va(),b=C(),K=C(),P=C(),X=C(),Z=C(),ne=C(),z=Ca(),R=[{key:"acrobatics",label:"Acrobatics"},{key:"animalHandling",label:"Animal Handling"},{key:"arcana",label:"Arcana"},{key:"athletics",label:"Athletics"},{key:"deception",label:"Deception"},{key:"history",label:"History"},{key:"insight",label:"Insight"},{key:"intimidation",label:"Intimidation"},{key:"investigation",label:"Investigation"},{key:"medicine",label:"Medicine"},{key:"nature",label:"Nature"},{key:"perception",label:"Perception"},{key:"performance",label:"Performance"},{key:"persuasion",label:"Persuasion"},{key:"religion",label:"Religion"},{key:"sleightOfHand",label:"Sleight of Hand"},{key:"stealth",label:"Stealth"},{key:"survival",label:"Survival"}];function T(ye){const he=qa[ye],Ae=v()[he],B=t().skillProficiencies[ye]?t().proficiencyBonus:0,F=e(b)[ye],x=`1d20${F>=0?"+":""}${F}`,J=[];J.push({value:"1d20",source:"base die"}),Ae!==0&&J.push({value:Ae,source:he}),B!==0&&J.push({value:B,source:"proficiency"}),z("roll",{notation:x,rollType:"check",bonusBreakdown:J})}Ve(()=>{},()=>{n(b,{})}),Ve(()=>t(),()=>{n(K,t().skillProficiencies)}),Ve(()=>t(),()=>{n(P,t().proficiencyBonus)}),Ve(()=>v(),()=>{n(X,v())}),Ve(()=>(e(X),e(K),e(P)),()=>{for(const{key:ye}of R){const he=qa[ye],Ae=e(X)[he],B=e(K)[ye]?e(P):0;_a(b,e(b)[ye]=Ae+B)}}),Ve(()=>f(),()=>{n(Z,R.filter(({label:ye})=>f()?ye.toLowerCase().includes(f().toLowerCase()):!0))}),Ve(()=>e(Z),()=>{n(ne,e(Z).length>0)}),ma(),Jt();var ae=rr();let me;var We=l(ae);{let ye=kt(()=>(p(),i(()=>p().skills?"Expand":"Collapse")));Da(We,{title:"Skills",get collapsed(){return p(),i(()=>p().skills)},get ariaLabel(){return e(ye)},onToggle:()=>sa.update(he=>({...he,skills:!he.skills}))})}var G=a(We,2);{var Pe=ye=>{var he=lr();St(he,5,()=>e(Z),Lt,(Ae,B)=>{let F=()=>e(B).key,x=()=>e(B).label;var J=sr(),h=l(J);we(h);var I=a(h,2),se=l(I),fe=a(se),ue=l(fe);s(fe),s(I);var pe=a(I,2),ke=l(pe);s(pe);var Je=a(pe,2);s(J),A(st=>{Hs(h,(e(K),F(),i(()=>e(K)[F()]))),h.disabled=!m(),tt(h,"id",F()),tt(I,"for",F()),k(se,`${x()??""} `),k(ue,`(${st??""})`),k(ke,`${e(b),F(),i(()=>e(b)[F()]>=0?"+":"")??""}${e(b),F(),i(()=>e(b)[F()])??""}`)},[()=>(N(qa),F(),i(()=>qa[F()].substring(0,3).toUpperCase()))]),j("change",h,st=>{console.log("Skill proficiency changed:",F(),st.target.checked),de.update(ct=>({...ct,skillProficiencies:{...ct.skillProficiencies,[F()]:st.target.checked}}))}),j("click",Je,()=>T(F())),o(Ae,J)}),s(he),o(ye,he)};g(G,ye=>{p(),i(()=>!p().skills)&&ye(Pe)})}s(ae),A(()=>me=Et(ae,1,"skills svelte-1f1pl16",null,me,{hidden:!e(ne)})),o(r,ae),Qt(),y()}var nr=u('<p class="empty-message svelte-1123ljy">No attacks or spells to reorder.</p>'),or=u('<li class="reorder-item svelte-1123ljy"><span class="attack-name svelte-1123ljy"> </span> <div class="reorder-buttons svelte-1123ljy"><button class="btn-move svelte-1123ljy" aria-label="Move up">‚ñ≤</button> <button class="btn-move svelte-1123ljy" aria-label="Move down">‚ñº</button></div></li>'),cr=u('<ul class="reorder-list svelte-1123ljy"></ul>'),vr=u('<div class="modal-backdrop svelte-1123ljy" role="presentation"><div class="modal-content svelte-1123ljy" role="dialog" aria-modal="true" aria-labelledby="modal-title"><div class="modal-header svelte-1123ljy"><h3 id="modal-title" class="svelte-1123ljy">Reorder Attacks & Spells</h3> <button class="btn-close svelte-1123ljy" aria-label="Close">√ó</button></div> <div class="modal-body svelte-1123ljy"><!></div> <div class="modal-footer svelte-1123ljy"><button class="btn btn-secondary svelte-1123ljy">Cancel</button> <button class="btn btn-primary svelte-1123ljy">Save Order</button></div></div></div>');function dr(r,c){Yt(c,!1);let t=Dt(c,"show",8,!1),v=Dt(c,"attacks",24,()=>[]),f=Dt(c,"onSave",8),p=Dt(c,"onCancel",8),m=C([]);function $(R,T){const ae=e(m)[R];_a(m,e(m)[R]=e(m)[T]),_a(m,e(m)[T]=ae),n(m,[...e(m)])}function y(R){R>0&&$(R,R-1)}function b(R){R<e(m).length-1&&$(R,R+1)}function K(){f()(e(m))}function P(){p()()}function X(R){R.target===R.currentTarget&&P()}Ve(()=>(N(t()),N(v())),()=>{t()&&n(m,[...v()])}),ma(),Jt();var Z=bt(),ne=$e(Z);{var z=R=>{var T=vr(),ae=l(T),me=l(ae),We=a(l(me),2);s(me);var G=a(me,2),Pe=l(G);{var ye=x=>{var J=nr();o(x,J)},he=x=>{var J=cr();St(J,7,()=>e(m),h=>h.id,(h,I,se)=>{var fe=or(),ue=l(fe),pe=l(ue,!0);s(ue);var ke=a(ue,2),Je=l(ke),st=a(Je,2);s(ke),s(fe),A(()=>{k(pe,(e(I),i(()=>e(I).name||"(Unnamed attack or spell)"))),Je.disabled=e(se)===0,st.disabled=(N(e(se)),e(m),i(()=>e(se)===e(m).length-1))}),j("click",Je,()=>y(e(se))),j("click",st,()=>b(e(se))),o(h,fe)}),s(J),o(x,J)};g(Pe,x=>{e(m),i(()=>e(m).length===0)?x(ye):x(he,!1)})}s(G);var Ae=a(G,2),B=l(Ae),F=a(B,2);s(Ae),s(ae),s(T),j("click",We,P),j("click",B,P),j("click",F,K),j("click",T,X),o(R,T)};g(ne,R=>{t()&&R(z)})}o(r,Z),Qt()}let za=null,Wa=null;async function Gs(){if(za)return za;try{return za=await(await fetch(Us("/data/spells.json"))).json(),za||[]}catch(r){return console.error("Failed to load spells:",r),[]}}async function ur(){if(Wa)return Wa;try{return Wa=await(await fetch(Us("/data/feats.json"))).json(),Wa||[]}catch(r){return console.error("Failed to load feats:",r),[]}}function Rs(r,c){if(!c.trim())return r;const t=c.toLowerCase();return r.filter(v=>v.name.toLowerCase().includes(t)||v.school.toLowerCase().includes(t)||v.classes.some(f=>f.toLowerCase().includes(t))||v.description.toLowerCase().includes(t))}function fr(r,c){return c===null?r:r.filter(t=>t.level===c)}function pr(r,c){if(!c.trim())return r;const t=c.toLowerCase();return r.filter(v=>v.name.toLowerCase().includes(t)||v.description.toLowerCase().includes(t))}function Ka(r){const c=r.description,t=/\b(Strength|Dexterity|Constitution|Intelligence|Wisdom|Charisma)\s+saving\s+throw/i,v=c.match(t);if(!v)return null;const f=v[1].toLowerCase(),m=/half\s+(?:as\s+much\s+)?damage\s+on\s+a\s+successful(?:\s+save)?|on\s+a\s+successful(?:\s+save)?[^.]*half\s+(?:as\s+much\s+)?damage/i.test(c),y=/saving\s+throw\s+or\s+take.*?damage/i.test(c)&&!m;return{ability:f,halfDamageOnSave:m,noDamageOnSave:y}}function mr(r){const c=r.description;return/(plus|add)\s+your\s+spellcasting\s+(ability\s+)?modifier/i.test(c)}function La(r){const c=r.description.toLowerCase();return c.includes("ranged spell attack")||c.includes("melee spell attack")}function Va(r){const c=r.description.toLowerCase();if(["Divine Favor","Bless","Aid","Command","Crusader's Mantle"].includes(r.name))return!0;const f=["takes","take","deals","deal","damage equal to","force damage","fire damage","cold damage","lightning damage","thunder damage","acid damage","poison damage","necrotic damage","radiant damage","psychic damage","regain","regains","hit point"].some($=>c.includes($));return["bonus to attack","bonus to damage","bonus to ac","gains a +","gain a +","+1 bonus","+2 bonus","+3 bonus","advantage on","becomes a magic weapon"].some($=>c.includes($))&&!f}function gr(r){const c=r.description;let t=0,v=0,f=0,p="";const m=c.match(/\+(\d+)\s+bonus\s+to\s+attack\s+rolls\s+and\s+damage\s+rolls/i);if(m){const y=parseInt(m[1]);t=y,v=y,p=`+${y} to attack and damage rolls`}if(r.name==="Bless"&&(p="Add 1d4 to attack rolls and saves",t="1d4"),r.name==="Aid")return p="+5 HP (max and current) for 8 hours",{attackBonus:0,damageBonus:0,acBonus:0,hpBonus:5,description:p,name:r.name};r.name==="Divine Favor"&&(p="Your weapon attacks deal an extra 1d4 radiant damage on a hit.",v="1d4");const $=c.match(/\+(\d+)\s+bonus\s+to\s+AC/i);return $&&(f=parseInt($[1]),p=`+${f} to AC`),r.name==="Haste"&&(p="+2 AC, doubled speed, extra action",f=2),r.name==="Crusader's Mantle"&&(p="Your weapon attacks deal an extra 1d4 radiant damage on a hit.",v="1d4"),p||t!==0||v!==0||f!==0?{attackBonus:t,damageBonus:v,acBonus:f,description:p||r.description.substring(0,100),name:r.name}:null}function vs(r){const c=r.description,t=/takes?\s+(\d+d\d+)\s+\w+\s+damage[^.]*\.\s*If\s+the\s+target\s+is\s+missing.*?instead\s+takes?\s+(\d+d\d+)/is,v=c.match(t);return v?{baseDamage:v[1],alternateDamage:v[2]}:null}var br=u('<button class="btn btn-secondary">Reorder</button>'),hr=u('<div class="edit-buttons svelte-14o91c5"><button class="btn btn-secondary">Add Attack</button> <!></div>'),_r=u('<input type="text" placeholder="Attack name" class="attack-name svelte-14o91c5"/>'),yr=u('<h4 class="attack-name-display svelte-14o91c5"> </h4>'),xr=u('<button class="btn-remove svelte-14o91c5">√ó</button>'),$r=u('<div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Bonus</label> <input type="number" class="attack-bonus svelte-14o91c5"/></div>'),wr=u('<div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Damage</label> <input type="text" placeholder="e.g., 2d6+3" class="attack-damage svelte-14o91c5"/></div>'),kr=u('<div class="spell-info-loading svelte-14o91c5">Loading spell info...</div>'),Sr=u('<li class="svelte-14o91c5"><strong>At Higher Levels:</strong> </li>'),Cr=u('<li style="color: #007bff;" class="svelte-14o91c5"><strong>Special:</strong> Mage Hand is invisible when cast via Githyanki Psionics.</li>'),Dr=u('<li style="color: #007bff;" class="svelte-14o91c5"><strong>Cast via:</strong> </li>'),Lr=u("<!> <!>",1),Ar=u('<ul class="svelte-14o91c5"><li class="svelte-14o91c5"><strong>Level:</strong> </li> <li class="svelte-14o91c5"><strong>Casting Time:</strong> </li> <li class="svelte-14o91c5"><strong>Range:</strong> </li> <li class="svelte-14o91c5"><strong>Components:</strong> <!></li> <li class="svelte-14o91c5"><strong>Duration:</strong> <!> </li> <li class="svelte-14o91c5"><strong>Description:</strong> </li> <!> <!></ul>'),jr=u('<span class="scaled-damage svelte-14o91c5" style="margin-left: 8px;"> </span>'),Rr=u('<span class="scaled-damage svelte-14o91c5">(Half damage)</span>'),Br=u('<span class="scaled-damage svelte-14o91c5">(No damage)</span>'),Mr=u('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> <!> <!></label></div>'),Tr=u('<span class="scaled-damage svelte-14o91c5"> </span>'),Fr=u('<span class="scaled-damage svelte-14o91c5"> </span>'),Pr=u('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> Target is missing HP <!></label></div>'),Ir=u("<option> </option>"),Er=u('<span class="scaled-damage svelte-14o91c5"><!> </span>'),Hr=u('<span class="scaled-damage svelte-14o91c5"> </span>'),Ur=u('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> Target is Fiend or Undead <!></label></div>'),Nr=u('<div class="spell-level-selector svelte-14o91c5"><label class="svelte-14o91c5">Cast at Level:</label> <select class="spell-level-select use-enabled svelte-14o91c5"></select> <!></div> <!>',1),Or=u('<div class="spell-info svelte-14o91c5"><div class="spell-info-header svelte-14o91c5" role="button" tabindex="0"><h4 class="svelte-14o91c5">Spell Info</h4> <button class="collapse-btn-small svelte-14o91c5"> </button></div> <!></div> <!> <!> <!>',1),Gr=u('<div class="spell-info-missing svelte-14o91c5">Spell info not found.</div>'),qr=u('<div class="attack-notes svelte-14o91c5"><label class="svelte-14o91c5">Notes</label> <textarea placeholder="e.g., DC 15 Dex save, Range 120 ft, Concentration" class="notes-input svelte-14o91c5" rows="2"></textarea></div>'),zr=u('<div style="margin-bottom: 0.5em;"><label style="font-size:0.95em;"><input type="checkbox" class="svelte-14o91c5"/> Use Racial Trait <span style="color:#007bff; font-size:0.95em; margin-left:0.5em;"> </span></label></div>'),Wr=u('<button class="btn btn-primary">Roll Attack (Spell Slot)</button>'),Kr=u('<button class="btn btn-primary" disabled>No spell slots available</button>'),Vr=u('<button class="btn btn-primary">Roll Attack (Racial Trait)</button>'),Jr=u('<button class="btn btn-primary" disabled>No racial uses left</button>'),Yr=u('<div class="buff-target-selection svelte-14o91c5"><div class="target-options svelte-14o91c5"><label class="target-option svelte-14o91c5"><input type="radio" class="svelte-14o91c5"/> Self</label> <label class="target-option svelte-14o91c5"><input type="radio" class="svelte-14o91c5"/> Other</label></div> <button class="btn btn-info"> </button></div>'),Qr=u('<button class="btn btn-info">Cast Spell</button>'),Xr=u("<button><!></button>"),Zr=u('<button class="btn btn-info">Cast Spell</button>'),ei=u("<!> <!> <!> <!>",1),ti=u('<button class="btn btn-secondary">Roll Damage</button>'),ai=u('<button class="btn btn-primary">Roll Attack</button> <!>',1),si=u('<div class="attack-card svelte-14o91c5"><div class="attack-header svelte-14o91c5"><!> <!></div> <div class="attack-details svelte-14o91c5"><!> <!> <div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Type</label> <input type="text" placeholder="e.g., slashing" class="attack-type svelte-14o91c5"/></div></div> <!> <!> <div class="attack-actions svelte-14o91c5"><!> <!></div></div>'),li=u('<p class="no-attacks svelte-14o91c5">No attacks added yet. Click "Add Attack" to create one.</p>'),ri=u('<p class="no-attacks svelte-14o91c5">No attacks match your search.</p>'),ii=u('<span class="ability-uses svelte-14o91c5"> <!></span>'),ni=u('<span class="ability-reaction svelte-14o91c5">‚ö° Reaction</span>'),oi=u('<button class="btn btn-ability svelte-14o91c5">Use Ability</button>'),ci=u('<div class="ability-card svelte-14o91c5"><div class="ability-header svelte-14o91c5"><h4 class="ability-name svelte-14o91c5"> </h4> <span class="ability-source svelte-14o91c5"> </span></div> <p class="ability-description svelte-14o91c5"> </p> <div class="ability-footer svelte-14o91c5"><!> <!> <!></div></div>'),vi=u('<div class="condition-abilities-section svelte-14o91c5"><h3 class="abilities-header svelte-14o91c5">Condition Abilities</h3> <p class="section-description svelte-14o91c5">Special actions granted by active conditions (e.g., Flicker of Deceit)</p> <div class="abilities-list svelte-14o91c5"></div></div>'),di=u('<button class="btn-remove svelte-14o91c5">√ó</button>'),ui=u('<div class="state-card svelte-14o91c5"><div class="state-header svelte-14o91c5"><input type="text" placeholder="Effect name (e.g., Magic Weapon)" class="state-name svelte-14o91c5"/> <!></div> <div class="state-details svelte-14o91c5"><div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Attack Bonus</label> <input type="number" class="state-bonus svelte-14o91c5"/></div> <div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Damage Bonus</label> <input type="text" class="state-bonus svelte-14o91c5"/></div> <div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Target</label> <select class="state-bonus svelte-14o91c5"><option>Self</option><option>Other</option></select></div></div> <div class="state-description svelte-14o91c5"><label class="svelte-14o91c5">Description</label> <input type="text" placeholder="e.g., +1 to attack and damage rolls (Magic Weapon)" class="state-desc-input svelte-14o91c5"/></div></div>'),fi=u('<div class="states-list svelte-14o91c5"></div>'),pi=u('<p class="no-states svelte-14o91c5">No active effects. Add spell effects that modify your attacks.</p>'),mi=u('<!> <div class="attacks-list svelte-14o91c5"><!> <!> <!></div> <!> <div class="active-states-section svelte-14o91c5"><h3 class="svelte-14o91c5">Active Spell Effects</h3> <p class="section-description svelte-14o91c5">Effects that modify attack and damage rolls (e.g., Magic Weapon, Bless)</p> <button class="btn btn-secondary">Add Effect</button> <!></div>',1),gi=u("<section><!> <!></section> <!>",1);function bi(r,c){Yt(c,!1);const t=()=>ot(de,"$character",m),v=()=>ot(xa,"$searchFilter",m),f=()=>ot(sa,"$collapsedStates",m),p=()=>ot(ka,"$isEditMode",m),[m,$]=va(),y=C(),b=C(),K=C(),P=[];let X=C({});function Z(w,q){de.update(_=>{if(!_.activeStates)return _;const H=_.activeStates.findIndex(Ce=>Ce.name===w);if(H===-1)return _;const V=_.activeStates[H];if(!V.abilities)return _;const re=V.abilities.findIndex(Ce=>Ce.name===q);if(re===-1)return _;const Se=V.abilities[re];return Se.currentUses!==void 0&&Se.currentUses>0&&(Se.currentUses-=1,Se.usesPerRest!==void 0?Nt.add(`Used ${q} (${Se.currentUses}/${Se.usesPerRest} remaining)`,"info"):Nt.add(`Used ${q}`,"info")),_})}const ne=Ca();let z=C({}),R=C({}),T=C(!1);function ae(w){_a(z,e(z)[w]=!e(z)[w]),n(z,{...e(z)})}function me(w){return w.description.toLowerCase().includes("regain")&&(w.description.toLowerCase().includes("hit point")||w.description.toLowerCase().includes("hp"))}function We(w){return["Shield of Faith","Bless","Aid","Magic Weapon"].includes(w)}function G(){de.update(w=>(w.attacks=[...w.attacks,{id:crypto.randomUUID(),name:"",bonus:0,damage:"",damageType:"",notes:""}],w))}function Pe(w){de.update(q=>(q.attacks=q.attacks.filter(_=>_.id!==w),q))}function ye(){n(T,!0)}function he(){n(T,!1)}function Ae(w){de.update(q=>(q.attacks=w,q)),n(T,!1),Nt.add("Attack order updated successfully!","success")}function B(w,q){let _=w.damage,H=!1,V=!1;if(w.spellRef){const ee=h(w.spellRef);if(ee&&(V=La(ee),ee.level>0)){const S=w.castAtLevel||ee.level;let Y=!1;if(q||w.source==="racial"){if(Y=se(w.name),!Y){Nt.add(`No uses of ${w.name} remaining!`,"error");return}}else if(Y=I(S),!Y){Nt.add(`No level ${S} spell slots available!`,"error");return}const Oe=Ka(ee);Oe&&w.targetSucceededSave&&Oe.noDamageOnSave?_="0":(H=Oe?.halfDamageOnSave&&w.targetSucceededSave||!1,_=fe(w,ee))}}else if(t().activeStates&&t().activeStates.length>0){let ee=0,S=[];for(const Y of t().activeStates)Y.target!=="other"&&(typeof Y.damageBonus=="string"?S.push(Y.damageBonus):typeof Y.damageBonus=="number"&&(ee+=Y.damageBonus));if((ee!==0||S.length>0)&&_){const Y=_.match(/(\d+d\d+)([+-]\d+)?/);if(Y){const[,xe,Oe]=Y,ft=(Oe?parseInt(Oe):0)+ee;let De=`${xe}`;ft!==0&&(De+=`${ft>=0?"+":""}${ft}`),S.length>0&&(De+=" + "+S.join(" + ")),_=De}}}const re=[];let Se=0;if(V){const ee=os(t(),t().abilities),S=t().proficiencyBonus||0;re.push({value:S,source:"proficiency"}),re.push({value:ee,source:"spellcasting"}),Se=S+ee}else w.bonus!==0&&re.push({value:w.bonus,source:"base"}),Se=w.bonus;let Ce=[];if(t().activeStates)for(const ee of t().activeStates)ee.target!=="other"&&(typeof ee.attackBonus=="number"&&ee.attackBonus!==0?(re.push({value:ee.attackBonus,source:ee.name.toLowerCase()}),Se+=ee.attackBonus):typeof ee.attackBonus=="string"&&ee.attackBonus&&Ce.push(ee.attackBonus));let Re=`1d20${Se>=0?"+":""}${Se}`;Ce.length>0&&(Re+="+"+Ce.join("+")),ne("roll",{notation:Re,damageNotation:_,attackName:w.name,applyHalfDamage:H,bonusBreakdown:re,rollType:"attack"})}function F(w){if(!w.damage){Nt.add(`${w.name}: No damage specified`,"error");return}let q=w.damage,_=!1;const H=[];let V=w.damageType||"";if(w.spellRef){const re=h(w.spellRef);if(re){const Se=me(re);if(Se){const Ce=os(t(),t().abilities),Re=q.match(/^(\d+d\d+)/);Re&&(q=Re[1],Ce>0&&(q+=`+${Ce}`,H.push({value:Ce,source:"spellcasting"}))),V="Healing"}if(re.level>0){const Ce=w.castAtLevel||re.level;let Re=!1;if(w.source==="racial"){if(Re=se(w.name),!Re){Nt.add(`No uses of ${w.name} remaining!`,"error");return}}else if(Re=I(Ce),!Re){Nt.add(`No level ${Ce} spell slots available!`,"error");return}const ee=Ka(re);ee&&w.targetSucceededSave&&ee.noDamageOnSave?q="0":(_=ee?.halfDamageOnSave&&w.targetSucceededSave||!1,Se||(q=fe(w,re)))}}}else{const re=q.match(/(\d+d\d+)([+-]\d+)?/);if(re){const[,Se,Ce]=re,Re=Ce?parseInt(Ce):0;if(Re!==0&&H.push({value:Re,source:"base"}),t().activeStates&&t().activeStates.length>0){let ee=0,S=[];for(const Y of t().activeStates)Y.target!=="other"&&(typeof Y.damageBonus=="string"?S.push(Y.damageBonus):typeof Y.damageBonus=="number"&&Y.damageBonus!==0&&(H.push({value:Y.damageBonus,source:Y.name.toLowerCase()}),ee+=Y.damageBonus));if(ee!==0||S.length>0){const Y=Re+ee;let xe=`${Se}`;Y!==0&&(xe+=`${Y>=0?"+":""}${Y}`),S.length>0&&(xe+=" + "+S.join(" + ")),q=xe}}}}ne("roll",{notation:q,attackName:w.name,applyHalfDamage:_,bonusBreakdown:H,damageType:V})}let x=C([]),J=C(!1);Sa(async()=>{n(x,await Gs()),n(J,!0)});function h(w){return e(x).find(q=>q.name===w)}function I(w){t().classFeatures.spellSlotsByLevel||Ut(de,i(t).classFeatures.spellSlotsByLevel={},i(t)),t().classFeatures.spellSlotsByLevel[w]||Ut(de,i(t).classFeatures.spellSlotsByLevel[w]=Array(2).fill(!1),i(t));const _=t().classFeatures.spellSlotsByLevel[w].findIndex(H=>!H);return _===-1?!1:(de.update(H=>(H.classFeatures.spellSlotsByLevel||(H.classFeatures.spellSlotsByLevel={}),H.classFeatures.spellSlotsByLevel[w]||(H.classFeatures.spellSlotsByLevel[w]=Array(2).fill(!1)),H.classFeatures.spellSlotsByLevel[w][_]=!0,H)),!0)}function se(w){return!t().racialTraits||!t().racialTraits.uses[w]?!0:t().racialTraits.uses[w].currentUses<=0?!1:(ul(w),!0)}function fe(w,q){let _=w.damage,H=0,V=0;const re=vs(q);if(re&&w.targetIsDamaged&&(_=re.alternateDamage),mr(q)&&(V+=os(t(),t().abilities)),t().activeStates)for(const Qe of t().activeStates)Qe.target!=="other"&&typeof Qe.damageBonus=="number"&&(V+=Qe.damageBonus);if(q.higherLevelSlot&&w.castAtLevel){const Qe=q.level,De=(w.castAtLevel||Qe)-Qe;if(De>0){const Q=q.higherLevelSlot.match(/(\d+)d(\d+)\s+for\s+each.*?level\s+above/i);if(Q){const[,d]=Q;H+=De*parseInt(d)}}}if(w.targetIsFiendOrUndead&&q.description.includes("Fiend or an Undead")){const Qe=q.description.match(/increases by (\d+)d(\d+) if.*?Fiend or.*?Undead/i);if(Qe){const[,ft]=Qe;H+=parseInt(ft)}}const Se=_.match(/(\d+)d(\d+)([+-]\d+)?/);if(!Se)return V!==0?V>=0?`${V}`:`${V}`:_||"0";const[,Ce,Re,ee]=Se,S=parseInt(Ce)+H,xe=(ee?parseInt(ee):0)+V;let Oe=`${S}d${Re}`;return xe!==0&&(Oe+=xe>=0?`+${xe}`:`${xe}`),Oe}function ue(w){const q=[];for(let H=w.level;H<=9;H++){const V=t().classFeatures.spellSlotsByLevel?.[H];V&&V.length>0&&q.push(H)}return q}function pe(){de.update(w=>(w.activeStates||(w.activeStates=[]),w.activeStates=[...w.activeStates,{name:"",attackBonus:0,damageBonus:0,description:"",target:"self"}],w))}function ke(w){de.update(q=>{if(q.activeStates){const _=q.activeStates[w];_?.hpBonus&&_.target!=="other"&&(q.maxHP-=_.hpBonus,q.currentHP=Math.max(1,Math.min(q.currentHP-_.hpBonus,q.maxHP))),q.activeStates=q.activeStates.filter((H,V)=>V!==w)}return q})}function Je(w,q="self"){const _=h(w.spellRef);if(!_){Nt.add("Spell not found","error");return}const H=w.castAtLevel||_.level;if(H>0){let S=!1;if(w.source==="racial"){if(S=se(w.name),!S){Nt.add(`No uses of ${w.name} remaining!`,"error");return}}else if(S=I(H),!S){Nt.add(`No level ${H} spell slots available!`,"error");return}}const V=gr(_);if(!V){Nt.add(`${_.name} cast! Check spell description for effects.`,"info");return}let re=V.hpBonus||0,Se=V.description;_.name==="Aid"&&H>_.level&&(re=5+(H-_.level)*5,Se=`+${re} HP (max and current) for 8 hours`);const Re=["Shield of Faith","Bless","Aid","Magic Weapon"].includes(_.name);de.update(S=>{S.activeStates||(S.activeStates=[]);const Y=S.activeStates.find(xe=>xe.name===_.name);return Y&&Y.hpBonus&&Y.target!=="other"&&(S.maxHP-=Y.hpBonus,S.currentHP=Math.max(1,Math.min(S.currentHP-Y.hpBonus,S.maxHP))),S.activeStates=S.activeStates.filter(xe=>xe.name!==_.name),re>0&&q==="self"&&(S.maxHP+=re,S.currentHP+=re),S.activeStates=[...S.activeStates,{name:_.name,attackBonus:V.attackBonus,damageBonus:V.damageBonus,acBonus:V.acBonus,description:Se,target:q,hpBonus:re}],S});const ee=q==="self"?" on self":" on other";Nt.add(`${_.name} cast${Re?ee:""}! Effect added to Active Spell Effects.`,"success")}Ve(()=>t(),()=>{n(y,t().activeStates?t().activeStates.filter(w=>w.abilities&&w.abilities.length>0).flatMap(w=>w.abilities.map(q=>({...q,conditionName:w.name}))):[])}),Ve(()=>(t(),e(z),e(R)),()=>{if(t()&&t().attacks)for(const w of t().attacks)w.spellRef&&e(z)[w.id]===void 0&&_a(z,e(z)[w.id]=!0),w.spellRef&&e(R)[w.id]===void 0&&_a(R,e(R)[w.id]="self")}),Ve(()=>(t(),v()),()=>{n(b,t().attacks.filter(w=>{if(!v())return!0;const q=v().toLowerCase();return w.name.toLowerCase().includes(q)||w.damageType.toLowerCase().includes(q)}).sort((w,q)=>!w.spellRef&&q.spellRef?-1:w.spellRef&&!q.spellRef?1:0))}),Ve(()=>(v(),e(b)),()=>{n(K,!v()||e(b).length>0||"attack".includes(v().toLowerCase())||"spell".includes(v().toLowerCase()))}),ma(),Jt();var st=gi(),ct=$e(st);let ht;var vt=l(ct);{let w=kt(()=>(f(),i(()=>f().attacks?"Expand":"Collapse")));Da(vt,{title:"Attacks & Spells",get collapsed(){return f(),i(()=>f().attacks)},get ariaLabel(){return e(w)},onToggle:()=>sa.update(q=>({...q,attacks:!q.attacks}))})}var at=a(vt,2);{var At=w=>{var q=mi(),_=$e(q);{var H=Q=>{var d=hr(),He=l(d),ge=a(He,2);{var U=be=>{var te=br();j("click",te,ye),o(be,te)};g(ge,be=>{t(),i(()=>t().attacks.length>0)&&be(U)})}s(d),j("click",He,G),o(Q,d)};g(_,Q=>{p()&&Q(H)})}var V=a(_,2),re=l(V);St(re,1,()=>e(b),Q=>Q.id,(Q,d,He)=>{var ge=si(),U=l(ge),be=l(U);{var te=ve=>{var ie=_r();we(ie),Ee(ie,()=>e(d).name,Ze=>(e(d).name=Ze,Wt(()=>(e(b),t(),v())))),o(ve,ie)},Be=ve=>{var ie=yr(),Ze=l(ie,!0);s(ie),A(()=>k(Ze,(e(d),i(()=>e(d).name||"(Unnamed Attack)")))),o(ve,ie)};g(be,ve=>{p()?ve(te):ve(Be,!1)})}var _e=a(be,2);{var qe=ve=>{var ie=xr();j("click",ie,()=>Pe(e(d).id)),o(ve,ie)};g(_e,ve=>{p()&&ve(qe)})}s(U);var Ge=a(U,2),Xe=l(Ge);{var it=ve=>{var ie=$r(),Ze=l(ie),_t=a(Ze,2);we(_t),s(ie),A(()=>{tt(Ze,"for",`attack-bonus-${e(d),i(()=>e(d).id)??""}`),tt(_t,"id",`attack-bonus-${e(d),i(()=>e(d).id)??""}`)}),Ee(_t,()=>e(d).bonus,Ft=>(e(d).bonus=Ft,Wt(()=>(e(b),t(),v())))),o(ve,ie)};g(Xe,ve=>{e(d),i(()=>e(d).bonus!==0&&e(d).bonus!==void 0)&&ve(it)})}var oe=a(Xe,2);{var L=ve=>{var ie=wr(),Ze=l(ie),_t=a(Ze,2);we(_t),s(ie),A(()=>{tt(Ze,"for",`attack-damage-${e(d),i(()=>e(d).id)??""}`),tt(_t,"id",`attack-damage-${e(d),i(()=>e(d).id)??""}`)}),Ee(_t,()=>e(d).damage,Ft=>(e(d).damage=Ft,Wt(()=>(e(b),t(),v())))),o(ve,ie)};g(oe,ve=>{e(d),i(()=>e(d).damage&&e(d).damage.trim()!=="")&&ve(L)})}var O=a(oe,2),W=l(O),le=a(W,2);we(le),s(O),s(Ge);var Me=a(Ge,2);{var Ue=ve=>{var ie=bt(),Ze=$e(ie);{var _t=yt=>{var M=kr();o(yt,M)},Ft=yt=>{const M=kt(()=>(e(d),i(()=>h(e(d).spellRef))));var pt=bt(),Xt=$e(pt);{var da=D=>{const ce=kt(()=>(N(Ka),N(e(M)),i(()=>Ka(e(M))))),Ke=kt(()=>(N(vs),N(e(M)),i(()=>vs(e(M)))));var ut=Or(),E=$e(ut),Ie=l(E),ze=a(l(Ie),2),xt=l(ze,!0);s(ze),s(Ie);var Ye=a(Ie,2);{var Ct=et=>{var Tt=Ar(),Zt=l(Tt),Kt=a(l(Zt));s(Zt);var fa=a(Zt,2),ia=a(l(fa));s(fa);var pa=a(fa,2),Gt=a(l(pa));s(pa);var ea=a(pa,2),qt=a(l(ea)),Ht=a(qt);{var la=Bt=>{var ta=It();A(()=>k(ta,`(${N(e(M)),i(()=>e(M).material)??""})`)),o(Bt,ta)};g(Ht,Bt=>{N(e(M)),i(()=>e(M).material)&&Bt(la)})}s(ea);var ga=a(ea,2),ba=a(l(ga),2);{var zt=Bt=>{var ta=It("Concentration,");o(Bt,ta)};g(ba,Bt=>{N(e(M)),i(()=>e(M).concentration)&&Bt(zt)})}var lt=a(ba,1,!0);s(ga);var nt=a(ga,2),wt=a(l(nt));s(nt);var Pt=a(nt,2);{var Vt=Bt=>{var ta=Sr(),Ra=a(l(ta));s(ta),A(()=>k(Ra,` ${N(e(M)),i(()=>e(M).higherLevelSlot)??""}`)),o(Bt,ta)};g(Pt,Bt=>{N(e(M)),i(()=>e(M).higherLevelSlot)&&Bt(Vt)})}var na=a(Pt,2);{var ra=Bt=>{var ta=Lr(),Ra=$e(ta);{var es=oa=>{var ha=Cr();o(oa,ha)};g(Ra,oa=>{e(d),N(e(M)),i(()=>e(d).racialTraitName==="Githyanki Psionics"&&e(M).name==="Mage Hand")&&oa(es)})}var ts=a(Ra,2);{var $a=oa=>{var ha=Dr(),Ba=a(l(ha));s(ha),A(()=>k(Ba,` ${e(d),i(()=>e(d).racialTraitName)??""}`)),o(oa,ha)};g(ts,oa=>{e(d),i(()=>e(d).racialTraitName)&&oa($a)})}o(Bt,ta)};g(na,Bt=>{e(d),i(()=>e(d).source==="racial")&&Bt(ra)})}s(Tt),A(Bt=>{k(Kt,` ${N(e(M)),i(()=>e(M).level)??""}`),k(ia,` ${N(e(M)),i(()=>e(M).castingTime||e(M).actionType)??""}`),k(Gt,` ${N(e(M)),i(()=>e(M).range)??""}`),k(qt,` ${Bt??""}`),k(lt,(N(e(M)),i(()=>e(M).duration))),k(wt,` ${N(e(M)),i(()=>e(M).description)??""}`)},[()=>(N(e(M)),i(()=>e(M).components.join(", ")))]),o(et,Tt)};g(Ye,et=>{e(z),e(d),i(()=>!e(z)[e(d).id])&&et(Ct)})}s(E);var Ne=a(E,2);{var mt=et=>{var Tt=Mr(),Zt=l(Tt),Kt=l(Zt);we(Kt);var fa=a(Kt),ia=a(fa);{var pa=Ht=>{var la=jr(),ga=l(la);s(la),A(ba=>k(ga,`(Spell Save DC: ${ba??""})`),[()=>(N(ms),t(),i(()=>ms(t(),t().abilities)))]),o(Ht,la)};g(ia,Ht=>{t(),i(()=>t().class)&&Ht(pa)})}var Gt=a(ia,2);{var ea=Ht=>{var la=Rr();o(Ht,la)},qt=Ht=>{var la=bt(),ga=$e(la);{var ba=zt=>{var lt=Br();o(zt,lt)};g(ga,zt=>{e(d),N(e(ce)),i(()=>e(d).targetSucceededSave&&e(ce).noDamageOnSave)&&zt(ba)},!0)}o(Ht,la)};g(Gt,Ht=>{e(d),N(e(ce)),i(()=>e(d).targetSucceededSave&&e(ce).halfDamageOnSave)?Ht(ea):Ht(qt,!1)})}s(Zt),s(Tt),A(Ht=>k(fa,` Target succeeded on ${Ht??""} save `),[()=>(N(e(ce)),i(()=>e(ce).ability.charAt(0).toUpperCase()+e(ce).ability.slice(1)))]),Aa(Kt,()=>e(d).targetSucceededSave,Ht=>(e(d).targetSucceededSave=Ht,Wt(()=>(e(b),t(),v())))),o(et,Tt)};g(Ne,et=>{e(ce)&&et(mt)})}var Mt=a(Ne,2);{var Ot=et=>{var Tt=Pr(),Zt=l(Tt),Kt=l(Zt);we(Kt);var fa=a(Kt,2);{var ia=Gt=>{const ea=kt(()=>(e(d),N(e(M)),i(()=>fe(e(d),e(M)))));var qt=Tr(),Ht=l(qt);s(qt),A(()=>k(Ht,`(${N(e(Ke)),i(()=>e(Ke).alternateDamage)??""}, total: ${e(ea)??""})`)),o(Gt,qt)},pa=Gt=>{var ea=Fr(),qt=l(ea);s(ea),A(()=>k(qt,`(${N(e(Ke)),i(()=>e(Ke).baseDamage)??""})`)),o(Gt,ea)};g(fa,Gt=>{e(d),i(()=>e(d).targetIsDamaged)?Gt(ia):Gt(pa,!1)})}s(Zt),s(Tt),Aa(Kt,()=>e(d).targetIsDamaged,Gt=>(e(d).targetIsDamaged=Gt,Wt(()=>(e(b),t(),v())))),o(et,Tt)};g(Mt,et=>{e(Ke)&&et(Ot)})}var Rt=a(Mt,2);{var gt=et=>{const Tt=kt(()=>(N(e(M)),i(()=>ue(e(M)))));var Zt=bt(),Kt=$e(Zt);{var fa=ia=>{var pa=Nr(),Gt=$e(pa),ea=l(Gt),qt=a(ea,2);A(()=>{e(d),Wt(()=>{e(Tt)})}),St(qt,5,()=>e(Tt),Lt,(zt,lt)=>{var nt=Ir(),wt=l(nt);s(nt);var Pt={};A(()=>{k(wt,`Level ${e(lt)??""}`),Pt!==(Pt=e(lt))&&(nt.value=(nt.__value=e(lt))??"")}),o(zt,nt)}),s(qt);var Ht=a(qt,2);{var la=zt=>{const lt=kt(()=>(e(d),N(e(M)),i(()=>fe(e(d),e(M)))));var nt=Er(),wt=l(nt);{var Pt=ra=>{var Bt=It("Healing");o(ra,Bt)},Vt=ra=>{var Bt=It("Damage");o(ra,Bt)};g(wt,ra=>{N(e(M)),i(()=>me(e(M)))?ra(Pt):ra(Vt,!1)})}var na=a(wt);s(nt),A(()=>k(na,` ${e(lt)??""}`)),o(zt,nt)};g(Ht,zt=>{e(d),N(e(M)),i(()=>e(d).castAtLevel&&e(d).castAtLevel>e(M).level)&&zt(la)})}s(Gt);var ga=a(Gt,2);{var ba=zt=>{var lt=Ur(),nt=l(lt),wt=l(nt);we(wt);var Pt=a(wt,2);{var Vt=na=>{const ra=kt(()=>(e(d),N(e(M)),i(()=>fe(e(d),e(M)))));var Bt=Hr(),ta=l(Bt);s(Bt),A(()=>k(ta,`(+1d8, total: ${e(ra)??""})`)),o(na,Bt)};g(Pt,na=>{e(d),i(()=>e(d).targetIsFiendOrUndead)&&na(Vt)})}s(nt),s(lt),Aa(wt,()=>e(d).targetIsFiendOrUndead,na=>(e(d).targetIsFiendOrUndead=na,Wt(()=>(e(b),t(),v())))),o(zt,lt)};g(ga,zt=>{N(e(M)),i(()=>e(M).description.includes("Fiend or an Undead"))&&zt(ba)})}A(()=>{tt(ea,"for",`castLevel-${e(d),i(()=>e(d).id)??""}`),tt(qt,"id",`castLevel-${e(d),i(()=>e(d).id)??""}`)}),Na(qt,()=>e(d).castAtLevel,zt=>(e(d).castAtLevel=zt,Wt(()=>(e(b),t(),v())))),o(ia,pa)};g(Kt,ia=>{N(e(Tt)),e(X),e(d),i(()=>e(Tt).length>0&&!e(X)[e(d).id])&&ia(fa)})}o(et,Zt)};g(Rt,et=>{N(e(M)),i(()=>e(M).higherLevelSlot&&e(M).level>0)&&et(gt)})}A(()=>{tt(ze,"aria-label",(e(z),e(d),i(()=>e(z)[e(d).id]?"Expand":"Collapse"))),k(xt,(e(z),e(d),i(()=>e(z)[e(d).id]?"‚ñº":"‚ñ≤")))}),j("click",Ie,()=>ae(e(d).id)),j("keydown",Ie,et=>et.key==="Enter"&&ae(e(d).id)),o(D,ut)},ua=D=>{var ce=Gr();o(D,ce)};g(Xt,D=>{e(M)?D(da):D(ua,!1)})}o(yt,pt)};g(Ze,yt=>{e(x),i(()=>e(x).length===0)?yt(_t):yt(Ft,!1)})}o(ve,ie)};g(Me,ve=>{e(d),i(()=>e(d).spellRef)&&ve(Ue)})}var Te=a(Me,2);{var Le=ve=>{var ie=bt(),Ze=$e(ie);{var _t=Ft=>{var yt=qr(),M=l(yt),pt=a(M,2);ja(pt),s(yt),A(()=>{tt(M,"for",`attack-notes-${e(d),i(()=>e(d).id)??""}`),tt(pt,"id",`attack-notes-${e(d),i(()=>e(d).id)??""}`)}),Ee(pt,()=>e(d).notes,Xt=>(e(d).notes=Xt,Wt(()=>(e(b),t(),v())))),o(Ft,yt)};g(Ze,Ft=>{e(d),i(()=>e(d).notes&&e(d).notes.trim()!=="")&&Ft(_t)})}o(ve,ie)};g(Te,ve=>{e(d),i(()=>!e(d).spellRef)&&ve(Le)})}var rt=a(Te,2),dt=l(rt);{var Fe=ve=>{const ie=kt(()=>(e(d),i(()=>h(e(d).spellRef))));var Ze=bt(),_t=$e(Ze);{var Ft=yt=>{const M=kt(()=>(t(),e(d),i(()=>t().racialTraits&&t().racialTraits.uses[e(d).name])));var pt=ei(),Xt=$e(pt);{var da=Ie=>{var ze=zr(),xt=l(ze),Ye=l(xt);we(Ye);var Ct=a(Ye,2),Ne=l(Ct);s(Ct),s(xt),s(ze),A(()=>k(Ne,`(${N(e(M)),i(()=>e(M).currentUses)??""}/${N(e(M)),i(()=>e(M).maxUses)??""} uses left)`)),Aa(Ye,()=>e(X)[e(d).id],mt=>_a(X,e(X)[e(d).id]=mt)),j("change",Ye,()=>{n(X,{...e(X)})}),o(Ie,ze)};g(Xt,Ie=>{e(d),N(e(M)),i(()=>e(d).source==="racial"&&e(M))&&Ie(da)})}var ua=a(Xt,2);{var D=Ie=>{var ze=bt(),xt=$e(ze);{var Ye=Ne=>{var mt=bt(),Mt=$e(mt);{var Ot=gt=>{var et=Wr();j("click",et,()=>B(e(d),!1)),o(gt,et)},Rt=gt=>{var et=Kr();o(gt,et)};g(Mt,gt=>{t(),N(e(ie)),i(()=>t().classFeatures&&t().classFeatures.spellSlotsByLevel&&t().classFeatures.spellSlotsByLevel[e(ie).level]?.some(et=>!et))?gt(Ot):gt(Rt,!1)})}o(Ne,mt)},Ct=Ne=>{var mt=bt(),Mt=$e(mt);{var Ot=gt=>{var et=Vr();j("click",et,()=>B(e(d),!0)),o(gt,et)},Rt=gt=>{var et=Jr();o(gt,et)};g(Mt,gt=>{N(e(M)),i(()=>e(M)&&e(M).currentUses>0)?gt(Ot):gt(Rt,!1)})}o(Ne,mt)};g(xt,Ne=>{e(X),e(d),i(()=>!e(X)[e(d).id])?Ne(Ye):Ne(Ct,!1)})}o(Ie,ze)};g(ua,Ie=>{N(La),N(e(ie)),i(()=>La(e(ie)))&&Ie(D)})}var ce=a(ua,2);{var Ke=Ie=>{var ze=bt(),xt=$e(ze);{var Ye=Ne=>{var mt=Yr(),Mt=l(mt),Ot=l(Mt),Rt=l(Ot);we(Rt),Rt.value=Rt.__value="self",aa(),s(Ot);var gt=a(Ot,2),et=l(gt);we(et),et.value=et.__value="other",aa(),s(gt),s(Mt);var Tt=a(Mt,2),Zt=l(Tt);s(Tt),s(mt),A(()=>{tt(Rt,"name",`target-${e(d),i(()=>e(d).id)??""}`),tt(et,"name",`target-${e(d),i(()=>e(d).id)??""}`),k(Zt,`Cast ${N(e(ie)),i(()=>e(ie).name)??""}`)}),Cs(P,[He],Rt,()=>e(R)[e(d).id],Kt=>_a(R,e(R)[e(d).id]=Kt)),Cs(P,[He],et,()=>e(R)[e(d).id],Kt=>_a(R,e(R)[e(d).id]=Kt)),j("click",Tt,()=>Je(e(d),e(R)[e(d).id])),o(Ne,mt)},Ct=Ne=>{var mt=Qr();j("click",mt,()=>Je(e(d),"self")),o(Ne,mt)};g(xt,Ne=>{N(e(ie)),i(()=>We(e(ie).name))?Ne(Ye):Ne(Ct,!1)})}o(Ie,ze)};g(ce,Ie=>{N(La),N(e(ie)),N(Va),i(()=>!La(e(ie))&&Va(e(ie)))&&Ie(Ke)})}var ut=a(ce,2);{var E=Ie=>{var ze=bt(),xt=$e(ze);{var Ye=Ne=>{var mt=Xr(),Mt=l(mt);{var Ot=gt=>{var et=It("Roll Healing");o(gt,et)},Rt=gt=>{var et=It("Roll Damage");o(gt,et)};g(Mt,gt=>{N(e(ie)),i(()=>me(e(ie)))?gt(Ot):gt(Rt,!1)})}s(mt),A(gt=>Et(mt,1,`btn ${gt??""}`),[()=>(N(e(ie)),i(()=>me(e(ie))?"btn-success":"btn-secondary"))]),j("click",mt,()=>F(e(d))),o(Ne,mt)},Ct=Ne=>{var mt=Zr();j("click",mt,()=>Je(e(d),"self")),o(Ne,mt)};g(xt,Ne=>{e(d),i(()=>e(d).damage&&e(d).damage.trim()!=="")?Ne(Ye):Ne(Ct,!1)})}o(Ie,ze)};g(ut,Ie=>{N(La),N(e(ie)),N(Va),i(()=>!La(e(ie))&&!Va(e(ie)))&&Ie(E)})}o(yt,pt)};g(_t,yt=>{e(ie)&&yt(Ft)})}o(ve,Ze)};g(dt,ve=>{e(d),e(J),i(()=>e(d).spellRef&&e(J))&&ve(Fe)})}var je=a(dt,2);{var $t=ve=>{var ie=ai(),Ze=$e(ie),_t=a(Ze,2);{var Ft=yt=>{var M=ti();j("click",M,()=>F(e(d))),o(yt,M)};g(_t,yt=>{e(d),i(()=>e(d).damage&&e(d).damage.trim()!=="")&&yt(Ft)})}j("click",Ze,()=>B(e(d))),o(ve,ie)};g(je,ve=>{e(d),i(()=>!e(d).spellRef)&&ve($t)})}s(rt),s(ge),A(()=>{tt(W,"for",`attack-type-${e(d),i(()=>e(d).id)??""}`),tt(le,"id",`attack-type-${e(d),i(()=>e(d).id)??""}`)}),Ee(le,()=>e(d).damageType,ve=>(e(d).damageType=ve,Wt(()=>(e(b),t(),v())))),o(Q,ge)});var Se=a(re,2);{var Ce=Q=>{var d=li();o(Q,d)};g(Se,Q=>{t(),i(()=>t().attacks.length===0)&&Q(Ce)})}var Re=a(Se,2);{var ee=Q=>{var d=ri();o(Q,d)};g(Re,Q=>{e(b),t(),i(()=>e(b).length===0&&t().attacks.length>0)&&Q(ee)})}s(V);var S=a(V,2);{var Y=Q=>{var d=vi(),He=a(l(d),4);St(He,5,()=>e(y),Lt,(ge,U)=>{var be=ci(),te=l(be),Be=l(te),_e=l(Be,!0);s(Be);var qe=a(Be,2),Ge=l(qe);s(qe),s(te);var Xe=a(te,2),it=l(Xe,!0);s(Xe);var oe=a(Xe,2),L=l(oe);{var O=Te=>{var Le=ii(),rt=l(Le),dt=a(rt);{var Fe=je=>{var $t=It();A(()=>k($t,`per ${e(U),i(()=>e(U).restType)??""} rest`)),o(je,$t)};g(dt,je=>{e(U),i(()=>e(U).restType)&&je(Fe)})}s(Le),A(()=>k(rt,`${e(U),i(()=>e(U).currentUses??e(U).usesPerRest)??""}/${e(U),i(()=>e(U).usesPerRest)??""} uses `)),o(Te,Le)};g(L,Te=>{e(U),i(()=>e(U).usesPerRest)&&Te(O)})}var W=a(L,2);{var le=Te=>{var Le=ni();o(Te,Le)};g(W,Te=>{e(U),i(()=>e(U).requiresReaction)&&Te(le)})}var Me=a(W,2);{var Ue=Te=>{var Le=oi();A(()=>Le.disabled=(e(U),i(()=>e(U).currentUses===void 0||e(U).currentUses===0))),j("click",Le,()=>Z(e(U).conditionName,e(U).name)),o(Te,Le)};g(Me,Te=>{p(),e(U),i(()=>!p()&&e(U).usesPerRest)&&Te(Ue)})}s(oe),s(be),A(()=>{k(_e,(e(U),i(()=>e(U).name))),k(Ge,`(${e(U),i(()=>e(U).conditionName)??""})`),k(it,(e(U),i(()=>e(U).description)))}),o(ge,be)}),s(He),s(d),o(Q,d)};g(S,Q=>{e(y),i(()=>e(y).length>0)&&Q(Y)})}var xe=a(S,2),Oe=a(l(xe),4),Qe=a(Oe,2);{var ft=Q=>{var d=fi();St(d,5,()=>(t(),i(()=>t().activeStates)),Lt,(He,ge,U)=>{var be=ui(),te=l(be),Be=l(te);we(Be);var _e=a(Be,2);{var qe=je=>{var $t=di();j("click",$t,()=>ke(U)),o(je,$t)};g(_e,je=>{p()&&je(qe)})}s(te);var Ge=a(te,2),Xe=l(Ge),it=l(Xe);tt(it,"for",`state-attack-bonus-${U}`);var oe=a(it,2);we(oe),tt(oe,"id",`state-attack-bonus-${U}`),s(Xe);var L=a(Xe,2),O=l(L);tt(O,"for",`state-damage-bonus-${U}`);var W=a(O,2);we(W),tt(W,"id",`state-damage-bonus-${U}`),s(L);var le=a(L,2),Me=l(le);tt(Me,"for",`state-target-${U}`);var Ue=a(Me,2);A(()=>{e(ge),Wt(()=>{})}),tt(Ue,"id",`state-target-${U}`);var Te=l(Ue);Te.value=Te.__value="self";var Le=a(Te);Le.value=Le.__value="other",s(Ue),s(le),s(Ge);var rt=a(Ge,2),dt=l(rt);tt(dt,"for",`state-desc-${U}`);var Fe=a(dt,2);we(Fe),tt(Fe,"id",`state-desc-${U}`),s(rt),s(be),Ee(Be,()=>e(ge).name,je=>(e(ge).name=je,Wt(()=>t()),Pa(m,"$character"))),Ee(oe,()=>e(ge).attackBonus,je=>(e(ge).attackBonus=je,Wt(()=>t()),Pa(m,"$character"))),Ee(W,()=>e(ge).damageBonus,je=>(e(ge).damageBonus=je,Wt(()=>t()),Pa(m,"$character"))),Na(Ue,()=>e(ge).target,je=>(e(ge).target=je,Wt(()=>t()),Pa(m,"$character"))),Ee(Fe,()=>e(ge).description,je=>(e(ge).description=je,Wt(()=>t()),Pa(m,"$character"))),o(He,be)}),s(d),o(Q,d)},De=Q=>{var d=pi();o(Q,d)};g(Qe,Q=>{t(),i(()=>t().activeStates&&t().activeStates.length>0)?Q(ft):Q(De,!1)})}s(xe),j("click",Oe,pe),o(w,q)};g(at,w=>{f(),i(()=>!f().attacks)&&w(At)})}s(ct);var jt=a(ct,2);dr(jt,{get show(){return e(T)},get attacks(){return t(),i(()=>t().attacks)},onSave:Ae,onCancel:he}),A(()=>ht=Et(ct,1,"attacks svelte-14o91c5",null,ht,{hidden:!e(K)})),o(r,st),Qt(),$()}var hi=u('<span class="slot-checkbox-x svelte-serp1j">&#8212;</span>'),_i=u('<label><input type="checkbox" class="slot-checkbox-input svelte-serp1j"/> <span><!></span></label>');function Bs(r,c){Yt(c,!1);const t=()=>ot(ka,"$isEditMode",v),[v,f]=va();let p=Dt(c,"checked",8,!1),m=Dt(c,"disabled",8,!1),$=Dt(c,"className",8,""),y=Dt(c,"index",8,void 0),b=Dt(c,"ariaLabel",8,void 0);const K=Ca();function P(T){K("change",{checked:T.currentTarget.checked,index:y()})}Jt();var X=_i(),Z=l(X);we(Z);var ne=a(Z,2),z=l(ne);{var R=T=>{var ae=hi();o(T,ae)};g(z,T=>{p()&&T(R)})}s(ne),s(X),A(()=>{Et(X,1,"slot-checkbox-label "+$()+(t()?"":" not-editable"),"svelte-serp1j"),Hs(Z,p()),Z.disabled=m()||!t(),tt(Z,"aria-label",b()),tt(Z,"tabindex",t()?0:-1),Et(ne,1,`slot-checkbox-custom ${p()?"used":""} ${t()?"":"readonly"}`,"svelte-serp1j")}),j("change",Z,P),o(r,X),Qt(),f()}var yi=u('<span style="color:#007bff; margin-left:0.5em;"> </span>'),xi=u("<li><strong> </strong> <!></li>"),$i=u('<div class="racial-traits"><h4>Racial Traits</h4> <ul></ul></div>'),wi=u("<li> </li>"),ki=u('<div class="racial-resistances"><h4>Racial Resistances</h4> <ul></ul></div>'),Si=u("<!> <!>",1);function Ci(r,c){Yt(c,!1);const t=()=>ot(de,"$character",v),[v,f]=va(),p=C(),m=C();let $=C(),y=C();Sa(()=>{t().race&&t().level&&($s(),ls(),n($,t().race),n(y,t().level))}),Ve(()=>(t(),e($),e(y),ls),()=>{t().race&&t().level&&(t().race!==e($)||t().level!==e(y))&&($s(),ls(),n($,t().race),n(y,t().level))}),Ve(()=>(t(),Ja),()=>{n(p,(()=>{const ne=t().activeStates?t().activeStates.filter(T=>T.name&&T.name.toLowerCase().includes("racial")).flatMap(T=>T.resistances||[]):[],z=Ja(t().race||""),R=z?z.traits.flatMap(T=>T.resistances||[]):[];return Array.from(new Set([...ne,...R]))})())}),Ve(()=>t(),()=>{n(m,(()=>{const ne=Ja(t().race||"");return ne?ne.traits:[]})())}),ma(),Jt();var b=Si(),K=$e(b);{var P=ne=>{var z=$i(),R=a(l(z),2);St(R,5,()=>e(m),Lt,(T,ae)=>{var me=xi(),We=l(me),G=l(We);s(We);var Pe=a(We),ye=a(Pe);{var he=Ae=>{var B=yi(),F=l(B);s(B),A(x=>k(F,`(Resistances: ${x??""})`),[()=>(e(ae),i(()=>e(ae).resistances.map(x=>x.charAt(0).toUpperCase()+x.slice(1)).join(", ")))]),o(Ae,B)};g(ye,Ae=>{e(ae),i(()=>e(ae).resistances&&e(ae).resistances.length>0)&&Ae(he)})}s(me),A(()=>{k(G,`${e(ae),i(()=>e(ae).name)??""}:`),k(Pe,` ${e(ae),i(()=>e(ae).description)??""} `)}),o(T,me)}),s(R),s(z),o(ne,z)};g(K,ne=>{e(m),i(()=>e(m).length>0)&&ne(P)})}var X=a(K,2);{var Z=ne=>{var z=ki(),R=a(l(z),2);St(R,5,()=>e(p),Lt,(T,ae)=>{var me=wi(),We=l(me,!0);s(me),A(G=>k(We,G),[()=>(e(ae),i(()=>e(ae).charAt(0).toUpperCase()+e(ae).slice(1)))]),o(T,me)}),s(R),s(z),o(ne,z)};g(X,ne=>{e(p),i(()=>e(p).length>0)&&ne(Z)})}o(r,b),Qt(),f()}var Di=u('<p class="no-features svelte-1kpvv0n">Select a class to see available features</p>'),Li=u('<p class="no-features svelte-1kpvv0n">No class features available at this level</p>'),Ai=u('<div class="spell-slots svelte-1kpvv0n"><label class="svelte-1kpvv0n"> </label> <div class="slots-tracker svelte-1kpvv0n"></div></div>'),ji=u('<div class="all-spell-slots"></div>'),Ri=u('<div class="feature-box spellcasting svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"> </h3> <div class="spell-stats svelte-1kpvv0n"><div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Spell Save DC</label> <div class="spell-value svelte-1kpvv0n"> </div></div> <div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <div class="spell-value svelte-1kpvv0n"> </div></div></div> <!> <div class="prepared-spells svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <textarea placeholder="List your prepared spells..." class="svelte-1kpvv0n"></textarea></div></div>'),Bi=u('<p class="unlimited svelte-1kpvv0n">Unlimited Uses</p>'),Mi=u('<div class="slots-tracker svelte-1kpvv0n"></div> <div class="uses-actions-row"><button class="btn btn-primary use-enabled"> </button></div> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div>',1),Ti=u('<div class="uses-tracker svelte-1kpvv0n"><!></div>'),Fi=u('<div class="pool-tracker svelte-1kpvv0n"><input type="number" min="0" class="pool-input svelte-1kpvv0n"/> <span> </span> <button class="btn-small svelte-1kpvv0n"> </button></div>'),Pi=u('<p class="no-uses svelte-1kpvv0n">No Channel Divinity uses remaining</p>'),Ii=u('<div class="channel-divinity-option svelte-1kpvv0n"><button class="btn btn-primary use-enabled svelte-1kpvv0n">Use Channel Divinity</button> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div> <!></div>'),Ei=u('<div class="feature-box svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"><!> </h3> <p class="feature-description svelte-1kpvv0n"> </p> <!></div>'),Hi=u('<div class="features-grid svelte-1kpvv0n"><!> <!></div>'),Ui=u("<!> <!>",1),Ni=u("<section><!> <!></section>");function Oi(r,c){Yt(c,!1);const t=()=>ot(de,"$character",m),v=()=>ot(Xa,"$abilityModifiers",m),f=()=>ot(xa,"$searchFilter",m),p=()=>ot(sa,"$collapsedStates",m),[m,$]=va(),y=C(),b=C(),K=C(),P=C(),X=C(),Z=C(),ne=C();let z=C(0),R=C(0);function T(h,I){de.update(se=>(se.classFeatures.features[h]=I,se))}function ae(){de.update(h=>(h.classFeatures.spellSlotsByLevel||(h.classFeatures.spellSlotsByLevel={}),e(P).forEach(({level:I,slots:se})=>{h.classFeatures.spellSlotsByLevel[I]||(h.classFeatures.spellSlotsByLevel[I]=Array(se).fill(!1))}),h))}function me(h){if(typeof h.maxUses=="function"){if((h.name==="Divine Sense"||h.name==="War Priest")&&e(y)?.spellcastingAbility){const I=v()[e(y).spellcastingAbility];return h.maxUses(t().level,I)}return h.maxUses(t().level)}return h.maxUses||0}function We(h,I){de.update(se=>((!se.classFeatures.features[h]||!Array.isArray(se.classFeatures.features[h])||se.classFeatures.features[h].length!==I)&&(se.classFeatures.features[h]=Array(I).fill(!1)),se))}Ks(()=>{e(Z)&&t()&&t().classFeatures&&t().classFeatures.features&&e(Z).forEach(h=>{if(h.type==="uses"){const I=h.name.replace(/\s+/g,""),se=me(h),fe=t().classFeatures.features[I];(!Array.isArray(fe)||fe.length!==se)&&We(I,se)}})});function G(h){return typeof h.maxPool=="function"?h.maxPool(t().level):h.maxPool||0}function Pe(h){return typeof h.description=="function"?h.description(t().level):h.description}function ye(){const h="ChannelDivinity";de.update(I=>{const se=I.classFeatures.features[h];return typeof se=="number"&&se>0&&(I.classFeatures.features[h]=se-1),I})}function he(){sa.update(h=>({...h,classFeatures:!h.classFeatures}))}Ve(()=>(t(),ca),()=>{n(y,t().class?ca(t().class):null)}),Ve(()=>(t(),Ta),()=>{n(b,t().class?Ta(t().class,t().level,t().subclass):[])}),Ve(()=>(t(),As),()=>{n(K,t().class?As(t().class,t().level):0)}),Ve(()=>(e(y),t()),()=>{n(P,(()=>{if(!e(y)?.spellcaster)return[];const h=t().level,I=[];return h>=1&&I.push({level:1,slots:Math.min(4,2+Math.floor(h/3))}),h>=3&&I.push({level:2,slots:Math.min(3,2+Math.floor((h-3)/4))}),h>=5&&I.push({level:3,slots:Math.min(3,2+Math.floor((h-5)/5))}),h>=7&&I.push({level:4,slots:Math.min(3,1+Math.floor((h-7)/6))}),h>=9&&I.push({level:5,slots:Math.min(2,1+Math.floor((h-9)/8))}),h>=11&&I.push({level:6,slots:1}),h>=13&&I.push({level:7,slots:1}),h>=15&&I.push({level:8,slots:1}),h>=17&&I.push({level:9,slots:1}),I})())}),Ve(()=>(e(y),v(),t(),js),()=>{if(e(y)?.spellcaster&&e(y).spellcastingAbility){const h=v()[e(y).spellcastingAbility];n(z,Dl(t().class,h,t().proficiencyBonus)||0),n(R,js(t().class,t().level,h))}}),Ve(()=>(t(),e(y),e(P)),()=>{t().class&&e(y)?.spellcaster&&e(P).length>0&&ae()}),Ve(()=>t(),()=>{n(X,(()=>{const I=t().classFeatures.features["ChannelDivinity"];return typeof I=="number"?I:0})())}),Ve(()=>(e(b),f()),()=>{n(Z,e(b).filter(h=>{if(!f())return!0;const I=f().toLowerCase();return h.name.toLowerCase().includes(I)||Pe(h).toLowerCase().includes(I)}))}),Ve(()=>(f(),t(),e(Z)),()=>{n(ne,!f()||t().class||"class features".includes(f().toLowerCase())||"spellcasting".includes(f().toLowerCase())||e(Z).length>0)}),ma(),Jt();var Ae=Ni();let B;var F=l(Ae);{let h=kt(()=>(p(),i(()=>p().classFeatures?"Expand":"Collapse")));Da(F,{title:"Class Features",get collapsed(){return p(),i(()=>p().classFeatures)},get ariaLabel(){return e(h)},onToggle:he})}var x=a(F,2);{var J=h=>{var I=Ui(),se=$e(I);Ci(se,{});var fe=a(se,2);{var ue=ke=>{var Je=Di();o(ke,Je)},pe=ke=>{var Je=bt(),st=$e(Je);{var ct=vt=>{var at=Li();o(vt,at)},ht=vt=>{var at=Hi(),At=l(at);{var jt=q=>{var _=Ri(),H=l(_),V=l(H);s(H);var re=a(H,2),Se=l(re),Ce=a(l(Se),2),Re=l(Ce,!0);s(Ce),s(Se);var ee=a(Se,2),S=a(l(ee),2),Y=l(S,!0);s(S),s(ee),s(re);var xe=a(re,2);{var Oe=De=>{var Q=ji();St(Q,5,()=>e(P),Lt,(d,He)=>{let ge=()=>e(He).level,U=()=>e(He).slots;const be=kt(()=>(t(),ge(),U(),i(()=>t().classFeatures.spellSlotsByLevel?.[ge()]||Array(U()).fill(!1))));var te=Ai(),Be=l(te),_e=l(Be);s(Be);var qe=a(Be,2);St(qe,5,()=>e(be),Lt,(Ge,Xe,it)=>{{let oe=kt(()=>(N(e(be)),i(()=>e(be)[it]||!1)));Bs(Ge,{get checked(){return e(oe)},$$events:{change:L=>{de.update(O=>(O.classFeatures.spellSlotsByLevel||(O.classFeatures.spellSlotsByLevel={}),O.classFeatures.spellSlotsByLevel[ge()]||(O.classFeatures.spellSlotsByLevel[ge()]=Array(U()).fill(!1)),O.classFeatures.spellSlotsByLevel[ge()][it]=L.detail.checked,O))}}})}}),s(qe),s(te),A(()=>k(_e,`${ge()===1?"1st":ge()===2?"2nd":ge()===3?"3rd":`${ge()}th`} Level Spell Slots`)),o(d,te)}),s(Q),o(De,Q)};g(xe,De=>{e(P),i(()=>e(P).length>0)&&De(Oe)})}var Qe=a(xe,2),ft=a(l(Qe),2);ja(ft),s(Qe),s(_),A(De=>{k(V,`Spellcasting (${De??""})`),k(Re,e(z)),k(Y,e(R))},[()=>(e(y),i(()=>e(y).spellcastingAbility?.toUpperCase()))]),Ee(ft,()=>t().classFeatures.preparedSpells,De=>Ut(de,i(t).classFeatures.preparedSpells=De,i(t))),o(q,_)};g(At,q=>{e(y),i(()=>e(y)?.spellcaster)&&q(jt)})}var w=a(At,2);St(w,1,()=>e(Z),Lt,(q,_)=>{const H=kt(()=>(e(_),i(()=>e(_).name.replace(/\s+/g,"")))),V=kt(()=>(t(),N(e(H)),i(()=>t().classFeatures.features[e(H)]))),re=kt(()=>typeof e(V)=="number");var Se=Ei(),Ce=l(Se),Re=l(Ce);{var ee=De=>{var Q=It("Channel Divinity:");o(De,Q)};g(Re,De=>{e(_),i(()=>e(_).type==="channelDivinity")&&De(ee)})}var S=a(Re);s(Ce);var Y=a(Ce,2),xe=l(Y,!0);s(Y);var Oe=a(Y,2);{var Qe=De=>{const Q=kt(()=>(e(_),i(()=>me(e(_))))),d=kt(()=>(N(e(V)),N(e(Q)),i(()=>Array.isArray(e(V))?e(V):Array(e(Q)).fill(!1))));var He=Ti(),ge=l(He);{var U=te=>{var Be=Bi();o(te,Be)},be=te=>{var Be=Mi(),_e=$e(Be);St(_e,5,()=>e(d),Lt,(O,W,le)=>{Bs(O,{get checked(){return e(W)},index:le,$$events:{change:Me=>{de.update(Ue=>(Ue.classFeatures.features[e(H)]||(Ue.classFeatures.features[e(H)]=Array(e(Q)).fill(!1)),Ue.classFeatures.features[e(H)][le]=Me.detail.checked,Ue))}}})}),s(_e);var qe=a(_e,2),Ge=l(qe),Xe=l(Ge);s(Ge),s(qe);var it=a(qe,2),oe=l(it),L=l(oe);s(oe),s(it),A(O=>{Ge.disabled=O,k(Xe,`Use ${e(_),i(()=>e(_).name)??""}`),k(L,`Resets on ${e(_),i(()=>e(_).resetOn==="short"?"Short Rest":"Long Rest")??""}`)},[()=>(N(e(d)),i(()=>e(d).filter(O=>!O).length<=0))]),j("click",Ge,()=>{de.update(O=>{O.classFeatures.features[e(H)]||(O.classFeatures.features[e(H)]=Array(e(Q)).fill(!1));const W=O.classFeatures.features[e(H)],le=W.findIndex(Me=>!Me);return le!==-1&&(W[le]=!0),O})}),o(te,Be)};g(ge,te=>{e(Q)===1/0?te(U):te(be,!1)})}s(He),o(De,He)},ft=De=>{var Q=bt(),d=$e(Q);{var He=U=>{const be=kt(()=>(e(_),i(()=>G(e(_)))));var te=Fi(),Be=l(te);we(Be);var _e=a(Be,2),qe=l(_e);s(_e);var Ge=a(_e,2),Xe=l(Ge,!0);s(Ge),s(te),A(()=>{Ha(Be,e(re)&&e(V)!==void 0?e(V):e(be)),tt(Be,"max",e(be)),k(qe,`/ ${e(be)??""}`),k(Xe,(e(_),i(()=>e(_).resetOn==="short"?"Short Rest":"Long Rest")))}),j("input",Be,it=>{de.update(oe=>(oe.classFeatures.features[e(H)]=parseInt(it.currentTarget.value)||0,oe))}),j("click",Ge,()=>T(e(H),e(be))),o(U,te)},ge=U=>{var be=bt(),te=$e(be);{var Be=_e=>{var qe=Ii(),Ge=l(qe),Xe=a(Ge,2),it=l(Xe),oe=l(it);s(it),s(Xe);var L=a(Xe,2);{var O=W=>{var le=Pi();o(W,le)};g(L,W=>{e(X)<=0&&W(O)})}s(qe),A(()=>{Ge.disabled=e(X)<=0,k(oe,`Resets on ${e(_),i(()=>e(_).resetOn==="short"?"Short Rest":"Long Rest")??""}`)}),j("click",Ge,ye),o(_e,qe)};g(te,_e=>{e(_),i(()=>e(_).type==="channelDivinity")&&_e(Be)},!0)}o(U,be)};g(d,U=>{e(_),i(()=>e(_).type==="pool")?U(He):U(ge,!1)},!0)}o(De,Q)};g(Oe,De=>{e(_),i(()=>e(_).type==="uses")?De(Qe):De(ft,!1)})}s(Se),A(De=>{k(S,` ${e(_),i(()=>e(_).name)??""}`),k(xe,De)},[()=>(e(_),i(()=>Pe(e(_))))]),o(q,Se)}),s(at),o(vt,at)};g(st,vt=>{e(b),i(()=>e(b).length===0)?vt(ct):vt(ht,!1)},!0)}o(ke,Je)};g(fe,ke=>{t(),i(()=>!t().class)?ke(ue):ke(pe,!1)})}o(h,I)};g(x,h=>{p(),i(()=>!p().classFeatures)&&h(J)})}s(Ae),A(()=>B=Et(Ae,1,"class-features svelte-1kpvv0n",null,B,{hidden:!e(ne)})),o(r,Ae),Qt(),$()}var Gi=u('<textarea placeholder="Enter features, traits, and special abilities..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Equipment</h3> <textarea placeholder="List your equipment and inventory..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Notes</h3> <textarea placeholder="Additional notes..." class="svelte-wttn0l"></textarea>',1),qi=u("<section><!> <!></section>");function zi(r,c){Yt(c,!1);const t=()=>ot(xa,"$searchFilter",p),v=()=>ot(de,"$character",p),f=()=>ot(sa,"$collapsedStates",p),[p,m]=va(),$=C();function y(){sa.update(ne=>({...ne,notes:!ne.notes}))}Ve(()=>(t(),v()),()=>{n($,!t()||"features".includes(t().toLowerCase())||"traits".includes(t().toLowerCase())||"equipment".includes(t().toLowerCase())||"notes".includes(t().toLowerCase())||v().features.toLowerCase().includes(t().toLowerCase())||v().equipment.toLowerCase().includes(t().toLowerCase())||v().notes.toLowerCase().includes(t().toLowerCase()))}),ma(),Jt();var b=qi();let K;var P=l(b);{let ne=kt(()=>(f(),i(()=>f().notes?"Expand":"Collapse")));Da(P,{title:"Features & Traits",get collapsed(){return f(),i(()=>f().notes)},get ariaLabel(){return e(ne)},onToggle:y})}var X=a(P,2);{var Z=ne=>{var z=Gi(),R=$e(z);ja(R);var T=a(R,4);ja(T);var ae=a(T,4);ja(ae),Ee(R,()=>v().features,me=>Ut(de,i(v).features=me,i(v))),Ee(T,()=>v().equipment,me=>Ut(de,i(v).equipment=me,i(v))),Ee(ae,()=>v().notes,me=>Ut(de,i(v).notes=me,i(v))),o(ne,z)};g(X,ne=>{f(),i(()=>!f().notes)&&ne(Z)})}s(b),A(()=>K=Et(b,1,"notes svelte-wttn0l",null,K,{hidden:!e($)})),o(r,b),Qt(),m()}var Wi=u(" <!> <!> <!> <!> <!>",1),Ki=u('<div class="color-picker-section svelte-1r90jgp"><h3 class="svelte-1r90jgp">Dice Colors</h3> <div class="color-inputs svelte-1r90jgp"><div class="color-input-group svelte-1r90jgp"><label for="dice-color" class="svelte-1r90jgp">Dice Color</label> <input type="color" id="dice-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="label-color" class="svelte-1r90jgp">Label Color</label> <input type="color" id="label-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="desk-color" class="svelte-1r90jgp">Background Color</label> <input type="color" id="desk-color" class="svelte-1r90jgp"/></div></div></div>'),Vi=u('<div class="loading svelte-1r90jgp"><p class="svelte-1r90jgp">Loading 3D dice...</p></div>'),Ji=u('<div class="custom-dice-selector svelte-1r90jgp"><h3 class="svelte-1r90jgp">Choose Dice to Roll</h3> <div class="dice-inputs svelte-1r90jgp"><div class="dice-input-group svelte-1r90jgp"><label for="d4" class="svelte-1r90jgp">d4</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d4" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d6" class="svelte-1r90jgp">d6</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d6" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d8" class="svelte-1r90jgp">d8</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d8" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d10" class="svelte-1r90jgp">d10</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d10" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d12" class="svelte-1r90jgp">d12</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d12" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d20" class="svelte-1r90jgp">d20</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d20" min="0" max="10"/></div></div> <div class="dice-controls svelte-1r90jgp"><button class="btn btn-primary use-enabled svelte-1r90jgp"> </button> <button class="btn btn-secondary use-enabled svelte-1r90jgp">Reset</button></div></div>'),Yi=u('<h3 class="svelte-1r90jgp"> </h3>'),Qi=u('<h3 class="svelte-1r90jgp"> </h3>'),Xi=u('<h3 class="svelte-1r90jgp"> </h3>'),Zi=u('<h3 class="svelte-1r90jgp"> </h3>'),en=u('<span class="crit-badge svelte-1r90jgp">CRITICAL HIT!</span>'),tn=u('<span class="crit-badge crit-fail svelte-1r90jgp">CRITICAL MISS!</span>'),an=u('<div class="bonus-item svelte-1r90jgp"><span class="bonus-value svelte-1r90jgp"> </span> <span class="bonus-source svelte-1r90jgp"> </span></div>'),sn=u('<div class="bonus-breakdown svelte-1r90jgp"></div>'),ln=u('<p class="modifier-text svelte-1r90jgp"> </p>'),rn=u('<div class="svelte-1r90jgp"><em class="svelte-1r90jgp">No damage is dealt on a critical miss.</em></div>'),nn=u('<button class="btn btn-follow-up svelte-1r90jgp"> </button>'),on=u('<button class="btn btn-guided-strike svelte-1r90jgp">‚ö° Use Guided Strike (+10)</button>'),cn=u('<div class="follow-up-actions svelte-1r90jgp"><!> <!></div>'),vn=u('<div class="result-header svelte-1r90jgp"><!> <!> <!></div> <div class="result-total svelte-1r90jgp"> </div> <div class="result-details svelte-1r90jgp"><!></div> <!> <!>',1),dn=u('<div role="button" tabindex="-1"><div class="modal-content svelte-1r90jgp" role="dialog" tabindex="0"><div class="modal-header svelte-1r90jgp"><h2 class="svelte-1r90jgp"><!></h2> <div class="header-buttons svelte-1r90jgp"><button class="color-btn svelte-1r90jgp" title="Customize dice colors">üé®</button> <button class="close-btn svelte-1r90jgp">√ó</button></div></div> <!> <!> <div class="dice-main-area svelte-1r90jgp"><div class="dice-container svelte-1r90jgp"></div> <!></div> <div><!></div></div></div>');function un(r,c){Yt(c,!1);const t=()=>ot(de,"$character",v),[v,f]=va(),p=C(),m=C(),$=C(),y=Ca();let b=Dt(c,"notation",12,""),K=Dt(c,"visible",8,!1),P=Dt(c,"damageNotation",12,""),X=Dt(c,"damageType",8,""),Z=Dt(c,"attackName",12,""),ne=Dt(c,"applyHalfDamage",8,!1),z=Dt(c,"bonusBreakdown",28,()=>[]),R=Dt(c,"rollType",12,"other"),T=null,ae=C(void 0),me=C(!1),We=C(""),G=C(null);function Pe(){return e(G)?.resultTotal??null}function ye(L,O,W){const le=[];if(!L||!L.result)return le;const Me=O.match(/([+-]?\d*d\d+|[+-]?\d+)/g)||[];let Ue=0;const Te=new Set;for(const Le of Me){const rt=Le.trim();if(!rt)continue;const dt=rt.match(/([+-]?)(\d*)d(\d+)/);if(dt){const Fe=parseInt(dt[2]||"1"),je=`${Fe}d${dt[3]}`,$t=W.findIndex((Ze,_t)=>!Te.has(_t)&&typeof Ze.value=="string"&&Ze.value===je),ve=[];for(let Ze=0;Ze<Fe&&Ue<L.result.length;Ze++)ve.push(L.result[Ue++]);const ie=$t>=0?W[$t].source:"base die";$t>=0&&Te.add($t);for(const Ze of ve)le.push({display:`${Ze}`,source:ie})}}for(let Le=0;Le<W.length;Le++)if(!Te.has(Le)&&typeof W[Le].value=="number"){const rt=W[Le].value;le.push({display:rt>=0?`+${rt}`:`${rt}`,source:W[Le].source})}return le}let he=C(0),Ae=C(0),B=C(0),F=C(0),x=C(0),J=C(0),h=C(0),I=C([]),se=C(!1),fe=C(!1),ue=C(!1),pe=C("#051e0a"),ke=C("#ffffff"),Je=C("#3a2004"),st=C(!1);function ct(L){return L.length===9&&L.startsWith("#")?L.substring(0,7):L}function ht(L,O="ff"){return L.length===7&&L.startsWith("#")?L+O:L}function vt(){if(window.DICE&&e(ae))try{T&&e(ae)&&_a(ae,e(ae).innerHTML="");const L=e(ae).clientWidth||500,O=e(ae).clientHeight||300;T=new window.DICE.dice_box(e(ae),{w:L,h:O}),n(me,!0)}catch(L){console.error("Error initializing dice box:",L)}}Sa(()=>{const L=le=>new Promise((Me,Ue)=>{if(document.querySelector(`script[src="${le}"]`)){Me(null);return}const Le=document.createElement("script");Le.src=le,Le.onload=()=>{Me(null)},Le.onerror=()=>{console.error(`Failed to load: ${le}`),Ue(new Error(`Failed to load ${le}`))},document.head.appendChild(Le)});setTimeout(()=>{L(`${Ia}/libs/three.min.js`).then(()=>L(`${Ia}/libs/cannon.min.js`)).then(()=>L(`${Ia}/libs/teal.js`)).then(()=>L(`${Ia}/dice.js`)).then(()=>{if(window.DICE){const le=window.DICE.getColors();n(pe,ct(le.dice_color)),n(ke,ct(le.label_color)),n(Je,ct(le.desk_color))}vt()}).catch(le=>{console.error("Failed to load dice libraries:",le)})},100);const O=()=>{e(me)&&vt()},W=le=>{K()&&le.key==="Escape"&&re()};return window.addEventListener("resize",O),window.addEventListener("keydown",W),()=>{window.removeEventListener("resize",O),window.removeEventListener("keydown",W)}});function at(L,O="other"){if(!T||!e(me))return;n(G,null),n(I,[]),n(se,!1),n(fe,!1),O==="damage"&&z([]),R(O),n(ue,!1),T.diceToRoll=L;const W=Me=>null,le=Me=>{let Ue=Me.resultTotal,Te=Me.resultString;if(ne()&&(Ue=Math.floor(Ue/2),Te=Te+" (halved)"),n(G,{...Me,resultTotal:Ue,resultString:Te}),console.log("Final roll result:",e(G)),console.log({type:O}),O==="attack"&&Me.result&&Me.result.length>0){const Le=Me.result[0];n(se,Le===20),n(fe,Le===1)}if(n(I,[]),console.log("Setting up follow-up actions. Type:",O,"damageNotation:",P(),"isCriticalSuccess:",e(se),"isCriticalFail:",e(fe)),O==="attack"&&P())if(e(se)){const Le=w(P());e(I).push({label:`Roll Critical Damage (${Le})`,notation:Le})}else e(fe)||e(I).push({label:`Roll Damage (${P()})`,notation:P()})};T.start_throw(W,le)}function At(){const L=[];e(he)>0&&L.push(`${e(he)}d4`),e(Ae)>0&&L.push(`${e(Ae)}d6`),e(B)>0&&L.push(`${e(B)}d8`),e(F)>0&&L.push(`${e(F)}d10`),e(x)>0&&L.push(`${e(x)}d12`),e(J)>0&&L.push(`${e(J)}d20`);let O=L.join("+")||"1d20";return e(h)!==0&&(O+=e(h)>=0?`+${e(h)}`:`${e(h)}`),O}function jt(){const L=At();at(L)}function w(L){return L.replace(/(\d+)d(\d+)/g,(O,W,le)=>`${parseInt(W)*2}d${le}`)}function q(){n(he,0),n(Ae,0),n(B,0),n(F,0),n(x,0),n(J,0),n(h,0),n(G,null),n(I,[]),n(se,!1),n(fe,!1),R("other"),n(ue,!1)}function _(){window.DICE&&(window.DICE.setColors({dice_color:ht(e(pe),"ff"),label_color:ht(e(ke),"ff"),desk_color:e(Je)}),T&&(T.updateDeskColor(e(Je)),T.updateDiceColors()))}function H(){n(st,!e(st))}function V(){!e(G)||e(m)<=0||e(ue)||(n(G,{...e(G),resultTotal:e(G).resultTotal+10,resultString:e(G).resultString+" + 10 (Guided Strike)"}),de.update(L=>{const O="ChannelDivinity",W=L.classFeatures.features[O];return typeof W=="number"&&W>0&&(L.classFeatures.features[O]=W-1),L}),n(ue,!0))}function re(){y("close"),b(""),P(""),Z(""),n(We,""),n(G,null),n(ue,!1),n(se,!1),n(fe,!1),q()}Ve(()=>(t(),Ta),()=>{n(p,t().class?Ta(t().class,t().level,t().subclass).some(O=>O.name==="Guided Strike"):!1)}),Ve(()=>t(),()=>{n(m,(()=>{const O=t().classFeatures.features["ChannelDivinity"];return typeof O=="number"?O:0})())}),Ve(()=>(e(he),e(Ae),e(B),e(F),e(x),e(J),e(h)),()=>{n($,(()=>{const L=[];e(he)>0&&L.push(`${e(he)}d4`),e(Ae)>0&&L.push(`${e(Ae)}d6`),e(B)>0&&L.push(`${e(B)}d8`),e(F)>0&&L.push(`${e(F)}d10`),e(x)>0&&L.push(`${e(x)}d12`),e(J)>0&&L.push(`${e(J)}d20`);let O=L.join("+")||"1d20";return e(h)!==0&&(O+=e(h)>=0?`+${e(h)}`:`${e(h)}`),O})())}),Ve(()=>(N(b()),e(me),N(K()),e(We),N(P()),N(Z()),N(R())),()=>{b()&&e(me)&&K()&&b()!==e(We)&&(n(We,b()),n(G,null),n(I,[]),n(se,!1),n(fe,!1),n(ue,!1),console.log("Auto-roll triggered. notation:",b(),"damageNotation:",P(),"attackName:",Z(),"rollType:",R()),setTimeout(()=>at(b(),R()),200))}),ma();var Se={getLastRollTotal:Pe};Jt();var Ce=dn();let Re;var ee=l(Ce),S=l(ee),Y=l(S),xe=l(Y);{var Oe=L=>{var O=Wi(),W=$e(O),le=a(W);{var Me=ve=>{var ie=It("- Attack Roll");o(ve,ie)};g(le,ve=>{R()==="attack"&&ve(Me)})}var Ue=a(le,2);{var Te=ve=>{var ie=It("- Damage Roll");o(ve,ie)};g(Ue,ve=>{R()==="damage"&&ve(Te)})}var Le=a(Ue,2);{var rt=ve=>{var ie=It("- Healing Roll");o(ve,ie)};g(Le,ve=>{R()==="healing"&&ve(rt)})}var dt=a(Le,2);{var Fe=ve=>{var ie=It("- Ability Check");o(ve,ie)};g(dt,ve=>{R()==="check"&&ve(Fe)})}var je=a(dt,2);{var $t=ve=>{var ie=It("- Saving Throw");o(ve,ie)};g(je,ve=>{R()==="save"&&ve($t)})}A(()=>k(W,`${Z()??""} `)),o(L,O)},Qe=L=>{var O=It("Dice Roller");o(L,O)};g(xe,L=>{Z()?L(Oe):L(Qe,!1)})}s(Y);var ft=a(Y,2),De=l(ft),Q=a(De,2);s(ft),s(S);var d=a(S,2);{var He=L=>{var O=Ki(),W=a(l(O),2),le=l(W),Me=a(l(le),2);we(Me),s(le);var Ue=a(le,2),Te=a(l(Ue),2);we(Te),s(Ue);var Le=a(Ue,2),rt=a(l(Le),2);we(rt),s(Le),s(W),s(O),Ee(Me,()=>e(pe),dt=>n(pe,dt)),j("change",Me,_),Ee(Te,()=>e(ke),dt=>n(ke,dt)),j("change",Te,_),Ee(rt,()=>e(Je),dt=>n(Je,dt)),j("change",rt,_),o(L,O)};g(d,L=>{e(st)&&L(He)})}var ge=a(d,2);{var U=L=>{var O=Vi();o(L,O)};g(ge,L=>{e(me)||L(U)})}var be=a(ge,2),te=l(be);Ua(te,L=>n(ae,L),()=>e(ae));var Be=a(te,2);{var _e=L=>{var O=Ji(),W=a(l(O),2),le=l(W),Me=a(l(le),2);we(Me),s(le);var Ue=a(le,2),Te=a(l(Ue),2);we(Te),s(Ue);var Le=a(Ue,2),rt=a(l(Le),2);we(rt),s(Le);var dt=a(Le,2),Fe=a(l(dt),2);we(Fe),s(dt);var je=a(dt,2),$t=a(l(je),2);we($t),s(je);var ve=a(je,2),ie=a(l(ve),2);we(ie),s(ve),s(W);var Ze=a(W,2),_t=l(Ze),Ft=l(_t);s(_t);var yt=a(_t,2);s(Ze),s(O),A(()=>{_t.disabled=!e(me),k(Ft,`Roll ${e($)??""}`)}),Ee(Me,()=>e(he),M=>n(he,M)),Ee(Te,()=>e(Ae),M=>n(Ae,M)),Ee(rt,()=>e(B),M=>n(B,M)),Ee(Fe,()=>e(F),M=>n(F,M)),Ee($t,()=>e(x),M=>n(x,M)),Ee(ie,()=>e(J),M=>n(J,M)),j("click",_t,jt),j("click",yt,q),o(L,O)};g(Be,L=>{b()||L(_e)})}s(be);var qe=a(be,2);let Ge;var Xe=l(qe);{var it=L=>{var O=vn(),W=$e(O),le=l(W);{var Me=M=>{var pt=Yi(),Xt=l(pt,!0);s(pt),A(()=>k(Xt,Z()?`${Z()} - Healing`:"Healing")),o(M,pt)},Ue=M=>{var pt=bt(),Xt=$e(pt);{var da=D=>{var ce=Qi(),Ke=l(ce,!0);s(ce),A(()=>k(Ke,Z()?`${Z()} - ${X()} Damage`:`${X()} Damage`)),o(D,ce)},ua=D=>{var ce=bt(),Ke=$e(ce);{var ut=Ie=>{var ze=Xi(),xt=l(ze,!0);s(ze),A(()=>k(xt,Z()?`${Z()} - Damage`:"Damage")),o(Ie,ze)},E=Ie=>{var ze=Zi(),xt=l(ze,!0);s(ze),A(()=>k(xt,Z()?`${Z()} - Result`:"Result")),o(Ie,ze)};g(Ke,Ie=>{R()==="damage"?Ie(ut):Ie(E,!1)},!0)}o(D,ce)};g(Xt,D=>{R()==="damage"&&X()?D(da):D(ua,!1)},!0)}o(M,pt)};g(le,M=>{R()==="damage"&&X()==="Healing"?M(Me):M(Ue,!1)})}var Te=a(le,2);{var Le=M=>{var pt=en();o(M,pt)};g(Te,M=>{e(se)&&M(Le)})}var rt=a(Te,2);{var dt=M=>{var pt=tn();o(M,pt)};g(rt,M=>{e(fe)&&M(dt)})}s(W);var Fe=a(W,2),je=l(Fe,!0);s(Fe);var $t=a(Fe,2),ve=l($t);{var ie=M=>{var pt=bt(),Xt=$e(pt);{var da=D=>{var ce=sn();St(ce,5,()=>(e(G),N(b()),N(z()),i(()=>ye(e(G),b(),z()))),Lt,(Ke,ut)=>{var E=an(),Ie=l(E),ze=l(Ie,!0);s(Ie);var xt=a(Ie,2),Ye=l(xt);s(xt),s(E),A(()=>{k(ze,(e(ut),i(()=>e(ut).display))),k(Ye,`(${e(ut),i(()=>e(ut).source)??""})`)}),o(Ke,E)}),s(ce),o(D,ce)},ua=D=>{var ce=bt(),Ke=$e(ce);{var ut=E=>{var Ie=ln(),ze=l(Ie);s(Ie),A(()=>k(ze,`Modifier: ${e(G),i(()=>e(G).constant>=0?"+":"")??""}${e(G),i(()=>e(G).constant)??""}`)),o(E,Ie)};g(Ke,E=>{e(G),i(()=>e(G).constant)&&E(ut)},!0)}o(D,ce)};g(Xt,D=>{N(z()),i(()=>z().length>0)?D(da):D(ua,!1)})}o(M,pt)};g(ve,M=>{e(G),N(z()),i(()=>e(G).constant||z().length>0)&&M(ie)})}s($t);var Ze=a($t,2);{var _t=M=>{var pt=rn();o(M,pt)};g(Ze,M=>{e(fe)&&M(_t)})}var Ft=a(Ze,2);{var yt=M=>{var pt=cn(),Xt=l(pt);St(Xt,1,()=>e(I),Lt,(D,ce)=>{var Ke=nn(),ut=l(Ke,!0);s(Ke),A(()=>k(ut,(e(ce),i(()=>e(ce).label)))),j("click",Ke,()=>at(e(ce).notation,"damage")),o(D,Ke)});var da=a(Xt,2);{var ua=D=>{var ce=on();A(()=>{ce.disabled=e(m)<=0,tt(ce,"title",e(m)<=0?"No Channel Divinity uses remaining":"Use Channel Divinity to add +10 to this attack roll")}),j("click",ce,V),o(D,ce)};g(da,D=>{e(p)&&R()==="attack"&&!e(ue)&&e(m)>0&&!e(fe)&&D(ua)})}s(pt),o(M,pt)};g(Ft,M=>{e(I),e(p),N(R()),e(ue),e(m),i(()=>e(I).length>0||e(p)&&R()==="attack"&&!e(ue)&&e(m)>0)&&M(yt)})}A(()=>k(je,(e(G),i(()=>e(G).resultTotal)))),o(L,O)};g(Xe,L=>{e(G)&&L(it)})}s(qe),s(ee),s(Ce),A(()=>{Re=Et(Ce,1,"modal-overlay svelte-1r90jgp",null,Re,{hidden:!K()}),Ge=Et(qe,1,"roll-result svelte-1r90jgp",null,Ge,{"has-result":e(G)})}),j("click",De,H),j("click",Q,re),j("click",ee,_s(function(L){Ma.call(this,c,L)})),j("keydown",ee,function(L){Ma.call(this,c,L)}),j("click",Ce,re),j("keydown",Ce,L=>L.key==="Escape"&&re()),o(r,Ce),Sl(c,"getLastRollTotal",Pe);var oe=Qt(Se);return f(),oe}const Za="https://api.github.com/gists";async function fn(r,c,t){if(!c)throw new Error("GitHub token is required");const v=JSON.stringify(r,null,2),f=`${r.name||"character"}_dnd.json`,p={description:t||`D&D Character: ${r.name}`,public:!1,files:{[f]:{content:v}}},m=await fetch(Za,{method:"POST",headers:{Authorization:`token ${c}`,"Content-Type":"application/json"},body:JSON.stringify(p)});if(!m.ok)throw new Error(`Failed to create gist: ${m.statusText}`);return(await m.json()).id}async function pn(r,c,t){if(!c||!t)throw new Error("GitHub token and Gist ID are required");const v=JSON.stringify(r,null,2),p={files:{[`${r.name||"character"}_dnd.json`]:{content:v}}},m=await fetch(`${Za}/${t}`,{method:"PATCH",headers:{Authorization:`token ${c}`,"Content-Type":"application/json"},body:JSON.stringify(p)});if(!m.ok)throw new Error(`Failed to update gist: ${m.statusText}`)}async function mn(r,c){if(!r)throw new Error("Gist ID is required");const t={"Content-Type":"application/json"};c&&(t.Authorization=`token ${c}`);const v=await fetch(`${Za}/${r}`,{method:"GET",headers:t});if(!v.ok)throw new Error(`Failed to load gist: ${v.statusText}`);const f=await v.json(),p=Object.values(f.files);if(p.length===0)throw new Error("No files found in gist");const $=p[0].content;try{const y=JSON.parse($);return y.attacks&&Array.isArray(y.attacks)&&(y.attacks=y.attacks.map(b=>({...b,id:b.id||crypto.randomUUID()}))),y.classFeatures?(y.classFeatures.features||(y.classFeatures.features={}),y.classFeatures.spellSlots||(y.classFeatures.spellSlots=[]),y.classFeatures.preparedSpells===void 0&&(y.classFeatures.preparedSpells="")):y.classFeatures={features:{},spellSlots:[],preparedSpells:""},y}catch{throw new Error("Invalid character data in gist")}}function Ms(r){typeof window<"u"&&localStorage.setItem("dnd_gist_config",JSON.stringify(r))}function gn(){if(typeof window<"u"){const r=localStorage.getItem("dnd_gist_config");if(r)return JSON.parse(r)}return{}}async function bn(r,c=30){if(!r)throw new Error("GitHub token is required to list gists");const t=await fetch(`${Za}?per_page=${c}`,{method:"GET",headers:{Authorization:`token ${r}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error(`Failed to list gists: ${t.statusText}`);return await t.json()}var hn=u('<div class="error-message svelte-1jb5ckg"> </div>'),_n=u('<div class="toggle-container svelte-1jb5ckg"><button type="button" class="toggle-btn svelte-1jb5ckg"> </button></div>'),yn=u('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID (leave empty to create new)</label> <input type="text" id="gistId" placeholder="Optional: existing Gist ID to update" class="svelte-1jb5ckg"/></div>'),xn=u('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),$n=u('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),wn=u('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Update (or leave unselected to create new)</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),kn=u('<div class="info-message svelte-1jb5ckg">No gists found. A new one will be created.</div>'),Sn=u('<!> <div class="form-group svelte-1jb5ckg"><label for="description" class="svelte-1jb5ckg"> </label> <input type="text" id="description" placeholder="D&amp;D Character Sheet" class="svelte-1jb5ckg"/></div>',1),Cn=u('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID *</label> <input type="text" id="gistId" placeholder="Enter Gist ID (for public or your private gists)" required class="svelte-1jb5ckg"/></div>'),Dn=u('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),Ln=u('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),An=u('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Load</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),jn=u('<div class="info-message svelte-1jb5ckg">No gists found. Enter a Gist ID manually or create a new one in Save mode.</div>'),Rn=u('<div class="modal-overlay svelte-1jb5ckg" role="button" tabindex="-1"><div class="modal-content svelte-1jb5ckg" role="dialog" tabindex="0"><div class="modal-header svelte-1jb5ckg"><h2 class="svelte-1jb5ckg"> </h2> <button class="close-btn svelte-1jb5ckg">√ó</button></div> <div class="modal-body svelte-1jb5ckg"><!> <div class="form-group svelte-1jb5ckg"><label for="token" class="svelte-1jb5ckg"> <a href="https://github.com/settings/tokens" target="_blank" rel="noopener" class="svelte-1jb5ckg">Get token</a></label> <input type="password" id="token" placeholder="ghp_xxxxxxxxxxxxx" class="svelte-1jb5ckg"/></div> <!> <!> <div class="modal-actions svelte-1jb5ckg"><button class="btn btn-primary svelte-1jb5ckg"><!></button> <button class="btn btn-secondary svelte-1jb5ckg">Cancel</button></div></div></div></div>');function Bn(r,c){Yt(c,!1);const t=()=>ot(de,"$character",v),[v,f]=va(),p=Ca();let m=Dt(c,"mode",8,"save"),$=C(""),y=C(""),b=C(""),K=C(!1),P=C(""),X=C(!1),Z=C(!1),ne=C([]),z=C(null);const R=gn();R.token&&n($,R.token),R.gistId&&n(y,R.gistId),Sa(async()=>{e($)&&!e(X)&&await T()});async function T(){if(e($)){n(Z,!0),n(P,"");try{n(ne,await bn(e($))),e(y)&&n(z,e(ne).find(_=>_.id===e(y))||null)}catch(_){n(P,_.message||"Failed to load gists"),n(ne,[])}finally{n(Z,!1)}}}function ae(_){e(z)?.id===_.id?(n(z,null),n(y,"")):(n(z,_),n(y,_.id))}function me(){n(X,!e(X)),n(P,""),!e(X)&&e($)&&T()}async function We(){if(!e($)){n(P,"GitHub token is required");return}const _=e(z)?.id||e(y);n(K,!0),n(P,"");try{if(_)await pn(t(),e($),_),n(y,_),Nt.add("Character updated in Gist successfully!","success");else{const H=await fn(t(),e($),e(b));n(y,H),Nt.add(`Character saved to Gist! ID: ${H}`,"success")}Ms({token:e($),gistId:e(y)}),p("close")}catch(H){n(P,H.message||"Failed to save to Gist")}finally{n(K,!1)}}async function G(){const _=e(z)?.id||e(y);if(!_){n(P,"Please select a gist or enter a Gist ID");return}n(K,!0),n(P,"");try{const H=await mn(_,e($)||void 0);de.set(H),n(y,_),Ms({token:e($),gistId:e(y)}),Nt.add("Character loaded from Gist successfully!","success"),p("close")}catch(H){n(P,H.message||"Failed to load from Gist")}finally{n(K,!1)}}function Pe(){p("close")}Jt();var ye=Rn(),he=l(ye),Ae=l(he),B=l(Ae),F=l(B,!0);s(B);var x=a(B,2);s(Ae);var J=a(Ae,2),h=l(J);{var I=_=>{var H=hn(),V=l(H,!0);s(H),A(()=>k(V,e(P))),o(_,H)};g(h,_=>{e(P)&&_(I)})}var se=a(h,2),fe=l(se),ue=l(fe);aa(),s(fe);var pe=a(fe,2);we(pe),s(se);var ke=a(se,2);{var Je=_=>{var H=_n(),V=l(H),re=l(V,!0);s(V),s(H),A(()=>{V.disabled=e(K),k(re,e(X)?"üìã Show My Gists":"‚úèÔ∏è Enter Gist ID Manually")}),j("click",V,me),o(_,H)};g(ke,_=>{(m()==="load"||m()==="save"&&e($))&&_(Je)})}var st=a(ke,2);{var ct=_=>{var H=Sn(),V=$e(H);{var re=Y=>{var xe=yn(),Oe=a(l(xe),2);we(Oe),s(xe),A(()=>Oe.disabled=e(K)),Ee(Oe,()=>e(y),Qe=>n(y,Qe)),o(Y,xe)},Se=Y=>{var xe=bt(),Oe=$e(xe);{var Qe=De=>{var Q=xn();o(De,Q)},ft=De=>{var Q=bt(),d=$e(Q);{var He=U=>{var be=wn(),te=a(l(be),2);St(te,5,()=>e(ne),Lt,(Be,_e)=>{var qe=$n();let Ge;var Xe=l(qe),it=l(Xe),oe=l(it,!0);s(it);var L=a(it,2),O=l(L,!0);s(L),s(Xe);var W=a(Xe,2),le=l(W),Me=l(le);s(le);var Ue=a(le,2),Te=l(Ue);s(Ue),s(W),s(qe),A(Le=>{Ge=Et(qe,1,"gist-item svelte-1jb5ckg",null,Ge,{selected:e(z)?.id===e(_e).id}),qe.disabled=e(K),k(oe,(e(_e),i(()=>e(_e).description||"Untitled"))),k(O,(e(_e),i(()=>e(_e).public?"üåê Public":"üîí Private"))),k(Me,`ID: ${e(_e),i(()=>e(_e).id)??""}`),k(Te,`Updated: ${Le??""}`)},[()=>(e(_e),i(()=>new Date(e(_e).updated_at).toLocaleDateString()))]),j("click",qe,()=>ae(e(_e))),o(Be,qe)}),s(te),s(be),o(U,be)},ge=U=>{var be=bt(),te=$e(be);{var Be=_e=>{var qe=kn();o(_e,qe)};g(te,_e=>{e($)&&_e(Be)},!0)}o(U,be)};g(d,U=>{e(ne),i(()=>e(ne).length>0)?U(He):U(ge,!1)},!0)}o(De,Q)};g(Oe,De=>{e(Z)?De(Qe):De(ft,!1)},!0)}o(Y,xe)};g(V,Y=>{e(X)||!e($)?Y(re):Y(Se,!1)})}var Ce=a(V,2),Re=l(Ce),ee=l(Re);s(Re);var S=a(Re,2);we(S),s(Ce),A(()=>{k(ee,`Description ${e(y)?"(optional)":""}`),S.disabled=e(K)}),Ee(S,()=>e(b),Y=>n(b,Y)),o(_,H)},ht=_=>{var H=bt(),V=$e(H);{var re=Ce=>{var Re=Cn(),ee=a(l(Re),2);we(ee),s(Re),A(()=>ee.disabled=e(K)),Ee(ee,()=>e(y),S=>n(y,S)),o(Ce,Re)},Se=Ce=>{var Re=bt(),ee=$e(Re);{var S=xe=>{var Oe=Dn();o(xe,Oe)},Y=xe=>{var Oe=bt(),Qe=$e(Oe);{var ft=Q=>{var d=An(),He=a(l(d),2);St(He,5,()=>e(ne),Lt,(ge,U)=>{var be=Ln();let te;var Be=l(be),_e=l(Be),qe=l(_e,!0);s(_e);var Ge=a(_e,2),Xe=l(Ge,!0);s(Ge),s(Be);var it=a(Be,2),oe=l(it),L=l(oe);s(oe);var O=a(oe,2),W=l(O);s(O),s(it),s(be),A(le=>{te=Et(be,1,"gist-item svelte-1jb5ckg",null,te,{selected:e(z)?.id===e(U).id}),be.disabled=e(K),k(qe,(e(U),i(()=>e(U).description||"Untitled"))),k(Xe,(e(U),i(()=>e(U).public?"üåê Public":"üîí Private"))),k(L,`ID: ${e(U),i(()=>e(U).id)??""}`),k(W,`Updated: ${le??""}`)},[()=>(e(U),i(()=>new Date(e(U).updated_at).toLocaleDateString()))]),j("click",be,()=>ae(e(U))),o(ge,be)}),s(He),s(d),o(Q,d)},De=Q=>{var d=bt(),He=$e(d);{var ge=U=>{var be=jn();o(U,be)};g(He,U=>{e($)&&U(ge)},!0)}o(Q,d)};g(Qe,Q=>{e(ne),i(()=>e(ne).length>0)?Q(ft):Q(De,!1)},!0)}o(xe,Oe)};g(ee,xe=>{e(Z)?xe(S):xe(Y,!1)},!0)}o(Ce,Re)};g(V,Ce=>{e(X)||!e($)?Ce(re):Ce(Se,!1)},!0)}o(_,H)};g(st,_=>{m()==="save"?_(ct):_(ht,!1)})}var vt=a(st,2),at=l(vt),At=l(at);{var jt=_=>{var H=It();A(()=>k(H,m()==="save"?"Saving...":"Loading...")),o(_,H)},w=_=>{var H=It();A(()=>k(H,m()==="save"?"Save":"Load")),o(_,H)};g(At,_=>{e(K)?_(jt):_(w,!1)})}s(at);var q=a(at,2);s(vt),s(J),s(he),s(ye),A(()=>{k(F,m()==="save"?"Save to GitHub Gist":"Load from GitHub Gist"),k(ue,`GitHub Token ${m()==="load"?"(optional for public gists)":"(required)"} `),pe.disabled=e(K),at.disabled=e(K),q.disabled=e(K)}),j("click",x,Pe),Ee(pe,()=>e($),_=>n($,_)),j("blur",pe,()=>{e($)&&!e(X)&&T()}),j("click",at,function(..._){(m()==="save"?We:G)?.apply(this,_)}),j("click",q,Pe),j("click",he,_s(function(_){Ma.call(this,c,_)})),j("keydown",he,function(_){Ma.call(this,c,_)}),j("click",ye,Pe),j("keydown",ye,_=>_.key==="Escape"&&Pe()),o(r,ye),Qt(),f()}var Mn=u('<div class="loading svelte-1ngjemu">Loading D&D data...</div>'),Tn=u("<option> </option>"),Fn=u('<select class="level-filter svelte-1ngjemu"><option>All Levels</option><option>Cantrip</option><!></select>'),Pn=u('<div class="no-results svelte-1ngjemu"> </div>'),In=u('<div class="item-meta svelte-1ngjemu"> </div>'),En=u('<div class="item-meta svelte-1ngjemu"> </div>'),Hn=u('<button><div class="item-name svelte-1ngjemu"> </div> <!></button>'),Un=u('<p class="higher-levels"><strong>At Higher Levels:</strong> </p>'),Nn=u('<p class="cantrip-upgrade"><strong>Cantrip Upgrade:</strong> </p>'),On=u('<h3 class="svelte-1ngjemu"> </h3> <p class="spell-meta svelte-1ngjemu"><!> <!></p> <p class="spell-classes"><strong>Classes:</strong> </p> <div class="spell-stats svelte-1ngjemu"><div><strong>Casting Time:</strong> </div> <div><strong>Range:</strong> </div> <div><strong>Components:</strong> <!></div> <div><strong>Duration:</strong> <!> </div></div> <p class="description svelte-1ngjemu"> </p> <!> <!>',1),Gn=u('<p class="prerequisite svelte-1ngjemu"><strong>Prerequisite:</strong> </p>'),qn=u('<h3 class="svelte-1ngjemu"> </h3> <!> <p class="description svelte-1ngjemu"> </p> <a target="_blank" rel="noopener" class="source-link svelte-1ngjemu">View Full Details ‚Üí</a>',1),zn=u('<div class="item-details svelte-1ngjemu"><!></div>'),Wn=u('<div class="controls svelte-1ngjemu"><div class="tabs svelte-1ngjemu"><button> </button> <button> </button></div> <div class="search-controls svelte-1ngjemu"><input type="text" placeholder="Search by name or description..." class="search-input svelte-1ngjemu"/> <!></div></div> <div class="content-container svelte-1ngjemu"><div class="items-list svelte-1ngjemu"><!></div> <!></div>',1),Kn=u('<div class="modal-backdrop svelte-1ngjemu" role="presentation"><div class="modal svelte-1ngjemu" role="dialog" aria-modal="true" tabindex="-1"><div class="modal-header svelte-1ngjemu"><h2 class="svelte-1ngjemu">Browse D&D Spells & Feats</h2> <button class="close-btn svelte-1ngjemu" aria-label="Close">&times;</button></div> <div class="modal-body svelte-1ngjemu"><!></div> <div class="modal-footer svelte-1ngjemu"><button class="btn-secondary svelte-1ngjemu">Cancel</button> <button class="btn-primary svelte-1ngjemu">Add to Character Sheet</button></div></div></div>');function Vn(r,c){Yt(c,!1);const t=C(),v=C(),f=C();let p=Dt(c,"onClose",8),m=C("spell"),$=C(!0),y=C(""),b=C(null),K=C([]),P=C([]),X=C(null);Sa(async()=>{n($,!0);try{n(K,await Gs()),n(P,await ur())}catch(x){console.error("Failed to load data:",x)}finally{n($,!1)}});function Z(x){n(X,x)}function ne(x){const J=x.match(/(\d+d\d+(?:\s*\+\s*\d+)?)/i);return J?J[1]:""}function z(x){const J=x.split(/\.( |$)/)[0].trim(),h=Array.from(x.matchAll(/\*\*(.*?)\*\*/g)).map(se=>se[1].replace(/\.$/,""));let I=J;return h.length&&(I+=" | Effects: "+h.join(", ")),I}function R(){if(e(X)){if(e(m)==="spell"){const x=e(X);de.update(J=>{const I=[];x.range&&I.push(`Range: ${x.range}`),x.castingTime&&I.push(`Cast: ${x.castingTime}`),x.duration&&I.push(`Duration: ${x.duration}`),x.actionType==="Save"&&I.push("Saving throw spell"),x.components&&x.components.length>0&&I.push(`Components: ${x.components.join(", ")}`),x.material&&I.push(`Material: ${x.material}`);const se=I.join(" | "),fe=z(x.description),ue={id:crypto.randomUUID(),name:`${x.name}${x.concentration?" (C)":""}${x.ritual?" (R)":""}`,bonus:x.actionType==="Attack"?5:0,damage:ne(x.description),damageType:`${x.school} (Lvl ${x.level})`,spellRef:x.name,infoNotes:se,generalNotes:fe,castAtLevel:x.level};return J.attacks=[...J.attacks,ue],J})}else if(e(m)==="feat"){const x=e(X);de.update(J=>{const h=`${x.name}${x.prerequisite?` (Req: ${x.prerequisite})`:""}
${x.description}
`;return J.features=J.features?`${J.features}
${h}`:h,J})}n(X,null),p()()}}Ve(()=>(e(b),e(K),e(y)),()=>{n(t,e(b)!==null?fr(Rs(e(K),e(y)),e(b)):Rs(e(K),e(y)))}),Ve(()=>(e(P),e(y)),()=>{n(v,pr(e(P),e(y)))}),Ve(()=>(e(m),e(t),e(v)),()=>{n(f,e(m)==="spell"?e(t):e(v))}),ma(),Jt();var T=Kn(),ae=l(T),me=l(ae),We=a(l(me),2);s(me);var G=a(me,2),Pe=l(G);{var ye=x=>{var J=Mn();o(x,J)},he=x=>{var J=Wn(),h=$e(J),I=l(h),se=l(I);let fe;var ue=l(se);s(se);var pe=a(se,2);let ke;var Je=l(pe);s(pe),s(I);var st=a(I,2),ct=l(st);we(ct);var ht=a(ct,2);{var vt=V=>{var re=Fn();A(()=>{e(b),Wt(()=>{})});var Se=l(re);Se.value=(Se.__value=null)??"";var Ce=a(Se);Ce.value=Ce.__value=0;var Re=a(Ce);St(Re,0,()=>[1,2,3,4,5,6,7,8,9],Lt,(ee,S)=>{var Y=Tn(),xe=l(Y);s(Y);var Oe={};A(()=>{k(xe,`Level ${S??""}`),Oe!==(Oe=S)&&(Y.value=(Y.__value=S)??"")}),o(ee,Y)}),s(re),Na(re,()=>e(b),ee=>n(b,ee)),o(V,re)};g(ht,V=>{e(m)==="spell"&&V(vt)})}s(st),s(h);var at=a(h,2),At=l(at),jt=l(At);{var w=V=>{var re=Pn(),Se=l(re);s(re),A(()=>k(Se,`No ${e(m)??""}s found`)),o(V,re)},q=V=>{var re=bt(),Se=$e(re);St(Se,1,()=>e(f),Lt,(Ce,Re)=>{var ee=Hn();let S;var Y=l(ee),xe=l(Y,!0);s(Y);var Oe=a(Y,2);{var Qe=De=>{const Q=kt(()=>e(Re));var d=In(),He=l(d);s(d),A(()=>k(He,`Level ${N(e(Q)),i(()=>e(Q).level)??""} ‚Ä¢ ${N(e(Q)),i(()=>e(Q).school)??""}`)),o(De,d)},ft=De=>{const Q=kt(()=>e(Re));var d=bt(),He=$e(d);{var ge=U=>{var be=En(),te=l(be,!0);s(be),A(()=>k(te,(N(e(Q)),i(()=>e(Q).prerequisite)))),o(U,be)};g(He,U=>{N(e(Q)),i(()=>e(Q).prerequisite)&&U(ge)})}o(De,d)};g(Oe,De=>{e(m)==="spell"?De(Qe):De(ft,!1)})}s(ee),A(()=>{S=Et(ee,1,"item-card svelte-1ngjemu",null,S,{selected:e(X)?.name===e(Re).name}),k(xe,(e(Re),i(()=>e(Re).name)))}),j("click",ee,()=>Z(e(Re))),o(Ce,ee)}),o(V,re)};g(jt,V=>{e(f),i(()=>e(f).length===0)?V(w):V(q,!1)})}s(At);var _=a(At,2);{var H=V=>{var re=zn(),Se=l(re);{var Ce=ee=>{const S=kt(()=>e(X));var Y=On(),xe=$e(Y),Oe=l(xe,!0);s(xe);var Qe=a(xe,2),ft=l(Qe);{var De=Fe=>{var je=It();A(()=>k(je,`${N(e(S)),i(()=>e(S).school)??""} cantrip`)),o(Fe,je)},Q=Fe=>{var je=It();A(()=>k(je,`Level ${N(e(S)),i(()=>e(S).level)??""} ${N(e(S)),i(()=>e(S).school)??""}`)),o(Fe,je)};g(ft,Fe=>{N(e(S)),i(()=>e(S).level===0)?Fe(De):Fe(Q,!1)})}var d=a(ft,2);{var He=Fe=>{var je=It("(ritual)");o(Fe,je)};g(d,Fe=>{N(e(S)),i(()=>e(S).ritual)&&Fe(He)})}s(Qe);var ge=a(Qe,2),U=a(l(ge));s(ge);var be=a(ge,2),te=l(be),Be=a(l(te));s(te);var _e=a(te,2),qe=a(l(_e));s(_e);var Ge=a(_e,2),Xe=a(l(Ge)),it=a(Xe);{var oe=Fe=>{var je=It();A(()=>k(je,`(${N(e(S)),i(()=>e(S).material)??""})`)),o(Fe,je)};g(it,Fe=>{N(e(S)),i(()=>e(S).material)&&Fe(oe)})}s(Ge);var L=a(Ge,2),O=a(l(L),2);{var W=Fe=>{var je=It("Concentration,");o(Fe,je)};g(O,Fe=>{N(e(S)),i(()=>e(S).concentration)&&Fe(W)})}var le=a(O,1,!0);s(L),s(be);var Me=a(be,2),Ue=l(Me,!0);s(Me);var Te=a(Me,2);{var Le=Fe=>{var je=Un(),$t=a(l(je));s(je),A(()=>k($t,` ${N(e(S)),i(()=>e(S).higherLevelSlot)??""}`)),o(Fe,je)};g(Te,Fe=>{N(e(S)),i(()=>e(S).higherLevelSlot)&&Fe(Le)})}var rt=a(Te,2);{var dt=Fe=>{var je=Nn(),$t=a(l(je));s(je),A(()=>k($t,` ${N(e(S)),i(()=>e(S).cantripUpgrade)??""}`)),o(Fe,je)};g(rt,Fe=>{N(e(S)),i(()=>e(S).cantripUpgrade)&&Fe(dt)})}A((Fe,je)=>{k(Oe,(N(e(S)),i(()=>e(S).name))),k(U,` ${Fe??""}`),k(Be,` ${N(e(S)),i(()=>e(S).castingTime||e(S).actionType)??""}`),k(qe,` ${N(e(S)),i(()=>e(S).range)??""}`),k(Xe,` ${je??""}`),k(le,(N(e(S)),i(()=>e(S).duration))),k(Ue,(N(e(S)),i(()=>e(S).description)))},[()=>(N(e(S)),i(()=>e(S).classes.join(", "))),()=>(N(e(S)),i(()=>e(S).components.join(", ").toUpperCase()))]),o(ee,Y)},Re=ee=>{const S=kt(()=>e(X));var Y=qn(),xe=$e(Y),Oe=l(xe,!0);s(xe);var Qe=a(xe,2);{var ft=He=>{var ge=Gn(),U=a(l(ge));s(ge),A(()=>k(U,` ${N(e(S)),i(()=>e(S).prerequisite)??""}`)),o(He,ge)};g(Qe,He=>{N(e(S)),i(()=>e(S).prerequisite)&&He(ft)})}var De=a(Qe,2),Q=l(De,!0);s(De);var d=a(De,2);A(()=>{k(Oe,(N(e(S)),i(()=>e(S).name))),k(Q,(N(e(S)),i(()=>e(S).description))),tt(d,"href",(N(e(S)),i(()=>e(S).source)))}),o(ee,Y)};g(Se,ee=>{e(m)==="spell"?ee(Ce):ee(Re,!1)})}s(re),o(V,re)};g(_,V=>{e(X)&&V(H)})}s(at),A(()=>{fe=Et(se,1,"tab svelte-1ngjemu",null,fe,{active:e(m)==="spell"}),k(ue,`üìú Spells (${e(K),i(()=>e(K).length)??""})`),ke=Et(pe,1,"tab svelte-1ngjemu",null,ke,{active:e(m)==="feat"}),k(Je,`‚≠ê Feats (${e(P),i(()=>e(P).length)??""})`)}),j("click",se,()=>{n(m,"spell"),n(X,null),n(y,"")}),j("click",pe,()=>{n(m,"feat"),n(X,null),n(y,"")}),Ee(ct,()=>e(y),V=>n(y,V)),o(x,J)};g(Pe,x=>{e($)?x(ye):x(he,!1)})}s(G);var Ae=a(G,2),B=l(Ae),F=a(B,2);s(Ae),s(ae),s(T),A(()=>F.disabled=!e(X)),j("click",We,function(...x){p()?.apply(this,x)}),j("click",B,function(...x){p()?.apply(this,x)}),j("click",F,R),j("click",ae,_s(function(x){Ma.call(this,c,x)})),j("keydown",ae,function(x){Ma.call(this,c,x)}),j("click",T,function(...x){p()?.apply(this,x)}),j("keydown",T,x=>x.key==="Escape"&&p()()),o(r,T),Qt()}var Jn=u('<span class="resistance-tag svelte-gdwwx1"> <button type="button" class="tag-remove svelte-gdwwx1">√ó</button></span>'),Yn=u('<div class="resistance-list svelte-gdwwx1"></div>'),Qn=u('<p class="ability-meta svelte-gdwwx1"> <!></p>'),Xn=u('<p class="ability-meta svelte-gdwwx1">Requires Reaction</p>'),Zn=u('<div class="ability-card svelte-gdwwx1"><div class="ability-header svelte-gdwwx1"><strong class="svelte-gdwwx1"> </strong> <button type="button" class="ability-remove svelte-gdwwx1">√ó</button></div> <p class="ability-description svelte-gdwwx1"> </p> <!></div>'),eo=u('<div class="abilities-list svelte-gdwwx1"></div>'),to=u(`<div class="modal-backdrop svelte-gdwwx1" role="presentation"><div class="modal-content svelte-gdwwx1" role="dialog" aria-modal="true" aria-labelledby="modal-title"><div class="modal-header svelte-gdwwx1"><h3 id="modal-title" class="svelte-gdwwx1">Add Custom Condition</h3> <button class="btn-close svelte-gdwwx1" aria-label="Close">√ó</button></div> <div class="modal-body svelte-gdwwx1"><div class="form-group svelte-gdwwx1"><label for="conditionName" class="svelte-gdwwx1">Condition Name*</label> <input type="text" id="conditionName" placeholder="e.g., Cazna's Mark" class="svelte-gdwwx1"/></div> <div class="form-group svelte-gdwwx1"><label for="description" class="svelte-gdwwx1">Description</label> <textarea id="description" placeholder="Describe the condition..." rows="3" class="svelte-gdwwx1"></textarea></div> <div class="form-row svelte-gdwwx1"><div class="form-group svelte-gdwwx1"><label for="attackBonus" class="svelte-gdwwx1">Attack Bonus</label> <input type="text" id="attackBonus" placeholder="0 or 1d4" class="svelte-gdwwx1"/></div> <div class="form-group svelte-gdwwx1"><label for="damageBonus" class="svelte-gdwwx1">Damage Bonus</label> <input type="text" id="damageBonus" placeholder="0 or 1d6" class="svelte-gdwwx1"/></div> <div class="form-group svelte-gdwwx1"><label for="acBonus" class="svelte-gdwwx1">AC Bonus</label> <input type="number" id="acBonus" placeholder="0" class="svelte-gdwwx1"/></div></div> <div class="form-group svelte-gdwwx1"><label for="darkvision" class="svelte-gdwwx1">Darkvision (feet)</label> <input type="number" id="darkvision" placeholder="0" min="0" step="30" class="svelte-gdwwx1"/> <small class="help-text svelte-gdwwx1">Grant or extend darkvision (e.g., 60 for 60 feet)</small></div> <div class="form-group svelte-gdwwx1"><label class="svelte-gdwwx1">Damage Resistances</label> <div class="resistance-input-group svelte-gdwwx1"><input type="text" placeholder="e.g., cold, fire, poison" class="svelte-gdwwx1"/> <button type="button" class="btn-add svelte-gdwwx1">Add</button></div> <!></div> <div class="form-group svelte-gdwwx1"><label class="svelte-gdwwx1">Special Abilities</label> <div class="ability-form svelte-gdwwx1"><input type="text" placeholder="Ability name (e.g., Flicker of Deceit)" class="ability-name-input svelte-gdwwx1"/> <textarea placeholder="Ability description..." rows="2" class="ability-desc-input svelte-gdwwx1"></textarea> <div class="ability-options svelte-gdwwx1"><div class="ability-option svelte-gdwwx1"><label for="abilityUses" class="svelte-gdwwx1">Uses per rest</label> <input type="number" id="abilityUses" min="0" class="svelte-gdwwx1"/></div> <div class="ability-option svelte-gdwwx1"><label for="restType" class="svelte-gdwwx1">Rest type</label> <select id="restType" class="svelte-gdwwx1"><option>Short</option><option>Long</option></select></div> <div class="ability-option svelte-gdwwx1"><label class="svelte-gdwwx1"><input type="checkbox" class="svelte-gdwwx1"/> Requires Reaction</label></div></div> <button type="button" class="btn-add svelte-gdwwx1">Add Ability</button></div> <!></div></div> <div class="modal-footer svelte-gdwwx1"><button class="btn btn-secondary svelte-gdwwx1">Cancel</button> <button class="btn btn-primary svelte-gdwwx1">Add Condition</button></div></div></div>`);function ao(r,c){Yt(c,!1);let t=Dt(c,"show",8,!1),v=Dt(c,"onSave",8),f=Dt(c,"onCancel",8),p=C(""),m=C(""),$=C(0),y=C(0),b=C(0),K=C(0),P=C([]),X=C(""),Z=C([]),ne=C(""),z=C(""),R=C(0),T=C("short"),ae=C(!1);function me(){n(p,""),n(m,""),n($,0),n(y,0),n(b,0),n(K,0),n(P,[]),n(X,""),n(Z,[]),n(ne,""),n(z,""),n(R,0),n(T,"short"),n(ae,!1)}function We(){e(X).trim()&&(n(P,[...e(P),e(X).trim()]),n(X,""))}function G(h){n(P,e(P).filter((I,se)=>se!==h))}function Pe(){if(e(ne).trim()&&e(z).trim()){const h={name:e(ne).trim(),description:e(z).trim(),requiresReaction:e(ae)};e(R)>0&&(h.usesPerRest=e(R),h.currentUses=e(R),h.restType=e(T)),n(Z,[...e(Z),h]),n(ne,""),n(z,""),n(R,0),n(T,"short"),n(ae,!1)}}function ye(h){n(Z,e(Z).filter((I,se)=>se!==h))}function he(){if(!e(p).trim()){alert("Please enter a condition name");return}const h={name:e(p).trim(),description:e(m).trim()||"Custom condition",attackBonus:e($)||0,damageBonus:e(y)||0,target:"self"};e(b)!==0&&(h.acBonus=e(b)),e(K)>0&&(h.darkvision=e(K)),e(P).length>0&&(h.resistances=e(P)),e(Z).length>0&&(h.abilities=e(Z)),v()(h),me()}function Ae(){me(),f()()}function B(h){h.target===h.currentTarget&&Ae()}Jt();var F=bt(),x=$e(F);{var J=h=>{var I=to(),se=l(I),fe=l(se),ue=a(l(fe),2);s(fe);var pe=a(fe,2),ke=l(pe),Je=a(l(ke),2);we(Je),s(ke);var st=a(ke,2),ct=a(l(st),2);ja(ct),s(st);var ht=a(st,2),vt=l(ht),at=a(l(vt),2);we(at),s(vt);var At=a(vt,2),jt=a(l(At),2);we(jt),s(At);var w=a(At,2),q=a(l(w),2);we(q),s(w),s(ht);var _=a(ht,2),H=a(l(_),2);we(H),aa(2),s(_);var V=a(_,2),re=a(l(V),2),Se=l(re);we(Se);var Ce=a(Se,2);s(re);var Re=a(re,2);{var ee=oe=>{var L=Yn();St(L,5,()=>e(P),Lt,(O,W,le)=>{var Me=Jn(),Ue=l(Me),Te=a(Ue);s(Me),A(()=>{k(Ue,`${e(W)??""} `),tt(Te,"aria-label",`Remove ${e(W)??""}`)}),j("click",Te,()=>G(le)),o(O,Me)}),s(L),o(oe,L)};g(Re,oe=>{e(P),i(()=>e(P).length>0)&&oe(ee)})}s(V);var S=a(V,2),Y=a(l(S),2),xe=l(Y);we(xe);var Oe=a(xe,2);ja(Oe);var Qe=a(Oe,2),ft=l(Qe),De=a(l(ft),2);we(De),s(ft);var Q=a(ft,2),d=a(l(Q),2);A(()=>{e(T),Wt(()=>{})});var He=l(d);He.value=He.__value="short";var ge=a(He);ge.value=ge.__value="long",s(d),s(Q);var U=a(Q,2),be=l(U),te=l(be);we(te),aa(),s(be),s(U),s(Qe);var Be=a(Qe,2);s(Y);var _e=a(Y,2);{var qe=oe=>{var L=eo();St(L,5,()=>e(Z),Lt,(O,W,le)=>{var Me=Zn(),Ue=l(Me),Te=l(Ue),Le=l(Te,!0);s(Te);var rt=a(Te,2);s(Ue);var dt=a(Ue,2),Fe=l(dt,!0);s(dt);var je=a(dt,2);{var $t=ie=>{var Ze=Qn(),_t=l(Ze),Ft=a(_t);{var yt=M=>{var pt=It("‚Ä¢ Requires Reaction");o(M,pt)};g(Ft,M=>{e(W),i(()=>e(W).requiresReaction)&&M(yt)})}s(Ze),A(()=>k(_t,`${e(W),i(()=>e(W).usesPerRest)??""} use${e(W),i(()=>e(W).usesPerRest>1?"s":"")??""} per ${e(W),i(()=>e(W).restType)??""}
                      rest `)),o(ie,Ze)},ve=ie=>{var Ze=bt(),_t=$e(Ze);{var Ft=yt=>{var M=Xn();o(yt,M)};g(_t,yt=>{e(W),i(()=>e(W).requiresReaction)&&yt(Ft)},!0)}o(ie,Ze)};g(je,ie=>{e(W),i(()=>e(W).usesPerRest)?ie($t):ie(ve,!1)})}s(Me),A(()=>{k(Le,(e(W),i(()=>e(W).name))),tt(rt,"aria-label",`Remove ${e(W),i(()=>e(W).name)??""}`),k(Fe,(e(W),i(()=>e(W).description)))}),j("click",rt,()=>ye(le)),o(O,Me)}),s(L),o(oe,L)};g(_e,oe=>{e(Z),i(()=>e(Z).length>0)&&oe(qe)})}s(S),s(pe);var Ge=a(pe,2),Xe=l(Ge),it=a(Xe,2);s(Ge),s(se),s(I),j("click",ue,Ae),Ee(Je,()=>e(p),oe=>n(p,oe)),Ee(ct,()=>e(m),oe=>n(m,oe)),Ee(at,()=>e($),oe=>n($,oe)),Ee(jt,()=>e(y),oe=>n(y,oe)),Ee(q,()=>e(b),oe=>n(b,oe)),Ee(H,()=>e(K),oe=>n(K,oe)),Ee(Se,()=>e(X),oe=>n(X,oe)),j("keydown",Se,oe=>oe.key==="Enter"&&We()),j("click",Ce,We),Ee(xe,()=>e(ne),oe=>n(ne,oe)),Ee(Oe,()=>e(z),oe=>n(z,oe)),Ee(De,()=>e(R),oe=>n(R,oe)),Na(d,()=>e(T),oe=>n(T,oe)),Aa(te,()=>e(ae),oe=>n(ae,oe)),j("click",Be,Pe),j("click",Xe,Ae),j("click",it,he),j("click",I,B),o(h,I)};g(x,h=>{t()&&h(J)})}o(r,F),Qt()}var so=u("<option></option>"),lo=u("<button> </button>"),ro=u('<div class="adjustment-msg svelte-uvfntf"> </div>'),io=u('<div class="calculation-result svelte-uvfntf"><div class="result-header svelte-uvfntf"><h4 class="svelte-uvfntf">Damage Calculation</h4></div> <div class="result-content svelte-uvfntf"><div class="damage-breakdown svelte-uvfntf"><div class="damage-row svelte-uvfntf"><span class="label svelte-uvfntf">Original Damage:</span> <span class="value svelte-uvfntf"> </span></div> <div class="adjustments svelte-uvfntf"></div> <div class="damage-row final svelte-uvfntf"><span class="label svelte-uvfntf">Final Damage:</span> <span class="value damage-value svelte-uvfntf"> </span></div></div></div> <div class="result-actions svelte-uvfntf"><button class="btn btn-primary apply-btn use-enabled svelte-uvfntf">Apply Damage</button> <button class="btn btn-secondary cancel-btn use-enabled svelte-uvfntf">Cancel</button></div></div>'),no=u('<div class="damage-form svelte-uvfntf"><div class="input-group svelte-uvfntf"><div class="input-field svelte-uvfntf"><label for="damageAmount" class="svelte-uvfntf">Damage Amount</label> <input type="number" id="damageAmount" min="0" placeholder="0" class="damage-input-field use-enabled svelte-uvfntf"/></div> <div class="input-field svelte-uvfntf"><label for="damageType" class="svelte-uvfntf">Damage Type</label> <input type="text" id="damageType" list="damageTypes" placeholder="e.g., fire, cold" class="damage-input-field use-enabled svelte-uvfntf"/> <datalist id="damageTypes"></datalist></div></div> <div class="quick-types svelte-uvfntf"><span class="quick-types-label svelte-uvfntf">Quick Select:</span> <!></div> <!></div>'),oo=u("<section><!> <!></section>");function co(r,c){Yt(c,!1);const t=()=>ot(de,"$character",p),v=()=>ot(xa,"$searchFilter",p),f=()=>ot(sa,"$collapsedStates",p),[p,m]=va(),$=C();Ca();let y=C(0),b=C(""),K=C(0),P=C([]);const X=["slashing","piercing","bludgeoning","fire","cold","lightning","thunder","acid","poison","necrotic","radiant","psychic","force"],Z={slashing:"üó°Ô∏è",piercing:"üèπ",bludgeoning:"üî®",fire:"üî•",cold:"‚ùÑÔ∏è",lightning:"‚ö°",thunder:"üí•",acid:"üß™",poison:"‚ò†Ô∏è",necrotic:"üíÄ",radiant:"‚ú®",psychic:"üß†",force:"üå™Ô∏è"};function ne(){de.update(G=>zl(G,e(K))),Nt.add(`Applied ${e(K)} damage to character (${e(b)})`,"info"),n(y,0),n(b,""),n(K,0),n(P,[])}function z(){n(y,0),n(b,""),n(K,0),n(P,[])}Ve(()=>(e(y),e(b),t()),()=>{if(e(y)>=0&&e(b).trim()){const G=ql(e(y),e(b),t());n(K,G.finalDamage),n(P,G.adjustments)}else n(K,0),n(P,[])}),Ve(()=>v(),()=>{n($,!v()||"damage".includes(v().toLowerCase())||"resistance".includes(v().toLowerCase())||"immune".includes(v().toLowerCase()))}),ma(),Jt();var R=oo();let T;var ae=l(R);{let G=kt(()=>(f(),i(()=>f().damageInput?"Expand":"Collapse")));Da(ae,{title:"Apply Damage",get collapsed(){return f(),i(()=>f().damageInput)},get ariaLabel(){return e(G)},onToggle:()=>sa.update(Pe=>({...Pe,damageInput:!Pe.damageInput}))})}var me=a(ae,2);{var We=G=>{var Pe=no(),ye=l(Pe),he=l(ye),Ae=a(l(he),2);we(Ae),s(he);var B=a(he,2),F=a(l(B),2);we(F);var x=a(F,2);St(x,5,()=>X,Lt,(fe,ue)=>{var pe=so(),ke={};A(()=>{ke!==(ke=e(ue))&&(pe.value=(pe.__value=e(ue))??"")}),o(fe,pe)}),s(x),s(B),s(ye);var J=a(ye,2),h=a(l(J),2);St(h,1,()=>X,Lt,(fe,ue)=>{var pe=lo();let ke;var Je=l(pe);s(pe),A(()=>{ke=Et(pe,1,"quick-type-btn use-enabled svelte-uvfntf",null,ke,{active:e(b)===e(ue)}),k(Je,`${e(ue),i(()=>Z[e(ue)])??""} ${e(ue)??""}`)}),j("click",pe,()=>n(b,e(ue))),o(fe,pe)}),s(J);var I=a(J,2);{var se=fe=>{var ue=io(),pe=a(l(ue),2),ke=l(pe),Je=l(ke),st=a(l(Je),2),ct=l(st);s(st),s(Je);var ht=a(Je,2);St(ht,5,()=>e(P),Lt,(_,H)=>{var V=ro(),re=l(V,!0);s(V),A(()=>k(re,e(H))),o(_,V)}),s(ht);var vt=a(ht,2),at=a(l(vt),2),At=l(at,!0);s(at),s(vt),s(ke),s(pe);var jt=a(pe,2),w=l(jt),q=a(w,2);s(jt),s(ue),A(()=>{k(ct,`${e(y)??""} ${e(b),i(()=>Z[e(b)]||"")??""} ${e(b)??""}`),k(At,e(K))}),j("click",w,ne),j("click",q,z),o(fe,ue)};g(I,fe=>{e(y),e(b),i(()=>e(y)>=0&&e(b).trim())&&fe(se)})}s(Pe),Ee(Ae,()=>e(y),fe=>n(y,fe)),Ee(F,()=>e(b),fe=>n(b,fe)),o(G,Pe)};g(me,G=>{f(),i(()=>!f().damageInput)&&G(We)})}s(R),A(()=>T=Et(R,1,"damage-input svelte-uvfntf",null,T,{hidden:!e($)})),o(r,R),Qt(),m()}var vo=u('<link rel="icon" type="image/png" href="favicon4.png"/> <meta name="viewport" content="width=device-width, initial-scale=1"/>',1),uo=u('<span class="character-name svelte-1uha8ag"> </span>'),fo=u("<span> </span>"),po=u('<div class="spell-slots-header svelte-1uha8ag"></div>'),mo=u("<span> </span><br/>",1),go=u("<span> </span><br/>",1),bo=u("<span> </span><br/>",1),ho=u("<span> </span><br/>",1),_o=u("<span> </span><br/>",1),yo=u("<span> </span><br/>",1),xo=u("<br/><em> <!>)</em>",1),$o=u("<br/><em>(requires reaction)</em>",1),wo=u('<div class="ability-detail"><strong> </strong> <!></div>'),ko=u('<div class="abilities-section"><strong>Abilities:</strong><br/> <!></div>'),So=u('<span class="effect-tooltip"><strong> </strong><br/> <br/> <!> <!> <!> <!> <!> <!> <!></span>'),Co=u('<button class="effect-remove-btn svelte-1uha8ag">√ó</button>'),Do=u('<span class="effect-badge svelte-1uha8ag" tabindex="0"> <!> <!></span>'),Lo=u(`<div class="active-effects-header svelte-1uha8ag"></div> <style>.effect-badge {
              position: relative;
            }
            .effect-tooltip {
              position: absolute;
              top: 120%;
              left: 50%;
              transform: translateX(-50%);
              background: #fff;
              color: #222;
              border: 1px solid #a5b4fc;
              border-radius: 6px;
              padding: 8px 12px;
              font-size: 0.95em;
              box-shadow: 0 2px 8px rgba(0, 0, 0, 0.12);
              z-index: 10;
              min-width: 180px;
              max-width: 300px;
              white-space: normal;
              pointer-events: none;
              opacity: 1;
              transition: opacity 0.15s;
            }

            .abilities-section {
              margin-top: 8px;
              padding-top: 8px;
              border-top: 1px solid #e5e7eb;
            }

            .ability-detail {
              margin-top: 6px;
              padding: 4px;
              background: #f9fafb;
              border-radius: 4px;
              font-size: 0.9em;
            }

            .ability-detail strong {
              color: #6366f1;
            }

            .ability-detail em {
              font-size: 0.85em;
              color: #6b7280;
            }</style>`,1),Ao=u('<div class="rest-menu svelte-1uha8ag"><button class="rest-option svelte-1uha8ag">‚òï Short Rest</button> <button class="rest-option svelte-1uha8ag">üõèÔ∏è Long Rest</button></div>'),jo=u('<div class="container svelte-1uha8ag"><header class="svelte-1uha8ag"><div class="header-top svelte-1uha8ag"><div class="header-title svelte-1uha8ag"><div class="title-row svelte-1uha8ag"><h1 class="svelte-1uha8ag">D&D Character Sheet</h1> <!></div> <!> <!></div> <div class="header-right svelte-1uha8ag"><div class="header-controls svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">üé≤</span><span class="btn-text svelte-1uha8ag">Roll Dice</span></button> <div class="rest-button-container svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">üò¥</span><span class="btn-text svelte-1uha8ag">Rest</span></button> <!></div> <button class="btn btn-secondary use-enabled" title="Add custom condition with effects"><span class="btn-icon svelte-1uha8ag">‚ú®</span><span class="btn-text svelte-1uha8ag">Add Condition</span></button> <div class="mode-toggle"><button><span class="btn-icon svelte-1uha8ag"> </span><span class="btn-text svelte-1uha8ag"> </span></button> <button class="btn btn-mode svelte-1uha8ag" title="Toggle dark mode"><span class="btn-icon svelte-1uha8ag"> </span> <span class="btn-text svelte-1uha8ag"> </span></button></div></div> <div class="header-search svelte-1uha8ag"><input type="text" placeholder="üîç Search..." class="search-input use-enabled svelte-1uha8ag"/></div></div></div> <div class="header-actions svelte-1uha8ag"><button class="btn btn-mode svelte-1uha8ag">üìö Browse Spells & Feats</button> <button class="btn btn-secondary">Save to Gist</button> <button class="btn btn-secondary">Load from Gist</button> <button class="btn btn-secondary">Export JSON</button> <button class="btn btn-secondary">Import JSON</button> <input type="file" accept=".json" style="display: none;"/></div></header> <main class="svelte-1uha8ag"><!> <!> <!> <!> <!> <!> <!> <!></main></div> <!> <!> <!> <!> <!>',1);function Ho(r,c){Yt(c,!1);const t=()=>ot(de,"$character",p),v=()=>ot(ka,"$isEditMode",p),f=()=>ot(xa,"$searchFilter",p),[p,m]=va();let $=C(!1);function y(D){n($,D),D?document.body.classList.add("dark-mode"):document.body.classList.remove("dark-mode"),localStorage.setItem("dnd-dark-mode",D?"true":"false")}function b(){y(!e($))}Sa(()=>{const D=localStorage.getItem("dnd-dark-mode");y(D==="true")});function K(){const D=[],ce=t().classFeatures.spellSlotsByLevel||{};for(let Ke=1;Ke<=9;Ke++){const ut=ce[Ke];if(ut&&ut.length>0){const E=ut.length,Ie=ut.filter(ze=>ze).length;D.push({level:Ke,available:E-Ie,total:E})}}return D}let P=C(!1),X=C(!1),Z=C(!1),ne=C(!1),z=C("save"),R=C(void 0),T=C(""),ae=C(""),me=C(""),We=C(!1),G=C([]),Pe=C("other"),ye=C(),he=!1,Ae=1,B=C(!1),F=C(null);function x(D){n(F,D)}function J(){n(F,null)}function h(D){n(F,e(F)===D?null:D)}function I(D){de.update(ce=>(ce.activeStates||(ce.activeStates=[]),ce.activeStates=[...ce.activeStates,D],ce)),n(ne,!1),Nt.add(`Added condition: ${D.name}`,"success")}function se(){n(ne,!1)}function fe(){const D=[];de.update(E=>{const Ie=E.hitDice.current;E.hitDice.current=Math.min(E.hitDice.max,E.hitDice.current+Math.max(1,Math.floor(E.hitDice.max/2)));const ze=E.hitDice.current-Ie;if(ze>0&&D.push(`${ze} hit ${ze===1?"die":"dice"}`),E.class){const xt=Ta(E.class,E.level,E.subclass);E.classFeatures.features||(E.classFeatures.features={}),xt.forEach(Ye=>{if(Ye.resetOn==="short"){const Ct=Ye.name.replace(/\s+/g,"");if(Ye.type==="uses"){const Ne=typeof Ye.maxUses=="function"?Ye.maxUses(E.level):Ye.maxUses;E.classFeatures.features[Ct]=Array(Ne).fill(!1),D.push(Ye.name)}else if(Ye.type==="pool"){const Ne=typeof Ye.maxPool=="function"?Ye.maxPool(E.level):Ye.maxPool;Ne!==void 0&&(E.classFeatures.features[Ct]=Ne,D.push(Ye.name))}}})}return E.activeStates&&E.activeStates.forEach(xt=>{xt.abilities&&xt.abilities.forEach(Ye=>{if(Ye.restType==="short"&&Ye.usesPerRest){const Ct=Ye.usesPerRest-(Ye.currentUses||0)>0;Ye.currentUses=Ye.usesPerRest,Ct&&D.push(`${xt.name}: ${Ye.name}`)}})}),E}),ws("short"),ks(t().race,t().level).some(E=>E.restType==="short"&&E.usesPerRest)&&D.push("racial traits"),n(B,!1);const ut=D.length>0?`Short rest taken! Restored: ${D.join(", ")}`:"Short rest taken!";Nt.add(ut,"success")}function ue(){const D=[];de.update(E=>{const Ie=E.maxHP-E.currentHP;Ie>0&&D.push(`${Ie} HP`),E.currentHP=E.maxHP,E.tempHP=0;const ze=E.hitDice.max-E.hitDice.current;ze>0&&D.push(`${ze} hit ${ze===1?"die":"dice"}`),E.hitDice.current=E.hitDice.max;let xt=0;if(E.classFeatures.spellSlotsByLevel&&Object.keys(E.classFeatures.spellSlotsByLevel).forEach(Ye=>{const Ct=E.classFeatures.spellSlotsByLevel[parseInt(Ye)];if(Ct){const Ne=Ct.filter(mt=>mt).length;xt+=Ne,E.classFeatures.spellSlotsByLevel[parseInt(Ye)]=Array(Ct.length).fill(!1)}}),xt>0&&D.push(`${xt} spell ${xt===1?"slot":"slots"}`),E.class){const Ye=Ta(E.class,E.level,E.subclass);E.classFeatures.features||(E.classFeatures.features={});let Ct=!1;Ye.forEach(Ne=>{const mt=Ne.name.replace(/\s+/g,"");if(!(Ne.type==="info"||Ne.type==="channelDivinity")){if(Ne.type==="uses"){const Mt=typeof Ne.maxUses=="function"?Ne.maxUses(E.level):Ne.maxUses;E.classFeatures.features[mt]=Array(Mt).fill(!1),Ct=!0}else if(Ne.type==="pool"){const Mt=typeof Ne.maxPool=="function"?Ne.maxPool(E.level):Ne.maxPool;Mt!==void 0&&(E.classFeatures.features[mt]=Mt,Ct=!0)}}}),Ct&&D.push("all class features")}if(E.activeStates){let Ye=!1;E.activeStates.forEach(Ct=>{Ct.abilities&&Ct.abilities.forEach(Ne=>{if(Ne.usesPerRest){const mt=(Ne.currentUses||0)<Ne.usesPerRest;Ne.currentUses=Ne.usesPerRest,mt&&(Ye=!0)}})}),Ye&&D.push("condition abilities")}return E}),ws("long"),ks(t().race,t().level).some(E=>E.usesPerRest)&&D.push("racial traits"),n(B,!1);const ut=D.length>0?`Long rest taken! Restored: ${D.join(", ")}`:"Long rest taken! Fully rested.";Nt.add(ut,"success")}function pe(D){n(T,""),n(ae,""),n(me,""),n(We,!1),n(G,[]),n(Pe,"other"),he=!1,typeof D=="string"?n(T,D):(n(T,D.notation),n(ae,D.damageNotation||""),n(me,D.attackName||""),n(We,!!D.applyHalfDamage),n(G,D.bonusBreakdown||[]),n(Pe,D.rollType||"other")),n(P,!0)}function ke(D){const{notation:ce,count:Ke,bonusBreakdown:ut}=D.detail;n(T,""),he=!0,Ae=Ke||1,setTimeout(()=>{n(T,ce),n(ae,""),n(me,"Hit Die"),n(G,ut||[]),n(Pe,"other")},0),n(P,!0)}function Je(){if(n(P,!1),he&&e(ye)){const D=e(ye).getLastRollTotal();if(D!==null){const ce=Math.max(1,D);de.update(Ke=>(Ke.hitDice.current=Math.max(0,Ke.hitDice.current-Ae),Ke.currentHP=Math.min(Ke.maxHP,Ke.currentHP+ce),Ke))}he=!1}}function st(){ka.update(D=>!D)}function ct(D){D.target.closest(".rest-button-container")||n(B,!1)}Sa(()=>{const D=ka.subscribe(ce=>{ce?document.body.classList.remove("use-mode"):document.body.classList.add("use-mode")});return document.addEventListener("click",ct),()=>{D(),document.removeEventListener("click",ct)}});function ht(){ml(t())}function vt(){e(R)?.click()}async function at(D){const Ke=D.target.files?.[0];if(Ke)try{const ut=await gl(Ke);de.set(ut),alert("Character imported successfully!")}catch{alert("Failed to import character file")}}Jt();var At=jo();fl("1uha8ag",D=>{var ce=vo();aa(2),Ps(()=>{cl.title="D&D Character Sheet"}),o(D,ce)});var jt=$e(At),w=l(jt),q=l(w),_=l(q),H=l(_),V=a(l(H),2);{var re=D=>{var ce=uo(),Ke=l(ce);s(ce),A(()=>k(Ke,`${t().name??""} (${t().level??""})`)),o(D,ce)};g(V,D=>{t().name&&D(re)})}s(H);var Se=a(H,2);{var Ce=D=>{var ce=po();St(ce,5,K,Lt,(Ke,ut)=>{var E=fo();let Ie;var ze=l(E);s(E),A(()=>{Ie=Et(E,1,"slot-badge svelte-1uha8ag",null,Ie,{depleted:e(ut).available===0}),k(ze,`Lv${e(ut).level??""}: ${e(ut).available??""}/${e(ut).total??""}`)}),o(Ke,E)}),s(ce),o(D,ce)};g(Se,D=>{K().length>0&&D(Ce)})}var Re=a(Se,2);{var ee=D=>{var ce=Lo(),Ke=$e(ce);St(Ke,5,()=>t().activeStates,Lt,(ut,E,Ie)=>{var ze=Do(),xt=l(ze),Ye=a(xt);{var Ct=Mt=>{var Ot=So(),Rt=l(Ot),gt=l(Rt,!0);s(Rt);var et=a(Rt,2),Tt=a(et,3);{var Zt=lt=>{var nt=mo(),wt=$e(nt),Pt=l(wt);s(wt),aa(),A(()=>k(Pt,`Attack Bonus: ${typeof e(E).attackBonus=="number"&&e(E).attackBonus>0?"+":""}${e(E).attackBonus??""}`)),o(lt,nt)};g(Tt,lt=>{e(E).attackBonus&&lt(Zt)})}var Kt=a(Tt,2);{var fa=lt=>{var nt=go(),wt=$e(nt),Pt=l(wt);s(wt),aa(),A(()=>k(Pt,`Damage Bonus: ${typeof e(E).damageBonus=="number"&&e(E).damageBonus>0?"+":""}${e(E).damageBonus??""}`)),o(lt,nt)};g(Kt,lt=>{e(E).damageBonus&&lt(fa)})}var ia=a(Kt,2);{var pa=lt=>{var nt=bo(),wt=$e(nt),Pt=l(wt);s(wt),aa(),A(()=>k(Pt,`AC Bonus: ${e(E).acBonus>0?"+":""}${e(E).acBonus??""}`)),o(lt,nt)};g(ia,lt=>{e(E).acBonus&&lt(pa)})}var Gt=a(ia,2);{var ea=lt=>{var nt=ho(),wt=$e(nt),Pt=l(wt);s(wt),aa(),A(()=>k(Pt,`Darkvision: ${e(E).darkvision??""} feet`)),o(lt,nt)};g(Gt,lt=>{e(E).darkvision&&lt(ea)})}var qt=a(Gt,2);{var Ht=lt=>{var nt=_o(),wt=$e(nt),Pt=l(wt);s(wt),aa(),A(Vt=>k(Pt,`Resistances: ${Vt??""}`),[()=>e(E).resistances.join(", ")]),o(lt,nt)};g(qt,lt=>{e(E).resistances&&e(E).resistances.length>0&&lt(Ht)})}var la=a(qt,2);{var ga=lt=>{var nt=yo(),wt=$e(nt),Pt=l(wt);s(wt),aa(),A(Vt=>k(Pt,`Immunities: ${Vt??""}`),[()=>e(E).immunities.join(", ")]),o(lt,nt)};g(la,lt=>{e(E).immunities&&e(E).immunities.length>0&&lt(ga)})}var ba=a(la,2);{var zt=lt=>{var nt=ko(),wt=a(l(nt),3);St(wt,1,()=>e(E).abilities,Lt,(Pt,Vt)=>{var na=wo(),ra=l(na),Bt=l(ra);s(ra);var ta=a(ra),Ra=a(ta);{var es=$a=>{var oa=xo(),ha=a($e(oa)),Ba=l(ha),Fa=a(Ba);{var as=ss=>{var qs=It(", requires reaction");o(ss,qs)};g(Fa,ss=>{e(Vt).requiresReaction&&ss(as)})}aa(),s(ha),A(()=>k(Ba,`(${(e(Vt).currentUses||0)??""}/${e(Vt).usesPerRest??""} uses per ${e(Vt).restType??""}
                                rest`)),o($a,oa)},ts=$a=>{var oa=bt(),ha=$e(oa);{var Ba=Fa=>{var as=$o();aa(),o(Fa,as)};g(ha,Fa=>{e(Vt).requiresReaction&&Fa(Ba)},!0)}o($a,oa)};g(Ra,$a=>{e(Vt).usesPerRest?$a(es):$a(ts,!1)})}s(na),A(()=>{k(Bt,`${e(Vt).name??""}:`),k(ta,` ${e(Vt).description??""} `)}),o(Pt,na)}),s(nt),o(lt,nt)};g(ba,lt=>{e(E).abilities&&e(E).abilities.length>0&&lt(zt)})}s(Ot),A(()=>{k(gt,e(E).name),k(et,` ${e(E).description??""}`)}),o(Mt,Ot)};g(Ye,Mt=>{e(F)===Ie&&Mt(Ct)})}var Ne=a(Ye,2);{var mt=Mt=>{var Ot=Co();A(()=>tt(Ot,"title",`End ${e(E).name??""}`)),j("click",Ot,()=>{de.update(Rt=>{if(Rt.activeStates){const gt=Rt.activeStates[Ie];gt?.hpBonus&&gt.target!=="other"&&(Rt.maxHP-=gt.hpBonus,Rt.currentHP=Math.max(1,Math.min(Rt.currentHP-gt.hpBonus,Rt.maxHP))),Rt.activeStates=Rt.activeStates.filter((et,Tt)=>Tt!==Ie)}return Rt})}),o(Mt,Ot)};g(Ne,Mt=>{v()||Mt(mt)})}s(ze),A(()=>{tt(ze,"aria-label",e(E).name),k(xt,`‚ú® ${e(E).name??""} `)}),j("mouseenter",ze,()=>x(Ie)),j("mouseleave",ze,J),j("focus",ze,()=>x(Ie)),j("blur",ze,J),j("click",ze,()=>h(Ie)),o(ut,ze)}),s(Ke),aa(2),o(D,ce)};g(Re,D=>{t().activeStates&&t().activeStates.length>0&&D(ee)})}s(_);var S=a(_,2),Y=l(S),xe=l(Y),Oe=a(xe,2),Qe=l(Oe),ft=a(Qe,2);{var De=D=>{var ce=Ao(),Ke=l(ce),ut=a(Ke,2);s(ce),j("click",Ke,fe),j("click",ut,ue),o(D,ce)};g(ft,D=>{e(B)&&D(De)})}s(Oe);var Q=a(Oe,2),d=a(Q,2),He=l(d);let ge;var U=l(He),be=l(U,!0);s(U);var te=a(U),Be=l(te,!0);s(te),s(He);var _e=a(He,2),qe=l(_e),Ge=l(qe,!0);s(qe);var Xe=a(qe,2),it=l(Xe,!0);s(Xe),s(_e),s(d),s(Y);var oe=a(Y,2),L=l(oe);we(L),s(oe),s(S),s(q);var O=a(q,2),W=l(O),le=a(W,2),Me=a(le,2),Ue=a(Me,2),Te=a(Ue,2),Le=a(Te,2);Ua(Le,D=>n(R,D),()=>e(R)),s(O),s(w);var rt=a(w,2),dt=l(rt);Fl(dt,{});var Fe=a(dt,2);Hl(Fe,{$$events:{roll:D=>pe(D.detail)}});var je=a(Fe,2);ir(je,{$$events:{roll:D=>pe(D.detail)}});var $t=a(je,2);ar($t,{$$events:{rollHitDice:ke}});var ve=a($t,2);co(ve,{});var ie=a(ve,2);bi(ie,{$$events:{roll:D=>pe(D.detail)}});var Ze=a(ie,2);Oi(Ze,{});var _t=a(Ze,2);zi(_t,{}),s(rt),s(jt);var Ft=a(jt,2);Ua(un(Ft,{get notation(){return e(T)},get damageNotation(){return e(ae)},get attackName(){return e(me)},get applyHalfDamage(){return e(We)},get bonusBreakdown(){return e(G)},get rollType(){return e(Pe)},get visible(){return e(P)},$$events:{close:Je},$$legacy:!0}),D=>n(ye,D),()=>e(ye));var yt=a(Ft,2);{var M=D=>{Bn(D,{get mode(){return e(z)},$$events:{close:()=>n(X,!1)}})};g(yt,D=>{e(X)&&D(M)})}var pt=a(yt,2);{var Xt=D=>{Vn(D,{onClose:()=>n(Z,!1)})};g(pt,D=>{e(Z)&&D(Xt)})}var da=a(pt,2);ao(da,{get show(){return e(ne)},onSave:I,onCancel:se});var ua=a(da,2);pl(ua,{}),A(()=>{ge=Et(He,1,"btn btn-mode svelte-1uha8ag",null,ge,{"use-mode":!v()}),k(be,v()?"üìù":"üé≤"),k(Be,v()?"Edit Mode":"Use Mode"),k(Ge,e($)?"‚òÄÔ∏è":"üåô"),k(it,e($)?"Light Mode":"Dark Mode")}),j("click",xe,()=>{n(G,[]),n(P,!0)}),j("click",Qe,()=>n(B,!e(B))),j("click",Q,()=>n(ne,!0)),j("click",He,st),j("click",_e,b),Ee(L,f,D=>bl(xa,D)),j("click",W,()=>n(Z,!0)),j("click",le,()=>{n(z,"save"),n(X,!0)}),j("click",Me,()=>{n(z,"load"),n(X,!0)}),j("click",Ue,ht),j("click",Te,vt),j("change",Le,at),o(r,At),Qt(),m()}export{Ho as component};
