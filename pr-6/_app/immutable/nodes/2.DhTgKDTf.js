import{f as u,e as B,a as c,s as L,c as ot,t as jt}from"../chunks/DBs_ODQp.js";import{i as Bt}from"../chunks/BbaRvQ4Z.js";import{c as Zt,o as na,a as Ja}from"../chunks/CHX4V4AM.js";import{a7 as Ta,i as Ha,aZ as Va,a_ as Qa,a$ as wa,K as Vt,e as Na,b0 as Ua,T as ma,b1 as Xa,b2 as Ya,b3 as Za,q as es,b4 as ts,b5 as as,ab as ss,d as r,r as Ga,g as ls,C as It,F as R,G as Rt,H as i,I as l,J as s,b6 as Qe,b7 as Wt,s as v,a4 as E,f as e,m as Xe,E as Ne,A as N,b8 as Sa,b9 as Dt,ba as ia,ao as pa,bb as is}from"../chunks/DwmZeGF1.js";import{c as At,a as Q,e as ut,i as pt,u as Oa,s as Qt,b as ft,d as oa,f as ta,g as rs,t as Et,h as ns,T as os,j as cs,k as vs}from"../chunks/DQJFtNtV.js";import{i as y,s as Nt,a as ze,b as nt,d as ca,e as ds}from"../chunks/0ovU14Ao.js";import{p as mt,b as xa}from"../chunks/CFUzmRYW.js";import{b as la,r as us}from"../chunks/DEkNBiaQ.js";function fa(a,n,t=!1){if(a.multiple){if(n==null)return;if(!Ha(n))return Va();for(var d of a.options)d.selected=n.includes(ra(d));return}for(d of a.options){var p=ra(d);if(Qa(p,n)){d.selected=!0;return}}(!t||n!==void 0)&&(a.selectedIndex=-1)}function $a(a){var n=new MutationObserver(()=>{fa(a,a.__value)});n.observe(a,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Ta(()=>{n.disconnect()})}function qa(a,n,t=n){var d=new WeakSet,p=!0;wa(a,"change",m=>{var S=m?"[selected]":":checked",M;if(a.multiple)M=[].map.call(a.querySelectorAll(S),ra);else{var k=a.querySelector(S)??a.querySelector("option:not([disabled])");M=k&&ra(k)}t(M),Vt!==null&&d.add(Vt)}),Na(()=>{var m=n();if(a===document.activeElement){var S=Ua??Vt;if(d.has(S))return}if(fa(a,m,p),p&&m===void 0){var M=a.querySelector(":checked");M!==null&&(m=ra(M),t(m))}a.__value=m,p=!1}),$a(a)}function ra(a){return"__value"in a?a.__value:a.value}const ps=Symbol("is custom element"),fs=Symbol("is html");function $e(a){if(ma){var n=!1,t=()=>{if(!n){if(n=!0,a.hasAttribute("value")){var d=a.value;ct(a,"value",null),a.value=d}if(a.hasAttribute("checked")){var p=a.checked;ct(a,"checked",null),a.checked=p}}};a.__on_r=t,es(t),ts()}}function ga(a,n){var t=Da(a);t.value===(t.value=n??void 0)||a.value===n&&(n!==0||a.nodeName!=="PROGRESS")||(a.value=n??"")}function gs(a,n){var t=Da(a);t.checked!==(t.checked=n??void 0)&&(a.checked=n)}function ct(a,n,t,d){var p=Da(a);ma&&(p[n]=a.getAttribute(n),n==="src"||n==="srcset"||n==="href"&&a.nodeName==="LINK")||p[n]!==(p[n]=t)&&(n==="loading"&&(a[Xa]=t),t==null?a.removeAttribute(n):typeof t!="string"&&bs(a).includes(n)?a[n]=t:a.setAttribute(n,t))}function Da(a){return a.__attributes??={[ps]:a.nodeName.includes("-"),[fs]:a.namespaceURI===Ya}}var Aa=new Map;function bs(a){var n=a.getAttribute("is")||a.nodeName,t=Aa.get(n);if(t)return t;Aa.set(n,t=[]);for(var d,p=a,m=Element.prototype;m!==p;){d=as(p);for(var S in d)d[S].set&&t.push(S);p=Za(p)}return t}function Ae(a,n,t=n){var d=new WeakSet;wa(a,"input",async p=>{var m=p?a.defaultValue:a.value;if(m=_a(a)?ya(m):m,t(m),Vt!==null&&d.add(Vt),await ss(),m!==(m=n())){var S=a.selectionStart,M=a.selectionEnd,k=a.value.length;if(a.value=m??"",M!==null){var P=a.value.length;S===M&&M===k&&P>k?(a.selectionStart=P,a.selectionEnd=P):(a.selectionStart=S,a.selectionEnd=Math.min(M,P))}}}),(ma&&a.defaultValue!==a.value||r(n)==null&&a.value)&&(t(_a(a)?ya(a.value):a.value),Vt!==null&&d.add(Vt)),Ga(()=>{var p=n();if(a===document.activeElement){var m=Ua??Vt;if(d.has(m))return}_a(a)&&p===ya(a.value)||a.type==="date"&&!p&&!a.value||p!==a.value&&(a.value=p??"")})}function ba(a,n,t=n){wa(a,"change",d=>{var p=d?a.defaultChecked:a.checked;t(p)}),(ma&&a.defaultChecked!==a.checked||r(n)==null)&&t(a.checked),Ga(()=>{var d=n();a.checked=!!d})}function _a(a){var n=a.type;return n==="number"||n==="range"}function ya(a){return a===""?null:+a}function ms(a,n,t){var d=ls(a,n);d&&d.set&&(a[n]=t,Ta(()=>{a[n]=null}))}function ja(a){return function(...n){var t=n[0];return t.stopPropagation(),a?.apply(this,n)}}function aa(a,n){var t=a.$$events?.[n.type],d=Ha(t)?t.slice():t==null?[]:[t];for(var p of d)p.call(this,n)}const hs="";function Wa(...a){return la+hs+us(a[0],a[1])}const Ca={paladin:{name:"Paladin",hitDice:"d10",spellcaster:!0,spellcastingAbility:"charisma",spellSlotsByLevel:{1:0,2:2,3:3,4:3,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Divine Sense",type:"uses",maxUses:(a,n=1)=>1+Math.max(1,n),resetOn:"long",description:"Detect celestials, fiends, and undead within 60 feet",minLevel:1},{name:"Lay on Hands",type:"pool",maxPool:a=>a*5,resetOn:"long",description:"Heal wounds or cure disease",minLevel:1},{name:"Divine Smite",type:"spellSlot",description:"Expend spell slot to deal extra radiant damage",minLevel:2,rollable:!0},{name:"Channel Divinity",type:"pool",maxPool:a=>a>=18?3:a>=6?2:1,resetOn:"short",description:"Sacred Weapon or Turn Undead",minLevel:3}]},fighter:{name:"Fighter",hitDice:"d10",spellcaster:!1,features:[{name:"Second Wind",type:"uses",maxUses:1,resetOn:"short",description:"Regain 1d10 + fighter level HP as bonus action",minLevel:1,rollable:!0,rollFormula:a=>`1d10+${a}`},{name:"Action Surge",type:"uses",maxUses:a=>a>=17?2:1,resetOn:"short",description:"Take one additional action on your turn",minLevel:2},{name:"Indomitable",type:"uses",maxUses:a=>a>=17?3:a>=13?2:1,resetOn:"long",description:"Reroll a failed saving throw",minLevel:9}],subclasses:{champion:{name:"Champion",features:[{name:"Improved Critical",type:"info",description:"Critical hit on 19-20",minLevel:3},{name:"Remarkable Athlete",type:"info",description:"Add half proficiency to STR/DEX/CON checks, increase long jump distance",minLevel:7},{name:"Additional Fighting Style",type:"info",description:"Choose a second fighting style",minLevel:10},{name:"Superior Critical",type:"info",description:"Critical hit on 18-20",minLevel:15},{name:"Survivor",type:"info",description:"Regain 5 + CON mod HP at start of turn if below half HP",minLevel:18}]},battlemaster:{name:"Battle Master",features:[{name:"Combat Superiority",type:"uses",maxUses:a=>a>=15?6:a>=7?5:4,resetOn:"short",description:a=>`Use superiority dice (${a>=18?"d12":a>=10?"d10":"d8"}) for maneuvers`,minLevel:3},{name:"Know Your Enemy",type:"info",description:"Learn capabilities of creatures you observe",minLevel:7},{name:"Improved Combat Superiority",type:"info",description:"Superiority dice become d10",minLevel:10},{name:"Relentless",type:"info",description:"Regain 1 superiority die if you have none at start of turn",minLevel:15}]}}},rogue:{name:"Rogue",hitDice:"d8",spellcaster:!1,features:[{name:"Sneak Attack",type:"info",description:a=>`Deal ${Math.ceil(a/2)}d6 extra damage once per turn with advantage or ally nearby`,minLevel:1,rollable:!0,rollFormula:a=>`${Math.ceil(a/2)}d6`},{name:"Cunning Action",type:"info",description:"Dash, Disengage, or Hide as a bonus action",minLevel:2},{name:"Uncanny Dodge",type:"info",description:"Use reaction to halve damage from an attack",minLevel:5},{name:"Evasion",type:"info",description:"Take no damage on successful Dex save (half on fail)",minLevel:7}]},wizard:{name:"Wizard",hitDice:"d6",spellcaster:!0,spellcastingAbility:"intelligence",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Arcane Recovery",type:"uses",maxUses:1,resetOn:"long",description:a=>`Recover spell slots totaling up to ${Math.ceil(a/2)} levels during short rest`,minLevel:1},{name:"Spell Mastery",type:"info",description:"Cast one 1st-level and one 2nd-level spell at will",minLevel:18}]},cleric:{name:"Cleric",hitDice:"d8",spellcaster:!0,spellcastingAbility:"wisdom",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Channel Divinity",type:"pool",maxPool:a=>a>=18?3:a>=6?2:1,resetOn:"short",description:"Turn Undead or domain-specific ability",minLevel:2},{name:"Destroy Undead",type:"info",description:a=>`Channel Divinity destroys undead of CR ${a>=17?4:a>=14?3:a>=11?2:a>=8?1:.5} or lower`,minLevel:5},{name:"Divine Intervention",type:"uses",maxUses:1,resetOn:"long",description:a=>`${a}% chance to succeed, implore deity for aid`,minLevel:10}],subclasses:{war:{name:"War Domain",features:[{name:"War Priest",type:"uses",maxUses:(a,n=1)=>Math.max(1,n),resetOn:"long",description:"Make one weapon attack as a bonus action",minLevel:1},{name:"Guided Strike",type:"channelDivinity",description:"Use your Channel Divinity to gain +10 to an attack roll. Make this choice after you see the roll, but before the DM says whether the attack hits or misses.",minLevel:2,resetOn:"short"},{name:"War God's Blessing",type:"channelDivinity",description:"Use reaction to grant +10 to an ally's attack roll within 30 feet. Consumes one use of Channel Divinity.",minLevel:6,resetOn:"short"},{name:"Divine Strike",type:"info",description:a=>`Deal extra ${a>=14?"2d8":"1d8"} weapon damage once per turn`,minLevel:8,rollable:!0,rollFormula:a=>a>=14?"2d8":"1d8"},{name:"Avatar of Battle",type:"info",description:"Gain resistance to nonmagical weapon damage",minLevel:17}]},life:{name:"Life Domain",features:[{name:"Disciple of Life",type:"info",description:"Healing spells restore additional 2 + spell level HP",minLevel:1},{name:"Preserve Life",type:"pool",maxPool:a=>a*5,resetOn:"short",description:"Restore HP to creatures within 30 feet",minLevel:2},{name:"Blessed Healer",type:"info",description:"Regain 2 + spell level HP when you cast healing spell",minLevel:6},{name:"Divine Strike",type:"info",description:a=>`Deal extra ${a>=14?"2d8":"1d8"} radiant damage once per turn`,minLevel:8,rollable:!0,rollFormula:a=>a>=14?"2d8":"1d8"},{name:"Supreme Healing",type:"info",description:"Maximize healing dice instead of rolling",minLevel:17}]}}},barbarian:{name:"Barbarian",hitDice:"d12",spellcaster:!1,features:[{name:"Rage",type:"uses",maxUses:a=>a>=20?1/0:a>=17?6:a>=12?5:a>=6?4:a>=3?3:2,resetOn:"long",description:a=>`+${a>=16?4:a>=9?3:2} damage, resistance to physical damage`,minLevel:1},{name:"Reckless Attack",type:"info",description:"Gain advantage on melee attacks, enemies get advantage on you",minLevel:2},{name:"Danger Sense",type:"info",description:"Advantage on Dex saves against effects you can see",minLevel:2}],subclasses:{berserker:{name:"Path of the Berserker",features:[{name:"Frenzy",type:"info",description:"While raging, make melee attack as bonus action (gain 1 exhaustion after rage)",minLevel:3},{name:"Mindless Rage",type:"info",description:"Cannot be charmed or frightened while raging",minLevel:6},{name:"Intimidating Presence",type:"info",description:"Use action to frighten creature within 30 feet",minLevel:10},{name:"Retaliation",type:"info",description:"When damaged by creature within 5 feet, make melee attack as reaction",minLevel:14}]}}}};function Pt(a){const n=a.toLowerCase();return Ca[n]||null}function sa(a,n,t){const d=Pt(a);if(!d)return[];const p=d.features.filter(m=>!m.minLevel||m.minLevel<=n);if(t&&d.subclasses&&d.subclasses[t]){const m=d.subclasses[t].features.filter(S=>!S.minLevel||S.minLevel<=n);return[...p,...m]}return p}function Fa(a){const n=Pt(a);return!n||!n.subclasses?[]:Object.keys(n.subclasses).map(t=>({id:t,name:n.subclasses[t].name}))}function Ma(a,n){const t=Pt(a);return!t||!t.spellcaster||!t.spellSlotsByLevel?0:t.spellSlotsByLevel[n]||0}function Ba(a,n,t){const d=Pt(a);return!d||!d.spellcaster?0:Math.max(1,t+n)}function _s(a,n,t){const d=Pt(a);return!d||!d.spellcaster?null:8+n+t}function ys(){return Object.keys(Ca).map(a=>({id:a,name:Ca[a].name}))}var ks=u('<div class="section-header svelte-ls99y2" role="button" tabindex="0"><h2 class="svelte-ls99y2"> </h2> <span class="collapse-btn svelte-ls99y2"> </span></div>');function ea(a,n){It(n,!1);let t=mt(n,"title",8),d=mt(n,"collapsed",8),p=mt(n,"ariaLabel",8,""),m=mt(n,"onToggle",8);Bt();var S=ks(),M=i(S),k=i(M,!0);l(M);var P=s(M,2),ae=i(P,!0);l(P),l(S),R(()=>{ct(S,"aria-expanded",!d()),ct(S,"aria-label",p()),L(k,t()),L(ae,d()?"â–¼":"â–²")}),B("click",S,function(...z){m()?.apply(this,z)}),B("keydown",S,z=>{(z.key==="Enter"||z.key===" ")&&m()()}),c(a,S),Rt()}var Ss=u("<option> </option>"),xs=u("<option> </option>"),$s=u('<div class="form-group svelte-172i2fj"><label for="characterSubclass" class="svelte-172i2fj">Subclass</label> <select id="characterSubclass" class="svelte-172i2fj"><option>Select Subclass</option><!></select></div>'),Cs=u('<div class="info-grid svelte-172i2fj"><div class="form-group svelte-172i2fj"><label for="characterName" class="svelte-172i2fj">Character Name</label> <input type="text" id="characterName" placeholder="Enter name" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterClass" class="svelte-172i2fj">Class</label> <select id="characterClass" class="svelte-172i2fj"><option>Select Class</option><!></select></div> <!> <div class="form-group svelte-172i2fj"><label for="characterLevel" class="svelte-172i2fj">Level</label> <input type="number" id="characterLevel" min="1" max="20" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterRace" class="svelte-172i2fj">Race</label> <input type="text" id="characterRace" placeholder="e.g., Human" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterBackground" class="svelte-172i2fj">Background</label> <input type="text" id="characterBackground" placeholder="e.g., Soldier" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterAlignment" class="svelte-172i2fj">Alignment</label> <input type="text" id="characterAlignment" placeholder="e.g., Lawful Good" class="svelte-172i2fj"/></div></div>'),Ls=u('<section class="character-info svelte-172i2fj"><!> <!></section>');function ws(a,n){It(n,!1);const t=()=>ze(Q,"$character",p),d=()=>ze(At,"$collapsedStates",p),[p,m]=Nt(),S=E(),M=ys();function k(Y){const le=Y.target;Q.update(Z=>(Z.class=le.value,Z.subclass="",Z))}function P(Y){const le=Y.target;Q.update(Z=>(Z.subclass=le.value,Z))}function ae(Y){const le=Y.target;Q.update(Z=>(Z.level=parseInt(le.value)||1,Z)),Oa()}Qe(()=>(t(),Fa),()=>{v(S,t().class?Fa(t().class):[])}),Wt(),Bt();var z=Ls(),G=i(z);{let Y=Xe(()=>(d(),r(()=>d().characterInfo?"Expand":"Collapse")));ea(G,{title:"Character Info",get collapsed(){return d(),r(()=>d().characterInfo)},get ariaLabel(){return e(Y)},onToggle:()=>At.update(le=>({...le,characterInfo:!le.characterInfo}))})}var ke=s(G,2);{var ne=Y=>{var le=Cs(),Z=i(le),Ue=s(i(Z),2);$e(Ue),l(Z);var H=s(Z,2),q=s(i(H),2),K=i(q);K.value=K.__value="";var be=s(K);ut(be,1,()=>M,pt,($,O)=>{var A=Ss(),J=i(A,!0);l(A);var Me={};R(()=>{L(J,(e(O),r(()=>e(O).name))),Me!==(Me=(e(O),r(()=>e(O).id)))&&(A.value=(A.__value=(e(O),r(()=>e(O).id)))??"")}),c($,A)}),l(q);var ce;$a(q),l(H);var Re=s(H,2);{var Ee=$=>{var O=$s(),A=s(i(O),2),J=i(A);J.value=J.__value="";var Me=s(J);ut(Me,1,()=>e(S),pt,(me,Pe)=>{var we=xs(),it=i(we,!0);l(we);var Ye={};R(()=>{L(it,(e(Pe),r(()=>e(Pe).name))),Ye!==(Ye=(e(Pe),r(()=>e(Pe).id)))&&(we.value=(we.__value=(e(Pe),r(()=>e(Pe).id)))??"")}),c(me,we)}),l(A);var Se;$a(A),l(O),R(()=>{Se!==(Se=(t(),r(()=>t().subclass)))&&(A.value=(A.__value=(t(),r(()=>t().subclass)))??"",fa(A,(t(),r(()=>t().subclass))))}),B("change",A,P),c($,O)};y(Re,$=>{e(S),r(()=>e(S).length>0)&&$(Ee)})}var Ge=s(Re,2),fe=s(i(Ge),2);$e(fe),l(Ge);var x=s(Ge,2),ve=s(i(x),2);$e(ve),l(x);var h=s(x,2),I=s(i(h),2);$e(I),l(h);var ie=s(h,2),f=s(i(ie),2);$e(f),l(ie),l(le),R(()=>{ce!==(ce=(t(),r(()=>t().class)))&&(q.value=(q.__value=(t(),r(()=>t().class)))??"",fa(q,(t(),r(()=>t().class)))),ga(fe,(t(),r(()=>t().level)))}),Ae(Ue,()=>t().name,$=>nt(Q,r(t).name=$,r(t))),B("change",q,k),B("change",fe,ae),Ae(ve,()=>t().race,$=>nt(Q,r(t).race=$,r(t))),Ae(I,()=>t().background,$=>nt(Q,r(t).background=$,r(t))),Ae(f,()=>t().alignment,$=>nt(Q,r(t).alignment=$,r(t))),c(Y,le)};y(ke,Y=>{d(),r(()=>!d().characterInfo)&&Y(ne)})}l(z),c(a,z),Rt(),m()}var Ds=u('<div class="ability-card svelte-bbv1xt"><h3 class="svelte-bbv1xt"> </h3> <input type="number" class="ability-score svelte-bbv1xt" min="1" max="30"/> <div class="ability-modifier svelte-bbv1xt"> </div> <button class="roll-btn svelte-bbv1xt">Check</button> <div class="save-row svelte-bbv1xt"><input type="checkbox" class="svelte-bbv1xt"/> <label class="svelte-bbv1xt">Save</label> <button class="roll-btn-small svelte-bbv1xt">Roll</button></div></div>'),js=u('<div class="proficiency-bonus svelte-bbv1xt"><label for="profBonus">Proficiency Bonus</label> <input type="number" id="profBonus" class="prof-input svelte-bbv1xt"/></div> <div class="abilities-grid svelte-bbv1xt"></div>',1),As=u("<section><!> <!></section>");function Fs(a,n){It(n,!1);const t=()=>ze(oa,"$abilityModifiers",S),d=()=>ze(Q,"$character",S),p=()=>ze(Qt,"$searchFilter",S),m=()=>ze(At,"$collapsedStates",S),[S,M]=Nt(),k=E(),P=E(),ae=Zt(),z=[{key:"strength",label:"Strength"},{key:"dexterity",label:"Dexterity"},{key:"constitution",label:"Constitution"},{key:"intelligence",label:"Intelligence"},{key:"wisdom",label:"Wisdom"},{key:"charisma",label:"Charisma"}];function G(){Oa()}function ke(q){const K=t()[q],be=`1d20${K>=0?"+":""}${K}`;ae("roll",be)}function ne(q){const K=t()[q],be=d().saveProficiencies[q]?d().proficiencyBonus:0,ce=K+be,Re=`1d20${ce>=0?"+":""}${ce}`;ae("roll",Re)}Qe(()=>p(),()=>{v(k,z.filter(({label:q})=>p()?q.toLowerCase().includes(p().toLowerCase()):!0))}),Qe(()=>(e(k),p()),()=>{v(P,e(k).length>0||!p()||p().toLowerCase().includes("proficiency"))}),Wt(),Bt();var Y=As();let le;var Z=i(Y);ea(Z,{title:"Ability Scores",get collapsed(){return m(),r(()=>m().abilityScores)},ariaLabel:"Toggle Ability Scores Section",onToggle:()=>At.update(q=>({...q,abilityScores:!q.abilityScores}))});var Ue=s(Z,2);{var H=q=>{var K=js(),be=Ne(K),ce=s(i(be),2);$e(ce),l(be);var Re=s(be,2);ut(Re,5,()=>e(k),pt,(Ee,Ge)=>{let fe=()=>e(Ge).key,x=()=>e(Ge).label;var ve=Ds(),h=i(ve),I=i(h,!0);l(h);var ie=s(h,2);$e(ie);var f=s(ie,2),$=i(f);l(f);var O=s(f,2),A=s(O,2),J=i(A);$e(J);var Me=s(J,2),Se=s(Me,2);l(A),l(ve),R(me=>{L(I,me),L($,`${t(),fe(),r(()=>t()[fe()]>=0?"+":"")??""}${t(),fe(),r(()=>t()[fe()])??""}`),ct(J,"id",`${fe()}-save`),ct(Me,"for",`${fe()}-save`)},[()=>(x(),r(()=>x().substring(0,3).toUpperCase()))]),Ae(ie,()=>d().abilities[fe()],me=>nt(Q,r(d).abilities[fe()]=me,r(d))),B("change",ie,G),B("click",O,()=>ke(fe())),ba(J,()=>d().saveProficiencies[fe()],me=>nt(Q,r(d).saveProficiencies[fe()]=me,r(d))),B("click",Se,()=>ne(fe())),c(Ee,ve)}),l(Re),Ae(ce,()=>d().proficiencyBonus,Ee=>nt(Q,r(d).proficiencyBonus=Ee,r(d))),c(q,K)};y(Ue,q=>{m(),r(()=>!m().abilityScores)&&q(H)})}l(Y),R(()=>le=ft(Y,1,"ability-scores svelte-bbv1xt",null,le,{hidden:!e(P)})),c(a,Y),Rt(),M()}function Ms(a){return Math.floor((a-10)/2)}function La(a,n){if(!a.class)return null;const t=Pt(a.class);if(!t||!t.spellcaster||!t.spellcastingAbility)return null;const d=n[t.spellcastingAbility];return 8+a.proficiencyBonus+d}function Bs(a,n){if(!a.class)return 0;const t=Pt(a.class);return!t||!t.spellcaster||!t.spellcastingAbility?0:Ms(n[t.spellcastingAbility])}var Is=u('<input type="number" id="armorClass" class="stat-input svelte-1r5hyyb"/>'),Rs=u('<input type="text" id="armorClass" readonly=""/>'),Es=u('<div class="stat-box svelte-1r5hyyb"><label for="spellSaveDC" class="svelte-1r5hyyb">Spell Save DC</label> <input type="number" id="spellSaveDC" class="stat-input svelte-1r5hyyb" readonly="" title="8 + Proficiency Bonus + Spellcasting Ability Modifier"/></div>'),Ps=u('<span class="hit-dice-type"> </span>'),Ts=u('<div class="stats-grid svelte-1r5hyyb"><div class="stat-box svelte-1r5hyyb"><label for="armorClass" class="svelte-1r5hyyb">Armor Class</label> <!></div> <div class="stat-box svelte-1r5hyyb"><label for="initiative" class="svelte-1r5hyyb">Initiative</label> <input type="number" id="initiative" class="stat-input svelte-1r5hyyb"/></div> <div class="stat-box svelte-1r5hyyb"><label for="speed" class="svelte-1r5hyyb">Speed</label> <input type="text" id="speed" class="stat-input svelte-1r5hyyb"/></div> <!></div> <div class="hp-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Points</h3> <div class="hp-display svelte-1r5hyyb"><div class="hp-inputs svelte-1r5hyyb"><input type="number" class="hp-current svelte-1r5hyyb" min="0"/> <span class="hp-separator svelte-1r5hyyb">/</span> <input type="number" class="hp-max svelte-1r5hyyb" min="0"/></div> <div class="hp-controls svelte-1r5hyyb"><button class="hp-btn svelte-1r5hyyb">âˆ’</button> <button class="hp-btn svelte-1r5hyyb">+</button> <button class="hp-btn svelte-1r5hyyb">âˆ’5</button> <button class="hp-btn svelte-1r5hyyb">+5</button></div></div> <div class="temp-hp svelte-1r5hyyb"><label for="tempHP" class="svelte-1r5hyyb">Temp HP</label> <input type="number" id="tempHP" min="0" class="svelte-1r5hyyb"/></div></div> <div class="hit-dice-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Dice</h3> <div class="hit-dice-display svelte-1r5hyyb"><input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <span>/</span> <input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <!></div> <div class="hit-dice-controls"><label for="hitDiceCount" class="svelte-1r5hyyb">Roll</label> <input type="number" id="hitDiceCount" class="hit-dice-count-input svelte-1r5hyyb" min="1" value="1"/> <button class="btn btn-primary roll-hit-dice use-enabled svelte-1r5hyyb">ðŸŽ² Roll</button></div></div>',1),Hs=u("<section><!> <!></section>");function Ns(a,n){It(n,!1);const t=()=>ze(Q,"$character",M),d=()=>ze(oa,"$abilityModifiers",M),p=()=>ze(Qt,"$searchFilter",M),m=()=>ze(At,"$collapsedStates",M),S=()=>ze(ta,"$isEditMode",M),[M,k]=Nt(),P=E(),ae=E(),z=E(),G=Zt();function ke(q){Q.update(K=>(K.currentHP=Math.max(0,Math.min(K.maxHP,K.currentHP+q)),K))}function ne(q=1){if(t().hitDice.current<=0){alert("No hit dice remaining!");return}if(!t().class){alert("Please select a class first!");return}const K=Pt(t().class);if(!K){alert("Invalid class configuration!");return}const be=Math.min(q,t().hitDice.current),ce=K.hitDice,Re=d().constitution,Ee=Re>=0?`+${Re}`:`${Re}`,Ge=`${be}${ce}${Ee}`;G("rollHitDice",{notation:Ge,hitDie:ce,count:be})}console.log("Active States:",t().activeStates),Qe(()=>(t(),d()),()=>{v(P,La(t(),d()))}),Qe(()=>t(),()=>{v(ae,t().activeStates&&t().activeStates.length>0?t().activeStates.reduce((q,K)=>q+(K.acBonus||0),0):0)}),Qe(()=>p(),()=>{v(z,!p()||"armor class".includes(p().toLowerCase())||"initiative".includes(p().toLowerCase())||"speed".includes(p().toLowerCase())||"hit points".includes(p().toLowerCase())||"hp".includes(p().toLowerCase())||"hit dice".includes(p().toLowerCase())||"spell save".includes(p().toLowerCase())||"combat".includes(p().toLowerCase()))}),Wt(),Bt();var Y=Hs();let le;var Z=i(Y);{let q=Xe(()=>(m(),r(()=>m().combatStats?"Expand":"Collapse")));ea(Z,{title:"Combat Stats",get collapsed(){return m(),r(()=>m().combatStats)},get ariaLabel(){return e(q)},onToggle:()=>At.update(K=>({...K,combatStats:!K.combatStats}))})}var Ue=s(Z,2);{var H=q=>{var K=Ts(),be=Ne(K),ce=i(be),Re=s(i(ce),2);{var Ee=T=>{var b=Is();$e(b),Ae(b,()=>t().armorClass,re=>nt(Q,r(t).armorClass=re,r(t))),c(T,b)},Ge=T=>{var b=Rs();$e(b),R(()=>{ga(b,(e(ae),t(),r(()=>e(ae)!==0?`${t().armorClass} â†’ ${t().armorClass+e(ae)}`:`${t().armorClass}`))),ft(b,1,rs(e(ae)!==0?"stat-input ac-enhanced":"stat-input"),"svelte-1r5hyyb"),ct(b,"title",e(ae)!==0?"Base AC plus active effect bonuses":"Base Armor Class")}),c(T,b)};y(Re,T=>{S()?T(Ee):T(Ge,!1)})}l(ce);var fe=s(ce,2),x=s(i(fe),2);$e(x),l(fe);var ve=s(fe,2),h=s(i(ve),2);$e(h),l(ve);var I=s(ve,2);{var ie=T=>{var b=Es(),re=s(i(b),2);$e(re),l(b),R(()=>ga(re,e(P))),c(T,b)};y(I,T=>{e(P)!==null&&T(ie)})}l(be);var f=s(be,2),$=s(i(f),2),O=i($),A=i(O);$e(A);var J=s(A,4);$e(J),l(O);var Me=s(O,2),Se=i(Me),me=s(Se,2),Pe=s(me,2),we=s(Pe,2);l(Me),l($);var it=s($,2),Ye=s(i(it),2);$e(Ye),l(it),l(f);var vt=s(f,2),U=s(i(vt),2),o=i(U);$e(o);var ee=s(o,4);$e(ee);var W=s(ee,2);{var pe=T=>{const b=Xe(()=>(N(Pt),t(),r(()=>Pt(t().class))));var re=ot(),Le=Ne(re);{var Oe=qe=>{const he=Xe(()=>(d(),r(()=>d().constitution)));var de=Ps(),Ce=i(de);l(de),R(()=>L(Ce,`(${N(e(b)),r(()=>e(b).hitDice)??""}${(e(he)>=0?`+${e(he)}`:e(he))??""})`)),c(qe,de)};y(Le,qe=>{e(b)&&qe(Oe)})}c(T,re)};y(W,T=>{t(),r(()=>t().class)&&T(pe)})}l(U);var Fe=s(U,2),Ie=s(i(Fe),2),Be=s(Ie,2);l(Fe),l(vt),R(()=>{ct(A,"max",(t(),r(()=>t().maxHP))),ct(o,"max",(t(),r(()=>t().hitDice.max))),ct(Ie,"max",(t(),r(()=>t().hitDice.current))),Be.disabled=(t(),r(()=>t().hitDice.current<=0||!t().class))}),Ae(x,()=>t().initiative,T=>nt(Q,r(t).initiative=T,r(t))),Ae(h,()=>t().speed,T=>nt(Q,r(t).speed=T,r(t))),Ae(A,()=>t().currentHP,T=>nt(Q,r(t).currentHP=T,r(t))),Ae(J,()=>t().maxHP,T=>nt(Q,r(t).maxHP=T,r(t))),B("click",Se,()=>ke(-1)),B("click",me,()=>ke(1)),B("click",Pe,()=>ke(-5)),B("click",we,()=>ke(5)),Ae(Ye,()=>t().tempHP,T=>nt(Q,r(t).tempHP=T,r(t))),Ae(o,()=>t().hitDice.current,T=>nt(Q,r(t).hitDice.current=T,r(t))),Ae(ee,()=>t().hitDice.max,T=>nt(Q,r(t).hitDice.max=T,r(t))),B("input",Ie,T=>{const b=T.target,re=parseInt(b.value);re>t().hitDice.current&&(b.value=String(t().hitDice.current)),re<1&&(b.value="1")}),B("click",Be,()=>{const T=document.getElementById("hitDiceCount"),b=parseInt(T?.value||"1");ne(b)}),c(q,K)};y(Ue,q=>{m(),r(()=>!m().combatStats)&&q(H)})}l(Y),R(()=>le=ft(Y,1,"combat-stats svelte-1r5hyyb",null,le,{hidden:!e(z)})),c(a,Y),Rt(),k()}const ka={acrobatics:"dexterity",animalHandling:"wisdom",arcana:"intelligence",athletics:"strength",deception:"charisma",history:"intelligence",insight:"wisdom",intimidation:"charisma",investigation:"intelligence",medicine:"wisdom",nature:"intelligence",perception:"wisdom",performance:"charisma",persuasion:"charisma",religion:"intelligence",sleightOfHand:"dexterity",stealth:"dexterity",survival:"wisdom"};var Us=u('<div class="skill-row svelte-1f1pl16"><input type="checkbox" class="svelte-1f1pl16"/> <label class="svelte-1f1pl16"> <span class="ability-tag svelte-1f1pl16"> </span></label> <span class="skill-modifier svelte-1f1pl16"> </span> <button class="roll-btn svelte-1f1pl16">Roll</button></div>'),Gs=u('<div class="skills-grid svelte-1f1pl16"></div>'),Os=u("<section><!> <!></section>");function qs(a,n){It(n,!1);const t=()=>ze(oa,"$abilityModifiers",S),d=()=>ze(Q,"$character",S),p=()=>ze(Qt,"$searchFilter",S),m=()=>ze(At,"$collapsedStates",S),[S,M]=Nt(),k=E(),P=E(),ae=Zt(),z=[{key:"acrobatics",label:"Acrobatics"},{key:"animalHandling",label:"Animal Handling"},{key:"arcana",label:"Arcana"},{key:"athletics",label:"Athletics"},{key:"deception",label:"Deception"},{key:"history",label:"History"},{key:"insight",label:"Insight"},{key:"intimidation",label:"Intimidation"},{key:"investigation",label:"Investigation"},{key:"medicine",label:"Medicine"},{key:"nature",label:"Nature"},{key:"perception",label:"Perception"},{key:"performance",label:"Performance"},{key:"persuasion",label:"Persuasion"},{key:"religion",label:"Religion"},{key:"sleightOfHand",label:"Sleight of Hand"},{key:"stealth",label:"Stealth"},{key:"survival",label:"Survival"}];function G(H){const q=ka[H],K=t()[q],be=d().skillProficiencies[H]?d().proficiencyBonus:0;return K+be}function ke(H){const q=G(H),K=`1d20${q>=0?"+":""}${q}`;ae("roll",K)}Qe(()=>p(),()=>{v(k,z.filter(({label:H})=>p()?H.toLowerCase().includes(p().toLowerCase()):!0))}),Qe(()=>e(k),()=>{v(P,e(k).length>0)}),Wt(),Bt();var ne=Os();let Y;var le=i(ne);{let H=Xe(()=>(m(),r(()=>m().skills?"Expand":"Collapse")));ea(le,{title:"Skills",get collapsed(){return m(),r(()=>m().skills)},get ariaLabel(){return e(H)},onToggle:()=>At.update(q=>({...q,skills:!q.skills}))})}var Z=s(le,2);{var Ue=H=>{var q=Gs();ut(q,5,()=>e(k),pt,(K,be)=>{let ce=()=>e(be).key,Re=()=>e(be).label;const Ee=Xe(()=>(N(ka),ce(),r(()=>ka[ce()]))),Ge=Xe(()=>(ce(),r(()=>G(ce()))));var fe=Us(),x=i(fe);$e(x);var ve=s(x,2),h=i(ve),I=s(h),ie=i(I);l(I),l(ve);var f=s(ve,2),$=i(f);l(f);var O=s(f,2);l(fe),R(A=>{ct(x,"id",ce()),ct(ve,"for",ce()),L(h,`${Re()??""} `),L(ie,`(${A??""})`),L($,`${e(Ge)>=0?"+":""}${e(Ge)??""}`)},[()=>(N(e(Ee)),r(()=>e(Ee).substring(0,3).toUpperCase()))]),ba(x,()=>d().skillProficiencies[ce()],A=>nt(Q,r(d).skillProficiencies[ce()]=A,r(d))),B("click",O,()=>ke(ce())),c(K,fe)}),l(q),c(H,q)};y(Z,H=>{m(),r(()=>!m().skills)&&H(Ue)})}l(ne),R(()=>Y=ft(ne,1,"skills svelte-1f1pl16",null,Y,{hidden:!e(P)})),c(a,ne),Rt(),M()}let va=null,da=null;async function za(){if(va)return va;try{return va=await(await fetch(Wa("/data/spells.json"))).json(),va||[]}catch(a){return console.error("Failed to load spells:",a),[]}}async function Ws(){if(da)return da;try{return da=await(await fetch(Wa("/data/feats.json"))).json(),da||[]}catch(a){return console.error("Failed to load feats:",a),[]}}function Ia(a,n){if(!n.trim())return a;const t=n.toLowerCase();return a.filter(d=>d.name.toLowerCase().includes(t)||d.school.toLowerCase().includes(t)||d.classes.some(p=>p.toLowerCase().includes(t))||d.description.toLowerCase().includes(t))}function zs(a,n){return n===null?a:a.filter(t=>t.level===n)}function Ks(a,n){if(!n.trim())return a;const t=n.toLowerCase();return a.filter(d=>d.name.toLowerCase().includes(t)||d.description.toLowerCase().includes(t))}function ua(a){const n=a.description,t=/\b(Strength|Dexterity|Constitution|Intelligence|Wisdom|Charisma)\s+saving\s+throw/i,d=n.match(t);if(!d)return null;const p=d[1].toLowerCase(),S=/half\s+(?:as\s+much\s+)?damage\s+on\s+a\s+successful(?:\s+save)?/i.test(n),k=/saving\s+throw\s+or\s+take.*?damage/i.test(n)&&!S;return{ability:p,halfDamageOnSave:S,noDamageOnSave:k}}function Js(a){const n=a.description;return/(plus|add)\s+your\s+spellcasting\s+(ability\s+)?modifier/i.test(n)}function Ra(a){const n=a.description.toLowerCase(),d=["takes","take","deals","deal","damage equal to","force damage","fire damage","cold damage","lightning damage","thunder damage","acid damage","poison damage","necrotic damage","radiant damage","psychic damage","regain","regains","hit point"].some(S=>n.includes(S));return["bonus to attack","bonus to damage","bonus to ac","gains a +","gain a +","+1 bonus","+2 bonus","+3 bonus","advantage on","becomes a magic weapon"].some(S=>n.includes(S))&&!d}function Vs(a){const n=a.description;let t=0,d=0,p=0,m="";const S=n.match(/\+(\d+)\s+bonus\s+to\s+attack\s+rolls\s+and\s+damage\s+rolls/i);if(S){const k=parseInt(S[1]);t=k,d=k,m=`+${k} to attack and damage rolls`}a.name==="Bless"&&(m="Add 1d4 to attack rolls and saves");const M=n.match(/\+(\d+)\s+bonus\s+to\s+AC/i);return M&&(p=parseInt(M[1]),m=`+${p} to AC`),a.name==="Haste"&&(m="+2 AC, doubled speed, extra action"),m||t!==0||d!==0||p!==0?{attackBonus:t,damageBonus:d,acBonus:p,description:m||a.description.substring(0,100)}:null}var Qs=u('<button class="btn-remove svelte-14o91c5">Ã—</button>'),Xs=u('<div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Bonus</label> <input type="number" class="attack-bonus svelte-14o91c5"/></div>'),Ys=u('<div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Damage</label> <input type="text" placeholder="e.g., 2d6+3" class="attack-damage svelte-14o91c5"/></div>'),Zs=u('<div class="spell-info-loading svelte-14o91c5">Loading spell info...</div>'),el=u('<div class="spell-notes svelte-14o91c5"><h4 class="svelte-14o91c5">General Notes</h4> <p> </p></div>'),tl=u('<li class="svelte-14o91c5"><strong>At Higher Levels:</strong> </li>'),al=u('<ul class="svelte-14o91c5"><li class="svelte-14o91c5"><strong>Level:</strong> </li> <li class="svelte-14o91c5"><strong>Casting Time:</strong> </li> <li class="svelte-14o91c5"><strong>Range:</strong> </li> <li class="svelte-14o91c5"><strong>Components:</strong> <!></li> <li class="svelte-14o91c5"><strong>Duration:</strong> <!> </li> <li class="svelte-14o91c5"><strong>Description:</strong> </li> <!></ul>'),sl=u('<span class="scaled-damage svelte-14o91c5" style="margin-left: 8px;"> </span>'),ll=u('<span class="scaled-damage svelte-14o91c5">(Half damage)</span>'),il=u('<span class="scaled-damage svelte-14o91c5">(No damage)</span>'),rl=u('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> <!> <!></label></div>'),nl=u("<option> </option>"),ol=u('<span class="scaled-damage svelte-14o91c5"><!> </span>'),cl=u('<span class="scaled-damage svelte-14o91c5"> </span>'),vl=u('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> Target is Fiend or Undead <!></label></div>'),dl=u('<div class="spell-level-selector svelte-14o91c5"><label class="svelte-14o91c5">Cast at Level:</label> <select class="spell-level-select use-enabled svelte-14o91c5"></select> <!></div> <!>',1),ul=u('<div class="spell-level-selector svelte-14o91c5"><span style="color: #dc3545; font-weight: bold;">No spell slots available!</span></div>'),pl=u('<!> <div class="spell-info svelte-14o91c5"><div class="spell-info-header svelte-14o91c5" role="button" tabindex="0"><h4 class="svelte-14o91c5">Spell Info</h4> <button class="collapse-btn-small svelte-14o91c5"> </button></div> <!></div> <!> <!>',1),fl=u('<div class="spell-info-missing svelte-14o91c5">Spell info not found.</div>'),gl=u('<div class="attack-notes svelte-14o91c5"><label class="svelte-14o91c5">Notes</label> <textarea placeholder="e.g., DC 15 Dex save, Range 120 ft, Concentration" class="notes-input svelte-14o91c5" rows="2"></textarea></div>'),bl=u('<button class="btn btn-primary">Roll Attack</button>'),ml=u('<button class="btn btn-success">Cast Spell</button>'),hl=u('<button class="btn btn-secondary"><!></button>'),_l=u('<button class="btn btn-secondary">Roll Damage</button>'),yl=u('<div class="attack-card svelte-14o91c5"><div class="attack-header svelte-14o91c5"><input type="text" placeholder="Attack name" class="attack-name svelte-14o91c5"/> <!></div> <div class="attack-details svelte-14o91c5"><!> <!> <div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Type</label> <input type="text" placeholder="e.g., slashing" class="attack-type svelte-14o91c5"/></div></div> <!> <!> <div class="attack-actions svelte-14o91c5"><!> <!></div></div>'),kl=u('<p class="no-attacks svelte-14o91c5">No attacks added yet. Click "Add Attack" to create one.</p>'),Sl=u('<p class="no-attacks svelte-14o91c5">No attacks match your search.</p>'),xl=u('<button class="btn-remove svelte-14o91c5">Ã—</button>'),$l=u('<div class="state-card svelte-14o91c5"><div class="state-header svelte-14o91c5"><input type="text" placeholder="Effect name (e.g., Magic Weapon)" class="state-name svelte-14o91c5"/> <!></div> <div class="state-details svelte-14o91c5"><div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Attack Bonus</label> <input type="number" class="state-bonus svelte-14o91c5"/></div> <div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Damage Bonus</label> <input type="number" class="state-bonus svelte-14o91c5"/></div></div> <div class="state-description svelte-14o91c5"><label class="svelte-14o91c5">Description</label> <input type="text" placeholder="e.g., +1 to attack and damage rolls (Magic Weapon)" class="state-desc-input svelte-14o91c5"/></div></div>'),Cl=u('<div class="states-list svelte-14o91c5"></div>'),Ll=u('<p class="no-states svelte-14o91c5">No active effects. Add spell effects that modify your attacks.</p>'),wl=u('<button class="btn btn-secondary">Add Attack</button> <div class="attacks-list svelte-14o91c5"><!> <!></div> <div class="active-states-section svelte-14o91c5"><h3 class="svelte-14o91c5">Active Spell Effects</h3> <p class="section-description svelte-14o91c5">Effects that modify attack and damage rolls (e.g., Magic Weapon, Bless)</p> <button class="btn btn-secondary">Add Effect</button> <!></div>',1),Dl=u("<section><!> <!></section>");function jl(a,n){It(n,!1);const t=()=>ze(Q,"$character",M),d=()=>ze(oa,"$abilityModifiers",M),p=()=>ze(Qt,"$searchFilter",M),m=()=>ze(At,"$collapsedStates",M),S=()=>ze(ta,"$isEditMode",M),[M,k]=Nt(),P=E(),ae=E(),z=Zt();let G=E({});function ke(f){Sa(G,e(G)[f]=!e(G)[f]),v(G,{...e(G)})}function ne(f){return f.description.toLowerCase().includes("regain")&&(f.description.toLowerCase().includes("hit point")||f.description.toLowerCase().includes("hp"))}function Y(){Q.update(f=>(f.attacks=[...f.attacks,{id:crypto.randomUUID(),name:"",bonus:0,damage:"",damageType:"",notes:""}],f))}function le(f){Q.update($=>($.attacks=$.attacks.filter(O=>O.id!==f),$))}function Z(f){let $=f.damage,O=!1;if(f.spellRef){const Se=K(f.spellRef);if(Se&&Se.level>0){const me=f.castAtLevel||Se.level;if(!be(me)){Et.add(`No level ${me} spell slots available!`,"error");return}const we=ua(Se);we&&f.targetSucceededSave&&we.noDamageOnSave?$="0":(O=we?.halfDamageOnSave&&f.targetSucceededSave||!1,$=ce(f,Se))}}else if(t().activeStates&&t().activeStates.length>0){let Se=0;for(const me of t().activeStates)Se+=me.damageBonus;if(Se!==0&&$){const me=$.match(/(\d+d\d+)([+-]\d+)?/);if(me){const[,Pe,we]=me,Ye=(we?parseInt(we):0)+Se;$=`${Pe}${Ye>=0?"+":""}${Ye}`}}}const A=[];f.bonus!==0&&A.push({value:f.bonus,source:"base"});let J=f.bonus;if(t().activeStates)for(const Se of t().activeStates)Se.attackBonus!==0&&(A.push({value:Se.attackBonus,source:Se.name.toLowerCase()}),J+=Se.attackBonus);let Me;Me=`1d20${J>=0?"+":""}${J}`,z("roll",{notation:Me,damageNotation:$,attackName:f.name,applyHalfDamage:O,bonusBreakdown:A})}function Ue(f){if(!f.damage){Et.add(`${f.name}: No damage specified`,"error");return}let $=f.damage,O=!1;const A=[];if(f.spellRef){const J=K(f.spellRef);if(J&&J.level>0){const Me=f.castAtLevel||J.level;if(!be(Me)){Et.add(`No level ${Me} spell slots available!`,"error");return}const me=ua(J);me&&f.targetSucceededSave&&me.noDamageOnSave?$="0":(O=me?.halfDamageOnSave&&f.targetSucceededSave||!1,$=ce(f,J))}}else{const J=$.match(/(\d+d\d+)([+-]\d+)?/);if(J){const[,Me,Se]=J,me=Se?parseInt(Se):0;if(me!==0&&A.push({value:me,source:"base"}),t().activeStates&&t().activeStates.length>0){let Pe=0;for(const we of t().activeStates)we.damageBonus!==0&&(A.push({value:we.damageBonus,source:we.name.toLowerCase()}),Pe+=we.damageBonus);if(Pe!==0){const we=me+Pe;$=`${Me}${we>=0?"+":""}${we}`}}}}z("roll",{notation:$,attackName:f.name,applyHalfDamage:O,bonusBreakdown:A})}let H=E([]),q=E(!1);na(async()=>{v(H,await za()),v(q,!0)});function K(f){return e(H).find($=>$.name===f)}function be(f){t().classFeatures.spellSlotsByLevel||nt(Q,r(t).classFeatures.spellSlotsByLevel={},r(t)),t().classFeatures.spellSlotsByLevel[f]||nt(Q,r(t).classFeatures.spellSlotsByLevel[f]=Array(2).fill(!1),r(t));const O=t().classFeatures.spellSlotsByLevel[f].findIndex(A=>!A);return O===-1?!1:(Q.update(A=>(A.classFeatures.spellSlotsByLevel||(A.classFeatures.spellSlotsByLevel={}),A.classFeatures.spellSlotsByLevel[f]||(A.classFeatures.spellSlotsByLevel[f]=Array(2).fill(!1)),A.classFeatures.spellSlotsByLevel[f][O]=!0,A)),!0)}function ce(f,$){let O=f.damage,A=0,J=0;if(Js($)&&(J+=Bs(t(),d())),t().activeStates)for(const U of t().activeStates)J+=U.damageBonus;if($.higherLevelSlot&&f.castAtLevel){const U=$.level,ee=(f.castAtLevel||U)-U;if(ee>0){const W=$.higherLevelSlot.match(/(\d+)d(\d+)\s+for\s+each.*?level\s+above/i);if(W){const[,pe]=W;A+=ee*parseInt(pe)}}}if(f.targetIsFiendOrUndead&&$.description.includes("Fiend or an Undead")){const U=$.description.match(/increases by (\d+)d(\d+) if.*?Fiend or.*?Undead/i);if(U){const[,o]=U;A+=parseInt(o)}}const Me=O.match(/(\d+)d(\d+)([+-]\d+)?/);if(!Me)return J!==0?J>=0?`${J}`:`${J}`:O||"0";const[,Se,me,Pe]=Me,we=parseInt(Se)+A,Ye=(Pe?parseInt(Pe):0)+J;let vt=`${we}d${me}`;return Ye!==0&&(vt+=Ye>=0?`+${Ye}`:`${Ye}`),vt}function Re(f){const $=[];for(let A=f.level;A<=9;A++){const J=t().classFeatures.spellSlotsByLevel?.[A];J&&J.length>0&&$.push(A)}return $}function Ee(){Q.update(f=>(f.activeStates||(f.activeStates=[]),f.activeStates=[...f.activeStates,{name:"",attackBonus:0,damageBonus:0,description:""}],f))}function Ge(f){Q.update($=>($.activeStates&&($.activeStates=$.activeStates.filter((O,A)=>A!==f)),$))}function fe(f){const $=K(f.spellRef);if(!$){Et.add("Spell not found","error");return}const O=f.castAtLevel||$.level;if(O>0&&!be(O)){Et.add(`No level ${O} spell slots available!`,"error");return}const A=Vs($);if(!A){Et.add(`${$.name} cast! Check spell description for effects.`,"info");return}Q.update(J=>(J.activeStates||(J.activeStates=[]),J.activeStates=J.activeStates.filter(Me=>Me.name!==$.name),J.activeStates=[...J.activeStates,{name:$.name,attackBonus:A.attackBonus,damageBonus:A.damageBonus,acBonus:A.acBonus,description:A.description}],J)),Et.add(`${$.name} cast! Effect added to Active Spell Effects.`,"success")}Qe(()=>(t(),e(G)),()=>{if(t()&&t().attacks)for(const f of t().attacks)f.spellRef&&e(G)[f.id]===void 0&&Sa(G,e(G)[f.id]=!0)}),Qe(()=>(t(),p()),()=>{v(P,t().attacks.filter(f=>{if(!p())return!0;const $=p().toLowerCase();return f.name.toLowerCase().includes($)||f.damageType.toLowerCase().includes($)}).sort((f,$)=>!f.spellRef&&$.spellRef?-1:f.spellRef&&!$.spellRef?1:0))}),Qe(()=>(p(),e(P)),()=>{v(ae,!p()||e(P).length>0||"attack".includes(p().toLowerCase())||"spell".includes(p().toLowerCase()))}),Wt(),Bt();var x=Dl();let ve;var h=i(x);{let f=Xe(()=>(m(),r(()=>m().attacks?"Expand":"Collapse")));ea(h,{title:"Attacks & Spells",get collapsed(){return m(),r(()=>m().attacks)},get ariaLabel(){return e(f)},onToggle:()=>At.update($=>({...$,attacks:!$.attacks}))})}var I=s(h,2);{var ie=f=>{var $=wl(),O=Ne($),A=s(O,2),J=i(A);ut(J,1,()=>e(P),U=>U.id,(U,o,ee)=>{var W=yl(),pe=i(W),Fe=i(pe);$e(Fe);var Ie=s(Fe,2);{var Be=w=>{var j=Qs();B("click",j,()=>le(e(o).id)),c(w,j)};y(Ie,w=>{S()&&w(Be)})}l(pe);var T=s(pe,2),b=i(T);{var re=w=>{var j=Xs(),te=s(i(j),2);$e(te),l(j),Ae(te,()=>e(o).bonus,ye=>(e(o).bonus=ye,Dt(()=>(e(P),t(),p())))),c(w,j)};y(b,w=>{e(o),r(()=>e(o).bonus!==0&&e(o).bonus!==void 0)&&w(re)})}var Le=s(b,2);{var Oe=w=>{var j=Ys(),te=s(i(j),2);$e(te),l(j),Ae(te,()=>e(o).damage,ye=>(e(o).damage=ye,Dt(()=>(e(P),t(),p())))),c(w,j)};y(Le,w=>{e(o),r(()=>e(o).damage&&e(o).damage.trim()!=="")&&w(Oe)})}var qe=s(Le,2),he=s(i(qe),2);$e(he),l(qe),l(T);var de=s(T,2);{var Ce=w=>{var j=ot(),te=Ne(j);{var ye=V=>{var F=Zs();c(V,F)},We=V=>{const F=Xe(()=>(e(o),r(()=>K(e(o).spellRef))));var je=ot(),lt=Ne(je);{var rt=tt=>{const at=Xe(()=>(N(ua),N(e(F)),r(()=>ua(e(F)))));var C=pl(),X=Ne(C);{var g=Ve=>{var Ze=el(),kt=s(i(Ze),2),xt=i(kt,!0);l(kt),l(Ze),R(()=>L(xt,(e(o),r(()=>e(o).generalNotes)))),c(Ve,Ze)};y(X,Ve=>{e(o),r(()=>e(o).generalNotes)&&Ve(g)})}var se=s(X,2),oe=i(se),st=s(i(oe),2),xe=i(st,!0);l(st),l(oe);var Je=s(oe,2);{var Ke=Ve=>{var Ze=al(),kt=i(Ze),xt=s(i(kt));l(kt);var Ht=s(kt,2),zt=s(i(Ht));l(Ht);var $t=s(Ht,2),Ut=s(i($t));l($t);var gt=s($t,2),Ct=s(i(gt)),et=s(Ct);{var Lt=bt=>{var yt=jt();R(()=>L(yt,`(${N(e(F)),r(()=>e(F).material)??""})`)),c(bt,yt)};y(et,bt=>{N(e(F)),r(()=>e(F).material)&&bt(Lt)})}l(gt);var qt=s(gt,2),Kt=s(i(qt),2);{var Xt=bt=>{var yt=jt("Concentration,");c(bt,yt)};y(Kt,bt=>{N(e(F)),r(()=>e(F).concentration)&&bt(Xt)})}var St=s(Kt,1,!0);l(qt);var Mt=s(qt,2),wt=s(i(Mt));l(Mt);var Gt=s(Mt,2);{var Jt=bt=>{var yt=tl(),Ot=s(i(yt));l(yt),R(()=>L(Ot,` ${N(e(F)),r(()=>e(F).higherLevelSlot)??""}`)),c(bt,yt)};y(Gt,bt=>{N(e(F)),r(()=>e(F).higherLevelSlot)&&bt(Jt)})}l(Ze),R(bt=>{L(xt,` ${N(e(F)),r(()=>e(F).level)??""}`),L(zt,` ${N(e(F)),r(()=>e(F).castingTime||e(F).actionType)??""}`),L(Ut,` ${N(e(F)),r(()=>e(F).range)??""}`),L(Ct,` ${bt??""}`),L(St,(N(e(F)),r(()=>e(F).duration))),L(wt,` ${N(e(F)),r(()=>e(F).description)??""}`)},[()=>(N(e(F)),r(()=>e(F).components.join(", ")))]),c(Ve,Ze)};y(Je,Ve=>{e(G),e(o),r(()=>!e(G)[e(o).id])&&Ve(Ke)})}l(se);var dt=s(se,2);{var _t=Ve=>{var Ze=rl(),kt=i(Ze),xt=i(kt);$e(xt);var Ht=s(xt),zt=s(Ht);{var $t=et=>{var Lt=sl(),qt=i(Lt);l(Lt),R(Kt=>L(qt,`(Spell Save DC: ${Kt??""})`),[()=>(N(La),t(),d(),r(()=>La(t(),d())))]),c(et,Lt)};y(zt,et=>{t(),r(()=>t().class)&&et($t)})}var Ut=s(zt,2);{var gt=et=>{var Lt=ll();c(et,Lt)},Ct=et=>{var Lt=ot(),qt=Ne(Lt);{var Kt=Xt=>{var St=il();c(Xt,St)};y(qt,Xt=>{e(o),N(e(at)),r(()=>e(o).targetSucceededSave&&e(at).noDamageOnSave)&&Xt(Kt)},!0)}c(et,Lt)};y(Ut,et=>{e(o),N(e(at)),r(()=>e(o).targetSucceededSave&&e(at).halfDamageOnSave)?et(gt):et(Ct,!1)})}l(kt),l(Ze),R(et=>L(Ht,` Target succeeded on ${et??""} save `),[()=>(N(e(at)),r(()=>e(at).ability.charAt(0).toUpperCase()+e(at).ability.slice(1)))]),ba(xt,()=>e(o).targetSucceededSave,et=>(e(o).targetSucceededSave=et,Dt(()=>(e(P),t(),p())))),c(Ve,Ze)};y(dt,Ve=>{e(at)&&Ve(_t)})}var Tt=s(dt,2);{var Ft=Ve=>{const Ze=Xe(()=>(N(e(F)),r(()=>Re(e(F)))));var kt=ot(),xt=Ne(kt);{var Ht=$t=>{var Ut=dl(),gt=Ne(Ut),Ct=i(gt),et=s(Ct,2);R(()=>{e(o),Dt(()=>{e(Ze)})}),ut(et,5,()=>e(Ze),pt,(St,Mt)=>{var wt=nl(),Gt=i(wt);l(wt);var Jt={};R(()=>{L(Gt,`Level ${e(Mt)??""}`),Jt!==(Jt=e(Mt))&&(wt.value=(wt.__value=e(Mt))??"")}),c(St,wt)}),l(et);var Lt=s(et,2);{var qt=St=>{const Mt=Xe(()=>(e(o),N(e(F)),r(()=>ce(e(o),e(F)))));var wt=ol(),Gt=i(wt);{var Jt=Ot=>{var Yt=jt("Healing");c(Ot,Yt)},bt=Ot=>{var Yt=jt("Damage");c(Ot,Yt)};y(Gt,Ot=>{N(e(F)),r(()=>ne(e(F)))?Ot(Jt):Ot(bt,!1)})}var yt=s(Gt);l(wt),R(()=>L(yt,` ${e(Mt)??""}`)),c(St,wt)};y(Lt,St=>{e(o),N(e(F)),r(()=>e(o).castAtLevel&&e(o).castAtLevel>e(F).level)&&St(qt)})}l(gt);var Kt=s(gt,2);{var Xt=St=>{var Mt=vl(),wt=i(Mt),Gt=i(wt);$e(Gt);var Jt=s(Gt,2);{var bt=yt=>{const Ot=Xe(()=>(e(o),N(e(F)),r(()=>ce(e(o),e(F)))));var Yt=cl(),Ka=i(Yt);l(Yt),R(()=>L(Ka,`(+1d8, total: ${e(Ot)??""})`)),c(yt,Yt)};y(Jt,yt=>{e(o),r(()=>e(o).targetIsFiendOrUndead)&&yt(bt)})}l(wt),l(Mt),ba(Gt,()=>e(o).targetIsFiendOrUndead,yt=>(e(o).targetIsFiendOrUndead=yt,Dt(()=>(e(P),t(),p())))),c(St,Mt)};y(Kt,St=>{N(e(F)),r(()=>e(F).description.includes("Fiend or an Undead"))&&St(Xt)})}R(()=>{ct(Ct,"for",`castLevel-${e(o),r(()=>e(o).id)??""}`),ct(et,"id",`castLevel-${e(o),r(()=>e(o).id)??""}`)}),qa(et,()=>e(o).castAtLevel,St=>(e(o).castAtLevel=St,Dt(()=>(e(P),t(),p())))),c($t,Ut)},zt=$t=>{var Ut=ul();c($t,Ut)};y(xt,$t=>{N(e(Ze)),r(()=>e(Ze).length>0)?$t(Ht):$t(zt,!1)})}c(Ve,kt)};y(Tt,Ve=>{N(e(F)),r(()=>e(F).higherLevelSlot&&e(F).level>0)&&Ve(Ft)})}R(()=>{ct(st,"aria-label",(e(G),e(o),r(()=>e(G)[e(o).id]?"Expand":"Collapse"))),L(xe,(e(G),e(o),r(()=>e(G)[e(o).id]?"â–¼":"â–²")))}),B("click",oe,()=>ke(e(o).id)),B("keydown",oe,Ve=>Ve.key==="Enter"&&ke(e(o).id)),c(tt,C)},ht=tt=>{var at=fl();c(tt,at)};y(lt,tt=>{e(F)?tt(rt):tt(ht,!1)})}c(V,je)};y(te,V=>{e(H),r(()=>e(H).length===0)?V(ye):V(We,!1)})}c(w,j)};y(de,w=>{e(o),r(()=>e(o).spellRef)&&w(Ce)})}var ge=s(de,2);{var De=w=>{var j=gl(),te=s(i(j),2);ia(te),l(j),Ae(te,()=>e(o).notes,ye=>(e(o).notes=ye,Dt(()=>(e(P),t(),p())))),c(w,j)};y(ge,w=>{e(o),r(()=>!e(o).spellRef)&&w(De)})}var Te=s(ge,2),ue=i(Te);{var _e=w=>{var j=bl();B("click",j,()=>Z(e(o))),c(w,j)};y(ue,w=>{e(o),r(()=>e(o).bonus!==0||!e(o).spellRef)&&w(_e)})}var He=s(ue,2);{var _=w=>{const j=Xe(()=>(e(o),r(()=>K(e(o).spellRef))));var te=ot(),ye=Ne(te);{var We=F=>{var je=ml();B("click",je,()=>fe(e(o))),c(F,je)},V=F=>{var je=hl(),lt=i(je);{var rt=tt=>{var at=jt("Roll Healing");c(tt,at)},ht=tt=>{var at=jt("Roll Damage");c(tt,at)};y(lt,tt=>{N(e(j)),r(()=>e(j)&&ne(e(j)))?tt(rt):tt(ht,!1)})}l(je),B("click",je,()=>Ue(e(o))),c(F,je)};y(ye,F=>{N(e(j)),N(Ra),r(()=>e(j)&&Ra(e(j)))?F(We):F(V,!1)})}c(w,te)},D=w=>{var j=_l();B("click",j,()=>Ue(e(o))),c(w,j)};y(He,w=>{e(o),e(q),r(()=>e(o).spellRef&&e(q))?w(_):w(D,!1)})}l(Te),l(W),Ae(Fe,()=>e(o).name,w=>(e(o).name=w,Dt(()=>(e(P),t(),p())))),Ae(he,()=>e(o).damageType,w=>(e(o).damageType=w,Dt(()=>(e(P),t(),p())))),c(U,W)});var Me=s(J,2);{var Se=U=>{var o=kl();c(U,o)},me=U=>{var o=ot(),ee=Ne(o);{var W=pe=>{var Fe=Sl();c(pe,Fe)};y(ee,pe=>{e(P),r(()=>e(P).length===0)&&pe(W)},!0)}c(U,o)};y(Me,U=>{t(),r(()=>t().attacks.length===0)?U(Se):U(me,!1)})}l(A);var Pe=s(A,2),we=s(i(Pe),4),it=s(we,2);{var Ye=U=>{var o=Cl();ut(o,5,()=>(t(),r(()=>t().activeStates)),pt,(ee,W,pe)=>{var Fe=$l(),Ie=i(Fe),Be=i(Ie);$e(Be);var T=s(Be,2);{var b=ge=>{var De=xl();B("click",De,()=>Ge(pe)),c(ge,De)};y(T,ge=>{S()&&ge(b)})}l(Ie);var re=s(Ie,2),Le=i(re),Oe=s(i(Le),2);$e(Oe),l(Le);var qe=s(Le,2),he=s(i(qe),2);$e(he),l(qe),l(re);var de=s(re,2),Ce=s(i(de),2);$e(Ce),l(de),l(Fe),Ae(Be,()=>e(W).name,ge=>(e(W).name=ge,Dt(()=>t()),ca(M,"$character"))),Ae(Oe,()=>e(W).attackBonus,ge=>(e(W).attackBonus=ge,Dt(()=>t()),ca(M,"$character"))),Ae(he,()=>e(W).damageBonus,ge=>(e(W).damageBonus=ge,Dt(()=>t()),ca(M,"$character"))),Ae(Ce,()=>e(W).description,ge=>(e(W).description=ge,Dt(()=>t()),ca(M,"$character"))),c(ee,Fe)}),l(o),c(U,o)},vt=U=>{var o=Ll();c(U,o)};y(it,U=>{t(),r(()=>t().activeStates&&t().activeStates.length>0)?U(Ye):U(vt,!1)})}l(Pe),B("click",O,Y),B("click",we,Ee),c(f,$)};y(I,f=>{m(),r(()=>!m().attacks)&&f(ie)})}l(x),R(()=>ve=ft(x,1,"attacks svelte-14o91c5",null,ve,{hidden:!e(ae)})),c(a,x),Rt(),k()}var Al=u('<span class="slot-checkbox-x svelte-serp1j">&#8212;</span>'),Fl=u('<label><input type="checkbox" class="slot-checkbox-input svelte-serp1j"/> <span><!></span></label>');function Ea(a,n){It(n,!1);const t=()=>ze(ta,"$isEditMode",d),[d,p]=Nt();let m=mt(n,"checked",8,!1),S=mt(n,"disabled",8,!1),M=mt(n,"className",8,""),k=mt(n,"index",8,void 0),P=mt(n,"ariaLabel",8,void 0);const ae=Zt();function z(Z){ae("change",{checked:Z.currentTarget.checked,index:k()})}Bt();var G=Fl(),ke=i(G);$e(ke);var ne=s(ke,2),Y=i(ne);{var le=Z=>{var Ue=Al();c(Z,Ue)};y(Y,Z=>{m()&&Z(le)})}l(ne),l(G),R(()=>{ft(G,1,"slot-checkbox-label "+M()+(t()?"":" not-editable"),"svelte-serp1j"),gs(ke,m()),ke.disabled=S()||!t(),ct(ke,"aria-label",P()),ct(ke,"tabindex",t()?0:-1),ft(ne,1,`slot-checkbox-custom ${m()?"used":""} ${t()?"":"readonly"}`,"svelte-serp1j")}),B("change",ke,z),c(a,G),Rt(),p()}var Ml=u('<p class="no-features svelte-1kpvv0n">Select a class to see available features</p>'),Bl=u('<p class="no-features svelte-1kpvv0n">No class features available at this level</p>'),Il=u('<div class="spell-slots svelte-1kpvv0n"><label class="svelte-1kpvv0n"> </label> <div class="slots-tracker svelte-1kpvv0n"></div></div>'),Rl=u('<div class="all-spell-slots"></div>'),El=u('<div class="feature-box spellcasting svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"> </h3> <div class="spell-stats svelte-1kpvv0n"><div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Spell Save DC</label> <div class="spell-value svelte-1kpvv0n"> </div></div> <div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <div class="spell-value svelte-1kpvv0n"> </div></div></div> <!> <div class="prepared-spells svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <textarea placeholder="List your prepared spells..." class="svelte-1kpvv0n"></textarea></div></div>'),Pl=u('<p class="unlimited svelte-1kpvv0n">Unlimited Uses</p>'),Tl=u('<div class="slots-tracker svelte-1kpvv0n"></div> <div class="uses-actions-row"><button class="btn btn-primary use-enabled"> </button></div> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div>',1),Hl=u('<div class="uses-tracker svelte-1kpvv0n"><!></div>'),Nl=u('<div class="pool-tracker svelte-1kpvv0n"><input type="number" min="0" class="pool-input svelte-1kpvv0n"/> <span> </span> <button class="btn-small svelte-1kpvv0n"> </button></div>'),Ul=u('<p class="no-uses svelte-1kpvv0n">No Channel Divinity uses remaining</p>'),Gl=u('<div class="channel-divinity-option svelte-1kpvv0n"><button class="btn btn-primary use-enabled svelte-1kpvv0n">Use Channel Divinity</button> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div> <!></div>'),Ol=u('<div class="feature-box svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"><!> </h3> <p class="feature-description svelte-1kpvv0n"> </p> <!></div>'),ql=u('<div class="features-grid svelte-1kpvv0n"><!> <!></div>'),Wl=u("<section><!> <!></section>");function zl(a,n){It(n,!1);const t=()=>ze(Q,"$character",S),d=()=>ze(oa,"$abilityModifiers",S),p=()=>ze(Qt,"$searchFilter",S),m=()=>ze(At,"$collapsedStates",S),[S,M]=Nt(),k=E(),P=E(),ae=E(),z=E(),G=E(),ke=E(),ne=E();let Y=E(0),le=E(0);function Z(h,I){Q.update(ie=>(ie.classFeatures.features[h]=I,ie))}function Ue(){Q.update(h=>(h.classFeatures.spellSlotsByLevel||(h.classFeatures.spellSlotsByLevel={}),e(z).forEach(({level:I,slots:ie})=>{h.classFeatures.spellSlotsByLevel[I]||(h.classFeatures.spellSlotsByLevel[I]=Array(ie).fill(!1))}),h))}function H(h){if(typeof h.maxUses=="function"){if((h.name==="Divine Sense"||h.name==="War Priest")&&e(k)?.spellcastingAbility){const I=d()[e(k).spellcastingAbility];return h.maxUses(t().level,I)}return h.maxUses(t().level)}return h.maxUses||0}function q(h,I){Q.update(ie=>((!ie.classFeatures.features[h]||!Array.isArray(ie.classFeatures.features[h])||ie.classFeatures.features[h].length!==I)&&(ie.classFeatures.features[h]=Array(I).fill(!1)),ie))}Ja(()=>{e(ke)&&t()&&t().classFeatures&&t().classFeatures.features&&e(ke).forEach(h=>{if(h.type==="uses"){const I=h.name.replace(/\s+/g,""),ie=H(h),f=t().classFeatures.features[I];(!Array.isArray(f)||f.length!==ie)&&q(I,ie)}})});function K(h){return typeof h.maxPool=="function"?h.maxPool(t().level):h.maxPool||0}function be(h){return typeof h.description=="function"?h.description(t().level):h.description}function ce(){const h="ChannelDivinity";Q.update(I=>{const ie=I.classFeatures.features[h];return typeof ie=="number"&&ie>0&&(I.classFeatures.features[h]=ie-1),I})}function Re(){At.update(h=>({...h,classFeatures:!h.classFeatures}))}Qe(()=>(t(),Pt),()=>{v(k,t().class?Pt(t().class):null)}),Qe(()=>(t(),sa),()=>{v(P,t().class?sa(t().class,t().level,t().subclass):[])}),Qe(()=>(t(),Ma),()=>{v(ae,t().class?Ma(t().class,t().level):0)}),Qe(()=>(e(k),t()),()=>{v(z,(()=>{if(!e(k)?.spellcaster)return[];const h=t().level,I=[];return h>=1&&I.push({level:1,slots:Math.min(4,2+Math.floor(h/3))}),h>=3&&I.push({level:2,slots:Math.min(3,2+Math.floor((h-3)/4))}),h>=5&&I.push({level:3,slots:Math.min(3,2+Math.floor((h-5)/5))}),h>=7&&I.push({level:4,slots:Math.min(3,1+Math.floor((h-7)/6))}),h>=9&&I.push({level:5,slots:Math.min(2,1+Math.floor((h-9)/8))}),h>=11&&I.push({level:6,slots:1}),h>=13&&I.push({level:7,slots:1}),h>=15&&I.push({level:8,slots:1}),h>=17&&I.push({level:9,slots:1}),I})())}),Qe(()=>(e(k),d(),t(),Ba),()=>{if(e(k)?.spellcaster&&e(k).spellcastingAbility){const h=d()[e(k).spellcastingAbility];v(Y,_s(t().class,h,t().proficiencyBonus)||0),v(le,Ba(t().class,t().level,h))}}),Qe(()=>(t(),e(k),e(z)),()=>{t().class&&e(k)?.spellcaster&&e(z).length>0&&Ue()}),Qe(()=>t(),()=>{v(G,(()=>{const I=t().classFeatures.features["ChannelDivinity"];return typeof I=="number"?I:0})())}),Qe(()=>(e(P),p()),()=>{v(ke,e(P).filter(h=>{if(!p())return!0;const I=p().toLowerCase();return h.name.toLowerCase().includes(I)||be(h).toLowerCase().includes(I)}))}),Qe(()=>(p(),t(),e(ke)),()=>{v(ne,!p()||t().class||"class features".includes(p().toLowerCase())||"spellcasting".includes(p().toLowerCase())||e(ke).length>0)}),Wt(),Bt();var Ee=Wl();let Ge;var fe=i(Ee);{let h=Xe(()=>(m(),r(()=>m().classFeatures?"Expand":"Collapse")));ea(fe,{title:"Class Features",get collapsed(){return m(),r(()=>m().classFeatures)},get ariaLabel(){return e(h)},onToggle:Re})}var x=s(fe,2);{var ve=h=>{var I=ot(),ie=Ne(I);{var f=O=>{var A=Ml();c(O,A)},$=O=>{var A=ot(),J=Ne(A);{var Me=me=>{var Pe=Bl();c(me,Pe)},Se=me=>{var Pe=ql(),we=i(Pe);{var it=vt=>{var U=El(),o=i(U),ee=i(o);l(o);var W=s(o,2),pe=i(W),Fe=s(i(pe),2),Ie=i(Fe,!0);l(Fe),l(pe);var Be=s(pe,2),T=s(i(Be),2),b=i(T,!0);l(T),l(Be),l(W);var re=s(W,2);{var Le=he=>{var de=Rl();ut(de,5,()=>e(z),pt,(Ce,ge)=>{let De=()=>e(ge).level,Te=()=>e(ge).slots;const ue=Xe(()=>(t(),De(),Te(),r(()=>t().classFeatures.spellSlotsByLevel?.[De()]||Array(Te()).fill(!1))));var _e=Il(),He=i(_e),_=i(He);l(He);var D=s(He,2);ut(D,5,()=>e(ue),pt,(w,j,te)=>{{let ye=Xe(()=>(N(e(ue)),r(()=>e(ue)[te]||!1)));Ea(w,{get checked(){return e(ye)},$$events:{change:We=>{Q.update(V=>(V.classFeatures.spellSlotsByLevel||(V.classFeatures.spellSlotsByLevel={}),V.classFeatures.spellSlotsByLevel[De()]||(V.classFeatures.spellSlotsByLevel[De()]=Array(Te()).fill(!1)),V.classFeatures.spellSlotsByLevel[De()][te]=We.detail.checked,V))}}})}}),l(D),l(_e),R(()=>L(_,`${De()===1?"1st":De()===2?"2nd":De()===3?"3rd":`${De()}th`} Level Spell Slots`)),c(Ce,_e)}),l(de),c(he,de)};y(re,he=>{e(z),r(()=>e(z).length>0)&&he(Le)})}var Oe=s(re,2),qe=s(i(Oe),2);ia(qe),l(Oe),l(U),R(he=>{L(ee,`Spellcasting (${he??""})`),L(Ie,e(Y)),L(b,e(le))},[()=>(e(k),r(()=>e(k).spellcastingAbility?.toUpperCase()))]),Ae(qe,()=>t().classFeatures.preparedSpells,he=>nt(Q,r(t).classFeatures.preparedSpells=he,r(t))),c(vt,U)};y(we,vt=>{e(k),r(()=>e(k)?.spellcaster)&&vt(it)})}var Ye=s(we,2);ut(Ye,1,()=>e(ke),pt,(vt,U)=>{const o=Xe(()=>(e(U),r(()=>e(U).name.replace(/\s+/g,"")))),ee=Xe(()=>(t(),N(e(o)),r(()=>t().classFeatures.features[e(o)]))),W=Xe(()=>typeof e(ee)=="number");var pe=Ol(),Fe=i(pe),Ie=i(Fe);{var Be=he=>{var de=jt("Channel Divinity:");c(he,de)};y(Ie,he=>{e(U),r(()=>e(U).type==="channelDivinity")&&he(Be)})}var T=s(Ie);l(Fe);var b=s(Fe,2),re=i(b,!0);l(b);var Le=s(b,2);{var Oe=he=>{const de=Xe(()=>(e(U),r(()=>H(e(U))))),Ce=Xe(()=>(N(e(ee)),N(e(de)),r(()=>Array.isArray(e(ee))?e(ee):Array(e(de)).fill(!1))));var ge=Hl(),De=i(ge);{var Te=_e=>{var He=Pl();c(_e,He)},ue=_e=>{var He=Tl(),_=Ne(He);ut(_,5,()=>e(Ce),pt,(V,F,je)=>{Ea(V,{get checked(){return e(F)},index:je,$$events:{change:lt=>{Q.update(rt=>(rt.classFeatures.features[e(o)]||(rt.classFeatures.features[e(o)]=Array(e(de)).fill(!1)),rt.classFeatures.features[e(o)][je]=lt.detail.checked,rt))}}})}),l(_);var D=s(_,2),w=i(D),j=i(w);l(w),l(D);var te=s(D,2),ye=i(te),We=i(ye);l(ye),l(te),R(V=>{w.disabled=V,L(j,`Use ${e(U),r(()=>e(U).name)??""}`),L(We,`Resets on ${e(U),r(()=>e(U).resetOn==="short"?"Short Rest":"Long Rest")??""}`)},[()=>(N(e(Ce)),r(()=>e(Ce).filter(V=>!V).length<=0))]),B("click",w,()=>{Q.update(V=>{V.classFeatures.features[e(o)]||(V.classFeatures.features[e(o)]=Array(e(de)).fill(!1));const F=V.classFeatures.features[e(o)],je=F.findIndex(lt=>!lt);return je!==-1&&(F[je]=!0),V})}),c(_e,He)};y(De,_e=>{e(de)===1/0?_e(Te):_e(ue,!1)})}l(ge),c(he,ge)},qe=he=>{var de=ot(),Ce=Ne(de);{var ge=Te=>{const ue=Xe(()=>(e(U),r(()=>K(e(U)))));var _e=Nl(),He=i(_e);$e(He);var _=s(He,2),D=i(_);l(_);var w=s(_,2),j=i(w,!0);l(w),l(_e),R(()=>{ga(He,e(W)&&e(ee)!==void 0?e(ee):e(ue)),ct(He,"max",e(ue)),L(D,`/ ${e(ue)??""}`),L(j,(e(U),r(()=>e(U).resetOn==="short"?"Short Rest":"Long Rest")))}),B("input",He,te=>{Q.update(ye=>(ye.classFeatures.features[e(o)]=parseInt(te.currentTarget.value)||0,ye))}),B("click",w,()=>Z(e(o),e(ue))),c(Te,_e)},De=Te=>{var ue=ot(),_e=Ne(ue);{var He=_=>{var D=Gl(),w=i(D),j=s(w,2),te=i(j),ye=i(te);l(te),l(j);var We=s(j,2);{var V=F=>{var je=Ul();c(F,je)};y(We,F=>{e(G)<=0&&F(V)})}l(D),R(()=>{w.disabled=e(G)<=0,L(ye,`Resets on ${e(U),r(()=>e(U).resetOn==="short"?"Short Rest":"Long Rest")??""}`)}),B("click",w,ce),c(_,D)};y(_e,_=>{e(U),r(()=>e(U).type==="channelDivinity")&&_(He)},!0)}c(Te,ue)};y(Ce,Te=>{e(U),r(()=>e(U).type==="pool")?Te(ge):Te(De,!1)},!0)}c(he,de)};y(Le,he=>{e(U),r(()=>e(U).type==="uses")?he(Oe):he(qe,!1)})}l(pe),R(he=>{L(T,` ${e(U),r(()=>e(U).name)??""}`),L(re,he)},[()=>(e(U),r(()=>be(e(U))))]),c(vt,pe)}),l(Pe),c(me,Pe)};y(J,me=>{e(P),r(()=>e(P).length===0)?me(Me):me(Se,!1)},!0)}c(O,A)};y(ie,O=>{t(),r(()=>!t().class)?O(f):O($,!1)})}c(h,I)};y(x,h=>{m(),r(()=>!m().classFeatures)&&h(ve)})}l(Ee),R(()=>Ge=ft(Ee,1,"class-features svelte-1kpvv0n",null,Ge,{hidden:!e(ne)})),c(a,Ee),Rt(),M()}var Kl=u('<textarea placeholder="Enter features, traits, and special abilities..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Equipment</h3> <textarea placeholder="List your equipment and inventory..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Notes</h3> <textarea placeholder="Additional notes..." class="svelte-wttn0l"></textarea>',1),Jl=u("<section><!> <!></section>");function Vl(a,n){It(n,!1);const t=()=>ze(Qt,"$searchFilter",m),d=()=>ze(Q,"$character",m),p=()=>ze(At,"$collapsedStates",m),[m,S]=Nt(),M=E();function k(){At.update(ne=>({...ne,notes:!ne.notes}))}Qe(()=>(t(),d()),()=>{v(M,!t()||"features".includes(t().toLowerCase())||"traits".includes(t().toLowerCase())||"equipment".includes(t().toLowerCase())||"notes".includes(t().toLowerCase())||d().features.toLowerCase().includes(t().toLowerCase())||d().equipment.toLowerCase().includes(t().toLowerCase())||d().notes.toLowerCase().includes(t().toLowerCase()))}),Wt(),Bt();var P=Jl();let ae;var z=i(P);{let ne=Xe(()=>(p(),r(()=>p().notes?"Expand":"Collapse")));ea(z,{title:"Features & Traits",get collapsed(){return p(),r(()=>p().notes)},get ariaLabel(){return e(ne)},onToggle:k})}var G=s(z,2);{var ke=ne=>{var Y=Kl(),le=Ne(Y);ia(le);var Z=s(le,4);ia(Z);var Ue=s(Z,4);ia(Ue),Ae(le,()=>d().features,H=>nt(Q,r(d).features=H,r(d))),Ae(Z,()=>d().equipment,H=>nt(Q,r(d).equipment=H,r(d))),Ae(Ue,()=>d().notes,H=>nt(Q,r(d).notes=H,r(d))),c(ne,Y)};y(G,ne=>{p(),r(()=>!p().notes)&&ne(ke)})}l(P),R(()=>ae=ft(P,1,"notes svelte-wttn0l",null,ae,{hidden:!e(M)})),c(a,P),Rt(),S()}var Ql=u('<div class="color-picker-section svelte-1r90jgp"><h3 class="svelte-1r90jgp">Dice Colors</h3> <div class="color-inputs svelte-1r90jgp"><div class="color-input-group svelte-1r90jgp"><label for="dice-color" class="svelte-1r90jgp">Dice Color</label> <input type="color" id="dice-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="label-color" class="svelte-1r90jgp">Label Color</label> <input type="color" id="label-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="desk-color" class="svelte-1r90jgp">Background Color</label> <input type="color" id="desk-color" class="svelte-1r90jgp"/></div></div></div>'),Xl=u('<div class="loading svelte-1r90jgp"><p class="svelte-1r90jgp">Loading 3D dice...</p></div>'),Yl=u('<div class="custom-dice-selector svelte-1r90jgp"><h3 class="svelte-1r90jgp">Choose Dice to Roll</h3> <div class="dice-inputs svelte-1r90jgp"><div class="dice-input-group svelte-1r90jgp"><label for="d4" class="svelte-1r90jgp">d4</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d4" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d6" class="svelte-1r90jgp">d6</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d6" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d8" class="svelte-1r90jgp">d8</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d8" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d10" class="svelte-1r90jgp">d10</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d10" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d12" class="svelte-1r90jgp">d12</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d12" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d20" class="svelte-1r90jgp">d20</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d20" min="0" max="10"/></div></div> <div class="dice-controls svelte-1r90jgp"><button class="btn btn-primary use-enabled svelte-1r90jgp"> </button> <button class="btn btn-secondary use-enabled svelte-1r90jgp">Reset</button></div></div>'),Zl=u('<span class="crit-badge svelte-1r90jgp">CRITICAL!</span>'),ei=u('<p class="svelte-1r90jgp"> </p>'),ti=u('<div class="bonus-item svelte-1r90jgp"><span class="bonus-value svelte-1r90jgp"> </span> <span class="bonus-source svelte-1r90jgp"> </span></div>'),ai=u('<div class="bonus-breakdown svelte-1r90jgp"></div>'),si=u('<p class="modifier-text svelte-1r90jgp"> </p>'),li=u('<button class="btn btn-follow-up svelte-1r90jgp"> </button>'),ii=u('<button class="btn btn-guided-strike svelte-1r90jgp">âš¡ Use Guided Strike (+10)</button>'),ri=u('<div class="follow-up-actions svelte-1r90jgp"><!> <!></div>'),ni=u('<div class="result-header svelte-1r90jgp"><h3 class="svelte-1r90jgp"> </h3> <!></div> <div class="result-total svelte-1r90jgp"> </div> <div class="result-details svelte-1r90jgp"><!> <!></div> <!>',1),oi=u('<div role="button" tabindex="-1"><div class="modal-content svelte-1r90jgp" role="dialog" tabindex="0"><div class="modal-header svelte-1r90jgp"><h2 class="svelte-1r90jgp">Dice Roller</h2> <div class="header-buttons svelte-1r90jgp"><button class="color-btn svelte-1r90jgp" title="Customize dice colors">ðŸŽ¨</button> <button class="close-btn svelte-1r90jgp">Ã—</button></div></div> <!> <!> <div class="dice-main-area svelte-1r90jgp"><div class="dice-container svelte-1r90jgp"></div> <!></div> <div><!></div></div></div>');function ci(a,n){It(n,!1);const t=()=>ze(Q,"$character",d),[d,p]=Nt(),m=E(),S=E(),M=E(),k=Zt();let P=mt(n,"notation",12,""),ae=mt(n,"visible",8,!1),z=mt(n,"damageNotation",12,""),G=mt(n,"attackName",12,""),ke=mt(n,"applyHalfDamage",8,!1),ne=mt(n,"bonusBreakdown",28,()=>[]),Y=null,le=E(void 0),Z=E(!1),Ue=E(""),H=E(null);function q(){return e(H)?.resultTotal??null}let K=E(0),be=E(0),ce=E(0),Re=E(0),Ee=E(0),Ge=E(0),fe=E(0),x=E([]),ve=E(!1),h=E("other"),I=E(!1),ie=E("#051e0a"),f=E("#ffffff"),$=E("#3a2004"),O=E(!1);function A(_){return _.length===9&&_.startsWith("#")?_.substring(0,7):_}function J(_,D="ff"){return _.length===7&&_.startsWith("#")?_+D:_}function Me(){if(window.DICE&&e(le))try{Y&&e(le)&&Sa(le,e(le).innerHTML="");const _=e(le).clientWidth||500,D=e(le).clientHeight||300;Y=new window.DICE.dice_box(e(le),{w:_,h:D}),v(Z,!0)}catch(_){console.error("Error initializing dice box:",_)}}na(()=>{const _=j=>new Promise((te,ye)=>{if(document.querySelector(`script[src="${j}"]`)){console.log(`Script already loaded: ${j}`),te(null);return}const V=document.createElement("script");V.src=j,V.onload=()=>{console.log(`Loaded: ${j}`),te(null)},V.onerror=()=>{console.error(`Failed to load: ${j}`),ye(new Error(`Failed to load ${j}`))},document.head.appendChild(V)});setTimeout(()=>{_(`${la}/libs/three.min.js`).then(()=>_(`${la}/libs/cannon.min.js`)).then(()=>_(`${la}/libs/teal.js`)).then(()=>_(`${la}/dice.js`)).then(()=>{if(console.log("All scripts loaded, initializing dice box..."),console.log("DICE available:",!!window.DICE),console.log("Container available:",!!e(le)),window.DICE){const j=window.DICE.getColors();v(ie,A(j.dice_color)),v(f,A(j.label_color)),v($,A(j.desk_color))}Me()}).catch(j=>{console.error("Failed to load dice libraries:",j)})},100);const D=()=>{e(Z)&&(console.log("Window resized, reinitializing dice box..."),Me())},w=j=>{ae()&&j.key==="Escape"&&o()};return window.addEventListener("resize",D),window.addEventListener("keydown",w),()=>{window.removeEventListener("resize",D),window.removeEventListener("keydown",w)}});function Se(_,D="other"){if(!Y||!e(Z))return;console.log("Rolling dice:",_,"type:",D),v(H,null),v(x,[]),v(ve,!1),D==="damage"&&ne([]),v(h,D),v(I,!1),Y.diceToRoll=_;const w=te=>(console.log("Before roll:",te),null),j=te=>{console.log("After roll:",te);let ye=te.resultTotal,We=te.resultString;if(ke()&&(ye=Math.floor(ye/2),We=We+" (halved)"),v(H,{...te,resultTotal:ye,resultString:We}),D==="attack"||D==="check"||D==="save"){const V=te.result?.filter(F=>F===20)||[];if(V.length>0){const F=V[0];v(ve,F===20)}}if(v(x,[]),console.log("Setting up follow-up actions. Type:",D,"damageNotation:",z(),"isCritical:",e(ve)),D==="attack")if(z()){if(e(ve)){const V=we(z());console.log("Creating critical damage button:",V),e(x).push({label:`Roll Critical Damage (${V})`,notation:V})}else console.log("Creating normal damage button:",z()),e(x).push({label:`Roll Damage (${z()})`,notation:z()});console.log("Follow-up actions after setup:",e(x))}else console.log("No damageNotation provided for attack roll");console.log("Final followUpActions:",e(x))};Y.start_throw(w,j)}function me(){const _=[];e(K)>0&&_.push(`${e(K)}d4`),e(be)>0&&_.push(`${e(be)}d6`),e(ce)>0&&_.push(`${e(ce)}d8`),e(Re)>0&&_.push(`${e(Re)}d10`),e(Ee)>0&&_.push(`${e(Ee)}d12`),e(Ge)>0&&_.push(`${e(Ge)}d20`);let D=_.join("+")||"1d20";return e(fe)!==0&&(D+=e(fe)>=0?`+${e(fe)}`:`${e(fe)}`),D}function Pe(){const _=me();Se(_)}function we(_){return _.replace(/(\d+)d(\d+)/g,(D,w,j)=>`${parseInt(w)*2}d${j}`)}function it(){v(K,0),v(be,0),v(ce,0),v(Re,0),v(Ee,0),v(Ge,0),v(fe,0),v(H,null),v(x,[]),v(ve,!1),v(h,"other"),v(I,!1)}function Ye(){window.DICE&&(window.DICE.setColors({dice_color:J(e(ie),"ff"),label_color:J(e(f),"ff"),desk_color:e($)}),Y&&(Y.updateDeskColor(e($)),Y.updateDiceColors()))}function vt(){v(O,!e(O))}function U(){!e(H)||e(S)<=0||e(I)||(v(H,{...e(H),resultTotal:e(H).resultTotal+10,resultString:e(H).resultString+" + 10 (Guided Strike)"}),Q.update(_=>{const D="ChannelDivinity",w=_.classFeatures.features[D];return typeof w=="number"&&w>0&&(_.classFeatures.features[D]=w-1),_}),v(I,!0))}function o(){k("close"),P(""),z(""),G(""),v(Ue,""),v(H,null),v(I,!1),it()}Qe(()=>(t(),sa),()=>{v(m,t().class?sa(t().class,t().level,t().subclass).some(D=>D.name==="Guided Strike"):!1)}),Qe(()=>t(),()=>{v(S,(()=>{const D=t().classFeatures.features["ChannelDivinity"];return typeof D=="number"?D:0})())}),Qe(()=>(e(K),e(be),e(ce),e(Re),e(Ee),e(Ge),e(fe)),()=>{v(M,(()=>{const _=[];e(K)>0&&_.push(`${e(K)}d4`),e(be)>0&&_.push(`${e(be)}d6`),e(ce)>0&&_.push(`${e(ce)}d8`),e(Re)>0&&_.push(`${e(Re)}d10`),e(Ee)>0&&_.push(`${e(Ee)}d12`),e(Ge)>0&&_.push(`${e(Ge)}d20`);let D=_.join("+")||"1d20";return e(fe)!==0&&(D+=e(fe)>=0?`+${e(fe)}`:`${e(fe)}`),D})())}),Qe(()=>(N(P()),e(Z),N(ae()),e(Ue),N(z()),N(G())),()=>{if(P()&&e(Z)&&ae()&&P()!==e(Ue)){v(Ue,P()),v(H,null),v(x,[]),v(ve,!1),v(I,!1);const _=P().includes("1d20")?"attack":"other";console.log("Auto-roll triggered. notation:",P(),"damageNotation:",z(),"attackName:",G()),setTimeout(()=>Se(P(),_),200)}}),Wt();var ee={getLastRollTotal:q};Bt();var W=oi();let pe;var Fe=i(W),Ie=i(Fe),Be=s(i(Ie),2),T=i(Be),b=s(T,2);l(Be),l(Ie);var re=s(Ie,2);{var Le=_=>{var D=Ql(),w=s(i(D),2),j=i(w),te=s(i(j),2);$e(te),l(j);var ye=s(j,2),We=s(i(ye),2);$e(We),l(ye);var V=s(ye,2),F=s(i(V),2);$e(F),l(V),l(w),l(D),Ae(te,()=>e(ie),je=>v(ie,je)),B("change",te,Ye),Ae(We,()=>e(f),je=>v(f,je)),B("change",We,Ye),Ae(F,()=>e($),je=>v($,je)),B("change",F,Ye),c(_,D)};y(re,_=>{e(O)&&_(Le)})}var Oe=s(re,2);{var qe=_=>{var D=Xl();c(_,D)};y(Oe,_=>{e(Z)||_(qe)})}var he=s(Oe,2),de=i(he);xa(de,_=>v(le,_),()=>e(le));var Ce=s(de,2);{var ge=_=>{var D=Yl(),w=s(i(D),2),j=i(w),te=s(i(j),2);$e(te),l(j);var ye=s(j,2),We=s(i(ye),2);$e(We),l(ye);var V=s(ye,2),F=s(i(V),2);$e(F),l(V);var je=s(V,2),lt=s(i(je),2);$e(lt),l(je);var rt=s(je,2),ht=s(i(rt),2);$e(ht),l(rt);var tt=s(rt,2),at=s(i(tt),2);$e(at),l(tt),l(w);var C=s(w,2),X=i(C),g=i(X);l(X);var se=s(X,2);l(C),l(D),R(()=>{X.disabled=!e(Z),L(g,`Roll ${e(M)??""}`)}),Ae(te,()=>e(K),oe=>v(K,oe)),Ae(We,()=>e(be),oe=>v(be,oe)),Ae(F,()=>e(ce),oe=>v(ce,oe)),Ae(lt,()=>e(Re),oe=>v(Re,oe)),Ae(ht,()=>e(Ee),oe=>v(Ee,oe)),Ae(at,()=>e(Ge),oe=>v(Ge,oe)),B("click",X,Pe),B("click",se,it),c(_,D)};y(Ce,_=>{P()||_(ge)})}l(he);var De=s(he,2);let Te;var ue=i(De);{var _e=_=>{var D=ni(),w=Ne(D),j=i(w),te=i(j,!0);l(j);var ye=s(j,2);{var We=X=>{var g=Zl();c(X,g)};y(ye,X=>{e(ve)&&X(We)})}l(w);var V=s(w,2),F=i(V,!0);l(V);var je=s(V,2),lt=i(je);{var rt=X=>{var g=ei(),se=i(g,!0);l(g),R(()=>L(se,(e(H),r(()=>e(H).resultString)))),c(X,g)};y(lt,X=>{e(H),r(()=>e(H).resultString)&&X(rt)})}var ht=s(lt,2);{var tt=X=>{var g=ot(),se=Ne(g);{var oe=xe=>{var Je=ai();ut(Je,5,ne,pt,(Ke,dt)=>{var _t=ti(),Tt=i(_t),Ft=i(Tt);l(Tt);var Ve=s(Tt,2),Ze=i(Ve);l(Ve),l(_t),R(()=>{L(Ft,`${e(dt),r(()=>e(dt).value>=0?"+":"")??""}${e(dt),r(()=>e(dt).value)??""}`),L(Ze,`(${e(dt),r(()=>e(dt).source)??""})`)}),c(Ke,_t)}),l(Je),c(xe,Je)},st=xe=>{var Je=ot(),Ke=Ne(Je);{var dt=_t=>{var Tt=si(),Ft=i(Tt);l(Tt),R(()=>L(Ft,`Modifier: ${e(H),r(()=>e(H).constant>=0?"+":"")??""}${e(H),r(()=>e(H).constant)??""}`)),c(_t,Tt)};y(Ke,_t=>{e(H),r(()=>e(H).constant)&&_t(dt)},!0)}c(xe,Je)};y(se,xe=>{N(ne()),r(()=>ne().length>0)?xe(oe):xe(st,!1)})}c(X,g)};y(ht,X=>{e(H),N(ne()),r(()=>e(H).constant||ne().length>0)&&X(tt)})}l(je);var at=s(je,2);{var C=X=>{var g=ri(),se=i(g);ut(se,1,()=>e(x),pt,(xe,Je)=>{var Ke=li(),dt=i(Ke,!0);l(Ke),R(()=>L(dt,(e(Je),r(()=>e(Je).label)))),B("click",Ke,()=>Se(e(Je).notation,"damage")),c(xe,Ke)});var oe=s(se,2);{var st=xe=>{var Je=ii();R(()=>{Je.disabled=e(S)<=0,ct(Je,"title",e(S)<=0?"No Channel Divinity uses remaining":"Use Channel Divinity to add +10 to this attack roll")}),B("click",Je,U),c(xe,Je)};y(oe,xe=>{e(m)&&e(h)==="attack"&&!e(I)&&xe(st)})}l(g),c(X,g)};y(at,X=>{e(x),e(m),e(h),e(I),r(()=>e(x).length>0||e(m)&&e(h)==="attack"&&!e(I))&&X(C)})}R(()=>{L(te,G()?`${G()} - Result`:"Result"),L(F,(e(H),r(()=>e(H).resultTotal)))}),c(_,D)};y(ue,_=>{e(H)&&_(_e)})}l(De),l(Fe),l(W),R(()=>{pe=ft(W,1,"modal-overlay svelte-1r90jgp",null,pe,{hidden:!ae()}),Te=ft(De,1,"roll-result svelte-1r90jgp",null,Te,{"has-result":e(H)})}),B("click",T,vt),B("click",b,o),B("click",Fe,ja(function(_){aa.call(this,n,_)})),B("keydown",Fe,function(_){aa.call(this,n,_)}),B("click",W,o),B("keydown",W,_=>_.key==="Escape"&&o()),c(a,W),ms(n,"getLastRollTotal",q);var He=Rt(ee);return p(),He}const ha="https://api.github.com/gists";async function vi(a,n,t){if(!n)throw new Error("GitHub token is required");const d=JSON.stringify(a,null,2),p=`${a.name||"character"}_dnd.json`,m={description:t||`D&D Character: ${a.name}`,public:!1,files:{[p]:{content:d}}},S=await fetch(ha,{method:"POST",headers:{Authorization:`token ${n}`,"Content-Type":"application/json"},body:JSON.stringify(m)});if(!S.ok)throw new Error(`Failed to create gist: ${S.statusText}`);return(await S.json()).id}async function di(a,n,t){if(!n||!t)throw new Error("GitHub token and Gist ID are required");const d=JSON.stringify(a,null,2),m={files:{[`${a.name||"character"}_dnd.json`]:{content:d}}},S=await fetch(`${ha}/${t}`,{method:"PATCH",headers:{Authorization:`token ${n}`,"Content-Type":"application/json"},body:JSON.stringify(m)});if(!S.ok)throw new Error(`Failed to update gist: ${S.statusText}`)}async function ui(a,n){if(!a)throw new Error("Gist ID is required");const t={"Content-Type":"application/json"};n&&(t.Authorization=`token ${n}`);const d=await fetch(`${ha}/${a}`,{method:"GET",headers:t});if(!d.ok)throw new Error(`Failed to load gist: ${d.statusText}`);const p=await d.json(),m=Object.values(p.files);if(m.length===0)throw new Error("No files found in gist");const M=m[0].content;try{const k=JSON.parse(M);return k.attacks&&Array.isArray(k.attacks)&&(k.attacks=k.attacks.map(P=>({...P,id:P.id||crypto.randomUUID()}))),k.classFeatures?(k.classFeatures.features||(k.classFeatures.features={}),k.classFeatures.spellSlots||(k.classFeatures.spellSlots=[]),k.classFeatures.preparedSpells===void 0&&(k.classFeatures.preparedSpells="")):k.classFeatures={features:{},spellSlots:[],preparedSpells:""},k}catch{throw new Error("Invalid character data in gist")}}function Pa(a){typeof window<"u"&&localStorage.setItem("dnd_gist_config",JSON.stringify(a))}function pi(){if(typeof window<"u"){const a=localStorage.getItem("dnd_gist_config");if(a)return JSON.parse(a)}return{}}async function fi(a,n=30){if(!a)throw new Error("GitHub token is required to list gists");const t=await fetch(`${ha}?per_page=${n}`,{method:"GET",headers:{Authorization:`token ${a}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error(`Failed to list gists: ${t.statusText}`);return await t.json()}var gi=u('<div class="error-message svelte-1jb5ckg"> </div>'),bi=u('<div class="toggle-container svelte-1jb5ckg"><button type="button" class="toggle-btn svelte-1jb5ckg"> </button></div>'),mi=u('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID (leave empty to create new)</label> <input type="text" id="gistId" placeholder="Optional: existing Gist ID to update" class="svelte-1jb5ckg"/></div>'),hi=u('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),_i=u('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),yi=u('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Update (or leave unselected to create new)</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),ki=u('<div class="info-message svelte-1jb5ckg">No gists found. A new one will be created.</div>'),Si=u('<!> <div class="form-group svelte-1jb5ckg"><label for="description" class="svelte-1jb5ckg"> </label> <input type="text" id="description" placeholder="D&amp;D Character Sheet" class="svelte-1jb5ckg"/></div>',1),xi=u('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID *</label> <input type="text" id="gistId" placeholder="Enter Gist ID (for public or your private gists)" required class="svelte-1jb5ckg"/></div>'),$i=u('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),Ci=u('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),Li=u('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Load</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),wi=u('<div class="info-message svelte-1jb5ckg">No gists found. Enter a Gist ID manually or create a new one in Save mode.</div>'),Di=u('<div class="modal-overlay svelte-1jb5ckg" role="button" tabindex="-1"><div class="modal-content svelte-1jb5ckg" role="dialog" tabindex="0"><div class="modal-header svelte-1jb5ckg"><h2 class="svelte-1jb5ckg"> </h2> <button class="close-btn svelte-1jb5ckg">Ã—</button></div> <div class="modal-body svelte-1jb5ckg"><!> <div class="form-group svelte-1jb5ckg"><label for="token" class="svelte-1jb5ckg"> <a href="https://github.com/settings/tokens" target="_blank" rel="noopener" class="svelte-1jb5ckg">Get token</a></label> <input type="password" id="token" placeholder="ghp_xxxxxxxxxxxxx" class="svelte-1jb5ckg"/></div> <!> <!> <div class="modal-actions svelte-1jb5ckg"><button class="btn btn-primary svelte-1jb5ckg"><!></button> <button class="btn btn-secondary svelte-1jb5ckg">Cancel</button></div></div></div></div>');function ji(a,n){It(n,!1);const t=()=>ze(Q,"$character",d),[d,p]=Nt(),m=Zt();let S=mt(n,"mode",8,"save"),M=E(""),k=E(""),P=E(""),ae=E(!1),z=E(""),G=E(!1),ke=E(!1),ne=E([]),Y=E(null);const le=pi();le.token&&v(M,le.token),le.gistId&&v(k,le.gistId),na(async()=>{e(M)&&!e(G)&&await Z()});async function Z(){if(e(M)){v(ke,!0),v(z,"");try{v(ne,await fi(e(M))),e(k)&&v(Y,e(ne).find(o=>o.id===e(k))||null)}catch(o){v(z,o.message||"Failed to load gists"),v(ne,[])}finally{v(ke,!1)}}}function Ue(o){v(Y,o),v(k,o.id)}function H(){v(G,!e(G)),v(z,""),!e(G)&&e(M)&&Z()}async function q(){if(!e(M)){v(z,"GitHub token is required");return}const o=e(Y)?.id||e(k);v(ae,!0),v(z,"");try{if(o)await di(t(),e(M),o),v(k,o),Et.add("Character updated in Gist successfully!","success");else{const ee=await vi(t(),e(M),e(P));v(k,ee),Et.add(`Character saved to Gist! ID: ${ee}`,"success")}Pa({token:e(M),gistId:e(k)}),m("close")}catch(ee){v(z,ee.message||"Failed to save to Gist")}finally{v(ae,!1)}}async function K(){const o=e(Y)?.id||e(k);if(!o){v(z,"Please select a gist or enter a Gist ID");return}v(ae,!0),v(z,"");try{const ee=await ui(o,e(M)||void 0);Q.set(ee),v(k,o),Pa({token:e(M),gistId:e(k)}),Et.add("Character loaded from Gist successfully!","success"),m("close")}catch(ee){v(z,ee.message||"Failed to load from Gist")}finally{v(ae,!1)}}function be(){m("close")}Bt();var ce=Di(),Re=i(ce),Ee=i(Re),Ge=i(Ee),fe=i(Ge,!0);l(Ge);var x=s(Ge,2);l(Ee);var ve=s(Ee,2),h=i(ve);{var I=o=>{var ee=gi(),W=i(ee,!0);l(ee),R(()=>L(W,e(z))),c(o,ee)};y(h,o=>{e(z)&&o(I)})}var ie=s(h,2),f=i(ie),$=i(f);pa(),l(f);var O=s(f,2);$e(O),l(ie);var A=s(ie,2);{var J=o=>{var ee=bi(),W=i(ee),pe=i(W,!0);l(W),l(ee),R(()=>{W.disabled=e(ae),L(pe,e(G)?"ðŸ“‹ Show My Gists":"âœï¸ Enter Gist ID Manually")}),B("click",W,H),c(o,ee)};y(A,o=>{(S()==="load"||S()==="save"&&e(M))&&o(J)})}var Me=s(A,2);{var Se=o=>{var ee=Si(),W=Ne(ee);{var pe=re=>{var Le=mi(),Oe=s(i(Le),2);$e(Oe),l(Le),R(()=>Oe.disabled=e(ae)),Ae(Oe,()=>e(k),qe=>v(k,qe)),c(re,Le)},Fe=re=>{var Le=ot(),Oe=Ne(Le);{var qe=de=>{var Ce=hi();c(de,Ce)},he=de=>{var Ce=ot(),ge=Ne(Ce);{var De=ue=>{var _e=yi(),He=s(i(_e),2);ut(He,5,()=>e(ne),pt,(_,D)=>{var w=_i();let j;var te=i(w),ye=i(te),We=i(ye,!0);l(ye);var V=s(ye,2),F=i(V,!0);l(V),l(te);var je=s(te,2),lt=i(je),rt=i(lt);l(lt);var ht=s(lt,2),tt=i(ht);l(ht),l(je),l(w),R(at=>{j=ft(w,1,"gist-item svelte-1jb5ckg",null,j,{selected:e(Y)?.id===e(D).id}),w.disabled=e(ae),L(We,(e(D),r(()=>e(D).description||"Untitled"))),L(F,(e(D),r(()=>e(D).public?"ðŸŒ Public":"ðŸ”’ Private"))),L(rt,`ID: ${e(D),r(()=>e(D).id)??""}`),L(tt,`Updated: ${at??""}`)},[()=>(e(D),r(()=>new Date(e(D).updated_at).toLocaleDateString()))]),B("click",w,()=>Ue(e(D))),c(_,w)}),l(He),l(_e),c(ue,_e)},Te=ue=>{var _e=ot(),He=Ne(_e);{var _=D=>{var w=ki();c(D,w)};y(He,D=>{e(M)&&D(_)},!0)}c(ue,_e)};y(ge,ue=>{e(ne),r(()=>e(ne).length>0)?ue(De):ue(Te,!1)},!0)}c(de,Ce)};y(Oe,de=>{e(ke)?de(qe):de(he,!1)},!0)}c(re,Le)};y(W,re=>{e(G)||!e(M)?re(pe):re(Fe,!1)})}var Ie=s(W,2),Be=i(Ie),T=i(Be);l(Be);var b=s(Be,2);$e(b),l(Ie),R(()=>{L(T,`Description ${e(k)?"(optional)":""}`),b.disabled=e(ae)}),Ae(b,()=>e(P),re=>v(P,re)),c(o,ee)},me=o=>{var ee=ot(),W=Ne(ee);{var pe=Ie=>{var Be=xi(),T=s(i(Be),2);$e(T),l(Be),R(()=>T.disabled=e(ae)),Ae(T,()=>e(k),b=>v(k,b)),c(Ie,Be)},Fe=Ie=>{var Be=ot(),T=Ne(Be);{var b=Le=>{var Oe=$i();c(Le,Oe)},re=Le=>{var Oe=ot(),qe=Ne(Oe);{var he=Ce=>{var ge=Li(),De=s(i(ge),2);ut(De,5,()=>e(ne),pt,(Te,ue)=>{var _e=Ci();let He;var _=i(_e),D=i(_),w=i(D,!0);l(D);var j=s(D,2),te=i(j,!0);l(j),l(_);var ye=s(_,2),We=i(ye),V=i(We);l(We);var F=s(We,2),je=i(F);l(F),l(ye),l(_e),R(lt=>{He=ft(_e,1,"gist-item svelte-1jb5ckg",null,He,{selected:e(Y)?.id===e(ue).id}),_e.disabled=e(ae),L(w,(e(ue),r(()=>e(ue).description||"Untitled"))),L(te,(e(ue),r(()=>e(ue).public?"ðŸŒ Public":"ðŸ”’ Private"))),L(V,`ID: ${e(ue),r(()=>e(ue).id)??""}`),L(je,`Updated: ${lt??""}`)},[()=>(e(ue),r(()=>new Date(e(ue).updated_at).toLocaleDateString()))]),B("click",_e,()=>Ue(e(ue))),c(Te,_e)}),l(De),l(ge),c(Ce,ge)},de=Ce=>{var ge=ot(),De=Ne(ge);{var Te=ue=>{var _e=wi();c(ue,_e)};y(De,ue=>{e(M)&&ue(Te)},!0)}c(Ce,ge)};y(qe,Ce=>{e(ne),r(()=>e(ne).length>0)?Ce(he):Ce(de,!1)},!0)}c(Le,Oe)};y(T,Le=>{e(ke)?Le(b):Le(re,!1)},!0)}c(Ie,Be)};y(W,Ie=>{e(G)||!e(M)?Ie(pe):Ie(Fe,!1)},!0)}c(o,ee)};y(Me,o=>{S()==="save"?o(Se):o(me,!1)})}var Pe=s(Me,2),we=i(Pe),it=i(we);{var Ye=o=>{var ee=jt();R(()=>L(ee,S()==="save"?"Saving...":"Loading...")),c(o,ee)},vt=o=>{var ee=jt();R(()=>L(ee,S()==="save"?"Save":"Load")),c(o,ee)};y(it,o=>{e(ae)?o(Ye):o(vt,!1)})}l(we);var U=s(we,2);l(Pe),l(ve),l(Re),l(ce),R(()=>{L(fe,S()==="save"?"Save to GitHub Gist":"Load from GitHub Gist"),L($,`GitHub Token ${S()==="load"?"(optional for public gists)":"(required)"} `),O.disabled=e(ae),we.disabled=e(ae),U.disabled=e(ae)}),B("click",x,be),Ae(O,()=>e(M),o=>v(M,o)),B("blur",O,()=>{e(M)&&!e(G)&&Z()}),B("click",we,function(...o){(S()==="save"?q:K)?.apply(this,o)}),B("click",U,be),B("click",Re,ja(function(o){aa.call(this,n,o)})),B("keydown",Re,function(o){aa.call(this,n,o)}),B("click",ce,be),B("keydown",ce,o=>o.key==="Escape"&&be()),c(a,ce),Rt(),p()}var Ai=u('<div class="loading svelte-1ngjemu">Loading D&D data...</div>'),Fi=u("<option> </option>"),Mi=u('<select class="level-filter svelte-1ngjemu"><option>All Levels</option><option>Cantrip</option><!></select>'),Bi=u('<div class="no-results svelte-1ngjemu"> </div>'),Ii=u('<div class="item-meta svelte-1ngjemu"> </div>'),Ri=u('<div class="item-meta svelte-1ngjemu"> </div>'),Ei=u('<button><div class="item-name svelte-1ngjemu"> </div> <!></button>'),Pi=u('<p class="higher-levels"><strong>At Higher Levels:</strong> </p>'),Ti=u('<p class="cantrip-upgrade"><strong>Cantrip Upgrade:</strong> </p>'),Hi=u('<h3 class="svelte-1ngjemu"> </h3> <p class="spell-meta svelte-1ngjemu"><!> <!></p> <p class="spell-classes"><strong>Classes:</strong> </p> <div class="spell-stats svelte-1ngjemu"><div><strong>Casting Time:</strong> </div> <div><strong>Range:</strong> </div> <div><strong>Components:</strong> <!></div> <div><strong>Duration:</strong> <!> </div></div> <p class="description svelte-1ngjemu"> </p> <!> <!>',1),Ni=u('<p class="prerequisite svelte-1ngjemu"><strong>Prerequisite:</strong> </p>'),Ui=u('<h3 class="svelte-1ngjemu"> </h3> <!> <p class="description svelte-1ngjemu"> </p> <a target="_blank" rel="noopener" class="source-link svelte-1ngjemu">View Full Details â†’</a>',1),Gi=u('<div class="item-details svelte-1ngjemu"><!></div>'),Oi=u('<div class="controls svelte-1ngjemu"><div class="tabs svelte-1ngjemu"><button> </button> <button> </button></div> <div class="search-controls svelte-1ngjemu"><input type="text" placeholder="Search by name or description..." class="search-input svelte-1ngjemu"/> <!></div></div> <div class="content-container svelte-1ngjemu"><div class="items-list svelte-1ngjemu"><!></div> <!></div>',1),qi=u('<div class="modal-backdrop svelte-1ngjemu" role="presentation"><div class="modal svelte-1ngjemu" role="dialog" aria-modal="true" tabindex="-1"><div class="modal-header svelte-1ngjemu"><h2 class="svelte-1ngjemu">Browse D&D Spells & Feats</h2> <button class="close-btn svelte-1ngjemu" aria-label="Close">&times;</button></div> <div class="modal-body svelte-1ngjemu"><!></div> <div class="modal-footer svelte-1ngjemu"><button class="btn-secondary svelte-1ngjemu">Cancel</button> <button class="btn-primary svelte-1ngjemu">Add to Character Sheet</button></div></div></div>');function Wi(a,n){It(n,!1);const t=E(),d=E(),p=E();let m=mt(n,"onClose",8),S=E("spell"),M=E(!0),k=E(""),P=E(null),ae=E([]),z=E([]),G=E(null);na(async()=>{v(M,!0);try{v(ae,await za()),v(z,await Ws())}catch(x){console.error("Failed to load data:",x)}finally{v(M,!1)}});function ke(x){v(G,x)}function ne(x){const ve=x.match(/(\d+d\d+(?:\s*\+\s*\d+)?)/i);return ve?ve[1]:""}function Y(x){const ve=x.split(/\.( |$)/)[0].trim(),h=Array.from(x.matchAll(/\*\*(.*?)\*\*/g)).map(ie=>ie[1].replace(/\.$/,""));let I=ve;return h.length&&(I+=" | Effects: "+h.join(", ")),I}function le(){if(e(G)){if(e(S)==="spell"){const x=e(G);Q.update(ve=>{const I=[];x.range&&I.push(`Range: ${x.range}`),x.castingTime&&I.push(`Cast: ${x.castingTime}`),x.duration&&I.push(`Duration: ${x.duration}`),x.actionType==="Save"&&I.push("Saving throw spell"),x.components&&x.components.length>0&&I.push(`Components: ${x.components.join(", ")}`),x.material&&I.push(`Material: ${x.material}`);const ie=I.join(" | "),f=Y(x.description),$={id:crypto.randomUUID(),name:`${x.name}${x.concentration?" (C)":""}${x.ritual?" (R)":""}`,bonus:x.actionType==="Attack"?5:0,damage:ne(x.description),damageType:`${x.school} (Lvl ${x.level})`,spellRef:x.name,infoNotes:ie,generalNotes:f,castAtLevel:x.level};return ve.attacks=[...ve.attacks,$],ve})}else if(e(S)==="feat"){const x=e(G);Q.update(ve=>{const h=`${x.name}${x.prerequisite?` (Req: ${x.prerequisite})`:""}
${x.description}
`;return ve.features=ve.features?`${ve.features}
${h}`:h,ve})}v(G,null),m()()}}Qe(()=>(e(P),e(ae),e(k)),()=>{v(t,e(P)!==null?zs(Ia(e(ae),e(k)),e(P)):Ia(e(ae),e(k)))}),Qe(()=>(e(z),e(k)),()=>{v(d,Ks(e(z),e(k)))}),Qe(()=>(e(S),e(t),e(d)),()=>{v(p,e(S)==="spell"?e(t):e(d))}),Wt(),Bt();var Z=qi(),Ue=i(Z),H=i(Ue),q=s(i(H),2);l(H);var K=s(H,2),be=i(K);{var ce=x=>{var ve=Ai();c(x,ve)},Re=x=>{var ve=Oi(),h=Ne(ve),I=i(h),ie=i(I);let f;var $=i(ie);l(ie);var O=s(ie,2);let A;var J=i(O);l(O),l(I);var Me=s(I,2),Se=i(Me);$e(Se);var me=s(Se,2);{var Pe=W=>{var pe=Mi();R(()=>{e(P),Dt(()=>{})});var Fe=i(pe);Fe.value=(Fe.__value=null)??"";var Ie=s(Fe);Ie.value=Ie.__value=0;var Be=s(Ie);ut(Be,0,()=>[1,2,3,4,5,6,7,8,9],pt,(T,b)=>{var re=Fi(),Le=i(re);l(re);var Oe={};R(()=>{L(Le,`Level ${b??""}`),Oe!==(Oe=b)&&(re.value=(re.__value=b)??"")}),c(T,re)}),l(pe),qa(pe,()=>e(P),T=>v(P,T)),c(W,pe)};y(me,W=>{e(S)==="spell"&&W(Pe)})}l(Me),l(h);var we=s(h,2),it=i(we),Ye=i(it);{var vt=W=>{var pe=Bi(),Fe=i(pe);l(pe),R(()=>L(Fe,`No ${e(S)??""}s found`)),c(W,pe)},U=W=>{var pe=ot(),Fe=Ne(pe);ut(Fe,1,()=>e(p),pt,(Ie,Be)=>{var T=Ei();let b;var re=i(T),Le=i(re,!0);l(re);var Oe=s(re,2);{var qe=de=>{const Ce=Xe(()=>e(Be));var ge=Ii(),De=i(ge);l(ge),R(()=>L(De,`Level ${N(e(Ce)),r(()=>e(Ce).level)??""} â€¢ ${N(e(Ce)),r(()=>e(Ce).school)??""}`)),c(de,ge)},he=de=>{const Ce=Xe(()=>e(Be));var ge=ot(),De=Ne(ge);{var Te=ue=>{var _e=Ri(),He=i(_e,!0);l(_e),R(()=>L(He,(N(e(Ce)),r(()=>e(Ce).prerequisite)))),c(ue,_e)};y(De,ue=>{N(e(Ce)),r(()=>e(Ce).prerequisite)&&ue(Te)})}c(de,ge)};y(Oe,de=>{e(S)==="spell"?de(qe):de(he,!1)})}l(T),R(()=>{b=ft(T,1,"item-card svelte-1ngjemu",null,b,{selected:e(G)?.name===e(Be).name}),L(Le,(e(Be),r(()=>e(Be).name)))}),B("click",T,()=>ke(e(Be))),c(Ie,T)}),c(W,pe)};y(Ye,W=>{e(p),r(()=>e(p).length===0)?W(vt):W(U,!1)})}l(it);var o=s(it,2);{var ee=W=>{var pe=Gi(),Fe=i(pe);{var Ie=T=>{const b=Xe(()=>e(G));var re=Hi(),Le=Ne(re),Oe=i(Le,!0);l(Le);var qe=s(Le,2),he=i(qe);{var de=g=>{var se=jt();R(()=>L(se,`${N(e(b)),r(()=>e(b).school)??""} cantrip`)),c(g,se)},Ce=g=>{var se=jt();R(()=>L(se,`Level ${N(e(b)),r(()=>e(b).level)??""} ${N(e(b)),r(()=>e(b).school)??""}`)),c(g,se)};y(he,g=>{N(e(b)),r(()=>e(b).level===0)?g(de):g(Ce,!1)})}var ge=s(he,2);{var De=g=>{var se=jt("(ritual)");c(g,se)};y(ge,g=>{N(e(b)),r(()=>e(b).ritual)&&g(De)})}l(qe);var Te=s(qe,2),ue=s(i(Te));l(Te);var _e=s(Te,2),He=i(_e),_=s(i(He));l(He);var D=s(He,2),w=s(i(D));l(D);var j=s(D,2),te=s(i(j)),ye=s(te);{var We=g=>{var se=jt();R(()=>L(se,`(${N(e(b)),r(()=>e(b).material)??""})`)),c(g,se)};y(ye,g=>{N(e(b)),r(()=>e(b).material)&&g(We)})}l(j);var V=s(j,2),F=s(i(V),2);{var je=g=>{var se=jt("Concentration,");c(g,se)};y(F,g=>{N(e(b)),r(()=>e(b).concentration)&&g(je)})}var lt=s(F,1,!0);l(V),l(_e);var rt=s(_e,2),ht=i(rt,!0);l(rt);var tt=s(rt,2);{var at=g=>{var se=Pi(),oe=s(i(se));l(se),R(()=>L(oe,` ${N(e(b)),r(()=>e(b).higherLevelSlot)??""}`)),c(g,se)};y(tt,g=>{N(e(b)),r(()=>e(b).higherLevelSlot)&&g(at)})}var C=s(tt,2);{var X=g=>{var se=Ti(),oe=s(i(se));l(se),R(()=>L(oe,` ${N(e(b)),r(()=>e(b).cantripUpgrade)??""}`)),c(g,se)};y(C,g=>{N(e(b)),r(()=>e(b).cantripUpgrade)&&g(X)})}R((g,se)=>{L(Oe,(N(e(b)),r(()=>e(b).name))),L(ue,` ${g??""}`),L(_,` ${N(e(b)),r(()=>e(b).castingTime||e(b).actionType)??""}`),L(w,` ${N(e(b)),r(()=>e(b).range)??""}`),L(te,` ${se??""}`),L(lt,(N(e(b)),r(()=>e(b).duration))),L(ht,(N(e(b)),r(()=>e(b).description)))},[()=>(N(e(b)),r(()=>e(b).classes.join(", "))),()=>(N(e(b)),r(()=>e(b).components.join(", ").toUpperCase()))]),c(T,re)},Be=T=>{const b=Xe(()=>e(G));var re=Ui(),Le=Ne(re),Oe=i(Le,!0);l(Le);var qe=s(Le,2);{var he=De=>{var Te=Ni(),ue=s(i(Te));l(Te),R(()=>L(ue,` ${N(e(b)),r(()=>e(b).prerequisite)??""}`)),c(De,Te)};y(qe,De=>{N(e(b)),r(()=>e(b).prerequisite)&&De(he)})}var de=s(qe,2),Ce=i(de,!0);l(de);var ge=s(de,2);R(()=>{L(Oe,(N(e(b)),r(()=>e(b).name))),L(Ce,(N(e(b)),r(()=>e(b).description))),ct(ge,"href",(N(e(b)),r(()=>e(b).source)))}),c(T,re)};y(Fe,T=>{e(S)==="spell"?T(Ie):T(Be,!1)})}l(pe),c(W,pe)};y(o,W=>{e(G)&&W(ee)})}l(we),R(()=>{f=ft(ie,1,"tab svelte-1ngjemu",null,f,{active:e(S)==="spell"}),L($,`ðŸ“œ Spells (${e(ae),r(()=>e(ae).length)??""})`),A=ft(O,1,"tab svelte-1ngjemu",null,A,{active:e(S)==="feat"}),L(J,`â­ Feats (${e(z),r(()=>e(z).length)??""})`)}),B("click",ie,()=>{v(S,"spell"),v(G,null),v(k,"")}),B("click",O,()=>{v(S,"feat"),v(G,null),v(k,"")}),Ae(Se,()=>e(k),W=>v(k,W)),c(x,ve)};y(be,x=>{e(M)?x(ce):x(Re,!1)})}l(K);var Ee=s(K,2),Ge=i(Ee),fe=s(Ge,2);l(Ee),l(Ue),l(Z),R(()=>fe.disabled=!e(G)),B("click",q,function(...x){m()?.apply(this,x)}),B("click",Ge,function(...x){m()?.apply(this,x)}),B("click",fe,le),B("click",Ue,ja(function(x){aa.call(this,n,x)})),B("keydown",Ue,function(x){aa.call(this,n,x)}),B("click",Z,function(...x){m()?.apply(this,x)}),B("keydown",Z,x=>x.key==="Escape"&&m()()),c(a,Z),Rt()}var zi=u('<link rel="icon" type="image/png" href="favicon4.png"/> <meta name="viewport" content="width=device-width, initial-scale=1"/>',1),Ki=u('<span class="character-name svelte-1uha8ag"> </span>'),Ji=u("<span> </span>"),Vi=u('<div class="spell-slots-header svelte-1uha8ag"></div>'),Qi=u("<span> </span><br/>",1),Xi=u("<span> </span>"),Yi=u('<span class="effect-tooltip"><strong> </strong><br/> <br/> <!> <!></span>'),Zi=u('<button class="effect-remove-btn svelte-1uha8ag">Ã—</button>'),er=u('<span class="effect-badge svelte-1uha8ag" tabindex="0"> <!> <!></span>'),tr=u(`<div class="active-effects-header svelte-1uha8ag"></div> <style>.effect-badge {
            position: relative;
          }
          .effect-tooltip {
            position: absolute;
            top: 120%;
            left: 50%;
            transform: translateX(-50%);
            background: #fff;
            color: #222;
            border: 1px solid #a5b4fc;
            border-radius: 6px;
            padding: 8px 12px;
            font-size: 0.95em;
            box-shadow: 0 2px 8px rgba(0,0,0,0.12);
            z-index: 10;
            min-width: 180px;
            max-width: 260px;
            white-space: normal;
            pointer-events: none;
            opacity: 1;
            transition: opacity 0.15s;
          }</style>`,1),ar=u('<div class="rest-menu svelte-1uha8ag"><button class="rest-option svelte-1uha8ag">â˜• Short Rest</button> <button class="rest-option svelte-1uha8ag">ðŸ›ï¸ Long Rest</button></div>'),sr=u('<div class="container svelte-1uha8ag"><header class="svelte-1uha8ag"><div class="header-top svelte-1uha8ag"><div class="header-title svelte-1uha8ag"><div class="title-row svelte-1uha8ag"><h1 class="svelte-1uha8ag">D&D Character Sheet</h1> <!></div> <!> <!></div> <div class="header-right svelte-1uha8ag"><div class="header-controls svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">ðŸŽ²</span><span class="btn-text svelte-1uha8ag">Roll Dice</span></button> <div class="rest-button-container svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">ðŸ˜´</span><span class="btn-text svelte-1uha8ag">Rest</span></button> <!></div> <div class="mode-toggle"><button><span class="btn-icon svelte-1uha8ag"> </span><span class="btn-text svelte-1uha8ag"> </span></button></div></div> <div class="header-search svelte-1uha8ag"><input type="text" placeholder="ðŸ” Search..." class="search-input use-enabled svelte-1uha8ag"/></div></div></div> <div class="header-actions svelte-1uha8ag"><button class="btn btn-mode svelte-1uha8ag">ðŸ“š Browse Spells & Feats</button> <button class="btn btn-secondary">Save to Gist</button> <button class="btn btn-secondary">Load from Gist</button> <button class="btn btn-secondary">Export JSON</button> <button class="btn btn-secondary">Import JSON</button> <input type="file" accept=".json" style="display: none;"/></div></header> <main class="svelte-1uha8ag"><!> <!> <!> <!> <!> <!> <!></main></div> <!> <!> <!> <!>',1);function ur(a,n){It(n,!1);const t=()=>ze(Q,"$character",m),d=()=>ze(ta,"$isEditMode",m),p=()=>ze(Qt,"$searchFilter",m),[m,S]=Nt();function M(){const C=[],X=t().classFeatures.spellSlotsByLevel||{};for(let g=1;g<=9;g++){const se=X[g];if(se&&se.length>0){const oe=se.length,st=se.filter(xe=>xe).length;C.push({level:g,available:oe-st,total:oe})}}return C}let k=E(!1),P=E(!1),ae=E(!1),z=E("save"),G=E(void 0),ke=E(""),ne=E(""),Y=E(""),le=E(!1),Z=E([]),Ue=E(),H=!1,q=E(!1),K=E(null);function be(C){v(K,C)}function ce(){v(K,null)}function Re(C){v(K,e(K)===C?null:C)}function Ee(){const C=[];Q.update(g=>{const se=g.hitDice.current;g.hitDice.current=Math.min(g.hitDice.max,g.hitDice.current+Math.max(1,Math.floor(g.hitDice.max/2)));const oe=g.hitDice.current-se;if(oe>0&&C.push(`${oe} hit ${oe===1?"die":"dice"}`),g.class){const st=sa(g.class,g.level,g.subclass);g.classFeatures.features||(g.classFeatures.features={}),st.forEach(xe=>{if(xe.resetOn==="short"){const Je=xe.name.replace(/\s+/g,"");if(xe.type==="uses"){const Ke=typeof xe.maxUses=="function"?xe.maxUses(g.level):xe.maxUses;g.classFeatures.features[Je]=Array(Ke).fill(!1),C.push(xe.name)}else if(xe.type==="pool"){const Ke=typeof xe.maxPool=="function"?xe.maxPool(g.level):xe.maxPool;Ke!==void 0&&(g.classFeatures.features[Je]=Ke,C.push(xe.name))}}})}return g}),v(q,!1);const X=C.length>0?`Short rest taken! Restored: ${C.join(", ")}`:"Short rest taken!";Et.add(X,"success")}function Ge(){const C=[];Q.update(g=>{const se=g.maxHP-g.currentHP;se>0&&C.push(`${se} HP`),g.currentHP=g.maxHP,g.tempHP=0;const oe=g.hitDice.max-g.hitDice.current;oe>0&&C.push(`${oe} hit ${oe===1?"die":"dice"}`),g.hitDice.current=g.hitDice.max;let st=0;if(g.classFeatures.spellSlotsByLevel&&Object.keys(g.classFeatures.spellSlotsByLevel).forEach(xe=>{const Je=g.classFeatures.spellSlotsByLevel[parseInt(xe)];if(Je){const Ke=Je.filter(dt=>dt).length;st+=Ke,g.classFeatures.spellSlotsByLevel[parseInt(xe)]=Array(Je.length).fill(!1)}}),st>0&&C.push(`${st} spell ${st===1?"slot":"slots"}`),g.class){const xe=sa(g.class,g.level,g.subclass);g.classFeatures.features||(g.classFeatures.features={});let Je=!1;xe.forEach(Ke=>{const dt=Ke.name.replace(/\s+/g,"");if(!(Ke.type==="info"||Ke.type==="channelDivinity")){if(Ke.type==="uses"){const _t=typeof Ke.maxUses=="function"?Ke.maxUses(g.level):Ke.maxUses;g.classFeatures.features[dt]=Array(_t).fill(!1),Je=!0}else if(Ke.type==="pool"){const _t=typeof Ke.maxPool=="function"?Ke.maxPool(g.level):Ke.maxPool;_t!==void 0&&(g.classFeatures.features[dt]=_t,Je=!0)}}}),Je&&C.push("all class features")}return g}),v(q,!1);const X=C.length>0?`Long rest taken! Restored: ${C.join(", ")}`:"Long rest taken! Fully rested.";Et.add(X,"success")}function fe(C){v(ke,""),v(ne,""),v(Y,""),v(le,!1),v(Z,[]),H=!1,typeof C=="string"?v(ke,C):(v(ke,C.notation),v(ne,C.damageNotation||""),v(Y,C.attackName||""),v(le,!!C.applyHalfDamage),v(Z,C.bonusBreakdown||[])),v(k,!0)}function x(C){const{notation:X}=C.detail;v(ke,""),H=!0,setTimeout(()=>{v(ke,X),v(ne,""),v(Y,"Hit Die")},0),v(k,!0)}function ve(){if(v(k,!1),H&&e(Ue)){const C=e(Ue).getLastRollTotal();if(C!==null){const X=Math.max(1,C);Q.update(g=>(g.hitDice.current=Math.max(0,g.hitDice.current-1),g.currentHP=Math.min(g.maxHP,g.currentHP+X),g))}H=!1}}function h(){console.log("toggleMode called, current isEditMode:",d()),ta.update(C=>(console.log("Updating isEditMode from",C,"to",!C),!C))}function I(C){C.target.closest(".rest-button-container")||v(q,!1)}na(()=>{console.log("onMount - initial isEditMode:",d()),console.log("onMount - body classes:",document.body.className);const C=ta.subscribe(X=>{console.log("isEditMode subscription triggered, value:",X),console.log("Body classes before:",document.body.className),X?(document.body.classList.remove("use-mode"),console.log("Removed use-mode class (Edit Mode)")):(document.body.classList.add("use-mode"),console.log("Added use-mode class (Use Mode)")),console.log("Body classes after:",document.body.className)});return document.addEventListener("click",I),()=>{C(),document.removeEventListener("click",I)}});function ie(){cs(t())}function f(){e(G)?.click()}async function $(C){const g=C.target.files?.[0];if(g)try{const se=await vs(g);Q.set(se),alert("Character imported successfully!")}catch{alert("Failed to import character file")}}Bt();var O=sr();ns("1uha8ag",C=>{var X=zi();pa(2),Na(()=>{is.title="D&D Character Sheet"}),c(C,X)});var A=Ne(O),J=i(A),Me=i(J),Se=i(Me),me=i(Se),Pe=s(i(me),2);{var we=C=>{var X=Ki(),g=i(X);l(X),R(()=>L(g,`${t().name??""} (${t().level??""})`)),c(C,X)};y(Pe,C=>{t().name&&C(we)})}l(me);var it=s(me,2);{var Ye=C=>{var X=Vi();ut(X,5,M,pt,(g,se)=>{var oe=Ji();let st;var xe=i(oe);l(oe),R(()=>{st=ft(oe,1,"slot-badge svelte-1uha8ag",null,st,{depleted:e(se).available===0}),L(xe,`Lv${e(se).level??""}: ${e(se).available??""}/${e(se).total??""}`)}),c(g,oe)}),l(X),c(C,X)};y(it,C=>{M().length>0&&C(Ye)})}var vt=s(it,2);{var U=C=>{var X=tr(),g=Ne(X);ut(g,5,()=>t().activeStates,pt,(se,oe,st)=>{var xe=er(),Je=i(xe),Ke=s(Je);{var dt=Ft=>{var Ve=Yi(),Ze=i(Ve),kt=i(Ze,!0);l(Ze);var xt=s(Ze,2),Ht=s(xt,3);{var zt=gt=>{var Ct=Qi(),et=Ne(Ct),Lt=i(et);l(et),pa(),R(()=>L(Lt,`Attack Bonus: ${e(oe).attackBonus>0?"+":""}${e(oe).attackBonus??""}`)),c(gt,Ct)};y(Ht,gt=>{e(oe).attackBonus&&gt(zt)})}var $t=s(Ht,2);{var Ut=gt=>{var Ct=Xi(),et=i(Ct);l(Ct),R(()=>L(et,`Damage Bonus: ${e(oe).damageBonus>0?"+":""}${e(oe).damageBonus??""}`)),c(gt,Ct)};y($t,gt=>{e(oe).damageBonus&&gt(Ut)})}l(Ve),R(()=>{L(kt,e(oe).name),L(xt,` ${e(oe).description??""}`)}),c(Ft,Ve)};y(Ke,Ft=>{e(K)===st&&Ft(dt)})}var _t=s(Ke,2);{var Tt=Ft=>{var Ve=Zi();R(()=>ct(Ve,"title",`End ${e(oe).name??""}`)),B("click",Ve,()=>{Q.update(Ze=>(Ze.activeStates&&(Ze.activeStates=Ze.activeStates.filter((kt,xt)=>xt!==st)),Ze))}),c(Ft,Ve)};y(_t,Ft=>{d()||Ft(Tt)})}l(xe),R(()=>{ct(xe,"aria-label",e(oe).name),L(Je,`âœ¨ ${e(oe).name??""} `)}),B("mouseenter",xe,()=>be(st)),B("mouseleave",xe,ce),B("focus",xe,()=>be(st)),B("blur",xe,ce),B("click",xe,()=>Re(st)),c(se,xe)}),l(g),pa(2),c(C,X)};y(vt,C=>{t().activeStates&&t().activeStates.length>0&&C(U)})}l(Se);var o=s(Se,2),ee=i(o),W=i(ee),pe=s(W,2),Fe=i(pe),Ie=s(Fe,2);{var Be=C=>{var X=ar(),g=i(X),se=s(g,2);l(X),B("click",g,Ee),B("click",se,Ge),c(C,X)};y(Ie,C=>{e(q)&&C(Be)})}l(pe);var T=s(pe,2),b=i(T);let re;var Le=i(b),Oe=i(Le,!0);l(Le);var qe=s(Le),he=i(qe,!0);l(qe),l(b),l(T),l(ee);var de=s(ee,2),Ce=i(de);$e(Ce),l(de),l(o),l(Me);var ge=s(Me,2),De=i(ge),Te=s(De,2),ue=s(Te,2),_e=s(ue,2),He=s(_e,2),_=s(He,2);xa(_,C=>v(G,C),()=>e(G)),l(ge),l(J);var D=s(J,2),w=i(D);ws(w,{});var j=s(w,2);Ns(j,{$$events:{rollHitDice:x}});var te=s(j,2);Fs(te,{$$events:{roll:C=>fe(C.detail)}});var ye=s(te,2);qs(ye,{$$events:{roll:C=>fe(C.detail)}});var We=s(ye,2);jl(We,{$$events:{roll:C=>fe(C.detail)}});var V=s(We,2);zl(V,{});var F=s(V,2);Vl(F,{}),l(D),l(A);var je=s(A,2);xa(ci(je,{get notation(){return e(ke)},get damageNotation(){return e(ne)},get attackName(){return e(Y)},get applyHalfDamage(){return e(le)},get bonusBreakdown(){return e(Z)},get visible(){return e(k)},$$events:{close:ve},$$legacy:!0}),C=>v(Ue,C),()=>e(Ue));var lt=s(je,2);{var rt=C=>{ji(C,{get mode(){return e(z)},$$events:{close:()=>v(P,!1)}})};y(lt,C=>{e(P)&&C(rt)})}var ht=s(lt,2);{var tt=C=>{Wi(C,{onClose:()=>v(ae,!1)})};y(ht,C=>{e(ae)&&C(tt)})}var at=s(ht,2);os(at,{}),R(()=>{re=ft(b,1,"btn btn-mode svelte-1uha8ag",null,re,{"use-mode":!d()}),L(Oe,d()?"ðŸ“":"ðŸŽ²"),L(he,d()?"Edit Mode":"Use Mode")}),B("click",W,()=>v(k,!0)),B("click",Fe,()=>v(q,!e(q))),B("click",b,h),Ae(Ce,p,C=>ds(Qt,C)),B("click",De,()=>v(ae,!0)),B("click",Te,()=>{v(z,"save"),v(P,!0)}),B("click",ue,()=>{v(z,"load"),v(P,!0)}),B("click",_e,ie),B("click",He,f),B("change",_,$),c(a,O),Rt(),S()}export{ur as component};
