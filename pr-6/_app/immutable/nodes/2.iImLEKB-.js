import{d as $s,g as Ks,f as u,e as B,a as o,s as k,c as kt,t as Tt}from"../chunks/BESELRjb.js";import{i as Yt}from"../chunks/JMgyEzd3.js";import{c as $a,o as Sa,a as Vs,b as Js}from"../chunks/CtPH092J.js";import{F as D,T as ya,Y as us,j as Ys,aZ as Qs,U as ks,ag as Xs,aD as Zs,aK as el,aE as tl,a1 as al,av as Ga,a7 as hs,i as Ps,a_ as sl,a$ as Is,b0 as Qa,K as ka,e as Es,b1 as Us,b2 as ll,b3 as rl,b4 as il,q as fs,b5 as nl,b6 as ol,ab as cl,d as i,r as _s,g as vl,C as Qt,G as Xt,H as l,I as s,J as a,b7 as Ze,b8 as ga,s as n,a4 as C,f as e,m as xt,E as Ae,b9 as Kt,ao as sa,A as E,ba as _a,bb as ja,bc as dl}from"../chunks/DyJ43TGI.js";import{t as ul,c as la,a as fe,e as Lt,i as Rt,u as Ns,s as xa,b as Et,d as Xa,f as wa,g as Ja,j as fl,k as Ht,l as pl,m as ws,n as rs,h as ml,T as gl,o as bl,p as hl,r as Ss,q as Cs}from"../chunks/Fq0DehG0.js";import{i as m,s as fa,a as _t,b as Ot,d as Pa,e as _l}from"../chunks/CCL4udNy.js";import{p as Bt,b as Ua}from"../chunks/iXw84bXb.js";import{b as Ia,r as yl}from"../chunks/DoZECg9Y.js";function ps(r,c,t=!1,v=!1,f=!1){var p=r,g="";D(()=>{var w=Ys;if(g===(g=c()??"")){ya&&us();return}if(w.nodes_start!==null&&(Qs(w.nodes_start,w.nodes_end),w.nodes_start=w.nodes_end=null),g!==""){if(ya){ks.data;for(var h=us(),_=h;h!==null&&(h.nodeType!==Xs||h.data!=="");)_=h,h=Zs(h);if(h===null)throw el(),tl;$s(ks,_),p=al(h);return}var q=g+"";t?q=`<svg>${q}</svg>`:v&&(q=`<math>${q}</math>`);var I=Ks(q);if((t||v)&&(I=Ga(I)),$s(Ga(I),I.lastChild),t||v)for(;Ga(I);)p.before(Ga(I));else p.before(I)}})}function xl(r,c,t,v,f){ya&&us();var p=c.$$slots?.[t],g=!1;p===!0&&(p=c[t],g=!0),p===void 0?f!==null&&f(r):p(r,g?()=>v:v)}function $l(r,c,t,v){var f=r.__style;if(ya||f!==c){var p=ul(c);(!ya||p!==r.getAttribute("style"))&&(p==null?r.removeAttribute("style"):r.style.cssText=p),r.__style=c}return v}function Ya(r,c,t=!1){if(r.multiple){if(c==null)return;if(!Ps(c))return sl();for(var v of r.options)v.selected=c.includes(Ea(v));return}for(v of r.options){var f=Ea(v);if(Is(f,c)){v.selected=!0;return}}(!t||c!==void 0)&&(r.selectedIndex=-1)}function ms(r){var c=new MutationObserver(()=>{Ya(r,r.__value)});c.observe(r,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),hs(()=>{c.disconnect()})}function Na(r,c,t=c){var v=new WeakSet,f=!0;Qa(r,"change",p=>{var g=p?"[selected]":":checked",w;if(r.multiple)w=[].map.call(r.querySelectorAll(g),Ea);else{var h=r.querySelector(g)??r.querySelector("option:not([disabled])");w=h&&Ea(h)}t(w),ka!==null&&v.add(ka)}),Es(()=>{var p=c();if(r===document.activeElement){var g=Us??ka;if(v.has(g))return}if(Ya(r,p,f),f&&p===void 0){var w=r.querySelector(":checked");w!==null&&(p=Ea(w),t(p))}r.__value=p,f=!1}),ms(r)}function Ea(r){return"__value"in r?r.__value:r.value}const kl=Symbol("is custom element"),wl=Symbol("is html");function Se(r){if(ya){var c=!1,t=()=>{if(!c){if(c=!0,r.hasAttribute("value")){var v=r.value;vt(r,"value",null),r.value=v}if(r.hasAttribute("checked")){var f=r.checked;vt(r,"checked",null),r.checked=f}}};r.__on_r=t,fs(t),nl()}}function Ra(r,c){var t=ys(r);t.value===(t.value=c??void 0)||r.value===c&&(c!==0||r.nodeName!=="PROGRESS")||(r.value=c??"")}function Hs(r,c){var t=ys(r);t.checked!==(t.checked=c??void 0)&&(r.checked=c)}function vt(r,c,t,v){var f=ys(r);ya&&(f[c]=r.getAttribute(c),c==="src"||c==="srcset"||c==="href"&&r.nodeName==="LINK")||f[c]!==(f[c]=t)&&(c==="loading"&&(r[ll]=t),t==null?r.removeAttribute(c):typeof t!="string"&&Sl(r).includes(c)?r[c]=t:r.setAttribute(c,t))}function ys(r){return r.__attributes??={[kl]:r.nodeName.includes("-"),[wl]:r.namespaceURI===rl}}var Ds=new Map;function Sl(r){var c=r.getAttribute("is")||r.nodeName,t=Ds.get(c);if(t)return t;Ds.set(c,t=[]);for(var v,f=r,p=Element.prototype;p!==f;){v=ol(f);for(var g in v)v[g].set&&t.push(g);f=il(f)}return t}function We(r,c,t=c){var v=new WeakSet;Qa(r,"input",async f=>{var p=f?r.defaultValue:r.value;if(p=ns(r)?os(p):p,t(p),ka!==null&&v.add(ka),await cl(),p!==(p=c())){var g=r.selectionStart,w=r.selectionEnd,h=r.value.length;if(r.value=p??"",w!==null){var _=r.value.length;g===w&&w===h&&_>h?(r.selectionStart=_,r.selectionEnd=_):(r.selectionStart=g,r.selectionEnd=Math.min(w,_))}}}),(ya&&r.defaultValue!==r.value||i(c)==null&&r.value)&&(t(ns(r)?os(r.value):r.value),ka!==null&&v.add(ka)),_s(()=>{var f=c();if(r===document.activeElement){var p=Us??ka;if(v.has(p))return}ns(r)&&f===os(r.value)||r.type==="date"&&!f&&!r.value||f!==r.value&&(r.value=f??"")})}const is=new Set;function Ls(r,c,t,v,f=v){var p=t.getAttribute("type")==="checkbox",g=r;let w=!1;if(c!==null)for(var h of c)g=g[h]??=[];g.push(t),Qa(t,"change",()=>{var _=t.__value;p&&(_=As(g,_,t.checked)),f(_)},()=>f(p?[]:null)),_s(()=>{var _=v();if(ya&&t.defaultChecked!==t.checked){w=!0;return}p?(_=_||[],t.checked=_.includes(t.__value)):t.checked=Is(t.__value,_)}),hs(()=>{var _=g.indexOf(t);_!==-1&&g.splice(_,1)}),is.has(g)||(is.add(g),fs(()=>{g.sort((_,q)=>_.compareDocumentPosition(q)===4?-1:1),is.delete(g)})),fs(()=>{if(w){var _;if(p)_=As(g,_,t.checked);else{var q=g.find(I=>I.checked);_=q?.__value}f(_)}})}function Aa(r,c,t=c){Qa(r,"change",v=>{var f=v?r.defaultChecked:r.checked;t(f)}),(ya&&r.defaultChecked!==r.checked||i(c)==null)&&t(r.checked),_s(()=>{var v=c();r.checked=!!v})}function As(r,c,t){for(var v=new Set,f=0;f<r.length;f+=1)r[f].checked&&v.add(r[f].__value);return t||v.delete(c),Array.from(v)}function ns(r){var c=r.type;return c==="number"||c==="range"}function os(r){return r===""?null:+r}function Cl(r,c,t){var v=vl(r,c);v&&v.set&&(r[c]=t,hs(()=>{r[c]=null}))}function xs(r){return function(...c){var t=c[0];return t.stopPropagation(),r?.apply(this,c)}}function Ma(r,c){var t=r.$$events?.[c.type],v=Ps(t)?t.slice():t==null?[]:[t];for(var f of v)f.call(this,c)}const Dl="";function Os(...r){return Ia+Dl+yl(r[0],r[1])}const gs={paladin:{name:"Paladin",hitDice:"d10",spellcaster:!0,spellcastingAbility:"charisma",spellSlotsByLevel:{1:0,2:2,3:3,4:3,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Divine Sense",type:"uses",maxUses:(r,c=1)=>1+Math.max(1,c),resetOn:"long",description:"Detect celestials, fiends, and undead within 60 feet",minLevel:1},{name:"Lay on Hands",type:"pool",maxPool:r=>r*5,resetOn:"long",description:"Heal wounds or cure disease",minLevel:1},{name:"Divine Smite",type:"spellSlot",description:"Expend spell slot to deal extra radiant damage",minLevel:2,rollable:!0},{name:"Channel Divinity",type:"pool",maxPool:r=>r>=18?3:r>=6?2:1,resetOn:"short",description:"Sacred Weapon or Turn Undead",minLevel:3}]},fighter:{name:"Fighter",hitDice:"d10",spellcaster:!1,features:[{name:"Second Wind",type:"uses",maxUses:1,resetOn:"short",description:"Regain 1d10 + fighter level HP as bonus action",minLevel:1,rollable:!0,rollFormula:r=>`1d10+${r}`},{name:"Action Surge",type:"uses",maxUses:r=>r>=17?2:1,resetOn:"short",description:"Take one additional action on your turn",minLevel:2},{name:"Indomitable",type:"uses",maxUses:r=>r>=17?3:r>=13?2:1,resetOn:"long",description:"Reroll a failed saving throw",minLevel:9}],subclasses:{champion:{name:"Champion",features:[{name:"Improved Critical",type:"info",description:"Critical hit on 19-20",minLevel:3},{name:"Remarkable Athlete",type:"info",description:"Add half proficiency to STR/DEX/CON checks, increase long jump distance",minLevel:7},{name:"Additional Fighting Style",type:"info",description:"Choose a second fighting style",minLevel:10},{name:"Superior Critical",type:"info",description:"Critical hit on 18-20",minLevel:15},{name:"Survivor",type:"info",description:"Regain 5 + CON mod HP at start of turn if below half HP",minLevel:18}]},battlemaster:{name:"Battle Master",features:[{name:"Combat Superiority",type:"uses",maxUses:r=>r>=15?6:r>=7?5:4,resetOn:"short",description:r=>`Use superiority dice (${r>=18?"d12":r>=10?"d10":"d8"}) for maneuvers`,minLevel:3},{name:"Know Your Enemy",type:"info",description:"Learn capabilities of creatures you observe",minLevel:7},{name:"Improved Combat Superiority",type:"info",description:"Superiority dice become d10",minLevel:10},{name:"Relentless",type:"info",description:"Regain 1 superiority die if you have none at start of turn",minLevel:15}]}}},rogue:{name:"Rogue",hitDice:"d8",spellcaster:!1,features:[{name:"Sneak Attack",type:"info",description:r=>`Deal ${Math.ceil(r/2)}d6 extra damage once per turn with advantage or ally nearby`,minLevel:1,rollable:!0,rollFormula:r=>`${Math.ceil(r/2)}d6`},{name:"Cunning Action",type:"info",description:"Dash, Disengage, or Hide as a bonus action",minLevel:2},{name:"Uncanny Dodge",type:"info",description:"Use reaction to halve damage from an attack",minLevel:5},{name:"Evasion",type:"info",description:"Take no damage on successful Dex save (half on fail)",minLevel:7}]},wizard:{name:"Wizard",hitDice:"d6",spellcaster:!0,spellcastingAbility:"intelligence",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Arcane Recovery",type:"uses",maxUses:1,resetOn:"long",description:r=>`Recover spell slots totaling up to ${Math.ceil(r/2)} levels during short rest`,minLevel:1},{name:"Spell Mastery",type:"info",description:"Cast one 1st-level and one 2nd-level spell at will",minLevel:18}]},cleric:{name:"Cleric",hitDice:"d8",spellcaster:!0,spellcastingAbility:"wisdom",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Channel Divinity",type:"pool",maxPool:r=>r>=18?4:r>=6?3:2,resetOn:"short",description:"Turn Undead or domain-specific ability",minLevel:2},{name:r=>r>=5?"Sear Undead":"Turn Undead",subName:r=>r>=5?"Improved Turn Undead":null,type:"channelDivinity",description:(r,c=1)=>{let t="As a Magic action, you present your Holy Symbol and censure Undead creatures. Each Undead of your choice within 30 feet of you must make a Wisdom saving throw. If the creature fails its save, it has the Frightened and Incapacitated conditions for 1 minute. For that duration, it tries to move as far from you as it can on its turns. This effect ends early on the creature if it takes any damage, if you have the Incapacitated condition, or if you die.";if(r>=5){const v=Math.max(1,c);t+=` <br /><br />
            
          With Sear Undead, roll ${v}d8 radiant damage to turned undead.`}return t},minLevel:2,rollable:!0,rollFormula:(r,c=1)=>r>=5?`${Math.max(1,c)}d8`:""},{name:"Divine Intervention",type:"uses",maxUses:1,resetOn:"long",description:r=>`${r}% chance to succeed, implore deity for aid`,minLevel:10}],subclasses:{war:{name:"War Domain",features:[{name:"War Priest",type:"uses",maxUses:(r,c=1)=>Math.max(1,c),resetOn:"long",description:"Make one weapon attack as a bonus action",minLevel:1},{name:"Channel Divinity",type:"info",description:"Additional Channel Divinity options from War Domain",minLevel:2,subFeatures:[{name:"Guided Strike",type:"channelDivinity",description:"Use your Channel Divinity to gain +10 to an attack roll. Make this choice after you see the roll, but before the DM says whether the attack hits or misses.",minLevel:2},{name:"War God's Blessing",type:"channelDivinity",description:"Use reaction to grant +10 to an ally's attack roll within 30 feet. Consumes one use of Channel Divinity.",minLevel:6,resetOn:"short"}]},{name:"Divine Strike",type:"info",description:r=>`Deal extra ${r>=14?"2d8":"1d8"} weapon damage once per turn`,minLevel:8,rollable:!0,rollFormula:r=>r>=14?"2d8":"1d8"},{name:"Avatar of Battle",type:"info",description:"Gain resistance to nonmagical weapon damage",minLevel:17}]},life:{name:"Life Domain",features:[{name:"Disciple of Life",type:"info",description:"Healing spells restore additional 2 + spell level HP",minLevel:1},{name:"Preserve Life",type:"pool",maxPool:r=>r*5,resetOn:"short",description:"Restore HP to creatures within 30 feet",minLevel:2},{name:"Blessed Healer",type:"info",description:"Regain 2 + spell level HP when you cast healing spell",minLevel:6},{name:"Divine Strike",type:"info",description:r=>`Deal extra ${r>=14?"2d8":"1d8"} radiant damage once per turn`,minLevel:8,rollable:!0,rollFormula:r=>r>=14?"2d8":"1d8"},{name:"Supreme Healing",type:"info",description:"Maximize healing dice instead of rolling",minLevel:17}]}}},barbarian:{name:"Barbarian",hitDice:"d12",spellcaster:!1,features:[{name:"Rage",type:"uses",maxUses:r=>r>=20?1/0:r>=17?6:r>=12?5:r>=6?4:r>=3?3:2,resetOn:"long",description:r=>`+${r>=16?4:r>=9?3:2} damage, resistance to physical damage`,minLevel:1},{name:"Reckless Attack",type:"info",description:"Gain advantage on melee attacks, enemies get advantage on you",minLevel:2},{name:"Danger Sense",type:"info",description:"Advantage on Dex saves against effects you can see",minLevel:2}],subclasses:{berserker:{name:"Path of the Berserker",features:[{name:"Frenzy",type:"info",description:"While raging, make melee attack as bonus action (gain 1 exhaustion after rage)",minLevel:3},{name:"Mindless Rage",type:"info",description:"Cannot be charmed or frightened while raging",minLevel:6},{name:"Intimidating Presence",type:"info",description:"Use action to frighten creature within 30 feet",minLevel:10},{name:"Retaliation",type:"info",description:"When damaged by creature within 5 feet, make melee attack as reaction",minLevel:14}]}}}};function ua(r){const c=r.toLowerCase();return gs[c]||null}function Ta(r,c,t){const v=ua(r);if(!v)return[];const f=v.features.filter(p=>!p.minLevel||p.minLevel<=c);if(t&&v.subclasses&&v.subclasses[t]){const p=v.subclasses[t].features.filter(g=>!g.minLevel||g.minLevel<=c);return[...f,...p]}return f}function js(r){const c=ua(r);return!c||!c.subclasses?[]:Object.keys(c.subclasses).map(t=>({id:t,name:c.subclasses[t].name}))}function Bs(r,c){const t=ua(r);return!t||!t.spellcaster||!t.spellSlotsByLevel?0:t.spellSlotsByLevel[c]||0}function Rs(r,c,t){const v=ua(r);return!v||!v.spellcaster?0:Math.max(1,t+c)}function Ll(r,c,t){const v=ua(r);return!v||!v.spellcaster?null:8+c+t}function Al(){return Object.keys(gs).map(r=>({id:r,name:gs[r].name}))}var jl=u('<div class="section-header svelte-ls99y2" role="button" tabindex="0"><h2 class="svelte-ls99y2"> </h2> <span class="collapse-btn svelte-ls99y2"> </span></div>');function Ca(r,c){Qt(c,!1);let t=Bt(c,"title",8),v=Bt(c,"collapsed",8),f=Bt(c,"ariaLabel",8,""),p=Bt(c,"onToggle",8);Yt();var g=jl(),w=l(g),h=l(w,!0);s(w);var _=a(w,2),q=l(_,!0);s(_),s(g),D(()=>{vt(g,"aria-expanded",!v()),vt(g,"aria-label",f()),k(h,t()),k(q,v()?"‚ñº":"‚ñ≤")}),B("click",g,function(...I){p()?.apply(this,I)}),B("keydown",g,I=>{(I.key==="Enter"||I.key===" ")&&p()()}),o(r,g),Xt()}var Bl=u("<option> </option>"),Rl=u("<option> </option>"),Ml=u('<div class="form-group svelte-172i2fj"><label for="characterSubclass" class="svelte-172i2fj">Subclass</label> <select id="characterSubclass" class="svelte-172i2fj"><option>Select Subclass</option><!></select></div>'),Tl=u('<div class="info-grid svelte-172i2fj"><div class="form-group svelte-172i2fj"><label for="characterName" class="svelte-172i2fj">Character Name</label> <input type="text" id="characterName" placeholder="Enter name" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterClass" class="svelte-172i2fj">Class</label> <select id="characterClass" class="svelte-172i2fj"><option>Select Class</option><!></select></div> <!> <div class="form-group svelte-172i2fj"><label for="characterLevel" class="svelte-172i2fj">Level</label> <input type="number" id="characterLevel" min="1" max="20" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterRace" class="svelte-172i2fj">Race</label> <input type="text" id="characterRace" placeholder="e.g., Human" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterBackground" class="svelte-172i2fj">Background</label> <input type="text" id="characterBackground" placeholder="e.g., Soldier" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterAlignment" class="svelte-172i2fj">Alignment</label> <input type="text" id="characterAlignment" placeholder="e.g., Lawful Good" class="svelte-172i2fj"/></div></div>'),Fl=u('<section class="character-info svelte-172i2fj"><!> <!></section>');function Pl(r,c){Qt(c,!1);const t=()=>_t(fe,"$character",f),v=()=>_t(la,"$collapsedStates",f),[f,p]=fa(),g=C(),w=Al();function h(U){const R=U.target;fe.update(F=>(F.class=R.value,F.subclass="",F))}function _(U){const R=U.target;fe.update(F=>(F.subclass=R.value,F))}function q(U){const R=U.target;fe.update(F=>(F.level=parseInt(R.value)||1,F)),Ns()}Ze(()=>(t(),js),()=>{n(g,t().class?js(t().class):[])}),ga(),Yt();var I=Fl(),ae=l(I);{let U=xt(()=>(v(),i(()=>v().characterInfo?"Expand":"Collapse")));Ca(ae,{title:"Character Info",get collapsed(){return v(),i(()=>v().characterInfo)},get ariaLabel(){return e(U)},onToggle:()=>la.update(R=>({...R,characterInfo:!R.characterInfo}))})}var Q=a(ae,2);{var se=U=>{var R=Tl(),F=l(R),le=a(l(F),2);Se(le),s(F);var he=a(F,2),qe=a(l(he),2),ce=l(qe);ce.value=ce.__value="";var re=a(ce);Lt(re,1,()=>w,Rt,(be,pe)=>{var we=Bl(),y=l(we,!0);s(we);var O={};D(()=>{k(y,(e(pe),i(()=>e(pe).name))),O!==(O=(e(pe),i(()=>e(pe).id)))&&(we.value=(we.__value=(e(pe),i(()=>e(pe).id)))??"")}),o(be,we)}),s(qe);var _e;ms(qe),s(he);var Ie=a(he,2);{var Qe=be=>{var pe=Ml(),we=a(l(pe),2),y=l(we);y.value=y.__value="";var O=a(y);Lt(O,1,()=>e(g),Rt,(ft,ut)=>{var yt=Rl(),Ct=l(yt,!0);s(yt);var Dt={};D(()=>{k(Ct,(e(ut),i(()=>e(ut).name))),Dt!==(Dt=(e(ut),i(()=>e(ut).id)))&&(yt.value=(yt.__value=(e(ut),i(()=>e(ut).id)))??"")}),o(ft,yt)}),s(we);var Te;ms(we),s(pe),D(()=>{Te!==(Te=(t(),i(()=>t().subclass)))&&(we.value=(we.__value=(t(),i(()=>t().subclass)))??"",Ya(we,(t(),i(()=>t().subclass))))}),B("change",we,_),o(be,pe)};m(Ie,be=>{e(g),i(()=>e(g).length>0)&&be(Qe)})}var T=a(Ie,2),M=a(l(T),2);Se(M),s(T);var x=a(T,2),J=a(l(x),2);Se(J),s(x);var W=a(x,2),ge=a(l(W),2);Se(ge),s(W);var $e=a(W,2),ke=a(l($e),2);Se(ke),s($e),s(R),D(()=>{_e!==(_e=(t(),i(()=>t().class)))&&(qe.value=(qe.__value=(t(),i(()=>t().class)))??"",Ya(qe,(t(),i(()=>t().class)))),Ra(M,(t(),i(()=>t().level)))}),We(le,()=>t().name,be=>Ot(fe,i(t).name=be,i(t))),B("change",qe,h),B("change",M,q),We(J,()=>t().race,be=>Ot(fe,i(t).race=be,i(t))),We(ge,()=>t().background,be=>Ot(fe,i(t).background=be,i(t))),We(ke,()=>t().alignment,be=>Ot(fe,i(t).alignment=be,i(t))),o(U,R)};m(Q,U=>{v(),i(()=>!v().characterInfo)&&U(se)})}s(I),o(r,I),Xt(),p()}var Il=u('<div class="ability-card svelte-bbv1xt"><h3 class="svelte-bbv1xt"> </h3> <input type="number" class="ability-score svelte-bbv1xt" min="1" max="30"/> <div class="ability-modifier svelte-bbv1xt"> </div> <div class="roll-buttons svelte-bbv1xt"><button class="roll-btn svelte-bbv1xt">Check</button> <button class="roll-btn svelte-bbv1xt">Save</button></div> <div class="save-proficiency svelte-bbv1xt"><input type="checkbox" class="svelte-bbv1xt"/> <label class="svelte-bbv1xt">Save Prof.</label></div></div>'),El=u('<div class="proficiency-bonus svelte-bbv1xt"><label for="profBonus">Proficiency Bonus</label> <input type="number" id="profBonus" class="prof-input svelte-bbv1xt"/></div> <div class="abilities-grid svelte-bbv1xt"></div>',1),Ul=u("<section><!> <!></section>");function Nl(r,c){Qt(c,!1);const t=()=>_t(Xa,"$abilityModifiers",w),v=()=>_t(fe,"$character",w),f=()=>_t(xa,"$searchFilter",w),p=()=>_t(la,"$collapsedStates",w),g=()=>_t(wa,"$isEditMode",w),[w,h]=fa(),_=C(),q=C(),I=$a(),ae=[{key:"strength",label:"Strength"},{key:"dexterity",label:"Dexterity"},{key:"constitution",label:"Constitution"},{key:"intelligence",label:"Intelligence"},{key:"wisdom",label:"Wisdom"},{key:"charisma",label:"Charisma"}];function Q(){Ns()}function se(ce){const re=t()[ce],_e=`1d20${re>=0?"+":""}${re}`,Ie=[];Ie.push({value:"1d20",source:"base die"}),re!==0&&Ie.push({value:re,source:ce}),I("roll",{notation:_e,rollType:"check",bonusBreakdown:Ie})}function U(ce){const re=t()[ce],_e=v().saveProficiencies[ce]?v().proficiencyBonus:0,Ie=re+_e,Qe=`1d20${Ie>=0?"+":""}${Ie}`,T=[];T.push({value:"1d20",source:"base die"}),re!==0&&T.push({value:re,source:ce}),_e!==0&&T.push({value:_e,source:"proficiency"}),I("roll",{notation:Qe,rollType:"save",bonusBreakdown:T})}Ze(()=>f(),()=>{n(_,ae.filter(({label:ce})=>f()?ce.toLowerCase().includes(f().toLowerCase()):!0))}),Ze(()=>(e(_),f()),()=>{n(q,e(_).length>0||!f()||f().toLowerCase().includes("proficiency"))}),ga(),Yt();var R=Ul();let F;var le=l(R);Ca(le,{title:"Ability Scores",get collapsed(){return p(),i(()=>p().abilityScores)},ariaLabel:"Toggle Ability Scores Section",onToggle:()=>la.update(ce=>({...ce,abilityScores:!ce.abilityScores}))});var he=a(le,2);{var qe=ce=>{var re=El(),_e=Ae(re),Ie=a(l(_e),2);Se(Ie),s(_e);var Qe=a(_e,2);Lt(Qe,5,()=>e(_),Rt,(T,M)=>{let x=()=>e(M).key,J=()=>e(M).label;var W=Il(),ge=l(W),$e=l(ge,!0);s(ge);var ke=a(ge,2);Se(ke);var be=a(ke,2),pe=l(be);s(be);var we=a(be,2),y=l(we),O=a(y,2);s(we);var Te=a(we,2),ft=l(Te);Se(ft);var ut=a(ft,2);s(Te),s(W),D(yt=>{k($e,yt),k(pe,`${t(),x(),i(()=>t()[x()]>=0?"+":"")??""}${t(),x(),i(()=>t()[x()])??""}`),ft.disabled=!g(),vt(ft,"id",`${x()}-save`),vt(ut,"for",`${x()}-save`)},[()=>(J(),i(()=>J().substring(0,3).toUpperCase()))]),We(ke,()=>v().abilities[x()],yt=>Ot(fe,i(v).abilities[x()]=yt,i(v))),B("change",ke,Q),B("click",y,()=>se(x())),B("click",O,()=>U(x())),Aa(ft,()=>v().saveProficiencies[x()],yt=>Ot(fe,i(v).saveProficiencies[x()]=yt,i(v))),o(T,W)}),s(Qe),We(Ie,()=>v().proficiencyBonus,T=>Ot(fe,i(v).proficiencyBonus=T,i(v))),o(ce,re)};m(he,ce=>{p(),i(()=>!p().abilityScores)&&ce(qe)})}s(R),D(()=>F=Et(R,1,"ability-scores svelte-bbv1xt",null,F,{hidden:!e(q)})),o(r,R),Xt(),h()}const Gs=[{name:"Unarmored",type:"none",baseAC:10},{name:"Padded",type:"light",baseAC:11},{name:"Leather",type:"light",baseAC:11},{name:"Studded Leather",type:"light",baseAC:12},{name:"Hide",type:"medium",baseAC:12,maxDexBonus:2},{name:"Chain Shirt",type:"medium",baseAC:13,maxDexBonus:2},{name:"Scale Mail",type:"medium",baseAC:14,maxDexBonus:2},{name:"Breastplate",type:"medium",baseAC:14,maxDexBonus:2},{name:"Half Plate",type:"medium",baseAC:15,maxDexBonus:2},{name:"Ring Mail",type:"heavy",baseAC:14,maxDexBonus:0},{name:"Chain Mail",type:"heavy",baseAC:16,maxDexBonus:0},{name:"Splint",type:"heavy",baseAC:17,maxDexBonus:0},{name:"Plate",type:"heavy",baseAC:18,maxDexBonus:0}];function qs(r){return Gs.find(c=>c.name===r)}function Hl(r,c,t){if(!r)return 10+c+(t?2:0);const v=qs(r);if(!v)return 10+c+(t?2:0);let f=v.baseAC;return v.maxDexBonus===void 0?f+=c:v.maxDexBonus>0&&(f+=Math.min(c,v.maxDexBonus)),t&&(f+=2),f}function Ha(r){return Math.floor((r-10)/2)}function bs(r,c){if(!r.class)return null;const t=ua(r.class);if(!t||!t.spellcaster||!t.spellcastingAbility)return null;const v=Ha(c[t.spellcastingAbility]);return 8+r.proficiencyBonus+v}function cs(r,c){if(!r.class)return 0;const t=ua(r.class);return!t||!t.spellcaster||!t.spellcastingAbility?0:Ha(c[t.spellcastingAbility])}function Ol(r,c){const t=[],v=Ha(c.dexterity),f=r.armorName?qs(r.armorName):void 0;if(f){if(f.type==="none")t.push("Unarmored"),t.push("Base: 10"),t.push(`Dexterity: ${v>=0?"+":""}${v}`);else if(f.type==="light")t.push(`${f.name}: ${f.baseAC}`),t.push(`Dexterity: ${v>=0?"+":""}${v}`);else if(f.type==="medium"){const p=Math.min(2,v);t.push(`${f.name}: ${f.baseAC}`),t.push(`Dexterity: ${p>=0?"+":""}${p} (max +2)`)}else f.type==="heavy"&&(t.push(`${f.name}: ${f.baseAC}`),t.push("Dexterity: +0 (heavy armor)"));r.shieldEquipped&&t.push("Shield: +2")}else{t.push("Base: 10"),v!==0&&t.push(`Dexterity: ${v>=0?"+":""}${v}`);const p=10+v,g=r.armorClass-p;g!==0&&t.push(`Other: ${g>=0?"+":""}${g}`)}return r.activeStates&&r.activeStates.length>0&&r.activeStates.forEach(p=>{typeof p.acBonus=="number"&&p.acBonus!==0&&(!p.target||p.target==="self")&&t.push(`${p.name}: ${p.acBonus>=0?"+":""}${p.acBonus}`)}),t.join(`
`)}function Gl(r,c){const t=[],v=Ha(c.dexterity);t.push(`Dexterity: ${v>=0?"+":""}${v}`);const f=r.initiative-v;return f!==0&&t.push(`Other Bonuses: ${f>=0?"+":""}${f}`),t.join(`
`)}function ql(r,c){if(!r.class)return"";const t=ua(r.class);if(!t||!t.spellcaster||!t.spellcastingAbility)return"";const v=[],f=Ha(c[t.spellcastingAbility]),p=t.spellcastingAbility.charAt(0).toUpperCase()+t.spellcastingAbility.slice(1);return v.push("Base: 8"),v.push(`Proficiency: +${r.proficiencyBonus}`),v.push(`${p}: ${f>=0?"+":""}${f}`),v.join(`
`)}function Wl(r,c,t){const v=[];let f=r;const p=c.toLowerCase().trim();if(t.activeStates){for(const w of t.activeStates)if(w.immunities&&w.immunities.length>0&&w.immunities.some(_=>_.toLowerCase().trim()===p))return v.push(`Immune to ${c} (${w.name})`),{finalDamage:0,adjustments:v}}let g=!1;if(t.activeStates){for(const w of t.activeStates)if(w.resistances&&w.resistances.length>0&&w.resistances.some(_=>_.toLowerCase().trim()===p)){const _=Math.floor(f/2);v.push(`Resistant to ${c} (${w.name}): ${f} ‚Üí ${_}`),f=_,g=!0;break}}if(!g&&t.race){const w=Ja(t.race);if(w){for(const h of w.traits)if(h.resistances&&h.resistances.some(_=>_.toLowerCase().trim()===p)){const _=Math.floor(f/2);v.push(`Resistant to ${c} (racial trait): ${f} ‚Üí ${_}`),f=_,g=!0;break}}}return v.length===0&&v.push(`No adjustments for ${c}`),{finalDamage:f,adjustments:v}}function zl(r,c){const t={...r};if(t.tempHP>0){if(c<=t.tempHP)return t.tempHP-=c,t;c-=t.tempHP,t.tempHP=0}return t.currentHP=Math.max(0,t.currentHP-c),t}var Kl=u('<button class="info-icon svelte-1o8ci7b" type="button">‚ÑπÔ∏è</button>'),Vl=u('<button class="info-icon svelte-1o8ci7b" type="button">‚ÑπÔ∏è</button>'),Jl=u("<div><!></div>"),Yl=u('<div class="tooltip-wrapper svelte-1o8ci7b"><!> <!></div>');function vs(r,c){Qt(c,!1);let t=Bt(c,"tooltipContent",8),v=Bt(c,"ariaLabel",8,"Show information"),f=C(!1),p=C(),g=C(!1),w=C(null),h=C(!1),_=C(!1),q=C("");const I=Math.random().toString(36).slice(2);function ae(){window.dispatchEvent(new CustomEvent("tooltip-open",{detail:I}))}function Q(T){T.detail!==I&&(n(f,!1),n(h,!1))}function se(){n(g,window.matchMedia("(pointer: coarse)").matches||"ontouchstart"in window)}function U(){if(!e(w)||!e(p))return;const T=e(p).getBoundingClientRect(),M=e(w).getBoundingClientRect();let x=T.bottom+5,J=T.left;n(h,!1),J+M.width>window.innerWidth-8&&(J=T.right-M.width,n(h,!0),J<8&&(J=8)),J<8&&(J=8),x+M.height>window.innerHeight-8&&(x=T.top-M.height-5),n(q,`position:fixed;top:${x}px;left:${J}px;z-index:1000;`),n(_,!0)}function R(){ae(),n(f,!1),n(_,!1),requestAnimationFrame(()=>{n(f,!0),n(_,!1),setTimeout(U,0)})}function F(){n(f,!1),n(h,!1)}function le(T){T.stopPropagation(),e(f)?(n(f,!1),n(h,!1),n(_,!1)):(ae(),n(f,!1),n(_,!1),requestAnimationFrame(()=>{n(f,!0),n(_,!1),setTimeout(U,0)}))}function he(T){e(p)&&!e(p).contains(T.target)&&(n(f,!1),n(h,!1))}Sa(()=>{se(),document.addEventListener("click",he),window.addEventListener("tooltip-open",Q)}),Vs(()=>{document.removeEventListener("click",he),window.removeEventListener("tooltip-open",Q)}),Yt();var qe=Yl(),ce=l(qe);{var re=T=>{var M=Kl();D(()=>vt(M,"aria-label",v())),B("click",M,le),o(T,M)},_e=T=>{var M=Vl();D(()=>vt(M,"aria-label",v())),B("mouseenter",M,R),B("mouseleave",M,F),o(T,M)};m(ce,T=>{e(g)?T(re):T(_e,!1)})}var Ie=a(ce,2);{var Qe=T=>{var M=Jl(),x=l(M);xl(x,c,"content",{},J=>{var W=kt(),ge=Ae(W);ps(ge,t),o(J,W)}),s(M),Ua(M,J=>n(w,J),()=>e(w)),D(()=>{Et(M,1,`tooltip-popup ${e(h)?"right-align":""}`,"svelte-1o8ci7b"),$l(M,e(_)?e(q)+"opacity:1;pointer-events:auto;":"opacity:0;pointer-events:none;position:fixed;top:0;left:0;z-index:1000;")}),o(T,M)};m(Ie,T=>{e(f)&&T(Qe)})}s(qe),Ua(qe,T=>n(p,T),()=>e(p)),o(r,qe),Xt()}var Ql=u("<option> </option>"),Xl=u('<div class="armor-config svelte-1r5hyyb"><h4 class="svelte-1r5hyyb">Armor Configuration</h4> <div class="armor-controls svelte-1r5hyyb"><div class="armor-field svelte-1r5hyyb"><label for="armorName" class="svelte-1r5hyyb">Armor</label> <select id="armorName" class="armor-select svelte-1r5hyyb"><option>None (Unarmored)</option><!></select></div> <div class="armor-field svelte-1r5hyyb"><label class="shield-label svelte-1r5hyyb"><input type="checkbox" class="shield-checkbox svelte-1r5hyyb"/> Shield Equipped (+2 AC)</label></div></div></div>'),Zl=u('<div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="spellSaveDC" class="svelte-1r5hyyb">Spell Save DC</label> <!></div> <input type="number" id="spellSaveDC" class="stat-input svelte-1r5hyyb" readonly=""/></div>'),er=u('<span class="hit-dice-type"> </span>'),tr=u('<!> <div class="stats-grid svelte-1r5hyyb"><div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="armorClass" class="svelte-1r5hyyb">Armor Class</label> <!></div> <input type="text" id="armorClass" readonly=""/></div> <div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="initiative" class="svelte-1r5hyyb">Initiative</label> <!></div> <input type="text" id="initiative" class="stat-input svelte-1r5hyyb" readonly=""/></div> <div class="stat-box svelte-1r5hyyb"><label for="speed" class="svelte-1r5hyyb">Speed</label> <input type="text" id="speed" class="stat-input svelte-1r5hyyb"/></div> <!></div> <div class="hp-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Points</h3> <div><div class="hp-inputs svelte-1r5hyyb"><input type="number" class="hp-current svelte-1r5hyyb" min="0"/> <span class="hp-separator svelte-1r5hyyb">/</span> <input type="number" class="hp-max svelte-1r5hyyb" min="0"/></div> <div class="hp-controls svelte-1r5hyyb"><button class="hp-btn svelte-1r5hyyb">‚àí</button> <button class="hp-btn svelte-1r5hyyb">+</button> <button class="hp-btn svelte-1r5hyyb">‚àí5</button> <button class="hp-btn svelte-1r5hyyb">+5</button></div></div> <div class="temp-hp svelte-1r5hyyb"><label for="tempHP" class="svelte-1r5hyyb">Temp HP</label> <input type="number" id="tempHP" min="0" class="svelte-1r5hyyb"/></div></div> <div class="hit-dice-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Dice</h3> <div class="hit-dice-display svelte-1r5hyyb"><input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <span>/</span> <input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <!></div> <div class="hit-dice-controls svelte-1r5hyyb"><label for="hitDiceCount" class="svelte-1r5hyyb">Roll</label> <div class="hit-dice-count-controls svelte-1r5hyyb"><button class="hit-dice-btn svelte-1r5hyyb">‚àí</button> <input type="number" id="hitDiceCount" class="hit-dice-count-input svelte-1r5hyyb" min="1"/> <button class="hit-dice-btn svelte-1r5hyyb">+</button></div> <button class="btn btn-primary roll-hit-dice use-enabled svelte-1r5hyyb">üé≤ Roll</button></div></div>',1),ar=u("<section><!> <!></section>");function sr(r,c){Qt(c,!1);const t=()=>_t(fe,"$character",w),v=()=>_t(Xa,"$abilityModifiers",w),f=()=>_t(xa,"$searchFilter",w),p=()=>_t(la,"$collapsedStates",w),g=()=>_t(wa,"$isEditMode",w),[w,h]=fa(),_=C(),q=C(),I=C(),ae=C(),Q=C(),se=C(),U=C(),R=$a();let F=C(1);function le(T){fe.update(M=>(M.currentHP=Math.max(0,Math.min(M.maxHP,M.currentHP+T)),M))}function he(T){const M=e(F)+T,x=t().hitDice.current;n(F,Math.max(1,Math.min(x,M)))}function qe(T=1){if(t().hitDice.current<=0){alert("No hit dice remaining!");return}if(!t().class){alert("Please select a class first!");return}const M=ua(t().class);if(!M){alert("Invalid class configuration!");return}const x=Math.min(T,t().hitDice.current),J=M.hitDice,W=v().constitution,ge=W*x,$e=ge>=0?`+${ge}`:`${ge}`,ke=`${x}${J}${$e}`,be=[];if(be.push({value:`${x}${J}`,source:"hit dice"}),W!==0)for(let pe=0;pe<x;pe++)be.push({value:W,source:"constitution"});R("rollHitDice",{notation:ke,hitDie:J,count:x,bonusBreakdown:be})}Ze(()=>(t(),v(),fe),()=>{if(t().armorName!==void 0||t().shieldEquipped!==void 0){const T=v().dexterity,M=Hl(t().armorName,T,t().shieldEquipped||!1);t().armorClass!==M&&fe.update(x=>({...x,armorClass:M}))}}),Ze(()=>(v(),t(),fe),()=>{const T=v().dexterity;t().initiative!==T&&fe.update(M=>({...M,initiative:T}))}),Ze(()=>t(),()=>{n(_,bs(t(),t().abilities))}),Ze(()=>t(),()=>{n(q,Ol(t(),t().abilities))}),Ze(()=>t(),()=>{n(I,Gl(t(),t().abilities))}),Ze(()=>t(),()=>{n(ae,ql(t(),t().abilities))}),Ze(()=>(t(),e(F)),()=>{const T=t().hitDice.current;T>0&&e(F)>T&&n(F,T)}),Ze(()=>t(),()=>{n(Q,t().activeStates&&t().activeStates.length>0?t().activeStates.reduce((T,M)=>T+(M.acBonus||0),0):0)}),Ze(()=>t(),()=>{n(se,t().activeStates&&t().activeStates.length>0?t().activeStates.some(T=>T.name==="Aid"&&T.target==="self"):!1)}),Ze(()=>f(),()=>{n(U,!f()||"armor class".includes(f().toLowerCase())||"initiative".includes(f().toLowerCase())||"speed".includes(f().toLowerCase())||"hit points".includes(f().toLowerCase())||"hp".includes(f().toLowerCase())||"hit dice".includes(f().toLowerCase())||"spell save".includes(f().toLowerCase())||"combat".includes(f().toLowerCase()))}),ga(),Yt();var ce=ar();let re;var _e=l(ce);{let T=xt(()=>(p(),i(()=>p().combatStats?"Expand":"Collapse")));Ca(_e,{title:"Combat Stats",get collapsed(){return p(),i(()=>p().combatStats)},get ariaLabel(){return e(T)},onToggle:()=>la.update(M=>({...M,combatStats:!M.combatStats}))})}var Ie=a(_e,2);{var Qe=T=>{var M=tr(),x=Ae(M);{var J=de=>{var Ve=Xl(),Oe=a(l(Ve),2),et=l(Oe),Ue=a(l(et),2);D(()=>{t(),Kt(()=>{})});var Je=l(Ue);Je.value=(Je.__value=void 0)??"";var mt=a(Je);Lt(mt,1,()=>Gs,Rt,(b,P)=>{var ie=kt(),ne=Ae(ie);{var ve=Re=>{var ze=Ql(),Ne=l(ze);s(ze);var oe={};D(()=>{k(Ne,`${e(P),i(()=>e(P).name)??""} (AC ${e(P),i(()=>e(P).baseAC)??""})`),oe!==(oe=(e(P),i(()=>e(P).name)))&&(ze.value=(ze.__value=(e(P),i(()=>e(P).name)))??"")}),o(Re,ze)};m(ne,Re=>{e(P),i(()=>e(P).name!=="Unarmored")&&Re(ve)})}o(b,ie)}),s(Ue),s(et);var Y=a(et,2),Ye=l(Y),gt=l(Ye);Se(gt),sa(),s(Ye),s(Y),s(Oe),s(Ve),Na(Ue,()=>t().armorName,b=>Ot(fe,i(t).armorName=b,i(t))),Aa(gt,()=>t().shieldEquipped,b=>Ot(fe,i(t).shieldEquipped=b,i(t))),o(de,Ve)};m(x,de=>{g()&&de(J)})}var W=a(x,2),ge=l(W),$e=l(ge),ke=a(l($e),2);vs(ke,{get tooltipContent(){return e(q)},ariaLabel:"Show AC breakdown"}),s($e);var be=a($e,2);Se(be),s(ge);var pe=a(ge,2),we=l(pe),y=a(l(we),2);vs(y,{get tooltipContent(){return e(I)},ariaLabel:"Show Initiative breakdown"}),s(we);var O=a(we,2);Se(O),s(pe);var Te=a(pe,2),ft=a(l(Te),2);Se(ft),s(Te);var ut=a(Te,2);{var yt=de=>{var Ve=Zl(),Oe=l(Ve),et=a(l(Oe),2);vs(et,{get tooltipContent(){return e(ae)},ariaLabel:"Show Spell Save DC breakdown"}),s(Oe);var Ue=a(Oe,2);Se(Ue),s(Ve),D(()=>Ra(Ue,e(_))),o(de,Ve)};m(ut,de=>{e(_)!==null&&de(yt)})}s(W);var Ct=a(W,2),Dt=a(l(Ct),2);let S;var z=l(Dt),A=l(z);Se(A);var H=a(A,4);Se(H),s(z);var K=a(z,2),me=l(K),He=a(me,2),Fe=a(He,2),Ge=a(Fe,2);s(K),s(Dt);var Pe=a(Dt,2),$=a(l(Pe),2);Se($),s(Pe),s(Ct);var X=a(Ct,2),N=a(l(X),2),Be=l(N);Se(Be);var ye=a(Be,4);Se(ye);var nt=a(ye,2);{var je=de=>{const Ve=xt(()=>(E(ua),t(),i(()=>ua(t().class))));var Oe=kt(),et=Ae(Oe);{var Ue=Je=>{const mt=xt(()=>(v(),i(()=>v().constitution)));var Y=er(),Ye=l(Y);s(Y),D(()=>k(Ye,`(${E(e(Ve)),i(()=>e(Ve).hitDice)??""}${(e(mt)>=0?`+${e(mt)}`:e(mt))??""})`)),o(Je,Y)};m(et,Je=>{e(Ve)&&Je(Ue)})}o(de,Oe)};m(nt,de=>{t(),i(()=>t().class)&&de(je)})}s(N);var Z=a(N,2),d=a(l(Z),2),at=l(d),Ce=a(at,2);Se(Ce);var G=a(Ce,2);s(d);var De=a(d,2);s(Z),s(X),D(()=>{Ra(be,(e(Q),t(),i(()=>e(Q)!==0?`${t().armorClass} ‚Üí ${t().armorClass+e(Q)}`:`${t().armorClass}`))),Et(be,1,fl(e(Q)!==0?"stat-input ac-enhanced":"stat-input"),"svelte-1r5hyyb"),Ra(O,(t(),i(()=>t().initiative))),S=Et(Dt,1,"hp-display svelte-1r5hyyb",null,S,{"aid-active":e(se)}),vt(A,"max",(t(),i(()=>t().maxHP))),vt(Be,"max",(t(),i(()=>t().hitDice.max))),at.disabled=e(F)<=1,vt(Ce,"max",(t(),i(()=>t().hitDice.current))),G.disabled=(e(F),t(),i(()=>e(F)>=t().hitDice.current)),De.disabled=(t(),i(()=>t().hitDice.current<=0||!t().class))}),We(ft,()=>t().speed,de=>Ot(fe,i(t).speed=de,i(t))),We(A,()=>t().currentHP,de=>Ot(fe,i(t).currentHP=de,i(t))),We(H,()=>t().maxHP,de=>Ot(fe,i(t).maxHP=de,i(t))),B("click",me,()=>le(-1)),B("click",He,()=>le(1)),B("click",Fe,()=>le(-5)),B("click",Ge,()=>le(5)),We($,()=>t().tempHP,de=>Ot(fe,i(t).tempHP=de,i(t))),We(Be,()=>t().hitDice.current,de=>Ot(fe,i(t).hitDice.current=de,i(t))),We(ye,()=>t().hitDice.max,de=>Ot(fe,i(t).hitDice.max=de,i(t))),B("click",at,()=>he(-1)),We(Ce,()=>e(F),de=>n(F,de)),B("input",Ce,de=>{const Ve=de.target,Oe=parseInt(Ve.value);Oe>t().hitDice.current&&n(F,t().hitDice.current),Oe<1&&n(F,1)}),B("click",G,()=>he(1)),B("click",De,()=>qe(e(F))),o(T,M)};m(Ie,T=>{p(),i(()=>!p().combatStats)&&T(Qe)})}s(ce),D(()=>re=Et(ce,1,"combat-stats svelte-1r5hyyb",null,re,{hidden:!e(U)})),o(r,ce),Xt(),h()}const qa={acrobatics:"dexterity",animalHandling:"wisdom",arcana:"intelligence",athletics:"strength",deception:"charisma",history:"intelligence",insight:"wisdom",intimidation:"charisma",investigation:"intelligence",medicine:"wisdom",nature:"intelligence",perception:"wisdom",performance:"charisma",persuasion:"charisma",religion:"intelligence",sleightOfHand:"dexterity",stealth:"dexterity",survival:"wisdom"};var lr=u('<div class="skill-row svelte-1f1pl16"><input type="checkbox" class="svelte-1f1pl16"/> <label class="svelte-1f1pl16"> <span class="ability-tag svelte-1f1pl16"> </span></label> <span class="skill-modifier svelte-1f1pl16"> </span> <button class="roll-btn svelte-1f1pl16">Roll</button></div>'),rr=u('<div class="skills-grid svelte-1f1pl16"></div>'),ir=u("<section><!> <!></section>");function nr(r,c){Qt(c,!1);const t=()=>_t(fe,"$character",w),v=()=>_t(Xa,"$abilityModifiers",w),f=()=>_t(xa,"$searchFilter",w),p=()=>_t(la,"$collapsedStates",w),g=()=>_t(wa,"$isEditMode",w),[w,h]=fa(),_=C(),q=C(),I=C(),ae=C(),Q=C(),se=C(),U=$a(),R=[{key:"acrobatics",label:"Acrobatics"},{key:"animalHandling",label:"Animal Handling"},{key:"arcana",label:"Arcana"},{key:"athletics",label:"Athletics"},{key:"deception",label:"Deception"},{key:"history",label:"History"},{key:"insight",label:"Insight"},{key:"intimidation",label:"Intimidation"},{key:"investigation",label:"Investigation"},{key:"medicine",label:"Medicine"},{key:"nature",label:"Nature"},{key:"perception",label:"Perception"},{key:"performance",label:"Performance"},{key:"persuasion",label:"Persuasion"},{key:"religion",label:"Religion"},{key:"sleightOfHand",label:"Sleight of Hand"},{key:"stealth",label:"Stealth"},{key:"survival",label:"Survival"}];function F(_e){const Ie=qa[_e],Qe=v()[Ie],T=t().skillProficiencies[_e]?t().proficiencyBonus:0,M=e(_)[_e],x=`1d20${M>=0?"+":""}${M}`,J=[];J.push({value:"1d20",source:"base die"}),Qe!==0&&J.push({value:Qe,source:Ie}),T!==0&&J.push({value:T,source:"proficiency"}),U("roll",{notation:x,rollType:"check",bonusBreakdown:J})}Ze(()=>{},()=>{n(_,{})}),Ze(()=>t(),()=>{n(q,t().skillProficiencies)}),Ze(()=>t(),()=>{n(I,t().proficiencyBonus)}),Ze(()=>v(),()=>{n(ae,v())}),Ze(()=>(e(ae),e(q),e(I)),()=>{for(const{key:_e}of R){const Ie=qa[_e],Qe=e(ae)[Ie],T=e(q)[_e]?e(I):0;_a(_,e(_)[_e]=Qe+T)}}),Ze(()=>f(),()=>{n(Q,R.filter(({label:_e})=>f()?_e.toLowerCase().includes(f().toLowerCase()):!0))}),Ze(()=>e(Q),()=>{n(se,e(Q).length>0)}),ga(),Yt();var le=ir();let he;var qe=l(le);{let _e=xt(()=>(p(),i(()=>p().skills?"Expand":"Collapse")));Ca(qe,{title:"Skills",get collapsed(){return p(),i(()=>p().skills)},get ariaLabel(){return e(_e)},onToggle:()=>la.update(Ie=>({...Ie,skills:!Ie.skills}))})}var ce=a(qe,2);{var re=_e=>{var Ie=rr();Lt(Ie,5,()=>e(Q),Rt,(Qe,T)=>{let M=()=>e(T).key,x=()=>e(T).label;var J=lr(),W=l(J);Se(W);var ge=a(W,2),$e=l(ge),ke=a($e),be=l(ke);s(ke),s(ge);var pe=a(ge,2),we=l(pe);s(pe);var y=a(pe,2);s(J),D(O=>{Hs(W,(e(q),M(),i(()=>e(q)[M()]))),W.disabled=!g(),vt(W,"id",M()),vt(ge,"for",M()),k($e,`${x()??""} `),k(be,`(${O??""})`),k(we,`${e(_),M(),i(()=>e(_)[M()]>=0?"+":"")??""}${e(_),M(),i(()=>e(_)[M()])??""}`)},[()=>(E(qa),M(),i(()=>qa[M()].substring(0,3).toUpperCase()))]),B("change",W,O=>{console.log("Skill proficiency changed:",M(),O.target.checked),fe.update(Te=>({...Te,skillProficiencies:{...Te.skillProficiencies,[M()]:O.target.checked}}))}),B("click",y,()=>F(M())),o(Qe,J)}),s(Ie),o(_e,Ie)};m(ce,_e=>{p(),i(()=>!p().skills)&&_e(re)})}s(le),D(()=>he=Et(le,1,"skills svelte-1f1pl16",null,he,{hidden:!e(se)})),o(r,le),Xt(),h()}var or=u('<p class="empty-message svelte-1123ljy">No attacks or spells to reorder.</p>'),cr=u('<li class="reorder-item svelte-1123ljy"><span class="attack-name svelte-1123ljy"> </span> <div class="reorder-buttons svelte-1123ljy"><button class="btn-move svelte-1123ljy" aria-label="Move up">‚ñ≤</button> <button class="btn-move svelte-1123ljy" aria-label="Move down">‚ñº</button></div></li>'),vr=u('<ul class="reorder-list svelte-1123ljy"></ul>'),dr=u('<div class="modal-backdrop svelte-1123ljy" role="presentation"><div class="modal-content svelte-1123ljy" role="dialog" aria-modal="true" aria-labelledby="modal-title"><div class="modal-header svelte-1123ljy"><h3 id="modal-title" class="svelte-1123ljy">Reorder Attacks & Spells</h3> <button class="btn-close svelte-1123ljy" aria-label="Close">√ó</button></div> <div class="modal-body svelte-1123ljy"><!></div> <div class="modal-footer svelte-1123ljy"><button class="btn btn-secondary svelte-1123ljy">Cancel</button> <button class="btn btn-primary svelte-1123ljy">Save Order</button></div></div></div>');function ur(r,c){Qt(c,!1);let t=Bt(c,"show",8,!1),v=Bt(c,"attacks",24,()=>[]),f=Bt(c,"onSave",8),p=Bt(c,"onCancel",8),g=C([]);function w(R,F){const le=e(g)[R];_a(g,e(g)[R]=e(g)[F]),_a(g,e(g)[F]=le),n(g,[...e(g)])}function h(R){R>0&&w(R,R-1)}function _(R){R<e(g).length-1&&w(R,R+1)}function q(){f()(e(g))}function I(){p()()}function ae(R){R.target===R.currentTarget&&I()}Ze(()=>(E(t()),E(v())),()=>{t()&&n(g,[...v()])}),ga(),Yt();var Q=kt(),se=Ae(Q);{var U=R=>{var F=dr(),le=l(F),he=l(le),qe=a(l(he),2);s(he);var ce=a(he,2),re=l(ce);{var _e=x=>{var J=or();o(x,J)},Ie=x=>{var J=vr();Lt(J,7,()=>e(g),W=>W.id,(W,ge,$e)=>{var ke=cr(),be=l(ke),pe=l(be,!0);s(be);var we=a(be,2),y=l(we),O=a(y,2);s(we),s(ke),D(()=>{k(pe,(e(ge),i(()=>e(ge).name||"(Unnamed attack or spell)"))),y.disabled=e($e)===0,O.disabled=(E(e($e)),e(g),i(()=>e($e)===e(g).length-1))}),B("click",y,()=>h(e($e))),B("click",O,()=>_(e($e))),o(W,ke)}),s(J),o(x,J)};m(re,x=>{e(g),i(()=>e(g).length===0)?x(_e):x(Ie,!1)})}s(ce);var Qe=a(ce,2),T=l(Qe),M=a(T,2);s(Qe),s(le),s(F),B("click",qe,I),B("click",T,I),B("click",M,q),B("click",F,ae),o(R,F)};m(se,R=>{t()&&R(U)})}o(r,Q),Xt()}let Wa=null,za=null;async function Ws(){if(Wa)return Wa;try{return Wa=await(await fetch(Os("/data/spells.json"))).json(),Wa||[]}catch(r){return console.error("Failed to load spells:",r),[]}}async function fr(){if(za)return za;try{return za=await(await fetch(Os("/data/feats.json"))).json(),za||[]}catch(r){return console.error("Failed to load feats:",r),[]}}function Ms(r,c){if(!c.trim())return r;const t=c.toLowerCase();return r.filter(v=>v.name.toLowerCase().includes(t)||v.school.toLowerCase().includes(t)||v.classes.some(f=>f.toLowerCase().includes(t))||v.description.toLowerCase().includes(t))}function pr(r,c){return c===null?r:r.filter(t=>t.level===c)}function mr(r,c){if(!c.trim())return r;const t=c.toLowerCase();return r.filter(v=>v.name.toLowerCase().includes(t)||v.description.toLowerCase().includes(t))}function Ka(r){const c=r.description,t=/\b(Strength|Dexterity|Constitution|Intelligence|Wisdom|Charisma)\s+saving\s+throw/i,v=c.match(t);if(!v)return null;const f=v[1].toLowerCase(),g=/half\s+(?:as\s+much\s+)?damage\s+on\s+a\s+successful(?:\s+save)?|on\s+a\s+successful(?:\s+save)?[^.]*half\s+(?:as\s+much\s+)?damage/i.test(c),h=/saving\s+throw\s+or\s+take.*?damage/i.test(c)&&!g;return{ability:f,halfDamageOnSave:g,noDamageOnSave:h}}function gr(r){const c=r.description;return/(plus|add)\s+your\s+spellcasting\s+(ability\s+)?modifier/i.test(c)}function La(r){const c=r.description.toLowerCase();return c.includes("ranged spell attack")||c.includes("melee spell attack")}function Va(r){const c=r.description.toLowerCase();if(["Divine Favor","Bless","Aid","Command","Crusader's Mantle"].includes(r.name))return!0;const f=["takes","take","deals","deal","damage equal to","force damage","fire damage","cold damage","lightning damage","thunder damage","acid damage","poison damage","necrotic damage","radiant damage","psychic damage","regain","regains","hit point"].some(w=>c.includes(w));return["bonus to attack","bonus to damage","bonus to ac","gains a +","gain a +","+1 bonus","+2 bonus","+3 bonus","advantage on","becomes a magic weapon"].some(w=>c.includes(w))&&!f}function br(r){const c=r.description;let t=0,v=0,f=0,p="";const g=c.match(/\+(\d+)\s+bonus\s+to\s+attack\s+rolls\s+and\s+damage\s+rolls/i);if(g){const h=parseInt(g[1]);t=h,v=h,p=`+${h} to attack and damage rolls`}if(r.name==="Bless"&&(p="Add 1d4 to attack rolls and saves",t="1d4"),r.name==="Aid")return p="+5 HP (max and current) for 8 hours",{attackBonus:0,damageBonus:0,acBonus:0,hpBonus:5,description:p,name:r.name};r.name==="Divine Favor"&&(p="Your weapon attacks deal an extra 1d4 radiant damage on a hit.",v="1d4");const w=c.match(/\+(\d+)\s+bonus\s+to\s+AC/i);return w&&(f=parseInt(w[1]),p=`+${f} to AC`),r.name==="Haste"&&(p="+2 AC, doubled speed, extra action",f=2),r.name==="Crusader's Mantle"&&(p="Your weapon attacks deal an extra 1d4 radiant damage on a hit.",v="1d4"),p||t!==0||v!==0||f!==0?{attackBonus:t,damageBonus:v,acBonus:f,description:p||r.description.substring(0,100),name:r.name}:null}function ds(r){const c=r.description,t=/takes?\s+(\d+d\d+)\s+\w+\s+damage[^.]*\.\s*If\s+the\s+target\s+is\s+missing.*?instead\s+takes?\s+(\d+d\d+)/is,v=c.match(t);return v?{baseDamage:v[1],alternateDamage:v[2]}:null}var hr=u('<button class="btn btn-secondary">Reorder</button>'),_r=u('<div class="edit-buttons svelte-14o91c5"><button class="btn btn-secondary">Add Attack</button> <!></div>'),yr=u('<input type="text" placeholder="Attack name" class="attack-name svelte-14o91c5"/>'),xr=u('<h4 class="attack-name-display svelte-14o91c5"> </h4>'),$r=u('<button class="btn-remove svelte-14o91c5">√ó</button>'),kr=u('<div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Bonus</label> <input type="number" class="attack-bonus svelte-14o91c5"/></div>'),wr=u('<div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Damage</label> <input type="text" placeholder="e.g., 2d6+3" class="attack-damage svelte-14o91c5"/></div>'),Sr=u('<div class="spell-info-loading svelte-14o91c5">Loading spell info...</div>'),Cr=u('<li class="svelte-14o91c5"><strong>At Higher Levels:</strong> </li>'),Dr=u('<li style="color: #007bff;" class="svelte-14o91c5"><strong>Special:</strong> Mage Hand is invisible when cast via Githyanki Psionics.</li>'),Lr=u('<li style="color: #007bff;" class="svelte-14o91c5"><strong>Cast via:</strong> </li>'),Ar=u("<!> <!>",1),jr=u('<ul class="svelte-14o91c5"><li class="svelte-14o91c5"><strong>Level:</strong> </li> <li class="svelte-14o91c5"><strong>Casting Time:</strong> </li> <li class="svelte-14o91c5"><strong>Range:</strong> </li> <li class="svelte-14o91c5"><strong>Components:</strong> <!></li> <li class="svelte-14o91c5"><strong>Duration:</strong> <!> </li> <li class="svelte-14o91c5"><strong>Description:</strong> </li> <!> <!></ul>'),Br=u('<span class="scaled-damage svelte-14o91c5" style="margin-left: 8px;"> </span>'),Rr=u('<span class="scaled-damage svelte-14o91c5">(Half damage)</span>'),Mr=u('<span class="scaled-damage svelte-14o91c5">(No damage)</span>'),Tr=u('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> <!> <!></label></div>'),Fr=u('<span class="scaled-damage svelte-14o91c5"> </span>'),Pr=u('<span class="scaled-damage svelte-14o91c5"> </span>'),Ir=u('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> Target is missing HP <!></label></div>'),Er=u("<option> </option>"),Ur=u('<span class="scaled-damage svelte-14o91c5"><!> </span>'),Nr=u('<span class="scaled-damage svelte-14o91c5"> </span>'),Hr=u('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> Target is Fiend or Undead <!></label></div>'),Or=u('<div class="spell-level-selector svelte-14o91c5"><label class="svelte-14o91c5">Cast at Level:</label> <select class="spell-level-select use-enabled svelte-14o91c5"></select> <!></div> <!>',1),Gr=u('<div class="spell-info svelte-14o91c5"><div class="spell-info-header svelte-14o91c5" role="button" tabindex="0"><h4 class="svelte-14o91c5">Spell Info</h4> <button class="collapse-btn-small svelte-14o91c5"> </button></div> <!></div> <!> <!> <!>',1),qr=u('<div class="spell-info-missing svelte-14o91c5">Spell info not found.</div>'),Wr=u('<div class="attack-notes svelte-14o91c5"><label class="svelte-14o91c5">Notes</label> <textarea placeholder="e.g., DC 15 Dex save, Range 120 ft, Concentration" class="notes-input svelte-14o91c5" rows="2"></textarea></div>'),zr=u('<div style="margin-bottom: 0.5em;"><label style="font-size:0.95em;"><input type="checkbox" class="svelte-14o91c5"/> Use Racial Trait <span style="color:#007bff; font-size:0.95em; margin-left:0.5em;"> </span></label></div>'),Kr=u('<button class="btn btn-primary">Roll Attack (Spell Slot)</button>'),Vr=u('<button class="btn btn-primary" disabled>No spell slots available</button>'),Jr=u('<button class="btn btn-primary">Roll Attack (Racial Trait)</button>'),Yr=u('<button class="btn btn-primary" disabled>No racial uses left</button>'),Qr=u('<div class="buff-target-selection svelte-14o91c5"><div class="target-options svelte-14o91c5"><label class="target-option svelte-14o91c5"><input type="radio" class="svelte-14o91c5"/> Self</label> <label class="target-option svelte-14o91c5"><input type="radio" class="svelte-14o91c5"/> Other</label></div> <button class="btn btn-info"> </button></div>'),Xr=u('<button class="btn btn-info">Cast Spell</button>'),Zr=u("<button><!></button>"),ei=u('<button class="btn btn-info">Cast Spell</button>'),ti=u("<!> <!> <!> <!>",1),ai=u('<button class="btn btn-secondary">Roll Damage</button>'),si=u('<button class="btn btn-primary">Roll Attack</button> <!>',1),li=u('<div class="attack-card svelte-14o91c5"><div class="attack-header svelte-14o91c5"><!> <!></div> <div class="attack-details svelte-14o91c5"><!> <!> <div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Type</label> <input type="text" placeholder="e.g., slashing" class="attack-type svelte-14o91c5"/></div></div> <!> <!> <div class="attack-actions svelte-14o91c5"><!> <!></div></div>'),ri=u('<p class="no-attacks svelte-14o91c5">No attacks added yet. Click "Add Attack" to create one.</p>'),ii=u('<p class="no-attacks svelte-14o91c5">No attacks match your search.</p>'),ni=u('<span class="ability-uses svelte-14o91c5"> <!></span>'),oi=u('<span class="ability-reaction svelte-14o91c5">‚ö° Reaction</span>'),ci=u('<button class="btn btn-ability svelte-14o91c5">Use Ability</button>'),vi=u('<div class="ability-card svelte-14o91c5"><div class="ability-header svelte-14o91c5"><h4 class="ability-name svelte-14o91c5"> </h4> <span class="ability-source svelte-14o91c5"> </span></div> <p class="ability-description svelte-14o91c5"> </p> <div class="ability-footer svelte-14o91c5"><!> <!> <!></div></div>'),di=u('<div class="condition-abilities-section svelte-14o91c5"><h3 class="abilities-header svelte-14o91c5">Condition Abilities</h3> <p class="section-description svelte-14o91c5">Special actions granted by active conditions (e.g., Flicker of Deceit)</p> <div class="abilities-list svelte-14o91c5"></div></div>'),ui=u('<button class="btn-remove svelte-14o91c5">√ó</button>'),fi=u('<div class="state-card svelte-14o91c5"><div class="state-header svelte-14o91c5"><input type="text" placeholder="Effect name (e.g., Magic Weapon)" class="state-name svelte-14o91c5"/> <!></div> <div class="state-details svelte-14o91c5"><div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Attack Bonus</label> <input type="text" class="state-bonus svelte-14o91c5" placeholder="0 or 1d4"/></div> <div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Damage Bonus</label> <input type="text" class="state-bonus svelte-14o91c5"/></div> <div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Target</label> <select class="state-bonus svelte-14o91c5"><option>Self</option><option>Other</option></select></div></div> <div class="state-description svelte-14o91c5"><label class="svelte-14o91c5">Description</label> <input type="text" placeholder="e.g., +1 to attack and damage rolls (Magic Weapon)" class="state-desc-input svelte-14o91c5"/></div></div>'),pi=u('<div class="states-list svelte-14o91c5"></div>'),mi=u('<p class="no-states svelte-14o91c5">No active effects. Add spell effects that modify your attacks.</p>'),gi=u('<!> <div class="attacks-list svelte-14o91c5"><!> <!> <!></div> <!> <div class="active-states-section svelte-14o91c5"><h3 class="svelte-14o91c5">Active Spell Effects</h3> <p class="section-description svelte-14o91c5">Effects that modify attack and damage rolls (e.g., Magic Weapon, Bless)</p> <button class="btn btn-secondary">Add Effect</button> <!></div>',1),bi=u("<section><!> <!></section> <!>",1);function hi(r,c){Qt(c,!1);const t=()=>_t(fe,"$character",g),v=()=>_t(xa,"$searchFilter",g),f=()=>_t(la,"$collapsedStates",g),p=()=>_t(wa,"$isEditMode",g),[g,w]=fa(),h=C(),_=C(),q=C(),I=[];let ae=C({});function Q(S,z){fe.update(A=>{if(!A.activeStates)return A;const H=A.activeStates.findIndex(Fe=>Fe.name===S);if(H===-1)return A;const K=A.activeStates[H];if(!K.abilities)return A;const me=K.abilities.findIndex(Fe=>Fe.name===z);if(me===-1)return A;const He=K.abilities[me];return He.currentUses!==void 0&&He.currentUses>0&&(He.currentUses-=1,He.usesPerRest!==void 0?Ht.add(`Used ${z} (${He.currentUses}/${He.usesPerRest} remaining)`,"info"):Ht.add(`Used ${z}`,"info")),A})}const se=$a();let U=C({}),R=C({}),F=C(!1);function le(S){_a(U,e(U)[S]=!e(U)[S]),n(U,{...e(U)})}function he(S){return S.description.toLowerCase().includes("regain")&&(S.description.toLowerCase().includes("hit point")||S.description.toLowerCase().includes("hp"))}function qe(S){return["Shield of Faith","Bless","Aid","Magic Weapon"].includes(S)}function ce(){fe.update(S=>(S.attacks=[...S.attacks,{id:crypto.randomUUID(),name:"",bonus:0,damage:"",damageType:"",notes:""}],S))}function re(S){fe.update(z=>(z.attacks=z.attacks.filter(A=>A.id!==S),z))}function _e(){n(F,!0)}function Ie(){n(F,!1)}function Qe(S){fe.update(z=>(z.attacks=S,z)),n(F,!1),Ht.add("Attack order updated successfully!","success")}function T(S,z){let A=S.damage,H=!1,K=!1;const me=[];if(S.spellRef){const $=W(S.spellRef);if($&&(K=La($),$.level>0)){const X=S.castAtLevel||$.level;let N=!1;if(z||S.source==="racial"){if(N=$e(S.name),!N){Ht.add(`No uses of ${S.name} remaining!`,"error");return}}else if(N=ge(X),!N){Ht.add(`No level ${X} spell slots available!`,"error");return}const ye=Ka($);ye&&S.targetSucceededSave&&ye.noDamageOnSave?A="0":(H=ye?.halfDamageOnSave&&S.targetSucceededSave||!1,A=ke(S,$))}}else if(A){const $=A.match(/(\d+d\d+)([+-]?\d+)?/);if($){const[,X,N]=$,Be=N?parseInt(N):0;if(Be!==0&&me.push({value:Be,source:"base"}),t().activeStates&&t().activeStates.length>0){let ye=0,nt=[];for(const je of t().activeStates)je.target!=="other"&&(typeof je.damageBonus=="string"?(nt.push(je.damageBonus),me.push({value:je.damageBonus,source:je.name})):typeof je.damageBonus=="number"&&je.damageBonus!==0&&(ye+=je.damageBonus,me.push({value:je.damageBonus,source:je.name})));if(ye!==0||nt.length>0){const je=Be+ye;let Z=`${X}`;je!==0&&(Z+=`${je>=0?"+":""}${je}`),nt.length>0&&(Z+=" + "+nt.join(" + ")),A=Z}}}}const He=[];let Fe=0;if(K){const $=cs(t(),t().abilities),X=t().proficiencyBonus||0;He.push({value:X,source:"proficiency"}),He.push({value:$,source:"spellcasting"}),Fe=X+$}else S.bonus!==0&&He.push({value:S.bonus,source:"base"}),Fe=S.bonus;let Ge=[];if(t().activeStates)for(const $ of t().activeStates)$.target!=="other"&&(typeof $.attackBonus=="number"&&$.attackBonus!==0?(He.push({value:$.attackBonus,source:$.name}),Fe+=$.attackBonus):typeof $.attackBonus=="string"&&$.attackBonus&&(Ge.push($.attackBonus),He.push({value:$.attackBonus,source:$.name})));let Pe=`1d20${Fe>=0?"+":""}${Fe}`;Ge.length>0&&(Pe+="+"+Ge.join("+")),se("roll",{notation:Pe,damageNotation:A,attackName:S.name,applyHalfDamage:H,bonusBreakdown:He,damageBreakdown:me,rollType:"attack"})}function M(S){if(!S.damage){Ht.add(`${S.name}: No damage specified`,"error");return}let z=S.damage,A=!1;const H=[];let K=S.damageType||"";if(S.spellRef){const me=W(S.spellRef);if(me){const He=he(me);if(He){const Fe=cs(t(),t().abilities),Ge=z.match(/^(\d+d\d+)/);Ge&&(z=Ge[1],Fe>0&&(z+=`+${Fe}`,H.push({value:Fe,source:"spellcasting"}))),K="Healing"}if(me.level>0){const Fe=S.castAtLevel||me.level;let Ge=!1;if(S.source==="racial"){if(Ge=$e(S.name),!Ge){Ht.add(`No uses of ${S.name} remaining!`,"error");return}}else if(Ge=ge(Fe),!Ge){Ht.add(`No level ${Fe} spell slots available!`,"error");return}const Pe=Ka(me);Pe&&S.targetSucceededSave&&Pe.noDamageOnSave?z="0":(A=Pe?.halfDamageOnSave&&S.targetSucceededSave||!1,He||(z=ke(S,me)))}}}else{const me=z.match(/(\d+d\d+)([+-]\d+)?/);if(me){const[,He,Fe]=me,Ge=Fe?parseInt(Fe):0;if(Ge!==0&&H.push({value:Ge,source:"base"}),t().activeStates&&t().activeStates.length>0){let Pe=0,$=[];for(const X of t().activeStates)X.target!=="other"&&(typeof X.damageBonus=="string"?($.push(X.damageBonus),H.push({value:X.damageBonus,source:X.name})):typeof X.damageBonus=="number"&&X.damageBonus!==0&&(H.push({value:X.damageBonus,source:X.name}),Pe+=X.damageBonus));if(Pe!==0||$.length>0){const X=Ge+Pe;let N=`${He}`;X!==0&&(N+=`${X>=0?"+":""}${X}`),$.length>0&&(N+=" + "+$.join(" + ")),z=N}}}}se("roll",{notation:z,attackName:S.name,applyHalfDamage:A,bonusBreakdown:H,damageType:K})}let x=C([]),J=C(!1);Sa(async()=>{n(x,await Ws()),n(J,!0)});function W(S){return e(x).find(z=>z.name===S)}function ge(S){t().classFeatures.spellSlotsByLevel||Ot(fe,i(t).classFeatures.spellSlotsByLevel={},i(t)),t().classFeatures.spellSlotsByLevel[S]||Ot(fe,i(t).classFeatures.spellSlotsByLevel[S]=Array(2).fill(!1),i(t));const A=t().classFeatures.spellSlotsByLevel[S].findIndex(H=>!H);return A===-1?!1:(fe.update(H=>(H.classFeatures.spellSlotsByLevel||(H.classFeatures.spellSlotsByLevel={}),H.classFeatures.spellSlotsByLevel[S]||(H.classFeatures.spellSlotsByLevel[S]=Array(2).fill(!1)),H.classFeatures.spellSlotsByLevel[S][A]=!0,H)),!0)}function $e(S){return!t().racialTraits||!t().racialTraits.uses[S]?!0:t().racialTraits.uses[S].currentUses<=0?!1:(pl(S),!0)}function ke(S,z){let A=S.damage,H=0,K=0;const me=ds(z);if(me&&S.targetIsDamaged&&(A=me.alternateDamage),gr(z)&&(K+=cs(t(),t().abilities)),t().activeStates)for(const ye of t().activeStates)ye.target!=="other"&&typeof ye.damageBonus=="number"&&(K+=ye.damageBonus);if(z.higherLevelSlot&&S.castAtLevel){const ye=z.level,je=(S.castAtLevel||ye)-ye;if(je>0){const Z=z.higherLevelSlot.match(/(\d+)d(\d+)\s+for\s+each.*?level\s+above/i);if(Z){const[,d]=Z;H+=je*parseInt(d)}}}if(S.targetIsFiendOrUndead&&z.description.includes("Fiend or an Undead")){const ye=z.description.match(/increases by (\d+)d(\d+) if.*?Fiend or.*?Undead/i);if(ye){const[,nt]=ye;H+=parseInt(nt)}}const He=A.match(/(\d+)d(\d+)([+-]\d+)?/);if(!He)return K!==0?K>=0?`${K}`:`${K}`:A||"0";const[,Fe,Ge,Pe]=He,$=parseInt(Fe)+H,N=(Pe?parseInt(Pe):0)+K;let Be=`${$}d${Ge}`;return N!==0&&(Be+=N>=0?`+${N}`:`${N}`),Be}function be(S){const z=[];for(let H=S.level;H<=9;H++){const K=t().classFeatures.spellSlotsByLevel?.[H];K&&K.length>0&&z.push(H)}return z}function pe(){fe.update(S=>(S.activeStates||(S.activeStates=[]),S.activeStates=[...S.activeStates,{name:"",attackBonus:0,damageBonus:0,description:"",target:"self"}],S))}function we(S){fe.update(z=>{if(z.activeStates){const A=z.activeStates[S];A?.hpBonus&&A.target!=="other"&&(z.maxHP-=A.hpBonus,z.currentHP=Math.max(1,Math.min(z.currentHP-A.hpBonus,z.maxHP))),z.activeStates=z.activeStates.filter((H,K)=>K!==S)}return z})}function y(S,z="self"){const A=W(S.spellRef);if(!A){Ht.add("Spell not found","error");return}const H=S.castAtLevel||A.level;if(H>0){let $=!1;if(S.source==="racial"){if($=$e(S.name),!$){Ht.add(`No uses of ${S.name} remaining!`,"error");return}}else if($=ge(H),!$){Ht.add(`No level ${H} spell slots available!`,"error");return}}const K=br(A);if(!K){Ht.add(`${A.name} cast! Check spell description for effects.`,"info");return}let me=K.hpBonus||0,He=K.description;A.name==="Aid"&&H>A.level&&(me=5+(H-A.level)*5,He=`+${me} HP (max and current) for 8 hours`);const Ge=["Shield of Faith","Bless","Aid","Magic Weapon"].includes(A.name);fe.update($=>{$.activeStates||($.activeStates=[]);const X=$.activeStates.find(N=>N.name===A.name);return X&&X.hpBonus&&X.target!=="other"&&($.maxHP-=X.hpBonus,$.currentHP=Math.max(1,Math.min($.currentHP-X.hpBonus,$.maxHP))),$.activeStates=$.activeStates.filter(N=>N.name!==A.name),me>0&&z==="self"&&($.maxHP+=me,$.currentHP+=me),$.activeStates=[...$.activeStates,{name:A.name,attackBonus:K.attackBonus,damageBonus:K.damageBonus,acBonus:K.acBonus,description:He,target:z,hpBonus:me}],$});const Pe=z==="self"?" on self":" on other";Ht.add(`${A.name} cast${Ge?Pe:""}! Effect added to Active Spell Effects.`,"success")}Ze(()=>t(),()=>{n(h,t().activeStates?t().activeStates.filter(S=>S.abilities&&S.abilities.length>0).flatMap(S=>S.abilities.map(z=>({...z,conditionName:S.name}))):[])}),Ze(()=>(t(),e(U),e(R)),()=>{if(t()&&t().attacks)for(const S of t().attacks)S.spellRef&&e(U)[S.id]===void 0&&_a(U,e(U)[S.id]=!0),S.spellRef&&e(R)[S.id]===void 0&&_a(R,e(R)[S.id]="self")}),Ze(()=>(t(),v()),()=>{n(_,t().attacks.filter(S=>{if(!v())return!0;const z=v().toLowerCase();return S.name.toLowerCase().includes(z)||S.damageType.toLowerCase().includes(z)}).sort((S,z)=>!S.spellRef&&z.spellRef?-1:S.spellRef&&!z.spellRef?1:0))}),Ze(()=>(v(),e(_)),()=>{n(q,!v()||e(_).length>0||"attack".includes(v().toLowerCase())||"spell".includes(v().toLowerCase()))}),ga(),Yt();var O=bi(),Te=Ae(O);let ft;var ut=l(Te);{let S=xt(()=>(f(),i(()=>f().attacks?"Expand":"Collapse")));Ca(ut,{title:"Attacks & Spells",get collapsed(){return f(),i(()=>f().attacks)},get ariaLabel(){return e(S)},onToggle:()=>la.update(z=>({...z,attacks:!z.attacks}))})}var yt=a(ut,2);{var Ct=S=>{var z=gi(),A=Ae(z);{var H=Z=>{var d=_r(),at=l(d),Ce=a(at,2);{var G=De=>{var de=hr();B("click",de,_e),o(De,de)};m(Ce,De=>{t(),i(()=>t().attacks.length>0)&&De(G)})}s(d),B("click",at,ce),o(Z,d)};m(A,Z=>{p()&&Z(H)})}var K=a(A,2),me=l(K);Lt(me,1,()=>e(_),Z=>Z.id,(Z,d,at)=>{var Ce=li(),G=l(Ce),De=l(G);{var de=xe=>{var ee=yr();Se(ee),We(ee,()=>e(d).name,ue=>(e(d).name=ue,Kt(()=>(e(_),t(),v())))),o(xe,ee)},Ve=xe=>{var ee=xr(),ue=l(ee,!0);s(ee),D(()=>k(ue,(e(d),i(()=>e(d).name||"(Unnamed Attack)")))),o(xe,ee)};m(De,xe=>{p()?xe(de):xe(Ve,!1)})}var Oe=a(De,2);{var et=xe=>{var ee=$r();B("click",ee,()=>re(e(d).id)),o(xe,ee)};m(Oe,xe=>{p()&&xe(et)})}s(G);var Ue=a(G,2),Je=l(Ue);{var mt=xe=>{var ee=kr(),ue=l(ee),Xe=a(ue,2);Se(Xe),s(ee),D(()=>{vt(ue,"for",`attack-bonus-${e(d),i(()=>e(d).id)??""}`),vt(Xe,"id",`attack-bonus-${e(d),i(()=>e(d).id)??""}`)}),We(Xe,()=>e(d).bonus,wt=>(e(d).bonus=wt,Kt(()=>(e(_),t(),v())))),o(xe,ee)};m(Je,xe=>{e(d),i(()=>e(d).bonus!==0&&e(d).bonus!==void 0)&&xe(mt)})}var Y=a(Je,2);{var Ye=xe=>{var ee=wr(),ue=l(ee),Xe=a(ue,2);Se(Xe),s(ee),D(()=>{vt(ue,"for",`attack-damage-${e(d),i(()=>e(d).id)??""}`),vt(Xe,"id",`attack-damage-${e(d),i(()=>e(d).id)??""}`)}),We(Xe,()=>e(d).damage,wt=>(e(d).damage=wt,Kt(()=>(e(_),t(),v())))),o(xe,ee)};m(Y,xe=>{e(d),i(()=>e(d).damage&&e(d).damage.trim()!=="")&&xe(Ye)})}var gt=a(Y,2),b=l(gt),P=a(b,2);Se(P),s(gt),s(Ue);var ie=a(Ue,2);{var ne=xe=>{var ee=kt(),ue=Ae(ee);{var Xe=it=>{var te=Sr();o(it,te)},wt=it=>{const te=xt(()=>(e(d),i(()=>W(e(d).spellRef))));var Gt=kt(),Me=Ae(Gt);{var $t=aa=>{const j=xt(()=>(E(Ka),E(e(te)),i(()=>Ka(e(te))))),Le=xt(()=>(E(ds),E(e(te)),i(()=>ds(e(te)))));var Ee=Gr(),bt=Ae(Ee),L=l(bt),dt=a(l(L),2),st=l(dt,!0);s(dt),s(L);var ht=a(L,2);{var tt=rt=>{var Pt=jr(),qt=l(Pt),Zt=a(l(qt));s(qt);var va=a(qt,2),pa=a(l(va));s(va);var da=a(va,2),Vt=a(l(da));s(da);var ea=a(da,2),Jt=a(l(ea)),It=a(Jt);{var na=jt=>{var ia=Tt();D(()=>k(ia,`(${E(e(te)),i(()=>e(te).material)??""})`)),o(jt,ia)};m(It,jt=>{E(e(te)),i(()=>e(te).material)&&jt(na)})}s(ea);var ma=a(ea,2),ha=a(l(ma),2);{var Wt=jt=>{var ia=Tt("Concentration,");o(jt,ia)};m(ha,jt=>{E(e(te)),i(()=>e(te).concentration)&&jt(Wt)})}var ra=a(ha,1,!0);s(ma);var ct=a(ma,2),St=a(l(ct));s(ct);var At=a(ct,2);{var zt=jt=>{var ia=Cr(),Da=a(l(ia));s(ia),D(()=>k(Da,` ${E(e(te)),i(()=>e(te).higherLevelSlot)??""}`)),o(jt,ia)};m(At,jt=>{E(e(te)),i(()=>e(te).higherLevelSlot)&&jt(zt)})}var Nt=a(At,2);{var oa=jt=>{var ia=Ar(),Da=Ae(ia);{var es=ca=>{var ba=Dr();o(ca,ba)};m(Da,ca=>{e(d),E(e(te)),i(()=>e(d).racialTraitName==="Githyanki Psionics"&&e(te).name==="Mage Hand")&&ca(es)})}var ts=a(Da,2);{var as=ca=>{var ba=Lr(),Ba=a(l(ba));s(ba),D(()=>k(Ba,` ${e(d),i(()=>e(d).racialTraitName)??""}`)),o(ca,ba)};m(ts,ca=>{e(d),i(()=>e(d).racialTraitName)&&ca(as)})}o(jt,ia)};m(Nt,jt=>{e(d),i(()=>e(d).source==="racial")&&jt(oa)})}s(Pt),D(jt=>{k(Zt,` ${E(e(te)),i(()=>e(te).level)??""}`),k(pa,` ${E(e(te)),i(()=>e(te).castingTime||e(te).actionType)??""}`),k(Vt,` ${E(e(te)),i(()=>e(te).range)??""}`),k(Jt,` ${jt??""}`),k(ra,(E(e(te)),i(()=>e(te).duration))),k(St,` ${E(e(te)),i(()=>e(te).description)??""}`)},[()=>(E(e(te)),i(()=>e(te).components.join(", ")))]),o(rt,Pt)};m(ht,rt=>{e(U),e(d),i(()=>!e(U)[e(d).id])&&rt(tt)})}s(bt);var lt=a(bt,2);{var Ke=rt=>{var Pt=Tr(),qt=l(Pt),Zt=l(qt);Se(Zt);var va=a(Zt),pa=a(va);{var da=It=>{var na=Br(),ma=l(na);s(na),D(ha=>k(ma,`(Spell Save DC: ${ha??""})`),[()=>(E(bs),t(),i(()=>bs(t(),t().abilities)))]),o(It,na)};m(pa,It=>{t(),i(()=>t().class)&&It(da)})}var Vt=a(pa,2);{var ea=It=>{var na=Rr();o(It,na)},Jt=It=>{var na=kt(),ma=Ae(na);{var ha=Wt=>{var ra=Mr();o(Wt,ra)};m(ma,Wt=>{e(d),E(e(j)),i(()=>e(d).targetSucceededSave&&e(j).noDamageOnSave)&&Wt(ha)},!0)}o(It,na)};m(Vt,It=>{e(d),E(e(j)),i(()=>e(d).targetSucceededSave&&e(j).halfDamageOnSave)?It(ea):It(Jt,!1)})}s(qt),s(Pt),D(It=>k(va,` Target succeeded on ${It??""} save `),[()=>(E(e(j)),i(()=>e(j).ability.charAt(0).toUpperCase()+e(j).ability.slice(1)))]),Aa(Zt,()=>e(d).targetSucceededSave,It=>(e(d).targetSucceededSave=It,Kt(()=>(e(_),t(),v())))),o(rt,Pt)};m(lt,rt=>{e(j)&&rt(Ke)})}var Ft=a(lt,2);{var Ut=rt=>{var Pt=Ir(),qt=l(Pt),Zt=l(qt);Se(Zt);var va=a(Zt,2);{var pa=Vt=>{const ea=xt(()=>(e(d),E(e(te)),i(()=>ke(e(d),e(te)))));var Jt=Fr(),It=l(Jt);s(Jt),D(()=>k(It,`(${E(e(Le)),i(()=>e(Le).alternateDamage)??""}, total: ${e(ea)??""})`)),o(Vt,Jt)},da=Vt=>{var ea=Pr(),Jt=l(ea);s(ea),D(()=>k(Jt,`(${E(e(Le)),i(()=>e(Le).baseDamage)??""})`)),o(Vt,ea)};m(va,Vt=>{e(d),i(()=>e(d).targetIsDamaged)?Vt(pa):Vt(da,!1)})}s(qt),s(Pt),Aa(Zt,()=>e(d).targetIsDamaged,Vt=>(e(d).targetIsDamaged=Vt,Kt(()=>(e(_),t(),v())))),o(rt,Pt)};m(Ft,rt=>{e(Le)&&rt(Ut)})}var Mt=a(Ft,2);{var pt=rt=>{const Pt=xt(()=>(E(e(te)),i(()=>be(e(te)))));var qt=kt(),Zt=Ae(qt);{var va=pa=>{var da=Or(),Vt=Ae(da),ea=l(Vt),Jt=a(ea,2);D(()=>{e(d),Kt(()=>{e(Pt)})}),Lt(Jt,5,()=>e(Pt),Rt,(Wt,ra)=>{var ct=Er(),St=l(ct);s(ct);var At={};D(()=>{k(St,`Level ${e(ra)??""}`),At!==(At=e(ra))&&(ct.value=(ct.__value=e(ra))??"")}),o(Wt,ct)}),s(Jt);var It=a(Jt,2);{var na=Wt=>{const ra=xt(()=>(e(d),E(e(te)),i(()=>ke(e(d),e(te)))));var ct=Ur(),St=l(ct);{var At=oa=>{var jt=Tt("Healing");o(oa,jt)},zt=oa=>{var jt=Tt("Damage");o(oa,jt)};m(St,oa=>{E(e(te)),i(()=>he(e(te)))?oa(At):oa(zt,!1)})}var Nt=a(St);s(ct),D(()=>k(Nt,` ${e(ra)??""}`)),o(Wt,ct)};m(It,Wt=>{e(d),E(e(te)),i(()=>e(d).castAtLevel&&e(d).castAtLevel>e(te).level)&&Wt(na)})}s(Vt);var ma=a(Vt,2);{var ha=Wt=>{var ra=Hr(),ct=l(ra),St=l(ct);Se(St);var At=a(St,2);{var zt=Nt=>{const oa=xt(()=>(e(d),E(e(te)),i(()=>ke(e(d),e(te)))));var jt=Nr(),ia=l(jt);s(jt),D(()=>k(ia,`(+1d8, total: ${e(oa)??""})`)),o(Nt,jt)};m(At,Nt=>{e(d),i(()=>e(d).targetIsFiendOrUndead)&&Nt(zt)})}s(ct),s(ra),Aa(St,()=>e(d).targetIsFiendOrUndead,Nt=>(e(d).targetIsFiendOrUndead=Nt,Kt(()=>(e(_),t(),v())))),o(Wt,ra)};m(ma,Wt=>{E(e(te)),i(()=>e(te).description.includes("Fiend or an Undead"))&&Wt(ha)})}D(()=>{vt(ea,"for",`castLevel-${e(d),i(()=>e(d).id)??""}`),vt(Jt,"id",`castLevel-${e(d),i(()=>e(d).id)??""}`)}),Na(Jt,()=>e(d).castAtLevel,Wt=>(e(d).castAtLevel=Wt,Kt(()=>(e(_),t(),v())))),o(pa,da)};m(Zt,pa=>{E(e(Pt)),e(ae),e(d),i(()=>e(Pt).length>0&&!e(ae)[e(d).id])&&pa(va)})}o(rt,qt)};m(Mt,rt=>{E(e(te)),i(()=>e(te).higherLevelSlot&&e(te).level>0)&&rt(pt)})}D(()=>{vt(dt,"aria-label",(e(U),e(d),i(()=>e(U)[e(d).id]?"Expand":"Collapse"))),k(st,(e(U),e(d),i(()=>e(U)[e(d).id]?"‚ñº":"‚ñ≤")))}),B("click",L,()=>le(e(d).id)),B("keydown",L,rt=>rt.key==="Enter"&&le(e(d).id)),o(aa,Ee)},ta=aa=>{var j=qr();o(aa,j)};m(Me,aa=>{e(te)?aa($t):aa(ta,!1)})}o(it,Gt)};m(ue,it=>{e(x),i(()=>e(x).length===0)?it(Xe):it(wt,!1)})}o(xe,ee)};m(ie,xe=>{e(d),i(()=>e(d).spellRef)&&xe(ne)})}var ve=a(ie,2);{var Re=xe=>{var ee=kt(),ue=Ae(ee);{var Xe=wt=>{var it=Wr(),te=l(it),Gt=a(te,2);ja(Gt),s(it),D(()=>{vt(te,"for",`attack-notes-${e(d),i(()=>e(d).id)??""}`),vt(Gt,"id",`attack-notes-${e(d),i(()=>e(d).id)??""}`)}),We(Gt,()=>e(d).notes,Me=>(e(d).notes=Me,Kt(()=>(e(_),t(),v())))),o(wt,it)};m(ue,wt=>{e(d),i(()=>e(d).notes&&e(d).notes.trim()!=="")&&wt(Xe)})}o(xe,ee)};m(ve,xe=>{e(d),i(()=>!e(d).spellRef)&&xe(Re)})}var ze=a(ve,2),Ne=l(ze);{var oe=xe=>{const ee=xt(()=>(e(d),i(()=>W(e(d).spellRef))));var ue=kt(),Xe=Ae(ue);{var wt=it=>{const te=xt(()=>(t(),e(d),i(()=>t().racialTraits&&t().racialTraits.uses[e(d).name])));var Gt=ti(),Me=Ae(Gt);{var $t=L=>{var dt=zr(),st=l(dt),ht=l(st);Se(ht);var tt=a(ht,2),lt=l(tt);s(tt),s(st),s(dt),D(()=>k(lt,`(${E(e(te)),i(()=>e(te).currentUses)??""}/${E(e(te)),i(()=>e(te).maxUses)??""} uses left)`)),Aa(ht,()=>e(ae)[e(d).id],Ke=>_a(ae,e(ae)[e(d).id]=Ke)),B("change",ht,()=>{n(ae,{...e(ae)})}),o(L,dt)};m(Me,L=>{e(d),E(e(te)),i(()=>e(d).source==="racial"&&e(te))&&L($t)})}var ta=a(Me,2);{var aa=L=>{var dt=kt(),st=Ae(dt);{var ht=lt=>{var Ke=kt(),Ft=Ae(Ke);{var Ut=pt=>{var rt=Kr();B("click",rt,()=>T(e(d),!1)),o(pt,rt)},Mt=pt=>{var rt=Vr();o(pt,rt)};m(Ft,pt=>{t(),E(e(ee)),i(()=>t().classFeatures&&t().classFeatures.spellSlotsByLevel&&t().classFeatures.spellSlotsByLevel[e(ee).level]?.some(rt=>!rt))?pt(Ut):pt(Mt,!1)})}o(lt,Ke)},tt=lt=>{var Ke=kt(),Ft=Ae(Ke);{var Ut=pt=>{var rt=Jr();B("click",rt,()=>T(e(d),!0)),o(pt,rt)},Mt=pt=>{var rt=Yr();o(pt,rt)};m(Ft,pt=>{E(e(te)),i(()=>e(te)&&e(te).currentUses>0)?pt(Ut):pt(Mt,!1)})}o(lt,Ke)};m(st,lt=>{e(ae),e(d),i(()=>!e(ae)[e(d).id])?lt(ht):lt(tt,!1)})}o(L,dt)};m(ta,L=>{E(La),E(e(ee)),i(()=>La(e(ee)))&&L(aa)})}var j=a(ta,2);{var Le=L=>{var dt=kt(),st=Ae(dt);{var ht=lt=>{var Ke=Qr(),Ft=l(Ke),Ut=l(Ft),Mt=l(Ut);Se(Mt),Mt.value=Mt.__value="self",sa(),s(Ut);var pt=a(Ut,2),rt=l(pt);Se(rt),rt.value=rt.__value="other",sa(),s(pt),s(Ft);var Pt=a(Ft,2),qt=l(Pt);s(Pt),s(Ke),D(()=>{vt(Mt,"name",`target-${e(d),i(()=>e(d).id)??""}`),vt(rt,"name",`target-${e(d),i(()=>e(d).id)??""}`),k(qt,`Cast ${E(e(ee)),i(()=>e(ee).name)??""}`)}),Ls(I,[at],Mt,()=>e(R)[e(d).id],Zt=>_a(R,e(R)[e(d).id]=Zt)),Ls(I,[at],rt,()=>e(R)[e(d).id],Zt=>_a(R,e(R)[e(d).id]=Zt)),B("click",Pt,()=>y(e(d),e(R)[e(d).id])),o(lt,Ke)},tt=lt=>{var Ke=Xr();B("click",Ke,()=>y(e(d),"self")),o(lt,Ke)};m(st,lt=>{E(e(ee)),i(()=>qe(e(ee).name))?lt(ht):lt(tt,!1)})}o(L,dt)};m(j,L=>{E(La),E(e(ee)),E(Va),i(()=>!La(e(ee))&&Va(e(ee)))&&L(Le)})}var Ee=a(j,2);{var bt=L=>{var dt=kt(),st=Ae(dt);{var ht=lt=>{var Ke=Zr(),Ft=l(Ke);{var Ut=pt=>{var rt=Tt("Roll Healing");o(pt,rt)},Mt=pt=>{var rt=Tt("Roll Damage");o(pt,rt)};m(Ft,pt=>{E(e(ee)),i(()=>he(e(ee)))?pt(Ut):pt(Mt,!1)})}s(Ke),D(pt=>Et(Ke,1,`btn ${pt??""}`),[()=>(E(e(ee)),i(()=>he(e(ee))?"btn-success":"btn-secondary"))]),B("click",Ke,()=>M(e(d))),o(lt,Ke)},tt=lt=>{var Ke=ei();B("click",Ke,()=>y(e(d),"self")),o(lt,Ke)};m(st,lt=>{e(d),i(()=>e(d).damage&&e(d).damage.trim()!=="")?lt(ht):lt(tt,!1)})}o(L,dt)};m(Ee,L=>{E(La),E(e(ee)),E(Va),i(()=>!La(e(ee))&&!Va(e(ee)))&&L(bt)})}o(it,Gt)};m(Xe,it=>{e(ee)&&it(wt)})}o(xe,ue)};m(Ne,xe=>{e(d),e(J),i(()=>e(d).spellRef&&e(J))&&xe(oe)})}var V=a(Ne,2);{var ot=xe=>{var ee=si(),ue=Ae(ee),Xe=a(ue,2);{var wt=it=>{var te=ai();B("click",te,()=>M(e(d))),o(it,te)};m(Xe,it=>{e(d),i(()=>e(d).damage&&e(d).damage.trim()!=="")&&it(wt)})}B("click",ue,()=>T(e(d))),o(xe,ee)};m(V,xe=>{e(d),i(()=>!e(d).spellRef)&&xe(ot)})}s(ze),s(Ce),D(()=>{vt(b,"for",`attack-type-${e(d),i(()=>e(d).id)??""}`),vt(P,"id",`attack-type-${e(d),i(()=>e(d).id)??""}`)}),We(P,()=>e(d).damageType,xe=>(e(d).damageType=xe,Kt(()=>(e(_),t(),v())))),o(Z,Ce)});var He=a(me,2);{var Fe=Z=>{var d=ri();o(Z,d)};m(He,Z=>{t(),i(()=>t().attacks.length===0)&&Z(Fe)})}var Ge=a(He,2);{var Pe=Z=>{var d=ii();o(Z,d)};m(Ge,Z=>{e(_),t(),i(()=>e(_).length===0&&t().attacks.length>0)&&Z(Pe)})}s(K);var $=a(K,2);{var X=Z=>{var d=di(),at=a(l(d),4);Lt(at,5,()=>e(h),Rt,(Ce,G)=>{var De=vi(),de=l(De),Ve=l(de),Oe=l(Ve,!0);s(Ve);var et=a(Ve,2),Ue=l(et);s(et),s(de);var Je=a(de,2),mt=l(Je,!0);s(Je);var Y=a(Je,2),Ye=l(Y);{var gt=ve=>{var Re=ni(),ze=l(Re),Ne=a(ze);{var oe=V=>{var ot=Tt();D(()=>k(ot,`per ${e(G),i(()=>e(G).restType)??""} rest`)),o(V,ot)};m(Ne,V=>{e(G),i(()=>e(G).restType)&&V(oe)})}s(Re),D(()=>k(ze,`${e(G),i(()=>e(G).currentUses??e(G).usesPerRest)??""}/${e(G),i(()=>e(G).usesPerRest)??""} uses `)),o(ve,Re)};m(Ye,ve=>{e(G),i(()=>e(G).usesPerRest)&&ve(gt)})}var b=a(Ye,2);{var P=ve=>{var Re=oi();o(ve,Re)};m(b,ve=>{e(G),i(()=>e(G).requiresReaction)&&ve(P)})}var ie=a(b,2);{var ne=ve=>{var Re=ci();D(()=>Re.disabled=(e(G),i(()=>e(G).currentUses===void 0||e(G).currentUses===0))),B("click",Re,()=>Q(e(G).conditionName,e(G).name)),o(ve,Re)};m(ie,ve=>{p(),e(G),i(()=>!p()&&e(G).usesPerRest)&&ve(ne)})}s(Y),s(De),D(()=>{k(Oe,(e(G),i(()=>e(G).name))),k(Ue,`(${e(G),i(()=>e(G).conditionName)??""})`),k(mt,(e(G),i(()=>e(G).description)))}),o(Ce,De)}),s(at),s(d),o(Z,d)};m($,Z=>{e(h),i(()=>e(h).length>0)&&Z(X)})}var N=a($,2),Be=a(l(N),4),ye=a(Be,2);{var nt=Z=>{var d=pi();Lt(d,5,()=>(t(),i(()=>t().activeStates)),Rt,(at,Ce,G)=>{var De=fi(),de=l(De),Ve=l(de);Se(Ve);var Oe=a(Ve,2);{var et=V=>{var ot=ui();B("click",ot,()=>we(G)),o(V,ot)};m(Oe,V=>{p()&&V(et)})}s(de);var Ue=a(de,2),Je=l(Ue),mt=l(Je);vt(mt,"for",`state-attack-bonus-${G}`);var Y=a(mt,2);Se(Y),vt(Y,"id",`state-attack-bonus-${G}`),s(Je);var Ye=a(Je,2),gt=l(Ye);vt(gt,"for",`state-damage-bonus-${G}`);var b=a(gt,2);Se(b),vt(b,"id",`state-damage-bonus-${G}`),s(Ye);var P=a(Ye,2),ie=l(P);vt(ie,"for",`state-target-${G}`);var ne=a(ie,2);D(()=>{e(Ce),Kt(()=>{})}),vt(ne,"id",`state-target-${G}`);var ve=l(ne);ve.value=ve.__value="self";var Re=a(ve);Re.value=Re.__value="other",s(ne),s(P),s(Ue);var ze=a(Ue,2),Ne=l(ze);vt(Ne,"for",`state-desc-${G}`);var oe=a(Ne,2);Se(oe),vt(oe,"id",`state-desc-${G}`),s(ze),s(De),We(Ve,()=>e(Ce).name,V=>(e(Ce).name=V,Kt(()=>t()),Pa(g,"$character"))),We(Y,()=>e(Ce).attackBonus,V=>(e(Ce).attackBonus=V,Kt(()=>t()),Pa(g,"$character"))),We(b,()=>e(Ce).damageBonus,V=>(e(Ce).damageBonus=V,Kt(()=>t()),Pa(g,"$character"))),Na(ne,()=>e(Ce).target,V=>(e(Ce).target=V,Kt(()=>t()),Pa(g,"$character"))),We(oe,()=>e(Ce).description,V=>(e(Ce).description=V,Kt(()=>t()),Pa(g,"$character"))),o(at,De)}),s(d),o(Z,d)},je=Z=>{var d=mi();o(Z,d)};m(ye,Z=>{t(),i(()=>t().activeStates&&t().activeStates.length>0)?Z(nt):Z(je,!1)})}s(N),B("click",Be,pe),o(S,z)};m(yt,S=>{f(),i(()=>!f().attacks)&&S(Ct)})}s(Te);var Dt=a(Te,2);ur(Dt,{get show(){return e(F)},get attacks(){return t(),i(()=>t().attacks)},onSave:Qe,onCancel:Ie}),D(()=>ft=Et(Te,1,"attacks svelte-14o91c5",null,ft,{hidden:!e(q)})),o(r,O),Xt(),w()}var _i=u('<span class="slot-checkbox-x svelte-serp1j">&#8212;</span>'),yi=u('<label><input type="checkbox" class="slot-checkbox-input svelte-serp1j"/> <span><!></span></label>');function Ts(r,c){Qt(c,!1);const t=()=>_t(wa,"$isEditMode",v),[v,f]=fa();let p=Bt(c,"checked",8,!1),g=Bt(c,"disabled",8,!1),w=Bt(c,"className",8,""),h=Bt(c,"index",8,void 0),_=Bt(c,"ariaLabel",8,void 0);const q=$a();function I(F){q("change",{checked:F.currentTarget.checked,index:h()})}Yt();var ae=yi(),Q=l(ae);Se(Q);var se=a(Q,2),U=l(se);{var R=F=>{var le=_i();o(F,le)};m(U,F=>{p()&&F(R)})}s(se),s(ae),D(()=>{Et(ae,1,"slot-checkbox-label "+w()+(t()?"":" not-editable"),"svelte-serp1j"),Hs(Q,p()),Q.disabled=g()||!t(),vt(Q,"aria-label",_()),vt(Q,"tabindex",t()?0:-1),Et(se,1,`slot-checkbox-custom ${p()?"used":""} ${t()?"":"readonly"}`,"svelte-serp1j")}),B("change",Q,I),o(r,ae),Xt(),f()}var xi=u('<span style="color:#007bff; margin-left:0.5em;"> </span>'),$i=u("<li><strong> </strong> <!></li>"),ki=u('<div class="racial-traits"><h4>Racial Traits</h4> <ul></ul></div>'),wi=u("<li> </li>"),Si=u('<div class="racial-resistances"><h4>Racial Resistances</h4> <ul></ul></div>'),Ci=u("<!> <!>",1);function Di(r,c){Qt(c,!1);const t=()=>_t(fe,"$character",v),[v,f]=fa(),p=C(),g=C();let w=C(),h=C();Sa(()=>{t().race&&t().level&&(ws(),rs(),n(w,t().race),n(h,t().level))}),Ze(()=>(t(),e(w),e(h),rs),()=>{t().race&&t().level&&(t().race!==e(w)||t().level!==e(h))&&(ws(),rs(),n(w,t().race),n(h,t().level))}),Ze(()=>(t(),Ja),()=>{n(p,(()=>{const se=t().activeStates?t().activeStates.filter(F=>F.name&&F.name.toLowerCase().includes("racial")).flatMap(F=>F.resistances||[]):[],U=Ja(t().race||""),R=U?U.traits.flatMap(F=>F.resistances||[]):[];return Array.from(new Set([...se,...R]))})())}),Ze(()=>t(),()=>{n(g,(()=>{const se=Ja(t().race||"");return se?se.traits:[]})())}),ga(),Yt();var _=Ci(),q=Ae(_);{var I=se=>{var U=ki(),R=a(l(U),2);Lt(R,5,()=>e(g),Rt,(F,le)=>{var he=$i(),qe=l(he),ce=l(qe);s(qe);var re=a(qe),_e=a(re);{var Ie=Qe=>{var T=xi(),M=l(T);s(T),D(x=>k(M,`(Resistances: ${x??""})`),[()=>(e(le),i(()=>e(le).resistances.map(x=>x.charAt(0).toUpperCase()+x.slice(1)).join(", ")))]),o(Qe,T)};m(_e,Qe=>{e(le),i(()=>e(le).resistances&&e(le).resistances.length>0)&&Qe(Ie)})}s(he),D(()=>{k(ce,`${e(le),i(()=>e(le).name)??""}:`),k(re,` ${e(le),i(()=>e(le).description)??""} `)}),o(F,he)}),s(R),s(U),o(se,U)};m(q,se=>{e(g),i(()=>e(g).length>0)&&se(I)})}var ae=a(q,2);{var Q=se=>{var U=Si(),R=a(l(U),2);Lt(R,5,()=>e(p),Rt,(F,le)=>{var he=wi(),qe=l(he,!0);s(he),D(ce=>k(qe,ce),[()=>(e(le),i(()=>e(le).charAt(0).toUpperCase()+e(le).slice(1)))]),o(F,he)}),s(R),s(U),o(se,U)};m(ae,se=>{e(p),i(()=>e(p).length>0)&&se(Q)})}o(r,_),Xt(),f()}var Li=u('<p class="no-features svelte-1kpvv0n">Select a class to see available features</p>'),Ai=u('<p class="no-features svelte-1kpvv0n">No class features available at this level</p>'),ji=u('<h5 class="svelte-1kpvv0n"> </h5>'),Bi=u('<p class="no-uses svelte-1kpvv0n">No Channel Divinity uses remaining</p>'),Ri=u('<div class="channel-divinity-option svelte-1kpvv0n"><button class="btn btn-primary use-enabled svelte-1kpvv0n"><!></button> <!></div>'),Mi=u('<div class="sub-feature-box svelte-1kpvv0n"><h4 class="svelte-1kpvv0n"> </h4> <!> <p class="feature-description svelte-1kpvv0n"><!></p> <!></div>'),Ti=u('<div class="sub-features-grid svelte-1kpvv0n"></div>'),Fi=u('<div class="feature-box channel-divinity-main svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"> </h3> <p class="feature-description svelte-1kpvv0n"><!></p> <div class="pool-tracker svelte-1kpvv0n"><input type="number" min="0" class="pool-input svelte-1kpvv0n"/> <span> </span> <button class="btn-small svelte-1kpvv0n"> </button></div> <!></div>'),Pi=u('<div class="spell-slots svelte-1kpvv0n"><label class="svelte-1kpvv0n"> </label> <div class="slots-tracker svelte-1kpvv0n"></div></div>'),Ii=u('<div class="all-spell-slots"></div>'),Ei=u('<div class="feature-box spellcasting svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"> </h3> <div class="spell-stats svelte-1kpvv0n"><div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Spell Save DC</label> <div class="spell-value svelte-1kpvv0n"> </div></div> <div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <div class="spell-value svelte-1kpvv0n"> </div></div></div> <!> <div class="prepared-spells svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <textarea placeholder="List your prepared spells..." class="svelte-1kpvv0n"></textarea></div></div>'),Ui=u('<p class="unlimited svelte-1kpvv0n">Unlimited Uses</p>'),Ni=u('<div class="slots-tracker svelte-1kpvv0n"></div> <div class="uses-actions-row"><button class="btn btn-primary use-enabled"> </button></div> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div>',1),Hi=u('<div class="uses-tracker svelte-1kpvv0n"><!></div>'),Oi=u('<div class="pool-tracker svelte-1kpvv0n"><input type="number" min="0" class="pool-input svelte-1kpvv0n"/> <span> </span> <button class="btn-small svelte-1kpvv0n"> </button></div>'),Gi=u('<div class="feature-box svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"><!> </h3> <p class="feature-description svelte-1kpvv0n"> </p> <!></div>'),qi=u('<!> <div class="features-grid svelte-1kpvv0n"><!> <!></div>',1),Wi=u("<!> <!>",1),zi=u("<section><!> <!></section>");function Ki(r,c){Qt(c,!1);const t=()=>_t(fe,"$character",g),v=()=>_t(Xa,"$abilityModifiers",g),f=()=>_t(xa,"$searchFilter",g),p=()=>_t(la,"$collapsedStates",g),[g,w]=fa(),h=C(),_=C(),q=C(),I=C(),ae=C(),Q=C(),se=C(),U=C(),R=C(),F=C(),le=$a();let he=C(0),qe=C(0);function ce(y,O){fe.update(Te=>(Te.classFeatures.features[y]=O,Te))}function re(){fe.update(y=>(y.classFeatures.spellSlotsByLevel||(y.classFeatures.spellSlotsByLevel={}),e(I).forEach(({level:O,slots:Te})=>{y.classFeatures.spellSlotsByLevel[O]||(y.classFeatures.spellSlotsByLevel[O]=Array(Te).fill(!1))}),y))}function _e(y){if(typeof y.maxUses=="function"){if((y.name==="Divine Sense"||y.name==="War Priest")&&e(h)?.spellcastingAbility){const O=v()[e(h).spellcastingAbility];return y.maxUses(t().level,O)}return y.maxUses(t().level)}return y.maxUses||0}function Ie(y,O){fe.update(Te=>((!Te.classFeatures.features[y]||!Array.isArray(Te.classFeatures.features[y])||Te.classFeatures.features[y].length!==O)&&(Te.classFeatures.features[y]=Array(O).fill(!1)),Te))}Js(()=>{e(Q)&&t()&&t().classFeatures&&t().classFeatures.features&&e(Q).forEach(y=>{if(y.type==="uses"){const Te=M(y).replace(/\s+/g,""),ft=_e(y),ut=t().classFeatures.features[Te];(!Array.isArray(ut)||ut.length!==ft)&&Ie(Te,ft)}})});function Qe(y){return typeof y.maxPool=="function"?y.maxPool(t().level):y.maxPool||0}function T(y){if(typeof y.description=="function"){if(e(h)?.spellcastingAbility){const O=v()[e(h).spellcastingAbility];return y.description(t().level,O)}return y.description(t().level)}return y.description}function M(y){if(typeof y.name=="function"){if(e(h)?.spellcastingAbility){const O=v()[e(h).spellcastingAbility];return y.name(t().level,O)}return y.name(t().level)}return y.name}function x(y){if(typeof y.subName=="function"){if(e(h)?.spellcastingAbility){const O=v()[e(h).spellcastingAbility];return y.subName(t().level,O)}return y.subName(t().level)}return y.subName||null}function J(y){if(typeof y.rollFormula=="function"){if(e(h)?.spellcastingAbility){const O=v()[e(h).spellcastingAbility];return y.rollFormula(t().level,O)}return y.rollFormula(t().level)}return y.rollFormula||""}function W(y){const O="ChannelDivinity",Te=t().classFeatures.features[O];if(typeof Te=="number"&&Te>0){fe.update(ut=>(ut.classFeatures.features[O]=Te-1,ut));const ft=M(y);if(y.rollable&&y.rollFormula){const ut=J(y);ut?le("roll",{notation:ut,attackName:ft,rollType:"other"}):Ht.add(`Used ${ft}`,"info")}else Ht.add(`Used ${ft}`,"info")}}function ge(){la.update(y=>({...y,classFeatures:!y.classFeatures}))}Ze(()=>(t(),ua),()=>{n(h,t().class?ua(t().class):null)}),Ze(()=>(t(),Ta),()=>{n(_,t().class?Ta(t().class,t().level,t().subclass):[])}),Ze(()=>(t(),Bs),()=>{n(q,t().class?Bs(t().class,t().level):0)}),Ze(()=>(e(h),t()),()=>{n(I,(()=>{if(!e(h)?.spellcaster)return[];const y=t().level,O=[];return y>=1&&O.push({level:1,slots:Math.min(4,2+Math.floor(y/3))}),y>=3&&O.push({level:2,slots:Math.min(3,2+Math.floor((y-3)/4))}),y>=5&&O.push({level:3,slots:Math.min(3,2+Math.floor((y-5)/5))}),y>=7&&O.push({level:4,slots:Math.min(3,1+Math.floor((y-7)/6))}),y>=9&&O.push({level:5,slots:Math.min(2,1+Math.floor((y-9)/8))}),y>=11&&O.push({level:6,slots:1}),y>=13&&O.push({level:7,slots:1}),y>=15&&O.push({level:8,slots:1}),y>=17&&O.push({level:9,slots:1}),O})())}),Ze(()=>(e(h),v(),t(),Rs),()=>{if(e(h)?.spellcaster&&e(h).spellcastingAbility){const y=v()[e(h).spellcastingAbility];n(he,Ll(t().class,y,t().proficiencyBonus)||0),n(qe,Rs(t().class,t().level,y))}}),Ze(()=>(t(),e(h),e(I)),()=>{t().class&&e(h)?.spellcaster&&e(I).length>0&&re()}),Ze(()=>t(),()=>{n(ae,(()=>{const O=t().classFeatures.features["ChannelDivinity"];return typeof O=="number"?O:0})())}),Ze(()=>(e(_),f()),()=>{n(Q,e(_).filter(y=>{if(!f())return!0;const O=f().toLowerCase();return M(y).toLowerCase().includes(O)||T(y).toLowerCase().includes(O)}))}),Ze(()=>e(Q),()=>{n(se,e(Q).find(y=>y.type==="pool"&&M(y)==="Channel Divinity"))}),Ze(()=>e(Q),()=>{n(U,e(Q).flatMap(y=>{const O=[];return y.subFeatures&&O.push(...y.subFeatures),y.type==="channelDivinity"&&O.push(y),O}))}),Ze(()=>e(Q),()=>{n(R,e(Q).filter(y=>{const O=M(y);return!(y.type==="pool"&&O==="Channel Divinity"||y.type==="channelDivinity"||O==="Channel Divinity"&&y.subFeatures)}))}),Ze(()=>(f(),t(),e(Q)),()=>{n(F,!f()||t().class||"class features".includes(f().toLowerCase())||"spellcasting".includes(f().toLowerCase())||e(Q).length>0)}),ga(),Yt();var $e=zi();let ke;var be=l($e);{let y=xt(()=>(p(),i(()=>p().classFeatures?"Expand":"Collapse")));Ca(be,{title:"Class Features",get collapsed(){return p(),i(()=>p().classFeatures)},get ariaLabel(){return e(y)},onToggle:ge})}var pe=a(be,2);{var we=y=>{var O=Wi(),Te=Ae(O);Di(Te,{});var ft=a(Te,2);{var ut=Ct=>{var Dt=Li();o(Ct,Dt)},yt=Ct=>{var Dt=kt(),S=Ae(Dt);{var z=H=>{var K=Ai();o(H,K)},A=H=>{var K=qi(),me=Ae(K);{var He=X=>{const N=xt(()=>(e(se),i(()=>M(e(se))))),Be=xt(()=>(E(e(N)),i(()=>e(N).replace(/\s+/g,"")))),ye=xt(()=>(t(),E(e(Be)),i(()=>t().classFeatures.features[e(Be)]))),nt=xt(()=>typeof e(ye)=="number"),je=xt(()=>(e(se),i(()=>Qe(e(se)))));var Z=Fi(),d=l(Z),at=l(d,!0);s(d);var Ce=a(d,2),G=l(Ce);ps(G,()=>(e(se),i(()=>T(e(se))))),s(Ce);var De=a(Ce,2),de=l(De);Se(de);var Ve=a(de,2),Oe=l(Ve);s(Ve);var et=a(Ve,2),Ue=l(et,!0);s(et),s(De);var Je=a(De,2);{var mt=Y=>{var Ye=Ti();Lt(Ye,5,()=>e(U),Rt,(gt,b)=>{const P=xt(()=>(e(b),i(()=>M(e(b)))));var ie=Mi(),ne=l(ie),ve=l(ne,!0);s(ne);var Re=a(ne,2);{var ze=xe=>{var ee=ji(),ue=l(ee,!0);s(ee),D(Xe=>k(ue,Xe),[()=>(e(b),i(()=>x(e(b))))]),o(xe,ee)};m(Re,xe=>{e(b),i(()=>e(b).subName)&&xe(ze)})}var Ne=a(Re,2),oe=l(Ne);ps(oe,()=>(e(b),i(()=>T(e(b))))),s(Ne);var V=a(Ne,2);{var ot=xe=>{var ee=Ri(),ue=l(ee),Xe=l(ue);{var wt=Me=>{var $t=Tt();D(()=>k($t,`Roll ${e(P)??""}`)),o(Me,$t)},it=Me=>{var $t=Tt();D(()=>k($t,`Use ${e(P)??""}`)),o(Me,$t)};m(Xe,Me=>{e(b),i(()=>e(b).rollable&&J(e(b)))?Me(wt):Me(it,!1)})}s(ue);var te=a(ue,2);{var Gt=Me=>{var $t=Bi();o(Me,$t)};m(te,Me=>{e(ae)<=0&&Me(Gt)})}s(ee),D(()=>ue.disabled=e(ae)<=0),B("click",ue,()=>W(e(b))),o(xe,ee)};m(V,xe=>{e(b),i(()=>e(b).type==="channelDivinity")&&xe(ot)})}s(ie),D(()=>k(ve,e(P))),o(gt,ie)}),s(Ye),o(Y,Ye)};m(Je,Y=>{e(U),i(()=>e(U).length>0)&&Y(mt)})}s(Z),D(()=>{k(at,e(N)),Ra(de,e(nt)&&e(ye)!==void 0?e(ye):e(je)),vt(de,"max",e(je)),k(Oe,`/ ${e(je)??""}`),k(Ue,(e(se),i(()=>e(se).resetOn==="short"?"Short Rest":"Long Rest")))}),B("input",de,Y=>{fe.update(Ye=>(Ye.classFeatures.features[e(Be)]=parseInt(Y.currentTarget.value)||0,Ye))}),B("click",et,()=>ce(e(Be),e(je))),o(X,Z)};m(me,X=>{e(se)&&X(He)})}var Fe=a(me,2),Ge=l(Fe);{var Pe=X=>{var N=Ei(),Be=l(N),ye=l(Be);s(Be);var nt=a(Be,2),je=l(nt),Z=a(l(je),2),d=l(Z,!0);s(Z),s(je);var at=a(je,2),Ce=a(l(at),2),G=l(Ce,!0);s(Ce),s(at),s(nt);var De=a(nt,2);{var de=et=>{var Ue=Ii();Lt(Ue,5,()=>e(I),Rt,(Je,mt)=>{let Y=()=>e(mt).level,Ye=()=>e(mt).slots;const gt=xt(()=>(t(),Y(),Ye(),i(()=>t().classFeatures.spellSlotsByLevel?.[Y()]||Array(Ye()).fill(!1))));var b=Pi(),P=l(b),ie=l(P);s(P);var ne=a(P,2);Lt(ne,5,()=>e(gt),Rt,(ve,Re,ze)=>{{let Ne=xt(()=>(E(e(gt)),i(()=>e(gt)[ze]||!1)));Ts(ve,{get checked(){return e(Ne)},$$events:{change:oe=>{fe.update(V=>(V.classFeatures.spellSlotsByLevel||(V.classFeatures.spellSlotsByLevel={}),V.classFeatures.spellSlotsByLevel[Y()]||(V.classFeatures.spellSlotsByLevel[Y()]=Array(Ye()).fill(!1)),V.classFeatures.spellSlotsByLevel[Y()][ze]=oe.detail.checked,V))}}})}}),s(ne),s(b),D(()=>k(ie,`${Y()===1?"1st":Y()===2?"2nd":Y()===3?"3rd":`${Y()}th`} Level Spell Slots`)),o(Je,b)}),s(Ue),o(et,Ue)};m(De,et=>{e(I),i(()=>e(I).length>0)&&et(de)})}var Ve=a(De,2),Oe=a(l(Ve),2);ja(Oe),s(Ve),s(N),D(et=>{k(ye,`Spellcasting (${et??""})`),k(d,e(he)),k(G,e(qe))},[()=>(e(h),i(()=>e(h).spellcastingAbility?.toUpperCase()))]),We(Oe,()=>t().classFeatures.preparedSpells,et=>Ot(fe,i(t).classFeatures.preparedSpells=et,i(t))),o(X,N)};m(Ge,X=>{e(h),i(()=>e(h)?.spellcaster)&&X(Pe)})}var $=a(Ge,2);Lt($,1,()=>e(R),Rt,(X,N)=>{const Be=xt(()=>(e(N),i(()=>M(e(N))))),ye=xt(()=>(E(e(Be)),i(()=>e(Be).replace(/\s+/g,"")))),nt=xt(()=>(t(),E(e(ye)),i(()=>t().classFeatures.features[e(ye)]))),je=xt(()=>typeof e(nt)=="number");var Z=Gi(),d=l(Z),at=l(d);{var Ce=Ue=>{var Je=Tt("Channel Divinity:");o(Ue,Je)};m(at,Ue=>{e(N),i(()=>e(N).type==="channelDivinity")&&Ue(Ce)})}var G=a(at);s(d);var De=a(d,2),de=l(De,!0);s(De);var Ve=a(De,2);{var Oe=Ue=>{const Je=xt(()=>(e(N),i(()=>_e(e(N))))),mt=xt(()=>(E(e(nt)),E(e(Je)),i(()=>Array.isArray(e(nt))?e(nt):Array(e(Je)).fill(!1))));var Y=Hi(),Ye=l(Y);{var gt=P=>{var ie=Ui();o(P,ie)},b=P=>{var ie=Ni(),ne=Ae(ie);Lt(ne,5,()=>e(mt),Rt,(ot,xe,ee)=>{Ts(ot,{get checked(){return e(xe)},index:ee,$$events:{change:ue=>{fe.update(Xe=>(Xe.classFeatures.features[e(ye)]||(Xe.classFeatures.features[e(ye)]=Array(e(Je)).fill(!1)),Xe.classFeatures.features[e(ye)][ee]=ue.detail.checked,Xe))}}})}),s(ne);var ve=a(ne,2),Re=l(ve),ze=l(Re);s(Re),s(ve);var Ne=a(ve,2),oe=l(Ne),V=l(oe);s(oe),s(Ne),D(ot=>{Re.disabled=ot,k(ze,`Use ${e(Be)??""}`),k(V,`Resets on ${e(N),i(()=>e(N).resetOn==="short"?"Short Rest":"Long Rest")??""}`)},[()=>(E(e(mt)),i(()=>e(mt).filter(ot=>!ot).length<=0))]),B("click",Re,()=>{fe.update(ot=>{ot.classFeatures.features[e(ye)]||(ot.classFeatures.features[e(ye)]=Array(e(Je)).fill(!1));const xe=ot.classFeatures.features[e(ye)],ee=xe.findIndex(ue=>!ue);return ee!==-1&&(xe[ee]=!0),ot})}),o(P,ie)};m(Ye,P=>{e(Je)===1/0?P(gt):P(b,!1)})}s(Y),o(Ue,Y)},et=Ue=>{var Je=kt(),mt=Ae(Je);{var Y=Ye=>{const gt=xt(()=>(e(N),i(()=>Qe(e(N)))));var b=Oi(),P=l(b);Se(P);var ie=a(P,2),ne=l(ie);s(ie);var ve=a(ie,2),Re=l(ve,!0);s(ve),s(b),D(()=>{Ra(P,e(je)&&e(nt)!==void 0?e(nt):e(gt)),vt(P,"max",e(gt)),k(ne,`/ ${e(gt)??""}`),k(Re,(e(N),i(()=>e(N).resetOn==="short"?"Short Rest":"Long Rest")))}),B("input",P,ze=>{fe.update(Ne=>(Ne.classFeatures.features[e(ye)]=parseInt(ze.currentTarget.value)||0,Ne))}),B("click",ve,()=>ce(e(ye),e(gt))),o(Ye,b)};m(mt,Ye=>{e(N),i(()=>e(N).type==="pool")&&Ye(Y)},!0)}o(Ue,Je)};m(Ve,Ue=>{e(N),i(()=>e(N).type==="uses")?Ue(Oe):Ue(et,!1)})}s(Z),D(Ue=>{k(G,` ${e(Be)??""}`),k(de,Ue)},[()=>(e(N),i(()=>T(e(N))))]),o(X,Z)}),s(Fe),o(H,K)};m(S,H=>{e(_),i(()=>e(_).length===0)?H(z):H(A,!1)},!0)}o(Ct,Dt)};m(ft,Ct=>{t(),i(()=>!t().class)?Ct(ut):Ct(yt,!1)})}o(y,O)};m(pe,y=>{p(),i(()=>!p().classFeatures)&&y(we)})}s($e),D(()=>ke=Et($e,1,"class-features svelte-1kpvv0n",null,ke,{hidden:!e(F)})),o(r,$e),Xt(),w()}var Vi=u('<textarea placeholder="Enter features, traits, and special abilities..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Equipment</h3> <textarea placeholder="List your equipment and inventory..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Notes</h3> <textarea placeholder="Additional notes..." class="svelte-wttn0l"></textarea>',1),Ji=u("<section><!> <!></section>");function Yi(r,c){Qt(c,!1);const t=()=>_t(xa,"$searchFilter",p),v=()=>_t(fe,"$character",p),f=()=>_t(la,"$collapsedStates",p),[p,g]=fa(),w=C();function h(){la.update(se=>({...se,notes:!se.notes}))}Ze(()=>(t(),v()),()=>{n(w,!t()||"features".includes(t().toLowerCase())||"traits".includes(t().toLowerCase())||"equipment".includes(t().toLowerCase())||"notes".includes(t().toLowerCase())||v().features.toLowerCase().includes(t().toLowerCase())||v().equipment.toLowerCase().includes(t().toLowerCase())||v().notes.toLowerCase().includes(t().toLowerCase()))}),ga(),Yt();var _=Ji();let q;var I=l(_);{let se=xt(()=>(f(),i(()=>f().notes?"Expand":"Collapse")));Ca(I,{title:"Features & Traits",get collapsed(){return f(),i(()=>f().notes)},get ariaLabel(){return e(se)},onToggle:h})}var ae=a(I,2);{var Q=se=>{var U=Vi(),R=Ae(U);ja(R);var F=a(R,4);ja(F);var le=a(F,4);ja(le),We(R,()=>v().features,he=>Ot(fe,i(v).features=he,i(v))),We(F,()=>v().equipment,he=>Ot(fe,i(v).equipment=he,i(v))),We(le,()=>v().notes,he=>Ot(fe,i(v).notes=he,i(v))),o(se,U)};m(ae,se=>{f(),i(()=>!f().notes)&&se(Q)})}s(_),D(()=>q=Et(_,1,"notes svelte-wttn0l",null,q,{hidden:!e(w)})),o(r,_),Xt(),g()}var Qi=u(" <!> <!> <!> <!> <!>",1),Xi=u('<div class="color-picker-section svelte-1r90jgp"><h3 class="svelte-1r90jgp">Dice Colors</h3> <div class="color-inputs svelte-1r90jgp"><div class="color-input-group svelte-1r90jgp"><label for="dice-color" class="svelte-1r90jgp">Dice Color</label> <input type="color" id="dice-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="label-color" class="svelte-1r90jgp">Label Color</label> <input type="color" id="label-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="desk-color" class="svelte-1r90jgp">Background Color</label> <input type="color" id="desk-color" class="svelte-1r90jgp"/></div></div></div>'),Zi=u('<div class="loading svelte-1r90jgp"><p class="svelte-1r90jgp">Loading 3D dice...</p></div>'),en=u('<div class="custom-dice-selector svelte-1r90jgp"><h3 class="svelte-1r90jgp">Choose Dice to Roll</h3> <div class="dice-inputs svelte-1r90jgp"><div class="dice-input-group svelte-1r90jgp"><label for="d4" class="svelte-1r90jgp">d4</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d4" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d6" class="svelte-1r90jgp">d6</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d6" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d8" class="svelte-1r90jgp">d8</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d8" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d10" class="svelte-1r90jgp">d10</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d10" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d12" class="svelte-1r90jgp">d12</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d12" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d20" class="svelte-1r90jgp">d20</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d20" min="0" max="10"/></div></div> <div class="dice-controls svelte-1r90jgp"><button class="btn btn-primary use-enabled svelte-1r90jgp"> </button> <button class="btn btn-secondary use-enabled svelte-1r90jgp">Reset</button></div></div>'),tn=u('<h3 class="svelte-1r90jgp"> </h3>'),an=u('<h3 class="svelte-1r90jgp"> </h3>'),sn=u('<h3 class="svelte-1r90jgp"> </h3>'),ln=u('<h3 class="svelte-1r90jgp"> </h3>'),rn=u('<span class="crit-badge svelte-1r90jgp">CRITICAL HIT!</span>'),nn=u('<span class="crit-badge crit-fail svelte-1r90jgp">CRITICAL MISS!</span>'),on=u('<div class="bonus-item svelte-1r90jgp"><span class="bonus-value svelte-1r90jgp"> </span> <span class="bonus-source svelte-1r90jgp"> </span></div>'),cn=u('<div class="bonus-breakdown svelte-1r90jgp"></div>'),vn=u('<p class="modifier-text svelte-1r90jgp"> </p>'),dn=u('<div class="svelte-1r90jgp"><em class="svelte-1r90jgp">No damage is dealt on a critical miss.</em></div>'),un=u('<button class="btn btn-follow-up svelte-1r90jgp"> </button>'),fn=u('<button class="btn btn-guided-strike svelte-1r90jgp">‚ö° Use Guided Strike (+10)</button>'),pn=u('<div class="follow-up-actions svelte-1r90jgp"><!> <!></div>'),mn=u('<div class="result-header svelte-1r90jgp"><!> <!> <!></div> <div class="result-total svelte-1r90jgp"> </div> <div class="result-details svelte-1r90jgp"><!></div> <!> <!>',1),gn=u('<div role="button" tabindex="-1"><div class="modal-content svelte-1r90jgp" role="dialog" tabindex="0"><div class="modal-header svelte-1r90jgp"><h2 class="svelte-1r90jgp"><!></h2> <div class="header-buttons svelte-1r90jgp"><button class="color-btn svelte-1r90jgp" title="Customize dice colors">üé®</button> <button class="close-btn svelte-1r90jgp">√ó</button></div></div> <!> <!> <div class="dice-main-area svelte-1r90jgp"><div class="dice-container svelte-1r90jgp"></div> <!></div> <div><!></div></div></div>');function bn(r,c){Qt(c,!1);const t=()=>_t(fe,"$character",v),[v,f]=fa(),p=C(),g=C(),w=C(),h=$a();let _=Bt(c,"notation",12,""),q=Bt(c,"visible",8,!1),I=Bt(c,"damageNotation",12,""),ae=Bt(c,"damageType",8,""),Q=Bt(c,"attackName",12,""),se=Bt(c,"applyHalfDamage",8,!1),U=Bt(c,"bonusBreakdown",28,()=>[]),R=Bt(c,"rollType",12,"other"),F=Bt(c,"damageBreakdown",24,()=>[]),le=null,he=C(void 0),qe=C(!1),ce=C(""),re=C(null),_e=C("");function Ie(){return e(re)?.resultTotal??null}function Qe(b,P,ie){const ne=[];if(!b||!b.result)return ne;const ve=P.match(/([+-]?\d*d\d+|[+-]?\d+)/g)||[];let Re=0;const ze=new Set;let Ne=!0;for(const oe of ve){const V=oe.trim();if(!V)continue;const ot=V.match(/([+-]?)(\d*)d(\d+)/);if(ot){const xe=parseInt(ot[2]||"1"),ee=`${xe}d${ot[3]}`,ue=ie.findIndex((it,te)=>!ze.has(te)&&typeof it.value=="string"&&it.value===ee),Xe=[];for(let it=0;it<xe&&Re<b.result.length;it++)Xe.push(b.result[Re++]);let wt;ue>=0?(wt=ie[ue].source,ze.add(ue)):wt="base";for(const it of Xe)ne.push({display:`${it}`,source:wt});Ne=!1}}for(let oe=0;oe<ie.length;oe++)if(!ze.has(oe)&&typeof ie[oe].value=="number"){const V=ie[oe].value;ne.push({display:V>=0?`+${V}`:`${V}`,source:ie[oe].source})}return ne}let T=C(0),M=C(0),x=C(0),J=C(0),W=C(0),ge=C(0),$e=C(0),ke=C([]),be=C(!1),pe=C(!1),we=C(!1),y=C("#051e0a"),O=C("#ffffff"),Te=C("#3a2004"),ft=C(!1);function ut(b){return b.length===9&&b.startsWith("#")?b.substring(0,7):b}function yt(b,P="ff"){return b.length===7&&b.startsWith("#")?b+P:b}function Ct(){if(window.DICE&&e(he))try{le&&e(he)&&_a(he,e(he).innerHTML="");const b=e(he).clientWidth||500,P=e(he).clientHeight||300;le=new window.DICE.dice_box(e(he),{w:b,h:P}),n(qe,!0)}catch(b){console.error("Error initializing dice box:",b)}}Sa(()=>{const b=ne=>new Promise((ve,Re)=>{if(document.querySelector(`script[src="${ne}"]`)){ve(null);return}const Ne=document.createElement("script");Ne.src=ne,Ne.onload=()=>{ve(null)},Ne.onerror=()=>{console.error(`Failed to load: ${ne}`),Re(new Error(`Failed to load ${ne}`))},document.head.appendChild(Ne)});setTimeout(()=>{b(`${Ia}/libs/three.min.js`).then(()=>b(`${Ia}/libs/cannon.min.js`)).then(()=>b(`${Ia}/libs/teal.js`)).then(()=>b(`${Ia}/dice.js`)).then(()=>{if(window.DICE){const ne=window.DICE.getColors();n(y,ut(ne.dice_color)),n(O,ut(ne.label_color)),n(Te,ut(ne.desk_color))}Ct()}).catch(ne=>{console.error("Failed to load dice libraries:",ne)})},100);const P=()=>{e(qe)&&Ct()},ie=ne=>{q()&&ne.key==="Escape"&&Fe()};return window.addEventListener("resize",P),window.addEventListener("keydown",ie),()=>{window.removeEventListener("resize",P),window.removeEventListener("keydown",ie)}});function Dt(b,P="other"){if(!le||!e(qe))return;n(re,null),n(ke,[]),n(be,!1),n(pe,!1),R(P),n(we,!1),n(_e,b),le.diceToRoll=b;const ie=ve=>null,ne=ve=>{let Re=ve.resultTotal,ze=ve.resultString;if(se()&&(Re=Math.floor(Re/2),ze=ze+" (halved)"),n(re,{...ve,resultTotal:Re,resultString:ze}),P==="attack"&&ve.result&&ve.result.length>0){const Ne=ve.result[0];n(be,Ne===20),n(pe,Ne===1)}if(n(ke,[]),P==="attack"&&I())if(e(be)){const Ne=A(I()),oe=F().map(V=>{if(typeof V.value=="string"&&V.value.match(/^\d+d\d+$/)){const ot=A(V.value);return{...V,value:ot}}return V});e(ke).push({label:`Roll Critical Damage (${Ne})`,notation:Ne,breakdown:oe})}else e(pe)||e(ke).push({label:`Roll Damage (${I()})`,notation:I(),breakdown:F()})};le.start_throw(ie,ne)}function S(){const b=[];e(T)>0&&b.push(`${e(T)}d4`),e(M)>0&&b.push(`${e(M)}d6`),e(x)>0&&b.push(`${e(x)}d8`),e(J)>0&&b.push(`${e(J)}d10`),e(W)>0&&b.push(`${e(W)}d12`),e(ge)>0&&b.push(`${e(ge)}d20`);let P=b.join("+")||"1d20";return e($e)!==0&&(P+=e($e)>=0?`+${e($e)}`:`${e($e)}`),P}function z(){const b=S();Dt(b)}function A(b){return b.replace(/(\d+)d(\d+)/g,(P,ie,ne)=>`${parseInt(ie)*2}d${ne}`)}function H(){n(T,0),n(M,0),n(x,0),n(J,0),n(W,0),n(ge,0),n($e,0),n(re,null),n(ke,[]),n(be,!1),n(pe,!1),R("other"),n(we,!1)}function K(){window.DICE&&(window.DICE.setColors({dice_color:yt(e(y),"ff"),label_color:yt(e(O),"ff"),desk_color:e(Te)}),le&&(le.updateDeskColor(e(Te)),le.updateDiceColors()))}function me(){n(ft,!e(ft))}function He(){!e(re)||e(g)<=0||e(we)||(n(re,{...e(re),resultTotal:e(re).resultTotal+10,resultString:e(re).resultString+" + 10 (Guided Strike)"}),U([...U(),{value:10,source:"Guided Strike"}]),fe.update(b=>{const P="ChannelDivinity",ie=b.classFeatures.features[P];return typeof ie=="number"&&ie>0&&(b.classFeatures.features[P]=ie-1),b}),n(we,!0))}function Fe(){h("close"),_(""),I(""),Q(""),n(ce,""),n(re,null),n(we,!1),n(be,!1),n(pe,!1),H()}Ze(()=>(t(),Ta),()=>{n(p,t().class?Ta(t().class,t().level,t().subclass).some(P=>P.name==="Guided Strike"):!1)}),Ze(()=>t(),()=>{n(g,(()=>{const P=t().classFeatures.features["ChannelDivinity"];return typeof P=="number"?P:0})())}),Ze(()=>(e(T),e(M),e(x),e(J),e(W),e(ge),e($e)),()=>{n(w,(()=>{const b=[];e(T)>0&&b.push(`${e(T)}d4`),e(M)>0&&b.push(`${e(M)}d6`),e(x)>0&&b.push(`${e(x)}d8`),e(J)>0&&b.push(`${e(J)}d10`),e(W)>0&&b.push(`${e(W)}d12`),e(ge)>0&&b.push(`${e(ge)}d20`);let P=b.join("+")||"1d20";return e($e)!==0&&(P+=e($e)>=0?`+${e($e)}`:`${e($e)}`),P})())}),Ze(()=>(E(_()),e(qe),E(q()),e(ce),E(R())),()=>{_()&&e(qe)&&q()&&_()!==e(ce)&&(n(ce,_()),n(re,null),n(ke,[]),n(be,!1),n(pe,!1),n(we,!1),setTimeout(()=>Dt(_(),R()),200))}),ga();var Ge={getLastRollTotal:Ie};Yt();var Pe=gn();let $;var X=l(Pe),N=l(X),Be=l(N),ye=l(Be);{var nt=b=>{var P=Qi(),ie=Ae(P),ne=a(ie);{var ve=ue=>{var Xe=Tt("- Attack Roll");o(ue,Xe)};m(ne,ue=>{R()==="attack"&&ue(ve)})}var Re=a(ne,2);{var ze=ue=>{var Xe=Tt("- Damage Roll");o(ue,Xe)};m(Re,ue=>{R()==="damage"&&ue(ze)})}var Ne=a(Re,2);{var oe=ue=>{var Xe=Tt("- Healing Roll");o(ue,Xe)};m(Ne,ue=>{R()==="healing"&&ue(oe)})}var V=a(Ne,2);{var ot=ue=>{var Xe=Tt("- Ability Check");o(ue,Xe)};m(V,ue=>{R()==="check"&&ue(ot)})}var xe=a(V,2);{var ee=ue=>{var Xe=Tt("- Saving Throw");o(ue,Xe)};m(xe,ue=>{R()==="save"&&ue(ee)})}D(()=>k(ie,`${Q()??""} `)),o(b,P)},je=b=>{var P=Tt("Dice Roller");o(b,P)};m(ye,b=>{Q()?b(nt):b(je,!1)})}s(Be);var Z=a(Be,2),d=l(Z),at=a(d,2);s(Z),s(N);var Ce=a(N,2);{var G=b=>{var P=Xi(),ie=a(l(P),2),ne=l(ie),ve=a(l(ne),2);Se(ve),s(ne);var Re=a(ne,2),ze=a(l(Re),2);Se(ze),s(Re);var Ne=a(Re,2),oe=a(l(Ne),2);Se(oe),s(Ne),s(ie),s(P),We(ve,()=>e(y),V=>n(y,V)),B("change",ve,K),We(ze,()=>e(O),V=>n(O,V)),B("change",ze,K),We(oe,()=>e(Te),V=>n(Te,V)),B("change",oe,K),o(b,P)};m(Ce,b=>{e(ft)&&b(G)})}var De=a(Ce,2);{var de=b=>{var P=Zi();o(b,P)};m(De,b=>{e(qe)||b(de)})}var Ve=a(De,2),Oe=l(Ve);Ua(Oe,b=>n(he,b),()=>e(he));var et=a(Oe,2);{var Ue=b=>{var P=en(),ie=a(l(P),2),ne=l(ie),ve=a(l(ne),2);Se(ve),s(ne);var Re=a(ne,2),ze=a(l(Re),2);Se(ze),s(Re);var Ne=a(Re,2),oe=a(l(Ne),2);Se(oe),s(Ne);var V=a(Ne,2),ot=a(l(V),2);Se(ot),s(V);var xe=a(V,2),ee=a(l(xe),2);Se(ee),s(xe);var ue=a(xe,2),Xe=a(l(ue),2);Se(Xe),s(ue),s(ie);var wt=a(ie,2),it=l(wt),te=l(it);s(it);var Gt=a(it,2);s(wt),s(P),D(()=>{it.disabled=!e(qe),k(te,`Roll ${e(w)??""}`)}),We(ve,()=>e(T),Me=>n(T,Me)),We(ze,()=>e(M),Me=>n(M,Me)),We(oe,()=>e(x),Me=>n(x,Me)),We(ot,()=>e(J),Me=>n(J,Me)),We(ee,()=>e(W),Me=>n(W,Me)),We(Xe,()=>e(ge),Me=>n(ge,Me)),B("click",it,z),B("click",Gt,H),o(b,P)};m(et,b=>{_()||b(Ue)})}s(Ve);var Je=a(Ve,2);let mt;var Y=l(Je);{var Ye=b=>{var P=mn(),ie=Ae(P),ne=l(ie);{var ve=Me=>{var $t=tn(),ta=l($t,!0);s($t),D(()=>k(ta,Q()?`${Q()} - Healing`:"Healing")),o(Me,$t)},Re=Me=>{var $t=kt(),ta=Ae($t);{var aa=Le=>{var Ee=an(),bt=l(Ee,!0);s(Ee),D(()=>k(bt,Q()?`${Q()} - ${ae()} Damage`:`${ae()} Damage`)),o(Le,Ee)},j=Le=>{var Ee=kt(),bt=Ae(Ee);{var L=st=>{var ht=sn(),tt=l(ht,!0);s(ht),D(()=>k(tt,Q()?`${Q()} - Damage`:"Damage")),o(st,ht)},dt=st=>{var ht=ln(),tt=l(ht,!0);s(ht),D(()=>k(tt,Q()?`${Q()} - Result`:"Result")),o(st,ht)};m(bt,st=>{R()==="damage"?st(L):st(dt,!1)},!0)}o(Le,Ee)};m(ta,Le=>{R()==="damage"&&ae()?Le(aa):Le(j,!1)},!0)}o(Me,$t)};m(ne,Me=>{R()==="damage"&&ae()==="Healing"?Me(ve):Me(Re,!1)})}var ze=a(ne,2);{var Ne=Me=>{var $t=rn();o(Me,$t)};m(ze,Me=>{e(be)&&Me(Ne)})}var oe=a(ze,2);{var V=Me=>{var $t=nn();o(Me,$t)};m(oe,Me=>{e(pe)&&Me(V)})}s(ie);var ot=a(ie,2),xe=l(ot,!0);s(ot);var ee=a(ot,2),ue=l(ee);{var Xe=Me=>{var $t=kt(),ta=Ae($t);{var aa=Le=>{var Ee=cn();Lt(Ee,5,()=>(e(re),e(_e),E(U()),i(()=>Qe(e(re),e(_e),U()))),Rt,(bt,L)=>{var dt=on(),st=l(dt),ht=l(st,!0);s(st);var tt=a(st,2),lt=l(tt);s(tt),s(dt),D(()=>{k(ht,(e(L),i(()=>e(L).display))),k(lt,`(${e(L),i(()=>e(L).source)??""})`)}),o(bt,dt)}),s(Ee),o(Le,Ee)},j=Le=>{var Ee=kt(),bt=Ae(Ee);{var L=dt=>{var st=vn(),ht=l(st);s(st),D(()=>k(ht,`Modifier: ${e(re),i(()=>e(re).constant>=0?"+":"")??""}${e(re),i(()=>e(re).constant)??""}`)),o(dt,st)};m(bt,dt=>{e(re),i(()=>e(re).constant)&&dt(L)},!0)}o(Le,Ee)};m(ta,Le=>{E(U()),i(()=>U().length>0)?Le(aa):Le(j,!1)})}o(Me,$t)};m(ue,Me=>{e(re),E(U()),i(()=>e(re).constant||U().length>0)&&Me(Xe)})}s(ee);var wt=a(ee,2);{var it=Me=>{var $t=dn();o(Me,$t)};m(wt,Me=>{e(pe)&&Me(it)})}var te=a(wt,2);{var Gt=Me=>{var $t=pn(),ta=l($t);Lt(ta,1,()=>e(ke),Rt,(Le,Ee)=>{var bt=un(),L=l(bt,!0);s(bt),D(()=>k(L,(e(Ee),i(()=>e(Ee).label)))),B("click",bt,()=>{U(e(Ee).breakdown||[]),Dt(e(Ee).notation,"damage")}),o(Le,bt)});var aa=a(ta,2);{var j=Le=>{var Ee=fn();D(()=>{Ee.disabled=e(g)<=0,vt(Ee,"title",e(g)<=0?"No Channel Divinity uses remaining":"Use Channel Divinity to add +10 to this attack roll")}),B("click",Ee,He),o(Le,Ee)};m(aa,Le=>{e(p)&&R()==="attack"&&!e(we)&&e(g)>0&&!e(pe)&&Le(j)})}s($t),o(Me,$t)};m(te,Me=>{e(ke),e(p),E(R()),e(we),e(g),i(()=>e(ke).length>0||e(p)&&R()==="attack"&&!e(we)&&e(g)>0)&&Me(Gt)})}D(()=>k(xe,(e(re),i(()=>e(re).resultTotal)))),o(b,P)};m(Y,b=>{e(re)&&b(Ye)})}s(Je),s(X),s(Pe),D(()=>{$=Et(Pe,1,"modal-overlay svelte-1r90jgp",null,$,{hidden:!q()}),mt=Et(Je,1,"roll-result svelte-1r90jgp",null,mt,{"has-result":e(re)})}),B("click",d,me),B("click",at,Fe),B("click",X,xs(function(b){Ma.call(this,c,b)})),B("keydown",X,function(b){Ma.call(this,c,b)}),B("click",Pe,Fe),B("keydown",Pe,b=>b.key==="Escape"&&Fe()),o(r,Pe),Cl(c,"getLastRollTotal",Ie);var gt=Xt(Ge);return f(),gt}const Za="https://api.github.com/gists";async function hn(r,c,t){if(!c)throw new Error("GitHub token is required");const v=JSON.stringify(r,null,2),f=`${r.name||"character"}_dnd.json`,p={description:t||`D&D Character: ${r.name}`,public:!1,files:{[f]:{content:v}}},g=await fetch(Za,{method:"POST",headers:{Authorization:`token ${c}`,"Content-Type":"application/json"},body:JSON.stringify(p)});if(!g.ok)throw new Error(`Failed to create gist: ${g.statusText}`);return(await g.json()).id}async function _n(r,c,t){if(!c||!t)throw new Error("GitHub token and Gist ID are required");const v=JSON.stringify(r,null,2),p={files:{[`${r.name||"character"}_dnd.json`]:{content:v}}},g=await fetch(`${Za}/${t}`,{method:"PATCH",headers:{Authorization:`token ${c}`,"Content-Type":"application/json"},body:JSON.stringify(p)});if(!g.ok)throw new Error(`Failed to update gist: ${g.statusText}`)}async function yn(r,c){if(!r)throw new Error("Gist ID is required");const t={"Content-Type":"application/json"};c&&(t.Authorization=`token ${c}`);const v=await fetch(`${Za}/${r}`,{method:"GET",headers:t});if(!v.ok)throw new Error(`Failed to load gist: ${v.statusText}`);const f=await v.json(),p=Object.values(f.files);if(p.length===0)throw new Error("No files found in gist");const w=p[0].content;try{const h=JSON.parse(w);return h.attacks&&Array.isArray(h.attacks)&&(h.attacks=h.attacks.map(_=>({..._,id:_.id||crypto.randomUUID()}))),h.classFeatures?(h.classFeatures.features||(h.classFeatures.features={}),h.classFeatures.spellSlots||(h.classFeatures.spellSlots=[]),h.classFeatures.preparedSpells===void 0&&(h.classFeatures.preparedSpells="")):h.classFeatures={features:{},spellSlots:[],preparedSpells:""},h}catch{throw new Error("Invalid character data in gist")}}function Fs(r){typeof window<"u"&&localStorage.setItem("dnd_gist_config",JSON.stringify(r))}function xn(){if(typeof window<"u"){const r=localStorage.getItem("dnd_gist_config");if(r)return JSON.parse(r)}return{}}async function $n(r,c=30){if(!r)throw new Error("GitHub token is required to list gists");const t=await fetch(`${Za}?per_page=${c}`,{method:"GET",headers:{Authorization:`token ${r}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error(`Failed to list gists: ${t.statusText}`);return await t.json()}var kn=u('<div class="error-message svelte-1jb5ckg"> </div>'),wn=u('<div class="toggle-container svelte-1jb5ckg"><button type="button" class="toggle-btn svelte-1jb5ckg"> </button></div>'),Sn=u('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID (leave empty to create new)</label> <input type="text" id="gistId" placeholder="Optional: existing Gist ID to update" class="svelte-1jb5ckg"/></div>'),Cn=u('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),Dn=u('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),Ln=u('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Update (or leave unselected to create new)</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),An=u('<div class="info-message svelte-1jb5ckg">No gists found. A new one will be created.</div>'),jn=u('<!> <div class="form-group svelte-1jb5ckg"><label for="description" class="svelte-1jb5ckg"> </label> <input type="text" id="description" placeholder="D&amp;D Character Sheet" class="svelte-1jb5ckg"/></div>',1),Bn=u('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID *</label> <input type="text" id="gistId" placeholder="Enter Gist ID (for public or your private gists)" required class="svelte-1jb5ckg"/></div>'),Rn=u('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),Mn=u('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),Tn=u('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Load</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),Fn=u('<div class="info-message svelte-1jb5ckg">No gists found. Enter a Gist ID manually or create a new one in Save mode.</div>'),Pn=u('<div class="modal-overlay svelte-1jb5ckg" role="button" tabindex="-1"><div class="modal-content svelte-1jb5ckg" role="dialog" tabindex="0"><div class="modal-header svelte-1jb5ckg"><h2 class="svelte-1jb5ckg"> </h2> <button class="close-btn svelte-1jb5ckg">√ó</button></div> <div class="modal-body svelte-1jb5ckg"><!> <div class="form-group svelte-1jb5ckg"><label for="token" class="svelte-1jb5ckg"> <a href="https://github.com/settings/tokens" target="_blank" rel="noopener" class="svelte-1jb5ckg">Get token</a></label> <input type="password" id="token" placeholder="ghp_xxxxxxxxxxxxx" class="svelte-1jb5ckg"/></div> <!> <!> <div class="modal-actions svelte-1jb5ckg"><button class="btn btn-primary svelte-1jb5ckg"><!></button> <button class="btn btn-secondary svelte-1jb5ckg">Cancel</button></div></div></div></div>');function In(r,c){Qt(c,!1);const t=()=>_t(fe,"$character",v),[v,f]=fa(),p=$a();let g=Bt(c,"mode",8,"save"),w=C(""),h=C(""),_=C(""),q=C(!1),I=C(""),ae=C(!1),Q=C(!1),se=C([]),U=C(null);const R=xn();R.token&&n(w,R.token),R.gistId&&n(h,R.gistId),Sa(async()=>{e(w)&&!e(ae)&&await F()});async function F(){if(e(w)){n(Q,!0),n(I,"");try{n(se,await $n(e(w))),e(h)&&n(U,e(se).find(A=>A.id===e(h))||null)}catch(A){n(I,A.message||"Failed to load gists"),n(se,[])}finally{n(Q,!1)}}}function le(A){e(U)?.id===A.id?(n(U,null),n(h,"")):(n(U,A),n(h,A.id))}function he(){n(ae,!e(ae)),n(I,""),!e(ae)&&e(w)&&F()}async function qe(){if(!e(w)){n(I,"GitHub token is required");return}const A=e(U)?.id||e(h);n(q,!0),n(I,"");try{if(A)await _n(t(),e(w),A),n(h,A),Ht.add("Character updated in Gist successfully!","success");else{const H=await hn(t(),e(w),e(_));n(h,H),Ht.add(`Character saved to Gist! ID: ${H}`,"success")}Fs({token:e(w),gistId:e(h)}),p("close")}catch(H){n(I,H.message||"Failed to save to Gist")}finally{n(q,!1)}}async function ce(){const A=e(U)?.id||e(h);if(!A){n(I,"Please select a gist or enter a Gist ID");return}n(q,!0),n(I,"");try{const H=await yn(A,e(w)||void 0);fe.set(H),n(h,A),Fs({token:e(w),gistId:e(h)}),Ht.add("Character loaded from Gist successfully!","success"),p("close")}catch(H){n(I,H.message||"Failed to load from Gist")}finally{n(q,!1)}}function re(){p("close")}Yt();var _e=Pn(),Ie=l(_e),Qe=l(Ie),T=l(Qe),M=l(T,!0);s(T);var x=a(T,2);s(Qe);var J=a(Qe,2),W=l(J);{var ge=A=>{var H=kn(),K=l(H,!0);s(H),D(()=>k(K,e(I))),o(A,H)};m(W,A=>{e(I)&&A(ge)})}var $e=a(W,2),ke=l($e),be=l(ke);sa(),s(ke);var pe=a(ke,2);Se(pe),s($e);var we=a($e,2);{var y=A=>{var H=wn(),K=l(H),me=l(K,!0);s(K),s(H),D(()=>{K.disabled=e(q),k(me,e(ae)?"üìã Show My Gists":"‚úèÔ∏è Enter Gist ID Manually")}),B("click",K,he),o(A,H)};m(we,A=>{(g()==="load"||g()==="save"&&e(w))&&A(y)})}var O=a(we,2);{var Te=A=>{var H=jn(),K=Ae(H);{var me=X=>{var N=Sn(),Be=a(l(N),2);Se(Be),s(N),D(()=>Be.disabled=e(q)),We(Be,()=>e(h),ye=>n(h,ye)),o(X,N)},He=X=>{var N=kt(),Be=Ae(N);{var ye=je=>{var Z=Cn();o(je,Z)},nt=je=>{var Z=kt(),d=Ae(Z);{var at=G=>{var De=Ln(),de=a(l(De),2);Lt(de,5,()=>e(se),Rt,(Ve,Oe)=>{var et=Dn();let Ue;var Je=l(et),mt=l(Je),Y=l(mt,!0);s(mt);var Ye=a(mt,2),gt=l(Ye,!0);s(Ye),s(Je);var b=a(Je,2),P=l(b),ie=l(P);s(P);var ne=a(P,2),ve=l(ne);s(ne),s(b),s(et),D(Re=>{Ue=Et(et,1,"gist-item svelte-1jb5ckg",null,Ue,{selected:e(U)?.id===e(Oe).id}),et.disabled=e(q),k(Y,(e(Oe),i(()=>e(Oe).description||"Untitled"))),k(gt,(e(Oe),i(()=>e(Oe).public?"üåê Public":"üîí Private"))),k(ie,`ID: ${e(Oe),i(()=>e(Oe).id)??""}`),k(ve,`Updated: ${Re??""}`)},[()=>(e(Oe),i(()=>new Date(e(Oe).updated_at).toLocaleDateString()))]),B("click",et,()=>le(e(Oe))),o(Ve,et)}),s(de),s(De),o(G,De)},Ce=G=>{var De=kt(),de=Ae(De);{var Ve=Oe=>{var et=An();o(Oe,et)};m(de,Oe=>{e(w)&&Oe(Ve)},!0)}o(G,De)};m(d,G=>{e(se),i(()=>e(se).length>0)?G(at):G(Ce,!1)},!0)}o(je,Z)};m(Be,je=>{e(Q)?je(ye):je(nt,!1)},!0)}o(X,N)};m(K,X=>{e(ae)||!e(w)?X(me):X(He,!1)})}var Fe=a(K,2),Ge=l(Fe),Pe=l(Ge);s(Ge);var $=a(Ge,2);Se($),s(Fe),D(()=>{k(Pe,`Description ${e(h)?"(optional)":""}`),$.disabled=e(q)}),We($,()=>e(_),X=>n(_,X)),o(A,H)},ft=A=>{var H=kt(),K=Ae(H);{var me=Fe=>{var Ge=Bn(),Pe=a(l(Ge),2);Se(Pe),s(Ge),D(()=>Pe.disabled=e(q)),We(Pe,()=>e(h),$=>n(h,$)),o(Fe,Ge)},He=Fe=>{var Ge=kt(),Pe=Ae(Ge);{var $=N=>{var Be=Rn();o(N,Be)},X=N=>{var Be=kt(),ye=Ae(Be);{var nt=Z=>{var d=Tn(),at=a(l(d),2);Lt(at,5,()=>e(se),Rt,(Ce,G)=>{var De=Mn();let de;var Ve=l(De),Oe=l(Ve),et=l(Oe,!0);s(Oe);var Ue=a(Oe,2),Je=l(Ue,!0);s(Ue),s(Ve);var mt=a(Ve,2),Y=l(mt),Ye=l(Y);s(Y);var gt=a(Y,2),b=l(gt);s(gt),s(mt),s(De),D(P=>{de=Et(De,1,"gist-item svelte-1jb5ckg",null,de,{selected:e(U)?.id===e(G).id}),De.disabled=e(q),k(et,(e(G),i(()=>e(G).description||"Untitled"))),k(Je,(e(G),i(()=>e(G).public?"üåê Public":"üîí Private"))),k(Ye,`ID: ${e(G),i(()=>e(G).id)??""}`),k(b,`Updated: ${P??""}`)},[()=>(e(G),i(()=>new Date(e(G).updated_at).toLocaleDateString()))]),B("click",De,()=>le(e(G))),o(Ce,De)}),s(at),s(d),o(Z,d)},je=Z=>{var d=kt(),at=Ae(d);{var Ce=G=>{var De=Fn();o(G,De)};m(at,G=>{e(w)&&G(Ce)},!0)}o(Z,d)};m(ye,Z=>{e(se),i(()=>e(se).length>0)?Z(nt):Z(je,!1)},!0)}o(N,Be)};m(Pe,N=>{e(Q)?N($):N(X,!1)},!0)}o(Fe,Ge)};m(K,Fe=>{e(ae)||!e(w)?Fe(me):Fe(He,!1)},!0)}o(A,H)};m(O,A=>{g()==="save"?A(Te):A(ft,!1)})}var ut=a(O,2),yt=l(ut),Ct=l(yt);{var Dt=A=>{var H=Tt();D(()=>k(H,g()==="save"?"Saving...":"Loading...")),o(A,H)},S=A=>{var H=Tt();D(()=>k(H,g()==="save"?"Save":"Load")),o(A,H)};m(Ct,A=>{e(q)?A(Dt):A(S,!1)})}s(yt);var z=a(yt,2);s(ut),s(J),s(Ie),s(_e),D(()=>{k(M,g()==="save"?"Save to GitHub Gist":"Load from GitHub Gist"),k(be,`GitHub Token ${g()==="load"?"(optional for public gists)":"(required)"} `),pe.disabled=e(q),yt.disabled=e(q),z.disabled=e(q)}),B("click",x,re),We(pe,()=>e(w),A=>n(w,A)),B("blur",pe,()=>{e(w)&&!e(ae)&&F()}),B("click",yt,function(...A){(g()==="save"?qe:ce)?.apply(this,A)}),B("click",z,re),B("click",Ie,xs(function(A){Ma.call(this,c,A)})),B("keydown",Ie,function(A){Ma.call(this,c,A)}),B("click",_e,re),B("keydown",_e,A=>A.key==="Escape"&&re()),o(r,_e),Xt(),f()}var En=u('<div class="loading svelte-1ngjemu">Loading D&D data...</div>'),Un=u("<option> </option>"),Nn=u('<select class="level-filter svelte-1ngjemu"><option>All Levels</option><option>Cantrip</option><!></select>'),Hn=u('<div class="no-results svelte-1ngjemu"> </div>'),On=u('<div class="item-meta svelte-1ngjemu"> </div>'),Gn=u('<div class="item-meta svelte-1ngjemu"> </div>'),qn=u('<button><div class="item-name svelte-1ngjemu"> </div> <!></button>'),Wn=u('<p class="higher-levels"><strong>At Higher Levels:</strong> </p>'),zn=u('<p class="cantrip-upgrade"><strong>Cantrip Upgrade:</strong> </p>'),Kn=u('<h3 class="svelte-1ngjemu"> </h3> <p class="spell-meta svelte-1ngjemu"><!> <!></p> <p class="spell-classes"><strong>Classes:</strong> </p> <div class="spell-stats svelte-1ngjemu"><div><strong>Casting Time:</strong> </div> <div><strong>Range:</strong> </div> <div><strong>Components:</strong> <!></div> <div><strong>Duration:</strong> <!> </div></div> <p class="description svelte-1ngjemu"> </p> <!> <!>',1),Vn=u('<p class="prerequisite svelte-1ngjemu"><strong>Prerequisite:</strong> </p>'),Jn=u('<h3 class="svelte-1ngjemu"> </h3> <!> <p class="description svelte-1ngjemu"> </p> <a target="_blank" rel="noopener" class="source-link svelte-1ngjemu">View Full Details ‚Üí</a>',1),Yn=u('<div class="item-details svelte-1ngjemu"><!></div>'),Qn=u('<div class="controls svelte-1ngjemu"><div class="tabs svelte-1ngjemu"><button> </button> <button> </button></div> <div class="search-controls svelte-1ngjemu"><input type="text" placeholder="Search by name or description..." class="search-input svelte-1ngjemu"/> <!></div></div> <div class="content-container svelte-1ngjemu"><div class="items-list svelte-1ngjemu"><!></div> <!></div>',1),Xn=u('<div class="modal-backdrop svelte-1ngjemu" role="presentation"><div class="modal svelte-1ngjemu" role="dialog" aria-modal="true" tabindex="-1"><div class="modal-header svelte-1ngjemu"><h2 class="svelte-1ngjemu">Browse D&D Spells & Feats</h2> <button class="close-btn svelte-1ngjemu" aria-label="Close">&times;</button></div> <div class="modal-body svelte-1ngjemu"><!></div> <div class="modal-footer svelte-1ngjemu"><button class="btn-secondary svelte-1ngjemu">Cancel</button> <button class="btn-primary svelte-1ngjemu">Add to Character Sheet</button></div></div></div>');function Zn(r,c){Qt(c,!1);const t=C(),v=C(),f=C();let p=Bt(c,"onClose",8),g=C("spell"),w=C(!0),h=C(""),_=C(null),q=C([]),I=C([]),ae=C(null);Sa(async()=>{n(w,!0);try{n(q,await Ws()),n(I,await fr())}catch(x){console.error("Failed to load data:",x)}finally{n(w,!1)}});function Q(x){n(ae,x)}function se(x){const J=x.match(/(\d+d\d+(?:\s*\+\s*\d+)?)/i);return J?J[1]:""}function U(x){const J=x.split(/\.( |$)/)[0].trim(),W=Array.from(x.matchAll(/\*\*(.*?)\*\*/g)).map($e=>$e[1].replace(/\.$/,""));let ge=J;return W.length&&(ge+=" | Effects: "+W.join(", ")),ge}function R(){if(e(ae)){if(e(g)==="spell"){const x=e(ae);fe.update(J=>{const ge=[];x.range&&ge.push(`Range: ${x.range}`),x.castingTime&&ge.push(`Cast: ${x.castingTime}`),x.duration&&ge.push(`Duration: ${x.duration}`),x.actionType==="Save"&&ge.push("Saving throw spell"),x.components&&x.components.length>0&&ge.push(`Components: ${x.components.join(", ")}`),x.material&&ge.push(`Material: ${x.material}`);const $e=ge.join(" | "),ke=U(x.description),be={id:crypto.randomUUID(),name:`${x.name}${x.concentration?" (C)":""}${x.ritual?" (R)":""}`,bonus:x.actionType==="Attack"?5:0,damage:se(x.description),damageType:`${x.school} (Lvl ${x.level})`,spellRef:x.name,infoNotes:$e,generalNotes:ke,castAtLevel:x.level};return J.attacks=[...J.attacks,be],J})}else if(e(g)==="feat"){const x=e(ae);fe.update(J=>{const W=`${x.name}${x.prerequisite?` (Req: ${x.prerequisite})`:""}
${x.description}
`;return J.features=J.features?`${J.features}
${W}`:W,J})}n(ae,null),p()()}}Ze(()=>(e(_),e(q),e(h)),()=>{n(t,e(_)!==null?pr(Ms(e(q),e(h)),e(_)):Ms(e(q),e(h)))}),Ze(()=>(e(I),e(h)),()=>{n(v,mr(e(I),e(h)))}),Ze(()=>(e(g),e(t),e(v)),()=>{n(f,e(g)==="spell"?e(t):e(v))}),ga(),Yt();var F=Xn(),le=l(F),he=l(le),qe=a(l(he),2);s(he);var ce=a(he,2),re=l(ce);{var _e=x=>{var J=En();o(x,J)},Ie=x=>{var J=Qn(),W=Ae(J),ge=l(W),$e=l(ge);let ke;var be=l($e);s($e);var pe=a($e,2);let we;var y=l(pe);s(pe),s(ge);var O=a(ge,2),Te=l(O);Se(Te);var ft=a(Te,2);{var ut=K=>{var me=Nn();D(()=>{e(_),Kt(()=>{})});var He=l(me);He.value=(He.__value=null)??"";var Fe=a(He);Fe.value=Fe.__value=0;var Ge=a(Fe);Lt(Ge,0,()=>[1,2,3,4,5,6,7,8,9],Rt,(Pe,$)=>{var X=Un(),N=l(X);s(X);var Be={};D(()=>{k(N,`Level ${$??""}`),Be!==(Be=$)&&(X.value=(X.__value=$)??"")}),o(Pe,X)}),s(me),Na(me,()=>e(_),Pe=>n(_,Pe)),o(K,me)};m(ft,K=>{e(g)==="spell"&&K(ut)})}s(O),s(W);var yt=a(W,2),Ct=l(yt),Dt=l(Ct);{var S=K=>{var me=Hn(),He=l(me);s(me),D(()=>k(He,`No ${e(g)??""}s found`)),o(K,me)},z=K=>{var me=kt(),He=Ae(me);Lt(He,1,()=>e(f),Rt,(Fe,Ge)=>{var Pe=qn();let $;var X=l(Pe),N=l(X,!0);s(X);var Be=a(X,2);{var ye=je=>{const Z=xt(()=>e(Ge));var d=On(),at=l(d);s(d),D(()=>k(at,`Level ${E(e(Z)),i(()=>e(Z).level)??""} ‚Ä¢ ${E(e(Z)),i(()=>e(Z).school)??""}`)),o(je,d)},nt=je=>{const Z=xt(()=>e(Ge));var d=kt(),at=Ae(d);{var Ce=G=>{var De=Gn(),de=l(De,!0);s(De),D(()=>k(de,(E(e(Z)),i(()=>e(Z).prerequisite)))),o(G,De)};m(at,G=>{E(e(Z)),i(()=>e(Z).prerequisite)&&G(Ce)})}o(je,d)};m(Be,je=>{e(g)==="spell"?je(ye):je(nt,!1)})}s(Pe),D(()=>{$=Et(Pe,1,"item-card svelte-1ngjemu",null,$,{selected:e(ae)?.name===e(Ge).name}),k(N,(e(Ge),i(()=>e(Ge).name)))}),B("click",Pe,()=>Q(e(Ge))),o(Fe,Pe)}),o(K,me)};m(Dt,K=>{e(f),i(()=>e(f).length===0)?K(S):K(z,!1)})}s(Ct);var A=a(Ct,2);{var H=K=>{var me=Yn(),He=l(me);{var Fe=Pe=>{const $=xt(()=>e(ae));var X=Kn(),N=Ae(X),Be=l(N,!0);s(N);var ye=a(N,2),nt=l(ye);{var je=oe=>{var V=Tt();D(()=>k(V,`${E(e($)),i(()=>e($).school)??""} cantrip`)),o(oe,V)},Z=oe=>{var V=Tt();D(()=>k(V,`Level ${E(e($)),i(()=>e($).level)??""} ${E(e($)),i(()=>e($).school)??""}`)),o(oe,V)};m(nt,oe=>{E(e($)),i(()=>e($).level===0)?oe(je):oe(Z,!1)})}var d=a(nt,2);{var at=oe=>{var V=Tt("(ritual)");o(oe,V)};m(d,oe=>{E(e($)),i(()=>e($).ritual)&&oe(at)})}s(ye);var Ce=a(ye,2),G=a(l(Ce));s(Ce);var De=a(Ce,2),de=l(De),Ve=a(l(de));s(de);var Oe=a(de,2),et=a(l(Oe));s(Oe);var Ue=a(Oe,2),Je=a(l(Ue)),mt=a(Je);{var Y=oe=>{var V=Tt();D(()=>k(V,`(${E(e($)),i(()=>e($).material)??""})`)),o(oe,V)};m(mt,oe=>{E(e($)),i(()=>e($).material)&&oe(Y)})}s(Ue);var Ye=a(Ue,2),gt=a(l(Ye),2);{var b=oe=>{var V=Tt("Concentration,");o(oe,V)};m(gt,oe=>{E(e($)),i(()=>e($).concentration)&&oe(b)})}var P=a(gt,1,!0);s(Ye),s(De);var ie=a(De,2),ne=l(ie,!0);s(ie);var ve=a(ie,2);{var Re=oe=>{var V=Wn(),ot=a(l(V));s(V),D(()=>k(ot,` ${E(e($)),i(()=>e($).higherLevelSlot)??""}`)),o(oe,V)};m(ve,oe=>{E(e($)),i(()=>e($).higherLevelSlot)&&oe(Re)})}var ze=a(ve,2);{var Ne=oe=>{var V=zn(),ot=a(l(V));s(V),D(()=>k(ot,` ${E(e($)),i(()=>e($).cantripUpgrade)??""}`)),o(oe,V)};m(ze,oe=>{E(e($)),i(()=>e($).cantripUpgrade)&&oe(Ne)})}D((oe,V)=>{k(Be,(E(e($)),i(()=>e($).name))),k(G,` ${oe??""}`),k(Ve,` ${E(e($)),i(()=>e($).castingTime||e($).actionType)??""}`),k(et,` ${E(e($)),i(()=>e($).range)??""}`),k(Je,` ${V??""}`),k(P,(E(e($)),i(()=>e($).duration))),k(ne,(E(e($)),i(()=>e($).description)))},[()=>(E(e($)),i(()=>e($).classes.join(", "))),()=>(E(e($)),i(()=>e($).components.join(", ").toUpperCase()))]),o(Pe,X)},Ge=Pe=>{const $=xt(()=>e(ae));var X=Jn(),N=Ae(X),Be=l(N,!0);s(N);var ye=a(N,2);{var nt=at=>{var Ce=Vn(),G=a(l(Ce));s(Ce),D(()=>k(G,` ${E(e($)),i(()=>e($).prerequisite)??""}`)),o(at,Ce)};m(ye,at=>{E(e($)),i(()=>e($).prerequisite)&&at(nt)})}var je=a(ye,2),Z=l(je,!0);s(je);var d=a(je,2);D(()=>{k(Be,(E(e($)),i(()=>e($).name))),k(Z,(E(e($)),i(()=>e($).description))),vt(d,"href",(E(e($)),i(()=>e($).source)))}),o(Pe,X)};m(He,Pe=>{e(g)==="spell"?Pe(Fe):Pe(Ge,!1)})}s(me),o(K,me)};m(A,K=>{e(ae)&&K(H)})}s(yt),D(()=>{ke=Et($e,1,"tab svelte-1ngjemu",null,ke,{active:e(g)==="spell"}),k(be,`üìú Spells (${e(q),i(()=>e(q).length)??""})`),we=Et(pe,1,"tab svelte-1ngjemu",null,we,{active:e(g)==="feat"}),k(y,`‚≠ê Feats (${e(I),i(()=>e(I).length)??""})`)}),B("click",$e,()=>{n(g,"spell"),n(ae,null),n(h,"")}),B("click",pe,()=>{n(g,"feat"),n(ae,null),n(h,"")}),We(Te,()=>e(h),K=>n(h,K)),o(x,J)};m(re,x=>{e(w)?x(_e):x(Ie,!1)})}s(ce);var Qe=a(ce,2),T=l(Qe),M=a(T,2);s(Qe),s(le),s(F),D(()=>M.disabled=!e(ae)),B("click",qe,function(...x){p()?.apply(this,x)}),B("click",T,function(...x){p()?.apply(this,x)}),B("click",M,R),B("click",le,xs(function(x){Ma.call(this,c,x)})),B("keydown",le,function(x){Ma.call(this,c,x)}),B("click",F,function(...x){p()?.apply(this,x)}),B("keydown",F,x=>x.key==="Escape"&&p()()),o(r,F),Xt()}var eo=u('<span class="resistance-tag svelte-gdwwx1"> <button type="button" class="tag-remove svelte-gdwwx1">√ó</button></span>'),to=u('<div class="resistance-list svelte-gdwwx1"></div>'),ao=u('<p class="ability-meta svelte-gdwwx1"> <!></p>'),so=u('<p class="ability-meta svelte-gdwwx1">Requires Reaction</p>'),lo=u('<div class="ability-card svelte-gdwwx1"><div class="ability-header svelte-gdwwx1"><strong class="svelte-gdwwx1"> </strong> <button type="button" class="ability-remove svelte-gdwwx1">√ó</button></div> <p class="ability-description svelte-gdwwx1"> </p> <!></div>'),ro=u('<div class="abilities-list svelte-gdwwx1"></div>'),io=u(`<div class="modal-backdrop svelte-gdwwx1" role="presentation"><div class="modal-content svelte-gdwwx1" role="dialog" aria-modal="true" aria-labelledby="modal-title"><div class="modal-header svelte-gdwwx1"><h3 id="modal-title" class="svelte-gdwwx1">Add Custom Condition</h3> <button class="btn-close svelte-gdwwx1" aria-label="Close">√ó</button></div> <div class="modal-body svelte-gdwwx1"><div class="form-group svelte-gdwwx1"><label for="conditionName" class="svelte-gdwwx1">Condition Name*</label> <input type="text" id="conditionName" placeholder="e.g., Cazna's Mark" class="svelte-gdwwx1"/></div> <div class="form-group svelte-gdwwx1"><label for="description" class="svelte-gdwwx1">Description</label> <textarea id="description" placeholder="Describe the condition..." rows="3" class="svelte-gdwwx1"></textarea></div> <div class="form-row svelte-gdwwx1"><div class="form-group svelte-gdwwx1"><label for="attackBonus" class="svelte-gdwwx1">Attack Bonus</label> <input type="text" id="attackBonus" placeholder="0 or 1d4" class="svelte-gdwwx1"/></div> <div class="form-group svelte-gdwwx1"><label for="damageBonus" class="svelte-gdwwx1">Damage Bonus</label> <input type="text" id="damageBonus" placeholder="0 or 1d6" class="svelte-gdwwx1"/></div> <div class="form-group svelte-gdwwx1"><label for="acBonus" class="svelte-gdwwx1">AC Bonus</label> <input type="number" id="acBonus" placeholder="0" class="svelte-gdwwx1"/></div></div> <div class="form-group svelte-gdwwx1"><label for="darkvision" class="svelte-gdwwx1">Darkvision (feet)</label> <input type="number" id="darkvision" placeholder="0" min="0" step="30" class="svelte-gdwwx1"/> <small class="help-text svelte-gdwwx1">Grant or extend darkvision (e.g., 60 for 60 feet)</small></div> <div class="form-group svelte-gdwwx1"><label class="svelte-gdwwx1">Damage Resistances</label> <div class="resistance-input-group svelte-gdwwx1"><input type="text" placeholder="e.g., cold, fire, poison" class="svelte-gdwwx1"/> <button type="button" class="btn-add svelte-gdwwx1">Add</button></div> <!></div> <div class="form-group svelte-gdwwx1"><label class="svelte-gdwwx1">Special Abilities</label> <div class="ability-form svelte-gdwwx1"><input type="text" placeholder="Ability name (e.g., Flicker of Deceit)" class="ability-name-input svelte-gdwwx1"/> <textarea placeholder="Ability description..." rows="2" class="ability-desc-input svelte-gdwwx1"></textarea> <div class="ability-options svelte-gdwwx1"><div class="ability-option svelte-gdwwx1"><label for="abilityUses" class="svelte-gdwwx1">Uses per rest</label> <input type="number" id="abilityUses" min="0" class="svelte-gdwwx1"/></div> <div class="ability-option svelte-gdwwx1"><label for="restType" class="svelte-gdwwx1">Rest type</label> <select id="restType" class="svelte-gdwwx1"><option>Short</option><option>Long</option></select></div> <div class="ability-option svelte-gdwwx1"><label class="svelte-gdwwx1"><input type="checkbox" class="svelte-gdwwx1"/> Requires Reaction</label></div></div> <button type="button" class="btn-add svelte-gdwwx1">Add Ability</button></div> <!></div></div> <div class="modal-footer svelte-gdwwx1"><button class="btn btn-secondary svelte-gdwwx1">Cancel</button> <button class="btn btn-primary svelte-gdwwx1">Add Condition</button></div></div></div>`);function no(r,c){Qt(c,!1);let t=Bt(c,"show",8,!1),v=Bt(c,"onSave",8),f=Bt(c,"onCancel",8),p=C(""),g=C(""),w=C(0),h=C(0),_=C(0),q=C(0),I=C([]),ae=C(""),Q=C([]),se=C(""),U=C(""),R=C(0),F=C("short"),le=C(!1);function he(){n(p,""),n(g,""),n(w,0),n(h,0),n(_,0),n(q,0),n(I,[]),n(ae,""),n(Q,[]),n(se,""),n(U,""),n(R,0),n(F,"short"),n(le,!1)}function qe(){e(ae).trim()&&(n(I,[...e(I),e(ae).trim()]),n(ae,""))}function ce(W){n(I,e(I).filter((ge,$e)=>$e!==W))}function re(){if(e(se).trim()&&e(U).trim()){const W={name:e(se).trim(),description:e(U).trim(),requiresReaction:e(le)};e(R)>0&&(W.usesPerRest=e(R),W.currentUses=e(R),W.restType=e(F)),n(Q,[...e(Q),W]),n(se,""),n(U,""),n(R,0),n(F,"short"),n(le,!1)}}function _e(W){n(Q,e(Q).filter((ge,$e)=>$e!==W))}function Ie(){if(!e(p).trim()){alert("Please enter a condition name");return}const W={name:e(p).trim(),description:e(g).trim()||"Custom condition",attackBonus:e(w)||0,damageBonus:e(h)||0,target:"self"};e(_)!==0&&(W.acBonus=e(_)),e(q)>0&&(W.darkvision=e(q)),e(I).length>0&&(W.resistances=e(I)),e(Q).length>0&&(W.abilities=e(Q)),v()(W),he()}function Qe(){he(),f()()}function T(W){W.target===W.currentTarget&&Qe()}Yt();var M=kt(),x=Ae(M);{var J=W=>{var ge=io(),$e=l(ge),ke=l($e),be=a(l(ke),2);s(ke);var pe=a(ke,2),we=l(pe),y=a(l(we),2);Se(y),s(we);var O=a(we,2),Te=a(l(O),2);ja(Te),s(O);var ft=a(O,2),ut=l(ft),yt=a(l(ut),2);Se(yt),s(ut);var Ct=a(ut,2),Dt=a(l(Ct),2);Se(Dt),s(Ct);var S=a(Ct,2),z=a(l(S),2);Se(z),s(S),s(ft);var A=a(ft,2),H=a(l(A),2);Se(H),sa(2),s(A);var K=a(A,2),me=a(l(K),2),He=l(me);Se(He);var Fe=a(He,2);s(me);var Ge=a(me,2);{var Pe=Y=>{var Ye=to();Lt(Ye,5,()=>e(I),Rt,(gt,b,P)=>{var ie=eo(),ne=l(ie),ve=a(ne);s(ie),D(()=>{k(ne,`${e(b)??""} `),vt(ve,"aria-label",`Remove ${e(b)??""}`)}),B("click",ve,()=>ce(P)),o(gt,ie)}),s(Ye),o(Y,Ye)};m(Ge,Y=>{e(I),i(()=>e(I).length>0)&&Y(Pe)})}s(K);var $=a(K,2),X=a(l($),2),N=l(X);Se(N);var Be=a(N,2);ja(Be);var ye=a(Be,2),nt=l(ye),je=a(l(nt),2);Se(je),s(nt);var Z=a(nt,2),d=a(l(Z),2);D(()=>{e(F),Kt(()=>{})});var at=l(d);at.value=at.__value="short";var Ce=a(at);Ce.value=Ce.__value="long",s(d),s(Z);var G=a(Z,2),De=l(G),de=l(De);Se(de),sa(),s(De),s(G),s(ye);var Ve=a(ye,2);s(X);var Oe=a(X,2);{var et=Y=>{var Ye=ro();Lt(Ye,5,()=>e(Q),Rt,(gt,b,P)=>{var ie=lo(),ne=l(ie),ve=l(ne),Re=l(ve,!0);s(ve);var ze=a(ve,2);s(ne);var Ne=a(ne,2),oe=l(Ne,!0);s(Ne);var V=a(Ne,2);{var ot=ee=>{var ue=ao(),Xe=l(ue),wt=a(Xe);{var it=te=>{var Gt=Tt("‚Ä¢ Requires Reaction");o(te,Gt)};m(wt,te=>{e(b),i(()=>e(b).requiresReaction)&&te(it)})}s(ue),D(()=>k(Xe,`${e(b),i(()=>e(b).usesPerRest)??""} use${e(b),i(()=>e(b).usesPerRest>1?"s":"")??""} per ${e(b),i(()=>e(b).restType)??""}
                      rest `)),o(ee,ue)},xe=ee=>{var ue=kt(),Xe=Ae(ue);{var wt=it=>{var te=so();o(it,te)};m(Xe,it=>{e(b),i(()=>e(b).requiresReaction)&&it(wt)},!0)}o(ee,ue)};m(V,ee=>{e(b),i(()=>e(b).usesPerRest)?ee(ot):ee(xe,!1)})}s(ie),D(()=>{k(Re,(e(b),i(()=>e(b).name))),vt(ze,"aria-label",`Remove ${e(b),i(()=>e(b).name)??""}`),k(oe,(e(b),i(()=>e(b).description)))}),B("click",ze,()=>_e(P)),o(gt,ie)}),s(Ye),o(Y,Ye)};m(Oe,Y=>{e(Q),i(()=>e(Q).length>0)&&Y(et)})}s($),s(pe);var Ue=a(pe,2),Je=l(Ue),mt=a(Je,2);s(Ue),s($e),s(ge),B("click",be,Qe),We(y,()=>e(p),Y=>n(p,Y)),We(Te,()=>e(g),Y=>n(g,Y)),We(yt,()=>e(w),Y=>n(w,Y)),We(Dt,()=>e(h),Y=>n(h,Y)),We(z,()=>e(_),Y=>n(_,Y)),We(H,()=>e(q),Y=>n(q,Y)),We(He,()=>e(ae),Y=>n(ae,Y)),B("keydown",He,Y=>Y.key==="Enter"&&qe()),B("click",Fe,qe),We(N,()=>e(se),Y=>n(se,Y)),We(Be,()=>e(U),Y=>n(U,Y)),We(je,()=>e(R),Y=>n(R,Y)),Na(d,()=>e(F),Y=>n(F,Y)),Aa(de,()=>e(le),Y=>n(le,Y)),B("click",Ve,re),B("click",Je,Qe),B("click",mt,Ie),B("click",ge,T),o(W,ge)};m(x,W=>{t()&&W(J)})}o(r,M),Xt()}var oo=u("<option></option>"),co=u("<button> </button>"),vo=u('<div class="adjustment-msg svelte-uvfntf"> </div>'),uo=u('<div class="calculation-result svelte-uvfntf"><div class="result-header svelte-uvfntf"><h4 class="svelte-uvfntf">Damage Calculation</h4></div> <div class="result-content svelte-uvfntf"><div class="damage-breakdown svelte-uvfntf"><div class="damage-row svelte-uvfntf"><span class="label svelte-uvfntf">Original Damage:</span> <span class="value svelte-uvfntf"> </span></div> <div class="adjustments svelte-uvfntf"></div> <div class="damage-row final svelte-uvfntf"><span class="label svelte-uvfntf">Final Damage:</span> <span class="value damage-value svelte-uvfntf"> </span></div></div></div> <div class="result-actions svelte-uvfntf"><button class="btn btn-primary apply-btn use-enabled svelte-uvfntf">Apply Damage</button> <button class="btn btn-secondary cancel-btn use-enabled svelte-uvfntf">Cancel</button></div></div>'),fo=u('<div class="damage-form svelte-uvfntf"><div class="input-group svelte-uvfntf"><div class="input-field svelte-uvfntf"><label for="damageAmount" class="svelte-uvfntf">Damage Amount</label> <input type="number" id="damageAmount" min="0" placeholder="0" class="damage-input-field use-enabled svelte-uvfntf"/></div> <div class="input-field svelte-uvfntf"><label for="damageType" class="svelte-uvfntf">Damage Type</label> <input type="text" id="damageType" list="damageTypes" placeholder="e.g., fire, cold" class="damage-input-field use-enabled svelte-uvfntf"/> <datalist id="damageTypes"></datalist></div></div> <div class="quick-types svelte-uvfntf"><span class="quick-types-label svelte-uvfntf">Quick Select:</span> <!></div> <!></div>'),po=u("<section><!> <!></section>");function mo(r,c){Qt(c,!1);const t=()=>_t(fe,"$character",p),v=()=>_t(xa,"$searchFilter",p),f=()=>_t(la,"$collapsedStates",p),[p,g]=fa(),w=C();$a();let h=C(0),_=C(""),q=C(0),I=C([]);const ae=["slashing","piercing","bludgeoning","fire","cold","lightning","thunder","acid","poison","necrotic","radiant","psychic","force"],Q={slashing:"üó°Ô∏è",piercing:"üèπ",bludgeoning:"üî®",fire:"üî•",cold:"‚ùÑÔ∏è",lightning:"‚ö°",thunder:"üí•",acid:"üß™",poison:"‚ò†Ô∏è",necrotic:"üíÄ",radiant:"‚ú®",psychic:"üß†",force:"üå™Ô∏è"};function se(){fe.update(ce=>zl(ce,e(q))),Ht.add(`Applied ${e(q)} damage to character (${e(_)})`,"info"),n(h,0),n(_,""),n(q,0),n(I,[])}function U(){n(h,0),n(_,""),n(q,0),n(I,[])}Ze(()=>(e(h),e(_),t()),()=>{if(e(h)>=0&&e(_).trim()){const ce=Wl(e(h),e(_),t());n(q,ce.finalDamage),n(I,ce.adjustments)}else n(q,0),n(I,[])}),Ze(()=>v(),()=>{n(w,!v()||"damage".includes(v().toLowerCase())||"resistance".includes(v().toLowerCase())||"immune".includes(v().toLowerCase()))}),ga(),Yt();var R=po();let F;var le=l(R);{let ce=xt(()=>(f(),i(()=>f().damageInput?"Expand":"Collapse")));Ca(le,{title:"Apply Damage",get collapsed(){return f(),i(()=>f().damageInput)},get ariaLabel(){return e(ce)},onToggle:()=>la.update(re=>({...re,damageInput:!re.damageInput}))})}var he=a(le,2);{var qe=ce=>{var re=fo(),_e=l(re),Ie=l(_e),Qe=a(l(Ie),2);Se(Qe),s(Ie);var T=a(Ie,2),M=a(l(T),2);Se(M);var x=a(M,2);Lt(x,5,()=>ae,Rt,(ke,be)=>{var pe=oo(),we={};D(()=>{we!==(we=e(be))&&(pe.value=(pe.__value=e(be))??"")}),o(ke,pe)}),s(x),s(T),s(_e);var J=a(_e,2),W=a(l(J),2);Lt(W,1,()=>ae,Rt,(ke,be)=>{var pe=co();let we;var y=l(pe);s(pe),D(()=>{we=Et(pe,1,"quick-type-btn use-enabled svelte-uvfntf",null,we,{active:e(_)===e(be)}),k(y,`${e(be),i(()=>Q[e(be)])??""} ${e(be)??""}`)}),B("click",pe,()=>n(_,e(be))),o(ke,pe)}),s(J);var ge=a(J,2);{var $e=ke=>{var be=uo(),pe=a(l(be),2),we=l(pe),y=l(we),O=a(l(y),2),Te=l(O);s(O),s(y);var ft=a(y,2);Lt(ft,5,()=>e(I),Rt,(A,H)=>{var K=vo(),me=l(K,!0);s(K),D(()=>k(me,e(H))),o(A,K)}),s(ft);var ut=a(ft,2),yt=a(l(ut),2),Ct=l(yt,!0);s(yt),s(ut),s(we),s(pe);var Dt=a(pe,2),S=l(Dt),z=a(S,2);s(Dt),s(be),D(()=>{k(Te,`${e(h)??""} ${e(_),i(()=>Q[e(_)]||"")??""} ${e(_)??""}`),k(Ct,e(q))}),B("click",S,se),B("click",z,U),o(ke,be)};m(ge,ke=>{e(h),e(_),i(()=>e(h)>=0&&e(_).trim())&&ke($e)})}s(re),We(Qe,()=>e(h),ke=>n(h,ke)),We(M,()=>e(_),ke=>n(_,ke)),o(ce,re)};m(he,ce=>{f(),i(()=>!f().damageInput)&&ce(qe)})}s(R),D(()=>F=Et(R,1,"damage-input svelte-uvfntf",null,F,{hidden:!e(w)})),o(r,R),Xt(),g()}var go=u('<link rel="icon" type="image/png" href="favicon4.png"/> <meta name="viewport" content="width=device-width, initial-scale=1"/>',1),bo=u('<span class="character-name svelte-1uha8ag"> </span>'),ho=u("<span> </span>"),_o=u('<div class="spell-slots-header svelte-1uha8ag"></div>'),yo=u("<span> </span><br/>",1),xo=u("<span> </span><br/>",1),$o=u("<span> </span><br/>",1),ko=u("<span> </span><br/>",1),wo=u("<span> </span><br/>",1),So=u("<span> </span><br/>",1),Co=u("<br/><em> <!>)</em>",1),Do=u("<br/><em>(requires reaction)</em>",1),Lo=u('<div class="ability-detail"><strong> </strong> <!></div>'),Ao=u('<div class="abilities-section"><strong>Abilities:</strong><br/> <!></div>'),jo=u('<span class="effect-tooltip"><strong> </strong><br/> <br/> <!> <!> <!> <!> <!> <!> <!></span>'),Bo=u('<button class="effect-remove-btn svelte-1uha8ag">√ó</button>'),Ro=u('<span class="effect-badge svelte-1uha8ag" tabindex="0"> <!> <!></span>'),Mo=u(`<div class="active-effects-header svelte-1uha8ag"></div> <style>.effect-badge {
              position: relative;
            }
            .effect-tooltip {
              position: absolute;
              top: 120%;
              left: 50%;
              transform: translateX(-50%);
              background: #fff;
              color: #222;
              border: 1px solid #a5b4fc;
              border-radius: 6px;
              padding: 8px 12px;
              font-size: 0.95em;
              box-shadow: 0 2px 8px rgba(0, 0, 0, 0.12);
              z-index: 10;
              min-width: 180px;
              max-width: 300px;
              white-space: normal;
              pointer-events: none;
              opacity: 1;
              transition: opacity 0.15s;
            }

            .abilities-section {
              margin-top: 8px;
              padding-top: 8px;
              border-top: 1px solid #e5e7eb;
            }

            .ability-detail {
              margin-top: 6px;
              padding: 4px;
              background: #f9fafb;
              border-radius: 4px;
              font-size: 0.9em;
            }

            .ability-detail strong {
              color: #6366f1;
            }

            .ability-detail em {
              font-size: 0.85em;
              color: #6b7280;
            }</style>`,1),To=u('<div class="rest-menu svelte-1uha8ag"><button class="rest-option svelte-1uha8ag">‚òï Short Rest</button> <button class="rest-option svelte-1uha8ag">üõèÔ∏è Long Rest</button></div>'),Fo=u('<div class="container svelte-1uha8ag"><header class="svelte-1uha8ag"><div class="header-top svelte-1uha8ag"><div class="header-title svelte-1uha8ag"><div class="title-row svelte-1uha8ag"><h1 class="svelte-1uha8ag">D&D Character Sheet</h1> <!></div> <!> <!></div> <div class="header-right svelte-1uha8ag"><div class="header-controls svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">üé≤</span><span class="btn-text svelte-1uha8ag">Roll Dice</span></button> <div class="rest-button-container svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">üò¥</span><span class="btn-text svelte-1uha8ag">Rest</span></button> <!></div> <button class="btn btn-secondary use-enabled" title="Add custom condition with effects"><span class="btn-icon svelte-1uha8ag">‚ú®</span><span class="btn-text svelte-1uha8ag">Add Condition</span></button> <div class="mode-toggle"><button><span class="btn-icon svelte-1uha8ag"> </span><span class="btn-text svelte-1uha8ag"> </span></button> <button class="btn btn-mode svelte-1uha8ag" title="Toggle dark mode"><span class="btn-icon svelte-1uha8ag"> </span> <span class="btn-text svelte-1uha8ag"> </span></button></div></div> <div class="header-search svelte-1uha8ag"><input type="text" placeholder="üîç Search..." class="search-input use-enabled svelte-1uha8ag"/></div></div></div> <div class="header-actions svelte-1uha8ag"><button class="btn btn-mode svelte-1uha8ag">üìö Browse Spells & Feats</button> <button class="btn btn-secondary">Save to Gist</button> <button class="btn btn-secondary">Load from Gist</button> <button class="btn btn-secondary">Export JSON</button> <button class="btn btn-secondary">Import JSON</button> <input type="file" accept=".json" style="display: none;"/></div></header> <main class="svelte-1uha8ag"><!> <!> <!> <!> <!> <!> <!> <!></main></div> <!> <!> <!> <!> <!>',1);function qo(r,c){Qt(c,!1);const t=()=>_t(fe,"$character",p),v=()=>_t(wa,"$isEditMode",p),f=()=>_t(xa,"$searchFilter",p),[p,g]=fa();let w=C(!1);function h(j){n(w,j),j?document.body.classList.add("dark-mode"):document.body.classList.remove("dark-mode"),localStorage.setItem("dnd-dark-mode",j?"true":"false")}function _(){h(!e(w))}Sa(()=>{const j=localStorage.getItem("dnd-dark-mode");h(j==="true")});function q(){const j=[],Le=t().classFeatures.spellSlotsByLevel||{};for(let Ee=1;Ee<=9;Ee++){const bt=Le[Ee];if(bt&&bt.length>0){const L=bt.length,dt=bt.filter(st=>st).length;j.push({level:Ee,available:L-dt,total:L})}}return j}let I=C(!1),ae=C(!1),Q=C(!1),se=C(!1),U=C("save"),R=C(void 0),F=C(""),le=C(""),he=C(""),qe=C(!1),ce=C([]),re=C([]),_e=C("other"),Ie=C(),Qe=!1,T=1,M=C(!1),x=C(null);function J(j){n(x,j)}function W(){n(x,null)}function ge(j){n(x,e(x)===j?null:j)}function $e(j){fe.update(Le=>(Le.activeStates||(Le.activeStates=[]),Le.activeStates=[...Le.activeStates,j],Le)),n(se,!1),Ht.add(`Added condition: ${j.name}`,"success")}function ke(){n(se,!1)}function be(){const j=[];fe.update(L=>{const dt=L.hitDice.current;L.hitDice.current=Math.min(L.hitDice.max,L.hitDice.current+Math.max(1,Math.floor(L.hitDice.max/2)));const st=L.hitDice.current-dt;if(st>0&&j.push(`${st} hit ${st===1?"die":"dice"}`),L.class){const ht=Ta(L.class,L.level,L.subclass);L.classFeatures.features||(L.classFeatures.features={}),ht.forEach(tt=>{if(tt.resetOn==="short"){const lt=typeof tt.name=="function"?tt.name(L.level):tt.name,Ke=lt.replace(/\s+/g,"");if(tt.type==="uses"){const Ft=typeof tt.maxUses=="function"?tt.maxUses(L.level):tt.maxUses;L.classFeatures.features[Ke]=Array(Ft).fill(!1),j.push(lt)}else if(tt.type==="pool"){const Ft=typeof tt.maxPool=="function"?tt.maxPool(L.level):tt.maxPool;Ft!==void 0&&(L.classFeatures.features[Ke]=Ft,j.push(lt))}}})}return L.activeStates&&L.activeStates.forEach(ht=>{ht.abilities&&ht.abilities.forEach(tt=>{if(tt.restType==="short"&&tt.usesPerRest){const lt=tt.usesPerRest-(tt.currentUses||0)>0;tt.currentUses=tt.usesPerRest,lt&&j.push(`${ht.name}: ${tt.name}`)}})}),L}),Ss("short"),Cs(t().race,t().level).some(L=>L.restType==="short"&&L.usesPerRest)&&j.push("racial traits"),n(M,!1);const bt=j.length>0?`Short rest taken! Restored: ${j.join(", ")}`:"Short rest taken!";Ht.add(bt,"success")}function pe(){const j=[];fe.update(L=>{const dt=L.maxHP-L.currentHP;dt>0&&j.push(`${dt} HP`),L.currentHP=L.maxHP,L.tempHP=0;const st=L.hitDice.max-L.hitDice.current;st>0&&j.push(`${st} hit ${st===1?"die":"dice"}`),L.hitDice.current=L.hitDice.max;let ht=0;if(L.classFeatures.spellSlotsByLevel&&Object.keys(L.classFeatures.spellSlotsByLevel).forEach(tt=>{const lt=L.classFeatures.spellSlotsByLevel[parseInt(tt)];if(lt){const Ke=lt.filter(Ft=>Ft).length;ht+=Ke,L.classFeatures.spellSlotsByLevel[parseInt(tt)]=Array(lt.length).fill(!1)}}),ht>0&&j.push(`${ht} spell ${ht===1?"slot":"slots"}`),L.class){const tt=Ta(L.class,L.level,L.subclass);L.classFeatures.features||(L.classFeatures.features={});let lt=!1;tt.forEach(Ke=>{const Ut=(typeof Ke.name=="function"?Ke.name(L.level):Ke.name).replace(/\s+/g,"");if(!(Ke.type==="info"||Ke.type==="channelDivinity")){if(Ke.type==="uses"){const Mt=typeof Ke.maxUses=="function"?Ke.maxUses(L.level):Ke.maxUses;L.classFeatures.features[Ut]=Array(Mt).fill(!1),lt=!0}else if(Ke.type==="pool"){const Mt=typeof Ke.maxPool=="function"?Ke.maxPool(L.level):Ke.maxPool;Mt!==void 0&&(L.classFeatures.features[Ut]=Mt,lt=!0)}}}),lt&&j.push("all class features")}if(L.activeStates){let tt=!1;L.activeStates.forEach(lt=>{lt.abilities&&lt.abilities.forEach(Ke=>{if(Ke.usesPerRest){const Ft=(Ke.currentUses||0)<Ke.usesPerRest;Ke.currentUses=Ke.usesPerRest,Ft&&(tt=!0)}})}),tt&&j.push("condition abilities")}return L}),Ss("long"),Cs(t().race,t().level).some(L=>L.usesPerRest)&&j.push("racial traits"),n(M,!1);const bt=j.length>0?`Long rest taken! Restored: ${j.join(", ")}`:"Long rest taken! Fully rested.";Ht.add(bt,"success")}function we(j){n(F,""),n(le,""),n(he,""),n(qe,!1),n(ce,[]),n(re,[]),n(_e,"other"),Qe=!1,typeof j=="string"?n(F,j):(n(F,j.notation),n(le,j.damageNotation||""),n(he,j.attackName||""),n(qe,!!j.applyHalfDamage),n(ce,j.bonusBreakdown||[]),n(re,j.damageBreakdown||[]),n(_e,j.rollType||"other")),n(I,!0)}function y(j){const{notation:Le,count:Ee,bonusBreakdown:bt}=j.detail;n(F,""),Qe=!0,T=Ee||1,setTimeout(()=>{n(F,Le),n(le,""),n(he,"Hit Die"),n(ce,bt||[]),n(_e,"other")},0),n(I,!0)}function O(){if(n(I,!1),Qe&&e(Ie)){const j=e(Ie).getLastRollTotal();if(j!==null){const Le=Math.max(1,j);fe.update(Ee=>(Ee.hitDice.current=Math.max(0,Ee.hitDice.current-T),Ee.currentHP=Math.min(Ee.maxHP,Ee.currentHP+Le),Ee))}Qe=!1}}function Te(){wa.update(j=>!j)}function ft(j){j.target.closest(".rest-button-container")||n(M,!1)}Sa(()=>{const j=wa.subscribe(Le=>{Le?document.body.classList.remove("use-mode"):document.body.classList.add("use-mode")});return document.addEventListener("click",ft),()=>{j(),document.removeEventListener("click",ft)}});function ut(){bl(t())}function yt(){e(R)?.click()}async function Ct(j){const Ee=j.target.files?.[0];if(Ee)try{const bt=await hl(Ee);fe.set(bt),alert("Character imported successfully!")}catch{alert("Failed to import character file")}}Yt();var Dt=Fo();ml("1uha8ag",j=>{var Le=go();sa(2),Es(()=>{dl.title="D&D Character Sheet"}),o(j,Le)});var S=Ae(Dt),z=l(S),A=l(z),H=l(A),K=l(H),me=a(l(K),2);{var He=j=>{var Le=bo(),Ee=l(Le);s(Le),D(()=>k(Ee,`${t().name??""} (${t().level??""})`)),o(j,Le)};m(me,j=>{t().name&&j(He)})}s(K);var Fe=a(K,2);{var Ge=j=>{var Le=_o();Lt(Le,5,q,Rt,(Ee,bt)=>{var L=ho();let dt;var st=l(L);s(L),D(()=>{dt=Et(L,1,"slot-badge svelte-1uha8ag",null,dt,{depleted:e(bt).available===0}),k(st,`Lv${e(bt).level??""}: ${e(bt).available??""}/${e(bt).total??""}`)}),o(Ee,L)}),s(Le),o(j,Le)};m(Fe,j=>{q().length>0&&j(Ge)})}var Pe=a(Fe,2);{var $=j=>{var Le=Mo(),Ee=Ae(Le);Lt(Ee,5,()=>t().activeStates,Rt,(bt,L,dt)=>{var st=Ro(),ht=l(st),tt=a(ht);{var lt=Ut=>{var Mt=jo(),pt=l(Mt),rt=l(pt,!0);s(pt);var Pt=a(pt,2),qt=a(Pt,3);{var Zt=ct=>{var St=yo(),At=Ae(St),zt=l(At);s(At),sa(),D(()=>k(zt,`Attack Bonus: ${typeof e(L).attackBonus=="number"&&e(L).attackBonus>0?"+":""}${e(L).attackBonus??""}`)),o(ct,St)};m(qt,ct=>{e(L).attackBonus&&ct(Zt)})}var va=a(qt,2);{var pa=ct=>{var St=xo(),At=Ae(St),zt=l(At);s(At),sa(),D(()=>k(zt,`Damage Bonus: ${typeof e(L).damageBonus=="number"&&e(L).damageBonus>0?"+":""}${e(L).damageBonus??""}`)),o(ct,St)};m(va,ct=>{e(L).damageBonus&&ct(pa)})}var da=a(va,2);{var Vt=ct=>{var St=$o(),At=Ae(St),zt=l(At);s(At),sa(),D(()=>k(zt,`AC Bonus: ${e(L).acBonus>0?"+":""}${e(L).acBonus??""}`)),o(ct,St)};m(da,ct=>{e(L).acBonus&&ct(Vt)})}var ea=a(da,2);{var Jt=ct=>{var St=ko(),At=Ae(St),zt=l(At);s(At),sa(),D(()=>k(zt,`Darkvision: ${e(L).darkvision??""} feet`)),o(ct,St)};m(ea,ct=>{e(L).darkvision&&ct(Jt)})}var It=a(ea,2);{var na=ct=>{var St=wo(),At=Ae(St),zt=l(At);s(At),sa(),D(Nt=>k(zt,`Resistances: ${Nt??""}`),[()=>e(L).resistances.join(", ")]),o(ct,St)};m(It,ct=>{e(L).resistances&&e(L).resistances.length>0&&ct(na)})}var ma=a(It,2);{var ha=ct=>{var St=So(),At=Ae(St),zt=l(At);s(At),sa(),D(Nt=>k(zt,`Immunities: ${Nt??""}`),[()=>e(L).immunities.join(", ")]),o(ct,St)};m(ma,ct=>{e(L).immunities&&e(L).immunities.length>0&&ct(ha)})}var Wt=a(ma,2);{var ra=ct=>{var St=Ao(),At=a(l(St),3);Lt(At,1,()=>e(L).abilities,Rt,(zt,Nt)=>{var oa=Lo(),jt=l(oa),ia=l(jt);s(jt);var Da=a(jt),es=a(Da);{var ts=ca=>{var ba=Co(),Ba=a(Ae(ba)),Oa=l(Ba),Fa=a(Oa);{var ss=ls=>{var zs=Tt(", requires reaction");o(ls,zs)};m(Fa,ls=>{e(Nt).requiresReaction&&ls(ss)})}sa(),s(Ba),D(()=>k(Oa,`(${(e(Nt).currentUses||0)??""}/${e(Nt).usesPerRest??""} uses per ${e(Nt).restType??""}
                                rest`)),o(ca,ba)},as=ca=>{var ba=kt(),Ba=Ae(ba);{var Oa=Fa=>{var ss=Do();sa(),o(Fa,ss)};m(Ba,Fa=>{e(Nt).requiresReaction&&Fa(Oa)},!0)}o(ca,ba)};m(es,ca=>{e(Nt).usesPerRest?ca(ts):ca(as,!1)})}s(oa),D(()=>{k(ia,`${e(Nt).name??""}:`),k(Da,` ${e(Nt).description??""} `)}),o(zt,oa)}),s(St),o(ct,St)};m(Wt,ct=>{e(L).abilities&&e(L).abilities.length>0&&ct(ra)})}s(Mt),D(()=>{k(rt,e(L).name),k(Pt,` ${e(L).description??""}`)}),o(Ut,Mt)};m(tt,Ut=>{e(x)===dt&&Ut(lt)})}var Ke=a(tt,2);{var Ft=Ut=>{var Mt=Bo();D(()=>vt(Mt,"title",`End ${e(L).name??""}`)),B("click",Mt,()=>{fe.update(pt=>{if(pt.activeStates){const rt=pt.activeStates[dt];rt?.hpBonus&&rt.target!=="other"&&(pt.maxHP-=rt.hpBonus,pt.currentHP=Math.max(1,Math.min(pt.currentHP-rt.hpBonus,pt.maxHP))),pt.activeStates=pt.activeStates.filter((Pt,qt)=>qt!==dt)}return pt})}),o(Ut,Mt)};m(Ke,Ut=>{v()||Ut(Ft)})}s(st),D(()=>{vt(st,"aria-label",e(L).name),k(ht,`‚ú® ${e(L).name??""} `)}),B("mouseenter",st,()=>J(dt)),B("mouseleave",st,W),B("focus",st,()=>J(dt)),B("blur",st,W),B("click",st,()=>ge(dt)),o(bt,st)}),s(Ee),sa(2),o(j,Le)};m(Pe,j=>{t().activeStates&&t().activeStates.length>0&&j($)})}s(H);var X=a(H,2),N=l(X),Be=l(N),ye=a(Be,2),nt=l(ye),je=a(nt,2);{var Z=j=>{var Le=To(),Ee=l(Le),bt=a(Ee,2);s(Le),B("click",Ee,be),B("click",bt,pe),o(j,Le)};m(je,j=>{e(M)&&j(Z)})}s(ye);var d=a(ye,2),at=a(d,2),Ce=l(at);let G;var De=l(Ce),de=l(De,!0);s(De);var Ve=a(De),Oe=l(Ve,!0);s(Ve),s(Ce);var et=a(Ce,2),Ue=l(et),Je=l(Ue,!0);s(Ue);var mt=a(Ue,2),Y=l(mt,!0);s(mt),s(et),s(at),s(N);var Ye=a(N,2),gt=l(Ye);Se(gt),s(Ye),s(X),s(A);var b=a(A,2),P=l(b),ie=a(P,2),ne=a(ie,2),ve=a(ne,2),Re=a(ve,2),ze=a(Re,2);Ua(ze,j=>n(R,j),()=>e(R)),s(b),s(z);var Ne=a(z,2),oe=l(Ne);Pl(oe,{});var V=a(oe,2);Nl(V,{$$events:{roll:j=>we(j.detail)}});var ot=a(V,2);nr(ot,{$$events:{roll:j=>we(j.detail)}});var xe=a(ot,2);sr(xe,{$$events:{rollHitDice:y}});var ee=a(xe,2);mo(ee,{});var ue=a(ee,2);hi(ue,{$$events:{roll:j=>we(j.detail)}});var Xe=a(ue,2);Ki(Xe,{$$events:{roll:j=>we(j.detail)}});var wt=a(Xe,2);Yi(wt,{}),s(Ne),s(S);var it=a(S,2);Ua(bn(it,{get notation(){return e(F)},get damageNotation(){return e(le)},get attackName(){return e(he)},get applyHalfDamage(){return e(qe)},get bonusBreakdown(){return e(ce)},get damageBreakdown(){return e(re)},get rollType(){return e(_e)},get visible(){return e(I)},$$events:{close:O},$$legacy:!0}),j=>n(Ie,j),()=>e(Ie));var te=a(it,2);{var Gt=j=>{In(j,{get mode(){return e(U)},$$events:{close:()=>n(ae,!1)}})};m(te,j=>{e(ae)&&j(Gt)})}var Me=a(te,2);{var $t=j=>{Zn(j,{onClose:()=>n(Q,!1)})};m(Me,j=>{e(Q)&&j($t)})}var ta=a(Me,2);no(ta,{get show(){return e(se)},onSave:$e,onCancel:ke});var aa=a(ta,2);gl(aa,{}),D(()=>{G=Et(Ce,1,"btn btn-mode svelte-1uha8ag",null,G,{"use-mode":!v()}),k(de,v()?"üìù":"üé≤"),k(Oe,v()?"Edit Mode":"Use Mode"),k(Je,e(w)?"‚òÄÔ∏è":"üåô"),k(Y,e(w)?"Light Mode":"Dark Mode")}),B("click",Be,()=>{n(ce,[]),n(I,!0)}),B("click",nt,()=>n(M,!e(M))),B("click",d,()=>n(se,!0)),B("click",Ce,Te),B("click",et,_),We(gt,f,j=>_l(xa,j)),B("click",P,()=>n(Q,!0)),B("click",ie,()=>{n(U,"save"),n(ae,!0)}),B("click",ne,()=>{n(U,"load"),n(ae,!0)}),B("click",ve,ut),B("click",Re,yt),B("change",ze,Ct),o(r,Dt),Xt(),g()}export{qo as component};
