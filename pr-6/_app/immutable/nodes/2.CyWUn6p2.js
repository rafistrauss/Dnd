import{d as xs,g as Ws,f as u,e as B,a as o,s as C,c as yt,t as Pt}from"../chunks/BESELRjb.js";import{i as Jt}from"../chunks/JMgyEzd3.js";import{c as Sa,o as ka,a as Ks,b as Vs}from"../chunks/CtPH092J.js";import{F as L,T as ya,Y as us,j as Js,aZ as Ys,U as $s,ag as Qs,aD as Xs,aK as Zs,aE as el,a1 as tl,av as Ga,a7 as bs,i as Fs,a_ as al,a$ as Ps,b0 as Qa,K as $a,e as Is,b1 as Es,b2 as sl,b3 as ll,b4 as rl,q as fs,b5 as il,b6 as nl,ab as ol,d as i,r as hs,g as cl,C as Yt,G as Qt,H as l,I as s,J as a,b7 as Ye,b8 as ga,s as n,a4 as D,f as e,m as kt,E as Se,b9 as Wt,ao as sa,A as U,ba as _a,bb as ja,bc as vl}from"../chunks/DyJ43TGI.js";import{t as dl,c as la,a as ve,e as St,i as jt,u as Hs,s as xa,b as It,d as Xa,f as wa,g as Ja,j as ul,k as Ot,l as fl,m as ws,n as rs,h as pl,T as ml,o as gl,p as bl,r as ks,q as Ss}from"../chunks/Fq0DehG0.js";import{i as g,s as fa,a as bt,b as Nt,d as Fa,e as hl}from"../chunks/CCL4udNy.js";import{p as Lt,b as Ha}from"../chunks/iXw84bXb.js";import{b as Pa,r as _l}from"../chunks/Bglc5_bY.js";function yl(r,c,t=!1,v=!1,f=!1){var p=r,m="";L(()=>{var k=Js;if(m===(m=c()??"")){ya&&us();return}if(k.nodes_start!==null&&(Ys(k.nodes_start,k.nodes_end),k.nodes_start=k.nodes_end=null),m!==""){if(ya){$s.data;for(var y=us(),h=y;y!==null&&(y.nodeType!==Qs||y.data!=="");)h=y,y=Xs(y);if(y===null)throw Zs(),el;xs($s,h),p=tl(y);return}var z=m+"";t?z=`<svg>${z}</svg>`:v&&(z=`<math>${z}</math>`);var P=Ws(z);if((t||v)&&(P=Ga(P)),xs(Ga(P),P.lastChild),t||v)for(;Ga(P);)p.before(Ga(P));else p.before(P)}})}function xl(r,c,t,v,f){ya&&us();var p=c.$$slots?.[t],m=!1;p===!0&&(p=c[t],m=!0),p===void 0?f!==null&&f(r):p(r,m?()=>v:v)}function $l(r,c,t,v){var f=r.__style;if(ya||f!==c){var p=dl(c);(!ya||p!==r.getAttribute("style"))&&(p==null?r.removeAttribute("style"):r.style.cssText=p),r.__style=c}return v}function Ya(r,c,t=!1){if(r.multiple){if(c==null)return;if(!Fs(c))return al();for(var v of r.options)v.selected=c.includes(Ia(v));return}for(v of r.options){var f=Ia(v);if(Ps(f,c)){v.selected=!0;return}}(!t||c!==void 0)&&(r.selectedIndex=-1)}function ps(r){var c=new MutationObserver(()=>{Ya(r,r.__value)});c.observe(r,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),bs(()=>{c.disconnect()})}function Ua(r,c,t=c){var v=new WeakSet,f=!0;Qa(r,"change",p=>{var m=p?"[selected]":":checked",k;if(r.multiple)k=[].map.call(r.querySelectorAll(m),Ia);else{var y=r.querySelector(m)??r.querySelector("option:not([disabled])");k=y&&Ia(y)}t(k),$a!==null&&v.add($a)}),Is(()=>{var p=c();if(r===document.activeElement){var m=Es??$a;if(v.has(m))return}if(Ya(r,p,f),f&&p===void 0){var k=r.querySelector(":checked");k!==null&&(p=Ia(k),t(p))}r.__value=p,f=!1}),ps(r)}function Ia(r){return"__value"in r?r.__value:r.value}const wl=Symbol("is custom element"),kl=Symbol("is html");function Ce(r){if(ya){var c=!1,t=()=>{if(!c){if(c=!0,r.hasAttribute("value")){var v=r.value;it(r,"value",null),r.value=v}if(r.hasAttribute("checked")){var f=r.checked;it(r,"checked",null),r.checked=f}}};r.__on_r=t,fs(t),il()}}function Ea(r,c){var t=_s(r);t.value===(t.value=c??void 0)||r.value===c&&(c!==0||r.nodeName!=="PROGRESS")||(r.value=c??"")}function Us(r,c){var t=_s(r);t.checked!==(t.checked=c??void 0)&&(r.checked=c)}function it(r,c,t,v){var f=_s(r);ya&&(f[c]=r.getAttribute(c),c==="src"||c==="srcset"||c==="href"&&r.nodeName==="LINK")||f[c]!==(f[c]=t)&&(c==="loading"&&(r[sl]=t),t==null?r.removeAttribute(c):typeof t!="string"&&Sl(r).includes(c)?r[c]=t:r.setAttribute(c,t))}function _s(r){return r.__attributes??={[wl]:r.nodeName.includes("-"),[kl]:r.namespaceURI===ll}}var Cs=new Map;function Sl(r){var c=r.getAttribute("is")||r.nodeName,t=Cs.get(c);if(t)return t;Cs.set(c,t=[]);for(var v,f=r,p=Element.prototype;p!==f;){v=nl(f);for(var m in v)v[m].set&&t.push(m);f=rl(f)}return t}function Pe(r,c,t=c){var v=new WeakSet;Qa(r,"input",async f=>{var p=f?r.defaultValue:r.value;if(p=ns(r)?os(p):p,t(p),$a!==null&&v.add($a),await ol(),p!==(p=c())){var m=r.selectionStart,k=r.selectionEnd,y=r.value.length;if(r.value=p??"",k!==null){var h=r.value.length;m===k&&k===y&&h>y?(r.selectionStart=h,r.selectionEnd=h):(r.selectionStart=m,r.selectionEnd=Math.min(k,h))}}}),(ya&&r.defaultValue!==r.value||i(c)==null&&r.value)&&(t(ns(r)?os(r.value):r.value),$a!==null&&v.add($a)),hs(()=>{var f=c();if(r===document.activeElement){var p=Es??$a;if(v.has(p))return}ns(r)&&f===os(r.value)||r.type==="date"&&!f&&!r.value||f!==r.value&&(r.value=f??"")})}const is=new Set;function Ds(r,c,t,v,f=v){var p=t.getAttribute("type")==="checkbox",m=r;let k=!1;if(c!==null)for(var y of c)m=m[y]??=[];m.push(t),Qa(t,"change",()=>{var h=t.__value;p&&(h=Ls(m,h,t.checked)),f(h)},()=>f(p?[]:null)),hs(()=>{var h=v();if(ya&&t.defaultChecked!==t.checked){k=!0;return}p?(h=h||[],t.checked=h.includes(t.__value)):t.checked=Ps(t.__value,h)}),bs(()=>{var h=m.indexOf(t);h!==-1&&m.splice(h,1)}),is.has(m)||(is.add(m),fs(()=>{m.sort((h,z)=>h.compareDocumentPosition(z)===4?-1:1),is.delete(m)})),fs(()=>{if(k){var h;if(p)h=Ls(m,h,t.checked);else{var z=m.find(P=>P.checked);h=z?.__value}f(h)}})}function Aa(r,c,t=c){Qa(r,"change",v=>{var f=v?r.defaultChecked:r.checked;t(f)}),(ya&&r.defaultChecked!==r.checked||i(c)==null)&&t(r.checked),hs(()=>{var v=c();r.checked=!!v})}function Ls(r,c,t){for(var v=new Set,f=0;f<r.length;f+=1)r[f].checked&&v.add(r[f].__value);return t||v.delete(c),Array.from(v)}function ns(r){var c=r.type;return c==="number"||c==="range"}function os(r){return r===""?null:+r}function Cl(r,c,t){var v=cl(r,c);v&&v.set&&(r[c]=t,bs(()=>{r[c]=null}))}function ys(r){return function(...c){var t=c[0];return t.stopPropagation(),r?.apply(this,c)}}function Ra(r,c){var t=r.$$events?.[c.type],v=Fs(t)?t.slice():t==null?[]:[t];for(var f of v)f.call(this,c)}const Dl="";function Ns(...r){return Pa+Dl+_l(r[0],r[1])}const ms={paladin:{name:"Paladin",hitDice:"d10",spellcaster:!0,spellcastingAbility:"charisma",spellSlotsByLevel:{1:0,2:2,3:3,4:3,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Divine Sense",type:"uses",maxUses:(r,c=1)=>1+Math.max(1,c),resetOn:"long",description:"Detect celestials, fiends, and undead within 60 feet",minLevel:1},{name:"Lay on Hands",type:"pool",maxPool:r=>r*5,resetOn:"long",description:"Heal wounds or cure disease",minLevel:1},{name:"Divine Smite",type:"spellSlot",description:"Expend spell slot to deal extra radiant damage",minLevel:2,rollable:!0},{name:"Channel Divinity",type:"pool",maxPool:r=>r>=18?3:r>=6?2:1,resetOn:"short",description:"Sacred Weapon or Turn Undead",minLevel:3}]},fighter:{name:"Fighter",hitDice:"d10",spellcaster:!1,features:[{name:"Second Wind",type:"uses",maxUses:1,resetOn:"short",description:"Regain 1d10 + fighter level HP as bonus action",minLevel:1,rollable:!0,rollFormula:r=>`1d10+${r}`},{name:"Action Surge",type:"uses",maxUses:r=>r>=17?2:1,resetOn:"short",description:"Take one additional action on your turn",minLevel:2},{name:"Indomitable",type:"uses",maxUses:r=>r>=17?3:r>=13?2:1,resetOn:"long",description:"Reroll a failed saving throw",minLevel:9}],subclasses:{champion:{name:"Champion",features:[{name:"Improved Critical",type:"info",description:"Critical hit on 19-20",minLevel:3},{name:"Remarkable Athlete",type:"info",description:"Add half proficiency to STR/DEX/CON checks, increase long jump distance",minLevel:7},{name:"Additional Fighting Style",type:"info",description:"Choose a second fighting style",minLevel:10},{name:"Superior Critical",type:"info",description:"Critical hit on 18-20",minLevel:15},{name:"Survivor",type:"info",description:"Regain 5 + CON mod HP at start of turn if below half HP",minLevel:18}]},battlemaster:{name:"Battle Master",features:[{name:"Combat Superiority",type:"uses",maxUses:r=>r>=15?6:r>=7?5:4,resetOn:"short",description:r=>`Use superiority dice (${r>=18?"d12":r>=10?"d10":"d8"}) for maneuvers`,minLevel:3},{name:"Know Your Enemy",type:"info",description:"Learn capabilities of creatures you observe",minLevel:7},{name:"Improved Combat Superiority",type:"info",description:"Superiority dice become d10",minLevel:10},{name:"Relentless",type:"info",description:"Regain 1 superiority die if you have none at start of turn",minLevel:15}]}}},rogue:{name:"Rogue",hitDice:"d8",spellcaster:!1,features:[{name:"Sneak Attack",type:"info",description:r=>`Deal ${Math.ceil(r/2)}d6 extra damage once per turn with advantage or ally nearby`,minLevel:1,rollable:!0,rollFormula:r=>`${Math.ceil(r/2)}d6`},{name:"Cunning Action",type:"info",description:"Dash, Disengage, or Hide as a bonus action",minLevel:2},{name:"Uncanny Dodge",type:"info",description:"Use reaction to halve damage from an attack",minLevel:5},{name:"Evasion",type:"info",description:"Take no damage on successful Dex save (half on fail)",minLevel:7}]},wizard:{name:"Wizard",hitDice:"d6",spellcaster:!0,spellcastingAbility:"intelligence",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Arcane Recovery",type:"uses",maxUses:1,resetOn:"long",description:r=>`Recover spell slots totaling up to ${Math.ceil(r/2)} levels during short rest`,minLevel:1},{name:"Spell Mastery",type:"info",description:"Cast one 1st-level and one 2nd-level spell at will",minLevel:18}]},cleric:{name:"Cleric",hitDice:"d8",spellcaster:!0,spellcastingAbility:"wisdom",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Channel Divinity",type:"pool",maxPool:r=>r>=18?4:r>=6?3:2,resetOn:"short",description:"Turn Undead or domain-specific ability",minLevel:2},{name:"Destroy Undead",type:"info",description:r=>`Channel Divinity destroys undead of CR ${r>=17?4:r>=14?3:r>=11?2:r>=8?1:.5} or lower`,minLevel:5},{name:"Divine Intervention",type:"uses",maxUses:1,resetOn:"long",description:r=>`${r}% chance to succeed, implore deity for aid`,minLevel:10}],subclasses:{war:{name:"War Domain",features:[{name:"War Priest",type:"uses",maxUses:(r,c=1)=>Math.max(1,c),resetOn:"long",description:"Make one weapon attack as a bonus action",minLevel:1},{name:"Guided Strike",type:"channelDivinity",description:"Use your Channel Divinity to gain +10 to an attack roll. Make this choice after you see the roll, but before the DM says whether the attack hits or misses.",minLevel:2,resetOn:"short"},{name:"War God's Blessing",type:"channelDivinity",description:"Use reaction to grant +10 to an ally's attack roll within 30 feet. Consumes one use of Channel Divinity.",minLevel:6,resetOn:"short"},{name:"Divine Strike",type:"info",description:r=>`Deal extra ${r>=14?"2d8":"1d8"} weapon damage once per turn`,minLevel:8,rollable:!0,rollFormula:r=>r>=14?"2d8":"1d8"},{name:"Avatar of Battle",type:"info",description:"Gain resistance to nonmagical weapon damage",minLevel:17}]},life:{name:"Life Domain",features:[{name:"Disciple of Life",type:"info",description:"Healing spells restore additional 2 + spell level HP",minLevel:1},{name:"Preserve Life",type:"pool",maxPool:r=>r*5,resetOn:"short",description:"Restore HP to creatures within 30 feet",minLevel:2},{name:"Blessed Healer",type:"info",description:"Regain 2 + spell level HP when you cast healing spell",minLevel:6},{name:"Divine Strike",type:"info",description:r=>`Deal extra ${r>=14?"2d8":"1d8"} radiant damage once per turn`,minLevel:8,rollable:!0,rollFormula:r=>r>=14?"2d8":"1d8"},{name:"Supreme Healing",type:"info",description:"Maximize healing dice instead of rolling",minLevel:17}]}}},barbarian:{name:"Barbarian",hitDice:"d12",spellcaster:!1,features:[{name:"Rage",type:"uses",maxUses:r=>r>=20?1/0:r>=17?6:r>=12?5:r>=6?4:r>=3?3:2,resetOn:"long",description:r=>`+${r>=16?4:r>=9?3:2} damage, resistance to physical damage`,minLevel:1},{name:"Reckless Attack",type:"info",description:"Gain advantage on melee attacks, enemies get advantage on you",minLevel:2},{name:"Danger Sense",type:"info",description:"Advantage on Dex saves against effects you can see",minLevel:2}],subclasses:{berserker:{name:"Path of the Berserker",features:[{name:"Frenzy",type:"info",description:"While raging, make melee attack as bonus action (gain 1 exhaustion after rage)",minLevel:3},{name:"Mindless Rage",type:"info",description:"Cannot be charmed or frightened while raging",minLevel:6},{name:"Intimidating Presence",type:"info",description:"Use action to frighten creature within 30 feet",minLevel:10},{name:"Retaliation",type:"info",description:"When damaged by creature within 5 feet, make melee attack as reaction",minLevel:14}]}}}};function ua(r){const c=r.toLowerCase();return ms[c]||null}function Ma(r,c,t){const v=ua(r);if(!v)return[];const f=v.features.filter(p=>!p.minLevel||p.minLevel<=c);if(t&&v.subclasses&&v.subclasses[t]){const p=v.subclasses[t].features.filter(m=>!m.minLevel||m.minLevel<=c);return[...f,...p]}return f}function As(r){const c=ua(r);return!c||!c.subclasses?[]:Object.keys(c.subclasses).map(t=>({id:t,name:c.subclasses[t].name}))}function js(r,c){const t=ua(r);return!t||!t.spellcaster||!t.spellSlotsByLevel?0:t.spellSlotsByLevel[c]||0}function Bs(r,c,t){const v=ua(r);return!v||!v.spellcaster?0:Math.max(1,t+c)}function Ll(r,c,t){const v=ua(r);return!v||!v.spellcaster?null:8+c+t}function Al(){return Object.keys(ms).map(r=>({id:r,name:ms[r].name}))}var jl=u('<div class="section-header svelte-ls99y2" role="button" tabindex="0"><h2 class="svelte-ls99y2"> </h2> <span class="collapse-btn svelte-ls99y2"> </span></div>');function Ca(r,c){Yt(c,!1);let t=Lt(c,"title",8),v=Lt(c,"collapsed",8),f=Lt(c,"ariaLabel",8,""),p=Lt(c,"onToggle",8);Jt();var m=jl(),k=l(m),y=l(k,!0);s(k);var h=a(k,2),z=l(h,!0);s(h),s(m),L(()=>{it(m,"aria-expanded",!v()),it(m,"aria-label",f()),C(y,t()),C(z,v()?"‚ñº":"‚ñ≤")}),B("click",m,function(...P){p()?.apply(this,P)}),B("keydown",m,P=>{(P.key==="Enter"||P.key===" ")&&p()()}),o(r,m),Qt()}var Bl=u("<option> </option>"),Rl=u("<option> </option>"),Ml=u('<div class="form-group svelte-172i2fj"><label for="characterSubclass" class="svelte-172i2fj">Subclass</label> <select id="characterSubclass" class="svelte-172i2fj"><option>Select Subclass</option><!></select></div>'),Tl=u('<div class="info-grid svelte-172i2fj"><div class="form-group svelte-172i2fj"><label for="characterName" class="svelte-172i2fj">Character Name</label> <input type="text" id="characterName" placeholder="Enter name" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterClass" class="svelte-172i2fj">Class</label> <select id="characterClass" class="svelte-172i2fj"><option>Select Class</option><!></select></div> <!> <div class="form-group svelte-172i2fj"><label for="characterLevel" class="svelte-172i2fj">Level</label> <input type="number" id="characterLevel" min="1" max="20" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterRace" class="svelte-172i2fj">Race</label> <input type="text" id="characterRace" placeholder="e.g., Human" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterBackground" class="svelte-172i2fj">Background</label> <input type="text" id="characterBackground" placeholder="e.g., Soldier" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterAlignment" class="svelte-172i2fj">Alignment</label> <input type="text" id="characterAlignment" placeholder="e.g., Lawful Good" class="svelte-172i2fj"/></div></div>'),Fl=u('<section class="character-info svelte-172i2fj"><!> <!></section>');function Pl(r,c){Yt(c,!1);const t=()=>bt(ve,"$character",f),v=()=>bt(la,"$collapsedStates",f),[f,p]=fa(),m=D(),k=Al();function y(N){const R=N.target;ve.update(I=>(I.class=R.value,I.subclass="",I))}function h(N){const R=N.target;ve.update(I=>(I.subclass=R.value,I))}function z(N){const R=N.target;ve.update(I=>(I.level=parseInt(R.value)||1,I)),Hs()}Ye(()=>(t(),As),()=>{n(m,t().class?As(t().class):[])}),ga(),Jt();var P=Fl(),V=l(P);{let N=kt(()=>(v(),i(()=>v().characterInfo?"Expand":"Collapse")));Ca(V,{title:"Character Info",get collapsed(){return v(),i(()=>v().characterInfo)},get ariaLabel(){return e(N)},onToggle:()=>la.update(R=>({...R,characterInfo:!R.characterInfo}))})}var X=a(V,2);{var se=N=>{var R=Tl(),I=l(R),ee=a(l(I),2);Ce(ee),s(I);var pe=a(I,2),Ie=a(l(pe),2),re=l(Ie);re.value=re.__value="";var te=a(re);St(te,1,()=>k,jt,(ge,ce)=>{var de=Bl(),Xe=l(de,!0);s(de);var nt={};L(()=>{C(Xe,(e(ce),i(()=>e(ce).name))),nt!==(nt=(e(ce),i(()=>e(ce).id)))&&(de.value=(de.__value=(e(ce),i(()=>e(ce).id)))??"")}),o(ge,de)}),s(Ie);var ye;ps(Ie),s(pe);var Re=a(pe,2);{var Ee=ge=>{var ce=Ml(),de=a(l(ce),2),Xe=l(de);Xe.value=Xe.__value="";var nt=a(Xe);St(nt,1,()=>e(m),jt,(_t,mt)=>{var ot=Rl(),Bt=l(ot,!0);s(ot);var At={};L(()=>{C(Bt,(e(mt),i(()=>e(mt).name))),At!==(At=(e(mt),i(()=>e(mt).id)))&&(ot.value=(ot.__value=(e(mt),i(()=>e(mt).id)))??"")}),o(_t,ot)}),s(de);var pt;ps(de),s(ce),L(()=>{pt!==(pt=(t(),i(()=>t().subclass)))&&(de.value=(de.__value=(t(),i(()=>t().subclass)))??"",Ya(de,(t(),i(()=>t().subclass))))}),B("change",de,h),o(ge,ce)};g(Re,ge=>{e(m),i(()=>e(m).length>0)&&ge(Ee)})}var M=a(Re,2),T=a(l(M),2);Ce(T),s(M);var w=a(M,2),K=a(l(w),2);Ce(K),s(w);var b=a(w,2),F=a(l(b),2);Ce(F),s(b);var J=a(b,2),me=a(l(J),2);Ce(me),s(J),s(R),L(()=>{ye!==(ye=(t(),i(()=>t().class)))&&(Ie.value=(Ie.__value=(t(),i(()=>t().class)))??"",Ya(Ie,(t(),i(()=>t().class)))),Ea(T,(t(),i(()=>t().level)))}),Pe(ee,()=>t().name,ge=>Nt(ve,i(t).name=ge,i(t))),B("change",Ie,y),B("change",T,z),Pe(K,()=>t().race,ge=>Nt(ve,i(t).race=ge,i(t))),Pe(F,()=>t().background,ge=>Nt(ve,i(t).background=ge,i(t))),Pe(me,()=>t().alignment,ge=>Nt(ve,i(t).alignment=ge,i(t))),o(N,R)};g(X,N=>{v(),i(()=>!v().characterInfo)&&N(se)})}s(P),o(r,P),Qt(),p()}var Il=u('<div class="ability-card svelte-bbv1xt"><h3 class="svelte-bbv1xt"> </h3> <input type="number" class="ability-score svelte-bbv1xt" min="1" max="30"/> <div class="ability-modifier svelte-bbv1xt"> </div> <div class="roll-buttons svelte-bbv1xt"><button class="roll-btn svelte-bbv1xt">Check</button> <button class="roll-btn svelte-bbv1xt">Save</button></div> <div class="save-proficiency svelte-bbv1xt"><input type="checkbox" class="svelte-bbv1xt"/> <label class="svelte-bbv1xt">Save Prof.</label></div></div>'),El=u('<div class="proficiency-bonus svelte-bbv1xt"><label for="profBonus">Proficiency Bonus</label> <input type="number" id="profBonus" class="prof-input svelte-bbv1xt"/></div> <div class="abilities-grid svelte-bbv1xt"></div>',1),Hl=u("<section><!> <!></section>");function Ul(r,c){Yt(c,!1);const t=()=>bt(Xa,"$abilityModifiers",k),v=()=>bt(ve,"$character",k),f=()=>bt(xa,"$searchFilter",k),p=()=>bt(la,"$collapsedStates",k),m=()=>bt(wa,"$isEditMode",k),[k,y]=fa(),h=D(),z=D(),P=Sa(),V=[{key:"strength",label:"Strength"},{key:"dexterity",label:"Dexterity"},{key:"constitution",label:"Constitution"},{key:"intelligence",label:"Intelligence"},{key:"wisdom",label:"Wisdom"},{key:"charisma",label:"Charisma"}];function X(){Hs()}function se(re){const te=t()[re],ye=`1d20${te>=0?"+":""}${te}`,Re=[];Re.push({value:"1d20",source:"base die"}),te!==0&&Re.push({value:te,source:re}),P("roll",{notation:ye,rollType:"check",bonusBreakdown:Re})}function N(re){const te=t()[re],ye=v().saveProficiencies[re]?v().proficiencyBonus:0,Re=te+ye,Ee=`1d20${Re>=0?"+":""}${Re}`,M=[];M.push({value:"1d20",source:"base die"}),te!==0&&M.push({value:te,source:re}),ye!==0&&M.push({value:ye,source:"proficiency"}),P("roll",{notation:Ee,rollType:"save",bonusBreakdown:M})}Ye(()=>f(),()=>{n(h,V.filter(({label:re})=>f()?re.toLowerCase().includes(f().toLowerCase()):!0))}),Ye(()=>(e(h),f()),()=>{n(z,e(h).length>0||!f()||f().toLowerCase().includes("proficiency"))}),ga(),Jt();var R=Hl();let I;var ee=l(R);Ca(ee,{title:"Ability Scores",get collapsed(){return p(),i(()=>p().abilityScores)},ariaLabel:"Toggle Ability Scores Section",onToggle:()=>la.update(re=>({...re,abilityScores:!re.abilityScores}))});var pe=a(ee,2);{var Ie=re=>{var te=El(),ye=Se(te),Re=a(l(ye),2);Ce(Re),s(ye);var Ee=a(ye,2);St(Ee,5,()=>e(h),jt,(M,T)=>{let w=()=>e(T).key,K=()=>e(T).label;var b=Il(),F=l(b),J=l(F,!0);s(F);var me=a(F,2);Ce(me);var ge=a(me,2),ce=l(ge);s(ge);var de=a(ge,2),Xe=l(de),nt=a(Xe,2);s(de);var pt=a(de,2),_t=l(pt);Ce(_t);var mt=a(_t,2);s(pt),s(b),L(ot=>{C(J,ot),C(ce,`${t(),w(),i(()=>t()[w()]>=0?"+":"")??""}${t(),w(),i(()=>t()[w()])??""}`),_t.disabled=!m(),it(_t,"id",`${w()}-save`),it(mt,"for",`${w()}-save`)},[()=>(K(),i(()=>K().substring(0,3).toUpperCase()))]),Pe(me,()=>v().abilities[w()],ot=>Nt(ve,i(v).abilities[w()]=ot,i(v))),B("change",me,X),B("click",Xe,()=>se(w())),B("click",nt,()=>N(w())),Aa(_t,()=>v().saveProficiencies[w()],ot=>Nt(ve,i(v).saveProficiencies[w()]=ot,i(v))),o(M,b)}),s(Ee),Pe(Re,()=>v().proficiencyBonus,M=>Nt(ve,i(v).proficiencyBonus=M,i(v))),o(re,te)};g(pe,re=>{p(),i(()=>!p().abilityScores)&&re(Ie)})}s(R),L(()=>I=It(R,1,"ability-scores svelte-bbv1xt",null,I,{hidden:!e(z)})),o(r,R),Qt(),y()}const Os=[{name:"Unarmored",type:"none",baseAC:10},{name:"Padded",type:"light",baseAC:11},{name:"Leather",type:"light",baseAC:11},{name:"Studded Leather",type:"light",baseAC:12},{name:"Hide",type:"medium",baseAC:12,maxDexBonus:2},{name:"Chain Shirt",type:"medium",baseAC:13,maxDexBonus:2},{name:"Scale Mail",type:"medium",baseAC:14,maxDexBonus:2},{name:"Breastplate",type:"medium",baseAC:14,maxDexBonus:2},{name:"Half Plate",type:"medium",baseAC:15,maxDexBonus:2},{name:"Ring Mail",type:"heavy",baseAC:14,maxDexBonus:0},{name:"Chain Mail",type:"heavy",baseAC:16,maxDexBonus:0},{name:"Splint",type:"heavy",baseAC:17,maxDexBonus:0},{name:"Plate",type:"heavy",baseAC:18,maxDexBonus:0}];function Gs(r){return Os.find(c=>c.name===r)}function Nl(r,c,t){if(!r)return 10+c+(t?2:0);const v=Gs(r);if(!v)return 10+c+(t?2:0);let f=v.baseAC;return v.maxDexBonus===void 0?f+=c:v.maxDexBonus>0&&(f+=Math.min(c,v.maxDexBonus)),t&&(f+=2),f}function Na(r){return Math.floor((r-10)/2)}function gs(r,c){if(!r.class)return null;const t=ua(r.class);if(!t||!t.spellcaster||!t.spellcastingAbility)return null;const v=Na(c[t.spellcastingAbility]);return 8+r.proficiencyBonus+v}function cs(r,c){if(!r.class)return 0;const t=ua(r.class);return!t||!t.spellcaster||!t.spellcastingAbility?0:Na(c[t.spellcastingAbility])}function Ol(r,c){const t=[],v=Na(c.dexterity),f=r.armorName?Gs(r.armorName):void 0;if(f){if(f.type==="none")t.push("Unarmored"),t.push("Base: 10"),t.push(`Dexterity: ${v>=0?"+":""}${v}`);else if(f.type==="light")t.push(`${f.name}: ${f.baseAC}`),t.push(`Dexterity: ${v>=0?"+":""}${v}`);else if(f.type==="medium"){const p=Math.min(2,v);t.push(`${f.name}: ${f.baseAC}`),t.push(`Dexterity: ${p>=0?"+":""}${p} (max +2)`)}else f.type==="heavy"&&(t.push(`${f.name}: ${f.baseAC}`),t.push("Dexterity: +0 (heavy armor)"));r.shieldEquipped&&t.push("Shield: +2")}else{t.push("Base: 10"),v!==0&&t.push(`Dexterity: ${v>=0?"+":""}${v}`);const p=10+v,m=r.armorClass-p;m!==0&&t.push(`Other: ${m>=0?"+":""}${m}`)}return r.activeStates&&r.activeStates.length>0&&r.activeStates.forEach(p=>{typeof p.acBonus=="number"&&p.acBonus!==0&&(!p.target||p.target==="self")&&t.push(`${p.name}: ${p.acBonus>=0?"+":""}${p.acBonus}`)}),t.join(`
`)}function Gl(r,c){const t=[],v=Na(c.dexterity);t.push(`Dexterity: ${v>=0?"+":""}${v}`);const f=r.initiative-v;return f!==0&&t.push(`Other Bonuses: ${f>=0?"+":""}${f}`),t.join(`
`)}function ql(r,c){if(!r.class)return"";const t=ua(r.class);if(!t||!t.spellcaster||!t.spellcastingAbility)return"";const v=[],f=Na(c[t.spellcastingAbility]),p=t.spellcastingAbility.charAt(0).toUpperCase()+t.spellcastingAbility.slice(1);return v.push("Base: 8"),v.push(`Proficiency: +${r.proficiencyBonus}`),v.push(`${p}: ${f>=0?"+":""}${f}`),v.join(`
`)}function zl(r,c,t){const v=[];let f=r;const p=c.toLowerCase().trim();if(t.activeStates){for(const k of t.activeStates)if(k.immunities&&k.immunities.length>0&&k.immunities.some(h=>h.toLowerCase().trim()===p))return v.push(`Immune to ${c} (${k.name})`),{finalDamage:0,adjustments:v}}let m=!1;if(t.activeStates){for(const k of t.activeStates)if(k.resistances&&k.resistances.length>0&&k.resistances.some(h=>h.toLowerCase().trim()===p)){const h=Math.floor(f/2);v.push(`Resistant to ${c} (${k.name}): ${f} ‚Üí ${h}`),f=h,m=!0;break}}if(!m&&t.race){const k=Ja(t.race);if(k){for(const y of k.traits)if(y.resistances&&y.resistances.some(h=>h.toLowerCase().trim()===p)){const h=Math.floor(f/2);v.push(`Resistant to ${c} (racial trait): ${f} ‚Üí ${h}`),f=h,m=!0;break}}}return v.length===0&&v.push(`No adjustments for ${c}`),{finalDamage:f,adjustments:v}}function Wl(r,c){const t={...r};if(t.tempHP>0){if(c<=t.tempHP)return t.tempHP-=c,t;c-=t.tempHP,t.tempHP=0}return t.currentHP=Math.max(0,t.currentHP-c),t}var Kl=u('<button class="info-icon svelte-1o8ci7b" type="button">‚ÑπÔ∏è</button>'),Vl=u('<button class="info-icon svelte-1o8ci7b" type="button">‚ÑπÔ∏è</button>'),Jl=u("<div><!></div>"),Yl=u('<div class="tooltip-wrapper svelte-1o8ci7b"><!> <!></div>');function vs(r,c){Yt(c,!1);let t=Lt(c,"tooltipContent",8),v=Lt(c,"ariaLabel",8,"Show information"),f=D(!1),p=D(),m=D(!1),k=D(null),y=D(!1),h=D(!1),z=D("");const P=Math.random().toString(36).slice(2);function V(){window.dispatchEvent(new CustomEvent("tooltip-open",{detail:P}))}function X(M){M.detail!==P&&(n(f,!1),n(y,!1))}function se(){n(m,window.matchMedia("(pointer: coarse)").matches||"ontouchstart"in window)}function N(){if(!e(k)||!e(p))return;const M=e(p).getBoundingClientRect(),T=e(k).getBoundingClientRect();let w=M.bottom+5,K=M.left;n(y,!1),K+T.width>window.innerWidth-8&&(K=M.right-T.width,n(y,!0),K<8&&(K=8)),K<8&&(K=8),w+T.height>window.innerHeight-8&&(w=M.top-T.height-5),n(z,`position:fixed;top:${w}px;left:${K}px;z-index:1000;`),n(h,!0)}function R(){V(),n(f,!1),n(h,!1),requestAnimationFrame(()=>{n(f,!0),n(h,!1),setTimeout(N,0)})}function I(){n(f,!1),n(y,!1)}function ee(M){M.stopPropagation(),e(f)?(n(f,!1),n(y,!1),n(h,!1)):(V(),n(f,!1),n(h,!1),requestAnimationFrame(()=>{n(f,!0),n(h,!1),setTimeout(N,0)}))}function pe(M){e(p)&&!e(p).contains(M.target)&&(n(f,!1),n(y,!1))}ka(()=>{se(),document.addEventListener("click",pe),window.addEventListener("tooltip-open",X)}),Ks(()=>{document.removeEventListener("click",pe),window.removeEventListener("tooltip-open",X)}),Jt();var Ie=Yl(),re=l(Ie);{var te=M=>{var T=Kl();L(()=>it(T,"aria-label",v())),B("click",T,ee),o(M,T)},ye=M=>{var T=Vl();L(()=>it(T,"aria-label",v())),B("mouseenter",T,R),B("mouseleave",T,I),o(M,T)};g(re,M=>{e(m)?M(te):M(ye,!1)})}var Re=a(re,2);{var Ee=M=>{var T=Jl(),w=l(T);xl(w,c,"content",{},K=>{var b=yt(),F=Se(b);yl(F,t),o(K,b)}),s(T),Ha(T,K=>n(k,K),()=>e(k)),L(()=>{It(T,1,`tooltip-popup ${e(y)?"right-align":""}`,"svelte-1o8ci7b"),$l(T,e(h)?e(z)+"opacity:1;pointer-events:auto;":"opacity:0;pointer-events:none;position:fixed;top:0;left:0;z-index:1000;")}),o(M,T)};g(Re,M=>{e(f)&&M(Ee)})}s(Ie),Ha(Ie,M=>n(p,M),()=>e(p)),o(r,Ie),Qt()}var Ql=u("<option> </option>"),Xl=u('<div class="armor-config svelte-1r5hyyb"><h4 class="svelte-1r5hyyb">Armor Configuration</h4> <div class="armor-controls svelte-1r5hyyb"><div class="armor-field svelte-1r5hyyb"><label for="armorName" class="svelte-1r5hyyb">Armor</label> <select id="armorName" class="armor-select svelte-1r5hyyb"><option>None (Unarmored)</option><!></select></div> <div class="armor-field svelte-1r5hyyb"><label class="shield-label svelte-1r5hyyb"><input type="checkbox" class="shield-checkbox svelte-1r5hyyb"/> Shield Equipped (+2 AC)</label></div></div></div>'),Zl=u('<div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="spellSaveDC" class="svelte-1r5hyyb">Spell Save DC</label> <!></div> <input type="number" id="spellSaveDC" class="stat-input svelte-1r5hyyb" readonly=""/></div>'),er=u('<span class="hit-dice-type"> </span>'),tr=u('<!> <div class="stats-grid svelte-1r5hyyb"><div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="armorClass" class="svelte-1r5hyyb">Armor Class</label> <!></div> <input type="text" id="armorClass" readonly=""/></div> <div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="initiative" class="svelte-1r5hyyb">Initiative</label> <!></div> <input type="text" id="initiative" class="stat-input svelte-1r5hyyb" readonly=""/></div> <div class="stat-box svelte-1r5hyyb"><label for="speed" class="svelte-1r5hyyb">Speed</label> <input type="text" id="speed" class="stat-input svelte-1r5hyyb"/></div> <!></div> <div class="hp-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Points</h3> <div><div class="hp-inputs svelte-1r5hyyb"><input type="number" class="hp-current svelte-1r5hyyb" min="0"/> <span class="hp-separator svelte-1r5hyyb">/</span> <input type="number" class="hp-max svelte-1r5hyyb" min="0"/></div> <div class="hp-controls svelte-1r5hyyb"><button class="hp-btn svelte-1r5hyyb">‚àí</button> <button class="hp-btn svelte-1r5hyyb">+</button> <button class="hp-btn svelte-1r5hyyb">‚àí5</button> <button class="hp-btn svelte-1r5hyyb">+5</button></div></div> <div class="temp-hp svelte-1r5hyyb"><label for="tempHP" class="svelte-1r5hyyb">Temp HP</label> <input type="number" id="tempHP" min="0" class="svelte-1r5hyyb"/></div></div> <div class="hit-dice-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Dice</h3> <div class="hit-dice-display svelte-1r5hyyb"><input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <span>/</span> <input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <!></div> <div class="hit-dice-controls svelte-1r5hyyb"><label for="hitDiceCount" class="svelte-1r5hyyb">Roll</label> <div class="hit-dice-count-controls svelte-1r5hyyb"><button class="hit-dice-btn svelte-1r5hyyb">‚àí</button> <input type="number" id="hitDiceCount" class="hit-dice-count-input svelte-1r5hyyb" min="1"/> <button class="hit-dice-btn svelte-1r5hyyb">+</button></div> <button class="btn btn-primary roll-hit-dice use-enabled svelte-1r5hyyb">üé≤ Roll</button></div></div>',1),ar=u("<section><!> <!></section>");function sr(r,c){Yt(c,!1);const t=()=>bt(ve,"$character",k),v=()=>bt(Xa,"$abilityModifiers",k),f=()=>bt(xa,"$searchFilter",k),p=()=>bt(la,"$collapsedStates",k),m=()=>bt(wa,"$isEditMode",k),[k,y]=fa(),h=D(),z=D(),P=D(),V=D(),X=D(),se=D(),N=D(),R=Sa();let I=D(1);function ee(M){ve.update(T=>(T.currentHP=Math.max(0,Math.min(T.maxHP,T.currentHP+M)),T))}function pe(M){const T=e(I)+M,w=t().hitDice.current;n(I,Math.max(1,Math.min(w,T)))}function Ie(M=1){if(t().hitDice.current<=0){alert("No hit dice remaining!");return}if(!t().class){alert("Please select a class first!");return}const T=ua(t().class);if(!T){alert("Invalid class configuration!");return}const w=Math.min(M,t().hitDice.current),K=T.hitDice,b=v().constitution,F=b*w,J=F>=0?`+${F}`:`${F}`,me=`${w}${K}${J}`,ge=[];if(ge.push({value:`${w}${K}`,source:"hit dice"}),b!==0)for(let ce=0;ce<w;ce++)ge.push({value:b,source:"constitution"});R("rollHitDice",{notation:me,hitDie:K,count:w,bonusBreakdown:ge})}Ye(()=>(t(),v(),ve),()=>{if(t().armorName!==void 0||t().shieldEquipped!==void 0){const M=v().dexterity,T=Nl(t().armorName,M,t().shieldEquipped||!1);t().armorClass!==T&&ve.update(w=>({...w,armorClass:T}))}}),Ye(()=>(v(),t(),ve),()=>{const M=v().dexterity;t().initiative!==M&&ve.update(T=>({...T,initiative:M}))}),Ye(()=>t(),()=>{n(h,gs(t(),t().abilities))}),Ye(()=>t(),()=>{n(z,Ol(t(),t().abilities))}),Ye(()=>t(),()=>{n(P,Gl(t(),t().abilities))}),Ye(()=>t(),()=>{n(V,ql(t(),t().abilities))}),Ye(()=>(t(),e(I)),()=>{const M=t().hitDice.current;M>0&&e(I)>M&&n(I,M)}),Ye(()=>t(),()=>{n(X,t().activeStates&&t().activeStates.length>0?t().activeStates.reduce((M,T)=>M+(T.acBonus||0),0):0)}),Ye(()=>t(),()=>{n(se,t().activeStates&&t().activeStates.length>0?t().activeStates.some(M=>M.name==="Aid"&&M.target==="self"):!1)}),Ye(()=>f(),()=>{n(N,!f()||"armor class".includes(f().toLowerCase())||"initiative".includes(f().toLowerCase())||"speed".includes(f().toLowerCase())||"hit points".includes(f().toLowerCase())||"hp".includes(f().toLowerCase())||"hit dice".includes(f().toLowerCase())||"spell save".includes(f().toLowerCase())||"combat".includes(f().toLowerCase()))}),ga(),Jt();var re=ar();let te;var ye=l(re);{let M=kt(()=>(p(),i(()=>p().combatStats?"Expand":"Collapse")));Ca(ye,{title:"Combat Stats",get collapsed(){return p(),i(()=>p().combatStats)},get ariaLabel(){return e(M)},onToggle:()=>la.update(T=>({...T,combatStats:!T.combatStats}))})}var Re=a(ye,2);{var Ee=M=>{var T=tr(),w=Se(T);{var K=Z=>{var je=Xl(),we=a(l(je),2),We=l(we),He=a(l(We),2);L(()=>{t(),Wt(()=>{})});var Ze=l(He);Ze.value=(Ze.__value=void 0)??"";var dt=a(Ze);St(dt,1,()=>Os,jt,(x,q)=>{var xe=yt(),be=Se(xe);{var Ae=qe=>{var st=Ql(),tt=l(st);s(st);var he={};L(()=>{C(tt,`${e(q),i(()=>e(q).name)??""} (AC ${e(q),i(()=>e(q).baseAC)??""})`),he!==(he=(e(q),i(()=>e(q).name)))&&(st.value=(st.__value=(e(q),i(()=>e(q).name)))??"")}),o(qe,st)};g(be,qe=>{e(q),i(()=>e(q).name!=="Unarmored")&&qe(Ae)})}o(x,xe)}),s(He),s(We);var le=a(We,2),ut=l(le),Ve=l(ut);Ce(Ve),sa(),s(ut),s(le),s(we),s(je),Ua(He,()=>t().armorName,x=>Nt(ve,i(t).armorName=x,i(t))),Aa(Ve,()=>t().shieldEquipped,x=>Nt(ve,i(t).shieldEquipped=x,i(t))),o(Z,je)};g(w,Z=>{m()&&Z(K)})}var b=a(w,2),F=l(b),J=l(F),me=a(l(J),2);vs(me,{get tooltipContent(){return e(z)},ariaLabel:"Show AC breakdown"}),s(J);var ge=a(J,2);Ce(ge),s(F);var ce=a(F,2),de=l(ce),Xe=a(l(de),2);vs(Xe,{get tooltipContent(){return e(P)},ariaLabel:"Show Initiative breakdown"}),s(de);var nt=a(de,2);Ce(nt),s(ce);var pt=a(ce,2),_t=a(l(pt),2);Ce(_t),s(pt);var mt=a(pt,2);{var ot=Z=>{var je=Zl(),we=l(je),We=a(l(we),2);vs(We,{get tooltipContent(){return e(V)},ariaLabel:"Show Spell Save DC breakdown"}),s(we);var He=a(we,2);Ce(He),s(je),L(()=>Ea(He,e(h))),o(Z,je)};g(mt,Z=>{e(h)!==null&&Z(ot)})}s(b);var Bt=a(b,2),At=a(l(Bt),2);let S;var O=l(At),_=l(O);Ce(_);var E=a(_,4);Ce(E),s(O);var G=a(O,2),ie=l(G),De=a(ie,2),$e=a(De,2),Te=a($e,2);s(G),s(At);var Le=a(At,2),$=a(l(Le),2);Ce($),s(Le),s(Bt);var Q=a(Bt,2),oe=a(l(Q),2),Oe=l(oe);Ce(Oe);var Fe=a(Oe,4);Ce(Fe);var ht=a(Fe,2);{var ne=Z=>{const je=kt(()=>(U(ua),t(),i(()=>ua(t().class))));var we=yt(),We=Se(we);{var He=Ze=>{const dt=kt(()=>(v(),i(()=>v().constitution)));var le=er(),ut=l(le);s(le),L(()=>C(ut,`(${U(e(je)),i(()=>e(je).hitDice)??""}${(e(dt)>=0?`+${e(dt)}`:e(dt))??""})`)),o(Ze,le)};g(We,Ze=>{e(je)&&Ze(He)})}o(Z,we)};g(ht,Z=>{t(),i(()=>t().class)&&Z(ne)})}s(oe);var W=a(oe,2),d=a(l(W),2),Ge=l(d),fe=a(Ge,2);Ce(fe);var H=a(fe,2);s(d);var _e=a(d,2);s(W),s(Q),L(()=>{Ea(ge,(e(X),t(),i(()=>e(X)!==0?`${t().armorClass} ‚Üí ${t().armorClass+e(X)}`:`${t().armorClass}`))),It(ge,1,ul(e(X)!==0?"stat-input ac-enhanced":"stat-input"),"svelte-1r5hyyb"),Ea(nt,(t(),i(()=>t().initiative))),S=It(At,1,"hp-display svelte-1r5hyyb",null,S,{"aid-active":e(se)}),it(_,"max",(t(),i(()=>t().maxHP))),it(Oe,"max",(t(),i(()=>t().hitDice.max))),Ge.disabled=e(I)<=1,it(fe,"max",(t(),i(()=>t().hitDice.current))),H.disabled=(e(I),t(),i(()=>e(I)>=t().hitDice.current)),_e.disabled=(t(),i(()=>t().hitDice.current<=0||!t().class))}),Pe(_t,()=>t().speed,Z=>Nt(ve,i(t).speed=Z,i(t))),Pe(_,()=>t().currentHP,Z=>Nt(ve,i(t).currentHP=Z,i(t))),Pe(E,()=>t().maxHP,Z=>Nt(ve,i(t).maxHP=Z,i(t))),B("click",ie,()=>ee(-1)),B("click",De,()=>ee(1)),B("click",$e,()=>ee(-5)),B("click",Te,()=>ee(5)),Pe($,()=>t().tempHP,Z=>Nt(ve,i(t).tempHP=Z,i(t))),Pe(Oe,()=>t().hitDice.current,Z=>Nt(ve,i(t).hitDice.current=Z,i(t))),Pe(Fe,()=>t().hitDice.max,Z=>Nt(ve,i(t).hitDice.max=Z,i(t))),B("click",Ge,()=>pe(-1)),Pe(fe,()=>e(I),Z=>n(I,Z)),B("input",fe,Z=>{const je=Z.target,we=parseInt(je.value);we>t().hitDice.current&&n(I,t().hitDice.current),we<1&&n(I,1)}),B("click",H,()=>pe(1)),B("click",_e,()=>Ie(e(I))),o(M,T)};g(Re,M=>{p(),i(()=>!p().combatStats)&&M(Ee)})}s(re),L(()=>te=It(re,1,"combat-stats svelte-1r5hyyb",null,te,{hidden:!e(N)})),o(r,re),Qt(),y()}const qa={acrobatics:"dexterity",animalHandling:"wisdom",arcana:"intelligence",athletics:"strength",deception:"charisma",history:"intelligence",insight:"wisdom",intimidation:"charisma",investigation:"intelligence",medicine:"wisdom",nature:"intelligence",perception:"wisdom",performance:"charisma",persuasion:"charisma",religion:"intelligence",sleightOfHand:"dexterity",stealth:"dexterity",survival:"wisdom"};var lr=u('<div class="skill-row svelte-1f1pl16"><input type="checkbox" class="svelte-1f1pl16"/> <label class="svelte-1f1pl16"> <span class="ability-tag svelte-1f1pl16"> </span></label> <span class="skill-modifier svelte-1f1pl16"> </span> <button class="roll-btn svelte-1f1pl16">Roll</button></div>'),rr=u('<div class="skills-grid svelte-1f1pl16"></div>'),ir=u("<section><!> <!></section>");function nr(r,c){Yt(c,!1);const t=()=>bt(ve,"$character",k),v=()=>bt(Xa,"$abilityModifiers",k),f=()=>bt(xa,"$searchFilter",k),p=()=>bt(la,"$collapsedStates",k),m=()=>bt(wa,"$isEditMode",k),[k,y]=fa(),h=D(),z=D(),P=D(),V=D(),X=D(),se=D(),N=Sa(),R=[{key:"acrobatics",label:"Acrobatics"},{key:"animalHandling",label:"Animal Handling"},{key:"arcana",label:"Arcana"},{key:"athletics",label:"Athletics"},{key:"deception",label:"Deception"},{key:"history",label:"History"},{key:"insight",label:"Insight"},{key:"intimidation",label:"Intimidation"},{key:"investigation",label:"Investigation"},{key:"medicine",label:"Medicine"},{key:"nature",label:"Nature"},{key:"perception",label:"Perception"},{key:"performance",label:"Performance"},{key:"persuasion",label:"Persuasion"},{key:"religion",label:"Religion"},{key:"sleightOfHand",label:"Sleight of Hand"},{key:"stealth",label:"Stealth"},{key:"survival",label:"Survival"}];function I(ye){const Re=qa[ye],Ee=v()[Re],M=t().skillProficiencies[ye]?t().proficiencyBonus:0,T=e(h)[ye],w=`1d20${T>=0?"+":""}${T}`,K=[];K.push({value:"1d20",source:"base die"}),Ee!==0&&K.push({value:Ee,source:Re}),M!==0&&K.push({value:M,source:"proficiency"}),N("roll",{notation:w,rollType:"check",bonusBreakdown:K})}Ye(()=>{},()=>{n(h,{})}),Ye(()=>t(),()=>{n(z,t().skillProficiencies)}),Ye(()=>t(),()=>{n(P,t().proficiencyBonus)}),Ye(()=>v(),()=>{n(V,v())}),Ye(()=>(e(V),e(z),e(P)),()=>{for(const{key:ye}of R){const Re=qa[ye],Ee=e(V)[Re],M=e(z)[ye]?e(P):0;_a(h,e(h)[ye]=Ee+M)}}),Ye(()=>f(),()=>{n(X,R.filter(({label:ye})=>f()?ye.toLowerCase().includes(f().toLowerCase()):!0))}),Ye(()=>e(X),()=>{n(se,e(X).length>0)}),ga(),Jt();var ee=ir();let pe;var Ie=l(ee);{let ye=kt(()=>(p(),i(()=>p().skills?"Expand":"Collapse")));Ca(Ie,{title:"Skills",get collapsed(){return p(),i(()=>p().skills)},get ariaLabel(){return e(ye)},onToggle:()=>la.update(Re=>({...Re,skills:!Re.skills}))})}var re=a(Ie,2);{var te=ye=>{var Re=rr();St(Re,5,()=>e(X),jt,(Ee,M)=>{let T=()=>e(M).key,w=()=>e(M).label;var K=lr(),b=l(K);Ce(b);var F=a(b,2),J=l(F),me=a(J),ge=l(me);s(me),s(F);var ce=a(F,2),de=l(ce);s(ce);var Xe=a(ce,2);s(K),L(nt=>{Us(b,(e(z),T(),i(()=>e(z)[T()]))),b.disabled=!m(),it(b,"id",T()),it(F,"for",T()),C(J,`${w()??""} `),C(ge,`(${nt??""})`),C(de,`${e(h),T(),i(()=>e(h)[T()]>=0?"+":"")??""}${e(h),T(),i(()=>e(h)[T()])??""}`)},[()=>(U(qa),T(),i(()=>qa[T()].substring(0,3).toUpperCase()))]),B("change",b,nt=>{console.log("Skill proficiency changed:",T(),nt.target.checked),ve.update(pt=>({...pt,skillProficiencies:{...pt.skillProficiencies,[T()]:nt.target.checked}}))}),B("click",Xe,()=>I(T())),o(Ee,K)}),s(Re),o(ye,Re)};g(re,ye=>{p(),i(()=>!p().skills)&&ye(te)})}s(ee),L(()=>pe=It(ee,1,"skills svelte-1f1pl16",null,pe,{hidden:!e(se)})),o(r,ee),Qt(),y()}var or=u('<p class="empty-message svelte-1123ljy">No attacks or spells to reorder.</p>'),cr=u('<li class="reorder-item svelte-1123ljy"><span class="attack-name svelte-1123ljy"> </span> <div class="reorder-buttons svelte-1123ljy"><button class="btn-move svelte-1123ljy" aria-label="Move up">‚ñ≤</button> <button class="btn-move svelte-1123ljy" aria-label="Move down">‚ñº</button></div></li>'),vr=u('<ul class="reorder-list svelte-1123ljy"></ul>'),dr=u('<div class="modal-backdrop svelte-1123ljy" role="presentation"><div class="modal-content svelte-1123ljy" role="dialog" aria-modal="true" aria-labelledby="modal-title"><div class="modal-header svelte-1123ljy"><h3 id="modal-title" class="svelte-1123ljy">Reorder Attacks & Spells</h3> <button class="btn-close svelte-1123ljy" aria-label="Close">√ó</button></div> <div class="modal-body svelte-1123ljy"><!></div> <div class="modal-footer svelte-1123ljy"><button class="btn btn-secondary svelte-1123ljy">Cancel</button> <button class="btn btn-primary svelte-1123ljy">Save Order</button></div></div></div>');function ur(r,c){Yt(c,!1);let t=Lt(c,"show",8,!1),v=Lt(c,"attacks",24,()=>[]),f=Lt(c,"onSave",8),p=Lt(c,"onCancel",8),m=D([]);function k(R,I){const ee=e(m)[R];_a(m,e(m)[R]=e(m)[I]),_a(m,e(m)[I]=ee),n(m,[...e(m)])}function y(R){R>0&&k(R,R-1)}function h(R){R<e(m).length-1&&k(R,R+1)}function z(){f()(e(m))}function P(){p()()}function V(R){R.target===R.currentTarget&&P()}Ye(()=>(U(t()),U(v())),()=>{t()&&n(m,[...v()])}),ga(),Jt();var X=yt(),se=Se(X);{var N=R=>{var I=dr(),ee=l(I),pe=l(ee),Ie=a(l(pe),2);s(pe);var re=a(pe,2),te=l(re);{var ye=w=>{var K=or();o(w,K)},Re=w=>{var K=vr();St(K,7,()=>e(m),b=>b.id,(b,F,J)=>{var me=cr(),ge=l(me),ce=l(ge,!0);s(ge);var de=a(ge,2),Xe=l(de),nt=a(Xe,2);s(de),s(me),L(()=>{C(ce,(e(F),i(()=>e(F).name||"(Unnamed attack or spell)"))),Xe.disabled=e(J)===0,nt.disabled=(U(e(J)),e(m),i(()=>e(J)===e(m).length-1))}),B("click",Xe,()=>y(e(J))),B("click",nt,()=>h(e(J))),o(b,me)}),s(K),o(w,K)};g(te,w=>{e(m),i(()=>e(m).length===0)?w(ye):w(Re,!1)})}s(re);var Ee=a(re,2),M=l(Ee),T=a(M,2);s(Ee),s(ee),s(I),B("click",Ie,P),B("click",M,P),B("click",T,z),B("click",I,V),o(R,I)};g(se,R=>{t()&&R(N)})}o(r,X),Qt()}let za=null,Wa=null;async function qs(){if(za)return za;try{return za=await(await fetch(Ns("/data/spells.json"))).json(),za||[]}catch(r){return console.error("Failed to load spells:",r),[]}}async function fr(){if(Wa)return Wa;try{return Wa=await(await fetch(Ns("/data/feats.json"))).json(),Wa||[]}catch(r){return console.error("Failed to load feats:",r),[]}}function Rs(r,c){if(!c.trim())return r;const t=c.toLowerCase();return r.filter(v=>v.name.toLowerCase().includes(t)||v.school.toLowerCase().includes(t)||v.classes.some(f=>f.toLowerCase().includes(t))||v.description.toLowerCase().includes(t))}function pr(r,c){return c===null?r:r.filter(t=>t.level===c)}function mr(r,c){if(!c.trim())return r;const t=c.toLowerCase();return r.filter(v=>v.name.toLowerCase().includes(t)||v.description.toLowerCase().includes(t))}function Ka(r){const c=r.description,t=/\b(Strength|Dexterity|Constitution|Intelligence|Wisdom|Charisma)\s+saving\s+throw/i,v=c.match(t);if(!v)return null;const f=v[1].toLowerCase(),m=/half\s+(?:as\s+much\s+)?damage\s+on\s+a\s+successful(?:\s+save)?|on\s+a\s+successful(?:\s+save)?[^.]*half\s+(?:as\s+much\s+)?damage/i.test(c),y=/saving\s+throw\s+or\s+take.*?damage/i.test(c)&&!m;return{ability:f,halfDamageOnSave:m,noDamageOnSave:y}}function gr(r){const c=r.description;return/(plus|add)\s+your\s+spellcasting\s+(ability\s+)?modifier/i.test(c)}function La(r){const c=r.description.toLowerCase();return c.includes("ranged spell attack")||c.includes("melee spell attack")}function Va(r){const c=r.description.toLowerCase();if(["Divine Favor","Bless","Aid","Command","Crusader's Mantle"].includes(r.name))return!0;const f=["takes","take","deals","deal","damage equal to","force damage","fire damage","cold damage","lightning damage","thunder damage","acid damage","poison damage","necrotic damage","radiant damage","psychic damage","regain","regains","hit point"].some(k=>c.includes(k));return["bonus to attack","bonus to damage","bonus to ac","gains a +","gain a +","+1 bonus","+2 bonus","+3 bonus","advantage on","becomes a magic weapon"].some(k=>c.includes(k))&&!f}function br(r){const c=r.description;let t=0,v=0,f=0,p="";const m=c.match(/\+(\d+)\s+bonus\s+to\s+attack\s+rolls\s+and\s+damage\s+rolls/i);if(m){const y=parseInt(m[1]);t=y,v=y,p=`+${y} to attack and damage rolls`}if(r.name==="Bless"&&(p="Add 1d4 to attack rolls and saves",t="1d4"),r.name==="Aid")return p="+5 HP (max and current) for 8 hours",{attackBonus:0,damageBonus:0,acBonus:0,hpBonus:5,description:p,name:r.name};r.name==="Divine Favor"&&(p="Your weapon attacks deal an extra 1d4 radiant damage on a hit.",v="1d4");const k=c.match(/\+(\d+)\s+bonus\s+to\s+AC/i);return k&&(f=parseInt(k[1]),p=`+${f} to AC`),r.name==="Haste"&&(p="+2 AC, doubled speed, extra action",f=2),r.name==="Crusader's Mantle"&&(p="Your weapon attacks deal an extra 1d4 radiant damage on a hit.",v="1d4"),p||t!==0||v!==0||f!==0?{attackBonus:t,damageBonus:v,acBonus:f,description:p||r.description.substring(0,100),name:r.name}:null}function ds(r){const c=r.description,t=/takes?\s+(\d+d\d+)\s+\w+\s+damage[^.]*\.\s*If\s+the\s+target\s+is\s+missing.*?instead\s+takes?\s+(\d+d\d+)/is,v=c.match(t);return v?{baseDamage:v[1],alternateDamage:v[2]}:null}var hr=u('<button class="btn btn-secondary">Reorder</button>'),_r=u('<div class="edit-buttons svelte-14o91c5"><button class="btn btn-secondary">Add Attack</button> <!></div>'),yr=u('<input type="text" placeholder="Attack name" class="attack-name svelte-14o91c5"/>'),xr=u('<h4 class="attack-name-display svelte-14o91c5"> </h4>'),$r=u('<button class="btn-remove svelte-14o91c5">√ó</button>'),wr=u('<div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Bonus</label> <input type="number" class="attack-bonus svelte-14o91c5"/></div>'),kr=u('<div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Damage</label> <input type="text" placeholder="e.g., 2d6+3" class="attack-damage svelte-14o91c5"/></div>'),Sr=u('<div class="spell-info-loading svelte-14o91c5">Loading spell info...</div>'),Cr=u('<li class="svelte-14o91c5"><strong>At Higher Levels:</strong> </li>'),Dr=u('<li style="color: #007bff;" class="svelte-14o91c5"><strong>Special:</strong> Mage Hand is invisible when cast via Githyanki Psionics.</li>'),Lr=u('<li style="color: #007bff;" class="svelte-14o91c5"><strong>Cast via:</strong> </li>'),Ar=u("<!> <!>",1),jr=u('<ul class="svelte-14o91c5"><li class="svelte-14o91c5"><strong>Level:</strong> </li> <li class="svelte-14o91c5"><strong>Casting Time:</strong> </li> <li class="svelte-14o91c5"><strong>Range:</strong> </li> <li class="svelte-14o91c5"><strong>Components:</strong> <!></li> <li class="svelte-14o91c5"><strong>Duration:</strong> <!> </li> <li class="svelte-14o91c5"><strong>Description:</strong> </li> <!> <!></ul>'),Br=u('<span class="scaled-damage svelte-14o91c5" style="margin-left: 8px;"> </span>'),Rr=u('<span class="scaled-damage svelte-14o91c5">(Half damage)</span>'),Mr=u('<span class="scaled-damage svelte-14o91c5">(No damage)</span>'),Tr=u('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> <!> <!></label></div>'),Fr=u('<span class="scaled-damage svelte-14o91c5"> </span>'),Pr=u('<span class="scaled-damage svelte-14o91c5"> </span>'),Ir=u('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> Target is missing HP <!></label></div>'),Er=u("<option> </option>"),Hr=u('<span class="scaled-damage svelte-14o91c5"><!> </span>'),Ur=u('<span class="scaled-damage svelte-14o91c5"> </span>'),Nr=u('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> Target is Fiend or Undead <!></label></div>'),Or=u('<div class="spell-level-selector svelte-14o91c5"><label class="svelte-14o91c5">Cast at Level:</label> <select class="spell-level-select use-enabled svelte-14o91c5"></select> <!></div> <!>',1),Gr=u('<div class="spell-info svelte-14o91c5"><div class="spell-info-header svelte-14o91c5" role="button" tabindex="0"><h4 class="svelte-14o91c5">Spell Info</h4> <button class="collapse-btn-small svelte-14o91c5"> </button></div> <!></div> <!> <!> <!>',1),qr=u('<div class="spell-info-missing svelte-14o91c5">Spell info not found.</div>'),zr=u('<div class="attack-notes svelte-14o91c5"><label class="svelte-14o91c5">Notes</label> <textarea placeholder="e.g., DC 15 Dex save, Range 120 ft, Concentration" class="notes-input svelte-14o91c5" rows="2"></textarea></div>'),Wr=u('<div style="margin-bottom: 0.5em;"><label style="font-size:0.95em;"><input type="checkbox" class="svelte-14o91c5"/> Use Racial Trait <span style="color:#007bff; font-size:0.95em; margin-left:0.5em;"> </span></label></div>'),Kr=u('<button class="btn btn-primary">Roll Attack (Spell Slot)</button>'),Vr=u('<button class="btn btn-primary" disabled>No spell slots available</button>'),Jr=u('<button class="btn btn-primary">Roll Attack (Racial Trait)</button>'),Yr=u('<button class="btn btn-primary" disabled>No racial uses left</button>'),Qr=u('<div class="buff-target-selection svelte-14o91c5"><div class="target-options svelte-14o91c5"><label class="target-option svelte-14o91c5"><input type="radio" class="svelte-14o91c5"/> Self</label> <label class="target-option svelte-14o91c5"><input type="radio" class="svelte-14o91c5"/> Other</label></div> <button class="btn btn-info"> </button></div>'),Xr=u('<button class="btn btn-info">Cast Spell</button>'),Zr=u("<button><!></button>"),ei=u('<button class="btn btn-info">Cast Spell</button>'),ti=u("<!> <!> <!> <!>",1),ai=u('<button class="btn btn-secondary">Roll Damage</button>'),si=u('<button class="btn btn-primary">Roll Attack</button> <!>',1),li=u('<div class="attack-card svelte-14o91c5"><div class="attack-header svelte-14o91c5"><!> <!></div> <div class="attack-details svelte-14o91c5"><!> <!> <div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Type</label> <input type="text" placeholder="e.g., slashing" class="attack-type svelte-14o91c5"/></div></div> <!> <!> <div class="attack-actions svelte-14o91c5"><!> <!></div></div>'),ri=u('<p class="no-attacks svelte-14o91c5">No attacks added yet. Click "Add Attack" to create one.</p>'),ii=u('<p class="no-attacks svelte-14o91c5">No attacks match your search.</p>'),ni=u('<span class="ability-uses svelte-14o91c5"> <!></span>'),oi=u('<span class="ability-reaction svelte-14o91c5">‚ö° Reaction</span>'),ci=u('<button class="btn btn-ability svelte-14o91c5">Use Ability</button>'),vi=u('<div class="ability-card svelte-14o91c5"><div class="ability-header svelte-14o91c5"><h4 class="ability-name svelte-14o91c5"> </h4> <span class="ability-source svelte-14o91c5"> </span></div> <p class="ability-description svelte-14o91c5"> </p> <div class="ability-footer svelte-14o91c5"><!> <!> <!></div></div>'),di=u('<div class="condition-abilities-section svelte-14o91c5"><h3 class="abilities-header svelte-14o91c5">Condition Abilities</h3> <p class="section-description svelte-14o91c5">Special actions granted by active conditions (e.g., Flicker of Deceit)</p> <div class="abilities-list svelte-14o91c5"></div></div>'),ui=u('<button class="btn-remove svelte-14o91c5">√ó</button>'),fi=u('<div class="state-card svelte-14o91c5"><div class="state-header svelte-14o91c5"><input type="text" placeholder="Effect name (e.g., Magic Weapon)" class="state-name svelte-14o91c5"/> <!></div> <div class="state-details svelte-14o91c5"><div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Attack Bonus</label> <input type="number" class="state-bonus svelte-14o91c5"/></div> <div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Damage Bonus</label> <input type="text" class="state-bonus svelte-14o91c5"/></div> <div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Target</label> <select class="state-bonus svelte-14o91c5"><option>Self</option><option>Other</option></select></div></div> <div class="state-description svelte-14o91c5"><label class="svelte-14o91c5">Description</label> <input type="text" placeholder="e.g., +1 to attack and damage rolls (Magic Weapon)" class="state-desc-input svelte-14o91c5"/></div></div>'),pi=u('<div class="states-list svelte-14o91c5"></div>'),mi=u('<p class="no-states svelte-14o91c5">No active effects. Add spell effects that modify your attacks.</p>'),gi=u('<!> <div class="attacks-list svelte-14o91c5"><!> <!> <!></div> <!> <div class="active-states-section svelte-14o91c5"><h3 class="svelte-14o91c5">Active Spell Effects</h3> <p class="section-description svelte-14o91c5">Effects that modify attack and damage rolls (e.g., Magic Weapon, Bless)</p> <button class="btn btn-secondary">Add Effect</button> <!></div>',1),bi=u("<section><!> <!></section> <!>",1);function hi(r,c){Yt(c,!1);const t=()=>bt(ve,"$character",m),v=()=>bt(xa,"$searchFilter",m),f=()=>bt(la,"$collapsedStates",m),p=()=>bt(wa,"$isEditMode",m),[m,k]=fa(),y=D(),h=D(),z=D(),P=[];let V=D({});function X(S,O){ve.update(_=>{if(!_.activeStates)return _;const E=_.activeStates.findIndex($e=>$e.name===S);if(E===-1)return _;const G=_.activeStates[E];if(!G.abilities)return _;const ie=G.abilities.findIndex($e=>$e.name===O);if(ie===-1)return _;const De=G.abilities[ie];return De.currentUses!==void 0&&De.currentUses>0&&(De.currentUses-=1,De.usesPerRest!==void 0?Ot.add(`Used ${O} (${De.currentUses}/${De.usesPerRest} remaining)`,"info"):Ot.add(`Used ${O}`,"info")),_})}const se=Sa();let N=D({}),R=D({}),I=D(!1);function ee(S){_a(N,e(N)[S]=!e(N)[S]),n(N,{...e(N)})}function pe(S){return S.description.toLowerCase().includes("regain")&&(S.description.toLowerCase().includes("hit point")||S.description.toLowerCase().includes("hp"))}function Ie(S){return["Shield of Faith","Bless","Aid","Magic Weapon"].includes(S)}function re(){ve.update(S=>(S.attacks=[...S.attacks,{id:crypto.randomUUID(),name:"",bonus:0,damage:"",damageType:"",notes:""}],S))}function te(S){ve.update(O=>(O.attacks=O.attacks.filter(_=>_.id!==S),O))}function ye(){n(I,!0)}function Re(){n(I,!1)}function Ee(S){ve.update(O=>(O.attacks=S,O)),n(I,!1),Ot.add("Attack order updated successfully!","success")}function M(S,O){let _=S.damage,E=!1,G=!1;const ie=[];if(S.spellRef){const $=b(S.spellRef);if($&&(G=La($),$.level>0)){const Q=S.castAtLevel||$.level;let oe=!1;if(O||S.source==="racial"){if(oe=J(S.name),!oe){Ot.add(`No uses of ${S.name} remaining!`,"error");return}}else if(oe=F(Q),!oe){Ot.add(`No level ${Q} spell slots available!`,"error");return}const Fe=Ka($);Fe&&S.targetSucceededSave&&Fe.noDamageOnSave?_="0":(E=Fe?.halfDamageOnSave&&S.targetSucceededSave||!1,_=me(S,$))}}else if(_){const $=_.match(/(\d+d\d+)([+-]?\d+)?/);if($){const[,Q,oe]=$,Oe=oe?parseInt(oe):0;if(Oe!==0&&ie.push({value:Oe,source:"base"}),t().activeStates&&t().activeStates.length>0){let Fe=0,ht=[];for(const ne of t().activeStates)ne.target!=="other"&&(typeof ne.damageBonus=="string"?(ht.push(ne.damageBonus),ie.push({value:ne.damageBonus,source:ne.name})):typeof ne.damageBonus=="number"&&ne.damageBonus!==0&&(Fe+=ne.damageBonus,ie.push({value:ne.damageBonus,source:ne.name})));if(Fe!==0||ht.length>0){const ne=Oe+Fe;let W=`${Q}`;ne!==0&&(W+=`${ne>=0?"+":""}${ne}`),ht.length>0&&(W+=" + "+ht.join(" + ")),_=W}}}}const De=[];let $e=0;if(G){const $=cs(t(),t().abilities),Q=t().proficiencyBonus||0;De.push({value:Q,source:"proficiency"}),De.push({value:$,source:"spellcasting"}),$e=Q+$}else S.bonus!==0&&De.push({value:S.bonus,source:"base"}),$e=S.bonus;let Te=[];if(t().activeStates)for(const $ of t().activeStates)$.target!=="other"&&(typeof $.attackBonus=="number"&&$.attackBonus!==0?(De.push({value:$.attackBonus,source:$.name}),$e+=$.attackBonus):typeof $.attackBonus=="string"&&$.attackBonus&&(Te.push($.attackBonus),De.push({value:$.attackBonus,source:$.name})));let Le=`1d20${$e>=0?"+":""}${$e}`;Te.length>0&&(Le+="+"+Te.join("+")),se("roll",{notation:Le,damageNotation:_,attackName:S.name,applyHalfDamage:E,bonusBreakdown:De,damageBreakdown:ie,rollType:"attack"})}function T(S){if(!S.damage){Ot.add(`${S.name}: No damage specified`,"error");return}let O=S.damage,_=!1;const E=[];let G=S.damageType||"";if(S.spellRef){const ie=b(S.spellRef);if(ie){const De=pe(ie);if(De){const $e=cs(t(),t().abilities),Te=O.match(/^(\d+d\d+)/);Te&&(O=Te[1],$e>0&&(O+=`+${$e}`,E.push({value:$e,source:"spellcasting"}))),G="Healing"}if(ie.level>0){const $e=S.castAtLevel||ie.level;let Te=!1;if(S.source==="racial"){if(Te=J(S.name),!Te){Ot.add(`No uses of ${S.name} remaining!`,"error");return}}else if(Te=F($e),!Te){Ot.add(`No level ${$e} spell slots available!`,"error");return}const Le=Ka(ie);Le&&S.targetSucceededSave&&Le.noDamageOnSave?O="0":(_=Le?.halfDamageOnSave&&S.targetSucceededSave||!1,De||(O=me(S,ie)))}}}else{const ie=O.match(/(\d+d\d+)([+-]\d+)?/);if(ie){const[,De,$e]=ie,Te=$e?parseInt($e):0;if(Te!==0&&E.push({value:Te,source:"base"}),t().activeStates&&t().activeStates.length>0){let Le=0,$=[];for(const Q of t().activeStates)Q.target!=="other"&&(typeof Q.damageBonus=="string"?($.push(Q.damageBonus),E.push({value:Q.damageBonus,source:Q.name})):typeof Q.damageBonus=="number"&&Q.damageBonus!==0&&(E.push({value:Q.damageBonus,source:Q.name}),Le+=Q.damageBonus));if(Le!==0||$.length>0){const Q=Te+Le;let oe=`${De}`;Q!==0&&(oe+=`${Q>=0?"+":""}${Q}`),$.length>0&&(oe+=" + "+$.join(" + ")),O=oe}}}}se("roll",{notation:O,attackName:S.name,applyHalfDamage:_,bonusBreakdown:E,damageType:G})}let w=D([]),K=D(!1);ka(async()=>{n(w,await qs()),n(K,!0)});function b(S){return e(w).find(O=>O.name===S)}function F(S){t().classFeatures.spellSlotsByLevel||Nt(ve,i(t).classFeatures.spellSlotsByLevel={},i(t)),t().classFeatures.spellSlotsByLevel[S]||Nt(ve,i(t).classFeatures.spellSlotsByLevel[S]=Array(2).fill(!1),i(t));const _=t().classFeatures.spellSlotsByLevel[S].findIndex(E=>!E);return _===-1?!1:(ve.update(E=>(E.classFeatures.spellSlotsByLevel||(E.classFeatures.spellSlotsByLevel={}),E.classFeatures.spellSlotsByLevel[S]||(E.classFeatures.spellSlotsByLevel[S]=Array(2).fill(!1)),E.classFeatures.spellSlotsByLevel[S][_]=!0,E)),!0)}function J(S){return!t().racialTraits||!t().racialTraits.uses[S]?!0:t().racialTraits.uses[S].currentUses<=0?!1:(fl(S),!0)}function me(S,O){let _=S.damage,E=0,G=0;const ie=ds(O);if(ie&&S.targetIsDamaged&&(_=ie.alternateDamage),gr(O)&&(G+=cs(t(),t().abilities)),t().activeStates)for(const Fe of t().activeStates)Fe.target!=="other"&&typeof Fe.damageBonus=="number"&&(G+=Fe.damageBonus);if(O.higherLevelSlot&&S.castAtLevel){const Fe=O.level,ne=(S.castAtLevel||Fe)-Fe;if(ne>0){const W=O.higherLevelSlot.match(/(\d+)d(\d+)\s+for\s+each.*?level\s+above/i);if(W){const[,d]=W;E+=ne*parseInt(d)}}}if(S.targetIsFiendOrUndead&&O.description.includes("Fiend or an Undead")){const Fe=O.description.match(/increases by (\d+)d(\d+) if.*?Fiend or.*?Undead/i);if(Fe){const[,ht]=Fe;E+=parseInt(ht)}}const De=_.match(/(\d+)d(\d+)([+-]\d+)?/);if(!De)return G!==0?G>=0?`${G}`:`${G}`:_||"0";const[,$e,Te,Le]=De,$=parseInt($e)+E,oe=(Le?parseInt(Le):0)+G;let Oe=`${$}d${Te}`;return oe!==0&&(Oe+=oe>=0?`+${oe}`:`${oe}`),Oe}function ge(S){const O=[];for(let E=S.level;E<=9;E++){const G=t().classFeatures.spellSlotsByLevel?.[E];G&&G.length>0&&O.push(E)}return O}function ce(){ve.update(S=>(S.activeStates||(S.activeStates=[]),S.activeStates=[...S.activeStates,{name:"",attackBonus:0,damageBonus:0,description:"",target:"self"}],S))}function de(S){ve.update(O=>{if(O.activeStates){const _=O.activeStates[S];_?.hpBonus&&_.target!=="other"&&(O.maxHP-=_.hpBonus,O.currentHP=Math.max(1,Math.min(O.currentHP-_.hpBonus,O.maxHP))),O.activeStates=O.activeStates.filter((E,G)=>G!==S)}return O})}function Xe(S,O="self"){const _=b(S.spellRef);if(!_){Ot.add("Spell not found","error");return}const E=S.castAtLevel||_.level;if(E>0){let $=!1;if(S.source==="racial"){if($=J(S.name),!$){Ot.add(`No uses of ${S.name} remaining!`,"error");return}}else if($=F(E),!$){Ot.add(`No level ${E} spell slots available!`,"error");return}}const G=br(_);if(!G){Ot.add(`${_.name} cast! Check spell description for effects.`,"info");return}let ie=G.hpBonus||0,De=G.description;_.name==="Aid"&&E>_.level&&(ie=5+(E-_.level)*5,De=`+${ie} HP (max and current) for 8 hours`);const Te=["Shield of Faith","Bless","Aid","Magic Weapon"].includes(_.name);ve.update($=>{$.activeStates||($.activeStates=[]);const Q=$.activeStates.find(oe=>oe.name===_.name);return Q&&Q.hpBonus&&Q.target!=="other"&&($.maxHP-=Q.hpBonus,$.currentHP=Math.max(1,Math.min($.currentHP-Q.hpBonus,$.maxHP))),$.activeStates=$.activeStates.filter(oe=>oe.name!==_.name),ie>0&&O==="self"&&($.maxHP+=ie,$.currentHP+=ie),$.activeStates=[...$.activeStates,{name:_.name,attackBonus:G.attackBonus,damageBonus:G.damageBonus,acBonus:G.acBonus,description:De,target:O,hpBonus:ie}],$});const Le=O==="self"?" on self":" on other";Ot.add(`${_.name} cast${Te?Le:""}! Effect added to Active Spell Effects.`,"success")}Ye(()=>t(),()=>{n(y,t().activeStates?t().activeStates.filter(S=>S.abilities&&S.abilities.length>0).flatMap(S=>S.abilities.map(O=>({...O,conditionName:S.name}))):[])}),Ye(()=>(t(),e(N),e(R)),()=>{if(t()&&t().attacks)for(const S of t().attacks)S.spellRef&&e(N)[S.id]===void 0&&_a(N,e(N)[S.id]=!0),S.spellRef&&e(R)[S.id]===void 0&&_a(R,e(R)[S.id]="self")}),Ye(()=>(t(),v()),()=>{n(h,t().attacks.filter(S=>{if(!v())return!0;const O=v().toLowerCase();return S.name.toLowerCase().includes(O)||S.damageType.toLowerCase().includes(O)}).sort((S,O)=>!S.spellRef&&O.spellRef?-1:S.spellRef&&!O.spellRef?1:0))}),Ye(()=>(v(),e(h)),()=>{n(z,!v()||e(h).length>0||"attack".includes(v().toLowerCase())||"spell".includes(v().toLowerCase()))}),ga(),Jt();var nt=bi(),pt=Se(nt);let _t;var mt=l(pt);{let S=kt(()=>(f(),i(()=>f().attacks?"Expand":"Collapse")));Ca(mt,{title:"Attacks & Spells",get collapsed(){return f(),i(()=>f().attacks)},get ariaLabel(){return e(S)},onToggle:()=>la.update(O=>({...O,attacks:!O.attacks}))})}var ot=a(mt,2);{var Bt=S=>{var O=gi(),_=Se(O);{var E=W=>{var d=_r(),Ge=l(d),fe=a(Ge,2);{var H=_e=>{var Z=hr();B("click",Z,ye),o(_e,Z)};g(fe,_e=>{t(),i(()=>t().attacks.length>0)&&_e(H)})}s(d),B("click",Ge,re),o(W,d)};g(_,W=>{p()&&W(E)})}var G=a(_,2),ie=l(G);St(ie,1,()=>e(h),W=>W.id,(W,d,Ge)=>{var fe=li(),H=l(fe),_e=l(H);{var Z=Ue=>{var ue=yr();Ce(ue),Pe(ue,()=>e(d).name,Be=>(e(d).name=Be,Wt(()=>(e(h),t(),v())))),o(Ue,ue)},je=Ue=>{var ue=xr(),Be=l(ue,!0);s(ue),L(()=>C(Be,(e(d),i(()=>e(d).name||"(Unnamed Attack)")))),o(Ue,ue)};g(_e,Ue=>{p()?Ue(Z):Ue(je,!1)})}var we=a(_e,2);{var We=Ue=>{var ue=$r();B("click",ue,()=>te(e(d).id)),o(Ue,ue)};g(we,Ue=>{p()&&Ue(We)})}s(H);var He=a(H,2),Ze=l(He);{var dt=Ue=>{var ue=wr(),Be=l(ue),ct=a(Be,2);Ce(ct),s(ue),L(()=>{it(Be,"for",`attack-bonus-${e(d),i(()=>e(d).id)??""}`),it(ct,"id",`attack-bonus-${e(d),i(()=>e(d).id)??""}`)}),Pe(ct,()=>e(d).bonus,wt=>(e(d).bonus=wt,Wt(()=>(e(h),t(),v())))),o(Ue,ue)};g(Ze,Ue=>{e(d),i(()=>e(d).bonus!==0&&e(d).bonus!==void 0)&&Ue(dt)})}var le=a(Ze,2);{var ut=Ue=>{var ue=kr(),Be=l(ue),ct=a(Be,2);Ce(ct),s(ue),L(()=>{it(Be,"for",`attack-damage-${e(d),i(()=>e(d).id)??""}`),it(ct,"id",`attack-damage-${e(d),i(()=>e(d).id)??""}`)}),Pe(ct,()=>e(d).damage,wt=>(e(d).damage=wt,Wt(()=>(e(h),t(),v())))),o(Ue,ue)};g(le,Ue=>{e(d),i(()=>e(d).damage&&e(d).damage.trim()!=="")&&Ue(ut)})}var Ve=a(le,2),x=l(Ve),q=a(x,2);Ce(q),s(Ve),s(He);var xe=a(He,2);{var be=Ue=>{var ue=yt(),Be=Se(ue);{var ct=lt=>{var Y=Sr();o(lt,Y)},wt=lt=>{const Y=kt(()=>(e(d),i(()=>b(e(d).spellRef))));var Xt=yt(),Ke=Se(Xt);{var Rt=aa=>{const j=kt(()=>(U(Ka),U(e(Y)),i(()=>Ka(e(Y))))),ke=kt(()=>(U(ds),U(e(Y)),i(()=>ds(e(Y)))));var Me=Gr(),ft=Se(Me),A=l(ft),rt=a(l(A),2),Je=l(rt,!0);s(rt),s(A);var gt=a(A,2);{var ze=Qe=>{var Tt=jr(),Gt=l(Tt),Zt=a(l(Gt));s(Gt);var va=a(Gt,2),pa=a(l(va));s(va);var da=a(va,2),Kt=a(l(da));s(da);var ea=a(da,2),Vt=a(l(ea)),Ft=a(Vt);{var na=Dt=>{var ia=Pt();L(()=>C(ia,`(${U(e(Y)),i(()=>e(Y).material)??""})`)),o(Dt,ia)};g(Ft,Dt=>{U(e(Y)),i(()=>e(Y).material)&&Dt(na)})}s(ea);var ma=a(ea,2),ha=a(l(ma),2);{var qt=Dt=>{var ia=Pt("Concentration,");o(Dt,ia)};g(ha,Dt=>{U(e(Y)),i(()=>e(Y).concentration)&&Dt(qt)})}var ra=a(ha,1,!0);s(ma);var at=a(ma,2),xt=a(l(at));s(at);var Ct=a(at,2);{var zt=Dt=>{var ia=Cr(),Da=a(l(ia));s(ia),L(()=>C(Da,` ${U(e(Y)),i(()=>e(Y).higherLevelSlot)??""}`)),o(Dt,ia)};g(Ct,Dt=>{U(e(Y)),i(()=>e(Y).higherLevelSlot)&&Dt(zt)})}var Et=a(Ct,2);{var oa=Dt=>{var ia=Ar(),Da=Se(ia);{var es=ca=>{var ba=Dr();o(ca,ba)};g(Da,ca=>{e(d),U(e(Y)),i(()=>e(d).racialTraitName==="Githyanki Psionics"&&e(Y).name==="Mage Hand")&&ca(es)})}var ts=a(Da,2);{var as=ca=>{var ba=Lr(),Ba=a(l(ba));s(ba),L(()=>C(Ba,` ${e(d),i(()=>e(d).racialTraitName)??""}`)),o(ca,ba)};g(ts,ca=>{e(d),i(()=>e(d).racialTraitName)&&ca(as)})}o(Dt,ia)};g(Et,Dt=>{e(d),i(()=>e(d).source==="racial")&&Dt(oa)})}s(Tt),L(Dt=>{C(Zt,` ${U(e(Y)),i(()=>e(Y).level)??""}`),C(pa,` ${U(e(Y)),i(()=>e(Y).castingTime||e(Y).actionType)??""}`),C(Kt,` ${U(e(Y)),i(()=>e(Y).range)??""}`),C(Vt,` ${Dt??""}`),C(ra,(U(e(Y)),i(()=>e(Y).duration))),C(xt,` ${U(e(Y)),i(()=>e(Y).description)??""}`)},[()=>(U(e(Y)),i(()=>e(Y).components.join(", ")))]),o(Qe,Tt)};g(gt,Qe=>{e(N),e(d),i(()=>!e(N)[e(d).id])&&Qe(ze)})}s(ft);var et=a(ft,2);{var Ne=Qe=>{var Tt=Tr(),Gt=l(Tt),Zt=l(Gt);Ce(Zt);var va=a(Zt),pa=a(va);{var da=Ft=>{var na=Br(),ma=l(na);s(na),L(ha=>C(ma,`(Spell Save DC: ${ha??""})`),[()=>(U(gs),t(),i(()=>gs(t(),t().abilities)))]),o(Ft,na)};g(pa,Ft=>{t(),i(()=>t().class)&&Ft(da)})}var Kt=a(pa,2);{var ea=Ft=>{var na=Rr();o(Ft,na)},Vt=Ft=>{var na=yt(),ma=Se(na);{var ha=qt=>{var ra=Mr();o(qt,ra)};g(ma,qt=>{e(d),U(e(j)),i(()=>e(d).targetSucceededSave&&e(j).noDamageOnSave)&&qt(ha)},!0)}o(Ft,na)};g(Kt,Ft=>{e(d),U(e(j)),i(()=>e(d).targetSucceededSave&&e(j).halfDamageOnSave)?Ft(ea):Ft(Vt,!1)})}s(Gt),s(Tt),L(Ft=>C(va,` Target succeeded on ${Ft??""} save `),[()=>(U(e(j)),i(()=>e(j).ability.charAt(0).toUpperCase()+e(j).ability.slice(1)))]),Aa(Zt,()=>e(d).targetSucceededSave,Ft=>(e(d).targetSucceededSave=Ft,Wt(()=>(e(h),t(),v())))),o(Qe,Tt)};g(et,Qe=>{e(j)&&Qe(Ne)})}var Ht=a(et,2);{var Mt=Qe=>{var Tt=Ir(),Gt=l(Tt),Zt=l(Gt);Ce(Zt);var va=a(Zt,2);{var pa=Kt=>{const ea=kt(()=>(e(d),U(e(Y)),i(()=>me(e(d),e(Y)))));var Vt=Fr(),Ft=l(Vt);s(Vt),L(()=>C(Ft,`(${U(e(ke)),i(()=>e(ke).alternateDamage)??""}, total: ${e(ea)??""})`)),o(Kt,Vt)},da=Kt=>{var ea=Pr(),Vt=l(ea);s(ea),L(()=>C(Vt,`(${U(e(ke)),i(()=>e(ke).baseDamage)??""})`)),o(Kt,ea)};g(va,Kt=>{e(d),i(()=>e(d).targetIsDamaged)?Kt(pa):Kt(da,!1)})}s(Gt),s(Tt),Aa(Zt,()=>e(d).targetIsDamaged,Kt=>(e(d).targetIsDamaged=Kt,Wt(()=>(e(h),t(),v())))),o(Qe,Tt)};g(Ht,Qe=>{e(ke)&&Qe(Mt)})}var Ut=a(Ht,2);{var vt=Qe=>{const Tt=kt(()=>(U(e(Y)),i(()=>ge(e(Y)))));var Gt=yt(),Zt=Se(Gt);{var va=pa=>{var da=Or(),Kt=Se(da),ea=l(Kt),Vt=a(ea,2);L(()=>{e(d),Wt(()=>{e(Tt)})}),St(Vt,5,()=>e(Tt),jt,(qt,ra)=>{var at=Er(),xt=l(at);s(at);var Ct={};L(()=>{C(xt,`Level ${e(ra)??""}`),Ct!==(Ct=e(ra))&&(at.value=(at.__value=e(ra))??"")}),o(qt,at)}),s(Vt);var Ft=a(Vt,2);{var na=qt=>{const ra=kt(()=>(e(d),U(e(Y)),i(()=>me(e(d),e(Y)))));var at=Hr(),xt=l(at);{var Ct=oa=>{var Dt=Pt("Healing");o(oa,Dt)},zt=oa=>{var Dt=Pt("Damage");o(oa,Dt)};g(xt,oa=>{U(e(Y)),i(()=>pe(e(Y)))?oa(Ct):oa(zt,!1)})}var Et=a(xt);s(at),L(()=>C(Et,` ${e(ra)??""}`)),o(qt,at)};g(Ft,qt=>{e(d),U(e(Y)),i(()=>e(d).castAtLevel&&e(d).castAtLevel>e(Y).level)&&qt(na)})}s(Kt);var ma=a(Kt,2);{var ha=qt=>{var ra=Nr(),at=l(ra),xt=l(at);Ce(xt);var Ct=a(xt,2);{var zt=Et=>{const oa=kt(()=>(e(d),U(e(Y)),i(()=>me(e(d),e(Y)))));var Dt=Ur(),ia=l(Dt);s(Dt),L(()=>C(ia,`(+1d8, total: ${e(oa)??""})`)),o(Et,Dt)};g(Ct,Et=>{e(d),i(()=>e(d).targetIsFiendOrUndead)&&Et(zt)})}s(at),s(ra),Aa(xt,()=>e(d).targetIsFiendOrUndead,Et=>(e(d).targetIsFiendOrUndead=Et,Wt(()=>(e(h),t(),v())))),o(qt,ra)};g(ma,qt=>{U(e(Y)),i(()=>e(Y).description.includes("Fiend or an Undead"))&&qt(ha)})}L(()=>{it(ea,"for",`castLevel-${e(d),i(()=>e(d).id)??""}`),it(Vt,"id",`castLevel-${e(d),i(()=>e(d).id)??""}`)}),Ua(Vt,()=>e(d).castAtLevel,qt=>(e(d).castAtLevel=qt,Wt(()=>(e(h),t(),v())))),o(pa,da)};g(Zt,pa=>{U(e(Tt)),e(V),e(d),i(()=>e(Tt).length>0&&!e(V)[e(d).id])&&pa(va)})}o(Qe,Gt)};g(Ut,Qe=>{U(e(Y)),i(()=>e(Y).higherLevelSlot&&e(Y).level>0)&&Qe(vt)})}L(()=>{it(rt,"aria-label",(e(N),e(d),i(()=>e(N)[e(d).id]?"Expand":"Collapse"))),C(Je,(e(N),e(d),i(()=>e(N)[e(d).id]?"‚ñº":"‚ñ≤")))}),B("click",A,()=>ee(e(d).id)),B("keydown",A,Qe=>Qe.key==="Enter"&&ee(e(d).id)),o(aa,Me)},ta=aa=>{var j=qr();o(aa,j)};g(Ke,aa=>{e(Y)?aa(Rt):aa(ta,!1)})}o(lt,Xt)};g(Be,lt=>{e(w),i(()=>e(w).length===0)?lt(ct):lt(wt,!1)})}o(Ue,ue)};g(xe,Ue=>{e(d),i(()=>e(d).spellRef)&&Ue(be)})}var Ae=a(xe,2);{var qe=Ue=>{var ue=yt(),Be=Se(ue);{var ct=wt=>{var lt=zr(),Y=l(lt),Xt=a(Y,2);ja(Xt),s(lt),L(()=>{it(Y,"for",`attack-notes-${e(d),i(()=>e(d).id)??""}`),it(Xt,"id",`attack-notes-${e(d),i(()=>e(d).id)??""}`)}),Pe(Xt,()=>e(d).notes,Ke=>(e(d).notes=Ke,Wt(()=>(e(h),t(),v())))),o(wt,lt)};g(Be,wt=>{e(d),i(()=>e(d).notes&&e(d).notes.trim()!=="")&&wt(ct)})}o(Ue,ue)};g(Ae,Ue=>{e(d),i(()=>!e(d).spellRef)&&Ue(qe)})}var st=a(Ae,2),tt=l(st);{var he=Ue=>{const ue=kt(()=>(e(d),i(()=>b(e(d).spellRef))));var Be=yt(),ct=Se(Be);{var wt=lt=>{const Y=kt(()=>(t(),e(d),i(()=>t().racialTraits&&t().racialTraits.uses[e(d).name])));var Xt=ti(),Ke=Se(Xt);{var Rt=A=>{var rt=Wr(),Je=l(rt),gt=l(Je);Ce(gt);var ze=a(gt,2),et=l(ze);s(ze),s(Je),s(rt),L(()=>C(et,`(${U(e(Y)),i(()=>e(Y).currentUses)??""}/${U(e(Y)),i(()=>e(Y).maxUses)??""} uses left)`)),Aa(gt,()=>e(V)[e(d).id],Ne=>_a(V,e(V)[e(d).id]=Ne)),B("change",gt,()=>{n(V,{...e(V)})}),o(A,rt)};g(Ke,A=>{e(d),U(e(Y)),i(()=>e(d).source==="racial"&&e(Y))&&A(Rt)})}var ta=a(Ke,2);{var aa=A=>{var rt=yt(),Je=Se(rt);{var gt=et=>{var Ne=yt(),Ht=Se(Ne);{var Mt=vt=>{var Qe=Kr();B("click",Qe,()=>M(e(d),!1)),o(vt,Qe)},Ut=vt=>{var Qe=Vr();o(vt,Qe)};g(Ht,vt=>{t(),U(e(ue)),i(()=>t().classFeatures&&t().classFeatures.spellSlotsByLevel&&t().classFeatures.spellSlotsByLevel[e(ue).level]?.some(Qe=>!Qe))?vt(Mt):vt(Ut,!1)})}o(et,Ne)},ze=et=>{var Ne=yt(),Ht=Se(Ne);{var Mt=vt=>{var Qe=Jr();B("click",Qe,()=>M(e(d),!0)),o(vt,Qe)},Ut=vt=>{var Qe=Yr();o(vt,Qe)};g(Ht,vt=>{U(e(Y)),i(()=>e(Y)&&e(Y).currentUses>0)?vt(Mt):vt(Ut,!1)})}o(et,Ne)};g(Je,et=>{e(V),e(d),i(()=>!e(V)[e(d).id])?et(gt):et(ze,!1)})}o(A,rt)};g(ta,A=>{U(La),U(e(ue)),i(()=>La(e(ue)))&&A(aa)})}var j=a(ta,2);{var ke=A=>{var rt=yt(),Je=Se(rt);{var gt=et=>{var Ne=Qr(),Ht=l(Ne),Mt=l(Ht),Ut=l(Mt);Ce(Ut),Ut.value=Ut.__value="self",sa(),s(Mt);var vt=a(Mt,2),Qe=l(vt);Ce(Qe),Qe.value=Qe.__value="other",sa(),s(vt),s(Ht);var Tt=a(Ht,2),Gt=l(Tt);s(Tt),s(Ne),L(()=>{it(Ut,"name",`target-${e(d),i(()=>e(d).id)??""}`),it(Qe,"name",`target-${e(d),i(()=>e(d).id)??""}`),C(Gt,`Cast ${U(e(ue)),i(()=>e(ue).name)??""}`)}),Ds(P,[Ge],Ut,()=>e(R)[e(d).id],Zt=>_a(R,e(R)[e(d).id]=Zt)),Ds(P,[Ge],Qe,()=>e(R)[e(d).id],Zt=>_a(R,e(R)[e(d).id]=Zt)),B("click",Tt,()=>Xe(e(d),e(R)[e(d).id])),o(et,Ne)},ze=et=>{var Ne=Xr();B("click",Ne,()=>Xe(e(d),"self")),o(et,Ne)};g(Je,et=>{U(e(ue)),i(()=>Ie(e(ue).name))?et(gt):et(ze,!1)})}o(A,rt)};g(j,A=>{U(La),U(e(ue)),U(Va),i(()=>!La(e(ue))&&Va(e(ue)))&&A(ke)})}var Me=a(j,2);{var ft=A=>{var rt=yt(),Je=Se(rt);{var gt=et=>{var Ne=Zr(),Ht=l(Ne);{var Mt=vt=>{var Qe=Pt("Roll Healing");o(vt,Qe)},Ut=vt=>{var Qe=Pt("Roll Damage");o(vt,Qe)};g(Ht,vt=>{U(e(ue)),i(()=>pe(e(ue)))?vt(Mt):vt(Ut,!1)})}s(Ne),L(vt=>It(Ne,1,`btn ${vt??""}`),[()=>(U(e(ue)),i(()=>pe(e(ue))?"btn-success":"btn-secondary"))]),B("click",Ne,()=>T(e(d))),o(et,Ne)},ze=et=>{var Ne=ei();B("click",Ne,()=>Xe(e(d),"self")),o(et,Ne)};g(Je,et=>{e(d),i(()=>e(d).damage&&e(d).damage.trim()!=="")?et(gt):et(ze,!1)})}o(A,rt)};g(Me,A=>{U(La),U(e(ue)),U(Va),i(()=>!La(e(ue))&&!Va(e(ue)))&&A(ft)})}o(lt,Xt)};g(ct,lt=>{e(ue)&&lt(wt)})}o(Ue,Be)};g(tt,Ue=>{e(d),e(K),i(()=>e(d).spellRef&&e(K))&&Ue(he)})}var ae=a(tt,2);{var $t=Ue=>{var ue=si(),Be=Se(ue),ct=a(Be,2);{var wt=lt=>{var Y=ai();B("click",Y,()=>T(e(d))),o(lt,Y)};g(ct,lt=>{e(d),i(()=>e(d).damage&&e(d).damage.trim()!=="")&&lt(wt)})}B("click",Be,()=>M(e(d))),o(Ue,ue)};g(ae,Ue=>{e(d),i(()=>!e(d).spellRef)&&Ue($t)})}s(st),s(fe),L(()=>{it(x,"for",`attack-type-${e(d),i(()=>e(d).id)??""}`),it(q,"id",`attack-type-${e(d),i(()=>e(d).id)??""}`)}),Pe(q,()=>e(d).damageType,Ue=>(e(d).damageType=Ue,Wt(()=>(e(h),t(),v())))),o(W,fe)});var De=a(ie,2);{var $e=W=>{var d=ri();o(W,d)};g(De,W=>{t(),i(()=>t().attacks.length===0)&&W($e)})}var Te=a(De,2);{var Le=W=>{var d=ii();o(W,d)};g(Te,W=>{e(h),t(),i(()=>e(h).length===0&&t().attacks.length>0)&&W(Le)})}s(G);var $=a(G,2);{var Q=W=>{var d=di(),Ge=a(l(d),4);St(Ge,5,()=>e(y),jt,(fe,H)=>{var _e=vi(),Z=l(_e),je=l(Z),we=l(je,!0);s(je);var We=a(je,2),He=l(We);s(We),s(Z);var Ze=a(Z,2),dt=l(Ze,!0);s(Ze);var le=a(Ze,2),ut=l(le);{var Ve=Ae=>{var qe=ni(),st=l(qe),tt=a(st);{var he=ae=>{var $t=Pt();L(()=>C($t,`per ${e(H),i(()=>e(H).restType)??""} rest`)),o(ae,$t)};g(tt,ae=>{e(H),i(()=>e(H).restType)&&ae(he)})}s(qe),L(()=>C(st,`${e(H),i(()=>e(H).currentUses??e(H).usesPerRest)??""}/${e(H),i(()=>e(H).usesPerRest)??""} uses `)),o(Ae,qe)};g(ut,Ae=>{e(H),i(()=>e(H).usesPerRest)&&Ae(Ve)})}var x=a(ut,2);{var q=Ae=>{var qe=oi();o(Ae,qe)};g(x,Ae=>{e(H),i(()=>e(H).requiresReaction)&&Ae(q)})}var xe=a(x,2);{var be=Ae=>{var qe=ci();L(()=>qe.disabled=(e(H),i(()=>e(H).currentUses===void 0||e(H).currentUses===0))),B("click",qe,()=>X(e(H).conditionName,e(H).name)),o(Ae,qe)};g(xe,Ae=>{p(),e(H),i(()=>!p()&&e(H).usesPerRest)&&Ae(be)})}s(le),s(_e),L(()=>{C(we,(e(H),i(()=>e(H).name))),C(He,`(${e(H),i(()=>e(H).conditionName)??""})`),C(dt,(e(H),i(()=>e(H).description)))}),o(fe,_e)}),s(Ge),s(d),o(W,d)};g($,W=>{e(y),i(()=>e(y).length>0)&&W(Q)})}var oe=a($,2),Oe=a(l(oe),4),Fe=a(Oe,2);{var ht=W=>{var d=pi();St(d,5,()=>(t(),i(()=>t().activeStates)),jt,(Ge,fe,H)=>{var _e=fi(),Z=l(_e),je=l(Z);Ce(je);var we=a(je,2);{var We=ae=>{var $t=ui();B("click",$t,()=>de(H)),o(ae,$t)};g(we,ae=>{p()&&ae(We)})}s(Z);var He=a(Z,2),Ze=l(He),dt=l(Ze);it(dt,"for",`state-attack-bonus-${H}`);var le=a(dt,2);Ce(le),it(le,"id",`state-attack-bonus-${H}`),s(Ze);var ut=a(Ze,2),Ve=l(ut);it(Ve,"for",`state-damage-bonus-${H}`);var x=a(Ve,2);Ce(x),it(x,"id",`state-damage-bonus-${H}`),s(ut);var q=a(ut,2),xe=l(q);it(xe,"for",`state-target-${H}`);var be=a(xe,2);L(()=>{e(fe),Wt(()=>{})}),it(be,"id",`state-target-${H}`);var Ae=l(be);Ae.value=Ae.__value="self";var qe=a(Ae);qe.value=qe.__value="other",s(be),s(q),s(He);var st=a(He,2),tt=l(st);it(tt,"for",`state-desc-${H}`);var he=a(tt,2);Ce(he),it(he,"id",`state-desc-${H}`),s(st),s(_e),Pe(je,()=>e(fe).name,ae=>(e(fe).name=ae,Wt(()=>t()),Fa(m,"$character"))),Pe(le,()=>e(fe).attackBonus,ae=>(e(fe).attackBonus=ae,Wt(()=>t()),Fa(m,"$character"))),Pe(x,()=>e(fe).damageBonus,ae=>(e(fe).damageBonus=ae,Wt(()=>t()),Fa(m,"$character"))),Ua(be,()=>e(fe).target,ae=>(e(fe).target=ae,Wt(()=>t()),Fa(m,"$character"))),Pe(he,()=>e(fe).description,ae=>(e(fe).description=ae,Wt(()=>t()),Fa(m,"$character"))),o(Ge,_e)}),s(d),o(W,d)},ne=W=>{var d=mi();o(W,d)};g(Fe,W=>{t(),i(()=>t().activeStates&&t().activeStates.length>0)?W(ht):W(ne,!1)})}s(oe),B("click",Oe,ce),o(S,O)};g(ot,S=>{f(),i(()=>!f().attacks)&&S(Bt)})}s(pt);var At=a(pt,2);ur(At,{get show(){return e(I)},get attacks(){return t(),i(()=>t().attacks)},onSave:Ee,onCancel:Re}),L(()=>_t=It(pt,1,"attacks svelte-14o91c5",null,_t,{hidden:!e(z)})),o(r,nt),Qt(),k()}var _i=u('<span class="slot-checkbox-x svelte-serp1j">&#8212;</span>'),yi=u('<label><input type="checkbox" class="slot-checkbox-input svelte-serp1j"/> <span><!></span></label>');function Ms(r,c){Yt(c,!1);const t=()=>bt(wa,"$isEditMode",v),[v,f]=fa();let p=Lt(c,"checked",8,!1),m=Lt(c,"disabled",8,!1),k=Lt(c,"className",8,""),y=Lt(c,"index",8,void 0),h=Lt(c,"ariaLabel",8,void 0);const z=Sa();function P(I){z("change",{checked:I.currentTarget.checked,index:y()})}Jt();var V=yi(),X=l(V);Ce(X);var se=a(X,2),N=l(se);{var R=I=>{var ee=_i();o(I,ee)};g(N,I=>{p()&&I(R)})}s(se),s(V),L(()=>{It(V,1,"slot-checkbox-label "+k()+(t()?"":" not-editable"),"svelte-serp1j"),Us(X,p()),X.disabled=m()||!t(),it(X,"aria-label",h()),it(X,"tabindex",t()?0:-1),It(se,1,`slot-checkbox-custom ${p()?"used":""} ${t()?"":"readonly"}`,"svelte-serp1j")}),B("change",X,P),o(r,V),Qt(),f()}var xi=u('<span style="color:#007bff; margin-left:0.5em;"> </span>'),$i=u("<li><strong> </strong> <!></li>"),wi=u('<div class="racial-traits"><h4>Racial Traits</h4> <ul></ul></div>'),ki=u("<li> </li>"),Si=u('<div class="racial-resistances"><h4>Racial Resistances</h4> <ul></ul></div>'),Ci=u("<!> <!>",1);function Di(r,c){Yt(c,!1);const t=()=>bt(ve,"$character",v),[v,f]=fa(),p=D(),m=D();let k=D(),y=D();ka(()=>{t().race&&t().level&&(ws(),rs(),n(k,t().race),n(y,t().level))}),Ye(()=>(t(),e(k),e(y),rs),()=>{t().race&&t().level&&(t().race!==e(k)||t().level!==e(y))&&(ws(),rs(),n(k,t().race),n(y,t().level))}),Ye(()=>(t(),Ja),()=>{n(p,(()=>{const se=t().activeStates?t().activeStates.filter(I=>I.name&&I.name.toLowerCase().includes("racial")).flatMap(I=>I.resistances||[]):[],N=Ja(t().race||""),R=N?N.traits.flatMap(I=>I.resistances||[]):[];return Array.from(new Set([...se,...R]))})())}),Ye(()=>t(),()=>{n(m,(()=>{const se=Ja(t().race||"");return se?se.traits:[]})())}),ga(),Jt();var h=Ci(),z=Se(h);{var P=se=>{var N=wi(),R=a(l(N),2);St(R,5,()=>e(m),jt,(I,ee)=>{var pe=$i(),Ie=l(pe),re=l(Ie);s(Ie);var te=a(Ie),ye=a(te);{var Re=Ee=>{var M=xi(),T=l(M);s(M),L(w=>C(T,`(Resistances: ${w??""})`),[()=>(e(ee),i(()=>e(ee).resistances.map(w=>w.charAt(0).toUpperCase()+w.slice(1)).join(", ")))]),o(Ee,M)};g(ye,Ee=>{e(ee),i(()=>e(ee).resistances&&e(ee).resistances.length>0)&&Ee(Re)})}s(pe),L(()=>{C(re,`${e(ee),i(()=>e(ee).name)??""}:`),C(te,` ${e(ee),i(()=>e(ee).description)??""} `)}),o(I,pe)}),s(R),s(N),o(se,N)};g(z,se=>{e(m),i(()=>e(m).length>0)&&se(P)})}var V=a(z,2);{var X=se=>{var N=Si(),R=a(l(N),2);St(R,5,()=>e(p),jt,(I,ee)=>{var pe=ki(),Ie=l(pe,!0);s(pe),L(re=>C(Ie,re),[()=>(e(ee),i(()=>e(ee).charAt(0).toUpperCase()+e(ee).slice(1)))]),o(I,pe)}),s(R),s(N),o(se,N)};g(V,se=>{e(p),i(()=>e(p).length>0)&&se(X)})}o(r,h),Qt(),f()}var Li=u('<p class="no-features svelte-1kpvv0n">Select a class to see available features</p>'),Ai=u('<p class="no-features svelte-1kpvv0n">No class features available at this level</p>'),ji=u('<div class="spell-slots svelte-1kpvv0n"><label class="svelte-1kpvv0n"> </label> <div class="slots-tracker svelte-1kpvv0n"></div></div>'),Bi=u('<div class="all-spell-slots"></div>'),Ri=u('<div class="feature-box spellcasting svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"> </h3> <div class="spell-stats svelte-1kpvv0n"><div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Spell Save DC</label> <div class="spell-value svelte-1kpvv0n"> </div></div> <div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <div class="spell-value svelte-1kpvv0n"> </div></div></div> <!> <div class="prepared-spells svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <textarea placeholder="List your prepared spells..." class="svelte-1kpvv0n"></textarea></div></div>'),Mi=u('<p class="unlimited svelte-1kpvv0n">Unlimited Uses</p>'),Ti=u('<div class="slots-tracker svelte-1kpvv0n"></div> <div class="uses-actions-row"><button class="btn btn-primary use-enabled"> </button></div> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div>',1),Fi=u('<div class="uses-tracker svelte-1kpvv0n"><!></div>'),Pi=u('<div class="pool-tracker svelte-1kpvv0n"><input type="number" min="0" class="pool-input svelte-1kpvv0n"/> <span> </span> <button class="btn-small svelte-1kpvv0n"> </button></div>'),Ii=u('<p class="no-uses svelte-1kpvv0n">No Channel Divinity uses remaining</p>'),Ei=u('<div class="channel-divinity-option svelte-1kpvv0n"><button class="btn btn-primary use-enabled svelte-1kpvv0n">Use Channel Divinity</button> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div> <!></div>'),Hi=u('<div class="feature-box svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"><!> </h3> <p class="feature-description svelte-1kpvv0n"> </p> <!></div>'),Ui=u('<div class="features-grid svelte-1kpvv0n"><!> <!></div>'),Ni=u("<!> <!>",1),Oi=u("<section><!> <!></section>");function Gi(r,c){Yt(c,!1);const t=()=>bt(ve,"$character",m),v=()=>bt(Xa,"$abilityModifiers",m),f=()=>bt(xa,"$searchFilter",m),p=()=>bt(la,"$collapsedStates",m),[m,k]=fa(),y=D(),h=D(),z=D(),P=D(),V=D(),X=D(),se=D();let N=D(0),R=D(0);function I(b,F){ve.update(J=>(J.classFeatures.features[b]=F,J))}function ee(){ve.update(b=>(b.classFeatures.spellSlotsByLevel||(b.classFeatures.spellSlotsByLevel={}),e(P).forEach(({level:F,slots:J})=>{b.classFeatures.spellSlotsByLevel[F]||(b.classFeatures.spellSlotsByLevel[F]=Array(J).fill(!1))}),b))}function pe(b){if(typeof b.maxUses=="function"){if((b.name==="Divine Sense"||b.name==="War Priest")&&e(y)?.spellcastingAbility){const F=v()[e(y).spellcastingAbility];return b.maxUses(t().level,F)}return b.maxUses(t().level)}return b.maxUses||0}function Ie(b,F){ve.update(J=>((!J.classFeatures.features[b]||!Array.isArray(J.classFeatures.features[b])||J.classFeatures.features[b].length!==F)&&(J.classFeatures.features[b]=Array(F).fill(!1)),J))}Vs(()=>{e(X)&&t()&&t().classFeatures&&t().classFeatures.features&&e(X).forEach(b=>{if(b.type==="uses"){const F=b.name.replace(/\s+/g,""),J=pe(b),me=t().classFeatures.features[F];(!Array.isArray(me)||me.length!==J)&&Ie(F,J)}})});function re(b){return typeof b.maxPool=="function"?b.maxPool(t().level):b.maxPool||0}function te(b){return typeof b.description=="function"?b.description(t().level):b.description}function ye(){const b="ChannelDivinity";ve.update(F=>{const J=F.classFeatures.features[b];return typeof J=="number"&&J>0&&(F.classFeatures.features[b]=J-1),F})}function Re(){la.update(b=>({...b,classFeatures:!b.classFeatures}))}Ye(()=>(t(),ua),()=>{n(y,t().class?ua(t().class):null)}),Ye(()=>(t(),Ma),()=>{n(h,t().class?Ma(t().class,t().level,t().subclass):[])}),Ye(()=>(t(),js),()=>{n(z,t().class?js(t().class,t().level):0)}),Ye(()=>(e(y),t()),()=>{n(P,(()=>{if(!e(y)?.spellcaster)return[];const b=t().level,F=[];return b>=1&&F.push({level:1,slots:Math.min(4,2+Math.floor(b/3))}),b>=3&&F.push({level:2,slots:Math.min(3,2+Math.floor((b-3)/4))}),b>=5&&F.push({level:3,slots:Math.min(3,2+Math.floor((b-5)/5))}),b>=7&&F.push({level:4,slots:Math.min(3,1+Math.floor((b-7)/6))}),b>=9&&F.push({level:5,slots:Math.min(2,1+Math.floor((b-9)/8))}),b>=11&&F.push({level:6,slots:1}),b>=13&&F.push({level:7,slots:1}),b>=15&&F.push({level:8,slots:1}),b>=17&&F.push({level:9,slots:1}),F})())}),Ye(()=>(e(y),v(),t(),Bs),()=>{if(e(y)?.spellcaster&&e(y).spellcastingAbility){const b=v()[e(y).spellcastingAbility];n(N,Ll(t().class,b,t().proficiencyBonus)||0),n(R,Bs(t().class,t().level,b))}}),Ye(()=>(t(),e(y),e(P)),()=>{t().class&&e(y)?.spellcaster&&e(P).length>0&&ee()}),Ye(()=>t(),()=>{n(V,(()=>{const F=t().classFeatures.features["ChannelDivinity"];return typeof F=="number"?F:0})())}),Ye(()=>(e(h),f()),()=>{n(X,e(h).filter(b=>{if(!f())return!0;const F=f().toLowerCase();return b.name.toLowerCase().includes(F)||te(b).toLowerCase().includes(F)}))}),Ye(()=>(f(),t(),e(X)),()=>{n(se,!f()||t().class||"class features".includes(f().toLowerCase())||"spellcasting".includes(f().toLowerCase())||e(X).length>0)}),ga(),Jt();var Ee=Oi();let M;var T=l(Ee);{let b=kt(()=>(p(),i(()=>p().classFeatures?"Expand":"Collapse")));Ca(T,{title:"Class Features",get collapsed(){return p(),i(()=>p().classFeatures)},get ariaLabel(){return e(b)},onToggle:Re})}var w=a(T,2);{var K=b=>{var F=Ni(),J=Se(F);Di(J,{});var me=a(J,2);{var ge=de=>{var Xe=Li();o(de,Xe)},ce=de=>{var Xe=yt(),nt=Se(Xe);{var pt=mt=>{var ot=Ai();o(mt,ot)},_t=mt=>{var ot=Ui(),Bt=l(ot);{var At=O=>{var _=Ri(),E=l(_),G=l(E);s(E);var ie=a(E,2),De=l(ie),$e=a(l(De),2),Te=l($e,!0);s($e),s(De);var Le=a(De,2),$=a(l(Le),2),Q=l($,!0);s($),s(Le),s(ie);var oe=a(ie,2);{var Oe=ne=>{var W=Bi();St(W,5,()=>e(P),jt,(d,Ge)=>{let fe=()=>e(Ge).level,H=()=>e(Ge).slots;const _e=kt(()=>(t(),fe(),H(),i(()=>t().classFeatures.spellSlotsByLevel?.[fe()]||Array(H()).fill(!1))));var Z=ji(),je=l(Z),we=l(je);s(je);var We=a(je,2);St(We,5,()=>e(_e),jt,(He,Ze,dt)=>{{let le=kt(()=>(U(e(_e)),i(()=>e(_e)[dt]||!1)));Ms(He,{get checked(){return e(le)},$$events:{change:ut=>{ve.update(Ve=>(Ve.classFeatures.spellSlotsByLevel||(Ve.classFeatures.spellSlotsByLevel={}),Ve.classFeatures.spellSlotsByLevel[fe()]||(Ve.classFeatures.spellSlotsByLevel[fe()]=Array(H()).fill(!1)),Ve.classFeatures.spellSlotsByLevel[fe()][dt]=ut.detail.checked,Ve))}}})}}),s(We),s(Z),L(()=>C(we,`${fe()===1?"1st":fe()===2?"2nd":fe()===3?"3rd":`${fe()}th`} Level Spell Slots`)),o(d,Z)}),s(W),o(ne,W)};g(oe,ne=>{e(P),i(()=>e(P).length>0)&&ne(Oe)})}var Fe=a(oe,2),ht=a(l(Fe),2);ja(ht),s(Fe),s(_),L(ne=>{C(G,`Spellcasting (${ne??""})`),C(Te,e(N)),C(Q,e(R))},[()=>(e(y),i(()=>e(y).spellcastingAbility?.toUpperCase()))]),Pe(ht,()=>t().classFeatures.preparedSpells,ne=>Nt(ve,i(t).classFeatures.preparedSpells=ne,i(t))),o(O,_)};g(Bt,O=>{e(y),i(()=>e(y)?.spellcaster)&&O(At)})}var S=a(Bt,2);St(S,1,()=>e(X),jt,(O,_)=>{const E=kt(()=>(e(_),i(()=>e(_).name.replace(/\s+/g,"")))),G=kt(()=>(t(),U(e(E)),i(()=>t().classFeatures.features[e(E)]))),ie=kt(()=>typeof e(G)=="number");var De=Hi(),$e=l(De),Te=l($e);{var Le=ne=>{var W=Pt("Channel Divinity:");o(ne,W)};g(Te,ne=>{e(_),i(()=>e(_).type==="channelDivinity")&&ne(Le)})}var $=a(Te);s($e);var Q=a($e,2),oe=l(Q,!0);s(Q);var Oe=a(Q,2);{var Fe=ne=>{const W=kt(()=>(e(_),i(()=>pe(e(_))))),d=kt(()=>(U(e(G)),U(e(W)),i(()=>Array.isArray(e(G))?e(G):Array(e(W)).fill(!1))));var Ge=Fi(),fe=l(Ge);{var H=Z=>{var je=Mi();o(Z,je)},_e=Z=>{var je=Ti(),we=Se(je);St(we,5,()=>e(d),jt,(Ve,x,q)=>{Ms(Ve,{get checked(){return e(x)},index:q,$$events:{change:xe=>{ve.update(be=>(be.classFeatures.features[e(E)]||(be.classFeatures.features[e(E)]=Array(e(W)).fill(!1)),be.classFeatures.features[e(E)][q]=xe.detail.checked,be))}}})}),s(we);var We=a(we,2),He=l(We),Ze=l(He);s(He),s(We);var dt=a(We,2),le=l(dt),ut=l(le);s(le),s(dt),L(Ve=>{He.disabled=Ve,C(Ze,`Use ${e(_),i(()=>e(_).name)??""}`),C(ut,`Resets on ${e(_),i(()=>e(_).resetOn==="short"?"Short Rest":"Long Rest")??""}`)},[()=>(U(e(d)),i(()=>e(d).filter(Ve=>!Ve).length<=0))]),B("click",He,()=>{ve.update(Ve=>{Ve.classFeatures.features[e(E)]||(Ve.classFeatures.features[e(E)]=Array(e(W)).fill(!1));const x=Ve.classFeatures.features[e(E)],q=x.findIndex(xe=>!xe);return q!==-1&&(x[q]=!0),Ve})}),o(Z,je)};g(fe,Z=>{e(W)===1/0?Z(H):Z(_e,!1)})}s(Ge),o(ne,Ge)},ht=ne=>{var W=yt(),d=Se(W);{var Ge=H=>{const _e=kt(()=>(e(_),i(()=>re(e(_)))));var Z=Pi(),je=l(Z);Ce(je);var we=a(je,2),We=l(we);s(we);var He=a(we,2),Ze=l(He,!0);s(He),s(Z),L(()=>{Ea(je,e(ie)&&e(G)!==void 0?e(G):e(_e)),it(je,"max",e(_e)),C(We,`/ ${e(_e)??""}`),C(Ze,(e(_),i(()=>e(_).resetOn==="short"?"Short Rest":"Long Rest")))}),B("input",je,dt=>{ve.update(le=>(le.classFeatures.features[e(E)]=parseInt(dt.currentTarget.value)||0,le))}),B("click",He,()=>I(e(E),e(_e))),o(H,Z)},fe=H=>{var _e=yt(),Z=Se(_e);{var je=we=>{var We=Ei(),He=l(We),Ze=a(He,2),dt=l(Ze),le=l(dt);s(dt),s(Ze);var ut=a(Ze,2);{var Ve=x=>{var q=Ii();o(x,q)};g(ut,x=>{e(V)<=0&&x(Ve)})}s(We),L(()=>{He.disabled=e(V)<=0,C(le,`Resets on ${e(_),i(()=>e(_).resetOn==="short"?"Short Rest":"Long Rest")??""}`)}),B("click",He,ye),o(we,We)};g(Z,we=>{e(_),i(()=>e(_).type==="channelDivinity")&&we(je)},!0)}o(H,_e)};g(d,H=>{e(_),i(()=>e(_).type==="pool")?H(Ge):H(fe,!1)},!0)}o(ne,W)};g(Oe,ne=>{e(_),i(()=>e(_).type==="uses")?ne(Fe):ne(ht,!1)})}s(De),L(ne=>{C($,` ${e(_),i(()=>e(_).name)??""}`),C(oe,ne)},[()=>(e(_),i(()=>te(e(_))))]),o(O,De)}),s(ot),o(mt,ot)};g(nt,mt=>{e(h),i(()=>e(h).length===0)?mt(pt):mt(_t,!1)},!0)}o(de,Xe)};g(me,de=>{t(),i(()=>!t().class)?de(ge):de(ce,!1)})}o(b,F)};g(w,b=>{p(),i(()=>!p().classFeatures)&&b(K)})}s(Ee),L(()=>M=It(Ee,1,"class-features svelte-1kpvv0n",null,M,{hidden:!e(se)})),o(r,Ee),Qt(),k()}var qi=u('<textarea placeholder="Enter features, traits, and special abilities..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Equipment</h3> <textarea placeholder="List your equipment and inventory..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Notes</h3> <textarea placeholder="Additional notes..." class="svelte-wttn0l"></textarea>',1),zi=u("<section><!> <!></section>");function Wi(r,c){Yt(c,!1);const t=()=>bt(xa,"$searchFilter",p),v=()=>bt(ve,"$character",p),f=()=>bt(la,"$collapsedStates",p),[p,m]=fa(),k=D();function y(){la.update(se=>({...se,notes:!se.notes}))}Ye(()=>(t(),v()),()=>{n(k,!t()||"features".includes(t().toLowerCase())||"traits".includes(t().toLowerCase())||"equipment".includes(t().toLowerCase())||"notes".includes(t().toLowerCase())||v().features.toLowerCase().includes(t().toLowerCase())||v().equipment.toLowerCase().includes(t().toLowerCase())||v().notes.toLowerCase().includes(t().toLowerCase()))}),ga(),Jt();var h=zi();let z;var P=l(h);{let se=kt(()=>(f(),i(()=>f().notes?"Expand":"Collapse")));Ca(P,{title:"Features & Traits",get collapsed(){return f(),i(()=>f().notes)},get ariaLabel(){return e(se)},onToggle:y})}var V=a(P,2);{var X=se=>{var N=qi(),R=Se(N);ja(R);var I=a(R,4);ja(I);var ee=a(I,4);ja(ee),Pe(R,()=>v().features,pe=>Nt(ve,i(v).features=pe,i(v))),Pe(I,()=>v().equipment,pe=>Nt(ve,i(v).equipment=pe,i(v))),Pe(ee,()=>v().notes,pe=>Nt(ve,i(v).notes=pe,i(v))),o(se,N)};g(V,se=>{f(),i(()=>!f().notes)&&se(X)})}s(h),L(()=>z=It(h,1,"notes svelte-wttn0l",null,z,{hidden:!e(k)})),o(r,h),Qt(),m()}var Ki=u(" <!> <!> <!> <!> <!>",1),Vi=u('<div class="color-picker-section svelte-1r90jgp"><h3 class="svelte-1r90jgp">Dice Colors</h3> <div class="color-inputs svelte-1r90jgp"><div class="color-input-group svelte-1r90jgp"><label for="dice-color" class="svelte-1r90jgp">Dice Color</label> <input type="color" id="dice-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="label-color" class="svelte-1r90jgp">Label Color</label> <input type="color" id="label-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="desk-color" class="svelte-1r90jgp">Background Color</label> <input type="color" id="desk-color" class="svelte-1r90jgp"/></div></div></div>'),Ji=u('<div class="loading svelte-1r90jgp"><p class="svelte-1r90jgp">Loading 3D dice...</p></div>'),Yi=u('<div class="custom-dice-selector svelte-1r90jgp"><h3 class="svelte-1r90jgp">Choose Dice to Roll</h3> <div class="dice-inputs svelte-1r90jgp"><div class="dice-input-group svelte-1r90jgp"><label for="d4" class="svelte-1r90jgp">d4</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d4" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d6" class="svelte-1r90jgp">d6</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d6" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d8" class="svelte-1r90jgp">d8</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d8" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d10" class="svelte-1r90jgp">d10</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d10" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d12" class="svelte-1r90jgp">d12</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d12" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d20" class="svelte-1r90jgp">d20</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d20" min="0" max="10"/></div></div> <div class="dice-controls svelte-1r90jgp"><button class="btn btn-primary use-enabled svelte-1r90jgp"> </button> <button class="btn btn-secondary use-enabled svelte-1r90jgp">Reset</button></div></div>'),Qi=u('<h3 class="svelte-1r90jgp"> </h3>'),Xi=u('<h3 class="svelte-1r90jgp"> </h3>'),Zi=u('<h3 class="svelte-1r90jgp"> </h3>'),en=u('<h3 class="svelte-1r90jgp"> </h3>'),tn=u('<span class="crit-badge svelte-1r90jgp">CRITICAL HIT!</span>'),an=u('<span class="crit-badge crit-fail svelte-1r90jgp">CRITICAL MISS!</span>'),sn=u('<div class="bonus-item svelte-1r90jgp"><span class="bonus-value svelte-1r90jgp"> </span> <span class="bonus-source svelte-1r90jgp"> </span></div>'),ln=u('<div class="bonus-breakdown svelte-1r90jgp"></div>'),rn=u('<p class="modifier-text svelte-1r90jgp"> </p>'),nn=u('<div class="svelte-1r90jgp"><em class="svelte-1r90jgp">No damage is dealt on a critical miss.</em></div>'),on=u('<button class="btn btn-follow-up svelte-1r90jgp"> </button>'),cn=u('<button class="btn btn-guided-strike svelte-1r90jgp">‚ö° Use Guided Strike (+10)</button>'),vn=u('<div class="follow-up-actions svelte-1r90jgp"><!> <!></div>'),dn=u('<div class="result-header svelte-1r90jgp"><!> <!> <!></div> <div class="result-total svelte-1r90jgp"> </div> <div class="result-details svelte-1r90jgp"><!></div> <!> <!>',1),un=u('<div role="button" tabindex="-1"><div class="modal-content svelte-1r90jgp" role="dialog" tabindex="0"><div class="modal-header svelte-1r90jgp"><h2 class="svelte-1r90jgp"><!></h2> <div class="header-buttons svelte-1r90jgp"><button class="color-btn svelte-1r90jgp" title="Customize dice colors">üé®</button> <button class="close-btn svelte-1r90jgp">√ó</button></div></div> <!> <!> <div class="dice-main-area svelte-1r90jgp"><div class="dice-container svelte-1r90jgp"></div> <!></div> <div><!></div></div></div>');function fn(r,c){Yt(c,!1);const t=()=>bt(ve,"$character",v),[v,f]=fa(),p=D(),m=D(),k=D(),y=Sa();let h=Lt(c,"notation",12,""),z=Lt(c,"visible",8,!1),P=Lt(c,"damageNotation",12,""),V=Lt(c,"damageType",8,""),X=Lt(c,"attackName",12,""),se=Lt(c,"applyHalfDamage",8,!1),N=Lt(c,"bonusBreakdown",28,()=>[]),R=Lt(c,"rollType",12,"other"),I=Lt(c,"damageBreakdown",24,()=>[]),ee=null,pe=D(void 0),Ie=D(!1),re=D(""),te=D(null),ye=D("");function Re(){return e(te)?.resultTotal??null}function Ee(x,q,xe){const be=[];if(!x||!x.result)return be;const Ae=q.match(/([+-]?\d*d\d+|[+-]?\d+)/g)||[];let qe=0;const st=new Set;let tt=!0;for(const he of Ae){const ae=he.trim();if(!ae)continue;const $t=ae.match(/([+-]?)(\d*)d(\d+)/);if($t){const Ue=parseInt($t[2]||"1"),ue=`${Ue}d${$t[3]}`,Be=xe.findIndex((lt,Y)=>!st.has(Y)&&typeof lt.value=="string"&&lt.value===ue),ct=[];for(let lt=0;lt<Ue&&qe<x.result.length;lt++)ct.push(x.result[qe++]);let wt;Be>=0?(wt=xe[Be].source,st.add(Be)):wt="base";for(const lt of ct)be.push({display:`${lt}`,source:wt});tt=!1}}for(let he=0;he<xe.length;he++)if(!st.has(he)&&typeof xe[he].value=="number"){const ae=xe[he].value;be.push({display:ae>=0?`+${ae}`:`${ae}`,source:xe[he].source})}return be}let M=D(0),T=D(0),w=D(0),K=D(0),b=D(0),F=D(0),J=D(0),me=D([]),ge=D(!1),ce=D(!1),de=D(!1),Xe=D("#051e0a"),nt=D("#ffffff"),pt=D("#3a2004"),_t=D(!1);function mt(x){return x.length===9&&x.startsWith("#")?x.substring(0,7):x}function ot(x,q="ff"){return x.length===7&&x.startsWith("#")?x+q:x}function Bt(){if(window.DICE&&e(pe))try{ee&&e(pe)&&_a(pe,e(pe).innerHTML="");const x=e(pe).clientWidth||500,q=e(pe).clientHeight||300;ee=new window.DICE.dice_box(e(pe),{w:x,h:q}),n(Ie,!0)}catch(x){console.error("Error initializing dice box:",x)}}ka(()=>{const x=be=>new Promise((Ae,qe)=>{if(document.querySelector(`script[src="${be}"]`)){Ae(null);return}const tt=document.createElement("script");tt.src=be,tt.onload=()=>{Ae(null)},tt.onerror=()=>{console.error(`Failed to load: ${be}`),qe(new Error(`Failed to load ${be}`))},document.head.appendChild(tt)});setTimeout(()=>{x(`${Pa}/libs/three.min.js`).then(()=>x(`${Pa}/libs/cannon.min.js`)).then(()=>x(`${Pa}/libs/teal.js`)).then(()=>x(`${Pa}/dice.js`)).then(()=>{if(window.DICE){const be=window.DICE.getColors();n(Xe,mt(be.dice_color)),n(nt,mt(be.label_color)),n(pt,mt(be.desk_color))}Bt()}).catch(be=>{console.error("Failed to load dice libraries:",be)})},100);const q=()=>{e(Ie)&&Bt()},xe=be=>{z()&&be.key==="Escape"&&$e()};return window.addEventListener("resize",q),window.addEventListener("keydown",xe),()=>{window.removeEventListener("resize",q),window.removeEventListener("keydown",xe)}});function At(x,q="other"){if(!ee||!e(Ie))return;n(te,null),n(me,[]),n(ge,!1),n(ce,!1),R(q),n(de,!1),n(ye,x),ee.diceToRoll=x;const xe=Ae=>null,be=Ae=>{let qe=Ae.resultTotal,st=Ae.resultString;if(se()&&(qe=Math.floor(qe/2),st=st+" (halved)"),n(te,{...Ae,resultTotal:qe,resultString:st}),q==="attack"&&Ae.result&&Ae.result.length>0){const tt=Ae.result[0];n(ge,tt===20),n(ce,tt===1)}if(n(me,[]),q==="attack"&&P())if(e(ge)){const tt=_(P()),he=I().map(ae=>{if(typeof ae.value=="string"&&ae.value.match(/^\d+d\d+$/)){const $t=_(ae.value);return{...ae,value:$t}}return ae});e(me).push({label:`Roll Critical Damage (${tt})`,notation:tt,breakdown:he})}else e(ce)||e(me).push({label:`Roll Damage (${P()})`,notation:P(),breakdown:I()})};ee.start_throw(xe,be)}function S(){const x=[];e(M)>0&&x.push(`${e(M)}d4`),e(T)>0&&x.push(`${e(T)}d6`),e(w)>0&&x.push(`${e(w)}d8`),e(K)>0&&x.push(`${e(K)}d10`),e(b)>0&&x.push(`${e(b)}d12`),e(F)>0&&x.push(`${e(F)}d20`);let q=x.join("+")||"1d20";return e(J)!==0&&(q+=e(J)>=0?`+${e(J)}`:`${e(J)}`),q}function O(){const x=S();At(x)}function _(x){return x.replace(/(\d+)d(\d+)/g,(q,xe,be)=>`${parseInt(xe)*2}d${be}`)}function E(){n(M,0),n(T,0),n(w,0),n(K,0),n(b,0),n(F,0),n(J,0),n(te,null),n(me,[]),n(ge,!1),n(ce,!1),R("other"),n(de,!1)}function G(){window.DICE&&(window.DICE.setColors({dice_color:ot(e(Xe),"ff"),label_color:ot(e(nt),"ff"),desk_color:e(pt)}),ee&&(ee.updateDeskColor(e(pt)),ee.updateDiceColors()))}function ie(){n(_t,!e(_t))}function De(){!e(te)||e(m)<=0||e(de)||(n(te,{...e(te),resultTotal:e(te).resultTotal+10,resultString:e(te).resultString+" + 10 (Guided Strike)"}),N([...N(),{value:10,source:"Guided Strike"}]),ve.update(x=>{const q="ChannelDivinity",xe=x.classFeatures.features[q];return typeof xe=="number"&&xe>0&&(x.classFeatures.features[q]=xe-1),x}),n(de,!0))}function $e(){y("close"),h(""),P(""),X(""),n(re,""),n(te,null),n(de,!1),n(ge,!1),n(ce,!1),E()}Ye(()=>(t(),Ma),()=>{n(p,t().class?Ma(t().class,t().level,t().subclass).some(q=>q.name==="Guided Strike"):!1)}),Ye(()=>t(),()=>{n(m,(()=>{const q=t().classFeatures.features["ChannelDivinity"];return typeof q=="number"?q:0})())}),Ye(()=>(e(M),e(T),e(w),e(K),e(b),e(F),e(J)),()=>{n(k,(()=>{const x=[];e(M)>0&&x.push(`${e(M)}d4`),e(T)>0&&x.push(`${e(T)}d6`),e(w)>0&&x.push(`${e(w)}d8`),e(K)>0&&x.push(`${e(K)}d10`),e(b)>0&&x.push(`${e(b)}d12`),e(F)>0&&x.push(`${e(F)}d20`);let q=x.join("+")||"1d20";return e(J)!==0&&(q+=e(J)>=0?`+${e(J)}`:`${e(J)}`),q})())}),Ye(()=>(U(h()),e(Ie),U(z()),e(re),U(R())),()=>{h()&&e(Ie)&&z()&&h()!==e(re)&&(n(re,h()),n(te,null),n(me,[]),n(ge,!1),n(ce,!1),n(de,!1),setTimeout(()=>At(h(),R()),200))}),ga();var Te={getLastRollTotal:Re};Jt();var Le=un();let $;var Q=l(Le),oe=l(Q),Oe=l(oe),Fe=l(Oe);{var ht=x=>{var q=Ki(),xe=Se(q),be=a(xe);{var Ae=Be=>{var ct=Pt("- Attack Roll");o(Be,ct)};g(be,Be=>{R()==="attack"&&Be(Ae)})}var qe=a(be,2);{var st=Be=>{var ct=Pt("- Damage Roll");o(Be,ct)};g(qe,Be=>{R()==="damage"&&Be(st)})}var tt=a(qe,2);{var he=Be=>{var ct=Pt("- Healing Roll");o(Be,ct)};g(tt,Be=>{R()==="healing"&&Be(he)})}var ae=a(tt,2);{var $t=Be=>{var ct=Pt("- Ability Check");o(Be,ct)};g(ae,Be=>{R()==="check"&&Be($t)})}var Ue=a(ae,2);{var ue=Be=>{var ct=Pt("- Saving Throw");o(Be,ct)};g(Ue,Be=>{R()==="save"&&Be(ue)})}L(()=>C(xe,`${X()??""} `)),o(x,q)},ne=x=>{var q=Pt("Dice Roller");o(x,q)};g(Fe,x=>{X()?x(ht):x(ne,!1)})}s(Oe);var W=a(Oe,2),d=l(W),Ge=a(d,2);s(W),s(oe);var fe=a(oe,2);{var H=x=>{var q=Vi(),xe=a(l(q),2),be=l(xe),Ae=a(l(be),2);Ce(Ae),s(be);var qe=a(be,2),st=a(l(qe),2);Ce(st),s(qe);var tt=a(qe,2),he=a(l(tt),2);Ce(he),s(tt),s(xe),s(q),Pe(Ae,()=>e(Xe),ae=>n(Xe,ae)),B("change",Ae,G),Pe(st,()=>e(nt),ae=>n(nt,ae)),B("change",st,G),Pe(he,()=>e(pt),ae=>n(pt,ae)),B("change",he,G),o(x,q)};g(fe,x=>{e(_t)&&x(H)})}var _e=a(fe,2);{var Z=x=>{var q=Ji();o(x,q)};g(_e,x=>{e(Ie)||x(Z)})}var je=a(_e,2),we=l(je);Ha(we,x=>n(pe,x),()=>e(pe));var We=a(we,2);{var He=x=>{var q=Yi(),xe=a(l(q),2),be=l(xe),Ae=a(l(be),2);Ce(Ae),s(be);var qe=a(be,2),st=a(l(qe),2);Ce(st),s(qe);var tt=a(qe,2),he=a(l(tt),2);Ce(he),s(tt);var ae=a(tt,2),$t=a(l(ae),2);Ce($t),s(ae);var Ue=a(ae,2),ue=a(l(Ue),2);Ce(ue),s(Ue);var Be=a(Ue,2),ct=a(l(Be),2);Ce(ct),s(Be),s(xe);var wt=a(xe,2),lt=l(wt),Y=l(lt);s(lt);var Xt=a(lt,2);s(wt),s(q),L(()=>{lt.disabled=!e(Ie),C(Y,`Roll ${e(k)??""}`)}),Pe(Ae,()=>e(M),Ke=>n(M,Ke)),Pe(st,()=>e(T),Ke=>n(T,Ke)),Pe(he,()=>e(w),Ke=>n(w,Ke)),Pe($t,()=>e(K),Ke=>n(K,Ke)),Pe(ue,()=>e(b),Ke=>n(b,Ke)),Pe(ct,()=>e(F),Ke=>n(F,Ke)),B("click",lt,O),B("click",Xt,E),o(x,q)};g(We,x=>{h()||x(He)})}s(je);var Ze=a(je,2);let dt;var le=l(Ze);{var ut=x=>{var q=dn(),xe=Se(q),be=l(xe);{var Ae=Ke=>{var Rt=Qi(),ta=l(Rt,!0);s(Rt),L(()=>C(ta,X()?`${X()} - Healing`:"Healing")),o(Ke,Rt)},qe=Ke=>{var Rt=yt(),ta=Se(Rt);{var aa=ke=>{var Me=Xi(),ft=l(Me,!0);s(Me),L(()=>C(ft,X()?`${X()} - ${V()} Damage`:`${V()} Damage`)),o(ke,Me)},j=ke=>{var Me=yt(),ft=Se(Me);{var A=Je=>{var gt=Zi(),ze=l(gt,!0);s(gt),L(()=>C(ze,X()?`${X()} - Damage`:"Damage")),o(Je,gt)},rt=Je=>{var gt=en(),ze=l(gt,!0);s(gt),L(()=>C(ze,X()?`${X()} - Result`:"Result")),o(Je,gt)};g(ft,Je=>{R()==="damage"?Je(A):Je(rt,!1)},!0)}o(ke,Me)};g(ta,ke=>{R()==="damage"&&V()?ke(aa):ke(j,!1)},!0)}o(Ke,Rt)};g(be,Ke=>{R()==="damage"&&V()==="Healing"?Ke(Ae):Ke(qe,!1)})}var st=a(be,2);{var tt=Ke=>{var Rt=tn();o(Ke,Rt)};g(st,Ke=>{e(ge)&&Ke(tt)})}var he=a(st,2);{var ae=Ke=>{var Rt=an();o(Ke,Rt)};g(he,Ke=>{e(ce)&&Ke(ae)})}s(xe);var $t=a(xe,2),Ue=l($t,!0);s($t);var ue=a($t,2),Be=l(ue);{var ct=Ke=>{var Rt=yt(),ta=Se(Rt);{var aa=ke=>{var Me=ln();St(Me,5,()=>(e(te),e(ye),U(N()),i(()=>Ee(e(te),e(ye),N()))),jt,(ft,A)=>{var rt=sn(),Je=l(rt),gt=l(Je,!0);s(Je);var ze=a(Je,2),et=l(ze);s(ze),s(rt),L(()=>{C(gt,(e(A),i(()=>e(A).display))),C(et,`(${e(A),i(()=>e(A).source)??""})`)}),o(ft,rt)}),s(Me),o(ke,Me)},j=ke=>{var Me=yt(),ft=Se(Me);{var A=rt=>{var Je=rn(),gt=l(Je);s(Je),L(()=>C(gt,`Modifier: ${e(te),i(()=>e(te).constant>=0?"+":"")??""}${e(te),i(()=>e(te).constant)??""}`)),o(rt,Je)};g(ft,rt=>{e(te),i(()=>e(te).constant)&&rt(A)},!0)}o(ke,Me)};g(ta,ke=>{U(N()),i(()=>N().length>0)?ke(aa):ke(j,!1)})}o(Ke,Rt)};g(Be,Ke=>{e(te),U(N()),i(()=>e(te).constant||N().length>0)&&Ke(ct)})}s(ue);var wt=a(ue,2);{var lt=Ke=>{var Rt=nn();o(Ke,Rt)};g(wt,Ke=>{e(ce)&&Ke(lt)})}var Y=a(wt,2);{var Xt=Ke=>{var Rt=vn(),ta=l(Rt);St(ta,1,()=>e(me),jt,(ke,Me)=>{var ft=on(),A=l(ft,!0);s(ft),L(()=>C(A,(e(Me),i(()=>e(Me).label)))),B("click",ft,()=>{N(e(Me).breakdown||[]),At(e(Me).notation,"damage")}),o(ke,ft)});var aa=a(ta,2);{var j=ke=>{var Me=cn();L(()=>{Me.disabled=e(m)<=0,it(Me,"title",e(m)<=0?"No Channel Divinity uses remaining":"Use Channel Divinity to add +10 to this attack roll")}),B("click",Me,De),o(ke,Me)};g(aa,ke=>{e(p)&&R()==="attack"&&!e(de)&&e(m)>0&&!e(ce)&&ke(j)})}s(Rt),o(Ke,Rt)};g(Y,Ke=>{e(me),e(p),U(R()),e(de),e(m),i(()=>e(me).length>0||e(p)&&R()==="attack"&&!e(de)&&e(m)>0)&&Ke(Xt)})}L(()=>C(Ue,(e(te),i(()=>e(te).resultTotal)))),o(x,q)};g(le,x=>{e(te)&&x(ut)})}s(Ze),s(Q),s(Le),L(()=>{$=It(Le,1,"modal-overlay svelte-1r90jgp",null,$,{hidden:!z()}),dt=It(Ze,1,"roll-result svelte-1r90jgp",null,dt,{"has-result":e(te)})}),B("click",d,ie),B("click",Ge,$e),B("click",Q,ys(function(x){Ra.call(this,c,x)})),B("keydown",Q,function(x){Ra.call(this,c,x)}),B("click",Le,$e),B("keydown",Le,x=>x.key==="Escape"&&$e()),o(r,Le),Cl(c,"getLastRollTotal",Re);var Ve=Qt(Te);return f(),Ve}const Za="https://api.github.com/gists";async function pn(r,c,t){if(!c)throw new Error("GitHub token is required");const v=JSON.stringify(r,null,2),f=`${r.name||"character"}_dnd.json`,p={description:t||`D&D Character: ${r.name}`,public:!1,files:{[f]:{content:v}}},m=await fetch(Za,{method:"POST",headers:{Authorization:`token ${c}`,"Content-Type":"application/json"},body:JSON.stringify(p)});if(!m.ok)throw new Error(`Failed to create gist: ${m.statusText}`);return(await m.json()).id}async function mn(r,c,t){if(!c||!t)throw new Error("GitHub token and Gist ID are required");const v=JSON.stringify(r,null,2),p={files:{[`${r.name||"character"}_dnd.json`]:{content:v}}},m=await fetch(`${Za}/${t}`,{method:"PATCH",headers:{Authorization:`token ${c}`,"Content-Type":"application/json"},body:JSON.stringify(p)});if(!m.ok)throw new Error(`Failed to update gist: ${m.statusText}`)}async function gn(r,c){if(!r)throw new Error("Gist ID is required");const t={"Content-Type":"application/json"};c&&(t.Authorization=`token ${c}`);const v=await fetch(`${Za}/${r}`,{method:"GET",headers:t});if(!v.ok)throw new Error(`Failed to load gist: ${v.statusText}`);const f=await v.json(),p=Object.values(f.files);if(p.length===0)throw new Error("No files found in gist");const k=p[0].content;try{const y=JSON.parse(k);return y.attacks&&Array.isArray(y.attacks)&&(y.attacks=y.attacks.map(h=>({...h,id:h.id||crypto.randomUUID()}))),y.classFeatures?(y.classFeatures.features||(y.classFeatures.features={}),y.classFeatures.spellSlots||(y.classFeatures.spellSlots=[]),y.classFeatures.preparedSpells===void 0&&(y.classFeatures.preparedSpells="")):y.classFeatures={features:{},spellSlots:[],preparedSpells:""},y}catch{throw new Error("Invalid character data in gist")}}function Ts(r){typeof window<"u"&&localStorage.setItem("dnd_gist_config",JSON.stringify(r))}function bn(){if(typeof window<"u"){const r=localStorage.getItem("dnd_gist_config");if(r)return JSON.parse(r)}return{}}async function hn(r,c=30){if(!r)throw new Error("GitHub token is required to list gists");const t=await fetch(`${Za}?per_page=${c}`,{method:"GET",headers:{Authorization:`token ${r}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error(`Failed to list gists: ${t.statusText}`);return await t.json()}var _n=u('<div class="error-message svelte-1jb5ckg"> </div>'),yn=u('<div class="toggle-container svelte-1jb5ckg"><button type="button" class="toggle-btn svelte-1jb5ckg"> </button></div>'),xn=u('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID (leave empty to create new)</label> <input type="text" id="gistId" placeholder="Optional: existing Gist ID to update" class="svelte-1jb5ckg"/></div>'),$n=u('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),wn=u('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),kn=u('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Update (or leave unselected to create new)</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),Sn=u('<div class="info-message svelte-1jb5ckg">No gists found. A new one will be created.</div>'),Cn=u('<!> <div class="form-group svelte-1jb5ckg"><label for="description" class="svelte-1jb5ckg"> </label> <input type="text" id="description" placeholder="D&amp;D Character Sheet" class="svelte-1jb5ckg"/></div>',1),Dn=u('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID *</label> <input type="text" id="gistId" placeholder="Enter Gist ID (for public or your private gists)" required class="svelte-1jb5ckg"/></div>'),Ln=u('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),An=u('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),jn=u('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Load</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),Bn=u('<div class="info-message svelte-1jb5ckg">No gists found. Enter a Gist ID manually or create a new one in Save mode.</div>'),Rn=u('<div class="modal-overlay svelte-1jb5ckg" role="button" tabindex="-1"><div class="modal-content svelte-1jb5ckg" role="dialog" tabindex="0"><div class="modal-header svelte-1jb5ckg"><h2 class="svelte-1jb5ckg"> </h2> <button class="close-btn svelte-1jb5ckg">√ó</button></div> <div class="modal-body svelte-1jb5ckg"><!> <div class="form-group svelte-1jb5ckg"><label for="token" class="svelte-1jb5ckg"> <a href="https://github.com/settings/tokens" target="_blank" rel="noopener" class="svelte-1jb5ckg">Get token</a></label> <input type="password" id="token" placeholder="ghp_xxxxxxxxxxxxx" class="svelte-1jb5ckg"/></div> <!> <!> <div class="modal-actions svelte-1jb5ckg"><button class="btn btn-primary svelte-1jb5ckg"><!></button> <button class="btn btn-secondary svelte-1jb5ckg">Cancel</button></div></div></div></div>');function Mn(r,c){Yt(c,!1);const t=()=>bt(ve,"$character",v),[v,f]=fa(),p=Sa();let m=Lt(c,"mode",8,"save"),k=D(""),y=D(""),h=D(""),z=D(!1),P=D(""),V=D(!1),X=D(!1),se=D([]),N=D(null);const R=bn();R.token&&n(k,R.token),R.gistId&&n(y,R.gistId),ka(async()=>{e(k)&&!e(V)&&await I()});async function I(){if(e(k)){n(X,!0),n(P,"");try{n(se,await hn(e(k))),e(y)&&n(N,e(se).find(_=>_.id===e(y))||null)}catch(_){n(P,_.message||"Failed to load gists"),n(se,[])}finally{n(X,!1)}}}function ee(_){e(N)?.id===_.id?(n(N,null),n(y,"")):(n(N,_),n(y,_.id))}function pe(){n(V,!e(V)),n(P,""),!e(V)&&e(k)&&I()}async function Ie(){if(!e(k)){n(P,"GitHub token is required");return}const _=e(N)?.id||e(y);n(z,!0),n(P,"");try{if(_)await mn(t(),e(k),_),n(y,_),Ot.add("Character updated in Gist successfully!","success");else{const E=await pn(t(),e(k),e(h));n(y,E),Ot.add(`Character saved to Gist! ID: ${E}`,"success")}Ts({token:e(k),gistId:e(y)}),p("close")}catch(E){n(P,E.message||"Failed to save to Gist")}finally{n(z,!1)}}async function re(){const _=e(N)?.id||e(y);if(!_){n(P,"Please select a gist or enter a Gist ID");return}n(z,!0),n(P,"");try{const E=await gn(_,e(k)||void 0);ve.set(E),n(y,_),Ts({token:e(k),gistId:e(y)}),Ot.add("Character loaded from Gist successfully!","success"),p("close")}catch(E){n(P,E.message||"Failed to load from Gist")}finally{n(z,!1)}}function te(){p("close")}Jt();var ye=Rn(),Re=l(ye),Ee=l(Re),M=l(Ee),T=l(M,!0);s(M);var w=a(M,2);s(Ee);var K=a(Ee,2),b=l(K);{var F=_=>{var E=_n(),G=l(E,!0);s(E),L(()=>C(G,e(P))),o(_,E)};g(b,_=>{e(P)&&_(F)})}var J=a(b,2),me=l(J),ge=l(me);sa(),s(me);var ce=a(me,2);Ce(ce),s(J);var de=a(J,2);{var Xe=_=>{var E=yn(),G=l(E),ie=l(G,!0);s(G),s(E),L(()=>{G.disabled=e(z),C(ie,e(V)?"üìã Show My Gists":"‚úèÔ∏è Enter Gist ID Manually")}),B("click",G,pe),o(_,E)};g(de,_=>{(m()==="load"||m()==="save"&&e(k))&&_(Xe)})}var nt=a(de,2);{var pt=_=>{var E=Cn(),G=Se(E);{var ie=Q=>{var oe=xn(),Oe=a(l(oe),2);Ce(Oe),s(oe),L(()=>Oe.disabled=e(z)),Pe(Oe,()=>e(y),Fe=>n(y,Fe)),o(Q,oe)},De=Q=>{var oe=yt(),Oe=Se(oe);{var Fe=ne=>{var W=$n();o(ne,W)},ht=ne=>{var W=yt(),d=Se(W);{var Ge=H=>{var _e=kn(),Z=a(l(_e),2);St(Z,5,()=>e(se),jt,(je,we)=>{var We=wn();let He;var Ze=l(We),dt=l(Ze),le=l(dt,!0);s(dt);var ut=a(dt,2),Ve=l(ut,!0);s(ut),s(Ze);var x=a(Ze,2),q=l(x),xe=l(q);s(q);var be=a(q,2),Ae=l(be);s(be),s(x),s(We),L(qe=>{He=It(We,1,"gist-item svelte-1jb5ckg",null,He,{selected:e(N)?.id===e(we).id}),We.disabled=e(z),C(le,(e(we),i(()=>e(we).description||"Untitled"))),C(Ve,(e(we),i(()=>e(we).public?"üåê Public":"üîí Private"))),C(xe,`ID: ${e(we),i(()=>e(we).id)??""}`),C(Ae,`Updated: ${qe??""}`)},[()=>(e(we),i(()=>new Date(e(we).updated_at).toLocaleDateString()))]),B("click",We,()=>ee(e(we))),o(je,We)}),s(Z),s(_e),o(H,_e)},fe=H=>{var _e=yt(),Z=Se(_e);{var je=we=>{var We=Sn();o(we,We)};g(Z,we=>{e(k)&&we(je)},!0)}o(H,_e)};g(d,H=>{e(se),i(()=>e(se).length>0)?H(Ge):H(fe,!1)},!0)}o(ne,W)};g(Oe,ne=>{e(X)?ne(Fe):ne(ht,!1)},!0)}o(Q,oe)};g(G,Q=>{e(V)||!e(k)?Q(ie):Q(De,!1)})}var $e=a(G,2),Te=l($e),Le=l(Te);s(Te);var $=a(Te,2);Ce($),s($e),L(()=>{C(Le,`Description ${e(y)?"(optional)":""}`),$.disabled=e(z)}),Pe($,()=>e(h),Q=>n(h,Q)),o(_,E)},_t=_=>{var E=yt(),G=Se(E);{var ie=$e=>{var Te=Dn(),Le=a(l(Te),2);Ce(Le),s(Te),L(()=>Le.disabled=e(z)),Pe(Le,()=>e(y),$=>n(y,$)),o($e,Te)},De=$e=>{var Te=yt(),Le=Se(Te);{var $=oe=>{var Oe=Ln();o(oe,Oe)},Q=oe=>{var Oe=yt(),Fe=Se(Oe);{var ht=W=>{var d=jn(),Ge=a(l(d),2);St(Ge,5,()=>e(se),jt,(fe,H)=>{var _e=An();let Z;var je=l(_e),we=l(je),We=l(we,!0);s(we);var He=a(we,2),Ze=l(He,!0);s(He),s(je);var dt=a(je,2),le=l(dt),ut=l(le);s(le);var Ve=a(le,2),x=l(Ve);s(Ve),s(dt),s(_e),L(q=>{Z=It(_e,1,"gist-item svelte-1jb5ckg",null,Z,{selected:e(N)?.id===e(H).id}),_e.disabled=e(z),C(We,(e(H),i(()=>e(H).description||"Untitled"))),C(Ze,(e(H),i(()=>e(H).public?"üåê Public":"üîí Private"))),C(ut,`ID: ${e(H),i(()=>e(H).id)??""}`),C(x,`Updated: ${q??""}`)},[()=>(e(H),i(()=>new Date(e(H).updated_at).toLocaleDateString()))]),B("click",_e,()=>ee(e(H))),o(fe,_e)}),s(Ge),s(d),o(W,d)},ne=W=>{var d=yt(),Ge=Se(d);{var fe=H=>{var _e=Bn();o(H,_e)};g(Ge,H=>{e(k)&&H(fe)},!0)}o(W,d)};g(Fe,W=>{e(se),i(()=>e(se).length>0)?W(ht):W(ne,!1)},!0)}o(oe,Oe)};g(Le,oe=>{e(X)?oe($):oe(Q,!1)},!0)}o($e,Te)};g(G,$e=>{e(V)||!e(k)?$e(ie):$e(De,!1)},!0)}o(_,E)};g(nt,_=>{m()==="save"?_(pt):_(_t,!1)})}var mt=a(nt,2),ot=l(mt),Bt=l(ot);{var At=_=>{var E=Pt();L(()=>C(E,m()==="save"?"Saving...":"Loading...")),o(_,E)},S=_=>{var E=Pt();L(()=>C(E,m()==="save"?"Save":"Load")),o(_,E)};g(Bt,_=>{e(z)?_(At):_(S,!1)})}s(ot);var O=a(ot,2);s(mt),s(K),s(Re),s(ye),L(()=>{C(T,m()==="save"?"Save to GitHub Gist":"Load from GitHub Gist"),C(ge,`GitHub Token ${m()==="load"?"(optional for public gists)":"(required)"} `),ce.disabled=e(z),ot.disabled=e(z),O.disabled=e(z)}),B("click",w,te),Pe(ce,()=>e(k),_=>n(k,_)),B("blur",ce,()=>{e(k)&&!e(V)&&I()}),B("click",ot,function(..._){(m()==="save"?Ie:re)?.apply(this,_)}),B("click",O,te),B("click",Re,ys(function(_){Ra.call(this,c,_)})),B("keydown",Re,function(_){Ra.call(this,c,_)}),B("click",ye,te),B("keydown",ye,_=>_.key==="Escape"&&te()),o(r,ye),Qt(),f()}var Tn=u('<div class="loading svelte-1ngjemu">Loading D&D data...</div>'),Fn=u("<option> </option>"),Pn=u('<select class="level-filter svelte-1ngjemu"><option>All Levels</option><option>Cantrip</option><!></select>'),In=u('<div class="no-results svelte-1ngjemu"> </div>'),En=u('<div class="item-meta svelte-1ngjemu"> </div>'),Hn=u('<div class="item-meta svelte-1ngjemu"> </div>'),Un=u('<button><div class="item-name svelte-1ngjemu"> </div> <!></button>'),Nn=u('<p class="higher-levels"><strong>At Higher Levels:</strong> </p>'),On=u('<p class="cantrip-upgrade"><strong>Cantrip Upgrade:</strong> </p>'),Gn=u('<h3 class="svelte-1ngjemu"> </h3> <p class="spell-meta svelte-1ngjemu"><!> <!></p> <p class="spell-classes"><strong>Classes:</strong> </p> <div class="spell-stats svelte-1ngjemu"><div><strong>Casting Time:</strong> </div> <div><strong>Range:</strong> </div> <div><strong>Components:</strong> <!></div> <div><strong>Duration:</strong> <!> </div></div> <p class="description svelte-1ngjemu"> </p> <!> <!>',1),qn=u('<p class="prerequisite svelte-1ngjemu"><strong>Prerequisite:</strong> </p>'),zn=u('<h3 class="svelte-1ngjemu"> </h3> <!> <p class="description svelte-1ngjemu"> </p> <a target="_blank" rel="noopener" class="source-link svelte-1ngjemu">View Full Details ‚Üí</a>',1),Wn=u('<div class="item-details svelte-1ngjemu"><!></div>'),Kn=u('<div class="controls svelte-1ngjemu"><div class="tabs svelte-1ngjemu"><button> </button> <button> </button></div> <div class="search-controls svelte-1ngjemu"><input type="text" placeholder="Search by name or description..." class="search-input svelte-1ngjemu"/> <!></div></div> <div class="content-container svelte-1ngjemu"><div class="items-list svelte-1ngjemu"><!></div> <!></div>',1),Vn=u('<div class="modal-backdrop svelte-1ngjemu" role="presentation"><div class="modal svelte-1ngjemu" role="dialog" aria-modal="true" tabindex="-1"><div class="modal-header svelte-1ngjemu"><h2 class="svelte-1ngjemu">Browse D&D Spells & Feats</h2> <button class="close-btn svelte-1ngjemu" aria-label="Close">&times;</button></div> <div class="modal-body svelte-1ngjemu"><!></div> <div class="modal-footer svelte-1ngjemu"><button class="btn-secondary svelte-1ngjemu">Cancel</button> <button class="btn-primary svelte-1ngjemu">Add to Character Sheet</button></div></div></div>');function Jn(r,c){Yt(c,!1);const t=D(),v=D(),f=D();let p=Lt(c,"onClose",8),m=D("spell"),k=D(!0),y=D(""),h=D(null),z=D([]),P=D([]),V=D(null);ka(async()=>{n(k,!0);try{n(z,await qs()),n(P,await fr())}catch(w){console.error("Failed to load data:",w)}finally{n(k,!1)}});function X(w){n(V,w)}function se(w){const K=w.match(/(\d+d\d+(?:\s*\+\s*\d+)?)/i);return K?K[1]:""}function N(w){const K=w.split(/\.( |$)/)[0].trim(),b=Array.from(w.matchAll(/\*\*(.*?)\*\*/g)).map(J=>J[1].replace(/\.$/,""));let F=K;return b.length&&(F+=" | Effects: "+b.join(", ")),F}function R(){if(e(V)){if(e(m)==="spell"){const w=e(V);ve.update(K=>{const F=[];w.range&&F.push(`Range: ${w.range}`),w.castingTime&&F.push(`Cast: ${w.castingTime}`),w.duration&&F.push(`Duration: ${w.duration}`),w.actionType==="Save"&&F.push("Saving throw spell"),w.components&&w.components.length>0&&F.push(`Components: ${w.components.join(", ")}`),w.material&&F.push(`Material: ${w.material}`);const J=F.join(" | "),me=N(w.description),ge={id:crypto.randomUUID(),name:`${w.name}${w.concentration?" (C)":""}${w.ritual?" (R)":""}`,bonus:w.actionType==="Attack"?5:0,damage:se(w.description),damageType:`${w.school} (Lvl ${w.level})`,spellRef:w.name,infoNotes:J,generalNotes:me,castAtLevel:w.level};return K.attacks=[...K.attacks,ge],K})}else if(e(m)==="feat"){const w=e(V);ve.update(K=>{const b=`${w.name}${w.prerequisite?` (Req: ${w.prerequisite})`:""}
${w.description}
`;return K.features=K.features?`${K.features}
${b}`:b,K})}n(V,null),p()()}}Ye(()=>(e(h),e(z),e(y)),()=>{n(t,e(h)!==null?pr(Rs(e(z),e(y)),e(h)):Rs(e(z),e(y)))}),Ye(()=>(e(P),e(y)),()=>{n(v,mr(e(P),e(y)))}),Ye(()=>(e(m),e(t),e(v)),()=>{n(f,e(m)==="spell"?e(t):e(v))}),ga(),Jt();var I=Vn(),ee=l(I),pe=l(ee),Ie=a(l(pe),2);s(pe);var re=a(pe,2),te=l(re);{var ye=w=>{var K=Tn();o(w,K)},Re=w=>{var K=Kn(),b=Se(K),F=l(b),J=l(F);let me;var ge=l(J);s(J);var ce=a(J,2);let de;var Xe=l(ce);s(ce),s(F);var nt=a(F,2),pt=l(nt);Ce(pt);var _t=a(pt,2);{var mt=G=>{var ie=Pn();L(()=>{e(h),Wt(()=>{})});var De=l(ie);De.value=(De.__value=null)??"";var $e=a(De);$e.value=$e.__value=0;var Te=a($e);St(Te,0,()=>[1,2,3,4,5,6,7,8,9],jt,(Le,$)=>{var Q=Fn(),oe=l(Q);s(Q);var Oe={};L(()=>{C(oe,`Level ${$??""}`),Oe!==(Oe=$)&&(Q.value=(Q.__value=$)??"")}),o(Le,Q)}),s(ie),Ua(ie,()=>e(h),Le=>n(h,Le)),o(G,ie)};g(_t,G=>{e(m)==="spell"&&G(mt)})}s(nt),s(b);var ot=a(b,2),Bt=l(ot),At=l(Bt);{var S=G=>{var ie=In(),De=l(ie);s(ie),L(()=>C(De,`No ${e(m)??""}s found`)),o(G,ie)},O=G=>{var ie=yt(),De=Se(ie);St(De,1,()=>e(f),jt,($e,Te)=>{var Le=Un();let $;var Q=l(Le),oe=l(Q,!0);s(Q);var Oe=a(Q,2);{var Fe=ne=>{const W=kt(()=>e(Te));var d=En(),Ge=l(d);s(d),L(()=>C(Ge,`Level ${U(e(W)),i(()=>e(W).level)??""} ‚Ä¢ ${U(e(W)),i(()=>e(W).school)??""}`)),o(ne,d)},ht=ne=>{const W=kt(()=>e(Te));var d=yt(),Ge=Se(d);{var fe=H=>{var _e=Hn(),Z=l(_e,!0);s(_e),L(()=>C(Z,(U(e(W)),i(()=>e(W).prerequisite)))),o(H,_e)};g(Ge,H=>{U(e(W)),i(()=>e(W).prerequisite)&&H(fe)})}o(ne,d)};g(Oe,ne=>{e(m)==="spell"?ne(Fe):ne(ht,!1)})}s(Le),L(()=>{$=It(Le,1,"item-card svelte-1ngjemu",null,$,{selected:e(V)?.name===e(Te).name}),C(oe,(e(Te),i(()=>e(Te).name)))}),B("click",Le,()=>X(e(Te))),o($e,Le)}),o(G,ie)};g(At,G=>{e(f),i(()=>e(f).length===0)?G(S):G(O,!1)})}s(Bt);var _=a(Bt,2);{var E=G=>{var ie=Wn(),De=l(ie);{var $e=Le=>{const $=kt(()=>e(V));var Q=Gn(),oe=Se(Q),Oe=l(oe,!0);s(oe);var Fe=a(oe,2),ht=l(Fe);{var ne=he=>{var ae=Pt();L(()=>C(ae,`${U(e($)),i(()=>e($).school)??""} cantrip`)),o(he,ae)},W=he=>{var ae=Pt();L(()=>C(ae,`Level ${U(e($)),i(()=>e($).level)??""} ${U(e($)),i(()=>e($).school)??""}`)),o(he,ae)};g(ht,he=>{U(e($)),i(()=>e($).level===0)?he(ne):he(W,!1)})}var d=a(ht,2);{var Ge=he=>{var ae=Pt("(ritual)");o(he,ae)};g(d,he=>{U(e($)),i(()=>e($).ritual)&&he(Ge)})}s(Fe);var fe=a(Fe,2),H=a(l(fe));s(fe);var _e=a(fe,2),Z=l(_e),je=a(l(Z));s(Z);var we=a(Z,2),We=a(l(we));s(we);var He=a(we,2),Ze=a(l(He)),dt=a(Ze);{var le=he=>{var ae=Pt();L(()=>C(ae,`(${U(e($)),i(()=>e($).material)??""})`)),o(he,ae)};g(dt,he=>{U(e($)),i(()=>e($).material)&&he(le)})}s(He);var ut=a(He,2),Ve=a(l(ut),2);{var x=he=>{var ae=Pt("Concentration,");o(he,ae)};g(Ve,he=>{U(e($)),i(()=>e($).concentration)&&he(x)})}var q=a(Ve,1,!0);s(ut),s(_e);var xe=a(_e,2),be=l(xe,!0);s(xe);var Ae=a(xe,2);{var qe=he=>{var ae=Nn(),$t=a(l(ae));s(ae),L(()=>C($t,` ${U(e($)),i(()=>e($).higherLevelSlot)??""}`)),o(he,ae)};g(Ae,he=>{U(e($)),i(()=>e($).higherLevelSlot)&&he(qe)})}var st=a(Ae,2);{var tt=he=>{var ae=On(),$t=a(l(ae));s(ae),L(()=>C($t,` ${U(e($)),i(()=>e($).cantripUpgrade)??""}`)),o(he,ae)};g(st,he=>{U(e($)),i(()=>e($).cantripUpgrade)&&he(tt)})}L((he,ae)=>{C(Oe,(U(e($)),i(()=>e($).name))),C(H,` ${he??""}`),C(je,` ${U(e($)),i(()=>e($).castingTime||e($).actionType)??""}`),C(We,` ${U(e($)),i(()=>e($).range)??""}`),C(Ze,` ${ae??""}`),C(q,(U(e($)),i(()=>e($).duration))),C(be,(U(e($)),i(()=>e($).description)))},[()=>(U(e($)),i(()=>e($).classes.join(", "))),()=>(U(e($)),i(()=>e($).components.join(", ").toUpperCase()))]),o(Le,Q)},Te=Le=>{const $=kt(()=>e(V));var Q=zn(),oe=Se(Q),Oe=l(oe,!0);s(oe);var Fe=a(oe,2);{var ht=Ge=>{var fe=qn(),H=a(l(fe));s(fe),L(()=>C(H,` ${U(e($)),i(()=>e($).prerequisite)??""}`)),o(Ge,fe)};g(Fe,Ge=>{U(e($)),i(()=>e($).prerequisite)&&Ge(ht)})}var ne=a(Fe,2),W=l(ne,!0);s(ne);var d=a(ne,2);L(()=>{C(Oe,(U(e($)),i(()=>e($).name))),C(W,(U(e($)),i(()=>e($).description))),it(d,"href",(U(e($)),i(()=>e($).source)))}),o(Le,Q)};g(De,Le=>{e(m)==="spell"?Le($e):Le(Te,!1)})}s(ie),o(G,ie)};g(_,G=>{e(V)&&G(E)})}s(ot),L(()=>{me=It(J,1,"tab svelte-1ngjemu",null,me,{active:e(m)==="spell"}),C(ge,`üìú Spells (${e(z),i(()=>e(z).length)??""})`),de=It(ce,1,"tab svelte-1ngjemu",null,de,{active:e(m)==="feat"}),C(Xe,`‚≠ê Feats (${e(P),i(()=>e(P).length)??""})`)}),B("click",J,()=>{n(m,"spell"),n(V,null),n(y,"")}),B("click",ce,()=>{n(m,"feat"),n(V,null),n(y,"")}),Pe(pt,()=>e(y),G=>n(y,G)),o(w,K)};g(te,w=>{e(k)?w(ye):w(Re,!1)})}s(re);var Ee=a(re,2),M=l(Ee),T=a(M,2);s(Ee),s(ee),s(I),L(()=>T.disabled=!e(V)),B("click",Ie,function(...w){p()?.apply(this,w)}),B("click",M,function(...w){p()?.apply(this,w)}),B("click",T,R),B("click",ee,ys(function(w){Ra.call(this,c,w)})),B("keydown",ee,function(w){Ra.call(this,c,w)}),B("click",I,function(...w){p()?.apply(this,w)}),B("keydown",I,w=>w.key==="Escape"&&p()()),o(r,I),Qt()}var Yn=u('<span class="resistance-tag svelte-gdwwx1"> <button type="button" class="tag-remove svelte-gdwwx1">√ó</button></span>'),Qn=u('<div class="resistance-list svelte-gdwwx1"></div>'),Xn=u('<p class="ability-meta svelte-gdwwx1"> <!></p>'),Zn=u('<p class="ability-meta svelte-gdwwx1">Requires Reaction</p>'),eo=u('<div class="ability-card svelte-gdwwx1"><div class="ability-header svelte-gdwwx1"><strong class="svelte-gdwwx1"> </strong> <button type="button" class="ability-remove svelte-gdwwx1">√ó</button></div> <p class="ability-description svelte-gdwwx1"> </p> <!></div>'),to=u('<div class="abilities-list svelte-gdwwx1"></div>'),ao=u(`<div class="modal-backdrop svelte-gdwwx1" role="presentation"><div class="modal-content svelte-gdwwx1" role="dialog" aria-modal="true" aria-labelledby="modal-title"><div class="modal-header svelte-gdwwx1"><h3 id="modal-title" class="svelte-gdwwx1">Add Custom Condition</h3> <button class="btn-close svelte-gdwwx1" aria-label="Close">√ó</button></div> <div class="modal-body svelte-gdwwx1"><div class="form-group svelte-gdwwx1"><label for="conditionName" class="svelte-gdwwx1">Condition Name*</label> <input type="text" id="conditionName" placeholder="e.g., Cazna's Mark" class="svelte-gdwwx1"/></div> <div class="form-group svelte-gdwwx1"><label for="description" class="svelte-gdwwx1">Description</label> <textarea id="description" placeholder="Describe the condition..." rows="3" class="svelte-gdwwx1"></textarea></div> <div class="form-row svelte-gdwwx1"><div class="form-group svelte-gdwwx1"><label for="attackBonus" class="svelte-gdwwx1">Attack Bonus</label> <input type="text" id="attackBonus" placeholder="0 or 1d4" class="svelte-gdwwx1"/></div> <div class="form-group svelte-gdwwx1"><label for="damageBonus" class="svelte-gdwwx1">Damage Bonus</label> <input type="text" id="damageBonus" placeholder="0 or 1d6" class="svelte-gdwwx1"/></div> <div class="form-group svelte-gdwwx1"><label for="acBonus" class="svelte-gdwwx1">AC Bonus</label> <input type="number" id="acBonus" placeholder="0" class="svelte-gdwwx1"/></div></div> <div class="form-group svelte-gdwwx1"><label for="darkvision" class="svelte-gdwwx1">Darkvision (feet)</label> <input type="number" id="darkvision" placeholder="0" min="0" step="30" class="svelte-gdwwx1"/> <small class="help-text svelte-gdwwx1">Grant or extend darkvision (e.g., 60 for 60 feet)</small></div> <div class="form-group svelte-gdwwx1"><label class="svelte-gdwwx1">Damage Resistances</label> <div class="resistance-input-group svelte-gdwwx1"><input type="text" placeholder="e.g., cold, fire, poison" class="svelte-gdwwx1"/> <button type="button" class="btn-add svelte-gdwwx1">Add</button></div> <!></div> <div class="form-group svelte-gdwwx1"><label class="svelte-gdwwx1">Special Abilities</label> <div class="ability-form svelte-gdwwx1"><input type="text" placeholder="Ability name (e.g., Flicker of Deceit)" class="ability-name-input svelte-gdwwx1"/> <textarea placeholder="Ability description..." rows="2" class="ability-desc-input svelte-gdwwx1"></textarea> <div class="ability-options svelte-gdwwx1"><div class="ability-option svelte-gdwwx1"><label for="abilityUses" class="svelte-gdwwx1">Uses per rest</label> <input type="number" id="abilityUses" min="0" class="svelte-gdwwx1"/></div> <div class="ability-option svelte-gdwwx1"><label for="restType" class="svelte-gdwwx1">Rest type</label> <select id="restType" class="svelte-gdwwx1"><option>Short</option><option>Long</option></select></div> <div class="ability-option svelte-gdwwx1"><label class="svelte-gdwwx1"><input type="checkbox" class="svelte-gdwwx1"/> Requires Reaction</label></div></div> <button type="button" class="btn-add svelte-gdwwx1">Add Ability</button></div> <!></div></div> <div class="modal-footer svelte-gdwwx1"><button class="btn btn-secondary svelte-gdwwx1">Cancel</button> <button class="btn btn-primary svelte-gdwwx1">Add Condition</button></div></div></div>`);function so(r,c){Yt(c,!1);let t=Lt(c,"show",8,!1),v=Lt(c,"onSave",8),f=Lt(c,"onCancel",8),p=D(""),m=D(""),k=D(0),y=D(0),h=D(0),z=D(0),P=D([]),V=D(""),X=D([]),se=D(""),N=D(""),R=D(0),I=D("short"),ee=D(!1);function pe(){n(p,""),n(m,""),n(k,0),n(y,0),n(h,0),n(z,0),n(P,[]),n(V,""),n(X,[]),n(se,""),n(N,""),n(R,0),n(I,"short"),n(ee,!1)}function Ie(){e(V).trim()&&(n(P,[...e(P),e(V).trim()]),n(V,""))}function re(b){n(P,e(P).filter((F,J)=>J!==b))}function te(){if(e(se).trim()&&e(N).trim()){const b={name:e(se).trim(),description:e(N).trim(),requiresReaction:e(ee)};e(R)>0&&(b.usesPerRest=e(R),b.currentUses=e(R),b.restType=e(I)),n(X,[...e(X),b]),n(se,""),n(N,""),n(R,0),n(I,"short"),n(ee,!1)}}function ye(b){n(X,e(X).filter((F,J)=>J!==b))}function Re(){if(!e(p).trim()){alert("Please enter a condition name");return}const b={name:e(p).trim(),description:e(m).trim()||"Custom condition",attackBonus:e(k)||0,damageBonus:e(y)||0,target:"self"};e(h)!==0&&(b.acBonus=e(h)),e(z)>0&&(b.darkvision=e(z)),e(P).length>0&&(b.resistances=e(P)),e(X).length>0&&(b.abilities=e(X)),v()(b),pe()}function Ee(){pe(),f()()}function M(b){b.target===b.currentTarget&&Ee()}Jt();var T=yt(),w=Se(T);{var K=b=>{var F=ao(),J=l(F),me=l(J),ge=a(l(me),2);s(me);var ce=a(me,2),de=l(ce),Xe=a(l(de),2);Ce(Xe),s(de);var nt=a(de,2),pt=a(l(nt),2);ja(pt),s(nt);var _t=a(nt,2),mt=l(_t),ot=a(l(mt),2);Ce(ot),s(mt);var Bt=a(mt,2),At=a(l(Bt),2);Ce(At),s(Bt);var S=a(Bt,2),O=a(l(S),2);Ce(O),s(S),s(_t);var _=a(_t,2),E=a(l(_),2);Ce(E),sa(2),s(_);var G=a(_,2),ie=a(l(G),2),De=l(ie);Ce(De);var $e=a(De,2);s(ie);var Te=a(ie,2);{var Le=le=>{var ut=Qn();St(ut,5,()=>e(P),jt,(Ve,x,q)=>{var xe=Yn(),be=l(xe),Ae=a(be);s(xe),L(()=>{C(be,`${e(x)??""} `),it(Ae,"aria-label",`Remove ${e(x)??""}`)}),B("click",Ae,()=>re(q)),o(Ve,xe)}),s(ut),o(le,ut)};g(Te,le=>{e(P),i(()=>e(P).length>0)&&le(Le)})}s(G);var $=a(G,2),Q=a(l($),2),oe=l(Q);Ce(oe);var Oe=a(oe,2);ja(Oe);var Fe=a(Oe,2),ht=l(Fe),ne=a(l(ht),2);Ce(ne),s(ht);var W=a(ht,2),d=a(l(W),2);L(()=>{e(I),Wt(()=>{})});var Ge=l(d);Ge.value=Ge.__value="short";var fe=a(Ge);fe.value=fe.__value="long",s(d),s(W);var H=a(W,2),_e=l(H),Z=l(_e);Ce(Z),sa(),s(_e),s(H),s(Fe);var je=a(Fe,2);s(Q);var we=a(Q,2);{var We=le=>{var ut=to();St(ut,5,()=>e(X),jt,(Ve,x,q)=>{var xe=eo(),be=l(xe),Ae=l(be),qe=l(Ae,!0);s(Ae);var st=a(Ae,2);s(be);var tt=a(be,2),he=l(tt,!0);s(tt);var ae=a(tt,2);{var $t=ue=>{var Be=Xn(),ct=l(Be),wt=a(ct);{var lt=Y=>{var Xt=Pt("‚Ä¢ Requires Reaction");o(Y,Xt)};g(wt,Y=>{e(x),i(()=>e(x).requiresReaction)&&Y(lt)})}s(Be),L(()=>C(ct,`${e(x),i(()=>e(x).usesPerRest)??""} use${e(x),i(()=>e(x).usesPerRest>1?"s":"")??""} per ${e(x),i(()=>e(x).restType)??""}
                      rest `)),o(ue,Be)},Ue=ue=>{var Be=yt(),ct=Se(Be);{var wt=lt=>{var Y=Zn();o(lt,Y)};g(ct,lt=>{e(x),i(()=>e(x).requiresReaction)&&lt(wt)},!0)}o(ue,Be)};g(ae,ue=>{e(x),i(()=>e(x).usesPerRest)?ue($t):ue(Ue,!1)})}s(xe),L(()=>{C(qe,(e(x),i(()=>e(x).name))),it(st,"aria-label",`Remove ${e(x),i(()=>e(x).name)??""}`),C(he,(e(x),i(()=>e(x).description)))}),B("click",st,()=>ye(q)),o(Ve,xe)}),s(ut),o(le,ut)};g(we,le=>{e(X),i(()=>e(X).length>0)&&le(We)})}s($),s(ce);var He=a(ce,2),Ze=l(He),dt=a(Ze,2);s(He),s(J),s(F),B("click",ge,Ee),Pe(Xe,()=>e(p),le=>n(p,le)),Pe(pt,()=>e(m),le=>n(m,le)),Pe(ot,()=>e(k),le=>n(k,le)),Pe(At,()=>e(y),le=>n(y,le)),Pe(O,()=>e(h),le=>n(h,le)),Pe(E,()=>e(z),le=>n(z,le)),Pe(De,()=>e(V),le=>n(V,le)),B("keydown",De,le=>le.key==="Enter"&&Ie()),B("click",$e,Ie),Pe(oe,()=>e(se),le=>n(se,le)),Pe(Oe,()=>e(N),le=>n(N,le)),Pe(ne,()=>e(R),le=>n(R,le)),Ua(d,()=>e(I),le=>n(I,le)),Aa(Z,()=>e(ee),le=>n(ee,le)),B("click",je,te),B("click",Ze,Ee),B("click",dt,Re),B("click",F,M),o(b,F)};g(w,b=>{t()&&b(K)})}o(r,T),Qt()}var lo=u("<option></option>"),ro=u("<button> </button>"),io=u('<div class="adjustment-msg svelte-uvfntf"> </div>'),no=u('<div class="calculation-result svelte-uvfntf"><div class="result-header svelte-uvfntf"><h4 class="svelte-uvfntf">Damage Calculation</h4></div> <div class="result-content svelte-uvfntf"><div class="damage-breakdown svelte-uvfntf"><div class="damage-row svelte-uvfntf"><span class="label svelte-uvfntf">Original Damage:</span> <span class="value svelte-uvfntf"> </span></div> <div class="adjustments svelte-uvfntf"></div> <div class="damage-row final svelte-uvfntf"><span class="label svelte-uvfntf">Final Damage:</span> <span class="value damage-value svelte-uvfntf"> </span></div></div></div> <div class="result-actions svelte-uvfntf"><button class="btn btn-primary apply-btn use-enabled svelte-uvfntf">Apply Damage</button> <button class="btn btn-secondary cancel-btn use-enabled svelte-uvfntf">Cancel</button></div></div>'),oo=u('<div class="damage-form svelte-uvfntf"><div class="input-group svelte-uvfntf"><div class="input-field svelte-uvfntf"><label for="damageAmount" class="svelte-uvfntf">Damage Amount</label> <input type="number" id="damageAmount" min="0" placeholder="0" class="damage-input-field use-enabled svelte-uvfntf"/></div> <div class="input-field svelte-uvfntf"><label for="damageType" class="svelte-uvfntf">Damage Type</label> <input type="text" id="damageType" list="damageTypes" placeholder="e.g., fire, cold" class="damage-input-field use-enabled svelte-uvfntf"/> <datalist id="damageTypes"></datalist></div></div> <div class="quick-types svelte-uvfntf"><span class="quick-types-label svelte-uvfntf">Quick Select:</span> <!></div> <!></div>'),co=u("<section><!> <!></section>");function vo(r,c){Yt(c,!1);const t=()=>bt(ve,"$character",p),v=()=>bt(xa,"$searchFilter",p),f=()=>bt(la,"$collapsedStates",p),[p,m]=fa(),k=D();Sa();let y=D(0),h=D(""),z=D(0),P=D([]);const V=["slashing","piercing","bludgeoning","fire","cold","lightning","thunder","acid","poison","necrotic","radiant","psychic","force"],X={slashing:"üó°Ô∏è",piercing:"üèπ",bludgeoning:"üî®",fire:"üî•",cold:"‚ùÑÔ∏è",lightning:"‚ö°",thunder:"üí•",acid:"üß™",poison:"‚ò†Ô∏è",necrotic:"üíÄ",radiant:"‚ú®",psychic:"üß†",force:"üå™Ô∏è"};function se(){ve.update(re=>Wl(re,e(z))),Ot.add(`Applied ${e(z)} damage to character (${e(h)})`,"info"),n(y,0),n(h,""),n(z,0),n(P,[])}function N(){n(y,0),n(h,""),n(z,0),n(P,[])}Ye(()=>(e(y),e(h),t()),()=>{if(e(y)>=0&&e(h).trim()){const re=zl(e(y),e(h),t());n(z,re.finalDamage),n(P,re.adjustments)}else n(z,0),n(P,[])}),Ye(()=>v(),()=>{n(k,!v()||"damage".includes(v().toLowerCase())||"resistance".includes(v().toLowerCase())||"immune".includes(v().toLowerCase()))}),ga(),Jt();var R=co();let I;var ee=l(R);{let re=kt(()=>(f(),i(()=>f().damageInput?"Expand":"Collapse")));Ca(ee,{title:"Apply Damage",get collapsed(){return f(),i(()=>f().damageInput)},get ariaLabel(){return e(re)},onToggle:()=>la.update(te=>({...te,damageInput:!te.damageInput}))})}var pe=a(ee,2);{var Ie=re=>{var te=oo(),ye=l(te),Re=l(ye),Ee=a(l(Re),2);Ce(Ee),s(Re);var M=a(Re,2),T=a(l(M),2);Ce(T);var w=a(T,2);St(w,5,()=>V,jt,(me,ge)=>{var ce=lo(),de={};L(()=>{de!==(de=e(ge))&&(ce.value=(ce.__value=e(ge))??"")}),o(me,ce)}),s(w),s(M),s(ye);var K=a(ye,2),b=a(l(K),2);St(b,1,()=>V,jt,(me,ge)=>{var ce=ro();let de;var Xe=l(ce);s(ce),L(()=>{de=It(ce,1,"quick-type-btn use-enabled svelte-uvfntf",null,de,{active:e(h)===e(ge)}),C(Xe,`${e(ge),i(()=>X[e(ge)])??""} ${e(ge)??""}`)}),B("click",ce,()=>n(h,e(ge))),o(me,ce)}),s(K);var F=a(K,2);{var J=me=>{var ge=no(),ce=a(l(ge),2),de=l(ce),Xe=l(de),nt=a(l(Xe),2),pt=l(nt);s(nt),s(Xe);var _t=a(Xe,2);St(_t,5,()=>e(P),jt,(_,E)=>{var G=io(),ie=l(G,!0);s(G),L(()=>C(ie,e(E))),o(_,G)}),s(_t);var mt=a(_t,2),ot=a(l(mt),2),Bt=l(ot,!0);s(ot),s(mt),s(de),s(ce);var At=a(ce,2),S=l(At),O=a(S,2);s(At),s(ge),L(()=>{C(pt,`${e(y)??""} ${e(h),i(()=>X[e(h)]||"")??""} ${e(h)??""}`),C(Bt,e(z))}),B("click",S,se),B("click",O,N),o(me,ge)};g(F,me=>{e(y),e(h),i(()=>e(y)>=0&&e(h).trim())&&me(J)})}s(te),Pe(Ee,()=>e(y),me=>n(y,me)),Pe(T,()=>e(h),me=>n(h,me)),o(re,te)};g(pe,re=>{f(),i(()=>!f().damageInput)&&re(Ie)})}s(R),L(()=>I=It(R,1,"damage-input svelte-uvfntf",null,I,{hidden:!e(k)})),o(r,R),Qt(),m()}var uo=u('<link rel="icon" type="image/png" href="favicon4.png"/> <meta name="viewport" content="width=device-width, initial-scale=1"/>',1),fo=u('<span class="character-name svelte-1uha8ag"> </span>'),po=u("<span> </span>"),mo=u('<div class="spell-slots-header svelte-1uha8ag"></div>'),go=u("<span> </span><br/>",1),bo=u("<span> </span><br/>",1),ho=u("<span> </span><br/>",1),_o=u("<span> </span><br/>",1),yo=u("<span> </span><br/>",1),xo=u("<span> </span><br/>",1),$o=u("<br/><em> <!>)</em>",1),wo=u("<br/><em>(requires reaction)</em>",1),ko=u('<div class="ability-detail"><strong> </strong> <!></div>'),So=u('<div class="abilities-section"><strong>Abilities:</strong><br/> <!></div>'),Co=u('<span class="effect-tooltip"><strong> </strong><br/> <br/> <!> <!> <!> <!> <!> <!> <!></span>'),Do=u('<button class="effect-remove-btn svelte-1uha8ag">√ó</button>'),Lo=u('<span class="effect-badge svelte-1uha8ag" tabindex="0"> <!> <!></span>'),Ao=u(`<div class="active-effects-header svelte-1uha8ag"></div> <style>.effect-badge {
              position: relative;
            }
            .effect-tooltip {
              position: absolute;
              top: 120%;
              left: 50%;
              transform: translateX(-50%);
              background: #fff;
              color: #222;
              border: 1px solid #a5b4fc;
              border-radius: 6px;
              padding: 8px 12px;
              font-size: 0.95em;
              box-shadow: 0 2px 8px rgba(0, 0, 0, 0.12);
              z-index: 10;
              min-width: 180px;
              max-width: 300px;
              white-space: normal;
              pointer-events: none;
              opacity: 1;
              transition: opacity 0.15s;
            }

            .abilities-section {
              margin-top: 8px;
              padding-top: 8px;
              border-top: 1px solid #e5e7eb;
            }

            .ability-detail {
              margin-top: 6px;
              padding: 4px;
              background: #f9fafb;
              border-radius: 4px;
              font-size: 0.9em;
            }

            .ability-detail strong {
              color: #6366f1;
            }

            .ability-detail em {
              font-size: 0.85em;
              color: #6b7280;
            }</style>`,1),jo=u('<div class="rest-menu svelte-1uha8ag"><button class="rest-option svelte-1uha8ag">‚òï Short Rest</button> <button class="rest-option svelte-1uha8ag">üõèÔ∏è Long Rest</button></div>'),Bo=u('<div class="container svelte-1uha8ag"><header class="svelte-1uha8ag"><div class="header-top svelte-1uha8ag"><div class="header-title svelte-1uha8ag"><div class="title-row svelte-1uha8ag"><h1 class="svelte-1uha8ag">D&D Character Sheet</h1> <!></div> <!> <!></div> <div class="header-right svelte-1uha8ag"><div class="header-controls svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">üé≤</span><span class="btn-text svelte-1uha8ag">Roll Dice</span></button> <div class="rest-button-container svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">üò¥</span><span class="btn-text svelte-1uha8ag">Rest</span></button> <!></div> <button class="btn btn-secondary use-enabled" title="Add custom condition with effects"><span class="btn-icon svelte-1uha8ag">‚ú®</span><span class="btn-text svelte-1uha8ag">Add Condition</span></button> <div class="mode-toggle"><button><span class="btn-icon svelte-1uha8ag"> </span><span class="btn-text svelte-1uha8ag"> </span></button> <button class="btn btn-mode svelte-1uha8ag" title="Toggle dark mode"><span class="btn-icon svelte-1uha8ag"> </span> <span class="btn-text svelte-1uha8ag"> </span></button></div></div> <div class="header-search svelte-1uha8ag"><input type="text" placeholder="üîç Search..." class="search-input use-enabled svelte-1uha8ag"/></div></div></div> <div class="header-actions svelte-1uha8ag"><button class="btn btn-mode svelte-1uha8ag">üìö Browse Spells & Feats</button> <button class="btn btn-secondary">Save to Gist</button> <button class="btn btn-secondary">Load from Gist</button> <button class="btn btn-secondary">Export JSON</button> <button class="btn btn-secondary">Import JSON</button> <input type="file" accept=".json" style="display: none;"/></div></header> <main class="svelte-1uha8ag"><!> <!> <!> <!> <!> <!> <!> <!></main></div> <!> <!> <!> <!> <!>',1);function Uo(r,c){Yt(c,!1);const t=()=>bt(ve,"$character",p),v=()=>bt(wa,"$isEditMode",p),f=()=>bt(xa,"$searchFilter",p),[p,m]=fa();let k=D(!1);function y(j){n(k,j),j?document.body.classList.add("dark-mode"):document.body.classList.remove("dark-mode"),localStorage.setItem("dnd-dark-mode",j?"true":"false")}function h(){y(!e(k))}ka(()=>{const j=localStorage.getItem("dnd-dark-mode");y(j==="true")});function z(){const j=[],ke=t().classFeatures.spellSlotsByLevel||{};for(let Me=1;Me<=9;Me++){const ft=ke[Me];if(ft&&ft.length>0){const A=ft.length,rt=ft.filter(Je=>Je).length;j.push({level:Me,available:A-rt,total:A})}}return j}let P=D(!1),V=D(!1),X=D(!1),se=D(!1),N=D("save"),R=D(void 0),I=D(""),ee=D(""),pe=D(""),Ie=D(!1),re=D([]),te=D([]),ye=D("other"),Re=D(),Ee=!1,M=1,T=D(!1),w=D(null);function K(j){n(w,j)}function b(){n(w,null)}function F(j){n(w,e(w)===j?null:j)}function J(j){ve.update(ke=>(ke.activeStates||(ke.activeStates=[]),ke.activeStates=[...ke.activeStates,j],ke)),n(se,!1),Ot.add(`Added condition: ${j.name}`,"success")}function me(){n(se,!1)}function ge(){const j=[];ve.update(A=>{const rt=A.hitDice.current;A.hitDice.current=Math.min(A.hitDice.max,A.hitDice.current+Math.max(1,Math.floor(A.hitDice.max/2)));const Je=A.hitDice.current-rt;if(Je>0&&j.push(`${Je} hit ${Je===1?"die":"dice"}`),A.class){const gt=Ma(A.class,A.level,A.subclass);A.classFeatures.features||(A.classFeatures.features={}),gt.forEach(ze=>{if(ze.resetOn==="short"){const et=ze.name.replace(/\s+/g,"");if(ze.type==="uses"){const Ne=typeof ze.maxUses=="function"?ze.maxUses(A.level):ze.maxUses;A.classFeatures.features[et]=Array(Ne).fill(!1),j.push(ze.name)}else if(ze.type==="pool"){const Ne=typeof ze.maxPool=="function"?ze.maxPool(A.level):ze.maxPool;Ne!==void 0&&(A.classFeatures.features[et]=Ne,j.push(ze.name))}}})}return A.activeStates&&A.activeStates.forEach(gt=>{gt.abilities&&gt.abilities.forEach(ze=>{if(ze.restType==="short"&&ze.usesPerRest){const et=ze.usesPerRest-(ze.currentUses||0)>0;ze.currentUses=ze.usesPerRest,et&&j.push(`${gt.name}: ${ze.name}`)}})}),A}),ks("short"),Ss(t().race,t().level).some(A=>A.restType==="short"&&A.usesPerRest)&&j.push("racial traits"),n(T,!1);const ft=j.length>0?`Short rest taken! Restored: ${j.join(", ")}`:"Short rest taken!";Ot.add(ft,"success")}function ce(){const j=[];ve.update(A=>{const rt=A.maxHP-A.currentHP;rt>0&&j.push(`${rt} HP`),A.currentHP=A.maxHP,A.tempHP=0;const Je=A.hitDice.max-A.hitDice.current;Je>0&&j.push(`${Je} hit ${Je===1?"die":"dice"}`),A.hitDice.current=A.hitDice.max;let gt=0;if(A.classFeatures.spellSlotsByLevel&&Object.keys(A.classFeatures.spellSlotsByLevel).forEach(ze=>{const et=A.classFeatures.spellSlotsByLevel[parseInt(ze)];if(et){const Ne=et.filter(Ht=>Ht).length;gt+=Ne,A.classFeatures.spellSlotsByLevel[parseInt(ze)]=Array(et.length).fill(!1)}}),gt>0&&j.push(`${gt} spell ${gt===1?"slot":"slots"}`),A.class){const ze=Ma(A.class,A.level,A.subclass);A.classFeatures.features||(A.classFeatures.features={});let et=!1;ze.forEach(Ne=>{const Ht=Ne.name.replace(/\s+/g,"");if(!(Ne.type==="info"||Ne.type==="channelDivinity")){if(Ne.type==="uses"){const Mt=typeof Ne.maxUses=="function"?Ne.maxUses(A.level):Ne.maxUses;A.classFeatures.features[Ht]=Array(Mt).fill(!1),et=!0}else if(Ne.type==="pool"){const Mt=typeof Ne.maxPool=="function"?Ne.maxPool(A.level):Ne.maxPool;Mt!==void 0&&(A.classFeatures.features[Ht]=Mt,et=!0)}}}),et&&j.push("all class features")}if(A.activeStates){let ze=!1;A.activeStates.forEach(et=>{et.abilities&&et.abilities.forEach(Ne=>{if(Ne.usesPerRest){const Ht=(Ne.currentUses||0)<Ne.usesPerRest;Ne.currentUses=Ne.usesPerRest,Ht&&(ze=!0)}})}),ze&&j.push("condition abilities")}return A}),ks("long"),Ss(t().race,t().level).some(A=>A.usesPerRest)&&j.push("racial traits"),n(T,!1);const ft=j.length>0?`Long rest taken! Restored: ${j.join(", ")}`:"Long rest taken! Fully rested.";Ot.add(ft,"success")}function de(j){n(I,""),n(ee,""),n(pe,""),n(Ie,!1),n(re,[]),n(te,[]),n(ye,"other"),Ee=!1,typeof j=="string"?n(I,j):(n(I,j.notation),n(ee,j.damageNotation||""),n(pe,j.attackName||""),n(Ie,!!j.applyHalfDamage),n(re,j.bonusBreakdown||[]),n(te,j.damageBreakdown||[]),n(ye,j.rollType||"other")),n(P,!0)}function Xe(j){const{notation:ke,count:Me,bonusBreakdown:ft}=j.detail;n(I,""),Ee=!0,M=Me||1,setTimeout(()=>{n(I,ke),n(ee,""),n(pe,"Hit Die"),n(re,ft||[]),n(ye,"other")},0),n(P,!0)}function nt(){if(n(P,!1),Ee&&e(Re)){const j=e(Re).getLastRollTotal();if(j!==null){const ke=Math.max(1,j);ve.update(Me=>(Me.hitDice.current=Math.max(0,Me.hitDice.current-M),Me.currentHP=Math.min(Me.maxHP,Me.currentHP+ke),Me))}Ee=!1}}function pt(){wa.update(j=>!j)}function _t(j){j.target.closest(".rest-button-container")||n(T,!1)}ka(()=>{const j=wa.subscribe(ke=>{ke?document.body.classList.remove("use-mode"):document.body.classList.add("use-mode")});return document.addEventListener("click",_t),()=>{j(),document.removeEventListener("click",_t)}});function mt(){gl(t())}function ot(){e(R)?.click()}async function Bt(j){const Me=j.target.files?.[0];if(Me)try{const ft=await bl(Me);ve.set(ft),alert("Character imported successfully!")}catch{alert("Failed to import character file")}}Jt();var At=Bo();pl("1uha8ag",j=>{var ke=uo();sa(2),Is(()=>{vl.title="D&D Character Sheet"}),o(j,ke)});var S=Se(At),O=l(S),_=l(O),E=l(_),G=l(E),ie=a(l(G),2);{var De=j=>{var ke=fo(),Me=l(ke);s(ke),L(()=>C(Me,`${t().name??""} (${t().level??""})`)),o(j,ke)};g(ie,j=>{t().name&&j(De)})}s(G);var $e=a(G,2);{var Te=j=>{var ke=mo();St(ke,5,z,jt,(Me,ft)=>{var A=po();let rt;var Je=l(A);s(A),L(()=>{rt=It(A,1,"slot-badge svelte-1uha8ag",null,rt,{depleted:e(ft).available===0}),C(Je,`Lv${e(ft).level??""}: ${e(ft).available??""}/${e(ft).total??""}`)}),o(Me,A)}),s(ke),o(j,ke)};g($e,j=>{z().length>0&&j(Te)})}var Le=a($e,2);{var $=j=>{var ke=Ao(),Me=Se(ke);St(Me,5,()=>t().activeStates,jt,(ft,A,rt)=>{var Je=Lo(),gt=l(Je),ze=a(gt);{var et=Mt=>{var Ut=Co(),vt=l(Ut),Qe=l(vt,!0);s(vt);var Tt=a(vt,2),Gt=a(Tt,3);{var Zt=at=>{var xt=go(),Ct=Se(xt),zt=l(Ct);s(Ct),sa(),L(()=>C(zt,`Attack Bonus: ${typeof e(A).attackBonus=="number"&&e(A).attackBonus>0?"+":""}${e(A).attackBonus??""}`)),o(at,xt)};g(Gt,at=>{e(A).attackBonus&&at(Zt)})}var va=a(Gt,2);{var pa=at=>{var xt=bo(),Ct=Se(xt),zt=l(Ct);s(Ct),sa(),L(()=>C(zt,`Damage Bonus: ${typeof e(A).damageBonus=="number"&&e(A).damageBonus>0?"+":""}${e(A).damageBonus??""}`)),o(at,xt)};g(va,at=>{e(A).damageBonus&&at(pa)})}var da=a(va,2);{var Kt=at=>{var xt=ho(),Ct=Se(xt),zt=l(Ct);s(Ct),sa(),L(()=>C(zt,`AC Bonus: ${e(A).acBonus>0?"+":""}${e(A).acBonus??""}`)),o(at,xt)};g(da,at=>{e(A).acBonus&&at(Kt)})}var ea=a(da,2);{var Vt=at=>{var xt=_o(),Ct=Se(xt),zt=l(Ct);s(Ct),sa(),L(()=>C(zt,`Darkvision: ${e(A).darkvision??""} feet`)),o(at,xt)};g(ea,at=>{e(A).darkvision&&at(Vt)})}var Ft=a(ea,2);{var na=at=>{var xt=yo(),Ct=Se(xt),zt=l(Ct);s(Ct),sa(),L(Et=>C(zt,`Resistances: ${Et??""}`),[()=>e(A).resistances.join(", ")]),o(at,xt)};g(Ft,at=>{e(A).resistances&&e(A).resistances.length>0&&at(na)})}var ma=a(Ft,2);{var ha=at=>{var xt=xo(),Ct=Se(xt),zt=l(Ct);s(Ct),sa(),L(Et=>C(zt,`Immunities: ${Et??""}`),[()=>e(A).immunities.join(", ")]),o(at,xt)};g(ma,at=>{e(A).immunities&&e(A).immunities.length>0&&at(ha)})}var qt=a(ma,2);{var ra=at=>{var xt=So(),Ct=a(l(xt),3);St(Ct,1,()=>e(A).abilities,jt,(zt,Et)=>{var oa=ko(),Dt=l(oa),ia=l(Dt);s(Dt);var Da=a(Dt),es=a(Da);{var ts=ca=>{var ba=$o(),Ba=a(Se(ba)),Oa=l(Ba),Ta=a(Oa);{var ss=ls=>{var zs=Pt(", requires reaction");o(ls,zs)};g(Ta,ls=>{e(Et).requiresReaction&&ls(ss)})}sa(),s(Ba),L(()=>C(Oa,`(${(e(Et).currentUses||0)??""}/${e(Et).usesPerRest??""} uses per ${e(Et).restType??""}
                                rest`)),o(ca,ba)},as=ca=>{var ba=yt(),Ba=Se(ba);{var Oa=Ta=>{var ss=wo();sa(),o(Ta,ss)};g(Ba,Ta=>{e(Et).requiresReaction&&Ta(Oa)},!0)}o(ca,ba)};g(es,ca=>{e(Et).usesPerRest?ca(ts):ca(as,!1)})}s(oa),L(()=>{C(ia,`${e(Et).name??""}:`),C(Da,` ${e(Et).description??""} `)}),o(zt,oa)}),s(xt),o(at,xt)};g(qt,at=>{e(A).abilities&&e(A).abilities.length>0&&at(ra)})}s(Ut),L(()=>{C(Qe,e(A).name),C(Tt,` ${e(A).description??""}`)}),o(Mt,Ut)};g(ze,Mt=>{e(w)===rt&&Mt(et)})}var Ne=a(ze,2);{var Ht=Mt=>{var Ut=Do();L(()=>it(Ut,"title",`End ${e(A).name??""}`)),B("click",Ut,()=>{ve.update(vt=>{if(vt.activeStates){const Qe=vt.activeStates[rt];Qe?.hpBonus&&Qe.target!=="other"&&(vt.maxHP-=Qe.hpBonus,vt.currentHP=Math.max(1,Math.min(vt.currentHP-Qe.hpBonus,vt.maxHP))),vt.activeStates=vt.activeStates.filter((Tt,Gt)=>Gt!==rt)}return vt})}),o(Mt,Ut)};g(Ne,Mt=>{v()||Mt(Ht)})}s(Je),L(()=>{it(Je,"aria-label",e(A).name),C(gt,`‚ú® ${e(A).name??""} `)}),B("mouseenter",Je,()=>K(rt)),B("mouseleave",Je,b),B("focus",Je,()=>K(rt)),B("blur",Je,b),B("click",Je,()=>F(rt)),o(ft,Je)}),s(Me),sa(2),o(j,ke)};g(Le,j=>{t().activeStates&&t().activeStates.length>0&&j($)})}s(E);var Q=a(E,2),oe=l(Q),Oe=l(oe),Fe=a(Oe,2),ht=l(Fe),ne=a(ht,2);{var W=j=>{var ke=jo(),Me=l(ke),ft=a(Me,2);s(ke),B("click",Me,ge),B("click",ft,ce),o(j,ke)};g(ne,j=>{e(T)&&j(W)})}s(Fe);var d=a(Fe,2),Ge=a(d,2),fe=l(Ge);let H;var _e=l(fe),Z=l(_e,!0);s(_e);var je=a(_e),we=l(je,!0);s(je),s(fe);var We=a(fe,2),He=l(We),Ze=l(He,!0);s(He);var dt=a(He,2),le=l(dt,!0);s(dt),s(We),s(Ge),s(oe);var ut=a(oe,2),Ve=l(ut);Ce(Ve),s(ut),s(Q),s(_);var x=a(_,2),q=l(x),xe=a(q,2),be=a(xe,2),Ae=a(be,2),qe=a(Ae,2),st=a(qe,2);Ha(st,j=>n(R,j),()=>e(R)),s(x),s(O);var tt=a(O,2),he=l(tt);Pl(he,{});var ae=a(he,2);Ul(ae,{$$events:{roll:j=>de(j.detail)}});var $t=a(ae,2);nr($t,{$$events:{roll:j=>de(j.detail)}});var Ue=a($t,2);sr(Ue,{$$events:{rollHitDice:Xe}});var ue=a(Ue,2);vo(ue,{});var Be=a(ue,2);hi(Be,{$$events:{roll:j=>de(j.detail)}});var ct=a(Be,2);Gi(ct,{});var wt=a(ct,2);Wi(wt,{}),s(tt),s(S);var lt=a(S,2);Ha(fn(lt,{get notation(){return e(I)},get damageNotation(){return e(ee)},get attackName(){return e(pe)},get applyHalfDamage(){return e(Ie)},get bonusBreakdown(){return e(re)},get damageBreakdown(){return e(te)},get rollType(){return e(ye)},get visible(){return e(P)},$$events:{close:nt},$$legacy:!0}),j=>n(Re,j),()=>e(Re));var Y=a(lt,2);{var Xt=j=>{Mn(j,{get mode(){return e(N)},$$events:{close:()=>n(V,!1)}})};g(Y,j=>{e(V)&&j(Xt)})}var Ke=a(Y,2);{var Rt=j=>{Jn(j,{onClose:()=>n(X,!1)})};g(Ke,j=>{e(X)&&j(Rt)})}var ta=a(Ke,2);so(ta,{get show(){return e(se)},onSave:J,onCancel:me});var aa=a(ta,2);ml(aa,{}),L(()=>{H=It(fe,1,"btn btn-mode svelte-1uha8ag",null,H,{"use-mode":!v()}),C(Z,v()?"üìù":"üé≤"),C(we,v()?"Edit Mode":"Use Mode"),C(Ze,e(k)?"‚òÄÔ∏è":"üåô"),C(le,e(k)?"Light Mode":"Dark Mode")}),B("click",Oe,()=>{n(re,[]),n(P,!0)}),B("click",ht,()=>n(T,!e(T))),B("click",d,()=>n(se,!0)),B("click",fe,pt),B("click",We,h),Pe(Ve,f,j=>hl(xa,j)),B("click",q,()=>n(X,!0)),B("click",xe,()=>{n(N,"save"),n(V,!0)}),B("click",be,()=>{n(N,"load"),n(V,!0)}),B("click",Ae,mt),B("click",qe,ot),B("change",st,Bt),o(r,At),Qt(),m()}export{Uo as component};
