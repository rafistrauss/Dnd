import{d as Ga,g as ps,f as h,e as M,a as v,s as A,c as rt,t as Ft}from"../chunks/BESELRjb.js";import{i as Rt}from"../chunks/JMgyEzd3.js";import{c as na,o as va,a as fs,b as hs}from"../chunks/CtPH092J.js";import{F as T,T as Vt,Y as Ta,j as ms,aZ as gs,U as qa,ag as bs,aD as _s,aK as ys,aE as xs,a1 as Ss,av as _a,a7 as Ha,i as as,a_ as ks,a$ as ss,b0 as Da,K as Zt,e as ls,b1 as is,b2 as $s,b3 as Cs,b4 as ws,q as Ra,b5 as Ds,b6 as Ls,ab as js,d as n,r as Na,g as As,C as Et,G as Pt,H as i,I as l,J as s,b7 as Qe,b8 as Yt,s as o,a4 as D,f as e,m as dt,E as Ue,b9 as Ct,ao as ia,A as N,ba as la,bb as pa,bc as Bs}from"../chunks/DyJ43TGI.js";import{t as Ms,c as Tt,a as se,e as St,i as kt,u as ns,s as ta,b as yt,d as ga,f as ea,g as Fs,j as qt,h as Ts,T as Rs,k as Es,l as Ps}from"../chunks/D6-WMxVZ.js";import{i as k,s as Wt,a as tt,b as _t,d as da,e as Is}from"../chunks/CCL4udNy.js";import{p as xt,b as ma}from"../chunks/iXw84bXb.js";import{b as ua,r as Hs}from"../chunks/DcOwP38V.js";function Ns(a,r,t=!1,c=!1,d=!1){var p=a,g="";T(()=>{var $=ms;if(g===(g=r()??"")){Vt&&Ta();return}if($.nodes_start!==null&&(gs($.nodes_start,$.nodes_end),$.nodes_start=$.nodes_end=null),g!==""){if(Vt){qa.data;for(var x=Ta(),y=x;x!==null&&(x.nodeType!==bs||x.data!=="");)y=x,x=_s(x);if(x===null)throw ys(),xs;Ga(qa,y),p=Ss(x);return}var z=g+"";t?z=`<svg>${z}</svg>`:c&&(z=`<math>${z}</math>`);var U=ps(z);if((t||c)&&(U=_a(U)),Ga(_a(U),U.lastChild),t||c)for(;_a(U);)p.before(_a(U));else p.before(U)}})}function Us(a,r,t,c,d){Vt&&Ta();var p=r.$$slots?.[t],g=!1;p===!0&&(p=r[t],g=!0),p===void 0?d!==null&&d(a):p(a,g?()=>c:c)}function Os(a,r,t,c){var d=a.__style;if(Vt||d!==r){var p=Ms(r);(!Vt||p!==a.getAttribute("style"))&&(p==null?a.removeAttribute("style"):a.style.cssText=p),a.__style=r}return c}function $a(a,r,t=!1){if(a.multiple){if(r==null)return;if(!as(r))return ks();for(var c of a.options)c.selected=r.includes(fa(c));return}for(c of a.options){var d=fa(c);if(ss(d,r)){c.selected=!0;return}}(!t||r!==void 0)&&(a.selectedIndex=-1)}function Ea(a){var r=new MutationObserver(()=>{$a(a,a.__value)});r.observe(a,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Ha(()=>{r.disconnect()})}function Ca(a,r,t=r){var c=new WeakSet,d=!0;Da(a,"change",p=>{var g=p?"[selected]":":checked",$;if(a.multiple)$=[].map.call(a.querySelectorAll(g),fa);else{var x=a.querySelector(g)??a.querySelector("option:not([disabled])");$=x&&fa(x)}t($),Zt!==null&&c.add(Zt)}),ls(()=>{var p=r();if(a===document.activeElement){var g=is??Zt;if(c.has(g))return}if($a(a,p,d),d&&p===void 0){var $=a.querySelector(":checked");$!==null&&(p=fa($),t(p))}a.__value=p,d=!1}),Ea(a)}function fa(a){return"__value"in a?a.__value:a.value}const Gs=Symbol("is custom element"),qs=Symbol("is html");function De(a){if(Vt){var r=!1,t=()=>{if(!r){if(r=!0,a.hasAttribute("value")){var c=a.value;Ve(a,"value",null),a.value=c}if(a.hasAttribute("checked")){var d=a.checked;Ve(a,"checked",null),a.checked=d}}};a.__on_r=t,Ra(t),Ds()}}function ha(a,r){var t=Ua(a);t.value===(t.value=r??void 0)||a.value===r&&(r!==0||a.nodeName!=="PROGRESS")||(a.value=r??"")}function rs(a,r){var t=Ua(a);t.checked!==(t.checked=r??void 0)&&(a.checked=r)}function Ve(a,r,t,c){var d=Ua(a);Vt&&(d[r]=a.getAttribute(r),r==="src"||r==="srcset"||r==="href"&&a.nodeName==="LINK")||d[r]!==(d[r]=t)&&(r==="loading"&&(a[$s]=t),t==null?a.removeAttribute(r):typeof t!="string"&&Ws(a).includes(r)?a[r]=t:a.setAttribute(r,t))}function Ua(a){return a.__attributes??={[Gs]:a.nodeName.includes("-"),[qs]:a.namespaceURI===Cs}}var Wa=new Map;function Ws(a){var r=a.getAttribute("is")||a.nodeName,t=Wa.get(r);if(t)return t;Wa.set(r,t=[]);for(var c,d=a,p=Element.prototype;p!==d;){c=Ls(d);for(var g in c)c[g].set&&t.push(g);d=ws(d)}return t}function Je(a,r,t=r){var c=new WeakSet;Da(a,"input",async d=>{var p=d?a.defaultValue:a.value;if(p=Aa(a)?Ba(p):p,t(p),Zt!==null&&c.add(Zt),await js(),p!==(p=r())){var g=a.selectionStart,$=a.selectionEnd,x=a.value.length;if(a.value=p??"",$!==null){var y=a.value.length;g===$&&$===x&&y>x?(a.selectionStart=y,a.selectionEnd=y):(a.selectionStart=g,a.selectionEnd=Math.min($,y))}}}),(Vt&&a.defaultValue!==a.value||n(r)==null&&a.value)&&(t(Aa(a)?Ba(a.value):a.value),Zt!==null&&c.add(Zt)),Na(()=>{var d=r();if(a===document.activeElement){var p=is??Zt;if(c.has(p))return}Aa(a)&&d===Ba(a.value)||a.type==="date"&&!d&&!a.value||d!==a.value&&(a.value=d??"")})}const ja=new Set;function za(a,r,t,c,d=c){var p=t.getAttribute("type")==="checkbox",g=a;let $=!1;if(r!==null)for(var x of r)g=g[x]??=[];g.push(t),Da(t,"change",()=>{var y=t.__value;p&&(y=Ka(g,y,t.checked)),d(y)},()=>d(p?[]:null)),Na(()=>{var y=c();if(Vt&&t.defaultChecked!==t.checked){$=!0;return}p?(y=y||[],t.checked=y.includes(t.__value)):t.checked=ss(t.__value,y)}),Ha(()=>{var y=g.indexOf(t);y!==-1&&g.splice(y,1)}),ja.has(g)||(ja.add(g),Ra(()=>{g.sort((y,z)=>y.compareDocumentPosition(z)===4?-1:1),ja.delete(g)})),Ra(()=>{if($){var y;if(p)y=Ka(g,y,t.checked);else{var z=g.find(U=>U.checked);y=z?.__value}d(y)}})}function wa(a,r,t=r){Da(a,"change",c=>{var d=c?a.defaultChecked:a.checked;t(d)}),(Vt&&a.defaultChecked!==a.checked||n(r)==null)&&t(a.checked),Na(()=>{var c=r();a.checked=!!c})}function Ka(a,r,t){for(var c=new Set,d=0;d<a.length;d+=1)a[d].checked&&c.add(a[d].__value);return t||c.delete(r),Array.from(c)}function Aa(a){var r=a.type;return r==="number"||r==="range"}function Ba(a){return a===""?null:+a}function zs(a,r,t){var c=As(a,r);c&&c.set&&(a[r]=t,Ha(()=>{a[r]=null}))}function Oa(a){return function(...r){var t=r[0];return t.stopPropagation(),a?.apply(this,r)}}function oa(a,r){var t=a.$$events?.[r.type],c=as(t)?t.slice():t==null?[]:[t];for(var d of c)d.call(this,r)}const Ks="";function os(...a){return ua+Ks+Hs(a[0],a[1])}const Pa={paladin:{name:"Paladin",hitDice:"d10",spellcaster:!0,spellcastingAbility:"charisma",spellSlotsByLevel:{1:0,2:2,3:3,4:3,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Divine Sense",type:"uses",maxUses:(a,r=1)=>1+Math.max(1,r),resetOn:"long",description:"Detect celestials, fiends, and undead within 60 feet",minLevel:1},{name:"Lay on Hands",type:"pool",maxPool:a=>a*5,resetOn:"long",description:"Heal wounds or cure disease",minLevel:1},{name:"Divine Smite",type:"spellSlot",description:"Expend spell slot to deal extra radiant damage",minLevel:2,rollable:!0},{name:"Channel Divinity",type:"pool",maxPool:a=>a>=18?3:a>=6?2:1,resetOn:"short",description:"Sacred Weapon or Turn Undead",minLevel:3}]},fighter:{name:"Fighter",hitDice:"d10",spellcaster:!1,features:[{name:"Second Wind",type:"uses",maxUses:1,resetOn:"short",description:"Regain 1d10 + fighter level HP as bonus action",minLevel:1,rollable:!0,rollFormula:a=>`1d10+${a}`},{name:"Action Surge",type:"uses",maxUses:a=>a>=17?2:1,resetOn:"short",description:"Take one additional action on your turn",minLevel:2},{name:"Indomitable",type:"uses",maxUses:a=>a>=17?3:a>=13?2:1,resetOn:"long",description:"Reroll a failed saving throw",minLevel:9}],subclasses:{champion:{name:"Champion",features:[{name:"Improved Critical",type:"info",description:"Critical hit on 19-20",minLevel:3},{name:"Remarkable Athlete",type:"info",description:"Add half proficiency to STR/DEX/CON checks, increase long jump distance",minLevel:7},{name:"Additional Fighting Style",type:"info",description:"Choose a second fighting style",minLevel:10},{name:"Superior Critical",type:"info",description:"Critical hit on 18-20",minLevel:15},{name:"Survivor",type:"info",description:"Regain 5 + CON mod HP at start of turn if below half HP",minLevel:18}]},battlemaster:{name:"Battle Master",features:[{name:"Combat Superiority",type:"uses",maxUses:a=>a>=15?6:a>=7?5:4,resetOn:"short",description:a=>`Use superiority dice (${a>=18?"d12":a>=10?"d10":"d8"}) for maneuvers`,minLevel:3},{name:"Know Your Enemy",type:"info",description:"Learn capabilities of creatures you observe",minLevel:7},{name:"Improved Combat Superiority",type:"info",description:"Superiority dice become d10",minLevel:10},{name:"Relentless",type:"info",description:"Regain 1 superiority die if you have none at start of turn",minLevel:15}]}}},rogue:{name:"Rogue",hitDice:"d8",spellcaster:!1,features:[{name:"Sneak Attack",type:"info",description:a=>`Deal ${Math.ceil(a/2)}d6 extra damage once per turn with advantage or ally nearby`,minLevel:1,rollable:!0,rollFormula:a=>`${Math.ceil(a/2)}d6`},{name:"Cunning Action",type:"info",description:"Dash, Disengage, or Hide as a bonus action",minLevel:2},{name:"Uncanny Dodge",type:"info",description:"Use reaction to halve damage from an attack",minLevel:5},{name:"Evasion",type:"info",description:"Take no damage on successful Dex save (half on fail)",minLevel:7}]},wizard:{name:"Wizard",hitDice:"d6",spellcaster:!0,spellcastingAbility:"intelligence",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Arcane Recovery",type:"uses",maxUses:1,resetOn:"long",description:a=>`Recover spell slots totaling up to ${Math.ceil(a/2)} levels during short rest`,minLevel:1},{name:"Spell Mastery",type:"info",description:"Cast one 1st-level and one 2nd-level spell at will",minLevel:18}]},cleric:{name:"Cleric",hitDice:"d8",spellcaster:!0,spellcastingAbility:"wisdom",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Channel Divinity",type:"pool",maxPool:a=>a>=18?3:a>=6?2:1,resetOn:"short",description:"Turn Undead or domain-specific ability",minLevel:2},{name:"Destroy Undead",type:"info",description:a=>`Channel Divinity destroys undead of CR ${a>=17?4:a>=14?3:a>=11?2:a>=8?1:.5} or lower`,minLevel:5},{name:"Divine Intervention",type:"uses",maxUses:1,resetOn:"long",description:a=>`${a}% chance to succeed, implore deity for aid`,minLevel:10}],subclasses:{war:{name:"War Domain",features:[{name:"War Priest",type:"uses",maxUses:(a,r=1)=>Math.max(1,r),resetOn:"long",description:"Make one weapon attack as a bonus action",minLevel:1},{name:"Guided Strike",type:"channelDivinity",description:"Use your Channel Divinity to gain +10 to an attack roll. Make this choice after you see the roll, but before the DM says whether the attack hits or misses.",minLevel:2,resetOn:"short"},{name:"War God's Blessing",type:"channelDivinity",description:"Use reaction to grant +10 to an ally's attack roll within 30 feet. Consumes one use of Channel Divinity.",minLevel:6,resetOn:"short"},{name:"Divine Strike",type:"info",description:a=>`Deal extra ${a>=14?"2d8":"1d8"} weapon damage once per turn`,minLevel:8,rollable:!0,rollFormula:a=>a>=14?"2d8":"1d8"},{name:"Avatar of Battle",type:"info",description:"Gain resistance to nonmagical weapon damage",minLevel:17}]},life:{name:"Life Domain",features:[{name:"Disciple of Life",type:"info",description:"Healing spells restore additional 2 + spell level HP",minLevel:1},{name:"Preserve Life",type:"pool",maxPool:a=>a*5,resetOn:"short",description:"Restore HP to creatures within 30 feet",minLevel:2},{name:"Blessed Healer",type:"info",description:"Regain 2 + spell level HP when you cast healing spell",minLevel:6},{name:"Divine Strike",type:"info",description:a=>`Deal extra ${a>=14?"2d8":"1d8"} radiant damage once per turn`,minLevel:8,rollable:!0,rollFormula:a=>a>=14?"2d8":"1d8"},{name:"Supreme Healing",type:"info",description:"Maximize healing dice instead of rolling",minLevel:17}]}}},barbarian:{name:"Barbarian",hitDice:"d12",spellcaster:!1,features:[{name:"Rage",type:"uses",maxUses:a=>a>=20?1/0:a>=17?6:a>=12?5:a>=6?4:a>=3?3:2,resetOn:"long",description:a=>`+${a>=16?4:a>=9?3:2} damage, resistance to physical damage`,minLevel:1},{name:"Reckless Attack",type:"info",description:"Gain advantage on melee attacks, enemies get advantage on you",minLevel:2},{name:"Danger Sense",type:"info",description:"Advantage on Dex saves against effects you can see",minLevel:2}],subclasses:{berserker:{name:"Path of the Berserker",features:[{name:"Frenzy",type:"info",description:"While raging, make melee attack as bonus action (gain 1 exhaustion after rage)",minLevel:3},{name:"Mindless Rage",type:"info",description:"Cannot be charmed or frightened while raging",minLevel:6},{name:"Intimidating Presence",type:"info",description:"Use action to frighten creature within 30 feet",minLevel:10},{name:"Retaliation",type:"info",description:"When damaged by creature within 5 feet, make melee attack as reaction",minLevel:14}]}}}};function Ht(a){const r=a.toLowerCase();return Pa[r]||null}function ca(a,r,t){const c=Ht(a);if(!c)return[];const d=c.features.filter(p=>!p.minLevel||p.minLevel<=r);if(t&&c.subclasses&&c.subclasses[t]){const p=c.subclasses[t].features.filter(g=>!g.minLevel||g.minLevel<=r);return[...d,...p]}return d}function Va(a){const r=Ht(a);return!r||!r.subclasses?[]:Object.keys(r.subclasses).map(t=>({id:t,name:r.subclasses[t].name}))}function Ja(a,r){const t=Ht(a);return!t||!t.spellcaster||!t.spellSlotsByLevel?0:t.spellSlotsByLevel[r]||0}function Ya(a,r,t){const c=Ht(a);return!c||!c.spellcaster?0:Math.max(1,t+r)}function Vs(a,r,t){const c=Ht(a);return!c||!c.spellcaster?null:8+r+t}function Js(){return Object.keys(Pa).map(a=>({id:a,name:Pa[a].name}))}var Ys=h('<div class="section-header svelte-ls99y2" role="button" tabindex="0"><h2 class="svelte-ls99y2"> </h2> <span class="collapse-btn svelte-ls99y2"> </span></div>');function ra(a,r){Et(r,!1);let t=xt(r,"title",8),c=xt(r,"collapsed",8),d=xt(r,"ariaLabel",8,""),p=xt(r,"onToggle",8);Rt();var g=Ys(),$=i(g),x=i($,!0);l($);var y=s($,2),z=i(y,!0);l(y),l(g),T(()=>{Ve(g,"aria-expanded",!c()),Ve(g,"aria-label",d()),A(x,t()),A(z,c()?"‚ñº":"‚ñ≤")}),M("click",g,function(...U){p()?.apply(this,U)}),M("keydown",g,U=>{(U.key==="Enter"||U.key===" ")&&p()()}),v(a,g),Pt()}var Qs=h("<option> </option>"),Xs=h("<option> </option>"),Zs=h('<div class="form-group svelte-172i2fj"><label for="characterSubclass" class="svelte-172i2fj">Subclass</label> <select id="characterSubclass" class="svelte-172i2fj"><option>Select Subclass</option><!></select></div>'),el=h('<div class="info-grid svelte-172i2fj"><div class="form-group svelte-172i2fj"><label for="characterName" class="svelte-172i2fj">Character Name</label> <input type="text" id="characterName" placeholder="Enter name" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterClass" class="svelte-172i2fj">Class</label> <select id="characterClass" class="svelte-172i2fj"><option>Select Class</option><!></select></div> <!> <div class="form-group svelte-172i2fj"><label for="characterLevel" class="svelte-172i2fj">Level</label> <input type="number" id="characterLevel" min="1" max="20" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterRace" class="svelte-172i2fj">Race</label> <input type="text" id="characterRace" placeholder="e.g., Human" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterBackground" class="svelte-172i2fj">Background</label> <input type="text" id="characterBackground" placeholder="e.g., Soldier" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterAlignment" class="svelte-172i2fj">Alignment</label> <input type="text" id="characterAlignment" placeholder="e.g., Lawful Good" class="svelte-172i2fj"/></div></div>'),tl=h('<section class="character-info svelte-172i2fj"><!> <!></section>');function al(a,r){Et(r,!1);const t=()=>tt(se,"$character",d),c=()=>tt(Tt,"$collapsedStates",d),[d,p]=Wt(),g=D(),$=Js();function x(_e){const he=_e.target;se.update(G=>(G.class=he.value,G.subclass="",G))}function y(_e){const he=_e.target;se.update(G=>(G.subclass=he.value,G))}function z(_e){const he=_e.target;se.update(G=>(G.level=parseInt(he.value)||1,G)),ns()}Qe(()=>(t(),Va),()=>{o(g,t().class?Va(t().class):[])}),Yt(),Rt();var U=tl(),re=i(U);{let _e=dt(()=>(c(),n(()=>c().characterInfo?"Expand":"Collapse")));ra(re,{title:"Character Info",get collapsed(){return c(),n(()=>c().characterInfo)},get ariaLabel(){return e(_e)},onToggle:()=>Tt.update(he=>({...he,characterInfo:!he.characterInfo}))})}var X=s(re,2);{var ee=_e=>{var he=el(),G=i(he),je=s(i(G),2);De(je),l(G);var ze=s(G,2),oe=s(i(ze),2),Be=i(oe);Be.value=Be.__value="";var Oe=s(Be);St(Oe,1,()=>$,kt,(qe,$e)=>{var m=Qs(),I=i(m,!0);l(m);var Z={};T(()=>{A(I,(e($e),n(()=>e($e).name))),Z!==(Z=(e($e),n(()=>e($e).id)))&&(m.value=(m.__value=(e($e),n(()=>e($e).id)))??"")}),v(qe,m)}),l(oe);var le;Ea(oe),l(ze);var ye=s(ze,2);{var Ee=qe=>{var $e=Zs(),m=s(i($e),2),I=i(m);I.value=I.__value="";var Z=s(I);St(Z,1,()=>e(g),kt,(V,Se)=>{var Me=Xs(),st=i(Me,!0);l(Me);var xe={};T(()=>{A(st,(e(Se),n(()=>e(Se).name))),xe!==(xe=(e(Se),n(()=>e(Se).id)))&&(Me.value=(Me.__value=(e(Se),n(()=>e(Se).id)))??"")}),v(V,Me)}),l(m);var ne;Ea(m),l($e),T(()=>{ne!==(ne=(t(),n(()=>t().subclass)))&&(m.value=(m.__value=(t(),n(()=>t().subclass)))??"",$a(m,(t(),n(()=>t().subclass))))}),M("change",m,y),v(qe,$e)};k(ye,qe=>{e(g),n(()=>e(g).length>0)&&qe(Ee)})}var C=s(ye,2),R=s(i(C),2);De(R),l(C);var S=s(C,2),q=s(i(S),2);De(q),l(S);var b=s(S,2),j=s(i(b),2);De(j),l(b);var ae=s(b,2),Ge=s(i(ae),2);De(Ge),l(ae),l(he),T(()=>{le!==(le=(t(),n(()=>t().class)))&&(oe.value=(oe.__value=(t(),n(()=>t().class)))??"",$a(oe,(t(),n(()=>t().class)))),ha(R,(t(),n(()=>t().level)))}),Je(je,()=>t().name,qe=>_t(se,n(t).name=qe,n(t))),M("change",oe,x),M("change",R,z),Je(q,()=>t().race,qe=>_t(se,n(t).race=qe,n(t))),Je(j,()=>t().background,qe=>_t(se,n(t).background=qe,n(t))),Je(Ge,()=>t().alignment,qe=>_t(se,n(t).alignment=qe,n(t))),v(_e,he)};k(X,_e=>{c(),n(()=>!c().characterInfo)&&_e(ee)})}l(U),v(a,U),Pt(),p()}var sl=h('<div class="ability-card svelte-bbv1xt"><h3 class="svelte-bbv1xt"> </h3> <input type="number" class="ability-score svelte-bbv1xt" min="1" max="30"/> <div class="ability-modifier svelte-bbv1xt"> </div> <div class="roll-buttons svelte-bbv1xt"><button class="roll-btn svelte-bbv1xt">Check</button> <button class="roll-btn svelte-bbv1xt">Save</button></div> <div class="save-proficiency svelte-bbv1xt"><input type="checkbox" class="svelte-bbv1xt"/> <label class="svelte-bbv1xt">Save Prof.</label></div></div>'),ll=h('<div class="proficiency-bonus svelte-bbv1xt"><label for="profBonus">Proficiency Bonus</label> <input type="number" id="profBonus" class="prof-input svelte-bbv1xt"/></div> <div class="abilities-grid svelte-bbv1xt"></div>',1),il=h("<section><!> <!></section>");function nl(a,r){Et(r,!1);const t=()=>tt(ga,"$abilityModifiers",$),c=()=>tt(se,"$character",$),d=()=>tt(ta,"$searchFilter",$),p=()=>tt(Tt,"$collapsedStates",$),g=()=>tt(ea,"$isEditMode",$),[$,x]=Wt(),y=D(),z=D(),U=na(),re=[{key:"strength",label:"Strength"},{key:"dexterity",label:"Dexterity"},{key:"constitution",label:"Constitution"},{key:"intelligence",label:"Intelligence"},{key:"wisdom",label:"Wisdom"},{key:"charisma",label:"Charisma"}];function X(){ns()}function ee(Be){const Oe=t()[Be],le=`1d20${Oe>=0?"+":""}${Oe}`,ye=[];ye.push({value:"1d20",source:"base die"}),Oe!==0&&ye.push({value:Oe,source:Be}),U("roll",{notation:le,rollType:"check",bonusBreakdown:ye})}function _e(Be){const Oe=t()[Be],le=c().saveProficiencies[Be]?c().proficiencyBonus:0,ye=Oe+le,Ee=`1d20${ye>=0?"+":""}${ye}`,C=[];C.push({value:"1d20",source:"base die"}),Oe!==0&&C.push({value:Oe,source:Be}),le!==0&&C.push({value:le,source:"proficiency"}),U("roll",{notation:Ee,rollType:"save",bonusBreakdown:C})}Qe(()=>d(),()=>{o(y,re.filter(({label:Be})=>d()?Be.toLowerCase().includes(d().toLowerCase()):!0))}),Qe(()=>(e(y),d()),()=>{o(z,e(y).length>0||!d()||d().toLowerCase().includes("proficiency"))}),Yt(),Rt();var he=il();let G;var je=i(he);ra(je,{title:"Ability Scores",get collapsed(){return p(),n(()=>p().abilityScores)},ariaLabel:"Toggle Ability Scores Section",onToggle:()=>Tt.update(Be=>({...Be,abilityScores:!Be.abilityScores}))});var ze=s(je,2);{var oe=Be=>{var Oe=ll(),le=Ue(Oe),ye=s(i(le),2);De(ye),l(le);var Ee=s(le,2);St(Ee,5,()=>e(y),kt,(C,R)=>{let S=()=>e(R).key,q=()=>e(R).label;var b=sl(),j=i(b),ae=i(j,!0);l(j);var Ge=s(j,2);De(Ge);var qe=s(Ge,2),$e=i(qe);l(qe);var m=s(qe,2),I=i(m),Z=s(I,2);l(m);var ne=s(m,2),V=i(ne);De(V);var Se=s(V,2);l(ne),l(b),T(Me=>{A(ae,Me),A($e,`${t(),S(),n(()=>t()[S()]>=0?"+":"")??""}${t(),S(),n(()=>t()[S()])??""}`),V.disabled=!g(),Ve(V,"id",`${S()}-save`),Ve(Se,"for",`${S()}-save`)},[()=>(q(),n(()=>q().substring(0,3).toUpperCase()))]),Je(Ge,()=>c().abilities[S()],Me=>_t(se,n(c).abilities[S()]=Me,n(c))),M("change",Ge,X),M("click",I,()=>ee(S())),M("click",Z,()=>_e(S())),wa(V,()=>c().saveProficiencies[S()],Me=>_t(se,n(c).saveProficiencies[S()]=Me,n(c))),v(C,b)}),l(Ee),Je(ye,()=>c().proficiencyBonus,C=>_t(se,n(c).proficiencyBonus=C,n(c))),v(Be,Oe)};k(ze,Be=>{p(),n(()=>!p().abilityScores)&&Be(oe)})}l(he),T(()=>G=yt(he,1,"ability-scores svelte-bbv1xt",null,G,{hidden:!e(z)})),v(a,he),Pt(),x()}const cs=[{name:"Unarmored",type:"none",baseAC:10},{name:"Padded",type:"light",baseAC:11},{name:"Leather",type:"light",baseAC:11},{name:"Studded Leather",type:"light",baseAC:12},{name:"Hide",type:"medium",baseAC:12,maxDexBonus:2},{name:"Chain Shirt",type:"medium",baseAC:13,maxDexBonus:2},{name:"Scale Mail",type:"medium",baseAC:14,maxDexBonus:2},{name:"Breastplate",type:"medium",baseAC:14,maxDexBonus:2},{name:"Half Plate",type:"medium",baseAC:15,maxDexBonus:2},{name:"Ring Mail",type:"heavy",baseAC:14,maxDexBonus:0},{name:"Chain Mail",type:"heavy",baseAC:16,maxDexBonus:0},{name:"Splint",type:"heavy",baseAC:17,maxDexBonus:0},{name:"Plate",type:"heavy",baseAC:18,maxDexBonus:0}];function vs(a){return cs.find(r=>r.name===a)}function rl(a,r,t){if(!a)return 10+r+(t?2:0);const c=vs(a);if(!c)return 10+r+(t?2:0);let d=c.baseAC;return c.maxDexBonus===void 0?d+=r:c.maxDexBonus>0&&(d+=Math.min(r,c.maxDexBonus)),t&&(d+=2),d}function ba(a){return Math.floor((a-10)/2)}function Ia(a,r){if(!a.class)return null;const t=Ht(a.class);if(!t||!t.spellcaster||!t.spellcastingAbility)return null;const c=ba(r[t.spellcastingAbility]);return 8+a.proficiencyBonus+c}function Qa(a,r){if(!a.class)return 0;const t=Ht(a.class);return!t||!t.spellcaster||!t.spellcastingAbility?0:ba(r[t.spellcastingAbility])}function ol(a,r){const t=[],c=ba(r.dexterity),d=a.armorName?vs(a.armorName):void 0;if(d){if(d.type==="none")t.push("Unarmored"),t.push("Base: 10"),t.push(`Dexterity: ${c>=0?"+":""}${c}`);else if(d.type==="light")t.push(`${d.name}: ${d.baseAC}`),t.push(`Dexterity: ${c>=0?"+":""}${c}`);else if(d.type==="medium"){const p=Math.min(2,c);t.push(`${d.name}: ${d.baseAC}`),t.push(`Dexterity: ${p>=0?"+":""}${p} (max +2)`)}else d.type==="heavy"&&(t.push(`${d.name}: ${d.baseAC}`),t.push("Dexterity: +0 (heavy armor)"));a.shieldEquipped&&t.push("Shield: +2")}else{t.push("Base: 10"),c!==0&&t.push(`Dexterity: ${c>=0?"+":""}${c}`);const p=10+c,g=a.armorClass-p;g!==0&&t.push(`Other: ${g>=0?"+":""}${g}`)}return a.activeStates&&a.activeStates.length>0&&a.activeStates.forEach(p=>{typeof p.acBonus=="number"&&p.acBonus!==0&&(!p.target||p.target==="self")&&t.push(`${p.name}: ${p.acBonus>=0?"+":""}${p.acBonus}`)}),t.join(`
`)}function cl(a,r){const t=[],c=ba(r.dexterity);t.push(`Dexterity: ${c>=0?"+":""}${c}`);const d=a.initiative-c;return d!==0&&t.push(`Other Bonuses: ${d>=0?"+":""}${d}`),t.join(`
`)}function vl(a,r){if(!a.class)return"";const t=Ht(a.class);if(!t||!t.spellcaster||!t.spellcastingAbility)return"";const c=[],d=ba(r[t.spellcastingAbility]),p=t.spellcastingAbility.charAt(0).toUpperCase()+t.spellcastingAbility.slice(1);return c.push("Base: 8"),c.push(`Proficiency: +${a.proficiencyBonus}`),c.push(`${p}: ${d>=0?"+":""}${d}`),c.join(`
`)}var dl=h('<button class="info-icon svelte-1o8ci7b" type="button">‚ÑπÔ∏è</button>'),ul=h('<button class="info-icon svelte-1o8ci7b" type="button">‚ÑπÔ∏è</button>'),pl=h("<div><!></div>"),fl=h('<div class="tooltip-wrapper svelte-1o8ci7b"><!> <!></div>');function Ma(a,r){Et(r,!1);let t=xt(r,"tooltipContent",8),c=xt(r,"ariaLabel",8,"Show information"),d=D(!1),p=D(),g=D(!1),$=D(null),x=D(!1),y=D(!1),z=D("");const U=Math.random().toString(36).slice(2);function re(){window.dispatchEvent(new CustomEvent("tooltip-open",{detail:U}))}function X(C){C.detail!==U&&(o(d,!1),o(x,!1))}function ee(){o(g,window.matchMedia("(pointer: coarse)").matches||"ontouchstart"in window)}function _e(){if(!e($)||!e(p))return;const C=e(p).getBoundingClientRect(),R=e($).getBoundingClientRect();let S=C.bottom+5,q=C.left;o(x,!1),q+R.width>window.innerWidth-8&&(q=C.right-R.width,o(x,!0),q<8&&(q=8)),q<8&&(q=8),S+R.height>window.innerHeight-8&&(S=C.top-R.height-5),o(z,`position:fixed;top:${S}px;left:${q}px;z-index:1000;`),o(y,!0)}function he(){re(),o(d,!1),o(y,!1),requestAnimationFrame(()=>{o(d,!0),o(y,!1),setTimeout(_e,0)})}function G(){o(d,!1),o(x,!1)}function je(C){C.stopPropagation(),e(d)?(o(d,!1),o(x,!1),o(y,!1)):(re(),o(d,!1),o(y,!1),requestAnimationFrame(()=>{o(d,!0),o(y,!1),setTimeout(_e,0)}))}function ze(C){e(p)&&!e(p).contains(C.target)&&(o(d,!1),o(x,!1))}va(()=>{ee(),document.addEventListener("click",ze),window.addEventListener("tooltip-open",X)}),fs(()=>{document.removeEventListener("click",ze),window.removeEventListener("tooltip-open",X)}),Rt();var oe=fl(),Be=i(oe);{var Oe=C=>{var R=dl();T(()=>Ve(R,"aria-label",c())),M("click",R,je),v(C,R)},le=C=>{var R=ul();T(()=>Ve(R,"aria-label",c())),M("mouseenter",R,he),M("mouseleave",R,G),v(C,R)};k(Be,C=>{e(g)?C(Oe):C(le,!1)})}var ye=s(Be,2);{var Ee=C=>{var R=pl(),S=i(R);Us(S,r,"content",{},q=>{var b=rt(),j=Ue(b);Ns(j,t),v(q,b)}),l(R),ma(R,q=>o($,q),()=>e($)),T(()=>{yt(R,1,`tooltip-popup ${e(x)?"right-align":""}`,"svelte-1o8ci7b"),Os(R,e(y)?e(z)+"opacity:1;pointer-events:auto;":"opacity:0;pointer-events:none;position:fixed;top:0;left:0;z-index:1000;")}),v(C,R)};k(ye,C=>{e(d)&&C(Ee)})}l(oe),ma(oe,C=>o(p,C),()=>e(p)),v(a,oe),Pt()}var hl=h("<option> </option>"),ml=h('<div class="armor-config svelte-1r5hyyb"><h4 class="svelte-1r5hyyb">Armor Configuration</h4> <div class="armor-controls svelte-1r5hyyb"><div class="armor-field svelte-1r5hyyb"><label for="armorName" class="svelte-1r5hyyb">Armor</label> <select id="armorName" class="armor-select svelte-1r5hyyb"><option>None (Unarmored)</option><!></select></div> <div class="armor-field svelte-1r5hyyb"><label class="shield-label svelte-1r5hyyb"><input type="checkbox" class="shield-checkbox svelte-1r5hyyb"/> Shield Equipped (+2 AC)</label></div></div></div>'),gl=h('<div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="spellSaveDC" class="svelte-1r5hyyb">Spell Save DC</label> <!></div> <input type="number" id="spellSaveDC" class="stat-input svelte-1r5hyyb" readonly=""/></div>'),bl=h('<span class="hit-dice-type"> </span>'),_l=h('<!> <div class="stats-grid svelte-1r5hyyb"><div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="armorClass" class="svelte-1r5hyyb">Armor Class</label> <!></div> <input type="text" id="armorClass" readonly=""/></div> <div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="initiative" class="svelte-1r5hyyb">Initiative</label> <!></div> <input type="text" id="initiative" class="stat-input svelte-1r5hyyb" readonly=""/></div> <div class="stat-box svelte-1r5hyyb"><label for="speed" class="svelte-1r5hyyb">Speed</label> <input type="text" id="speed" class="stat-input svelte-1r5hyyb"/></div> <!></div> <div class="hp-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Points</h3> <div><div class="hp-inputs svelte-1r5hyyb"><input type="number" class="hp-current svelte-1r5hyyb" min="0"/> <span class="hp-separator svelte-1r5hyyb">/</span> <input type="number" class="hp-max svelte-1r5hyyb" min="0"/></div> <div class="hp-controls svelte-1r5hyyb"><button class="hp-btn svelte-1r5hyyb">‚àí</button> <button class="hp-btn svelte-1r5hyyb">+</button> <button class="hp-btn svelte-1r5hyyb">‚àí5</button> <button class="hp-btn svelte-1r5hyyb">+5</button></div></div> <div class="temp-hp svelte-1r5hyyb"><label for="tempHP" class="svelte-1r5hyyb">Temp HP</label> <input type="number" id="tempHP" min="0" class="svelte-1r5hyyb"/></div></div> <div class="hit-dice-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Dice</h3> <div class="hit-dice-display svelte-1r5hyyb"><input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <span>/</span> <input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <!></div> <div class="hit-dice-controls svelte-1r5hyyb"><label for="hitDiceCount" class="svelte-1r5hyyb">Roll</label> <div class="hit-dice-count-controls svelte-1r5hyyb"><button class="hit-dice-btn svelte-1r5hyyb">‚àí</button> <input type="number" id="hitDiceCount" class="hit-dice-count-input svelte-1r5hyyb" min="1"/> <button class="hit-dice-btn svelte-1r5hyyb">+</button></div> <button class="btn btn-primary roll-hit-dice use-enabled svelte-1r5hyyb">üé≤ Roll</button></div></div>',1),yl=h("<section><!> <!></section>");function xl(a,r){Et(r,!1);const t=()=>tt(se,"$character",$),c=()=>tt(ga,"$abilityModifiers",$),d=()=>tt(ta,"$searchFilter",$),p=()=>tt(Tt,"$collapsedStates",$),g=()=>tt(ea,"$isEditMode",$),[$,x]=Wt(),y=D(),z=D(),U=D(),re=D(),X=D(),ee=D(),_e=D(),he=na();let G=D(1);function je(C){se.update(R=>(R.currentHP=Math.max(0,Math.min(R.maxHP,R.currentHP+C)),R))}function ze(C){const R=e(G)+C,S=t().hitDice.current;o(G,Math.max(1,Math.min(S,R)))}function oe(C=1){if(t().hitDice.current<=0){alert("No hit dice remaining!");return}if(!t().class){alert("Please select a class first!");return}const R=Ht(t().class);if(!R){alert("Invalid class configuration!");return}const S=Math.min(C,t().hitDice.current),q=R.hitDice,b=c().constitution,j=b*S,ae=j>=0?`+${j}`:`${j}`,Ge=`${S}${q}${ae}`,qe=[];if(qe.push({value:`${S}${q}`,source:"hit dice"}),b!==0)for(let $e=0;$e<S;$e++)qe.push({value:b,source:"constitution"});he("rollHitDice",{notation:Ge,hitDie:q,count:S,bonusBreakdown:qe})}Qe(()=>(t(),c(),se),()=>{if(t().armorName!==void 0||t().shieldEquipped!==void 0){const C=c().dexterity,R=rl(t().armorName,C,t().shieldEquipped||!1);t().armorClass!==R&&se.update(S=>({...S,armorClass:R}))}}),Qe(()=>(c(),t(),se),()=>{const C=c().dexterity;t().initiative!==C&&se.update(R=>({...R,initiative:C}))}),Qe(()=>t(),()=>{o(y,Ia(t(),t().abilities))}),Qe(()=>t(),()=>{o(z,ol(t(),t().abilities))}),Qe(()=>t(),()=>{o(U,cl(t(),t().abilities))}),Qe(()=>t(),()=>{o(re,vl(t(),t().abilities))}),Qe(()=>(t(),e(G)),()=>{const C=t().hitDice.current;C>0&&e(G)>C&&o(G,C)}),Qe(()=>t(),()=>{o(X,t().activeStates&&t().activeStates.length>0?t().activeStates.reduce((C,R)=>C+(R.acBonus||0),0):0)}),Qe(()=>t(),()=>{o(ee,t().activeStates&&t().activeStates.length>0?t().activeStates.some(C=>C.name==="Aid"&&C.target==="self"):!1)}),Qe(()=>d(),()=>{o(_e,!d()||"armor class".includes(d().toLowerCase())||"initiative".includes(d().toLowerCase())||"speed".includes(d().toLowerCase())||"hit points".includes(d().toLowerCase())||"hp".includes(d().toLowerCase())||"hit dice".includes(d().toLowerCase())||"spell save".includes(d().toLowerCase())||"combat".includes(d().toLowerCase()))}),Yt(),Rt();var Be=yl();let Oe;var le=i(Be);{let C=dt(()=>(p(),n(()=>p().combatStats?"Expand":"Collapse")));ra(le,{title:"Combat Stats",get collapsed(){return p(),n(()=>p().combatStats)},get ariaLabel(){return e(C)},onToggle:()=>Tt.update(R=>({...R,combatStats:!R.combatStats}))})}var ye=s(le,2);{var Ee=C=>{var R=_l(),S=Ue(R);{var q=K=>{var Ce=ml(),ve=s(i(Ce),2),_=i(ve),H=s(i(_),2);T(()=>{t(),Ct(()=>{})});var te=i(H);te.value=(te.__value=void 0)??"";var Q=s(te);St(Q,1,()=>cs,kt,(W,fe)=>{var Le=rt(),nt=Ue(Le);{var J=vt=>{var ft=hl(),bt=i(ft);l(ft);var f={};T(()=>{A(bt,`${e(fe),n(()=>e(fe).name)??""} (AC ${e(fe),n(()=>e(fe).baseAC)??""})`),f!==(f=(e(fe),n(()=>e(fe).name)))&&(ft.value=(ft.__value=(e(fe),n(()=>e(fe).name)))??"")}),v(vt,ft)};k(nt,vt=>{e(fe),n(()=>e(fe).name!=="Unarmored")&&vt(J)})}v(W,Le)}),l(H),l(_);var ie=s(_,2),L=i(ie),P=i(L);De(P),ia(),l(L),l(ie),l(ve),l(Ce),Ca(H,()=>t().armorName,W=>_t(se,n(t).armorName=W,n(t))),wa(P,()=>t().shieldEquipped,W=>_t(se,n(t).shieldEquipped=W,n(t))),v(K,Ce)};k(S,K=>{g()&&K(q)})}var b=s(S,2),j=i(b),ae=i(j),Ge=s(i(ae),2);Ma(Ge,{get tooltipContent(){return e(z)},ariaLabel:"Show AC breakdown"}),l(ae);var qe=s(ae,2);De(qe),l(j);var $e=s(j,2),m=i($e),I=s(i(m),2);Ma(I,{get tooltipContent(){return e(U)},ariaLabel:"Show Initiative breakdown"}),l(m);var Z=s(m,2);De(Z),l($e);var ne=s($e,2),V=s(i(ne),2);De(V),l(ne);var Se=s(ne,2);{var Me=K=>{var Ce=gl(),ve=i(Ce),_=s(i(ve),2);Ma(_,{get tooltipContent(){return e(re)},ariaLabel:"Show Spell Save DC breakdown"}),l(ve);var H=s(ve,2);De(H),l(Ce),T(()=>ha(H,e(y))),v(K,Ce)};k(Se,K=>{e(y)!==null&&K(Me)})}l(b);var st=s(b,2),xe=s(i(st),2);let Ke;var F=i(xe),w=i(F);De(w);var ue=s(w,4);De(ue),l(F);var pe=s(F,2),Y=i(pe),u=s(Y,2),We=s(u,2),me=s(We,2);l(pe),l(xe);var ge=s(xe,2),E=s(i(ge),2);De(E),l(ge),l(st);var Fe=s(st,2),Te=s(i(Fe),2),Xe=i(Te);De(Xe);var lt=s(Xe,4);De(lt);var Re=s(lt,2);{var ke=K=>{const Ce=dt(()=>(N(Ht),t(),n(()=>Ht(t().class))));var ve=rt(),_=Ue(ve);{var H=te=>{const Q=dt(()=>(c(),n(()=>c().constitution)));var ie=bl(),L=i(ie);l(ie),T(()=>A(L,`(${N(e(Ce)),n(()=>e(Ce).hitDice)??""}${(e(Q)>=0?`+${e(Q)}`:e(Q))??""})`)),v(te,ie)};k(_,te=>{e(Ce)&&te(H)})}v(K,ve)};k(Re,K=>{t(),n(()=>t().class)&&K(ke)})}l(Te);var Ae=s(Te,2),Pe=s(i(Ae),2),Ie=i(Pe),He=s(Ie,2);De(He);var ce=s(He,2);l(Pe);var be=s(Pe,2);l(Ae),l(Fe),T(()=>{ha(qe,(e(X),t(),n(()=>e(X)!==0?`${t().armorClass} ‚Üí ${t().armorClass+e(X)}`:`${t().armorClass}`))),yt(qe,1,Fs(e(X)!==0?"stat-input ac-enhanced":"stat-input"),"svelte-1r5hyyb"),ha(Z,(t(),n(()=>t().initiative))),Ke=yt(xe,1,"hp-display svelte-1r5hyyb",null,Ke,{"aid-active":e(ee)}),Ve(w,"max",(t(),n(()=>t().maxHP))),Ve(Xe,"max",(t(),n(()=>t().hitDice.max))),Ie.disabled=e(G)<=1,Ve(He,"max",(t(),n(()=>t().hitDice.current))),ce.disabled=(e(G),t(),n(()=>e(G)>=t().hitDice.current)),be.disabled=(t(),n(()=>t().hitDice.current<=0||!t().class))}),Je(V,()=>t().speed,K=>_t(se,n(t).speed=K,n(t))),Je(w,()=>t().currentHP,K=>_t(se,n(t).currentHP=K,n(t))),Je(ue,()=>t().maxHP,K=>_t(se,n(t).maxHP=K,n(t))),M("click",Y,()=>je(-1)),M("click",u,()=>je(1)),M("click",We,()=>je(-5)),M("click",me,()=>je(5)),Je(E,()=>t().tempHP,K=>_t(se,n(t).tempHP=K,n(t))),Je(Xe,()=>t().hitDice.current,K=>_t(se,n(t).hitDice.current=K,n(t))),Je(lt,()=>t().hitDice.max,K=>_t(se,n(t).hitDice.max=K,n(t))),M("click",Ie,()=>ze(-1)),Je(He,()=>e(G),K=>o(G,K)),M("input",He,K=>{const Ce=K.target,ve=parseInt(Ce.value);ve>t().hitDice.current&&o(G,t().hitDice.current),ve<1&&o(G,1)}),M("click",ce,()=>ze(1)),M("click",be,()=>oe(e(G))),v(C,R)};k(ye,C=>{p(),n(()=>!p().combatStats)&&C(Ee)})}l(Be),T(()=>Oe=yt(Be,1,"combat-stats svelte-1r5hyyb",null,Oe,{hidden:!e(_e)})),v(a,Be),Pt(),x()}const ya={acrobatics:"dexterity",animalHandling:"wisdom",arcana:"intelligence",athletics:"strength",deception:"charisma",history:"intelligence",insight:"wisdom",intimidation:"charisma",investigation:"intelligence",medicine:"wisdom",nature:"intelligence",perception:"wisdom",performance:"charisma",persuasion:"charisma",religion:"intelligence",sleightOfHand:"dexterity",stealth:"dexterity",survival:"wisdom"};var Sl=h('<div class="skill-row svelte-1f1pl16"><input type="checkbox" class="svelte-1f1pl16"/> <label class="svelte-1f1pl16"> <span class="ability-tag svelte-1f1pl16"> </span></label> <span class="skill-modifier svelte-1f1pl16"> </span> <button class="roll-btn svelte-1f1pl16">Roll</button></div>'),kl=h('<div class="skills-grid svelte-1f1pl16"></div>'),$l=h("<section><!> <!></section>");function Cl(a,r){Et(r,!1);const t=()=>tt(se,"$character",$),c=()=>tt(ga,"$abilityModifiers",$),d=()=>tt(ta,"$searchFilter",$),p=()=>tt(Tt,"$collapsedStates",$),g=()=>tt(ea,"$isEditMode",$),[$,x]=Wt(),y=D(),z=D(),U=D(),re=D(),X=D(),ee=D(),_e=na(),he=[{key:"acrobatics",label:"Acrobatics"},{key:"animalHandling",label:"Animal Handling"},{key:"arcana",label:"Arcana"},{key:"athletics",label:"Athletics"},{key:"deception",label:"Deception"},{key:"history",label:"History"},{key:"insight",label:"Insight"},{key:"intimidation",label:"Intimidation"},{key:"investigation",label:"Investigation"},{key:"medicine",label:"Medicine"},{key:"nature",label:"Nature"},{key:"perception",label:"Perception"},{key:"performance",label:"Performance"},{key:"persuasion",label:"Persuasion"},{key:"religion",label:"Religion"},{key:"sleightOfHand",label:"Sleight of Hand"},{key:"stealth",label:"Stealth"},{key:"survival",label:"Survival"}];function G(le){const ye=ya[le],Ee=c()[ye],C=t().skillProficiencies[le]?t().proficiencyBonus:0,R=e(y)[le],S=`1d20${R>=0?"+":""}${R}`,q=[];q.push({value:"1d20",source:"base die"}),Ee!==0&&q.push({value:Ee,source:ye}),C!==0&&q.push({value:C,source:"proficiency"}),_e("roll",{notation:S,rollType:"check",bonusBreakdown:q})}Qe(()=>{},()=>{o(y,{})}),Qe(()=>t(),()=>{o(z,t().skillProficiencies)}),Qe(()=>t(),()=>{o(U,t().proficiencyBonus)}),Qe(()=>c(),()=>{o(re,c())}),Qe(()=>(e(re),e(z),e(U)),()=>{for(const{key:le}of he){const ye=ya[le],Ee=e(re)[ye],C=e(z)[le]?e(U):0;la(y,e(y)[le]=Ee+C)}}),Qe(()=>d(),()=>{o(X,he.filter(({label:le})=>d()?le.toLowerCase().includes(d().toLowerCase()):!0))}),Qe(()=>e(X),()=>{o(ee,e(X).length>0)}),Yt(),Rt();var je=$l();let ze;var oe=i(je);{let le=dt(()=>(p(),n(()=>p().skills?"Expand":"Collapse")));ra(oe,{title:"Skills",get collapsed(){return p(),n(()=>p().skills)},get ariaLabel(){return e(le)},onToggle:()=>Tt.update(ye=>({...ye,skills:!ye.skills}))})}var Be=s(oe,2);{var Oe=le=>{var ye=kl();St(ye,5,()=>e(X),kt,(Ee,C)=>{let R=()=>e(C).key,S=()=>e(C).label;var q=Sl(),b=i(q);De(b);var j=s(b,2),ae=i(j),Ge=s(ae),qe=i(Ge);l(Ge),l(j);var $e=s(j,2),m=i($e);l($e);var I=s($e,2);l(q),T(Z=>{rs(b,(e(z),R(),n(()=>e(z)[R()]))),b.disabled=!g(),Ve(b,"id",R()),Ve(j,"for",R()),A(ae,`${S()??""} `),A(qe,`(${Z??""})`),A(m,`${e(y),R(),n(()=>e(y)[R()]>=0?"+":"")??""}${e(y),R(),n(()=>e(y)[R()])??""}`)},[()=>(N(ya),R(),n(()=>ya[R()].substring(0,3).toUpperCase()))]),M("change",b,Z=>{console.log("Skill proficiency changed:",R(),Z.target.checked),se.update(ne=>({...ne,skillProficiencies:{...ne.skillProficiencies,[R()]:Z.target.checked}}))}),M("click",I,()=>G(R())),v(Ee,q)}),l(ye),v(le,ye)};k(Be,le=>{p(),n(()=>!p().skills)&&le(Oe)})}l(je),T(()=>ze=yt(je,1,"skills svelte-1f1pl16",null,ze,{hidden:!e(ee)})),v(a,je),Pt(),x()}let xa=null,Sa=null;async function ds(){if(xa)return xa;try{return xa=await(await fetch(os("/data/spells.json"))).json(),xa||[]}catch(a){return console.error("Failed to load spells:",a),[]}}async function wl(){if(Sa)return Sa;try{return Sa=await(await fetch(os("/data/feats.json"))).json(),Sa||[]}catch(a){return console.error("Failed to load feats:",a),[]}}function Xa(a,r){if(!r.trim())return a;const t=r.toLowerCase();return a.filter(c=>c.name.toLowerCase().includes(t)||c.school.toLowerCase().includes(t)||c.classes.some(d=>d.toLowerCase().includes(t))||c.description.toLowerCase().includes(t))}function Dl(a,r){return r===null?a:a.filter(t=>t.level===r)}function Ll(a,r){if(!r.trim())return a;const t=r.toLowerCase();return a.filter(c=>c.name.toLowerCase().includes(t)||c.description.toLowerCase().includes(t))}function ka(a){const r=a.description,t=/\b(Strength|Dexterity|Constitution|Intelligence|Wisdom|Charisma)\s+saving\s+throw/i,c=r.match(t);if(!c)return null;const d=c[1].toLowerCase(),g=/half\s+(?:as\s+much\s+)?damage\s+on\s+a\s+successful(?:\s+save)?/i.test(r),x=/saving\s+throw\s+or\s+take.*?damage/i.test(r)&&!g;return{ability:d,halfDamageOnSave:g,noDamageOnSave:x}}function jl(a){const r=a.description;return/(plus|add)\s+your\s+spellcasting\s+(ability\s+)?modifier/i.test(r)}function Fa(a){const r=a.description.toLowerCase();return r.includes("ranged spell attack")||r.includes("melee spell attack")}function Za(a){const r=a.description.toLowerCase();if(["Divine Favor","Bless","Aid","Command"].includes(a.name))return!0;const d=["takes","take","deals","deal","damage equal to","force damage","fire damage","cold damage","lightning damage","thunder damage","acid damage","poison damage","necrotic damage","radiant damage","psychic damage","regain","regains","hit point"].some($=>r.includes($));return["bonus to attack","bonus to damage","bonus to ac","gains a +","gain a +","+1 bonus","+2 bonus","+3 bonus","advantage on","becomes a magic weapon"].some($=>r.includes($))&&!d}function Al(a){const r=a.description;let t=0,c=0,d=0,p="";const g=r.match(/\+(\d+)\s+bonus\s+to\s+attack\s+rolls\s+and\s+damage\s+rolls/i);if(g){const x=parseInt(g[1]);t=x,c=x,p=`+${x} to attack and damage rolls`}if(a.name==="Bless"&&(p="Add 1d4 to attack rolls and saves",t="1d4"),a.name==="Aid")return p="+5 HP (max and current) for 8 hours",{attackBonus:0,damageBonus:0,acBonus:0,hpBonus:5,description:p,name:a.name};a.name==="Divine Favor"&&(p="Your weapon attacks deal an extra 1d4 radiant damage on a hit.",c="1d4");const $=r.match(/\+(\d+)\s+bonus\s+to\s+AC/i);return $&&(d=parseInt($[1]),p=`+${d} to AC`),a.name==="Haste"&&(p="+2 AC, doubled speed, extra action",d=2),p||t!==0||c!==0||d!==0?{attackBonus:t,damageBonus:c,acBonus:d,description:p||a.description.substring(0,100),name:a.name}:null}var Bl=h('<button class="btn btn-secondary">Add Attack</button>'),Ml=h('<input type="text" placeholder="Attack name" class="attack-name svelte-14o91c5"/>'),Fl=h('<h4 class="attack-name-display svelte-14o91c5"> </h4>'),Tl=h('<button class="btn-remove svelte-14o91c5">√ó</button>'),Rl=h('<div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Bonus</label> <input type="number" class="attack-bonus svelte-14o91c5"/></div>'),El=h('<div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Damage</label> <input type="text" placeholder="e.g., 2d6+3" class="attack-damage svelte-14o91c5"/></div>'),Pl=h('<div class="spell-info-loading svelte-14o91c5">Loading spell info...</div>'),Il=h('<li class="svelte-14o91c5"><strong>At Higher Levels:</strong> </li>'),Hl=h('<ul class="svelte-14o91c5"><li class="svelte-14o91c5"><strong>Level:</strong> </li> <li class="svelte-14o91c5"><strong>Casting Time:</strong> </li> <li class="svelte-14o91c5"><strong>Range:</strong> </li> <li class="svelte-14o91c5"><strong>Components:</strong> <!></li> <li class="svelte-14o91c5"><strong>Duration:</strong> <!> </li> <li class="svelte-14o91c5"><strong>Description:</strong> </li> <!></ul>'),Nl=h('<span class="scaled-damage svelte-14o91c5" style="margin-left: 8px;"> </span>'),Ul=h('<span class="scaled-damage svelte-14o91c5">(Half damage)</span>'),Ol=h('<span class="scaled-damage svelte-14o91c5">(No damage)</span>'),Gl=h('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> <!> <!></label></div>'),ql=h("<option> </option>"),Wl=h('<span class="scaled-damage svelte-14o91c5"><!> </span>'),zl=h('<span class="scaled-damage svelte-14o91c5"> </span>'),Kl=h('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> Target is Fiend or Undead <!></label></div>'),Vl=h('<div class="spell-level-selector svelte-14o91c5"><label class="svelte-14o91c5">Cast at Level:</label> <select class="spell-level-select use-enabled svelte-14o91c5"></select> <!></div> <!>',1),Jl=h('<div class="spell-level-selector svelte-14o91c5"><span style="color: #dc3545; font-weight: bold;">No spell slots available!</span></div>'),Yl=h('<div class="spell-info svelte-14o91c5"><div class="spell-info-header svelte-14o91c5" role="button" tabindex="0"><h4 class="svelte-14o91c5">Spell Info</h4> <button class="collapse-btn-small svelte-14o91c5"> </button></div> <!></div> <!> <!>',1),Ql=h('<div class="spell-info-missing svelte-14o91c5">Spell info not found.</div>'),Xl=h('<div class="attack-notes svelte-14o91c5"><label class="svelte-14o91c5">Notes</label> <textarea placeholder="e.g., DC 15 Dex save, Range 120 ft, Concentration" class="notes-input svelte-14o91c5" rows="2"></textarea></div>'),Zl=h('<button class="btn btn-primary">Roll Attack</button>'),ei=h('<div class="buff-target-selection svelte-14o91c5"><div class="target-options svelte-14o91c5"><label class="target-option svelte-14o91c5"><input type="radio" class="svelte-14o91c5"/> Self</label> <label class="target-option svelte-14o91c5"><input type="radio" class="svelte-14o91c5"/> Other</label></div> <button class="btn btn-info"> </button></div>'),ti=h('<button class="btn btn-info">Cast Spell</button>'),ai=h("<button><!></button>"),si=h('<button class="btn btn-info">Cast Spell</button>'),li=h('<button class="btn btn-secondary">Roll Damage</button>'),ii=h('<button class="btn btn-primary">Roll Attack</button> <!>',1),ni=h('<div class="attack-card svelte-14o91c5"><div class="attack-header svelte-14o91c5"><!> <!></div> <div class="attack-details svelte-14o91c5"><!> <!> <div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Type</label> <input type="text" placeholder="e.g., slashing" class="attack-type svelte-14o91c5"/></div></div> <!> <!> <div class="attack-actions svelte-14o91c5"><!></div></div>'),ri=h('<p class="no-attacks svelte-14o91c5">No attacks added yet. Click "Add Attack" to create one.</p>'),oi=h('<p class="no-attacks svelte-14o91c5">No attacks match your search.</p>'),ci=h('<button class="btn-remove svelte-14o91c5">√ó</button>'),vi=h('<div class="state-card svelte-14o91c5"><div class="state-header svelte-14o91c5"><input type="text" placeholder="Effect name (e.g., Magic Weapon)" class="state-name svelte-14o91c5"/> <!></div> <div class="state-details svelte-14o91c5"><div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Attack Bonus</label> <input type="number" class="state-bonus svelte-14o91c5"/></div> <div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Damage Bonus</label> <input type="text" class="state-bonus svelte-14o91c5"/></div> <div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Target</label> <select class="state-bonus svelte-14o91c5"><option>Self</option><option>Other</option></select></div></div> <div class="state-description svelte-14o91c5"><label class="svelte-14o91c5">Description</label> <input type="text" placeholder="e.g., +1 to attack and damage rolls (Magic Weapon)" class="state-desc-input svelte-14o91c5"/></div></div>'),di=h('<div class="states-list svelte-14o91c5"></div>'),ui=h('<p class="no-states svelte-14o91c5">No active effects. Add spell effects that modify your attacks.</p>'),pi=h('<!> <div class="attacks-list svelte-14o91c5"><!> <!></div> <div class="active-states-section svelte-14o91c5"><h3 class="svelte-14o91c5">Active Spell Effects</h3> <p class="section-description svelte-14o91c5">Effects that modify attack and damage rolls (e.g., Magic Weapon, Bless)</p> <button class="btn btn-secondary">Add Effect</button> <!></div>',1),fi=h("<section><!> <!></section>");function hi(a,r){Et(r,!1);const t=()=>tt(se,"$character",$),c=()=>tt(ga,"$abilityModifiers",$),d=()=>tt(ta,"$searchFilter",$),p=()=>tt(Tt,"$collapsedStates",$),g=()=>tt(ea,"$isEditMode",$),[$,x]=Wt(),y=D(),z=D(),U=[],re=na();let X=D({}),ee=D({});function _e(m){la(X,e(X)[m]=!e(X)[m]),o(X,{...e(X)})}function he(m){return m.description.toLowerCase().includes("regain")&&(m.description.toLowerCase().includes("hit point")||m.description.toLowerCase().includes("hp"))}function G(m){return["Shield of Faith","Bless","Aid","Magic Weapon"].includes(m)}function je(){se.update(m=>(m.attacks=[...m.attacks,{id:crypto.randomUUID(),name:"",bonus:0,damage:"",damageType:"",notes:""}],m))}function ze(m){se.update(I=>(I.attacks=I.attacks.filter(Z=>Z.id!==m),I))}function oe(m){let I=m.damage,Z=!1,ne=!1;if(m.spellRef){const xe=ye(m.spellRef);if(xe&&(ne=Fa(xe),xe.level>0)){const Ke=m.castAtLevel||xe.level;if(!Ee(Ke)){qt.add(`No level ${Ke} spell slots available!`,"error");return}const w=ka(xe);w&&m.targetSucceededSave&&w.noDamageOnSave?I="0":(Z=w?.halfDamageOnSave&&m.targetSucceededSave||!1,I=C(m,xe))}}else if(t().activeStates&&t().activeStates.length>0){let xe=0,Ke=[];for(const F of t().activeStates)F.target!=="other"&&(typeof F.damageBonus=="string"?Ke.push(F.damageBonus):typeof F.damageBonus=="number"&&(xe+=F.damageBonus));if((xe!==0||Ke.length>0)&&I){const F=I.match(/(\d+d\d+)([+-]\d+)?/);if(F){const[,w,ue]=F,Y=(ue?parseInt(ue):0)+xe;let u=`${w}`;Y!==0&&(u+=`${Y>=0?"+":""}${Y}`),Ke.length>0&&(u+=" + "+Ke.join(" + ")),I=u}}}const V=[];let Se=0;if(ne){const xe=Qa(t(),c()),Ke=t().proficiencyBonus||0;V.push({value:Ke,source:"proficiency"}),V.push({value:xe,source:"spellcasting"}),Se=Ke+xe}else m.bonus!==0&&V.push({value:m.bonus,source:"base"}),Se=m.bonus;let Me=[];if(t().activeStates)for(const xe of t().activeStates)xe.target!=="other"&&(typeof xe.attackBonus=="number"&&xe.attackBonus!==0?(V.push({value:xe.attackBonus,source:xe.name.toLowerCase()}),Se+=xe.attackBonus):typeof xe.attackBonus=="string"&&xe.attackBonus&&(Me.push(xe.attackBonus),V.push({value:xe.attackBonus,source:xe.name.toLowerCase()})));let st=`1d20${Se>=0?"+":""}${Se}`;Me.length>0&&(st+="+"+Me.join("+")),re("roll",{notation:st,damageNotation:I,attackName:m.name,applyHalfDamage:Z,bonusBreakdown:V,rollType:"attack"})}function Be(m){if(!m.damage){qt.add(`${m.name}: No damage specified`,"error");return}let I=m.damage,Z=!1;const ne=[];if(m.spellRef){const V=ye(m.spellRef);if(V&&V.level>0){const Se=m.castAtLevel||V.level;if(!Ee(Se)){qt.add(`No level ${Se} spell slots available!`,"error");return}const st=ka(V);st&&m.targetSucceededSave&&st.noDamageOnSave?I="0":(Z=st?.halfDamageOnSave&&m.targetSucceededSave||!1,I=C(m,V))}}else{const V=I.match(/(\d+d\d+)([+-]\d+)?/);if(V){const[,Se,Me]=V,st=Me?parseInt(Me):0;if(st!==0&&ne.push({value:st,source:"base"}),t().activeStates&&t().activeStates.length>0){let xe=0,Ke=[];for(const F of t().activeStates)F.target!=="other"&&(typeof F.damageBonus=="string"?Ke.push(F.damageBonus):typeof F.damageBonus=="number"&&F.damageBonus!==0&&(ne.push({value:F.damageBonus,source:F.name.toLowerCase()}),xe+=F.damageBonus));if(xe!==0||Ke.length>0){const F=st+xe;let w=`${Se}`;F!==0&&(w+=`${F>=0?"+":""}${F}`),Ke.length>0&&(w+=" + "+Ke.join(" + ")),I=w}}}}re("roll",{notation:I,attackName:m.name,applyHalfDamage:Z,bonusBreakdown:ne})}let Oe=D([]),le=D(!1);va(async()=>{o(Oe,await ds()),o(le,!0)});function ye(m){return e(Oe).find(I=>I.name===m)}function Ee(m){t().classFeatures.spellSlotsByLevel||_t(se,n(t).classFeatures.spellSlotsByLevel={},n(t)),t().classFeatures.spellSlotsByLevel[m]||_t(se,n(t).classFeatures.spellSlotsByLevel[m]=Array(2).fill(!1),n(t));const Z=t().classFeatures.spellSlotsByLevel[m].findIndex(ne=>!ne);return Z===-1?!1:(se.update(ne=>(ne.classFeatures.spellSlotsByLevel||(ne.classFeatures.spellSlotsByLevel={}),ne.classFeatures.spellSlotsByLevel[m]||(ne.classFeatures.spellSlotsByLevel[m]=Array(2).fill(!1)),ne.classFeatures.spellSlotsByLevel[m][Z]=!0,ne)),!0)}function C(m,I){let Z=m.damage,ne=0,V=0;if(jl(I)&&(V+=Qa(t(),c())),t().activeStates)for(const pe of t().activeStates)pe.target!=="other"&&typeof pe.damageBonus=="number"&&(V+=pe.damageBonus);if(I.higherLevelSlot&&m.castAtLevel){const pe=I.level,u=(m.castAtLevel||pe)-pe;if(u>0){const We=I.higherLevelSlot.match(/(\d+)d(\d+)\s+for\s+each.*?level\s+above/i);if(We){const[,me]=We;ne+=u*parseInt(me)}}}if(m.targetIsFiendOrUndead&&I.description.includes("Fiend or an Undead")){const pe=I.description.match(/increases by (\d+)d(\d+) if.*?Fiend or.*?Undead/i);if(pe){const[,Y]=pe;ne+=parseInt(Y)}}const Se=Z.match(/(\d+)d(\d+)([+-]\d+)?/);if(!Se)return V!==0?V>=0?`${V}`:`${V}`:Z||"0";const[,Me,st,xe]=Se,Ke=parseInt(Me)+ne,w=(xe?parseInt(xe):0)+V;let ue=`${Ke}d${st}`;return w!==0&&(ue+=w>=0?`+${w}`:`${w}`),ue}function R(m){const I=[];for(let ne=m.level;ne<=9;ne++){const V=t().classFeatures.spellSlotsByLevel?.[ne];V&&V.length>0&&I.push(ne)}return I}function S(){se.update(m=>(m.activeStates||(m.activeStates=[]),m.activeStates=[...m.activeStates,{name:"",attackBonus:0,damageBonus:0,description:"",target:"self"}],m))}function q(m){se.update(I=>{if(I.activeStates){const Z=I.activeStates[m];Z?.hpBonus&&Z.target!=="other"&&(I.maxHP-=Z.hpBonus,I.currentHP=Math.max(1,Math.min(I.currentHP-Z.hpBonus,I.maxHP))),I.activeStates=I.activeStates.filter((ne,V)=>V!==m)}return I})}function b(m,I="self"){const Z=ye(m.spellRef);if(!Z){qt.add("Spell not found","error");return}const ne=m.castAtLevel||Z.level;if(ne>0&&!Ee(ne)){qt.add(`No level ${ne} spell slots available!`,"error");return}const V=Al(Z);if(!V){qt.add(`${Z.name} cast! Check spell description for effects.`,"info");return}let Se=V.hpBonus||0,Me=V.description;Z.name==="Aid"&&ne>Z.level&&(Se=5+(ne-Z.level)*5,Me=`+${Se} HP (max and current) for 8 hours`);const xe=["Shield of Faith","Bless","Aid","Magic Weapon"].includes(Z.name);se.update(F=>{F.activeStates||(F.activeStates=[]);const w=F.activeStates.find(ue=>ue.name===Z.name);return w&&w.hpBonus&&w.target!=="other"&&(F.maxHP-=w.hpBonus,F.currentHP=Math.max(1,Math.min(F.currentHP-w.hpBonus,F.maxHP))),F.activeStates=F.activeStates.filter(ue=>ue.name!==Z.name),Se>0&&I==="self"&&(F.maxHP+=Se,F.currentHP+=Se),F.activeStates=[...F.activeStates,{name:Z.name,attackBonus:V.attackBonus,damageBonus:V.damageBonus,acBonus:V.acBonus,description:Me,target:I,hpBonus:Se}],F});const Ke=I==="self"?" on self":" on other";qt.add(`${Z.name} cast${xe?Ke:""}! Effect added to Active Spell Effects.`,"success")}Qe(()=>(t(),e(X),e(ee)),()=>{if(t()&&t().attacks)for(const m of t().attacks)m.spellRef&&e(X)[m.id]===void 0&&la(X,e(X)[m.id]=!0),m.spellRef&&e(ee)[m.id]===void 0&&la(ee,e(ee)[m.id]="self")}),Qe(()=>(t(),d()),()=>{o(y,t().attacks.filter(m=>{if(!d())return!0;const I=d().toLowerCase();return m.name.toLowerCase().includes(I)||m.damageType.toLowerCase().includes(I)}).sort((m,I)=>!m.spellRef&&I.spellRef?-1:m.spellRef&&!I.spellRef?1:0))}),Qe(()=>(d(),e(y)),()=>{o(z,!d()||e(y).length>0||"attack".includes(d().toLowerCase())||"spell".includes(d().toLowerCase()))}),Yt(),Rt();var j=fi();let ae;var Ge=i(j);{let m=dt(()=>(p(),n(()=>p().attacks?"Expand":"Collapse")));ra(Ge,{title:"Attacks & Spells",get collapsed(){return p(),n(()=>p().attacks)},get ariaLabel(){return e(m)},onToggle:()=>Tt.update(I=>({...I,attacks:!I.attacks}))})}var qe=s(Ge,2);{var $e=m=>{var I=pi(),Z=Ue(I);{var ne=Y=>{var u=Bl();M("click",u,je),v(Y,u)};k(Z,Y=>{g()&&Y(ne)})}var V=s(Z,2),Se=i(V);St(Se,1,()=>e(y),Y=>Y.id,(Y,u,We)=>{var me=ni(),ge=i(me),E=i(ge);{var Fe=L=>{var P=Ml();De(P),Je(P,()=>e(u).name,W=>(e(u).name=W,Ct(()=>(e(y),t(),d())))),v(L,P)},Te=L=>{var P=Fl(),W=i(P,!0);l(P),T(()=>A(W,(e(u),n(()=>e(u).name||"(Unnamed Attack)")))),v(L,P)};k(E,L=>{g()?L(Fe):L(Te,!1)})}var Xe=s(E,2);{var lt=L=>{var P=Tl();M("click",P,()=>ze(e(u).id)),v(L,P)};k(Xe,L=>{g()&&L(lt)})}l(ge);var Re=s(ge,2),ke=i(Re);{var Ae=L=>{var P=Rl(),W=i(P),fe=s(W,2);De(fe),l(P),T(()=>{Ve(W,"for",`attack-bonus-${e(u),n(()=>e(u).id)??""}`),Ve(fe,"id",`attack-bonus-${e(u),n(()=>e(u).id)??""}`)}),Je(fe,()=>e(u).bonus,Le=>(e(u).bonus=Le,Ct(()=>(e(y),t(),d())))),v(L,P)};k(ke,L=>{e(u),n(()=>e(u).bonus!==0&&e(u).bonus!==void 0)&&L(Ae)})}var Pe=s(ke,2);{var Ie=L=>{var P=El(),W=i(P),fe=s(W,2);De(fe),l(P),T(()=>{Ve(W,"for",`attack-damage-${e(u),n(()=>e(u).id)??""}`),Ve(fe,"id",`attack-damage-${e(u),n(()=>e(u).id)??""}`)}),Je(fe,()=>e(u).damage,Le=>(e(u).damage=Le,Ct(()=>(e(y),t(),d())))),v(L,P)};k(Pe,L=>{e(u),n(()=>e(u).damage&&e(u).damage.trim()!=="")&&L(Ie)})}var He=s(Pe,2),ce=i(He),be=s(ce,2);De(be),l(He),l(Re);var K=s(Re,2);{var Ce=L=>{var P=rt(),W=Ue(P);{var fe=nt=>{var J=Pl();v(nt,J)},Le=nt=>{const J=dt(()=>(e(u),n(()=>ye(e(u).spellRef))));var vt=rt(),ft=Ue(vt);{var bt=O=>{const B=dt(()=>(N(ka),N(e(J)),n(()=>ka(e(J)))));var we=Yl(),de=Ue(we),et=i(de),Ne=s(i(et),2),ht=i(Ne,!0);l(Ne),l(et);var Ye=s(et,2);{var ot=Ze=>{var at=Hl(),ut=i(at),wt=s(i(ut));l(ut);var Nt=s(ut,2),Ut=s(i(Nt));l(Nt);var Bt=s(Nt,2),Dt=s(i(Bt));l(Bt);var Lt=s(Bt,2),Ot=s(i(Lt)),pt=s(Ot);{var Gt=$t=>{var jt=Ft();T(()=>A(jt,`(${N(e(J)),n(()=>e(J).material)??""})`)),v($t,jt)};k(pt,$t=>{N(e(J)),n(()=>e(J).material)&&$t(Gt)})}l(Lt);var Jt=s(Lt,2),Qt=s(i(Jt),2);{var aa=$t=>{var jt=Ft("Concentration,");v($t,jt)};k(Qt,$t=>{N(e(J)),n(()=>e(J).concentration)&&$t(aa)})}var At=s(Qt,1,!0);l(Jt);var It=s(Jt,2),Mt=s(i(It));l(It);var zt=s(It,2);{var Xt=$t=>{var jt=Il(),Kt=s(i(jt));l(jt),T(()=>A(Kt,` ${N(e(J)),n(()=>e(J).higherLevelSlot)??""}`)),v($t,jt)};k(zt,$t=>{N(e(J)),n(()=>e(J).higherLevelSlot)&&$t(Xt)})}l(at),T($t=>{A(wt,` ${N(e(J)),n(()=>e(J).level)??""}`),A(Ut,` ${N(e(J)),n(()=>e(J).castingTime||e(J).actionType)??""}`),A(Dt,` ${N(e(J)),n(()=>e(J).range)??""}`),A(Ot,` ${$t??""}`),A(At,(N(e(J)),n(()=>e(J).duration))),A(Mt,` ${N(e(J)),n(()=>e(J).description)??""}`)},[()=>(N(e(J)),n(()=>e(J).components.join(", ")))]),v(Ze,at)};k(Ye,Ze=>{e(X),e(u),n(()=>!e(X)[e(u).id])&&Ze(ot)})}l(de);var it=s(de,2);{var ct=Ze=>{var at=Gl(),ut=i(at),wt=i(ut);De(wt);var Nt=s(wt),Ut=s(Nt);{var Bt=pt=>{var Gt=Nl(),Jt=i(Gt);l(Gt),T(Qt=>A(Jt,`(Spell Save DC: ${Qt??""})`),[()=>(N(Ia),t(),c(),n(()=>Ia(t(),c())))]),v(pt,Gt)};k(Ut,pt=>{t(),n(()=>t().class)&&pt(Bt)})}var Dt=s(Ut,2);{var Lt=pt=>{var Gt=Ul();v(pt,Gt)},Ot=pt=>{var Gt=rt(),Jt=Ue(Gt);{var Qt=aa=>{var At=Ol();v(aa,At)};k(Jt,aa=>{e(u),N(e(B)),n(()=>e(u).targetSucceededSave&&e(B).noDamageOnSave)&&aa(Qt)},!0)}v(pt,Gt)};k(Dt,pt=>{e(u),N(e(B)),n(()=>e(u).targetSucceededSave&&e(B).halfDamageOnSave)?pt(Lt):pt(Ot,!1)})}l(ut),l(at),T(pt=>A(Nt,` Target succeeded on ${pt??""} save `),[()=>(N(e(B)),n(()=>e(B).ability.charAt(0).toUpperCase()+e(B).ability.slice(1)))]),wa(wt,()=>e(u).targetSucceededSave,pt=>(e(u).targetSucceededSave=pt,Ct(()=>(e(y),t(),d())))),v(Ze,at)};k(it,Ze=>{e(B)&&Ze(ct)})}var mt=s(it,2);{var gt=Ze=>{const at=dt(()=>(N(e(J)),n(()=>R(e(J)))));var ut=rt(),wt=Ue(ut);{var Nt=Bt=>{var Dt=Vl(),Lt=Ue(Dt),Ot=i(Lt),pt=s(Ot,2);T(()=>{e(u),Ct(()=>{e(at)})}),St(pt,5,()=>e(at),kt,(At,It)=>{var Mt=ql(),zt=i(Mt);l(Mt);var Xt={};T(()=>{A(zt,`Level ${e(It)??""}`),Xt!==(Xt=e(It))&&(Mt.value=(Mt.__value=e(It))??"")}),v(At,Mt)}),l(pt);var Gt=s(pt,2);{var Jt=At=>{const It=dt(()=>(e(u),N(e(J)),n(()=>C(e(u),e(J)))));var Mt=Wl(),zt=i(Mt);{var Xt=Kt=>{var sa=Ft("Healing");v(Kt,sa)},$t=Kt=>{var sa=Ft("Damage");v(Kt,sa)};k(zt,Kt=>{N(e(J)),n(()=>he(e(J)))?Kt(Xt):Kt($t,!1)})}var jt=s(zt);l(Mt),T(()=>A(jt,` ${e(It)??""}`)),v(At,Mt)};k(Gt,At=>{e(u),N(e(J)),n(()=>e(u).castAtLevel&&e(u).castAtLevel>e(J).level)&&At(Jt)})}l(Lt);var Qt=s(Lt,2);{var aa=At=>{var It=Kl(),Mt=i(It),zt=i(Mt);De(zt);var Xt=s(zt,2);{var $t=jt=>{const Kt=dt(()=>(e(u),N(e(J)),n(()=>C(e(u),e(J)))));var sa=zl(),us=i(sa);l(sa),T(()=>A(us,`(+1d8, total: ${e(Kt)??""})`)),v(jt,sa)};k(Xt,jt=>{e(u),n(()=>e(u).targetIsFiendOrUndead)&&jt($t)})}l(Mt),l(It),wa(zt,()=>e(u).targetIsFiendOrUndead,jt=>(e(u).targetIsFiendOrUndead=jt,Ct(()=>(e(y),t(),d())))),v(At,It)};k(Qt,At=>{N(e(J)),n(()=>e(J).description.includes("Fiend or an Undead"))&&At(aa)})}T(()=>{Ve(Ot,"for",`castLevel-${e(u),n(()=>e(u).id)??""}`),Ve(pt,"id",`castLevel-${e(u),n(()=>e(u).id)??""}`)}),Ca(pt,()=>e(u).castAtLevel,At=>(e(u).castAtLevel=At,Ct(()=>(e(y),t(),d())))),v(Bt,Dt)},Ut=Bt=>{var Dt=Jl();v(Bt,Dt)};k(wt,Bt=>{N(e(at)),n(()=>e(at).length>0)?Bt(Nt):Bt(Ut,!1)})}v(Ze,ut)};k(mt,Ze=>{N(e(J)),n(()=>e(J).higherLevelSlot&&e(J).level>0)&&Ze(gt)})}T(()=>{Ve(Ne,"aria-label",(e(X),e(u),n(()=>e(X)[e(u).id]?"Expand":"Collapse"))),A(ht,(e(X),e(u),n(()=>e(X)[e(u).id]?"‚ñº":"‚ñ≤")))}),M("click",et,()=>_e(e(u).id)),M("keydown",et,Ze=>Ze.key==="Enter"&&_e(e(u).id)),v(O,we)},f=O=>{var B=Ql();v(O,B)};k(ft,O=>{e(J)?O(bt):O(f,!1)})}v(nt,vt)};k(W,nt=>{e(Oe),n(()=>e(Oe).length===0)?nt(fe):nt(Le,!1)})}v(L,P)};k(K,L=>{e(u),n(()=>e(u).spellRef)&&L(Ce)})}var ve=s(K,2);{var _=L=>{var P=Xl(),W=i(P),fe=s(W,2);pa(fe),l(P),T(()=>{Ve(W,"for",`attack-notes-${e(u),n(()=>e(u).id)??""}`),Ve(fe,"id",`attack-notes-${e(u),n(()=>e(u).id)??""}`)}),Je(fe,()=>e(u).notes,Le=>(e(u).notes=Le,Ct(()=>(e(y),t(),d())))),v(L,P)};k(ve,L=>{e(u),n(()=>!e(u).spellRef)&&L(_)})}var H=s(ve,2),te=i(H);{var Q=L=>{const P=dt(()=>(e(u),n(()=>ye(e(u).spellRef))));var W=rt(),fe=Ue(W);{var Le=nt=>{var J=rt(),vt=Ue(J);{var ft=f=>{var O=Zl();M("click",O,()=>oe(e(u))),v(f,O)},bt=f=>{var O=rt(),B=Ue(O);{var we=et=>{var Ne=rt(),ht=Ue(Ne);{var Ye=it=>{var ct=ei(),mt=i(ct),gt=i(mt),Ze=i(gt);De(Ze),Ze.value=Ze.__value="self",ia(),l(gt);var at=s(gt,2),ut=i(at);De(ut),ut.value=ut.__value="other",ia(),l(at),l(mt);var wt=s(mt,2),Nt=i(wt);l(wt),l(ct),T(()=>{Ve(Ze,"name",`target-${e(u),n(()=>e(u).id)??""}`),Ve(ut,"name",`target-${e(u),n(()=>e(u).id)??""}`),A(Nt,`Cast ${N(e(P)),n(()=>e(P).name)??""}`)}),za(U,[We],Ze,()=>e(ee)[e(u).id],Ut=>la(ee,e(ee)[e(u).id]=Ut)),za(U,[We],ut,()=>e(ee)[e(u).id],Ut=>la(ee,e(ee)[e(u).id]=Ut)),M("click",wt,()=>b(e(u),e(ee)[e(u).id])),v(it,ct)},ot=it=>{var ct=ti();M("click",ct,()=>b(e(u),"self")),v(it,ct)};k(ht,it=>{N(e(P)),n(()=>G(e(P).name))?it(Ye):it(ot,!1)})}v(et,Ne)},de=et=>{var Ne=rt(),ht=Ue(Ne);{var Ye=it=>{var ct=ai(),mt=i(ct);{var gt=at=>{var ut=Ft("Roll Healing");v(at,ut)},Ze=at=>{var ut=Ft("Roll Damage");v(at,ut)};k(mt,at=>{N(e(P)),n(()=>he(e(P)))?at(gt):at(Ze,!1)})}l(ct),T(at=>yt(ct,1,`btn ${at??""}`),[()=>(N(e(P)),n(()=>he(e(P))?"btn-success":"btn-secondary"))]),M("click",ct,()=>Be(e(u))),v(it,ct)},ot=it=>{var ct=si();M("click",ct,()=>b(e(u),"self")),v(it,ct)};k(ht,it=>{e(u),n(()=>e(u).damage&&e(u).damage.trim()!=="")?it(Ye):it(ot,!1)})}v(et,Ne)};k(B,et=>{N(Za),N(e(P)),n(()=>Za(e(P)))?et(we):et(de,!1)},!0)}v(f,O)};k(vt,f=>{N(Fa),N(e(P)),n(()=>Fa(e(P)))?f(ft):f(bt,!1)})}v(nt,J)};k(fe,nt=>{e(P)&&nt(Le)})}v(L,W)},ie=L=>{var P=rt(),W=Ue(P);{var fe=Le=>{var nt=ii(),J=Ue(nt),vt=s(J,2);{var ft=bt=>{var f=li();M("click",f,()=>Be(e(u))),v(bt,f)};k(vt,bt=>{e(u),n(()=>e(u).damage&&e(u).damage.trim()!=="")&&bt(ft)})}M("click",J,()=>oe(e(u))),v(Le,nt)};k(W,Le=>{e(u),n(()=>!e(u).spellRef)&&Le(fe)},!0)}v(L,P)};k(te,L=>{e(u),e(le),n(()=>e(u).spellRef&&e(le))?L(Q):L(ie,!1)})}l(H),l(me),T(()=>{Ve(ce,"for",`attack-type-${e(u),n(()=>e(u).id)??""}`),Ve(be,"id",`attack-type-${e(u),n(()=>e(u).id)??""}`)}),Je(be,()=>e(u).damageType,L=>(e(u).damageType=L,Ct(()=>(e(y),t(),d())))),v(Y,me)});var Me=s(Se,2);{var st=Y=>{var u=ri();v(Y,u)},xe=Y=>{var u=rt(),We=Ue(u);{var me=ge=>{var E=oi();v(ge,E)};k(We,ge=>{e(y),n(()=>e(y).length===0)&&ge(me)},!0)}v(Y,u)};k(Me,Y=>{t(),n(()=>t().attacks.length===0)?Y(st):Y(xe,!1)})}l(V);var Ke=s(V,2),F=s(i(Ke),4),w=s(F,2);{var ue=Y=>{var u=di();St(u,5,()=>(t(),n(()=>t().activeStates)),kt,(We,me,ge)=>{var E=vi(),Fe=i(E),Te=i(Fe);De(Te);var Xe=s(Te,2);{var lt=ie=>{var L=ci();M("click",L,()=>q(ge)),v(ie,L)};k(Xe,ie=>{g()&&ie(lt)})}l(Fe);var Re=s(Fe,2),ke=i(Re),Ae=i(ke);Ve(Ae,"for",`state-attack-bonus-${ge}`);var Pe=s(Ae,2);De(Pe),Ve(Pe,"id",`state-attack-bonus-${ge}`),l(ke);var Ie=s(ke,2),He=i(Ie);Ve(He,"for",`state-damage-bonus-${ge}`);var ce=s(He,2);De(ce),Ve(ce,"id",`state-damage-bonus-${ge}`),l(Ie);var be=s(Ie,2),K=i(be);Ve(K,"for",`state-target-${ge}`);var Ce=s(K,2);T(()=>{e(me),Ct(()=>{})}),Ve(Ce,"id",`state-target-${ge}`);var ve=i(Ce);ve.value=ve.__value="self";var _=s(ve);_.value=_.__value="other",l(Ce),l(be),l(Re);var H=s(Re,2),te=i(H);Ve(te,"for",`state-desc-${ge}`);var Q=s(te,2);De(Q),Ve(Q,"id",`state-desc-${ge}`),l(H),l(E),Je(Te,()=>e(me).name,ie=>(e(me).name=ie,Ct(()=>t()),da($,"$character"))),Je(Pe,()=>e(me).attackBonus,ie=>(e(me).attackBonus=ie,Ct(()=>t()),da($,"$character"))),Je(ce,()=>e(me).damageBonus,ie=>(e(me).damageBonus=ie,Ct(()=>t()),da($,"$character"))),Ca(Ce,()=>e(me).target,ie=>(e(me).target=ie,Ct(()=>t()),da($,"$character"))),Je(Q,()=>e(me).description,ie=>(e(me).description=ie,Ct(()=>t()),da($,"$character"))),v(We,E)}),l(u),v(Y,u)},pe=Y=>{var u=ui();v(Y,u)};k(w,Y=>{t(),n(()=>t().activeStates&&t().activeStates.length>0)?Y(ue):Y(pe,!1)})}l(Ke),M("click",F,S),v(m,I)};k(qe,m=>{p(),n(()=>!p().attacks)&&m($e)})}l(j),T(()=>ae=yt(j,1,"attacks svelte-14o91c5",null,ae,{hidden:!e(z)})),v(a,j),Pt(),x()}var mi=h('<span class="slot-checkbox-x svelte-serp1j">&#8212;</span>'),gi=h('<label><input type="checkbox" class="slot-checkbox-input svelte-serp1j"/> <span><!></span></label>');function es(a,r){Et(r,!1);const t=()=>tt(ea,"$isEditMode",c),[c,d]=Wt();let p=xt(r,"checked",8,!1),g=xt(r,"disabled",8,!1),$=xt(r,"className",8,""),x=xt(r,"index",8,void 0),y=xt(r,"ariaLabel",8,void 0);const z=na();function U(G){z("change",{checked:G.currentTarget.checked,index:x()})}Rt();var re=gi(),X=i(re);De(X);var ee=s(X,2),_e=i(ee);{var he=G=>{var je=mi();v(G,je)};k(_e,G=>{p()&&G(he)})}l(ee),l(re),T(()=>{yt(re,1,"slot-checkbox-label "+$()+(t()?"":" not-editable"),"svelte-serp1j"),rs(X,p()),X.disabled=g()||!t(),Ve(X,"aria-label",y()),Ve(X,"tabindex",t()?0:-1),yt(ee,1,`slot-checkbox-custom ${p()?"used":""} ${t()?"":"readonly"}`,"svelte-serp1j")}),M("change",X,U),v(a,re),Pt(),d()}var bi=h('<p class="no-features svelte-1kpvv0n">Select a class to see available features</p>'),_i=h('<p class="no-features svelte-1kpvv0n">No class features available at this level</p>'),yi=h('<div class="spell-slots svelte-1kpvv0n"><label class="svelte-1kpvv0n"> </label> <div class="slots-tracker svelte-1kpvv0n"></div></div>'),xi=h('<div class="all-spell-slots"></div>'),Si=h('<div class="feature-box spellcasting svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"> </h3> <div class="spell-stats svelte-1kpvv0n"><div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Spell Save DC</label> <div class="spell-value svelte-1kpvv0n"> </div></div> <div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <div class="spell-value svelte-1kpvv0n"> </div></div></div> <!> <div class="prepared-spells svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <textarea placeholder="List your prepared spells..." class="svelte-1kpvv0n"></textarea></div></div>'),ki=h('<p class="unlimited svelte-1kpvv0n">Unlimited Uses</p>'),$i=h('<div class="slots-tracker svelte-1kpvv0n"></div> <div class="uses-actions-row"><button class="btn btn-primary use-enabled"> </button></div> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div>',1),Ci=h('<div class="uses-tracker svelte-1kpvv0n"><!></div>'),wi=h('<div class="pool-tracker svelte-1kpvv0n"><input type="number" min="0" class="pool-input svelte-1kpvv0n"/> <span> </span> <button class="btn-small svelte-1kpvv0n"> </button></div>'),Di=h('<p class="no-uses svelte-1kpvv0n">No Channel Divinity uses remaining</p>'),Li=h('<div class="channel-divinity-option svelte-1kpvv0n"><button class="btn btn-primary use-enabled svelte-1kpvv0n">Use Channel Divinity</button> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div> <!></div>'),ji=h('<div class="feature-box svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"><!> </h3> <p class="feature-description svelte-1kpvv0n"> </p> <!></div>'),Ai=h('<div class="features-grid svelte-1kpvv0n"><!> <!></div>'),Bi=h("<section><!> <!></section>");function Mi(a,r){Et(r,!1);const t=()=>tt(se,"$character",g),c=()=>tt(ga,"$abilityModifiers",g),d=()=>tt(ta,"$searchFilter",g),p=()=>tt(Tt,"$collapsedStates",g),[g,$]=Wt(),x=D(),y=D(),z=D(),U=D(),re=D(),X=D(),ee=D();let _e=D(0),he=D(0);function G(b,j){se.update(ae=>(ae.classFeatures.features[b]=j,ae))}function je(){se.update(b=>(b.classFeatures.spellSlotsByLevel||(b.classFeatures.spellSlotsByLevel={}),e(U).forEach(({level:j,slots:ae})=>{b.classFeatures.spellSlotsByLevel[j]||(b.classFeatures.spellSlotsByLevel[j]=Array(ae).fill(!1))}),b))}function ze(b){if(typeof b.maxUses=="function"){if((b.name==="Divine Sense"||b.name==="War Priest")&&e(x)?.spellcastingAbility){const j=c()[e(x).spellcastingAbility];return b.maxUses(t().level,j)}return b.maxUses(t().level)}return b.maxUses||0}function oe(b,j){se.update(ae=>((!ae.classFeatures.features[b]||!Array.isArray(ae.classFeatures.features[b])||ae.classFeatures.features[b].length!==j)&&(ae.classFeatures.features[b]=Array(j).fill(!1)),ae))}hs(()=>{e(X)&&t()&&t().classFeatures&&t().classFeatures.features&&e(X).forEach(b=>{if(b.type==="uses"){const j=b.name.replace(/\s+/g,""),ae=ze(b),Ge=t().classFeatures.features[j];(!Array.isArray(Ge)||Ge.length!==ae)&&oe(j,ae)}})});function Be(b){return typeof b.maxPool=="function"?b.maxPool(t().level):b.maxPool||0}function Oe(b){return typeof b.description=="function"?b.description(t().level):b.description}function le(){const b="ChannelDivinity";se.update(j=>{const ae=j.classFeatures.features[b];return typeof ae=="number"&&ae>0&&(j.classFeatures.features[b]=ae-1),j})}function ye(){Tt.update(b=>({...b,classFeatures:!b.classFeatures}))}Qe(()=>(t(),Ht),()=>{o(x,t().class?Ht(t().class):null)}),Qe(()=>(t(),ca),()=>{o(y,t().class?ca(t().class,t().level,t().subclass):[])}),Qe(()=>(t(),Ja),()=>{o(z,t().class?Ja(t().class,t().level):0)}),Qe(()=>(e(x),t()),()=>{o(U,(()=>{if(!e(x)?.spellcaster)return[];const b=t().level,j=[];return b>=1&&j.push({level:1,slots:Math.min(4,2+Math.floor(b/3))}),b>=3&&j.push({level:2,slots:Math.min(3,2+Math.floor((b-3)/4))}),b>=5&&j.push({level:3,slots:Math.min(3,2+Math.floor((b-5)/5))}),b>=7&&j.push({level:4,slots:Math.min(3,1+Math.floor((b-7)/6))}),b>=9&&j.push({level:5,slots:Math.min(2,1+Math.floor((b-9)/8))}),b>=11&&j.push({level:6,slots:1}),b>=13&&j.push({level:7,slots:1}),b>=15&&j.push({level:8,slots:1}),b>=17&&j.push({level:9,slots:1}),j})())}),Qe(()=>(e(x),c(),t(),Ya),()=>{if(e(x)?.spellcaster&&e(x).spellcastingAbility){const b=c()[e(x).spellcastingAbility];o(_e,Vs(t().class,b,t().proficiencyBonus)||0),o(he,Ya(t().class,t().level,b))}}),Qe(()=>(t(),e(x),e(U)),()=>{t().class&&e(x)?.spellcaster&&e(U).length>0&&je()}),Qe(()=>t(),()=>{o(re,(()=>{const j=t().classFeatures.features["ChannelDivinity"];return typeof j=="number"?j:0})())}),Qe(()=>(e(y),d()),()=>{o(X,e(y).filter(b=>{if(!d())return!0;const j=d().toLowerCase();return b.name.toLowerCase().includes(j)||Oe(b).toLowerCase().includes(j)}))}),Qe(()=>(d(),t(),e(X)),()=>{o(ee,!d()||t().class||"class features".includes(d().toLowerCase())||"spellcasting".includes(d().toLowerCase())||e(X).length>0)}),Yt(),Rt();var Ee=Bi();let C;var R=i(Ee);{let b=dt(()=>(p(),n(()=>p().classFeatures?"Expand":"Collapse")));ra(R,{title:"Class Features",get collapsed(){return p(),n(()=>p().classFeatures)},get ariaLabel(){return e(b)},onToggle:ye})}var S=s(R,2);{var q=b=>{var j=rt(),ae=Ue(j);{var Ge=$e=>{var m=bi();v($e,m)},qe=$e=>{var m=rt(),I=Ue(m);{var Z=V=>{var Se=_i();v(V,Se)},ne=V=>{var Se=Ai(),Me=i(Se);{var st=Ke=>{var F=Si(),w=i(F),ue=i(w);l(w);var pe=s(w,2),Y=i(pe),u=s(i(Y),2),We=i(u,!0);l(u),l(Y);var me=s(Y,2),ge=s(i(me),2),E=i(ge,!0);l(ge),l(me),l(pe);var Fe=s(pe,2);{var Te=Re=>{var ke=xi();St(ke,5,()=>e(U),kt,(Ae,Pe)=>{let Ie=()=>e(Pe).level,He=()=>e(Pe).slots;const ce=dt(()=>(t(),Ie(),He(),n(()=>t().classFeatures.spellSlotsByLevel?.[Ie()]||Array(He()).fill(!1))));var be=yi(),K=i(be),Ce=i(K);l(K);var ve=s(K,2);St(ve,5,()=>e(ce),kt,(_,H,te)=>{{let Q=dt(()=>(N(e(ce)),n(()=>e(ce)[te]||!1)));es(_,{get checked(){return e(Q)},$$events:{change:ie=>{se.update(L=>(L.classFeatures.spellSlotsByLevel||(L.classFeatures.spellSlotsByLevel={}),L.classFeatures.spellSlotsByLevel[Ie()]||(L.classFeatures.spellSlotsByLevel[Ie()]=Array(He()).fill(!1)),L.classFeatures.spellSlotsByLevel[Ie()][te]=ie.detail.checked,L))}}})}}),l(ve),l(be),T(()=>A(Ce,`${Ie()===1?"1st":Ie()===2?"2nd":Ie()===3?"3rd":`${Ie()}th`} Level Spell Slots`)),v(Ae,be)}),l(ke),v(Re,ke)};k(Fe,Re=>{e(U),n(()=>e(U).length>0)&&Re(Te)})}var Xe=s(Fe,2),lt=s(i(Xe),2);pa(lt),l(Xe),l(F),T(Re=>{A(ue,`Spellcasting (${Re??""})`),A(We,e(_e)),A(E,e(he))},[()=>(e(x),n(()=>e(x).spellcastingAbility?.toUpperCase()))]),Je(lt,()=>t().classFeatures.preparedSpells,Re=>_t(se,n(t).classFeatures.preparedSpells=Re,n(t))),v(Ke,F)};k(Me,Ke=>{e(x),n(()=>e(x)?.spellcaster)&&Ke(st)})}var xe=s(Me,2);St(xe,1,()=>e(X),kt,(Ke,F)=>{const w=dt(()=>(e(F),n(()=>e(F).name.replace(/\s+/g,"")))),ue=dt(()=>(t(),N(e(w)),n(()=>t().classFeatures.features[e(w)]))),pe=dt(()=>typeof e(ue)=="number");var Y=ji(),u=i(Y),We=i(u);{var me=Re=>{var ke=Ft("Channel Divinity:");v(Re,ke)};k(We,Re=>{e(F),n(()=>e(F).type==="channelDivinity")&&Re(me)})}var ge=s(We);l(u);var E=s(u,2),Fe=i(E,!0);l(E);var Te=s(E,2);{var Xe=Re=>{const ke=dt(()=>(e(F),n(()=>ze(e(F))))),Ae=dt(()=>(N(e(ue)),N(e(ke)),n(()=>Array.isArray(e(ue))?e(ue):Array(e(ke)).fill(!1))));var Pe=Ci(),Ie=i(Pe);{var He=be=>{var K=ki();v(be,K)},ce=be=>{var K=$i(),Ce=Ue(K);St(Ce,5,()=>e(Ae),kt,(L,P,W)=>{es(L,{get checked(){return e(P)},index:W,$$events:{change:fe=>{se.update(Le=>(Le.classFeatures.features[e(w)]||(Le.classFeatures.features[e(w)]=Array(e(ke)).fill(!1)),Le.classFeatures.features[e(w)][W]=fe.detail.checked,Le))}}})}),l(Ce);var ve=s(Ce,2),_=i(ve),H=i(_);l(_),l(ve);var te=s(ve,2),Q=i(te),ie=i(Q);l(Q),l(te),T(L=>{_.disabled=L,A(H,`Use ${e(F),n(()=>e(F).name)??""}`),A(ie,`Resets on ${e(F),n(()=>e(F).resetOn==="short"?"Short Rest":"Long Rest")??""}`)},[()=>(N(e(Ae)),n(()=>e(Ae).filter(L=>!L).length<=0))]),M("click",_,()=>{se.update(L=>{L.classFeatures.features[e(w)]||(L.classFeatures.features[e(w)]=Array(e(ke)).fill(!1));const P=L.classFeatures.features[e(w)],W=P.findIndex(fe=>!fe);return W!==-1&&(P[W]=!0),L})}),v(be,K)};k(Ie,be=>{e(ke)===1/0?be(He):be(ce,!1)})}l(Pe),v(Re,Pe)},lt=Re=>{var ke=rt(),Ae=Ue(ke);{var Pe=He=>{const ce=dt(()=>(e(F),n(()=>Be(e(F)))));var be=wi(),K=i(be);De(K);var Ce=s(K,2),ve=i(Ce);l(Ce);var _=s(Ce,2),H=i(_,!0);l(_),l(be),T(()=>{ha(K,e(pe)&&e(ue)!==void 0?e(ue):e(ce)),Ve(K,"max",e(ce)),A(ve,`/ ${e(ce)??""}`),A(H,(e(F),n(()=>e(F).resetOn==="short"?"Short Rest":"Long Rest")))}),M("input",K,te=>{se.update(Q=>(Q.classFeatures.features[e(w)]=parseInt(te.currentTarget.value)||0,Q))}),M("click",_,()=>G(e(w),e(ce))),v(He,be)},Ie=He=>{var ce=rt(),be=Ue(ce);{var K=Ce=>{var ve=Li(),_=i(ve),H=s(_,2),te=i(H),Q=i(te);l(te),l(H);var ie=s(H,2);{var L=P=>{var W=Di();v(P,W)};k(ie,P=>{e(re)<=0&&P(L)})}l(ve),T(()=>{_.disabled=e(re)<=0,A(Q,`Resets on ${e(F),n(()=>e(F).resetOn==="short"?"Short Rest":"Long Rest")??""}`)}),M("click",_,le),v(Ce,ve)};k(be,Ce=>{e(F),n(()=>e(F).type==="channelDivinity")&&Ce(K)},!0)}v(He,ce)};k(Ae,He=>{e(F),n(()=>e(F).type==="pool")?He(Pe):He(Ie,!1)},!0)}v(Re,ke)};k(Te,Re=>{e(F),n(()=>e(F).type==="uses")?Re(Xe):Re(lt,!1)})}l(Y),T(Re=>{A(ge,` ${e(F),n(()=>e(F).name)??""}`),A(Fe,Re)},[()=>(e(F),n(()=>Oe(e(F))))]),v(Ke,Y)}),l(Se),v(V,Se)};k(I,V=>{e(y),n(()=>e(y).length===0)?V(Z):V(ne,!1)},!0)}v($e,m)};k(ae,$e=>{t(),n(()=>!t().class)?$e(Ge):$e(qe,!1)})}v(b,j)};k(S,b=>{p(),n(()=>!p().classFeatures)&&b(q)})}l(Ee),T(()=>C=yt(Ee,1,"class-features svelte-1kpvv0n",null,C,{hidden:!e(ee)})),v(a,Ee),Pt(),$()}var Fi=h('<textarea placeholder="Enter features, traits, and special abilities..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Equipment</h3> <textarea placeholder="List your equipment and inventory..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Notes</h3> <textarea placeholder="Additional notes..." class="svelte-wttn0l"></textarea>',1),Ti=h("<section><!> <!></section>");function Ri(a,r){Et(r,!1);const t=()=>tt(ta,"$searchFilter",p),c=()=>tt(se,"$character",p),d=()=>tt(Tt,"$collapsedStates",p),[p,g]=Wt(),$=D();function x(){Tt.update(ee=>({...ee,notes:!ee.notes}))}Qe(()=>(t(),c()),()=>{o($,!t()||"features".includes(t().toLowerCase())||"traits".includes(t().toLowerCase())||"equipment".includes(t().toLowerCase())||"notes".includes(t().toLowerCase())||c().features.toLowerCase().includes(t().toLowerCase())||c().equipment.toLowerCase().includes(t().toLowerCase())||c().notes.toLowerCase().includes(t().toLowerCase()))}),Yt(),Rt();var y=Ti();let z;var U=i(y);{let ee=dt(()=>(d(),n(()=>d().notes?"Expand":"Collapse")));ra(U,{title:"Features & Traits",get collapsed(){return d(),n(()=>d().notes)},get ariaLabel(){return e(ee)},onToggle:x})}var re=s(U,2);{var X=ee=>{var _e=Fi(),he=Ue(_e);pa(he);var G=s(he,4);pa(G);var je=s(G,4);pa(je),Je(he,()=>c().features,ze=>_t(se,n(c).features=ze,n(c))),Je(G,()=>c().equipment,ze=>_t(se,n(c).equipment=ze,n(c))),Je(je,()=>c().notes,ze=>_t(se,n(c).notes=ze,n(c))),v(ee,_e)};k(re,ee=>{d(),n(()=>!d().notes)&&ee(X)})}l(y),T(()=>z=yt(y,1,"notes svelte-wttn0l",null,z,{hidden:!e($)})),v(a,y),Pt(),g()}var Ei=h('<div class="color-picker-section svelte-1r90jgp"><h3 class="svelte-1r90jgp">Dice Colors</h3> <div class="color-inputs svelte-1r90jgp"><div class="color-input-group svelte-1r90jgp"><label for="dice-color" class="svelte-1r90jgp">Dice Color</label> <input type="color" id="dice-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="label-color" class="svelte-1r90jgp">Label Color</label> <input type="color" id="label-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="desk-color" class="svelte-1r90jgp">Background Color</label> <input type="color" id="desk-color" class="svelte-1r90jgp"/></div></div></div>'),Pi=h('<div class="loading svelte-1r90jgp"><p class="svelte-1r90jgp">Loading 3D dice...</p></div>'),Ii=h('<div class="custom-dice-selector svelte-1r90jgp"><h3 class="svelte-1r90jgp">Choose Dice to Roll</h3> <div class="dice-inputs svelte-1r90jgp"><div class="dice-input-group svelte-1r90jgp"><label for="d4" class="svelte-1r90jgp">d4</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d4" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d6" class="svelte-1r90jgp">d6</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d6" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d8" class="svelte-1r90jgp">d8</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d8" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d10" class="svelte-1r90jgp">d10</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d10" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d12" class="svelte-1r90jgp">d12</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d12" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d20" class="svelte-1r90jgp">d20</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d20" min="0" max="10"/></div></div> <div class="dice-controls svelte-1r90jgp"><button class="btn btn-primary use-enabled svelte-1r90jgp"> </button> <button class="btn btn-secondary use-enabled svelte-1r90jgp">Reset</button></div></div>'),Hi=h('<span class="crit-badge svelte-1r90jgp">CRITICAL HIT!</span>'),Ni=h('<span class="crit-badge crit-fail svelte-1r90jgp">CRITICAL MISS!</span>'),Ui=h('<div class="bonus-item svelte-1r90jgp"><span class="bonus-value svelte-1r90jgp"> </span> <span class="bonus-source svelte-1r90jgp"> </span></div>'),Oi=h('<div class="bonus-breakdown svelte-1r90jgp"></div>'),Gi=h('<p class="modifier-text svelte-1r90jgp"> </p>'),qi=h('<div class="svelte-1r90jgp"><em class="svelte-1r90jgp">No damage is dealt on a critical miss.</em></div>'),Wi=h('<button class="btn btn-follow-up svelte-1r90jgp"> </button>'),zi=h('<button class="btn btn-guided-strike svelte-1r90jgp">‚ö° Use Guided Strike (+10)</button>'),Ki=h('<div class="follow-up-actions svelte-1r90jgp"><!> <!></div>'),Vi=h('<div class="result-header svelte-1r90jgp"><h3 class="svelte-1r90jgp"> </h3> <!> <!></div> <div class="result-total svelte-1r90jgp"> </div> <div class="result-details svelte-1r90jgp"><!></div> <!> <!>',1),Ji=h('<div role="button" tabindex="-1"><div class="modal-content svelte-1r90jgp" role="dialog" tabindex="0"><div class="modal-header svelte-1r90jgp"><h2 class="svelte-1r90jgp">Dice Roller</h2> <div class="header-buttons svelte-1r90jgp"><button class="color-btn svelte-1r90jgp" title="Customize dice colors">üé®</button> <button class="close-btn svelte-1r90jgp">√ó</button></div></div> <!> <!> <div class="dice-main-area svelte-1r90jgp"><div class="dice-container svelte-1r90jgp"></div> <!></div> <div><!></div></div></div>');function Yi(a,r){Et(r,!1);const t=()=>tt(se,"$character",c),[c,d]=Wt(),p=D(),g=D(),$=D(),x=na();let y=xt(r,"notation",12,""),z=xt(r,"visible",8,!1),U=xt(r,"damageNotation",12,""),re=xt(r,"attackName",12,""),X=xt(r,"applyHalfDamage",8,!1),ee=xt(r,"bonusBreakdown",28,()=>[]),_e=xt(r,"rollType",12,"other"),he=null,G=D(void 0),je=D(!1),ze=D(""),oe=D(null);function Be(){return e(oe)?.resultTotal??null}function Oe(_,H,te){const Q=[];if(!_||!_.result)return Q;const ie=H.match(/([+-]?\d*d\d+|[+-]?\d+)/g)||[];let L=0;const P=new Set;for(const W of ie){const fe=W.trim();if(!fe)continue;const Le=fe.match(/([+-]?)(\d*)d(\d+)/);if(Le){const nt=parseInt(Le[2]||"1"),J=`${nt}d${Le[3]}`,vt=te.findIndex((f,O)=>!P.has(O)&&typeof f.value=="string"&&f.value===J),ft=[];for(let f=0;f<nt&&L<_.result.length;f++)ft.push(_.result[L++]);const bt=vt>=0?te[vt].source:"base die";vt>=0&&P.add(vt);for(const f of ft)Q.push({display:`${f}`,source:bt})}}for(let W=0;W<te.length;W++)if(!P.has(W)&&typeof te[W].value=="number"){const fe=te[W].value;Q.push({display:fe>=0?`+${fe}`:`${fe}`,source:te[W].source})}return Q}let le=D(0),ye=D(0),Ee=D(0),C=D(0),R=D(0),S=D(0),q=D(0),b=D([]),j=D(!1),ae=D(!1),Ge=D(!1),qe=D("#051e0a"),$e=D("#ffffff"),m=D("#3a2004"),I=D(!1);function Z(_){return _.length===9&&_.startsWith("#")?_.substring(0,7):_}function ne(_,H="ff"){return _.length===7&&_.startsWith("#")?_+H:_}function V(){if(window.DICE&&e(G))try{he&&e(G)&&la(G,e(G).innerHTML="");const _=e(G).clientWidth||500,H=e(G).clientHeight||300;he=new window.DICE.dice_box(e(G),{w:_,h:H}),o(je,!0)}catch(_){console.error("Error initializing dice box:",_)}}va(()=>{const _=Q=>new Promise((ie,L)=>{if(document.querySelector(`script[src="${Q}"]`)){ie(null);return}const W=document.createElement("script");W.src=Q,W.onload=()=>{ie(null)},W.onerror=()=>{console.error(`Failed to load: ${Q}`),L(new Error(`Failed to load ${Q}`))},document.head.appendChild(W)});setTimeout(()=>{_(`${ua}/libs/three.min.js`).then(()=>_(`${ua}/libs/cannon.min.js`)).then(()=>_(`${ua}/libs/teal.js`)).then(()=>_(`${ua}/dice.js`)).then(()=>{if(window.DICE){const Q=window.DICE.getColors();o(qe,Z(Q.dice_color)),o($e,Z(Q.label_color)),o(m,Z(Q.desk_color))}V()}).catch(Q=>{console.error("Failed to load dice libraries:",Q)})},100);const H=()=>{e(je)&&V()},te=Q=>{z()&&Q.key==="Escape"&&pe()};return window.addEventListener("resize",H),window.addEventListener("keydown",te),()=>{window.removeEventListener("resize",H),window.removeEventListener("keydown",te)}});function Se(_,H="other"){if(!he||!e(je))return;o(oe,null),o(b,[]),o(j,!1),o(ae,!1),H==="damage"&&ee([]),_e(H),o(Ge,!1),he.diceToRoll=_;const te=ie=>null,Q=ie=>{let L=ie.resultTotal,P=ie.resultString;if(X()&&(L=Math.floor(L/2),P=P+" (halved)"),o(oe,{...ie,resultTotal:L,resultString:P}),console.log("Final roll result:",e(oe)),console.log({type:H}),H==="attack"&&ie.result&&ie.result.length>0){const W=ie.result[0];o(j,W===20),o(ae,W===1)}if(o(b,[]),console.log("Setting up follow-up actions. Type:",H,"damageNotation:",U(),"isCriticalSuccess:",e(j),"isCriticalFail:",e(ae)),H==="attack"&&U())if(e(j)){const W=xe(U());e(b).push({label:`Roll Critical Damage (${W})`,notation:W})}else e(ae)||e(b).push({label:`Roll Damage (${U()})`,notation:U()})};he.start_throw(te,Q)}function Me(){const _=[];e(le)>0&&_.push(`${e(le)}d4`),e(ye)>0&&_.push(`${e(ye)}d6`),e(Ee)>0&&_.push(`${e(Ee)}d8`),e(C)>0&&_.push(`${e(C)}d10`),e(R)>0&&_.push(`${e(R)}d12`),e(S)>0&&_.push(`${e(S)}d20`);let H=_.join("+")||"1d20";return e(q)!==0&&(H+=e(q)>=0?`+${e(q)}`:`${e(q)}`),H}function st(){const _=Me();Se(_)}function xe(_){return _.replace(/(\d+)d(\d+)/g,(H,te,Q)=>`${parseInt(te)*2}d${Q}`)}function Ke(){o(le,0),o(ye,0),o(Ee,0),o(C,0),o(R,0),o(S,0),o(q,0),o(oe,null),o(b,[]),o(j,!1),o(ae,!1),_e("other"),o(Ge,!1)}function F(){window.DICE&&(window.DICE.setColors({dice_color:ne(e(qe),"ff"),label_color:ne(e($e),"ff"),desk_color:e(m)}),he&&(he.updateDeskColor(e(m)),he.updateDiceColors()))}function w(){o(I,!e(I))}function ue(){!e(oe)||e(g)<=0||e(Ge)||(o(oe,{...e(oe),resultTotal:e(oe).resultTotal+10,resultString:e(oe).resultString+" + 10 (Guided Strike)"}),se.update(_=>{const H="ChannelDivinity",te=_.classFeatures.features[H];return typeof te=="number"&&te>0&&(_.classFeatures.features[H]=te-1),_}),o(Ge,!0))}function pe(){x("close"),y(""),U(""),re(""),o(ze,""),o(oe,null),o(Ge,!1),o(j,!1),o(ae,!1),Ke()}Qe(()=>(t(),ca),()=>{o(p,t().class?ca(t().class,t().level,t().subclass).some(H=>H.name==="Guided Strike"):!1)}),Qe(()=>t(),()=>{o(g,(()=>{const H=t().classFeatures.features["ChannelDivinity"];return typeof H=="number"?H:0})())}),Qe(()=>(e(le),e(ye),e(Ee),e(C),e(R),e(S),e(q)),()=>{o($,(()=>{const _=[];e(le)>0&&_.push(`${e(le)}d4`),e(ye)>0&&_.push(`${e(ye)}d6`),e(Ee)>0&&_.push(`${e(Ee)}d8`),e(C)>0&&_.push(`${e(C)}d10`),e(R)>0&&_.push(`${e(R)}d12`),e(S)>0&&_.push(`${e(S)}d20`);let H=_.join("+")||"1d20";return e(q)!==0&&(H+=e(q)>=0?`+${e(q)}`:`${e(q)}`),H})())}),Qe(()=>(N(y()),e(je),N(z()),e(ze),N(U()),N(re()),N(_e())),()=>{y()&&e(je)&&z()&&y()!==e(ze)&&(o(ze,y()),o(oe,null),o(b,[]),o(j,!1),o(ae,!1),o(Ge,!1),console.log("Auto-roll triggered. notation:",y(),"damageNotation:",U(),"attackName:",re(),"rollType:",_e()),setTimeout(()=>Se(y(),_e()),200))}),Yt();var Y={getLastRollTotal:Be};Rt();var u=Ji();let We;var me=i(u),ge=i(me),E=s(i(ge),2),Fe=i(E),Te=s(Fe,2);l(E),l(ge);var Xe=s(ge,2);{var lt=_=>{var H=Ei(),te=s(i(H),2),Q=i(te),ie=s(i(Q),2);De(ie),l(Q);var L=s(Q,2),P=s(i(L),2);De(P),l(L);var W=s(L,2),fe=s(i(W),2);De(fe),l(W),l(te),l(H),Je(ie,()=>e(qe),Le=>o(qe,Le)),M("change",ie,F),Je(P,()=>e($e),Le=>o($e,Le)),M("change",P,F),Je(fe,()=>e(m),Le=>o(m,Le)),M("change",fe,F),v(_,H)};k(Xe,_=>{e(I)&&_(lt)})}var Re=s(Xe,2);{var ke=_=>{var H=Pi();v(_,H)};k(Re,_=>{e(je)||_(ke)})}var Ae=s(Re,2),Pe=i(Ae);ma(Pe,_=>o(G,_),()=>e(G));var Ie=s(Pe,2);{var He=_=>{var H=Ii(),te=s(i(H),2),Q=i(te),ie=s(i(Q),2);De(ie),l(Q);var L=s(Q,2),P=s(i(L),2);De(P),l(L);var W=s(L,2),fe=s(i(W),2);De(fe),l(W);var Le=s(W,2),nt=s(i(Le),2);De(nt),l(Le);var J=s(Le,2),vt=s(i(J),2);De(vt),l(J);var ft=s(J,2),bt=s(i(ft),2);De(bt),l(ft),l(te);var f=s(te,2),O=i(f),B=i(O);l(O);var we=s(O,2);l(f),l(H),T(()=>{O.disabled=!e(je),A(B,`Roll ${e($)??""}`)}),Je(ie,()=>e(le),de=>o(le,de)),Je(P,()=>e(ye),de=>o(ye,de)),Je(fe,()=>e(Ee),de=>o(Ee,de)),Je(nt,()=>e(C),de=>o(C,de)),Je(vt,()=>e(R),de=>o(R,de)),Je(bt,()=>e(S),de=>o(S,de)),M("click",O,st),M("click",we,Ke),v(_,H)};k(Ie,_=>{y()||_(He)})}l(Ae);var ce=s(Ae,2);let be;var K=i(ce);{var Ce=_=>{var H=Vi(),te=Ue(H),Q=i(te),ie=i(Q,!0);l(Q);var L=s(Q,2);{var P=we=>{var de=Hi();v(we,de)};k(L,we=>{e(j)&&we(P)})}var W=s(L,2);{var fe=we=>{var de=Ni();v(we,de)};k(W,we=>{e(ae)&&we(fe)})}l(te);var Le=s(te,2),nt=i(Le,!0);l(Le);var J=s(Le,2),vt=i(J);{var ft=we=>{var de=rt(),et=Ue(de);{var Ne=Ye=>{var ot=Oi();St(ot,5,()=>(e(oe),N(y()),N(ee()),n(()=>Oe(e(oe),y(),ee()))),kt,(it,ct)=>{var mt=Ui(),gt=i(mt),Ze=i(gt,!0);l(gt);var at=s(gt,2),ut=i(at);l(at),l(mt),T(()=>{A(Ze,(e(ct),n(()=>e(ct).display))),A(ut,`(${e(ct),n(()=>e(ct).source)??""})`)}),v(it,mt)}),l(ot),v(Ye,ot)},ht=Ye=>{var ot=rt(),it=Ue(ot);{var ct=mt=>{var gt=Gi(),Ze=i(gt);l(gt),T(()=>A(Ze,`Modifier: ${e(oe),n(()=>e(oe).constant>=0?"+":"")??""}${e(oe),n(()=>e(oe).constant)??""}`)),v(mt,gt)};k(it,mt=>{e(oe),n(()=>e(oe).constant)&&mt(ct)},!0)}v(Ye,ot)};k(et,Ye=>{N(ee()),n(()=>ee().length>0)?Ye(Ne):Ye(ht,!1)})}v(we,de)};k(vt,we=>{e(oe),N(ee()),n(()=>e(oe).constant||ee().length>0)&&we(ft)})}l(J);var bt=s(J,2);{var f=we=>{var de=qi();v(we,de)};k(bt,we=>{e(ae)&&we(f)})}var O=s(bt,2);{var B=we=>{var de=Ki(),et=i(de);St(et,1,()=>e(b),kt,(Ye,ot)=>{var it=Wi(),ct=i(it,!0);l(it),T(()=>A(ct,(e(ot),n(()=>e(ot).label)))),M("click",it,()=>Se(e(ot).notation,"damage")),v(Ye,it)});var Ne=s(et,2);{var ht=Ye=>{var ot=zi();T(()=>{ot.disabled=e(g)<=0,Ve(ot,"title",e(g)<=0?"No Channel Divinity uses remaining":"Use Channel Divinity to add +10 to this attack roll")}),M("click",ot,ue),v(Ye,ot)};k(Ne,Ye=>{e(p)&&_e()==="attack"&&!e(Ge)&&e(g)>0&&!e(ae)&&Ye(ht)})}l(de),v(we,de)};k(O,we=>{e(b),e(p),N(_e()),e(Ge),e(g),n(()=>e(b).length>0||e(p)&&_e()==="attack"&&!e(Ge)&&e(g)>0)&&we(B)})}T(()=>{A(ie,re()?`${re()} - Result`:"Result"),A(nt,(e(oe),n(()=>e(oe).resultTotal)))}),v(_,H)};k(K,_=>{e(oe)&&_(Ce)})}l(ce),l(me),l(u),T(()=>{We=yt(u,1,"modal-overlay svelte-1r90jgp",null,We,{hidden:!z()}),be=yt(ce,1,"roll-result svelte-1r90jgp",null,be,{"has-result":e(oe)})}),M("click",Fe,w),M("click",Te,pe),M("click",me,Oa(function(_){oa.call(this,r,_)})),M("keydown",me,function(_){oa.call(this,r,_)}),M("click",u,pe),M("keydown",u,_=>_.key==="Escape"&&pe()),v(a,u),zs(r,"getLastRollTotal",Be);var ve=Pt(Y);return d(),ve}const La="https://api.github.com/gists";async function Qi(a,r,t){if(!r)throw new Error("GitHub token is required");const c=JSON.stringify(a,null,2),d=`${a.name||"character"}_dnd.json`,p={description:t||`D&D Character: ${a.name}`,public:!1,files:{[d]:{content:c}}},g=await fetch(La,{method:"POST",headers:{Authorization:`token ${r}`,"Content-Type":"application/json"},body:JSON.stringify(p)});if(!g.ok)throw new Error(`Failed to create gist: ${g.statusText}`);return(await g.json()).id}async function Xi(a,r,t){if(!r||!t)throw new Error("GitHub token and Gist ID are required");const c=JSON.stringify(a,null,2),p={files:{[`${a.name||"character"}_dnd.json`]:{content:c}}},g=await fetch(`${La}/${t}`,{method:"PATCH",headers:{Authorization:`token ${r}`,"Content-Type":"application/json"},body:JSON.stringify(p)});if(!g.ok)throw new Error(`Failed to update gist: ${g.statusText}`)}async function Zi(a,r){if(!a)throw new Error("Gist ID is required");const t={"Content-Type":"application/json"};r&&(t.Authorization=`token ${r}`);const c=await fetch(`${La}/${a}`,{method:"GET",headers:t});if(!c.ok)throw new Error(`Failed to load gist: ${c.statusText}`);const d=await c.json(),p=Object.values(d.files);if(p.length===0)throw new Error("No files found in gist");const $=p[0].content;try{const x=JSON.parse($);return x.attacks&&Array.isArray(x.attacks)&&(x.attacks=x.attacks.map(y=>({...y,id:y.id||crypto.randomUUID()}))),x.classFeatures?(x.classFeatures.features||(x.classFeatures.features={}),x.classFeatures.spellSlots||(x.classFeatures.spellSlots=[]),x.classFeatures.preparedSpells===void 0&&(x.classFeatures.preparedSpells="")):x.classFeatures={features:{},spellSlots:[],preparedSpells:""},x}catch{throw new Error("Invalid character data in gist")}}function ts(a){typeof window<"u"&&localStorage.setItem("dnd_gist_config",JSON.stringify(a))}function en(){if(typeof window<"u"){const a=localStorage.getItem("dnd_gist_config");if(a)return JSON.parse(a)}return{}}async function tn(a,r=30){if(!a)throw new Error("GitHub token is required to list gists");const t=await fetch(`${La}?per_page=${r}`,{method:"GET",headers:{Authorization:`token ${a}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error(`Failed to list gists: ${t.statusText}`);return await t.json()}var an=h('<div class="error-message svelte-1jb5ckg"> </div>'),sn=h('<div class="toggle-container svelte-1jb5ckg"><button type="button" class="toggle-btn svelte-1jb5ckg"> </button></div>'),ln=h('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID (leave empty to create new)</label> <input type="text" id="gistId" placeholder="Optional: existing Gist ID to update" class="svelte-1jb5ckg"/></div>'),nn=h('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),rn=h('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),on=h('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Update (or leave unselected to create new)</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),cn=h('<div class="info-message svelte-1jb5ckg">No gists found. A new one will be created.</div>'),vn=h('<!> <div class="form-group svelte-1jb5ckg"><label for="description" class="svelte-1jb5ckg"> </label> <input type="text" id="description" placeholder="D&amp;D Character Sheet" class="svelte-1jb5ckg"/></div>',1),dn=h('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID *</label> <input type="text" id="gistId" placeholder="Enter Gist ID (for public or your private gists)" required class="svelte-1jb5ckg"/></div>'),un=h('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),pn=h('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),fn=h('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Load</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),hn=h('<div class="info-message svelte-1jb5ckg">No gists found. Enter a Gist ID manually or create a new one in Save mode.</div>'),mn=h('<div class="modal-overlay svelte-1jb5ckg" role="button" tabindex="-1"><div class="modal-content svelte-1jb5ckg" role="dialog" tabindex="0"><div class="modal-header svelte-1jb5ckg"><h2 class="svelte-1jb5ckg"> </h2> <button class="close-btn svelte-1jb5ckg">√ó</button></div> <div class="modal-body svelte-1jb5ckg"><!> <div class="form-group svelte-1jb5ckg"><label for="token" class="svelte-1jb5ckg"> <a href="https://github.com/settings/tokens" target="_blank" rel="noopener" class="svelte-1jb5ckg">Get token</a></label> <input type="password" id="token" placeholder="ghp_xxxxxxxxxxxxx" class="svelte-1jb5ckg"/></div> <!> <!> <div class="modal-actions svelte-1jb5ckg"><button class="btn btn-primary svelte-1jb5ckg"><!></button> <button class="btn btn-secondary svelte-1jb5ckg">Cancel</button></div></div></div></div>');function gn(a,r){Et(r,!1);const t=()=>tt(se,"$character",c),[c,d]=Wt(),p=na();let g=xt(r,"mode",8,"save"),$=D(""),x=D(""),y=D(""),z=D(!1),U=D(""),re=D(!1),X=D(!1),ee=D([]),_e=D(null);const he=en();he.token&&o($,he.token),he.gistId&&o(x,he.gistId),va(async()=>{e($)&&!e(re)&&await G()});async function G(){if(e($)){o(X,!0),o(U,"");try{o(ee,await tn(e($))),e(x)&&o(_e,e(ee).find(w=>w.id===e(x))||null)}catch(w){o(U,w.message||"Failed to load gists"),o(ee,[])}finally{o(X,!1)}}}function je(w){o(_e,w),o(x,w.id)}function ze(){o(re,!e(re)),o(U,""),!e(re)&&e($)&&G()}async function oe(){if(!e($)){o(U,"GitHub token is required");return}const w=e(_e)?.id||e(x);o(z,!0),o(U,"");try{if(w)await Xi(t(),e($),w),o(x,w),qt.add("Character updated in Gist successfully!","success");else{const ue=await Qi(t(),e($),e(y));o(x,ue),qt.add(`Character saved to Gist! ID: ${ue}`,"success")}ts({token:e($),gistId:e(x)}),p("close")}catch(ue){o(U,ue.message||"Failed to save to Gist")}finally{o(z,!1)}}async function Be(){const w=e(_e)?.id||e(x);if(!w){o(U,"Please select a gist or enter a Gist ID");return}o(z,!0),o(U,"");try{const ue=await Zi(w,e($)||void 0);se.set(ue),o(x,w),ts({token:e($),gistId:e(x)}),qt.add("Character loaded from Gist successfully!","success"),p("close")}catch(ue){o(U,ue.message||"Failed to load from Gist")}finally{o(z,!1)}}function Oe(){p("close")}Rt();var le=mn(),ye=i(le),Ee=i(ye),C=i(Ee),R=i(C,!0);l(C);var S=s(C,2);l(Ee);var q=s(Ee,2),b=i(q);{var j=w=>{var ue=an(),pe=i(ue,!0);l(ue),T(()=>A(pe,e(U))),v(w,ue)};k(b,w=>{e(U)&&w(j)})}var ae=s(b,2),Ge=i(ae),qe=i(Ge);ia(),l(Ge);var $e=s(Ge,2);De($e),l(ae);var m=s(ae,2);{var I=w=>{var ue=sn(),pe=i(ue),Y=i(pe,!0);l(pe),l(ue),T(()=>{pe.disabled=e(z),A(Y,e(re)?"üìã Show My Gists":"‚úèÔ∏è Enter Gist ID Manually")}),M("click",pe,ze),v(w,ue)};k(m,w=>{(g()==="load"||g()==="save"&&e($))&&w(I)})}var Z=s(m,2);{var ne=w=>{var ue=vn(),pe=Ue(ue);{var Y=Fe=>{var Te=ln(),Xe=s(i(Te),2);De(Xe),l(Te),T(()=>Xe.disabled=e(z)),Je(Xe,()=>e(x),lt=>o(x,lt)),v(Fe,Te)},u=Fe=>{var Te=rt(),Xe=Ue(Te);{var lt=ke=>{var Ae=nn();v(ke,Ae)},Re=ke=>{var Ae=rt(),Pe=Ue(Ae);{var Ie=ce=>{var be=on(),K=s(i(be),2);St(K,5,()=>e(ee),kt,(Ce,ve)=>{var _=rn();let H;var te=i(_),Q=i(te),ie=i(Q,!0);l(Q);var L=s(Q,2),P=i(L,!0);l(L),l(te);var W=s(te,2),fe=i(W),Le=i(fe);l(fe);var nt=s(fe,2),J=i(nt);l(nt),l(W),l(_),T(vt=>{H=yt(_,1,"gist-item svelte-1jb5ckg",null,H,{selected:e(_e)?.id===e(ve).id}),_.disabled=e(z),A(ie,(e(ve),n(()=>e(ve).description||"Untitled"))),A(P,(e(ve),n(()=>e(ve).public?"üåê Public":"üîí Private"))),A(Le,`ID: ${e(ve),n(()=>e(ve).id)??""}`),A(J,`Updated: ${vt??""}`)},[()=>(e(ve),n(()=>new Date(e(ve).updated_at).toLocaleDateString()))]),M("click",_,()=>je(e(ve))),v(Ce,_)}),l(K),l(be),v(ce,be)},He=ce=>{var be=rt(),K=Ue(be);{var Ce=ve=>{var _=cn();v(ve,_)};k(K,ve=>{e($)&&ve(Ce)},!0)}v(ce,be)};k(Pe,ce=>{e(ee),n(()=>e(ee).length>0)?ce(Ie):ce(He,!1)},!0)}v(ke,Ae)};k(Xe,ke=>{e(X)?ke(lt):ke(Re,!1)},!0)}v(Fe,Te)};k(pe,Fe=>{e(re)||!e($)?Fe(Y):Fe(u,!1)})}var We=s(pe,2),me=i(We),ge=i(me);l(me);var E=s(me,2);De(E),l(We),T(()=>{A(ge,`Description ${e(x)?"(optional)":""}`),E.disabled=e(z)}),Je(E,()=>e(y),Fe=>o(y,Fe)),v(w,ue)},V=w=>{var ue=rt(),pe=Ue(ue);{var Y=We=>{var me=dn(),ge=s(i(me),2);De(ge),l(me),T(()=>ge.disabled=e(z)),Je(ge,()=>e(x),E=>o(x,E)),v(We,me)},u=We=>{var me=rt(),ge=Ue(me);{var E=Te=>{var Xe=un();v(Te,Xe)},Fe=Te=>{var Xe=rt(),lt=Ue(Xe);{var Re=Ae=>{var Pe=fn(),Ie=s(i(Pe),2);St(Ie,5,()=>e(ee),kt,(He,ce)=>{var be=pn();let K;var Ce=i(be),ve=i(Ce),_=i(ve,!0);l(ve);var H=s(ve,2),te=i(H,!0);l(H),l(Ce);var Q=s(Ce,2),ie=i(Q),L=i(ie);l(ie);var P=s(ie,2),W=i(P);l(P),l(Q),l(be),T(fe=>{K=yt(be,1,"gist-item svelte-1jb5ckg",null,K,{selected:e(_e)?.id===e(ce).id}),be.disabled=e(z),A(_,(e(ce),n(()=>e(ce).description||"Untitled"))),A(te,(e(ce),n(()=>e(ce).public?"üåê Public":"üîí Private"))),A(L,`ID: ${e(ce),n(()=>e(ce).id)??""}`),A(W,`Updated: ${fe??""}`)},[()=>(e(ce),n(()=>new Date(e(ce).updated_at).toLocaleDateString()))]),M("click",be,()=>je(e(ce))),v(He,be)}),l(Ie),l(Pe),v(Ae,Pe)},ke=Ae=>{var Pe=rt(),Ie=Ue(Pe);{var He=ce=>{var be=hn();v(ce,be)};k(Ie,ce=>{e($)&&ce(He)},!0)}v(Ae,Pe)};k(lt,Ae=>{e(ee),n(()=>e(ee).length>0)?Ae(Re):Ae(ke,!1)},!0)}v(Te,Xe)};k(ge,Te=>{e(X)?Te(E):Te(Fe,!1)},!0)}v(We,me)};k(pe,We=>{e(re)||!e($)?We(Y):We(u,!1)},!0)}v(w,ue)};k(Z,w=>{g()==="save"?w(ne):w(V,!1)})}var Se=s(Z,2),Me=i(Se),st=i(Me);{var xe=w=>{var ue=Ft();T(()=>A(ue,g()==="save"?"Saving...":"Loading...")),v(w,ue)},Ke=w=>{var ue=Ft();T(()=>A(ue,g()==="save"?"Save":"Load")),v(w,ue)};k(st,w=>{e(z)?w(xe):w(Ke,!1)})}l(Me);var F=s(Me,2);l(Se),l(q),l(ye),l(le),T(()=>{A(R,g()==="save"?"Save to GitHub Gist":"Load from GitHub Gist"),A(qe,`GitHub Token ${g()==="load"?"(optional for public gists)":"(required)"} `),$e.disabled=e(z),Me.disabled=e(z),F.disabled=e(z)}),M("click",S,Oe),Je($e,()=>e($),w=>o($,w)),M("blur",$e,()=>{e($)&&!e(re)&&G()}),M("click",Me,function(...w){(g()==="save"?oe:Be)?.apply(this,w)}),M("click",F,Oe),M("click",ye,Oa(function(w){oa.call(this,r,w)})),M("keydown",ye,function(w){oa.call(this,r,w)}),M("click",le,Oe),M("keydown",le,w=>w.key==="Escape"&&Oe()),v(a,le),Pt(),d()}var bn=h('<div class="loading svelte-1ngjemu">Loading D&D data...</div>'),_n=h("<option> </option>"),yn=h('<select class="level-filter svelte-1ngjemu"><option>All Levels</option><option>Cantrip</option><!></select>'),xn=h('<div class="no-results svelte-1ngjemu"> </div>'),Sn=h('<div class="item-meta svelte-1ngjemu"> </div>'),kn=h('<div class="item-meta svelte-1ngjemu"> </div>'),$n=h('<button><div class="item-name svelte-1ngjemu"> </div> <!></button>'),Cn=h('<p class="higher-levels"><strong>At Higher Levels:</strong> </p>'),wn=h('<p class="cantrip-upgrade"><strong>Cantrip Upgrade:</strong> </p>'),Dn=h('<h3 class="svelte-1ngjemu"> </h3> <p class="spell-meta svelte-1ngjemu"><!> <!></p> <p class="spell-classes"><strong>Classes:</strong> </p> <div class="spell-stats svelte-1ngjemu"><div><strong>Casting Time:</strong> </div> <div><strong>Range:</strong> </div> <div><strong>Components:</strong> <!></div> <div><strong>Duration:</strong> <!> </div></div> <p class="description svelte-1ngjemu"> </p> <!> <!>',1),Ln=h('<p class="prerequisite svelte-1ngjemu"><strong>Prerequisite:</strong> </p>'),jn=h('<h3 class="svelte-1ngjemu"> </h3> <!> <p class="description svelte-1ngjemu"> </p> <a target="_blank" rel="noopener" class="source-link svelte-1ngjemu">View Full Details ‚Üí</a>',1),An=h('<div class="item-details svelte-1ngjemu"><!></div>'),Bn=h('<div class="controls svelte-1ngjemu"><div class="tabs svelte-1ngjemu"><button> </button> <button> </button></div> <div class="search-controls svelte-1ngjemu"><input type="text" placeholder="Search by name or description..." class="search-input svelte-1ngjemu"/> <!></div></div> <div class="content-container svelte-1ngjemu"><div class="items-list svelte-1ngjemu"><!></div> <!></div>',1),Mn=h('<div class="modal-backdrop svelte-1ngjemu" role="presentation"><div class="modal svelte-1ngjemu" role="dialog" aria-modal="true" tabindex="-1"><div class="modal-header svelte-1ngjemu"><h2 class="svelte-1ngjemu">Browse D&D Spells & Feats</h2> <button class="close-btn svelte-1ngjemu" aria-label="Close">&times;</button></div> <div class="modal-body svelte-1ngjemu"><!></div> <div class="modal-footer svelte-1ngjemu"><button class="btn-secondary svelte-1ngjemu">Cancel</button> <button class="btn-primary svelte-1ngjemu">Add to Character Sheet</button></div></div></div>');function Fn(a,r){Et(r,!1);const t=D(),c=D(),d=D();let p=xt(r,"onClose",8),g=D("spell"),$=D(!0),x=D(""),y=D(null),z=D([]),U=D([]),re=D(null);va(async()=>{o($,!0);try{o(z,await ds()),o(U,await wl())}catch(S){console.error("Failed to load data:",S)}finally{o($,!1)}});function X(S){o(re,S)}function ee(S){const q=S.match(/(\d+d\d+(?:\s*\+\s*\d+)?)/i);return q?q[1]:""}function _e(S){const q=S.split(/\.( |$)/)[0].trim(),b=Array.from(S.matchAll(/\*\*(.*?)\*\*/g)).map(ae=>ae[1].replace(/\.$/,""));let j=q;return b.length&&(j+=" | Effects: "+b.join(", ")),j}function he(){if(e(re)){if(e(g)==="spell"){const S=e(re);se.update(q=>{const j=[];S.range&&j.push(`Range: ${S.range}`),S.castingTime&&j.push(`Cast: ${S.castingTime}`),S.duration&&j.push(`Duration: ${S.duration}`),S.actionType==="Save"&&j.push("Saving throw spell"),S.components&&S.components.length>0&&j.push(`Components: ${S.components.join(", ")}`),S.material&&j.push(`Material: ${S.material}`);const ae=j.join(" | "),Ge=_e(S.description),qe={id:crypto.randomUUID(),name:`${S.name}${S.concentration?" (C)":""}${S.ritual?" (R)":""}`,bonus:S.actionType==="Attack"?5:0,damage:ee(S.description),damageType:`${S.school} (Lvl ${S.level})`,spellRef:S.name,infoNotes:ae,generalNotes:Ge,castAtLevel:S.level};return q.attacks=[...q.attacks,qe],q})}else if(e(g)==="feat"){const S=e(re);se.update(q=>{const b=`${S.name}${S.prerequisite?` (Req: ${S.prerequisite})`:""}
${S.description}
`;return q.features=q.features?`${q.features}
${b}`:b,q})}o(re,null),p()()}}Qe(()=>(e(y),e(z),e(x)),()=>{o(t,e(y)!==null?Dl(Xa(e(z),e(x)),e(y)):Xa(e(z),e(x)))}),Qe(()=>(e(U),e(x)),()=>{o(c,Ll(e(U),e(x)))}),Qe(()=>(e(g),e(t),e(c)),()=>{o(d,e(g)==="spell"?e(t):e(c))}),Yt(),Rt();var G=Mn(),je=i(G),ze=i(je),oe=s(i(ze),2);l(ze);var Be=s(ze,2),Oe=i(Be);{var le=S=>{var q=bn();v(S,q)},ye=S=>{var q=Bn(),b=Ue(q),j=i(b),ae=i(j);let Ge;var qe=i(ae);l(ae);var $e=s(ae,2);let m;var I=i($e);l($e),l(j);var Z=s(j,2),ne=i(Z);De(ne);var V=s(ne,2);{var Se=pe=>{var Y=yn();T(()=>{e(y),Ct(()=>{})});var u=i(Y);u.value=(u.__value=null)??"";var We=s(u);We.value=We.__value=0;var me=s(We);St(me,0,()=>[1,2,3,4,5,6,7,8,9],kt,(ge,E)=>{var Fe=_n(),Te=i(Fe);l(Fe);var Xe={};T(()=>{A(Te,`Level ${E??""}`),Xe!==(Xe=E)&&(Fe.value=(Fe.__value=E)??"")}),v(ge,Fe)}),l(Y),Ca(Y,()=>e(y),ge=>o(y,ge)),v(pe,Y)};k(V,pe=>{e(g)==="spell"&&pe(Se)})}l(Z),l(b);var Me=s(b,2),st=i(Me),xe=i(st);{var Ke=pe=>{var Y=xn(),u=i(Y);l(Y),T(()=>A(u,`No ${e(g)??""}s found`)),v(pe,Y)},F=pe=>{var Y=rt(),u=Ue(Y);St(u,1,()=>e(d),kt,(We,me)=>{var ge=$n();let E;var Fe=i(ge),Te=i(Fe,!0);l(Fe);var Xe=s(Fe,2);{var lt=ke=>{const Ae=dt(()=>e(me));var Pe=Sn(),Ie=i(Pe);l(Pe),T(()=>A(Ie,`Level ${N(e(Ae)),n(()=>e(Ae).level)??""} ‚Ä¢ ${N(e(Ae)),n(()=>e(Ae).school)??""}`)),v(ke,Pe)},Re=ke=>{const Ae=dt(()=>e(me));var Pe=rt(),Ie=Ue(Pe);{var He=ce=>{var be=kn(),K=i(be,!0);l(be),T(()=>A(K,(N(e(Ae)),n(()=>e(Ae).prerequisite)))),v(ce,be)};k(Ie,ce=>{N(e(Ae)),n(()=>e(Ae).prerequisite)&&ce(He)})}v(ke,Pe)};k(Xe,ke=>{e(g)==="spell"?ke(lt):ke(Re,!1)})}l(ge),T(()=>{E=yt(ge,1,"item-card svelte-1ngjemu",null,E,{selected:e(re)?.name===e(me).name}),A(Te,(e(me),n(()=>e(me).name)))}),M("click",ge,()=>X(e(me))),v(We,ge)}),v(pe,Y)};k(xe,pe=>{e(d),n(()=>e(d).length===0)?pe(Ke):pe(F,!1)})}l(st);var w=s(st,2);{var ue=pe=>{var Y=An(),u=i(Y);{var We=ge=>{const E=dt(()=>e(re));var Fe=Dn(),Te=Ue(Fe),Xe=i(Te,!0);l(Te);var lt=s(Te,2),Re=i(lt);{var ke=f=>{var O=Ft();T(()=>A(O,`${N(e(E)),n(()=>e(E).school)??""} cantrip`)),v(f,O)},Ae=f=>{var O=Ft();T(()=>A(O,`Level ${N(e(E)),n(()=>e(E).level)??""} ${N(e(E)),n(()=>e(E).school)??""}`)),v(f,O)};k(Re,f=>{N(e(E)),n(()=>e(E).level===0)?f(ke):f(Ae,!1)})}var Pe=s(Re,2);{var Ie=f=>{var O=Ft("(ritual)");v(f,O)};k(Pe,f=>{N(e(E)),n(()=>e(E).ritual)&&f(Ie)})}l(lt);var He=s(lt,2),ce=s(i(He));l(He);var be=s(He,2),K=i(be),Ce=s(i(K));l(K);var ve=s(K,2),_=s(i(ve));l(ve);var H=s(ve,2),te=s(i(H)),Q=s(te);{var ie=f=>{var O=Ft();T(()=>A(O,`(${N(e(E)),n(()=>e(E).material)??""})`)),v(f,O)};k(Q,f=>{N(e(E)),n(()=>e(E).material)&&f(ie)})}l(H);var L=s(H,2),P=s(i(L),2);{var W=f=>{var O=Ft("Concentration,");v(f,O)};k(P,f=>{N(e(E)),n(()=>e(E).concentration)&&f(W)})}var fe=s(P,1,!0);l(L),l(be);var Le=s(be,2),nt=i(Le,!0);l(Le);var J=s(Le,2);{var vt=f=>{var O=Cn(),B=s(i(O));l(O),T(()=>A(B,` ${N(e(E)),n(()=>e(E).higherLevelSlot)??""}`)),v(f,O)};k(J,f=>{N(e(E)),n(()=>e(E).higherLevelSlot)&&f(vt)})}var ft=s(J,2);{var bt=f=>{var O=wn(),B=s(i(O));l(O),T(()=>A(B,` ${N(e(E)),n(()=>e(E).cantripUpgrade)??""}`)),v(f,O)};k(ft,f=>{N(e(E)),n(()=>e(E).cantripUpgrade)&&f(bt)})}T((f,O)=>{A(Xe,(N(e(E)),n(()=>e(E).name))),A(ce,` ${f??""}`),A(Ce,` ${N(e(E)),n(()=>e(E).castingTime||e(E).actionType)??""}`),A(_,` ${N(e(E)),n(()=>e(E).range)??""}`),A(te,` ${O??""}`),A(fe,(N(e(E)),n(()=>e(E).duration))),A(nt,(N(e(E)),n(()=>e(E).description)))},[()=>(N(e(E)),n(()=>e(E).classes.join(", "))),()=>(N(e(E)),n(()=>e(E).components.join(", ").toUpperCase()))]),v(ge,Fe)},me=ge=>{const E=dt(()=>e(re));var Fe=jn(),Te=Ue(Fe),Xe=i(Te,!0);l(Te);var lt=s(Te,2);{var Re=Ie=>{var He=Ln(),ce=s(i(He));l(He),T(()=>A(ce,` ${N(e(E)),n(()=>e(E).prerequisite)??""}`)),v(Ie,He)};k(lt,Ie=>{N(e(E)),n(()=>e(E).prerequisite)&&Ie(Re)})}var ke=s(lt,2),Ae=i(ke,!0);l(ke);var Pe=s(ke,2);T(()=>{A(Xe,(N(e(E)),n(()=>e(E).name))),A(Ae,(N(e(E)),n(()=>e(E).description))),Ve(Pe,"href",(N(e(E)),n(()=>e(E).source)))}),v(ge,Fe)};k(u,ge=>{e(g)==="spell"?ge(We):ge(me,!1)})}l(Y),v(pe,Y)};k(w,pe=>{e(re)&&pe(ue)})}l(Me),T(()=>{Ge=yt(ae,1,"tab svelte-1ngjemu",null,Ge,{active:e(g)==="spell"}),A(qe,`üìú Spells (${e(z),n(()=>e(z).length)??""})`),m=yt($e,1,"tab svelte-1ngjemu",null,m,{active:e(g)==="feat"}),A(I,`‚≠ê Feats (${e(U),n(()=>e(U).length)??""})`)}),M("click",ae,()=>{o(g,"spell"),o(re,null),o(x,"")}),M("click",$e,()=>{o(g,"feat"),o(re,null),o(x,"")}),Je(ne,()=>e(x),pe=>o(x,pe)),v(S,q)};k(Oe,S=>{e($)?S(le):S(ye,!1)})}l(Be);var Ee=s(Be,2),C=i(Ee),R=s(C,2);l(Ee),l(je),l(G),T(()=>R.disabled=!e(re)),M("click",oe,function(...S){p()?.apply(this,S)}),M("click",C,function(...S){p()?.apply(this,S)}),M("click",R,he),M("click",je,Oa(function(S){oa.call(this,r,S)})),M("keydown",je,function(S){oa.call(this,r,S)}),M("click",G,function(...S){p()?.apply(this,S)}),M("keydown",G,S=>S.key==="Escape"&&p()()),v(a,G),Pt()}var Tn=h('<link rel="icon" type="image/png" href="favicon4.png"/> <meta name="viewport" content="width=device-width, initial-scale=1"/>',1),Rn=h('<span class="character-name svelte-1uha8ag"> </span>'),En=h("<span> </span>"),Pn=h('<div class="spell-slots-header svelte-1uha8ag"></div>'),In=h("<span> </span><br/>",1),Hn=h("<span> </span>"),Nn=h('<span class="effect-tooltip"><strong> </strong><br/> <br/> <!> <!></span>'),Un=h('<button class="effect-remove-btn svelte-1uha8ag">√ó</button>'),On=h('<span class="effect-badge svelte-1uha8ag" tabindex="0"> <!> <!></span>'),Gn=h(`<div class="active-effects-header svelte-1uha8ag"></div> <style>.effect-badge {
              position: relative;
            }
            .effect-tooltip {
              position: absolute;
              top: 120%;
              left: 50%;
              transform: translateX(-50%);
              background: #fff;
              color: #222;
              border: 1px solid #a5b4fc;
              border-radius: 6px;
              padding: 8px 12px;
              font-size: 0.95em;
              box-shadow: 0 2px 8px rgba(0, 0, 0, 0.12);
              z-index: 10;
              min-width: 180px;
              max-width: 260px;
              white-space: normal;
              pointer-events: none;
              opacity: 1;
              transition: opacity 0.15s;
            }</style>`,1),qn=h('<div class="rest-menu svelte-1uha8ag"><button class="rest-option svelte-1uha8ag">‚òï Short Rest</button> <button class="rest-option svelte-1uha8ag">üõèÔ∏è Long Rest</button></div>'),Wn=h('<div class="container svelte-1uha8ag"><header class="svelte-1uha8ag"><div class="header-top svelte-1uha8ag"><div class="header-title svelte-1uha8ag"><div class="title-row svelte-1uha8ag"><h1 class="svelte-1uha8ag">D&D Character Sheet</h1> <!></div> <!> <!></div> <div class="header-right svelte-1uha8ag"><div class="header-controls svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">üé≤</span><span class="btn-text svelte-1uha8ag">Roll Dice</span></button> <div class="rest-button-container svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">üò¥</span><span class="btn-text svelte-1uha8ag">Rest</span></button> <!></div> <div class="mode-toggle"><button><span class="btn-icon svelte-1uha8ag"> </span><span class="btn-text svelte-1uha8ag"> </span></button></div></div> <div class="header-search svelte-1uha8ag"><input type="text" placeholder="üîç Search..." class="search-input use-enabled svelte-1uha8ag"/></div></div></div> <div class="header-actions svelte-1uha8ag"><button class="btn btn-mode svelte-1uha8ag">üìö Browse Spells & Feats</button> <button class="btn btn-secondary">Save to Gist</button> <button class="btn btn-secondary">Load from Gist</button> <button class="btn btn-secondary">Export JSON</button> <button class="btn btn-secondary">Import JSON</button> <input type="file" accept=".json" style="display: none;"/></div></header> <main class="svelte-1uha8ag"><!> <!> <!> <!> <!> <!> <!></main></div> <!> <!> <!> <!>',1);function er(a,r){Et(r,!1);const t=()=>tt(se,"$character",p),c=()=>tt(ea,"$isEditMode",p),d=()=>tt(ta,"$searchFilter",p),[p,g]=Wt();function $(){const f=[],O=t().classFeatures.spellSlotsByLevel||{};for(let B=1;B<=9;B++){const we=O[B];if(we&&we.length>0){const de=we.length,et=we.filter(Ne=>Ne).length;f.push({level:B,available:de-et,total:de})}}return f}let x=D(!1),y=D(!1),z=D(!1),U=D("save"),re=D(void 0),X=D(""),ee=D(""),_e=D(""),he=D(!1),G=D([]),je=D("other"),ze=D(),oe=!1,Be=1,Oe=D(!1),le=D(null);function ye(f){o(le,f)}function Ee(){o(le,null)}function C(f){o(le,e(le)===f?null:f)}function R(){const f=[];se.update(B=>{const we=B.hitDice.current;B.hitDice.current=Math.min(B.hitDice.max,B.hitDice.current+Math.max(1,Math.floor(B.hitDice.max/2)));const de=B.hitDice.current-we;if(de>0&&f.push(`${de} hit ${de===1?"die":"dice"}`),B.class){const et=ca(B.class,B.level,B.subclass);B.classFeatures.features||(B.classFeatures.features={}),et.forEach(Ne=>{if(Ne.resetOn==="short"){const ht=Ne.name.replace(/\s+/g,"");if(Ne.type==="uses"){const Ye=typeof Ne.maxUses=="function"?Ne.maxUses(B.level):Ne.maxUses;B.classFeatures.features[ht]=Array(Ye).fill(!1),f.push(Ne.name)}else if(Ne.type==="pool"){const Ye=typeof Ne.maxPool=="function"?Ne.maxPool(B.level):Ne.maxPool;Ye!==void 0&&(B.classFeatures.features[ht]=Ye,f.push(Ne.name))}}})}return B}),o(Oe,!1);const O=f.length>0?`Short rest taken! Restored: ${f.join(", ")}`:"Short rest taken!";qt.add(O,"success")}function S(){const f=[];se.update(B=>{const we=B.maxHP-B.currentHP;we>0&&f.push(`${we} HP`),B.currentHP=B.maxHP,B.tempHP=0;const de=B.hitDice.max-B.hitDice.current;de>0&&f.push(`${de} hit ${de===1?"die":"dice"}`),B.hitDice.current=B.hitDice.max;let et=0;if(B.classFeatures.spellSlotsByLevel&&Object.keys(B.classFeatures.spellSlotsByLevel).forEach(Ne=>{const ht=B.classFeatures.spellSlotsByLevel[parseInt(Ne)];if(ht){const Ye=ht.filter(ot=>ot).length;et+=Ye,B.classFeatures.spellSlotsByLevel[parseInt(Ne)]=Array(ht.length).fill(!1)}}),et>0&&f.push(`${et} spell ${et===1?"slot":"slots"}`),B.class){const Ne=ca(B.class,B.level,B.subclass);B.classFeatures.features||(B.classFeatures.features={});let ht=!1;Ne.forEach(Ye=>{const ot=Ye.name.replace(/\s+/g,"");if(!(Ye.type==="info"||Ye.type==="channelDivinity")){if(Ye.type==="uses"){const it=typeof Ye.maxUses=="function"?Ye.maxUses(B.level):Ye.maxUses;B.classFeatures.features[ot]=Array(it).fill(!1),ht=!0}else if(Ye.type==="pool"){const it=typeof Ye.maxPool=="function"?Ye.maxPool(B.level):Ye.maxPool;it!==void 0&&(B.classFeatures.features[ot]=it,ht=!0)}}}),ht&&f.push("all class features")}return B}),o(Oe,!1);const O=f.length>0?`Long rest taken! Restored: ${f.join(", ")}`:"Long rest taken! Fully rested.";qt.add(O,"success")}function q(f){o(X,""),o(ee,""),o(_e,""),o(he,!1),o(G,[]),o(je,"other"),oe=!1,typeof f=="string"?o(X,f):(o(X,f.notation),o(ee,f.damageNotation||""),o(_e,f.attackName||""),o(he,!!f.applyHalfDamage),o(G,f.bonusBreakdown||[]),o(je,f.rollType||"other")),o(x,!0)}function b(f){const{notation:O,count:B,bonusBreakdown:we}=f.detail;o(X,""),oe=!0,Be=B||1,setTimeout(()=>{o(X,O),o(ee,""),o(_e,"Hit Die"),o(G,we||[]),o(je,"other")},0),o(x,!0)}function j(){if(o(x,!1),oe&&e(ze)){const f=e(ze).getLastRollTotal();if(f!==null){const O=Math.max(1,f);se.update(B=>(B.hitDice.current=Math.max(0,B.hitDice.current-Be),B.currentHP=Math.min(B.maxHP,B.currentHP+O),B))}oe=!1}}function ae(){ea.update(f=>!f)}function Ge(f){f.target.closest(".rest-button-container")||o(Oe,!1)}va(()=>{const f=ea.subscribe(O=>{O?document.body.classList.remove("use-mode"):document.body.classList.add("use-mode")});return document.addEventListener("click",Ge),()=>{f(),document.removeEventListener("click",Ge)}});function qe(){Es(t())}function $e(){e(re)?.click()}async function m(f){const B=f.target.files?.[0];if(B)try{const we=await Ps(B);se.set(we),alert("Character imported successfully!")}catch{alert("Failed to import character file")}}Rt();var I=Wn();Ts("1uha8ag",f=>{var O=Tn();ia(2),ls(()=>{Bs.title="D&D Character Sheet"}),v(f,O)});var Z=Ue(I),ne=i(Z),V=i(ne),Se=i(V),Me=i(Se),st=s(i(Me),2);{var xe=f=>{var O=Rn(),B=i(O);l(O),T(()=>A(B,`${t().name??""} (${t().level??""})`)),v(f,O)};k(st,f=>{t().name&&f(xe)})}l(Me);var Ke=s(Me,2);{var F=f=>{var O=Pn();St(O,5,$,kt,(B,we)=>{var de=En();let et;var Ne=i(de);l(de),T(()=>{et=yt(de,1,"slot-badge svelte-1uha8ag",null,et,{depleted:e(we).available===0}),A(Ne,`Lv${e(we).level??""}: ${e(we).available??""}/${e(we).total??""}`)}),v(B,de)}),l(O),v(f,O)};k(Ke,f=>{$().length>0&&f(F)})}var w=s(Ke,2);{var ue=f=>{var O=Gn(),B=Ue(O);St(B,5,()=>t().activeStates,kt,(we,de,et)=>{var Ne=On(),ht=i(Ne),Ye=s(ht);{var ot=mt=>{var gt=Nn(),Ze=i(gt),at=i(Ze,!0);l(Ze);var ut=s(Ze,2),wt=s(ut,3);{var Nt=Dt=>{var Lt=In(),Ot=Ue(Lt),pt=i(Ot);l(Ot),ia(),T(()=>A(pt,`Attack Bonus: ${typeof e(de).attackBonus=="number"&&e(de).attackBonus>0?"+":""}${e(de).attackBonus??""}`)),v(Dt,Lt)};k(wt,Dt=>{e(de).attackBonus&&Dt(Nt)})}var Ut=s(wt,2);{var Bt=Dt=>{var Lt=Hn(),Ot=i(Lt);l(Lt),T(()=>A(Ot,`Damage Bonus: ${typeof e(de).damageBonus=="number"&&e(de).damageBonus>0?"+":""}${e(de).damageBonus??""}`)),v(Dt,Lt)};k(Ut,Dt=>{e(de).damageBonus&&Dt(Bt)})}l(gt),T(()=>{A(at,e(de).name),A(ut,` ${e(de).description??""}`)}),v(mt,gt)};k(Ye,mt=>{e(le)===et&&mt(ot)})}var it=s(Ye,2);{var ct=mt=>{var gt=Un();T(()=>Ve(gt,"title",`End ${e(de).name??""}`)),M("click",gt,()=>{se.update(Ze=>{if(Ze.activeStates){const at=Ze.activeStates[et];at?.hpBonus&&at.target!=="other"&&(Ze.maxHP-=at.hpBonus,Ze.currentHP=Math.max(1,Math.min(Ze.currentHP-at.hpBonus,Ze.maxHP))),Ze.activeStates=Ze.activeStates.filter((ut,wt)=>wt!==et)}return Ze})}),v(mt,gt)};k(it,mt=>{c()||mt(ct)})}l(Ne),T(()=>{Ve(Ne,"aria-label",e(de).name),A(ht,`‚ú® ${e(de).name??""} `)}),M("mouseenter",Ne,()=>ye(et)),M("mouseleave",Ne,Ee),M("focus",Ne,()=>ye(et)),M("blur",Ne,Ee),M("click",Ne,()=>C(et)),v(we,Ne)}),l(B),ia(2),v(f,O)};k(w,f=>{t().activeStates&&t().activeStates.length>0&&f(ue)})}l(Se);var pe=s(Se,2),Y=i(pe),u=i(Y),We=s(u,2),me=i(We),ge=s(me,2);{var E=f=>{var O=qn(),B=i(O),we=s(B,2);l(O),M("click",B,R),M("click",we,S),v(f,O)};k(ge,f=>{e(Oe)&&f(E)})}l(We);var Fe=s(We,2),Te=i(Fe);let Xe;var lt=i(Te),Re=i(lt,!0);l(lt);var ke=s(lt),Ae=i(ke,!0);l(ke),l(Te),l(Fe),l(Y);var Pe=s(Y,2),Ie=i(Pe);De(Ie),l(Pe),l(pe),l(V);var He=s(V,2),ce=i(He),be=s(ce,2),K=s(be,2),Ce=s(K,2),ve=s(Ce,2),_=s(ve,2);ma(_,f=>o(re,f),()=>e(re)),l(He),l(ne);var H=s(ne,2),te=i(H);al(te,{});var Q=s(te,2);nl(Q,{$$events:{roll:f=>q(f.detail)}});var ie=s(Q,2);Cl(ie,{$$events:{roll:f=>q(f.detail)}});var L=s(ie,2);xl(L,{$$events:{rollHitDice:b}});var P=s(L,2);hi(P,{$$events:{roll:f=>q(f.detail)}});var W=s(P,2);Mi(W,{});var fe=s(W,2);Ri(fe,{}),l(H),l(Z);var Le=s(Z,2);ma(Yi(Le,{get notation(){return e(X)},get damageNotation(){return e(ee)},get attackName(){return e(_e)},get applyHalfDamage(){return e(he)},get bonusBreakdown(){return e(G)},get rollType(){return e(je)},get visible(){return e(x)},$$events:{close:j},$$legacy:!0}),f=>o(ze,f),()=>e(ze));var nt=s(Le,2);{var J=f=>{gn(f,{get mode(){return e(U)},$$events:{close:()=>o(y,!1)}})};k(nt,f=>{e(y)&&f(J)})}var vt=s(nt,2);{var ft=f=>{Fn(f,{onClose:()=>o(z,!1)})};k(vt,f=>{e(z)&&f(ft)})}var bt=s(vt,2);Rs(bt,{}),T(()=>{Xe=yt(Te,1,"btn btn-mode svelte-1uha8ag",null,Xe,{"use-mode":!c()}),A(Re,c()?"üìù":"üé≤"),A(Ae,c()?"Edit Mode":"Use Mode")}),M("click",u,()=>{o(G,[]),o(x,!0)}),M("click",me,()=>o(Oe,!e(Oe))),M("click",Te,ae),Je(Ie,d,f=>Is(ta,f)),M("click",ce,()=>o(z,!0)),M("click",be,()=>{o(U,"save"),o(y,!0)}),M("click",K,()=>{o(U,"load"),o(y,!0)}),M("click",Ce,qe),M("click",ve,$e),M("change",_,m),v(a,I),Pt(),g()}export{er as component};
