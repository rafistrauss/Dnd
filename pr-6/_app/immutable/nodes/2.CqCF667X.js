import{f,e as D,a as o,s as x,c as rt,t as yt}from"../chunks/B7Yu7-pH.js";import{i as wt}from"../chunks/Pgj_Karr.js";import{c as qt,o as ia,a as as}from"../chunks/YW1J0937.js";import{a7 as qa,i as Wa,aZ as ss,a_ as ls,a$ as Ma,K as Ut,e as za,b0 as Ka,T as ba,b1 as is,b2 as ns,q as rs,b3 as os,b4 as cs,b5 as vs,ab as ds,d as n,r as Ja,g as us,C as Lt,b6 as tt,b7 as Ht,F as E,G as Dt,s as c,a4 as R,H as i,J as s,I as l,f as e,E as Ke,m as it,A as N,b8 as _t,b9 as aa,ba as Va,ao as Qa,bb as ps}from"../chunks/TSJapsqm.js";import{c as J,a as kt,e as ct,i as vt,u as Ya,s as Gt,b as ut,d as na,f as sa,t as $t,h as fs,T as gs,g as bs,j as hs}from"../chunks/BW7xBItJ.js";import{i as y,s as At,a as Ye,b as nt,d as va,e as ms}from"../chunks/lg4VTcy2.js";import{p as St,b as Da}from"../chunks/BPqayAlY.js";import{b as ta,r as _s}from"../chunks/Bg5PcA3n.js";function fa(a,r,t=!1){if(a.multiple){if(r==null)return;if(!Wa(r))return ss();for(var d of a.options)d.selected=r.includes(la(d));return}for(d of a.options){var p=la(d);if(ls(p,r)){d.selected=!0;return}}(!t||r!==void 0)&&(a.selectedIndex=-1)}function ja(a){var r=new MutationObserver(()=>{fa(a,a.__value)});r.observe(a,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),qa(()=>{r.disconnect()})}function Xa(a,r,t=r){var d=new WeakSet,p=!0;Ma(a,"change",m=>{var k=m?"[selected]":":checked",M;if(a.multiple)M=[].map.call(a.querySelectorAll(k),la);else{var _=a.querySelector(k)??a.querySelector("option:not([disabled])");M=_&&la(_)}t(M),Ut!==null&&d.add(Ut)}),za(()=>{var m=r();if(a===document.activeElement){var k=Ka??Ut;if(d.has(k))return}if(fa(a,m,p),p&&m===void 0){var M=a.querySelector(":checked");M!==null&&(m=la(M),t(m))}a.__value=m,p=!1}),ja(a)}function la(a){return"__value"in a?a.__value:a.value}const ys=Symbol("is custom element"),ks=Symbol("is html");function Le(a){if(ba){var r=!1,t=()=>{if(!r){if(r=!0,a.hasAttribute("value")){var d=a.value;at(a,"value",null),a.value=d}if(a.hasAttribute("checked")){var p=a.checked;at(a,"checked",null),a.checked=p}}};a.__on_r=t,rs(t),os()}}function Ba(a,r){var t=Ia(a);t.value===(t.value=r??void 0)||a.value===r&&(r!==0||a.nodeName!=="PROGRESS")||(a.value=r??"")}function Ss(a,r){var t=Ia(a);t.checked!==(t.checked=r??void 0)&&(a.checked=r)}function at(a,r,t,d){var p=Ia(a);ba&&(p[r]=a.getAttribute(r),r==="src"||r==="srcset"||r==="href"&&a.nodeName==="LINK")||p[r]!==(p[r]=t)&&(r==="loading"&&(a[cs]=t),t==null?a.removeAttribute(r):typeof t!="string"&&xs(a).includes(r)?a[r]=t:a.setAttribute(r,t))}function Ia(a){return a.__attributes??={[ys]:a.nodeName.includes("-"),[ks]:a.namespaceURI===is}}var Ea=new Map;function xs(a){var r=a.getAttribute("is")||a.nodeName,t=Ea.get(r);if(t)return t;Ea.set(r,t=[]);for(var d,p=a,m=Element.prototype;m!==p;){d=vs(p);for(var k in d)d[k].set&&t.push(k);p=ns(p)}return t}function Be(a,r,t=r){var d=new WeakSet;Ma(a,"input",async p=>{var m=p?a.defaultValue:a.value;if(m=Ca(a)?wa(m):m,t(m),Ut!==null&&d.add(Ut),await ds(),m!==(m=r())){var k=a.selectionStart,M=a.selectionEnd,_=a.value.length;if(a.value=m??"",M!==null){var P=a.value.length;k===M&&M===_&&P>_?(a.selectionStart=P,a.selectionEnd=P):(a.selectionStart=k,a.selectionEnd=Math.min(M,P))}}}),(ba&&a.defaultValue!==a.value||n(r)==null&&a.value)&&(t(Ca(a)?wa(a.value):a.value),Ut!==null&&d.add(Ut)),Ja(()=>{var p=r();if(a===document.activeElement){var m=Ka??Ut;if(d.has(m))return}Ca(a)&&p===wa(a.value)||a.type==="date"&&!p&&!a.value||p!==a.value&&(a.value=p??"")})}function ga(a,r,t=r){Ma(a,"change",d=>{var p=d?a.defaultChecked:a.checked;t(p)}),(ba&&a.defaultChecked!==a.checked||n(r)==null)&&t(a.checked),Ja(()=>{var d=r();a.checked=!!d})}function Ca(a){var r=a.type;return r==="number"||r==="range"}function wa(a){return a===""?null:+a}function $s(a,r,t){var d=us(a,r);d&&d.set&&(a[r]=t,qa(()=>{a[r]=null}))}function Ra(a){return function(...r){var t=r[0];return t.stopPropagation(),a?.apply(this,r)}}function Jt(a,r){var t=a.$$events?.[r.type],d=Wa(t)?t.slice():t==null?[]:[t];for(var p of d)p.call(this,r)}const Cs="";function Za(...a){return ta+Cs+_s(a[0],a[1])}const Fa={paladin:{name:"Paladin",hitDice:"d10",spellcaster:!0,spellcastingAbility:"charisma",spellSlotsByLevel:{1:0,2:2,3:3,4:3,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Divine Sense",type:"uses",maxUses:(a,r=1)=>1+Math.max(1,r),resetOn:"long",description:"Detect celestials, fiends, and undead within 60 feet",minLevel:1},{name:"Lay on Hands",type:"pool",maxPool:a=>a*5,resetOn:"long",description:"Heal wounds or cure disease",minLevel:1},{name:"Divine Smite",type:"spellSlot",description:"Expend spell slot to deal extra radiant damage",minLevel:2,rollable:!0},{name:"Channel Divinity",type:"pool",maxPool:a=>a>=18?3:a>=6?2:1,resetOn:"short",description:"Sacred Weapon or Turn Undead",minLevel:3}]},fighter:{name:"Fighter",hitDice:"d10",spellcaster:!1,features:[{name:"Second Wind",type:"uses",maxUses:1,resetOn:"short",description:"Regain 1d10 + fighter level HP as bonus action",minLevel:1,rollable:!0,rollFormula:a=>`1d10+${a}`},{name:"Action Surge",type:"uses",maxUses:a=>a>=17?2:1,resetOn:"short",description:"Take one additional action on your turn",minLevel:2},{name:"Indomitable",type:"uses",maxUses:a=>a>=17?3:a>=13?2:1,resetOn:"long",description:"Reroll a failed saving throw",minLevel:9}],subclasses:{champion:{name:"Champion",features:[{name:"Improved Critical",type:"info",description:"Critical hit on 19-20",minLevel:3},{name:"Remarkable Athlete",type:"info",description:"Add half proficiency to STR/DEX/CON checks, increase long jump distance",minLevel:7},{name:"Additional Fighting Style",type:"info",description:"Choose a second fighting style",minLevel:10},{name:"Superior Critical",type:"info",description:"Critical hit on 18-20",minLevel:15},{name:"Survivor",type:"info",description:"Regain 5 + CON mod HP at start of turn if below half HP",minLevel:18}]},battlemaster:{name:"Battle Master",features:[{name:"Combat Superiority",type:"uses",maxUses:a=>a>=15?6:a>=7?5:4,resetOn:"short",description:a=>`Use superiority dice (${a>=18?"d12":a>=10?"d10":"d8"}) for maneuvers`,minLevel:3},{name:"Know Your Enemy",type:"info",description:"Learn capabilities of creatures you observe",minLevel:7},{name:"Improved Combat Superiority",type:"info",description:"Superiority dice become d10",minLevel:10},{name:"Relentless",type:"info",description:"Regain 1 superiority die if you have none at start of turn",minLevel:15}]}}},rogue:{name:"Rogue",hitDice:"d8",spellcaster:!1,features:[{name:"Sneak Attack",type:"info",description:a=>`Deal ${Math.ceil(a/2)}d6 extra damage once per turn with advantage or ally nearby`,minLevel:1,rollable:!0,rollFormula:a=>`${Math.ceil(a/2)}d6`},{name:"Cunning Action",type:"info",description:"Dash, Disengage, or Hide as a bonus action",minLevel:2},{name:"Uncanny Dodge",type:"info",description:"Use reaction to halve damage from an attack",minLevel:5},{name:"Evasion",type:"info",description:"Take no damage on successful Dex save (half on fail)",minLevel:7}]},wizard:{name:"Wizard",hitDice:"d6",spellcaster:!0,spellcastingAbility:"intelligence",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Arcane Recovery",type:"uses",maxUses:1,resetOn:"long",description:a=>`Recover spell slots totaling up to ${Math.ceil(a/2)} levels during short rest`,minLevel:1},{name:"Spell Mastery",type:"info",description:"Cast one 1st-level and one 2nd-level spell at will",minLevel:18}]},cleric:{name:"Cleric",hitDice:"d8",spellcaster:!0,spellcastingAbility:"wisdom",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Channel Divinity",type:"pool",maxPool:a=>a>=18?3:a>=6?2:1,resetOn:"short",description:"Turn Undead or domain-specific ability",minLevel:2},{name:"Destroy Undead",type:"info",description:a=>`Channel Divinity destroys undead of CR ${a>=17?4:a>=14?3:a>=11?2:a>=8?1:.5} or lower`,minLevel:5},{name:"Divine Intervention",type:"uses",maxUses:1,resetOn:"long",description:a=>`${a}% chance to succeed, implore deity for aid`,minLevel:10}],subclasses:{war:{name:"War Domain",features:[{name:"War Priest",type:"uses",maxUses:(a,r=1)=>Math.max(1,r),resetOn:"long",description:"Make one weapon attack as a bonus action",minLevel:1},{name:"Guided Strike",type:"channelDivinity",description:"Use your Channel Divinity to gain +10 to an attack roll. Make this choice after you see the roll, but before the DM says whether the attack hits or misses.",minLevel:2,resetOn:"short"},{name:"War God's Blessing",type:"channelDivinity",description:"Use reaction to grant +10 to an ally's attack roll within 30 feet. Consumes one use of Channel Divinity.",minLevel:6,resetOn:"short"},{name:"Divine Strike",type:"info",description:a=>`Deal extra ${a>=14?"2d8":"1d8"} weapon damage once per turn`,minLevel:8,rollable:!0,rollFormula:a=>a>=14?"2d8":"1d8"},{name:"Avatar of Battle",type:"info",description:"Gain resistance to nonmagical weapon damage",minLevel:17}]},life:{name:"Life Domain",features:[{name:"Disciple of Life",type:"info",description:"Healing spells restore additional 2 + spell level HP",minLevel:1},{name:"Preserve Life",type:"pool",maxPool:a=>a*5,resetOn:"short",description:"Restore HP to creatures within 30 feet",minLevel:2},{name:"Blessed Healer",type:"info",description:"Regain 2 + spell level HP when you cast healing spell",minLevel:6},{name:"Divine Strike",type:"info",description:a=>`Deal extra ${a>=14?"2d8":"1d8"} radiant damage once per turn`,minLevel:8,rollable:!0,rollFormula:a=>a>=14?"2d8":"1d8"},{name:"Supreme Healing",type:"info",description:"Maximize healing dice instead of rolling",minLevel:17}]}}},barbarian:{name:"Barbarian",hitDice:"d12",spellcaster:!1,features:[{name:"Rage",type:"uses",maxUses:a=>a>=20?1/0:a>=17?6:a>=12?5:a>=6?4:a>=3?3:2,resetOn:"long",description:a=>`+${a>=16?4:a>=9?3:2} damage, resistance to physical damage`,minLevel:1},{name:"Reckless Attack",type:"info",description:"Gain advantage on melee attacks, enemies get advantage on you",minLevel:2},{name:"Danger Sense",type:"info",description:"Advantage on Dex saves against effects you can see",minLevel:2}],subclasses:{berserker:{name:"Path of the Berserker",features:[{name:"Frenzy",type:"info",description:"While raging, make melee attack as bonus action (gain 1 exhaustion after rage)",minLevel:3},{name:"Mindless Rage",type:"info",description:"Cannot be charmed or frightened while raging",minLevel:6},{name:"Intimidating Presence",type:"info",description:"Use action to frighten creature within 30 feet",minLevel:10},{name:"Retaliation",type:"info",description:"When damaged by creature within 5 feet, make melee attack as reaction",minLevel:14}]}}}};function Ct(a){const r=a.toLowerCase();return Fa[r]||null}function Vt(a,r,t){const d=Ct(a);if(!d)return[];const p=d.features.filter(m=>!m.minLevel||m.minLevel<=r);if(t&&d.subclasses&&d.subclasses[t]){const m=d.subclasses[t].features.filter(k=>!k.minLevel||k.minLevel<=r);return[...p,...m]}return p}function Pa(a){const r=Ct(a);return!r||!r.subclasses?[]:Object.keys(r.subclasses).map(t=>({id:t,name:r.subclasses[t].name}))}function Ta(a,r){const t=Ct(a);return!t||!t.spellcaster||!t.spellSlotsByLevel?0:t.spellSlotsByLevel[r]||0}function Ha(a,r,t){const d=Ct(a);return!d||!d.spellcaster?0:Math.max(1,t+r)}function ws(a,r,t){const d=Ct(a);return!d||!d.spellcaster?null:8+r+t}function Ls(){return Object.keys(Fa).map(a=>({id:a,name:Fa[a].name}))}var Ds=f("<option> </option>"),js=f("<option> </option>"),Fs=f('<div class="form-group svelte-172i2fj"><label for="characterSubclass" class="svelte-172i2fj">Subclass</label> <select id="characterSubclass" class="svelte-172i2fj"><option>Select Subclass</option><!></select></div>'),As=f('<div class="info-grid svelte-172i2fj"><div class="form-group svelte-172i2fj"><label for="characterName" class="svelte-172i2fj">Character Name</label> <input type="text" id="characterName" placeholder="Enter name" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterClass" class="svelte-172i2fj">Class</label> <select id="characterClass" class="svelte-172i2fj"><option>Select Class</option><!></select></div> <!> <div class="form-group svelte-172i2fj"><label for="characterLevel" class="svelte-172i2fj">Level</label> <input type="number" id="characterLevel" min="1" max="20" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterRace" class="svelte-172i2fj">Race</label> <input type="text" id="characterRace" placeholder="e.g., Human" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterBackground" class="svelte-172i2fj">Background</label> <input type="text" id="characterBackground" placeholder="e.g., Soldier" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterAlignment" class="svelte-172i2fj">Alignment</label> <input type="text" id="characterAlignment" placeholder="e.g., Lawful Good" class="svelte-172i2fj"/></div></div>'),Ms=f('<section class="character-info svelte-172i2fj"><div class="header svelte-172i2fj"><h2 class="svelte-172i2fj">Character Info</h2> <button class="collapse-btn svelte-172i2fj"> </button></div> <!></section>');function Bs(a,r){Lt(r,!1);const t=()=>Ye(J,"$character",p),d=()=>Ye(kt,"$collapsedStates",p),[p,m]=At(),k=R(),M=Ls();function _(ie){const O=ie.target;J.update(Ae=>(Ae.class=O.value,Ae.subclass="",Ae))}function P(ie){const O=ie.target;J.update(Ae=>(Ae.subclass=O.value,Ae))}function ce(ie){const O=ie.target;J.update(Ae=>(Ae.level=parseInt(O.value)||1,Ae)),Ya()}function z(){kt.update(ie=>({...ie,characterInfo:!ie.characterInfo}))}tt(()=>(t(),Pa),()=>{c(k,t().class?Pa(t().class):[])}),Ht(),wt();var U=Ms(),Ce=i(U),ve=s(i(Ce),2),Fe=i(ve,!0);l(ve),l(Ce);var de=s(Ce,2);{var be=ie=>{var O=As(),Ae=i(O),ke=s(i(Ae),2);Le(ke),l(Ae);var X=s(Ae,2),q=s(i(X),2),ue=i(q);ue.value=ue.__value="";var Se=s(ue);ct(Se,1,()=>M,vt,(C,Z)=>{var B=Ds(),K=i(B,!0);l(B);var Oe={};E(()=>{x(K,(e(Z),n(()=>e(Z).name))),Oe!==(Oe=(e(Z),n(()=>e(Z).id)))&&(B.value=(B.__value=(e(Z),n(()=>e(Z).id)))??"")}),o(C,B)}),l(q);var _e;ja(q),l(X);var He=s(X,2);{var S=C=>{var Z=Fs(),B=s(i(Z),2),K=i(B);K.value=K.__value="";var Oe=s(K);ct(Oe,1,()=>e(k),vt,(he,Ue)=>{var Re=js(),lt=i(Re,!0);l(Re);var F={};E(()=>{x(lt,(e(Ue),n(()=>e(Ue).name))),F!==(F=(e(Ue),n(()=>e(Ue).id)))&&(Re.value=(Re.__value=(e(Ue),n(()=>e(Ue).id)))??"")}),o(he,Re)}),l(B);var re;ja(B),l(Z),E(()=>{re!==(re=(t(),n(()=>t().subclass)))&&(B.value=(B.__value=(t(),n(()=>t().subclass)))??"",fa(B,(t(),n(()=>t().subclass))))}),D("change",B,P),o(C,Z)};y(He,C=>{e(k),n(()=>e(k).length>0)&&C(S)})}var ne=s(He,2),pe=s(i(ne),2);Le(pe),l(ne);var fe=s(ne,2),g=s(i(fe),2);Le(g),l(fe);var H=s(fe,2),ge=s(i(H),2);Le(ge),l(H);var Ne=s(H,2),h=s(i(Ne),2);Le(h),l(Ne),l(O),E(()=>{_e!==(_e=(t(),n(()=>t().class)))&&(q.value=(q.__value=(t(),n(()=>t().class)))??"",fa(q,(t(),n(()=>t().class)))),Ba(pe,(t(),n(()=>t().level)))}),Be(ke,()=>t().name,C=>nt(J,n(t).name=C,n(t))),D("change",q,_),D("change",pe,ce),Be(g,()=>t().race,C=>nt(J,n(t).race=C,n(t))),Be(ge,()=>t().background,C=>nt(J,n(t).background=C,n(t))),Be(h,()=>t().alignment,C=>nt(J,n(t).alignment=C,n(t))),o(ie,O)};y(de,ie=>{d(),n(()=>!d().characterInfo)&&ie(be)})}l(U),E(()=>{at(ve,"aria-label",(d(),n(()=>d().characterInfo?"Expand":"Collapse"))),x(Fe,(d(),n(()=>d().characterInfo?"â–¼":"â–²")))}),D("click",ve,z),o(a,U),Dt(),m()}var Is=f('<div class="ability-card svelte-bbv1xt"><h3 class="svelte-bbv1xt"> </h3> <input type="number" class="ability-score svelte-bbv1xt" min="1" max="30"/> <div class="ability-modifier svelte-bbv1xt"> </div> <button class="roll-btn svelte-bbv1xt">Check</button> <div class="save-row svelte-bbv1xt"><input type="checkbox" class="svelte-bbv1xt"/> <label class="svelte-bbv1xt">Save</label> <button class="roll-btn-small svelte-bbv1xt">Roll</button></div></div>'),Rs=f('<div class="proficiency-bonus svelte-bbv1xt"><label for="profBonus">Proficiency Bonus</label> <input type="number" id="profBonus" class="prof-input svelte-bbv1xt"/></div> <div class="abilities-grid svelte-bbv1xt"></div>',1),Es=f('<section><div class="header svelte-bbv1xt"><h2 class="svelte-bbv1xt">Ability Scores</h2> <button class="collapse-btn svelte-bbv1xt"> </button></div> <!></section>');function Ps(a,r){Lt(r,!1);const t=()=>Ye(na,"$abilityModifiers",k),d=()=>Ye(J,"$character",k),p=()=>Ye(Gt,"$searchFilter",k),m=()=>Ye(kt,"$collapsedStates",k),[k,M]=At(),_=R(),P=R(),ce=qt(),z=[{key:"strength",label:"Strength"},{key:"dexterity",label:"Dexterity"},{key:"constitution",label:"Constitution"},{key:"intelligence",label:"Intelligence"},{key:"wisdom",label:"Wisdom"},{key:"charisma",label:"Charisma"}];function U(){Ya()}function Ce(q){const ue=t()[q],Se=`1d20${ue>=0?"+":""}${ue}`;ce("roll",Se)}function ve(q){const ue=t()[q],Se=d().saveProficiencies[q]?d().proficiencyBonus:0,_e=ue+Se,He=`1d20${_e>=0?"+":""}${_e}`;ce("roll",He)}function Fe(){kt.update(q=>({...q,abilityScores:!q.abilityScores}))}tt(()=>p(),()=>{c(_,z.filter(({label:q})=>p()?q.toLowerCase().includes(p().toLowerCase()):!0))}),tt(()=>(e(_),p()),()=>{c(P,e(_).length>0||!p()||p().toLowerCase().includes("proficiency"))}),Ht(),wt();var de=Es();let be;var ie=i(de),O=s(i(ie),2),Ae=i(O,!0);l(O),l(ie);var ke=s(ie,2);{var X=q=>{var ue=Rs(),Se=Ke(ue),_e=s(i(Se),2);Le(_e),l(Se);var He=s(Se,2);ct(He,5,()=>e(_),vt,(S,ne)=>{let pe=()=>e(ne).key,fe=()=>e(ne).label;var g=Is(),H=i(g),ge=i(H,!0);l(H);var Ne=s(H,2);Le(Ne);var h=s(Ne,2),C=i(h);l(h);var Z=s(h,2),B=s(Z,2),K=i(B);Le(K);var Oe=s(K,2),re=s(Oe,2);l(B),l(g),E(he=>{x(ge,he),x(C,`${t(),pe(),n(()=>t()[pe()]>=0?"+":"")??""}${t(),pe(),n(()=>t()[pe()])??""}`),at(K,"id",`${pe()}-save`),at(Oe,"for",`${pe()}-save`)},[()=>(fe(),n(()=>fe().substring(0,3).toUpperCase()))]),Be(Ne,()=>d().abilities[pe()],he=>nt(J,n(d).abilities[pe()]=he,n(d))),D("change",Ne,U),D("click",Z,()=>Ce(pe())),ga(K,()=>d().saveProficiencies[pe()],he=>nt(J,n(d).saveProficiencies[pe()]=he,n(d))),D("click",re,()=>ve(pe())),o(S,g)}),l(He),Be(_e,()=>d().proficiencyBonus,S=>nt(J,n(d).proficiencyBonus=S,n(d))),o(q,ue)};y(ke,q=>{m(),n(()=>!m().abilityScores)&&q(X)})}l(de),E(()=>{be=ut(de,1,"ability-scores svelte-bbv1xt",null,be,{hidden:!e(P)}),at(O,"aria-label",(m(),n(()=>m().abilityScores?"Expand":"Collapse"))),x(Ae,(m(),n(()=>m().abilityScores?"â–¼":"â–²")))}),D("click",O,Fe),o(a,de),Dt(),M()}function Ts(a){return Math.floor((a-10)/2)}function Aa(a,r){if(!a.class)return null;const t=Ct(a.class);if(!t||!t.spellcaster||!t.spellcastingAbility)return null;const d=r[t.spellcastingAbility];return 8+a.proficiencyBonus+d}function Hs(a,r){if(!a.class)return 0;const t=Ct(a.class);return!t||!t.spellcaster||!t.spellcastingAbility?0:Ts(r[t.spellcastingAbility])}var Ns=f('<div class="stat-box svelte-1r5hyyb"><label for="spellSaveDC" class="svelte-1r5hyyb">Spell Save DC</label> <input type="number" id="spellSaveDC" class="stat-input svelte-1r5hyyb" readonly="" title="8 + Proficiency Bonus + Spellcasting Ability Modifier"/></div>'),Us=f('<span class="hit-dice-type"> </span>'),Gs=f('<div class="stats-grid svelte-1r5hyyb"><div class="stat-box svelte-1r5hyyb"><label for="armorClass" class="svelte-1r5hyyb">Armor Class</label> <input type="number" id="armorClass" class="stat-input svelte-1r5hyyb"/></div> <div class="stat-box svelte-1r5hyyb"><label for="initiative" class="svelte-1r5hyyb">Initiative</label> <input type="number" id="initiative" class="stat-input svelte-1r5hyyb"/></div> <div class="stat-box svelte-1r5hyyb"><label for="speed" class="svelte-1r5hyyb">Speed</label> <input type="text" id="speed" class="stat-input svelte-1r5hyyb"/></div> <!></div> <div class="hp-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Points</h3> <div class="hp-display svelte-1r5hyyb"><div class="hp-inputs svelte-1r5hyyb"><input type="number" class="hp-current svelte-1r5hyyb" min="0"/> <span class="hp-separator svelte-1r5hyyb">/</span> <input type="number" class="hp-max svelte-1r5hyyb" min="0"/></div> <div class="hp-controls svelte-1r5hyyb"><button class="hp-btn svelte-1r5hyyb">âˆ’</button> <button class="hp-btn svelte-1r5hyyb">+</button> <button class="hp-btn svelte-1r5hyyb">âˆ’5</button> <button class="hp-btn svelte-1r5hyyb">+5</button></div></div> <div class="temp-hp svelte-1r5hyyb"><label for="tempHP" class="svelte-1r5hyyb">Temp HP</label> <input type="number" id="tempHP" min="0" class="svelte-1r5hyyb"/></div></div> <div class="hit-dice-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Dice</h3> <div class="hit-dice-display svelte-1r5hyyb"><input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <span>/</span> <input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <!></div> <div class="hit-dice-controls"><label for="hitDiceCount" class="svelte-1r5hyyb">Roll</label> <input type="number" id="hitDiceCount" class="hit-dice-count-input svelte-1r5hyyb" min="1" value="1"/> <button class="btn btn-primary roll-hit-dice use-enabled svelte-1r5hyyb">ðŸŽ² Roll</button></div></div>',1),Os=f('<section><div class="header svelte-1r5hyyb"><h2 class="svelte-1r5hyyb">Combat Stats</h2> <button class="collapse-btn svelte-1r5hyyb"> </button></div> <!></section>');function qs(a,r){Lt(r,!1);const t=()=>Ye(J,"$character",k),d=()=>Ye(na,"$abilityModifiers",k),p=()=>Ye(Gt,"$searchFilter",k),m=()=>Ye(kt,"$collapsedStates",k),[k,M]=At(),_=R(),P=R(),ce=qt();function z(ke){J.update(X=>(X.currentHP=Math.max(0,Math.min(X.maxHP,X.currentHP+ke)),X))}function U(ke=1){if(t().hitDice.current<=0){alert("No hit dice remaining!");return}if(!t().class){alert("Please select a class first!");return}const X=Ct(t().class);if(!X){alert("Invalid class configuration!");return}const q=Math.min(ke,t().hitDice.current),ue=X.hitDice,Se=d().constitution,_e=Se>=0?`+${Se}`:`${Se}`,He=`${q}${ue}${_e}`;ce("rollHitDice",{notation:He,hitDie:ue,count:q})}function Ce(){kt.update(ke=>({...ke,combatStats:!ke.combatStats}))}tt(()=>(t(),d()),()=>{c(_,Aa(t(),d()))}),tt(()=>p(),()=>{c(P,!p()||"armor class".includes(p().toLowerCase())||"initiative".includes(p().toLowerCase())||"speed".includes(p().toLowerCase())||"hit points".includes(p().toLowerCase())||"hp".includes(p().toLowerCase())||"hit dice".includes(p().toLowerCase())||"spell save".includes(p().toLowerCase())||"combat".includes(p().toLowerCase()))}),Ht(),wt();var ve=Os();let Fe;var de=i(ve),be=s(i(de),2),ie=i(be,!0);l(be),l(de);var O=s(de,2);{var Ae=ke=>{var X=Gs(),q=Ke(X),ue=i(q),Se=s(i(ue),2);Le(Se),l(ue);var _e=s(ue,2),He=s(i(_e),2);Le(He),l(_e);var S=s(_e,2),ne=s(i(S),2);Le(ne),l(S);var pe=s(S,2);{var fe=I=>{var V=Ns(),$=s(i(V),2);Le($),l(V),E(()=>Ba($,e(_))),o(I,V)};y(pe,I=>{e(_)!==null&&I(fe)})}l(q);var g=s(q,2),H=s(i(g),2),ge=i(H),Ne=i(ge);Le(Ne);var h=s(Ne,4);Le(h),l(ge);var C=s(ge,2),Z=i(C),B=s(Z,2),K=s(B,2),Oe=s(K,2);l(C),l(H);var re=s(H,2),he=s(i(re),2);Le(he),l(re),l(g);var Ue=s(g,2),Re=s(i(Ue),2),lt=i(Re);Le(lt);var F=s(lt,4);Le(F);var T=s(F,2);{var j=I=>{const V=it(()=>(N(Ct),t(),n(()=>Ct(t().class))));var $=rt(),De=Ke($);{var je=Ee=>{const Je=it(()=>(d(),n(()=>d().constitution)));var Ve=Us(),Pe=i(Ve);l(Ve),E(()=>x(Pe,`(${N(e(V)),n(()=>e(V).hitDice)??""}${(e(Je)>=0?`+${e(Je)}`:e(Je))??""})`)),o(Ee,Ve)};y(De,Ee=>{e(V)&&Ee(je)})}o(I,$)};y(T,I=>{t(),n(()=>t().class)&&I(j)})}l(Re);var u=s(Re,2),Ie=s(i(u),2),se=s(Ie,2);l(u),l(Ue),E(()=>{at(Ne,"max",(t(),n(()=>t().maxHP))),at(lt,"max",(t(),n(()=>t().hitDice.max))),at(Ie,"max",(t(),n(()=>t().hitDice.current))),se.disabled=(t(),n(()=>t().hitDice.current<=0||!t().class))}),Be(Se,()=>t().armorClass,I=>nt(J,n(t).armorClass=I,n(t))),Be(He,()=>t().initiative,I=>nt(J,n(t).initiative=I,n(t))),Be(ne,()=>t().speed,I=>nt(J,n(t).speed=I,n(t))),Be(Ne,()=>t().currentHP,I=>nt(J,n(t).currentHP=I,n(t))),Be(h,()=>t().maxHP,I=>nt(J,n(t).maxHP=I,n(t))),D("click",Z,()=>z(-1)),D("click",B,()=>z(1)),D("click",K,()=>z(-5)),D("click",Oe,()=>z(5)),Be(he,()=>t().tempHP,I=>nt(J,n(t).tempHP=I,n(t))),Be(lt,()=>t().hitDice.current,I=>nt(J,n(t).hitDice.current=I,n(t))),Be(F,()=>t().hitDice.max,I=>nt(J,n(t).hitDice.max=I,n(t))),D("input",Ie,I=>{const V=I.target,$=parseInt(V.value);$>t().hitDice.current&&(V.value=String(t().hitDice.current)),$<1&&(V.value="1")}),D("click",se,()=>{const I=document.getElementById("hitDiceCount"),V=parseInt(I?.value||"1");U(V)}),o(ke,X)};y(O,ke=>{m(),n(()=>!m().combatStats)&&ke(Ae)})}l(ve),E(()=>{Fe=ut(ve,1,"combat-stats svelte-1r5hyyb",null,Fe,{hidden:!e(P)}),at(be,"aria-label",(m(),n(()=>m().combatStats?"Expand":"Collapse"))),x(ie,(m(),n(()=>m().combatStats?"â–¼":"â–²")))}),D("click",be,Ce),o(a,ve),Dt(),M()}const La={acrobatics:"dexterity",animalHandling:"wisdom",arcana:"intelligence",athletics:"strength",deception:"charisma",history:"intelligence",insight:"wisdom",intimidation:"charisma",investigation:"intelligence",medicine:"wisdom",nature:"intelligence",perception:"wisdom",performance:"charisma",persuasion:"charisma",religion:"intelligence",sleightOfHand:"dexterity",stealth:"dexterity",survival:"wisdom"};var Ws=f('<div class="skill-row svelte-1f1pl16"><input type="checkbox" class="svelte-1f1pl16"/> <label class="svelte-1f1pl16"> <span class="ability-tag svelte-1f1pl16"> </span></label> <span class="skill-modifier svelte-1f1pl16"> </span> <button class="roll-btn svelte-1f1pl16">Roll</button></div>'),zs=f('<div class="skills-grid svelte-1f1pl16"></div>'),Ks=f('<section><div class="header svelte-1f1pl16"><h2 class="svelte-1f1pl16">Skills</h2> <button class="collapse-btn svelte-1f1pl16"> </button></div> <!></section>');function Js(a,r){Lt(r,!1);const t=()=>Ye(na,"$abilityModifiers",k),d=()=>Ye(J,"$character",k),p=()=>Ye(Gt,"$searchFilter",k),m=()=>Ye(kt,"$collapsedStates",k),[k,M]=At(),_=R(),P=R(),ce=qt(),z=[{key:"acrobatics",label:"Acrobatics"},{key:"animalHandling",label:"Animal Handling"},{key:"arcana",label:"Arcana"},{key:"athletics",label:"Athletics"},{key:"deception",label:"Deception"},{key:"history",label:"History"},{key:"insight",label:"Insight"},{key:"intimidation",label:"Intimidation"},{key:"investigation",label:"Investigation"},{key:"medicine",label:"Medicine"},{key:"nature",label:"Nature"},{key:"perception",label:"Perception"},{key:"performance",label:"Performance"},{key:"persuasion",label:"Persuasion"},{key:"religion",label:"Religion"},{key:"sleightOfHand",label:"Sleight of Hand"},{key:"stealth",label:"Stealth"},{key:"survival",label:"Survival"}];function U(X){const q=La[X],ue=t()[q],Se=d().skillProficiencies[X]?d().proficiencyBonus:0;return ue+Se}function Ce(X){const q=U(X),ue=`1d20${q>=0?"+":""}${q}`;ce("roll",ue)}function ve(){kt.update(X=>({...X,skills:!X.skills}))}tt(()=>p(),()=>{c(_,z.filter(({label:X})=>p()?X.toLowerCase().includes(p().toLowerCase()):!0))}),tt(()=>e(_),()=>{c(P,e(_).length>0)}),Ht(),wt();var Fe=Ks();let de;var be=i(Fe),ie=s(i(be),2),O=i(ie,!0);l(ie),l(be);var Ae=s(be,2);{var ke=X=>{var q=zs();ct(q,5,()=>e(_),vt,(ue,Se)=>{let _e=()=>e(Se).key,He=()=>e(Se).label;const S=it(()=>(N(La),_e(),n(()=>La[_e()]))),ne=it(()=>(_e(),n(()=>U(_e()))));var pe=Ws(),fe=i(pe);Le(fe);var g=s(fe,2),H=i(g),ge=s(H),Ne=i(ge);l(ge),l(g);var h=s(g,2),C=i(h);l(h);var Z=s(h,2);l(pe),E(B=>{at(fe,"id",_e()),at(g,"for",_e()),x(H,`${He()??""} `),x(Ne,`(${B??""})`),x(C,`${e(ne)>=0?"+":""}${e(ne)??""}`)},[()=>(N(e(S)),n(()=>e(S).substring(0,3).toUpperCase()))]),ga(fe,()=>d().skillProficiencies[_e()],B=>nt(J,n(d).skillProficiencies[_e()]=B,n(d))),D("click",Z,()=>Ce(_e())),o(ue,pe)}),l(q),o(X,q)};y(Ae,X=>{m(),n(()=>!m().skills)&&X(ke)})}l(Fe),E(()=>{de=ut(Fe,1,"skills svelte-1f1pl16",null,de,{hidden:!e(P)}),at(ie,"aria-label",(m(),n(()=>m().skills?"Expand":"Collapse"))),x(O,(m(),n(()=>m().skills?"â–¼":"â–²")))}),D("click",ie,ve),o(a,Fe),Dt(),M()}let da=null,ua=null;async function es(){if(da)return da;try{return da=await(await fetch(Za("/data/spells.json"))).json(),da||[]}catch(a){return console.error("Failed to load spells:",a),[]}}async function Vs(){if(ua)return ua;try{return ua=await(await fetch(Za("/data/feats.json"))).json(),ua||[]}catch(a){return console.error("Failed to load feats:",a),[]}}function Na(a,r){if(!r.trim())return a;const t=r.toLowerCase();return a.filter(d=>d.name.toLowerCase().includes(t)||d.school.toLowerCase().includes(t)||d.classes.some(p=>p.toLowerCase().includes(t))||d.description.toLowerCase().includes(t))}function Qs(a,r){return r===null?a:a.filter(t=>t.level===r)}function Ys(a,r){if(!r.trim())return a;const t=r.toLowerCase();return a.filter(d=>d.name.toLowerCase().includes(t)||d.description.toLowerCase().includes(t))}function pa(a){const r=a.description,t=/\b(Strength|Dexterity|Constitution|Intelligence|Wisdom|Charisma)\s+saving\s+throw/i,d=r.match(t);if(!d)return null;const p=d[1].toLowerCase(),k=/half\s+(?:as\s+much\s+)?damage\s+on\s+a\s+successful(?:\s+save)?/i.test(r),_=/saving\s+throw\s+or\s+take.*?damage/i.test(r)&&!k;return{ability:p,halfDamageOnSave:k,noDamageOnSave:_}}function Xs(a){const r=a.description;return/(plus|add)\s+your\s+spellcasting\s+(ability\s+)?modifier/i.test(r)}function Ua(a){const r=a.description.toLowerCase(),d=["takes","take","deals","deal","damage equal to","force damage","fire damage","cold damage","lightning damage","thunder damage","acid damage","poison damage","necrotic damage","radiant damage","psychic damage","regain","regains","hit point"].some(k=>r.includes(k));return["bonus to attack","bonus to damage","bonus to ac","gains a +","gain a +","+1 bonus","+2 bonus","+3 bonus","advantage on","becomes a magic weapon"].some(k=>r.includes(k))&&!d}function Zs(a){const r=a.description;let t=0,d=0,p="";const m=r.match(/\+(\d+)\s+bonus\s+to\s+attack\s+rolls\s+and\s+damage\s+rolls/i);if(m){const M=parseInt(m[1]);t=M,d=M,p=`+${M} to attack and damage rolls`}a.name==="Bless"&&(p="Add 1d4 to attack rolls and saves");const k=r.match(/\+(\d+)\s+bonus\s+to\s+AC/i);return k&&(p=`+${parseInt(k[1])} to AC`),a.name==="Haste"&&(p="+2 AC, doubled speed, extra action"),p||t!==0||d!==0?{attackBonus:t,damageBonus:d,description:p||a.description.substring(0,100)}:null}var el=f('<button class="btn-remove svelte-14o91c5">Ã—</button>'),tl=f('<div class="spell-info-loading svelte-14o91c5">Loading spell info...</div>'),al=f('<div class="spell-notes svelte-14o91c5"><h4 class="svelte-14o91c5">General Notes</h4> <p> </p></div>'),sl=f('<li class="svelte-14o91c5"><strong>At Higher Levels:</strong> </li>'),ll=f('<ul class="svelte-14o91c5"><li class="svelte-14o91c5"><strong>Level:</strong> </li> <li class="svelte-14o91c5"><strong>Casting Time:</strong> </li> <li class="svelte-14o91c5"><strong>Range:</strong> </li> <li class="svelte-14o91c5"><strong>Components:</strong> <!></li> <li class="svelte-14o91c5"><strong>Duration:</strong> <!> </li> <li class="svelte-14o91c5"><strong>Description:</strong> </li> <!></ul>'),il=f("<option> </option>"),nl=f('<span class="scaled-damage svelte-14o91c5"><!> </span>'),rl=f('<span class="scaled-damage svelte-14o91c5"> </span>'),ol=f('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> Target is Fiend or Undead <!></label></div>'),cl=f('<span class="scaled-damage svelte-14o91c5" style="margin-left: 8px;"> </span>'),vl=f('<span class="scaled-damage svelte-14o91c5">(Half damage)</span>'),dl=f('<span class="scaled-damage svelte-14o91c5">(No damage)</span>'),ul=f('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> <!> <!></label></div>'),pl=f('<div class="spell-level-selector svelte-14o91c5"><label class="svelte-14o91c5">Cast at Level:</label> <select class="spell-level-select use-enabled svelte-14o91c5"></select> <!></div> <!> <!>',1),fl=f('<div class="spell-level-selector svelte-14o91c5"><span style="color: #dc3545; font-weight: bold;">No spell slots available!</span></div>'),gl=f('<!> <div class="spell-info svelte-14o91c5"><div class="spell-info-header svelte-14o91c5" role="button" tabindex="0"><h4 class="svelte-14o91c5">Spell Info</h4> <button class="collapse-btn-small svelte-14o91c5"> </button></div> <!></div> <!>',1),bl=f('<div class="spell-info-missing svelte-14o91c5">Spell info not found.</div>'),hl=f('<div class="attack-notes svelte-14o91c5"><label class="svelte-14o91c5">Notes</label> <textarea placeholder="e.g., DC 15 Dex save, Range 120 ft, Concentration" class="notes-input svelte-14o91c5" rows="2"></textarea></div>'),ml=f('<button class="btn btn-primary">Roll Attack</button>'),_l=f('<button class="btn btn-success">Cast Spell</button>'),yl=f('<button class="btn btn-secondary"><!></button>'),kl=f('<button class="btn btn-secondary">Roll Damage</button>'),Sl=f('<div class="attack-card svelte-14o91c5"><div class="attack-header svelte-14o91c5"><input type="text" placeholder="Attack name" class="attack-name svelte-14o91c5"/> <!></div> <div class="attack-details svelte-14o91c5"><div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Bonus</label> <input type="number" class="attack-bonus svelte-14o91c5"/></div> <div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Damage</label> <input type="text" placeholder="e.g., 2d6+3" class="attack-damage svelte-14o91c5"/></div> <div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Type</label> <input type="text" placeholder="e.g., slashing" class="attack-type svelte-14o91c5"/></div></div> <!> <!> <div class="attack-actions svelte-14o91c5"><!> <!></div></div>'),xl=f('<p class="no-attacks svelte-14o91c5">No attacks added yet. Click "Add Attack" to create one.</p>'),$l=f('<p class="no-attacks svelte-14o91c5">No attacks match your search.</p>'),Cl=f('<button class="btn-remove svelte-14o91c5">Ã—</button>'),wl=f('<div class="state-card svelte-14o91c5"><div class="state-header svelte-14o91c5"><input type="text" placeholder="Effect name (e.g., Magic Weapon)" class="state-name svelte-14o91c5"/> <!></div> <div class="state-details svelte-14o91c5"><div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Attack Bonus</label> <input type="number" class="state-bonus svelte-14o91c5"/></div> <div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Damage Bonus</label> <input type="number" class="state-bonus svelte-14o91c5"/></div></div> <div class="state-description svelte-14o91c5"><label class="svelte-14o91c5">Description</label> <input type="text" placeholder="e.g., +1 to attack and damage rolls (Magic Weapon)" class="state-desc-input svelte-14o91c5"/></div></div>'),Ll=f('<div class="states-list svelte-14o91c5"></div>'),Dl=f('<p class="no-states svelte-14o91c5">No active effects. Add spell effects that modify your attacks.</p>'),jl=f('<button class="btn btn-secondary">Add Attack</button> <div class="attacks-list svelte-14o91c5"><!> <!></div> <div class="active-states-section svelte-14o91c5"><h3 class="svelte-14o91c5">Active Spell Effects</h3> <p class="section-description svelte-14o91c5">Effects that modify attack and damage rolls (e.g., Magic Weapon, Bless)</p> <button class="btn btn-secondary">Add Effect</button> <!></div>',1),Fl=f('<section><div class="header svelte-14o91c5"><h2 class="svelte-14o91c5">Attacks & Spells</h2> <button class="collapse-btn svelte-14o91c5"> </button></div> <!></section>');function Al(a,r){Lt(r,!1);const t=()=>Ye(J,"$character",M),d=()=>Ye(na,"$abilityModifiers",M),p=()=>Ye(Gt,"$searchFilter",M),m=()=>Ye(kt,"$collapsedStates",M),k=()=>Ye(sa,"$isEditMode",M),[M,_]=At(),P=R(),ce=R(),z=qt();let U=R({});function Ce(h){Va(U,e(U)[h]=!e(U)[h]),c(U,{...e(U)})}function ve(h){return h.description.toLowerCase().includes("regain")&&(h.description.toLowerCase().includes("hit point")||h.description.toLowerCase().includes("hp"))}function Fe(){J.update(h=>(h.attacks=[...h.attacks,{id:crypto.randomUUID(),name:"",bonus:0,damage:"",damageType:"",notes:""}],h))}function de(h){J.update(C=>(C.attacks=C.attacks.filter(Z=>Z.id!==h),C))}function be(h){let C=h.damage,Z=!1;if(h.spellRef){const re=X(h.spellRef);if(re&&re.level>0){const he=h.castAtLevel||re.level;if(!q(he)){$t.add(`No level ${he} spell slots available!`,"error");return}const Re=pa(re);Re&&h.targetSucceededSave&&Re.noDamageOnSave?C="0":(Z=Re?.halfDamageOnSave&&h.targetSucceededSave||!1,C=ue(h,re))}}else if(t().activeStates&&t().activeStates.length>0){let re=0;for(const he of t().activeStates)re+=he.damageBonus;if(re!==0&&C){const he=C.match(/(\d+d\d+)([+-]\d+)?/);if(he){const[,Ue,Re]=he,F=(Re?parseInt(Re):0)+re;C=`${Ue}${F>=0?"+":""}${F}`}}}const B=[];h.bonus!==0&&B.push({value:h.bonus,source:"base"});let K=h.bonus;if(t().activeStates)for(const re of t().activeStates)re.attackBonus!==0&&(B.push({value:re.attackBonus,source:re.name.toLowerCase()}),K+=re.attackBonus);let Oe;Oe=`1d20${K>=0?"+":""}${K}`,z("roll",{notation:Oe,damageNotation:C,attackName:h.name,applyHalfDamage:Z,bonusBreakdown:B})}function ie(h){if(!h.damage){$t.add(`${h.name}: No damage specified`,"error");return}let C=h.damage,Z=!1;const B=[];if(h.spellRef){const K=X(h.spellRef);if(K&&K.level>0){const Oe=h.castAtLevel||K.level;if(!q(Oe)){$t.add(`No level ${Oe} spell slots available!`,"error");return}const he=pa(K);he&&h.targetSucceededSave&&he.noDamageOnSave?C="0":(Z=he?.halfDamageOnSave&&h.targetSucceededSave||!1,C=ue(h,K))}}else{const K=C.match(/(\d+d\d+)([+-]\d+)?/);if(K){const[,Oe,re]=K,he=re?parseInt(re):0;if(he!==0&&B.push({value:he,source:"base"}),t().activeStates&&t().activeStates.length>0){let Ue=0;for(const Re of t().activeStates)Re.damageBonus!==0&&(B.push({value:Re.damageBonus,source:Re.name.toLowerCase()}),Ue+=Re.damageBonus);if(Ue!==0){const Re=he+Ue;C=`${Oe}${Re>=0?"+":""}${Re}`}}}}z("roll",{notation:C,attackName:h.name,applyHalfDamage:Z,bonusBreakdown:B})}function O(){kt.update(h=>({...h,attacks:!h.attacks}))}let Ae=R([]),ke=R(!1);ia(async()=>{c(Ae,await es()),c(ke,!0)});function X(h){return e(Ae).find(C=>C.name===h)}function q(h){t().classFeatures.spellSlotsByLevel||nt(J,n(t).classFeatures.spellSlotsByLevel={},n(t)),t().classFeatures.spellSlotsByLevel[h]||nt(J,n(t).classFeatures.spellSlotsByLevel[h]=Array(2).fill(!1),n(t));const Z=t().classFeatures.spellSlotsByLevel[h].findIndex(B=>!B);return Z===-1?!1:(J.update(B=>(B.classFeatures.spellSlotsByLevel||(B.classFeatures.spellSlotsByLevel={}),B.classFeatures.spellSlotsByLevel[h]||(B.classFeatures.spellSlotsByLevel[h]=Array(2).fill(!1)),B.classFeatures.spellSlotsByLevel[h][Z]=!0,B)),!0)}function ue(h,C){let Z=h.damage,B=0,K=0;if(Xs(C)&&(K+=Hs(t(),d())),t().activeStates)for(const j of t().activeStates)K+=j.damageBonus;if(C.higherLevelSlot&&h.castAtLevel){const j=C.level,Ie=(h.castAtLevel||j)-j;if(Ie>0){const se=C.higherLevelSlot.match(/(\d+)d(\d+)\s+for\s+each.*?level\s+above/i);if(se){const[,I]=se;B+=Ie*parseInt(I)}}}if(h.targetIsFiendOrUndead&&C.description.includes("Fiend or an Undead")){const j=C.description.match(/increases by (\d+)d(\d+) if.*?Fiend or.*?Undead/i);if(j){const[,u]=j;B+=parseInt(u)}}const Oe=Z.match(/(\d+)d(\d+)([+-]\d+)?/);if(!Oe)return K!==0?K>=0?`${K}`:`${K}`:Z||"0";const[,re,he,Ue]=Oe,Re=parseInt(re)+B,F=(Ue?parseInt(Ue):0)+K;let T=`${Re}d${he}`;return F!==0&&(T+=F>=0?`+${F}`:`${F}`),T}function Se(h){const C=[];for(let B=h.level;B<=9;B++){const K=t().classFeatures.spellSlotsByLevel?.[B];K&&K.length>0&&C.push(B)}return C}function _e(){J.update(h=>(h.activeStates||(h.activeStates=[]),h.activeStates=[...h.activeStates,{name:"",attackBonus:0,damageBonus:0,description:""}],h))}function He(h){J.update(C=>(C.activeStates&&(C.activeStates=C.activeStates.filter((Z,B)=>B!==h)),C))}function S(h){const C=X(h.spellRef);if(!C){$t.add("Spell not found","error");return}const Z=h.castAtLevel||C.level;if(Z>0&&!q(Z)){$t.add(`No level ${Z} spell slots available!`,"error");return}const B=Zs(C);if(!B){$t.add(`${C.name} cast! Check spell description for effects.`,"info");return}J.update(K=>(K.activeStates||(K.activeStates=[]),K.activeStates=K.activeStates.filter(Oe=>Oe.name!==C.name),K.activeStates=[...K.activeStates,{name:C.name,attackBonus:B.attackBonus,damageBonus:B.damageBonus,description:B.description}],K)),$t.add(`${C.name} cast! Effect added to Active Spell Effects.`,"success")}tt(()=>(t(),p()),()=>{c(P,t().attacks.filter(h=>{if(!p())return!0;const C=p().toLowerCase();return h.name.toLowerCase().includes(C)||h.damageType.toLowerCase().includes(C)}).sort((h,C)=>!h.spellRef&&C.spellRef?-1:h.spellRef&&!C.spellRef?1:0))}),tt(()=>(p(),e(P)),()=>{c(ce,!p()||e(P).length>0||"attack".includes(p().toLowerCase())||"spell".includes(p().toLowerCase()))}),Ht(),wt();var ne=Fl();let pe;var fe=i(ne),g=s(i(fe),2),H=i(g,!0);l(g),l(fe);var ge=s(fe,2);{var Ne=h=>{var C=jl(),Z=Ke(C),B=s(Z,2),K=i(B);ct(K,1,()=>e(P),j=>j.id,(j,u,Ie)=>{var se=Sl(),I=i(se),V=i(I);Le(V);var $=s(V,2);{var De=G=>{var Y=el();D("click",Y,()=>de(e(u).id)),o(G,Y)};y($,G=>{k()&&G(De)})}l(I);var je=s(I,2),Ee=i(je),Je=s(i(Ee),2);Le(Je),l(Ee);var Ve=s(Ee,2),Pe=s(i(Ve),2);Le(Pe),l(Ve);var ee=s(Ve,2),we=s(i(ee),2);Le(we),l(ee),l(je);var Ge=s(je,2);{var qe=G=>{var Y=rt(),oe=Ke(Y);{var ze=Qe=>{var v=tl();o(Qe,v)},$e=Qe=>{const v=it(()=>(e(u),n(()=>X(e(u).spellRef))));var te=rt(),L=Ke(te);{var Te=ae=>{var A=gl(),ye=Ke(A);{var Me=ft=>{var ht=al(),Et=s(i(ht),2),Yt=i(Et,!0);l(Et),l(ht),E(()=>x(Yt,(e(u),n(()=>e(u).generalNotes)))),o(ft,ht)};y(ye,ft=>{e(u),n(()=>e(u).generalNotes)&&ft(Me)})}var pt=s(ye,2),et=i(pt),st=s(i(et),2),jt=i(st,!0);l(st),l(et);var bt=s(et,2);{var It=ft=>{var ht=ll(),Et=i(ht),Yt=s(i(Et));l(Et);var Xt=s(Et,2),ma=s(i(Xt));l(Xt);var Mt=s(Xt,2),xt=s(i(Mt));l(Mt);var Wt=s(Mt,2),zt=s(i(Wt)),ra=s(zt);{var Ot=Xe=>{var ot=yt();E(()=>x(ot,`(${N(e(v)),n(()=>e(v).material)??""})`)),o(Xe,ot)};y(ra,Xe=>{N(e(v)),n(()=>e(v).material)&&Xe(Ot)})}l(Wt);var Zt=s(Wt,2),oa=s(i(Zt),2);{var ca=Xe=>{var ot=yt("Concentration,");o(Xe,ot)};y(oa,Xe=>{N(e(v)),n(()=>e(v).concentration)&&Xe(ca)})}var _a=s(oa,1,!0);l(Zt);var ea=s(Zt,2),ya=s(i(ea));l(ea);var dt=s(ea,2);{var gt=Xe=>{var ot=sl(),Ft=s(i(ot));l(ot),E(()=>x(Ft,` ${N(e(v)),n(()=>e(v).higherLevelSlot)??""}`)),o(Xe,ot)};y(dt,Xe=>{N(e(v)),n(()=>e(v).higherLevelSlot)&&Xe(gt)})}l(ht),E(Xe=>{x(Yt,` ${N(e(v)),n(()=>e(v).level)??""}`),x(ma,` ${N(e(v)),n(()=>e(v).castingTime||e(v).actionType)??""}`),x(xt,` ${N(e(v)),n(()=>e(v).range)??""}`),x(zt,` ${Xe??""}`),x(_a,(N(e(v)),n(()=>e(v).duration))),x(ya,` ${N(e(v)),n(()=>e(v).description)??""}`)},[()=>(N(e(v)),n(()=>e(v).components.join(", ")))]),o(ft,ht)};y(bt,ft=>{e(U),e(u),n(()=>!e(U)[e(u).id])&&ft(It)})}l(pt);var Rt=s(pt,2);{var Qt=ft=>{const ht=it(()=>(N(e(v)),n(()=>Se(e(v)))));var Et=rt(),Yt=Ke(Et);{var Xt=Mt=>{const xt=it(()=>(N(pa),N(e(v)),n(()=>pa(e(v)))));var Wt=pl(),zt=Ke(Wt),ra=i(zt),Ot=s(ra,2);E(()=>{e(u),_t(()=>{e(ht)})}),ct(Ot,5,()=>e(ht),vt,(dt,gt)=>{var Xe=il(),ot=i(Xe);l(Xe);var Ft={};E(()=>{x(ot,`Level ${e(gt)??""}`),Ft!==(Ft=e(gt))&&(Xe.value=(Xe.__value=e(gt))??"")}),o(dt,Xe)}),l(Ot);var Zt=s(Ot,2);{var oa=dt=>{const gt=it(()=>(e(u),N(e(v)),n(()=>ue(e(u),e(v)))));var Xe=nl(),ot=i(Xe);{var Ft=Bt=>{var Tt=yt("Healing");o(Bt,Tt)},Kt=Bt=>{var Tt=yt("Damage");o(Bt,Tt)};y(ot,Bt=>{N(e(v)),n(()=>ve(e(v)))?Bt(Ft):Bt(Kt,!1)})}var Pt=s(ot);l(Xe),E(()=>x(Pt,` ${e(gt)??""}`)),o(dt,Xe)};y(Zt,dt=>{e(u),N(e(v)),n(()=>e(u).castAtLevel&&e(u).castAtLevel>e(v).level)&&dt(oa)})}l(zt);var ca=s(zt,2);{var _a=dt=>{var gt=ol(),Xe=i(gt),ot=i(Xe);Le(ot);var Ft=s(ot,2);{var Kt=Pt=>{const Bt=it(()=>(e(u),N(e(v)),n(()=>ue(e(u),e(v)))));var Tt=rl(),ka=i(Tt);l(Tt),E(()=>x(ka,`(+1d8, total: ${e(Bt)??""})`)),o(Pt,Tt)};y(Ft,Pt=>{e(u),n(()=>e(u).targetIsFiendOrUndead)&&Pt(Kt)})}l(Xe),l(gt),ga(ot,()=>e(u).targetIsFiendOrUndead,Pt=>(e(u).targetIsFiendOrUndead=Pt,_t(()=>(e(P),t(),p())))),o(dt,gt)};y(ca,dt=>{N(e(v)),n(()=>e(v).description.includes("Fiend or an Undead"))&&dt(_a)})}var ea=s(ca,2);{var ya=dt=>{var gt=ul(),Xe=i(gt),ot=i(Xe);Le(ot);var Ft=s(ot),Kt=s(Ft);{var Pt=mt=>{var Nt=cl(),Sa=i(Nt);l(Nt),E(xa=>x(Sa,`(Spell Save DC: ${xa??""})`),[()=>(N(Aa),t(),d(),n(()=>Aa(t(),d())))]),o(mt,Nt)};y(Kt,mt=>{t(),n(()=>t().class)&&mt(Pt)})}var Bt=s(Kt,2);{var Tt=mt=>{var Nt=vl();o(mt,Nt)},ka=mt=>{var Nt=rt(),Sa=Ke(Nt);{var xa=$a=>{var ts=dl();o($a,ts)};y(Sa,$a=>{e(u),N(e(xt)),n(()=>e(u).targetSucceededSave&&e(xt).noDamageOnSave)&&$a(xa)},!0)}o(mt,Nt)};y(Bt,mt=>{e(u),N(e(xt)),n(()=>e(u).targetSucceededSave&&e(xt).halfDamageOnSave)?mt(Tt):mt(ka,!1)})}l(Xe),l(gt),E(mt=>x(Ft,` Target succeeded on ${mt??""} save `),[()=>(N(e(xt)),n(()=>e(xt).ability.charAt(0).toUpperCase()+e(xt).ability.slice(1)))]),ga(ot,()=>e(u).targetSucceededSave,mt=>(e(u).targetSucceededSave=mt,_t(()=>(e(P),t(),p())))),o(dt,gt)};y(ea,dt=>{e(xt)&&dt(ya)})}E(()=>{at(ra,"for",`castLevel-${e(u),n(()=>e(u).id)??""}`),at(Ot,"id",`castLevel-${e(u),n(()=>e(u).id)??""}`)}),Xa(Ot,()=>e(u).castAtLevel,dt=>(e(u).castAtLevel=dt,_t(()=>(e(P),t(),p())))),o(Mt,Wt)},ma=Mt=>{var xt=fl();o(Mt,xt)};y(Yt,Mt=>{N(e(ht)),n(()=>e(ht).length>0)?Mt(Xt):Mt(ma,!1)})}o(ft,Et)};y(Rt,ft=>{N(e(v)),n(()=>e(v).higherLevelSlot&&e(v).level>0)&&ft(Qt)})}E(()=>{at(st,"aria-label",(e(U),e(u),n(()=>e(U)[e(u).id]?"Expand":"Collapse"))),x(jt,(e(U),e(u),n(()=>e(U)[e(u).id]?"â–¼":"â–²")))}),D("click",et,()=>Ce(e(u).id)),D("keydown",et,ft=>ft.key==="Enter"&&Ce(e(u).id)),o(ae,A)},Ze=ae=>{var A=bl();o(ae,A)};y(L,ae=>{e(v)?ae(Te):ae(Ze,!1)})}o(Qe,te)};y(oe,Qe=>{e(Ae),n(()=>e(Ae).length===0)?Qe(ze):Qe($e,!1)})}o(G,Y)};y(Ge,G=>{e(u),n(()=>e(u).spellRef)&&G(qe)})}var W=s(Ge,2);{var xe=G=>{var Y=hl(),oe=s(i(Y),2);aa(oe),l(Y),Be(oe,()=>e(u).notes,ze=>(e(u).notes=ze,_t(()=>(e(P),t(),p())))),o(G,Y)};y(W,G=>{e(u),n(()=>!e(u).spellRef)&&G(xe)})}var We=s(W,2),b=i(We);{var w=G=>{var Y=ml();D("click",Y,()=>be(e(u))),o(G,Y)};y(b,G=>{e(u),n(()=>e(u).bonus!==0||!e(u).spellRef)&&G(w)})}var le=s(b,2);{var Q=G=>{const Y=it(()=>(e(u),n(()=>X(e(u).spellRef))));var oe=rt(),ze=Ke(oe);{var $e=v=>{var te=_l();D("click",te,()=>S(e(u))),o(v,te)},Qe=v=>{var te=yl(),L=i(te);{var Te=ae=>{var A=yt("Roll Healing");o(ae,A)},Ze=ae=>{var A=yt("Roll Damage");o(ae,A)};y(L,ae=>{N(e(Y)),n(()=>e(Y)&&ve(e(Y)))?ae(Te):ae(Ze,!1)})}l(te),D("click",te,()=>ie(e(u))),o(v,te)};y(ze,v=>{N(e(Y)),N(Ua),n(()=>e(Y)&&Ua(e(Y)))?v($e):v(Qe,!1)})}o(G,oe)},me=G=>{var Y=kl();D("click",Y,()=>ie(e(u))),o(G,Y)};y(le,G=>{e(u),e(ke),n(()=>e(u).spellRef&&e(ke))?G(Q):G(me,!1)})}l(We),l(se),Be(V,()=>e(u).name,G=>(e(u).name=G,_t(()=>(e(P),t(),p())))),Be(Je,()=>e(u).bonus,G=>(e(u).bonus=G,_t(()=>(e(P),t(),p())))),Be(Pe,()=>e(u).damage,G=>(e(u).damage=G,_t(()=>(e(P),t(),p())))),Be(we,()=>e(u).damageType,G=>(e(u).damageType=G,_t(()=>(e(P),t(),p())))),o(j,se)});var Oe=s(K,2);{var re=j=>{var u=xl();o(j,u)},he=j=>{var u=rt(),Ie=Ke(u);{var se=I=>{var V=$l();o(I,V)};y(Ie,I=>{e(P),n(()=>e(P).length===0)&&I(se)},!0)}o(j,u)};y(Oe,j=>{t(),n(()=>t().attacks.length===0)?j(re):j(he,!1)})}l(B);var Ue=s(B,2),Re=s(i(Ue),4),lt=s(Re,2);{var F=j=>{var u=Ll();ct(u,5,()=>(t(),n(()=>t().activeStates)),vt,(Ie,se,I)=>{var V=wl(),$=i(V),De=i($);Le(De);var je=s(De,2);{var Ee=W=>{var xe=Cl();D("click",xe,()=>He(I)),o(W,xe)};y(je,W=>{k()&&W(Ee)})}l($);var Je=s($,2),Ve=i(Je),Pe=s(i(Ve),2);Le(Pe),l(Ve);var ee=s(Ve,2),we=s(i(ee),2);Le(we),l(ee),l(Je);var Ge=s(Je,2),qe=s(i(Ge),2);Le(qe),l(Ge),l(V),Be(De,()=>e(se).name,W=>(e(se).name=W,_t(()=>t()),va(M,"$character"))),Be(Pe,()=>e(se).attackBonus,W=>(e(se).attackBonus=W,_t(()=>t()),va(M,"$character"))),Be(we,()=>e(se).damageBonus,W=>(e(se).damageBonus=W,_t(()=>t()),va(M,"$character"))),Be(qe,()=>e(se).description,W=>(e(se).description=W,_t(()=>t()),va(M,"$character"))),o(Ie,V)}),l(u),o(j,u)},T=j=>{var u=Dl();o(j,u)};y(lt,j=>{t(),n(()=>t().activeStates&&t().activeStates.length>0)?j(F):j(T,!1)})}l(Ue),D("click",Z,Fe),D("click",Re,_e),o(h,C)};y(ge,h=>{m(),n(()=>!m().attacks)&&h(Ne)})}l(ne),E(()=>{pe=ut(ne,1,"attacks svelte-14o91c5",null,pe,{hidden:!e(ce)}),at(g,"aria-label",(m(),n(()=>m().attacks?"Expand":"Collapse"))),x(H,(m(),n(()=>m().attacks?"â–¼":"â–²")))}),D("click",g,O),o(a,ne),Dt(),_()}var Ml=f('<span class="slot-checkbox-x svelte-serp1j">&#8212;</span>'),Bl=f('<label><input type="checkbox" class="slot-checkbox-input svelte-serp1j"/> <span><!></span></label>');function Ga(a,r){Lt(r,!1);const t=()=>Ye(sa,"$isEditMode",d),[d,p]=At();let m=St(r,"checked",8,!1),k=St(r,"disabled",8,!1),M=St(r,"className",8,""),_=St(r,"index",8,void 0),P=St(r,"ariaLabel",8,void 0);const ce=qt();function z(be){ce("change",{checked:be.currentTarget.checked,index:_()})}wt();var U=Bl(),Ce=i(U);Le(Ce);var ve=s(Ce,2),Fe=i(ve);{var de=be=>{var ie=Ml();o(be,ie)};y(Fe,be=>{m()&&be(de)})}l(ve),l(U),E(()=>{ut(U,1,"slot-checkbox-label "+M()+(t()?"":" not-editable"),"svelte-serp1j"),Ss(Ce,m()),Ce.disabled=k()||!t(),at(Ce,"aria-label",P()),at(Ce,"tabindex",t()?0:-1),ut(ve,1,`slot-checkbox-custom ${m()?"used":""} ${t()?"":"readonly"}`,"svelte-serp1j")}),D("change",Ce,z),o(a,U),Dt(),p()}var Il=f('<p class="no-features svelte-1kpvv0n">Select a class to see available features</p>'),Rl=f('<p class="no-features svelte-1kpvv0n">No class features available at this level</p>'),El=f('<div class="spell-slots svelte-1kpvv0n"><label class="svelte-1kpvv0n"> </label> <div class="slots-tracker svelte-1kpvv0n"></div></div>'),Pl=f('<div class="all-spell-slots"></div>'),Tl=f('<div class="feature-box spellcasting svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"> </h3> <div class="spell-stats svelte-1kpvv0n"><div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Spell Save DC</label> <div class="spell-value svelte-1kpvv0n"> </div></div> <div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <div class="spell-value svelte-1kpvv0n"> </div></div></div> <!> <div class="prepared-spells svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <textarea placeholder="List your prepared spells..." class="svelte-1kpvv0n"></textarea></div></div>'),Hl=f('<p class="unlimited svelte-1kpvv0n">Unlimited Uses</p>'),Nl=f('<div class="slots-tracker svelte-1kpvv0n"></div> <div class="uses-actions-row"><button class="btn btn-primary use-enabled"> </button></div> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div>',1),Ul=f('<div class="uses-tracker svelte-1kpvv0n"><!></div>'),Gl=f('<div class="pool-tracker svelte-1kpvv0n"><input type="number" min="0" class="pool-input svelte-1kpvv0n"/> <span> </span> <button class="btn-small svelte-1kpvv0n"> </button></div>'),Ol=f('<p class="no-uses svelte-1kpvv0n">No Channel Divinity uses remaining</p>'),ql=f('<div class="channel-divinity-option svelte-1kpvv0n"><button class="btn btn-primary use-enabled svelte-1kpvv0n">Use Channel Divinity</button> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div> <!></div>'),Wl=f('<div class="feature-box svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"><!> </h3> <p class="feature-description svelte-1kpvv0n"> </p> <!></div>'),zl=f('<div class="features-grid svelte-1kpvv0n"><!> <!></div>'),Kl=f('<section><div class="header svelte-1kpvv0n"><h2 class="svelte-1kpvv0n">Class Features</h2> <button class="collapse-btn svelte-1kpvv0n"> </button></div> <!></section>');function Jl(a,r){Lt(r,!1);const t=()=>Ye(J,"$character",k),d=()=>Ye(na,"$abilityModifiers",k),p=()=>Ye(Gt,"$searchFilter",k),m=()=>Ye(kt,"$collapsedStates",k),[k,M]=At(),_=R(),P=R(),ce=R(),z=R(),U=R(),Ce=R(),ve=R();let Fe=R(0),de=R(0);function be(g,H){J.update(ge=>(ge.classFeatures.features[g]=H,ge))}function ie(){J.update(g=>(g.classFeatures.spellSlotsByLevel||(g.classFeatures.spellSlotsByLevel={}),e(z).forEach(({level:H,slots:ge})=>{g.classFeatures.spellSlotsByLevel[H]||(g.classFeatures.spellSlotsByLevel[H]=Array(ge).fill(!1))}),g))}function O(g){if(typeof g.maxUses=="function"){if((g.name==="Divine Sense"||g.name==="War Priest")&&e(_)?.spellcastingAbility){const H=d()[e(_).spellcastingAbility];return g.maxUses(t().level,H)}return g.maxUses(t().level)}return g.maxUses||0}function Ae(g,H){J.update(ge=>((!ge.classFeatures.features[g]||!Array.isArray(ge.classFeatures.features[g])||ge.classFeatures.features[g].length!==H)&&(ge.classFeatures.features[g]=Array(H).fill(!1)),ge))}as(()=>{e(Ce)&&t()&&t().classFeatures&&t().classFeatures.features&&e(Ce).forEach(g=>{if(g.type==="uses"){const H=g.name.replace(/\s+/g,""),ge=O(g),Ne=t().classFeatures.features[H];(!Array.isArray(Ne)||Ne.length!==ge)&&Ae(H,ge)}})});function ke(g){return typeof g.maxPool=="function"?g.maxPool(t().level):g.maxPool||0}function X(g){return typeof g.description=="function"?g.description(t().level):g.description}function q(){const g="ChannelDivinity";J.update(H=>{const ge=H.classFeatures.features[g];return typeof ge=="number"&&ge>0&&(H.classFeatures.features[g]=ge-1),H})}function ue(){kt.update(g=>({...g,classFeatures:!g.classFeatures}))}tt(()=>(t(),Ct),()=>{c(_,t().class?Ct(t().class):null)}),tt(()=>(t(),Vt),()=>{c(P,t().class?Vt(t().class,t().level,t().subclass):[])}),tt(()=>(t(),Ta),()=>{c(ce,t().class?Ta(t().class,t().level):0)}),tt(()=>(e(_),t()),()=>{c(z,(()=>{if(!e(_)?.spellcaster)return[];const g=t().level,H=[];return g>=1&&H.push({level:1,slots:Math.min(4,2+Math.floor(g/3))}),g>=3&&H.push({level:2,slots:Math.min(3,2+Math.floor((g-3)/4))}),g>=5&&H.push({level:3,slots:Math.min(3,2+Math.floor((g-5)/5))}),g>=7&&H.push({level:4,slots:Math.min(3,1+Math.floor((g-7)/6))}),g>=9&&H.push({level:5,slots:Math.min(2,1+Math.floor((g-9)/8))}),g>=11&&H.push({level:6,slots:1}),g>=13&&H.push({level:7,slots:1}),g>=15&&H.push({level:8,slots:1}),g>=17&&H.push({level:9,slots:1}),H})())}),tt(()=>(e(_),d(),t(),Ha),()=>{if(e(_)?.spellcaster&&e(_).spellcastingAbility){const g=d()[e(_).spellcastingAbility];c(Fe,ws(t().class,g,t().proficiencyBonus)||0),c(de,Ha(t().class,t().level,g))}}),tt(()=>(t(),e(_),e(z)),()=>{t().class&&e(_)?.spellcaster&&e(z).length>0&&ie()}),tt(()=>t(),()=>{c(U,(()=>{const H=t().classFeatures.features["ChannelDivinity"];return typeof H=="number"?H:0})())}),tt(()=>(e(P),p()),()=>{c(Ce,e(P).filter(g=>{if(!p())return!0;const H=p().toLowerCase();return g.name.toLowerCase().includes(H)||X(g).toLowerCase().includes(H)}))}),tt(()=>(p(),t(),e(Ce)),()=>{c(ve,!p()||t().class||"class features".includes(p().toLowerCase())||"spellcasting".includes(p().toLowerCase())||e(Ce).length>0)}),Ht(),wt();var Se=Kl();let _e;var He=i(Se),S=s(i(He),2),ne=i(S,!0);l(S),l(He);var pe=s(He,2);{var fe=g=>{var H=rt(),ge=Ke(H);{var Ne=C=>{var Z=Il();o(C,Z)},h=C=>{var Z=rt(),B=Ke(Z);{var K=re=>{var he=Rl();o(re,he)},Oe=re=>{var he=zl(),Ue=i(he);{var Re=F=>{var T=Tl(),j=i(T),u=i(j);l(j);var Ie=s(j,2),se=i(Ie),I=s(i(se),2),V=i(I,!0);l(I),l(se);var $=s(se,2),De=s(i($),2),je=i(De,!0);l(De),l($),l(Ie);var Ee=s(Ie,2);{var Je=ee=>{var we=Pl();ct(we,5,()=>e(z),vt,(Ge,qe)=>{let W=()=>e(qe).level,xe=()=>e(qe).slots;const We=it(()=>(t(),W(),xe(),n(()=>t().classFeatures.spellSlotsByLevel?.[W()]||Array(xe()).fill(!1))));var b=El(),w=i(b),le=i(w);l(w);var Q=s(w,2);ct(Q,5,()=>e(We),vt,(me,G,Y)=>{{let oe=it(()=>(N(e(We)),n(()=>e(We)[Y]||!1)));Ga(me,{get checked(){return e(oe)},$$events:{change:ze=>{J.update($e=>($e.classFeatures.spellSlotsByLevel||($e.classFeatures.spellSlotsByLevel={}),$e.classFeatures.spellSlotsByLevel[W()]||($e.classFeatures.spellSlotsByLevel[W()]=Array(xe()).fill(!1)),$e.classFeatures.spellSlotsByLevel[W()][Y]=ze.detail.checked,$e))}}})}}),l(Q),l(b),E(()=>x(le,`${W()===1?"1st":W()===2?"2nd":W()===3?"3rd":`${W()}th`} Level Spell Slots`)),o(Ge,b)}),l(we),o(ee,we)};y(Ee,ee=>{e(z),n(()=>e(z).length>0)&&ee(Je)})}var Ve=s(Ee,2),Pe=s(i(Ve),2);aa(Pe),l(Ve),l(T),E(ee=>{x(u,`Spellcasting (${ee??""})`),x(V,e(Fe)),x(je,e(de))},[()=>(e(_),n(()=>e(_).spellcastingAbility?.toUpperCase()))]),Be(Pe,()=>t().classFeatures.preparedSpells,ee=>nt(J,n(t).classFeatures.preparedSpells=ee,n(t))),o(F,T)};y(Ue,F=>{e(_),n(()=>e(_)?.spellcaster)&&F(Re)})}var lt=s(Ue,2);ct(lt,1,()=>e(Ce),vt,(F,T)=>{const j=it(()=>(e(T),n(()=>e(T).name.replace(/\s+/g,"")))),u=it(()=>(t(),N(e(j)),n(()=>t().classFeatures.features[e(j)]))),Ie=it(()=>typeof e(u)=="number");var se=Wl(),I=i(se),V=i(I);{var $=ee=>{var we=yt("Channel Divinity:");o(ee,we)};y(V,ee=>{e(T),n(()=>e(T).type==="channelDivinity")&&ee($)})}var De=s(V);l(I);var je=s(I,2),Ee=i(je,!0);l(je);var Je=s(je,2);{var Ve=ee=>{const we=it(()=>(e(T),n(()=>O(e(T))))),Ge=it(()=>(N(e(u)),N(e(we)),n(()=>Array.isArray(e(u))?e(u):Array(e(we)).fill(!1))));var qe=Ul(),W=i(qe);{var xe=b=>{var w=Hl();o(b,w)},We=b=>{var w=Nl(),le=Ke(w);ct(le,5,()=>e(Ge),vt,($e,Qe,v)=>{Ga($e,{get checked(){return e(Qe)},index:v,$$events:{change:te=>{J.update(L=>(L.classFeatures.features[e(j)]||(L.classFeatures.features[e(j)]=Array(e(we)).fill(!1)),L.classFeatures.features[e(j)][v]=te.detail.checked,L))}}})}),l(le);var Q=s(le,2),me=i(Q),G=i(me);l(me),l(Q);var Y=s(Q,2),oe=i(Y),ze=i(oe);l(oe),l(Y),E($e=>{me.disabled=$e,x(G,`Use ${e(T),n(()=>e(T).name)??""}`),x(ze,`Resets on ${e(T),n(()=>e(T).resetOn==="short"?"Short Rest":"Long Rest")??""}`)},[()=>(N(e(Ge)),n(()=>e(Ge).filter($e=>!$e).length<=0))]),D("click",me,()=>{J.update($e=>{$e.classFeatures.features[e(j)]||($e.classFeatures.features[e(j)]=Array(e(we)).fill(!1));const Qe=$e.classFeatures.features[e(j)],v=Qe.findIndex(te=>!te);return v!==-1&&(Qe[v]=!0),$e})}),o(b,w)};y(W,b=>{e(we)===1/0?b(xe):b(We,!1)})}l(qe),o(ee,qe)},Pe=ee=>{var we=rt(),Ge=Ke(we);{var qe=xe=>{const We=it(()=>(e(T),n(()=>ke(e(T)))));var b=Gl(),w=i(b);Le(w);var le=s(w,2),Q=i(le);l(le);var me=s(le,2),G=i(me,!0);l(me),l(b),E(()=>{Ba(w,e(Ie)&&e(u)!==void 0?e(u):e(We)),at(w,"max",e(We)),x(Q,`/ ${e(We)??""}`),x(G,(e(T),n(()=>e(T).resetOn==="short"?"Short Rest":"Long Rest")))}),D("input",w,Y=>{J.update(oe=>(oe.classFeatures.features[e(j)]=parseInt(Y.currentTarget.value)||0,oe))}),D("click",me,()=>be(e(j),e(We))),o(xe,b)},W=xe=>{var We=rt(),b=Ke(We);{var w=le=>{var Q=ql(),me=i(Q),G=s(me,2),Y=i(G),oe=i(Y);l(Y),l(G);var ze=s(G,2);{var $e=Qe=>{var v=Ol();o(Qe,v)};y(ze,Qe=>{e(U)<=0&&Qe($e)})}l(Q),E(()=>{me.disabled=e(U)<=0,x(oe,`Resets on ${e(T),n(()=>e(T).resetOn==="short"?"Short Rest":"Long Rest")??""}`)}),D("click",me,q),o(le,Q)};y(b,le=>{e(T),n(()=>e(T).type==="channelDivinity")&&le(w)},!0)}o(xe,We)};y(Ge,xe=>{e(T),n(()=>e(T).type==="pool")?xe(qe):xe(W,!1)},!0)}o(ee,we)};y(Je,ee=>{e(T),n(()=>e(T).type==="uses")?ee(Ve):ee(Pe,!1)})}l(se),E(ee=>{x(De,` ${e(T),n(()=>e(T).name)??""}`),x(Ee,ee)},[()=>(e(T),n(()=>X(e(T))))]),o(F,se)}),l(he),o(re,he)};y(B,re=>{e(P),n(()=>e(P).length===0)?re(K):re(Oe,!1)},!0)}o(C,Z)};y(ge,C=>{t(),n(()=>!t().class)?C(Ne):C(h,!1)})}o(g,H)};y(pe,g=>{m(),n(()=>!m().classFeatures)&&g(fe)})}l(Se),E(()=>{_e=ut(Se,1,"class-features svelte-1kpvv0n",null,_e,{hidden:!e(ve)}),at(S,"aria-label",(m(),n(()=>m().classFeatures?"Expand":"Collapse"))),x(ne,(m(),n(()=>m().classFeatures?"â–¼":"â–²")))}),D("click",S,ue),o(a,Se),Dt(),M()}var Vl=f('<textarea placeholder="Enter features, traits, and special abilities..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Equipment</h3> <textarea placeholder="List your equipment and inventory..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Notes</h3> <textarea placeholder="Additional notes..." class="svelte-wttn0l"></textarea>',1),Ql=f('<section><div class="header svelte-wttn0l"><h2 class="svelte-wttn0l">Features & Traits</h2> <button class="collapse-btn svelte-wttn0l"> </button></div> <!></section>');function Yl(a,r){Lt(r,!1);const t=()=>Ye(Gt,"$searchFilter",m),d=()=>Ye(J,"$character",m),p=()=>Ye(kt,"$collapsedStates",m),[m,k]=At(),M=R();function _(){kt.update(de=>({...de,notes:!de.notes}))}tt(()=>(t(),d()),()=>{c(M,!t()||"features".includes(t().toLowerCase())||"traits".includes(t().toLowerCase())||"equipment".includes(t().toLowerCase())||"notes".includes(t().toLowerCase())||d().features.toLowerCase().includes(t().toLowerCase())||d().equipment.toLowerCase().includes(t().toLowerCase())||d().notes.toLowerCase().includes(t().toLowerCase()))}),Ht(),wt();var P=Ql();let ce;var z=i(P),U=s(i(z),2),Ce=i(U,!0);l(U),l(z);var ve=s(z,2);{var Fe=de=>{var be=Vl(),ie=Ke(be);aa(ie);var O=s(ie,4);aa(O);var Ae=s(O,4);aa(Ae),Be(ie,()=>d().features,ke=>nt(J,n(d).features=ke,n(d))),Be(O,()=>d().equipment,ke=>nt(J,n(d).equipment=ke,n(d))),Be(Ae,()=>d().notes,ke=>nt(J,n(d).notes=ke,n(d))),o(de,be)};y(ve,de=>{p(),n(()=>!p().notes)&&de(Fe)})}l(P),E(()=>{ce=ut(P,1,"notes svelte-wttn0l",null,ce,{hidden:!e(M)}),at(U,"aria-label",(p(),n(()=>p().notes?"Expand":"Collapse"))),x(Ce,(p(),n(()=>p().notes?"â–¼":"â–²")))}),D("click",U,_),o(a,P),Dt(),k()}var Xl=f('<div class="color-picker-section svelte-1r90jgp"><h3 class="svelte-1r90jgp">Dice Colors</h3> <div class="color-inputs svelte-1r90jgp"><div class="color-input-group svelte-1r90jgp"><label for="dice-color" class="svelte-1r90jgp">Dice Color</label> <input type="color" id="dice-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="label-color" class="svelte-1r90jgp">Label Color</label> <input type="color" id="label-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="desk-color" class="svelte-1r90jgp">Background Color</label> <input type="color" id="desk-color" class="svelte-1r90jgp"/></div></div></div>'),Zl=f('<div class="loading svelte-1r90jgp"><p class="svelte-1r90jgp">Loading 3D dice...</p></div>'),ei=f('<div class="custom-dice-selector svelte-1r90jgp"><h3 class="svelte-1r90jgp">Choose Dice to Roll</h3> <div class="dice-inputs svelte-1r90jgp"><div class="dice-input-group svelte-1r90jgp"><label for="d4" class="svelte-1r90jgp">d4</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d4" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d6" class="svelte-1r90jgp">d6</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d6" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d8" class="svelte-1r90jgp">d8</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d8" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d10" class="svelte-1r90jgp">d10</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d10" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d12" class="svelte-1r90jgp">d12</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d12" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d20" class="svelte-1r90jgp">d20</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d20" min="0" max="10"/></div></div> <div class="dice-controls svelte-1r90jgp"><button class="btn btn-primary use-enabled svelte-1r90jgp"> </button> <button class="btn btn-secondary use-enabled svelte-1r90jgp">Reset</button></div></div>'),ti=f('<span class="crit-badge svelte-1r90jgp">CRITICAL!</span>'),ai=f('<p class="svelte-1r90jgp"> </p>'),si=f('<div class="bonus-item svelte-1r90jgp"><span class="bonus-value svelte-1r90jgp"> </span> <span class="bonus-source svelte-1r90jgp"> </span></div>'),li=f('<div class="bonus-breakdown svelte-1r90jgp"></div>'),ii=f('<p class="modifier-text svelte-1r90jgp"> </p>'),ni=f('<button class="btn btn-follow-up svelte-1r90jgp"> </button>'),ri=f('<button class="btn btn-guided-strike svelte-1r90jgp">âš¡ Use Guided Strike (+10)</button>'),oi=f('<div class="follow-up-actions svelte-1r90jgp"><!> <!></div>'),ci=f('<div class="result-header svelte-1r90jgp"><h3 class="svelte-1r90jgp"> </h3> <!></div> <div class="result-total svelte-1r90jgp"> </div> <div class="result-details svelte-1r90jgp"><!> <!></div> <!>',1),vi=f('<div role="button" tabindex="-1"><div class="modal-content svelte-1r90jgp" role="dialog" tabindex="0"><div class="modal-header svelte-1r90jgp"><h2 class="svelte-1r90jgp">Dice Roller</h2> <div class="header-buttons svelte-1r90jgp"><button class="color-btn svelte-1r90jgp" title="Customize dice colors">ðŸŽ¨</button> <button class="close-btn svelte-1r90jgp">Ã—</button></div></div> <!> <!> <div class="dice-main-area svelte-1r90jgp"><div class="dice-container svelte-1r90jgp"></div> <!></div> <div><!></div></div></div>');function di(a,r){Lt(r,!1);const t=()=>Ye(J,"$character",d),[d,p]=At(),m=R(),k=R(),M=R(),_=qt();let P=St(r,"notation",12,""),ce=St(r,"visible",8,!1),z=St(r,"damageNotation",12,""),U=St(r,"attackName",12,""),Ce=St(r,"applyHalfDamage",8,!1),ve=St(r,"bonusBreakdown",28,()=>[]),Fe=null,de=R(void 0),be=R(!1),ie=R(""),O=R(null);function Ae(){return e(O)?.resultTotal??null}let ke=R(0),X=R(0),q=R(0),ue=R(0),Se=R(0),_e=R(0),He=R(0),S=R([]),ne=R(!1),pe=R("other"),fe=R(!1),g=R("#051e0a"),H=R("#ffffff"),ge=R("#3a2004"),Ne=R(!1);function h(b){return b.length===9&&b.startsWith("#")?b.substring(0,7):b}function C(b,w="ff"){return b.length===7&&b.startsWith("#")?b+w:b}function Z(){if(window.DICE&&e(de))try{Fe&&e(de)&&Va(de,e(de).innerHTML="");const b=e(de).clientWidth||500,w=e(de).clientHeight||300;Fe=new window.DICE.dice_box(e(de),{w:b,h:w}),c(be,!0)}catch(b){console.error("Error initializing dice box:",b)}}ia(()=>{const b=Q=>new Promise((me,G)=>{if(document.querySelector(`script[src="${Q}"]`)){console.log(`Script already loaded: ${Q}`),me(null);return}const oe=document.createElement("script");oe.src=Q,oe.onload=()=>{console.log(`Loaded: ${Q}`),me(null)},oe.onerror=()=>{console.error(`Failed to load: ${Q}`),G(new Error(`Failed to load ${Q}`))},document.head.appendChild(oe)});setTimeout(()=>{b(`${ta}/libs/three.min.js`).then(()=>b(`${ta}/libs/cannon.min.js`)).then(()=>b(`${ta}/libs/teal.js`)).then(()=>b(`${ta}/dice.js`)).then(()=>{if(console.log("All scripts loaded, initializing dice box..."),console.log("DICE available:",!!window.DICE),console.log("Container available:",!!e(de)),window.DICE){const Q=window.DICE.getColors();c(g,h(Q.dice_color)),c(H,h(Q.label_color)),c(ge,h(Q.desk_color))}Z()}).catch(Q=>{console.error("Failed to load dice libraries:",Q)})},100);const w=()=>{e(be)&&(console.log("Window resized, reinitializing dice box..."),Z())},le=Q=>{ce()&&Q.key==="Escape"&&F()};return window.addEventListener("resize",w),window.addEventListener("keydown",le),()=>{window.removeEventListener("resize",w),window.removeEventListener("keydown",le)}});function B(b,w="other"){if(!Fe||!e(be))return;console.log("Rolling dice:",b,"type:",w),c(O,null),c(S,[]),c(ne,!1),w==="damage"&&ve([]),c(pe,w),c(fe,!1),Fe.diceToRoll=b;const le=me=>(console.log("Before roll:",me),null),Q=me=>{console.log("After roll:",me);let G=me.resultTotal,Y=me.resultString;if(Ce()&&(G=Math.floor(G/2),Y=Y+" (halved)"),c(O,{...me,resultTotal:G,resultString:Y}),w==="attack"||w==="check"||w==="save"){const oe=me.result?.filter(ze=>ze===20)||[];if(oe.length>0){const ze=oe[0];c(ne,ze===20)}}if(c(S,[]),console.log("Setting up follow-up actions. Type:",w,"damageNotation:",z(),"isCritical:",e(ne)),w==="attack")if(z()){if(e(ne)){const oe=re(z());console.log("Creating critical damage button:",oe),e(S).push({label:`Roll Critical Damage (${oe})`,notation:oe})}else console.log("Creating normal damage button:",z()),e(S).push({label:`Roll Damage (${z()})`,notation:z()});console.log("Follow-up actions after setup:",e(S))}else console.log("No damageNotation provided for attack roll");console.log("Final followUpActions:",e(S))};Fe.start_throw(le,Q)}function K(){const b=[];e(ke)>0&&b.push(`${e(ke)}d4`),e(X)>0&&b.push(`${e(X)}d6`),e(q)>0&&b.push(`${e(q)}d8`),e(ue)>0&&b.push(`${e(ue)}d10`),e(Se)>0&&b.push(`${e(Se)}d12`),e(_e)>0&&b.push(`${e(_e)}d20`);let w=b.join("+")||"1d20";return e(He)!==0&&(w+=e(He)>=0?`+${e(He)}`:`${e(He)}`),w}function Oe(){const b=K();B(b)}function re(b){return b.replace(/(\d+)d(\d+)/g,(w,le,Q)=>`${parseInt(le)*2}d${Q}`)}function he(){c(ke,0),c(X,0),c(q,0),c(ue,0),c(Se,0),c(_e,0),c(He,0),c(O,null),c(S,[]),c(ne,!1),c(pe,"other"),c(fe,!1)}function Ue(){window.DICE&&(window.DICE.setColors({dice_color:C(e(g),"ff"),label_color:C(e(H),"ff"),desk_color:e(ge)}),Fe&&(Fe.updateDeskColor(e(ge)),Fe.updateDiceColors()))}function Re(){c(Ne,!e(Ne))}function lt(){!e(O)||e(k)<=0||e(fe)||(c(O,{...e(O),resultTotal:e(O).resultTotal+10,resultString:e(O).resultString+" + 10 (Guided Strike)"}),J.update(b=>{const w="ChannelDivinity",le=b.classFeatures.features[w];return typeof le=="number"&&le>0&&(b.classFeatures.features[w]=le-1),b}),c(fe,!0))}function F(){_("close"),P(""),z(""),U(""),c(ie,""),c(O,null),c(fe,!1),he()}tt(()=>(t(),Vt),()=>{c(m,t().class?Vt(t().class,t().level,t().subclass).some(w=>w.name==="Guided Strike"):!1)}),tt(()=>t(),()=>{c(k,(()=>{const w=t().classFeatures.features["ChannelDivinity"];return typeof w=="number"?w:0})())}),tt(()=>(e(ke),e(X),e(q),e(ue),e(Se),e(_e),e(He)),()=>{c(M,(()=>{const b=[];e(ke)>0&&b.push(`${e(ke)}d4`),e(X)>0&&b.push(`${e(X)}d6`),e(q)>0&&b.push(`${e(q)}d8`),e(ue)>0&&b.push(`${e(ue)}d10`),e(Se)>0&&b.push(`${e(Se)}d12`),e(_e)>0&&b.push(`${e(_e)}d20`);let w=b.join("+")||"1d20";return e(He)!==0&&(w+=e(He)>=0?`+${e(He)}`:`${e(He)}`),w})())}),tt(()=>(N(P()),e(be),N(ce()),e(ie),N(z()),N(U())),()=>{if(P()&&e(be)&&ce()&&P()!==e(ie)){c(ie,P()),c(O,null),c(S,[]),c(ne,!1),c(fe,!1);const b=P().includes("1d20")?"attack":"other";console.log("Auto-roll triggered. notation:",P(),"damageNotation:",z(),"attackName:",U()),setTimeout(()=>B(P(),b),200)}}),Ht();var T={getLastRollTotal:Ae};wt();var j=vi();let u;var Ie=i(j),se=i(Ie),I=s(i(se),2),V=i(I),$=s(V,2);l(I),l(se);var De=s(se,2);{var je=b=>{var w=Xl(),le=s(i(w),2),Q=i(le),me=s(i(Q),2);Le(me),l(Q);var G=s(Q,2),Y=s(i(G),2);Le(Y),l(G);var oe=s(G,2),ze=s(i(oe),2);Le(ze),l(oe),l(le),l(w),Be(me,()=>e(g),$e=>c(g,$e)),D("change",me,Ue),Be(Y,()=>e(H),$e=>c(H,$e)),D("change",Y,Ue),Be(ze,()=>e(ge),$e=>c(ge,$e)),D("change",ze,Ue),o(b,w)};y(De,b=>{e(Ne)&&b(je)})}var Ee=s(De,2);{var Je=b=>{var w=Zl();o(b,w)};y(Ee,b=>{e(be)||b(Je)})}var Ve=s(Ee,2),Pe=i(Ve);Da(Pe,b=>c(de,b),()=>e(de));var ee=s(Pe,2);{var we=b=>{var w=ei(),le=s(i(w),2),Q=i(le),me=s(i(Q),2);Le(me),l(Q);var G=s(Q,2),Y=s(i(G),2);Le(Y),l(G);var oe=s(G,2),ze=s(i(oe),2);Le(ze),l(oe);var $e=s(oe,2),Qe=s(i($e),2);Le(Qe),l($e);var v=s($e,2),te=s(i(v),2);Le(te),l(v);var L=s(v,2),Te=s(i(L),2);Le(Te),l(L),l(le);var Ze=s(le,2),ae=i(Ze),A=i(ae);l(ae);var ye=s(ae,2);l(Ze),l(w),E(()=>{ae.disabled=!e(be),x(A,`Roll ${e(M)??""}`)}),Be(me,()=>e(ke),Me=>c(ke,Me)),Be(Y,()=>e(X),Me=>c(X,Me)),Be(ze,()=>e(q),Me=>c(q,Me)),Be(Qe,()=>e(ue),Me=>c(ue,Me)),Be(te,()=>e(Se),Me=>c(Se,Me)),Be(Te,()=>e(_e),Me=>c(_e,Me)),D("click",ae,Oe),D("click",ye,he),o(b,w)};y(ee,b=>{P()||b(we)})}l(Ve);var Ge=s(Ve,2);let qe;var W=i(Ge);{var xe=b=>{var w=ci(),le=Ke(w),Q=i(le),me=i(Q,!0);l(Q);var G=s(Q,2);{var Y=ae=>{var A=ti();o(ae,A)};y(G,ae=>{e(ne)&&ae(Y)})}l(le);var oe=s(le,2),ze=i(oe,!0);l(oe);var $e=s(oe,2),Qe=i($e);{var v=ae=>{var A=ai(),ye=i(A,!0);l(A),E(()=>x(ye,(e(O),n(()=>e(O).resultString)))),o(ae,A)};y(Qe,ae=>{e(O),n(()=>e(O).resultString)&&ae(v)})}var te=s(Qe,2);{var L=ae=>{var A=rt(),ye=Ke(A);{var Me=et=>{var st=li();ct(st,5,ve,vt,(jt,bt)=>{var It=si(),Rt=i(It),Qt=i(Rt);l(Rt);var ft=s(Rt,2),ht=i(ft);l(ft),l(It),E(()=>{x(Qt,`${e(bt),n(()=>e(bt).value>=0?"+":"")??""}${e(bt),n(()=>e(bt).value)??""}`),x(ht,`(${e(bt),n(()=>e(bt).source)??""})`)}),o(jt,It)}),l(st),o(et,st)},pt=et=>{var st=rt(),jt=Ke(st);{var bt=It=>{var Rt=ii(),Qt=i(Rt);l(Rt),E(()=>x(Qt,`Modifier: ${e(O),n(()=>e(O).constant>=0?"+":"")??""}${e(O),n(()=>e(O).constant)??""}`)),o(It,Rt)};y(jt,It=>{e(O),n(()=>e(O).constant)&&It(bt)},!0)}o(et,st)};y(ye,et=>{N(ve()),n(()=>ve().length>0)?et(Me):et(pt,!1)})}o(ae,A)};y(te,ae=>{e(O),N(ve()),n(()=>e(O).constant||ve().length>0)&&ae(L)})}l($e);var Te=s($e,2);{var Ze=ae=>{var A=oi(),ye=i(A);ct(ye,1,()=>e(S),vt,(et,st)=>{var jt=ni(),bt=i(jt,!0);l(jt),E(()=>x(bt,(e(st),n(()=>e(st).label)))),D("click",jt,()=>B(e(st).notation,"damage")),o(et,jt)});var Me=s(ye,2);{var pt=et=>{var st=ri();E(()=>{st.disabled=e(k)<=0,at(st,"title",e(k)<=0?"No Channel Divinity uses remaining":"Use Channel Divinity to add +10 to this attack roll")}),D("click",st,lt),o(et,st)};y(Me,et=>{e(m)&&e(pe)==="attack"&&!e(fe)&&et(pt)})}l(A),o(ae,A)};y(Te,ae=>{e(S),e(m),e(pe),e(fe),n(()=>e(S).length>0||e(m)&&e(pe)==="attack"&&!e(fe))&&ae(Ze)})}E(()=>{x(me,U()?`${U()} - Result`:"Result"),x(ze,(e(O),n(()=>e(O).resultTotal)))}),o(b,w)};y(W,b=>{e(O)&&b(xe)})}l(Ge),l(Ie),l(j),E(()=>{u=ut(j,1,"modal-overlay svelte-1r90jgp",null,u,{hidden:!ce()}),qe=ut(Ge,1,"roll-result svelte-1r90jgp",null,qe,{"has-result":e(O)})}),D("click",V,Re),D("click",$,F),D("click",Ie,Ra(function(b){Jt.call(this,r,b)})),D("keydown",Ie,function(b){Jt.call(this,r,b)}),D("click",j,F),D("keydown",j,b=>b.key==="Escape"&&F()),o(a,j),$s(r,"getLastRollTotal",Ae);var We=Dt(T);return p(),We}const ha="https://api.github.com/gists";async function ui(a,r,t){if(!r)throw new Error("GitHub token is required");const d=JSON.stringify(a,null,2),p=`${a.name||"character"}_dnd.json`,m={description:t||`D&D Character: ${a.name}`,public:!1,files:{[p]:{content:d}}},k=await fetch(ha,{method:"POST",headers:{Authorization:`token ${r}`,"Content-Type":"application/json"},body:JSON.stringify(m)});if(!k.ok)throw new Error(`Failed to create gist: ${k.statusText}`);return(await k.json()).id}async function pi(a,r,t){if(!r||!t)throw new Error("GitHub token and Gist ID are required");const d=JSON.stringify(a,null,2),m={files:{[`${a.name||"character"}_dnd.json`]:{content:d}}},k=await fetch(`${ha}/${t}`,{method:"PATCH",headers:{Authorization:`token ${r}`,"Content-Type":"application/json"},body:JSON.stringify(m)});if(!k.ok)throw new Error(`Failed to update gist: ${k.statusText}`)}async function fi(a,r){if(!a)throw new Error("Gist ID is required");const t={"Content-Type":"application/json"};r&&(t.Authorization=`token ${r}`);const d=await fetch(`${ha}/${a}`,{method:"GET",headers:t});if(!d.ok)throw new Error(`Failed to load gist: ${d.statusText}`);const p=await d.json(),m=Object.values(p.files);if(m.length===0)throw new Error("No files found in gist");const M=m[0].content;try{const _=JSON.parse(M);return _.attacks&&Array.isArray(_.attacks)&&(_.attacks=_.attacks.map(P=>({...P,id:P.id||crypto.randomUUID()}))),_.classFeatures?(_.classFeatures.features||(_.classFeatures.features={}),_.classFeatures.spellSlots||(_.classFeatures.spellSlots=[]),_.classFeatures.preparedSpells===void 0&&(_.classFeatures.preparedSpells="")):_.classFeatures={features:{},spellSlots:[],preparedSpells:""},_}catch{throw new Error("Invalid character data in gist")}}function Oa(a){typeof window<"u"&&localStorage.setItem("dnd_gist_config",JSON.stringify(a))}function gi(){if(typeof window<"u"){const a=localStorage.getItem("dnd_gist_config");if(a)return JSON.parse(a)}return{}}async function bi(a,r=30){if(!a)throw new Error("GitHub token is required to list gists");const t=await fetch(`${ha}?per_page=${r}`,{method:"GET",headers:{Authorization:`token ${a}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error(`Failed to list gists: ${t.statusText}`);return await t.json()}var hi=f('<div class="error-message svelte-1jb5ckg"> </div>'),mi=f('<div class="toggle-container svelte-1jb5ckg"><button type="button" class="toggle-btn svelte-1jb5ckg"> </button></div>'),_i=f('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID (leave empty to create new)</label> <input type="text" id="gistId" placeholder="Optional: existing Gist ID to update" class="svelte-1jb5ckg"/></div>'),yi=f('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),ki=f('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),Si=f('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Update (or leave unselected to create new)</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),xi=f('<div class="info-message svelte-1jb5ckg">No gists found. A new one will be created.</div>'),$i=f('<!> <div class="form-group svelte-1jb5ckg"><label for="description" class="svelte-1jb5ckg"> </label> <input type="text" id="description" placeholder="D&amp;D Character Sheet" class="svelte-1jb5ckg"/></div>',1),Ci=f('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID *</label> <input type="text" id="gistId" placeholder="Enter Gist ID (for public or your private gists)" required class="svelte-1jb5ckg"/></div>'),wi=f('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),Li=f('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),Di=f('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Load</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),ji=f('<div class="info-message svelte-1jb5ckg">No gists found. Enter a Gist ID manually or create a new one in Save mode.</div>'),Fi=f('<div class="modal-overlay svelte-1jb5ckg" role="button" tabindex="-1"><div class="modal-content svelte-1jb5ckg" role="dialog" tabindex="0"><div class="modal-header svelte-1jb5ckg"><h2 class="svelte-1jb5ckg"> </h2> <button class="close-btn svelte-1jb5ckg">Ã—</button></div> <div class="modal-body svelte-1jb5ckg"><!> <div class="form-group svelte-1jb5ckg"><label for="token" class="svelte-1jb5ckg"> <a href="https://github.com/settings/tokens" target="_blank" rel="noopener" class="svelte-1jb5ckg">Get token</a></label> <input type="password" id="token" placeholder="ghp_xxxxxxxxxxxxx" class="svelte-1jb5ckg"/></div> <!> <!> <div class="modal-actions svelte-1jb5ckg"><button class="btn btn-primary svelte-1jb5ckg"><!></button> <button class="btn btn-secondary svelte-1jb5ckg">Cancel</button></div></div></div></div>');function Ai(a,r){Lt(r,!1);const t=()=>Ye(J,"$character",d),[d,p]=At(),m=qt();let k=St(r,"mode",8,"save"),M=R(""),_=R(""),P=R(""),ce=R(!1),z=R(""),U=R(!1),Ce=R(!1),ve=R([]),Fe=R(null);const de=gi();de.token&&c(M,de.token),de.gistId&&c(_,de.gistId),ia(async()=>{e(M)&&!e(U)&&await be()});async function be(){if(e(M)){c(Ce,!0),c(z,"");try{c(ve,await bi(e(M))),e(_)&&c(Fe,e(ve).find(F=>F.id===e(_))||null)}catch(F){c(z,F.message||"Failed to load gists"),c(ve,[])}finally{c(Ce,!1)}}}function ie(F){c(Fe,F),c(_,F.id)}function O(){c(U,!e(U)),c(z,""),!e(U)&&e(M)&&be()}async function Ae(){if(!e(M)){c(z,"GitHub token is required");return}const F=e(Fe)?.id||e(_);c(ce,!0),c(z,"");try{if(F)await pi(t(),e(M),F),c(_,F),$t.add("Character updated in Gist successfully!","success");else{const T=await ui(t(),e(M),e(P));c(_,T),$t.add(`Character saved to Gist! ID: ${T}`,"success")}Oa({token:e(M),gistId:e(_)}),m("close")}catch(T){c(z,T.message||"Failed to save to Gist")}finally{c(ce,!1)}}async function ke(){const F=e(Fe)?.id||e(_);if(!F){c(z,"Please select a gist or enter a Gist ID");return}c(ce,!0),c(z,"");try{const T=await fi(F,e(M)||void 0);J.set(T),c(_,F),Oa({token:e(M),gistId:e(_)}),$t.add("Character loaded from Gist successfully!","success"),m("close")}catch(T){c(z,T.message||"Failed to load from Gist")}finally{c(ce,!1)}}function X(){m("close")}wt();var q=Fi(),ue=i(q),Se=i(ue),_e=i(Se),He=i(_e,!0);l(_e);var S=s(_e,2);l(Se);var ne=s(Se,2),pe=i(ne);{var fe=F=>{var T=hi(),j=i(T,!0);l(T),E(()=>x(j,e(z))),o(F,T)};y(pe,F=>{e(z)&&F(fe)})}var g=s(pe,2),H=i(g),ge=i(H);Qa(),l(H);var Ne=s(H,2);Le(Ne),l(g);var h=s(g,2);{var C=F=>{var T=mi(),j=i(T),u=i(j,!0);l(j),l(T),E(()=>{j.disabled=e(ce),x(u,e(U)?"ðŸ“‹ Show My Gists":"âœï¸ Enter Gist ID Manually")}),D("click",j,O),o(F,T)};y(h,F=>{(k()==="load"||k()==="save"&&e(M))&&F(C)})}var Z=s(h,2);{var B=F=>{var T=$i(),j=Ke(T);{var u=De=>{var je=_i(),Ee=s(i(je),2);Le(Ee),l(je),E(()=>Ee.disabled=e(ce)),Be(Ee,()=>e(_),Je=>c(_,Je)),o(De,je)},Ie=De=>{var je=rt(),Ee=Ke(je);{var Je=Pe=>{var ee=yi();o(Pe,ee)},Ve=Pe=>{var ee=rt(),we=Ke(ee);{var Ge=W=>{var xe=Si(),We=s(i(xe),2);ct(We,5,()=>e(ve),vt,(b,w)=>{var le=ki();let Q;var me=i(le),G=i(me),Y=i(G,!0);l(G);var oe=s(G,2),ze=i(oe,!0);l(oe),l(me);var $e=s(me,2),Qe=i($e),v=i(Qe);l(Qe);var te=s(Qe,2),L=i(te);l(te),l($e),l(le),E(Te=>{Q=ut(le,1,"gist-item svelte-1jb5ckg",null,Q,{selected:e(Fe)?.id===e(w).id}),le.disabled=e(ce),x(Y,(e(w),n(()=>e(w).description||"Untitled"))),x(ze,(e(w),n(()=>e(w).public?"ðŸŒ Public":"ðŸ”’ Private"))),x(v,`ID: ${e(w),n(()=>e(w).id)??""}`),x(L,`Updated: ${Te??""}`)},[()=>(e(w),n(()=>new Date(e(w).updated_at).toLocaleDateString()))]),D("click",le,()=>ie(e(w))),o(b,le)}),l(We),l(xe),o(W,xe)},qe=W=>{var xe=rt(),We=Ke(xe);{var b=w=>{var le=xi();o(w,le)};y(We,w=>{e(M)&&w(b)},!0)}o(W,xe)};y(we,W=>{e(ve),n(()=>e(ve).length>0)?W(Ge):W(qe,!1)},!0)}o(Pe,ee)};y(Ee,Pe=>{e(Ce)?Pe(Je):Pe(Ve,!1)},!0)}o(De,je)};y(j,De=>{e(U)||!e(M)?De(u):De(Ie,!1)})}var se=s(j,2),I=i(se),V=i(I);l(I);var $=s(I,2);Le($),l(se),E(()=>{x(V,`Description ${e(_)?"(optional)":""}`),$.disabled=e(ce)}),Be($,()=>e(P),De=>c(P,De)),o(F,T)},K=F=>{var T=rt(),j=Ke(T);{var u=se=>{var I=Ci(),V=s(i(I),2);Le(V),l(I),E(()=>V.disabled=e(ce)),Be(V,()=>e(_),$=>c(_,$)),o(se,I)},Ie=se=>{var I=rt(),V=Ke(I);{var $=je=>{var Ee=wi();o(je,Ee)},De=je=>{var Ee=rt(),Je=Ke(Ee);{var Ve=ee=>{var we=Di(),Ge=s(i(we),2);ct(Ge,5,()=>e(ve),vt,(qe,W)=>{var xe=Li();let We;var b=i(xe),w=i(b),le=i(w,!0);l(w);var Q=s(w,2),me=i(Q,!0);l(Q),l(b);var G=s(b,2),Y=i(G),oe=i(Y);l(Y);var ze=s(Y,2),$e=i(ze);l(ze),l(G),l(xe),E(Qe=>{We=ut(xe,1,"gist-item svelte-1jb5ckg",null,We,{selected:e(Fe)?.id===e(W).id}),xe.disabled=e(ce),x(le,(e(W),n(()=>e(W).description||"Untitled"))),x(me,(e(W),n(()=>e(W).public?"ðŸŒ Public":"ðŸ”’ Private"))),x(oe,`ID: ${e(W),n(()=>e(W).id)??""}`),x($e,`Updated: ${Qe??""}`)},[()=>(e(W),n(()=>new Date(e(W).updated_at).toLocaleDateString()))]),D("click",xe,()=>ie(e(W))),o(qe,xe)}),l(Ge),l(we),o(ee,we)},Pe=ee=>{var we=rt(),Ge=Ke(we);{var qe=W=>{var xe=ji();o(W,xe)};y(Ge,W=>{e(M)&&W(qe)},!0)}o(ee,we)};y(Je,ee=>{e(ve),n(()=>e(ve).length>0)?ee(Ve):ee(Pe,!1)},!0)}o(je,Ee)};y(V,je=>{e(Ce)?je($):je(De,!1)},!0)}o(se,I)};y(j,se=>{e(U)||!e(M)?se(u):se(Ie,!1)},!0)}o(F,T)};y(Z,F=>{k()==="save"?F(B):F(K,!1)})}var Oe=s(Z,2),re=i(Oe),he=i(re);{var Ue=F=>{var T=yt();E(()=>x(T,k()==="save"?"Saving...":"Loading...")),o(F,T)},Re=F=>{var T=yt();E(()=>x(T,k()==="save"?"Save":"Load")),o(F,T)};y(he,F=>{e(ce)?F(Ue):F(Re,!1)})}l(re);var lt=s(re,2);l(Oe),l(ne),l(ue),l(q),E(()=>{x(He,k()==="save"?"Save to GitHub Gist":"Load from GitHub Gist"),x(ge,`GitHub Token ${k()==="load"?"(optional for public gists)":"(required)"} `),Ne.disabled=e(ce),re.disabled=e(ce),lt.disabled=e(ce)}),D("click",S,X),Be(Ne,()=>e(M),F=>c(M,F)),D("blur",Ne,()=>{e(M)&&!e(U)&&be()}),D("click",re,function(...F){(k()==="save"?Ae:ke)?.apply(this,F)}),D("click",lt,X),D("click",ue,Ra(function(F){Jt.call(this,r,F)})),D("keydown",ue,function(F){Jt.call(this,r,F)}),D("click",q,X),D("keydown",q,F=>F.key==="Escape"&&X()),o(a,q),Dt(),p()}var Mi=f('<div class="loading svelte-1ngjemu">Loading D&D data...</div>'),Bi=f("<option> </option>"),Ii=f('<select class="level-filter svelte-1ngjemu"><option>All Levels</option><option>Cantrip</option><!></select>'),Ri=f('<div class="no-results svelte-1ngjemu"> </div>'),Ei=f('<div class="item-meta svelte-1ngjemu"> </div>'),Pi=f('<div class="item-meta svelte-1ngjemu"> </div>'),Ti=f('<button><div class="item-name svelte-1ngjemu"> </div> <!></button>'),Hi=f('<p class="higher-levels"><strong>At Higher Levels:</strong> </p>'),Ni=f('<p class="cantrip-upgrade"><strong>Cantrip Upgrade:</strong> </p>'),Ui=f('<h3 class="svelte-1ngjemu"> </h3> <p class="spell-meta svelte-1ngjemu"><!> <!></p> <p class="spell-classes"><strong>Classes:</strong> </p> <div class="spell-stats svelte-1ngjemu"><div><strong>Casting Time:</strong> </div> <div><strong>Range:</strong> </div> <div><strong>Components:</strong> <!></div> <div><strong>Duration:</strong> <!> </div></div> <p class="description svelte-1ngjemu"> </p> <!> <!>',1),Gi=f('<p class="prerequisite svelte-1ngjemu"><strong>Prerequisite:</strong> </p>'),Oi=f('<h3 class="svelte-1ngjemu"> </h3> <!> <p class="description svelte-1ngjemu"> </p> <a target="_blank" rel="noopener" class="source-link svelte-1ngjemu">View Full Details â†’</a>',1),qi=f('<div class="item-details svelte-1ngjemu"><!></div>'),Wi=f('<div class="controls svelte-1ngjemu"><div class="tabs svelte-1ngjemu"><button> </button> <button> </button></div> <div class="search-controls svelte-1ngjemu"><input type="text" placeholder="Search by name or description..." class="search-input svelte-1ngjemu"/> <!></div></div> <div class="content-container svelte-1ngjemu"><div class="items-list svelte-1ngjemu"><!></div> <!></div>',1),zi=f('<div class="modal-backdrop svelte-1ngjemu" role="presentation"><div class="modal svelte-1ngjemu" role="dialog" aria-modal="true" tabindex="-1"><div class="modal-header svelte-1ngjemu"><h2 class="svelte-1ngjemu">Browse D&D Spells & Feats</h2> <button class="close-btn svelte-1ngjemu" aria-label="Close">&times;</button></div> <div class="modal-body svelte-1ngjemu"><!></div> <div class="modal-footer svelte-1ngjemu"><button class="btn-secondary svelte-1ngjemu">Cancel</button> <button class="btn-primary svelte-1ngjemu">Add to Character Sheet</button></div></div></div>');function Ki(a,r){Lt(r,!1);const t=R(),d=R(),p=R();let m=St(r,"onClose",8),k=R("spell"),M=R(!0),_=R(""),P=R(null),ce=R([]),z=R([]),U=R(null);ia(async()=>{c(M,!0);try{c(ce,await es()),c(z,await Vs())}catch(S){console.error("Failed to load data:",S)}finally{c(M,!1)}});function Ce(S){c(U,S)}function ve(S){const ne=S.match(/(\d+d\d+(?:\s*\+\s*\d+)?)/i);return ne?ne[1]:""}function Fe(S){const ne=S.split(/\.( |$)/)[0].trim(),pe=Array.from(S.matchAll(/\*\*(.*?)\*\*/g)).map(g=>g[1].replace(/\.$/,""));let fe=ne;return pe.length&&(fe+=" | Effects: "+pe.join(", ")),fe}function de(){if(e(U)){if(e(k)==="spell"){const S=e(U);J.update(ne=>{const fe=[];S.range&&fe.push(`Range: ${S.range}`),S.castingTime&&fe.push(`Cast: ${S.castingTime}`),S.duration&&fe.push(`Duration: ${S.duration}`),S.actionType==="Save"&&fe.push("Saving throw spell"),S.components&&S.components.length>0&&fe.push(`Components: ${S.components.join(", ")}`),S.material&&fe.push(`Material: ${S.material}`);const g=fe.join(" | "),H=Fe(S.description),ge={id:crypto.randomUUID(),name:`${S.name}${S.concentration?" (C)":""}${S.ritual?" (R)":""}`,bonus:S.actionType==="Attack"?5:0,damage:ve(S.description),damageType:`${S.school} (Lvl ${S.level})`,spellRef:S.name,infoNotes:g,generalNotes:H,castAtLevel:S.level};return ne.attacks=[...ne.attacks,ge],ne})}else if(e(k)==="feat"){const S=e(U);J.update(ne=>{const pe=`${S.name}${S.prerequisite?` (Req: ${S.prerequisite})`:""}
${S.description}
`;return ne.features=ne.features?`${ne.features}
${pe}`:pe,ne})}c(U,null),m()()}}tt(()=>(e(P),e(ce),e(_)),()=>{c(t,e(P)!==null?Qs(Na(e(ce),e(_)),e(P)):Na(e(ce),e(_)))}),tt(()=>(e(z),e(_)),()=>{c(d,Ys(e(z),e(_)))}),tt(()=>(e(k),e(t),e(d)),()=>{c(p,e(k)==="spell"?e(t):e(d))}),Ht(),wt();var be=zi(),ie=i(be),O=i(ie),Ae=s(i(O),2);l(O);var ke=s(O,2),X=i(ke);{var q=S=>{var ne=Mi();o(S,ne)},ue=S=>{var ne=Wi(),pe=Ke(ne),fe=i(pe),g=i(fe);let H;var ge=i(g);l(g);var Ne=s(g,2);let h;var C=i(Ne);l(Ne),l(fe);var Z=s(fe,2),B=i(Z);Le(B);var K=s(B,2);{var Oe=j=>{var u=Ii();E(()=>{e(P),_t(()=>{})});var Ie=i(u);Ie.value=(Ie.__value=null)??"";var se=s(Ie);se.value=se.__value=0;var I=s(se);ct(I,0,()=>[1,2,3,4,5,6,7,8,9],vt,(V,$)=>{var De=Bi(),je=i(De);l(De);var Ee={};E(()=>{x(je,`Level ${$??""}`),Ee!==(Ee=$)&&(De.value=(De.__value=$)??"")}),o(V,De)}),l(u),Xa(u,()=>e(P),V=>c(P,V)),o(j,u)};y(K,j=>{e(k)==="spell"&&j(Oe)})}l(Z),l(pe);var re=s(pe,2),he=i(re),Ue=i(he);{var Re=j=>{var u=Ri(),Ie=i(u);l(u),E(()=>x(Ie,`No ${e(k)??""}s found`)),o(j,u)},lt=j=>{var u=rt(),Ie=Ke(u);ct(Ie,1,()=>e(p),vt,(se,I)=>{var V=Ti();let $;var De=i(V),je=i(De,!0);l(De);var Ee=s(De,2);{var Je=Pe=>{const ee=it(()=>e(I));var we=Ei(),Ge=i(we);l(we),E(()=>x(Ge,`Level ${N(e(ee)),n(()=>e(ee).level)??""} â€¢ ${N(e(ee)),n(()=>e(ee).school)??""}`)),o(Pe,we)},Ve=Pe=>{const ee=it(()=>e(I));var we=rt(),Ge=Ke(we);{var qe=W=>{var xe=Pi(),We=i(xe,!0);l(xe),E(()=>x(We,(N(e(ee)),n(()=>e(ee).prerequisite)))),o(W,xe)};y(Ge,W=>{N(e(ee)),n(()=>e(ee).prerequisite)&&W(qe)})}o(Pe,we)};y(Ee,Pe=>{e(k)==="spell"?Pe(Je):Pe(Ve,!1)})}l(V),E(()=>{$=ut(V,1,"item-card svelte-1ngjemu",null,$,{selected:e(U)?.name===e(I).name}),x(je,(e(I),n(()=>e(I).name)))}),D("click",V,()=>Ce(e(I))),o(se,V)}),o(j,u)};y(Ue,j=>{e(p),n(()=>e(p).length===0)?j(Re):j(lt,!1)})}l(he);var F=s(he,2);{var T=j=>{var u=qi(),Ie=i(u);{var se=V=>{const $=it(()=>e(U));var De=Ui(),je=Ke(De),Ee=i(je,!0);l(je);var Je=s(je,2),Ve=i(Je);{var Pe=A=>{var ye=yt();E(()=>x(ye,`${N(e($)),n(()=>e($).school)??""} cantrip`)),o(A,ye)},ee=A=>{var ye=yt();E(()=>x(ye,`Level ${N(e($)),n(()=>e($).level)??""} ${N(e($)),n(()=>e($).school)??""}`)),o(A,ye)};y(Ve,A=>{N(e($)),n(()=>e($).level===0)?A(Pe):A(ee,!1)})}var we=s(Ve,2);{var Ge=A=>{var ye=yt("(ritual)");o(A,ye)};y(we,A=>{N(e($)),n(()=>e($).ritual)&&A(Ge)})}l(Je);var qe=s(Je,2),W=s(i(qe));l(qe);var xe=s(qe,2),We=i(xe),b=s(i(We));l(We);var w=s(We,2),le=s(i(w));l(w);var Q=s(w,2),me=s(i(Q)),G=s(me);{var Y=A=>{var ye=yt();E(()=>x(ye,`(${N(e($)),n(()=>e($).material)??""})`)),o(A,ye)};y(G,A=>{N(e($)),n(()=>e($).material)&&A(Y)})}l(Q);var oe=s(Q,2),ze=s(i(oe),2);{var $e=A=>{var ye=yt("Concentration,");o(A,ye)};y(ze,A=>{N(e($)),n(()=>e($).concentration)&&A($e)})}var Qe=s(ze,1,!0);l(oe),l(xe);var v=s(xe,2),te=i(v,!0);l(v);var L=s(v,2);{var Te=A=>{var ye=Hi(),Me=s(i(ye));l(ye),E(()=>x(Me,` ${N(e($)),n(()=>e($).higherLevelSlot)??""}`)),o(A,ye)};y(L,A=>{N(e($)),n(()=>e($).higherLevelSlot)&&A(Te)})}var Ze=s(L,2);{var ae=A=>{var ye=Ni(),Me=s(i(ye));l(ye),E(()=>x(Me,` ${N(e($)),n(()=>e($).cantripUpgrade)??""}`)),o(A,ye)};y(Ze,A=>{N(e($)),n(()=>e($).cantripUpgrade)&&A(ae)})}E((A,ye)=>{x(Ee,(N(e($)),n(()=>e($).name))),x(W,` ${A??""}`),x(b,` ${N(e($)),n(()=>e($).castingTime||e($).actionType)??""}`),x(le,` ${N(e($)),n(()=>e($).range)??""}`),x(me,` ${ye??""}`),x(Qe,(N(e($)),n(()=>e($).duration))),x(te,(N(e($)),n(()=>e($).description)))},[()=>(N(e($)),n(()=>e($).classes.join(", "))),()=>(N(e($)),n(()=>e($).components.join(", ").toUpperCase()))]),o(V,De)},I=V=>{const $=it(()=>e(U));var De=Oi(),je=Ke(De),Ee=i(je,!0);l(je);var Je=s(je,2);{var Ve=Ge=>{var qe=Gi(),W=s(i(qe));l(qe),E(()=>x(W,` ${N(e($)),n(()=>e($).prerequisite)??""}`)),o(Ge,qe)};y(Je,Ge=>{N(e($)),n(()=>e($).prerequisite)&&Ge(Ve)})}var Pe=s(Je,2),ee=i(Pe,!0);l(Pe);var we=s(Pe,2);E(()=>{x(Ee,(N(e($)),n(()=>e($).name))),x(ee,(N(e($)),n(()=>e($).description))),at(we,"href",(N(e($)),n(()=>e($).source)))}),o(V,De)};y(Ie,V=>{e(k)==="spell"?V(se):V(I,!1)})}l(u),o(j,u)};y(F,j=>{e(U)&&j(T)})}l(re),E(()=>{H=ut(g,1,"tab svelte-1ngjemu",null,H,{active:e(k)==="spell"}),x(ge,`ðŸ“œ Spells (${e(ce),n(()=>e(ce).length)??""})`),h=ut(Ne,1,"tab svelte-1ngjemu",null,h,{active:e(k)==="feat"}),x(C,`â­ Feats (${e(z),n(()=>e(z).length)??""})`)}),D("click",g,()=>{c(k,"spell"),c(U,null),c(_,"")}),D("click",Ne,()=>{c(k,"feat"),c(U,null),c(_,"")}),Be(B,()=>e(_),j=>c(_,j)),o(S,ne)};y(X,S=>{e(M)?S(q):S(ue,!1)})}l(ke);var Se=s(ke,2),_e=i(Se),He=s(_e,2);l(Se),l(ie),l(be),E(()=>He.disabled=!e(U)),D("click",Ae,function(...S){m()?.apply(this,S)}),D("click",_e,function(...S){m()?.apply(this,S)}),D("click",He,de),D("click",ie,Ra(function(S){Jt.call(this,r,S)})),D("keydown",ie,function(S){Jt.call(this,r,S)}),D("click",be,function(...S){m()?.apply(this,S)}),D("keydown",be,S=>S.key==="Escape"&&m()()),o(a,be),Dt()}var Ji=f('<link rel="icon" type="image/png" href="favicon4.png"/> <meta name="viewport" content="width=device-width, initial-scale=1"/>',1),Vi=f('<span class="character-name svelte-1uha8ag"> </span>'),Qi=f("<span> </span>"),Yi=f('<div class="spell-slots-header svelte-1uha8ag"></div>'),Xi=f('<button class="effect-remove-btn svelte-1uha8ag">Ã—</button>'),Zi=f('<span class="effect-badge svelte-1uha8ag"> <!></span>'),en=f('<div class="active-effects-header svelte-1uha8ag"></div>'),tn=f('<div class="rest-menu svelte-1uha8ag"><button class="rest-option svelte-1uha8ag">â˜• Short Rest</button> <button class="rest-option svelte-1uha8ag">ðŸ›ï¸ Long Rest</button></div>'),an=f('<div class="container svelte-1uha8ag"><header class="svelte-1uha8ag"><div class="header-top svelte-1uha8ag"><div class="header-title svelte-1uha8ag"><div class="title-row svelte-1uha8ag"><h1 class="svelte-1uha8ag">D&D Character Sheet</h1> <!></div> <!> <!></div> <div class="header-right svelte-1uha8ag"><div class="header-controls svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">ðŸŽ²</span><span class="btn-text svelte-1uha8ag">Roll Dice</span></button> <div class="rest-button-container svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">ðŸ˜´</span><span class="btn-text svelte-1uha8ag">Rest</span></button> <!></div> <div class="mode-toggle"><button><span class="btn-icon svelte-1uha8ag"> </span><span class="btn-text svelte-1uha8ag"> </span></button></div></div> <div class="header-search svelte-1uha8ag"><input type="text" placeholder="ðŸ” Search..." class="search-input use-enabled svelte-1uha8ag"/></div></div></div> <div class="header-actions svelte-1uha8ag"><button class="btn btn-mode svelte-1uha8ag">ðŸ“š Browse Spells & Feats</button> <button class="btn btn-secondary">Save to Gist</button> <button class="btn btn-secondary">Load from Gist</button> <button class="btn btn-secondary">Export JSON</button> <button class="btn btn-secondary">Import JSON</button> <input type="file" accept=".json" style="display: none;"/></div></header> <main class="svelte-1uha8ag"><!> <!> <!> <!> <!> <!> <!></main></div> <!> <!> <!> <!>',1);function un(a,r){Lt(r,!1);const t=()=>Ye(J,"$character",m),d=()=>Ye(sa,"$isEditMode",m),p=()=>Ye(Gt,"$searchFilter",m),[m,k]=At();function M(){const v=[],te=t().classFeatures.spellSlotsByLevel||{};for(let L=1;L<=9;L++){const Te=te[L];if(Te&&Te.length>0){const Ze=Te.length,ae=Te.filter(A=>A).length;v.push({level:L,available:Ze-ae,total:Ze})}}return v}let _=R(!1),P=R(!1),ce=R(!1),z=R("save"),U=R(void 0),Ce=R(""),ve=R(""),Fe=R(""),de=R(!1),be=R([]),ie=R(),O=!1,Ae=R(!1);function ke(){const v=[];J.update(L=>{const Te=L.hitDice.current;L.hitDice.current=Math.min(L.hitDice.max,L.hitDice.current+Math.max(1,Math.floor(L.hitDice.max/2)));const Ze=L.hitDice.current-Te;if(Ze>0&&v.push(`${Ze} hit ${Ze===1?"die":"dice"}`),L.class){const ae=Vt(L.class,L.level,L.subclass);L.classFeatures.features||(L.classFeatures.features={}),ae.forEach(A=>{if(A.resetOn==="short"){const ye=A.name.replace(/\s+/g,"");if(A.type==="uses"){const Me=typeof A.maxUses=="function"?A.maxUses(L.level):A.maxUses;L.classFeatures.features[ye]=Array(Me).fill(!1),v.push(A.name)}else if(A.type==="pool"){const Me=typeof A.maxPool=="function"?A.maxPool(L.level):A.maxPool;Me!==void 0&&(L.classFeatures.features[ye]=Me,v.push(A.name))}}})}return L}),c(Ae,!1);const te=v.length>0?`Short rest taken! Restored: ${v.join(", ")}`:"Short rest taken!";$t.add(te,"success")}function X(){const v=[];J.update(L=>{const Te=L.maxHP-L.currentHP;Te>0&&v.push(`${Te} HP`),L.currentHP=L.maxHP,L.tempHP=0;const Ze=L.hitDice.max-L.hitDice.current;Ze>0&&v.push(`${Ze} hit ${Ze===1?"die":"dice"}`),L.hitDice.current=L.hitDice.max;let ae=0;if(L.classFeatures.spellSlotsByLevel&&Object.keys(L.classFeatures.spellSlotsByLevel).forEach(A=>{const ye=L.classFeatures.spellSlotsByLevel[parseInt(A)];if(ye){const Me=ye.filter(pt=>pt).length;ae+=Me,L.classFeatures.spellSlotsByLevel[parseInt(A)]=Array(ye.length).fill(!1)}}),ae>0&&v.push(`${ae} spell ${ae===1?"slot":"slots"}`),L.class){const A=Vt(L.class,L.level,L.subclass);L.classFeatures.features||(L.classFeatures.features={});let ye=!1;A.forEach(Me=>{const pt=Me.name.replace(/\s+/g,"");if(!(Me.type==="info"||Me.type==="channelDivinity")){if(Me.type==="uses"){const et=typeof Me.maxUses=="function"?Me.maxUses(L.level):Me.maxUses;L.classFeatures.features[pt]=Array(et).fill(!1),ye=!0}else if(Me.type==="pool"){const et=typeof Me.maxPool=="function"?Me.maxPool(L.level):Me.maxPool;et!==void 0&&(L.classFeatures.features[pt]=et,ye=!0)}}}),ye&&v.push("all class features")}return L}),c(Ae,!1);const te=v.length>0?`Long rest taken! Restored: ${v.join(", ")}`:"Long rest taken! Fully rested.";$t.add(te,"success")}function q(v){c(Ce,""),c(ve,""),c(Fe,""),c(de,!1),c(be,[]),O=!1,typeof v=="string"?c(Ce,v):(c(Ce,v.notation),c(ve,v.damageNotation||""),c(Fe,v.attackName||""),c(de,!!v.applyHalfDamage),c(be,v.bonusBreakdown||[])),c(_,!0)}function ue(v){const{notation:te}=v.detail;c(Ce,""),O=!0,setTimeout(()=>{c(Ce,te),c(ve,""),c(Fe,"Hit Die")},0),c(_,!0)}function Se(){if(c(_,!1),O&&e(ie)){const v=e(ie).getLastRollTotal();if(v!==null){const te=Math.max(1,v);J.update(L=>(L.hitDice.current=Math.max(0,L.hitDice.current-1),L.currentHP=Math.min(L.maxHP,L.currentHP+te),L))}O=!1}}function _e(){console.log("toggleMode called, current isEditMode:",d()),sa.update(v=>(console.log("Updating isEditMode from",v,"to",!v),!v))}function He(v){v.target.closest(".rest-button-container")||c(Ae,!1)}ia(()=>{console.log("onMount - initial isEditMode:",d()),console.log("onMount - body classes:",document.body.className);const v=sa.subscribe(te=>{console.log("isEditMode subscription triggered, value:",te),console.log("Body classes before:",document.body.className),te?(document.body.classList.remove("use-mode"),console.log("Removed use-mode class (Edit Mode)")):(document.body.classList.add("use-mode"),console.log("Added use-mode class (Use Mode)")),console.log("Body classes after:",document.body.className)});return document.addEventListener("click",He),()=>{v(),document.removeEventListener("click",He)}});function S(){bs(t())}function ne(){e(U)?.click()}async function pe(v){const L=v.target.files?.[0];if(L)try{const Te=await hs(L);J.set(Te),alert("Character imported successfully!")}catch{alert("Failed to import character file")}}wt();var fe=an();fs("1uha8ag",v=>{var te=Ji();Qa(2),za(()=>{ps.title="D&D Character Sheet"}),o(v,te)});var g=Ke(fe),H=i(g),ge=i(H),Ne=i(ge),h=i(Ne),C=s(i(h),2);{var Z=v=>{var te=Vi(),L=i(te);l(te),E(()=>x(L,`${t().name??""} (${t().level??""})`)),o(v,te)};y(C,v=>{t().name&&v(Z)})}l(h);var B=s(h,2);{var K=v=>{var te=Yi();ct(te,5,M,vt,(L,Te)=>{var Ze=Qi();let ae;var A=i(Ze);l(Ze),E(()=>{ae=ut(Ze,1,"slot-badge svelte-1uha8ag",null,ae,{depleted:e(Te).available===0}),x(A,`Lv${e(Te).level??""}: ${e(Te).available??""}/${e(Te).total??""}`)}),o(L,Ze)}),l(te),o(v,te)};y(B,v=>{M().length>0&&v(K)})}var Oe=s(B,2);{var re=v=>{var te=en();ct(te,5,()=>t().activeStates,vt,(L,Te,Ze)=>{var ae=Zi(),A=i(ae),ye=s(A);{var Me=pt=>{var et=Xi();E(()=>at(et,"title",`End ${e(Te).name??""}`)),D("click",et,()=>{J.update(st=>(st.activeStates&&(st.activeStates=st.activeStates.filter((jt,bt)=>bt!==Ze)),st))}),o(pt,et)};y(ye,pt=>{d()||pt(Me)})}l(ae),E(()=>{at(ae,"title",e(Te).description||`${e(Te).attackBonus>0?"+"+e(Te).attackBonus+" attack":""}${e(Te).damageBonus>0?(e(Te).attackBonus>0?", ":"")+"+"+e(Te).damageBonus+" damage":""}`),x(A,`âœ¨ ${e(Te).name??""} `)}),o(L,ae)}),l(te),o(v,te)};y(Oe,v=>{t().activeStates&&t().activeStates.length>0&&v(re)})}l(Ne);var he=s(Ne,2),Ue=i(he),Re=i(Ue),lt=s(Re,2),F=i(lt),T=s(F,2);{var j=v=>{var te=tn(),L=i(te),Te=s(L,2);l(te),D("click",L,ke),D("click",Te,X),o(v,te)};y(T,v=>{e(Ae)&&v(j)})}l(lt);var u=s(lt,2),Ie=i(u);let se;var I=i(Ie),V=i(I,!0);l(I);var $=s(I),De=i($,!0);l($),l(Ie),l(u),l(Ue);var je=s(Ue,2),Ee=i(je);Le(Ee),l(je),l(he),l(ge);var Je=s(ge,2),Ve=i(Je),Pe=s(Ve,2),ee=s(Pe,2),we=s(ee,2),Ge=s(we,2),qe=s(Ge,2);Da(qe,v=>c(U,v),()=>e(U)),l(Je),l(H);var W=s(H,2),xe=i(W);Bs(xe,{});var We=s(xe,2);qs(We,{$$events:{rollHitDice:ue}});var b=s(We,2);Ps(b,{$$events:{roll:v=>q(v.detail)}});var w=s(b,2);Js(w,{$$events:{roll:v=>q(v.detail)}});var le=s(w,2);Al(le,{$$events:{roll:v=>q(v.detail)}});var Q=s(le,2);Jl(Q,{});var me=s(Q,2);Yl(me,{}),l(W),l(g);var G=s(g,2);Da(di(G,{get notation(){return e(Ce)},get damageNotation(){return e(ve)},get attackName(){return e(Fe)},get applyHalfDamage(){return e(de)},get bonusBreakdown(){return e(be)},get visible(){return e(_)},$$events:{close:Se},$$legacy:!0}),v=>c(ie,v),()=>e(ie));var Y=s(G,2);{var oe=v=>{Ai(v,{get mode(){return e(z)},$$events:{close:()=>c(P,!1)}})};y(Y,v=>{e(P)&&v(oe)})}var ze=s(Y,2);{var $e=v=>{Ki(v,{onClose:()=>c(ce,!1)})};y(ze,v=>{e(ce)&&v($e)})}var Qe=s(ze,2);gs(Qe,{}),E(()=>{se=ut(Ie,1,"btn btn-mode svelte-1uha8ag",null,se,{"use-mode":!d()}),x(V,d()?"ðŸ“":"ðŸŽ²"),x(De,d()?"Edit Mode":"Use Mode")}),D("click",Re,()=>c(_,!0)),D("click",F,()=>c(Ae,!e(Ae))),D("click",Ie,_e),Be(Ee,p,v=>ms(Gt,v)),D("click",Ve,()=>c(ce,!0)),D("click",Pe,()=>{c(z,"save"),c(P,!0)}),D("click",ee,()=>{c(z,"load"),c(P,!0)}),D("click",we,S),D("click",Ge,ne),D("change",qe,pe),o(a,fe),Dt(),k()}export{un as component};
