import{d as rs,g as Bs,f as p,e as L,a as c,s as D,c as vt,t as Ht}from"../chunks/BESELRjb.js";import{i as Wt}from"../chunks/JMgyEzd3.js";import{c as ya,o as Ca,a as Rs,b as Ms}from"../chunks/CtPH092J.js";import{F as j,T as pa,Y as Xa,j as Fs,aZ as Ps,U as os,ag as Ts,aD as Is,aK as Es,aE as Us,a1 as Hs,av as Ta,a7 as ss,i as ys,a_ as Ns,a$ as xs,b0 as Oa,K as ma,e as ks,b1 as ws,b2 as Os,b3 as Gs,b4 as qs,q as Za,b5 as Ws,b6 as zs,ab as Ks,d as n,r as ls,g as Vs,C as zt,G as Kt,H as i,I as s,J as a,b7 as Ye,b8 as fa,s as r,a4 as $,f as e,m as mt,E as je,b9 as Pt,ao as Gt,A as z,ba as ga,bb as _a,bc as Js}from"../chunks/DyJ43TGI.js";import{t as Ys,c as ea,a as de,e as _t,i as wt,u as Ss,s as ha,b as jt,d as Fa,f as ba,g as Qs,j as qt,h as Xs,T as Zs,k as el,l as tl}from"../chunks/D6-WMxVZ.js";import{i as b,s as va,a as rt,b as Lt,d as La,e as al}from"../chunks/CCL4udNy.js";import{p as bt,b as Ra}from"../chunks/iXw84bXb.js";import{b as ja,r as sl}from"../chunks/rZpEbv05.js";function ll(l,o,t=!1,v=!1,u=!1){var f=l,m="";j(()=>{var k=Fs;if(m===(m=o()??"")){pa&&Xa();return}if(k.nodes_start!==null&&(Ps(k.nodes_start,k.nodes_end),k.nodes_start=k.nodes_end=null),m!==""){if(pa){os.data;for(var y=Xa(),w=y;y!==null&&(y.nodeType!==Ts||y.data!=="");)w=y,y=Is(y);if(y===null)throw Es(),Us;rs(os,w),f=Hs(y);return}var U=m+"";t?U=`<svg>${U}</svg>`:v&&(U=`<math>${U}</math>`);var F=Bs(U);if((t||v)&&(F=Ta(F)),rs(Ta(F),F.lastChild),t||v)for(;Ta(F);)f.before(Ta(F));else f.before(F)}})}function il(l,o,t,v,u){pa&&Xa();var f=o.$$slots?.[t],m=!1;f===!0&&(f=o[t],m=!0),f===void 0?u!==null&&u(l):f(l,m?()=>v:v)}function nl(l,o,t,v){var u=l.__style;if(pa||u!==o){var f=Ys(o);(!pa||f!==l.getAttribute("style"))&&(f==null?l.removeAttribute("style"):l.style.cssText=f),l.__style=o}return v}function Na(l,o,t=!1){if(l.multiple){if(o==null)return;if(!ys(o))return Ns();for(var v of l.options)v.selected=o.includes(Aa(v));return}for(v of l.options){var u=Aa(v);if(xs(u,o)){v.selected=!0;return}}(!t||o!==void 0)&&(l.selectedIndex=-1)}function es(l){var o=new MutationObserver(()=>{Na(l,l.__value)});o.observe(l,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),ss(()=>{o.disconnect()})}function Ma(l,o,t=o){var v=new WeakSet,u=!0;Oa(l,"change",f=>{var m=f?"[selected]":":checked",k;if(l.multiple)k=[].map.call(l.querySelectorAll(m),Aa);else{var y=l.querySelector(m)??l.querySelector("option:not([disabled])");k=y&&Aa(y)}t(k),ma!==null&&v.add(ma)}),ks(()=>{var f=o();if(l===document.activeElement){var m=ws??ma;if(v.has(m))return}if(Na(l,f,u),u&&f===void 0){var k=l.querySelector(":checked");k!==null&&(f=Aa(k),t(f))}l.__value=f,u=!1}),es(l)}function Aa(l){return"__value"in l?l.__value:l.value}const rl=Symbol("is custom element"),ol=Symbol("is html");function Ce(l){if(pa){var o=!1,t=()=>{if(!o){if(o=!0,l.hasAttribute("value")){var v=l.value;Je(l,"value",null),l.value=v}if(l.hasAttribute("checked")){var u=l.checked;Je(l,"checked",null),l.checked=u}}};l.__on_r=t,Za(t),Ws()}}function Ba(l,o){var t=is(l);t.value===(t.value=o??void 0)||l.value===o&&(o!==0||l.nodeName!=="PROGRESS")||(l.value=o??"")}function $s(l,o){var t=is(l);t.checked!==(t.checked=o??void 0)&&(l.checked=o)}function Je(l,o,t,v){var u=is(l);pa&&(u[o]=l.getAttribute(o),o==="src"||o==="srcset"||o==="href"&&l.nodeName==="LINK")||u[o]!==(u[o]=t)&&(o==="loading"&&(l[Os]=t),t==null?l.removeAttribute(o):typeof t!="string"&&cl(l).includes(o)?l[o]=t:l.setAttribute(o,t))}function is(l){return l.__attributes??={[rl]:l.nodeName.includes("-"),[ol]:l.namespaceURI===Gs}}var cs=new Map;function cl(l){var o=l.getAttribute("is")||l.nodeName,t=cs.get(o);if(t)return t;cs.set(o,t=[]);for(var v,u=l,f=Element.prototype;f!==u;){v=zs(u);for(var m in v)v[m].set&&t.push(m);u=qs(u)}return t}function Ie(l,o,t=o){var v=new WeakSet;Oa(l,"input",async u=>{var f=u?l.defaultValue:l.value;if(f=Ka(l)?Va(f):f,t(f),ma!==null&&v.add(ma),await Ks(),f!==(f=o())){var m=l.selectionStart,k=l.selectionEnd,y=l.value.length;if(l.value=f??"",k!==null){var w=l.value.length;m===k&&k===y&&w>y?(l.selectionStart=w,l.selectionEnd=w):(l.selectionStart=m,l.selectionEnd=Math.min(k,w))}}}),(pa&&l.defaultValue!==l.value||n(o)==null&&l.value)&&(t(Ka(l)?Va(l.value):l.value),ma!==null&&v.add(ma)),ls(()=>{var u=o();if(l===document.activeElement){var f=ws??ma;if(v.has(f))return}Ka(l)&&u===Va(l.value)||l.type==="date"&&!u&&!l.value||u!==l.value&&(l.value=u??"")})}const za=new Set;function vs(l,o,t,v,u=v){var f=t.getAttribute("type")==="checkbox",m=l;let k=!1;if(o!==null)for(var y of o)m=m[y]??=[];m.push(t),Oa(t,"change",()=>{var w=t.__value;f&&(w=ds(m,w,t.checked)),u(w)},()=>u(f?[]:null)),ls(()=>{var w=v();if(pa&&t.defaultChecked!==t.checked){k=!0;return}f?(w=w||[],t.checked=w.includes(t.__value)):t.checked=xs(t.__value,w)}),ss(()=>{var w=m.indexOf(t);w!==-1&&m.splice(w,1)}),za.has(m)||(za.add(m),Za(()=>{m.sort((w,U)=>w.compareDocumentPosition(U)===4?-1:1),za.delete(m)})),Za(()=>{if(k){var w;if(f)w=ds(m,w,t.checked);else{var U=m.find(F=>F.checked);w=U?.__value}u(w)}})}function wa(l,o,t=o){Oa(l,"change",v=>{var u=v?l.defaultChecked:l.checked;t(u)}),(pa&&l.defaultChecked!==l.checked||n(o)==null)&&t(l.checked),ls(()=>{var v=o();l.checked=!!v})}function ds(l,o,t){for(var v=new Set,u=0;u<l.length;u+=1)l[u].checked&&v.add(l[u].__value);return t||v.delete(o),Array.from(v)}function Ka(l){var o=l.type;return o==="number"||o==="range"}function Va(l){return l===""?null:+l}function vl(l,o,t){var v=Vs(l,o);v&&v.set&&(l[o]=t,ss(()=>{l[o]=null}))}function ns(l){return function(...o){var t=o[0];return t.stopPropagation(),l?.apply(this,o)}}function Sa(l,o){var t=l.$$events?.[o.type],v=ys(t)?t.slice():t==null?[]:[t];for(var u of v)u.call(this,o)}const dl="";function Cs(...l){return ja+dl+sl(l[0],l[1])}const ts={paladin:{name:"Paladin",hitDice:"d10",spellcaster:!0,spellcastingAbility:"charisma",spellSlotsByLevel:{1:0,2:2,3:3,4:3,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Divine Sense",type:"uses",maxUses:(l,o=1)=>1+Math.max(1,o),resetOn:"long",description:"Detect celestials, fiends, and undead within 60 feet",minLevel:1},{name:"Lay on Hands",type:"pool",maxPool:l=>l*5,resetOn:"long",description:"Heal wounds or cure disease",minLevel:1},{name:"Divine Smite",type:"spellSlot",description:"Expend spell slot to deal extra radiant damage",minLevel:2,rollable:!0},{name:"Channel Divinity",type:"pool",maxPool:l=>l>=18?3:l>=6?2:1,resetOn:"short",description:"Sacred Weapon or Turn Undead",minLevel:3}]},fighter:{name:"Fighter",hitDice:"d10",spellcaster:!1,features:[{name:"Second Wind",type:"uses",maxUses:1,resetOn:"short",description:"Regain 1d10 + fighter level HP as bonus action",minLevel:1,rollable:!0,rollFormula:l=>`1d10+${l}`},{name:"Action Surge",type:"uses",maxUses:l=>l>=17?2:1,resetOn:"short",description:"Take one additional action on your turn",minLevel:2},{name:"Indomitable",type:"uses",maxUses:l=>l>=17?3:l>=13?2:1,resetOn:"long",description:"Reroll a failed saving throw",minLevel:9}],subclasses:{champion:{name:"Champion",features:[{name:"Improved Critical",type:"info",description:"Critical hit on 19-20",minLevel:3},{name:"Remarkable Athlete",type:"info",description:"Add half proficiency to STR/DEX/CON checks, increase long jump distance",minLevel:7},{name:"Additional Fighting Style",type:"info",description:"Choose a second fighting style",minLevel:10},{name:"Superior Critical",type:"info",description:"Critical hit on 18-20",minLevel:15},{name:"Survivor",type:"info",description:"Regain 5 + CON mod HP at start of turn if below half HP",minLevel:18}]},battlemaster:{name:"Battle Master",features:[{name:"Combat Superiority",type:"uses",maxUses:l=>l>=15?6:l>=7?5:4,resetOn:"short",description:l=>`Use superiority dice (${l>=18?"d12":l>=10?"d10":"d8"}) for maneuvers`,minLevel:3},{name:"Know Your Enemy",type:"info",description:"Learn capabilities of creatures you observe",minLevel:7},{name:"Improved Combat Superiority",type:"info",description:"Superiority dice become d10",minLevel:10},{name:"Relentless",type:"info",description:"Regain 1 superiority die if you have none at start of turn",minLevel:15}]}}},rogue:{name:"Rogue",hitDice:"d8",spellcaster:!1,features:[{name:"Sneak Attack",type:"info",description:l=>`Deal ${Math.ceil(l/2)}d6 extra damage once per turn with advantage or ally nearby`,minLevel:1,rollable:!0,rollFormula:l=>`${Math.ceil(l/2)}d6`},{name:"Cunning Action",type:"info",description:"Dash, Disengage, or Hide as a bonus action",minLevel:2},{name:"Uncanny Dodge",type:"info",description:"Use reaction to halve damage from an attack",minLevel:5},{name:"Evasion",type:"info",description:"Take no damage on successful Dex save (half on fail)",minLevel:7}]},wizard:{name:"Wizard",hitDice:"d6",spellcaster:!0,spellcastingAbility:"intelligence",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Arcane Recovery",type:"uses",maxUses:1,resetOn:"long",description:l=>`Recover spell slots totaling up to ${Math.ceil(l/2)} levels during short rest`,minLevel:1},{name:"Spell Mastery",type:"info",description:"Cast one 1st-level and one 2nd-level spell at will",minLevel:18}]},cleric:{name:"Cleric",hitDice:"d8",spellcaster:!0,spellcastingAbility:"wisdom",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Channel Divinity",type:"pool",maxPool:l=>l>=18?3:l>=6?2:1,resetOn:"short",description:"Turn Undead or domain-specific ability",minLevel:2},{name:"Destroy Undead",type:"info",description:l=>`Channel Divinity destroys undead of CR ${l>=17?4:l>=14?3:l>=11?2:l>=8?1:.5} or lower`,minLevel:5},{name:"Divine Intervention",type:"uses",maxUses:1,resetOn:"long",description:l=>`${l}% chance to succeed, implore deity for aid`,minLevel:10}],subclasses:{war:{name:"War Domain",features:[{name:"War Priest",type:"uses",maxUses:(l,o=1)=>Math.max(1,o),resetOn:"long",description:"Make one weapon attack as a bonus action",minLevel:1},{name:"Guided Strike",type:"channelDivinity",description:"Use your Channel Divinity to gain +10 to an attack roll. Make this choice after you see the roll, but before the DM says whether the attack hits or misses.",minLevel:2,resetOn:"short"},{name:"War God's Blessing",type:"channelDivinity",description:"Use reaction to grant +10 to an ally's attack roll within 30 feet. Consumes one use of Channel Divinity.",minLevel:6,resetOn:"short"},{name:"Divine Strike",type:"info",description:l=>`Deal extra ${l>=14?"2d8":"1d8"} weapon damage once per turn`,minLevel:8,rollable:!0,rollFormula:l=>l>=14?"2d8":"1d8"},{name:"Avatar of Battle",type:"info",description:"Gain resistance to nonmagical weapon damage",minLevel:17}]},life:{name:"Life Domain",features:[{name:"Disciple of Life",type:"info",description:"Healing spells restore additional 2 + spell level HP",minLevel:1},{name:"Preserve Life",type:"pool",maxPool:l=>l*5,resetOn:"short",description:"Restore HP to creatures within 30 feet",minLevel:2},{name:"Blessed Healer",type:"info",description:"Regain 2 + spell level HP when you cast healing spell",minLevel:6},{name:"Divine Strike",type:"info",description:l=>`Deal extra ${l>=14?"2d8":"1d8"} radiant damage once per turn`,minLevel:8,rollable:!0,rollFormula:l=>l>=14?"2d8":"1d8"},{name:"Supreme Healing",type:"info",description:"Maximize healing dice instead of rolling",minLevel:17}]}}},barbarian:{name:"Barbarian",hitDice:"d12",spellcaster:!1,features:[{name:"Rage",type:"uses",maxUses:l=>l>=20?1/0:l>=17?6:l>=12?5:l>=6?4:l>=3?3:2,resetOn:"long",description:l=>`+${l>=16?4:l>=9?3:2} damage, resistance to physical damage`,minLevel:1},{name:"Reckless Attack",type:"info",description:"Gain advantage on melee attacks, enemies get advantage on you",minLevel:2},{name:"Danger Sense",type:"info",description:"Advantage on Dex saves against effects you can see",minLevel:2}],subclasses:{berserker:{name:"Path of the Berserker",features:[{name:"Frenzy",type:"info",description:"While raging, make melee attack as bonus action (gain 1 exhaustion after rage)",minLevel:3},{name:"Mindless Rage",type:"info",description:"Cannot be charmed or frightened while raging",minLevel:6},{name:"Intimidating Presence",type:"info",description:"Use action to frighten creature within 30 feet",minLevel:10},{name:"Retaliation",type:"info",description:"When damaged by creature within 5 feet, make melee attack as reaction",minLevel:14}]}}}};function aa(l){const o=l.toLowerCase();return ts[o]||null}function $a(l,o,t){const v=aa(l);if(!v)return[];const u=v.features.filter(f=>!f.minLevel||f.minLevel<=o);if(t&&v.subclasses&&v.subclasses[t]){const f=v.subclasses[t].features.filter(m=>!m.minLevel||m.minLevel<=o);return[...u,...f]}return u}function us(l){const o=aa(l);return!o||!o.subclasses?[]:Object.keys(o.subclasses).map(t=>({id:t,name:o.subclasses[t].name}))}function ps(l,o){const t=aa(l);return!t||!t.spellcaster||!t.spellSlotsByLevel?0:t.spellSlotsByLevel[o]||0}function fs(l,o,t){const v=aa(l);return!v||!v.spellcaster?0:Math.max(1,t+o)}function ul(l,o,t){const v=aa(l);return!v||!v.spellcaster?null:8+o+t}function pl(){return Object.keys(ts).map(l=>({id:l,name:ts[l].name}))}var fl=p('<div class="section-header svelte-ls99y2" role="button" tabindex="0"><h2 class="svelte-ls99y2"> </h2> <span class="collapse-btn svelte-ls99y2"> </span></div>');function xa(l,o){zt(o,!1);let t=bt(o,"title",8),v=bt(o,"collapsed",8),u=bt(o,"ariaLabel",8,""),f=bt(o,"onToggle",8);Wt();var m=fl(),k=i(m),y=i(k,!0);s(k);var w=a(k,2),U=i(w,!0);s(w),s(m),j(()=>{Je(m,"aria-expanded",!v()),Je(m,"aria-label",u()),D(y,t()),D(U,v()?"‚ñº":"‚ñ≤")}),L("click",m,function(...F){f()?.apply(this,F)}),L("keydown",m,F=>{(F.key==="Enter"||F.key===" ")&&f()()}),c(l,m),Kt()}var gl=p("<option> </option>"),ml=p("<option> </option>"),bl=p('<div class="form-group svelte-172i2fj"><label for="characterSubclass" class="svelte-172i2fj">Subclass</label> <select id="characterSubclass" class="svelte-172i2fj"><option>Select Subclass</option><!></select></div>'),hl=p('<div class="info-grid svelte-172i2fj"><div class="form-group svelte-172i2fj"><label for="characterName" class="svelte-172i2fj">Character Name</label> <input type="text" id="characterName" placeholder="Enter name" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterClass" class="svelte-172i2fj">Class</label> <select id="characterClass" class="svelte-172i2fj"><option>Select Class</option><!></select></div> <!> <div class="form-group svelte-172i2fj"><label for="characterLevel" class="svelte-172i2fj">Level</label> <input type="number" id="characterLevel" min="1" max="20" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterRace" class="svelte-172i2fj">Race</label> <input type="text" id="characterRace" placeholder="e.g., Human" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterBackground" class="svelte-172i2fj">Background</label> <input type="text" id="characterBackground" placeholder="e.g., Soldier" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterAlignment" class="svelte-172i2fj">Alignment</label> <input type="text" id="characterAlignment" placeholder="e.g., Lawful Good" class="svelte-172i2fj"/></div></div>'),_l=p('<section class="character-info svelte-172i2fj"><!> <!></section>');function yl(l,o){zt(o,!1);const t=()=>rt(de,"$character",u),v=()=>rt(ea,"$collapsedStates",u),[u,f]=va(),m=$(),k=pl();function y(Z){const E=Z.target;de.update(H=>(H.class=E.value,H.subclass="",H))}function w(Z){const E=Z.target;de.update(H=>(H.subclass=E.value,H))}function U(Z){const E=Z.target;de.update(H=>(H.level=parseInt(E.value)||1,H)),Ss()}Ye(()=>(t(),us),()=>{r(m,t().class?us(t().class):[])}),fa(),Wt();var F=_l(),re=i(F);{let Z=mt(()=>(v(),n(()=>v().characterInfo?"Expand":"Collapse")));xa(re,{title:"Character Info",get collapsed(){return v(),n(()=>v().characterInfo)},get ariaLabel(){return e(Z)},onToggle:()=>ea.update(E=>({...E,characterInfo:!E.characterInfo}))})}var be=a(re,2);{var ve=Z=>{var E=hl(),H=i(E),we=a(i(H),2);Ce(we),s(H);var Ee=a(H,2),ge=a(i(Ee),2),Fe=i(ge);Fe.value=Fe.__value="";var Qe=a(Fe);_t(Qe,1,()=>k,wt,(Ne,Ae)=>{var Be=gl(),ot=i(Be,!0);s(Be);var et={};j(()=>{D(ot,(e(Ae),n(()=>e(Ae).name))),et!==(et=(e(Ae),n(()=>e(Ae).id)))&&(Be.value=(Be.__value=(e(Ae),n(()=>e(Ae).id)))??"")}),c(Ne,Be)}),s(ge);var ue;es(ge),s(Ee);var De=a(Ee,2);{var Ue=Ne=>{var Ae=bl(),Be=a(i(Ae),2),ot=i(Be);ot.value=ot.__value="";var et=a(ot);_t(et,1,()=>e(m),wt,(ct,it)=>{var lt=ml(),ht=i(lt,!0);s(lt);var x={};j(()=>{D(ht,(e(it),n(()=>e(it).name))),x!==(x=(e(it),n(()=>e(it).id)))&&(lt.value=(lt.__value=(e(it),n(()=>e(it).id)))??"")}),c(ct,lt)}),s(Be);var ut;es(Be),s(Ae),j(()=>{ut!==(ut=(t(),n(()=>t().subclass)))&&(Be.value=(Be.__value=(t(),n(()=>t().subclass)))??"",Na(Be,(t(),n(()=>t().subclass))))}),L("change",Be,w),c(Ne,Ae)};b(De,Ne=>{e(m),n(()=>e(m).length>0)&&Ne(Ue)})}var B=a(De,2),P=a(i(B),2);Ce(P),s(B);var _=a(B,2),Y=a(i(_),2);Ce(Y),s(_);var g=a(_,2),R=a(i(g),2);Ce(R),s(g);var Q=a(g,2),He=a(i(Q),2);Ce(He),s(Q),s(E),j(()=>{ue!==(ue=(t(),n(()=>t().class)))&&(ge.value=(ge.__value=(t(),n(()=>t().class)))??"",Na(ge,(t(),n(()=>t().class)))),Ba(P,(t(),n(()=>t().level)))}),Ie(we,()=>t().name,Ne=>Lt(de,n(t).name=Ne,n(t))),L("change",ge,y),L("change",P,U),Ie(Y,()=>t().race,Ne=>Lt(de,n(t).race=Ne,n(t))),Ie(R,()=>t().background,Ne=>Lt(de,n(t).background=Ne,n(t))),Ie(He,()=>t().alignment,Ne=>Lt(de,n(t).alignment=Ne,n(t))),c(Z,E)};b(be,Z=>{v(),n(()=>!v().characterInfo)&&Z(ve)})}s(F),c(l,F),Kt(),f()}var xl=p('<div class="ability-card svelte-bbv1xt"><h3 class="svelte-bbv1xt"> </h3> <input type="number" class="ability-score svelte-bbv1xt" min="1" max="30"/> <div class="ability-modifier svelte-bbv1xt"> </div> <div class="roll-buttons svelte-bbv1xt"><button class="roll-btn svelte-bbv1xt">Check</button> <button class="roll-btn svelte-bbv1xt">Save</button></div> <div class="save-proficiency svelte-bbv1xt"><input type="checkbox" class="svelte-bbv1xt"/> <label class="svelte-bbv1xt">Save Prof.</label></div></div>'),kl=p('<div class="proficiency-bonus svelte-bbv1xt"><label for="profBonus">Proficiency Bonus</label> <input type="number" id="profBonus" class="prof-input svelte-bbv1xt"/></div> <div class="abilities-grid svelte-bbv1xt"></div>',1),wl=p("<section><!> <!></section>");function Sl(l,o){zt(o,!1);const t=()=>rt(Fa,"$abilityModifiers",k),v=()=>rt(de,"$character",k),u=()=>rt(ha,"$searchFilter",k),f=()=>rt(ea,"$collapsedStates",k),m=()=>rt(ba,"$isEditMode",k),[k,y]=va(),w=$(),U=$(),F=ya(),re=[{key:"strength",label:"Strength"},{key:"dexterity",label:"Dexterity"},{key:"constitution",label:"Constitution"},{key:"intelligence",label:"Intelligence"},{key:"wisdom",label:"Wisdom"},{key:"charisma",label:"Charisma"}];function be(){Ss()}function ve(Fe){const Qe=t()[Fe],ue=`1d20${Qe>=0?"+":""}${Qe}`,De=[];De.push({value:"1d20",source:"base die"}),Qe!==0&&De.push({value:Qe,source:Fe}),F("roll",{notation:ue,rollType:"check",bonusBreakdown:De})}function Z(Fe){const Qe=t()[Fe],ue=v().saveProficiencies[Fe]?v().proficiencyBonus:0,De=Qe+ue,Ue=`1d20${De>=0?"+":""}${De}`,B=[];B.push({value:"1d20",source:"base die"}),Qe!==0&&B.push({value:Qe,source:Fe}),ue!==0&&B.push({value:ue,source:"proficiency"}),F("roll",{notation:Ue,rollType:"save",bonusBreakdown:B})}Ye(()=>u(),()=>{r(w,re.filter(({label:Fe})=>u()?Fe.toLowerCase().includes(u().toLowerCase()):!0))}),Ye(()=>(e(w),u()),()=>{r(U,e(w).length>0||!u()||u().toLowerCase().includes("proficiency"))}),fa(),Wt();var E=wl();let H;var we=i(E);xa(we,{title:"Ability Scores",get collapsed(){return f(),n(()=>f().abilityScores)},ariaLabel:"Toggle Ability Scores Section",onToggle:()=>ea.update(Fe=>({...Fe,abilityScores:!Fe.abilityScores}))});var Ee=a(we,2);{var ge=Fe=>{var Qe=kl(),ue=je(Qe),De=a(i(ue),2);Ce(De),s(ue);var Ue=a(ue,2);_t(Ue,5,()=>e(w),wt,(B,P)=>{let _=()=>e(P).key,Y=()=>e(P).label;var g=xl(),R=i(g),Q=i(R,!0);s(R);var He=a(R,2);Ce(He);var Ne=a(He,2),Ae=i(Ne);s(Ne);var Be=a(Ne,2),ot=i(Be),et=a(ot,2);s(Be);var ut=a(Be,2),ct=i(ut);Ce(ct);var it=a(ct,2);s(ut),s(g),j(lt=>{D(Q,lt),D(Ae,`${t(),_(),n(()=>t()[_()]>=0?"+":"")??""}${t(),_(),n(()=>t()[_()])??""}`),ct.disabled=!m(),Je(ct,"id",`${_()}-save`),Je(it,"for",`${_()}-save`)},[()=>(Y(),n(()=>Y().substring(0,3).toUpperCase()))]),Ie(He,()=>v().abilities[_()],lt=>Lt(de,n(v).abilities[_()]=lt,n(v))),L("change",He,be),L("click",ot,()=>ve(_())),L("click",et,()=>Z(_())),wa(ct,()=>v().saveProficiencies[_()],lt=>Lt(de,n(v).saveProficiencies[_()]=lt,n(v))),c(B,g)}),s(Ue),Ie(De,()=>v().proficiencyBonus,B=>Lt(de,n(v).proficiencyBonus=B,n(v))),c(Fe,Qe)};b(Ee,Fe=>{f(),n(()=>!f().abilityScores)&&Fe(ge)})}s(E),j(()=>H=jt(E,1,"ability-scores svelte-bbv1xt",null,H,{hidden:!e(U)})),c(l,E),Kt(),y()}const Ds=[{name:"Unarmored",type:"none",baseAC:10},{name:"Padded",type:"light",baseAC:11},{name:"Leather",type:"light",baseAC:11},{name:"Studded Leather",type:"light",baseAC:12},{name:"Hide",type:"medium",baseAC:12,maxDexBonus:2},{name:"Chain Shirt",type:"medium",baseAC:13,maxDexBonus:2},{name:"Scale Mail",type:"medium",baseAC:14,maxDexBonus:2},{name:"Breastplate",type:"medium",baseAC:14,maxDexBonus:2},{name:"Half Plate",type:"medium",baseAC:15,maxDexBonus:2},{name:"Ring Mail",type:"heavy",baseAC:14,maxDexBonus:0},{name:"Chain Mail",type:"heavy",baseAC:16,maxDexBonus:0},{name:"Splint",type:"heavy",baseAC:17,maxDexBonus:0},{name:"Plate",type:"heavy",baseAC:18,maxDexBonus:0}];function Ls(l){return Ds.find(o=>o.name===l)}function $l(l,o,t){if(!l)return 10+o+(t?2:0);const v=Ls(l);if(!v)return 10+o+(t?2:0);let u=v.baseAC;return v.maxDexBonus===void 0?u+=o:v.maxDexBonus>0&&(u+=Math.min(o,v.maxDexBonus)),t&&(u+=2),u}function Pa(l){return Math.floor((l-10)/2)}function as(l,o){if(!l.class)return null;const t=aa(l.class);if(!t||!t.spellcaster||!t.spellcastingAbility)return null;const v=Pa(o[t.spellcastingAbility]);return 8+l.proficiencyBonus+v}function gs(l,o){if(!l.class)return 0;const t=aa(l.class);return!t||!t.spellcaster||!t.spellcastingAbility?0:Pa(o[t.spellcastingAbility])}function Cl(l,o){const t=[],v=Pa(o.dexterity),u=l.armorName?Ls(l.armorName):void 0;if(u){if(u.type==="none")t.push("Unarmored"),t.push("Base: 10"),t.push(`Dexterity: ${v>=0?"+":""}${v}`);else if(u.type==="light")t.push(`${u.name}: ${u.baseAC}`),t.push(`Dexterity: ${v>=0?"+":""}${v}`);else if(u.type==="medium"){const f=Math.min(2,v);t.push(`${u.name}: ${u.baseAC}`),t.push(`Dexterity: ${f>=0?"+":""}${f} (max +2)`)}else u.type==="heavy"&&(t.push(`${u.name}: ${u.baseAC}`),t.push("Dexterity: +0 (heavy armor)"));l.shieldEquipped&&t.push("Shield: +2")}else{t.push("Base: 10"),v!==0&&t.push(`Dexterity: ${v>=0?"+":""}${v}`);const f=10+v,m=l.armorClass-f;m!==0&&t.push(`Other: ${m>=0?"+":""}${m}`)}return l.activeStates&&l.activeStates.length>0&&l.activeStates.forEach(f=>{typeof f.acBonus=="number"&&f.acBonus!==0&&(!f.target||f.target==="self")&&t.push(`${f.name}: ${f.acBonus>=0?"+":""}${f.acBonus}`)}),t.join(`
`)}function Dl(l,o){const t=[],v=Pa(o.dexterity);t.push(`Dexterity: ${v>=0?"+":""}${v}`);const u=l.initiative-v;return u!==0&&t.push(`Other Bonuses: ${u>=0?"+":""}${u}`),t.join(`
`)}function Ll(l,o){if(!l.class)return"";const t=aa(l.class);if(!t||!t.spellcaster||!t.spellcastingAbility)return"";const v=[],u=Pa(o[t.spellcastingAbility]),f=t.spellcastingAbility.charAt(0).toUpperCase()+t.spellcastingAbility.slice(1);return v.push("Base: 8"),v.push(`Proficiency: +${l.proficiencyBonus}`),v.push(`${f}: ${u>=0?"+":""}${u}`),v.join(`
`)}var jl=p('<button class="info-icon svelte-1o8ci7b" type="button">‚ÑπÔ∏è</button>'),Al=p('<button class="info-icon svelte-1o8ci7b" type="button">‚ÑπÔ∏è</button>'),Bl=p("<div><!></div>"),Rl=p('<div class="tooltip-wrapper svelte-1o8ci7b"><!> <!></div>');function Ja(l,o){zt(o,!1);let t=bt(o,"tooltipContent",8),v=bt(o,"ariaLabel",8,"Show information"),u=$(!1),f=$(),m=$(!1),k=$(null),y=$(!1),w=$(!1),U=$("");const F=Math.random().toString(36).slice(2);function re(){window.dispatchEvent(new CustomEvent("tooltip-open",{detail:F}))}function be(B){B.detail!==F&&(r(u,!1),r(y,!1))}function ve(){r(m,window.matchMedia("(pointer: coarse)").matches||"ontouchstart"in window)}function Z(){if(!e(k)||!e(f))return;const B=e(f).getBoundingClientRect(),P=e(k).getBoundingClientRect();let _=B.bottom+5,Y=B.left;r(y,!1),Y+P.width>window.innerWidth-8&&(Y=B.right-P.width,r(y,!0),Y<8&&(Y=8)),Y<8&&(Y=8),_+P.height>window.innerHeight-8&&(_=B.top-P.height-5),r(U,`position:fixed;top:${_}px;left:${Y}px;z-index:1000;`),r(w,!0)}function E(){re(),r(u,!1),r(w,!1),requestAnimationFrame(()=>{r(u,!0),r(w,!1),setTimeout(Z,0)})}function H(){r(u,!1),r(y,!1)}function we(B){B.stopPropagation(),e(u)?(r(u,!1),r(y,!1),r(w,!1)):(re(),r(u,!1),r(w,!1),requestAnimationFrame(()=>{r(u,!0),r(w,!1),setTimeout(Z,0)}))}function Ee(B){e(f)&&!e(f).contains(B.target)&&(r(u,!1),r(y,!1))}Ca(()=>{ve(),document.addEventListener("click",Ee),window.addEventListener("tooltip-open",be)}),Rs(()=>{document.removeEventListener("click",Ee),window.removeEventListener("tooltip-open",be)}),Wt();var ge=Rl(),Fe=i(ge);{var Qe=B=>{var P=jl();j(()=>Je(P,"aria-label",v())),L("click",P,we),c(B,P)},ue=B=>{var P=Al();j(()=>Je(P,"aria-label",v())),L("mouseenter",P,E),L("mouseleave",P,H),c(B,P)};b(Fe,B=>{e(m)?B(Qe):B(ue,!1)})}var De=a(Fe,2);{var Ue=B=>{var P=Bl(),_=i(P);il(_,o,"content",{},Y=>{var g=vt(),R=je(g);ll(R,t),c(Y,g)}),s(P),Ra(P,Y=>r(k,Y),()=>e(k)),j(()=>{jt(P,1,`tooltip-popup ${e(y)?"right-align":""}`,"svelte-1o8ci7b"),nl(P,e(w)?e(U)+"opacity:1;pointer-events:auto;":"opacity:0;pointer-events:none;position:fixed;top:0;left:0;z-index:1000;")}),c(B,P)};b(De,B=>{e(u)&&B(Ue)})}s(ge),Ra(ge,B=>r(f,B),()=>e(f)),c(l,ge),Kt()}var Ml=p("<option> </option>"),Fl=p('<div class="armor-config svelte-1r5hyyb"><h4 class="svelte-1r5hyyb">Armor Configuration</h4> <div class="armor-controls svelte-1r5hyyb"><div class="armor-field svelte-1r5hyyb"><label for="armorName" class="svelte-1r5hyyb">Armor</label> <select id="armorName" class="armor-select svelte-1r5hyyb"><option>None (Unarmored)</option><!></select></div> <div class="armor-field svelte-1r5hyyb"><label class="shield-label svelte-1r5hyyb"><input type="checkbox" class="shield-checkbox svelte-1r5hyyb"/> Shield Equipped (+2 AC)</label></div></div></div>'),Pl=p('<div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="spellSaveDC" class="svelte-1r5hyyb">Spell Save DC</label> <!></div> <input type="number" id="spellSaveDC" class="stat-input svelte-1r5hyyb" readonly=""/></div>'),Tl=p('<span class="hit-dice-type"> </span>'),Il=p('<!> <div class="stats-grid svelte-1r5hyyb"><div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="armorClass" class="svelte-1r5hyyb">Armor Class</label> <!></div> <input type="text" id="armorClass" readonly=""/></div> <div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="initiative" class="svelte-1r5hyyb">Initiative</label> <!></div> <input type="text" id="initiative" class="stat-input svelte-1r5hyyb" readonly=""/></div> <div class="stat-box svelte-1r5hyyb"><label for="speed" class="svelte-1r5hyyb">Speed</label> <input type="text" id="speed" class="stat-input svelte-1r5hyyb"/></div> <!></div> <div class="hp-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Points</h3> <div><div class="hp-inputs svelte-1r5hyyb"><input type="number" class="hp-current svelte-1r5hyyb" min="0"/> <span class="hp-separator svelte-1r5hyyb">/</span> <input type="number" class="hp-max svelte-1r5hyyb" min="0"/></div> <div class="hp-controls svelte-1r5hyyb"><button class="hp-btn svelte-1r5hyyb">‚àí</button> <button class="hp-btn svelte-1r5hyyb">+</button> <button class="hp-btn svelte-1r5hyyb">‚àí5</button> <button class="hp-btn svelte-1r5hyyb">+5</button></div></div> <div class="temp-hp svelte-1r5hyyb"><label for="tempHP" class="svelte-1r5hyyb">Temp HP</label> <input type="number" id="tempHP" min="0" class="svelte-1r5hyyb"/></div></div> <div class="hit-dice-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Dice</h3> <div class="hit-dice-display svelte-1r5hyyb"><input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <span>/</span> <input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <!></div> <div class="hit-dice-controls svelte-1r5hyyb"><label for="hitDiceCount" class="svelte-1r5hyyb">Roll</label> <div class="hit-dice-count-controls svelte-1r5hyyb"><button class="hit-dice-btn svelte-1r5hyyb">‚àí</button> <input type="number" id="hitDiceCount" class="hit-dice-count-input svelte-1r5hyyb" min="1"/> <button class="hit-dice-btn svelte-1r5hyyb">+</button></div> <button class="btn btn-primary roll-hit-dice use-enabled svelte-1r5hyyb">üé≤ Roll</button></div></div>',1),El=p("<section><!> <!></section>");function Ul(l,o){zt(o,!1);const t=()=>rt(de,"$character",k),v=()=>rt(Fa,"$abilityModifiers",k),u=()=>rt(ha,"$searchFilter",k),f=()=>rt(ea,"$collapsedStates",k),m=()=>rt(ba,"$isEditMode",k),[k,y]=va(),w=$(),U=$(),F=$(),re=$(),be=$(),ve=$(),Z=$(),E=ya();let H=$(1);function we(B){de.update(P=>(P.currentHP=Math.max(0,Math.min(P.maxHP,P.currentHP+B)),P))}function Ee(B){const P=e(H)+B,_=t().hitDice.current;r(H,Math.max(1,Math.min(_,P)))}function ge(B=1){if(t().hitDice.current<=0){alert("No hit dice remaining!");return}if(!t().class){alert("Please select a class first!");return}const P=aa(t().class);if(!P){alert("Invalid class configuration!");return}const _=Math.min(B,t().hitDice.current),Y=P.hitDice,g=v().constitution,R=g*_,Q=R>=0?`+${R}`:`${R}`,He=`${_}${Y}${Q}`,Ne=[];if(Ne.push({value:`${_}${Y}`,source:"hit dice"}),g!==0)for(let Ae=0;Ae<_;Ae++)Ne.push({value:g,source:"constitution"});E("rollHitDice",{notation:He,hitDie:Y,count:_,bonusBreakdown:Ne})}Ye(()=>(t(),v(),de),()=>{if(t().armorName!==void 0||t().shieldEquipped!==void 0){const B=v().dexterity,P=$l(t().armorName,B,t().shieldEquipped||!1);t().armorClass!==P&&de.update(_=>({..._,armorClass:P}))}}),Ye(()=>(v(),t(),de),()=>{const B=v().dexterity;t().initiative!==B&&de.update(P=>({...P,initiative:B}))}),Ye(()=>t(),()=>{r(w,as(t(),t().abilities))}),Ye(()=>t(),()=>{r(U,Cl(t(),t().abilities))}),Ye(()=>t(),()=>{r(F,Dl(t(),t().abilities))}),Ye(()=>t(),()=>{r(re,Ll(t(),t().abilities))}),Ye(()=>(t(),e(H)),()=>{const B=t().hitDice.current;B>0&&e(H)>B&&r(H,B)}),Ye(()=>t(),()=>{r(be,t().activeStates&&t().activeStates.length>0?t().activeStates.reduce((B,P)=>B+(P.acBonus||0),0):0)}),Ye(()=>t(),()=>{r(ve,t().activeStates&&t().activeStates.length>0?t().activeStates.some(B=>B.name==="Aid"&&B.target==="self"):!1)}),Ye(()=>u(),()=>{r(Z,!u()||"armor class".includes(u().toLowerCase())||"initiative".includes(u().toLowerCase())||"speed".includes(u().toLowerCase())||"hit points".includes(u().toLowerCase())||"hp".includes(u().toLowerCase())||"hit dice".includes(u().toLowerCase())||"spell save".includes(u().toLowerCase())||"combat".includes(u().toLowerCase()))}),fa(),Wt();var Fe=El();let Qe;var ue=i(Fe);{let B=mt(()=>(f(),n(()=>f().combatStats?"Expand":"Collapse")));xa(ue,{title:"Combat Stats",get collapsed(){return f(),n(()=>f().combatStats)},get ariaLabel(){return e(B)},onToggle:()=>ea.update(P=>({...P,combatStats:!P.combatStats}))})}var De=a(ue,2);{var Ue=B=>{var P=Il(),_=je(P);{var Y=le=>{var Te=Fl(),fe=a(i(Te),2),h=i(fe),V=a(i(h),2);j(()=>{t(),Pt(()=>{})});var ie=i(V);ie.value=(ie.__value=void 0)??"";var ne=a(ie);_t(ne,1,()=>Ds,wt,(J,Me)=>{var ke=vt(),tt=je(ke);{var nt=gt=>{var ft=Ml(),st=i(ft);s(ft);var N={};j(()=>{D(st,`${e(Me),n(()=>e(Me).name)??""} (AC ${e(Me),n(()=>e(Me).baseAC)??""})`),N!==(N=(e(Me),n(()=>e(Me).name)))&&(ft.value=(ft.__value=(e(Me),n(()=>e(Me).name)))??"")}),c(gt,ft)};b(tt,gt=>{e(Me),n(()=>e(Me).name!=="Unarmored")&&gt(nt)})}c(J,ke)}),s(V),s(h);var q=a(h,2),te=i(q),Pe=i(te);Ce(Pe),Gt(),s(te),s(q),s(fe),s(Te),Ma(V,()=>t().armorName,J=>Lt(de,n(t).armorName=J,n(t))),wa(Pe,()=>t().shieldEquipped,J=>Lt(de,n(t).shieldEquipped=J,n(t))),c(le,Te)};b(_,le=>{m()&&le(Y)})}var g=a(_,2),R=i(g),Q=i(R),He=a(i(Q),2);Ja(He,{get tooltipContent(){return e(U)},ariaLabel:"Show AC breakdown"}),s(Q);var Ne=a(Q,2);Ce(Ne),s(R);var Ae=a(R,2),Be=i(Ae),ot=a(i(Be),2);Ja(ot,{get tooltipContent(){return e(F)},ariaLabel:"Show Initiative breakdown"}),s(Be);var et=a(Be,2);Ce(et),s(Ae);var ut=a(Ae,2),ct=a(i(ut),2);Ce(ct),s(ut);var it=a(ut,2);{var lt=le=>{var Te=Pl(),fe=i(Te),h=a(i(fe),2);Ja(h,{get tooltipContent(){return e(re)},ariaLabel:"Show Spell Save DC breakdown"}),s(fe);var V=a(fe,2);Ce(V),s(Te),j(()=>Ba(V,e(w))),c(le,Te)};b(it,le=>{e(w)!==null&&le(lt)})}s(g);var ht=a(g,2),x=a(i(ht),2);let O;var T=i(x),S=i(T);Ce(S);var I=a(S,4);Ce(I),s(T);var ee=a(T,2),he=i(ee),Le=a(he,2),oe=a(Le,2),_e=a(oe,2);s(ee),s(x);var K=a(x,2),A=a(i(K),2);Ce(A),s(K),s(ht);var Se=a(ht,2),Oe=a(i(Se),2),Re=i(Oe);Ce(Re);var Xe=a(Re,4);Ce(Xe);var se=a(Xe,2);{var d=le=>{const Te=mt(()=>(z(aa),t(),n(()=>aa(t().class))));var fe=vt(),h=je(fe);{var V=ie=>{const ne=mt(()=>(v(),n(()=>v().constitution)));var q=Tl(),te=i(q);s(q),j(()=>D(te,`(${z(e(Te)),n(()=>e(Te).hitDice)??""}${(e(ne)>=0?`+${e(ne)}`:e(ne))??""})`)),c(ie,q)};b(h,ie=>{e(Te)&&ie(V)})}c(le,fe)};b(se,le=>{t(),n(()=>t().class)&&le(d)})}s(Oe);var ye=a(Oe,2),pe=a(i(ye),2),G=i(pe),$e=a(G,2);Ce($e);var ce=a($e,2);s(pe);var xe=a(pe,2);s(ye),s(Se),j(()=>{Ba(Ne,(e(be),t(),n(()=>e(be)!==0?`${t().armorClass} ‚Üí ${t().armorClass+e(be)}`:`${t().armorClass}`))),jt(Ne,1,Qs(e(be)!==0?"stat-input ac-enhanced":"stat-input"),"svelte-1r5hyyb"),Ba(et,(t(),n(()=>t().initiative))),O=jt(x,1,"hp-display svelte-1r5hyyb",null,O,{"aid-active":e(ve)}),Je(S,"max",(t(),n(()=>t().maxHP))),Je(Re,"max",(t(),n(()=>t().hitDice.max))),G.disabled=e(H)<=1,Je($e,"max",(t(),n(()=>t().hitDice.current))),ce.disabled=(e(H),t(),n(()=>e(H)>=t().hitDice.current)),xe.disabled=(t(),n(()=>t().hitDice.current<=0||!t().class))}),Ie(ct,()=>t().speed,le=>Lt(de,n(t).speed=le,n(t))),Ie(S,()=>t().currentHP,le=>Lt(de,n(t).currentHP=le,n(t))),Ie(I,()=>t().maxHP,le=>Lt(de,n(t).maxHP=le,n(t))),L("click",he,()=>we(-1)),L("click",Le,()=>we(1)),L("click",oe,()=>we(-5)),L("click",_e,()=>we(5)),Ie(A,()=>t().tempHP,le=>Lt(de,n(t).tempHP=le,n(t))),Ie(Re,()=>t().hitDice.current,le=>Lt(de,n(t).hitDice.current=le,n(t))),Ie(Xe,()=>t().hitDice.max,le=>Lt(de,n(t).hitDice.max=le,n(t))),L("click",G,()=>Ee(-1)),Ie($e,()=>e(H),le=>r(H,le)),L("input",$e,le=>{const Te=le.target,fe=parseInt(Te.value);fe>t().hitDice.current&&r(H,t().hitDice.current),fe<1&&r(H,1)}),L("click",ce,()=>Ee(1)),L("click",xe,()=>ge(e(H))),c(B,P)};b(De,B=>{f(),n(()=>!f().combatStats)&&B(Ue)})}s(Fe),j(()=>Qe=jt(Fe,1,"combat-stats svelte-1r5hyyb",null,Qe,{hidden:!e(Z)})),c(l,Fe),Kt(),y()}const Ia={acrobatics:"dexterity",animalHandling:"wisdom",arcana:"intelligence",athletics:"strength",deception:"charisma",history:"intelligence",insight:"wisdom",intimidation:"charisma",investigation:"intelligence",medicine:"wisdom",nature:"intelligence",perception:"wisdom",performance:"charisma",persuasion:"charisma",religion:"intelligence",sleightOfHand:"dexterity",stealth:"dexterity",survival:"wisdom"};var Hl=p('<div class="skill-row svelte-1f1pl16"><input type="checkbox" class="svelte-1f1pl16"/> <label class="svelte-1f1pl16"> <span class="ability-tag svelte-1f1pl16"> </span></label> <span class="skill-modifier svelte-1f1pl16"> </span> <button class="roll-btn svelte-1f1pl16">Roll</button></div>'),Nl=p('<div class="skills-grid svelte-1f1pl16"></div>'),Ol=p("<section><!> <!></section>");function Gl(l,o){zt(o,!1);const t=()=>rt(de,"$character",k),v=()=>rt(Fa,"$abilityModifiers",k),u=()=>rt(ha,"$searchFilter",k),f=()=>rt(ea,"$collapsedStates",k),m=()=>rt(ba,"$isEditMode",k),[k,y]=va(),w=$(),U=$(),F=$(),re=$(),be=$(),ve=$(),Z=ya(),E=[{key:"acrobatics",label:"Acrobatics"},{key:"animalHandling",label:"Animal Handling"},{key:"arcana",label:"Arcana"},{key:"athletics",label:"Athletics"},{key:"deception",label:"Deception"},{key:"history",label:"History"},{key:"insight",label:"Insight"},{key:"intimidation",label:"Intimidation"},{key:"investigation",label:"Investigation"},{key:"medicine",label:"Medicine"},{key:"nature",label:"Nature"},{key:"perception",label:"Perception"},{key:"performance",label:"Performance"},{key:"persuasion",label:"Persuasion"},{key:"religion",label:"Religion"},{key:"sleightOfHand",label:"Sleight of Hand"},{key:"stealth",label:"Stealth"},{key:"survival",label:"Survival"}];function H(ue){const De=Ia[ue],Ue=v()[De],B=t().skillProficiencies[ue]?t().proficiencyBonus:0,P=e(w)[ue],_=`1d20${P>=0?"+":""}${P}`,Y=[];Y.push({value:"1d20",source:"base die"}),Ue!==0&&Y.push({value:Ue,source:De}),B!==0&&Y.push({value:B,source:"proficiency"}),Z("roll",{notation:_,rollType:"check",bonusBreakdown:Y})}Ye(()=>{},()=>{r(w,{})}),Ye(()=>t(),()=>{r(U,t().skillProficiencies)}),Ye(()=>t(),()=>{r(F,t().proficiencyBonus)}),Ye(()=>v(),()=>{r(re,v())}),Ye(()=>(e(re),e(U),e(F)),()=>{for(const{key:ue}of E){const De=Ia[ue],Ue=e(re)[De],B=e(U)[ue]?e(F):0;ga(w,e(w)[ue]=Ue+B)}}),Ye(()=>u(),()=>{r(be,E.filter(({label:ue})=>u()?ue.toLowerCase().includes(u().toLowerCase()):!0))}),Ye(()=>e(be),()=>{r(ve,e(be).length>0)}),fa(),Wt();var we=Ol();let Ee;var ge=i(we);{let ue=mt(()=>(f(),n(()=>f().skills?"Expand":"Collapse")));xa(ge,{title:"Skills",get collapsed(){return f(),n(()=>f().skills)},get ariaLabel(){return e(ue)},onToggle:()=>ea.update(De=>({...De,skills:!De.skills}))})}var Fe=a(ge,2);{var Qe=ue=>{var De=Nl();_t(De,5,()=>e(be),wt,(Ue,B)=>{let P=()=>e(B).key,_=()=>e(B).label;var Y=Hl(),g=i(Y);Ce(g);var R=a(g,2),Q=i(R),He=a(Q),Ne=i(He);s(He),s(R);var Ae=a(R,2),Be=i(Ae);s(Ae);var ot=a(Ae,2);s(Y),j(et=>{$s(g,(e(U),P(),n(()=>e(U)[P()]))),g.disabled=!m(),Je(g,"id",P()),Je(R,"for",P()),D(Q,`${_()??""} `),D(Ne,`(${et??""})`),D(Be,`${e(w),P(),n(()=>e(w)[P()]>=0?"+":"")??""}${e(w),P(),n(()=>e(w)[P()])??""}`)},[()=>(z(Ia),P(),n(()=>Ia[P()].substring(0,3).toUpperCase()))]),L("change",g,et=>{console.log("Skill proficiency changed:",P(),et.target.checked),de.update(ut=>({...ut,skillProficiencies:{...ut.skillProficiencies,[P()]:et.target.checked}}))}),L("click",ot,()=>H(P())),c(Ue,Y)}),s(De),c(ue,De)};b(Fe,ue=>{f(),n(()=>!f().skills)&&ue(Qe)})}s(we),j(()=>Ee=jt(we,1,"skills svelte-1f1pl16",null,Ee,{hidden:!e(ve)})),c(l,we),Kt(),y()}var ql=p('<p class="empty-message svelte-1123ljy">No attacks or spells to reorder.</p>'),Wl=p('<li class="reorder-item svelte-1123ljy"><span class="attack-name svelte-1123ljy"> </span> <div class="reorder-buttons svelte-1123ljy"><button class="btn-move svelte-1123ljy" aria-label="Move up">‚ñ≤</button> <button class="btn-move svelte-1123ljy" aria-label="Move down">‚ñº</button></div></li>'),zl=p('<ul class="reorder-list svelte-1123ljy"></ul>'),Kl=p('<div class="modal-backdrop svelte-1123ljy" role="presentation"><div class="modal-content svelte-1123ljy" role="dialog" aria-modal="true" aria-labelledby="modal-title"><div class="modal-header svelte-1123ljy"><h3 id="modal-title" class="svelte-1123ljy">Reorder Attacks & Spells</h3> <button class="btn-close svelte-1123ljy" aria-label="Close">√ó</button></div> <div class="modal-body svelte-1123ljy"><!></div> <div class="modal-footer svelte-1123ljy"><button class="btn btn-secondary svelte-1123ljy">Cancel</button> <button class="btn btn-primary svelte-1123ljy">Save Order</button></div></div></div>');function Vl(l,o){zt(o,!1);let t=bt(o,"show",8,!1),v=bt(o,"attacks",24,()=>[]),u=bt(o,"onSave",8),f=bt(o,"onCancel",8),m=$([]);function k(E,H){const we=e(m)[E];ga(m,e(m)[E]=e(m)[H]),ga(m,e(m)[H]=we),r(m,[...e(m)])}function y(E){E>0&&k(E,E-1)}function w(E){E<e(m).length-1&&k(E,E+1)}function U(){u()(e(m))}function F(){f()()}function re(E){E.target===E.currentTarget&&F()}Ye(()=>(z(t()),z(v())),()=>{t()&&r(m,[...v()])}),fa(),Wt();var be=vt(),ve=je(be);{var Z=E=>{var H=Kl(),we=i(H),Ee=i(we),ge=a(i(Ee),2);s(Ee);var Fe=a(Ee,2),Qe=i(Fe);{var ue=_=>{var Y=ql();c(_,Y)},De=_=>{var Y=zl();_t(Y,7,()=>e(m),g=>g.id,(g,R,Q)=>{var He=Wl(),Ne=i(He),Ae=i(Ne,!0);s(Ne);var Be=a(Ne,2),ot=i(Be),et=a(ot,2);s(Be),s(He),j(()=>{D(Ae,(e(R),n(()=>e(R).name||"(Unnamed attack or spell)"))),ot.disabled=e(Q)===0,et.disabled=(z(e(Q)),e(m),n(()=>e(Q)===e(m).length-1))}),L("click",ot,()=>y(e(Q))),L("click",et,()=>w(e(Q))),c(g,He)}),s(Y),c(_,Y)};b(Qe,_=>{e(m),n(()=>e(m).length===0)?_(ue):_(De,!1)})}s(Fe);var Ue=a(Fe,2),B=i(Ue),P=a(B,2);s(Ue),s(we),s(H),L("click",ge,F),L("click",B,F),L("click",P,U),L("click",H,re),c(E,H)};b(ve,E=>{t()&&E(Z)})}c(l,be),Kt()}let Ea=null,Ua=null;async function js(){if(Ea)return Ea;try{return Ea=await(await fetch(Cs("/data/spells.json"))).json(),Ea||[]}catch(l){return console.error("Failed to load spells:",l),[]}}async function Jl(){if(Ua)return Ua;try{return Ua=await(await fetch(Cs("/data/feats.json"))).json(),Ua||[]}catch(l){return console.error("Failed to load feats:",l),[]}}function ms(l,o){if(!o.trim())return l;const t=o.toLowerCase();return l.filter(v=>v.name.toLowerCase().includes(t)||v.school.toLowerCase().includes(t)||v.classes.some(u=>u.toLowerCase().includes(t))||v.description.toLowerCase().includes(t))}function Yl(l,o){return o===null?l:l.filter(t=>t.level===o)}function Ql(l,o){if(!o.trim())return l;const t=o.toLowerCase();return l.filter(v=>v.name.toLowerCase().includes(t)||v.description.toLowerCase().includes(t))}function Ha(l){const o=l.description,t=/\b(Strength|Dexterity|Constitution|Intelligence|Wisdom|Charisma)\s+saving\s+throw/i,v=o.match(t);if(!v)return null;const u=v[1].toLowerCase(),m=/half\s+(?:as\s+much\s+)?damage\s+on\s+a\s+successful(?:\s+save)?/i.test(o),y=/saving\s+throw\s+or\s+take.*?damage/i.test(o)&&!m;return{ability:u,halfDamageOnSave:m,noDamageOnSave:y}}function Xl(l){const o=l.description;return/(plus|add)\s+your\s+spellcasting\s+(ability\s+)?modifier/i.test(o)}function Ya(l){const o=l.description.toLowerCase();return o.includes("ranged spell attack")||o.includes("melee spell attack")}function bs(l){const o=l.description.toLowerCase();if(["Divine Favor","Bless","Aid","Command"].includes(l.name))return!0;const u=["takes","take","deals","deal","damage equal to","force damage","fire damage","cold damage","lightning damage","thunder damage","acid damage","poison damage","necrotic damage","radiant damage","psychic damage","regain","regains","hit point"].some(k=>o.includes(k));return["bonus to attack","bonus to damage","bonus to ac","gains a +","gain a +","+1 bonus","+2 bonus","+3 bonus","advantage on","becomes a magic weapon"].some(k=>o.includes(k))&&!u}function Zl(l){const o=l.description;let t=0,v=0,u=0,f="";const m=o.match(/\+(\d+)\s+bonus\s+to\s+attack\s+rolls\s+and\s+damage\s+rolls/i);if(m){const y=parseInt(m[1]);t=y,v=y,f=`+${y} to attack and damage rolls`}if(l.name==="Bless"&&(f="Add 1d4 to attack rolls and saves",t="1d4"),l.name==="Aid")return f="+5 HP (max and current) for 8 hours",{attackBonus:0,damageBonus:0,acBonus:0,hpBonus:5,description:f,name:l.name};l.name==="Divine Favor"&&(f="Your weapon attacks deal an extra 1d4 radiant damage on a hit.",v="1d4");const k=o.match(/\+(\d+)\s+bonus\s+to\s+AC/i);return k&&(u=parseInt(k[1]),f=`+${u} to AC`),l.name==="Haste"&&(f="+2 AC, doubled speed, extra action",u=2),f||t!==0||v!==0||u!==0?{attackBonus:t,damageBonus:v,acBonus:u,description:f||l.description.substring(0,100),name:l.name}:null}function Qa(l){const o=l.description,t=/takes?\s+(\d+d\d+)\s+\w+\s+damage[^.]*\.\s*If\s+the\s+target\s+is\s+missing.*?instead\s+takes?\s+(\d+d\d+)/is,v=o.match(t);return v?{baseDamage:v[1],alternateDamage:v[2]}:null}var ei=p('<button class="btn btn-secondary">Reorder</button>'),ti=p('<div class="edit-buttons svelte-14o91c5"><button class="btn btn-secondary">Add Attack</button> <!></div>'),ai=p('<input type="text" placeholder="Attack name" class="attack-name svelte-14o91c5"/>'),si=p('<h4 class="attack-name-display svelte-14o91c5"> </h4>'),li=p('<button class="btn-remove svelte-14o91c5">√ó</button>'),ii=p('<div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Bonus</label> <input type="number" class="attack-bonus svelte-14o91c5"/></div>'),ni=p('<div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Damage</label> <input type="text" placeholder="e.g., 2d6+3" class="attack-damage svelte-14o91c5"/></div>'),ri=p('<div class="spell-info-loading svelte-14o91c5">Loading spell info...</div>'),oi=p('<li class="svelte-14o91c5"><strong>At Higher Levels:</strong> </li>'),ci=p('<ul class="svelte-14o91c5"><li class="svelte-14o91c5"><strong>Level:</strong> </li> <li class="svelte-14o91c5"><strong>Casting Time:</strong> </li> <li class="svelte-14o91c5"><strong>Range:</strong> </li> <li class="svelte-14o91c5"><strong>Components:</strong> <!></li> <li class="svelte-14o91c5"><strong>Duration:</strong> <!> </li> <li class="svelte-14o91c5"><strong>Description:</strong> </li> <!></ul>'),vi=p('<span class="scaled-damage svelte-14o91c5" style="margin-left: 8px;"> </span>'),di=p('<span class="scaled-damage svelte-14o91c5">(Half damage)</span>'),ui=p('<span class="scaled-damage svelte-14o91c5">(No damage)</span>'),pi=p('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> <!> <!></label></div>'),fi=p('<span class="scaled-damage svelte-14o91c5"> </span>'),gi=p('<span class="scaled-damage svelte-14o91c5"> </span>'),mi=p('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> Target is missing HP <!></label></div>'),bi=p("<option> </option>"),hi=p('<span class="scaled-damage svelte-14o91c5"><!> </span>'),_i=p('<span class="scaled-damage svelte-14o91c5"> </span>'),yi=p('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> Target is Fiend or Undead <!></label></div>'),xi=p('<div class="spell-level-selector svelte-14o91c5"><label class="svelte-14o91c5">Cast at Level:</label> <select class="spell-level-select use-enabled svelte-14o91c5"></select> <!></div> <!>',1),ki=p('<div class="spell-level-selector svelte-14o91c5"><span style="color: #dc3545; font-weight: bold;">No spell slots available!</span></div>'),wi=p('<div class="spell-info svelte-14o91c5"><div class="spell-info-header svelte-14o91c5" role="button" tabindex="0"><h4 class="svelte-14o91c5">Spell Info</h4> <button class="collapse-btn-small svelte-14o91c5"> </button></div> <!></div> <!> <!> <!>',1),Si=p('<div class="spell-info-missing svelte-14o91c5">Spell info not found.</div>'),$i=p('<div class="attack-notes svelte-14o91c5"><label class="svelte-14o91c5">Notes</label> <textarea placeholder="e.g., DC 15 Dex save, Range 120 ft, Concentration" class="notes-input svelte-14o91c5" rows="2"></textarea></div>'),Ci=p('<button class="btn btn-primary">Roll Attack</button>'),Di=p('<div class="buff-target-selection svelte-14o91c5"><div class="target-options svelte-14o91c5"><label class="target-option svelte-14o91c5"><input type="radio" class="svelte-14o91c5"/> Self</label> <label class="target-option svelte-14o91c5"><input type="radio" class="svelte-14o91c5"/> Other</label></div> <button class="btn btn-info"> </button></div>'),Li=p('<button class="btn btn-info">Cast Spell</button>'),ji=p("<button><!></button>"),Ai=p('<button class="btn btn-info">Cast Spell</button>'),Bi=p('<button class="btn btn-secondary">Roll Damage</button>'),Ri=p('<button class="btn btn-primary">Roll Attack</button> <!>',1),Mi=p('<div class="attack-card svelte-14o91c5"><div class="attack-header svelte-14o91c5"><!> <!></div> <div class="attack-details svelte-14o91c5"><!> <!> <div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Type</label> <input type="text" placeholder="e.g., slashing" class="attack-type svelte-14o91c5"/></div></div> <!> <!> <div class="attack-actions svelte-14o91c5"><!></div></div>'),Fi=p('<p class="no-attacks svelte-14o91c5">No attacks added yet. Click "Add Attack" to create one.</p>'),Pi=p('<p class="no-attacks svelte-14o91c5">No attacks match your search.</p>'),Ti=p('<span class="ability-uses svelte-14o91c5"> <!></span>'),Ii=p('<span class="ability-reaction svelte-14o91c5">‚ö° Reaction</span>'),Ei=p('<button class="btn btn-ability svelte-14o91c5">Use Ability</button>'),Ui=p('<div class="ability-card svelte-14o91c5"><div class="ability-header svelte-14o91c5"><h4 class="ability-name svelte-14o91c5"> </h4> <span class="ability-source svelte-14o91c5"> </span></div> <p class="ability-description svelte-14o91c5"> </p> <div class="ability-footer svelte-14o91c5"><!> <!> <!></div></div>'),Hi=p('<div class="condition-abilities-section svelte-14o91c5"><h3 class="abilities-header svelte-14o91c5">Condition Abilities</h3> <p class="section-description svelte-14o91c5">Special actions granted by active conditions (e.g., Flicker of Deceit)</p> <div class="abilities-list svelte-14o91c5"></div></div>'),Ni=p('<button class="btn-remove svelte-14o91c5">√ó</button>'),Oi=p('<div class="state-card svelte-14o91c5"><div class="state-header svelte-14o91c5"><input type="text" placeholder="Effect name (e.g., Magic Weapon)" class="state-name svelte-14o91c5"/> <!></div> <div class="state-details svelte-14o91c5"><div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Attack Bonus</label> <input type="number" class="state-bonus svelte-14o91c5"/></div> <div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Damage Bonus</label> <input type="text" class="state-bonus svelte-14o91c5"/></div> <div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Target</label> <select class="state-bonus svelte-14o91c5"><option>Self</option><option>Other</option></select></div></div> <div class="state-description svelte-14o91c5"><label class="svelte-14o91c5">Description</label> <input type="text" placeholder="e.g., +1 to attack and damage rolls (Magic Weapon)" class="state-desc-input svelte-14o91c5"/></div></div>'),Gi=p('<div class="states-list svelte-14o91c5"></div>'),qi=p('<p class="no-states svelte-14o91c5">No active effects. Add spell effects that modify your attacks.</p>'),Wi=p('<!> <div class="attacks-list svelte-14o91c5"><!> <!></div> <!> <div class="active-states-section svelte-14o91c5"><h3 class="svelte-14o91c5">Active Spell Effects</h3> <p class="section-description svelte-14o91c5">Effects that modify attack and damage rolls (e.g., Magic Weapon, Bless)</p> <button class="btn btn-secondary">Add Effect</button> <!></div>',1),zi=p("<section><!> <!></section> <!>",1);function Ki(l,o){zt(o,!1);const t=()=>rt(de,"$character",k),v=()=>rt(Fa,"$abilityModifiers",k),u=()=>rt(ha,"$searchFilter",k),f=()=>rt(ea,"$collapsedStates",k),m=()=>rt(ba,"$isEditMode",k),[k,y]=va(),w=$(),U=$(),F=$(),re=[];function be(x,O){de.update(T=>{if(!T.activeStates)return T;const S=T.activeStates.findIndex(Le=>Le.name===x);if(S===-1)return T;const I=T.activeStates[S];if(!I.abilities)return T;const ee=I.abilities.findIndex(Le=>Le.name===O);if(ee===-1)return T;const he=I.abilities[ee];return he.currentUses!==void 0&&he.currentUses>0&&(he.currentUses-=1,he.usesPerRest!==void 0?qt.add(`Used ${O} (${he.currentUses}/${he.usesPerRest} remaining)`,"info"):qt.add(`Used ${O}`,"info")),T})}const ve=ya();let Z=$({}),E=$({}),H=$(!1);function we(x){ga(Z,e(Z)[x]=!e(Z)[x]),r(Z,{...e(Z)})}function Ee(x){return x.description.toLowerCase().includes("regain")&&(x.description.toLowerCase().includes("hit point")||x.description.toLowerCase().includes("hp"))}function ge(x){return["Shield of Faith","Bless","Aid","Magic Weapon"].includes(x)}function Fe(){de.update(x=>(x.attacks=[...x.attacks,{id:crypto.randomUUID(),name:"",bonus:0,damage:"",damageType:"",notes:""}],x))}function Qe(x){de.update(O=>(O.attacks=O.attacks.filter(T=>T.id!==x),O))}function ue(){r(H,!0)}function De(){r(H,!1)}function Ue(x){de.update(O=>(O.attacks=x,O)),r(H,!1),qt.add("Attack order updated successfully!","success")}function B(x){let O=x.damage,T=!1,S=!1;if(x.spellRef){const oe=g(x.spellRef);if(oe&&(S=Ya(oe),oe.level>0)){const _e=x.castAtLevel||oe.level;if(!R(_e)){qt.add(`No level ${_e} spell slots available!`,"error");return}const A=Ha(oe);A&&x.targetSucceededSave&&A.noDamageOnSave?O="0":(T=A?.halfDamageOnSave&&x.targetSucceededSave||!1,O=Q(x,oe))}}else if(t().activeStates&&t().activeStates.length>0){let oe=0,_e=[];for(const K of t().activeStates)K.target!=="other"&&(typeof K.damageBonus=="string"?_e.push(K.damageBonus):typeof K.damageBonus=="number"&&(oe+=K.damageBonus));if((oe!==0||_e.length>0)&&O){const K=O.match(/(\d+d\d+)([+-]\d+)?/);if(K){const[,A,Se]=K,Re=(Se?parseInt(Se):0)+oe;let Xe=`${A}`;Re!==0&&(Xe+=`${Re>=0?"+":""}${Re}`),_e.length>0&&(Xe+=" + "+_e.join(" + ")),O=Xe}}}const I=[];let ee=0;if(S){const oe=gs(t(),v()),_e=t().proficiencyBonus||0;I.push({value:_e,source:"proficiency"}),I.push({value:oe,source:"spellcasting"}),ee=_e+oe}else x.bonus!==0&&I.push({value:x.bonus,source:"base"}),ee=x.bonus;let he=[];if(t().activeStates)for(const oe of t().activeStates)oe.target!=="other"&&(typeof oe.attackBonus=="number"&&oe.attackBonus!==0?(I.push({value:oe.attackBonus,source:oe.name.toLowerCase()}),ee+=oe.attackBonus):typeof oe.attackBonus=="string"&&oe.attackBonus&&(he.push(oe.attackBonus),I.push({value:oe.attackBonus,source:oe.name.toLowerCase()})));let Le=`1d20${ee>=0?"+":""}${ee}`;he.length>0&&(Le+="+"+he.join("+")),ve("roll",{notation:Le,damageNotation:O,attackName:x.name,applyHalfDamage:T,bonusBreakdown:I,rollType:"attack"})}function P(x){if(!x.damage){qt.add(`${x.name}: No damage specified`,"error");return}let O=x.damage,T=!1;const S=[];if(x.spellRef){const I=g(x.spellRef);if(I&&I.level>0){const ee=x.castAtLevel||I.level;if(!R(ee)){qt.add(`No level ${ee} spell slots available!`,"error");return}const Le=Ha(I);Le&&x.targetSucceededSave&&Le.noDamageOnSave?O="0":(T=Le?.halfDamageOnSave&&x.targetSucceededSave||!1,O=Q(x,I))}}else{const I=O.match(/(\d+d\d+)([+-]\d+)?/);if(I){const[,ee,he]=I,Le=he?parseInt(he):0;if(Le!==0&&S.push({value:Le,source:"base"}),t().activeStates&&t().activeStates.length>0){let oe=0,_e=[];for(const K of t().activeStates)K.target!=="other"&&(typeof K.damageBonus=="string"?_e.push(K.damageBonus):typeof K.damageBonus=="number"&&K.damageBonus!==0&&(S.push({value:K.damageBonus,source:K.name.toLowerCase()}),oe+=K.damageBonus));if(oe!==0||_e.length>0){const K=Le+oe;let A=`${ee}`;K!==0&&(A+=`${K>=0?"+":""}${K}`),_e.length>0&&(A+=" + "+_e.join(" + ")),O=A}}}}ve("roll",{notation:O,attackName:x.name,applyHalfDamage:T,bonusBreakdown:S})}let _=$([]),Y=$(!1);Ca(async()=>{r(_,await js()),r(Y,!0)});function g(x){return e(_).find(O=>O.name===x)}function R(x){t().classFeatures.spellSlotsByLevel||Lt(de,n(t).classFeatures.spellSlotsByLevel={},n(t)),t().classFeatures.spellSlotsByLevel[x]||Lt(de,n(t).classFeatures.spellSlotsByLevel[x]=Array(2).fill(!1),n(t));const T=t().classFeatures.spellSlotsByLevel[x].findIndex(S=>!S);return T===-1?!1:(de.update(S=>(S.classFeatures.spellSlotsByLevel||(S.classFeatures.spellSlotsByLevel={}),S.classFeatures.spellSlotsByLevel[x]||(S.classFeatures.spellSlotsByLevel[x]=Array(2).fill(!1)),S.classFeatures.spellSlotsByLevel[x][T]=!0,S)),!0)}function Q(x,O){let T=x.damage,S=0,I=0;const ee=Qa(O);if(ee&&x.targetIsDamaged&&(T=ee.alternateDamage),Xl(O)&&(I+=gs(t(),v())),t().activeStates)for(const Re of t().activeStates)Re.target!=="other"&&typeof Re.damageBonus=="number"&&(I+=Re.damageBonus);if(O.higherLevelSlot&&x.castAtLevel){const Re=O.level,se=(x.castAtLevel||Re)-Re;if(se>0){const d=O.higherLevelSlot.match(/(\d+)d(\d+)\s+for\s+each.*?level\s+above/i);if(d){const[,ye]=d;S+=se*parseInt(ye)}}}if(x.targetIsFiendOrUndead&&O.description.includes("Fiend or an Undead")){const Re=O.description.match(/increases by (\d+)d(\d+) if.*?Fiend or.*?Undead/i);if(Re){const[,Xe]=Re;S+=parseInt(Xe)}}const he=T.match(/(\d+)d(\d+)([+-]\d+)?/);if(!he)return I!==0?I>=0?`${I}`:`${I}`:T||"0";const[,Le,oe,_e]=he,K=parseInt(Le)+S,Se=(_e?parseInt(_e):0)+I;let Oe=`${K}d${oe}`;return Se!==0&&(Oe+=Se>=0?`+${Se}`:`${Se}`),Oe}function He(x){const O=[];for(let S=x.level;S<=9;S++){const I=t().classFeatures.spellSlotsByLevel?.[S];I&&I.length>0&&O.push(S)}return O}function Ne(){de.update(x=>(x.activeStates||(x.activeStates=[]),x.activeStates=[...x.activeStates,{name:"",attackBonus:0,damageBonus:0,description:"",target:"self"}],x))}function Ae(x){de.update(O=>{if(O.activeStates){const T=O.activeStates[x];T?.hpBonus&&T.target!=="other"&&(O.maxHP-=T.hpBonus,O.currentHP=Math.max(1,Math.min(O.currentHP-T.hpBonus,O.maxHP))),O.activeStates=O.activeStates.filter((S,I)=>I!==x)}return O})}function Be(x,O="self"){const T=g(x.spellRef);if(!T){qt.add("Spell not found","error");return}const S=x.castAtLevel||T.level;if(S>0&&!R(S)){qt.add(`No level ${S} spell slots available!`,"error");return}const I=Zl(T);if(!I){qt.add(`${T.name} cast! Check spell description for effects.`,"info");return}let ee=I.hpBonus||0,he=I.description;T.name==="Aid"&&S>T.level&&(ee=5+(S-T.level)*5,he=`+${ee} HP (max and current) for 8 hours`);const oe=["Shield of Faith","Bless","Aid","Magic Weapon"].includes(T.name);de.update(K=>{K.activeStates||(K.activeStates=[]);const A=K.activeStates.find(Se=>Se.name===T.name);return A&&A.hpBonus&&A.target!=="other"&&(K.maxHP-=A.hpBonus,K.currentHP=Math.max(1,Math.min(K.currentHP-A.hpBonus,K.maxHP))),K.activeStates=K.activeStates.filter(Se=>Se.name!==T.name),ee>0&&O==="self"&&(K.maxHP+=ee,K.currentHP+=ee),K.activeStates=[...K.activeStates,{name:T.name,attackBonus:I.attackBonus,damageBonus:I.damageBonus,acBonus:I.acBonus,description:he,target:O,hpBonus:ee}],K});const _e=O==="self"?" on self":" on other";qt.add(`${T.name} cast${oe?_e:""}! Effect added to Active Spell Effects.`,"success")}Ye(()=>t(),()=>{r(w,t().activeStates?t().activeStates.filter(x=>x.abilities&&x.abilities.length>0).flatMap(x=>x.abilities.map(O=>({...O,conditionName:x.name}))):[])}),Ye(()=>(t(),e(Z),e(E)),()=>{if(t()&&t().attacks)for(const x of t().attacks)x.spellRef&&e(Z)[x.id]===void 0&&ga(Z,e(Z)[x.id]=!0),x.spellRef&&e(E)[x.id]===void 0&&ga(E,e(E)[x.id]="self")}),Ye(()=>(t(),u()),()=>{r(U,t().attacks.filter(x=>{if(!u())return!0;const O=u().toLowerCase();return x.name.toLowerCase().includes(O)||x.damageType.toLowerCase().includes(O)}).sort((x,O)=>!x.spellRef&&O.spellRef?-1:x.spellRef&&!O.spellRef?1:0))}),Ye(()=>(u(),e(U)),()=>{r(F,!u()||e(U).length>0||"attack".includes(u().toLowerCase())||"spell".includes(u().toLowerCase()))}),fa(),Wt();var ot=zi(),et=je(ot);let ut;var ct=i(et);{let x=mt(()=>(f(),n(()=>f().attacks?"Expand":"Collapse")));xa(ct,{title:"Attacks & Spells",get collapsed(){return f(),n(()=>f().attacks)},get ariaLabel(){return e(x)},onToggle:()=>ea.update(O=>({...O,attacks:!O.attacks}))})}var it=a(ct,2);{var lt=x=>{var O=Wi(),T=je(O);{var S=se=>{var d=ti(),ye=i(d),pe=a(ye,2);{var G=$e=>{var ce=ei();L("click",ce,ue),c($e,ce)};b(pe,$e=>{t(),n(()=>t().attacks.length>0)&&$e(G)})}s(d),L("click",ye,Fe),c(se,d)};b(T,se=>{m()&&se(S)})}var I=a(T,2),ee=i(I);_t(ee,1,()=>e(U),se=>se.id,(se,d,ye)=>{var pe=Mi(),G=i(pe),$e=i(G);{var ce=N=>{var X=ai();Ce(X),Ie(X,()=>e(d).name,pt=>(e(d).name=pt,Pt(()=>(e(U),t(),u())))),c(N,X)},xe=N=>{var X=si(),pt=i(X,!0);s(X),j(()=>D(pt,(e(d),n(()=>e(d).name||"(Unnamed Attack)")))),c(N,X)};b($e,N=>{m()?N(ce):N(xe,!1)})}var le=a($e,2);{var Te=N=>{var X=li();L("click",X,()=>Qe(e(d).id)),c(N,X)};b(le,N=>{m()&&N(Te)})}s(G);var fe=a(G,2),h=i(fe);{var V=N=>{var X=ii(),pt=i(X),Ke=a(pt,2);Ce(Ke),s(X),j(()=>{Je(pt,"for",`attack-bonus-${e(d),n(()=>e(d).id)??""}`),Je(Ke,"id",`attack-bonus-${e(d),n(()=>e(d).id)??""}`)}),Ie(Ke,()=>e(d).bonus,Ge=>(e(d).bonus=Ge,Pt(()=>(e(U),t(),u())))),c(N,X)};b(h,N=>{e(d),n(()=>e(d).bonus!==0&&e(d).bonus!==void 0)&&N(V)})}var ie=a(h,2);{var ne=N=>{var X=ni(),pt=i(X),Ke=a(pt,2);Ce(Ke),s(X),j(()=>{Je(pt,"for",`attack-damage-${e(d),n(()=>e(d).id)??""}`),Je(Ke,"id",`attack-damage-${e(d),n(()=>e(d).id)??""}`)}),Ie(Ke,()=>e(d).damage,Ge=>(e(d).damage=Ge,Pt(()=>(e(U),t(),u())))),c(N,X)};b(ie,N=>{e(d),n(()=>e(d).damage&&e(d).damage.trim()!=="")&&N(ne)})}var q=a(ie,2),te=i(q),Pe=a(te,2);Ce(Pe),s(q),s(fe);var J=a(fe,2);{var Me=N=>{var X=vt(),pt=je(X);{var Ke=C=>{var M=ri();c(C,M)},Ge=C=>{const M=mt(()=>(e(d),n(()=>g(e(d).spellRef))));var W=vt(),qe=je(W);{var ae=me=>{const at=mt(()=>(z(Ha),z(e(M)),n(()=>Ha(e(M))))),Ve=mt(()=>(z(Qa),z(e(M)),n(()=>Qa(e(M)))));var It=wi(),At=je(It),Vt=i(At),Jt=a(i(Vt),2),ta=i(Jt,!0);s(Jt),s(Vt);var Bt=a(Vt,2);{var St=yt=>{var Ct=ci(),Tt=i(Ct),Zt=a(i(Tt));s(Tt);var ia=a(Tt,2),oa=a(i(ia));s(ia);var Nt=a(ia,2),Rt=a(i(Nt));s(Nt);var Et=a(Nt,2),Ze=a(i(Et)),We=a(Ze);{var dt=Ft=>{var kt=Ht();j(()=>D(kt,`(${z(e(M)),n(()=>e(M).material)??""})`)),c(Ft,kt)};b(We,Ft=>{z(e(M)),n(()=>e(M).material)&&Ft(dt)})}s(Et);var xt=a(Et,2),Dt=a(i(xt),2);{var ca=Ft=>{var kt=Ht("Concentration,");c(Ft,kt)};b(Dt,Ft=>{z(e(M)),n(()=>e(M).concentration)&&Ft(ca)})}var Mt=a(Dt,1,!0);s(xt);var Qt=a(xt,2),Ut=a(i(Qt));s(Qt);var na=a(Qt,2);{var ua=Ft=>{var kt=oi(),Ot=a(i(kt));s(kt),j(()=>D(Ot,` ${z(e(M)),n(()=>e(M).higherLevelSlot)??""}`)),c(Ft,kt)};b(na,Ft=>{z(e(M)),n(()=>e(M).higherLevelSlot)&&Ft(ua)})}s(Ct),j(Ft=>{D(Zt,` ${z(e(M)),n(()=>e(M).level)??""}`),D(oa,` ${z(e(M)),n(()=>e(M).castingTime||e(M).actionType)??""}`),D(Rt,` ${z(e(M)),n(()=>e(M).range)??""}`),D(Ze,` ${Ft??""}`),D(Mt,(z(e(M)),n(()=>e(M).duration))),D(Ut,` ${z(e(M)),n(()=>e(M).description)??""}`)},[()=>(z(e(M)),n(()=>e(M).components.join(", ")))]),c(yt,Ct)};b(Bt,yt=>{e(Z),e(d),n(()=>!e(Z)[e(d).id])&&yt(St)})}s(At);var $t=a(At,2);{var sa=yt=>{var Ct=pi(),Tt=i(Ct),Zt=i(Tt);Ce(Zt);var ia=a(Zt),oa=a(ia);{var Nt=We=>{var dt=vi(),xt=i(dt);s(dt),j(Dt=>D(xt,`(Spell Save DC: ${Dt??""})`),[()=>(z(as),t(),v(),n(()=>as(t(),v())))]),c(We,dt)};b(oa,We=>{t(),n(()=>t().class)&&We(Nt)})}var Rt=a(oa,2);{var Et=We=>{var dt=di();c(We,dt)},Ze=We=>{var dt=vt(),xt=je(dt);{var Dt=ca=>{var Mt=ui();c(ca,Mt)};b(xt,ca=>{e(d),z(e(at)),n(()=>e(d).targetSucceededSave&&e(at).noDamageOnSave)&&ca(Dt)},!0)}c(We,dt)};b(Rt,We=>{e(d),z(e(at)),n(()=>e(d).targetSucceededSave&&e(at).halfDamageOnSave)?We(Et):We(Ze,!1)})}s(Tt),s(Ct),j(We=>D(ia,` Target succeeded on ${We??""} save `),[()=>(z(e(at)),n(()=>e(at).ability.charAt(0).toUpperCase()+e(at).ability.slice(1)))]),wa(Zt,()=>e(d).targetSucceededSave,We=>(e(d).targetSucceededSave=We,Pt(()=>(e(U),t(),u())))),c(yt,Ct)};b($t,yt=>{e(at)&&yt(sa)})}var da=a($t,2);{var la=yt=>{var Ct=mi(),Tt=i(Ct),Zt=i(Tt);Ce(Zt);var ia=a(Zt,2);{var oa=Rt=>{const Et=mt(()=>(e(d),z(e(M)),n(()=>Q(e(d),e(M)))));var Ze=fi(),We=i(Ze);s(Ze),j(()=>D(We,`(${z(e(Ve)),n(()=>e(Ve).alternateDamage)??""}, total: ${e(Et)??""})`)),c(Rt,Ze)},Nt=Rt=>{var Et=gi(),Ze=i(Et);s(Et),j(()=>D(Ze,`(${z(e(Ve)),n(()=>e(Ve).baseDamage)??""})`)),c(Rt,Et)};b(ia,Rt=>{e(d),n(()=>e(d).targetIsDamaged)?Rt(oa):Rt(Nt,!1)})}s(Tt),s(Ct),wa(Zt,()=>e(d).targetIsDamaged,Rt=>(e(d).targetIsDamaged=Rt,Pt(()=>(e(U),t(),u())))),c(yt,Ct)};b(da,yt=>{e(Ve)&&yt(la)})}var Yt=a(da,2);{var Xt=yt=>{const Ct=mt(()=>(z(e(M)),n(()=>He(e(M)))));var Tt=vt(),Zt=je(Tt);{var ia=Nt=>{var Rt=xi(),Et=je(Rt),Ze=i(Et),We=a(Ze,2);j(()=>{e(d),Pt(()=>{e(Ct)})}),_t(We,5,()=>e(Ct),wt,(Mt,Qt)=>{var Ut=bi(),na=i(Ut);s(Ut);var ua={};j(()=>{D(na,`Level ${e(Qt)??""}`),ua!==(ua=e(Qt))&&(Ut.value=(Ut.__value=e(Qt))??"")}),c(Mt,Ut)}),s(We);var dt=a(We,2);{var xt=Mt=>{const Qt=mt(()=>(e(d),z(e(M)),n(()=>Q(e(d),e(M)))));var Ut=hi(),na=i(Ut);{var ua=Ot=>{var ra=Ht("Healing");c(Ot,ra)},Ft=Ot=>{var ra=Ht("Damage");c(Ot,ra)};b(na,Ot=>{z(e(M)),n(()=>Ee(e(M)))?Ot(ua):Ot(Ft,!1)})}var kt=a(na);s(Ut),j(()=>D(kt,` ${e(Qt)??""}`)),c(Mt,Ut)};b(dt,Mt=>{e(d),z(e(M)),n(()=>e(d).castAtLevel&&e(d).castAtLevel>e(M).level)&&Mt(xt)})}s(Et);var Dt=a(Et,2);{var ca=Mt=>{var Qt=yi(),Ut=i(Qt),na=i(Ut);Ce(na);var ua=a(na,2);{var Ft=kt=>{const Ot=mt(()=>(e(d),z(e(M)),n(()=>Q(e(d),e(M)))));var ra=_i(),ka=i(ra);s(ra),j(()=>D(ka,`(+1d8, total: ${e(Ot)??""})`)),c(kt,ra)};b(ua,kt=>{e(d),n(()=>e(d).targetIsFiendOrUndead)&&kt(Ft)})}s(Ut),s(Qt),wa(na,()=>e(d).targetIsFiendOrUndead,kt=>(e(d).targetIsFiendOrUndead=kt,Pt(()=>(e(U),t(),u())))),c(Mt,Qt)};b(Dt,Mt=>{z(e(M)),n(()=>e(M).description.includes("Fiend or an Undead"))&&Mt(ca)})}j(()=>{Je(Ze,"for",`castLevel-${e(d),n(()=>e(d).id)??""}`),Je(We,"id",`castLevel-${e(d),n(()=>e(d).id)??""}`)}),Ma(We,()=>e(d).castAtLevel,Mt=>(e(d).castAtLevel=Mt,Pt(()=>(e(U),t(),u())))),c(Nt,Rt)},oa=Nt=>{var Rt=ki();c(Nt,Rt)};b(Zt,Nt=>{z(e(Ct)),n(()=>e(Ct).length>0)?Nt(ia):Nt(oa,!1)})}c(yt,Tt)};b(Yt,yt=>{z(e(M)),n(()=>e(M).higherLevelSlot&&e(M).level>0)&&yt(Xt)})}j(()=>{Je(Jt,"aria-label",(e(Z),e(d),n(()=>e(Z)[e(d).id]?"Expand":"Collapse"))),D(ta,(e(Z),e(d),n(()=>e(Z)[e(d).id]?"‚ñº":"‚ñ≤")))}),L("click",Vt,()=>we(e(d).id)),L("keydown",Vt,yt=>yt.key==="Enter"&&we(e(d).id)),c(me,It)},ze=me=>{var at=Si();c(me,at)};b(qe,me=>{e(M)?me(ae):me(ze,!1)})}c(C,W)};b(pt,C=>{e(_),n(()=>e(_).length===0)?C(Ke):C(Ge,!1)})}c(N,X)};b(J,N=>{e(d),n(()=>e(d).spellRef)&&N(Me)})}var ke=a(J,2);{var tt=N=>{var X=$i(),pt=i(X),Ke=a(pt,2);_a(Ke),s(X),j(()=>{Je(pt,"for",`attack-notes-${e(d),n(()=>e(d).id)??""}`),Je(Ke,"id",`attack-notes-${e(d),n(()=>e(d).id)??""}`)}),Ie(Ke,()=>e(d).notes,Ge=>(e(d).notes=Ge,Pt(()=>(e(U),t(),u())))),c(N,X)};b(ke,N=>{e(d),n(()=>!e(d).spellRef)&&N(tt)})}var nt=a(ke,2),gt=i(nt);{var ft=N=>{const X=mt(()=>(e(d),n(()=>g(e(d).spellRef))));var pt=vt(),Ke=je(pt);{var Ge=C=>{var M=vt(),W=je(M);{var qe=ze=>{var me=Ci();L("click",me,()=>B(e(d))),c(ze,me)},ae=ze=>{var me=vt(),at=je(me);{var Ve=At=>{var Vt=vt(),Jt=je(Vt);{var ta=St=>{var $t=Di(),sa=i($t),da=i(sa),la=i(da);Ce(la),la.value=la.__value="self",Gt(),s(da);var Yt=a(da,2),Xt=i(Yt);Ce(Xt),Xt.value=Xt.__value="other",Gt(),s(Yt),s(sa);var yt=a(sa,2),Ct=i(yt);s(yt),s($t),j(()=>{Je(la,"name",`target-${e(d),n(()=>e(d).id)??""}`),Je(Xt,"name",`target-${e(d),n(()=>e(d).id)??""}`),D(Ct,`Cast ${z(e(X)),n(()=>e(X).name)??""}`)}),vs(re,[ye],la,()=>e(E)[e(d).id],Tt=>ga(E,e(E)[e(d).id]=Tt)),vs(re,[ye],Xt,()=>e(E)[e(d).id],Tt=>ga(E,e(E)[e(d).id]=Tt)),L("click",yt,()=>Be(e(d),e(E)[e(d).id])),c(St,$t)},Bt=St=>{var $t=Li();L("click",$t,()=>Be(e(d),"self")),c(St,$t)};b(Jt,St=>{z(e(X)),n(()=>ge(e(X).name))?St(ta):St(Bt,!1)})}c(At,Vt)},It=At=>{var Vt=vt(),Jt=je(Vt);{var ta=St=>{var $t=ji(),sa=i($t);{var da=Yt=>{var Xt=Ht("Roll Healing");c(Yt,Xt)},la=Yt=>{var Xt=Ht("Roll Damage");c(Yt,Xt)};b(sa,Yt=>{z(e(X)),n(()=>Ee(e(X)))?Yt(da):Yt(la,!1)})}s($t),j(Yt=>jt($t,1,`btn ${Yt??""}`),[()=>(z(e(X)),n(()=>Ee(e(X))?"btn-success":"btn-secondary"))]),L("click",$t,()=>P(e(d))),c(St,$t)},Bt=St=>{var $t=Ai();L("click",$t,()=>Be(e(d),"self")),c(St,$t)};b(Jt,St=>{e(d),n(()=>e(d).damage&&e(d).damage.trim()!=="")?St(ta):St(Bt,!1)})}c(At,Vt)};b(at,At=>{z(bs),z(e(X)),n(()=>bs(e(X)))?At(Ve):At(It,!1)},!0)}c(ze,me)};b(W,ze=>{z(Ya),z(e(X)),n(()=>Ya(e(X)))?ze(qe):ze(ae,!1)})}c(C,M)};b(Ke,C=>{e(X)&&C(Ge)})}c(N,pt)},st=N=>{var X=vt(),pt=je(X);{var Ke=Ge=>{var C=Ri(),M=je(C),W=a(M,2);{var qe=ae=>{var ze=Bi();L("click",ze,()=>P(e(d))),c(ae,ze)};b(W,ae=>{e(d),n(()=>e(d).damage&&e(d).damage.trim()!=="")&&ae(qe)})}L("click",M,()=>B(e(d))),c(Ge,C)};b(pt,Ge=>{e(d),n(()=>!e(d).spellRef)&&Ge(Ke)},!0)}c(N,X)};b(gt,N=>{e(d),e(Y),n(()=>e(d).spellRef&&e(Y))?N(ft):N(st,!1)})}s(nt),s(pe),j(()=>{Je(te,"for",`attack-type-${e(d),n(()=>e(d).id)??""}`),Je(Pe,"id",`attack-type-${e(d),n(()=>e(d).id)??""}`)}),Ie(Pe,()=>e(d).damageType,N=>(e(d).damageType=N,Pt(()=>(e(U),t(),u())))),c(se,pe)});var he=a(ee,2);{var Le=se=>{var d=Fi();c(se,d)},oe=se=>{var d=vt(),ye=je(d);{var pe=G=>{var $e=Pi();c(G,$e)};b(ye,G=>{e(U),n(()=>e(U).length===0)&&G(pe)},!0)}c(se,d)};b(he,se=>{t(),n(()=>t().attacks.length===0)?se(Le):se(oe,!1)})}s(I);var _e=a(I,2);{var K=se=>{var d=Hi(),ye=a(i(d),4);_t(ye,5,()=>e(w),wt,(pe,G)=>{var $e=Ui(),ce=i($e),xe=i(ce),le=i(xe,!0);s(xe);var Te=a(xe,2),fe=i(Te);s(Te),s(ce);var h=a(ce,2),V=i(h,!0);s(h);var ie=a(h,2),ne=i(ie);{var q=ke=>{var tt=Ti(),nt=i(tt),gt=a(nt);{var ft=st=>{var N=Ht();j(()=>D(N,`per ${e(G),n(()=>e(G).restType)??""} rest`)),c(st,N)};b(gt,st=>{e(G),n(()=>e(G).restType)&&st(ft)})}s(tt),j(()=>D(nt,`${e(G),n(()=>e(G).currentUses??e(G).usesPerRest)??""}/${e(G),n(()=>e(G).usesPerRest)??""} uses `)),c(ke,tt)};b(ne,ke=>{e(G),n(()=>e(G).usesPerRest)&&ke(q)})}var te=a(ne,2);{var Pe=ke=>{var tt=Ii();c(ke,tt)};b(te,ke=>{e(G),n(()=>e(G).requiresReaction)&&ke(Pe)})}var J=a(te,2);{var Me=ke=>{var tt=Ei();j(()=>tt.disabled=(e(G),n(()=>e(G).currentUses===void 0||e(G).currentUses===0))),L("click",tt,()=>be(e(G).conditionName,e(G).name)),c(ke,tt)};b(J,ke=>{m(),e(G),n(()=>!m()&&e(G).usesPerRest)&&ke(Me)})}s(ie),s($e),j(()=>{D(le,(e(G),n(()=>e(G).name))),D(fe,`(${e(G),n(()=>e(G).conditionName)??""})`),D(V,(e(G),n(()=>e(G).description)))}),c(pe,$e)}),s(ye),s(d),c(se,d)};b(_e,se=>{e(w),n(()=>e(w).length>0)&&se(K)})}var A=a(_e,2),Se=a(i(A),4),Oe=a(Se,2);{var Re=se=>{var d=Gi();_t(d,5,()=>(t(),n(()=>t().activeStates)),wt,(ye,pe,G)=>{var $e=Oi(),ce=i($e),xe=i(ce);Ce(xe);var le=a(xe,2);{var Te=st=>{var N=Ni();L("click",N,()=>Ae(G)),c(st,N)};b(le,st=>{m()&&st(Te)})}s(ce);var fe=a(ce,2),h=i(fe),V=i(h);Je(V,"for",`state-attack-bonus-${G}`);var ie=a(V,2);Ce(ie),Je(ie,"id",`state-attack-bonus-${G}`),s(h);var ne=a(h,2),q=i(ne);Je(q,"for",`state-damage-bonus-${G}`);var te=a(q,2);Ce(te),Je(te,"id",`state-damage-bonus-${G}`),s(ne);var Pe=a(ne,2),J=i(Pe);Je(J,"for",`state-target-${G}`);var Me=a(J,2);j(()=>{e(pe),Pt(()=>{})}),Je(Me,"id",`state-target-${G}`);var ke=i(Me);ke.value=ke.__value="self";var tt=a(ke);tt.value=tt.__value="other",s(Me),s(Pe),s(fe);var nt=a(fe,2),gt=i(nt);Je(gt,"for",`state-desc-${G}`);var ft=a(gt,2);Ce(ft),Je(ft,"id",`state-desc-${G}`),s(nt),s($e),Ie(xe,()=>e(pe).name,st=>(e(pe).name=st,Pt(()=>t()),La(k,"$character"))),Ie(ie,()=>e(pe).attackBonus,st=>(e(pe).attackBonus=st,Pt(()=>t()),La(k,"$character"))),Ie(te,()=>e(pe).damageBonus,st=>(e(pe).damageBonus=st,Pt(()=>t()),La(k,"$character"))),Ma(Me,()=>e(pe).target,st=>(e(pe).target=st,Pt(()=>t()),La(k,"$character"))),Ie(ft,()=>e(pe).description,st=>(e(pe).description=st,Pt(()=>t()),La(k,"$character"))),c(ye,$e)}),s(d),c(se,d)},Xe=se=>{var d=qi();c(se,d)};b(Oe,se=>{t(),n(()=>t().activeStates&&t().activeStates.length>0)?se(Re):se(Xe,!1)})}s(A),L("click",Se,Ne),c(x,O)};b(it,x=>{f(),n(()=>!f().attacks)&&x(lt)})}s(et);var ht=a(et,2);Vl(ht,{get show(){return e(H)},get attacks(){return t(),n(()=>t().attacks)},onSave:Ue,onCancel:De}),j(()=>ut=jt(et,1,"attacks svelte-14o91c5",null,ut,{hidden:!e(F)})),c(l,ot),Kt(),y()}var Vi=p('<span class="slot-checkbox-x svelte-serp1j">&#8212;</span>'),Ji=p('<label><input type="checkbox" class="slot-checkbox-input svelte-serp1j"/> <span><!></span></label>');function hs(l,o){zt(o,!1);const t=()=>rt(ba,"$isEditMode",v),[v,u]=va();let f=bt(o,"checked",8,!1),m=bt(o,"disabled",8,!1),k=bt(o,"className",8,""),y=bt(o,"index",8,void 0),w=bt(o,"ariaLabel",8,void 0);const U=ya();function F(H){U("change",{checked:H.currentTarget.checked,index:y()})}Wt();var re=Ji(),be=i(re);Ce(be);var ve=a(be,2),Z=i(ve);{var E=H=>{var we=Vi();c(H,we)};b(Z,H=>{f()&&H(E)})}s(ve),s(re),j(()=>{jt(re,1,"slot-checkbox-label "+k()+(t()?"":" not-editable"),"svelte-serp1j"),$s(be,f()),be.disabled=m()||!t(),Je(be,"aria-label",w()),Je(be,"tabindex",t()?0:-1),jt(ve,1,`slot-checkbox-custom ${f()?"used":""} ${t()?"":"readonly"}`,"svelte-serp1j")}),L("change",be,F),c(l,re),Kt(),u()}var Yi=p('<p class="no-features svelte-1kpvv0n">Select a class to see available features</p>'),Qi=p('<p class="no-features svelte-1kpvv0n">No class features available at this level</p>'),Xi=p('<div class="spell-slots svelte-1kpvv0n"><label class="svelte-1kpvv0n"> </label> <div class="slots-tracker svelte-1kpvv0n"></div></div>'),Zi=p('<div class="all-spell-slots"></div>'),en=p('<div class="feature-box spellcasting svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"> </h3> <div class="spell-stats svelte-1kpvv0n"><div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Spell Save DC</label> <div class="spell-value svelte-1kpvv0n"> </div></div> <div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <div class="spell-value svelte-1kpvv0n"> </div></div></div> <!> <div class="prepared-spells svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <textarea placeholder="List your prepared spells..." class="svelte-1kpvv0n"></textarea></div></div>'),tn=p('<p class="unlimited svelte-1kpvv0n">Unlimited Uses</p>'),an=p('<div class="slots-tracker svelte-1kpvv0n"></div> <div class="uses-actions-row"><button class="btn btn-primary use-enabled"> </button></div> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div>',1),sn=p('<div class="uses-tracker svelte-1kpvv0n"><!></div>'),ln=p('<div class="pool-tracker svelte-1kpvv0n"><input type="number" min="0" class="pool-input svelte-1kpvv0n"/> <span> </span> <button class="btn-small svelte-1kpvv0n"> </button></div>'),nn=p('<p class="no-uses svelte-1kpvv0n">No Channel Divinity uses remaining</p>'),rn=p('<div class="channel-divinity-option svelte-1kpvv0n"><button class="btn btn-primary use-enabled svelte-1kpvv0n">Use Channel Divinity</button> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div> <!></div>'),on=p('<div class="feature-box svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"><!> </h3> <p class="feature-description svelte-1kpvv0n"> </p> <!></div>'),cn=p('<div class="features-grid svelte-1kpvv0n"><!> <!></div>'),vn=p("<section><!> <!></section>");function dn(l,o){zt(o,!1);const t=()=>rt(de,"$character",m),v=()=>rt(Fa,"$abilityModifiers",m),u=()=>rt(ha,"$searchFilter",m),f=()=>rt(ea,"$collapsedStates",m),[m,k]=va(),y=$(),w=$(),U=$(),F=$(),re=$(),be=$(),ve=$();let Z=$(0),E=$(0);function H(g,R){de.update(Q=>(Q.classFeatures.features[g]=R,Q))}function we(){de.update(g=>(g.classFeatures.spellSlotsByLevel||(g.classFeatures.spellSlotsByLevel={}),e(F).forEach(({level:R,slots:Q})=>{g.classFeatures.spellSlotsByLevel[R]||(g.classFeatures.spellSlotsByLevel[R]=Array(Q).fill(!1))}),g))}function Ee(g){if(typeof g.maxUses=="function"){if((g.name==="Divine Sense"||g.name==="War Priest")&&e(y)?.spellcastingAbility){const R=v()[e(y).spellcastingAbility];return g.maxUses(t().level,R)}return g.maxUses(t().level)}return g.maxUses||0}function ge(g,R){de.update(Q=>((!Q.classFeatures.features[g]||!Array.isArray(Q.classFeatures.features[g])||Q.classFeatures.features[g].length!==R)&&(Q.classFeatures.features[g]=Array(R).fill(!1)),Q))}Ms(()=>{e(be)&&t()&&t().classFeatures&&t().classFeatures.features&&e(be).forEach(g=>{if(g.type==="uses"){const R=g.name.replace(/\s+/g,""),Q=Ee(g),He=t().classFeatures.features[R];(!Array.isArray(He)||He.length!==Q)&&ge(R,Q)}})});function Fe(g){return typeof g.maxPool=="function"?g.maxPool(t().level):g.maxPool||0}function Qe(g){return typeof g.description=="function"?g.description(t().level):g.description}function ue(){const g="ChannelDivinity";de.update(R=>{const Q=R.classFeatures.features[g];return typeof Q=="number"&&Q>0&&(R.classFeatures.features[g]=Q-1),R})}function De(){ea.update(g=>({...g,classFeatures:!g.classFeatures}))}Ye(()=>(t(),aa),()=>{r(y,t().class?aa(t().class):null)}),Ye(()=>(t(),$a),()=>{r(w,t().class?$a(t().class,t().level,t().subclass):[])}),Ye(()=>(t(),ps),()=>{r(U,t().class?ps(t().class,t().level):0)}),Ye(()=>(e(y),t()),()=>{r(F,(()=>{if(!e(y)?.spellcaster)return[];const g=t().level,R=[];return g>=1&&R.push({level:1,slots:Math.min(4,2+Math.floor(g/3))}),g>=3&&R.push({level:2,slots:Math.min(3,2+Math.floor((g-3)/4))}),g>=5&&R.push({level:3,slots:Math.min(3,2+Math.floor((g-5)/5))}),g>=7&&R.push({level:4,slots:Math.min(3,1+Math.floor((g-7)/6))}),g>=9&&R.push({level:5,slots:Math.min(2,1+Math.floor((g-9)/8))}),g>=11&&R.push({level:6,slots:1}),g>=13&&R.push({level:7,slots:1}),g>=15&&R.push({level:8,slots:1}),g>=17&&R.push({level:9,slots:1}),R})())}),Ye(()=>(e(y),v(),t(),fs),()=>{if(e(y)?.spellcaster&&e(y).spellcastingAbility){const g=v()[e(y).spellcastingAbility];r(Z,ul(t().class,g,t().proficiencyBonus)||0),r(E,fs(t().class,t().level,g))}}),Ye(()=>(t(),e(y),e(F)),()=>{t().class&&e(y)?.spellcaster&&e(F).length>0&&we()}),Ye(()=>t(),()=>{r(re,(()=>{const R=t().classFeatures.features["ChannelDivinity"];return typeof R=="number"?R:0})())}),Ye(()=>(e(w),u()),()=>{r(be,e(w).filter(g=>{if(!u())return!0;const R=u().toLowerCase();return g.name.toLowerCase().includes(R)||Qe(g).toLowerCase().includes(R)}))}),Ye(()=>(u(),t(),e(be)),()=>{r(ve,!u()||t().class||"class features".includes(u().toLowerCase())||"spellcasting".includes(u().toLowerCase())||e(be).length>0)}),fa(),Wt();var Ue=vn();let B;var P=i(Ue);{let g=mt(()=>(f(),n(()=>f().classFeatures?"Expand":"Collapse")));xa(P,{title:"Class Features",get collapsed(){return f(),n(()=>f().classFeatures)},get ariaLabel(){return e(g)},onToggle:De})}var _=a(P,2);{var Y=g=>{var R=vt(),Q=je(R);{var He=Ae=>{var Be=Yi();c(Ae,Be)},Ne=Ae=>{var Be=vt(),ot=je(Be);{var et=ct=>{var it=Qi();c(ct,it)},ut=ct=>{var it=cn(),lt=i(it);{var ht=O=>{var T=en(),S=i(T),I=i(S);s(S);var ee=a(S,2),he=i(ee),Le=a(i(he),2),oe=i(Le,!0);s(Le),s(he);var _e=a(he,2),K=a(i(_e),2),A=i(K,!0);s(K),s(_e),s(ee);var Se=a(ee,2);{var Oe=se=>{var d=Zi();_t(d,5,()=>e(F),wt,(ye,pe)=>{let G=()=>e(pe).level,$e=()=>e(pe).slots;const ce=mt(()=>(t(),G(),$e(),n(()=>t().classFeatures.spellSlotsByLevel?.[G()]||Array($e()).fill(!1))));var xe=Xi(),le=i(xe),Te=i(le);s(le);var fe=a(le,2);_t(fe,5,()=>e(ce),wt,(h,V,ie)=>{{let ne=mt(()=>(z(e(ce)),n(()=>e(ce)[ie]||!1)));hs(h,{get checked(){return e(ne)},$$events:{change:q=>{de.update(te=>(te.classFeatures.spellSlotsByLevel||(te.classFeatures.spellSlotsByLevel={}),te.classFeatures.spellSlotsByLevel[G()]||(te.classFeatures.spellSlotsByLevel[G()]=Array($e()).fill(!1)),te.classFeatures.spellSlotsByLevel[G()][ie]=q.detail.checked,te))}}})}}),s(fe),s(xe),j(()=>D(Te,`${G()===1?"1st":G()===2?"2nd":G()===3?"3rd":`${G()}th`} Level Spell Slots`)),c(ye,xe)}),s(d),c(se,d)};b(Se,se=>{e(F),n(()=>e(F).length>0)&&se(Oe)})}var Re=a(Se,2),Xe=a(i(Re),2);_a(Xe),s(Re),s(T),j(se=>{D(I,`Spellcasting (${se??""})`),D(oe,e(Z)),D(A,e(E))},[()=>(e(y),n(()=>e(y).spellcastingAbility?.toUpperCase()))]),Ie(Xe,()=>t().classFeatures.preparedSpells,se=>Lt(de,n(t).classFeatures.preparedSpells=se,n(t))),c(O,T)};b(lt,O=>{e(y),n(()=>e(y)?.spellcaster)&&O(ht)})}var x=a(lt,2);_t(x,1,()=>e(be),wt,(O,T)=>{const S=mt(()=>(e(T),n(()=>e(T).name.replace(/\s+/g,"")))),I=mt(()=>(t(),z(e(S)),n(()=>t().classFeatures.features[e(S)]))),ee=mt(()=>typeof e(I)=="number");var he=on(),Le=i(he),oe=i(Le);{var _e=se=>{var d=Ht("Channel Divinity:");c(se,d)};b(oe,se=>{e(T),n(()=>e(T).type==="channelDivinity")&&se(_e)})}var K=a(oe);s(Le);var A=a(Le,2),Se=i(A,!0);s(A);var Oe=a(A,2);{var Re=se=>{const d=mt(()=>(e(T),n(()=>Ee(e(T))))),ye=mt(()=>(z(e(I)),z(e(d)),n(()=>Array.isArray(e(I))?e(I):Array(e(d)).fill(!1))));var pe=sn(),G=i(pe);{var $e=xe=>{var le=tn();c(xe,le)},ce=xe=>{var le=an(),Te=je(le);_t(Te,5,()=>e(ye),wt,(te,Pe,J)=>{hs(te,{get checked(){return e(Pe)},index:J,$$events:{change:Me=>{de.update(ke=>(ke.classFeatures.features[e(S)]||(ke.classFeatures.features[e(S)]=Array(e(d)).fill(!1)),ke.classFeatures.features[e(S)][J]=Me.detail.checked,ke))}}})}),s(Te);var fe=a(Te,2),h=i(fe),V=i(h);s(h),s(fe);var ie=a(fe,2),ne=i(ie),q=i(ne);s(ne),s(ie),j(te=>{h.disabled=te,D(V,`Use ${e(T),n(()=>e(T).name)??""}`),D(q,`Resets on ${e(T),n(()=>e(T).resetOn==="short"?"Short Rest":"Long Rest")??""}`)},[()=>(z(e(ye)),n(()=>e(ye).filter(te=>!te).length<=0))]),L("click",h,()=>{de.update(te=>{te.classFeatures.features[e(S)]||(te.classFeatures.features[e(S)]=Array(e(d)).fill(!1));const Pe=te.classFeatures.features[e(S)],J=Pe.findIndex(Me=>!Me);return J!==-1&&(Pe[J]=!0),te})}),c(xe,le)};b(G,xe=>{e(d)===1/0?xe($e):xe(ce,!1)})}s(pe),c(se,pe)},Xe=se=>{var d=vt(),ye=je(d);{var pe=$e=>{const ce=mt(()=>(e(T),n(()=>Fe(e(T)))));var xe=ln(),le=i(xe);Ce(le);var Te=a(le,2),fe=i(Te);s(Te);var h=a(Te,2),V=i(h,!0);s(h),s(xe),j(()=>{Ba(le,e(ee)&&e(I)!==void 0?e(I):e(ce)),Je(le,"max",e(ce)),D(fe,`/ ${e(ce)??""}`),D(V,(e(T),n(()=>e(T).resetOn==="short"?"Short Rest":"Long Rest")))}),L("input",le,ie=>{de.update(ne=>(ne.classFeatures.features[e(S)]=parseInt(ie.currentTarget.value)||0,ne))}),L("click",h,()=>H(e(S),e(ce))),c($e,xe)},G=$e=>{var ce=vt(),xe=je(ce);{var le=Te=>{var fe=rn(),h=i(fe),V=a(h,2),ie=i(V),ne=i(ie);s(ie),s(V);var q=a(V,2);{var te=Pe=>{var J=nn();c(Pe,J)};b(q,Pe=>{e(re)<=0&&Pe(te)})}s(fe),j(()=>{h.disabled=e(re)<=0,D(ne,`Resets on ${e(T),n(()=>e(T).resetOn==="short"?"Short Rest":"Long Rest")??""}`)}),L("click",h,ue),c(Te,fe)};b(xe,Te=>{e(T),n(()=>e(T).type==="channelDivinity")&&Te(le)},!0)}c($e,ce)};b(ye,$e=>{e(T),n(()=>e(T).type==="pool")?$e(pe):$e(G,!1)},!0)}c(se,d)};b(Oe,se=>{e(T),n(()=>e(T).type==="uses")?se(Re):se(Xe,!1)})}s(he),j(se=>{D(K,` ${e(T),n(()=>e(T).name)??""}`),D(Se,se)},[()=>(e(T),n(()=>Qe(e(T))))]),c(O,he)}),s(it),c(ct,it)};b(ot,ct=>{e(w),n(()=>e(w).length===0)?ct(et):ct(ut,!1)},!0)}c(Ae,Be)};b(Q,Ae=>{t(),n(()=>!t().class)?Ae(He):Ae(Ne,!1)})}c(g,R)};b(_,g=>{f(),n(()=>!f().classFeatures)&&g(Y)})}s(Ue),j(()=>B=jt(Ue,1,"class-features svelte-1kpvv0n",null,B,{hidden:!e(ve)})),c(l,Ue),Kt(),k()}var un=p('<textarea placeholder="Enter features, traits, and special abilities..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Equipment</h3> <textarea placeholder="List your equipment and inventory..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Notes</h3> <textarea placeholder="Additional notes..." class="svelte-wttn0l"></textarea>',1),pn=p("<section><!> <!></section>");function fn(l,o){zt(o,!1);const t=()=>rt(ha,"$searchFilter",f),v=()=>rt(de,"$character",f),u=()=>rt(ea,"$collapsedStates",f),[f,m]=va(),k=$();function y(){ea.update(ve=>({...ve,notes:!ve.notes}))}Ye(()=>(t(),v()),()=>{r(k,!t()||"features".includes(t().toLowerCase())||"traits".includes(t().toLowerCase())||"equipment".includes(t().toLowerCase())||"notes".includes(t().toLowerCase())||v().features.toLowerCase().includes(t().toLowerCase())||v().equipment.toLowerCase().includes(t().toLowerCase())||v().notes.toLowerCase().includes(t().toLowerCase()))}),fa(),Wt();var w=pn();let U;var F=i(w);{let ve=mt(()=>(u(),n(()=>u().notes?"Expand":"Collapse")));xa(F,{title:"Features & Traits",get collapsed(){return u(),n(()=>u().notes)},get ariaLabel(){return e(ve)},onToggle:y})}var re=a(F,2);{var be=ve=>{var Z=un(),E=je(Z);_a(E);var H=a(E,4);_a(H);var we=a(H,4);_a(we),Ie(E,()=>v().features,Ee=>Lt(de,n(v).features=Ee,n(v))),Ie(H,()=>v().equipment,Ee=>Lt(de,n(v).equipment=Ee,n(v))),Ie(we,()=>v().notes,Ee=>Lt(de,n(v).notes=Ee,n(v))),c(ve,Z)};b(re,ve=>{u(),n(()=>!u().notes)&&ve(be)})}s(w),j(()=>U=jt(w,1,"notes svelte-wttn0l",null,U,{hidden:!e(k)})),c(l,w),Kt(),m()}var gn=p('<div class="color-picker-section svelte-1r90jgp"><h3 class="svelte-1r90jgp">Dice Colors</h3> <div class="color-inputs svelte-1r90jgp"><div class="color-input-group svelte-1r90jgp"><label for="dice-color" class="svelte-1r90jgp">Dice Color</label> <input type="color" id="dice-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="label-color" class="svelte-1r90jgp">Label Color</label> <input type="color" id="label-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="desk-color" class="svelte-1r90jgp">Background Color</label> <input type="color" id="desk-color" class="svelte-1r90jgp"/></div></div></div>'),mn=p('<div class="loading svelte-1r90jgp"><p class="svelte-1r90jgp">Loading 3D dice...</p></div>'),bn=p('<div class="custom-dice-selector svelte-1r90jgp"><h3 class="svelte-1r90jgp">Choose Dice to Roll</h3> <div class="dice-inputs svelte-1r90jgp"><div class="dice-input-group svelte-1r90jgp"><label for="d4" class="svelte-1r90jgp">d4</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d4" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d6" class="svelte-1r90jgp">d6</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d6" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d8" class="svelte-1r90jgp">d8</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d8" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d10" class="svelte-1r90jgp">d10</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d10" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d12" class="svelte-1r90jgp">d12</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d12" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d20" class="svelte-1r90jgp">d20</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d20" min="0" max="10"/></div></div> <div class="dice-controls svelte-1r90jgp"><button class="btn btn-primary use-enabled svelte-1r90jgp"> </button> <button class="btn btn-secondary use-enabled svelte-1r90jgp">Reset</button></div></div>'),hn=p('<span class="crit-badge svelte-1r90jgp">CRITICAL HIT!</span>'),_n=p('<span class="crit-badge crit-fail svelte-1r90jgp">CRITICAL MISS!</span>'),yn=p('<div class="bonus-item svelte-1r90jgp"><span class="bonus-value svelte-1r90jgp"> </span> <span class="bonus-source svelte-1r90jgp"> </span></div>'),xn=p('<div class="bonus-breakdown svelte-1r90jgp"></div>'),kn=p('<p class="modifier-text svelte-1r90jgp"> </p>'),wn=p('<div class="svelte-1r90jgp"><em class="svelte-1r90jgp">No damage is dealt on a critical miss.</em></div>'),Sn=p('<button class="btn btn-follow-up svelte-1r90jgp"> </button>'),$n=p('<button class="btn btn-guided-strike svelte-1r90jgp">‚ö° Use Guided Strike (+10)</button>'),Cn=p('<div class="follow-up-actions svelte-1r90jgp"><!> <!></div>'),Dn=p('<div class="result-header svelte-1r90jgp"><h3 class="svelte-1r90jgp"> </h3> <!> <!></div> <div class="result-total svelte-1r90jgp"> </div> <div class="result-details svelte-1r90jgp"><!></div> <!> <!>',1),Ln=p('<div role="button" tabindex="-1"><div class="modal-content svelte-1r90jgp" role="dialog" tabindex="0"><div class="modal-header svelte-1r90jgp"><h2 class="svelte-1r90jgp">Dice Roller</h2> <div class="header-buttons svelte-1r90jgp"><button class="color-btn svelte-1r90jgp" title="Customize dice colors">üé®</button> <button class="close-btn svelte-1r90jgp">√ó</button></div></div> <!> <!> <div class="dice-main-area svelte-1r90jgp"><div class="dice-container svelte-1r90jgp"></div> <!></div> <div><!></div></div></div>');function jn(l,o){zt(o,!1);const t=()=>rt(de,"$character",v),[v,u]=va(),f=$(),m=$(),k=$(),y=ya();let w=bt(o,"notation",12,""),U=bt(o,"visible",8,!1),F=bt(o,"damageNotation",12,""),re=bt(o,"attackName",12,""),be=bt(o,"applyHalfDamage",8,!1),ve=bt(o,"bonusBreakdown",28,()=>[]),Z=bt(o,"rollType",12,"other"),E=null,H=$(void 0),we=$(!1),Ee=$(""),ge=$(null);function Fe(){return e(ge)?.resultTotal??null}function Qe(h,V,ie){const ne=[];if(!h||!h.result)return ne;const q=V.match(/([+-]?\d*d\d+|[+-]?\d+)/g)||[];let te=0;const Pe=new Set;for(const J of q){const Me=J.trim();if(!Me)continue;const ke=Me.match(/([+-]?)(\d*)d(\d+)/);if(ke){const tt=parseInt(ke[2]||"1"),nt=`${tt}d${ke[3]}`,gt=ie.findIndex((N,X)=>!Pe.has(X)&&typeof N.value=="string"&&N.value===nt),ft=[];for(let N=0;N<tt&&te<h.result.length;N++)ft.push(h.result[te++]);const st=gt>=0?ie[gt].source:"base die";gt>=0&&Pe.add(gt);for(const N of ft)ne.push({display:`${N}`,source:st})}}for(let J=0;J<ie.length;J++)if(!Pe.has(J)&&typeof ie[J].value=="number"){const Me=ie[J].value;ne.push({display:Me>=0?`+${Me}`:`${Me}`,source:ie[J].source})}return ne}let ue=$(0),De=$(0),Ue=$(0),B=$(0),P=$(0),_=$(0),Y=$(0),g=$([]),R=$(!1),Q=$(!1),He=$(!1),Ne=$("#051e0a"),Ae=$("#ffffff"),Be=$("#3a2004"),ot=$(!1);function et(h){return h.length===9&&h.startsWith("#")?h.substring(0,7):h}function ut(h,V="ff"){return h.length===7&&h.startsWith("#")?h+V:h}function ct(){if(window.DICE&&e(H))try{E&&e(H)&&ga(H,e(H).innerHTML="");const h=e(H).clientWidth||500,V=e(H).clientHeight||300;E=new window.DICE.dice_box(e(H),{w:h,h:V}),r(we,!0)}catch(h){console.error("Error initializing dice box:",h)}}Ca(()=>{const h=ne=>new Promise((q,te)=>{if(document.querySelector(`script[src="${ne}"]`)){q(null);return}const J=document.createElement("script");J.src=ne,J.onload=()=>{q(null)},J.onerror=()=>{console.error(`Failed to load: ${ne}`),te(new Error(`Failed to load ${ne}`))},document.head.appendChild(J)});setTimeout(()=>{h(`${ja}/libs/three.min.js`).then(()=>h(`${ja}/libs/cannon.min.js`)).then(()=>h(`${ja}/libs/teal.js`)).then(()=>h(`${ja}/dice.js`)).then(()=>{if(window.DICE){const ne=window.DICE.getColors();r(Ne,et(ne.dice_color)),r(Ae,et(ne.label_color)),r(Be,et(ne.desk_color))}ct()}).catch(ne=>{console.error("Failed to load dice libraries:",ne)})},100);const V=()=>{e(we)&&ct()},ie=ne=>{U()&&ne.key==="Escape"&&ee()};return window.addEventListener("resize",V),window.addEventListener("keydown",ie),()=>{window.removeEventListener("resize",V),window.removeEventListener("keydown",ie)}});function it(h,V="other"){if(!E||!e(we))return;r(ge,null),r(g,[]),r(R,!1),r(Q,!1),V==="damage"&&ve([]),Z(V),r(He,!1),E.diceToRoll=h;const ie=q=>null,ne=q=>{let te=q.resultTotal,Pe=q.resultString;if(be()&&(te=Math.floor(te/2),Pe=Pe+" (halved)"),r(ge,{...q,resultTotal:te,resultString:Pe}),console.log("Final roll result:",e(ge)),console.log({type:V}),V==="attack"&&q.result&&q.result.length>0){const J=q.result[0];r(R,J===20),r(Q,J===1)}if(r(g,[]),console.log("Setting up follow-up actions. Type:",V,"damageNotation:",F(),"isCriticalSuccess:",e(R),"isCriticalFail:",e(Q)),V==="attack"&&F())if(e(R)){const J=x(F());e(g).push({label:`Roll Critical Damage (${J})`,notation:J})}else e(Q)||e(g).push({label:`Roll Damage (${F()})`,notation:F()})};E.start_throw(ie,ne)}function lt(){const h=[];e(ue)>0&&h.push(`${e(ue)}d4`),e(De)>0&&h.push(`${e(De)}d6`),e(Ue)>0&&h.push(`${e(Ue)}d8`),e(B)>0&&h.push(`${e(B)}d10`),e(P)>0&&h.push(`${e(P)}d12`),e(_)>0&&h.push(`${e(_)}d20`);let V=h.join("+")||"1d20";return e(Y)!==0&&(V+=e(Y)>=0?`+${e(Y)}`:`${e(Y)}`),V}function ht(){const h=lt();it(h)}function x(h){return h.replace(/(\d+)d(\d+)/g,(V,ie,ne)=>`${parseInt(ie)*2}d${ne}`)}function O(){r(ue,0),r(De,0),r(Ue,0),r(B,0),r(P,0),r(_,0),r(Y,0),r(ge,null),r(g,[]),r(R,!1),r(Q,!1),Z("other"),r(He,!1)}function T(){window.DICE&&(window.DICE.setColors({dice_color:ut(e(Ne),"ff"),label_color:ut(e(Ae),"ff"),desk_color:e(Be)}),E&&(E.updateDeskColor(e(Be)),E.updateDiceColors()))}function S(){r(ot,!e(ot))}function I(){!e(ge)||e(m)<=0||e(He)||(r(ge,{...e(ge),resultTotal:e(ge).resultTotal+10,resultString:e(ge).resultString+" + 10 (Guided Strike)"}),de.update(h=>{const V="ChannelDivinity",ie=h.classFeatures.features[V];return typeof ie=="number"&&ie>0&&(h.classFeatures.features[V]=ie-1),h}),r(He,!0))}function ee(){y("close"),w(""),F(""),re(""),r(Ee,""),r(ge,null),r(He,!1),r(R,!1),r(Q,!1),O()}Ye(()=>(t(),$a),()=>{r(f,t().class?$a(t().class,t().level,t().subclass).some(V=>V.name==="Guided Strike"):!1)}),Ye(()=>t(),()=>{r(m,(()=>{const V=t().classFeatures.features["ChannelDivinity"];return typeof V=="number"?V:0})())}),Ye(()=>(e(ue),e(De),e(Ue),e(B),e(P),e(_),e(Y)),()=>{r(k,(()=>{const h=[];e(ue)>0&&h.push(`${e(ue)}d4`),e(De)>0&&h.push(`${e(De)}d6`),e(Ue)>0&&h.push(`${e(Ue)}d8`),e(B)>0&&h.push(`${e(B)}d10`),e(P)>0&&h.push(`${e(P)}d12`),e(_)>0&&h.push(`${e(_)}d20`);let V=h.join("+")||"1d20";return e(Y)!==0&&(V+=e(Y)>=0?`+${e(Y)}`:`${e(Y)}`),V})())}),Ye(()=>(z(w()),e(we),z(U()),e(Ee),z(F()),z(re()),z(Z())),()=>{w()&&e(we)&&U()&&w()!==e(Ee)&&(r(Ee,w()),r(ge,null),r(g,[]),r(R,!1),r(Q,!1),r(He,!1),console.log("Auto-roll triggered. notation:",w(),"damageNotation:",F(),"attackName:",re(),"rollType:",Z()),setTimeout(()=>it(w(),Z()),200))}),fa();var he={getLastRollTotal:Fe};Wt();var Le=Ln();let oe;var _e=i(Le),K=i(_e),A=a(i(K),2),Se=i(A),Oe=a(Se,2);s(A),s(K);var Re=a(K,2);{var Xe=h=>{var V=gn(),ie=a(i(V),2),ne=i(ie),q=a(i(ne),2);Ce(q),s(ne);var te=a(ne,2),Pe=a(i(te),2);Ce(Pe),s(te);var J=a(te,2),Me=a(i(J),2);Ce(Me),s(J),s(ie),s(V),Ie(q,()=>e(Ne),ke=>r(Ne,ke)),L("change",q,T),Ie(Pe,()=>e(Ae),ke=>r(Ae,ke)),L("change",Pe,T),Ie(Me,()=>e(Be),ke=>r(Be,ke)),L("change",Me,T),c(h,V)};b(Re,h=>{e(ot)&&h(Xe)})}var se=a(Re,2);{var d=h=>{var V=mn();c(h,V)};b(se,h=>{e(we)||h(d)})}var ye=a(se,2),pe=i(ye);Ra(pe,h=>r(H,h),()=>e(H));var G=a(pe,2);{var $e=h=>{var V=bn(),ie=a(i(V),2),ne=i(ie),q=a(i(ne),2);Ce(q),s(ne);var te=a(ne,2),Pe=a(i(te),2);Ce(Pe),s(te);var J=a(te,2),Me=a(i(J),2);Ce(Me),s(J);var ke=a(J,2),tt=a(i(ke),2);Ce(tt),s(ke);var nt=a(ke,2),gt=a(i(nt),2);Ce(gt),s(nt);var ft=a(nt,2),st=a(i(ft),2);Ce(st),s(ft),s(ie);var N=a(ie,2),X=i(N),pt=i(X);s(X);var Ke=a(X,2);s(N),s(V),j(()=>{X.disabled=!e(we),D(pt,`Roll ${e(k)??""}`)}),Ie(q,()=>e(ue),Ge=>r(ue,Ge)),Ie(Pe,()=>e(De),Ge=>r(De,Ge)),Ie(Me,()=>e(Ue),Ge=>r(Ue,Ge)),Ie(tt,()=>e(B),Ge=>r(B,Ge)),Ie(gt,()=>e(P),Ge=>r(P,Ge)),Ie(st,()=>e(_),Ge=>r(_,Ge)),L("click",X,ht),L("click",Ke,O),c(h,V)};b(G,h=>{w()||h($e)})}s(ye);var ce=a(ye,2);let xe;var le=i(ce);{var Te=h=>{var V=Dn(),ie=je(V),ne=i(ie),q=i(ne,!0);s(ne);var te=a(ne,2);{var Pe=Ke=>{var Ge=hn();c(Ke,Ge)};b(te,Ke=>{e(R)&&Ke(Pe)})}var J=a(te,2);{var Me=Ke=>{var Ge=_n();c(Ke,Ge)};b(J,Ke=>{e(Q)&&Ke(Me)})}s(ie);var ke=a(ie,2),tt=i(ke,!0);s(ke);var nt=a(ke,2),gt=i(nt);{var ft=Ke=>{var Ge=vt(),C=je(Ge);{var M=qe=>{var ae=xn();_t(ae,5,()=>(e(ge),z(w()),z(ve()),n(()=>Qe(e(ge),w(),ve()))),wt,(ze,me)=>{var at=yn(),Ve=i(at),It=i(Ve,!0);s(Ve);var At=a(Ve,2),Vt=i(At);s(At),s(at),j(()=>{D(It,(e(me),n(()=>e(me).display))),D(Vt,`(${e(me),n(()=>e(me).source)??""})`)}),c(ze,at)}),s(ae),c(qe,ae)},W=qe=>{var ae=vt(),ze=je(ae);{var me=at=>{var Ve=kn(),It=i(Ve);s(Ve),j(()=>D(It,`Modifier: ${e(ge),n(()=>e(ge).constant>=0?"+":"")??""}${e(ge),n(()=>e(ge).constant)??""}`)),c(at,Ve)};b(ze,at=>{e(ge),n(()=>e(ge).constant)&&at(me)},!0)}c(qe,ae)};b(C,qe=>{z(ve()),n(()=>ve().length>0)?qe(M):qe(W,!1)})}c(Ke,Ge)};b(gt,Ke=>{e(ge),z(ve()),n(()=>e(ge).constant||ve().length>0)&&Ke(ft)})}s(nt);var st=a(nt,2);{var N=Ke=>{var Ge=wn();c(Ke,Ge)};b(st,Ke=>{e(Q)&&Ke(N)})}var X=a(st,2);{var pt=Ke=>{var Ge=Cn(),C=i(Ge);_t(C,1,()=>e(g),wt,(qe,ae)=>{var ze=Sn(),me=i(ze,!0);s(ze),j(()=>D(me,(e(ae),n(()=>e(ae).label)))),L("click",ze,()=>it(e(ae).notation,"damage")),c(qe,ze)});var M=a(C,2);{var W=qe=>{var ae=$n();j(()=>{ae.disabled=e(m)<=0,Je(ae,"title",e(m)<=0?"No Channel Divinity uses remaining":"Use Channel Divinity to add +10 to this attack roll")}),L("click",ae,I),c(qe,ae)};b(M,qe=>{e(f)&&Z()==="attack"&&!e(He)&&e(m)>0&&!e(Q)&&qe(W)})}s(Ge),c(Ke,Ge)};b(X,Ke=>{e(g),e(f),z(Z()),e(He),e(m),n(()=>e(g).length>0||e(f)&&Z()==="attack"&&!e(He)&&e(m)>0)&&Ke(pt)})}j(()=>{D(q,re()?`${re()} - Result`:"Result"),D(tt,(e(ge),n(()=>e(ge).resultTotal)))}),c(h,V)};b(le,h=>{e(ge)&&h(Te)})}s(ce),s(_e),s(Le),j(()=>{oe=jt(Le,1,"modal-overlay svelte-1r90jgp",null,oe,{hidden:!U()}),xe=jt(ce,1,"roll-result svelte-1r90jgp",null,xe,{"has-result":e(ge)})}),L("click",Se,S),L("click",Oe,ee),L("click",_e,ns(function(h){Sa.call(this,o,h)})),L("keydown",_e,function(h){Sa.call(this,o,h)}),L("click",Le,ee),L("keydown",Le,h=>h.key==="Escape"&&ee()),c(l,Le),vl(o,"getLastRollTotal",Fe);var fe=Kt(he);return u(),fe}const Ga="https://api.github.com/gists";async function An(l,o,t){if(!o)throw new Error("GitHub token is required");const v=JSON.stringify(l,null,2),u=`${l.name||"character"}_dnd.json`,f={description:t||`D&D Character: ${l.name}`,public:!1,files:{[u]:{content:v}}},m=await fetch(Ga,{method:"POST",headers:{Authorization:`token ${o}`,"Content-Type":"application/json"},body:JSON.stringify(f)});if(!m.ok)throw new Error(`Failed to create gist: ${m.statusText}`);return(await m.json()).id}async function Bn(l,o,t){if(!o||!t)throw new Error("GitHub token and Gist ID are required");const v=JSON.stringify(l,null,2),f={files:{[`${l.name||"character"}_dnd.json`]:{content:v}}},m=await fetch(`${Ga}/${t}`,{method:"PATCH",headers:{Authorization:`token ${o}`,"Content-Type":"application/json"},body:JSON.stringify(f)});if(!m.ok)throw new Error(`Failed to update gist: ${m.statusText}`)}async function Rn(l,o){if(!l)throw new Error("Gist ID is required");const t={"Content-Type":"application/json"};o&&(t.Authorization=`token ${o}`);const v=await fetch(`${Ga}/${l}`,{method:"GET",headers:t});if(!v.ok)throw new Error(`Failed to load gist: ${v.statusText}`);const u=await v.json(),f=Object.values(u.files);if(f.length===0)throw new Error("No files found in gist");const k=f[0].content;try{const y=JSON.parse(k);return y.attacks&&Array.isArray(y.attacks)&&(y.attacks=y.attacks.map(w=>({...w,id:w.id||crypto.randomUUID()}))),y.classFeatures?(y.classFeatures.features||(y.classFeatures.features={}),y.classFeatures.spellSlots||(y.classFeatures.spellSlots=[]),y.classFeatures.preparedSpells===void 0&&(y.classFeatures.preparedSpells="")):y.classFeatures={features:{},spellSlots:[],preparedSpells:""},y}catch{throw new Error("Invalid character data in gist")}}function _s(l){typeof window<"u"&&localStorage.setItem("dnd_gist_config",JSON.stringify(l))}function Mn(){if(typeof window<"u"){const l=localStorage.getItem("dnd_gist_config");if(l)return JSON.parse(l)}return{}}async function Fn(l,o=30){if(!l)throw new Error("GitHub token is required to list gists");const t=await fetch(`${Ga}?per_page=${o}`,{method:"GET",headers:{Authorization:`token ${l}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error(`Failed to list gists: ${t.statusText}`);return await t.json()}var Pn=p('<div class="error-message svelte-1jb5ckg"> </div>'),Tn=p('<div class="toggle-container svelte-1jb5ckg"><button type="button" class="toggle-btn svelte-1jb5ckg"> </button></div>'),In=p('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID (leave empty to create new)</label> <input type="text" id="gistId" placeholder="Optional: existing Gist ID to update" class="svelte-1jb5ckg"/></div>'),En=p('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),Un=p('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),Hn=p('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Update (or leave unselected to create new)</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),Nn=p('<div class="info-message svelte-1jb5ckg">No gists found. A new one will be created.</div>'),On=p('<!> <div class="form-group svelte-1jb5ckg"><label for="description" class="svelte-1jb5ckg"> </label> <input type="text" id="description" placeholder="D&amp;D Character Sheet" class="svelte-1jb5ckg"/></div>',1),Gn=p('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID *</label> <input type="text" id="gistId" placeholder="Enter Gist ID (for public or your private gists)" required class="svelte-1jb5ckg"/></div>'),qn=p('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),Wn=p('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),zn=p('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Load</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),Kn=p('<div class="info-message svelte-1jb5ckg">No gists found. Enter a Gist ID manually or create a new one in Save mode.</div>'),Vn=p('<div class="modal-overlay svelte-1jb5ckg" role="button" tabindex="-1"><div class="modal-content svelte-1jb5ckg" role="dialog" tabindex="0"><div class="modal-header svelte-1jb5ckg"><h2 class="svelte-1jb5ckg"> </h2> <button class="close-btn svelte-1jb5ckg">√ó</button></div> <div class="modal-body svelte-1jb5ckg"><!> <div class="form-group svelte-1jb5ckg"><label for="token" class="svelte-1jb5ckg"> <a href="https://github.com/settings/tokens" target="_blank" rel="noopener" class="svelte-1jb5ckg">Get token</a></label> <input type="password" id="token" placeholder="ghp_xxxxxxxxxxxxx" class="svelte-1jb5ckg"/></div> <!> <!> <div class="modal-actions svelte-1jb5ckg"><button class="btn btn-primary svelte-1jb5ckg"><!></button> <button class="btn btn-secondary svelte-1jb5ckg">Cancel</button></div></div></div></div>');function Jn(l,o){zt(o,!1);const t=()=>rt(de,"$character",v),[v,u]=va(),f=ya();let m=bt(o,"mode",8,"save"),k=$(""),y=$(""),w=$(""),U=$(!1),F=$(""),re=$(!1),be=$(!1),ve=$([]),Z=$(null);const E=Mn();E.token&&r(k,E.token),E.gistId&&r(y,E.gistId),Ca(async()=>{e(k)&&!e(re)&&await H()});async function H(){if(e(k)){r(be,!0),r(F,"");try{r(ve,await Fn(e(k))),e(y)&&r(Z,e(ve).find(S=>S.id===e(y))||null)}catch(S){r(F,S.message||"Failed to load gists"),r(ve,[])}finally{r(be,!1)}}}function we(S){r(Z,S),r(y,S.id)}function Ee(){r(re,!e(re)),r(F,""),!e(re)&&e(k)&&H()}async function ge(){if(!e(k)){r(F,"GitHub token is required");return}const S=e(Z)?.id||e(y);r(U,!0),r(F,"");try{if(S)await Bn(t(),e(k),S),r(y,S),qt.add("Character updated in Gist successfully!","success");else{const I=await An(t(),e(k),e(w));r(y,I),qt.add(`Character saved to Gist! ID: ${I}`,"success")}_s({token:e(k),gistId:e(y)}),f("close")}catch(I){r(F,I.message||"Failed to save to Gist")}finally{r(U,!1)}}async function Fe(){const S=e(Z)?.id||e(y);if(!S){r(F,"Please select a gist or enter a Gist ID");return}r(U,!0),r(F,"");try{const I=await Rn(S,e(k)||void 0);de.set(I),r(y,S),_s({token:e(k),gistId:e(y)}),qt.add("Character loaded from Gist successfully!","success"),f("close")}catch(I){r(F,I.message||"Failed to load from Gist")}finally{r(U,!1)}}function Qe(){f("close")}Wt();var ue=Vn(),De=i(ue),Ue=i(De),B=i(Ue),P=i(B,!0);s(B);var _=a(B,2);s(Ue);var Y=a(Ue,2),g=i(Y);{var R=S=>{var I=Pn(),ee=i(I,!0);s(I),j(()=>D(ee,e(F))),c(S,I)};b(g,S=>{e(F)&&S(R)})}var Q=a(g,2),He=i(Q),Ne=i(He);Gt(),s(He);var Ae=a(He,2);Ce(Ae),s(Q);var Be=a(Q,2);{var ot=S=>{var I=Tn(),ee=i(I),he=i(ee,!0);s(ee),s(I),j(()=>{ee.disabled=e(U),D(he,e(re)?"üìã Show My Gists":"‚úèÔ∏è Enter Gist ID Manually")}),L("click",ee,Ee),c(S,I)};b(Be,S=>{(m()==="load"||m()==="save"&&e(k))&&S(ot)})}var et=a(Be,2);{var ut=S=>{var I=On(),ee=je(I);{var he=Se=>{var Oe=In(),Re=a(i(Oe),2);Ce(Re),s(Oe),j(()=>Re.disabled=e(U)),Ie(Re,()=>e(y),Xe=>r(y,Xe)),c(Se,Oe)},Le=Se=>{var Oe=vt(),Re=je(Oe);{var Xe=d=>{var ye=En();c(d,ye)},se=d=>{var ye=vt(),pe=je(ye);{var G=ce=>{var xe=Hn(),le=a(i(xe),2);_t(le,5,()=>e(ve),wt,(Te,fe)=>{var h=Un();let V;var ie=i(h),ne=i(ie),q=i(ne,!0);s(ne);var te=a(ne,2),Pe=i(te,!0);s(te),s(ie);var J=a(ie,2),Me=i(J),ke=i(Me);s(Me);var tt=a(Me,2),nt=i(tt);s(tt),s(J),s(h),j(gt=>{V=jt(h,1,"gist-item svelte-1jb5ckg",null,V,{selected:e(Z)?.id===e(fe).id}),h.disabled=e(U),D(q,(e(fe),n(()=>e(fe).description||"Untitled"))),D(Pe,(e(fe),n(()=>e(fe).public?"üåê Public":"üîí Private"))),D(ke,`ID: ${e(fe),n(()=>e(fe).id)??""}`),D(nt,`Updated: ${gt??""}`)},[()=>(e(fe),n(()=>new Date(e(fe).updated_at).toLocaleDateString()))]),L("click",h,()=>we(e(fe))),c(Te,h)}),s(le),s(xe),c(ce,xe)},$e=ce=>{var xe=vt(),le=je(xe);{var Te=fe=>{var h=Nn();c(fe,h)};b(le,fe=>{e(k)&&fe(Te)},!0)}c(ce,xe)};b(pe,ce=>{e(ve),n(()=>e(ve).length>0)?ce(G):ce($e,!1)},!0)}c(d,ye)};b(Re,d=>{e(be)?d(Xe):d(se,!1)},!0)}c(Se,Oe)};b(ee,Se=>{e(re)||!e(k)?Se(he):Se(Le,!1)})}var oe=a(ee,2),_e=i(oe),K=i(_e);s(_e);var A=a(_e,2);Ce(A),s(oe),j(()=>{D(K,`Description ${e(y)?"(optional)":""}`),A.disabled=e(U)}),Ie(A,()=>e(w),Se=>r(w,Se)),c(S,I)},ct=S=>{var I=vt(),ee=je(I);{var he=oe=>{var _e=Gn(),K=a(i(_e),2);Ce(K),s(_e),j(()=>K.disabled=e(U)),Ie(K,()=>e(y),A=>r(y,A)),c(oe,_e)},Le=oe=>{var _e=vt(),K=je(_e);{var A=Oe=>{var Re=qn();c(Oe,Re)},Se=Oe=>{var Re=vt(),Xe=je(Re);{var se=ye=>{var pe=zn(),G=a(i(pe),2);_t(G,5,()=>e(ve),wt,($e,ce)=>{var xe=Wn();let le;var Te=i(xe),fe=i(Te),h=i(fe,!0);s(fe);var V=a(fe,2),ie=i(V,!0);s(V),s(Te);var ne=a(Te,2),q=i(ne),te=i(q);s(q);var Pe=a(q,2),J=i(Pe);s(Pe),s(ne),s(xe),j(Me=>{le=jt(xe,1,"gist-item svelte-1jb5ckg",null,le,{selected:e(Z)?.id===e(ce).id}),xe.disabled=e(U),D(h,(e(ce),n(()=>e(ce).description||"Untitled"))),D(ie,(e(ce),n(()=>e(ce).public?"üåê Public":"üîí Private"))),D(te,`ID: ${e(ce),n(()=>e(ce).id)??""}`),D(J,`Updated: ${Me??""}`)},[()=>(e(ce),n(()=>new Date(e(ce).updated_at).toLocaleDateString()))]),L("click",xe,()=>we(e(ce))),c($e,xe)}),s(G),s(pe),c(ye,pe)},d=ye=>{var pe=vt(),G=je(pe);{var $e=ce=>{var xe=Kn();c(ce,xe)};b(G,ce=>{e(k)&&ce($e)},!0)}c(ye,pe)};b(Xe,ye=>{e(ve),n(()=>e(ve).length>0)?ye(se):ye(d,!1)},!0)}c(Oe,Re)};b(K,Oe=>{e(be)?Oe(A):Oe(Se,!1)},!0)}c(oe,_e)};b(ee,oe=>{e(re)||!e(k)?oe(he):oe(Le,!1)},!0)}c(S,I)};b(et,S=>{m()==="save"?S(ut):S(ct,!1)})}var it=a(et,2),lt=i(it),ht=i(lt);{var x=S=>{var I=Ht();j(()=>D(I,m()==="save"?"Saving...":"Loading...")),c(S,I)},O=S=>{var I=Ht();j(()=>D(I,m()==="save"?"Save":"Load")),c(S,I)};b(ht,S=>{e(U)?S(x):S(O,!1)})}s(lt);var T=a(lt,2);s(it),s(Y),s(De),s(ue),j(()=>{D(P,m()==="save"?"Save to GitHub Gist":"Load from GitHub Gist"),D(Ne,`GitHub Token ${m()==="load"?"(optional for public gists)":"(required)"} `),Ae.disabled=e(U),lt.disabled=e(U),T.disabled=e(U)}),L("click",_,Qe),Ie(Ae,()=>e(k),S=>r(k,S)),L("blur",Ae,()=>{e(k)&&!e(re)&&H()}),L("click",lt,function(...S){(m()==="save"?ge:Fe)?.apply(this,S)}),L("click",T,Qe),L("click",De,ns(function(S){Sa.call(this,o,S)})),L("keydown",De,function(S){Sa.call(this,o,S)}),L("click",ue,Qe),L("keydown",ue,S=>S.key==="Escape"&&Qe()),c(l,ue),Kt(),u()}var Yn=p('<div class="loading svelte-1ngjemu">Loading D&D data...</div>'),Qn=p("<option> </option>"),Xn=p('<select class="level-filter svelte-1ngjemu"><option>All Levels</option><option>Cantrip</option><!></select>'),Zn=p('<div class="no-results svelte-1ngjemu"> </div>'),er=p('<div class="item-meta svelte-1ngjemu"> </div>'),tr=p('<div class="item-meta svelte-1ngjemu"> </div>'),ar=p('<button><div class="item-name svelte-1ngjemu"> </div> <!></button>'),sr=p('<p class="higher-levels"><strong>At Higher Levels:</strong> </p>'),lr=p('<p class="cantrip-upgrade"><strong>Cantrip Upgrade:</strong> </p>'),ir=p('<h3 class="svelte-1ngjemu"> </h3> <p class="spell-meta svelte-1ngjemu"><!> <!></p> <p class="spell-classes"><strong>Classes:</strong> </p> <div class="spell-stats svelte-1ngjemu"><div><strong>Casting Time:</strong> </div> <div><strong>Range:</strong> </div> <div><strong>Components:</strong> <!></div> <div><strong>Duration:</strong> <!> </div></div> <p class="description svelte-1ngjemu"> </p> <!> <!>',1),nr=p('<p class="prerequisite svelte-1ngjemu"><strong>Prerequisite:</strong> </p>'),rr=p('<h3 class="svelte-1ngjemu"> </h3> <!> <p class="description svelte-1ngjemu"> </p> <a target="_blank" rel="noopener" class="source-link svelte-1ngjemu">View Full Details ‚Üí</a>',1),or=p('<div class="item-details svelte-1ngjemu"><!></div>'),cr=p('<div class="controls svelte-1ngjemu"><div class="tabs svelte-1ngjemu"><button> </button> <button> </button></div> <div class="search-controls svelte-1ngjemu"><input type="text" placeholder="Search by name or description..." class="search-input svelte-1ngjemu"/> <!></div></div> <div class="content-container svelte-1ngjemu"><div class="items-list svelte-1ngjemu"><!></div> <!></div>',1),vr=p('<div class="modal-backdrop svelte-1ngjemu" role="presentation"><div class="modal svelte-1ngjemu" role="dialog" aria-modal="true" tabindex="-1"><div class="modal-header svelte-1ngjemu"><h2 class="svelte-1ngjemu">Browse D&D Spells & Feats</h2> <button class="close-btn svelte-1ngjemu" aria-label="Close">&times;</button></div> <div class="modal-body svelte-1ngjemu"><!></div> <div class="modal-footer svelte-1ngjemu"><button class="btn-secondary svelte-1ngjemu">Cancel</button> <button class="btn-primary svelte-1ngjemu">Add to Character Sheet</button></div></div></div>');function dr(l,o){zt(o,!1);const t=$(),v=$(),u=$();let f=bt(o,"onClose",8),m=$("spell"),k=$(!0),y=$(""),w=$(null),U=$([]),F=$([]),re=$(null);Ca(async()=>{r(k,!0);try{r(U,await js()),r(F,await Jl())}catch(_){console.error("Failed to load data:",_)}finally{r(k,!1)}});function be(_){r(re,_)}function ve(_){const Y=_.match(/(\d+d\d+(?:\s*\+\s*\d+)?)/i);return Y?Y[1]:""}function Z(_){const Y=_.split(/\.( |$)/)[0].trim(),g=Array.from(_.matchAll(/\*\*(.*?)\*\*/g)).map(Q=>Q[1].replace(/\.$/,""));let R=Y;return g.length&&(R+=" | Effects: "+g.join(", ")),R}function E(){if(e(re)){if(e(m)==="spell"){const _=e(re);de.update(Y=>{const R=[];_.range&&R.push(`Range: ${_.range}`),_.castingTime&&R.push(`Cast: ${_.castingTime}`),_.duration&&R.push(`Duration: ${_.duration}`),_.actionType==="Save"&&R.push("Saving throw spell"),_.components&&_.components.length>0&&R.push(`Components: ${_.components.join(", ")}`),_.material&&R.push(`Material: ${_.material}`);const Q=R.join(" | "),He=Z(_.description),Ne={id:crypto.randomUUID(),name:`${_.name}${_.concentration?" (C)":""}${_.ritual?" (R)":""}`,bonus:_.actionType==="Attack"?5:0,damage:ve(_.description),damageType:`${_.school} (Lvl ${_.level})`,spellRef:_.name,infoNotes:Q,generalNotes:He,castAtLevel:_.level};return Y.attacks=[...Y.attacks,Ne],Y})}else if(e(m)==="feat"){const _=e(re);de.update(Y=>{const g=`${_.name}${_.prerequisite?` (Req: ${_.prerequisite})`:""}
${_.description}
`;return Y.features=Y.features?`${Y.features}
${g}`:g,Y})}r(re,null),f()()}}Ye(()=>(e(w),e(U),e(y)),()=>{r(t,e(w)!==null?Yl(ms(e(U),e(y)),e(w)):ms(e(U),e(y)))}),Ye(()=>(e(F),e(y)),()=>{r(v,Ql(e(F),e(y)))}),Ye(()=>(e(m),e(t),e(v)),()=>{r(u,e(m)==="spell"?e(t):e(v))}),fa(),Wt();var H=vr(),we=i(H),Ee=i(we),ge=a(i(Ee),2);s(Ee);var Fe=a(Ee,2),Qe=i(Fe);{var ue=_=>{var Y=Yn();c(_,Y)},De=_=>{var Y=cr(),g=je(Y),R=i(g),Q=i(R);let He;var Ne=i(Q);s(Q);var Ae=a(Q,2);let Be;var ot=i(Ae);s(Ae),s(R);var et=a(R,2),ut=i(et);Ce(ut);var ct=a(ut,2);{var it=ee=>{var he=Xn();j(()=>{e(w),Pt(()=>{})});var Le=i(he);Le.value=(Le.__value=null)??"";var oe=a(Le);oe.value=oe.__value=0;var _e=a(oe);_t(_e,0,()=>[1,2,3,4,5,6,7,8,9],wt,(K,A)=>{var Se=Qn(),Oe=i(Se);s(Se);var Re={};j(()=>{D(Oe,`Level ${A??""}`),Re!==(Re=A)&&(Se.value=(Se.__value=A)??"")}),c(K,Se)}),s(he),Ma(he,()=>e(w),K=>r(w,K)),c(ee,he)};b(ct,ee=>{e(m)==="spell"&&ee(it)})}s(et),s(g);var lt=a(g,2),ht=i(lt),x=i(ht);{var O=ee=>{var he=Zn(),Le=i(he);s(he),j(()=>D(Le,`No ${e(m)??""}s found`)),c(ee,he)},T=ee=>{var he=vt(),Le=je(he);_t(Le,1,()=>e(u),wt,(oe,_e)=>{var K=ar();let A;var Se=i(K),Oe=i(Se,!0);s(Se);var Re=a(Se,2);{var Xe=d=>{const ye=mt(()=>e(_e));var pe=er(),G=i(pe);s(pe),j(()=>D(G,`Level ${z(e(ye)),n(()=>e(ye).level)??""} ‚Ä¢ ${z(e(ye)),n(()=>e(ye).school)??""}`)),c(d,pe)},se=d=>{const ye=mt(()=>e(_e));var pe=vt(),G=je(pe);{var $e=ce=>{var xe=tr(),le=i(xe,!0);s(xe),j(()=>D(le,(z(e(ye)),n(()=>e(ye).prerequisite)))),c(ce,xe)};b(G,ce=>{z(e(ye)),n(()=>e(ye).prerequisite)&&ce($e)})}c(d,pe)};b(Re,d=>{e(m)==="spell"?d(Xe):d(se,!1)})}s(K),j(()=>{A=jt(K,1,"item-card svelte-1ngjemu",null,A,{selected:e(re)?.name===e(_e).name}),D(Oe,(e(_e),n(()=>e(_e).name)))}),L("click",K,()=>be(e(_e))),c(oe,K)}),c(ee,he)};b(x,ee=>{e(u),n(()=>e(u).length===0)?ee(O):ee(T,!1)})}s(ht);var S=a(ht,2);{var I=ee=>{var he=or(),Le=i(he);{var oe=K=>{const A=mt(()=>e(re));var Se=ir(),Oe=je(Se),Re=i(Oe,!0);s(Oe);var Xe=a(Oe,2),se=i(Xe);{var d=N=>{var X=Ht();j(()=>D(X,`${z(e(A)),n(()=>e(A).school)??""} cantrip`)),c(N,X)},ye=N=>{var X=Ht();j(()=>D(X,`Level ${z(e(A)),n(()=>e(A).level)??""} ${z(e(A)),n(()=>e(A).school)??""}`)),c(N,X)};b(se,N=>{z(e(A)),n(()=>e(A).level===0)?N(d):N(ye,!1)})}var pe=a(se,2);{var G=N=>{var X=Ht("(ritual)");c(N,X)};b(pe,N=>{z(e(A)),n(()=>e(A).ritual)&&N(G)})}s(Xe);var $e=a(Xe,2),ce=a(i($e));s($e);var xe=a($e,2),le=i(xe),Te=a(i(le));s(le);var fe=a(le,2),h=a(i(fe));s(fe);var V=a(fe,2),ie=a(i(V)),ne=a(ie);{var q=N=>{var X=Ht();j(()=>D(X,`(${z(e(A)),n(()=>e(A).material)??""})`)),c(N,X)};b(ne,N=>{z(e(A)),n(()=>e(A).material)&&N(q)})}s(V);var te=a(V,2),Pe=a(i(te),2);{var J=N=>{var X=Ht("Concentration,");c(N,X)};b(Pe,N=>{z(e(A)),n(()=>e(A).concentration)&&N(J)})}var Me=a(Pe,1,!0);s(te),s(xe);var ke=a(xe,2),tt=i(ke,!0);s(ke);var nt=a(ke,2);{var gt=N=>{var X=sr(),pt=a(i(X));s(X),j(()=>D(pt,` ${z(e(A)),n(()=>e(A).higherLevelSlot)??""}`)),c(N,X)};b(nt,N=>{z(e(A)),n(()=>e(A).higherLevelSlot)&&N(gt)})}var ft=a(nt,2);{var st=N=>{var X=lr(),pt=a(i(X));s(X),j(()=>D(pt,` ${z(e(A)),n(()=>e(A).cantripUpgrade)??""}`)),c(N,X)};b(ft,N=>{z(e(A)),n(()=>e(A).cantripUpgrade)&&N(st)})}j((N,X)=>{D(Re,(z(e(A)),n(()=>e(A).name))),D(ce,` ${N??""}`),D(Te,` ${z(e(A)),n(()=>e(A).castingTime||e(A).actionType)??""}`),D(h,` ${z(e(A)),n(()=>e(A).range)??""}`),D(ie,` ${X??""}`),D(Me,(z(e(A)),n(()=>e(A).duration))),D(tt,(z(e(A)),n(()=>e(A).description)))},[()=>(z(e(A)),n(()=>e(A).classes.join(", "))),()=>(z(e(A)),n(()=>e(A).components.join(", ").toUpperCase()))]),c(K,Se)},_e=K=>{const A=mt(()=>e(re));var Se=rr(),Oe=je(Se),Re=i(Oe,!0);s(Oe);var Xe=a(Oe,2);{var se=G=>{var $e=nr(),ce=a(i($e));s($e),j(()=>D(ce,` ${z(e(A)),n(()=>e(A).prerequisite)??""}`)),c(G,$e)};b(Xe,G=>{z(e(A)),n(()=>e(A).prerequisite)&&G(se)})}var d=a(Xe,2),ye=i(d,!0);s(d);var pe=a(d,2);j(()=>{D(Re,(z(e(A)),n(()=>e(A).name))),D(ye,(z(e(A)),n(()=>e(A).description))),Je(pe,"href",(z(e(A)),n(()=>e(A).source)))}),c(K,Se)};b(Le,K=>{e(m)==="spell"?K(oe):K(_e,!1)})}s(he),c(ee,he)};b(S,ee=>{e(re)&&ee(I)})}s(lt),j(()=>{He=jt(Q,1,"tab svelte-1ngjemu",null,He,{active:e(m)==="spell"}),D(Ne,`üìú Spells (${e(U),n(()=>e(U).length)??""})`),Be=jt(Ae,1,"tab svelte-1ngjemu",null,Be,{active:e(m)==="feat"}),D(ot,`‚≠ê Feats (${e(F),n(()=>e(F).length)??""})`)}),L("click",Q,()=>{r(m,"spell"),r(re,null),r(y,"")}),L("click",Ae,()=>{r(m,"feat"),r(re,null),r(y,"")}),Ie(ut,()=>e(y),ee=>r(y,ee)),c(_,Y)};b(Qe,_=>{e(k)?_(ue):_(De,!1)})}s(Fe);var Ue=a(Fe,2),B=i(Ue),P=a(B,2);s(Ue),s(we),s(H),j(()=>P.disabled=!e(re)),L("click",ge,function(..._){f()?.apply(this,_)}),L("click",B,function(..._){f()?.apply(this,_)}),L("click",P,E),L("click",we,ns(function(_){Sa.call(this,o,_)})),L("keydown",we,function(_){Sa.call(this,o,_)}),L("click",H,function(..._){f()?.apply(this,_)}),L("keydown",H,_=>_.key==="Escape"&&f()()),c(l,H),Kt()}var ur=p('<span class="resistance-tag svelte-gdwwx1"> <button type="button" class="tag-remove svelte-gdwwx1">√ó</button></span>'),pr=p('<div class="resistance-list svelte-gdwwx1"></div>'),fr=p('<p class="ability-meta svelte-gdwwx1"> <!></p>'),gr=p('<p class="ability-meta svelte-gdwwx1">Requires Reaction</p>'),mr=p('<div class="ability-card svelte-gdwwx1"><div class="ability-header svelte-gdwwx1"><strong class="svelte-gdwwx1"> </strong> <button type="button" class="ability-remove svelte-gdwwx1">√ó</button></div> <p class="ability-description svelte-gdwwx1"> </p> <!></div>'),br=p('<div class="abilities-list svelte-gdwwx1"></div>'),hr=p(`<div class="modal-backdrop svelte-gdwwx1" role="presentation"><div class="modal-content svelte-gdwwx1" role="dialog" aria-modal="true" aria-labelledby="modal-title"><div class="modal-header svelte-gdwwx1"><h3 id="modal-title" class="svelte-gdwwx1">Add Custom Condition</h3> <button class="btn-close svelte-gdwwx1" aria-label="Close">√ó</button></div> <div class="modal-body svelte-gdwwx1"><div class="form-group svelte-gdwwx1"><label for="conditionName" class="svelte-gdwwx1">Condition Name*</label> <input type="text" id="conditionName" placeholder="e.g., Cazna's Mark" class="svelte-gdwwx1"/></div> <div class="form-group svelte-gdwwx1"><label for="description" class="svelte-gdwwx1">Description</label> <textarea id="description" placeholder="Describe the condition..." rows="3" class="svelte-gdwwx1"></textarea></div> <div class="form-row svelte-gdwwx1"><div class="form-group svelte-gdwwx1"><label for="attackBonus" class="svelte-gdwwx1">Attack Bonus</label> <input type="text" id="attackBonus" placeholder="0 or 1d4" class="svelte-gdwwx1"/></div> <div class="form-group svelte-gdwwx1"><label for="damageBonus" class="svelte-gdwwx1">Damage Bonus</label> <input type="text" id="damageBonus" placeholder="0 or 1d6" class="svelte-gdwwx1"/></div> <div class="form-group svelte-gdwwx1"><label for="acBonus" class="svelte-gdwwx1">AC Bonus</label> <input type="number" id="acBonus" placeholder="0" class="svelte-gdwwx1"/></div></div> <div class="form-group svelte-gdwwx1"><label for="darkvision" class="svelte-gdwwx1">Darkvision (feet)</label> <input type="number" id="darkvision" placeholder="0" min="0" step="30" class="svelte-gdwwx1"/> <small class="help-text svelte-gdwwx1">Grant or extend darkvision (e.g., 60 for 60 feet)</small></div> <div class="form-group svelte-gdwwx1"><label class="svelte-gdwwx1">Damage Resistances</label> <div class="resistance-input-group svelte-gdwwx1"><input type="text" placeholder="e.g., cold, fire, poison" class="svelte-gdwwx1"/> <button type="button" class="btn-add svelte-gdwwx1">Add</button></div> <!></div> <div class="form-group svelte-gdwwx1"><label class="svelte-gdwwx1">Special Abilities</label> <div class="ability-form svelte-gdwwx1"><input type="text" placeholder="Ability name (e.g., Flicker of Deceit)" class="ability-name-input svelte-gdwwx1"/> <textarea placeholder="Ability description..." rows="2" class="ability-desc-input svelte-gdwwx1"></textarea> <div class="ability-options svelte-gdwwx1"><div class="ability-option svelte-gdwwx1"><label for="abilityUses" class="svelte-gdwwx1">Uses per rest</label> <input type="number" id="abilityUses" min="0" class="svelte-gdwwx1"/></div> <div class="ability-option svelte-gdwwx1"><label for="restType" class="svelte-gdwwx1">Rest type</label> <select id="restType" class="svelte-gdwwx1"><option>Short</option><option>Long</option></select></div> <div class="ability-option svelte-gdwwx1"><label class="svelte-gdwwx1"><input type="checkbox" class="svelte-gdwwx1"/> Requires Reaction</label></div></div> <button type="button" class="btn-add svelte-gdwwx1">Add Ability</button></div> <!></div></div> <div class="modal-footer svelte-gdwwx1"><button class="btn btn-secondary svelte-gdwwx1">Cancel</button> <button class="btn btn-primary svelte-gdwwx1">Add Condition</button></div></div></div>`);function _r(l,o){zt(o,!1);let t=bt(o,"show",8,!1),v=bt(o,"onSave",8),u=bt(o,"onCancel",8),f=$(""),m=$(""),k=$(0),y=$(0),w=$(0),U=$(0),F=$([]),re=$(""),be=$([]),ve=$(""),Z=$(""),E=$(0),H=$("short"),we=$(!1);function Ee(){r(f,""),r(m,""),r(k,0),r(y,0),r(w,0),r(U,0),r(F,[]),r(re,""),r(be,[]),r(ve,""),r(Z,""),r(E,0),r(H,"short"),r(we,!1)}function ge(){e(re).trim()&&(r(F,[...e(F),e(re).trim()]),r(re,""))}function Fe(g){r(F,e(F).filter((R,Q)=>Q!==g))}function Qe(){if(e(ve).trim()&&e(Z).trim()){const g={name:e(ve).trim(),description:e(Z).trim(),requiresReaction:e(we)};e(E)>0&&(g.usesPerRest=e(E),g.currentUses=e(E),g.restType=e(H)),r(be,[...e(be),g]),r(ve,""),r(Z,""),r(E,0),r(H,"short"),r(we,!1)}}function ue(g){r(be,e(be).filter((R,Q)=>Q!==g))}function De(){if(!e(f).trim()){alert("Please enter a condition name");return}const g={name:e(f).trim(),description:e(m).trim()||"Custom condition",attackBonus:e(k)||0,damageBonus:e(y)||0,target:"self"};e(w)!==0&&(g.acBonus=e(w)),e(U)>0&&(g.darkvision=e(U)),e(F).length>0&&(g.resistances=e(F)),e(be).length>0&&(g.abilities=e(be)),v()(g),Ee()}function Ue(){Ee(),u()()}function B(g){g.target===g.currentTarget&&Ue()}Wt();var P=vt(),_=je(P);{var Y=g=>{var R=hr(),Q=i(R),He=i(Q),Ne=a(i(He),2);s(He);var Ae=a(He,2),Be=i(Ae),ot=a(i(Be),2);Ce(ot),s(Be);var et=a(Be,2),ut=a(i(et),2);_a(ut),s(et);var ct=a(et,2),it=i(ct),lt=a(i(it),2);Ce(lt),s(it);var ht=a(it,2),x=a(i(ht),2);Ce(x),s(ht);var O=a(ht,2),T=a(i(O),2);Ce(T),s(O),s(ct);var S=a(ct,2),I=a(i(S),2);Ce(I),Gt(2),s(S);var ee=a(S,2),he=a(i(ee),2),Le=i(he);Ce(Le);var oe=a(Le,2);s(he);var _e=a(he,2);{var K=q=>{var te=pr();_t(te,5,()=>e(F),wt,(Pe,J,Me)=>{var ke=ur(),tt=i(ke),nt=a(tt);s(ke),j(()=>{D(tt,`${e(J)??""} `),Je(nt,"aria-label",`Remove ${e(J)??""}`)}),L("click",nt,()=>Fe(Me)),c(Pe,ke)}),s(te),c(q,te)};b(_e,q=>{e(F),n(()=>e(F).length>0)&&q(K)})}s(ee);var A=a(ee,2),Se=a(i(A),2),Oe=i(Se);Ce(Oe);var Re=a(Oe,2);_a(Re);var Xe=a(Re,2),se=i(Xe),d=a(i(se),2);Ce(d),s(se);var ye=a(se,2),pe=a(i(ye),2);j(()=>{e(H),Pt(()=>{})});var G=i(pe);G.value=G.__value="short";var $e=a(G);$e.value=$e.__value="long",s(pe),s(ye);var ce=a(ye,2),xe=i(ce),le=i(xe);Ce(le),Gt(),s(xe),s(ce),s(Xe);var Te=a(Xe,2);s(Se);var fe=a(Se,2);{var h=q=>{var te=br();_t(te,5,()=>e(be),wt,(Pe,J,Me)=>{var ke=mr(),tt=i(ke),nt=i(tt),gt=i(nt,!0);s(nt);var ft=a(nt,2);s(tt);var st=a(tt,2),N=i(st,!0);s(st);var X=a(st,2);{var pt=Ge=>{var C=fr(),M=i(C),W=a(M);{var qe=ae=>{var ze=Ht("‚Ä¢ Requires Reaction");c(ae,ze)};b(W,ae=>{e(J),n(()=>e(J).requiresReaction)&&ae(qe)})}s(C),j(()=>D(M,`${e(J),n(()=>e(J).usesPerRest)??""} use${e(J),n(()=>e(J).usesPerRest>1?"s":"")??""} per ${e(J),n(()=>e(J).restType)??""}
                      rest `)),c(Ge,C)},Ke=Ge=>{var C=vt(),M=je(C);{var W=qe=>{var ae=gr();c(qe,ae)};b(M,qe=>{e(J),n(()=>e(J).requiresReaction)&&qe(W)},!0)}c(Ge,C)};b(X,Ge=>{e(J),n(()=>e(J).usesPerRest)?Ge(pt):Ge(Ke,!1)})}s(ke),j(()=>{D(gt,(e(J),n(()=>e(J).name))),Je(ft,"aria-label",`Remove ${e(J),n(()=>e(J).name)??""}`),D(N,(e(J),n(()=>e(J).description)))}),L("click",ft,()=>ue(Me)),c(Pe,ke)}),s(te),c(q,te)};b(fe,q=>{e(be),n(()=>e(be).length>0)&&q(h)})}s(A),s(Ae);var V=a(Ae,2),ie=i(V),ne=a(ie,2);s(V),s(Q),s(R),L("click",Ne,Ue),Ie(ot,()=>e(f),q=>r(f,q)),Ie(ut,()=>e(m),q=>r(m,q)),Ie(lt,()=>e(k),q=>r(k,q)),Ie(x,()=>e(y),q=>r(y,q)),Ie(T,()=>e(w),q=>r(w,q)),Ie(I,()=>e(U),q=>r(U,q)),Ie(Le,()=>e(re),q=>r(re,q)),L("keydown",Le,q=>q.key==="Enter"&&ge()),L("click",oe,ge),Ie(Oe,()=>e(ve),q=>r(ve,q)),Ie(Re,()=>e(Z),q=>r(Z,q)),Ie(d,()=>e(E),q=>r(E,q)),Ma(pe,()=>e(H),q=>r(H,q)),wa(le,()=>e(we),q=>r(we,q)),L("click",Te,Qe),L("click",ie,Ue),L("click",ne,De),L("click",R,B),c(g,R)};b(_,g=>{t()&&g(Y)})}c(l,P),Kt()}var yr=p('<link rel="icon" type="image/png" href="favicon4.png"/> <meta name="viewport" content="width=device-width, initial-scale=1"/>',1),xr=p('<span class="character-name svelte-1uha8ag"> </span>'),kr=p("<span> </span>"),wr=p('<div class="spell-slots-header svelte-1uha8ag"></div>'),Sr=p("<span> </span><br/>",1),$r=p("<span> </span><br/>",1),Cr=p("<span> </span><br/>",1),Dr=p("<span> </span><br/>",1),Lr=p("<span> </span><br/>",1),jr=p("<span> </span><br/>",1),Ar=p("<br/><em> <!>)</em>",1),Br=p("<br/><em>(requires reaction)</em>",1),Rr=p('<div class="ability-detail"><strong> </strong> <!></div>'),Mr=p('<div class="abilities-section"><strong>Abilities:</strong><br/> <!></div>'),Fr=p('<span class="effect-tooltip"><strong> </strong><br/> <br/> <!> <!> <!> <!> <!> <!> <!></span>'),Pr=p('<button class="effect-remove-btn svelte-1uha8ag">√ó</button>'),Tr=p('<span class="effect-badge svelte-1uha8ag" tabindex="0"> <!> <!></span>'),Ir=p(`<div class="active-effects-header svelte-1uha8ag"></div> <style>.effect-badge {
              position: relative;
            }
            .effect-tooltip {
              position: absolute;
              top: 120%;
              left: 50%;
              transform: translateX(-50%);
              background: #fff;
              color: #222;
              border: 1px solid #a5b4fc;
              border-radius: 6px;
              padding: 8px 12px;
              font-size: 0.95em;
              box-shadow: 0 2px 8px rgba(0, 0, 0, 0.12);
              z-index: 10;
              min-width: 180px;
              max-width: 300px;
              white-space: normal;
              pointer-events: none;
              opacity: 1;
              transition: opacity 0.15s;
            }

            .abilities-section {
              margin-top: 8px;
              padding-top: 8px;
              border-top: 1px solid #e5e7eb;
            }

            .ability-detail {
              margin-top: 6px;
              padding: 4px;
              background: #f9fafb;
              border-radius: 4px;
              font-size: 0.9em;
            }

            .ability-detail strong {
              color: #6366f1;
            }

            .ability-detail em {
              font-size: 0.85em;
              color: #6b7280;
            }</style>`,1),Er=p('<div class="rest-menu svelte-1uha8ag"><button class="rest-option svelte-1uha8ag">‚òï Short Rest</button> <button class="rest-option svelte-1uha8ag">üõèÔ∏è Long Rest</button></div>'),Ur=p('<div class="container svelte-1uha8ag"><header class="svelte-1uha8ag"><div class="header-top svelte-1uha8ag"><div class="header-title svelte-1uha8ag"><div class="title-row svelte-1uha8ag"><h1 class="svelte-1uha8ag">D&D Character Sheet</h1> <!></div> <!> <!></div> <div class="header-right svelte-1uha8ag"><div class="header-controls svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">üé≤</span><span class="btn-text svelte-1uha8ag">Roll Dice</span></button> <div class="rest-button-container svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">üò¥</span><span class="btn-text svelte-1uha8ag">Rest</span></button> <!></div> <button class="btn btn-secondary use-enabled" title="Add custom condition with effects"><span class="btn-icon svelte-1uha8ag">‚ú®</span><span class="btn-text svelte-1uha8ag">Add Condition</span></button> <div class="mode-toggle"><button><span class="btn-icon svelte-1uha8ag"> </span><span class="btn-text svelte-1uha8ag"> </span></button></div></div> <div class="header-search svelte-1uha8ag"><input type="text" placeholder="üîç Search..." class="search-input use-enabled svelte-1uha8ag"/></div></div></div> <div class="header-actions svelte-1uha8ag"><button class="btn btn-mode svelte-1uha8ag">üìö Browse Spells & Feats</button> <button class="btn btn-secondary">Save to Gist</button> <button class="btn btn-secondary">Load from Gist</button> <button class="btn btn-secondary">Export JSON</button> <button class="btn btn-secondary">Import JSON</button> <input type="file" accept=".json" style="display: none;"/></div></header> <main class="svelte-1uha8ag"><!> <!> <!> <!> <!> <!> <!></main></div> <!> <!> <!> <!> <!>',1);function Vr(l,o){zt(o,!1);const t=()=>rt(de,"$character",f),v=()=>rt(ba,"$isEditMode",f),u=()=>rt(ha,"$searchFilter",f),[f,m]=va();function k(){const C=[],M=t().classFeatures.spellSlotsByLevel||{};for(let W=1;W<=9;W++){const qe=M[W];if(qe&&qe.length>0){const ae=qe.length,ze=qe.filter(me=>me).length;C.push({level:W,available:ae-ze,total:ae})}}return C}let y=$(!1),w=$(!1),U=$(!1),F=$(!1),re=$("save"),be=$(void 0),ve=$(""),Z=$(""),E=$(""),H=$(!1),we=$([]),Ee=$("other"),ge=$(),Fe=!1,Qe=1,ue=$(!1),De=$(null);function Ue(C){r(De,C)}function B(){r(De,null)}function P(C){r(De,e(De)===C?null:C)}function _(C){de.update(M=>(M.activeStates||(M.activeStates=[]),M.activeStates=[...M.activeStates,C],M)),r(F,!1),qt.add(`Added condition: ${C.name}`,"success")}function Y(){r(F,!1)}function g(){const C=[];de.update(W=>{const qe=W.hitDice.current;W.hitDice.current=Math.min(W.hitDice.max,W.hitDice.current+Math.max(1,Math.floor(W.hitDice.max/2)));const ae=W.hitDice.current-qe;if(ae>0&&C.push(`${ae} hit ${ae===1?"die":"dice"}`),W.class){const ze=$a(W.class,W.level,W.subclass);W.classFeatures.features||(W.classFeatures.features={}),ze.forEach(me=>{if(me.resetOn==="short"){const at=me.name.replace(/\s+/g,"");if(me.type==="uses"){const Ve=typeof me.maxUses=="function"?me.maxUses(W.level):me.maxUses;W.classFeatures.features[at]=Array(Ve).fill(!1),C.push(me.name)}else if(me.type==="pool"){const Ve=typeof me.maxPool=="function"?me.maxPool(W.level):me.maxPool;Ve!==void 0&&(W.classFeatures.features[at]=Ve,C.push(me.name))}}})}return W.activeStates&&W.activeStates.forEach(ze=>{ze.abilities&&ze.abilities.forEach(me=>{if(me.restType==="short"&&me.usesPerRest){const at=me.usesPerRest-(me.currentUses||0)>0;me.currentUses=me.usesPerRest,at&&C.push(`${ze.name}: ${me.name}`)}})}),W}),r(ue,!1);const M=C.length>0?`Short rest taken! Restored: ${C.join(", ")}`:"Short rest taken!";qt.add(M,"success")}function R(){const C=[];de.update(W=>{const qe=W.maxHP-W.currentHP;qe>0&&C.push(`${qe} HP`),W.currentHP=W.maxHP,W.tempHP=0;const ae=W.hitDice.max-W.hitDice.current;ae>0&&C.push(`${ae} hit ${ae===1?"die":"dice"}`),W.hitDice.current=W.hitDice.max;let ze=0;if(W.classFeatures.spellSlotsByLevel&&Object.keys(W.classFeatures.spellSlotsByLevel).forEach(me=>{const at=W.classFeatures.spellSlotsByLevel[parseInt(me)];if(at){const Ve=at.filter(It=>It).length;ze+=Ve,W.classFeatures.spellSlotsByLevel[parseInt(me)]=Array(at.length).fill(!1)}}),ze>0&&C.push(`${ze} spell ${ze===1?"slot":"slots"}`),W.class){const me=$a(W.class,W.level,W.subclass);W.classFeatures.features||(W.classFeatures.features={});let at=!1;me.forEach(Ve=>{const It=Ve.name.replace(/\s+/g,"");if(!(Ve.type==="info"||Ve.type==="channelDivinity")){if(Ve.type==="uses"){const At=typeof Ve.maxUses=="function"?Ve.maxUses(W.level):Ve.maxUses;W.classFeatures.features[It]=Array(At).fill(!1),at=!0}else if(Ve.type==="pool"){const At=typeof Ve.maxPool=="function"?Ve.maxPool(W.level):Ve.maxPool;At!==void 0&&(W.classFeatures.features[It]=At,at=!0)}}}),at&&C.push("all class features")}if(W.activeStates){let me=!1;W.activeStates.forEach(at=>{at.abilities&&at.abilities.forEach(Ve=>{if(Ve.usesPerRest){const It=(Ve.currentUses||0)<Ve.usesPerRest;Ve.currentUses=Ve.usesPerRest,It&&(me=!0)}})}),me&&C.push("condition abilities")}return W}),r(ue,!1);const M=C.length>0?`Long rest taken! Restored: ${C.join(", ")}`:"Long rest taken! Fully rested.";qt.add(M,"success")}function Q(C){r(ve,""),r(Z,""),r(E,""),r(H,!1),r(we,[]),r(Ee,"other"),Fe=!1,typeof C=="string"?r(ve,C):(r(ve,C.notation),r(Z,C.damageNotation||""),r(E,C.attackName||""),r(H,!!C.applyHalfDamage),r(we,C.bonusBreakdown||[]),r(Ee,C.rollType||"other")),r(y,!0)}function He(C){const{notation:M,count:W,bonusBreakdown:qe}=C.detail;r(ve,""),Fe=!0,Qe=W||1,setTimeout(()=>{r(ve,M),r(Z,""),r(E,"Hit Die"),r(we,qe||[]),r(Ee,"other")},0),r(y,!0)}function Ne(){if(r(y,!1),Fe&&e(ge)){const C=e(ge).getLastRollTotal();if(C!==null){const M=Math.max(1,C);de.update(W=>(W.hitDice.current=Math.max(0,W.hitDice.current-Qe),W.currentHP=Math.min(W.maxHP,W.currentHP+M),W))}Fe=!1}}function Ae(){ba.update(C=>!C)}function Be(C){C.target.closest(".rest-button-container")||r(ue,!1)}Ca(()=>{const C=ba.subscribe(M=>{M?document.body.classList.remove("use-mode"):document.body.classList.add("use-mode")});return document.addEventListener("click",Be),()=>{C(),document.removeEventListener("click",Be)}});function ot(){el(t())}function et(){e(be)?.click()}async function ut(C){const W=C.target.files?.[0];if(W)try{const qe=await tl(W);de.set(qe),alert("Character imported successfully!")}catch{alert("Failed to import character file")}}Wt();var ct=Ur();Xs("1uha8ag",C=>{var M=yr();Gt(2),ks(()=>{Js.title="D&D Character Sheet"}),c(C,M)});var it=je(ct),lt=i(it),ht=i(lt),x=i(ht),O=i(x),T=a(i(O),2);{var S=C=>{var M=xr(),W=i(M);s(M),j(()=>D(W,`${t().name??""} (${t().level??""})`)),c(C,M)};b(T,C=>{t().name&&C(S)})}s(O);var I=a(O,2);{var ee=C=>{var M=wr();_t(M,5,k,wt,(W,qe)=>{var ae=kr();let ze;var me=i(ae);s(ae),j(()=>{ze=jt(ae,1,"slot-badge svelte-1uha8ag",null,ze,{depleted:e(qe).available===0}),D(me,`Lv${e(qe).level??""}: ${e(qe).available??""}/${e(qe).total??""}`)}),c(W,ae)}),s(M),c(C,M)};b(I,C=>{k().length>0&&C(ee)})}var he=a(I,2);{var Le=C=>{var M=Ir(),W=je(M);_t(W,5,()=>t().activeStates,wt,(qe,ae,ze)=>{var me=Tr(),at=i(me),Ve=a(at);{var It=Jt=>{var ta=Fr(),Bt=i(ta),St=i(Bt,!0);s(Bt);var $t=a(Bt,2),sa=a($t,3);{var da=Ze=>{var We=Sr(),dt=je(We),xt=i(dt);s(dt),Gt(),j(()=>D(xt,`Attack Bonus: ${typeof e(ae).attackBonus=="number"&&e(ae).attackBonus>0?"+":""}${e(ae).attackBonus??""}`)),c(Ze,We)};b(sa,Ze=>{e(ae).attackBonus&&Ze(da)})}var la=a(sa,2);{var Yt=Ze=>{var We=$r(),dt=je(We),xt=i(dt);s(dt),Gt(),j(()=>D(xt,`Damage Bonus: ${typeof e(ae).damageBonus=="number"&&e(ae).damageBonus>0?"+":""}${e(ae).damageBonus??""}`)),c(Ze,We)};b(la,Ze=>{e(ae).damageBonus&&Ze(Yt)})}var Xt=a(la,2);{var yt=Ze=>{var We=Cr(),dt=je(We),xt=i(dt);s(dt),Gt(),j(()=>D(xt,`AC Bonus: ${e(ae).acBonus>0?"+":""}${e(ae).acBonus??""}`)),c(Ze,We)};b(Xt,Ze=>{e(ae).acBonus&&Ze(yt)})}var Ct=a(Xt,2);{var Tt=Ze=>{var We=Dr(),dt=je(We),xt=i(dt);s(dt),Gt(),j(()=>D(xt,`Darkvision: ${e(ae).darkvision??""} feet`)),c(Ze,We)};b(Ct,Ze=>{e(ae).darkvision&&Ze(Tt)})}var Zt=a(Ct,2);{var ia=Ze=>{var We=Lr(),dt=je(We),xt=i(dt);s(dt),Gt(),j(Dt=>D(xt,`Resistances: ${Dt??""}`),[()=>e(ae).resistances.join(", ")]),c(Ze,We)};b(Zt,Ze=>{e(ae).resistances&&e(ae).resistances.length>0&&Ze(ia)})}var oa=a(Zt,2);{var Nt=Ze=>{var We=jr(),dt=je(We),xt=i(dt);s(dt),Gt(),j(Dt=>D(xt,`Immunities: ${Dt??""}`),[()=>e(ae).immunities.join(", ")]),c(Ze,We)};b(oa,Ze=>{e(ae).immunities&&e(ae).immunities.length>0&&Ze(Nt)})}var Rt=a(oa,2);{var Et=Ze=>{var We=Mr(),dt=a(i(We),3);_t(dt,1,()=>e(ae).abilities,wt,(xt,Dt)=>{var ca=Rr(),Mt=i(ca),Qt=i(Mt);s(Mt);var Ut=a(Mt),na=a(Ut);{var ua=kt=>{var Ot=Ar(),ra=a(je(Ot)),ka=i(ra),Da=a(ka);{var qa=Wa=>{var As=Ht(", requires reaction");c(Wa,As)};b(Da,Wa=>{e(Dt).requiresReaction&&Wa(qa)})}Gt(),s(ra),j(()=>D(ka,`(${(e(Dt).currentUses||0)??""}/${e(Dt).usesPerRest??""} uses per ${e(Dt).restType??""}
                                rest`)),c(kt,Ot)},Ft=kt=>{var Ot=vt(),ra=je(Ot);{var ka=Da=>{var qa=Br();Gt(),c(Da,qa)};b(ra,Da=>{e(Dt).requiresReaction&&Da(ka)},!0)}c(kt,Ot)};b(na,kt=>{e(Dt).usesPerRest?kt(ua):kt(Ft,!1)})}s(ca),j(()=>{D(Qt,`${e(Dt).name??""}:`),D(Ut,` ${e(Dt).description??""} `)}),c(xt,ca)}),s(We),c(Ze,We)};b(Rt,Ze=>{e(ae).abilities&&e(ae).abilities.length>0&&Ze(Et)})}s(ta),j(()=>{D(St,e(ae).name),D($t,` ${e(ae).description??""}`)}),c(Jt,ta)};b(Ve,Jt=>{e(De)===ze&&Jt(It)})}var At=a(Ve,2);{var Vt=Jt=>{var ta=Pr();j(()=>Je(ta,"title",`End ${e(ae).name??""}`)),L("click",ta,()=>{de.update(Bt=>{if(Bt.activeStates){const St=Bt.activeStates[ze];St?.hpBonus&&St.target!=="other"&&(Bt.maxHP-=St.hpBonus,Bt.currentHP=Math.max(1,Math.min(Bt.currentHP-St.hpBonus,Bt.maxHP))),Bt.activeStates=Bt.activeStates.filter(($t,sa)=>sa!==ze)}return Bt})}),c(Jt,ta)};b(At,Jt=>{v()||Jt(Vt)})}s(me),j(()=>{Je(me,"aria-label",e(ae).name),D(at,`‚ú® ${e(ae).name??""} `)}),L("mouseenter",me,()=>Ue(ze)),L("mouseleave",me,B),L("focus",me,()=>Ue(ze)),L("blur",me,B),L("click",me,()=>P(ze)),c(qe,me)}),s(W),Gt(2),c(C,M)};b(he,C=>{t().activeStates&&t().activeStates.length>0&&C(Le)})}s(x);var oe=a(x,2),_e=i(oe),K=i(_e),A=a(K,2),Se=i(A),Oe=a(Se,2);{var Re=C=>{var M=Er(),W=i(M),qe=a(W,2);s(M),L("click",W,g),L("click",qe,R),c(C,M)};b(Oe,C=>{e(ue)&&C(Re)})}s(A);var Xe=a(A,2),se=a(Xe,2),d=i(se);let ye;var pe=i(d),G=i(pe,!0);s(pe);var $e=a(pe),ce=i($e,!0);s($e),s(d),s(se),s(_e);var xe=a(_e,2),le=i(xe);Ce(le),s(xe),s(oe),s(ht);var Te=a(ht,2),fe=i(Te),h=a(fe,2),V=a(h,2),ie=a(V,2),ne=a(ie,2),q=a(ne,2);Ra(q,C=>r(be,C),()=>e(be)),s(Te),s(lt);var te=a(lt,2),Pe=i(te);yl(Pe,{});var J=a(Pe,2);Sl(J,{$$events:{roll:C=>Q(C.detail)}});var Me=a(J,2);Gl(Me,{$$events:{roll:C=>Q(C.detail)}});var ke=a(Me,2);Ul(ke,{$$events:{rollHitDice:He}});var tt=a(ke,2);Ki(tt,{$$events:{roll:C=>Q(C.detail)}});var nt=a(tt,2);dn(nt,{});var gt=a(nt,2);fn(gt,{}),s(te),s(it);var ft=a(it,2);Ra(jn(ft,{get notation(){return e(ve)},get damageNotation(){return e(Z)},get attackName(){return e(E)},get applyHalfDamage(){return e(H)},get bonusBreakdown(){return e(we)},get rollType(){return e(Ee)},get visible(){return e(y)},$$events:{close:Ne},$$legacy:!0}),C=>r(ge,C),()=>e(ge));var st=a(ft,2);{var N=C=>{Jn(C,{get mode(){return e(re)},$$events:{close:()=>r(w,!1)}})};b(st,C=>{e(w)&&C(N)})}var X=a(st,2);{var pt=C=>{dr(C,{onClose:()=>r(U,!1)})};b(X,C=>{e(U)&&C(pt)})}var Ke=a(X,2);_r(Ke,{get show(){return e(F)},onSave:_,onCancel:Y});var Ge=a(Ke,2);Zs(Ge,{}),j(()=>{ye=jt(d,1,"btn btn-mode svelte-1uha8ag",null,ye,{"use-mode":!v()}),D(G,v()?"üìù":"üé≤"),D(ce,v()?"Edit Mode":"Use Mode")}),L("click",K,()=>{r(we,[]),r(y,!0)}),L("click",Se,()=>r(ue,!e(ue))),L("click",Xe,()=>r(F,!0)),L("click",d,Ae),Ie(le,u,C=>al(ha,C)),L("click",fe,()=>r(U,!0)),L("click",h,()=>{r(re,"save"),r(w,!0)}),L("click",V,()=>{r(re,"load"),r(w,!0)}),L("click",ie,ot),L("click",ne,et),L("change",q,ut),c(l,ct),Kt(),m()}export{Vr as component};
