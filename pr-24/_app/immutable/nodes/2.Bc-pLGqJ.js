import{d as rs,g as Bs,f,e as $,a as c,s as D,c as ft,t as qt}from"../chunks/BESELRjb.js";import{i as Wt}from"../chunks/JMgyEzd3.js";import{c as ma,o as ka,a as Rs,b as Ms}from"../chunks/CtPH092J.js";import{F as j,T as oa,Y as Xa,j as Fs,aZ as Ts,U as os,ag as Ps,aD as Es,aK as Is,aE as Hs,a1 as Us,av as Ta,a7 as ss,i as ys,a_ as Ns,a$ as xs,b0 as Na,K as ua,e as ks,b1 as ws,b2 as Os,b3 as Gs,b4 as qs,q as Za,b5 as Ws,b6 as zs,ab as Ks,d as n,r as ls,g as Vs,C as zt,G as Kt,H as i,I as s,J as a,b7 as et,b8 as ca,s as r,a4 as S,f as e,m as bt,E as Ae,b9 as Ft,ao as Gt,A as H,ba as da,bb as ga,bc as Js}from"../chunks/DyJ43TGI.js";import{t as Ys,c as ea,a as ve,e as wt,i as Ct,u as Ss,s as fa,b as jt,d as Ba,f as pa,g as Qs,j as Zt,h as Xs,T as Zs,k as el,l as tl}from"../chunks/D6-WMxVZ.js";import{i as b,s as ra,a as vt,b as Lt,d as $a,e as al}from"../chunks/CCL4udNy.js";import{p as yt,b as ja}from"../chunks/iXw84bXb.js";import{b as Ca,r as sl}from"../chunks/BgVVv7xM.js";function ll(l,o,t=!1,v=!1,d=!1){var p=l,m="";j(()=>{var w=Fs;if(m===(m=o()??"")){oa&&Xa();return}if(w.nodes_start!==null&&(Ts(w.nodes_start,w.nodes_end),w.nodes_start=w.nodes_end=null),m!==""){if(oa){os.data;for(var k=Xa(),_=k;k!==null&&(k.nodeType!==Ps||k.data!=="");)_=k,k=Es(k);if(k===null)throw Is(),Hs;rs(os,_),p=Us(k);return}var K=m+"";t?K=`<svg>${K}</svg>`:v&&(K=`<math>${K}</math>`);var M=Bs(K);if((t||v)&&(M=Ta(M)),rs(Ta(M),M.lastChild),t||v)for(;Ta(M);)p.before(Ta(M));else p.before(M)}})}function il(l,o,t,v,d){oa&&Xa();var p=o.$$slots?.[t],m=!1;p===!0&&(p=o[t],m=!0),p===void 0?d!==null&&d(l):p(l,m?()=>v:v)}function nl(l,o,t,v){var d=l.__style;if(oa||d!==o){var p=Ys(o);(!oa||p!==l.getAttribute("style"))&&(p==null?l.removeAttribute("style"):l.style.cssText=p),l.__style=o}return v}function Ua(l,o,t=!1){if(l.multiple){if(o==null)return;if(!ys(o))return Ns();for(var v of l.options)v.selected=o.includes(Da(v));return}for(v of l.options){var d=Da(v);if(xs(d,o)){v.selected=!0;return}}(!t||o!==void 0)&&(l.selectedIndex=-1)}function es(l){var o=new MutationObserver(()=>{Ua(l,l.__value)});o.observe(l,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),ss(()=>{o.disconnect()})}function Aa(l,o,t=o){var v=new WeakSet,d=!0;Na(l,"change",p=>{var m=p?"[selected]":":checked",w;if(l.multiple)w=[].map.call(l.querySelectorAll(m),Da);else{var k=l.querySelector(m)??l.querySelector("option:not([disabled])");w=k&&Da(k)}t(w),ua!==null&&v.add(ua)}),ks(()=>{var p=o();if(l===document.activeElement){var m=ws??ua;if(v.has(m))return}if(Ua(l,p,d),d&&p===void 0){var w=l.querySelector(":checked");w!==null&&(p=Da(w),t(p))}l.__value=p,d=!1}),es(l)}function Da(l){return"__value"in l?l.__value:l.value}const rl=Symbol("is custom element"),ol=Symbol("is html");function Se(l){if(oa){var o=!1,t=()=>{if(!o){if(o=!0,l.hasAttribute("value")){var v=l.value;Qe(l,"value",null),l.value=v}if(l.hasAttribute("checked")){var d=l.checked;Qe(l,"checked",null),l.checked=d}}};l.__on_r=t,Za(t),Ws()}}function La(l,o){var t=is(l);t.value===(t.value=o??void 0)||l.value===o&&(o!==0||l.nodeName!=="PROGRESS")||(l.value=o??"")}function $s(l,o){var t=is(l);t.checked!==(t.checked=o??void 0)&&(l.checked=o)}function Qe(l,o,t,v){var d=is(l);oa&&(d[o]=l.getAttribute(o),o==="src"||o==="srcset"||o==="href"&&l.nodeName==="LINK")||d[o]!==(d[o]=t)&&(o==="loading"&&(l[Os]=t),t==null?l.removeAttribute(o):typeof t!="string"&&cl(l).includes(o)?l[o]=t:l.setAttribute(o,t))}function is(l){return l.__attributes??={[rl]:l.nodeName.includes("-"),[ol]:l.namespaceURI===Gs}}var cs=new Map;function cl(l){var o=l.getAttribute("is")||l.nodeName,t=cs.get(o);if(t)return t;cs.set(o,t=[]);for(var v,d=l,p=Element.prototype;p!==d;){v=zs(d);for(var m in v)v[m].set&&t.push(m);d=qs(d)}return t}function Ne(l,o,t=o){var v=new WeakSet;Na(l,"input",async d=>{var p=d?l.defaultValue:l.value;if(p=Ka(l)?Va(p):p,t(p),ua!==null&&v.add(ua),await Ks(),p!==(p=o())){var m=l.selectionStart,w=l.selectionEnd,k=l.value.length;if(l.value=p??"",w!==null){var _=l.value.length;m===w&&w===k&&_>k?(l.selectionStart=_,l.selectionEnd=_):(l.selectionStart=m,l.selectionEnd=Math.min(w,_))}}}),(oa&&l.defaultValue!==l.value||n(o)==null&&l.value)&&(t(Ka(l)?Va(l.value):l.value),ua!==null&&v.add(ua)),ls(()=>{var d=o();if(l===document.activeElement){var p=ws??ua;if(v.has(p))return}Ka(l)&&d===Va(l.value)||l.type==="date"&&!d&&!l.value||d!==l.value&&(l.value=d??"")})}const za=new Set;function vs(l,o,t,v,d=v){var p=t.getAttribute("type")==="checkbox",m=l;let w=!1;if(o!==null)for(var k of o)m=m[k]??=[];m.push(t),Na(t,"change",()=>{var _=t.__value;p&&(_=ds(m,_,t.checked)),d(_)},()=>d(p?[]:null)),ls(()=>{var _=v();if(oa&&t.defaultChecked!==t.checked){w=!0;return}p?(_=_||[],t.checked=_.includes(t.__value)):t.checked=xs(t.__value,_)}),ss(()=>{var _=m.indexOf(t);_!==-1&&m.splice(_,1)}),za.has(m)||(za.add(m),Za(()=>{m.sort((_,K)=>_.compareDocumentPosition(K)===4?-1:1),za.delete(m)})),Za(()=>{if(w){var _;if(p)_=ds(m,_,t.checked);else{var K=m.find(M=>M.checked);_=K?.__value}d(_)}})}function _a(l,o,t=o){Na(l,"change",v=>{var d=v?l.defaultChecked:l.checked;t(d)}),(oa&&l.defaultChecked!==l.checked||n(o)==null)&&t(l.checked),ls(()=>{var v=o();l.checked=!!v})}function ds(l,o,t){for(var v=new Set,d=0;d<l.length;d+=1)l[d].checked&&v.add(l[d].__value);return t||v.delete(o),Array.from(v)}function Ka(l){var o=l.type;return o==="number"||o==="range"}function Va(l){return l===""?null:+l}function vl(l,o,t){var v=Vs(l,o);v&&v.set&&(l[o]=t,ss(()=>{l[o]=null}))}function ns(l){return function(...o){var t=o[0];return t.stopPropagation(),l?.apply(this,o)}}function ya(l,o){var t=l.$$events?.[o.type],v=ys(t)?t.slice():t==null?[]:[t];for(var d of v)d.call(this,o)}const dl="";function Cs(...l){return Ca+dl+sl(l[0],l[1])}const ts={paladin:{name:"Paladin",hitDice:"d10",spellcaster:!0,spellcastingAbility:"charisma",spellSlotsByLevel:{1:0,2:2,3:3,4:3,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Divine Sense",type:"uses",maxUses:(l,o=1)=>1+Math.max(1,o),resetOn:"long",description:"Detect celestials, fiends, and undead within 60 feet",minLevel:1},{name:"Lay on Hands",type:"pool",maxPool:l=>l*5,resetOn:"long",description:"Heal wounds or cure disease",minLevel:1},{name:"Divine Smite",type:"spellSlot",description:"Expend spell slot to deal extra radiant damage",minLevel:2,rollable:!0},{name:"Channel Divinity",type:"pool",maxPool:l=>l>=18?3:l>=6?2:1,resetOn:"short",description:"Sacred Weapon or Turn Undead",minLevel:3}]},fighter:{name:"Fighter",hitDice:"d10",spellcaster:!1,features:[{name:"Second Wind",type:"uses",maxUses:1,resetOn:"short",description:"Regain 1d10 + fighter level HP as bonus action",minLevel:1,rollable:!0,rollFormula:l=>`1d10+${l}`},{name:"Action Surge",type:"uses",maxUses:l=>l>=17?2:1,resetOn:"short",description:"Take one additional action on your turn",minLevel:2},{name:"Indomitable",type:"uses",maxUses:l=>l>=17?3:l>=13?2:1,resetOn:"long",description:"Reroll a failed saving throw",minLevel:9}],subclasses:{champion:{name:"Champion",features:[{name:"Improved Critical",type:"info",description:"Critical hit on 19-20",minLevel:3},{name:"Remarkable Athlete",type:"info",description:"Add half proficiency to STR/DEX/CON checks, increase long jump distance",minLevel:7},{name:"Additional Fighting Style",type:"info",description:"Choose a second fighting style",minLevel:10},{name:"Superior Critical",type:"info",description:"Critical hit on 18-20",minLevel:15},{name:"Survivor",type:"info",description:"Regain 5 + CON mod HP at start of turn if below half HP",minLevel:18}]},battlemaster:{name:"Battle Master",features:[{name:"Combat Superiority",type:"uses",maxUses:l=>l>=15?6:l>=7?5:4,resetOn:"short",description:l=>`Use superiority dice (${l>=18?"d12":l>=10?"d10":"d8"}) for maneuvers`,minLevel:3},{name:"Know Your Enemy",type:"info",description:"Learn capabilities of creatures you observe",minLevel:7},{name:"Improved Combat Superiority",type:"info",description:"Superiority dice become d10",minLevel:10},{name:"Relentless",type:"info",description:"Regain 1 superiority die if you have none at start of turn",minLevel:15}]}}},rogue:{name:"Rogue",hitDice:"d8",spellcaster:!1,features:[{name:"Sneak Attack",type:"info",description:l=>`Deal ${Math.ceil(l/2)}d6 extra damage once per turn with advantage or ally nearby`,minLevel:1,rollable:!0,rollFormula:l=>`${Math.ceil(l/2)}d6`},{name:"Cunning Action",type:"info",description:"Dash, Disengage, or Hide as a bonus action",minLevel:2},{name:"Uncanny Dodge",type:"info",description:"Use reaction to halve damage from an attack",minLevel:5},{name:"Evasion",type:"info",description:"Take no damage on successful Dex save (half on fail)",minLevel:7}]},wizard:{name:"Wizard",hitDice:"d6",spellcaster:!0,spellcastingAbility:"intelligence",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Arcane Recovery",type:"uses",maxUses:1,resetOn:"long",description:l=>`Recover spell slots totaling up to ${Math.ceil(l/2)} levels during short rest`,minLevel:1},{name:"Spell Mastery",type:"info",description:"Cast one 1st-level and one 2nd-level spell at will",minLevel:18}]},cleric:{name:"Cleric",hitDice:"d8",spellcaster:!0,spellcastingAbility:"wisdom",spellSlotsByLevel:{1:2,2:3,3:4,4:4,5:4,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4,14:4,15:4,16:4,17:4,18:4,19:4,20:4},features:[{name:"Channel Divinity",type:"pool",maxPool:l=>l>=18?3:l>=6?2:1,resetOn:"short",description:"Turn Undead or domain-specific ability",minLevel:2},{name:"Destroy Undead",type:"info",description:l=>`Channel Divinity destroys undead of CR ${l>=17?4:l>=14?3:l>=11?2:l>=8?1:.5} or lower`,minLevel:5},{name:"Divine Intervention",type:"uses",maxUses:1,resetOn:"long",description:l=>`${l}% chance to succeed, implore deity for aid`,minLevel:10}],subclasses:{war:{name:"War Domain",features:[{name:"War Priest",type:"uses",maxUses:(l,o=1)=>Math.max(1,o),resetOn:"long",description:"Make one weapon attack as a bonus action",minLevel:1},{name:"Guided Strike",type:"channelDivinity",description:"Use your Channel Divinity to gain +10 to an attack roll. Make this choice after you see the roll, but before the DM says whether the attack hits or misses.",minLevel:2,resetOn:"short"},{name:"War God's Blessing",type:"channelDivinity",description:"Use reaction to grant +10 to an ally's attack roll within 30 feet. Consumes one use of Channel Divinity.",minLevel:6,resetOn:"short"},{name:"Divine Strike",type:"info",description:l=>`Deal extra ${l>=14?"2d8":"1d8"} weapon damage once per turn`,minLevel:8,rollable:!0,rollFormula:l=>l>=14?"2d8":"1d8"},{name:"Avatar of Battle",type:"info",description:"Gain resistance to nonmagical weapon damage",minLevel:17}]},life:{name:"Life Domain",features:[{name:"Disciple of Life",type:"info",description:"Healing spells restore additional 2 + spell level HP",minLevel:1},{name:"Preserve Life",type:"pool",maxPool:l=>l*5,resetOn:"short",description:"Restore HP to creatures within 30 feet",minLevel:2},{name:"Blessed Healer",type:"info",description:"Regain 2 + spell level HP when you cast healing spell",minLevel:6},{name:"Divine Strike",type:"info",description:l=>`Deal extra ${l>=14?"2d8":"1d8"} radiant damage once per turn`,minLevel:8,rollable:!0,rollFormula:l=>l>=14?"2d8":"1d8"},{name:"Supreme Healing",type:"info",description:"Maximize healing dice instead of rolling",minLevel:17}]}}},barbarian:{name:"Barbarian",hitDice:"d12",spellcaster:!1,features:[{name:"Rage",type:"uses",maxUses:l=>l>=20?1/0:l>=17?6:l>=12?5:l>=6?4:l>=3?3:2,resetOn:"long",description:l=>`+${l>=16?4:l>=9?3:2} damage, resistance to physical damage`,minLevel:1},{name:"Reckless Attack",type:"info",description:"Gain advantage on melee attacks, enemies get advantage on you",minLevel:2},{name:"Danger Sense",type:"info",description:"Advantage on Dex saves against effects you can see",minLevel:2}],subclasses:{berserker:{name:"Path of the Berserker",features:[{name:"Frenzy",type:"info",description:"While raging, make melee attack as bonus action (gain 1 exhaustion after rage)",minLevel:3},{name:"Mindless Rage",type:"info",description:"Cannot be charmed or frightened while raging",minLevel:6},{name:"Intimidating Presence",type:"info",description:"Use action to frighten creature within 30 feet",minLevel:10},{name:"Retaliation",type:"info",description:"When damaged by creature within 5 feet, make melee attack as reaction",minLevel:14}]}}}};function ta(l){const o=l.toLowerCase();return ts[o]||null}function xa(l,o,t){const v=ta(l);if(!v)return[];const d=v.features.filter(p=>!p.minLevel||p.minLevel<=o);if(t&&v.subclasses&&v.subclasses[t]){const p=v.subclasses[t].features.filter(m=>!m.minLevel||m.minLevel<=o);return[...d,...p]}return d}function us(l){const o=ta(l);return!o||!o.subclasses?[]:Object.keys(o.subclasses).map(t=>({id:t,name:o.subclasses[t].name}))}function ps(l,o){const t=ta(l);return!t||!t.spellcaster||!t.spellSlotsByLevel?0:t.spellSlotsByLevel[o]||0}function fs(l,o,t){const v=ta(l);return!v||!v.spellcaster?0:Math.max(1,t+o)}function ul(l,o,t){const v=ta(l);return!v||!v.spellcaster?null:8+o+t}function pl(){return Object.keys(ts).map(l=>({id:l,name:ts[l].name}))}var fl=f('<div class="section-header svelte-ls99y2" role="button" tabindex="0"><h2 class="svelte-ls99y2"> </h2> <span class="collapse-btn svelte-ls99y2"> </span></div>');function ba(l,o){zt(o,!1);let t=yt(o,"title",8),v=yt(o,"collapsed",8),d=yt(o,"ariaLabel",8,""),p=yt(o,"onToggle",8);Wt();var m=fl(),w=i(m),k=i(w,!0);s(w);var _=a(w,2),K=i(_,!0);s(_),s(m),j(()=>{Qe(m,"aria-expanded",!v()),Qe(m,"aria-label",d()),D(k,t()),D(K,v()?"‚ñº":"‚ñ≤")}),$("click",m,function(...M){p()?.apply(this,M)}),$("keydown",m,M=>{(M.key==="Enter"||M.key===" ")&&p()()}),c(l,m),Kt()}var gl=f("<option> </option>"),ml=f("<option> </option>"),bl=f('<div class="form-group svelte-172i2fj"><label for="characterSubclass" class="svelte-172i2fj">Subclass</label> <select id="characterSubclass" class="svelte-172i2fj"><option>Select Subclass</option><!></select></div>'),hl=f('<div class="info-grid svelte-172i2fj"><div class="form-group svelte-172i2fj"><label for="characterName" class="svelte-172i2fj">Character Name</label> <input type="text" id="characterName" placeholder="Enter name" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterClass" class="svelte-172i2fj">Class</label> <select id="characterClass" class="svelte-172i2fj"><option>Select Class</option><!></select></div> <!> <div class="form-group svelte-172i2fj"><label for="characterLevel" class="svelte-172i2fj">Level</label> <input type="number" id="characterLevel" min="1" max="20" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterRace" class="svelte-172i2fj">Race</label> <input type="text" id="characterRace" placeholder="e.g., Human" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterBackground" class="svelte-172i2fj">Background</label> <input type="text" id="characterBackground" placeholder="e.g., Soldier" class="svelte-172i2fj"/></div> <div class="form-group svelte-172i2fj"><label for="characterAlignment" class="svelte-172i2fj">Alignment</label> <input type="text" id="characterAlignment" placeholder="e.g., Lawful Good" class="svelte-172i2fj"/></div></div>'),_l=f('<section class="character-info svelte-172i2fj"><!> <!></section>');function yl(l,o){zt(o,!1);const t=()=>vt(ve,"$character",d),v=()=>vt(ea,"$collapsedStates",d),[d,p]=ra(),m=S(),w=pl();function k(le){const O=le.target;ve.update(P=>(P.class=O.value,P.subclass="",P))}function _(le){const O=le.target;ve.update(P=>(P.subclass=O.value,P))}function K(le){const O=le.target;ve.update(P=>(P.level=parseInt(O.value)||1,P)),Ss()}et(()=>(t(),us),()=>{r(m,t().class?us(t().class):[])}),ca(),Wt();var M=_l(),te=i(M);{let le=bt(()=>(v(),n(()=>v().characterInfo?"Expand":"Collapse")));ba(te,{title:"Character Info",get collapsed(){return v(),n(()=>v().characterInfo)},get ariaLabel(){return e(le)},onToggle:()=>ea.update(O=>({...O,characterInfo:!O.characterInfo}))})}var V=a(te,2);{var Q=le=>{var O=hl(),P=i(O),ye=a(i(P),2);Se(ye),s(P);var ze=a(P,2),de=a(i(ze),2),Te=i(de);Te.value=Te.__value="";var Xe=a(Te);wt(Xe,1,()=>w,Ct,(Pe,De)=>{var Be=gl(),dt=i(Be,!0);s(Be);var st={};j(()=>{D(dt,(e(De),n(()=>e(De).name))),st!==(st=(e(De),n(()=>e(De).id)))&&(Be.value=(Be.__value=(e(De),n(()=>e(De).id)))??"")}),c(Pe,Be)}),s(de);var ne;es(de),s(ze);var xe=a(ze,2);{var Ee=Pe=>{var De=bl(),Be=a(i(De),2),dt=i(Be);dt.value=dt.__value="";var st=a(dt);wt(st,1,()=>e(m),Ct,(ut,ot)=>{var y=ml(),U=i(y,!0);s(y);var ke={};j(()=>{D(U,(e(ot),n(()=>e(ot).name))),ke!==(ke=(e(ot),n(()=>e(ot).id)))&&(y.value=(y.__value=(e(ot),n(()=>e(ot).id)))??"")}),c(ut,y)}),s(Be);var gt;es(Be),s(De),j(()=>{gt!==(gt=(t(),n(()=>t().subclass)))&&(Be.value=(Be.__value=(t(),n(()=>t().subclass)))??"",Ua(Be,(t(),n(()=>t().subclass))))}),$("change",Be,_),c(Pe,De)};b(xe,Pe=>{e(m),n(()=>e(m).length>0)&&Pe(Ee)})}var L=a(xe,2),R=a(i(L),2);Se(R),s(L);var h=a(L,2),G=a(i(h),2);Se(G),s(h);var g=a(h,2),B=a(i(g),2);Se(B),s(g);var J=a(g,2),Oe=a(i(J),2);Se(Oe),s(J),s(O),j(()=>{ne!==(ne=(t(),n(()=>t().class)))&&(de.value=(de.__value=(t(),n(()=>t().class)))??"",Ua(de,(t(),n(()=>t().class)))),La(R,(t(),n(()=>t().level)))}),Ne(ye,()=>t().name,Pe=>Lt(ve,n(t).name=Pe,n(t))),$("change",de,k),$("change",R,K),Ne(G,()=>t().race,Pe=>Lt(ve,n(t).race=Pe,n(t))),Ne(B,()=>t().background,Pe=>Lt(ve,n(t).background=Pe,n(t))),Ne(Oe,()=>t().alignment,Pe=>Lt(ve,n(t).alignment=Pe,n(t))),c(le,O)};b(V,le=>{v(),n(()=>!v().characterInfo)&&le(Q)})}s(M),c(l,M),Kt(),p()}var xl=f('<div class="ability-card svelte-bbv1xt"><h3 class="svelte-bbv1xt"> </h3> <input type="number" class="ability-score svelte-bbv1xt" min="1" max="30"/> <div class="ability-modifier svelte-bbv1xt"> </div> <div class="roll-buttons svelte-bbv1xt"><button class="roll-btn svelte-bbv1xt">Check</button> <button class="roll-btn svelte-bbv1xt">Save</button></div> <div class="save-proficiency svelte-bbv1xt"><input type="checkbox" class="svelte-bbv1xt"/> <label class="svelte-bbv1xt">Save Prof.</label></div></div>'),kl=f('<div class="proficiency-bonus svelte-bbv1xt"><label for="profBonus">Proficiency Bonus</label> <input type="number" id="profBonus" class="prof-input svelte-bbv1xt"/></div> <div class="abilities-grid svelte-bbv1xt"></div>',1),wl=f("<section><!> <!></section>");function Sl(l,o){zt(o,!1);const t=()=>vt(Ba,"$abilityModifiers",w),v=()=>vt(ve,"$character",w),d=()=>vt(fa,"$searchFilter",w),p=()=>vt(ea,"$collapsedStates",w),m=()=>vt(pa,"$isEditMode",w),[w,k]=ra(),_=S(),K=S(),M=ma(),te=[{key:"strength",label:"Strength"},{key:"dexterity",label:"Dexterity"},{key:"constitution",label:"Constitution"},{key:"intelligence",label:"Intelligence"},{key:"wisdom",label:"Wisdom"},{key:"charisma",label:"Charisma"}];function V(){Ss()}function Q(Te){const Xe=t()[Te],ne=`1d20${Xe>=0?"+":""}${Xe}`,xe=[];xe.push({value:"1d20",source:"base die"}),Xe!==0&&xe.push({value:Xe,source:Te}),M("roll",{notation:ne,rollType:"check",bonusBreakdown:xe})}function le(Te){const Xe=t()[Te],ne=v().saveProficiencies[Te]?v().proficiencyBonus:0,xe=Xe+ne,Ee=`1d20${xe>=0?"+":""}${xe}`,L=[];L.push({value:"1d20",source:"base die"}),Xe!==0&&L.push({value:Xe,source:Te}),ne!==0&&L.push({value:ne,source:"proficiency"}),M("roll",{notation:Ee,rollType:"save",bonusBreakdown:L})}et(()=>d(),()=>{r(_,te.filter(({label:Te})=>d()?Te.toLowerCase().includes(d().toLowerCase()):!0))}),et(()=>(e(_),d()),()=>{r(K,e(_).length>0||!d()||d().toLowerCase().includes("proficiency"))}),ca(),Wt();var O=wl();let P;var ye=i(O);ba(ye,{title:"Ability Scores",get collapsed(){return p(),n(()=>p().abilityScores)},ariaLabel:"Toggle Ability Scores Section",onToggle:()=>ea.update(Te=>({...Te,abilityScores:!Te.abilityScores}))});var ze=a(ye,2);{var de=Te=>{var Xe=kl(),ne=Ae(Xe),xe=a(i(ne),2);Se(xe),s(ne);var Ee=a(ne,2);wt(Ee,5,()=>e(_),Ct,(L,R)=>{let h=()=>e(R).key,G=()=>e(R).label;var g=xl(),B=i(g),J=i(B,!0);s(B);var Oe=a(B,2);Se(Oe);var Pe=a(Oe,2),De=i(Pe);s(Pe);var Be=a(Pe,2),dt=i(Be),st=a(dt,2);s(Be);var gt=a(Be,2),ut=i(gt);Se(ut);var ot=a(ut,2);s(gt),s(g),j(y=>{D(J,y),D(De,`${t(),h(),n(()=>t()[h()]>=0?"+":"")??""}${t(),h(),n(()=>t()[h()])??""}`),ut.disabled=!m(),Qe(ut,"id",`${h()}-save`),Qe(ot,"for",`${h()}-save`)},[()=>(G(),n(()=>G().substring(0,3).toUpperCase()))]),Ne(Oe,()=>v().abilities[h()],y=>Lt(ve,n(v).abilities[h()]=y,n(v))),$("change",Oe,V),$("click",dt,()=>Q(h())),$("click",st,()=>le(h())),_a(ut,()=>v().saveProficiencies[h()],y=>Lt(ve,n(v).saveProficiencies[h()]=y,n(v))),c(L,g)}),s(Ee),Ne(xe,()=>v().proficiencyBonus,L=>Lt(ve,n(v).proficiencyBonus=L,n(v))),c(Te,Xe)};b(ze,Te=>{p(),n(()=>!p().abilityScores)&&Te(de)})}s(O),j(()=>P=jt(O,1,"ability-scores svelte-bbv1xt",null,P,{hidden:!e(K)})),c(l,O),Kt(),k()}const Ds=[{name:"Unarmored",type:"none",baseAC:10},{name:"Padded",type:"light",baseAC:11},{name:"Leather",type:"light",baseAC:11},{name:"Studded Leather",type:"light",baseAC:12},{name:"Hide",type:"medium",baseAC:12,maxDexBonus:2},{name:"Chain Shirt",type:"medium",baseAC:13,maxDexBonus:2},{name:"Scale Mail",type:"medium",baseAC:14,maxDexBonus:2},{name:"Breastplate",type:"medium",baseAC:14,maxDexBonus:2},{name:"Half Plate",type:"medium",baseAC:15,maxDexBonus:2},{name:"Ring Mail",type:"heavy",baseAC:14,maxDexBonus:0},{name:"Chain Mail",type:"heavy",baseAC:16,maxDexBonus:0},{name:"Splint",type:"heavy",baseAC:17,maxDexBonus:0},{name:"Plate",type:"heavy",baseAC:18,maxDexBonus:0}];function Ls(l){return Ds.find(o=>o.name===l)}function $l(l,o,t){if(!l)return 10+o+(t?2:0);const v=Ls(l);if(!v)return 10+o+(t?2:0);let d=v.baseAC;return v.maxDexBonus===void 0?d+=o:v.maxDexBonus>0&&(d+=Math.min(o,v.maxDexBonus)),t&&(d+=2),d}function Ra(l){return Math.floor((l-10)/2)}function as(l,o){if(!l.class)return null;const t=ta(l.class);if(!t||!t.spellcaster||!t.spellcastingAbility)return null;const v=Ra(o[t.spellcastingAbility]);return 8+l.proficiencyBonus+v}function gs(l,o){if(!l.class)return 0;const t=ta(l.class);return!t||!t.spellcaster||!t.spellcastingAbility?0:Ra(o[t.spellcastingAbility])}function Cl(l,o){const t=[],v=Ra(o.dexterity),d=l.armorName?Ls(l.armorName):void 0;if(d){if(d.type==="none")t.push("Unarmored"),t.push("Base: 10"),t.push(`Dexterity: ${v>=0?"+":""}${v}`);else if(d.type==="light")t.push(`${d.name}: ${d.baseAC}`),t.push(`Dexterity: ${v>=0?"+":""}${v}`);else if(d.type==="medium"){const p=Math.min(2,v);t.push(`${d.name}: ${d.baseAC}`),t.push(`Dexterity: ${p>=0?"+":""}${p} (max +2)`)}else d.type==="heavy"&&(t.push(`${d.name}: ${d.baseAC}`),t.push("Dexterity: +0 (heavy armor)"));l.shieldEquipped&&t.push("Shield: +2")}else{t.push("Base: 10"),v!==0&&t.push(`Dexterity: ${v>=0?"+":""}${v}`);const p=10+v,m=l.armorClass-p;m!==0&&t.push(`Other: ${m>=0?"+":""}${m}`)}return l.activeStates&&l.activeStates.length>0&&l.activeStates.forEach(p=>{typeof p.acBonus=="number"&&p.acBonus!==0&&(!p.target||p.target==="self")&&t.push(`${p.name}: ${p.acBonus>=0?"+":""}${p.acBonus}`)}),t.join(`
`)}function Dl(l,o){const t=[],v=Ra(o.dexterity);t.push(`Dexterity: ${v>=0?"+":""}${v}`);const d=l.initiative-v;return d!==0&&t.push(`Other Bonuses: ${d>=0?"+":""}${d}`),t.join(`
`)}function Ll(l,o){if(!l.class)return"";const t=ta(l.class);if(!t||!t.spellcaster||!t.spellcastingAbility)return"";const v=[],d=Ra(o[t.spellcastingAbility]),p=t.spellcastingAbility.charAt(0).toUpperCase()+t.spellcastingAbility.slice(1);return v.push("Base: 8"),v.push(`Proficiency: +${l.proficiencyBonus}`),v.push(`${p}: ${d>=0?"+":""}${d}`),v.join(`
`)}var jl=f('<button class="info-icon svelte-1o8ci7b" type="button">‚ÑπÔ∏è</button>'),Al=f('<button class="info-icon svelte-1o8ci7b" type="button">‚ÑπÔ∏è</button>'),Bl=f("<div><!></div>"),Rl=f('<div class="tooltip-wrapper svelte-1o8ci7b"><!> <!></div>');function Ja(l,o){zt(o,!1);let t=yt(o,"tooltipContent",8),v=yt(o,"ariaLabel",8,"Show information"),d=S(!1),p=S(),m=S(!1),w=S(null),k=S(!1),_=S(!1),K=S("");const M=Math.random().toString(36).slice(2);function te(){window.dispatchEvent(new CustomEvent("tooltip-open",{detail:M}))}function V(L){L.detail!==M&&(r(d,!1),r(k,!1))}function Q(){r(m,window.matchMedia("(pointer: coarse)").matches||"ontouchstart"in window)}function le(){if(!e(w)||!e(p))return;const L=e(p).getBoundingClientRect(),R=e(w).getBoundingClientRect();let h=L.bottom+5,G=L.left;r(k,!1),G+R.width>window.innerWidth-8&&(G=L.right-R.width,r(k,!0),G<8&&(G=8)),G<8&&(G=8),h+R.height>window.innerHeight-8&&(h=L.top-R.height-5),r(K,`position:fixed;top:${h}px;left:${G}px;z-index:1000;`),r(_,!0)}function O(){te(),r(d,!1),r(_,!1),requestAnimationFrame(()=>{r(d,!0),r(_,!1),setTimeout(le,0)})}function P(){r(d,!1),r(k,!1)}function ye(L){L.stopPropagation(),e(d)?(r(d,!1),r(k,!1),r(_,!1)):(te(),r(d,!1),r(_,!1),requestAnimationFrame(()=>{r(d,!0),r(_,!1),setTimeout(le,0)}))}function ze(L){e(p)&&!e(p).contains(L.target)&&(r(d,!1),r(k,!1))}ka(()=>{Q(),document.addEventListener("click",ze),window.addEventListener("tooltip-open",V)}),Rs(()=>{document.removeEventListener("click",ze),window.removeEventListener("tooltip-open",V)}),Wt();var de=Rl(),Te=i(de);{var Xe=L=>{var R=jl();j(()=>Qe(R,"aria-label",v())),$("click",R,ye),c(L,R)},ne=L=>{var R=Al();j(()=>Qe(R,"aria-label",v())),$("mouseenter",R,O),$("mouseleave",R,P),c(L,R)};b(Te,L=>{e(m)?L(Xe):L(ne,!1)})}var xe=a(Te,2);{var Ee=L=>{var R=Bl(),h=i(R);il(h,o,"content",{},G=>{var g=ft(),B=Ae(g);ll(B,t),c(G,g)}),s(R),ja(R,G=>r(w,G),()=>e(w)),j(()=>{jt(R,1,`tooltip-popup ${e(k)?"right-align":""}`,"svelte-1o8ci7b"),nl(R,e(_)?e(K)+"opacity:1;pointer-events:auto;":"opacity:0;pointer-events:none;position:fixed;top:0;left:0;z-index:1000;")}),c(L,R)};b(xe,L=>{e(d)&&L(Ee)})}s(de),ja(de,L=>r(p,L),()=>e(p)),c(l,de),Kt()}var Ml=f("<option> </option>"),Fl=f('<div class="armor-config svelte-1r5hyyb"><h4 class="svelte-1r5hyyb">Armor Configuration</h4> <div class="armor-controls svelte-1r5hyyb"><div class="armor-field svelte-1r5hyyb"><label for="armorName" class="svelte-1r5hyyb">Armor</label> <select id="armorName" class="armor-select svelte-1r5hyyb"><option>None (Unarmored)</option><!></select></div> <div class="armor-field svelte-1r5hyyb"><label class="shield-label svelte-1r5hyyb"><input type="checkbox" class="shield-checkbox svelte-1r5hyyb"/> Shield Equipped (+2 AC)</label></div></div></div>'),Tl=f('<div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="spellSaveDC" class="svelte-1r5hyyb">Spell Save DC</label> <!></div> <input type="number" id="spellSaveDC" class="stat-input svelte-1r5hyyb" readonly=""/></div>'),Pl=f('<span class="hit-dice-type"> </span>'),El=f('<!> <div class="stats-grid svelte-1r5hyyb"><div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="armorClass" class="svelte-1r5hyyb">Armor Class</label> <!></div> <input type="text" id="armorClass" readonly=""/></div> <div class="stat-box svelte-1r5hyyb"><div class="stat-label-with-icon svelte-1r5hyyb"><label for="initiative" class="svelte-1r5hyyb">Initiative</label> <!></div> <input type="text" id="initiative" class="stat-input svelte-1r5hyyb" readonly=""/></div> <div class="stat-box svelte-1r5hyyb"><label for="speed" class="svelte-1r5hyyb">Speed</label> <input type="text" id="speed" class="stat-input svelte-1r5hyyb"/></div> <!></div> <div class="hp-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Points</h3> <div><div class="hp-inputs svelte-1r5hyyb"><input type="number" class="hp-current svelte-1r5hyyb" min="0"/> <span class="hp-separator svelte-1r5hyyb">/</span> <input type="number" class="hp-max svelte-1r5hyyb" min="0"/></div> <div class="hp-controls svelte-1r5hyyb"><button class="hp-btn svelte-1r5hyyb">‚àí</button> <button class="hp-btn svelte-1r5hyyb">+</button> <button class="hp-btn svelte-1r5hyyb">‚àí5</button> <button class="hp-btn svelte-1r5hyyb">+5</button></div></div> <div class="temp-hp svelte-1r5hyyb"><label for="tempHP" class="svelte-1r5hyyb">Temp HP</label> <input type="number" id="tempHP" min="0" class="svelte-1r5hyyb"/></div></div> <div class="hit-dice-section svelte-1r5hyyb"><h3 class="svelte-1r5hyyb">Hit Dice</h3> <div class="hit-dice-display svelte-1r5hyyb"><input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <span>/</span> <input type="number" class="hit-dice-input svelte-1r5hyyb" min="0"/> <!></div> <div class="hit-dice-controls svelte-1r5hyyb"><label for="hitDiceCount" class="svelte-1r5hyyb">Roll</label> <div class="hit-dice-count-controls svelte-1r5hyyb"><button class="hit-dice-btn svelte-1r5hyyb">‚àí</button> <input type="number" id="hitDiceCount" class="hit-dice-count-input svelte-1r5hyyb" min="1"/> <button class="hit-dice-btn svelte-1r5hyyb">+</button></div> <button class="btn btn-primary roll-hit-dice use-enabled svelte-1r5hyyb">üé≤ Roll</button></div></div>',1),Il=f("<section><!> <!></section>");function Hl(l,o){zt(o,!1);const t=()=>vt(ve,"$character",w),v=()=>vt(Ba,"$abilityModifiers",w),d=()=>vt(fa,"$searchFilter",w),p=()=>vt(ea,"$collapsedStates",w),m=()=>vt(pa,"$isEditMode",w),[w,k]=ra(),_=S(),K=S(),M=S(),te=S(),V=S(),Q=S(),le=S(),O=ma();let P=S(1);function ye(L){ve.update(R=>(R.currentHP=Math.max(0,Math.min(R.maxHP,R.currentHP+L)),R))}function ze(L){const R=e(P)+L,h=t().hitDice.current;r(P,Math.max(1,Math.min(h,R)))}function de(L=1){if(t().hitDice.current<=0){alert("No hit dice remaining!");return}if(!t().class){alert("Please select a class first!");return}const R=ta(t().class);if(!R){alert("Invalid class configuration!");return}const h=Math.min(L,t().hitDice.current),G=R.hitDice,g=v().constitution,B=g*h,J=B>=0?`+${B}`:`${B}`,Oe=`${h}${G}${J}`,Pe=[];if(Pe.push({value:`${h}${G}`,source:"hit dice"}),g!==0)for(let De=0;De<h;De++)Pe.push({value:g,source:"constitution"});O("rollHitDice",{notation:Oe,hitDie:G,count:h,bonusBreakdown:Pe})}et(()=>(t(),v(),ve),()=>{if(t().armorName!==void 0||t().shieldEquipped!==void 0){const L=v().dexterity,R=$l(t().armorName,L,t().shieldEquipped||!1);t().armorClass!==R&&ve.update(h=>({...h,armorClass:R}))}}),et(()=>(v(),t(),ve),()=>{const L=v().dexterity;t().initiative!==L&&ve.update(R=>({...R,initiative:L}))}),et(()=>t(),()=>{r(_,as(t(),t().abilities))}),et(()=>t(),()=>{r(K,Cl(t(),t().abilities))}),et(()=>t(),()=>{r(M,Dl(t(),t().abilities))}),et(()=>t(),()=>{r(te,Ll(t(),t().abilities))}),et(()=>(t(),e(P)),()=>{const L=t().hitDice.current;L>0&&e(P)>L&&r(P,L)}),et(()=>t(),()=>{r(V,t().activeStates&&t().activeStates.length>0?t().activeStates.reduce((L,R)=>L+(R.acBonus||0),0):0)}),et(()=>t(),()=>{r(Q,t().activeStates&&t().activeStates.length>0?t().activeStates.some(L=>L.name==="Aid"&&L.target==="self"):!1)}),et(()=>d(),()=>{r(le,!d()||"armor class".includes(d().toLowerCase())||"initiative".includes(d().toLowerCase())||"speed".includes(d().toLowerCase())||"hit points".includes(d().toLowerCase())||"hp".includes(d().toLowerCase())||"hit dice".includes(d().toLowerCase())||"spell save".includes(d().toLowerCase())||"combat".includes(d().toLowerCase()))}),ca(),Wt();var Te=Il();let Xe;var ne=i(Te);{let L=bt(()=>(p(),n(()=>p().combatStats?"Expand":"Collapse")));ba(ne,{title:"Combat Stats",get collapsed(){return p(),n(()=>p().combatStats)},get ariaLabel(){return e(L)},onToggle:()=>ea.update(R=>({...R,combatStats:!R.combatStats}))})}var xe=a(ne,2);{var Ee=L=>{var R=El(),h=Ae(R);{var G=Z=>{var He=Fl(),_e=a(i(He),2),x=i(_e),N=a(i(x),2);j(()=>{t(),Ft(()=>{})});var ae=i(N);ae.value=(ae.__value=void 0)??"";var se=a(ae);wt(se,1,()=>Ds,Ct,(W,Ge)=>{var Ke=ft(),tt=Ae(Ke);{var oe=pe=>{var Ze=Ml(),nt=i(Ze);s(Ze);var ge={};j(()=>{D(nt,`${e(Ge),n(()=>e(Ge).name)??""} (AC ${e(Ge),n(()=>e(Ge).baseAC)??""})`),ge!==(ge=(e(Ge),n(()=>e(Ge).name)))&&(Ze.value=(Ze.__value=(e(Ge),n(()=>e(Ge).name)))??"")}),c(pe,Ze)};b(tt,pe=>{e(Ge),n(()=>e(Ge).name!=="Unarmored")&&pe(oe)})}c(W,Ke)}),s(N),s(x);var I=a(x,2),ee=i(I),We=i(ee);Se(We),Gt(),s(ee),s(I),s(_e),s(He),Aa(N,()=>t().armorName,W=>Lt(ve,n(t).armorName=W,n(t))),_a(We,()=>t().shieldEquipped,W=>Lt(ve,n(t).shieldEquipped=W,n(t))),c(Z,He)};b(h,Z=>{m()&&Z(G)})}var g=a(h,2),B=i(g),J=i(B),Oe=a(i(J),2);Ja(Oe,{get tooltipContent(){return e(K)},ariaLabel:"Show AC breakdown"}),s(J);var Pe=a(J,2);Se(Pe),s(B);var De=a(B,2),Be=i(De),dt=a(i(Be),2);Ja(dt,{get tooltipContent(){return e(M)},ariaLabel:"Show Initiative breakdown"}),s(Be);var st=a(Be,2);Se(st),s(De);var gt=a(De,2),ut=a(i(gt),2);Se(ut),s(gt);var ot=a(gt,2);{var y=Z=>{var He=Tl(),_e=i(He),x=a(i(_e),2);Ja(x,{get tooltipContent(){return e(te)},ariaLabel:"Show Spell Save DC breakdown"}),s(_e);var N=a(_e,2);Se(N),s(He),j(()=>La(N,e(_))),c(Z,He)};b(ot,Z=>{e(_)!==null&&Z(y)})}s(g);var U=a(g,2),ke=a(i(U),2);let Le;var E=i(ke),A=i(E);Se(A);var ie=a(A,4);Se(ie),s(E);var ue=a(E,2),Y=i(ue),be=a(Y,2),z=a(be,2),$e=a(z,2);s(ue),s(ke);var Re=a(ke,2),T=a(i(Re),2);Se(T),s(Re),s(U);var q=a(U,2),u=a(i(q),2),Ie=i(u);Se(Ie);var Me=a(Ie,4);Se(Me);var re=a(Me,2);{var he=Z=>{const He=bt(()=>(H(ta),t(),n(()=>ta(t().class))));var _e=ft(),x=Ae(_e);{var N=ae=>{const se=bt(()=>(v(),n(()=>v().constitution)));var I=Pl(),ee=i(I);s(I),j(()=>D(ee,`(${H(e(He)),n(()=>e(He).hitDice)??""}${(e(se)>=0?`+${e(se)}`:e(se))??""})`)),c(ae,I)};b(x,ae=>{e(He)&&ae(N)})}c(Z,_e)};b(re,Z=>{t(),n(()=>t().class)&&Z(he)})}s(u);var je=a(u,2),qe=a(i(je),2),Ve=i(qe),Je=a(Ve,2);Se(Je);var fe=a(Je,2);s(qe);var we=a(qe,2);s(je),s(q),j(()=>{La(Pe,(e(V),t(),n(()=>e(V)!==0?`${t().armorClass} ‚Üí ${t().armorClass+e(V)}`:`${t().armorClass}`))),jt(Pe,1,Qs(e(V)!==0?"stat-input ac-enhanced":"stat-input"),"svelte-1r5hyyb"),La(st,(t(),n(()=>t().initiative))),Le=jt(ke,1,"hp-display svelte-1r5hyyb",null,Le,{"aid-active":e(Q)}),Qe(A,"max",(t(),n(()=>t().maxHP))),Qe(Ie,"max",(t(),n(()=>t().hitDice.max))),Ve.disabled=e(P)<=1,Qe(Je,"max",(t(),n(()=>t().hitDice.current))),fe.disabled=(e(P),t(),n(()=>e(P)>=t().hitDice.current)),we.disabled=(t(),n(()=>t().hitDice.current<=0||!t().class))}),Ne(ut,()=>t().speed,Z=>Lt(ve,n(t).speed=Z,n(t))),Ne(A,()=>t().currentHP,Z=>Lt(ve,n(t).currentHP=Z,n(t))),Ne(ie,()=>t().maxHP,Z=>Lt(ve,n(t).maxHP=Z,n(t))),$("click",Y,()=>ye(-1)),$("click",be,()=>ye(1)),$("click",z,()=>ye(-5)),$("click",$e,()=>ye(5)),Ne(T,()=>t().tempHP,Z=>Lt(ve,n(t).tempHP=Z,n(t))),Ne(Ie,()=>t().hitDice.current,Z=>Lt(ve,n(t).hitDice.current=Z,n(t))),Ne(Me,()=>t().hitDice.max,Z=>Lt(ve,n(t).hitDice.max=Z,n(t))),$("click",Ve,()=>ze(-1)),Ne(Je,()=>e(P),Z=>r(P,Z)),$("input",Je,Z=>{const He=Z.target,_e=parseInt(He.value);_e>t().hitDice.current&&r(P,t().hitDice.current),_e<1&&r(P,1)}),$("click",fe,()=>ze(1)),$("click",we,()=>de(e(P))),c(L,R)};b(xe,L=>{p(),n(()=>!p().combatStats)&&L(Ee)})}s(Te),j(()=>Xe=jt(Te,1,"combat-stats svelte-1r5hyyb",null,Xe,{hidden:!e(le)})),c(l,Te),Kt(),k()}const Pa={acrobatics:"dexterity",animalHandling:"wisdom",arcana:"intelligence",athletics:"strength",deception:"charisma",history:"intelligence",insight:"wisdom",intimidation:"charisma",investigation:"intelligence",medicine:"wisdom",nature:"intelligence",perception:"wisdom",performance:"charisma",persuasion:"charisma",religion:"intelligence",sleightOfHand:"dexterity",stealth:"dexterity",survival:"wisdom"};var Ul=f('<div class="skill-row svelte-1f1pl16"><input type="checkbox" class="svelte-1f1pl16"/> <label class="svelte-1f1pl16"> <span class="ability-tag svelte-1f1pl16"> </span></label> <span class="skill-modifier svelte-1f1pl16"> </span> <button class="roll-btn svelte-1f1pl16">Roll</button></div>'),Nl=f('<div class="skills-grid svelte-1f1pl16"></div>'),Ol=f("<section><!> <!></section>");function Gl(l,o){zt(o,!1);const t=()=>vt(ve,"$character",w),v=()=>vt(Ba,"$abilityModifiers",w),d=()=>vt(fa,"$searchFilter",w),p=()=>vt(ea,"$collapsedStates",w),m=()=>vt(pa,"$isEditMode",w),[w,k]=ra(),_=S(),K=S(),M=S(),te=S(),V=S(),Q=S(),le=ma(),O=[{key:"acrobatics",label:"Acrobatics"},{key:"animalHandling",label:"Animal Handling"},{key:"arcana",label:"Arcana"},{key:"athletics",label:"Athletics"},{key:"deception",label:"Deception"},{key:"history",label:"History"},{key:"insight",label:"Insight"},{key:"intimidation",label:"Intimidation"},{key:"investigation",label:"Investigation"},{key:"medicine",label:"Medicine"},{key:"nature",label:"Nature"},{key:"perception",label:"Perception"},{key:"performance",label:"Performance"},{key:"persuasion",label:"Persuasion"},{key:"religion",label:"Religion"},{key:"sleightOfHand",label:"Sleight of Hand"},{key:"stealth",label:"Stealth"},{key:"survival",label:"Survival"}];function P(ne){const xe=Pa[ne],Ee=v()[xe],L=t().skillProficiencies[ne]?t().proficiencyBonus:0,R=e(_)[ne],h=`1d20${R>=0?"+":""}${R}`,G=[];G.push({value:"1d20",source:"base die"}),Ee!==0&&G.push({value:Ee,source:xe}),L!==0&&G.push({value:L,source:"proficiency"}),le("roll",{notation:h,rollType:"check",bonusBreakdown:G})}et(()=>{},()=>{r(_,{})}),et(()=>t(),()=>{r(K,t().skillProficiencies)}),et(()=>t(),()=>{r(M,t().proficiencyBonus)}),et(()=>v(),()=>{r(te,v())}),et(()=>(e(te),e(K),e(M)),()=>{for(const{key:ne}of O){const xe=Pa[ne],Ee=e(te)[xe],L=e(K)[ne]?e(M):0;da(_,e(_)[ne]=Ee+L)}}),et(()=>d(),()=>{r(V,O.filter(({label:ne})=>d()?ne.toLowerCase().includes(d().toLowerCase()):!0))}),et(()=>e(V),()=>{r(Q,e(V).length>0)}),ca(),Wt();var ye=Ol();let ze;var de=i(ye);{let ne=bt(()=>(p(),n(()=>p().skills?"Expand":"Collapse")));ba(de,{title:"Skills",get collapsed(){return p(),n(()=>p().skills)},get ariaLabel(){return e(ne)},onToggle:()=>ea.update(xe=>({...xe,skills:!xe.skills}))})}var Te=a(de,2);{var Xe=ne=>{var xe=Nl();wt(xe,5,()=>e(V),Ct,(Ee,L)=>{let R=()=>e(L).key,h=()=>e(L).label;var G=Ul(),g=i(G);Se(g);var B=a(g,2),J=i(B),Oe=a(J),Pe=i(Oe);s(Oe),s(B);var De=a(B,2),Be=i(De);s(De);var dt=a(De,2);s(G),j(st=>{$s(g,(e(K),R(),n(()=>e(K)[R()]))),g.disabled=!m(),Qe(g,"id",R()),Qe(B,"for",R()),D(J,`${h()??""} `),D(Pe,`(${st??""})`),D(Be,`${e(_),R(),n(()=>e(_)[R()]>=0?"+":"")??""}${e(_),R(),n(()=>e(_)[R()])??""}`)},[()=>(H(Pa),R(),n(()=>Pa[R()].substring(0,3).toUpperCase()))]),$("change",g,st=>{console.log("Skill proficiency changed:",R(),st.target.checked),ve.update(gt=>({...gt,skillProficiencies:{...gt.skillProficiencies,[R()]:st.target.checked}}))}),$("click",dt,()=>P(R())),c(Ee,G)}),s(xe),c(ne,xe)};b(Te,ne=>{p(),n(()=>!p().skills)&&ne(Xe)})}s(ye),j(()=>ze=jt(ye,1,"skills svelte-1f1pl16",null,ze,{hidden:!e(Q)})),c(l,ye),Kt(),k()}var ql=f('<p class="empty-message svelte-1123ljy">No attacks or spells to reorder.</p>'),Wl=f('<li class="reorder-item svelte-1123ljy"><span class="attack-name svelte-1123ljy"> </span> <div class="reorder-buttons svelte-1123ljy"><button class="btn-move svelte-1123ljy" aria-label="Move up">‚ñ≤</button> <button class="btn-move svelte-1123ljy" aria-label="Move down">‚ñº</button></div></li>'),zl=f('<ul class="reorder-list svelte-1123ljy"></ul>'),Kl=f('<div class="modal-backdrop svelte-1123ljy" role="presentation"><div class="modal-content svelte-1123ljy" role="dialog" aria-modal="true" aria-labelledby="modal-title"><div class="modal-header svelte-1123ljy"><h3 id="modal-title" class="svelte-1123ljy">Reorder Attacks & Spells</h3> <button class="btn-close svelte-1123ljy" aria-label="Close">√ó</button></div> <div class="modal-body svelte-1123ljy"><!></div> <div class="modal-footer svelte-1123ljy"><button class="btn btn-secondary svelte-1123ljy">Cancel</button> <button class="btn btn-primary svelte-1123ljy">Save Order</button></div></div></div>');function Vl(l,o){zt(o,!1);let t=yt(o,"show",8,!1),v=yt(o,"attacks",24,()=>[]),d=yt(o,"onSave",8),p=yt(o,"onCancel",8),m=S([]);function w(O,P){const ye=e(m)[O];da(m,e(m)[O]=e(m)[P]),da(m,e(m)[P]=ye),r(m,[...e(m)])}function k(O){O>0&&w(O,O-1)}function _(O){O<e(m).length-1&&w(O,O+1)}function K(){d()(e(m))}function M(){p()()}function te(O){O.target===O.currentTarget&&M()}et(()=>(H(t()),H(v())),()=>{t()&&r(m,[...v()])}),ca(),Wt();var V=ft(),Q=Ae(V);{var le=O=>{var P=Kl(),ye=i(P),ze=i(ye),de=a(i(ze),2);s(ze);var Te=a(ze,2),Xe=i(Te);{var ne=h=>{var G=ql();c(h,G)},xe=h=>{var G=zl();wt(G,7,()=>e(m),g=>g.id,(g,B,J)=>{var Oe=Wl(),Pe=i(Oe),De=i(Pe,!0);s(Pe);var Be=a(Pe,2),dt=i(Be),st=a(dt,2);s(Be),s(Oe),j(()=>{D(De,(e(B),n(()=>e(B).name||"(Unnamed attack or spell)"))),dt.disabled=e(J)===0,st.disabled=(H(e(J)),e(m),n(()=>e(J)===e(m).length-1))}),$("click",dt,()=>k(e(J))),$("click",st,()=>_(e(J))),c(g,Oe)}),s(G),c(h,G)};b(Xe,h=>{e(m),n(()=>e(m).length===0)?h(ne):h(xe,!1)})}s(Te);var Ee=a(Te,2),L=i(Ee),R=a(L,2);s(Ee),s(ye),s(P),$("click",de,M),$("click",L,M),$("click",R,K),$("click",P,te),c(O,P)};b(Q,O=>{t()&&O(le)})}c(l,V),Kt()}let Ea=null,Ia=null;async function js(){if(Ea)return Ea;try{return Ea=await(await fetch(Cs("/data/spells.json"))).json(),Ea||[]}catch(l){return console.error("Failed to load spells:",l),[]}}async function Jl(){if(Ia)return Ia;try{return Ia=await(await fetch(Cs("/data/feats.json"))).json(),Ia||[]}catch(l){return console.error("Failed to load feats:",l),[]}}function ms(l,o){if(!o.trim())return l;const t=o.toLowerCase();return l.filter(v=>v.name.toLowerCase().includes(t)||v.school.toLowerCase().includes(t)||v.classes.some(d=>d.toLowerCase().includes(t))||v.description.toLowerCase().includes(t))}function Yl(l,o){return o===null?l:l.filter(t=>t.level===o)}function Ql(l,o){if(!o.trim())return l;const t=o.toLowerCase();return l.filter(v=>v.name.toLowerCase().includes(t)||v.description.toLowerCase().includes(t))}function Ha(l){const o=l.description,t=/\b(Strength|Dexterity|Constitution|Intelligence|Wisdom|Charisma)\s+saving\s+throw/i,v=o.match(t);if(!v)return null;const d=v[1].toLowerCase(),m=/half\s+(?:as\s+much\s+)?damage\s+on\s+a\s+successful(?:\s+save)?/i.test(o),k=/saving\s+throw\s+or\s+take.*?damage/i.test(o)&&!m;return{ability:d,halfDamageOnSave:m,noDamageOnSave:k}}function Xl(l){const o=l.description;return/(plus|add)\s+your\s+spellcasting\s+(ability\s+)?modifier/i.test(o)}function Ya(l){const o=l.description.toLowerCase();return o.includes("ranged spell attack")||o.includes("melee spell attack")}function bs(l){const o=l.description.toLowerCase();if(["Divine Favor","Bless","Aid","Command"].includes(l.name))return!0;const d=["takes","take","deals","deal","damage equal to","force damage","fire damage","cold damage","lightning damage","thunder damage","acid damage","poison damage","necrotic damage","radiant damage","psychic damage","regain","regains","hit point"].some(w=>o.includes(w));return["bonus to attack","bonus to damage","bonus to ac","gains a +","gain a +","+1 bonus","+2 bonus","+3 bonus","advantage on","becomes a magic weapon"].some(w=>o.includes(w))&&!d}function Zl(l){const o=l.description;let t=0,v=0,d=0,p="";const m=o.match(/\+(\d+)\s+bonus\s+to\s+attack\s+rolls\s+and\s+damage\s+rolls/i);if(m){const k=parseInt(m[1]);t=k,v=k,p=`+${k} to attack and damage rolls`}if(l.name==="Bless"&&(p="Add 1d4 to attack rolls and saves",t="1d4"),l.name==="Aid")return p="+5 HP (max and current) for 8 hours",{attackBonus:0,damageBonus:0,acBonus:0,hpBonus:5,description:p,name:l.name};l.name==="Divine Favor"&&(p="Your weapon attacks deal an extra 1d4 radiant damage on a hit.",v="1d4");const w=o.match(/\+(\d+)\s+bonus\s+to\s+AC/i);return w&&(d=parseInt(w[1]),p=`+${d} to AC`),l.name==="Haste"&&(p="+2 AC, doubled speed, extra action",d=2),p||t!==0||v!==0||d!==0?{attackBonus:t,damageBonus:v,acBonus:d,description:p||l.description.substring(0,100),name:l.name}:null}function Qa(l){const o=l.description,t=/takes?\s+(\d+d\d+)\s+\w+\s+damage[^.]*\.\s*If\s+the\s+target\s+is\s+missing.*?instead\s+takes?\s+(\d+d\d+)/is,v=o.match(t);return v?{baseDamage:v[1],alternateDamage:v[2]}:null}var ei=f('<button class="btn btn-secondary">Reorder</button>'),ti=f('<div class="edit-buttons svelte-14o91c5"><button class="btn btn-secondary">Add Attack</button> <!></div>'),ai=f('<input type="text" placeholder="Attack name" class="attack-name svelte-14o91c5"/>'),si=f('<h4 class="attack-name-display svelte-14o91c5"> </h4>'),li=f('<button class="btn-remove svelte-14o91c5">√ó</button>'),ii=f('<div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Bonus</label> <input type="number" class="attack-bonus svelte-14o91c5"/></div>'),ni=f('<div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Damage</label> <input type="text" placeholder="e.g., 2d6+3" class="attack-damage svelte-14o91c5"/></div>'),ri=f('<div class="spell-info-loading svelte-14o91c5">Loading spell info...</div>'),oi=f('<li class="svelte-14o91c5"><strong>At Higher Levels:</strong> </li>'),ci=f('<ul class="svelte-14o91c5"><li class="svelte-14o91c5"><strong>Level:</strong> </li> <li class="svelte-14o91c5"><strong>Casting Time:</strong> </li> <li class="svelte-14o91c5"><strong>Range:</strong> </li> <li class="svelte-14o91c5"><strong>Components:</strong> <!></li> <li class="svelte-14o91c5"><strong>Duration:</strong> <!> </li> <li class="svelte-14o91c5"><strong>Description:</strong> </li> <!></ul>'),vi=f('<span class="scaled-damage svelte-14o91c5" style="margin-left: 8px;"> </span>'),di=f('<span class="scaled-damage svelte-14o91c5">(Half damage)</span>'),ui=f('<span class="scaled-damage svelte-14o91c5">(No damage)</span>'),pi=f('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> <!> <!></label></div>'),fi=f('<span class="scaled-damage svelte-14o91c5"> </span>'),gi=f('<span class="scaled-damage svelte-14o91c5"> </span>'),mi=f('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> Target is missing HP <!></label></div>'),bi=f("<option> </option>"),hi=f('<span class="scaled-damage svelte-14o91c5"><!> </span>'),_i=f('<span class="scaled-damage svelte-14o91c5"> </span>'),yi=f('<div class="target-condition svelte-14o91c5"><label class="svelte-14o91c5"><input type="checkbox" class="use-enabled svelte-14o91c5"/> Target is Fiend or Undead <!></label></div>'),xi=f('<div class="spell-level-selector svelte-14o91c5"><label class="svelte-14o91c5">Cast at Level:</label> <select class="spell-level-select use-enabled svelte-14o91c5"></select> <!></div> <!>',1),ki=f('<div class="spell-level-selector svelte-14o91c5"><span style="color: #dc3545; font-weight: bold;">No spell slots available!</span></div>'),wi=f('<div class="spell-info svelte-14o91c5"><div class="spell-info-header svelte-14o91c5" role="button" tabindex="0"><h4 class="svelte-14o91c5">Spell Info</h4> <button class="collapse-btn-small svelte-14o91c5"> </button></div> <!></div> <!> <!> <!>',1),Si=f('<div class="spell-info-missing svelte-14o91c5">Spell info not found.</div>'),$i=f('<div class="attack-notes svelte-14o91c5"><label class="svelte-14o91c5">Notes</label> <textarea placeholder="e.g., DC 15 Dex save, Range 120 ft, Concentration" class="notes-input svelte-14o91c5" rows="2"></textarea></div>'),Ci=f('<button class="btn btn-primary">Roll Attack</button>'),Di=f('<div class="buff-target-selection svelte-14o91c5"><div class="target-options svelte-14o91c5"><label class="target-option svelte-14o91c5"><input type="radio" class="svelte-14o91c5"/> Self</label> <label class="target-option svelte-14o91c5"><input type="radio" class="svelte-14o91c5"/> Other</label></div> <button class="btn btn-info"> </button></div>'),Li=f('<button class="btn btn-info">Cast Spell</button>'),ji=f("<button><!></button>"),Ai=f('<button class="btn btn-info">Cast Spell</button>'),Bi=f('<button class="btn btn-secondary">Roll Damage</button>'),Ri=f('<button class="btn btn-primary">Roll Attack</button> <!>',1),Mi=f('<div class="attack-card svelte-14o91c5"><div class="attack-header svelte-14o91c5"><!> <!></div> <div class="attack-details svelte-14o91c5"><!> <!> <div class="attack-field svelte-14o91c5"><label class="svelte-14o91c5">Type</label> <input type="text" placeholder="e.g., slashing" class="attack-type svelte-14o91c5"/></div></div> <!> <!> <div class="attack-actions svelte-14o91c5"><!></div></div>'),Fi=f('<p class="no-attacks svelte-14o91c5">No attacks added yet. Click "Add Attack" to create one.</p>'),Ti=f('<p class="no-attacks svelte-14o91c5">No attacks match your search.</p>'),Pi=f('<button class="btn-remove svelte-14o91c5">√ó</button>'),Ei=f('<div class="state-card svelte-14o91c5"><div class="state-header svelte-14o91c5"><input type="text" placeholder="Effect name (e.g., Magic Weapon)" class="state-name svelte-14o91c5"/> <!></div> <div class="state-details svelte-14o91c5"><div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Attack Bonus</label> <input type="number" class="state-bonus svelte-14o91c5"/></div> <div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Damage Bonus</label> <input type="text" class="state-bonus svelte-14o91c5"/></div> <div class="state-field svelte-14o91c5"><label class="svelte-14o91c5">Target</label> <select class="state-bonus svelte-14o91c5"><option>Self</option><option>Other</option></select></div></div> <div class="state-description svelte-14o91c5"><label class="svelte-14o91c5">Description</label> <input type="text" placeholder="e.g., +1 to attack and damage rolls (Magic Weapon)" class="state-desc-input svelte-14o91c5"/></div></div>'),Ii=f('<div class="states-list svelte-14o91c5"></div>'),Hi=f('<p class="no-states svelte-14o91c5">No active effects. Add spell effects that modify your attacks.</p>'),Ui=f('<!> <div class="attacks-list svelte-14o91c5"><!> <!></div> <div class="active-states-section svelte-14o91c5"><h3 class="svelte-14o91c5">Active Spell Effects</h3> <p class="section-description svelte-14o91c5">Effects that modify attack and damage rolls (e.g., Magic Weapon, Bless)</p> <button class="btn btn-secondary">Add Effect</button> <!></div>',1),Ni=f("<section><!> <!></section> <!>",1);function Oi(l,o){zt(o,!1);const t=()=>vt(ve,"$character",w),v=()=>vt(Ba,"$abilityModifiers",w),d=()=>vt(fa,"$searchFilter",w),p=()=>vt(ea,"$collapsedStates",w),m=()=>vt(pa,"$isEditMode",w),[w,k]=ra(),_=S(),K=S(),M=[],te=ma();let V=S({}),Q=S({}),le=S(!1);function O(y){da(V,e(V)[y]=!e(V)[y]),r(V,{...e(V)})}function P(y){return y.description.toLowerCase().includes("regain")&&(y.description.toLowerCase().includes("hit point")||y.description.toLowerCase().includes("hp"))}function ye(y){return["Shield of Faith","Bless","Aid","Magic Weapon"].includes(y)}function ze(){ve.update(y=>(y.attacks=[...y.attacks,{id:crypto.randomUUID(),name:"",bonus:0,damage:"",damageType:"",notes:""}],y))}function de(y){ve.update(U=>(U.attacks=U.attacks.filter(ke=>ke.id!==y),U))}function Te(){r(le,!0)}function Xe(){r(le,!1)}function ne(y){ve.update(U=>(U.attacks=y,U)),r(le,!1),Zt.add("Attack order updated successfully!","success")}function xe(y){let U=y.damage,ke=!1,Le=!1;if(y.spellRef){const Y=h(y.spellRef);if(Y&&(Le=Ya(Y),Y.level>0)){const be=y.castAtLevel||Y.level;if(!G(be)){Zt.add(`No level ${be} spell slots available!`,"error");return}const $e=Ha(Y);$e&&y.targetSucceededSave&&$e.noDamageOnSave?U="0":(ke=$e?.halfDamageOnSave&&y.targetSucceededSave||!1,U=g(y,Y))}}else if(t().activeStates&&t().activeStates.length>0){let Y=0,be=[];for(const z of t().activeStates)z.target!=="other"&&(typeof z.damageBonus=="string"?be.push(z.damageBonus):typeof z.damageBonus=="number"&&(Y+=z.damageBonus));if((Y!==0||be.length>0)&&U){const z=U.match(/(\d+d\d+)([+-]\d+)?/);if(z){const[,$e,Re]=z,q=(Re?parseInt(Re):0)+Y;let u=`${$e}`;q!==0&&(u+=`${q>=0?"+":""}${q}`),be.length>0&&(u+=" + "+be.join(" + ")),U=u}}}const E=[];let A=0;if(Le){const Y=gs(t(),v()),be=t().proficiencyBonus||0;E.push({value:be,source:"proficiency"}),E.push({value:Y,source:"spellcasting"}),A=be+Y}else y.bonus!==0&&E.push({value:y.bonus,source:"base"}),A=y.bonus;let ie=[];if(t().activeStates)for(const Y of t().activeStates)Y.target!=="other"&&(typeof Y.attackBonus=="number"&&Y.attackBonus!==0?(E.push({value:Y.attackBonus,source:Y.name.toLowerCase()}),A+=Y.attackBonus):typeof Y.attackBonus=="string"&&Y.attackBonus&&(ie.push(Y.attackBonus),E.push({value:Y.attackBonus,source:Y.name.toLowerCase()})));let ue=`1d20${A>=0?"+":""}${A}`;ie.length>0&&(ue+="+"+ie.join("+")),te("roll",{notation:ue,damageNotation:U,attackName:y.name,applyHalfDamage:ke,bonusBreakdown:E,rollType:"attack"})}function Ee(y){if(!y.damage){Zt.add(`${y.name}: No damage specified`,"error");return}let U=y.damage,ke=!1;const Le=[];if(y.spellRef){const E=h(y.spellRef);if(E&&E.level>0){const A=y.castAtLevel||E.level;if(!G(A)){Zt.add(`No level ${A} spell slots available!`,"error");return}const ue=Ha(E);ue&&y.targetSucceededSave&&ue.noDamageOnSave?U="0":(ke=ue?.halfDamageOnSave&&y.targetSucceededSave||!1,U=g(y,E))}}else{const E=U.match(/(\d+d\d+)([+-]\d+)?/);if(E){const[,A,ie]=E,ue=ie?parseInt(ie):0;if(ue!==0&&Le.push({value:ue,source:"base"}),t().activeStates&&t().activeStates.length>0){let Y=0,be=[];for(const z of t().activeStates)z.target!=="other"&&(typeof z.damageBonus=="string"?be.push(z.damageBonus):typeof z.damageBonus=="number"&&z.damageBonus!==0&&(Le.push({value:z.damageBonus,source:z.name.toLowerCase()}),Y+=z.damageBonus));if(Y!==0||be.length>0){const z=ue+Y;let $e=`${A}`;z!==0&&($e+=`${z>=0?"+":""}${z}`),be.length>0&&($e+=" + "+be.join(" + ")),U=$e}}}}te("roll",{notation:U,attackName:y.name,applyHalfDamage:ke,bonusBreakdown:Le})}let L=S([]),R=S(!1);ka(async()=>{r(L,await js()),r(R,!0)});function h(y){return e(L).find(U=>U.name===y)}function G(y){t().classFeatures.spellSlotsByLevel||Lt(ve,n(t).classFeatures.spellSlotsByLevel={},n(t)),t().classFeatures.spellSlotsByLevel[y]||Lt(ve,n(t).classFeatures.spellSlotsByLevel[y]=Array(2).fill(!1),n(t));const ke=t().classFeatures.spellSlotsByLevel[y].findIndex(Le=>!Le);return ke===-1?!1:(ve.update(Le=>(Le.classFeatures.spellSlotsByLevel||(Le.classFeatures.spellSlotsByLevel={}),Le.classFeatures.spellSlotsByLevel[y]||(Le.classFeatures.spellSlotsByLevel[y]=Array(2).fill(!1)),Le.classFeatures.spellSlotsByLevel[y][ke]=!0,Le)),!0)}function g(y,U){let ke=y.damage,Le=0,E=0;const A=Qa(U);if(A&&y.targetIsDamaged&&(ke=A.alternateDamage),Xl(U)&&(E+=gs(t(),v())),t().activeStates)for(const q of t().activeStates)q.target!=="other"&&typeof q.damageBonus=="number"&&(E+=q.damageBonus);if(U.higherLevelSlot&&y.castAtLevel){const q=U.level,Ie=(y.castAtLevel||q)-q;if(Ie>0){const Me=U.higherLevelSlot.match(/(\d+)d(\d+)\s+for\s+each.*?level\s+above/i);if(Me){const[,re]=Me;Le+=Ie*parseInt(re)}}}if(y.targetIsFiendOrUndead&&U.description.includes("Fiend or an Undead")){const q=U.description.match(/increases by (\d+)d(\d+) if.*?Fiend or.*?Undead/i);if(q){const[,u]=q;Le+=parseInt(u)}}const ie=ke.match(/(\d+)d(\d+)([+-]\d+)?/);if(!ie)return E!==0?E>=0?`${E}`:`${E}`:ke||"0";const[,ue,Y,be]=ie,z=parseInt(ue)+Le,Re=(be?parseInt(be):0)+E;let T=`${z}d${Y}`;return Re!==0&&(T+=Re>=0?`+${Re}`:`${Re}`),T}function B(y){const U=[];for(let Le=y.level;Le<=9;Le++){const E=t().classFeatures.spellSlotsByLevel?.[Le];E&&E.length>0&&U.push(Le)}return U}function J(){ve.update(y=>(y.activeStates||(y.activeStates=[]),y.activeStates=[...y.activeStates,{name:"",attackBonus:0,damageBonus:0,description:"",target:"self"}],y))}function Oe(y){ve.update(U=>{if(U.activeStates){const ke=U.activeStates[y];ke?.hpBonus&&ke.target!=="other"&&(U.maxHP-=ke.hpBonus,U.currentHP=Math.max(1,Math.min(U.currentHP-ke.hpBonus,U.maxHP))),U.activeStates=U.activeStates.filter((Le,E)=>E!==y)}return U})}function Pe(y,U="self"){const ke=h(y.spellRef);if(!ke){Zt.add("Spell not found","error");return}const Le=y.castAtLevel||ke.level;if(Le>0&&!G(Le)){Zt.add(`No level ${Le} spell slots available!`,"error");return}const E=Zl(ke);if(!E){Zt.add(`${ke.name} cast! Check spell description for effects.`,"info");return}let A=E.hpBonus||0,ie=E.description;ke.name==="Aid"&&Le>ke.level&&(A=5+(Le-ke.level)*5,ie=`+${A} HP (max and current) for 8 hours`);const Y=["Shield of Faith","Bless","Aid","Magic Weapon"].includes(ke.name);ve.update(z=>{z.activeStates||(z.activeStates=[]);const $e=z.activeStates.find(Re=>Re.name===ke.name);return $e&&$e.hpBonus&&$e.target!=="other"&&(z.maxHP-=$e.hpBonus,z.currentHP=Math.max(1,Math.min(z.currentHP-$e.hpBonus,z.maxHP))),z.activeStates=z.activeStates.filter(Re=>Re.name!==ke.name),A>0&&U==="self"&&(z.maxHP+=A,z.currentHP+=A),z.activeStates=[...z.activeStates,{name:ke.name,attackBonus:E.attackBonus,damageBonus:E.damageBonus,acBonus:E.acBonus,description:ie,target:U,hpBonus:A}],z});const be=U==="self"?" on self":" on other";Zt.add(`${ke.name} cast${Y?be:""}! Effect added to Active Spell Effects.`,"success")}et(()=>(t(),e(V),e(Q)),()=>{if(t()&&t().attacks)for(const y of t().attacks)y.spellRef&&e(V)[y.id]===void 0&&da(V,e(V)[y.id]=!0),y.spellRef&&e(Q)[y.id]===void 0&&da(Q,e(Q)[y.id]="self")}),et(()=>(t(),d()),()=>{r(_,t().attacks.filter(y=>{if(!d())return!0;const U=d().toLowerCase();return y.name.toLowerCase().includes(U)||y.damageType.toLowerCase().includes(U)}).sort((y,U)=>!y.spellRef&&U.spellRef?-1:y.spellRef&&!U.spellRef?1:0))}),et(()=>(d(),e(_)),()=>{r(K,!d()||e(_).length>0||"attack".includes(d().toLowerCase())||"spell".includes(d().toLowerCase()))}),ca(),Wt();var De=Ni(),Be=Ae(De);let dt;var st=i(Be);{let y=bt(()=>(p(),n(()=>p().attacks?"Expand":"Collapse")));ba(st,{title:"Attacks & Spells",get collapsed(){return p(),n(()=>p().attacks)},get ariaLabel(){return e(y)},onToggle:()=>ea.update(U=>({...U,attacks:!U.attacks}))})}var gt=a(st,2);{var ut=y=>{var U=Ui(),ke=Ae(U);{var Le=q=>{var u=ti(),Ie=i(u),Me=a(Ie,2);{var re=he=>{var je=ei();$("click",je,Te),c(he,je)};b(Me,he=>{t(),n(()=>t().attacks.length>0)&&he(re)})}s(u),$("click",Ie,ze),c(q,u)};b(ke,q=>{m()&&q(Le)})}var E=a(ke,2),A=i(E);wt(A,1,()=>e(_),q=>q.id,(q,u,Ie)=>{var Me=Mi(),re=i(Me),he=i(re);{var je=oe=>{var pe=ai();Se(pe),Ne(pe,()=>e(u).name,Ze=>(e(u).name=Ze,Ft(()=>(e(_),t(),d())))),c(oe,pe)},qe=oe=>{var pe=si(),Ze=i(pe,!0);s(pe),j(()=>D(Ze,(e(u),n(()=>e(u).name||"(Unnamed Attack)")))),c(oe,pe)};b(he,oe=>{m()?oe(je):oe(qe,!1)})}var Ve=a(he,2);{var Je=oe=>{var pe=li();$("click",pe,()=>de(e(u).id)),c(oe,pe)};b(Ve,oe=>{m()&&oe(Je)})}s(re);var fe=a(re,2),we=i(fe);{var Z=oe=>{var pe=ii(),Ze=i(pe),nt=a(Ze,2);Se(nt),s(pe),j(()=>{Qe(Ze,"for",`attack-bonus-${e(u),n(()=>e(u).id)??""}`),Qe(nt,"id",`attack-bonus-${e(u),n(()=>e(u).id)??""}`)}),Ne(nt,()=>e(u).bonus,ge=>(e(u).bonus=ge,Ft(()=>(e(_),t(),d())))),c(oe,pe)};b(we,oe=>{e(u),n(()=>e(u).bonus!==0&&e(u).bonus!==void 0)&&oe(Z)})}var He=a(we,2);{var _e=oe=>{var pe=ni(),Ze=i(pe),nt=a(Ze,2);Se(nt),s(pe),j(()=>{Qe(Ze,"for",`attack-damage-${e(u),n(()=>e(u).id)??""}`),Qe(nt,"id",`attack-damage-${e(u),n(()=>e(u).id)??""}`)}),Ne(nt,()=>e(u).damage,ge=>(e(u).damage=ge,Ft(()=>(e(_),t(),d())))),c(oe,pe)};b(He,oe=>{e(u),n(()=>e(u).damage&&e(u).damage.trim()!=="")&&oe(_e)})}var x=a(He,2),N=i(x),ae=a(N,2);Se(ae),s(x),s(fe);var se=a(fe,2);{var I=oe=>{var pe=ft(),Ze=Ae(pe);{var nt=Ue=>{var ce=ri();c(Ue,ce)},ge=Ue=>{const ce=bt(()=>(e(u),n(()=>h(e(u).spellRef))));var pt=ft(),at=Ae(pt);{var C=F=>{const Fe=bt(()=>(H(Ha),H(e(ce)),n(()=>Ha(e(ce))))),X=bt(()=>(H(Qa),H(e(ce)),n(()=>Qa(e(ce)))));var lt=wi(),me=Ae(lt),it=i(me),Ye=a(i(it),2),Tt=i(Ye,!0);s(Ye),s(it);var Vt=a(it,2);{var Bt=St=>{var Dt=ci(),Pt=i(Dt),Yt=a(i(Pt));s(Pt);var aa=a(Pt,2),ia=a(i(aa));s(aa);var Nt=a(aa,2),At=a(i(Nt));s(Nt);var It=a(Nt,2),Ot=a(i(It)),kt=a(Ot);{var Qt=Rt=>{var Mt=qt();j(()=>D(Mt,`(${H(e(ce)),n(()=>e(ce).material)??""})`)),c(Rt,Mt)};b(kt,Rt=>{H(e(ce)),n(()=>e(ce).material)&&Rt(Qt)})}s(It);var na=a(It,2),rt=a(i(na),2);{var mt=Rt=>{var Mt=qt("Concentration,");c(Rt,Mt)};b(rt,Rt=>{H(e(ce)),n(()=>e(ce).concentration)&&Rt(mt)})}var ct=a(rt,1,!0);s(na);var ht=a(na,2),_t=a(i(ht));s(ht);var Xt=a(ht,2);{var sa=Rt=>{var Mt=oi(),la=a(i(Mt));s(Mt),j(()=>D(la,` ${H(e(ce)),n(()=>e(ce).higherLevelSlot)??""}`)),c(Rt,Mt)};b(Xt,Rt=>{H(e(ce)),n(()=>e(ce).higherLevelSlot)&&Rt(sa)})}s(Dt),j(Rt=>{D(Yt,` ${H(e(ce)),n(()=>e(ce).level)??""}`),D(ia,` ${H(e(ce)),n(()=>e(ce).castingTime||e(ce).actionType)??""}`),D(At,` ${H(e(ce)),n(()=>e(ce).range)??""}`),D(Ot,` ${Rt??""}`),D(ct,(H(e(ce)),n(()=>e(ce).duration))),D(_t,` ${H(e(ce)),n(()=>e(ce).description)??""}`)},[()=>(H(e(ce)),n(()=>e(ce).components.join(", ")))]),c(St,Dt)};b(Vt,St=>{e(V),e(u),n(()=>!e(V)[e(u).id])&&St(Bt)})}s(me);var xt=a(me,2);{var Jt=St=>{var Dt=pi(),Pt=i(Dt),Yt=i(Pt);Se(Yt);var aa=a(Yt),ia=a(aa);{var Nt=kt=>{var Qt=vi(),na=i(Qt);s(Qt),j(rt=>D(na,`(Spell Save DC: ${rt??""})`),[()=>(H(as),t(),v(),n(()=>as(t(),v())))]),c(kt,Qt)};b(ia,kt=>{t(),n(()=>t().class)&&kt(Nt)})}var At=a(ia,2);{var It=kt=>{var Qt=di();c(kt,Qt)},Ot=kt=>{var Qt=ft(),na=Ae(Qt);{var rt=mt=>{var ct=ui();c(mt,ct)};b(na,mt=>{e(u),H(e(Fe)),n(()=>e(u).targetSucceededSave&&e(Fe).noDamageOnSave)&&mt(rt)},!0)}c(kt,Qt)};b(At,kt=>{e(u),H(e(Fe)),n(()=>e(u).targetSucceededSave&&e(Fe).halfDamageOnSave)?kt(It):kt(Ot,!1)})}s(Pt),s(Dt),j(kt=>D(aa,` Target succeeded on ${kt??""} save `),[()=>(H(e(Fe)),n(()=>e(Fe).ability.charAt(0).toUpperCase()+e(Fe).ability.slice(1)))]),_a(Yt,()=>e(u).targetSucceededSave,kt=>(e(u).targetSucceededSave=kt,Ft(()=>(e(_),t(),d())))),c(St,Dt)};b(xt,St=>{e(Fe)&&St(Jt)})}var $t=a(xt,2);{var Ht=St=>{var Dt=mi(),Pt=i(Dt),Yt=i(Pt);Se(Yt);var aa=a(Yt,2);{var ia=At=>{const It=bt(()=>(e(u),H(e(ce)),n(()=>g(e(u),e(ce)))));var Ot=fi(),kt=i(Ot);s(Ot),j(()=>D(kt,`(${H(e(X)),n(()=>e(X).alternateDamage)??""}, total: ${e(It)??""})`)),c(At,Ot)},Nt=At=>{var It=gi(),Ot=i(It);s(It),j(()=>D(Ot,`(${H(e(X)),n(()=>e(X).baseDamage)??""})`)),c(At,It)};b(aa,At=>{e(u),n(()=>e(u).targetIsDamaged)?At(ia):At(Nt,!1)})}s(Pt),s(Dt),_a(Yt,()=>e(u).targetIsDamaged,At=>(e(u).targetIsDamaged=At,Ft(()=>(e(_),t(),d())))),c(St,Dt)};b($t,St=>{e(X)&&St(Ht)})}var Et=a($t,2);{var Ut=St=>{const Dt=bt(()=>(H(e(ce)),n(()=>B(e(ce)))));var Pt=ft(),Yt=Ae(Pt);{var aa=Nt=>{var At=xi(),It=Ae(At),Ot=i(It),kt=a(Ot,2);j(()=>{e(u),Ft(()=>{e(Dt)})}),wt(kt,5,()=>e(Dt),Ct,(ct,ht)=>{var _t=bi(),Xt=i(_t);s(_t);var sa={};j(()=>{D(Xt,`Level ${e(ht)??""}`),sa!==(sa=e(ht))&&(_t.value=(_t.__value=e(ht))??"")}),c(ct,_t)}),s(kt);var Qt=a(kt,2);{var na=ct=>{const ht=bt(()=>(e(u),H(e(ce)),n(()=>g(e(u),e(ce)))));var _t=hi(),Xt=i(_t);{var sa=la=>{var va=qt("Healing");c(la,va)},Rt=la=>{var va=qt("Damage");c(la,va)};b(Xt,la=>{H(e(ce)),n(()=>P(e(ce)))?la(sa):la(Rt,!1)})}var Mt=a(Xt);s(_t),j(()=>D(Mt,` ${e(ht)??""}`)),c(ct,_t)};b(Qt,ct=>{e(u),H(e(ce)),n(()=>e(u).castAtLevel&&e(u).castAtLevel>e(ce).level)&&ct(na)})}s(It);var rt=a(It,2);{var mt=ct=>{var ht=yi(),_t=i(ht),Xt=i(_t);Se(Xt);var sa=a(Xt,2);{var Rt=Mt=>{const la=bt(()=>(e(u),H(e(ce)),n(()=>g(e(u),e(ce)))));var va=_i(),Ga=i(va);s(va),j(()=>D(Ga,`(+1d8, total: ${e(la)??""})`)),c(Mt,va)};b(sa,Mt=>{e(u),n(()=>e(u).targetIsFiendOrUndead)&&Mt(Rt)})}s(_t),s(ht),_a(Xt,()=>e(u).targetIsFiendOrUndead,Mt=>(e(u).targetIsFiendOrUndead=Mt,Ft(()=>(e(_),t(),d())))),c(ct,ht)};b(rt,ct=>{H(e(ce)),n(()=>e(ce).description.includes("Fiend or an Undead"))&&ct(mt)})}j(()=>{Qe(Ot,"for",`castLevel-${e(u),n(()=>e(u).id)??""}`),Qe(kt,"id",`castLevel-${e(u),n(()=>e(u).id)??""}`)}),Aa(kt,()=>e(u).castAtLevel,ct=>(e(u).castAtLevel=ct,Ft(()=>(e(_),t(),d())))),c(Nt,At)},ia=Nt=>{var At=ki();c(Nt,At)};b(Yt,Nt=>{H(e(Dt)),n(()=>e(Dt).length>0)?Nt(aa):Nt(ia,!1)})}c(St,Pt)};b(Et,St=>{H(e(ce)),n(()=>e(ce).higherLevelSlot&&e(ce).level>0)&&St(Ut)})}j(()=>{Qe(Ye,"aria-label",(e(V),e(u),n(()=>e(V)[e(u).id]?"Expand":"Collapse"))),D(Tt,(e(V),e(u),n(()=>e(V)[e(u).id]?"‚ñº":"‚ñ≤")))}),$("click",it,()=>O(e(u).id)),$("keydown",it,St=>St.key==="Enter"&&O(e(u).id)),c(F,lt)},Ce=F=>{var Fe=Si();c(F,Fe)};b(at,F=>{e(ce)?F(C):F(Ce,!1)})}c(Ue,pt)};b(Ze,Ue=>{e(L),n(()=>e(L).length===0)?Ue(nt):Ue(ge,!1)})}c(oe,pe)};b(se,oe=>{e(u),n(()=>e(u).spellRef)&&oe(I)})}var ee=a(se,2);{var We=oe=>{var pe=$i(),Ze=i(pe),nt=a(Ze,2);ga(nt),s(pe),j(()=>{Qe(Ze,"for",`attack-notes-${e(u),n(()=>e(u).id)??""}`),Qe(nt,"id",`attack-notes-${e(u),n(()=>e(u).id)??""}`)}),Ne(nt,()=>e(u).notes,ge=>(e(u).notes=ge,Ft(()=>(e(_),t(),d())))),c(oe,pe)};b(ee,oe=>{e(u),n(()=>!e(u).spellRef)&&oe(We)})}var W=a(ee,2),Ge=i(W);{var Ke=oe=>{const pe=bt(()=>(e(u),n(()=>h(e(u).spellRef))));var Ze=ft(),nt=Ae(Ze);{var ge=Ue=>{var ce=ft(),pt=Ae(ce);{var at=Ce=>{var F=Ci();$("click",F,()=>xe(e(u))),c(Ce,F)},C=Ce=>{var F=ft(),Fe=Ae(F);{var X=me=>{var it=ft(),Ye=Ae(it);{var Tt=Bt=>{var xt=Di(),Jt=i(xt),$t=i(Jt),Ht=i($t);Se(Ht),Ht.value=Ht.__value="self",Gt(),s($t);var Et=a($t,2),Ut=i(Et);Se(Ut),Ut.value=Ut.__value="other",Gt(),s(Et),s(Jt);var St=a(Jt,2),Dt=i(St);s(St),s(xt),j(()=>{Qe(Ht,"name",`target-${e(u),n(()=>e(u).id)??""}`),Qe(Ut,"name",`target-${e(u),n(()=>e(u).id)??""}`),D(Dt,`Cast ${H(e(pe)),n(()=>e(pe).name)??""}`)}),vs(M,[Ie],Ht,()=>e(Q)[e(u).id],Pt=>da(Q,e(Q)[e(u).id]=Pt)),vs(M,[Ie],Ut,()=>e(Q)[e(u).id],Pt=>da(Q,e(Q)[e(u).id]=Pt)),$("click",St,()=>Pe(e(u),e(Q)[e(u).id])),c(Bt,xt)},Vt=Bt=>{var xt=Li();$("click",xt,()=>Pe(e(u),"self")),c(Bt,xt)};b(Ye,Bt=>{H(e(pe)),n(()=>ye(e(pe).name))?Bt(Tt):Bt(Vt,!1)})}c(me,it)},lt=me=>{var it=ft(),Ye=Ae(it);{var Tt=Bt=>{var xt=ji(),Jt=i(xt);{var $t=Et=>{var Ut=qt("Roll Healing");c(Et,Ut)},Ht=Et=>{var Ut=qt("Roll Damage");c(Et,Ut)};b(Jt,Et=>{H(e(pe)),n(()=>P(e(pe)))?Et($t):Et(Ht,!1)})}s(xt),j(Et=>jt(xt,1,`btn ${Et??""}`),[()=>(H(e(pe)),n(()=>P(e(pe))?"btn-success":"btn-secondary"))]),$("click",xt,()=>Ee(e(u))),c(Bt,xt)},Vt=Bt=>{var xt=Ai();$("click",xt,()=>Pe(e(u),"self")),c(Bt,xt)};b(Ye,Bt=>{e(u),n(()=>e(u).damage&&e(u).damage.trim()!=="")?Bt(Tt):Bt(Vt,!1)})}c(me,it)};b(Fe,me=>{H(bs),H(e(pe)),n(()=>bs(e(pe)))?me(X):me(lt,!1)},!0)}c(Ce,F)};b(pt,Ce=>{H(Ya),H(e(pe)),n(()=>Ya(e(pe)))?Ce(at):Ce(C,!1)})}c(Ue,ce)};b(nt,Ue=>{e(pe)&&Ue(ge)})}c(oe,Ze)},tt=oe=>{var pe=ft(),Ze=Ae(pe);{var nt=ge=>{var Ue=Ri(),ce=Ae(Ue),pt=a(ce,2);{var at=C=>{var Ce=Bi();$("click",Ce,()=>Ee(e(u))),c(C,Ce)};b(pt,C=>{e(u),n(()=>e(u).damage&&e(u).damage.trim()!=="")&&C(at)})}$("click",ce,()=>xe(e(u))),c(ge,Ue)};b(Ze,ge=>{e(u),n(()=>!e(u).spellRef)&&ge(nt)},!0)}c(oe,pe)};b(Ge,oe=>{e(u),e(R),n(()=>e(u).spellRef&&e(R))?oe(Ke):oe(tt,!1)})}s(W),s(Me),j(()=>{Qe(N,"for",`attack-type-${e(u),n(()=>e(u).id)??""}`),Qe(ae,"id",`attack-type-${e(u),n(()=>e(u).id)??""}`)}),Ne(ae,()=>e(u).damageType,oe=>(e(u).damageType=oe,Ft(()=>(e(_),t(),d())))),c(q,Me)});var ie=a(A,2);{var ue=q=>{var u=Fi();c(q,u)},Y=q=>{var u=ft(),Ie=Ae(u);{var Me=re=>{var he=Ti();c(re,he)};b(Ie,re=>{e(_),n(()=>e(_).length===0)&&re(Me)},!0)}c(q,u)};b(ie,q=>{t(),n(()=>t().attacks.length===0)?q(ue):q(Y,!1)})}s(E);var be=a(E,2),z=a(i(be),4),$e=a(z,2);{var Re=q=>{var u=Ii();wt(u,5,()=>(t(),n(()=>t().activeStates)),Ct,(Ie,Me,re)=>{var he=Ei(),je=i(he),qe=i(je);Se(qe);var Ve=a(qe,2);{var Je=tt=>{var oe=Pi();$("click",oe,()=>Oe(re)),c(tt,oe)};b(Ve,tt=>{m()&&tt(Je)})}s(je);var fe=a(je,2),we=i(fe),Z=i(we);Qe(Z,"for",`state-attack-bonus-${re}`);var He=a(Z,2);Se(He),Qe(He,"id",`state-attack-bonus-${re}`),s(we);var _e=a(we,2),x=i(_e);Qe(x,"for",`state-damage-bonus-${re}`);var N=a(x,2);Se(N),Qe(N,"id",`state-damage-bonus-${re}`),s(_e);var ae=a(_e,2),se=i(ae);Qe(se,"for",`state-target-${re}`);var I=a(se,2);j(()=>{e(Me),Ft(()=>{})}),Qe(I,"id",`state-target-${re}`);var ee=i(I);ee.value=ee.__value="self";var We=a(ee);We.value=We.__value="other",s(I),s(ae),s(fe);var W=a(fe,2),Ge=i(W);Qe(Ge,"for",`state-desc-${re}`);var Ke=a(Ge,2);Se(Ke),Qe(Ke,"id",`state-desc-${re}`),s(W),s(he),Ne(qe,()=>e(Me).name,tt=>(e(Me).name=tt,Ft(()=>t()),$a(w,"$character"))),Ne(He,()=>e(Me).attackBonus,tt=>(e(Me).attackBonus=tt,Ft(()=>t()),$a(w,"$character"))),Ne(N,()=>e(Me).damageBonus,tt=>(e(Me).damageBonus=tt,Ft(()=>t()),$a(w,"$character"))),Aa(I,()=>e(Me).target,tt=>(e(Me).target=tt,Ft(()=>t()),$a(w,"$character"))),Ne(Ke,()=>e(Me).description,tt=>(e(Me).description=tt,Ft(()=>t()),$a(w,"$character"))),c(Ie,he)}),s(u),c(q,u)},T=q=>{var u=Hi();c(q,u)};b($e,q=>{t(),n(()=>t().activeStates&&t().activeStates.length>0)?q(Re):q(T,!1)})}s(be),$("click",z,J),c(y,U)};b(gt,y=>{p(),n(()=>!p().attacks)&&y(ut)})}s(Be);var ot=a(Be,2);Vl(ot,{get show(){return e(le)},get attacks(){return t(),n(()=>t().attacks)},onSave:ne,onCancel:Xe}),j(()=>dt=jt(Be,1,"attacks svelte-14o91c5",null,dt,{hidden:!e(K)})),c(l,De),Kt(),k()}var Gi=f('<span class="slot-checkbox-x svelte-serp1j">&#8212;</span>'),qi=f('<label><input type="checkbox" class="slot-checkbox-input svelte-serp1j"/> <span><!></span></label>');function hs(l,o){zt(o,!1);const t=()=>vt(pa,"$isEditMode",v),[v,d]=ra();let p=yt(o,"checked",8,!1),m=yt(o,"disabled",8,!1),w=yt(o,"className",8,""),k=yt(o,"index",8,void 0),_=yt(o,"ariaLabel",8,void 0);const K=ma();function M(P){K("change",{checked:P.currentTarget.checked,index:k()})}Wt();var te=qi(),V=i(te);Se(V);var Q=a(V,2),le=i(Q);{var O=P=>{var ye=Gi();c(P,ye)};b(le,P=>{p()&&P(O)})}s(Q),s(te),j(()=>{jt(te,1,"slot-checkbox-label "+w()+(t()?"":" not-editable"),"svelte-serp1j"),$s(V,p()),V.disabled=m()||!t(),Qe(V,"aria-label",_()),Qe(V,"tabindex",t()?0:-1),jt(Q,1,`slot-checkbox-custom ${p()?"used":""} ${t()?"":"readonly"}`,"svelte-serp1j")}),$("change",V,M),c(l,te),Kt(),d()}var Wi=f('<p class="no-features svelte-1kpvv0n">Select a class to see available features</p>'),zi=f('<p class="no-features svelte-1kpvv0n">No class features available at this level</p>'),Ki=f('<div class="spell-slots svelte-1kpvv0n"><label class="svelte-1kpvv0n"> </label> <div class="slots-tracker svelte-1kpvv0n"></div></div>'),Vi=f('<div class="all-spell-slots"></div>'),Ji=f('<div class="feature-box spellcasting svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"> </h3> <div class="spell-stats svelte-1kpvv0n"><div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Spell Save DC</label> <div class="spell-value svelte-1kpvv0n"> </div></div> <div class="spell-stat svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <div class="spell-value svelte-1kpvv0n"> </div></div></div> <!> <div class="prepared-spells svelte-1kpvv0n"><label class="svelte-1kpvv0n">Prepared Spells</label> <textarea placeholder="List your prepared spells..." class="svelte-1kpvv0n"></textarea></div></div>'),Yi=f('<p class="unlimited svelte-1kpvv0n">Unlimited Uses</p>'),Qi=f('<div class="slots-tracker svelte-1kpvv0n"></div> <div class="uses-actions-row"><button class="btn btn-primary use-enabled"> </button></div> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div>',1),Xi=f('<div class="uses-tracker svelte-1kpvv0n"><!></div>'),Zi=f('<div class="pool-tracker svelte-1kpvv0n"><input type="number" min="0" class="pool-input svelte-1kpvv0n"/> <span> </span> <button class="btn-small svelte-1kpvv0n"> </button></div>'),en=f('<p class="no-uses svelte-1kpvv0n">No Channel Divinity uses remaining</p>'),tn=f('<div class="channel-divinity-option svelte-1kpvv0n"><button class="btn btn-primary use-enabled svelte-1kpvv0n">Use Channel Divinity</button> <div class="uses-info svelte-1kpvv0n"><span class="reset-info svelte-1kpvv0n"> </span></div> <!></div>'),an=f('<div class="feature-box svelte-1kpvv0n"><h3 class="svelte-1kpvv0n"><!> </h3> <p class="feature-description svelte-1kpvv0n"> </p> <!></div>'),sn=f('<div class="features-grid svelte-1kpvv0n"><!> <!></div>'),ln=f("<section><!> <!></section>");function nn(l,o){zt(o,!1);const t=()=>vt(ve,"$character",m),v=()=>vt(Ba,"$abilityModifiers",m),d=()=>vt(fa,"$searchFilter",m),p=()=>vt(ea,"$collapsedStates",m),[m,w]=ra(),k=S(),_=S(),K=S(),M=S(),te=S(),V=S(),Q=S();let le=S(0),O=S(0);function P(g,B){ve.update(J=>(J.classFeatures.features[g]=B,J))}function ye(){ve.update(g=>(g.classFeatures.spellSlotsByLevel||(g.classFeatures.spellSlotsByLevel={}),e(M).forEach(({level:B,slots:J})=>{g.classFeatures.spellSlotsByLevel[B]||(g.classFeatures.spellSlotsByLevel[B]=Array(J).fill(!1))}),g))}function ze(g){if(typeof g.maxUses=="function"){if((g.name==="Divine Sense"||g.name==="War Priest")&&e(k)?.spellcastingAbility){const B=v()[e(k).spellcastingAbility];return g.maxUses(t().level,B)}return g.maxUses(t().level)}return g.maxUses||0}function de(g,B){ve.update(J=>((!J.classFeatures.features[g]||!Array.isArray(J.classFeatures.features[g])||J.classFeatures.features[g].length!==B)&&(J.classFeatures.features[g]=Array(B).fill(!1)),J))}Ms(()=>{e(V)&&t()&&t().classFeatures&&t().classFeatures.features&&e(V).forEach(g=>{if(g.type==="uses"){const B=g.name.replace(/\s+/g,""),J=ze(g),Oe=t().classFeatures.features[B];(!Array.isArray(Oe)||Oe.length!==J)&&de(B,J)}})});function Te(g){return typeof g.maxPool=="function"?g.maxPool(t().level):g.maxPool||0}function Xe(g){return typeof g.description=="function"?g.description(t().level):g.description}function ne(){const g="ChannelDivinity";ve.update(B=>{const J=B.classFeatures.features[g];return typeof J=="number"&&J>0&&(B.classFeatures.features[g]=J-1),B})}function xe(){ea.update(g=>({...g,classFeatures:!g.classFeatures}))}et(()=>(t(),ta),()=>{r(k,t().class?ta(t().class):null)}),et(()=>(t(),xa),()=>{r(_,t().class?xa(t().class,t().level,t().subclass):[])}),et(()=>(t(),ps),()=>{r(K,t().class?ps(t().class,t().level):0)}),et(()=>(e(k),t()),()=>{r(M,(()=>{if(!e(k)?.spellcaster)return[];const g=t().level,B=[];return g>=1&&B.push({level:1,slots:Math.min(4,2+Math.floor(g/3))}),g>=3&&B.push({level:2,slots:Math.min(3,2+Math.floor((g-3)/4))}),g>=5&&B.push({level:3,slots:Math.min(3,2+Math.floor((g-5)/5))}),g>=7&&B.push({level:4,slots:Math.min(3,1+Math.floor((g-7)/6))}),g>=9&&B.push({level:5,slots:Math.min(2,1+Math.floor((g-9)/8))}),g>=11&&B.push({level:6,slots:1}),g>=13&&B.push({level:7,slots:1}),g>=15&&B.push({level:8,slots:1}),g>=17&&B.push({level:9,slots:1}),B})())}),et(()=>(e(k),v(),t(),fs),()=>{if(e(k)?.spellcaster&&e(k).spellcastingAbility){const g=v()[e(k).spellcastingAbility];r(le,ul(t().class,g,t().proficiencyBonus)||0),r(O,fs(t().class,t().level,g))}}),et(()=>(t(),e(k),e(M)),()=>{t().class&&e(k)?.spellcaster&&e(M).length>0&&ye()}),et(()=>t(),()=>{r(te,(()=>{const B=t().classFeatures.features["ChannelDivinity"];return typeof B=="number"?B:0})())}),et(()=>(e(_),d()),()=>{r(V,e(_).filter(g=>{if(!d())return!0;const B=d().toLowerCase();return g.name.toLowerCase().includes(B)||Xe(g).toLowerCase().includes(B)}))}),et(()=>(d(),t(),e(V)),()=>{r(Q,!d()||t().class||"class features".includes(d().toLowerCase())||"spellcasting".includes(d().toLowerCase())||e(V).length>0)}),ca(),Wt();var Ee=ln();let L;var R=i(Ee);{let g=bt(()=>(p(),n(()=>p().classFeatures?"Expand":"Collapse")));ba(R,{title:"Class Features",get collapsed(){return p(),n(()=>p().classFeatures)},get ariaLabel(){return e(g)},onToggle:xe})}var h=a(R,2);{var G=g=>{var B=ft(),J=Ae(B);{var Oe=De=>{var Be=Wi();c(De,Be)},Pe=De=>{var Be=ft(),dt=Ae(Be);{var st=ut=>{var ot=zi();c(ut,ot)},gt=ut=>{var ot=sn(),y=i(ot);{var U=Le=>{var E=Ji(),A=i(E),ie=i(A);s(A);var ue=a(A,2),Y=i(ue),be=a(i(Y),2),z=i(be,!0);s(be),s(Y);var $e=a(Y,2),Re=a(i($e),2),T=i(Re,!0);s(Re),s($e),s(ue);var q=a(ue,2);{var u=re=>{var he=Vi();wt(he,5,()=>e(M),Ct,(je,qe)=>{let Ve=()=>e(qe).level,Je=()=>e(qe).slots;const fe=bt(()=>(t(),Ve(),Je(),n(()=>t().classFeatures.spellSlotsByLevel?.[Ve()]||Array(Je()).fill(!1))));var we=Ki(),Z=i(we),He=i(Z);s(Z);var _e=a(Z,2);wt(_e,5,()=>e(fe),Ct,(x,N,ae)=>{{let se=bt(()=>(H(e(fe)),n(()=>e(fe)[ae]||!1)));hs(x,{get checked(){return e(se)},$$events:{change:I=>{ve.update(ee=>(ee.classFeatures.spellSlotsByLevel||(ee.classFeatures.spellSlotsByLevel={}),ee.classFeatures.spellSlotsByLevel[Ve()]||(ee.classFeatures.spellSlotsByLevel[Ve()]=Array(Je()).fill(!1)),ee.classFeatures.spellSlotsByLevel[Ve()][ae]=I.detail.checked,ee))}}})}}),s(_e),s(we),j(()=>D(He,`${Ve()===1?"1st":Ve()===2?"2nd":Ve()===3?"3rd":`${Ve()}th`} Level Spell Slots`)),c(je,we)}),s(he),c(re,he)};b(q,re=>{e(M),n(()=>e(M).length>0)&&re(u)})}var Ie=a(q,2),Me=a(i(Ie),2);ga(Me),s(Ie),s(E),j(re=>{D(ie,`Spellcasting (${re??""})`),D(z,e(le)),D(T,e(O))},[()=>(e(k),n(()=>e(k).spellcastingAbility?.toUpperCase()))]),Ne(Me,()=>t().classFeatures.preparedSpells,re=>Lt(ve,n(t).classFeatures.preparedSpells=re,n(t))),c(Le,E)};b(y,Le=>{e(k),n(()=>e(k)?.spellcaster)&&Le(U)})}var ke=a(y,2);wt(ke,1,()=>e(V),Ct,(Le,E)=>{const A=bt(()=>(e(E),n(()=>e(E).name.replace(/\s+/g,"")))),ie=bt(()=>(t(),H(e(A)),n(()=>t().classFeatures.features[e(A)]))),ue=bt(()=>typeof e(ie)=="number");var Y=an(),be=i(Y),z=i(be);{var $e=re=>{var he=qt("Channel Divinity:");c(re,he)};b(z,re=>{e(E),n(()=>e(E).type==="channelDivinity")&&re($e)})}var Re=a(z);s(be);var T=a(be,2),q=i(T,!0);s(T);var u=a(T,2);{var Ie=re=>{const he=bt(()=>(e(E),n(()=>ze(e(E))))),je=bt(()=>(H(e(ie)),H(e(he)),n(()=>Array.isArray(e(ie))?e(ie):Array(e(he)).fill(!1))));var qe=Xi(),Ve=i(qe);{var Je=we=>{var Z=Yi();c(we,Z)},fe=we=>{var Z=Qi(),He=Ae(Z);wt(He,5,()=>e(je),Ct,(ee,We,W)=>{hs(ee,{get checked(){return e(We)},index:W,$$events:{change:Ge=>{ve.update(Ke=>(Ke.classFeatures.features[e(A)]||(Ke.classFeatures.features[e(A)]=Array(e(he)).fill(!1)),Ke.classFeatures.features[e(A)][W]=Ge.detail.checked,Ke))}}})}),s(He);var _e=a(He,2),x=i(_e),N=i(x);s(x),s(_e);var ae=a(_e,2),se=i(ae),I=i(se);s(se),s(ae),j(ee=>{x.disabled=ee,D(N,`Use ${e(E),n(()=>e(E).name)??""}`),D(I,`Resets on ${e(E),n(()=>e(E).resetOn==="short"?"Short Rest":"Long Rest")??""}`)},[()=>(H(e(je)),n(()=>e(je).filter(ee=>!ee).length<=0))]),$("click",x,()=>{ve.update(ee=>{ee.classFeatures.features[e(A)]||(ee.classFeatures.features[e(A)]=Array(e(he)).fill(!1));const We=ee.classFeatures.features[e(A)],W=We.findIndex(Ge=>!Ge);return W!==-1&&(We[W]=!0),ee})}),c(we,Z)};b(Ve,we=>{e(he)===1/0?we(Je):we(fe,!1)})}s(qe),c(re,qe)},Me=re=>{var he=ft(),je=Ae(he);{var qe=Je=>{const fe=bt(()=>(e(E),n(()=>Te(e(E)))));var we=Zi(),Z=i(we);Se(Z);var He=a(Z,2),_e=i(He);s(He);var x=a(He,2),N=i(x,!0);s(x),s(we),j(()=>{La(Z,e(ue)&&e(ie)!==void 0?e(ie):e(fe)),Qe(Z,"max",e(fe)),D(_e,`/ ${e(fe)??""}`),D(N,(e(E),n(()=>e(E).resetOn==="short"?"Short Rest":"Long Rest")))}),$("input",Z,ae=>{ve.update(se=>(se.classFeatures.features[e(A)]=parseInt(ae.currentTarget.value)||0,se))}),$("click",x,()=>P(e(A),e(fe))),c(Je,we)},Ve=Je=>{var fe=ft(),we=Ae(fe);{var Z=He=>{var _e=tn(),x=i(_e),N=a(x,2),ae=i(N),se=i(ae);s(ae),s(N);var I=a(N,2);{var ee=We=>{var W=en();c(We,W)};b(I,We=>{e(te)<=0&&We(ee)})}s(_e),j(()=>{x.disabled=e(te)<=0,D(se,`Resets on ${e(E),n(()=>e(E).resetOn==="short"?"Short Rest":"Long Rest")??""}`)}),$("click",x,ne),c(He,_e)};b(we,He=>{e(E),n(()=>e(E).type==="channelDivinity")&&He(Z)},!0)}c(Je,fe)};b(je,Je=>{e(E),n(()=>e(E).type==="pool")?Je(qe):Je(Ve,!1)},!0)}c(re,he)};b(u,re=>{e(E),n(()=>e(E).type==="uses")?re(Ie):re(Me,!1)})}s(Y),j(re=>{D(Re,` ${e(E),n(()=>e(E).name)??""}`),D(q,re)},[()=>(e(E),n(()=>Xe(e(E))))]),c(Le,Y)}),s(ot),c(ut,ot)};b(dt,ut=>{e(_),n(()=>e(_).length===0)?ut(st):ut(gt,!1)},!0)}c(De,Be)};b(J,De=>{t(),n(()=>!t().class)?De(Oe):De(Pe,!1)})}c(g,B)};b(h,g=>{p(),n(()=>!p().classFeatures)&&g(G)})}s(Ee),j(()=>L=jt(Ee,1,"class-features svelte-1kpvv0n",null,L,{hidden:!e(Q)})),c(l,Ee),Kt(),w()}var rn=f('<textarea placeholder="Enter features, traits, and special abilities..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Equipment</h3> <textarea placeholder="List your equipment and inventory..." class="svelte-wttn0l"></textarea> <h3 class="svelte-wttn0l">Notes</h3> <textarea placeholder="Additional notes..." class="svelte-wttn0l"></textarea>',1),on=f("<section><!> <!></section>");function cn(l,o){zt(o,!1);const t=()=>vt(fa,"$searchFilter",p),v=()=>vt(ve,"$character",p),d=()=>vt(ea,"$collapsedStates",p),[p,m]=ra(),w=S();function k(){ea.update(Q=>({...Q,notes:!Q.notes}))}et(()=>(t(),v()),()=>{r(w,!t()||"features".includes(t().toLowerCase())||"traits".includes(t().toLowerCase())||"equipment".includes(t().toLowerCase())||"notes".includes(t().toLowerCase())||v().features.toLowerCase().includes(t().toLowerCase())||v().equipment.toLowerCase().includes(t().toLowerCase())||v().notes.toLowerCase().includes(t().toLowerCase()))}),ca(),Wt();var _=on();let K;var M=i(_);{let Q=bt(()=>(d(),n(()=>d().notes?"Expand":"Collapse")));ba(M,{title:"Features & Traits",get collapsed(){return d(),n(()=>d().notes)},get ariaLabel(){return e(Q)},onToggle:k})}var te=a(M,2);{var V=Q=>{var le=rn(),O=Ae(le);ga(O);var P=a(O,4);ga(P);var ye=a(P,4);ga(ye),Ne(O,()=>v().features,ze=>Lt(ve,n(v).features=ze,n(v))),Ne(P,()=>v().equipment,ze=>Lt(ve,n(v).equipment=ze,n(v))),Ne(ye,()=>v().notes,ze=>Lt(ve,n(v).notes=ze,n(v))),c(Q,le)};b(te,Q=>{d(),n(()=>!d().notes)&&Q(V)})}s(_),j(()=>K=jt(_,1,"notes svelte-wttn0l",null,K,{hidden:!e(w)})),c(l,_),Kt(),m()}var vn=f('<div class="color-picker-section svelte-1r90jgp"><h3 class="svelte-1r90jgp">Dice Colors</h3> <div class="color-inputs svelte-1r90jgp"><div class="color-input-group svelte-1r90jgp"><label for="dice-color" class="svelte-1r90jgp">Dice Color</label> <input type="color" id="dice-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="label-color" class="svelte-1r90jgp">Label Color</label> <input type="color" id="label-color" class="svelte-1r90jgp"/></div> <div class="color-input-group svelte-1r90jgp"><label for="desk-color" class="svelte-1r90jgp">Background Color</label> <input type="color" id="desk-color" class="svelte-1r90jgp"/></div></div></div>'),dn=f('<div class="loading svelte-1r90jgp"><p class="svelte-1r90jgp">Loading 3D dice...</p></div>'),un=f('<div class="custom-dice-selector svelte-1r90jgp"><h3 class="svelte-1r90jgp">Choose Dice to Roll</h3> <div class="dice-inputs svelte-1r90jgp"><div class="dice-input-group svelte-1r90jgp"><label for="d4" class="svelte-1r90jgp">d4</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d4" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d6" class="svelte-1r90jgp">d6</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d6" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d8" class="svelte-1r90jgp">d8</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d8" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d10" class="svelte-1r90jgp">d10</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d10" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d12" class="svelte-1r90jgp">d12</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d12" min="0" max="10"/></div> <div class="dice-input-group svelte-1r90jgp"><label for="d20" class="svelte-1r90jgp">d20</label> <input class="use-enabled svelte-1r90jgp" type="number" id="d20" min="0" max="10"/></div></div> <div class="dice-controls svelte-1r90jgp"><button class="btn btn-primary use-enabled svelte-1r90jgp"> </button> <button class="btn btn-secondary use-enabled svelte-1r90jgp">Reset</button></div></div>'),pn=f('<span class="crit-badge svelte-1r90jgp">CRITICAL HIT!</span>'),fn=f('<span class="crit-badge crit-fail svelte-1r90jgp">CRITICAL MISS!</span>'),gn=f('<div class="bonus-item svelte-1r90jgp"><span class="bonus-value svelte-1r90jgp"> </span> <span class="bonus-source svelte-1r90jgp"> </span></div>'),mn=f('<div class="bonus-breakdown svelte-1r90jgp"></div>'),bn=f('<p class="modifier-text svelte-1r90jgp"> </p>'),hn=f('<div class="svelte-1r90jgp"><em class="svelte-1r90jgp">No damage is dealt on a critical miss.</em></div>'),_n=f('<button class="btn btn-follow-up svelte-1r90jgp"> </button>'),yn=f('<button class="btn btn-guided-strike svelte-1r90jgp">‚ö° Use Guided Strike (+10)</button>'),xn=f('<div class="follow-up-actions svelte-1r90jgp"><!> <!></div>'),kn=f('<div class="result-header svelte-1r90jgp"><h3 class="svelte-1r90jgp"> </h3> <!> <!></div> <div class="result-total svelte-1r90jgp"> </div> <div class="result-details svelte-1r90jgp"><!></div> <!> <!>',1),wn=f('<div role="button" tabindex="-1"><div class="modal-content svelte-1r90jgp" role="dialog" tabindex="0"><div class="modal-header svelte-1r90jgp"><h2 class="svelte-1r90jgp">Dice Roller</h2> <div class="header-buttons svelte-1r90jgp"><button class="color-btn svelte-1r90jgp" title="Customize dice colors">üé®</button> <button class="close-btn svelte-1r90jgp">√ó</button></div></div> <!> <!> <div class="dice-main-area svelte-1r90jgp"><div class="dice-container svelte-1r90jgp"></div> <!></div> <div><!></div></div></div>');function Sn(l,o){zt(o,!1);const t=()=>vt(ve,"$character",v),[v,d]=ra(),p=S(),m=S(),w=S(),k=ma();let _=yt(o,"notation",12,""),K=yt(o,"visible",8,!1),M=yt(o,"damageNotation",12,""),te=yt(o,"attackName",12,""),V=yt(o,"applyHalfDamage",8,!1),Q=yt(o,"bonusBreakdown",28,()=>[]),le=yt(o,"rollType",12,"other"),O=null,P=S(void 0),ye=S(!1),ze=S(""),de=S(null);function Te(){return e(de)?.resultTotal??null}function Xe(x,N,ae){const se=[];if(!x||!x.result)return se;const I=N.match(/([+-]?\d*d\d+|[+-]?\d+)/g)||[];let ee=0;const We=new Set;for(const W of I){const Ge=W.trim();if(!Ge)continue;const Ke=Ge.match(/([+-]?)(\d*)d(\d+)/);if(Ke){const tt=parseInt(Ke[2]||"1"),oe=`${tt}d${Ke[3]}`,pe=ae.findIndex((ge,Ue)=>!We.has(Ue)&&typeof ge.value=="string"&&ge.value===oe),Ze=[];for(let ge=0;ge<tt&&ee<x.result.length;ge++)Ze.push(x.result[ee++]);const nt=pe>=0?ae[pe].source:"base die";pe>=0&&We.add(pe);for(const ge of Ze)se.push({display:`${ge}`,source:nt})}}for(let W=0;W<ae.length;W++)if(!We.has(W)&&typeof ae[W].value=="number"){const Ge=ae[W].value;se.push({display:Ge>=0?`+${Ge}`:`${Ge}`,source:ae[W].source})}return se}let ne=S(0),xe=S(0),Ee=S(0),L=S(0),R=S(0),h=S(0),G=S(0),g=S([]),B=S(!1),J=S(!1),Oe=S(!1),Pe=S("#051e0a"),De=S("#ffffff"),Be=S("#3a2004"),dt=S(!1);function st(x){return x.length===9&&x.startsWith("#")?x.substring(0,7):x}function gt(x,N="ff"){return x.length===7&&x.startsWith("#")?x+N:x}function ut(){if(window.DICE&&e(P))try{O&&e(P)&&da(P,e(P).innerHTML="");const x=e(P).clientWidth||500,N=e(P).clientHeight||300;O=new window.DICE.dice_box(e(P),{w:x,h:N}),r(ye,!0)}catch(x){console.error("Error initializing dice box:",x)}}ka(()=>{const x=se=>new Promise((I,ee)=>{if(document.querySelector(`script[src="${se}"]`)){I(null);return}const W=document.createElement("script");W.src=se,W.onload=()=>{I(null)},W.onerror=()=>{console.error(`Failed to load: ${se}`),ee(new Error(`Failed to load ${se}`))},document.head.appendChild(W)});setTimeout(()=>{x(`${Ca}/libs/three.min.js`).then(()=>x(`${Ca}/libs/cannon.min.js`)).then(()=>x(`${Ca}/libs/teal.js`)).then(()=>x(`${Ca}/dice.js`)).then(()=>{if(window.DICE){const se=window.DICE.getColors();r(Pe,st(se.dice_color)),r(De,st(se.label_color)),r(Be,st(se.desk_color))}ut()}).catch(se=>{console.error("Failed to load dice libraries:",se)})},100);const N=()=>{e(ye)&&ut()},ae=se=>{K()&&se.key==="Escape"&&ue()};return window.addEventListener("resize",N),window.addEventListener("keydown",ae),()=>{window.removeEventListener("resize",N),window.removeEventListener("keydown",ae)}});function ot(x,N="other"){if(!O||!e(ye))return;r(de,null),r(g,[]),r(B,!1),r(J,!1),N==="damage"&&Q([]),le(N),r(Oe,!1),O.diceToRoll=x;const ae=I=>null,se=I=>{let ee=I.resultTotal,We=I.resultString;if(V()&&(ee=Math.floor(ee/2),We=We+" (halved)"),r(de,{...I,resultTotal:ee,resultString:We}),console.log("Final roll result:",e(de)),console.log({type:N}),N==="attack"&&I.result&&I.result.length>0){const W=I.result[0];r(B,W===20),r(J,W===1)}if(r(g,[]),console.log("Setting up follow-up actions. Type:",N,"damageNotation:",M(),"isCriticalSuccess:",e(B),"isCriticalFail:",e(J)),N==="attack"&&M())if(e(B)){const W=ke(M());e(g).push({label:`Roll Critical Damage (${W})`,notation:W})}else e(J)||e(g).push({label:`Roll Damage (${M()})`,notation:M()})};O.start_throw(ae,se)}function y(){const x=[];e(ne)>0&&x.push(`${e(ne)}d4`),e(xe)>0&&x.push(`${e(xe)}d6`),e(Ee)>0&&x.push(`${e(Ee)}d8`),e(L)>0&&x.push(`${e(L)}d10`),e(R)>0&&x.push(`${e(R)}d12`),e(h)>0&&x.push(`${e(h)}d20`);let N=x.join("+")||"1d20";return e(G)!==0&&(N+=e(G)>=0?`+${e(G)}`:`${e(G)}`),N}function U(){const x=y();ot(x)}function ke(x){return x.replace(/(\d+)d(\d+)/g,(N,ae,se)=>`${parseInt(ae)*2}d${se}`)}function Le(){r(ne,0),r(xe,0),r(Ee,0),r(L,0),r(R,0),r(h,0),r(G,0),r(de,null),r(g,[]),r(B,!1),r(J,!1),le("other"),r(Oe,!1)}function E(){window.DICE&&(window.DICE.setColors({dice_color:gt(e(Pe),"ff"),label_color:gt(e(De),"ff"),desk_color:e(Be)}),O&&(O.updateDeskColor(e(Be)),O.updateDiceColors()))}function A(){r(dt,!e(dt))}function ie(){!e(de)||e(m)<=0||e(Oe)||(r(de,{...e(de),resultTotal:e(de).resultTotal+10,resultString:e(de).resultString+" + 10 (Guided Strike)"}),ve.update(x=>{const N="ChannelDivinity",ae=x.classFeatures.features[N];return typeof ae=="number"&&ae>0&&(x.classFeatures.features[N]=ae-1),x}),r(Oe,!0))}function ue(){k("close"),_(""),M(""),te(""),r(ze,""),r(de,null),r(Oe,!1),r(B,!1),r(J,!1),Le()}et(()=>(t(),xa),()=>{r(p,t().class?xa(t().class,t().level,t().subclass).some(N=>N.name==="Guided Strike"):!1)}),et(()=>t(),()=>{r(m,(()=>{const N=t().classFeatures.features["ChannelDivinity"];return typeof N=="number"?N:0})())}),et(()=>(e(ne),e(xe),e(Ee),e(L),e(R),e(h),e(G)),()=>{r(w,(()=>{const x=[];e(ne)>0&&x.push(`${e(ne)}d4`),e(xe)>0&&x.push(`${e(xe)}d6`),e(Ee)>0&&x.push(`${e(Ee)}d8`),e(L)>0&&x.push(`${e(L)}d10`),e(R)>0&&x.push(`${e(R)}d12`),e(h)>0&&x.push(`${e(h)}d20`);let N=x.join("+")||"1d20";return e(G)!==0&&(N+=e(G)>=0?`+${e(G)}`:`${e(G)}`),N})())}),et(()=>(H(_()),e(ye),H(K()),e(ze),H(M()),H(te()),H(le())),()=>{_()&&e(ye)&&K()&&_()!==e(ze)&&(r(ze,_()),r(de,null),r(g,[]),r(B,!1),r(J,!1),r(Oe,!1),console.log("Auto-roll triggered. notation:",_(),"damageNotation:",M(),"attackName:",te(),"rollType:",le()),setTimeout(()=>ot(_(),le()),200))}),ca();var Y={getLastRollTotal:Te};Wt();var be=wn();let z;var $e=i(be),Re=i($e),T=a(i(Re),2),q=i(T),u=a(q,2);s(T),s(Re);var Ie=a(Re,2);{var Me=x=>{var N=vn(),ae=a(i(N),2),se=i(ae),I=a(i(se),2);Se(I),s(se);var ee=a(se,2),We=a(i(ee),2);Se(We),s(ee);var W=a(ee,2),Ge=a(i(W),2);Se(Ge),s(W),s(ae),s(N),Ne(I,()=>e(Pe),Ke=>r(Pe,Ke)),$("change",I,E),Ne(We,()=>e(De),Ke=>r(De,Ke)),$("change",We,E),Ne(Ge,()=>e(Be),Ke=>r(Be,Ke)),$("change",Ge,E),c(x,N)};b(Ie,x=>{e(dt)&&x(Me)})}var re=a(Ie,2);{var he=x=>{var N=dn();c(x,N)};b(re,x=>{e(ye)||x(he)})}var je=a(re,2),qe=i(je);ja(qe,x=>r(P,x),()=>e(P));var Ve=a(qe,2);{var Je=x=>{var N=un(),ae=a(i(N),2),se=i(ae),I=a(i(se),2);Se(I),s(se);var ee=a(se,2),We=a(i(ee),2);Se(We),s(ee);var W=a(ee,2),Ge=a(i(W),2);Se(Ge),s(W);var Ke=a(W,2),tt=a(i(Ke),2);Se(tt),s(Ke);var oe=a(Ke,2),pe=a(i(oe),2);Se(pe),s(oe);var Ze=a(oe,2),nt=a(i(Ze),2);Se(nt),s(Ze),s(ae);var ge=a(ae,2),Ue=i(ge),ce=i(Ue);s(Ue);var pt=a(Ue,2);s(ge),s(N),j(()=>{Ue.disabled=!e(ye),D(ce,`Roll ${e(w)??""}`)}),Ne(I,()=>e(ne),at=>r(ne,at)),Ne(We,()=>e(xe),at=>r(xe,at)),Ne(Ge,()=>e(Ee),at=>r(Ee,at)),Ne(tt,()=>e(L),at=>r(L,at)),Ne(pe,()=>e(R),at=>r(R,at)),Ne(nt,()=>e(h),at=>r(h,at)),$("click",Ue,U),$("click",pt,Le),c(x,N)};b(Ve,x=>{_()||x(Je)})}s(je);var fe=a(je,2);let we;var Z=i(fe);{var He=x=>{var N=kn(),ae=Ae(N),se=i(ae),I=i(se,!0);s(se);var ee=a(se,2);{var We=pt=>{var at=pn();c(pt,at)};b(ee,pt=>{e(B)&&pt(We)})}var W=a(ee,2);{var Ge=pt=>{var at=fn();c(pt,at)};b(W,pt=>{e(J)&&pt(Ge)})}s(ae);var Ke=a(ae,2),tt=i(Ke,!0);s(Ke);var oe=a(Ke,2),pe=i(oe);{var Ze=pt=>{var at=ft(),C=Ae(at);{var Ce=Fe=>{var X=mn();wt(X,5,()=>(e(de),H(_()),H(Q()),n(()=>Xe(e(de),_(),Q()))),Ct,(lt,me)=>{var it=gn(),Ye=i(it),Tt=i(Ye,!0);s(Ye);var Vt=a(Ye,2),Bt=i(Vt);s(Vt),s(it),j(()=>{D(Tt,(e(me),n(()=>e(me).display))),D(Bt,`(${e(me),n(()=>e(me).source)??""})`)}),c(lt,it)}),s(X),c(Fe,X)},F=Fe=>{var X=ft(),lt=Ae(X);{var me=it=>{var Ye=bn(),Tt=i(Ye);s(Ye),j(()=>D(Tt,`Modifier: ${e(de),n(()=>e(de).constant>=0?"+":"")??""}${e(de),n(()=>e(de).constant)??""}`)),c(it,Ye)};b(lt,it=>{e(de),n(()=>e(de).constant)&&it(me)},!0)}c(Fe,X)};b(C,Fe=>{H(Q()),n(()=>Q().length>0)?Fe(Ce):Fe(F,!1)})}c(pt,at)};b(pe,pt=>{e(de),H(Q()),n(()=>e(de).constant||Q().length>0)&&pt(Ze)})}s(oe);var nt=a(oe,2);{var ge=pt=>{var at=hn();c(pt,at)};b(nt,pt=>{e(J)&&pt(ge)})}var Ue=a(nt,2);{var ce=pt=>{var at=xn(),C=i(at);wt(C,1,()=>e(g),Ct,(Fe,X)=>{var lt=_n(),me=i(lt,!0);s(lt),j(()=>D(me,(e(X),n(()=>e(X).label)))),$("click",lt,()=>ot(e(X).notation,"damage")),c(Fe,lt)});var Ce=a(C,2);{var F=Fe=>{var X=yn();j(()=>{X.disabled=e(m)<=0,Qe(X,"title",e(m)<=0?"No Channel Divinity uses remaining":"Use Channel Divinity to add +10 to this attack roll")}),$("click",X,ie),c(Fe,X)};b(Ce,Fe=>{e(p)&&le()==="attack"&&!e(Oe)&&e(m)>0&&!e(J)&&Fe(F)})}s(at),c(pt,at)};b(Ue,pt=>{e(g),e(p),H(le()),e(Oe),e(m),n(()=>e(g).length>0||e(p)&&le()==="attack"&&!e(Oe)&&e(m)>0)&&pt(ce)})}j(()=>{D(I,te()?`${te()} - Result`:"Result"),D(tt,(e(de),n(()=>e(de).resultTotal)))}),c(x,N)};b(Z,x=>{e(de)&&x(He)})}s(fe),s($e),s(be),j(()=>{z=jt(be,1,"modal-overlay svelte-1r90jgp",null,z,{hidden:!K()}),we=jt(fe,1,"roll-result svelte-1r90jgp",null,we,{"has-result":e(de)})}),$("click",q,A),$("click",u,ue),$("click",$e,ns(function(x){ya.call(this,o,x)})),$("keydown",$e,function(x){ya.call(this,o,x)}),$("click",be,ue),$("keydown",be,x=>x.key==="Escape"&&ue()),c(l,be),vl(o,"getLastRollTotal",Te);var _e=Kt(Y);return d(),_e}const Oa="https://api.github.com/gists";async function $n(l,o,t){if(!o)throw new Error("GitHub token is required");const v=JSON.stringify(l,null,2),d=`${l.name||"character"}_dnd.json`,p={description:t||`D&D Character: ${l.name}`,public:!1,files:{[d]:{content:v}}},m=await fetch(Oa,{method:"POST",headers:{Authorization:`token ${o}`,"Content-Type":"application/json"},body:JSON.stringify(p)});if(!m.ok)throw new Error(`Failed to create gist: ${m.statusText}`);return(await m.json()).id}async function Cn(l,o,t){if(!o||!t)throw new Error("GitHub token and Gist ID are required");const v=JSON.stringify(l,null,2),p={files:{[`${l.name||"character"}_dnd.json`]:{content:v}}},m=await fetch(`${Oa}/${t}`,{method:"PATCH",headers:{Authorization:`token ${o}`,"Content-Type":"application/json"},body:JSON.stringify(p)});if(!m.ok)throw new Error(`Failed to update gist: ${m.statusText}`)}async function Dn(l,o){if(!l)throw new Error("Gist ID is required");const t={"Content-Type":"application/json"};o&&(t.Authorization=`token ${o}`);const v=await fetch(`${Oa}/${l}`,{method:"GET",headers:t});if(!v.ok)throw new Error(`Failed to load gist: ${v.statusText}`);const d=await v.json(),p=Object.values(d.files);if(p.length===0)throw new Error("No files found in gist");const w=p[0].content;try{const k=JSON.parse(w);return k.attacks&&Array.isArray(k.attacks)&&(k.attacks=k.attacks.map(_=>({..._,id:_.id||crypto.randomUUID()}))),k.classFeatures?(k.classFeatures.features||(k.classFeatures.features={}),k.classFeatures.spellSlots||(k.classFeatures.spellSlots=[]),k.classFeatures.preparedSpells===void 0&&(k.classFeatures.preparedSpells="")):k.classFeatures={features:{},spellSlots:[],preparedSpells:""},k}catch{throw new Error("Invalid character data in gist")}}function _s(l){typeof window<"u"&&localStorage.setItem("dnd_gist_config",JSON.stringify(l))}function Ln(){if(typeof window<"u"){const l=localStorage.getItem("dnd_gist_config");if(l)return JSON.parse(l)}return{}}async function jn(l,o=30){if(!l)throw new Error("GitHub token is required to list gists");const t=await fetch(`${Oa}?per_page=${o}`,{method:"GET",headers:{Authorization:`token ${l}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error(`Failed to list gists: ${t.statusText}`);return await t.json()}var An=f('<div class="error-message svelte-1jb5ckg"> </div>'),Bn=f('<div class="toggle-container svelte-1jb5ckg"><button type="button" class="toggle-btn svelte-1jb5ckg"> </button></div>'),Rn=f('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID (leave empty to create new)</label> <input type="text" id="gistId" placeholder="Optional: existing Gist ID to update" class="svelte-1jb5ckg"/></div>'),Mn=f('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),Fn=f('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),Tn=f('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Update (or leave unselected to create new)</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),Pn=f('<div class="info-message svelte-1jb5ckg">No gists found. A new one will be created.</div>'),En=f('<!> <div class="form-group svelte-1jb5ckg"><label for="description" class="svelte-1jb5ckg"> </label> <input type="text" id="description" placeholder="D&amp;D Character Sheet" class="svelte-1jb5ckg"/></div>',1),In=f('<div class="form-group svelte-1jb5ckg"><label for="gistId" class="svelte-1jb5ckg">Gist ID *</label> <input type="text" id="gistId" placeholder="Enter Gist ID (for public or your private gists)" required class="svelte-1jb5ckg"/></div>'),Hn=f('<div class="loading-message svelte-1jb5ckg">Loading your gists...</div>'),Un=f('<button type="button"><div class="gist-item-header svelte-1jb5ckg"><span class="gist-description svelte-1jb5ckg"> </span> <span class="gist-visibility svelte-1jb5ckg"> </span></div> <div class="gist-item-meta svelte-1jb5ckg"><span class="gist-id svelte-1jb5ckg"> </span> <span class="gist-date svelte-1jb5ckg"> </span></div></button>'),Nn=f('<div class="form-group svelte-1jb5ckg"><div class="gist-list-label svelte-1jb5ckg">Select a Gist to Load</div> <div class="gist-list svelte-1jb5ckg"></div></div>'),On=f('<div class="info-message svelte-1jb5ckg">No gists found. Enter a Gist ID manually or create a new one in Save mode.</div>'),Gn=f('<div class="modal-overlay svelte-1jb5ckg" role="button" tabindex="-1"><div class="modal-content svelte-1jb5ckg" role="dialog" tabindex="0"><div class="modal-header svelte-1jb5ckg"><h2 class="svelte-1jb5ckg"> </h2> <button class="close-btn svelte-1jb5ckg">√ó</button></div> <div class="modal-body svelte-1jb5ckg"><!> <div class="form-group svelte-1jb5ckg"><label for="token" class="svelte-1jb5ckg"> <a href="https://github.com/settings/tokens" target="_blank" rel="noopener" class="svelte-1jb5ckg">Get token</a></label> <input type="password" id="token" placeholder="ghp_xxxxxxxxxxxxx" class="svelte-1jb5ckg"/></div> <!> <!> <div class="modal-actions svelte-1jb5ckg"><button class="btn btn-primary svelte-1jb5ckg"><!></button> <button class="btn btn-secondary svelte-1jb5ckg">Cancel</button></div></div></div></div>');function qn(l,o){zt(o,!1);const t=()=>vt(ve,"$character",v),[v,d]=ra(),p=ma();let m=yt(o,"mode",8,"save"),w=S(""),k=S(""),_=S(""),K=S(!1),M=S(""),te=S(!1),V=S(!1),Q=S([]),le=S(null);const O=Ln();O.token&&r(w,O.token),O.gistId&&r(k,O.gistId),ka(async()=>{e(w)&&!e(te)&&await P()});async function P(){if(e(w)){r(V,!0),r(M,"");try{r(Q,await jn(e(w))),e(k)&&r(le,e(Q).find(A=>A.id===e(k))||null)}catch(A){r(M,A.message||"Failed to load gists"),r(Q,[])}finally{r(V,!1)}}}function ye(A){r(le,A),r(k,A.id)}function ze(){r(te,!e(te)),r(M,""),!e(te)&&e(w)&&P()}async function de(){if(!e(w)){r(M,"GitHub token is required");return}const A=e(le)?.id||e(k);r(K,!0),r(M,"");try{if(A)await Cn(t(),e(w),A),r(k,A),Zt.add("Character updated in Gist successfully!","success");else{const ie=await $n(t(),e(w),e(_));r(k,ie),Zt.add(`Character saved to Gist! ID: ${ie}`,"success")}_s({token:e(w),gistId:e(k)}),p("close")}catch(ie){r(M,ie.message||"Failed to save to Gist")}finally{r(K,!1)}}async function Te(){const A=e(le)?.id||e(k);if(!A){r(M,"Please select a gist or enter a Gist ID");return}r(K,!0),r(M,"");try{const ie=await Dn(A,e(w)||void 0);ve.set(ie),r(k,A),_s({token:e(w),gistId:e(k)}),Zt.add("Character loaded from Gist successfully!","success"),p("close")}catch(ie){r(M,ie.message||"Failed to load from Gist")}finally{r(K,!1)}}function Xe(){p("close")}Wt();var ne=Gn(),xe=i(ne),Ee=i(xe),L=i(Ee),R=i(L,!0);s(L);var h=a(L,2);s(Ee);var G=a(Ee,2),g=i(G);{var B=A=>{var ie=An(),ue=i(ie,!0);s(ie),j(()=>D(ue,e(M))),c(A,ie)};b(g,A=>{e(M)&&A(B)})}var J=a(g,2),Oe=i(J),Pe=i(Oe);Gt(),s(Oe);var De=a(Oe,2);Se(De),s(J);var Be=a(J,2);{var dt=A=>{var ie=Bn(),ue=i(ie),Y=i(ue,!0);s(ue),s(ie),j(()=>{ue.disabled=e(K),D(Y,e(te)?"üìã Show My Gists":"‚úèÔ∏è Enter Gist ID Manually")}),$("click",ue,ze),c(A,ie)};b(Be,A=>{(m()==="load"||m()==="save"&&e(w))&&A(dt)})}var st=a(Be,2);{var gt=A=>{var ie=En(),ue=Ae(ie);{var Y=q=>{var u=Rn(),Ie=a(i(u),2);Se(Ie),s(u),j(()=>Ie.disabled=e(K)),Ne(Ie,()=>e(k),Me=>r(k,Me)),c(q,u)},be=q=>{var u=ft(),Ie=Ae(u);{var Me=he=>{var je=Mn();c(he,je)},re=he=>{var je=ft(),qe=Ae(je);{var Ve=fe=>{var we=Tn(),Z=a(i(we),2);wt(Z,5,()=>e(Q),Ct,(He,_e)=>{var x=Fn();let N;var ae=i(x),se=i(ae),I=i(se,!0);s(se);var ee=a(se,2),We=i(ee,!0);s(ee),s(ae);var W=a(ae,2),Ge=i(W),Ke=i(Ge);s(Ge);var tt=a(Ge,2),oe=i(tt);s(tt),s(W),s(x),j(pe=>{N=jt(x,1,"gist-item svelte-1jb5ckg",null,N,{selected:e(le)?.id===e(_e).id}),x.disabled=e(K),D(I,(e(_e),n(()=>e(_e).description||"Untitled"))),D(We,(e(_e),n(()=>e(_e).public?"üåê Public":"üîí Private"))),D(Ke,`ID: ${e(_e),n(()=>e(_e).id)??""}`),D(oe,`Updated: ${pe??""}`)},[()=>(e(_e),n(()=>new Date(e(_e).updated_at).toLocaleDateString()))]),$("click",x,()=>ye(e(_e))),c(He,x)}),s(Z),s(we),c(fe,we)},Je=fe=>{var we=ft(),Z=Ae(we);{var He=_e=>{var x=Pn();c(_e,x)};b(Z,_e=>{e(w)&&_e(He)},!0)}c(fe,we)};b(qe,fe=>{e(Q),n(()=>e(Q).length>0)?fe(Ve):fe(Je,!1)},!0)}c(he,je)};b(Ie,he=>{e(V)?he(Me):he(re,!1)},!0)}c(q,u)};b(ue,q=>{e(te)||!e(w)?q(Y):q(be,!1)})}var z=a(ue,2),$e=i(z),Re=i($e);s($e);var T=a($e,2);Se(T),s(z),j(()=>{D(Re,`Description ${e(k)?"(optional)":""}`),T.disabled=e(K)}),Ne(T,()=>e(_),q=>r(_,q)),c(A,ie)},ut=A=>{var ie=ft(),ue=Ae(ie);{var Y=z=>{var $e=In(),Re=a(i($e),2);Se(Re),s($e),j(()=>Re.disabled=e(K)),Ne(Re,()=>e(k),T=>r(k,T)),c(z,$e)},be=z=>{var $e=ft(),Re=Ae($e);{var T=u=>{var Ie=Hn();c(u,Ie)},q=u=>{var Ie=ft(),Me=Ae(Ie);{var re=je=>{var qe=Nn(),Ve=a(i(qe),2);wt(Ve,5,()=>e(Q),Ct,(Je,fe)=>{var we=Un();let Z;var He=i(we),_e=i(He),x=i(_e,!0);s(_e);var N=a(_e,2),ae=i(N,!0);s(N),s(He);var se=a(He,2),I=i(se),ee=i(I);s(I);var We=a(I,2),W=i(We);s(We),s(se),s(we),j(Ge=>{Z=jt(we,1,"gist-item svelte-1jb5ckg",null,Z,{selected:e(le)?.id===e(fe).id}),we.disabled=e(K),D(x,(e(fe),n(()=>e(fe).description||"Untitled"))),D(ae,(e(fe),n(()=>e(fe).public?"üåê Public":"üîí Private"))),D(ee,`ID: ${e(fe),n(()=>e(fe).id)??""}`),D(W,`Updated: ${Ge??""}`)},[()=>(e(fe),n(()=>new Date(e(fe).updated_at).toLocaleDateString()))]),$("click",we,()=>ye(e(fe))),c(Je,we)}),s(Ve),s(qe),c(je,qe)},he=je=>{var qe=ft(),Ve=Ae(qe);{var Je=fe=>{var we=On();c(fe,we)};b(Ve,fe=>{e(w)&&fe(Je)},!0)}c(je,qe)};b(Me,je=>{e(Q),n(()=>e(Q).length>0)?je(re):je(he,!1)},!0)}c(u,Ie)};b(Re,u=>{e(V)?u(T):u(q,!1)},!0)}c(z,$e)};b(ue,z=>{e(te)||!e(w)?z(Y):z(be,!1)},!0)}c(A,ie)};b(st,A=>{m()==="save"?A(gt):A(ut,!1)})}var ot=a(st,2),y=i(ot),U=i(y);{var ke=A=>{var ie=qt();j(()=>D(ie,m()==="save"?"Saving...":"Loading...")),c(A,ie)},Le=A=>{var ie=qt();j(()=>D(ie,m()==="save"?"Save":"Load")),c(A,ie)};b(U,A=>{e(K)?A(ke):A(Le,!1)})}s(y);var E=a(y,2);s(ot),s(G),s(xe),s(ne),j(()=>{D(R,m()==="save"?"Save to GitHub Gist":"Load from GitHub Gist"),D(Pe,`GitHub Token ${m()==="load"?"(optional for public gists)":"(required)"} `),De.disabled=e(K),y.disabled=e(K),E.disabled=e(K)}),$("click",h,Xe),Ne(De,()=>e(w),A=>r(w,A)),$("blur",De,()=>{e(w)&&!e(te)&&P()}),$("click",y,function(...A){(m()==="save"?de:Te)?.apply(this,A)}),$("click",E,Xe),$("click",xe,ns(function(A){ya.call(this,o,A)})),$("keydown",xe,function(A){ya.call(this,o,A)}),$("click",ne,Xe),$("keydown",ne,A=>A.key==="Escape"&&Xe()),c(l,ne),Kt(),d()}var Wn=f('<div class="loading svelte-1ngjemu">Loading D&D data...</div>'),zn=f("<option> </option>"),Kn=f('<select class="level-filter svelte-1ngjemu"><option>All Levels</option><option>Cantrip</option><!></select>'),Vn=f('<div class="no-results svelte-1ngjemu"> </div>'),Jn=f('<div class="item-meta svelte-1ngjemu"> </div>'),Yn=f('<div class="item-meta svelte-1ngjemu"> </div>'),Qn=f('<button><div class="item-name svelte-1ngjemu"> </div> <!></button>'),Xn=f('<p class="higher-levels"><strong>At Higher Levels:</strong> </p>'),Zn=f('<p class="cantrip-upgrade"><strong>Cantrip Upgrade:</strong> </p>'),er=f('<h3 class="svelte-1ngjemu"> </h3> <p class="spell-meta svelte-1ngjemu"><!> <!></p> <p class="spell-classes"><strong>Classes:</strong> </p> <div class="spell-stats svelte-1ngjemu"><div><strong>Casting Time:</strong> </div> <div><strong>Range:</strong> </div> <div><strong>Components:</strong> <!></div> <div><strong>Duration:</strong> <!> </div></div> <p class="description svelte-1ngjemu"> </p> <!> <!>',1),tr=f('<p class="prerequisite svelte-1ngjemu"><strong>Prerequisite:</strong> </p>'),ar=f('<h3 class="svelte-1ngjemu"> </h3> <!> <p class="description svelte-1ngjemu"> </p> <a target="_blank" rel="noopener" class="source-link svelte-1ngjemu">View Full Details ‚Üí</a>',1),sr=f('<div class="item-details svelte-1ngjemu"><!></div>'),lr=f('<div class="controls svelte-1ngjemu"><div class="tabs svelte-1ngjemu"><button> </button> <button> </button></div> <div class="search-controls svelte-1ngjemu"><input type="text" placeholder="Search by name or description..." class="search-input svelte-1ngjemu"/> <!></div></div> <div class="content-container svelte-1ngjemu"><div class="items-list svelte-1ngjemu"><!></div> <!></div>',1),ir=f('<div class="modal-backdrop svelte-1ngjemu" role="presentation"><div class="modal svelte-1ngjemu" role="dialog" aria-modal="true" tabindex="-1"><div class="modal-header svelte-1ngjemu"><h2 class="svelte-1ngjemu">Browse D&D Spells & Feats</h2> <button class="close-btn svelte-1ngjemu" aria-label="Close">&times;</button></div> <div class="modal-body svelte-1ngjemu"><!></div> <div class="modal-footer svelte-1ngjemu"><button class="btn-secondary svelte-1ngjemu">Cancel</button> <button class="btn-primary svelte-1ngjemu">Add to Character Sheet</button></div></div></div>');function nr(l,o){zt(o,!1);const t=S(),v=S(),d=S();let p=yt(o,"onClose",8),m=S("spell"),w=S(!0),k=S(""),_=S(null),K=S([]),M=S([]),te=S(null);ka(async()=>{r(w,!0);try{r(K,await js()),r(M,await Jl())}catch(h){console.error("Failed to load data:",h)}finally{r(w,!1)}});function V(h){r(te,h)}function Q(h){const G=h.match(/(\d+d\d+(?:\s*\+\s*\d+)?)/i);return G?G[1]:""}function le(h){const G=h.split(/\.( |$)/)[0].trim(),g=Array.from(h.matchAll(/\*\*(.*?)\*\*/g)).map(J=>J[1].replace(/\.$/,""));let B=G;return g.length&&(B+=" | Effects: "+g.join(", ")),B}function O(){if(e(te)){if(e(m)==="spell"){const h=e(te);ve.update(G=>{const B=[];h.range&&B.push(`Range: ${h.range}`),h.castingTime&&B.push(`Cast: ${h.castingTime}`),h.duration&&B.push(`Duration: ${h.duration}`),h.actionType==="Save"&&B.push("Saving throw spell"),h.components&&h.components.length>0&&B.push(`Components: ${h.components.join(", ")}`),h.material&&B.push(`Material: ${h.material}`);const J=B.join(" | "),Oe=le(h.description),Pe={id:crypto.randomUUID(),name:`${h.name}${h.concentration?" (C)":""}${h.ritual?" (R)":""}`,bonus:h.actionType==="Attack"?5:0,damage:Q(h.description),damageType:`${h.school} (Lvl ${h.level})`,spellRef:h.name,infoNotes:J,generalNotes:Oe,castAtLevel:h.level};return G.attacks=[...G.attacks,Pe],G})}else if(e(m)==="feat"){const h=e(te);ve.update(G=>{const g=`${h.name}${h.prerequisite?` (Req: ${h.prerequisite})`:""}
${h.description}
`;return G.features=G.features?`${G.features}
${g}`:g,G})}r(te,null),p()()}}et(()=>(e(_),e(K),e(k)),()=>{r(t,e(_)!==null?Yl(ms(e(K),e(k)),e(_)):ms(e(K),e(k)))}),et(()=>(e(M),e(k)),()=>{r(v,Ql(e(M),e(k)))}),et(()=>(e(m),e(t),e(v)),()=>{r(d,e(m)==="spell"?e(t):e(v))}),ca(),Wt();var P=ir(),ye=i(P),ze=i(ye),de=a(i(ze),2);s(ze);var Te=a(ze,2),Xe=i(Te);{var ne=h=>{var G=Wn();c(h,G)},xe=h=>{var G=lr(),g=Ae(G),B=i(g),J=i(B);let Oe;var Pe=i(J);s(J);var De=a(J,2);let Be;var dt=i(De);s(De),s(B);var st=a(B,2),gt=i(st);Se(gt);var ut=a(gt,2);{var ot=ue=>{var Y=Kn();j(()=>{e(_),Ft(()=>{})});var be=i(Y);be.value=(be.__value=null)??"";var z=a(be);z.value=z.__value=0;var $e=a(z);wt($e,0,()=>[1,2,3,4,5,6,7,8,9],Ct,(Re,T)=>{var q=zn(),u=i(q);s(q);var Ie={};j(()=>{D(u,`Level ${T??""}`),Ie!==(Ie=T)&&(q.value=(q.__value=T)??"")}),c(Re,q)}),s(Y),Aa(Y,()=>e(_),Re=>r(_,Re)),c(ue,Y)};b(ut,ue=>{e(m)==="spell"&&ue(ot)})}s(st),s(g);var y=a(g,2),U=i(y),ke=i(U);{var Le=ue=>{var Y=Vn(),be=i(Y);s(Y),j(()=>D(be,`No ${e(m)??""}s found`)),c(ue,Y)},E=ue=>{var Y=ft(),be=Ae(Y);wt(be,1,()=>e(d),Ct,(z,$e)=>{var Re=Qn();let T;var q=i(Re),u=i(q,!0);s(q);var Ie=a(q,2);{var Me=he=>{const je=bt(()=>e($e));var qe=Jn(),Ve=i(qe);s(qe),j(()=>D(Ve,`Level ${H(e(je)),n(()=>e(je).level)??""} ‚Ä¢ ${H(e(je)),n(()=>e(je).school)??""}`)),c(he,qe)},re=he=>{const je=bt(()=>e($e));var qe=ft(),Ve=Ae(qe);{var Je=fe=>{var we=Yn(),Z=i(we,!0);s(we),j(()=>D(Z,(H(e(je)),n(()=>e(je).prerequisite)))),c(fe,we)};b(Ve,fe=>{H(e(je)),n(()=>e(je).prerequisite)&&fe(Je)})}c(he,qe)};b(Ie,he=>{e(m)==="spell"?he(Me):he(re,!1)})}s(Re),j(()=>{T=jt(Re,1,"item-card svelte-1ngjemu",null,T,{selected:e(te)?.name===e($e).name}),D(u,(e($e),n(()=>e($e).name)))}),$("click",Re,()=>V(e($e))),c(z,Re)}),c(ue,Y)};b(ke,ue=>{e(d),n(()=>e(d).length===0)?ue(Le):ue(E,!1)})}s(U);var A=a(U,2);{var ie=ue=>{var Y=sr(),be=i(Y);{var z=Re=>{const T=bt(()=>e(te));var q=er(),u=Ae(q),Ie=i(u,!0);s(u);var Me=a(u,2),re=i(Me);{var he=ge=>{var Ue=qt();j(()=>D(Ue,`${H(e(T)),n(()=>e(T).school)??""} cantrip`)),c(ge,Ue)},je=ge=>{var Ue=qt();j(()=>D(Ue,`Level ${H(e(T)),n(()=>e(T).level)??""} ${H(e(T)),n(()=>e(T).school)??""}`)),c(ge,Ue)};b(re,ge=>{H(e(T)),n(()=>e(T).level===0)?ge(he):ge(je,!1)})}var qe=a(re,2);{var Ve=ge=>{var Ue=qt("(ritual)");c(ge,Ue)};b(qe,ge=>{H(e(T)),n(()=>e(T).ritual)&&ge(Ve)})}s(Me);var Je=a(Me,2),fe=a(i(Je));s(Je);var we=a(Je,2),Z=i(we),He=a(i(Z));s(Z);var _e=a(Z,2),x=a(i(_e));s(_e);var N=a(_e,2),ae=a(i(N)),se=a(ae);{var I=ge=>{var Ue=qt();j(()=>D(Ue,`(${H(e(T)),n(()=>e(T).material)??""})`)),c(ge,Ue)};b(se,ge=>{H(e(T)),n(()=>e(T).material)&&ge(I)})}s(N);var ee=a(N,2),We=a(i(ee),2);{var W=ge=>{var Ue=qt("Concentration,");c(ge,Ue)};b(We,ge=>{H(e(T)),n(()=>e(T).concentration)&&ge(W)})}var Ge=a(We,1,!0);s(ee),s(we);var Ke=a(we,2),tt=i(Ke,!0);s(Ke);var oe=a(Ke,2);{var pe=ge=>{var Ue=Xn(),ce=a(i(Ue));s(Ue),j(()=>D(ce,` ${H(e(T)),n(()=>e(T).higherLevelSlot)??""}`)),c(ge,Ue)};b(oe,ge=>{H(e(T)),n(()=>e(T).higherLevelSlot)&&ge(pe)})}var Ze=a(oe,2);{var nt=ge=>{var Ue=Zn(),ce=a(i(Ue));s(Ue),j(()=>D(ce,` ${H(e(T)),n(()=>e(T).cantripUpgrade)??""}`)),c(ge,Ue)};b(Ze,ge=>{H(e(T)),n(()=>e(T).cantripUpgrade)&&ge(nt)})}j((ge,Ue)=>{D(Ie,(H(e(T)),n(()=>e(T).name))),D(fe,` ${ge??""}`),D(He,` ${H(e(T)),n(()=>e(T).castingTime||e(T).actionType)??""}`),D(x,` ${H(e(T)),n(()=>e(T).range)??""}`),D(ae,` ${Ue??""}`),D(Ge,(H(e(T)),n(()=>e(T).duration))),D(tt,(H(e(T)),n(()=>e(T).description)))},[()=>(H(e(T)),n(()=>e(T).classes.join(", "))),()=>(H(e(T)),n(()=>e(T).components.join(", ").toUpperCase()))]),c(Re,q)},$e=Re=>{const T=bt(()=>e(te));var q=ar(),u=Ae(q),Ie=i(u,!0);s(u);var Me=a(u,2);{var re=Ve=>{var Je=tr(),fe=a(i(Je));s(Je),j(()=>D(fe,` ${H(e(T)),n(()=>e(T).prerequisite)??""}`)),c(Ve,Je)};b(Me,Ve=>{H(e(T)),n(()=>e(T).prerequisite)&&Ve(re)})}var he=a(Me,2),je=i(he,!0);s(he);var qe=a(he,2);j(()=>{D(Ie,(H(e(T)),n(()=>e(T).name))),D(je,(H(e(T)),n(()=>e(T).description))),Qe(qe,"href",(H(e(T)),n(()=>e(T).source)))}),c(Re,q)};b(be,Re=>{e(m)==="spell"?Re(z):Re($e,!1)})}s(Y),c(ue,Y)};b(A,ue=>{e(te)&&ue(ie)})}s(y),j(()=>{Oe=jt(J,1,"tab svelte-1ngjemu",null,Oe,{active:e(m)==="spell"}),D(Pe,`üìú Spells (${e(K),n(()=>e(K).length)??""})`),Be=jt(De,1,"tab svelte-1ngjemu",null,Be,{active:e(m)==="feat"}),D(dt,`‚≠ê Feats (${e(M),n(()=>e(M).length)??""})`)}),$("click",J,()=>{r(m,"spell"),r(te,null),r(k,"")}),$("click",De,()=>{r(m,"feat"),r(te,null),r(k,"")}),Ne(gt,()=>e(k),ue=>r(k,ue)),c(h,G)};b(Xe,h=>{e(w)?h(ne):h(xe,!1)})}s(Te);var Ee=a(Te,2),L=i(Ee),R=a(L,2);s(Ee),s(ye),s(P),j(()=>R.disabled=!e(te)),$("click",de,function(...h){p()?.apply(this,h)}),$("click",L,function(...h){p()?.apply(this,h)}),$("click",R,O),$("click",ye,ns(function(h){ya.call(this,o,h)})),$("keydown",ye,function(h){ya.call(this,o,h)}),$("click",P,function(...h){p()?.apply(this,h)}),$("keydown",P,h=>h.key==="Escape"&&p()()),c(l,P),Kt()}var rr=f('<span class="resistance-tag svelte-gdwwx1"> <button type="button" class="tag-remove svelte-gdwwx1">√ó</button></span>'),or=f('<div class="resistance-list svelte-gdwwx1"></div>'),cr=f('<p class="ability-meta svelte-gdwwx1"> <!></p>'),vr=f('<p class="ability-meta svelte-gdwwx1">Requires Reaction</p>'),dr=f('<div class="ability-card svelte-gdwwx1"><div class="ability-header svelte-gdwwx1"><strong class="svelte-gdwwx1"> </strong> <button type="button" class="ability-remove svelte-gdwwx1">√ó</button></div> <p class="ability-description svelte-gdwwx1"> </p> <!></div>'),ur=f('<div class="abilities-list svelte-gdwwx1"></div>'),pr=f(`<div class="modal-backdrop svelte-gdwwx1" role="presentation"><div class="modal-content svelte-gdwwx1" role="dialog" aria-modal="true" aria-labelledby="modal-title"><div class="modal-header svelte-gdwwx1"><h3 id="modal-title" class="svelte-gdwwx1">Add Custom Condition</h3> <button class="btn-close svelte-gdwwx1" aria-label="Close">√ó</button></div> <div class="modal-body svelte-gdwwx1"><div class="form-group svelte-gdwwx1"><label for="conditionName" class="svelte-gdwwx1">Condition Name*</label> <input type="text" id="conditionName" placeholder="e.g., Cazna's Mark" class="svelte-gdwwx1"/></div> <div class="form-group svelte-gdwwx1"><label for="description" class="svelte-gdwwx1">Description</label> <textarea id="description" placeholder="Describe the condition..." rows="3" class="svelte-gdwwx1"></textarea></div> <div class="form-row svelte-gdwwx1"><div class="form-group svelte-gdwwx1"><label for="attackBonus" class="svelte-gdwwx1">Attack Bonus</label> <input type="text" id="attackBonus" placeholder="0 or 1d4" class="svelte-gdwwx1"/></div> <div class="form-group svelte-gdwwx1"><label for="damageBonus" class="svelte-gdwwx1">Damage Bonus</label> <input type="text" id="damageBonus" placeholder="0 or 1d6" class="svelte-gdwwx1"/></div> <div class="form-group svelte-gdwwx1"><label for="acBonus" class="svelte-gdwwx1">AC Bonus</label> <input type="number" id="acBonus" placeholder="0" class="svelte-gdwwx1"/></div></div> <div class="form-group svelte-gdwwx1"><label for="darkvision" class="svelte-gdwwx1">Darkvision (feet)</label> <input type="number" id="darkvision" placeholder="0" min="0" step="30" class="svelte-gdwwx1"/> <small class="help-text svelte-gdwwx1">Grant or extend darkvision (e.g., 60 for 60 feet)</small></div> <div class="form-group svelte-gdwwx1"><label class="svelte-gdwwx1">Damage Resistances</label> <div class="resistance-input-group svelte-gdwwx1"><input type="text" placeholder="e.g., cold, fire, poison" class="svelte-gdwwx1"/> <button type="button" class="btn-add svelte-gdwwx1">Add</button></div> <!></div> <div class="form-group svelte-gdwwx1"><label class="svelte-gdwwx1">Special Abilities</label> <div class="ability-form svelte-gdwwx1"><input type="text" placeholder="Ability name (e.g., Flicker of Deceit)" class="ability-name-input svelte-gdwwx1"/> <textarea placeholder="Ability description..." rows="2" class="ability-desc-input svelte-gdwwx1"></textarea> <div class="ability-options svelte-gdwwx1"><div class="ability-option svelte-gdwwx1"><label for="abilityUses" class="svelte-gdwwx1">Uses per rest</label> <input type="number" id="abilityUses" min="0" class="svelte-gdwwx1"/></div> <div class="ability-option svelte-gdwwx1"><label for="restType" class="svelte-gdwwx1">Rest type</label> <select id="restType" class="svelte-gdwwx1"><option>Short</option><option>Long</option></select></div> <div class="ability-option svelte-gdwwx1"><label class="svelte-gdwwx1"><input type="checkbox" class="svelte-gdwwx1"/> Requires Reaction</label></div></div> <button type="button" class="btn-add svelte-gdwwx1">Add Ability</button></div> <!></div></div> <div class="modal-footer svelte-gdwwx1"><button class="btn btn-secondary svelte-gdwwx1">Cancel</button> <button class="btn btn-primary svelte-gdwwx1">Add Condition</button></div></div></div>`);function fr(l,o){zt(o,!1);let t=yt(o,"show",8,!1),v=yt(o,"onSave",8),d=yt(o,"onCancel",8),p=S(""),m=S(""),w=S(0),k=S(0),_=S(0),K=S(0),M=S([]),te=S(""),V=S([]),Q=S(""),le=S(""),O=S(0),P=S("short"),ye=S(!1);function ze(){r(p,""),r(m,""),r(w,0),r(k,0),r(_,0),r(K,0),r(M,[]),r(te,""),r(V,[]),r(Q,""),r(le,""),r(O,0),r(P,"short"),r(ye,!1)}function de(){e(te).trim()&&(r(M,[...e(M),e(te).trim()]),r(te,""))}function Te(g){r(M,e(M).filter((B,J)=>J!==g))}function Xe(){if(e(Q).trim()&&e(le).trim()){const g={name:e(Q).trim(),description:e(le).trim(),requiresReaction:e(ye)};e(O)>0&&(g.usesPerRest=e(O),g.currentUses=e(O),g.restType=e(P)),r(V,[...e(V),g]),r(Q,""),r(le,""),r(O,0),r(P,"short"),r(ye,!1)}}function ne(g){r(V,e(V).filter((B,J)=>J!==g))}function xe(){if(!e(p).trim()){alert("Please enter a condition name");return}const g={name:e(p).trim(),description:e(m).trim()||"Custom condition",attackBonus:e(w)||0,damageBonus:e(k)||0,target:"self"};e(_)!==0&&(g.acBonus=e(_)),e(K)>0&&(g.darkvision=e(K)),e(M).length>0&&(g.resistances=e(M)),e(V).length>0&&(g.abilities=e(V)),v()(g),ze()}function Ee(){ze(),d()()}function L(g){g.target===g.currentTarget&&Ee()}Wt();var R=ft(),h=Ae(R);{var G=g=>{var B=pr(),J=i(B),Oe=i(J),Pe=a(i(Oe),2);s(Oe);var De=a(Oe,2),Be=i(De),dt=a(i(Be),2);Se(dt),s(Be);var st=a(Be,2),gt=a(i(st),2);ga(gt),s(st);var ut=a(st,2),ot=i(ut),y=a(i(ot),2);Se(y),s(ot);var U=a(ot,2),ke=a(i(U),2);Se(ke),s(U);var Le=a(U,2),E=a(i(Le),2);Se(E),s(Le),s(ut);var A=a(ut,2),ie=a(i(A),2);Se(ie),Gt(2),s(A);var ue=a(A,2),Y=a(i(ue),2),be=i(Y);Se(be);var z=a(be,2);s(Y);var $e=a(Y,2);{var Re=I=>{var ee=or();wt(ee,5,()=>e(M),Ct,(We,W,Ge)=>{var Ke=rr(),tt=i(Ke),oe=a(tt);s(Ke),j(()=>{D(tt,`${e(W)??""} `),Qe(oe,"aria-label",`Remove ${e(W)??""}`)}),$("click",oe,()=>Te(Ge)),c(We,Ke)}),s(ee),c(I,ee)};b($e,I=>{e(M),n(()=>e(M).length>0)&&I(Re)})}s(ue);var T=a(ue,2),q=a(i(T),2),u=i(q);Se(u);var Ie=a(u,2);ga(Ie);var Me=a(Ie,2),re=i(Me),he=a(i(re),2);Se(he),s(re);var je=a(re,2),qe=a(i(je),2);j(()=>{e(P),Ft(()=>{})});var Ve=i(qe);Ve.value=Ve.__value="short";var Je=a(Ve);Je.value=Je.__value="long",s(qe),s(je);var fe=a(je,2),we=i(fe),Z=i(we);Se(Z),Gt(),s(we),s(fe),s(Me);var He=a(Me,2);s(q);var _e=a(q,2);{var x=I=>{var ee=ur();wt(ee,5,()=>e(V),Ct,(We,W,Ge)=>{var Ke=dr(),tt=i(Ke),oe=i(tt),pe=i(oe,!0);s(oe);var Ze=a(oe,2);s(tt);var nt=a(tt,2),ge=i(nt,!0);s(nt);var Ue=a(nt,2);{var ce=at=>{var C=cr(),Ce=i(C),F=a(Ce);{var Fe=X=>{var lt=qt("‚Ä¢ Requires Reaction");c(X,lt)};b(F,X=>{e(W),n(()=>e(W).requiresReaction)&&X(Fe)})}s(C),j(()=>D(Ce,`${e(W),n(()=>e(W).usesPerRest)??""} use${e(W),n(()=>e(W).usesPerRest>1?"s":"")??""} per ${e(W),n(()=>e(W).restType)??""}
                      rest `)),c(at,C)},pt=at=>{var C=ft(),Ce=Ae(C);{var F=Fe=>{var X=vr();c(Fe,X)};b(Ce,Fe=>{e(W),n(()=>e(W).requiresReaction)&&Fe(F)},!0)}c(at,C)};b(Ue,at=>{e(W),n(()=>e(W).usesPerRest)?at(ce):at(pt,!1)})}s(Ke),j(()=>{D(pe,(e(W),n(()=>e(W).name))),Qe(Ze,"aria-label",`Remove ${e(W),n(()=>e(W).name)??""}`),D(ge,(e(W),n(()=>e(W).description)))}),$("click",Ze,()=>ne(Ge)),c(We,Ke)}),s(ee),c(I,ee)};b(_e,I=>{e(V),n(()=>e(V).length>0)&&I(x)})}s(T),s(De);var N=a(De,2),ae=i(N),se=a(ae,2);s(N),s(J),s(B),$("click",Pe,Ee),Ne(dt,()=>e(p),I=>r(p,I)),Ne(gt,()=>e(m),I=>r(m,I)),Ne(y,()=>e(w),I=>r(w,I)),Ne(ke,()=>e(k),I=>r(k,I)),Ne(E,()=>e(_),I=>r(_,I)),Ne(ie,()=>e(K),I=>r(K,I)),Ne(be,()=>e(te),I=>r(te,I)),$("keydown",be,I=>I.key==="Enter"&&de()),$("click",z,de),Ne(u,()=>e(Q),I=>r(Q,I)),Ne(Ie,()=>e(le),I=>r(le,I)),Ne(he,()=>e(O),I=>r(O,I)),Aa(qe,()=>e(P),I=>r(P,I)),_a(Z,()=>e(ye),I=>r(ye,I)),$("click",He,Xe),$("click",ae,Ee),$("click",se,xe),$("click",B,L),c(g,B)};b(h,g=>{t()&&g(G)})}c(l,R),Kt()}var gr=f('<link rel="icon" type="image/png" href="favicon4.png"/> <meta name="viewport" content="width=device-width, initial-scale=1"/>',1),mr=f('<span class="character-name svelte-1uha8ag"> </span>'),br=f("<span> </span>"),hr=f('<div class="spell-slots-header svelte-1uha8ag"></div>'),_r=f("<span> </span><br/>",1),yr=f("<span> </span><br/>",1),xr=f("<span> </span><br/>",1),kr=f("<span> </span><br/>",1),wr=f("<span> </span><br/>",1),Sr=f("<span> </span><br/>",1),$r=f("<br/><em> <!>)</em>",1),Cr=f("<br/><em>(requires reaction)</em>",1),Dr=f('<div class="ability-detail"><strong> </strong> <!></div>'),Lr=f('<div class="abilities-section"><strong>Abilities:</strong><br/> <!></div>'),jr=f('<span class="effect-tooltip"><strong> </strong><br/> <br/> <!> <!> <!> <!> <!> <!> <!></span>'),Ar=f('<button class="effect-remove-btn svelte-1uha8ag">√ó</button>'),Br=f('<span class="effect-badge svelte-1uha8ag" tabindex="0"> <!> <!></span>'),Rr=f(`<div class="active-effects-header svelte-1uha8ag"></div> <style>.effect-badge {
              position: relative;
            }
            .effect-tooltip {
              position: absolute;
              top: 120%;
              left: 50%;
              transform: translateX(-50%);
              background: #fff;
              color: #222;
              border: 1px solid #a5b4fc;
              border-radius: 6px;
              padding: 8px 12px;
              font-size: 0.95em;
              box-shadow: 0 2px 8px rgba(0, 0, 0, 0.12);
              z-index: 10;
              min-width: 180px;
              max-width: 300px;
              white-space: normal;
              pointer-events: none;
              opacity: 1;
              transition: opacity 0.15s;
            }

            .abilities-section {
              margin-top: 8px;
              padding-top: 8px;
              border-top: 1px solid #e5e7eb;
            }

            .ability-detail {
              margin-top: 6px;
              padding: 4px;
              background: #f9fafb;
              border-radius: 4px;
              font-size: 0.9em;
            }

            .ability-detail strong {
              color: #6366f1;
            }

            .ability-detail em {
              font-size: 0.85em;
              color: #6b7280;
            }</style>`,1),Mr=f('<div class="rest-menu svelte-1uha8ag"><button class="rest-option svelte-1uha8ag">‚òï Short Rest</button> <button class="rest-option svelte-1uha8ag">üõèÔ∏è Long Rest</button></div>'),Fr=f('<div class="container svelte-1uha8ag"><header class="svelte-1uha8ag"><div class="header-top svelte-1uha8ag"><div class="header-title svelte-1uha8ag"><div class="title-row svelte-1uha8ag"><h1 class="svelte-1uha8ag">D&D Character Sheet</h1> <!></div> <!> <!></div> <div class="header-right svelte-1uha8ag"><div class="header-controls svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">üé≤</span><span class="btn-text svelte-1uha8ag">Roll Dice</span></button> <div class="rest-button-container svelte-1uha8ag"><button class="btn btn-secondary use-enabled"><span class="btn-icon svelte-1uha8ag">üò¥</span><span class="btn-text svelte-1uha8ag">Rest</span></button> <!></div> <button class="btn btn-secondary use-enabled" title="Add custom condition with effects"><span class="btn-icon svelte-1uha8ag">‚ú®</span><span class="btn-text svelte-1uha8ag">Add Condition</span></button> <div class="mode-toggle"><button><span class="btn-icon svelte-1uha8ag"> </span><span class="btn-text svelte-1uha8ag"> </span></button></div></div> <div class="header-search svelte-1uha8ag"><input type="text" placeholder="üîç Search..." class="search-input use-enabled svelte-1uha8ag"/></div></div></div> <div class="header-actions svelte-1uha8ag"><button class="btn btn-mode svelte-1uha8ag">üìö Browse Spells & Feats</button> <button class="btn btn-secondary">Save to Gist</button> <button class="btn btn-secondary">Load from Gist</button> <button class="btn btn-secondary">Export JSON</button> <button class="btn btn-secondary">Import JSON</button> <input type="file" accept=".json" style="display: none;"/></div></header> <main class="svelte-1uha8ag"><!> <!> <!> <!> <!> <!> <!></main></div> <!> <!> <!> <!> <!>',1);function Gr(l,o){zt(o,!1);const t=()=>vt(ve,"$character",p),v=()=>vt(pa,"$isEditMode",p),d=()=>vt(fa,"$searchFilter",p),[p,m]=ra();function w(){const C=[],Ce=t().classFeatures.spellSlotsByLevel||{};for(let F=1;F<=9;F++){const Fe=Ce[F];if(Fe&&Fe.length>0){const X=Fe.length,lt=Fe.filter(me=>me).length;C.push({level:F,available:X-lt,total:X})}}return C}let k=S(!1),_=S(!1),K=S(!1),M=S(!1),te=S("save"),V=S(void 0),Q=S(""),le=S(""),O=S(""),P=S(!1),ye=S([]),ze=S("other"),de=S(),Te=!1,Xe=1,ne=S(!1),xe=S(null);function Ee(C){r(xe,C)}function L(){r(xe,null)}function R(C){r(xe,e(xe)===C?null:C)}function h(C){ve.update(Ce=>(Ce.activeStates||(Ce.activeStates=[]),Ce.activeStates=[...Ce.activeStates,C],Ce)),r(M,!1),Zt.add(`Added condition: ${C.name}`,"success")}function G(){r(M,!1)}function g(){const C=[];ve.update(F=>{const Fe=F.hitDice.current;F.hitDice.current=Math.min(F.hitDice.max,F.hitDice.current+Math.max(1,Math.floor(F.hitDice.max/2)));const X=F.hitDice.current-Fe;if(X>0&&C.push(`${X} hit ${X===1?"die":"dice"}`),F.class){const lt=xa(F.class,F.level,F.subclass);F.classFeatures.features||(F.classFeatures.features={}),lt.forEach(me=>{if(me.resetOn==="short"){const it=me.name.replace(/\s+/g,"");if(me.type==="uses"){const Ye=typeof me.maxUses=="function"?me.maxUses(F.level):me.maxUses;F.classFeatures.features[it]=Array(Ye).fill(!1),C.push(me.name)}else if(me.type==="pool"){const Ye=typeof me.maxPool=="function"?me.maxPool(F.level):me.maxPool;Ye!==void 0&&(F.classFeatures.features[it]=Ye,C.push(me.name))}}})}return F.activeStates&&F.activeStates.forEach(lt=>{lt.abilities&&lt.abilities.forEach(me=>{if(me.restType==="short"&&me.usesPerRest){const it=me.usesPerRest-(me.currentUses||0)>0;me.currentUses=me.usesPerRest,it&&C.push(`${lt.name}: ${me.name}`)}})}),F}),r(ne,!1);const Ce=C.length>0?`Short rest taken! Restored: ${C.join(", ")}`:"Short rest taken!";Zt.add(Ce,"success")}function B(){const C=[];ve.update(F=>{const Fe=F.maxHP-F.currentHP;Fe>0&&C.push(`${Fe} HP`),F.currentHP=F.maxHP,F.tempHP=0;const X=F.hitDice.max-F.hitDice.current;X>0&&C.push(`${X} hit ${X===1?"die":"dice"}`),F.hitDice.current=F.hitDice.max;let lt=0;if(F.classFeatures.spellSlotsByLevel&&Object.keys(F.classFeatures.spellSlotsByLevel).forEach(me=>{const it=F.classFeatures.spellSlotsByLevel[parseInt(me)];if(it){const Ye=it.filter(Tt=>Tt).length;lt+=Ye,F.classFeatures.spellSlotsByLevel[parseInt(me)]=Array(it.length).fill(!1)}}),lt>0&&C.push(`${lt} spell ${lt===1?"slot":"slots"}`),F.class){const me=xa(F.class,F.level,F.subclass);F.classFeatures.features||(F.classFeatures.features={});let it=!1;me.forEach(Ye=>{const Tt=Ye.name.replace(/\s+/g,"");if(!(Ye.type==="info"||Ye.type==="channelDivinity")){if(Ye.type==="uses"){const Vt=typeof Ye.maxUses=="function"?Ye.maxUses(F.level):Ye.maxUses;F.classFeatures.features[Tt]=Array(Vt).fill(!1),it=!0}else if(Ye.type==="pool"){const Vt=typeof Ye.maxPool=="function"?Ye.maxPool(F.level):Ye.maxPool;Vt!==void 0&&(F.classFeatures.features[Tt]=Vt,it=!0)}}}),it&&C.push("all class features")}if(F.activeStates){let me=!1;F.activeStates.forEach(it=>{it.abilities&&it.abilities.forEach(Ye=>{if(Ye.usesPerRest){const Tt=(Ye.currentUses||0)<Ye.usesPerRest;Ye.currentUses=Ye.usesPerRest,Tt&&(me=!0)}})}),me&&C.push("condition abilities")}return F}),r(ne,!1);const Ce=C.length>0?`Long rest taken! Restored: ${C.join(", ")}`:"Long rest taken! Fully rested.";Zt.add(Ce,"success")}function J(C){r(Q,""),r(le,""),r(O,""),r(P,!1),r(ye,[]),r(ze,"other"),Te=!1,typeof C=="string"?r(Q,C):(r(Q,C.notation),r(le,C.damageNotation||""),r(O,C.attackName||""),r(P,!!C.applyHalfDamage),r(ye,C.bonusBreakdown||[]),r(ze,C.rollType||"other")),r(k,!0)}function Oe(C){const{notation:Ce,count:F,bonusBreakdown:Fe}=C.detail;r(Q,""),Te=!0,Xe=F||1,setTimeout(()=>{r(Q,Ce),r(le,""),r(O,"Hit Die"),r(ye,Fe||[]),r(ze,"other")},0),r(k,!0)}function Pe(){if(r(k,!1),Te&&e(de)){const C=e(de).getLastRollTotal();if(C!==null){const Ce=Math.max(1,C);ve.update(F=>(F.hitDice.current=Math.max(0,F.hitDice.current-Xe),F.currentHP=Math.min(F.maxHP,F.currentHP+Ce),F))}Te=!1}}function De(){pa.update(C=>!C)}function Be(C){C.target.closest(".rest-button-container")||r(ne,!1)}ka(()=>{const C=pa.subscribe(Ce=>{Ce?document.body.classList.remove("use-mode"):document.body.classList.add("use-mode")});return document.addEventListener("click",Be),()=>{C(),document.removeEventListener("click",Be)}});function dt(){el(t())}function st(){e(V)?.click()}async function gt(C){const F=C.target.files?.[0];if(F)try{const Fe=await tl(F);ve.set(Fe),alert("Character imported successfully!")}catch{alert("Failed to import character file")}}Wt();var ut=Fr();Xs("1uha8ag",C=>{var Ce=gr();Gt(2),ks(()=>{Js.title="D&D Character Sheet"}),c(C,Ce)});var ot=Ae(ut),y=i(ot),U=i(y),ke=i(U),Le=i(ke),E=a(i(Le),2);{var A=C=>{var Ce=mr(),F=i(Ce);s(Ce),j(()=>D(F,`${t().name??""} (${t().level??""})`)),c(C,Ce)};b(E,C=>{t().name&&C(A)})}s(Le);var ie=a(Le,2);{var ue=C=>{var Ce=hr();wt(Ce,5,w,Ct,(F,Fe)=>{var X=br();let lt;var me=i(X);s(X),j(()=>{lt=jt(X,1,"slot-badge svelte-1uha8ag",null,lt,{depleted:e(Fe).available===0}),D(me,`Lv${e(Fe).level??""}: ${e(Fe).available??""}/${e(Fe).total??""}`)}),c(F,X)}),s(Ce),c(C,Ce)};b(ie,C=>{w().length>0&&C(ue)})}var Y=a(ie,2);{var be=C=>{var Ce=Rr(),F=Ae(Ce);wt(F,5,()=>t().activeStates,Ct,(Fe,X,lt)=>{var me=Br(),it=i(me),Ye=a(it);{var Tt=xt=>{var Jt=jr(),$t=i(Jt),Ht=i($t,!0);s($t);var Et=a($t,2),Ut=a(Et,3);{var St=rt=>{var mt=_r(),ct=Ae(mt),ht=i(ct);s(ct),Gt(),j(()=>D(ht,`Attack Bonus: ${typeof e(X).attackBonus=="number"&&e(X).attackBonus>0?"+":""}${e(X).attackBonus??""}`)),c(rt,mt)};b(Ut,rt=>{e(X).attackBonus&&rt(St)})}var Dt=a(Ut,2);{var Pt=rt=>{var mt=yr(),ct=Ae(mt),ht=i(ct);s(ct),Gt(),j(()=>D(ht,`Damage Bonus: ${typeof e(X).damageBonus=="number"&&e(X).damageBonus>0?"+":""}${e(X).damageBonus??""}`)),c(rt,mt)};b(Dt,rt=>{e(X).damageBonus&&rt(Pt)})}var Yt=a(Dt,2);{var aa=rt=>{var mt=xr(),ct=Ae(mt),ht=i(ct);s(ct),Gt(),j(()=>D(ht,`AC Bonus: ${e(X).acBonus>0?"+":""}${e(X).acBonus??""}`)),c(rt,mt)};b(Yt,rt=>{e(X).acBonus&&rt(aa)})}var ia=a(Yt,2);{var Nt=rt=>{var mt=kr(),ct=Ae(mt),ht=i(ct);s(ct),Gt(),j(()=>D(ht,`Darkvision: ${e(X).darkvision??""} feet`)),c(rt,mt)};b(ia,rt=>{e(X).darkvision&&rt(Nt)})}var At=a(ia,2);{var It=rt=>{var mt=wr(),ct=Ae(mt),ht=i(ct);s(ct),Gt(),j(_t=>D(ht,`Resistances: ${_t??""}`),[()=>e(X).resistances.join(", ")]),c(rt,mt)};b(At,rt=>{e(X).resistances&&e(X).resistances.length>0&&rt(It)})}var Ot=a(At,2);{var kt=rt=>{var mt=Sr(),ct=Ae(mt),ht=i(ct);s(ct),Gt(),j(_t=>D(ht,`Immunities: ${_t??""}`),[()=>e(X).immunities.join(", ")]),c(rt,mt)};b(Ot,rt=>{e(X).immunities&&e(X).immunities.length>0&&rt(kt)})}var Qt=a(Ot,2);{var na=rt=>{var mt=Lr(),ct=a(i(mt),3);wt(ct,1,()=>e(X).abilities,Ct,(ht,_t)=>{var Xt=Dr(),sa=i(Xt),Rt=i(sa);s(sa);var Mt=a(sa),la=a(Mt);{var va=ha=>{var wa=$r(),Ma=a(Ae(wa)),Fa=i(Ma),Sa=a(Fa);{var qa=Wa=>{var As=qt(", requires reaction");c(Wa,As)};b(Sa,Wa=>{e(_t).requiresReaction&&Wa(qa)})}Gt(),s(Ma),j(()=>D(Fa,`(${(e(_t).currentUses||0)??""}/${e(_t).usesPerRest??""} uses per ${e(_t).restType??""}
                                rest`)),c(ha,wa)},Ga=ha=>{var wa=ft(),Ma=Ae(wa);{var Fa=Sa=>{var qa=Cr();Gt(),c(Sa,qa)};b(Ma,Sa=>{e(_t).requiresReaction&&Sa(Fa)},!0)}c(ha,wa)};b(la,ha=>{e(_t).usesPerRest?ha(va):ha(Ga,!1)})}s(Xt),j(()=>{D(Rt,`${e(_t).name??""}:`),D(Mt,` ${e(_t).description??""} `)}),c(ht,Xt)}),s(mt),c(rt,mt)};b(Qt,rt=>{e(X).abilities&&e(X).abilities.length>0&&rt(na)})}s(Jt),j(()=>{D(Ht,e(X).name),D(Et,` ${e(X).description??""}`)}),c(xt,Jt)};b(Ye,xt=>{e(xe)===lt&&xt(Tt)})}var Vt=a(Ye,2);{var Bt=xt=>{var Jt=Ar();j(()=>Qe(Jt,"title",`End ${e(X).name??""}`)),$("click",Jt,()=>{ve.update($t=>{if($t.activeStates){const Ht=$t.activeStates[lt];Ht?.hpBonus&&Ht.target!=="other"&&($t.maxHP-=Ht.hpBonus,$t.currentHP=Math.max(1,Math.min($t.currentHP-Ht.hpBonus,$t.maxHP))),$t.activeStates=$t.activeStates.filter((Et,Ut)=>Ut!==lt)}return $t})}),c(xt,Jt)};b(Vt,xt=>{v()||xt(Bt)})}s(me),j(()=>{Qe(me,"aria-label",e(X).name),D(it,`‚ú® ${e(X).name??""} `)}),$("mouseenter",me,()=>Ee(lt)),$("mouseleave",me,L),$("focus",me,()=>Ee(lt)),$("blur",me,L),$("click",me,()=>R(lt)),c(Fe,me)}),s(F),Gt(2),c(C,Ce)};b(Y,C=>{t().activeStates&&t().activeStates.length>0&&C(be)})}s(ke);var z=a(ke,2),$e=i(z),Re=i($e),T=a(Re,2),q=i(T),u=a(q,2);{var Ie=C=>{var Ce=Mr(),F=i(Ce),Fe=a(F,2);s(Ce),$("click",F,g),$("click",Fe,B),c(C,Ce)};b(u,C=>{e(ne)&&C(Ie)})}s(T);var Me=a(T,2),re=a(Me,2),he=i(re);let je;var qe=i(he),Ve=i(qe,!0);s(qe);var Je=a(qe),fe=i(Je,!0);s(Je),s(he),s(re),s($e);var we=a($e,2),Z=i(we);Se(Z),s(we),s(z),s(U);var He=a(U,2),_e=i(He),x=a(_e,2),N=a(x,2),ae=a(N,2),se=a(ae,2),I=a(se,2);ja(I,C=>r(V,C),()=>e(V)),s(He),s(y);var ee=a(y,2),We=i(ee);yl(We,{});var W=a(We,2);Sl(W,{$$events:{roll:C=>J(C.detail)}});var Ge=a(W,2);Gl(Ge,{$$events:{roll:C=>J(C.detail)}});var Ke=a(Ge,2);Hl(Ke,{$$events:{rollHitDice:Oe}});var tt=a(Ke,2);Oi(tt,{$$events:{roll:C=>J(C.detail)}});var oe=a(tt,2);nn(oe,{});var pe=a(oe,2);cn(pe,{}),s(ee),s(ot);var Ze=a(ot,2);ja(Sn(Ze,{get notation(){return e(Q)},get damageNotation(){return e(le)},get attackName(){return e(O)},get applyHalfDamage(){return e(P)},get bonusBreakdown(){return e(ye)},get rollType(){return e(ze)},get visible(){return e(k)},$$events:{close:Pe},$$legacy:!0}),C=>r(de,C),()=>e(de));var nt=a(Ze,2);{var ge=C=>{qn(C,{get mode(){return e(te)},$$events:{close:()=>r(_,!1)}})};b(nt,C=>{e(_)&&C(ge)})}var Ue=a(nt,2);{var ce=C=>{nr(C,{onClose:()=>r(K,!1)})};b(Ue,C=>{e(K)&&C(ce)})}var pt=a(Ue,2);fr(pt,{get show(){return e(M)},onSave:h,onCancel:G});var at=a(pt,2);Zs(at,{}),j(()=>{je=jt(he,1,"btn btn-mode svelte-1uha8ag",null,je,{"use-mode":!v()}),D(Ve,v()?"üìù":"üé≤"),D(fe,v()?"Edit Mode":"Use Mode")}),$("click",Re,()=>{r(ye,[]),r(k,!0)}),$("click",q,()=>r(ne,!e(ne))),$("click",Me,()=>r(M,!0)),$("click",he,De),Ne(Z,d,C=>al(fa,C)),$("click",_e,()=>r(K,!0)),$("click",x,()=>{r(te,"save"),r(_,!0)}),$("click",N,()=>{r(te,"load"),r(_,!0)}),$("click",ae,dt),$("click",se,st),$("change",I,gt),c(l,ut),Kt(),m()}export{Gr as component};
